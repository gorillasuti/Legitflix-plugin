function iA(i,e){for(var t=0;t<e.length;t++){const s=e[t];if(typeof s!="string"&&!Array.isArray(s)){for(const n in s)if(n!=="default"&&!(n in i)){const r=Object.getOwnPropertyDescriptor(s,n);r&&Object.defineProperty(i,n,r.get?r:{enumerable:!0,get:()=>s[n]})}}}return Object.freeze(Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&s(l)}).observe(document,{childList:!0,subtree:!0});function t(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(n){if(n.ep)return;n.ep=!0;const r=t(n);fetch(n.href,r)}})();function Rx(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var Bh={exports:{}},Bl={};var xv;function nA(){if(xv)return Bl;xv=1;var i=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(s,n,r){var l=null;if(r!==void 0&&(l=""+r),n.key!==void 0&&(l=""+n.key),"key"in n){r={};for(var c in n)c!=="key"&&(r[c]=n[c])}else r=n;return n=r.ref,{$$typeof:i,type:s,key:l,ref:n!==void 0?n:null,props:r}}return Bl.Fragment=e,Bl.jsx=t,Bl.jsxs=t,Bl}var Sv;function aA(){return Sv||(Sv=1,Bh.exports=nA()),Bh.exports}var g=aA(),Vh={exports:{}},We={};var bv;function rA(){if(bv)return We;bv=1;var i=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),n=Symbol.for("react.profiler"),r=Symbol.for("react.consumer"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),h=Symbol.for("react.suspense"),u=Symbol.for("react.memo"),f=Symbol.for("react.lazy"),p=Symbol.for("react.activity"),v=Symbol.iterator;function x(P){return P===null||typeof P!="object"?null:(P=v&&P[v]||P["@@iterator"],typeof P=="function"?P:null)}var S={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},E=Object.assign,T={};function A(P,V,se){this.props=P,this.context=V,this.refs=T,this.updater=se||S}A.prototype.isReactComponent={},A.prototype.setState=function(P,V){if(typeof P!="object"&&typeof P!="function"&&P!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,P,V,"setState")},A.prototype.forceUpdate=function(P){this.updater.enqueueForceUpdate(this,P,"forceUpdate")};function I(){}I.prototype=A.prototype;function _(P,V,se){this.props=P,this.context=V,this.refs=T,this.updater=se||S}var C=_.prototype=new I;C.constructor=_,E(C,A.prototype),C.isPureReactComponent=!0;var k=Array.isArray;function U(){}var O={H:null,A:null,T:null,S:null},F=Object.prototype.hasOwnProperty;function j(P,V,se){var he=se.ref;return{$$typeof:i,type:P,key:V,ref:he!==void 0?he:null,props:se}}function M(P,V){return j(P.type,V,P.props)}function H(P){return typeof P=="object"&&P!==null&&P.$$typeof===i}function K(P){var V={"=":"=0",":":"=2"};return"$"+P.replace(/[=:]/g,function(se){return V[se]})}var te=/\/+/g;function ae(P,V){return typeof P=="object"&&P!==null&&P.key!=null?K(""+P.key):V.toString(36)}function me(P){switch(P.status){case"fulfilled":return P.value;case"rejected":throw P.reason;default:switch(typeof P.status=="string"?P.then(U,U):(P.status="pending",P.then(function(V){P.status==="pending"&&(P.status="fulfilled",P.value=V)},function(V){P.status==="pending"&&(P.status="rejected",P.reason=V)})),P.status){case"fulfilled":return P.value;case"rejected":throw P.reason}}throw P}function D(P,V,se,he,ye){var Ae=typeof P;(Ae==="undefined"||Ae==="boolean")&&(P=null);var Pe=!1;if(P===null)Pe=!0;else switch(Ae){case"bigint":case"string":case"number":Pe=!0;break;case"object":switch(P.$$typeof){case i:case e:Pe=!0;break;case f:return Pe=P._init,D(Pe(P._payload),V,se,he,ye)}}if(Pe)return ye=ye(P),Pe=he===""?"."+ae(P,0):he,k(ye)?(se="",Pe!=null&&(se=Pe.replace(te,"$&/")+"/"),D(ye,V,se,"",function(ht){return ht})):ye!=null&&(H(ye)&&(ye=M(ye,se+(ye.key==null||P&&P.key===ye.key?"":(""+ye.key).replace(te,"$&/")+"/")+Pe)),V.push(ye)),1;Pe=0;var He=he===""?".":he+":";if(k(P))for(var Be=0;Be<P.length;Be++)he=P[Be],Ae=He+ae(he,Be),Pe+=D(he,V,se,Ae,ye);else if(Be=x(P),typeof Be=="function")for(P=Be.call(P),Be=0;!(he=P.next()).done;)he=he.value,Ae=He+ae(he,Be++),Pe+=D(he,V,se,Ae,ye);else if(Ae==="object"){if(typeof P.then=="function")return D(me(P),V,se,he,ye);throw V=String(P),Error("Objects are not valid as a React child (found: "+(V==="[object Object]"?"object with keys {"+Object.keys(P).join(", ")+"}":V)+"). If you meant to render a collection of children, use an array instead.")}return Pe}function G(P,V,se){if(P==null)return P;var he=[],ye=0;return D(P,he,"","",function(Ae){return V.call(se,Ae,ye++)}),he}function Y(P){if(P._status===-1){var V=P._result;V=V(),V.then(function(se){(P._status===0||P._status===-1)&&(P._status=1,P._result=se)},function(se){(P._status===0||P._status===-1)&&(P._status=2,P._result=se)}),P._status===-1&&(P._status=0,P._result=V)}if(P._status===1)return P._result.default;throw P._result}var oe=typeof reportError=="function"?reportError:function(P){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var V=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof P=="object"&&P!==null&&typeof P.message=="string"?String(P.message):String(P),error:P});if(!window.dispatchEvent(V))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",P);return}console.error(P)},pe={map:G,forEach:function(P,V,se){G(P,function(){V.apply(this,arguments)},se)},count:function(P){var V=0;return G(P,function(){V++}),V},toArray:function(P){return G(P,function(V){return V})||[]},only:function(P){if(!H(P))throw Error("React.Children.only expected to receive a single React element child.");return P}};return We.Activity=p,We.Children=pe,We.Component=A,We.Fragment=t,We.Profiler=n,We.PureComponent=_,We.StrictMode=s,We.Suspense=h,We.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=O,We.__COMPILER_RUNTIME={__proto__:null,c:function(P){return O.H.useMemoCache(P)}},We.cache=function(P){return function(){return P.apply(null,arguments)}},We.cacheSignal=function(){return null},We.cloneElement=function(P,V,se){if(P==null)throw Error("The argument must be a React element, but you passed "+P+".");var he=E({},P.props),ye=P.key;if(V!=null)for(Ae in V.key!==void 0&&(ye=""+V.key),V)!F.call(V,Ae)||Ae==="key"||Ae==="__self"||Ae==="__source"||Ae==="ref"&&V.ref===void 0||(he[Ae]=V[Ae]);var Ae=arguments.length-2;if(Ae===1)he.children=se;else if(1<Ae){for(var Pe=Array(Ae),He=0;He<Ae;He++)Pe[He]=arguments[He+2];he.children=Pe}return j(P.type,ye,he)},We.createContext=function(P){return P={$$typeof:l,_currentValue:P,_currentValue2:P,_threadCount:0,Provider:null,Consumer:null},P.Provider=P,P.Consumer={$$typeof:r,_context:P},P},We.createElement=function(P,V,se){var he,ye={},Ae=null;if(V!=null)for(he in V.key!==void 0&&(Ae=""+V.key),V)F.call(V,he)&&he!=="key"&&he!=="__self"&&he!=="__source"&&(ye[he]=V[he]);var Pe=arguments.length-2;if(Pe===1)ye.children=se;else if(1<Pe){for(var He=Array(Pe),Be=0;Be<Pe;Be++)He[Be]=arguments[Be+2];ye.children=He}if(P&&P.defaultProps)for(he in Pe=P.defaultProps,Pe)ye[he]===void 0&&(ye[he]=Pe[he]);return j(P,Ae,ye)},We.createRef=function(){return{current:null}},We.forwardRef=function(P){return{$$typeof:c,render:P}},We.isValidElement=H,We.lazy=function(P){return{$$typeof:f,_payload:{_status:-1,_result:P},_init:Y}},We.memo=function(P,V){return{$$typeof:u,type:P,compare:V===void 0?null:V}},We.startTransition=function(P){var V=O.T,se={};O.T=se;try{var he=P(),ye=O.S;ye!==null&&ye(se,he),typeof he=="object"&&he!==null&&typeof he.then=="function"&&he.then(U,oe)}catch(Ae){oe(Ae)}finally{V!==null&&se.types!==null&&(V.types=se.types),O.T=V}},We.unstable_useCacheRefresh=function(){return O.H.useCacheRefresh()},We.use=function(P){return O.H.use(P)},We.useActionState=function(P,V,se){return O.H.useActionState(P,V,se)},We.useCallback=function(P,V){return O.H.useCallback(P,V)},We.useContext=function(P){return O.H.useContext(P)},We.useDebugValue=function(){},We.useDeferredValue=function(P,V){return O.H.useDeferredValue(P,V)},We.useEffect=function(P,V){return O.H.useEffect(P,V)},We.useEffectEvent=function(P){return O.H.useEffectEvent(P)},We.useId=function(){return O.H.useId()},We.useImperativeHandle=function(P,V,se){return O.H.useImperativeHandle(P,V,se)},We.useInsertionEffect=function(P,V){return O.H.useInsertionEffect(P,V)},We.useLayoutEffect=function(P,V){return O.H.useLayoutEffect(P,V)},We.useMemo=function(P,V){return O.H.useMemo(P,V)},We.useOptimistic=function(P,V){return O.H.useOptimistic(P,V)},We.useReducer=function(P,V,se){return O.H.useReducer(P,V,se)},We.useRef=function(P){return O.H.useRef(P)},We.useState=function(P){return O.H.useState(P)},We.useSyncExternalStore=function(P,V,se){return O.H.useSyncExternalStore(P,V,se)},We.useTransition=function(){return O.H.useTransition()},We.version="19.2.4",We}var Tv;function Jf(){return Tv||(Tv=1,Vh.exports=rA()),Vh.exports}var w=Jf();const Lx=Rx(w),lA=iA({__proto__:null,default:Lx},[w]);var $h={exports:{}},Vl={},Gh={exports:{}},Hh={};var Ev;function oA(){return Ev||(Ev=1,(function(i){function e(D,G){var Y=D.length;D.push(G);e:for(;0<Y;){var oe=Y-1>>>1,pe=D[oe];if(0<n(pe,G))D[oe]=G,D[Y]=pe,Y=oe;else break e}}function t(D){return D.length===0?null:D[0]}function s(D){if(D.length===0)return null;var G=D[0],Y=D.pop();if(Y!==G){D[0]=Y;e:for(var oe=0,pe=D.length,P=pe>>>1;oe<P;){var V=2*(oe+1)-1,se=D[V],he=V+1,ye=D[he];if(0>n(se,Y))he<pe&&0>n(ye,se)?(D[oe]=ye,D[he]=Y,oe=he):(D[oe]=se,D[V]=Y,oe=V);else if(he<pe&&0>n(ye,Y))D[oe]=ye,D[he]=Y,oe=he;else break e}}return G}function n(D,G){var Y=D.sortIndex-G.sortIndex;return Y!==0?Y:D.id-G.id}if(i.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var r=performance;i.unstable_now=function(){return r.now()}}else{var l=Date,c=l.now();i.unstable_now=function(){return l.now()-c}}var h=[],u=[],f=1,p=null,v=3,x=!1,S=!1,E=!1,T=!1,A=typeof setTimeout=="function"?setTimeout:null,I=typeof clearTimeout=="function"?clearTimeout:null,_=typeof setImmediate<"u"?setImmediate:null;function C(D){for(var G=t(u);G!==null;){if(G.callback===null)s(u);else if(G.startTime<=D)s(u),G.sortIndex=G.expirationTime,e(h,G);else break;G=t(u)}}function k(D){if(E=!1,C(D),!S)if(t(h)!==null)S=!0,U||(U=!0,K());else{var G=t(u);G!==null&&me(k,G.startTime-D)}}var U=!1,O=-1,F=5,j=-1;function M(){return T?!0:!(i.unstable_now()-j<F)}function H(){if(T=!1,U){var D=i.unstable_now();j=D;var G=!0;try{e:{S=!1,E&&(E=!1,I(O),O=-1),x=!0;var Y=v;try{t:{for(C(D),p=t(h);p!==null&&!(p.expirationTime>D&&M());){var oe=p.callback;if(typeof oe=="function"){p.callback=null,v=p.priorityLevel;var pe=oe(p.expirationTime<=D);if(D=i.unstable_now(),typeof pe=="function"){p.callback=pe,C(D),G=!0;break t}p===t(h)&&s(h),C(D)}else s(h);p=t(h)}if(p!==null)G=!0;else{var P=t(u);P!==null&&me(k,P.startTime-D),G=!1}}break e}finally{p=null,v=Y,x=!1}G=void 0}}finally{G?K():U=!1}}}var K;if(typeof _=="function")K=function(){_(H)};else if(typeof MessageChannel<"u"){var te=new MessageChannel,ae=te.port2;te.port1.onmessage=H,K=function(){ae.postMessage(null)}}else K=function(){A(H,0)};function me(D,G){O=A(function(){D(i.unstable_now())},G)}i.unstable_IdlePriority=5,i.unstable_ImmediatePriority=1,i.unstable_LowPriority=4,i.unstable_NormalPriority=3,i.unstable_Profiling=null,i.unstable_UserBlockingPriority=2,i.unstable_cancelCallback=function(D){D.callback=null},i.unstable_forceFrameRate=function(D){0>D||125<D?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):F=0<D?Math.floor(1e3/D):5},i.unstable_getCurrentPriorityLevel=function(){return v},i.unstable_next=function(D){switch(v){case 1:case 2:case 3:var G=3;break;default:G=v}var Y=v;v=G;try{return D()}finally{v=Y}},i.unstable_requestPaint=function(){T=!0},i.unstable_runWithPriority=function(D,G){switch(D){case 1:case 2:case 3:case 4:case 5:break;default:D=3}var Y=v;v=D;try{return G()}finally{v=Y}},i.unstable_scheduleCallback=function(D,G,Y){var oe=i.unstable_now();switch(typeof Y=="object"&&Y!==null?(Y=Y.delay,Y=typeof Y=="number"&&0<Y?oe+Y:oe):Y=oe,D){case 1:var pe=-1;break;case 2:pe=250;break;case 5:pe=1073741823;break;case 4:pe=1e4;break;default:pe=5e3}return pe=Y+pe,D={id:f++,callback:G,priorityLevel:D,startTime:Y,expirationTime:pe,sortIndex:-1},Y>oe?(D.sortIndex=Y,e(u,D),t(h)===null&&D===t(u)&&(E?(I(O),O=-1):E=!0,me(k,Y-oe))):(D.sortIndex=pe,e(h,D),S||x||(S=!0,U||(U=!0,K()))),D},i.unstable_shouldYield=M,i.unstable_wrapCallback=function(D){var G=v;return function(){var Y=v;v=G;try{return D.apply(this,arguments)}finally{v=Y}}}})(Hh)),Hh}var Av;function cA(){return Av||(Av=1,Gh.exports=oA()),Gh.exports}var zh={exports:{}},Ns={};var Iv;function uA(){if(Iv)return Ns;Iv=1;var i=Jf();function e(h){var u="https://react.dev/errors/"+h;if(1<arguments.length){u+="?args[]="+encodeURIComponent(arguments[1]);for(var f=2;f<arguments.length;f++)u+="&args[]="+encodeURIComponent(arguments[f])}return"Minified React error #"+h+"; visit "+u+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function t(){}var s={d:{f:t,r:function(){throw Error(e(522))},D:t,C:t,L:t,m:t,X:t,S:t,M:t},p:0,findDOMNode:null},n=Symbol.for("react.portal");function r(h,u,f){var p=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:n,key:p==null?null:""+p,children:h,containerInfo:u,implementation:f}}var l=i.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function c(h,u){if(h==="font")return"";if(typeof u=="string")return u==="use-credentials"?u:""}return Ns.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=s,Ns.createPortal=function(h,u){var f=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!u||u.nodeType!==1&&u.nodeType!==9&&u.nodeType!==11)throw Error(e(299));return r(h,u,null,f)},Ns.flushSync=function(h){var u=l.T,f=s.p;try{if(l.T=null,s.p=2,h)return h()}finally{l.T=u,s.p=f,s.d.f()}},Ns.preconnect=function(h,u){typeof h=="string"&&(u?(u=u.crossOrigin,u=typeof u=="string"?u==="use-credentials"?u:"":void 0):u=null,s.d.C(h,u))},Ns.prefetchDNS=function(h){typeof h=="string"&&s.d.D(h)},Ns.preinit=function(h,u){if(typeof h=="string"&&u&&typeof u.as=="string"){var f=u.as,p=c(f,u.crossOrigin),v=typeof u.integrity=="string"?u.integrity:void 0,x=typeof u.fetchPriority=="string"?u.fetchPriority:void 0;f==="style"?s.d.S(h,typeof u.precedence=="string"?u.precedence:void 0,{crossOrigin:p,integrity:v,fetchPriority:x}):f==="script"&&s.d.X(h,{crossOrigin:p,integrity:v,fetchPriority:x,nonce:typeof u.nonce=="string"?u.nonce:void 0})}},Ns.preinitModule=function(h,u){if(typeof h=="string")if(typeof u=="object"&&u!==null){if(u.as==null||u.as==="script"){var f=c(u.as,u.crossOrigin);s.d.M(h,{crossOrigin:f,integrity:typeof u.integrity=="string"?u.integrity:void 0,nonce:typeof u.nonce=="string"?u.nonce:void 0})}}else u==null&&s.d.M(h)},Ns.preload=function(h,u){if(typeof h=="string"&&typeof u=="object"&&u!==null&&typeof u.as=="string"){var f=u.as,p=c(f,u.crossOrigin);s.d.L(h,f,{crossOrigin:p,integrity:typeof u.integrity=="string"?u.integrity:void 0,nonce:typeof u.nonce=="string"?u.nonce:void 0,type:typeof u.type=="string"?u.type:void 0,fetchPriority:typeof u.fetchPriority=="string"?u.fetchPriority:void 0,referrerPolicy:typeof u.referrerPolicy=="string"?u.referrerPolicy:void 0,imageSrcSet:typeof u.imageSrcSet=="string"?u.imageSrcSet:void 0,imageSizes:typeof u.imageSizes=="string"?u.imageSizes:void 0,media:typeof u.media=="string"?u.media:void 0})}},Ns.preloadModule=function(h,u){if(typeof h=="string")if(u){var f=c(u.as,u.crossOrigin);s.d.m(h,{as:typeof u.as=="string"&&u.as!=="script"?u.as:void 0,crossOrigin:f,integrity:typeof u.integrity=="string"?u.integrity:void 0})}else s.d.m(h)},Ns.requestFormReset=function(h){s.d.r(h)},Ns.unstable_batchedUpdates=function(h,u){return h(u)},Ns.useFormState=function(h,u,f){return l.H.useFormState(h,u,f)},Ns.useFormStatus=function(){return l.H.useHostTransitionStatus()},Ns.version="19.2.4",Ns}var _v;function wx(){if(_v)return zh.exports;_v=1;function i(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(i)}catch(e){console.error(e)}}return i(),zh.exports=uA(),zh.exports}var Rv;function dA(){if(Rv)return Vl;Rv=1;var i=cA(),e=Jf(),t=wx();function s(a){var o="https://react.dev/errors/"+a;if(1<arguments.length){o+="?args[]="+encodeURIComponent(arguments[1]);for(var d=2;d<arguments.length;d++)o+="&args[]="+encodeURIComponent(arguments[d])}return"Minified React error #"+a+"; visit "+o+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function n(a){return!(!a||a.nodeType!==1&&a.nodeType!==9&&a.nodeType!==11)}function r(a){var o=a,d=a;if(a.alternate)for(;o.return;)o=o.return;else{a=o;do o=a,(o.flags&4098)!==0&&(d=o.return),a=o.return;while(a)}return o.tag===3?d:null}function l(a){if(a.tag===13){var o=a.memoizedState;if(o===null&&(a=a.alternate,a!==null&&(o=a.memoizedState)),o!==null)return o.dehydrated}return null}function c(a){if(a.tag===31){var o=a.memoizedState;if(o===null&&(a=a.alternate,a!==null&&(o=a.memoizedState)),o!==null)return o.dehydrated}return null}function h(a){if(r(a)!==a)throw Error(s(188))}function u(a){var o=a.alternate;if(!o){if(o=r(a),o===null)throw Error(s(188));return o!==a?null:a}for(var d=a,m=o;;){var y=d.return;if(y===null)break;var b=y.alternate;if(b===null){if(m=y.return,m!==null){d=m;continue}break}if(y.child===b.child){for(b=y.child;b;){if(b===d)return h(y),a;if(b===m)return h(y),o;b=b.sibling}throw Error(s(188))}if(d.return!==m.return)d=y,m=b;else{for(var R=!1,N=y.child;N;){if(N===d){R=!0,d=y,m=b;break}if(N===m){R=!0,m=y,d=b;break}N=N.sibling}if(!R){for(N=b.child;N;){if(N===d){R=!0,d=b,m=y;break}if(N===m){R=!0,m=b,d=y;break}N=N.sibling}if(!R)throw Error(s(189))}}if(d.alternate!==m)throw Error(s(190))}if(d.tag!==3)throw Error(s(188));return d.stateNode.current===d?a:o}function f(a){var o=a.tag;if(o===5||o===26||o===27||o===6)return a;for(a=a.child;a!==null;){if(o=f(a),o!==null)return o;a=a.sibling}return null}var p=Object.assign,v=Symbol.for("react.element"),x=Symbol.for("react.transitional.element"),S=Symbol.for("react.portal"),E=Symbol.for("react.fragment"),T=Symbol.for("react.strict_mode"),A=Symbol.for("react.profiler"),I=Symbol.for("react.consumer"),_=Symbol.for("react.context"),C=Symbol.for("react.forward_ref"),k=Symbol.for("react.suspense"),U=Symbol.for("react.suspense_list"),O=Symbol.for("react.memo"),F=Symbol.for("react.lazy"),j=Symbol.for("react.activity"),M=Symbol.for("react.memo_cache_sentinel"),H=Symbol.iterator;function K(a){return a===null||typeof a!="object"?null:(a=H&&a[H]||a["@@iterator"],typeof a=="function"?a:null)}var te=Symbol.for("react.client.reference");function ae(a){if(a==null)return null;if(typeof a=="function")return a.$$typeof===te?null:a.displayName||a.name||null;if(typeof a=="string")return a;switch(a){case E:return"Fragment";case A:return"Profiler";case T:return"StrictMode";case k:return"Suspense";case U:return"SuspenseList";case j:return"Activity"}if(typeof a=="object")switch(a.$$typeof){case S:return"Portal";case _:return a.displayName||"Context";case I:return(a._context.displayName||"Context")+".Consumer";case C:var o=a.render;return a=a.displayName,a||(a=o.displayName||o.name||"",a=a!==""?"ForwardRef("+a+")":"ForwardRef"),a;case O:return o=a.displayName||null,o!==null?o:ae(a.type)||"Memo";case F:o=a._payload,a=a._init;try{return ae(a(o))}catch{}}return null}var me=Array.isArray,D=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,G=t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Y={pending:!1,data:null,method:null,action:null},oe=[],pe=-1;function P(a){return{current:a}}function V(a){0>pe||(a.current=oe[pe],oe[pe]=null,pe--)}function se(a,o){pe++,oe[pe]=a.current,a.current=o}var he=P(null),ye=P(null),Ae=P(null),Pe=P(null);function He(a,o){switch(se(Ae,o),se(ye,a),se(he,null),o.nodeType){case 9:case 11:a=(a=o.documentElement)&&(a=a.namespaceURI)?$0(a):0;break;default:if(a=o.tagName,o=o.namespaceURI)o=$0(o),a=G0(o,a);else switch(a){case"svg":a=1;break;case"math":a=2;break;default:a=0}}V(he),se(he,a)}function Be(){V(he),V(ye),V(Ae)}function ht(a){a.memoizedState!==null&&se(Pe,a);var o=he.current,d=G0(o,a.type);o!==d&&(se(ye,a),se(he,d))}function dt(a){ye.current===a&&(V(he),V(ye)),Pe.current===a&&(V(Pe),Ul._currentValue=Y)}var Mt,bt;function Tt(a){if(Mt===void 0)try{throw Error()}catch(d){var o=d.stack.trim().match(/\n( *(at )?)/);Mt=o&&o[1]||"",bt=-1<d.stack.indexOf(`
    at`)?" (<anonymous>)":-1<d.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Mt+a+bt}var os=!1;function Ve(a,o){if(!a||os)return"";os=!0;var d=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var m={DetermineComponentFrameRoot:function(){try{if(o){var fe=function(){throw Error()};if(Object.defineProperty(fe.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(fe,[])}catch(ne){var J=ne}Reflect.construct(a,[],fe)}else{try{fe.call()}catch(ne){J=ne}a.call(fe.prototype)}}else{try{throw Error()}catch(ne){J=ne}(fe=a())&&typeof fe.catch=="function"&&fe.catch(function(){})}}catch(ne){if(ne&&J&&typeof ne.stack=="string")return[ne.stack,J.stack]}return[null,null]}};m.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var y=Object.getOwnPropertyDescriptor(m.DetermineComponentFrameRoot,"name");y&&y.configurable&&Object.defineProperty(m.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var b=m.DetermineComponentFrameRoot(),R=b[0],N=b[1];if(R&&N){var B=R.split(`
`),X=N.split(`
`);for(y=m=0;m<B.length&&!B[m].includes("DetermineComponentFrameRoot");)m++;for(;y<X.length&&!X[y].includes("DetermineComponentFrameRoot");)y++;if(m===B.length||y===X.length)for(m=B.length-1,y=X.length-1;1<=m&&0<=y&&B[m]!==X[y];)y--;for(;1<=m&&0<=y;m--,y--)if(B[m]!==X[y]){if(m!==1||y!==1)do if(m--,y--,0>y||B[m]!==X[y]){var re=`
`+B[m].replace(" at new "," at ");return a.displayName&&re.includes("<anonymous>")&&(re=re.replace("<anonymous>",a.displayName)),re}while(1<=m&&0<=y);break}}}finally{os=!1,Error.prepareStackTrace=d}return(d=a?a.displayName||a.name:"")?Tt(d):""}function we(a,o){switch(a.tag){case 26:case 27:case 5:return Tt(a.type);case 16:return Tt("Lazy");case 13:return a.child!==o&&o!==null?Tt("Suspense Fallback"):Tt("Suspense");case 19:return Tt("SuspenseList");case 0:case 15:return Ve(a.type,!1);case 11:return Ve(a.type.render,!1);case 1:return Ve(a.type,!0);case 31:return Tt("Activity");default:return""}}function Me(a){try{var o="",d=null;do o+=we(a,d),d=a,a=a.return;while(a);return o}catch(m){return`
Error generating stack: `+m.message+`
`+m.stack}}var Qe=Object.prototype.hasOwnProperty,ge=i.unstable_scheduleCallback,_e=i.unstable_cancelCallback,De=i.unstable_shouldYield,at=i.unstable_requestPaint,st=i.unstable_now,Bt=i.unstable_getCurrentPriorityLevel,ts=i.unstable_ImmediatePriority,ys=i.unstable_UserBlockingPriority,xs=i.unstable_NormalPriority,Ss=i.unstable_LowPriority,Cs=i.unstable_IdlePriority,Ht=i.log,Bs=i.unstable_setDisableYieldValue,bs=null,Vt=null;function fs(a){if(typeof Ht=="function"&&Bs(a),Vt&&typeof Vt.setStrictMode=="function")try{Vt.setStrictMode(bs,a)}catch{}}var Et=Math.clz32?Math.clz32:ti,xi=Math.log,ei=Math.LN2;function ti(a){return a>>>=0,a===0?32:31-(xi(a)/ei|0)|0}var ms=256,Wt=262144,Us=4194304;function ss(a){var o=a&42;if(o!==0)return o;switch(a&-a){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return a&261888;case 262144:case 524288:case 1048576:case 2097152:return a&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return a&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return a}}function Ms(a,o,d){var m=a.pendingLanes;if(m===0)return 0;var y=0,b=a.suspendedLanes,R=a.pingedLanes;a=a.warmLanes;var N=m&134217727;return N!==0?(m=N&~b,m!==0?y=ss(m):(R&=N,R!==0?y=ss(R):d||(d=N&~a,d!==0&&(y=ss(d))))):(N=m&~b,N!==0?y=ss(N):R!==0?y=ss(R):d||(d=m&~a,d!==0&&(y=ss(d)))),y===0?0:o!==0&&o!==y&&(o&b)===0&&(b=y&-y,d=o&-o,b>=d||b===32&&(d&4194048)!==0)?o:y}function cs(a,o){return(a.pendingLanes&~(a.suspendedLanes&~a.pingedLanes)&o)===0}function Vs(a,o){switch(a){case 1:case 2:case 4:case 8:case 64:return o+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Si(){var a=Us;return Us<<=1,(Us&62914560)===0&&(Us=4194304),a}function si(a){for(var o=[],d=0;31>d;d++)o.push(a);return o}function Nt(a,o){a.pendingLanes|=o,o!==268435456&&(a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0)}function Ui(a,o,d,m,y,b){var R=a.pendingLanes;a.pendingLanes=d,a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0,a.expiredLanes&=d,a.entangledLanes&=d,a.errorRecoveryDisabledLanes&=d,a.shellSuspendCounter=0;var N=a.entanglements,B=a.expirationTimes,X=a.hiddenUpdates;for(d=R&~d;0<d;){var re=31-Et(d),fe=1<<re;N[re]=0,B[re]=-1;var J=X[re];if(J!==null)for(X[re]=null,re=0;re<J.length;re++){var ne=J[re];ne!==null&&(ne.lane&=-536870913)}d&=~fe}m!==0&&Mi(a,m,0),b!==0&&y===0&&a.tag!==0&&(a.suspendedLanes|=b&~(R&~o))}function Mi(a,o,d){a.pendingLanes|=o,a.suspendedLanes&=~o;var m=31-Et(o);a.entangledLanes|=o,a.entanglements[m]=a.entanglements[m]|1073741824|d&261930}function Ki(a,o){var d=a.entangledLanes|=o;for(a=a.entanglements;d;){var m=31-Et(d),y=1<<m;y&o|a[m]&o&&(a[m]|=o),d&=~y}}function ue(a,o){var d=o&-o;return d=(d&42)!==0?1:Ne(d),(d&(a.suspendedLanes|o))!==0?0:d}function Ne(a){switch(a){case 2:a=1;break;case 8:a=4;break;case 32:a=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:a=128;break;case 268435456:a=134217728;break;default:a=0}return a}function Xe(a){return a&=-a,2<a?8<a?(a&134217727)!==0?32:268435456:8:2}function zt(){var a=G.p;return a!==0?a:(a=window.event,a===void 0?32:hv(a.type))}function Ie(a,o){var d=G.p;try{return G.p=a,o()}finally{G.p=d}}var Ts=Math.random().toString(36).slice(2),gt="__reactFiber$"+Ts,At="__reactProps$"+Ts,un="__reactContainer$"+Ts,Sa="__reactEvents$"+Ts,Ya="__reactListeners$"+Ts,jm="__reactHandles$"+Ts,ho="__reactResources$"+Ts,ii="__reactMarker$"+Ts;function Qr(a){delete a[gt],delete a[At],delete a[Sa],delete a[Ya],delete a[jm]}function dn(a){var o=a[gt];if(o)return o;for(var d=a.parentNode;d;){if(o=d[un]||d[gt]){if(d=o.alternate,o.child!==null||d!==null&&d.child!==null)for(a=W0(a);a!==null;){if(d=a[gt])return d;a=W0(a)}return o}a=d,d=a.parentNode}return null}function Mn(a){if(a=a[gt]||a[un]){var o=a.tag;if(o===5||o===6||o===13||o===31||o===26||o===27||o===3)return a}return null}function ba(a){var o=a.tag;if(o===5||o===26||o===27||o===6)return a.stateNode;throw Error(s(33))}function jn(a){var o=a[ho];return o||(o=a[ho]={hoistableStyles:new Map,hoistableScripts:new Map}),o}function is(a){a[ii]=!0}var fo=new Set,qa={};function ji(a,o){Fn(a,o),Fn(a+"Capture",o)}function Fn(a,o){for(qa[a]=o,a=0;a<o.length;a++)fo.add(o[a])}var Du=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),mo={},po={};function Wr(a){return Qe.call(po,a)?!0:Qe.call(mo,a)?!1:Du.test(a)?po[a]=!0:(mo[a]=!0,!1)}function Qa(a,o,d){if(Wr(o))if(d===null)a.removeAttribute(o);else{switch(typeof d){case"undefined":case"function":case"symbol":a.removeAttribute(o);return;case"boolean":var m=o.toLowerCase().slice(0,5);if(m!=="data-"&&m!=="aria-"){a.removeAttribute(o);return}}a.setAttribute(o,""+d)}}function Wa(a,o,d){if(d===null)a.removeAttribute(o);else{switch(typeof d){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(o);return}a.setAttribute(o,""+d)}}function Z(a,o,d,m){if(m===null)a.removeAttribute(d);else{switch(typeof m){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(d);return}a.setAttributeNS(o,d,""+m)}}function Ce(a){switch(typeof a){case"bigint":case"boolean":case"number":case"string":case"undefined":return a;case"object":return a;default:return""}}function Ze(a){var o=a.type;return(a=a.nodeName)&&a.toLowerCase()==="input"&&(o==="checkbox"||o==="radio")}function it(a,o,d){var m=Object.getOwnPropertyDescriptor(a.constructor.prototype,o);if(!a.hasOwnProperty(o)&&typeof m<"u"&&typeof m.get=="function"&&typeof m.set=="function"){var y=m.get,b=m.set;return Object.defineProperty(a,o,{configurable:!0,get:function(){return y.call(this)},set:function(R){d=""+R,b.call(this,R)}}),Object.defineProperty(a,o,{enumerable:m.enumerable}),{getValue:function(){return d},setValue:function(R){d=""+R},stopTracking:function(){a._valueTracker=null,delete a[o]}}}}function kt(a){if(!a._valueTracker){var o=Ze(a)?"checked":"value";a._valueTracker=it(a,o,""+a[o])}}function bi(a){if(!a)return!1;var o=a._valueTracker;if(!o)return!0;var d=o.getValue(),m="";return a&&(m=Ze(a)?a.checked?"true":"false":a.value),a=m,a!==d?(o.setValue(a),!0):!1}function Xt(a){if(a=a||(typeof document<"u"?document:void 0),typeof a>"u")return null;try{return a.activeElement||a.body}catch{return a.body}}var Bn=/[\n"\\]/g;function Kt(a){return a.replace(Bn,function(o){return"\\"+o.charCodeAt(0).toString(16)+" "})}function Os(a,o,d,m,y,b,R,N){a.name="",R!=null&&typeof R!="function"&&typeof R!="symbol"&&typeof R!="boolean"?a.type=R:a.removeAttribute("type"),o!=null?R==="number"?(o===0&&a.value===""||a.value!=o)&&(a.value=""+Ce(o)):a.value!==""+Ce(o)&&(a.value=""+Ce(o)):R!=="submit"&&R!=="reset"||a.removeAttribute("value"),o!=null?Xa(a,R,Ce(o)):d!=null?Xa(a,R,Ce(d)):m!=null&&a.removeAttribute("value"),y==null&&b!=null&&(a.defaultChecked=!!b),y!=null&&(a.checked=y&&typeof y!="function"&&typeof y!="symbol"),N!=null&&typeof N!="function"&&typeof N!="symbol"&&typeof N!="boolean"?a.name=""+Ce(N):a.removeAttribute("name")}function Xr(a,o,d,m,y,b,R,N){if(b!=null&&typeof b!="function"&&typeof b!="symbol"&&typeof b!="boolean"&&(a.type=b),o!=null||d!=null){if(!(b!=="submit"&&b!=="reset"||o!=null)){kt(a);return}d=d!=null?""+Ce(d):"",o=o!=null?""+Ce(o):d,N||o===a.value||(a.value=o),a.defaultValue=o}m=m??y,m=typeof m!="function"&&typeof m!="symbol"&&!!m,a.checked=N?a.checked:!!m,a.defaultChecked=!!m,R!=null&&typeof R!="function"&&typeof R!="symbol"&&typeof R!="boolean"&&(a.name=R),kt(a)}function Xa(a,o,d){o==="number"&&Xt(a.ownerDocument)===a||a.defaultValue===""+d||(a.defaultValue=""+d)}function Vn(a,o,d,m){if(a=a.options,o){o={};for(var y=0;y<d.length;y++)o["$"+d[y]]=!0;for(d=0;d<a.length;d++)y=o.hasOwnProperty("$"+a[d].value),a[d].selected!==y&&(a[d].selected=y),y&&m&&(a[d].defaultSelected=!0)}else{for(d=""+Ce(d),o=null,y=0;y<a.length;y++){if(a[y].value===d){a[y].selected=!0,m&&(a[y].defaultSelected=!0);return}o!==null||a[y].disabled||(o=a[y])}o!==null&&(o.selected=!0)}}function Zr(a,o,d){if(o!=null&&(o=""+Ce(o),o!==a.value&&(a.value=o),d==null)){a.defaultValue!==o&&(a.defaultValue=o);return}a.defaultValue=d!=null?""+Ce(d):""}function go(a,o,d,m){if(o==null){if(m!=null){if(d!=null)throw Error(s(92));if(me(m)){if(1<m.length)throw Error(s(93));m=m[0]}d=m}d==null&&(d=""),o=d}d=Ce(o),a.defaultValue=d,m=a.textContent,m===d&&m!==""&&m!==null&&(a.value=m),kt(a)}function $n(a,o){if(o){var d=a.firstChild;if(d&&d===a.lastChild&&d.nodeType===3){d.nodeValue=o;return}}a.textContent=o}var Pu=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Fm(a,o,d){var m=o.indexOf("--")===0;d==null||typeof d=="boolean"||d===""?m?a.setProperty(o,""):o==="float"?a.cssFloat="":a[o]="":m?a.setProperty(o,d):typeof d!="number"||d===0||Pu.has(o)?o==="float"?a.cssFloat=d:a[o]=(""+d).trim():a[o]=d+"px"}function Bm(a,o,d){if(o!=null&&typeof o!="object")throw Error(s(62));if(a=a.style,d!=null){for(var m in d)!d.hasOwnProperty(m)||o!=null&&o.hasOwnProperty(m)||(m.indexOf("--")===0?a.setProperty(m,""):m==="float"?a.cssFloat="":a[m]="");for(var y in o)m=o[y],o.hasOwnProperty(y)&&d[y]!==m&&Fm(a,y,m)}else for(var b in o)o.hasOwnProperty(b)&&Fm(a,b,o[b])}function Uu(a){if(a.indexOf("-")===-1)return!1;switch(a){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Jb=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),eT=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function vo(a){return eT.test(""+a)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":a}function hn(){}var Mu=null;function ju(a){return a=a.target||a.srcElement||window,a.correspondingUseElement&&(a=a.correspondingUseElement),a.nodeType===3?a.parentNode:a}var Za=null,Ja=null;function Vm(a){var o=Mn(a);if(o&&(a=o.stateNode)){var d=a[At]||null;e:switch(a=o.stateNode,o.type){case"input":if(Os(a,d.value,d.defaultValue,d.defaultValue,d.checked,d.defaultChecked,d.type,d.name),o=d.name,d.type==="radio"&&o!=null){for(d=a;d.parentNode;)d=d.parentNode;for(d=d.querySelectorAll('input[name="'+Kt(""+o)+'"][type="radio"]'),o=0;o<d.length;o++){var m=d[o];if(m!==a&&m.form===a.form){var y=m[At]||null;if(!y)throw Error(s(90));Os(m,y.value,y.defaultValue,y.defaultValue,y.checked,y.defaultChecked,y.type,y.name)}}for(o=0;o<d.length;o++)m=d[o],m.form===a.form&&bi(m)}break e;case"textarea":Zr(a,d.value,d.defaultValue);break e;case"select":o=d.value,o!=null&&Vn(a,!!d.multiple,o,!1)}}}var Fu=!1;function $m(a,o,d){if(Fu)return a(o,d);Fu=!0;try{var m=a(o);return m}finally{if(Fu=!1,(Za!==null||Ja!==null)&&(nc(),Za&&(o=Za,a=Ja,Ja=Za=null,Vm(o),a)))for(o=0;o<a.length;o++)Vm(a[o])}}function Jr(a,o){var d=a.stateNode;if(d===null)return null;var m=d[At]||null;if(m===null)return null;d=m[o];e:switch(o){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(m=!m.disabled)||(a=a.type,m=!(a==="button"||a==="input"||a==="select"||a==="textarea")),a=!m;break e;default:a=!1}if(a)return null;if(d&&typeof d!="function")throw Error(s(231,o,typeof d));return d}var fn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Bu=!1;if(fn)try{var el={};Object.defineProperty(el,"passive",{get:function(){Bu=!0}}),window.addEventListener("test",el,el),window.removeEventListener("test",el,el)}catch{Bu=!1}var Gn=null,Vu=null,yo=null;function Gm(){if(yo)return yo;var a,o=Vu,d=o.length,m,y="value"in Gn?Gn.value:Gn.textContent,b=y.length;for(a=0;a<d&&o[a]===y[a];a++);var R=d-a;for(m=1;m<=R&&o[d-m]===y[b-m];m++);return yo=y.slice(a,1<m?1-m:void 0)}function xo(a){var o=a.keyCode;return"charCode"in a?(a=a.charCode,a===0&&o===13&&(a=13)):a=o,a===10&&(a=13),32<=a||a===13?a:0}function So(){return!0}function Hm(){return!1}function $s(a){function o(d,m,y,b,R){this._reactName=d,this._targetInst=y,this.type=m,this.nativeEvent=b,this.target=R,this.currentTarget=null;for(var N in a)a.hasOwnProperty(N)&&(d=a[N],this[N]=d?d(b):b[N]);return this.isDefaultPrevented=(b.defaultPrevented!=null?b.defaultPrevented:b.returnValue===!1)?So:Hm,this.isPropagationStopped=Hm,this}return p(o.prototype,{preventDefault:function(){this.defaultPrevented=!0;var d=this.nativeEvent;d&&(d.preventDefault?d.preventDefault():typeof d.returnValue!="unknown"&&(d.returnValue=!1),this.isDefaultPrevented=So)},stopPropagation:function(){var d=this.nativeEvent;d&&(d.stopPropagation?d.stopPropagation():typeof d.cancelBubble!="unknown"&&(d.cancelBubble=!0),this.isPropagationStopped=So)},persist:function(){},isPersistent:So}),o}var Ta={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(a){return a.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},bo=$s(Ta),tl=p({},Ta,{view:0,detail:0}),tT=$s(tl),$u,Gu,sl,To=p({},tl,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:zu,button:0,buttons:0,relatedTarget:function(a){return a.relatedTarget===void 0?a.fromElement===a.srcElement?a.toElement:a.fromElement:a.relatedTarget},movementX:function(a){return"movementX"in a?a.movementX:(a!==sl&&(sl&&a.type==="mousemove"?($u=a.screenX-sl.screenX,Gu=a.screenY-sl.screenY):Gu=$u=0,sl=a),$u)},movementY:function(a){return"movementY"in a?a.movementY:Gu}}),zm=$s(To),sT=p({},To,{dataTransfer:0}),iT=$s(sT),nT=p({},tl,{relatedTarget:0}),Hu=$s(nT),aT=p({},Ta,{animationName:0,elapsedTime:0,pseudoElement:0}),rT=$s(aT),lT=p({},Ta,{clipboardData:function(a){return"clipboardData"in a?a.clipboardData:window.clipboardData}}),oT=$s(lT),cT=p({},Ta,{data:0}),Km=$s(cT),uT={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},dT={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},hT={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function fT(a){var o=this.nativeEvent;return o.getModifierState?o.getModifierState(a):(a=hT[a])?!!o[a]:!1}function zu(){return fT}var mT=p({},tl,{key:function(a){if(a.key){var o=uT[a.key]||a.key;if(o!=="Unidentified")return o}return a.type==="keypress"?(a=xo(a),a===13?"Enter":String.fromCharCode(a)):a.type==="keydown"||a.type==="keyup"?dT[a.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:zu,charCode:function(a){return a.type==="keypress"?xo(a):0},keyCode:function(a){return a.type==="keydown"||a.type==="keyup"?a.keyCode:0},which:function(a){return a.type==="keypress"?xo(a):a.type==="keydown"||a.type==="keyup"?a.keyCode:0}}),pT=$s(mT),gT=p({},To,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Ym=$s(gT),vT=p({},tl,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:zu}),yT=$s(vT),xT=p({},Ta,{propertyName:0,elapsedTime:0,pseudoElement:0}),ST=$s(xT),bT=p({},To,{deltaX:function(a){return"deltaX"in a?a.deltaX:"wheelDeltaX"in a?-a.wheelDeltaX:0},deltaY:function(a){return"deltaY"in a?a.deltaY:"wheelDeltaY"in a?-a.wheelDeltaY:"wheelDelta"in a?-a.wheelDelta:0},deltaZ:0,deltaMode:0}),TT=$s(bT),ET=p({},Ta,{newState:0,oldState:0}),AT=$s(ET),IT=[9,13,27,32],Ku=fn&&"CompositionEvent"in window,il=null;fn&&"documentMode"in document&&(il=document.documentMode);var _T=fn&&"TextEvent"in window&&!il,qm=fn&&(!Ku||il&&8<il&&11>=il),Qm=" ",Wm=!1;function Xm(a,o){switch(a){case"keyup":return IT.indexOf(o.keyCode)!==-1;case"keydown":return o.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Zm(a){return a=a.detail,typeof a=="object"&&"data"in a?a.data:null}var er=!1;function RT(a,o){switch(a){case"compositionend":return Zm(o);case"keypress":return o.which!==32?null:(Wm=!0,Qm);case"textInput":return a=o.data,a===Qm&&Wm?null:a;default:return null}}function LT(a,o){if(er)return a==="compositionend"||!Ku&&Xm(a,o)?(a=Gm(),yo=Vu=Gn=null,er=!1,a):null;switch(a){case"paste":return null;case"keypress":if(!(o.ctrlKey||o.altKey||o.metaKey)||o.ctrlKey&&o.altKey){if(o.char&&1<o.char.length)return o.char;if(o.which)return String.fromCharCode(o.which)}return null;case"compositionend":return qm&&o.locale!=="ko"?null:o.data;default:return null}}var wT={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Jm(a){var o=a&&a.nodeName&&a.nodeName.toLowerCase();return o==="input"?!!wT[a.type]:o==="textarea"}function ep(a,o,d,m){Za?Ja?Ja.push(m):Ja=[m]:Za=m,o=dc(o,"onChange"),0<o.length&&(d=new bo("onChange","change",null,d,m),a.push({event:d,listeners:o}))}var nl=null,al=null;function CT(a){U0(a,0)}function Eo(a){var o=ba(a);if(bi(o))return a}function tp(a,o){if(a==="change")return o}var sp=!1;if(fn){var Yu;if(fn){var qu="oninput"in document;if(!qu){var ip=document.createElement("div");ip.setAttribute("oninput","return;"),qu=typeof ip.oninput=="function"}Yu=qu}else Yu=!1;sp=Yu&&(!document.documentMode||9<document.documentMode)}function np(){nl&&(nl.detachEvent("onpropertychange",ap),al=nl=null)}function ap(a){if(a.propertyName==="value"&&Eo(al)){var o=[];ep(o,al,a,ju(a)),$m(CT,o)}}function OT(a,o,d){a==="focusin"?(np(),nl=o,al=d,nl.attachEvent("onpropertychange",ap)):a==="focusout"&&np()}function NT(a){if(a==="selectionchange"||a==="keyup"||a==="keydown")return Eo(al)}function kT(a,o){if(a==="click")return Eo(o)}function DT(a,o){if(a==="input"||a==="change")return Eo(o)}function PT(a,o){return a===o&&(a!==0||1/a===1/o)||a!==a&&o!==o}var ni=typeof Object.is=="function"?Object.is:PT;function rl(a,o){if(ni(a,o))return!0;if(typeof a!="object"||a===null||typeof o!="object"||o===null)return!1;var d=Object.keys(a),m=Object.keys(o);if(d.length!==m.length)return!1;for(m=0;m<d.length;m++){var y=d[m];if(!Qe.call(o,y)||!ni(a[y],o[y]))return!1}return!0}function rp(a){for(;a&&a.firstChild;)a=a.firstChild;return a}function lp(a,o){var d=rp(a);a=0;for(var m;d;){if(d.nodeType===3){if(m=a+d.textContent.length,a<=o&&m>=o)return{node:d,offset:o-a};a=m}e:{for(;d;){if(d.nextSibling){d=d.nextSibling;break e}d=d.parentNode}d=void 0}d=rp(d)}}function op(a,o){return a&&o?a===o?!0:a&&a.nodeType===3?!1:o&&o.nodeType===3?op(a,o.parentNode):"contains"in a?a.contains(o):a.compareDocumentPosition?!!(a.compareDocumentPosition(o)&16):!1:!1}function cp(a){a=a!=null&&a.ownerDocument!=null&&a.ownerDocument.defaultView!=null?a.ownerDocument.defaultView:window;for(var o=Xt(a.document);o instanceof a.HTMLIFrameElement;){try{var d=typeof o.contentWindow.location.href=="string"}catch{d=!1}if(d)a=o.contentWindow;else break;o=Xt(a.document)}return o}function Qu(a){var o=a&&a.nodeName&&a.nodeName.toLowerCase();return o&&(o==="input"&&(a.type==="text"||a.type==="search"||a.type==="tel"||a.type==="url"||a.type==="password")||o==="textarea"||a.contentEditable==="true")}var UT=fn&&"documentMode"in document&&11>=document.documentMode,tr=null,Wu=null,ll=null,Xu=!1;function up(a,o,d){var m=d.window===d?d.document:d.nodeType===9?d:d.ownerDocument;Xu||tr==null||tr!==Xt(m)||(m=tr,"selectionStart"in m&&Qu(m)?m={start:m.selectionStart,end:m.selectionEnd}:(m=(m.ownerDocument&&m.ownerDocument.defaultView||window).getSelection(),m={anchorNode:m.anchorNode,anchorOffset:m.anchorOffset,focusNode:m.focusNode,focusOffset:m.focusOffset}),ll&&rl(ll,m)||(ll=m,m=dc(Wu,"onSelect"),0<m.length&&(o=new bo("onSelect","select",null,o,d),a.push({event:o,listeners:m}),o.target=tr)))}function Ea(a,o){var d={};return d[a.toLowerCase()]=o.toLowerCase(),d["Webkit"+a]="webkit"+o,d["Moz"+a]="moz"+o,d}var sr={animationend:Ea("Animation","AnimationEnd"),animationiteration:Ea("Animation","AnimationIteration"),animationstart:Ea("Animation","AnimationStart"),transitionrun:Ea("Transition","TransitionRun"),transitionstart:Ea("Transition","TransitionStart"),transitioncancel:Ea("Transition","TransitionCancel"),transitionend:Ea("Transition","TransitionEnd")},Zu={},dp={};fn&&(dp=document.createElement("div").style,"AnimationEvent"in window||(delete sr.animationend.animation,delete sr.animationiteration.animation,delete sr.animationstart.animation),"TransitionEvent"in window||delete sr.transitionend.transition);function Aa(a){if(Zu[a])return Zu[a];if(!sr[a])return a;var o=sr[a],d;for(d in o)if(o.hasOwnProperty(d)&&d in dp)return Zu[a]=o[d];return a}var hp=Aa("animationend"),fp=Aa("animationiteration"),mp=Aa("animationstart"),MT=Aa("transitionrun"),jT=Aa("transitionstart"),FT=Aa("transitioncancel"),pp=Aa("transitionend"),gp=new Map,Ju="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Ju.push("scrollEnd");function Fi(a,o){gp.set(a,o),ji(o,[a])}var Ao=typeof reportError=="function"?reportError:function(a){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var o=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof a=="object"&&a!==null&&typeof a.message=="string"?String(a.message):String(a),error:a});if(!window.dispatchEvent(o))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",a);return}console.error(a)},Ti=[],ir=0,ed=0;function Io(){for(var a=ir,o=ed=ir=0;o<a;){var d=Ti[o];Ti[o++]=null;var m=Ti[o];Ti[o++]=null;var y=Ti[o];Ti[o++]=null;var b=Ti[o];if(Ti[o++]=null,m!==null&&y!==null){var R=m.pending;R===null?y.next=y:(y.next=R.next,R.next=y),m.pending=y}b!==0&&vp(d,y,b)}}function _o(a,o,d,m){Ti[ir++]=a,Ti[ir++]=o,Ti[ir++]=d,Ti[ir++]=m,ed|=m,a.lanes|=m,a=a.alternate,a!==null&&(a.lanes|=m)}function td(a,o,d,m){return _o(a,o,d,m),Ro(a)}function Ia(a,o){return _o(a,null,null,o),Ro(a)}function vp(a,o,d){a.lanes|=d;var m=a.alternate;m!==null&&(m.lanes|=d);for(var y=!1,b=a.return;b!==null;)b.childLanes|=d,m=b.alternate,m!==null&&(m.childLanes|=d),b.tag===22&&(a=b.stateNode,a===null||a._visibility&1||(y=!0)),a=b,b=b.return;return a.tag===3?(b=a.stateNode,y&&o!==null&&(y=31-Et(d),a=b.hiddenUpdates,m=a[y],m===null?a[y]=[o]:m.push(o),o.lane=d|536870912),b):null}function Ro(a){if(50<wl)throw wl=0,uh=null,Error(s(185));for(var o=a.return;o!==null;)a=o,o=a.return;return a.tag===3?a.stateNode:null}var nr={};function BT(a,o,d,m){this.tag=a,this.key=d,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=o,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=m,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ai(a,o,d,m){return new BT(a,o,d,m)}function sd(a){return a=a.prototype,!(!a||!a.isReactComponent)}function mn(a,o){var d=a.alternate;return d===null?(d=ai(a.tag,o,a.key,a.mode),d.elementType=a.elementType,d.type=a.type,d.stateNode=a.stateNode,d.alternate=a,a.alternate=d):(d.pendingProps=o,d.type=a.type,d.flags=0,d.subtreeFlags=0,d.deletions=null),d.flags=a.flags&65011712,d.childLanes=a.childLanes,d.lanes=a.lanes,d.child=a.child,d.memoizedProps=a.memoizedProps,d.memoizedState=a.memoizedState,d.updateQueue=a.updateQueue,o=a.dependencies,d.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext},d.sibling=a.sibling,d.index=a.index,d.ref=a.ref,d.refCleanup=a.refCleanup,d}function yp(a,o){a.flags&=65011714;var d=a.alternate;return d===null?(a.childLanes=0,a.lanes=o,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=d.childLanes,a.lanes=d.lanes,a.child=d.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=d.memoizedProps,a.memoizedState=d.memoizedState,a.updateQueue=d.updateQueue,a.type=d.type,o=d.dependencies,a.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext}),a}function Lo(a,o,d,m,y,b){var R=0;if(m=a,typeof a=="function")sd(a)&&(R=1);else if(typeof a=="string")R=zE(a,d,he.current)?26:a==="html"||a==="head"||a==="body"?27:5;else e:switch(a){case j:return a=ai(31,d,o,y),a.elementType=j,a.lanes=b,a;case E:return _a(d.children,y,b,o);case T:R=8,y|=24;break;case A:return a=ai(12,d,o,y|2),a.elementType=A,a.lanes=b,a;case k:return a=ai(13,d,o,y),a.elementType=k,a.lanes=b,a;case U:return a=ai(19,d,o,y),a.elementType=U,a.lanes=b,a;default:if(typeof a=="object"&&a!==null)switch(a.$$typeof){case _:R=10;break e;case I:R=9;break e;case C:R=11;break e;case O:R=14;break e;case F:R=16,m=null;break e}R=29,d=Error(s(130,a===null?"null":typeof a,"")),m=null}return o=ai(R,d,o,y),o.elementType=a,o.type=m,o.lanes=b,o}function _a(a,o,d,m){return a=ai(7,a,m,o),a.lanes=d,a}function id(a,o,d){return a=ai(6,a,null,o),a.lanes=d,a}function xp(a){var o=ai(18,null,null,0);return o.stateNode=a,o}function nd(a,o,d){return o=ai(4,a.children!==null?a.children:[],a.key,o),o.lanes=d,o.stateNode={containerInfo:a.containerInfo,pendingChildren:null,implementation:a.implementation},o}var Sp=new WeakMap;function Ei(a,o){if(typeof a=="object"&&a!==null){var d=Sp.get(a);return d!==void 0?d:(o={value:a,source:o,stack:Me(o)},Sp.set(a,o),o)}return{value:a,source:o,stack:Me(o)}}var ar=[],rr=0,wo=null,ol=0,Ai=[],Ii=0,Hn=null,Yi=1,qi="";function pn(a,o){ar[rr++]=ol,ar[rr++]=wo,wo=a,ol=o}function bp(a,o,d){Ai[Ii++]=Yi,Ai[Ii++]=qi,Ai[Ii++]=Hn,Hn=a;var m=Yi;a=qi;var y=32-Et(m)-1;m&=~(1<<y),d+=1;var b=32-Et(o)+y;if(30<b){var R=y-y%5;b=(m&(1<<R)-1).toString(32),m>>=R,y-=R,Yi=1<<32-Et(o)+y|d<<y|m,qi=b+a}else Yi=1<<b|d<<y|m,qi=a}function ad(a){a.return!==null&&(pn(a,1),bp(a,1,0))}function rd(a){for(;a===wo;)wo=ar[--rr],ar[rr]=null,ol=ar[--rr],ar[rr]=null;for(;a===Hn;)Hn=Ai[--Ii],Ai[Ii]=null,qi=Ai[--Ii],Ai[Ii]=null,Yi=Ai[--Ii],Ai[Ii]=null}function Tp(a,o){Ai[Ii++]=Yi,Ai[Ii++]=qi,Ai[Ii++]=Hn,Yi=o.id,qi=o.overflow,Hn=a}var Es=null,Dt=null,ut=!1,zn=null,_i=!1,ld=Error(s(519));function Kn(a){var o=Error(s(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw cl(Ei(o,a)),ld}function Ep(a){var o=a.stateNode,d=a.type,m=a.memoizedProps;switch(o[gt]=a,o[At]=m,d){case"dialog":lt("cancel",o),lt("close",o);break;case"iframe":case"object":case"embed":lt("load",o);break;case"video":case"audio":for(d=0;d<Ol.length;d++)lt(Ol[d],o);break;case"source":lt("error",o);break;case"img":case"image":case"link":lt("error",o),lt("load",o);break;case"details":lt("toggle",o);break;case"input":lt("invalid",o),Xr(o,m.value,m.defaultValue,m.checked,m.defaultChecked,m.type,m.name,!0);break;case"select":lt("invalid",o);break;case"textarea":lt("invalid",o),go(o,m.value,m.defaultValue,m.children)}d=m.children,typeof d!="string"&&typeof d!="number"&&typeof d!="bigint"||o.textContent===""+d||m.suppressHydrationWarning===!0||B0(o.textContent,d)?(m.popover!=null&&(lt("beforetoggle",o),lt("toggle",o)),m.onScroll!=null&&lt("scroll",o),m.onScrollEnd!=null&&lt("scrollend",o),m.onClick!=null&&(o.onclick=hn),o=!0):o=!1,o||Kn(a,!0)}function Ap(a){for(Es=a.return;Es;)switch(Es.tag){case 5:case 31:case 13:_i=!1;return;case 27:case 3:_i=!0;return;default:Es=Es.return}}function lr(a){if(a!==Es)return!1;if(!ut)return Ap(a),ut=!0,!1;var o=a.tag,d;if((d=o!==3&&o!==27)&&((d=o===5)&&(d=a.type,d=!(d!=="form"&&d!=="button")||Ih(a.type,a.memoizedProps)),d=!d),d&&Dt&&Kn(a),Ap(a),o===13){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(s(317));Dt=Q0(a)}else if(o===31){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(s(317));Dt=Q0(a)}else o===27?(o=Dt,ra(a.type)?(a=Ch,Ch=null,Dt=a):Dt=o):Dt=Es?Li(a.stateNode.nextSibling):null;return!0}function Ra(){Dt=Es=null,ut=!1}function od(){var a=zn;return a!==null&&(Ks===null?Ks=a:Ks.push.apply(Ks,a),zn=null),a}function cl(a){zn===null?zn=[a]:zn.push(a)}var cd=P(null),La=null,gn=null;function Yn(a,o,d){se(cd,o._currentValue),o._currentValue=d}function vn(a){a._currentValue=cd.current,V(cd)}function ud(a,o,d){for(;a!==null;){var m=a.alternate;if((a.childLanes&o)!==o?(a.childLanes|=o,m!==null&&(m.childLanes|=o)):m!==null&&(m.childLanes&o)!==o&&(m.childLanes|=o),a===d)break;a=a.return}}function dd(a,o,d,m){var y=a.child;for(y!==null&&(y.return=a);y!==null;){var b=y.dependencies;if(b!==null){var R=y.child;b=b.firstContext;e:for(;b!==null;){var N=b;b=y;for(var B=0;B<o.length;B++)if(N.context===o[B]){b.lanes|=d,N=b.alternate,N!==null&&(N.lanes|=d),ud(b.return,d,a),m||(R=null);break e}b=N.next}}else if(y.tag===18){if(R=y.return,R===null)throw Error(s(341));R.lanes|=d,b=R.alternate,b!==null&&(b.lanes|=d),ud(R,d,a),R=null}else R=y.child;if(R!==null)R.return=y;else for(R=y;R!==null;){if(R===a){R=null;break}if(y=R.sibling,y!==null){y.return=R.return,R=y;break}R=R.return}y=R}}function or(a,o,d,m){a=null;for(var y=o,b=!1;y!==null;){if(!b){if((y.flags&524288)!==0)b=!0;else if((y.flags&262144)!==0)break}if(y.tag===10){var R=y.alternate;if(R===null)throw Error(s(387));if(R=R.memoizedProps,R!==null){var N=y.type;ni(y.pendingProps.value,R.value)||(a!==null?a.push(N):a=[N])}}else if(y===Pe.current){if(R=y.alternate,R===null)throw Error(s(387));R.memoizedState.memoizedState!==y.memoizedState.memoizedState&&(a!==null?a.push(Ul):a=[Ul])}y=y.return}a!==null&&dd(o,a,d,m),o.flags|=262144}function Co(a){for(a=a.firstContext;a!==null;){if(!ni(a.context._currentValue,a.memoizedValue))return!0;a=a.next}return!1}function wa(a){La=a,gn=null,a=a.dependencies,a!==null&&(a.firstContext=null)}function As(a){return Ip(La,a)}function Oo(a,o){return La===null&&wa(a),Ip(a,o)}function Ip(a,o){var d=o._currentValue;if(o={context:o,memoizedValue:d,next:null},gn===null){if(a===null)throw Error(s(308));gn=o,a.dependencies={lanes:0,firstContext:o},a.flags|=524288}else gn=gn.next=o;return d}var VT=typeof AbortController<"u"?AbortController:function(){var a=[],o=this.signal={aborted:!1,addEventListener:function(d,m){a.push(m)}};this.abort=function(){o.aborted=!0,a.forEach(function(d){return d()})}},$T=i.unstable_scheduleCallback,GT=i.unstable_NormalPriority,ns={$$typeof:_,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function hd(){return{controller:new VT,data:new Map,refCount:0}}function ul(a){a.refCount--,a.refCount===0&&$T(GT,function(){a.controller.abort()})}var dl=null,fd=0,cr=0,ur=null;function HT(a,o){if(dl===null){var d=dl=[];fd=0,cr=gh(),ur={status:"pending",value:void 0,then:function(m){d.push(m)}}}return fd++,o.then(_p,_p),o}function _p(){if(--fd===0&&dl!==null){ur!==null&&(ur.status="fulfilled");var a=dl;dl=null,cr=0,ur=null;for(var o=0;o<a.length;o++)(0,a[o])()}}function zT(a,o){var d=[],m={status:"pending",value:null,reason:null,then:function(y){d.push(y)}};return a.then(function(){m.status="fulfilled",m.value=o;for(var y=0;y<d.length;y++)(0,d[y])(o)},function(y){for(m.status="rejected",m.reason=y,y=0;y<d.length;y++)(0,d[y])(void 0)}),m}var Rp=D.S;D.S=function(a,o){u0=st(),typeof o=="object"&&o!==null&&typeof o.then=="function"&&HT(a,o),Rp!==null&&Rp(a,o)};var Ca=P(null);function md(){var a=Ca.current;return a!==null?a:wt.pooledCache}function No(a,o){o===null?se(Ca,Ca.current):se(Ca,o.pool)}function Lp(){var a=md();return a===null?null:{parent:ns._currentValue,pool:a}}var dr=Error(s(460)),pd=Error(s(474)),ko=Error(s(542)),Do={then:function(){}};function wp(a){return a=a.status,a==="fulfilled"||a==="rejected"}function Cp(a,o,d){switch(d=a[d],d===void 0?a.push(o):d!==o&&(o.then(hn,hn),o=d),o.status){case"fulfilled":return o.value;case"rejected":throw a=o.reason,Np(a),a;default:if(typeof o.status=="string")o.then(hn,hn);else{if(a=wt,a!==null&&100<a.shellSuspendCounter)throw Error(s(482));a=o,a.status="pending",a.then(function(m){if(o.status==="pending"){var y=o;y.status="fulfilled",y.value=m}},function(m){if(o.status==="pending"){var y=o;y.status="rejected",y.reason=m}})}switch(o.status){case"fulfilled":return o.value;case"rejected":throw a=o.reason,Np(a),a}throw Na=o,dr}}function Oa(a){try{var o=a._init;return o(a._payload)}catch(d){throw d!==null&&typeof d=="object"&&typeof d.then=="function"?(Na=d,dr):d}}var Na=null;function Op(){if(Na===null)throw Error(s(459));var a=Na;return Na=null,a}function Np(a){if(a===dr||a===ko)throw Error(s(483))}var hr=null,hl=0;function Po(a){var o=hl;return hl+=1,hr===null&&(hr=[]),Cp(hr,a,o)}function fl(a,o){o=o.props.ref,a.ref=o!==void 0?o:null}function Uo(a,o){throw o.$$typeof===v?Error(s(525)):(a=Object.prototype.toString.call(o),Error(s(31,a==="[object Object]"?"object with keys {"+Object.keys(o).join(", ")+"}":a)))}function kp(a){function o(z,$){if(a){var W=z.deletions;W===null?(z.deletions=[$],z.flags|=16):W.push($)}}function d(z,$){if(!a)return null;for(;$!==null;)o(z,$),$=$.sibling;return null}function m(z){for(var $=new Map;z!==null;)z.key!==null?$.set(z.key,z):$.set(z.index,z),z=z.sibling;return $}function y(z,$){return z=mn(z,$),z.index=0,z.sibling=null,z}function b(z,$,W){return z.index=W,a?(W=z.alternate,W!==null?(W=W.index,W<$?(z.flags|=67108866,$):W):(z.flags|=67108866,$)):(z.flags|=1048576,$)}function R(z){return a&&z.alternate===null&&(z.flags|=67108866),z}function N(z,$,W,de){return $===null||$.tag!==6?($=id(W,z.mode,de),$.return=z,$):($=y($,W),$.return=z,$)}function B(z,$,W,de){var $e=W.type;return $e===E?re(z,$,W.props.children,de,W.key):$!==null&&($.elementType===$e||typeof $e=="object"&&$e!==null&&$e.$$typeof===F&&Oa($e)===$.type)?($=y($,W.props),fl($,W),$.return=z,$):($=Lo(W.type,W.key,W.props,null,z.mode,de),fl($,W),$.return=z,$)}function X(z,$,W,de){return $===null||$.tag!==4||$.stateNode.containerInfo!==W.containerInfo||$.stateNode.implementation!==W.implementation?($=nd(W,z.mode,de),$.return=z,$):($=y($,W.children||[]),$.return=z,$)}function re(z,$,W,de,$e){return $===null||$.tag!==7?($=_a(W,z.mode,de,$e),$.return=z,$):($=y($,W),$.return=z,$)}function fe(z,$,W){if(typeof $=="string"&&$!==""||typeof $=="number"||typeof $=="bigint")return $=id(""+$,z.mode,W),$.return=z,$;if(typeof $=="object"&&$!==null){switch($.$$typeof){case x:return W=Lo($.type,$.key,$.props,null,z.mode,W),fl(W,$),W.return=z,W;case S:return $=nd($,z.mode,W),$.return=z,$;case F:return $=Oa($),fe(z,$,W)}if(me($)||K($))return $=_a($,z.mode,W,null),$.return=z,$;if(typeof $.then=="function")return fe(z,Po($),W);if($.$$typeof===_)return fe(z,Oo(z,$),W);Uo(z,$)}return null}function J(z,$,W,de){var $e=$!==null?$.key:null;if(typeof W=="string"&&W!==""||typeof W=="number"||typeof W=="bigint")return $e!==null?null:N(z,$,""+W,de);if(typeof W=="object"&&W!==null){switch(W.$$typeof){case x:return W.key===$e?B(z,$,W,de):null;case S:return W.key===$e?X(z,$,W,de):null;case F:return W=Oa(W),J(z,$,W,de)}if(me(W)||K(W))return $e!==null?null:re(z,$,W,de,null);if(typeof W.then=="function")return J(z,$,Po(W),de);if(W.$$typeof===_)return J(z,$,Oo(z,W),de);Uo(z,W)}return null}function ne(z,$,W,de,$e){if(typeof de=="string"&&de!==""||typeof de=="number"||typeof de=="bigint")return z=z.get(W)||null,N($,z,""+de,$e);if(typeof de=="object"&&de!==null){switch(de.$$typeof){case x:return z=z.get(de.key===null?W:de.key)||null,B($,z,de,$e);case S:return z=z.get(de.key===null?W:de.key)||null,X($,z,de,$e);case F:return de=Oa(de),ne(z,$,W,de,$e)}if(me(de)||K(de))return z=z.get(W)||null,re($,z,de,$e,null);if(typeof de.then=="function")return ne(z,$,W,Po(de),$e);if(de.$$typeof===_)return ne(z,$,W,Oo($,de),$e);Uo($,de)}return null}function Ue(z,$,W,de){for(var $e=null,ft=null,je=$,et=$=0,ct=null;je!==null&&et<W.length;et++){je.index>et?(ct=je,je=null):ct=je.sibling;var mt=J(z,je,W[et],de);if(mt===null){je===null&&(je=ct);break}a&&je&&mt.alternate===null&&o(z,je),$=b(mt,$,et),ft===null?$e=mt:ft.sibling=mt,ft=mt,je=ct}if(et===W.length)return d(z,je),ut&&pn(z,et),$e;if(je===null){for(;et<W.length;et++)je=fe(z,W[et],de),je!==null&&($=b(je,$,et),ft===null?$e=je:ft.sibling=je,ft=je);return ut&&pn(z,et),$e}for(je=m(je);et<W.length;et++)ct=ne(je,z,et,W[et],de),ct!==null&&(a&&ct.alternate!==null&&je.delete(ct.key===null?et:ct.key),$=b(ct,$,et),ft===null?$e=ct:ft.sibling=ct,ft=ct);return a&&je.forEach(function(da){return o(z,da)}),ut&&pn(z,et),$e}function Ge(z,$,W,de){if(W==null)throw Error(s(151));for(var $e=null,ft=null,je=$,et=$=0,ct=null,mt=W.next();je!==null&&!mt.done;et++,mt=W.next()){je.index>et?(ct=je,je=null):ct=je.sibling;var da=J(z,je,mt.value,de);if(da===null){je===null&&(je=ct);break}a&&je&&da.alternate===null&&o(z,je),$=b(da,$,et),ft===null?$e=da:ft.sibling=da,ft=da,je=ct}if(mt.done)return d(z,je),ut&&pn(z,et),$e;if(je===null){for(;!mt.done;et++,mt=W.next())mt=fe(z,mt.value,de),mt!==null&&($=b(mt,$,et),ft===null?$e=mt:ft.sibling=mt,ft=mt);return ut&&pn(z,et),$e}for(je=m(je);!mt.done;et++,mt=W.next())mt=ne(je,z,et,mt.value,de),mt!==null&&(a&&mt.alternate!==null&&je.delete(mt.key===null?et:mt.key),$=b(mt,$,et),ft===null?$e=mt:ft.sibling=mt,ft=mt);return a&&je.forEach(function(sA){return o(z,sA)}),ut&&pn(z,et),$e}function Rt(z,$,W,de){if(typeof W=="object"&&W!==null&&W.type===E&&W.key===null&&(W=W.props.children),typeof W=="object"&&W!==null){switch(W.$$typeof){case x:e:{for(var $e=W.key;$!==null;){if($.key===$e){if($e=W.type,$e===E){if($.tag===7){d(z,$.sibling),de=y($,W.props.children),de.return=z,z=de;break e}}else if($.elementType===$e||typeof $e=="object"&&$e!==null&&$e.$$typeof===F&&Oa($e)===$.type){d(z,$.sibling),de=y($,W.props),fl(de,W),de.return=z,z=de;break e}d(z,$);break}else o(z,$);$=$.sibling}W.type===E?(de=_a(W.props.children,z.mode,de,W.key),de.return=z,z=de):(de=Lo(W.type,W.key,W.props,null,z.mode,de),fl(de,W),de.return=z,z=de)}return R(z);case S:e:{for($e=W.key;$!==null;){if($.key===$e)if($.tag===4&&$.stateNode.containerInfo===W.containerInfo&&$.stateNode.implementation===W.implementation){d(z,$.sibling),de=y($,W.children||[]),de.return=z,z=de;break e}else{d(z,$);break}else o(z,$);$=$.sibling}de=nd(W,z.mode,de),de.return=z,z=de}return R(z);case F:return W=Oa(W),Rt(z,$,W,de)}if(me(W))return Ue(z,$,W,de);if(K(W)){if($e=K(W),typeof $e!="function")throw Error(s(150));return W=$e.call(W),Ge(z,$,W,de)}if(typeof W.then=="function")return Rt(z,$,Po(W),de);if(W.$$typeof===_)return Rt(z,$,Oo(z,W),de);Uo(z,W)}return typeof W=="string"&&W!==""||typeof W=="number"||typeof W=="bigint"?(W=""+W,$!==null&&$.tag===6?(d(z,$.sibling),de=y($,W),de.return=z,z=de):(d(z,$),de=id(W,z.mode,de),de.return=z,z=de),R(z)):d(z,$)}return function(z,$,W,de){try{hl=0;var $e=Rt(z,$,W,de);return hr=null,$e}catch(je){if(je===dr||je===ko)throw je;var ft=ai(29,je,null,z.mode);return ft.lanes=de,ft.return=z,ft}}}var ka=kp(!0),Dp=kp(!1),qn=!1;function gd(a){a.updateQueue={baseState:a.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function vd(a,o){a=a.updateQueue,o.updateQueue===a&&(o.updateQueue={baseState:a.baseState,firstBaseUpdate:a.firstBaseUpdate,lastBaseUpdate:a.lastBaseUpdate,shared:a.shared,callbacks:null})}function Qn(a){return{lane:a,tag:0,payload:null,callback:null,next:null}}function Wn(a,o,d){var m=a.updateQueue;if(m===null)return null;if(m=m.shared,(pt&2)!==0){var y=m.pending;return y===null?o.next=o:(o.next=y.next,y.next=o),m.pending=o,o=Ro(a),vp(a,null,d),o}return _o(a,m,o,d),Ro(a)}function ml(a,o,d){if(o=o.updateQueue,o!==null&&(o=o.shared,(d&4194048)!==0)){var m=o.lanes;m&=a.pendingLanes,d|=m,o.lanes=d,Ki(a,d)}}function yd(a,o){var d=a.updateQueue,m=a.alternate;if(m!==null&&(m=m.updateQueue,d===m)){var y=null,b=null;if(d=d.firstBaseUpdate,d!==null){do{var R={lane:d.lane,tag:d.tag,payload:d.payload,callback:null,next:null};b===null?y=b=R:b=b.next=R,d=d.next}while(d!==null);b===null?y=b=o:b=b.next=o}else y=b=o;d={baseState:m.baseState,firstBaseUpdate:y,lastBaseUpdate:b,shared:m.shared,callbacks:m.callbacks},a.updateQueue=d;return}a=d.lastBaseUpdate,a===null?d.firstBaseUpdate=o:a.next=o,d.lastBaseUpdate=o}var xd=!1;function pl(){if(xd){var a=ur;if(a!==null)throw a}}function gl(a,o,d,m){xd=!1;var y=a.updateQueue;qn=!1;var b=y.firstBaseUpdate,R=y.lastBaseUpdate,N=y.shared.pending;if(N!==null){y.shared.pending=null;var B=N,X=B.next;B.next=null,R===null?b=X:R.next=X,R=B;var re=a.alternate;re!==null&&(re=re.updateQueue,N=re.lastBaseUpdate,N!==R&&(N===null?re.firstBaseUpdate=X:N.next=X,re.lastBaseUpdate=B))}if(b!==null){var fe=y.baseState;R=0,re=X=B=null,N=b;do{var J=N.lane&-536870913,ne=J!==N.lane;if(ne?(ot&J)===J:(m&J)===J){J!==0&&J===cr&&(xd=!0),re!==null&&(re=re.next={lane:0,tag:N.tag,payload:N.payload,callback:null,next:null});e:{var Ue=a,Ge=N;J=o;var Rt=d;switch(Ge.tag){case 1:if(Ue=Ge.payload,typeof Ue=="function"){fe=Ue.call(Rt,fe,J);break e}fe=Ue;break e;case 3:Ue.flags=Ue.flags&-65537|128;case 0:if(Ue=Ge.payload,J=typeof Ue=="function"?Ue.call(Rt,fe,J):Ue,J==null)break e;fe=p({},fe,J);break e;case 2:qn=!0}}J=N.callback,J!==null&&(a.flags|=64,ne&&(a.flags|=8192),ne=y.callbacks,ne===null?y.callbacks=[J]:ne.push(J))}else ne={lane:J,tag:N.tag,payload:N.payload,callback:N.callback,next:null},re===null?(X=re=ne,B=fe):re=re.next=ne,R|=J;if(N=N.next,N===null){if(N=y.shared.pending,N===null)break;ne=N,N=ne.next,ne.next=null,y.lastBaseUpdate=ne,y.shared.pending=null}}while(!0);re===null&&(B=fe),y.baseState=B,y.firstBaseUpdate=X,y.lastBaseUpdate=re,b===null&&(y.shared.lanes=0),ta|=R,a.lanes=R,a.memoizedState=fe}}function Pp(a,o){if(typeof a!="function")throw Error(s(191,a));a.call(o)}function Up(a,o){var d=a.callbacks;if(d!==null)for(a.callbacks=null,a=0;a<d.length;a++)Pp(d[a],o)}var fr=P(null),Mo=P(0);function Mp(a,o){a=_n,se(Mo,a),se(fr,o),_n=a|o.baseLanes}function Sd(){se(Mo,_n),se(fr,fr.current)}function bd(){_n=Mo.current,V(fr),V(Mo)}var ri=P(null),Ri=null;function Xn(a){var o=a.alternate;se(Zt,Zt.current&1),se(ri,a),Ri===null&&(o===null||fr.current!==null||o.memoizedState!==null)&&(Ri=a)}function Td(a){se(Zt,Zt.current),se(ri,a),Ri===null&&(Ri=a)}function jp(a){a.tag===22?(se(Zt,Zt.current),se(ri,a),Ri===null&&(Ri=a)):Zn()}function Zn(){se(Zt,Zt.current),se(ri,ri.current)}function li(a){V(ri),Ri===a&&(Ri=null),V(Zt)}var Zt=P(0);function jo(a){for(var o=a;o!==null;){if(o.tag===13){var d=o.memoizedState;if(d!==null&&(d=d.dehydrated,d===null||Lh(d)||wh(d)))return o}else if(o.tag===19&&(o.memoizedProps.revealOrder==="forwards"||o.memoizedProps.revealOrder==="backwards"||o.memoizedProps.revealOrder==="unstable_legacy-backwards"||o.memoizedProps.revealOrder==="together")){if((o.flags&128)!==0)return o}else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===a)break;for(;o.sibling===null;){if(o.return===null||o.return===a)return null;o=o.return}o.sibling.return=o.return,o=o.sibling}return null}var yn=0,Je=null,It=null,as=null,Fo=!1,mr=!1,Da=!1,Bo=0,vl=0,pr=null,KT=0;function Yt(){throw Error(s(321))}function Ed(a,o){if(o===null)return!1;for(var d=0;d<o.length&&d<a.length;d++)if(!ni(a[d],o[d]))return!1;return!0}function Ad(a,o,d,m,y,b){return yn=b,Je=o,o.memoizedState=null,o.updateQueue=null,o.lanes=0,D.H=a===null||a.memoizedState===null?bg:Fd,Da=!1,b=d(m,y),Da=!1,mr&&(b=Bp(o,d,m,y)),Fp(a),b}function Fp(a){D.H=Sl;var o=It!==null&&It.next!==null;if(yn=0,as=It=Je=null,Fo=!1,vl=0,pr=null,o)throw Error(s(300));a===null||rs||(a=a.dependencies,a!==null&&Co(a)&&(rs=!0))}function Bp(a,o,d,m){Je=a;var y=0;do{if(mr&&(pr=null),vl=0,mr=!1,25<=y)throw Error(s(301));if(y+=1,as=It=null,a.updateQueue!=null){var b=a.updateQueue;b.lastEffect=null,b.events=null,b.stores=null,b.memoCache!=null&&(b.memoCache.index=0)}D.H=Tg,b=o(d,m)}while(mr);return b}function YT(){var a=D.H,o=a.useState()[0];return o=typeof o.then=="function"?yl(o):o,a=a.useState()[0],(It!==null?It.memoizedState:null)!==a&&(Je.flags|=1024),o}function Id(){var a=Bo!==0;return Bo=0,a}function _d(a,o,d){o.updateQueue=a.updateQueue,o.flags&=-2053,a.lanes&=~d}function Rd(a){if(Fo){for(a=a.memoizedState;a!==null;){var o=a.queue;o!==null&&(o.pending=null),a=a.next}Fo=!1}yn=0,as=It=Je=null,mr=!1,vl=Bo=0,pr=null}function js(){var a={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return as===null?Je.memoizedState=as=a:as=as.next=a,as}function Jt(){if(It===null){var a=Je.alternate;a=a!==null?a.memoizedState:null}else a=It.next;var o=as===null?Je.memoizedState:as.next;if(o!==null)as=o,It=a;else{if(a===null)throw Je.alternate===null?Error(s(467)):Error(s(310));It=a,a={memoizedState:It.memoizedState,baseState:It.baseState,baseQueue:It.baseQueue,queue:It.queue,next:null},as===null?Je.memoizedState=as=a:as=as.next=a}return as}function Vo(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function yl(a){var o=vl;return vl+=1,pr===null&&(pr=[]),a=Cp(pr,a,o),o=Je,(as===null?o.memoizedState:as.next)===null&&(o=o.alternate,D.H=o===null||o.memoizedState===null?bg:Fd),a}function $o(a){if(a!==null&&typeof a=="object"){if(typeof a.then=="function")return yl(a);if(a.$$typeof===_)return As(a)}throw Error(s(438,String(a)))}function Ld(a){var o=null,d=Je.updateQueue;if(d!==null&&(o=d.memoCache),o==null){var m=Je.alternate;m!==null&&(m=m.updateQueue,m!==null&&(m=m.memoCache,m!=null&&(o={data:m.data.map(function(y){return y.slice()}),index:0})))}if(o==null&&(o={data:[],index:0}),d===null&&(d=Vo(),Je.updateQueue=d),d.memoCache=o,d=o.data[o.index],d===void 0)for(d=o.data[o.index]=Array(a),m=0;m<a;m++)d[m]=M;return o.index++,d}function xn(a,o){return typeof o=="function"?o(a):o}function Go(a){var o=Jt();return wd(o,It,a)}function wd(a,o,d){var m=a.queue;if(m===null)throw Error(s(311));m.lastRenderedReducer=d;var y=a.baseQueue,b=m.pending;if(b!==null){if(y!==null){var R=y.next;y.next=b.next,b.next=R}o.baseQueue=y=b,m.pending=null}if(b=a.baseState,y===null)a.memoizedState=b;else{o=y.next;var N=R=null,B=null,X=o,re=!1;do{var fe=X.lane&-536870913;if(fe!==X.lane?(ot&fe)===fe:(yn&fe)===fe){var J=X.revertLane;if(J===0)B!==null&&(B=B.next={lane:0,revertLane:0,gesture:null,action:X.action,hasEagerState:X.hasEagerState,eagerState:X.eagerState,next:null}),fe===cr&&(re=!0);else if((yn&J)===J){X=X.next,J===cr&&(re=!0);continue}else fe={lane:0,revertLane:X.revertLane,gesture:null,action:X.action,hasEagerState:X.hasEagerState,eagerState:X.eagerState,next:null},B===null?(N=B=fe,R=b):B=B.next=fe,Je.lanes|=J,ta|=J;fe=X.action,Da&&d(b,fe),b=X.hasEagerState?X.eagerState:d(b,fe)}else J={lane:fe,revertLane:X.revertLane,gesture:X.gesture,action:X.action,hasEagerState:X.hasEagerState,eagerState:X.eagerState,next:null},B===null?(N=B=J,R=b):B=B.next=J,Je.lanes|=fe,ta|=fe;X=X.next}while(X!==null&&X!==o);if(B===null?R=b:B.next=N,!ni(b,a.memoizedState)&&(rs=!0,re&&(d=ur,d!==null)))throw d;a.memoizedState=b,a.baseState=R,a.baseQueue=B,m.lastRenderedState=b}return y===null&&(m.lanes=0),[a.memoizedState,m.dispatch]}function Cd(a){var o=Jt(),d=o.queue;if(d===null)throw Error(s(311));d.lastRenderedReducer=a;var m=d.dispatch,y=d.pending,b=o.memoizedState;if(y!==null){d.pending=null;var R=y=y.next;do b=a(b,R.action),R=R.next;while(R!==y);ni(b,o.memoizedState)||(rs=!0),o.memoizedState=b,o.baseQueue===null&&(o.baseState=b),d.lastRenderedState=b}return[b,m]}function Vp(a,o,d){var m=Je,y=Jt(),b=ut;if(b){if(d===void 0)throw Error(s(407));d=d()}else d=o();var R=!ni((It||y).memoizedState,d);if(R&&(y.memoizedState=d,rs=!0),y=y.queue,kd(Hp.bind(null,m,y,a),[a]),y.getSnapshot!==o||R||as!==null&&as.memoizedState.tag&1){if(m.flags|=2048,gr(9,{destroy:void 0},Gp.bind(null,m,y,d,o),null),wt===null)throw Error(s(349));b||(yn&127)!==0||$p(m,o,d)}return d}function $p(a,o,d){a.flags|=16384,a={getSnapshot:o,value:d},o=Je.updateQueue,o===null?(o=Vo(),Je.updateQueue=o,o.stores=[a]):(d=o.stores,d===null?o.stores=[a]:d.push(a))}function Gp(a,o,d,m){o.value=d,o.getSnapshot=m,zp(o)&&Kp(a)}function Hp(a,o,d){return d(function(){zp(o)&&Kp(a)})}function zp(a){var o=a.getSnapshot;a=a.value;try{var d=o();return!ni(a,d)}catch{return!0}}function Kp(a){var o=Ia(a,2);o!==null&&Ys(o,a,2)}function Od(a){var o=js();if(typeof a=="function"){var d=a;if(a=d(),Da){fs(!0);try{d()}finally{fs(!1)}}}return o.memoizedState=o.baseState=a,o.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:xn,lastRenderedState:a},o}function Yp(a,o,d,m){return a.baseState=d,wd(a,It,typeof m=="function"?m:xn)}function qT(a,o,d,m,y){if(Ko(a))throw Error(s(485));if(a=o.action,a!==null){var b={payload:y,action:a,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(R){b.listeners.push(R)}};D.T!==null?d(!0):b.isTransition=!1,m(b),d=o.pending,d===null?(b.next=o.pending=b,qp(o,b)):(b.next=d.next,o.pending=d.next=b)}}function qp(a,o){var d=o.action,m=o.payload,y=a.state;if(o.isTransition){var b=D.T,R={};D.T=R;try{var N=d(y,m),B=D.S;B!==null&&B(R,N),Qp(a,o,N)}catch(X){Nd(a,o,X)}finally{b!==null&&R.types!==null&&(b.types=R.types),D.T=b}}else try{b=d(y,m),Qp(a,o,b)}catch(X){Nd(a,o,X)}}function Qp(a,o,d){d!==null&&typeof d=="object"&&typeof d.then=="function"?d.then(function(m){Wp(a,o,m)},function(m){return Nd(a,o,m)}):Wp(a,o,d)}function Wp(a,o,d){o.status="fulfilled",o.value=d,Xp(o),a.state=d,o=a.pending,o!==null&&(d=o.next,d===o?a.pending=null:(d=d.next,o.next=d,qp(a,d)))}function Nd(a,o,d){var m=a.pending;if(a.pending=null,m!==null){m=m.next;do o.status="rejected",o.reason=d,Xp(o),o=o.next;while(o!==m)}a.action=null}function Xp(a){a=a.listeners;for(var o=0;o<a.length;o++)(0,a[o])()}function Zp(a,o){return o}function Jp(a,o){if(ut){var d=wt.formState;if(d!==null){e:{var m=Je;if(ut){if(Dt){t:{for(var y=Dt,b=_i;y.nodeType!==8;){if(!b){y=null;break t}if(y=Li(y.nextSibling),y===null){y=null;break t}}b=y.data,y=b==="F!"||b==="F"?y:null}if(y){Dt=Li(y.nextSibling),m=y.data==="F!";break e}}Kn(m)}m=!1}m&&(o=d[0])}}return d=js(),d.memoizedState=d.baseState=o,m={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Zp,lastRenderedState:o},d.queue=m,d=yg.bind(null,Je,m),m.dispatch=d,m=Od(!1),b=jd.bind(null,Je,!1,m.queue),m=js(),y={state:o,dispatch:null,action:a,pending:null},m.queue=y,d=qT.bind(null,Je,y,b,d),y.dispatch=d,m.memoizedState=a,[o,d,!1]}function eg(a){var o=Jt();return tg(o,It,a)}function tg(a,o,d){if(o=wd(a,o,Zp)[0],a=Go(xn)[0],typeof o=="object"&&o!==null&&typeof o.then=="function")try{var m=yl(o)}catch(R){throw R===dr?ko:R}else m=o;o=Jt();var y=o.queue,b=y.dispatch;return d!==o.memoizedState&&(Je.flags|=2048,gr(9,{destroy:void 0},QT.bind(null,y,d),null)),[m,b,a]}function QT(a,o){a.action=o}function sg(a){var o=Jt(),d=It;if(d!==null)return tg(o,d,a);Jt(),o=o.memoizedState,d=Jt();var m=d.queue.dispatch;return d.memoizedState=a,[o,m,!1]}function gr(a,o,d,m){return a={tag:a,create:d,deps:m,inst:o,next:null},o=Je.updateQueue,o===null&&(o=Vo(),Je.updateQueue=o),d=o.lastEffect,d===null?o.lastEffect=a.next=a:(m=d.next,d.next=a,a.next=m,o.lastEffect=a),a}function ig(){return Jt().memoizedState}function Ho(a,o,d,m){var y=js();Je.flags|=a,y.memoizedState=gr(1|o,{destroy:void 0},d,m===void 0?null:m)}function zo(a,o,d,m){var y=Jt();m=m===void 0?null:m;var b=y.memoizedState.inst;It!==null&&m!==null&&Ed(m,It.memoizedState.deps)?y.memoizedState=gr(o,b,d,m):(Je.flags|=a,y.memoizedState=gr(1|o,b,d,m))}function ng(a,o){Ho(8390656,8,a,o)}function kd(a,o){zo(2048,8,a,o)}function WT(a){Je.flags|=4;var o=Je.updateQueue;if(o===null)o=Vo(),Je.updateQueue=o,o.events=[a];else{var d=o.events;d===null?o.events=[a]:d.push(a)}}function ag(a){var o=Jt().memoizedState;return WT({ref:o,nextImpl:a}),function(){if((pt&2)!==0)throw Error(s(440));return o.impl.apply(void 0,arguments)}}function rg(a,o){return zo(4,2,a,o)}function lg(a,o){return zo(4,4,a,o)}function og(a,o){if(typeof o=="function"){a=a();var d=o(a);return function(){typeof d=="function"?d():o(null)}}if(o!=null)return a=a(),o.current=a,function(){o.current=null}}function cg(a,o,d){d=d!=null?d.concat([a]):null,zo(4,4,og.bind(null,o,a),d)}function Dd(){}function ug(a,o){var d=Jt();o=o===void 0?null:o;var m=d.memoizedState;return o!==null&&Ed(o,m[1])?m[0]:(d.memoizedState=[a,o],a)}function dg(a,o){var d=Jt();o=o===void 0?null:o;var m=d.memoizedState;if(o!==null&&Ed(o,m[1]))return m[0];if(m=a(),Da){fs(!0);try{a()}finally{fs(!1)}}return d.memoizedState=[m,o],m}function Pd(a,o,d){return d===void 0||(yn&1073741824)!==0&&(ot&261930)===0?a.memoizedState=o:(a.memoizedState=d,a=h0(),Je.lanes|=a,ta|=a,d)}function hg(a,o,d,m){return ni(d,o)?d:fr.current!==null?(a=Pd(a,d,m),ni(a,o)||(rs=!0),a):(yn&42)===0||(yn&1073741824)!==0&&(ot&261930)===0?(rs=!0,a.memoizedState=d):(a=h0(),Je.lanes|=a,ta|=a,o)}function fg(a,o,d,m,y){var b=G.p;G.p=b!==0&&8>b?b:8;var R=D.T,N={};D.T=N,jd(a,!1,o,d);try{var B=y(),X=D.S;if(X!==null&&X(N,B),B!==null&&typeof B=="object"&&typeof B.then=="function"){var re=zT(B,m);xl(a,o,re,ui(a))}else xl(a,o,m,ui(a))}catch(fe){xl(a,o,{then:function(){},status:"rejected",reason:fe},ui())}finally{G.p=b,R!==null&&N.types!==null&&(R.types=N.types),D.T=R}}function XT(){}function Ud(a,o,d,m){if(a.tag!==5)throw Error(s(476));var y=mg(a).queue;fg(a,y,o,Y,d===null?XT:function(){return pg(a),d(m)})}function mg(a){var o=a.memoizedState;if(o!==null)return o;o={memoizedState:Y,baseState:Y,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:xn,lastRenderedState:Y},next:null};var d={};return o.next={memoizedState:d,baseState:d,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:xn,lastRenderedState:d},next:null},a.memoizedState=o,a=a.alternate,a!==null&&(a.memoizedState=o),o}function pg(a){var o=mg(a);o.next===null&&(o=a.alternate.memoizedState),xl(a,o.next.queue,{},ui())}function Md(){return As(Ul)}function gg(){return Jt().memoizedState}function vg(){return Jt().memoizedState}function ZT(a){for(var o=a.return;o!==null;){switch(o.tag){case 24:case 3:var d=ui();a=Qn(d);var m=Wn(o,a,d);m!==null&&(Ys(m,o,d),ml(m,o,d)),o={cache:hd()},a.payload=o;return}o=o.return}}function JT(a,o,d){var m=ui();d={lane:m,revertLane:0,gesture:null,action:d,hasEagerState:!1,eagerState:null,next:null},Ko(a)?xg(o,d):(d=td(a,o,d,m),d!==null&&(Ys(d,a,m),Sg(d,o,m)))}function yg(a,o,d){var m=ui();xl(a,o,d,m)}function xl(a,o,d,m){var y={lane:m,revertLane:0,gesture:null,action:d,hasEagerState:!1,eagerState:null,next:null};if(Ko(a))xg(o,y);else{var b=a.alternate;if(a.lanes===0&&(b===null||b.lanes===0)&&(b=o.lastRenderedReducer,b!==null))try{var R=o.lastRenderedState,N=b(R,d);if(y.hasEagerState=!0,y.eagerState=N,ni(N,R))return _o(a,o,y,0),wt===null&&Io(),!1}catch{}if(d=td(a,o,y,m),d!==null)return Ys(d,a,m),Sg(d,o,m),!0}return!1}function jd(a,o,d,m){if(m={lane:2,revertLane:gh(),gesture:null,action:m,hasEagerState:!1,eagerState:null,next:null},Ko(a)){if(o)throw Error(s(479))}else o=td(a,d,m,2),o!==null&&Ys(o,a,2)}function Ko(a){var o=a.alternate;return a===Je||o!==null&&o===Je}function xg(a,o){mr=Fo=!0;var d=a.pending;d===null?o.next=o:(o.next=d.next,d.next=o),a.pending=o}function Sg(a,o,d){if((d&4194048)!==0){var m=o.lanes;m&=a.pendingLanes,d|=m,o.lanes=d,Ki(a,d)}}var Sl={readContext:As,use:$o,useCallback:Yt,useContext:Yt,useEffect:Yt,useImperativeHandle:Yt,useLayoutEffect:Yt,useInsertionEffect:Yt,useMemo:Yt,useReducer:Yt,useRef:Yt,useState:Yt,useDebugValue:Yt,useDeferredValue:Yt,useTransition:Yt,useSyncExternalStore:Yt,useId:Yt,useHostTransitionStatus:Yt,useFormState:Yt,useActionState:Yt,useOptimistic:Yt,useMemoCache:Yt,useCacheRefresh:Yt};Sl.useEffectEvent=Yt;var bg={readContext:As,use:$o,useCallback:function(a,o){return js().memoizedState=[a,o===void 0?null:o],a},useContext:As,useEffect:ng,useImperativeHandle:function(a,o,d){d=d!=null?d.concat([a]):null,Ho(4194308,4,og.bind(null,o,a),d)},useLayoutEffect:function(a,o){return Ho(4194308,4,a,o)},useInsertionEffect:function(a,o){Ho(4,2,a,o)},useMemo:function(a,o){var d=js();o=o===void 0?null:o;var m=a();if(Da){fs(!0);try{a()}finally{fs(!1)}}return d.memoizedState=[m,o],m},useReducer:function(a,o,d){var m=js();if(d!==void 0){var y=d(o);if(Da){fs(!0);try{d(o)}finally{fs(!1)}}}else y=o;return m.memoizedState=m.baseState=y,a={pending:null,lanes:0,dispatch:null,lastRenderedReducer:a,lastRenderedState:y},m.queue=a,a=a.dispatch=JT.bind(null,Je,a),[m.memoizedState,a]},useRef:function(a){var o=js();return a={current:a},o.memoizedState=a},useState:function(a){a=Od(a);var o=a.queue,d=yg.bind(null,Je,o);return o.dispatch=d,[a.memoizedState,d]},useDebugValue:Dd,useDeferredValue:function(a,o){var d=js();return Pd(d,a,o)},useTransition:function(){var a=Od(!1);return a=fg.bind(null,Je,a.queue,!0,!1),js().memoizedState=a,[!1,a]},useSyncExternalStore:function(a,o,d){var m=Je,y=js();if(ut){if(d===void 0)throw Error(s(407));d=d()}else{if(d=o(),wt===null)throw Error(s(349));(ot&127)!==0||$p(m,o,d)}y.memoizedState=d;var b={value:d,getSnapshot:o};return y.queue=b,ng(Hp.bind(null,m,b,a),[a]),m.flags|=2048,gr(9,{destroy:void 0},Gp.bind(null,m,b,d,o),null),d},useId:function(){var a=js(),o=wt.identifierPrefix;if(ut){var d=qi,m=Yi;d=(m&~(1<<32-Et(m)-1)).toString(32)+d,o="_"+o+"R_"+d,d=Bo++,0<d&&(o+="H"+d.toString(32)),o+="_"}else d=KT++,o="_"+o+"r_"+d.toString(32)+"_";return a.memoizedState=o},useHostTransitionStatus:Md,useFormState:Jp,useActionState:Jp,useOptimistic:function(a){var o=js();o.memoizedState=o.baseState=a;var d={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return o.queue=d,o=jd.bind(null,Je,!0,d),d.dispatch=o,[a,o]},useMemoCache:Ld,useCacheRefresh:function(){return js().memoizedState=ZT.bind(null,Je)},useEffectEvent:function(a){var o=js(),d={impl:a};return o.memoizedState=d,function(){if((pt&2)!==0)throw Error(s(440));return d.impl.apply(void 0,arguments)}}},Fd={readContext:As,use:$o,useCallback:ug,useContext:As,useEffect:kd,useImperativeHandle:cg,useInsertionEffect:rg,useLayoutEffect:lg,useMemo:dg,useReducer:Go,useRef:ig,useState:function(){return Go(xn)},useDebugValue:Dd,useDeferredValue:function(a,o){var d=Jt();return hg(d,It.memoizedState,a,o)},useTransition:function(){var a=Go(xn)[0],o=Jt().memoizedState;return[typeof a=="boolean"?a:yl(a),o]},useSyncExternalStore:Vp,useId:gg,useHostTransitionStatus:Md,useFormState:eg,useActionState:eg,useOptimistic:function(a,o){var d=Jt();return Yp(d,It,a,o)},useMemoCache:Ld,useCacheRefresh:vg};Fd.useEffectEvent=ag;var Tg={readContext:As,use:$o,useCallback:ug,useContext:As,useEffect:kd,useImperativeHandle:cg,useInsertionEffect:rg,useLayoutEffect:lg,useMemo:dg,useReducer:Cd,useRef:ig,useState:function(){return Cd(xn)},useDebugValue:Dd,useDeferredValue:function(a,o){var d=Jt();return It===null?Pd(d,a,o):hg(d,It.memoizedState,a,o)},useTransition:function(){var a=Cd(xn)[0],o=Jt().memoizedState;return[typeof a=="boolean"?a:yl(a),o]},useSyncExternalStore:Vp,useId:gg,useHostTransitionStatus:Md,useFormState:sg,useActionState:sg,useOptimistic:function(a,o){var d=Jt();return It!==null?Yp(d,It,a,o):(d.baseState=a,[a,d.queue.dispatch])},useMemoCache:Ld,useCacheRefresh:vg};Tg.useEffectEvent=ag;function Bd(a,o,d,m){o=a.memoizedState,d=d(m,o),d=d==null?o:p({},o,d),a.memoizedState=d,a.lanes===0&&(a.updateQueue.baseState=d)}var Vd={enqueueSetState:function(a,o,d){a=a._reactInternals;var m=ui(),y=Qn(m);y.payload=o,d!=null&&(y.callback=d),o=Wn(a,y,m),o!==null&&(Ys(o,a,m),ml(o,a,m))},enqueueReplaceState:function(a,o,d){a=a._reactInternals;var m=ui(),y=Qn(m);y.tag=1,y.payload=o,d!=null&&(y.callback=d),o=Wn(a,y,m),o!==null&&(Ys(o,a,m),ml(o,a,m))},enqueueForceUpdate:function(a,o){a=a._reactInternals;var d=ui(),m=Qn(d);m.tag=2,o!=null&&(m.callback=o),o=Wn(a,m,d),o!==null&&(Ys(o,a,d),ml(o,a,d))}};function Eg(a,o,d,m,y,b,R){return a=a.stateNode,typeof a.shouldComponentUpdate=="function"?a.shouldComponentUpdate(m,b,R):o.prototype&&o.prototype.isPureReactComponent?!rl(d,m)||!rl(y,b):!0}function Ag(a,o,d,m){a=o.state,typeof o.componentWillReceiveProps=="function"&&o.componentWillReceiveProps(d,m),typeof o.UNSAFE_componentWillReceiveProps=="function"&&o.UNSAFE_componentWillReceiveProps(d,m),o.state!==a&&Vd.enqueueReplaceState(o,o.state,null)}function Pa(a,o){var d=o;if("ref"in o){d={};for(var m in o)m!=="ref"&&(d[m]=o[m])}if(a=a.defaultProps){d===o&&(d=p({},d));for(var y in a)d[y]===void 0&&(d[y]=a[y])}return d}function Ig(a){Ao(a)}function _g(a){console.error(a)}function Rg(a){Ao(a)}function Yo(a,o){try{var d=a.onUncaughtError;d(o.value,{componentStack:o.stack})}catch(m){setTimeout(function(){throw m})}}function Lg(a,o,d){try{var m=a.onCaughtError;m(d.value,{componentStack:d.stack,errorBoundary:o.tag===1?o.stateNode:null})}catch(y){setTimeout(function(){throw y})}}function $d(a,o,d){return d=Qn(d),d.tag=3,d.payload={element:null},d.callback=function(){Yo(a,o)},d}function wg(a){return a=Qn(a),a.tag=3,a}function Cg(a,o,d,m){var y=d.type.getDerivedStateFromError;if(typeof y=="function"){var b=m.value;a.payload=function(){return y(b)},a.callback=function(){Lg(o,d,m)}}var R=d.stateNode;R!==null&&typeof R.componentDidCatch=="function"&&(a.callback=function(){Lg(o,d,m),typeof y!="function"&&(sa===null?sa=new Set([this]):sa.add(this));var N=m.stack;this.componentDidCatch(m.value,{componentStack:N!==null?N:""})})}function eE(a,o,d,m,y){if(d.flags|=32768,m!==null&&typeof m=="object"&&typeof m.then=="function"){if(o=d.alternate,o!==null&&or(o,d,y,!0),d=ri.current,d!==null){switch(d.tag){case 31:case 13:return Ri===null?ac():d.alternate===null&&qt===0&&(qt=3),d.flags&=-257,d.flags|=65536,d.lanes=y,m===Do?d.flags|=16384:(o=d.updateQueue,o===null?d.updateQueue=new Set([m]):o.add(m),fh(a,m,y)),!1;case 22:return d.flags|=65536,m===Do?d.flags|=16384:(o=d.updateQueue,o===null?(o={transitions:null,markerInstances:null,retryQueue:new Set([m])},d.updateQueue=o):(d=o.retryQueue,d===null?o.retryQueue=new Set([m]):d.add(m)),fh(a,m,y)),!1}throw Error(s(435,d.tag))}return fh(a,m,y),ac(),!1}if(ut)return o=ri.current,o!==null?((o.flags&65536)===0&&(o.flags|=256),o.flags|=65536,o.lanes=y,m!==ld&&(a=Error(s(422),{cause:m}),cl(Ei(a,d)))):(m!==ld&&(o=Error(s(423),{cause:m}),cl(Ei(o,d))),a=a.current.alternate,a.flags|=65536,y&=-y,a.lanes|=y,m=Ei(m,d),y=$d(a.stateNode,m,y),yd(a,y),qt!==4&&(qt=2)),!1;var b=Error(s(520),{cause:m});if(b=Ei(b,d),Ll===null?Ll=[b]:Ll.push(b),qt!==4&&(qt=2),o===null)return!0;m=Ei(m,d),d=o;do{switch(d.tag){case 3:return d.flags|=65536,a=y&-y,d.lanes|=a,a=$d(d.stateNode,m,a),yd(d,a),!1;case 1:if(o=d.type,b=d.stateNode,(d.flags&128)===0&&(typeof o.getDerivedStateFromError=="function"||b!==null&&typeof b.componentDidCatch=="function"&&(sa===null||!sa.has(b))))return d.flags|=65536,y&=-y,d.lanes|=y,y=wg(y),Cg(y,a,d,m),yd(d,y),!1}d=d.return}while(d!==null);return!1}var Gd=Error(s(461)),rs=!1;function Is(a,o,d,m){o.child=a===null?Dp(o,null,d,m):ka(o,a.child,d,m)}function Og(a,o,d,m,y){d=d.render;var b=o.ref;if("ref"in m){var R={};for(var N in m)N!=="ref"&&(R[N]=m[N])}else R=m;return wa(o),m=Ad(a,o,d,R,b,y),N=Id(),a!==null&&!rs?(_d(a,o,y),Sn(a,o,y)):(ut&&N&&ad(o),o.flags|=1,Is(a,o,m,y),o.child)}function Ng(a,o,d,m,y){if(a===null){var b=d.type;return typeof b=="function"&&!sd(b)&&b.defaultProps===void 0&&d.compare===null?(o.tag=15,o.type=b,kg(a,o,b,m,y)):(a=Lo(d.type,null,m,o,o.mode,y),a.ref=o.ref,a.return=o,o.child=a)}if(b=a.child,!Xd(a,y)){var R=b.memoizedProps;if(d=d.compare,d=d!==null?d:rl,d(R,m)&&a.ref===o.ref)return Sn(a,o,y)}return o.flags|=1,a=mn(b,m),a.ref=o.ref,a.return=o,o.child=a}function kg(a,o,d,m,y){if(a!==null){var b=a.memoizedProps;if(rl(b,m)&&a.ref===o.ref)if(rs=!1,o.pendingProps=m=b,Xd(a,y))(a.flags&131072)!==0&&(rs=!0);else return o.lanes=a.lanes,Sn(a,o,y)}return Hd(a,o,d,m,y)}function Dg(a,o,d,m){var y=m.children,b=a!==null?a.memoizedState:null;if(a===null&&o.stateNode===null&&(o.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),m.mode==="hidden"){if((o.flags&128)!==0){if(b=b!==null?b.baseLanes|d:d,a!==null){for(m=o.child=a.child,y=0;m!==null;)y=y|m.lanes|m.childLanes,m=m.sibling;m=y&~b}else m=0,o.child=null;return Pg(a,o,b,d,m)}if((d&536870912)!==0)o.memoizedState={baseLanes:0,cachePool:null},a!==null&&No(o,b!==null?b.cachePool:null),b!==null?Mp(o,b):Sd(),jp(o);else return m=o.lanes=536870912,Pg(a,o,b!==null?b.baseLanes|d:d,d,m)}else b!==null?(No(o,b.cachePool),Mp(o,b),Zn(),o.memoizedState=null):(a!==null&&No(o,null),Sd(),Zn());return Is(a,o,y,d),o.child}function bl(a,o){return a!==null&&a.tag===22||o.stateNode!==null||(o.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),o.sibling}function Pg(a,o,d,m,y){var b=md();return b=b===null?null:{parent:ns._currentValue,pool:b},o.memoizedState={baseLanes:d,cachePool:b},a!==null&&No(o,null),Sd(),jp(o),a!==null&&or(a,o,m,!0),o.childLanes=y,null}function qo(a,o){return o=Wo({mode:o.mode,children:o.children},a.mode),o.ref=a.ref,a.child=o,o.return=a,o}function Ug(a,o,d){return ka(o,a.child,null,d),a=qo(o,o.pendingProps),a.flags|=2,li(o),o.memoizedState=null,a}function tE(a,o,d){var m=o.pendingProps,y=(o.flags&128)!==0;if(o.flags&=-129,a===null){if(ut){if(m.mode==="hidden")return a=qo(o,m),o.lanes=536870912,bl(null,a);if(Td(o),(a=Dt)?(a=q0(a,_i),a=a!==null&&a.data==="&"?a:null,a!==null&&(o.memoizedState={dehydrated:a,treeContext:Hn!==null?{id:Yi,overflow:qi}:null,retryLane:536870912,hydrationErrors:null},d=xp(a),d.return=o,o.child=d,Es=o,Dt=null)):a=null,a===null)throw Kn(o);return o.lanes=536870912,null}return qo(o,m)}var b=a.memoizedState;if(b!==null){var R=b.dehydrated;if(Td(o),y)if(o.flags&256)o.flags&=-257,o=Ug(a,o,d);else if(o.memoizedState!==null)o.child=a.child,o.flags|=128,o=null;else throw Error(s(558));else if(rs||or(a,o,d,!1),y=(d&a.childLanes)!==0,rs||y){if(m=wt,m!==null&&(R=ue(m,d),R!==0&&R!==b.retryLane))throw b.retryLane=R,Ia(a,R),Ys(m,a,R),Gd;ac(),o=Ug(a,o,d)}else a=b.treeContext,Dt=Li(R.nextSibling),Es=o,ut=!0,zn=null,_i=!1,a!==null&&Tp(o,a),o=qo(o,m),o.flags|=4096;return o}return a=mn(a.child,{mode:m.mode,children:m.children}),a.ref=o.ref,o.child=a,a.return=o,a}function Qo(a,o){var d=o.ref;if(d===null)a!==null&&a.ref!==null&&(o.flags|=4194816);else{if(typeof d!="function"&&typeof d!="object")throw Error(s(284));(a===null||a.ref!==d)&&(o.flags|=4194816)}}function Hd(a,o,d,m,y){return wa(o),d=Ad(a,o,d,m,void 0,y),m=Id(),a!==null&&!rs?(_d(a,o,y),Sn(a,o,y)):(ut&&m&&ad(o),o.flags|=1,Is(a,o,d,y),o.child)}function Mg(a,o,d,m,y,b){return wa(o),o.updateQueue=null,d=Bp(o,m,d,y),Fp(a),m=Id(),a!==null&&!rs?(_d(a,o,b),Sn(a,o,b)):(ut&&m&&ad(o),o.flags|=1,Is(a,o,d,b),o.child)}function jg(a,o,d,m,y){if(wa(o),o.stateNode===null){var b=nr,R=d.contextType;typeof R=="object"&&R!==null&&(b=As(R)),b=new d(m,b),o.memoizedState=b.state!==null&&b.state!==void 0?b.state:null,b.updater=Vd,o.stateNode=b,b._reactInternals=o,b=o.stateNode,b.props=m,b.state=o.memoizedState,b.refs={},gd(o),R=d.contextType,b.context=typeof R=="object"&&R!==null?As(R):nr,b.state=o.memoizedState,R=d.getDerivedStateFromProps,typeof R=="function"&&(Bd(o,d,R,m),b.state=o.memoizedState),typeof d.getDerivedStateFromProps=="function"||typeof b.getSnapshotBeforeUpdate=="function"||typeof b.UNSAFE_componentWillMount!="function"&&typeof b.componentWillMount!="function"||(R=b.state,typeof b.componentWillMount=="function"&&b.componentWillMount(),typeof b.UNSAFE_componentWillMount=="function"&&b.UNSAFE_componentWillMount(),R!==b.state&&Vd.enqueueReplaceState(b,b.state,null),gl(o,m,b,y),pl(),b.state=o.memoizedState),typeof b.componentDidMount=="function"&&(o.flags|=4194308),m=!0}else if(a===null){b=o.stateNode;var N=o.memoizedProps,B=Pa(d,N);b.props=B;var X=b.context,re=d.contextType;R=nr,typeof re=="object"&&re!==null&&(R=As(re));var fe=d.getDerivedStateFromProps;re=typeof fe=="function"||typeof b.getSnapshotBeforeUpdate=="function",N=o.pendingProps!==N,re||typeof b.UNSAFE_componentWillReceiveProps!="function"&&typeof b.componentWillReceiveProps!="function"||(N||X!==R)&&Ag(o,b,m,R),qn=!1;var J=o.memoizedState;b.state=J,gl(o,m,b,y),pl(),X=o.memoizedState,N||J!==X||qn?(typeof fe=="function"&&(Bd(o,d,fe,m),X=o.memoizedState),(B=qn||Eg(o,d,B,m,J,X,R))?(re||typeof b.UNSAFE_componentWillMount!="function"&&typeof b.componentWillMount!="function"||(typeof b.componentWillMount=="function"&&b.componentWillMount(),typeof b.UNSAFE_componentWillMount=="function"&&b.UNSAFE_componentWillMount()),typeof b.componentDidMount=="function"&&(o.flags|=4194308)):(typeof b.componentDidMount=="function"&&(o.flags|=4194308),o.memoizedProps=m,o.memoizedState=X),b.props=m,b.state=X,b.context=R,m=B):(typeof b.componentDidMount=="function"&&(o.flags|=4194308),m=!1)}else{b=o.stateNode,vd(a,o),R=o.memoizedProps,re=Pa(d,R),b.props=re,fe=o.pendingProps,J=b.context,X=d.contextType,B=nr,typeof X=="object"&&X!==null&&(B=As(X)),N=d.getDerivedStateFromProps,(X=typeof N=="function"||typeof b.getSnapshotBeforeUpdate=="function")||typeof b.UNSAFE_componentWillReceiveProps!="function"&&typeof b.componentWillReceiveProps!="function"||(R!==fe||J!==B)&&Ag(o,b,m,B),qn=!1,J=o.memoizedState,b.state=J,gl(o,m,b,y),pl();var ne=o.memoizedState;R!==fe||J!==ne||qn||a!==null&&a.dependencies!==null&&Co(a.dependencies)?(typeof N=="function"&&(Bd(o,d,N,m),ne=o.memoizedState),(re=qn||Eg(o,d,re,m,J,ne,B)||a!==null&&a.dependencies!==null&&Co(a.dependencies))?(X||typeof b.UNSAFE_componentWillUpdate!="function"&&typeof b.componentWillUpdate!="function"||(typeof b.componentWillUpdate=="function"&&b.componentWillUpdate(m,ne,B),typeof b.UNSAFE_componentWillUpdate=="function"&&b.UNSAFE_componentWillUpdate(m,ne,B)),typeof b.componentDidUpdate=="function"&&(o.flags|=4),typeof b.getSnapshotBeforeUpdate=="function"&&(o.flags|=1024)):(typeof b.componentDidUpdate!="function"||R===a.memoizedProps&&J===a.memoizedState||(o.flags|=4),typeof b.getSnapshotBeforeUpdate!="function"||R===a.memoizedProps&&J===a.memoizedState||(o.flags|=1024),o.memoizedProps=m,o.memoizedState=ne),b.props=m,b.state=ne,b.context=B,m=re):(typeof b.componentDidUpdate!="function"||R===a.memoizedProps&&J===a.memoizedState||(o.flags|=4),typeof b.getSnapshotBeforeUpdate!="function"||R===a.memoizedProps&&J===a.memoizedState||(o.flags|=1024),m=!1)}return b=m,Qo(a,o),m=(o.flags&128)!==0,b||m?(b=o.stateNode,d=m&&typeof d.getDerivedStateFromError!="function"?null:b.render(),o.flags|=1,a!==null&&m?(o.child=ka(o,a.child,null,y),o.child=ka(o,null,d,y)):Is(a,o,d,y),o.memoizedState=b.state,a=o.child):a=Sn(a,o,y),a}function Fg(a,o,d,m){return Ra(),o.flags|=256,Is(a,o,d,m),o.child}var zd={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Kd(a){return{baseLanes:a,cachePool:Lp()}}function Yd(a,o,d){return a=a!==null?a.childLanes&~d:0,o&&(a|=ci),a}function Bg(a,o,d){var m=o.pendingProps,y=!1,b=(o.flags&128)!==0,R;if((R=b)||(R=a!==null&&a.memoizedState===null?!1:(Zt.current&2)!==0),R&&(y=!0,o.flags&=-129),R=(o.flags&32)!==0,o.flags&=-33,a===null){if(ut){if(y?Xn(o):Zn(),(a=Dt)?(a=q0(a,_i),a=a!==null&&a.data!=="&"?a:null,a!==null&&(o.memoizedState={dehydrated:a,treeContext:Hn!==null?{id:Yi,overflow:qi}:null,retryLane:536870912,hydrationErrors:null},d=xp(a),d.return=o,o.child=d,Es=o,Dt=null)):a=null,a===null)throw Kn(o);return wh(a)?o.lanes=32:o.lanes=536870912,null}var N=m.children;return m=m.fallback,y?(Zn(),y=o.mode,N=Wo({mode:"hidden",children:N},y),m=_a(m,y,d,null),N.return=o,m.return=o,N.sibling=m,o.child=N,m=o.child,m.memoizedState=Kd(d),m.childLanes=Yd(a,R,d),o.memoizedState=zd,bl(null,m)):(Xn(o),qd(o,N))}var B=a.memoizedState;if(B!==null&&(N=B.dehydrated,N!==null)){if(b)o.flags&256?(Xn(o),o.flags&=-257,o=Qd(a,o,d)):o.memoizedState!==null?(Zn(),o.child=a.child,o.flags|=128,o=null):(Zn(),N=m.fallback,y=o.mode,m=Wo({mode:"visible",children:m.children},y),N=_a(N,y,d,null),N.flags|=2,m.return=o,N.return=o,m.sibling=N,o.child=m,ka(o,a.child,null,d),m=o.child,m.memoizedState=Kd(d),m.childLanes=Yd(a,R,d),o.memoizedState=zd,o=bl(null,m));else if(Xn(o),wh(N)){if(R=N.nextSibling&&N.nextSibling.dataset,R)var X=R.dgst;R=X,m=Error(s(419)),m.stack="",m.digest=R,cl({value:m,source:null,stack:null}),o=Qd(a,o,d)}else if(rs||or(a,o,d,!1),R=(d&a.childLanes)!==0,rs||R){if(R=wt,R!==null&&(m=ue(R,d),m!==0&&m!==B.retryLane))throw B.retryLane=m,Ia(a,m),Ys(R,a,m),Gd;Lh(N)||ac(),o=Qd(a,o,d)}else Lh(N)?(o.flags|=192,o.child=a.child,o=null):(a=B.treeContext,Dt=Li(N.nextSibling),Es=o,ut=!0,zn=null,_i=!1,a!==null&&Tp(o,a),o=qd(o,m.children),o.flags|=4096);return o}return y?(Zn(),N=m.fallback,y=o.mode,B=a.child,X=B.sibling,m=mn(B,{mode:"hidden",children:m.children}),m.subtreeFlags=B.subtreeFlags&65011712,X!==null?N=mn(X,N):(N=_a(N,y,d,null),N.flags|=2),N.return=o,m.return=o,m.sibling=N,o.child=m,bl(null,m),m=o.child,N=a.child.memoizedState,N===null?N=Kd(d):(y=N.cachePool,y!==null?(B=ns._currentValue,y=y.parent!==B?{parent:B,pool:B}:y):y=Lp(),N={baseLanes:N.baseLanes|d,cachePool:y}),m.memoizedState=N,m.childLanes=Yd(a,R,d),o.memoizedState=zd,bl(a.child,m)):(Xn(o),d=a.child,a=d.sibling,d=mn(d,{mode:"visible",children:m.children}),d.return=o,d.sibling=null,a!==null&&(R=o.deletions,R===null?(o.deletions=[a],o.flags|=16):R.push(a)),o.child=d,o.memoizedState=null,d)}function qd(a,o){return o=Wo({mode:"visible",children:o},a.mode),o.return=a,a.child=o}function Wo(a,o){return a=ai(22,a,null,o),a.lanes=0,a}function Qd(a,o,d){return ka(o,a.child,null,d),a=qd(o,o.pendingProps.children),a.flags|=2,o.memoizedState=null,a}function Vg(a,o,d){a.lanes|=o;var m=a.alternate;m!==null&&(m.lanes|=o),ud(a.return,o,d)}function Wd(a,o,d,m,y,b){var R=a.memoizedState;R===null?a.memoizedState={isBackwards:o,rendering:null,renderingStartTime:0,last:m,tail:d,tailMode:y,treeForkCount:b}:(R.isBackwards=o,R.rendering=null,R.renderingStartTime=0,R.last=m,R.tail=d,R.tailMode=y,R.treeForkCount=b)}function $g(a,o,d){var m=o.pendingProps,y=m.revealOrder,b=m.tail;m=m.children;var R=Zt.current,N=(R&2)!==0;if(N?(R=R&1|2,o.flags|=128):R&=1,se(Zt,R),Is(a,o,m,d),m=ut?ol:0,!N&&a!==null&&(a.flags&128)!==0)e:for(a=o.child;a!==null;){if(a.tag===13)a.memoizedState!==null&&Vg(a,d,o);else if(a.tag===19)Vg(a,d,o);else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===o)break e;for(;a.sibling===null;){if(a.return===null||a.return===o)break e;a=a.return}a.sibling.return=a.return,a=a.sibling}switch(y){case"forwards":for(d=o.child,y=null;d!==null;)a=d.alternate,a!==null&&jo(a)===null&&(y=d),d=d.sibling;d=y,d===null?(y=o.child,o.child=null):(y=d.sibling,d.sibling=null),Wd(o,!1,y,d,b,m);break;case"backwards":case"unstable_legacy-backwards":for(d=null,y=o.child,o.child=null;y!==null;){if(a=y.alternate,a!==null&&jo(a)===null){o.child=y;break}a=y.sibling,y.sibling=d,d=y,y=a}Wd(o,!0,d,null,b,m);break;case"together":Wd(o,!1,null,null,void 0,m);break;default:o.memoizedState=null}return o.child}function Sn(a,o,d){if(a!==null&&(o.dependencies=a.dependencies),ta|=o.lanes,(d&o.childLanes)===0)if(a!==null){if(or(a,o,d,!1),(d&o.childLanes)===0)return null}else return null;if(a!==null&&o.child!==a.child)throw Error(s(153));if(o.child!==null){for(a=o.child,d=mn(a,a.pendingProps),o.child=d,d.return=o;a.sibling!==null;)a=a.sibling,d=d.sibling=mn(a,a.pendingProps),d.return=o;d.sibling=null}return o.child}function Xd(a,o){return(a.lanes&o)!==0?!0:(a=a.dependencies,!!(a!==null&&Co(a)))}function sE(a,o,d){switch(o.tag){case 3:He(o,o.stateNode.containerInfo),Yn(o,ns,a.memoizedState.cache),Ra();break;case 27:case 5:ht(o);break;case 4:He(o,o.stateNode.containerInfo);break;case 10:Yn(o,o.type,o.memoizedProps.value);break;case 31:if(o.memoizedState!==null)return o.flags|=128,Td(o),null;break;case 13:var m=o.memoizedState;if(m!==null)return m.dehydrated!==null?(Xn(o),o.flags|=128,null):(d&o.child.childLanes)!==0?Bg(a,o,d):(Xn(o),a=Sn(a,o,d),a!==null?a.sibling:null);Xn(o);break;case 19:var y=(a.flags&128)!==0;if(m=(d&o.childLanes)!==0,m||(or(a,o,d,!1),m=(d&o.childLanes)!==0),y){if(m)return $g(a,o,d);o.flags|=128}if(y=o.memoizedState,y!==null&&(y.rendering=null,y.tail=null,y.lastEffect=null),se(Zt,Zt.current),m)break;return null;case 22:return o.lanes=0,Dg(a,o,d,o.pendingProps);case 24:Yn(o,ns,a.memoizedState.cache)}return Sn(a,o,d)}function Gg(a,o,d){if(a!==null)if(a.memoizedProps!==o.pendingProps)rs=!0;else{if(!Xd(a,d)&&(o.flags&128)===0)return rs=!1,sE(a,o,d);rs=(a.flags&131072)!==0}else rs=!1,ut&&(o.flags&1048576)!==0&&bp(o,ol,o.index);switch(o.lanes=0,o.tag){case 16:e:{var m=o.pendingProps;if(a=Oa(o.elementType),o.type=a,typeof a=="function")sd(a)?(m=Pa(a,m),o.tag=1,o=jg(null,o,a,m,d)):(o.tag=0,o=Hd(null,o,a,m,d));else{if(a!=null){var y=a.$$typeof;if(y===C){o.tag=11,o=Og(null,o,a,m,d);break e}else if(y===O){o.tag=14,o=Ng(null,o,a,m,d);break e}}throw o=ae(a)||a,Error(s(306,o,""))}}return o;case 0:return Hd(a,o,o.type,o.pendingProps,d);case 1:return m=o.type,y=Pa(m,o.pendingProps),jg(a,o,m,y,d);case 3:e:{if(He(o,o.stateNode.containerInfo),a===null)throw Error(s(387));m=o.pendingProps;var b=o.memoizedState;y=b.element,vd(a,o),gl(o,m,null,d);var R=o.memoizedState;if(m=R.cache,Yn(o,ns,m),m!==b.cache&&dd(o,[ns],d,!0),pl(),m=R.element,b.isDehydrated)if(b={element:m,isDehydrated:!1,cache:R.cache},o.updateQueue.baseState=b,o.memoizedState=b,o.flags&256){o=Fg(a,o,m,d);break e}else if(m!==y){y=Ei(Error(s(424)),o),cl(y),o=Fg(a,o,m,d);break e}else for(a=o.stateNode.containerInfo,a.nodeType===9?a=a.body:a=a.nodeName==="HTML"?a.ownerDocument.body:a,Dt=Li(a.firstChild),Es=o,ut=!0,zn=null,_i=!0,d=Dp(o,null,m,d),o.child=d;d;)d.flags=d.flags&-3|4096,d=d.sibling;else{if(Ra(),m===y){o=Sn(a,o,d);break e}Is(a,o,m,d)}o=o.child}return o;case 26:return Qo(a,o),a===null?(d=ev(o.type,null,o.pendingProps,null))?o.memoizedState=d:ut||(d=o.type,a=o.pendingProps,m=hc(Ae.current).createElement(d),m[gt]=o,m[At]=a,_s(m,d,a),is(m),o.stateNode=m):o.memoizedState=ev(o.type,a.memoizedProps,o.pendingProps,a.memoizedState),null;case 27:return ht(o),a===null&&ut&&(m=o.stateNode=X0(o.type,o.pendingProps,Ae.current),Es=o,_i=!0,y=Dt,ra(o.type)?(Ch=y,Dt=Li(m.firstChild)):Dt=y),Is(a,o,o.pendingProps.children,d),Qo(a,o),a===null&&(o.flags|=4194304),o.child;case 5:return a===null&&ut&&((y=m=Dt)&&(m=NE(m,o.type,o.pendingProps,_i),m!==null?(o.stateNode=m,Es=o,Dt=Li(m.firstChild),_i=!1,y=!0):y=!1),y||Kn(o)),ht(o),y=o.type,b=o.pendingProps,R=a!==null?a.memoizedProps:null,m=b.children,Ih(y,b)?m=null:R!==null&&Ih(y,R)&&(o.flags|=32),o.memoizedState!==null&&(y=Ad(a,o,YT,null,null,d),Ul._currentValue=y),Qo(a,o),Is(a,o,m,d),o.child;case 6:return a===null&&ut&&((a=d=Dt)&&(d=kE(d,o.pendingProps,_i),d!==null?(o.stateNode=d,Es=o,Dt=null,a=!0):a=!1),a||Kn(o)),null;case 13:return Bg(a,o,d);case 4:return He(o,o.stateNode.containerInfo),m=o.pendingProps,a===null?o.child=ka(o,null,m,d):Is(a,o,m,d),o.child;case 11:return Og(a,o,o.type,o.pendingProps,d);case 7:return Is(a,o,o.pendingProps,d),o.child;case 8:return Is(a,o,o.pendingProps.children,d),o.child;case 12:return Is(a,o,o.pendingProps.children,d),o.child;case 10:return m=o.pendingProps,Yn(o,o.type,m.value),Is(a,o,m.children,d),o.child;case 9:return y=o.type._context,m=o.pendingProps.children,wa(o),y=As(y),m=m(y),o.flags|=1,Is(a,o,m,d),o.child;case 14:return Ng(a,o,o.type,o.pendingProps,d);case 15:return kg(a,o,o.type,o.pendingProps,d);case 19:return $g(a,o,d);case 31:return tE(a,o,d);case 22:return Dg(a,o,d,o.pendingProps);case 24:return wa(o),m=As(ns),a===null?(y=md(),y===null&&(y=wt,b=hd(),y.pooledCache=b,b.refCount++,b!==null&&(y.pooledCacheLanes|=d),y=b),o.memoizedState={parent:m,cache:y},gd(o),Yn(o,ns,y)):((a.lanes&d)!==0&&(vd(a,o),gl(o,null,null,d),pl()),y=a.memoizedState,b=o.memoizedState,y.parent!==m?(y={parent:m,cache:m},o.memoizedState=y,o.lanes===0&&(o.memoizedState=o.updateQueue.baseState=y),Yn(o,ns,m)):(m=b.cache,Yn(o,ns,m),m!==y.cache&&dd(o,[ns],d,!0))),Is(a,o,o.pendingProps.children,d),o.child;case 29:throw o.pendingProps}throw Error(s(156,o.tag))}function bn(a){a.flags|=4}function Zd(a,o,d,m,y){if((o=(a.mode&32)!==0)&&(o=!1),o){if(a.flags|=16777216,(y&335544128)===y)if(a.stateNode.complete)a.flags|=8192;else if(g0())a.flags|=8192;else throw Na=Do,pd}else a.flags&=-16777217}function Hg(a,o){if(o.type!=="stylesheet"||(o.state.loading&4)!==0)a.flags&=-16777217;else if(a.flags|=16777216,!av(o))if(g0())a.flags|=8192;else throw Na=Do,pd}function Xo(a,o){o!==null&&(a.flags|=4),a.flags&16384&&(o=a.tag!==22?Si():536870912,a.lanes|=o,Sr|=o)}function Tl(a,o){if(!ut)switch(a.tailMode){case"hidden":o=a.tail;for(var d=null;o!==null;)o.alternate!==null&&(d=o),o=o.sibling;d===null?a.tail=null:d.sibling=null;break;case"collapsed":d=a.tail;for(var m=null;d!==null;)d.alternate!==null&&(m=d),d=d.sibling;m===null?o||a.tail===null?a.tail=null:a.tail.sibling=null:m.sibling=null}}function Pt(a){var o=a.alternate!==null&&a.alternate.child===a.child,d=0,m=0;if(o)for(var y=a.child;y!==null;)d|=y.lanes|y.childLanes,m|=y.subtreeFlags&65011712,m|=y.flags&65011712,y.return=a,y=y.sibling;else for(y=a.child;y!==null;)d|=y.lanes|y.childLanes,m|=y.subtreeFlags,m|=y.flags,y.return=a,y=y.sibling;return a.subtreeFlags|=m,a.childLanes=d,o}function iE(a,o,d){var m=o.pendingProps;switch(rd(o),o.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Pt(o),null;case 1:return Pt(o),null;case 3:return d=o.stateNode,m=null,a!==null&&(m=a.memoizedState.cache),o.memoizedState.cache!==m&&(o.flags|=2048),vn(ns),Be(),d.pendingContext&&(d.context=d.pendingContext,d.pendingContext=null),(a===null||a.child===null)&&(lr(o)?bn(o):a===null||a.memoizedState.isDehydrated&&(o.flags&256)===0||(o.flags|=1024,od())),Pt(o),null;case 26:var y=o.type,b=o.memoizedState;return a===null?(bn(o),b!==null?(Pt(o),Hg(o,b)):(Pt(o),Zd(o,y,null,m,d))):b?b!==a.memoizedState?(bn(o),Pt(o),Hg(o,b)):(Pt(o),o.flags&=-16777217):(a=a.memoizedProps,a!==m&&bn(o),Pt(o),Zd(o,y,a,m,d)),null;case 27:if(dt(o),d=Ae.current,y=o.type,a!==null&&o.stateNode!=null)a.memoizedProps!==m&&bn(o);else{if(!m){if(o.stateNode===null)throw Error(s(166));return Pt(o),null}a=he.current,lr(o)?Ep(o):(a=X0(y,m,d),o.stateNode=a,bn(o))}return Pt(o),null;case 5:if(dt(o),y=o.type,a!==null&&o.stateNode!=null)a.memoizedProps!==m&&bn(o);else{if(!m){if(o.stateNode===null)throw Error(s(166));return Pt(o),null}if(b=he.current,lr(o))Ep(o);else{var R=hc(Ae.current);switch(b){case 1:b=R.createElementNS("http://www.w3.org/2000/svg",y);break;case 2:b=R.createElementNS("http://www.w3.org/1998/Math/MathML",y);break;default:switch(y){case"svg":b=R.createElementNS("http://www.w3.org/2000/svg",y);break;case"math":b=R.createElementNS("http://www.w3.org/1998/Math/MathML",y);break;case"script":b=R.createElement("div"),b.innerHTML="<script><\/script>",b=b.removeChild(b.firstChild);break;case"select":b=typeof m.is=="string"?R.createElement("select",{is:m.is}):R.createElement("select"),m.multiple?b.multiple=!0:m.size&&(b.size=m.size);break;default:b=typeof m.is=="string"?R.createElement(y,{is:m.is}):R.createElement(y)}}b[gt]=o,b[At]=m;e:for(R=o.child;R!==null;){if(R.tag===5||R.tag===6)b.appendChild(R.stateNode);else if(R.tag!==4&&R.tag!==27&&R.child!==null){R.child.return=R,R=R.child;continue}if(R===o)break e;for(;R.sibling===null;){if(R.return===null||R.return===o)break e;R=R.return}R.sibling.return=R.return,R=R.sibling}o.stateNode=b;e:switch(_s(b,y,m),y){case"button":case"input":case"select":case"textarea":m=!!m.autoFocus;break e;case"img":m=!0;break e;default:m=!1}m&&bn(o)}}return Pt(o),Zd(o,o.type,a===null?null:a.memoizedProps,o.pendingProps,d),null;case 6:if(a&&o.stateNode!=null)a.memoizedProps!==m&&bn(o);else{if(typeof m!="string"&&o.stateNode===null)throw Error(s(166));if(a=Ae.current,lr(o)){if(a=o.stateNode,d=o.memoizedProps,m=null,y=Es,y!==null)switch(y.tag){case 27:case 5:m=y.memoizedProps}a[gt]=o,a=!!(a.nodeValue===d||m!==null&&m.suppressHydrationWarning===!0||B0(a.nodeValue,d)),a||Kn(o,!0)}else a=hc(a).createTextNode(m),a[gt]=o,o.stateNode=a}return Pt(o),null;case 31:if(d=o.memoizedState,a===null||a.memoizedState!==null){if(m=lr(o),d!==null){if(a===null){if(!m)throw Error(s(318));if(a=o.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(s(557));a[gt]=o}else Ra(),(o.flags&128)===0&&(o.memoizedState=null),o.flags|=4;Pt(o),a=!1}else d=od(),a!==null&&a.memoizedState!==null&&(a.memoizedState.hydrationErrors=d),a=!0;if(!a)return o.flags&256?(li(o),o):(li(o),null);if((o.flags&128)!==0)throw Error(s(558))}return Pt(o),null;case 13:if(m=o.memoizedState,a===null||a.memoizedState!==null&&a.memoizedState.dehydrated!==null){if(y=lr(o),m!==null&&m.dehydrated!==null){if(a===null){if(!y)throw Error(s(318));if(y=o.memoizedState,y=y!==null?y.dehydrated:null,!y)throw Error(s(317));y[gt]=o}else Ra(),(o.flags&128)===0&&(o.memoizedState=null),o.flags|=4;Pt(o),y=!1}else y=od(),a!==null&&a.memoizedState!==null&&(a.memoizedState.hydrationErrors=y),y=!0;if(!y)return o.flags&256?(li(o),o):(li(o),null)}return li(o),(o.flags&128)!==0?(o.lanes=d,o):(d=m!==null,a=a!==null&&a.memoizedState!==null,d&&(m=o.child,y=null,m.alternate!==null&&m.alternate.memoizedState!==null&&m.alternate.memoizedState.cachePool!==null&&(y=m.alternate.memoizedState.cachePool.pool),b=null,m.memoizedState!==null&&m.memoizedState.cachePool!==null&&(b=m.memoizedState.cachePool.pool),b!==y&&(m.flags|=2048)),d!==a&&d&&(o.child.flags|=8192),Xo(o,o.updateQueue),Pt(o),null);case 4:return Be(),a===null&&Sh(o.stateNode.containerInfo),Pt(o),null;case 10:return vn(o.type),Pt(o),null;case 19:if(V(Zt),m=o.memoizedState,m===null)return Pt(o),null;if(y=(o.flags&128)!==0,b=m.rendering,b===null)if(y)Tl(m,!1);else{if(qt!==0||a!==null&&(a.flags&128)!==0)for(a=o.child;a!==null;){if(b=jo(a),b!==null){for(o.flags|=128,Tl(m,!1),a=b.updateQueue,o.updateQueue=a,Xo(o,a),o.subtreeFlags=0,a=d,d=o.child;d!==null;)yp(d,a),d=d.sibling;return se(Zt,Zt.current&1|2),ut&&pn(o,m.treeForkCount),o.child}a=a.sibling}m.tail!==null&&st()>sc&&(o.flags|=128,y=!0,Tl(m,!1),o.lanes=4194304)}else{if(!y)if(a=jo(b),a!==null){if(o.flags|=128,y=!0,a=a.updateQueue,o.updateQueue=a,Xo(o,a),Tl(m,!0),m.tail===null&&m.tailMode==="hidden"&&!b.alternate&&!ut)return Pt(o),null}else 2*st()-m.renderingStartTime>sc&&d!==536870912&&(o.flags|=128,y=!0,Tl(m,!1),o.lanes=4194304);m.isBackwards?(b.sibling=o.child,o.child=b):(a=m.last,a!==null?a.sibling=b:o.child=b,m.last=b)}return m.tail!==null?(a=m.tail,m.rendering=a,m.tail=a.sibling,m.renderingStartTime=st(),a.sibling=null,d=Zt.current,se(Zt,y?d&1|2:d&1),ut&&pn(o,m.treeForkCount),a):(Pt(o),null);case 22:case 23:return li(o),bd(),m=o.memoizedState!==null,a!==null?a.memoizedState!==null!==m&&(o.flags|=8192):m&&(o.flags|=8192),m?(d&536870912)!==0&&(o.flags&128)===0&&(Pt(o),o.subtreeFlags&6&&(o.flags|=8192)):Pt(o),d=o.updateQueue,d!==null&&Xo(o,d.retryQueue),d=null,a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(d=a.memoizedState.cachePool.pool),m=null,o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(m=o.memoizedState.cachePool.pool),m!==d&&(o.flags|=2048),a!==null&&V(Ca),null;case 24:return d=null,a!==null&&(d=a.memoizedState.cache),o.memoizedState.cache!==d&&(o.flags|=2048),vn(ns),Pt(o),null;case 25:return null;case 30:return null}throw Error(s(156,o.tag))}function nE(a,o){switch(rd(o),o.tag){case 1:return a=o.flags,a&65536?(o.flags=a&-65537|128,o):null;case 3:return vn(ns),Be(),a=o.flags,(a&65536)!==0&&(a&128)===0?(o.flags=a&-65537|128,o):null;case 26:case 27:case 5:return dt(o),null;case 31:if(o.memoizedState!==null){if(li(o),o.alternate===null)throw Error(s(340));Ra()}return a=o.flags,a&65536?(o.flags=a&-65537|128,o):null;case 13:if(li(o),a=o.memoizedState,a!==null&&a.dehydrated!==null){if(o.alternate===null)throw Error(s(340));Ra()}return a=o.flags,a&65536?(o.flags=a&-65537|128,o):null;case 19:return V(Zt),null;case 4:return Be(),null;case 10:return vn(o.type),null;case 22:case 23:return li(o),bd(),a!==null&&V(Ca),a=o.flags,a&65536?(o.flags=a&-65537|128,o):null;case 24:return vn(ns),null;case 25:return null;default:return null}}function zg(a,o){switch(rd(o),o.tag){case 3:vn(ns),Be();break;case 26:case 27:case 5:dt(o);break;case 4:Be();break;case 31:o.memoizedState!==null&&li(o);break;case 13:li(o);break;case 19:V(Zt);break;case 10:vn(o.type);break;case 22:case 23:li(o),bd(),a!==null&&V(Ca);break;case 24:vn(ns)}}function El(a,o){try{var d=o.updateQueue,m=d!==null?d.lastEffect:null;if(m!==null){var y=m.next;d=y;do{if((d.tag&a)===a){m=void 0;var b=d.create,R=d.inst;m=b(),R.destroy=m}d=d.next}while(d!==y)}}catch(N){yt(o,o.return,N)}}function Jn(a,o,d){try{var m=o.updateQueue,y=m!==null?m.lastEffect:null;if(y!==null){var b=y.next;m=b;do{if((m.tag&a)===a){var R=m.inst,N=R.destroy;if(N!==void 0){R.destroy=void 0,y=o;var B=d,X=N;try{X()}catch(re){yt(y,B,re)}}}m=m.next}while(m!==b)}}catch(re){yt(o,o.return,re)}}function Kg(a){var o=a.updateQueue;if(o!==null){var d=a.stateNode;try{Up(o,d)}catch(m){yt(a,a.return,m)}}}function Yg(a,o,d){d.props=Pa(a.type,a.memoizedProps),d.state=a.memoizedState;try{d.componentWillUnmount()}catch(m){yt(a,o,m)}}function Al(a,o){try{var d=a.ref;if(d!==null){switch(a.tag){case 26:case 27:case 5:var m=a.stateNode;break;case 30:m=a.stateNode;break;default:m=a.stateNode}typeof d=="function"?a.refCleanup=d(m):d.current=m}}catch(y){yt(a,o,y)}}function Qi(a,o){var d=a.ref,m=a.refCleanup;if(d!==null)if(typeof m=="function")try{m()}catch(y){yt(a,o,y)}finally{a.refCleanup=null,a=a.alternate,a!=null&&(a.refCleanup=null)}else if(typeof d=="function")try{d(null)}catch(y){yt(a,o,y)}else d.current=null}function qg(a){var o=a.type,d=a.memoizedProps,m=a.stateNode;try{e:switch(o){case"button":case"input":case"select":case"textarea":d.autoFocus&&m.focus();break e;case"img":d.src?m.src=d.src:d.srcSet&&(m.srcset=d.srcSet)}}catch(y){yt(a,a.return,y)}}function Jd(a,o,d){try{var m=a.stateNode;_E(m,a.type,d,o),m[At]=o}catch(y){yt(a,a.return,y)}}function Qg(a){return a.tag===5||a.tag===3||a.tag===26||a.tag===27&&ra(a.type)||a.tag===4}function eh(a){e:for(;;){for(;a.sibling===null;){if(a.return===null||Qg(a.return))return null;a=a.return}for(a.sibling.return=a.return,a=a.sibling;a.tag!==5&&a.tag!==6&&a.tag!==18;){if(a.tag===27&&ra(a.type)||a.flags&2||a.child===null||a.tag===4)continue e;a.child.return=a,a=a.child}if(!(a.flags&2))return a.stateNode}}function th(a,o,d){var m=a.tag;if(m===5||m===6)a=a.stateNode,o?(d.nodeType===9?d.body:d.nodeName==="HTML"?d.ownerDocument.body:d).insertBefore(a,o):(o=d.nodeType===9?d.body:d.nodeName==="HTML"?d.ownerDocument.body:d,o.appendChild(a),d=d._reactRootContainer,d!=null||o.onclick!==null||(o.onclick=hn));else if(m!==4&&(m===27&&ra(a.type)&&(d=a.stateNode,o=null),a=a.child,a!==null))for(th(a,o,d),a=a.sibling;a!==null;)th(a,o,d),a=a.sibling}function Zo(a,o,d){var m=a.tag;if(m===5||m===6)a=a.stateNode,o?d.insertBefore(a,o):d.appendChild(a);else if(m!==4&&(m===27&&ra(a.type)&&(d=a.stateNode),a=a.child,a!==null))for(Zo(a,o,d),a=a.sibling;a!==null;)Zo(a,o,d),a=a.sibling}function Wg(a){var o=a.stateNode,d=a.memoizedProps;try{for(var m=a.type,y=o.attributes;y.length;)o.removeAttributeNode(y[0]);_s(o,m,d),o[gt]=a,o[At]=d}catch(b){yt(a,a.return,b)}}var Tn=!1,ls=!1,sh=!1,Xg=typeof WeakSet=="function"?WeakSet:Set,ps=null;function aE(a,o){if(a=a.containerInfo,Eh=xc,a=cp(a),Qu(a)){if("selectionStart"in a)var d={start:a.selectionStart,end:a.selectionEnd};else e:{d=(d=a.ownerDocument)&&d.defaultView||window;var m=d.getSelection&&d.getSelection();if(m&&m.rangeCount!==0){d=m.anchorNode;var y=m.anchorOffset,b=m.focusNode;m=m.focusOffset;try{d.nodeType,b.nodeType}catch{d=null;break e}var R=0,N=-1,B=-1,X=0,re=0,fe=a,J=null;t:for(;;){for(var ne;fe!==d||y!==0&&fe.nodeType!==3||(N=R+y),fe!==b||m!==0&&fe.nodeType!==3||(B=R+m),fe.nodeType===3&&(R+=fe.nodeValue.length),(ne=fe.firstChild)!==null;)J=fe,fe=ne;for(;;){if(fe===a)break t;if(J===d&&++X===y&&(N=R),J===b&&++re===m&&(B=R),(ne=fe.nextSibling)!==null)break;fe=J,J=fe.parentNode}fe=ne}d=N===-1||B===-1?null:{start:N,end:B}}else d=null}d=d||{start:0,end:0}}else d=null;for(Ah={focusedElem:a,selectionRange:d},xc=!1,ps=o;ps!==null;)if(o=ps,a=o.child,(o.subtreeFlags&1028)!==0&&a!==null)a.return=o,ps=a;else for(;ps!==null;){switch(o=ps,b=o.alternate,a=o.flags,o.tag){case 0:if((a&4)!==0&&(a=o.updateQueue,a=a!==null?a.events:null,a!==null))for(d=0;d<a.length;d++)y=a[d],y.ref.impl=y.nextImpl;break;case 11:case 15:break;case 1:if((a&1024)!==0&&b!==null){a=void 0,d=o,y=b.memoizedProps,b=b.memoizedState,m=d.stateNode;try{var Ue=Pa(d.type,y);a=m.getSnapshotBeforeUpdate(Ue,b),m.__reactInternalSnapshotBeforeUpdate=a}catch(Ge){yt(d,d.return,Ge)}}break;case 3:if((a&1024)!==0){if(a=o.stateNode.containerInfo,d=a.nodeType,d===9)Rh(a);else if(d===1)switch(a.nodeName){case"HEAD":case"HTML":case"BODY":Rh(a);break;default:a.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((a&1024)!==0)throw Error(s(163))}if(a=o.sibling,a!==null){a.return=o.return,ps=a;break}ps=o.return}}function Zg(a,o,d){var m=d.flags;switch(d.tag){case 0:case 11:case 15:An(a,d),m&4&&El(5,d);break;case 1:if(An(a,d),m&4)if(a=d.stateNode,o===null)try{a.componentDidMount()}catch(R){yt(d,d.return,R)}else{var y=Pa(d.type,o.memoizedProps);o=o.memoizedState;try{a.componentDidUpdate(y,o,a.__reactInternalSnapshotBeforeUpdate)}catch(R){yt(d,d.return,R)}}m&64&&Kg(d),m&512&&Al(d,d.return);break;case 3:if(An(a,d),m&64&&(a=d.updateQueue,a!==null)){if(o=null,d.child!==null)switch(d.child.tag){case 27:case 5:o=d.child.stateNode;break;case 1:o=d.child.stateNode}try{Up(a,o)}catch(R){yt(d,d.return,R)}}break;case 27:o===null&&m&4&&Wg(d);case 26:case 5:An(a,d),o===null&&m&4&&qg(d),m&512&&Al(d,d.return);break;case 12:An(a,d);break;case 31:An(a,d),m&4&&t0(a,d);break;case 13:An(a,d),m&4&&s0(a,d),m&64&&(a=d.memoizedState,a!==null&&(a=a.dehydrated,a!==null&&(d=mE.bind(null,d),DE(a,d))));break;case 22:if(m=d.memoizedState!==null||Tn,!m){o=o!==null&&o.memoizedState!==null||ls,y=Tn;var b=ls;Tn=m,(ls=o)&&!b?In(a,d,(d.subtreeFlags&8772)!==0):An(a,d),Tn=y,ls=b}break;case 30:break;default:An(a,d)}}function Jg(a){var o=a.alternate;o!==null&&(a.alternate=null,Jg(o)),a.child=null,a.deletions=null,a.sibling=null,a.tag===5&&(o=a.stateNode,o!==null&&Qr(o)),a.stateNode=null,a.return=null,a.dependencies=null,a.memoizedProps=null,a.memoizedState=null,a.pendingProps=null,a.stateNode=null,a.updateQueue=null}var jt=null,Gs=!1;function En(a,o,d){for(d=d.child;d!==null;)e0(a,o,d),d=d.sibling}function e0(a,o,d){if(Vt&&typeof Vt.onCommitFiberUnmount=="function")try{Vt.onCommitFiberUnmount(bs,d)}catch{}switch(d.tag){case 26:ls||Qi(d,o),En(a,o,d),d.memoizedState?d.memoizedState.count--:d.stateNode&&(d=d.stateNode,d.parentNode.removeChild(d));break;case 27:ls||Qi(d,o);var m=jt,y=Gs;ra(d.type)&&(jt=d.stateNode,Gs=!1),En(a,o,d),kl(d.stateNode),jt=m,Gs=y;break;case 5:ls||Qi(d,o);case 6:if(m=jt,y=Gs,jt=null,En(a,o,d),jt=m,Gs=y,jt!==null)if(Gs)try{(jt.nodeType===9?jt.body:jt.nodeName==="HTML"?jt.ownerDocument.body:jt).removeChild(d.stateNode)}catch(b){yt(d,o,b)}else try{jt.removeChild(d.stateNode)}catch(b){yt(d,o,b)}break;case 18:jt!==null&&(Gs?(a=jt,K0(a.nodeType===9?a.body:a.nodeName==="HTML"?a.ownerDocument.body:a,d.stateNode),Lr(a)):K0(jt,d.stateNode));break;case 4:m=jt,y=Gs,jt=d.stateNode.containerInfo,Gs=!0,En(a,o,d),jt=m,Gs=y;break;case 0:case 11:case 14:case 15:Jn(2,d,o),ls||Jn(4,d,o),En(a,o,d);break;case 1:ls||(Qi(d,o),m=d.stateNode,typeof m.componentWillUnmount=="function"&&Yg(d,o,m)),En(a,o,d);break;case 21:En(a,o,d);break;case 22:ls=(m=ls)||d.memoizedState!==null,En(a,o,d),ls=m;break;default:En(a,o,d)}}function t0(a,o){if(o.memoizedState===null&&(a=o.alternate,a!==null&&(a=a.memoizedState,a!==null))){a=a.dehydrated;try{Lr(a)}catch(d){yt(o,o.return,d)}}}function s0(a,o){if(o.memoizedState===null&&(a=o.alternate,a!==null&&(a=a.memoizedState,a!==null&&(a=a.dehydrated,a!==null))))try{Lr(a)}catch(d){yt(o,o.return,d)}}function rE(a){switch(a.tag){case 31:case 13:case 19:var o=a.stateNode;return o===null&&(o=a.stateNode=new Xg),o;case 22:return a=a.stateNode,o=a._retryCache,o===null&&(o=a._retryCache=new Xg),o;default:throw Error(s(435,a.tag))}}function Jo(a,o){var d=rE(a);o.forEach(function(m){if(!d.has(m)){d.add(m);var y=pE.bind(null,a,m);m.then(y,y)}})}function Hs(a,o){var d=o.deletions;if(d!==null)for(var m=0;m<d.length;m++){var y=d[m],b=a,R=o,N=R;e:for(;N!==null;){switch(N.tag){case 27:if(ra(N.type)){jt=N.stateNode,Gs=!1;break e}break;case 5:jt=N.stateNode,Gs=!1;break e;case 3:case 4:jt=N.stateNode.containerInfo,Gs=!0;break e}N=N.return}if(jt===null)throw Error(s(160));e0(b,R,y),jt=null,Gs=!1,b=y.alternate,b!==null&&(b.return=null),y.return=null}if(o.subtreeFlags&13886)for(o=o.child;o!==null;)i0(o,a),o=o.sibling}var Bi=null;function i0(a,o){var d=a.alternate,m=a.flags;switch(a.tag){case 0:case 11:case 14:case 15:Hs(o,a),zs(a),m&4&&(Jn(3,a,a.return),El(3,a),Jn(5,a,a.return));break;case 1:Hs(o,a),zs(a),m&512&&(ls||d===null||Qi(d,d.return)),m&64&&Tn&&(a=a.updateQueue,a!==null&&(m=a.callbacks,m!==null&&(d=a.shared.hiddenCallbacks,a.shared.hiddenCallbacks=d===null?m:d.concat(m))));break;case 26:var y=Bi;if(Hs(o,a),zs(a),m&512&&(ls||d===null||Qi(d,d.return)),m&4){var b=d!==null?d.memoizedState:null;if(m=a.memoizedState,d===null)if(m===null)if(a.stateNode===null){e:{m=a.type,d=a.memoizedProps,y=y.ownerDocument||y;t:switch(m){case"title":b=y.getElementsByTagName("title")[0],(!b||b[ii]||b[gt]||b.namespaceURI==="http://www.w3.org/2000/svg"||b.hasAttribute("itemprop"))&&(b=y.createElement(m),y.head.insertBefore(b,y.querySelector("head > title"))),_s(b,m,d),b[gt]=a,is(b),m=b;break e;case"link":var R=iv("link","href",y).get(m+(d.href||""));if(R){for(var N=0;N<R.length;N++)if(b=R[N],b.getAttribute("href")===(d.href==null||d.href===""?null:d.href)&&b.getAttribute("rel")===(d.rel==null?null:d.rel)&&b.getAttribute("title")===(d.title==null?null:d.title)&&b.getAttribute("crossorigin")===(d.crossOrigin==null?null:d.crossOrigin)){R.splice(N,1);break t}}b=y.createElement(m),_s(b,m,d),y.head.appendChild(b);break;case"meta":if(R=iv("meta","content",y).get(m+(d.content||""))){for(N=0;N<R.length;N++)if(b=R[N],b.getAttribute("content")===(d.content==null?null:""+d.content)&&b.getAttribute("name")===(d.name==null?null:d.name)&&b.getAttribute("property")===(d.property==null?null:d.property)&&b.getAttribute("http-equiv")===(d.httpEquiv==null?null:d.httpEquiv)&&b.getAttribute("charset")===(d.charSet==null?null:d.charSet)){R.splice(N,1);break t}}b=y.createElement(m),_s(b,m,d),y.head.appendChild(b);break;default:throw Error(s(468,m))}b[gt]=a,is(b),m=b}a.stateNode=m}else nv(y,a.type,a.stateNode);else a.stateNode=sv(y,m,a.memoizedProps);else b!==m?(b===null?d.stateNode!==null&&(d=d.stateNode,d.parentNode.removeChild(d)):b.count--,m===null?nv(y,a.type,a.stateNode):sv(y,m,a.memoizedProps)):m===null&&a.stateNode!==null&&Jd(a,a.memoizedProps,d.memoizedProps)}break;case 27:Hs(o,a),zs(a),m&512&&(ls||d===null||Qi(d,d.return)),d!==null&&m&4&&Jd(a,a.memoizedProps,d.memoizedProps);break;case 5:if(Hs(o,a),zs(a),m&512&&(ls||d===null||Qi(d,d.return)),a.flags&32){y=a.stateNode;try{$n(y,"")}catch(Ue){yt(a,a.return,Ue)}}m&4&&a.stateNode!=null&&(y=a.memoizedProps,Jd(a,y,d!==null?d.memoizedProps:y)),m&1024&&(sh=!0);break;case 6:if(Hs(o,a),zs(a),m&4){if(a.stateNode===null)throw Error(s(162));m=a.memoizedProps,d=a.stateNode;try{d.nodeValue=m}catch(Ue){yt(a,a.return,Ue)}}break;case 3:if(pc=null,y=Bi,Bi=fc(o.containerInfo),Hs(o,a),Bi=y,zs(a),m&4&&d!==null&&d.memoizedState.isDehydrated)try{Lr(o.containerInfo)}catch(Ue){yt(a,a.return,Ue)}sh&&(sh=!1,n0(a));break;case 4:m=Bi,Bi=fc(a.stateNode.containerInfo),Hs(o,a),zs(a),Bi=m;break;case 12:Hs(o,a),zs(a);break;case 31:Hs(o,a),zs(a),m&4&&(m=a.updateQueue,m!==null&&(a.updateQueue=null,Jo(a,m)));break;case 13:Hs(o,a),zs(a),a.child.flags&8192&&a.memoizedState!==null!=(d!==null&&d.memoizedState!==null)&&(tc=st()),m&4&&(m=a.updateQueue,m!==null&&(a.updateQueue=null,Jo(a,m)));break;case 22:y=a.memoizedState!==null;var B=d!==null&&d.memoizedState!==null,X=Tn,re=ls;if(Tn=X||y,ls=re||B,Hs(o,a),ls=re,Tn=X,zs(a),m&8192)e:for(o=a.stateNode,o._visibility=y?o._visibility&-2:o._visibility|1,y&&(d===null||B||Tn||ls||Ua(a)),d=null,o=a;;){if(o.tag===5||o.tag===26){if(d===null){B=d=o;try{if(b=B.stateNode,y)R=b.style,typeof R.setProperty=="function"?R.setProperty("display","none","important"):R.display="none";else{N=B.stateNode;var fe=B.memoizedProps.style,J=fe!=null&&fe.hasOwnProperty("display")?fe.display:null;N.style.display=J==null||typeof J=="boolean"?"":(""+J).trim()}}catch(Ue){yt(B,B.return,Ue)}}}else if(o.tag===6){if(d===null){B=o;try{B.stateNode.nodeValue=y?"":B.memoizedProps}catch(Ue){yt(B,B.return,Ue)}}}else if(o.tag===18){if(d===null){B=o;try{var ne=B.stateNode;y?Y0(ne,!0):Y0(B.stateNode,!1)}catch(Ue){yt(B,B.return,Ue)}}}else if((o.tag!==22&&o.tag!==23||o.memoizedState===null||o===a)&&o.child!==null){o.child.return=o,o=o.child;continue}if(o===a)break e;for(;o.sibling===null;){if(o.return===null||o.return===a)break e;d===o&&(d=null),o=o.return}d===o&&(d=null),o.sibling.return=o.return,o=o.sibling}m&4&&(m=a.updateQueue,m!==null&&(d=m.retryQueue,d!==null&&(m.retryQueue=null,Jo(a,d))));break;case 19:Hs(o,a),zs(a),m&4&&(m=a.updateQueue,m!==null&&(a.updateQueue=null,Jo(a,m)));break;case 30:break;case 21:break;default:Hs(o,a),zs(a)}}function zs(a){var o=a.flags;if(o&2){try{for(var d,m=a.return;m!==null;){if(Qg(m)){d=m;break}m=m.return}if(d==null)throw Error(s(160));switch(d.tag){case 27:var y=d.stateNode,b=eh(a);Zo(a,b,y);break;case 5:var R=d.stateNode;d.flags&32&&($n(R,""),d.flags&=-33);var N=eh(a);Zo(a,N,R);break;case 3:case 4:var B=d.stateNode.containerInfo,X=eh(a);th(a,X,B);break;default:throw Error(s(161))}}catch(re){yt(a,a.return,re)}a.flags&=-3}o&4096&&(a.flags&=-4097)}function n0(a){if(a.subtreeFlags&1024)for(a=a.child;a!==null;){var o=a;n0(o),o.tag===5&&o.flags&1024&&o.stateNode.reset(),a=a.sibling}}function An(a,o){if(o.subtreeFlags&8772)for(o=o.child;o!==null;)Zg(a,o.alternate,o),o=o.sibling}function Ua(a){for(a=a.child;a!==null;){var o=a;switch(o.tag){case 0:case 11:case 14:case 15:Jn(4,o,o.return),Ua(o);break;case 1:Qi(o,o.return);var d=o.stateNode;typeof d.componentWillUnmount=="function"&&Yg(o,o.return,d),Ua(o);break;case 27:kl(o.stateNode);case 26:case 5:Qi(o,o.return),Ua(o);break;case 22:o.memoizedState===null&&Ua(o);break;case 30:Ua(o);break;default:Ua(o)}a=a.sibling}}function In(a,o,d){for(d=d&&(o.subtreeFlags&8772)!==0,o=o.child;o!==null;){var m=o.alternate,y=a,b=o,R=b.flags;switch(b.tag){case 0:case 11:case 15:In(y,b,d),El(4,b);break;case 1:if(In(y,b,d),m=b,y=m.stateNode,typeof y.componentDidMount=="function")try{y.componentDidMount()}catch(X){yt(m,m.return,X)}if(m=b,y=m.updateQueue,y!==null){var N=m.stateNode;try{var B=y.shared.hiddenCallbacks;if(B!==null)for(y.shared.hiddenCallbacks=null,y=0;y<B.length;y++)Pp(B[y],N)}catch(X){yt(m,m.return,X)}}d&&R&64&&Kg(b),Al(b,b.return);break;case 27:Wg(b);case 26:case 5:In(y,b,d),d&&m===null&&R&4&&qg(b),Al(b,b.return);break;case 12:In(y,b,d);break;case 31:In(y,b,d),d&&R&4&&t0(y,b);break;case 13:In(y,b,d),d&&R&4&&s0(y,b);break;case 22:b.memoizedState===null&&In(y,b,d),Al(b,b.return);break;case 30:break;default:In(y,b,d)}o=o.sibling}}function ih(a,o){var d=null;a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(d=a.memoizedState.cachePool.pool),a=null,o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(a=o.memoizedState.cachePool.pool),a!==d&&(a!=null&&a.refCount++,d!=null&&ul(d))}function nh(a,o){a=null,o.alternate!==null&&(a=o.alternate.memoizedState.cache),o=o.memoizedState.cache,o!==a&&(o.refCount++,a!=null&&ul(a))}function Vi(a,o,d,m){if(o.subtreeFlags&10256)for(o=o.child;o!==null;)a0(a,o,d,m),o=o.sibling}function a0(a,o,d,m){var y=o.flags;switch(o.tag){case 0:case 11:case 15:Vi(a,o,d,m),y&2048&&El(9,o);break;case 1:Vi(a,o,d,m);break;case 3:Vi(a,o,d,m),y&2048&&(a=null,o.alternate!==null&&(a=o.alternate.memoizedState.cache),o=o.memoizedState.cache,o!==a&&(o.refCount++,a!=null&&ul(a)));break;case 12:if(y&2048){Vi(a,o,d,m),a=o.stateNode;try{var b=o.memoizedProps,R=b.id,N=b.onPostCommit;typeof N=="function"&&N(R,o.alternate===null?"mount":"update",a.passiveEffectDuration,-0)}catch(B){yt(o,o.return,B)}}else Vi(a,o,d,m);break;case 31:Vi(a,o,d,m);break;case 13:Vi(a,o,d,m);break;case 23:break;case 22:b=o.stateNode,R=o.alternate,o.memoizedState!==null?b._visibility&2?Vi(a,o,d,m):Il(a,o):b._visibility&2?Vi(a,o,d,m):(b._visibility|=2,vr(a,o,d,m,(o.subtreeFlags&10256)!==0||!1)),y&2048&&ih(R,o);break;case 24:Vi(a,o,d,m),y&2048&&nh(o.alternate,o);break;default:Vi(a,o,d,m)}}function vr(a,o,d,m,y){for(y=y&&((o.subtreeFlags&10256)!==0||!1),o=o.child;o!==null;){var b=a,R=o,N=d,B=m,X=R.flags;switch(R.tag){case 0:case 11:case 15:vr(b,R,N,B,y),El(8,R);break;case 23:break;case 22:var re=R.stateNode;R.memoizedState!==null?re._visibility&2?vr(b,R,N,B,y):Il(b,R):(re._visibility|=2,vr(b,R,N,B,y)),y&&X&2048&&ih(R.alternate,R);break;case 24:vr(b,R,N,B,y),y&&X&2048&&nh(R.alternate,R);break;default:vr(b,R,N,B,y)}o=o.sibling}}function Il(a,o){if(o.subtreeFlags&10256)for(o=o.child;o!==null;){var d=a,m=o,y=m.flags;switch(m.tag){case 22:Il(d,m),y&2048&&ih(m.alternate,m);break;case 24:Il(d,m),y&2048&&nh(m.alternate,m);break;default:Il(d,m)}o=o.sibling}}var _l=8192;function yr(a,o,d){if(a.subtreeFlags&_l)for(a=a.child;a!==null;)r0(a,o,d),a=a.sibling}function r0(a,o,d){switch(a.tag){case 26:yr(a,o,d),a.flags&_l&&a.memoizedState!==null&&KE(d,Bi,a.memoizedState,a.memoizedProps);break;case 5:yr(a,o,d);break;case 3:case 4:var m=Bi;Bi=fc(a.stateNode.containerInfo),yr(a,o,d),Bi=m;break;case 22:a.memoizedState===null&&(m=a.alternate,m!==null&&m.memoizedState!==null?(m=_l,_l=16777216,yr(a,o,d),_l=m):yr(a,o,d));break;default:yr(a,o,d)}}function l0(a){var o=a.alternate;if(o!==null&&(a=o.child,a!==null)){o.child=null;do o=a.sibling,a.sibling=null,a=o;while(a!==null)}}function Rl(a){var o=a.deletions;if((a.flags&16)!==0){if(o!==null)for(var d=0;d<o.length;d++){var m=o[d];ps=m,c0(m,a)}l0(a)}if(a.subtreeFlags&10256)for(a=a.child;a!==null;)o0(a),a=a.sibling}function o0(a){switch(a.tag){case 0:case 11:case 15:Rl(a),a.flags&2048&&Jn(9,a,a.return);break;case 3:Rl(a);break;case 12:Rl(a);break;case 22:var o=a.stateNode;a.memoizedState!==null&&o._visibility&2&&(a.return===null||a.return.tag!==13)?(o._visibility&=-3,ec(a)):Rl(a);break;default:Rl(a)}}function ec(a){var o=a.deletions;if((a.flags&16)!==0){if(o!==null)for(var d=0;d<o.length;d++){var m=o[d];ps=m,c0(m,a)}l0(a)}for(a=a.child;a!==null;){switch(o=a,o.tag){case 0:case 11:case 15:Jn(8,o,o.return),ec(o);break;case 22:d=o.stateNode,d._visibility&2&&(d._visibility&=-3,ec(o));break;default:ec(o)}a=a.sibling}}function c0(a,o){for(;ps!==null;){var d=ps;switch(d.tag){case 0:case 11:case 15:Jn(8,d,o);break;case 23:case 22:if(d.memoizedState!==null&&d.memoizedState.cachePool!==null){var m=d.memoizedState.cachePool.pool;m!=null&&m.refCount++}break;case 24:ul(d.memoizedState.cache)}if(m=d.child,m!==null)m.return=d,ps=m;else e:for(d=a;ps!==null;){m=ps;var y=m.sibling,b=m.return;if(Jg(m),m===d){ps=null;break e}if(y!==null){y.return=b,ps=y;break e}ps=b}}}var lE={getCacheForType:function(a){var o=As(ns),d=o.data.get(a);return d===void 0&&(d=a(),o.data.set(a,d)),d},cacheSignal:function(){return As(ns).controller.signal}},oE=typeof WeakMap=="function"?WeakMap:Map,pt=0,wt=null,rt=null,ot=0,vt=0,oi=null,ea=!1,xr=!1,ah=!1,_n=0,qt=0,ta=0,Ma=0,rh=0,ci=0,Sr=0,Ll=null,Ks=null,lh=!1,tc=0,u0=0,sc=1/0,ic=null,sa=null,us=0,ia=null,br=null,Rn=0,oh=0,ch=null,d0=null,wl=0,uh=null;function ui(){return(pt&2)!==0&&ot!==0?ot&-ot:D.T!==null?gh():zt()}function h0(){if(ci===0)if((ot&536870912)===0||ut){var a=Wt;Wt<<=1,(Wt&3932160)===0&&(Wt=262144),ci=a}else ci=536870912;return a=ri.current,a!==null&&(a.flags|=32),ci}function Ys(a,o,d){(a===wt&&(vt===2||vt===9)||a.cancelPendingCommit!==null)&&(Tr(a,0),na(a,ot,ci,!1)),Nt(a,d),((pt&2)===0||a!==wt)&&(a===wt&&((pt&2)===0&&(Ma|=d),qt===4&&na(a,ot,ci,!1)),Wi(a))}function f0(a,o,d){if((pt&6)!==0)throw Error(s(327));var m=!d&&(o&127)===0&&(o&a.expiredLanes)===0||cs(a,o),y=m?dE(a,o):hh(a,o,!0),b=m;do{if(y===0){xr&&!m&&na(a,o,0,!1);break}else{if(d=a.current.alternate,b&&!cE(d)){y=hh(a,o,!1),b=!1;continue}if(y===2){if(b=o,a.errorRecoveryDisabledLanes&b)var R=0;else R=a.pendingLanes&-536870913,R=R!==0?R:R&536870912?536870912:0;if(R!==0){o=R;e:{var N=a;y=Ll;var B=N.current.memoizedState.isDehydrated;if(B&&(Tr(N,R).flags|=256),R=hh(N,R,!1),R!==2){if(ah&&!B){N.errorRecoveryDisabledLanes|=b,Ma|=b,y=4;break e}b=Ks,Ks=y,b!==null&&(Ks===null?Ks=b:Ks.push.apply(Ks,b))}y=R}if(b=!1,y!==2)continue}}if(y===1){Tr(a,0),na(a,o,0,!0);break}e:{switch(m=a,b=y,b){case 0:case 1:throw Error(s(345));case 4:if((o&4194048)!==o)break;case 6:na(m,o,ci,!ea);break e;case 2:Ks=null;break;case 3:case 5:break;default:throw Error(s(329))}if((o&62914560)===o&&(y=tc+300-st(),10<y)){if(na(m,o,ci,!ea),Ms(m,0,!0)!==0)break e;Rn=o,m.timeoutHandle=H0(m0.bind(null,m,d,Ks,ic,lh,o,ci,Ma,Sr,ea,b,"Throttled",-0,0),y);break e}m0(m,d,Ks,ic,lh,o,ci,Ma,Sr,ea,b,null,-0,0)}}break}while(!0);Wi(a)}function m0(a,o,d,m,y,b,R,N,B,X,re,fe,J,ne){if(a.timeoutHandle=-1,fe=o.subtreeFlags,fe&8192||(fe&16785408)===16785408){fe={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:hn},r0(o,b,fe);var Ue=(b&62914560)===b?tc-st():(b&4194048)===b?u0-st():0;if(Ue=YE(fe,Ue),Ue!==null){Rn=b,a.cancelPendingCommit=Ue(T0.bind(null,a,o,b,d,m,y,R,N,B,re,fe,null,J,ne)),na(a,b,R,!X);return}}T0(a,o,b,d,m,y,R,N,B)}function cE(a){for(var o=a;;){var d=o.tag;if((d===0||d===11||d===15)&&o.flags&16384&&(d=o.updateQueue,d!==null&&(d=d.stores,d!==null)))for(var m=0;m<d.length;m++){var y=d[m],b=y.getSnapshot;y=y.value;try{if(!ni(b(),y))return!1}catch{return!1}}if(d=o.child,o.subtreeFlags&16384&&d!==null)d.return=o,o=d;else{if(o===a)break;for(;o.sibling===null;){if(o.return===null||o.return===a)return!0;o=o.return}o.sibling.return=o.return,o=o.sibling}}return!0}function na(a,o,d,m){o&=~rh,o&=~Ma,a.suspendedLanes|=o,a.pingedLanes&=~o,m&&(a.warmLanes|=o),m=a.expirationTimes;for(var y=o;0<y;){var b=31-Et(y),R=1<<b;m[b]=-1,y&=~R}d!==0&&Mi(a,d,o)}function nc(){return(pt&6)===0?(Cl(0),!1):!0}function dh(){if(rt!==null){if(vt===0)var a=rt.return;else a=rt,gn=La=null,Rd(a),hr=null,hl=0,a=rt;for(;a!==null;)zg(a.alternate,a),a=a.return;rt=null}}function Tr(a,o){var d=a.timeoutHandle;d!==-1&&(a.timeoutHandle=-1,wE(d)),d=a.cancelPendingCommit,d!==null&&(a.cancelPendingCommit=null,d()),Rn=0,dh(),wt=a,rt=d=mn(a.current,null),ot=o,vt=0,oi=null,ea=!1,xr=cs(a,o),ah=!1,Sr=ci=rh=Ma=ta=qt=0,Ks=Ll=null,lh=!1,(o&8)!==0&&(o|=o&32);var m=a.entangledLanes;if(m!==0)for(a=a.entanglements,m&=o;0<m;){var y=31-Et(m),b=1<<y;o|=a[y],m&=~b}return _n=o,Io(),d}function p0(a,o){Je=null,D.H=Sl,o===dr||o===ko?(o=Op(),vt=3):o===pd?(o=Op(),vt=4):vt=o===Gd?8:o!==null&&typeof o=="object"&&typeof o.then=="function"?6:1,oi=o,rt===null&&(qt=1,Yo(a,Ei(o,a.current)))}function g0(){var a=ri.current;return a===null?!0:(ot&4194048)===ot?Ri===null:(ot&62914560)===ot||(ot&536870912)!==0?a===Ri:!1}function v0(){var a=D.H;return D.H=Sl,a===null?Sl:a}function y0(){var a=D.A;return D.A=lE,a}function ac(){qt=4,ea||(ot&4194048)!==ot&&ri.current!==null||(xr=!0),(ta&134217727)===0&&(Ma&134217727)===0||wt===null||na(wt,ot,ci,!1)}function hh(a,o,d){var m=pt;pt|=2;var y=v0(),b=y0();(wt!==a||ot!==o)&&(ic=null,Tr(a,o)),o=!1;var R=qt;e:do try{if(vt!==0&&rt!==null){var N=rt,B=oi;switch(vt){case 8:dh(),R=6;break e;case 3:case 2:case 9:case 6:ri.current===null&&(o=!0);var X=vt;if(vt=0,oi=null,Er(a,N,B,X),d&&xr){R=0;break e}break;default:X=vt,vt=0,oi=null,Er(a,N,B,X)}}uE(),R=qt;break}catch(re){p0(a,re)}while(!0);return o&&a.shellSuspendCounter++,gn=La=null,pt=m,D.H=y,D.A=b,rt===null&&(wt=null,ot=0,Io()),R}function uE(){for(;rt!==null;)x0(rt)}function dE(a,o){var d=pt;pt|=2;var m=v0(),y=y0();wt!==a||ot!==o?(ic=null,sc=st()+500,Tr(a,o)):xr=cs(a,o);e:do try{if(vt!==0&&rt!==null){o=rt;var b=oi;t:switch(vt){case 1:vt=0,oi=null,Er(a,o,b,1);break;case 2:case 9:if(wp(b)){vt=0,oi=null,S0(o);break}o=function(){vt!==2&&vt!==9||wt!==a||(vt=7),Wi(a)},b.then(o,o);break e;case 3:vt=7;break e;case 4:vt=5;break e;case 7:wp(b)?(vt=0,oi=null,S0(o)):(vt=0,oi=null,Er(a,o,b,7));break;case 5:var R=null;switch(rt.tag){case 26:R=rt.memoizedState;case 5:case 27:var N=rt;if(R?av(R):N.stateNode.complete){vt=0,oi=null;var B=N.sibling;if(B!==null)rt=B;else{var X=N.return;X!==null?(rt=X,rc(X)):rt=null}break t}}vt=0,oi=null,Er(a,o,b,5);break;case 6:vt=0,oi=null,Er(a,o,b,6);break;case 8:dh(),qt=6;break e;default:throw Error(s(462))}}hE();break}catch(re){p0(a,re)}while(!0);return gn=La=null,D.H=m,D.A=y,pt=d,rt!==null?0:(wt=null,ot=0,Io(),qt)}function hE(){for(;rt!==null&&!De();)x0(rt)}function x0(a){var o=Gg(a.alternate,a,_n);a.memoizedProps=a.pendingProps,o===null?rc(a):rt=o}function S0(a){var o=a,d=o.alternate;switch(o.tag){case 15:case 0:o=Mg(d,o,o.pendingProps,o.type,void 0,ot);break;case 11:o=Mg(d,o,o.pendingProps,o.type.render,o.ref,ot);break;case 5:Rd(o);default:zg(d,o),o=rt=yp(o,_n),o=Gg(d,o,_n)}a.memoizedProps=a.pendingProps,o===null?rc(a):rt=o}function Er(a,o,d,m){gn=La=null,Rd(o),hr=null,hl=0;var y=o.return;try{if(eE(a,y,o,d,ot)){qt=1,Yo(a,Ei(d,a.current)),rt=null;return}}catch(b){if(y!==null)throw rt=y,b;qt=1,Yo(a,Ei(d,a.current)),rt=null;return}o.flags&32768?(ut||m===1?a=!0:xr||(ot&536870912)!==0?a=!1:(ea=a=!0,(m===2||m===9||m===3||m===6)&&(m=ri.current,m!==null&&m.tag===13&&(m.flags|=16384))),b0(o,a)):rc(o)}function rc(a){var o=a;do{if((o.flags&32768)!==0){b0(o,ea);return}a=o.return;var d=iE(o.alternate,o,_n);if(d!==null){rt=d;return}if(o=o.sibling,o!==null){rt=o;return}rt=o=a}while(o!==null);qt===0&&(qt=5)}function b0(a,o){do{var d=nE(a.alternate,a);if(d!==null){d.flags&=32767,rt=d;return}if(d=a.return,d!==null&&(d.flags|=32768,d.subtreeFlags=0,d.deletions=null),!o&&(a=a.sibling,a!==null)){rt=a;return}rt=a=d}while(a!==null);qt=6,rt=null}function T0(a,o,d,m,y,b,R,N,B){a.cancelPendingCommit=null;do lc();while(us!==0);if((pt&6)!==0)throw Error(s(327));if(o!==null){if(o===a.current)throw Error(s(177));if(b=o.lanes|o.childLanes,b|=ed,Ui(a,d,b,R,N,B),a===wt&&(rt=wt=null,ot=0),br=o,ia=a,Rn=d,oh=b,ch=y,d0=m,(o.subtreeFlags&10256)!==0||(o.flags&10256)!==0?(a.callbackNode=null,a.callbackPriority=0,gE(xs,function(){return R0(),null})):(a.callbackNode=null,a.callbackPriority=0),m=(o.flags&13878)!==0,(o.subtreeFlags&13878)!==0||m){m=D.T,D.T=null,y=G.p,G.p=2,R=pt,pt|=4;try{aE(a,o,d)}finally{pt=R,G.p=y,D.T=m}}us=1,E0(),A0(),I0()}}function E0(){if(us===1){us=0;var a=ia,o=br,d=(o.flags&13878)!==0;if((o.subtreeFlags&13878)!==0||d){d=D.T,D.T=null;var m=G.p;G.p=2;var y=pt;pt|=4;try{i0(o,a);var b=Ah,R=cp(a.containerInfo),N=b.focusedElem,B=b.selectionRange;if(R!==N&&N&&N.ownerDocument&&op(N.ownerDocument.documentElement,N)){if(B!==null&&Qu(N)){var X=B.start,re=B.end;if(re===void 0&&(re=X),"selectionStart"in N)N.selectionStart=X,N.selectionEnd=Math.min(re,N.value.length);else{var fe=N.ownerDocument||document,J=fe&&fe.defaultView||window;if(J.getSelection){var ne=J.getSelection(),Ue=N.textContent.length,Ge=Math.min(B.start,Ue),Rt=B.end===void 0?Ge:Math.min(B.end,Ue);!ne.extend&&Ge>Rt&&(R=Rt,Rt=Ge,Ge=R);var z=lp(N,Ge),$=lp(N,Rt);if(z&&$&&(ne.rangeCount!==1||ne.anchorNode!==z.node||ne.anchorOffset!==z.offset||ne.focusNode!==$.node||ne.focusOffset!==$.offset)){var W=fe.createRange();W.setStart(z.node,z.offset),ne.removeAllRanges(),Ge>Rt?(ne.addRange(W),ne.extend($.node,$.offset)):(W.setEnd($.node,$.offset),ne.addRange(W))}}}}for(fe=[],ne=N;ne=ne.parentNode;)ne.nodeType===1&&fe.push({element:ne,left:ne.scrollLeft,top:ne.scrollTop});for(typeof N.focus=="function"&&N.focus(),N=0;N<fe.length;N++){var de=fe[N];de.element.scrollLeft=de.left,de.element.scrollTop=de.top}}xc=!!Eh,Ah=Eh=null}finally{pt=y,G.p=m,D.T=d}}a.current=o,us=2}}function A0(){if(us===2){us=0;var a=ia,o=br,d=(o.flags&8772)!==0;if((o.subtreeFlags&8772)!==0||d){d=D.T,D.T=null;var m=G.p;G.p=2;var y=pt;pt|=4;try{Zg(a,o.alternate,o)}finally{pt=y,G.p=m,D.T=d}}us=3}}function I0(){if(us===4||us===3){us=0,at();var a=ia,o=br,d=Rn,m=d0;(o.subtreeFlags&10256)!==0||(o.flags&10256)!==0?us=5:(us=0,br=ia=null,_0(a,a.pendingLanes));var y=a.pendingLanes;if(y===0&&(sa=null),Xe(d),o=o.stateNode,Vt&&typeof Vt.onCommitFiberRoot=="function")try{Vt.onCommitFiberRoot(bs,o,void 0,(o.current.flags&128)===128)}catch{}if(m!==null){o=D.T,y=G.p,G.p=2,D.T=null;try{for(var b=a.onRecoverableError,R=0;R<m.length;R++){var N=m[R];b(N.value,{componentStack:N.stack})}}finally{D.T=o,G.p=y}}(Rn&3)!==0&&lc(),Wi(a),y=a.pendingLanes,(d&261930)!==0&&(y&42)!==0?a===uh?wl++:(wl=0,uh=a):wl=0,Cl(0)}}function _0(a,o){(a.pooledCacheLanes&=o)===0&&(o=a.pooledCache,o!=null&&(a.pooledCache=null,ul(o)))}function lc(){return E0(),A0(),I0(),R0()}function R0(){if(us!==5)return!1;var a=ia,o=oh;oh=0;var d=Xe(Rn),m=D.T,y=G.p;try{G.p=32>d?32:d,D.T=null,d=ch,ch=null;var b=ia,R=Rn;if(us=0,br=ia=null,Rn=0,(pt&6)!==0)throw Error(s(331));var N=pt;if(pt|=4,o0(b.current),a0(b,b.current,R,d),pt=N,Cl(0,!1),Vt&&typeof Vt.onPostCommitFiberRoot=="function")try{Vt.onPostCommitFiberRoot(bs,b)}catch{}return!0}finally{G.p=y,D.T=m,_0(a,o)}}function L0(a,o,d){o=Ei(d,o),o=$d(a.stateNode,o,2),a=Wn(a,o,2),a!==null&&(Nt(a,2),Wi(a))}function yt(a,o,d){if(a.tag===3)L0(a,a,d);else for(;o!==null;){if(o.tag===3){L0(o,a,d);break}else if(o.tag===1){var m=o.stateNode;if(typeof o.type.getDerivedStateFromError=="function"||typeof m.componentDidCatch=="function"&&(sa===null||!sa.has(m))){a=Ei(d,a),d=wg(2),m=Wn(o,d,2),m!==null&&(Cg(d,m,o,a),Nt(m,2),Wi(m));break}}o=o.return}}function fh(a,o,d){var m=a.pingCache;if(m===null){m=a.pingCache=new oE;var y=new Set;m.set(o,y)}else y=m.get(o),y===void 0&&(y=new Set,m.set(o,y));y.has(d)||(ah=!0,y.add(d),a=fE.bind(null,a,o,d),o.then(a,a))}function fE(a,o,d){var m=a.pingCache;m!==null&&m.delete(o),a.pingedLanes|=a.suspendedLanes&d,a.warmLanes&=~d,wt===a&&(ot&d)===d&&(qt===4||qt===3&&(ot&62914560)===ot&&300>st()-tc?(pt&2)===0&&Tr(a,0):rh|=d,Sr===ot&&(Sr=0)),Wi(a)}function w0(a,o){o===0&&(o=Si()),a=Ia(a,o),a!==null&&(Nt(a,o),Wi(a))}function mE(a){var o=a.memoizedState,d=0;o!==null&&(d=o.retryLane),w0(a,d)}function pE(a,o){var d=0;switch(a.tag){case 31:case 13:var m=a.stateNode,y=a.memoizedState;y!==null&&(d=y.retryLane);break;case 19:m=a.stateNode;break;case 22:m=a.stateNode._retryCache;break;default:throw Error(s(314))}m!==null&&m.delete(o),w0(a,d)}function gE(a,o){return ge(a,o)}var oc=null,Ar=null,mh=!1,cc=!1,ph=!1,aa=0;function Wi(a){a!==Ar&&a.next===null&&(Ar===null?oc=Ar=a:Ar=Ar.next=a),cc=!0,mh||(mh=!0,yE())}function Cl(a,o){if(!ph&&cc){ph=!0;do for(var d=!1,m=oc;m!==null;){if(a!==0){var y=m.pendingLanes;if(y===0)var b=0;else{var R=m.suspendedLanes,N=m.pingedLanes;b=(1<<31-Et(42|a)+1)-1,b&=y&~(R&~N),b=b&201326741?b&201326741|1:b?b|2:0}b!==0&&(d=!0,k0(m,b))}else b=ot,b=Ms(m,m===wt?b:0,m.cancelPendingCommit!==null||m.timeoutHandle!==-1),(b&3)===0||cs(m,b)||(d=!0,k0(m,b));m=m.next}while(d);ph=!1}}function vE(){C0()}function C0(){cc=mh=!1;var a=0;aa!==0&&LE()&&(a=aa);for(var o=st(),d=null,m=oc;m!==null;){var y=m.next,b=O0(m,o);b===0?(m.next=null,d===null?oc=y:d.next=y,y===null&&(Ar=d)):(d=m,(a!==0||(b&3)!==0)&&(cc=!0)),m=y}us!==0&&us!==5||Cl(a),aa!==0&&(aa=0)}function O0(a,o){for(var d=a.suspendedLanes,m=a.pingedLanes,y=a.expirationTimes,b=a.pendingLanes&-62914561;0<b;){var R=31-Et(b),N=1<<R,B=y[R];B===-1?((N&d)===0||(N&m)!==0)&&(y[R]=Vs(N,o)):B<=o&&(a.expiredLanes|=N),b&=~N}if(o=wt,d=ot,d=Ms(a,a===o?d:0,a.cancelPendingCommit!==null||a.timeoutHandle!==-1),m=a.callbackNode,d===0||a===o&&(vt===2||vt===9)||a.cancelPendingCommit!==null)return m!==null&&m!==null&&_e(m),a.callbackNode=null,a.callbackPriority=0;if((d&3)===0||cs(a,d)){if(o=d&-d,o===a.callbackPriority)return o;switch(m!==null&&_e(m),Xe(d)){case 2:case 8:d=ys;break;case 32:d=xs;break;case 268435456:d=Cs;break;default:d=xs}return m=N0.bind(null,a),d=ge(d,m),a.callbackPriority=o,a.callbackNode=d,o}return m!==null&&m!==null&&_e(m),a.callbackPriority=2,a.callbackNode=null,2}function N0(a,o){if(us!==0&&us!==5)return a.callbackNode=null,a.callbackPriority=0,null;var d=a.callbackNode;if(lc()&&a.callbackNode!==d)return null;var m=ot;return m=Ms(a,a===wt?m:0,a.cancelPendingCommit!==null||a.timeoutHandle!==-1),m===0?null:(f0(a,m,o),O0(a,st()),a.callbackNode!=null&&a.callbackNode===d?N0.bind(null,a):null)}function k0(a,o){if(lc())return null;f0(a,o,!0)}function yE(){CE(function(){(pt&6)!==0?ge(ts,vE):C0()})}function gh(){if(aa===0){var a=cr;a===0&&(a=ms,ms<<=1,(ms&261888)===0&&(ms=256)),aa=a}return aa}function D0(a){return a==null||typeof a=="symbol"||typeof a=="boolean"?null:typeof a=="function"?a:vo(""+a)}function P0(a,o){var d=o.ownerDocument.createElement("input");return d.name=o.name,d.value=o.value,a.id&&d.setAttribute("form",a.id),o.parentNode.insertBefore(d,o),a=new FormData(a),d.parentNode.removeChild(d),a}function xE(a,o,d,m,y){if(o==="submit"&&d&&d.stateNode===y){var b=D0((y[At]||null).action),R=m.submitter;R&&(o=(o=R[At]||null)?D0(o.formAction):R.getAttribute("formAction"),o!==null&&(b=o,R=null));var N=new bo("action","action",null,m,y);a.push({event:N,listeners:[{instance:null,listener:function(){if(m.defaultPrevented){if(aa!==0){var B=R?P0(y,R):new FormData(y);Ud(d,{pending:!0,data:B,method:y.method,action:b},null,B)}}else typeof b=="function"&&(N.preventDefault(),B=R?P0(y,R):new FormData(y),Ud(d,{pending:!0,data:B,method:y.method,action:b},b,B))},currentTarget:y}]})}}for(var vh=0;vh<Ju.length;vh++){var yh=Ju[vh],SE=yh.toLowerCase(),bE=yh[0].toUpperCase()+yh.slice(1);Fi(SE,"on"+bE)}Fi(hp,"onAnimationEnd"),Fi(fp,"onAnimationIteration"),Fi(mp,"onAnimationStart"),Fi("dblclick","onDoubleClick"),Fi("focusin","onFocus"),Fi("focusout","onBlur"),Fi(MT,"onTransitionRun"),Fi(jT,"onTransitionStart"),Fi(FT,"onTransitionCancel"),Fi(pp,"onTransitionEnd"),Fn("onMouseEnter",["mouseout","mouseover"]),Fn("onMouseLeave",["mouseout","mouseover"]),Fn("onPointerEnter",["pointerout","pointerover"]),Fn("onPointerLeave",["pointerout","pointerover"]),ji("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),ji("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),ji("onBeforeInput",["compositionend","keypress","textInput","paste"]),ji("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),ji("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),ji("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ol="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),TE=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Ol));function U0(a,o){o=(o&4)!==0;for(var d=0;d<a.length;d++){var m=a[d],y=m.event;m=m.listeners;e:{var b=void 0;if(o)for(var R=m.length-1;0<=R;R--){var N=m[R],B=N.instance,X=N.currentTarget;if(N=N.listener,B!==b&&y.isPropagationStopped())break e;b=N,y.currentTarget=X;try{b(y)}catch(re){Ao(re)}y.currentTarget=null,b=B}else for(R=0;R<m.length;R++){if(N=m[R],B=N.instance,X=N.currentTarget,N=N.listener,B!==b&&y.isPropagationStopped())break e;b=N,y.currentTarget=X;try{b(y)}catch(re){Ao(re)}y.currentTarget=null,b=B}}}}function lt(a,o){var d=o[Sa];d===void 0&&(d=o[Sa]=new Set);var m=a+"__bubble";d.has(m)||(M0(o,a,2,!1),d.add(m))}function xh(a,o,d){var m=0;o&&(m|=4),M0(d,a,m,o)}var uc="_reactListening"+Math.random().toString(36).slice(2);function Sh(a){if(!a[uc]){a[uc]=!0,fo.forEach(function(d){d!=="selectionchange"&&(TE.has(d)||xh(d,!1,a),xh(d,!0,a))});var o=a.nodeType===9?a:a.ownerDocument;o===null||o[uc]||(o[uc]=!0,xh("selectionchange",!1,o))}}function M0(a,o,d,m){switch(hv(o)){case 2:var y=WE;break;case 8:y=XE;break;default:y=Ph}d=y.bind(null,o,d,a),y=void 0,!Bu||o!=="touchstart"&&o!=="touchmove"&&o!=="wheel"||(y=!0),m?y!==void 0?a.addEventListener(o,d,{capture:!0,passive:y}):a.addEventListener(o,d,!0):y!==void 0?a.addEventListener(o,d,{passive:y}):a.addEventListener(o,d,!1)}function bh(a,o,d,m,y){var b=m;if((o&1)===0&&(o&2)===0&&m!==null)e:for(;;){if(m===null)return;var R=m.tag;if(R===3||R===4){var N=m.stateNode.containerInfo;if(N===y)break;if(R===4)for(R=m.return;R!==null;){var B=R.tag;if((B===3||B===4)&&R.stateNode.containerInfo===y)return;R=R.return}for(;N!==null;){if(R=dn(N),R===null)return;if(B=R.tag,B===5||B===6||B===26||B===27){m=b=R;continue e}N=N.parentNode}}m=m.return}$m(function(){var X=b,re=ju(d),fe=[];e:{var J=gp.get(a);if(J!==void 0){var ne=bo,Ue=a;switch(a){case"keypress":if(xo(d)===0)break e;case"keydown":case"keyup":ne=pT;break;case"focusin":Ue="focus",ne=Hu;break;case"focusout":Ue="blur",ne=Hu;break;case"beforeblur":case"afterblur":ne=Hu;break;case"click":if(d.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ne=zm;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ne=iT;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ne=yT;break;case hp:case fp:case mp:ne=rT;break;case pp:ne=ST;break;case"scroll":case"scrollend":ne=tT;break;case"wheel":ne=TT;break;case"copy":case"cut":case"paste":ne=oT;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ne=Ym;break;case"toggle":case"beforetoggle":ne=AT}var Ge=(o&4)!==0,Rt=!Ge&&(a==="scroll"||a==="scrollend"),z=Ge?J!==null?J+"Capture":null:J;Ge=[];for(var $=X,W;$!==null;){var de=$;if(W=de.stateNode,de=de.tag,de!==5&&de!==26&&de!==27||W===null||z===null||(de=Jr($,z),de!=null&&Ge.push(Nl($,de,W))),Rt)break;$=$.return}0<Ge.length&&(J=new ne(J,Ue,null,d,re),fe.push({event:J,listeners:Ge}))}}if((o&7)===0){e:{if(J=a==="mouseover"||a==="pointerover",ne=a==="mouseout"||a==="pointerout",J&&d!==Mu&&(Ue=d.relatedTarget||d.fromElement)&&(dn(Ue)||Ue[un]))break e;if((ne||J)&&(J=re.window===re?re:(J=re.ownerDocument)?J.defaultView||J.parentWindow:window,ne?(Ue=d.relatedTarget||d.toElement,ne=X,Ue=Ue?dn(Ue):null,Ue!==null&&(Rt=r(Ue),Ge=Ue.tag,Ue!==Rt||Ge!==5&&Ge!==27&&Ge!==6)&&(Ue=null)):(ne=null,Ue=X),ne!==Ue)){if(Ge=zm,de="onMouseLeave",z="onMouseEnter",$="mouse",(a==="pointerout"||a==="pointerover")&&(Ge=Ym,de="onPointerLeave",z="onPointerEnter",$="pointer"),Rt=ne==null?J:ba(ne),W=Ue==null?J:ba(Ue),J=new Ge(de,$+"leave",ne,d,re),J.target=Rt,J.relatedTarget=W,de=null,dn(re)===X&&(Ge=new Ge(z,$+"enter",Ue,d,re),Ge.target=W,Ge.relatedTarget=Rt,de=Ge),Rt=de,ne&&Ue)t:{for(Ge=EE,z=ne,$=Ue,W=0,de=z;de;de=Ge(de))W++;de=0;for(var $e=$;$e;$e=Ge($e))de++;for(;0<W-de;)z=Ge(z),W--;for(;0<de-W;)$=Ge($),de--;for(;W--;){if(z===$||$!==null&&z===$.alternate){Ge=z;break t}z=Ge(z),$=Ge($)}Ge=null}else Ge=null;ne!==null&&j0(fe,J,ne,Ge,!1),Ue!==null&&Rt!==null&&j0(fe,Rt,Ue,Ge,!0)}}e:{if(J=X?ba(X):window,ne=J.nodeName&&J.nodeName.toLowerCase(),ne==="select"||ne==="input"&&J.type==="file")var ft=tp;else if(Jm(J))if(sp)ft=DT;else{ft=NT;var je=OT}else ne=J.nodeName,!ne||ne.toLowerCase()!=="input"||J.type!=="checkbox"&&J.type!=="radio"?X&&Uu(X.elementType)&&(ft=tp):ft=kT;if(ft&&(ft=ft(a,X))){ep(fe,ft,d,re);break e}je&&je(a,J,X),a==="focusout"&&X&&J.type==="number"&&X.memoizedProps.value!=null&&Xa(J,"number",J.value)}switch(je=X?ba(X):window,a){case"focusin":(Jm(je)||je.contentEditable==="true")&&(tr=je,Wu=X,ll=null);break;case"focusout":ll=Wu=tr=null;break;case"mousedown":Xu=!0;break;case"contextmenu":case"mouseup":case"dragend":Xu=!1,up(fe,d,re);break;case"selectionchange":if(UT)break;case"keydown":case"keyup":up(fe,d,re)}var et;if(Ku)e:{switch(a){case"compositionstart":var ct="onCompositionStart";break e;case"compositionend":ct="onCompositionEnd";break e;case"compositionupdate":ct="onCompositionUpdate";break e}ct=void 0}else er?Xm(a,d)&&(ct="onCompositionEnd"):a==="keydown"&&d.keyCode===229&&(ct="onCompositionStart");ct&&(qm&&d.locale!=="ko"&&(er||ct!=="onCompositionStart"?ct==="onCompositionEnd"&&er&&(et=Gm()):(Gn=re,Vu="value"in Gn?Gn.value:Gn.textContent,er=!0)),je=dc(X,ct),0<je.length&&(ct=new Km(ct,a,null,d,re),fe.push({event:ct,listeners:je}),et?ct.data=et:(et=Zm(d),et!==null&&(ct.data=et)))),(et=_T?RT(a,d):LT(a,d))&&(ct=dc(X,"onBeforeInput"),0<ct.length&&(je=new Km("onBeforeInput","beforeinput",null,d,re),fe.push({event:je,listeners:ct}),je.data=et)),xE(fe,a,X,d,re)}U0(fe,o)})}function Nl(a,o,d){return{instance:a,listener:o,currentTarget:d}}function dc(a,o){for(var d=o+"Capture",m=[];a!==null;){var y=a,b=y.stateNode;if(y=y.tag,y!==5&&y!==26&&y!==27||b===null||(y=Jr(a,d),y!=null&&m.unshift(Nl(a,y,b)),y=Jr(a,o),y!=null&&m.push(Nl(a,y,b))),a.tag===3)return m;a=a.return}return[]}function EE(a){if(a===null)return null;do a=a.return;while(a&&a.tag!==5&&a.tag!==27);return a||null}function j0(a,o,d,m,y){for(var b=o._reactName,R=[];d!==null&&d!==m;){var N=d,B=N.alternate,X=N.stateNode;if(N=N.tag,B!==null&&B===m)break;N!==5&&N!==26&&N!==27||X===null||(B=X,y?(X=Jr(d,b),X!=null&&R.unshift(Nl(d,X,B))):y||(X=Jr(d,b),X!=null&&R.push(Nl(d,X,B)))),d=d.return}R.length!==0&&a.push({event:o,listeners:R})}var AE=/\r\n?/g,IE=/\u0000|\uFFFD/g;function F0(a){return(typeof a=="string"?a:""+a).replace(AE,`
`).replace(IE,"")}function B0(a,o){return o=F0(o),F0(a)===o}function _t(a,o,d,m,y,b){switch(d){case"children":typeof m=="string"?o==="body"||o==="textarea"&&m===""||$n(a,m):(typeof m=="number"||typeof m=="bigint")&&o!=="body"&&$n(a,""+m);break;case"className":Wa(a,"class",m);break;case"tabIndex":Wa(a,"tabindex",m);break;case"dir":case"role":case"viewBox":case"width":case"height":Wa(a,d,m);break;case"style":Bm(a,m,b);break;case"data":if(o!=="object"){Wa(a,"data",m);break}case"src":case"href":if(m===""&&(o!=="a"||d!=="href")){a.removeAttribute(d);break}if(m==null||typeof m=="function"||typeof m=="symbol"||typeof m=="boolean"){a.removeAttribute(d);break}m=vo(""+m),a.setAttribute(d,m);break;case"action":case"formAction":if(typeof m=="function"){a.setAttribute(d,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof b=="function"&&(d==="formAction"?(o!=="input"&&_t(a,o,"name",y.name,y,null),_t(a,o,"formEncType",y.formEncType,y,null),_t(a,o,"formMethod",y.formMethod,y,null),_t(a,o,"formTarget",y.formTarget,y,null)):(_t(a,o,"encType",y.encType,y,null),_t(a,o,"method",y.method,y,null),_t(a,o,"target",y.target,y,null)));if(m==null||typeof m=="symbol"||typeof m=="boolean"){a.removeAttribute(d);break}m=vo(""+m),a.setAttribute(d,m);break;case"onClick":m!=null&&(a.onclick=hn);break;case"onScroll":m!=null&&lt("scroll",a);break;case"onScrollEnd":m!=null&&lt("scrollend",a);break;case"dangerouslySetInnerHTML":if(m!=null){if(typeof m!="object"||!("__html"in m))throw Error(s(61));if(d=m.__html,d!=null){if(y.children!=null)throw Error(s(60));a.innerHTML=d}}break;case"multiple":a.multiple=m&&typeof m!="function"&&typeof m!="symbol";break;case"muted":a.muted=m&&typeof m!="function"&&typeof m!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(m==null||typeof m=="function"||typeof m=="boolean"||typeof m=="symbol"){a.removeAttribute("xlink:href");break}d=vo(""+m),a.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",d);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":m!=null&&typeof m!="function"&&typeof m!="symbol"?a.setAttribute(d,""+m):a.removeAttribute(d);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":m&&typeof m!="function"&&typeof m!="symbol"?a.setAttribute(d,""):a.removeAttribute(d);break;case"capture":case"download":m===!0?a.setAttribute(d,""):m!==!1&&m!=null&&typeof m!="function"&&typeof m!="symbol"?a.setAttribute(d,m):a.removeAttribute(d);break;case"cols":case"rows":case"size":case"span":m!=null&&typeof m!="function"&&typeof m!="symbol"&&!isNaN(m)&&1<=m?a.setAttribute(d,m):a.removeAttribute(d);break;case"rowSpan":case"start":m==null||typeof m=="function"||typeof m=="symbol"||isNaN(m)?a.removeAttribute(d):a.setAttribute(d,m);break;case"popover":lt("beforetoggle",a),lt("toggle",a),Qa(a,"popover",m);break;case"xlinkActuate":Z(a,"http://www.w3.org/1999/xlink","xlink:actuate",m);break;case"xlinkArcrole":Z(a,"http://www.w3.org/1999/xlink","xlink:arcrole",m);break;case"xlinkRole":Z(a,"http://www.w3.org/1999/xlink","xlink:role",m);break;case"xlinkShow":Z(a,"http://www.w3.org/1999/xlink","xlink:show",m);break;case"xlinkTitle":Z(a,"http://www.w3.org/1999/xlink","xlink:title",m);break;case"xlinkType":Z(a,"http://www.w3.org/1999/xlink","xlink:type",m);break;case"xmlBase":Z(a,"http://www.w3.org/XML/1998/namespace","xml:base",m);break;case"xmlLang":Z(a,"http://www.w3.org/XML/1998/namespace","xml:lang",m);break;case"xmlSpace":Z(a,"http://www.w3.org/XML/1998/namespace","xml:space",m);break;case"is":Qa(a,"is",m);break;case"innerText":case"textContent":break;default:(!(2<d.length)||d[0]!=="o"&&d[0]!=="O"||d[1]!=="n"&&d[1]!=="N")&&(d=Jb.get(d)||d,Qa(a,d,m))}}function Th(a,o,d,m,y,b){switch(d){case"style":Bm(a,m,b);break;case"dangerouslySetInnerHTML":if(m!=null){if(typeof m!="object"||!("__html"in m))throw Error(s(61));if(d=m.__html,d!=null){if(y.children!=null)throw Error(s(60));a.innerHTML=d}}break;case"children":typeof m=="string"?$n(a,m):(typeof m=="number"||typeof m=="bigint")&&$n(a,""+m);break;case"onScroll":m!=null&&lt("scroll",a);break;case"onScrollEnd":m!=null&&lt("scrollend",a);break;case"onClick":m!=null&&(a.onclick=hn);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!qa.hasOwnProperty(d))e:{if(d[0]==="o"&&d[1]==="n"&&(y=d.endsWith("Capture"),o=d.slice(2,y?d.length-7:void 0),b=a[At]||null,b=b!=null?b[d]:null,typeof b=="function"&&a.removeEventListener(o,b,y),typeof m=="function")){typeof b!="function"&&b!==null&&(d in a?a[d]=null:a.hasAttribute(d)&&a.removeAttribute(d)),a.addEventListener(o,m,y);break e}d in a?a[d]=m:m===!0?a.setAttribute(d,""):Qa(a,d,m)}}}function _s(a,o,d){switch(o){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":lt("error",a),lt("load",a);var m=!1,y=!1,b;for(b in d)if(d.hasOwnProperty(b)){var R=d[b];if(R!=null)switch(b){case"src":m=!0;break;case"srcSet":y=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(s(137,o));default:_t(a,o,b,R,d,null)}}y&&_t(a,o,"srcSet",d.srcSet,d,null),m&&_t(a,o,"src",d.src,d,null);return;case"input":lt("invalid",a);var N=b=R=y=null,B=null,X=null;for(m in d)if(d.hasOwnProperty(m)){var re=d[m];if(re!=null)switch(m){case"name":y=re;break;case"type":R=re;break;case"checked":B=re;break;case"defaultChecked":X=re;break;case"value":b=re;break;case"defaultValue":N=re;break;case"children":case"dangerouslySetInnerHTML":if(re!=null)throw Error(s(137,o));break;default:_t(a,o,m,re,d,null)}}Xr(a,b,N,B,X,R,y,!1);return;case"select":lt("invalid",a),m=R=b=null;for(y in d)if(d.hasOwnProperty(y)&&(N=d[y],N!=null))switch(y){case"value":b=N;break;case"defaultValue":R=N;break;case"multiple":m=N;default:_t(a,o,y,N,d,null)}o=b,d=R,a.multiple=!!m,o!=null?Vn(a,!!m,o,!1):d!=null&&Vn(a,!!m,d,!0);return;case"textarea":lt("invalid",a),b=y=m=null;for(R in d)if(d.hasOwnProperty(R)&&(N=d[R],N!=null))switch(R){case"value":m=N;break;case"defaultValue":y=N;break;case"children":b=N;break;case"dangerouslySetInnerHTML":if(N!=null)throw Error(s(91));break;default:_t(a,o,R,N,d,null)}go(a,m,y,b);return;case"option":for(B in d)d.hasOwnProperty(B)&&(m=d[B],m!=null)&&(B==="selected"?a.selected=m&&typeof m!="function"&&typeof m!="symbol":_t(a,o,B,m,d,null));return;case"dialog":lt("beforetoggle",a),lt("toggle",a),lt("cancel",a),lt("close",a);break;case"iframe":case"object":lt("load",a);break;case"video":case"audio":for(m=0;m<Ol.length;m++)lt(Ol[m],a);break;case"image":lt("error",a),lt("load",a);break;case"details":lt("toggle",a);break;case"embed":case"source":case"link":lt("error",a),lt("load",a);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(X in d)if(d.hasOwnProperty(X)&&(m=d[X],m!=null))switch(X){case"children":case"dangerouslySetInnerHTML":throw Error(s(137,o));default:_t(a,o,X,m,d,null)}return;default:if(Uu(o)){for(re in d)d.hasOwnProperty(re)&&(m=d[re],m!==void 0&&Th(a,o,re,m,d,void 0));return}}for(N in d)d.hasOwnProperty(N)&&(m=d[N],m!=null&&_t(a,o,N,m,d,null))}function _E(a,o,d,m){switch(o){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var y=null,b=null,R=null,N=null,B=null,X=null,re=null;for(ne in d){var fe=d[ne];if(d.hasOwnProperty(ne)&&fe!=null)switch(ne){case"checked":break;case"value":break;case"defaultValue":B=fe;default:m.hasOwnProperty(ne)||_t(a,o,ne,null,m,fe)}}for(var J in m){var ne=m[J];if(fe=d[J],m.hasOwnProperty(J)&&(ne!=null||fe!=null))switch(J){case"type":b=ne;break;case"name":y=ne;break;case"checked":X=ne;break;case"defaultChecked":re=ne;break;case"value":R=ne;break;case"defaultValue":N=ne;break;case"children":case"dangerouslySetInnerHTML":if(ne!=null)throw Error(s(137,o));break;default:ne!==fe&&_t(a,o,J,ne,m,fe)}}Os(a,R,N,B,X,re,b,y);return;case"select":ne=R=N=J=null;for(b in d)if(B=d[b],d.hasOwnProperty(b)&&B!=null)switch(b){case"value":break;case"multiple":ne=B;default:m.hasOwnProperty(b)||_t(a,o,b,null,m,B)}for(y in m)if(b=m[y],B=d[y],m.hasOwnProperty(y)&&(b!=null||B!=null))switch(y){case"value":J=b;break;case"defaultValue":N=b;break;case"multiple":R=b;default:b!==B&&_t(a,o,y,b,m,B)}o=N,d=R,m=ne,J!=null?Vn(a,!!d,J,!1):!!m!=!!d&&(o!=null?Vn(a,!!d,o,!0):Vn(a,!!d,d?[]:"",!1));return;case"textarea":ne=J=null;for(N in d)if(y=d[N],d.hasOwnProperty(N)&&y!=null&&!m.hasOwnProperty(N))switch(N){case"value":break;case"children":break;default:_t(a,o,N,null,m,y)}for(R in m)if(y=m[R],b=d[R],m.hasOwnProperty(R)&&(y!=null||b!=null))switch(R){case"value":J=y;break;case"defaultValue":ne=y;break;case"children":break;case"dangerouslySetInnerHTML":if(y!=null)throw Error(s(91));break;default:y!==b&&_t(a,o,R,y,m,b)}Zr(a,J,ne);return;case"option":for(var Ue in d)J=d[Ue],d.hasOwnProperty(Ue)&&J!=null&&!m.hasOwnProperty(Ue)&&(Ue==="selected"?a.selected=!1:_t(a,o,Ue,null,m,J));for(B in m)J=m[B],ne=d[B],m.hasOwnProperty(B)&&J!==ne&&(J!=null||ne!=null)&&(B==="selected"?a.selected=J&&typeof J!="function"&&typeof J!="symbol":_t(a,o,B,J,m,ne));return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Ge in d)J=d[Ge],d.hasOwnProperty(Ge)&&J!=null&&!m.hasOwnProperty(Ge)&&_t(a,o,Ge,null,m,J);for(X in m)if(J=m[X],ne=d[X],m.hasOwnProperty(X)&&J!==ne&&(J!=null||ne!=null))switch(X){case"children":case"dangerouslySetInnerHTML":if(J!=null)throw Error(s(137,o));break;default:_t(a,o,X,J,m,ne)}return;default:if(Uu(o)){for(var Rt in d)J=d[Rt],d.hasOwnProperty(Rt)&&J!==void 0&&!m.hasOwnProperty(Rt)&&Th(a,o,Rt,void 0,m,J);for(re in m)J=m[re],ne=d[re],!m.hasOwnProperty(re)||J===ne||J===void 0&&ne===void 0||Th(a,o,re,J,m,ne);return}}for(var z in d)J=d[z],d.hasOwnProperty(z)&&J!=null&&!m.hasOwnProperty(z)&&_t(a,o,z,null,m,J);for(fe in m)J=m[fe],ne=d[fe],!m.hasOwnProperty(fe)||J===ne||J==null&&ne==null||_t(a,o,fe,J,m,ne)}function V0(a){switch(a){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function RE(){if(typeof performance.getEntriesByType=="function"){for(var a=0,o=0,d=performance.getEntriesByType("resource"),m=0;m<d.length;m++){var y=d[m],b=y.transferSize,R=y.initiatorType,N=y.duration;if(b&&N&&V0(R)){for(R=0,N=y.responseEnd,m+=1;m<d.length;m++){var B=d[m],X=B.startTime;if(X>N)break;var re=B.transferSize,fe=B.initiatorType;re&&V0(fe)&&(B=B.responseEnd,R+=re*(B<N?1:(N-X)/(B-X)))}if(--m,o+=8*(b+R)/(y.duration/1e3),a++,10<a)break}}if(0<a)return o/a/1e6}return navigator.connection&&(a=navigator.connection.downlink,typeof a=="number")?a:5}var Eh=null,Ah=null;function hc(a){return a.nodeType===9?a:a.ownerDocument}function $0(a){switch(a){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function G0(a,o){if(a===0)switch(o){case"svg":return 1;case"math":return 2;default:return 0}return a===1&&o==="foreignObject"?0:a}function Ih(a,o){return a==="textarea"||a==="noscript"||typeof o.children=="string"||typeof o.children=="number"||typeof o.children=="bigint"||typeof o.dangerouslySetInnerHTML=="object"&&o.dangerouslySetInnerHTML!==null&&o.dangerouslySetInnerHTML.__html!=null}var _h=null;function LE(){var a=window.event;return a&&a.type==="popstate"?a===_h?!1:(_h=a,!0):(_h=null,!1)}var H0=typeof setTimeout=="function"?setTimeout:void 0,wE=typeof clearTimeout=="function"?clearTimeout:void 0,z0=typeof Promise=="function"?Promise:void 0,CE=typeof queueMicrotask=="function"?queueMicrotask:typeof z0<"u"?function(a){return z0.resolve(null).then(a).catch(OE)}:H0;function OE(a){setTimeout(function(){throw a})}function ra(a){return a==="head"}function K0(a,o){var d=o,m=0;do{var y=d.nextSibling;if(a.removeChild(d),y&&y.nodeType===8)if(d=y.data,d==="/$"||d==="/&"){if(m===0){a.removeChild(y),Lr(o);return}m--}else if(d==="$"||d==="$?"||d==="$~"||d==="$!"||d==="&")m++;else if(d==="html")kl(a.ownerDocument.documentElement);else if(d==="head"){d=a.ownerDocument.head,kl(d);for(var b=d.firstChild;b;){var R=b.nextSibling,N=b.nodeName;b[ii]||N==="SCRIPT"||N==="STYLE"||N==="LINK"&&b.rel.toLowerCase()==="stylesheet"||d.removeChild(b),b=R}}else d==="body"&&kl(a.ownerDocument.body);d=y}while(d);Lr(o)}function Y0(a,o){var d=a;a=0;do{var m=d.nextSibling;if(d.nodeType===1?o?(d._stashedDisplay=d.style.display,d.style.display="none"):(d.style.display=d._stashedDisplay||"",d.getAttribute("style")===""&&d.removeAttribute("style")):d.nodeType===3&&(o?(d._stashedText=d.nodeValue,d.nodeValue=""):d.nodeValue=d._stashedText||""),m&&m.nodeType===8)if(d=m.data,d==="/$"){if(a===0)break;a--}else d!=="$"&&d!=="$?"&&d!=="$~"&&d!=="$!"||a++;d=m}while(d)}function Rh(a){var o=a.firstChild;for(o&&o.nodeType===10&&(o=o.nextSibling);o;){var d=o;switch(o=o.nextSibling,d.nodeName){case"HTML":case"HEAD":case"BODY":Rh(d),Qr(d);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(d.rel.toLowerCase()==="stylesheet")continue}a.removeChild(d)}}function NE(a,o,d,m){for(;a.nodeType===1;){var y=d;if(a.nodeName.toLowerCase()!==o.toLowerCase()){if(!m&&(a.nodeName!=="INPUT"||a.type!=="hidden"))break}else if(m){if(!a[ii])switch(o){case"meta":if(!a.hasAttribute("itemprop"))break;return a;case"link":if(b=a.getAttribute("rel"),b==="stylesheet"&&a.hasAttribute("data-precedence"))break;if(b!==y.rel||a.getAttribute("href")!==(y.href==null||y.href===""?null:y.href)||a.getAttribute("crossorigin")!==(y.crossOrigin==null?null:y.crossOrigin)||a.getAttribute("title")!==(y.title==null?null:y.title))break;return a;case"style":if(a.hasAttribute("data-precedence"))break;return a;case"script":if(b=a.getAttribute("src"),(b!==(y.src==null?null:y.src)||a.getAttribute("type")!==(y.type==null?null:y.type)||a.getAttribute("crossorigin")!==(y.crossOrigin==null?null:y.crossOrigin))&&b&&a.hasAttribute("async")&&!a.hasAttribute("itemprop"))break;return a;default:return a}}else if(o==="input"&&a.type==="hidden"){var b=y.name==null?null:""+y.name;if(y.type==="hidden"&&a.getAttribute("name")===b)return a}else return a;if(a=Li(a.nextSibling),a===null)break}return null}function kE(a,o,d){if(o==="")return null;for(;a.nodeType!==3;)if((a.nodeType!==1||a.nodeName!=="INPUT"||a.type!=="hidden")&&!d||(a=Li(a.nextSibling),a===null))return null;return a}function q0(a,o){for(;a.nodeType!==8;)if((a.nodeType!==1||a.nodeName!=="INPUT"||a.type!=="hidden")&&!o||(a=Li(a.nextSibling),a===null))return null;return a}function Lh(a){return a.data==="$?"||a.data==="$~"}function wh(a){return a.data==="$!"||a.data==="$?"&&a.ownerDocument.readyState!=="loading"}function DE(a,o){var d=a.ownerDocument;if(a.data==="$~")a._reactRetry=o;else if(a.data!=="$?"||d.readyState!=="loading")o();else{var m=function(){o(),d.removeEventListener("DOMContentLoaded",m)};d.addEventListener("DOMContentLoaded",m),a._reactRetry=m}}function Li(a){for(;a!=null;a=a.nextSibling){var o=a.nodeType;if(o===1||o===3)break;if(o===8){if(o=a.data,o==="$"||o==="$!"||o==="$?"||o==="$~"||o==="&"||o==="F!"||o==="F")break;if(o==="/$"||o==="/&")return null}}return a}var Ch=null;function Q0(a){a=a.nextSibling;for(var o=0;a;){if(a.nodeType===8){var d=a.data;if(d==="/$"||d==="/&"){if(o===0)return Li(a.nextSibling);o--}else d!=="$"&&d!=="$!"&&d!=="$?"&&d!=="$~"&&d!=="&"||o++}a=a.nextSibling}return null}function W0(a){a=a.previousSibling;for(var o=0;a;){if(a.nodeType===8){var d=a.data;if(d==="$"||d==="$!"||d==="$?"||d==="$~"||d==="&"){if(o===0)return a;o--}else d!=="/$"&&d!=="/&"||o++}a=a.previousSibling}return null}function X0(a,o,d){switch(o=hc(d),a){case"html":if(a=o.documentElement,!a)throw Error(s(452));return a;case"head":if(a=o.head,!a)throw Error(s(453));return a;case"body":if(a=o.body,!a)throw Error(s(454));return a;default:throw Error(s(451))}}function kl(a){for(var o=a.attributes;o.length;)a.removeAttributeNode(o[0]);Qr(a)}var wi=new Map,Z0=new Set;function fc(a){return typeof a.getRootNode=="function"?a.getRootNode():a.nodeType===9?a:a.ownerDocument}var Ln=G.d;G.d={f:PE,r:UE,D:ME,C:jE,L:FE,m:BE,X:$E,S:VE,M:GE};function PE(){var a=Ln.f(),o=nc();return a||o}function UE(a){var o=Mn(a);o!==null&&o.tag===5&&o.type==="form"?pg(o):Ln.r(a)}var Ir=typeof document>"u"?null:document;function J0(a,o,d){var m=Ir;if(m&&typeof o=="string"&&o){var y=Kt(o);y='link[rel="'+a+'"][href="'+y+'"]',typeof d=="string"&&(y+='[crossorigin="'+d+'"]'),Z0.has(y)||(Z0.add(y),a={rel:a,crossOrigin:d,href:o},m.querySelector(y)===null&&(o=m.createElement("link"),_s(o,"link",a),is(o),m.head.appendChild(o)))}}function ME(a){Ln.D(a),J0("dns-prefetch",a,null)}function jE(a,o){Ln.C(a,o),J0("preconnect",a,o)}function FE(a,o,d){Ln.L(a,o,d);var m=Ir;if(m&&a&&o){var y='link[rel="preload"][as="'+Kt(o)+'"]';o==="image"&&d&&d.imageSrcSet?(y+='[imagesrcset="'+Kt(d.imageSrcSet)+'"]',typeof d.imageSizes=="string"&&(y+='[imagesizes="'+Kt(d.imageSizes)+'"]')):y+='[href="'+Kt(a)+'"]';var b=y;switch(o){case"style":b=_r(a);break;case"script":b=Rr(a)}wi.has(b)||(a=p({rel:"preload",href:o==="image"&&d&&d.imageSrcSet?void 0:a,as:o},d),wi.set(b,a),m.querySelector(y)!==null||o==="style"&&m.querySelector(Dl(b))||o==="script"&&m.querySelector(Pl(b))||(o=m.createElement("link"),_s(o,"link",a),is(o),m.head.appendChild(o)))}}function BE(a,o){Ln.m(a,o);var d=Ir;if(d&&a){var m=o&&typeof o.as=="string"?o.as:"script",y='link[rel="modulepreload"][as="'+Kt(m)+'"][href="'+Kt(a)+'"]',b=y;switch(m){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":b=Rr(a)}if(!wi.has(b)&&(a=p({rel:"modulepreload",href:a},o),wi.set(b,a),d.querySelector(y)===null)){switch(m){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(d.querySelector(Pl(b)))return}m=d.createElement("link"),_s(m,"link",a),is(m),d.head.appendChild(m)}}}function VE(a,o,d){Ln.S(a,o,d);var m=Ir;if(m&&a){var y=jn(m).hoistableStyles,b=_r(a);o=o||"default";var R=y.get(b);if(!R){var N={loading:0,preload:null};if(R=m.querySelector(Dl(b)))N.loading=5;else{a=p({rel:"stylesheet",href:a,"data-precedence":o},d),(d=wi.get(b))&&Oh(a,d);var B=R=m.createElement("link");is(B),_s(B,"link",a),B._p=new Promise(function(X,re){B.onload=X,B.onerror=re}),B.addEventListener("load",function(){N.loading|=1}),B.addEventListener("error",function(){N.loading|=2}),N.loading|=4,mc(R,o,m)}R={type:"stylesheet",instance:R,count:1,state:N},y.set(b,R)}}}function $E(a,o){Ln.X(a,o);var d=Ir;if(d&&a){var m=jn(d).hoistableScripts,y=Rr(a),b=m.get(y);b||(b=d.querySelector(Pl(y)),b||(a=p({src:a,async:!0},o),(o=wi.get(y))&&Nh(a,o),b=d.createElement("script"),is(b),_s(b,"link",a),d.head.appendChild(b)),b={type:"script",instance:b,count:1,state:null},m.set(y,b))}}function GE(a,o){Ln.M(a,o);var d=Ir;if(d&&a){var m=jn(d).hoistableScripts,y=Rr(a),b=m.get(y);b||(b=d.querySelector(Pl(y)),b||(a=p({src:a,async:!0,type:"module"},o),(o=wi.get(y))&&Nh(a,o),b=d.createElement("script"),is(b),_s(b,"link",a),d.head.appendChild(b)),b={type:"script",instance:b,count:1,state:null},m.set(y,b))}}function ev(a,o,d,m){var y=(y=Ae.current)?fc(y):null;if(!y)throw Error(s(446));switch(a){case"meta":case"title":return null;case"style":return typeof d.precedence=="string"&&typeof d.href=="string"?(o=_r(d.href),d=jn(y).hoistableStyles,m=d.get(o),m||(m={type:"style",instance:null,count:0,state:null},d.set(o,m)),m):{type:"void",instance:null,count:0,state:null};case"link":if(d.rel==="stylesheet"&&typeof d.href=="string"&&typeof d.precedence=="string"){a=_r(d.href);var b=jn(y).hoistableStyles,R=b.get(a);if(R||(y=y.ownerDocument||y,R={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},b.set(a,R),(b=y.querySelector(Dl(a)))&&!b._p&&(R.instance=b,R.state.loading=5),wi.has(a)||(d={rel:"preload",as:"style",href:d.href,crossOrigin:d.crossOrigin,integrity:d.integrity,media:d.media,hrefLang:d.hrefLang,referrerPolicy:d.referrerPolicy},wi.set(a,d),b||HE(y,a,d,R.state))),o&&m===null)throw Error(s(528,""));return R}if(o&&m!==null)throw Error(s(529,""));return null;case"script":return o=d.async,d=d.src,typeof d=="string"&&o&&typeof o!="function"&&typeof o!="symbol"?(o=Rr(d),d=jn(y).hoistableScripts,m=d.get(o),m||(m={type:"script",instance:null,count:0,state:null},d.set(o,m)),m):{type:"void",instance:null,count:0,state:null};default:throw Error(s(444,a))}}function _r(a){return'href="'+Kt(a)+'"'}function Dl(a){return'link[rel="stylesheet"]['+a+"]"}function tv(a){return p({},a,{"data-precedence":a.precedence,precedence:null})}function HE(a,o,d,m){a.querySelector('link[rel="preload"][as="style"]['+o+"]")?m.loading=1:(o=a.createElement("link"),m.preload=o,o.addEventListener("load",function(){return m.loading|=1}),o.addEventListener("error",function(){return m.loading|=2}),_s(o,"link",d),is(o),a.head.appendChild(o))}function Rr(a){return'[src="'+Kt(a)+'"]'}function Pl(a){return"script[async]"+a}function sv(a,o,d){if(o.count++,o.instance===null)switch(o.type){case"style":var m=a.querySelector('style[data-href~="'+Kt(d.href)+'"]');if(m)return o.instance=m,is(m),m;var y=p({},d,{"data-href":d.href,"data-precedence":d.precedence,href:null,precedence:null});return m=(a.ownerDocument||a).createElement("style"),is(m),_s(m,"style",y),mc(m,d.precedence,a),o.instance=m;case"stylesheet":y=_r(d.href);var b=a.querySelector(Dl(y));if(b)return o.state.loading|=4,o.instance=b,is(b),b;m=tv(d),(y=wi.get(y))&&Oh(m,y),b=(a.ownerDocument||a).createElement("link"),is(b);var R=b;return R._p=new Promise(function(N,B){R.onload=N,R.onerror=B}),_s(b,"link",m),o.state.loading|=4,mc(b,d.precedence,a),o.instance=b;case"script":return b=Rr(d.src),(y=a.querySelector(Pl(b)))?(o.instance=y,is(y),y):(m=d,(y=wi.get(b))&&(m=p({},d),Nh(m,y)),a=a.ownerDocument||a,y=a.createElement("script"),is(y),_s(y,"link",m),a.head.appendChild(y),o.instance=y);case"void":return null;default:throw Error(s(443,o.type))}else o.type==="stylesheet"&&(o.state.loading&4)===0&&(m=o.instance,o.state.loading|=4,mc(m,d.precedence,a));return o.instance}function mc(a,o,d){for(var m=d.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),y=m.length?m[m.length-1]:null,b=y,R=0;R<m.length;R++){var N=m[R];if(N.dataset.precedence===o)b=N;else if(b!==y)break}b?b.parentNode.insertBefore(a,b.nextSibling):(o=d.nodeType===9?d.head:d,o.insertBefore(a,o.firstChild))}function Oh(a,o){a.crossOrigin==null&&(a.crossOrigin=o.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=o.referrerPolicy),a.title==null&&(a.title=o.title)}function Nh(a,o){a.crossOrigin==null&&(a.crossOrigin=o.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=o.referrerPolicy),a.integrity==null&&(a.integrity=o.integrity)}var pc=null;function iv(a,o,d){if(pc===null){var m=new Map,y=pc=new Map;y.set(d,m)}else y=pc,m=y.get(d),m||(m=new Map,y.set(d,m));if(m.has(a))return m;for(m.set(a,null),d=d.getElementsByTagName(a),y=0;y<d.length;y++){var b=d[y];if(!(b[ii]||b[gt]||a==="link"&&b.getAttribute("rel")==="stylesheet")&&b.namespaceURI!=="http://www.w3.org/2000/svg"){var R=b.getAttribute(o)||"";R=a+R;var N=m.get(R);N?N.push(b):m.set(R,[b])}}return m}function nv(a,o,d){a=a.ownerDocument||a,a.head.insertBefore(d,o==="title"?a.querySelector("head > title"):null)}function zE(a,o,d){if(d===1||o.itemProp!=null)return!1;switch(a){case"meta":case"title":return!0;case"style":if(typeof o.precedence!="string"||typeof o.href!="string"||o.href==="")break;return!0;case"link":if(typeof o.rel!="string"||typeof o.href!="string"||o.href===""||o.onLoad||o.onError)break;return o.rel==="stylesheet"?(a=o.disabled,typeof o.precedence=="string"&&a==null):!0;case"script":if(o.async&&typeof o.async!="function"&&typeof o.async!="symbol"&&!o.onLoad&&!o.onError&&o.src&&typeof o.src=="string")return!0}return!1}function av(a){return!(a.type==="stylesheet"&&(a.state.loading&3)===0)}function KE(a,o,d,m){if(d.type==="stylesheet"&&(typeof m.media!="string"||matchMedia(m.media).matches!==!1)&&(d.state.loading&4)===0){if(d.instance===null){var y=_r(m.href),b=o.querySelector(Dl(y));if(b){o=b._p,o!==null&&typeof o=="object"&&typeof o.then=="function"&&(a.count++,a=gc.bind(a),o.then(a,a)),d.state.loading|=4,d.instance=b,is(b);return}b=o.ownerDocument||o,m=tv(m),(y=wi.get(y))&&Oh(m,y),b=b.createElement("link"),is(b);var R=b;R._p=new Promise(function(N,B){R.onload=N,R.onerror=B}),_s(b,"link",m),d.instance=b}a.stylesheets===null&&(a.stylesheets=new Map),a.stylesheets.set(d,o),(o=d.state.preload)&&(d.state.loading&3)===0&&(a.count++,d=gc.bind(a),o.addEventListener("load",d),o.addEventListener("error",d))}}var kh=0;function YE(a,o){return a.stylesheets&&a.count===0&&yc(a,a.stylesheets),0<a.count||0<a.imgCount?function(d){var m=setTimeout(function(){if(a.stylesheets&&yc(a,a.stylesheets),a.unsuspend){var b=a.unsuspend;a.unsuspend=null,b()}},6e4+o);0<a.imgBytes&&kh===0&&(kh=62500*RE());var y=setTimeout(function(){if(a.waitingForImages=!1,a.count===0&&(a.stylesheets&&yc(a,a.stylesheets),a.unsuspend)){var b=a.unsuspend;a.unsuspend=null,b()}},(a.imgBytes>kh?50:800)+o);return a.unsuspend=d,function(){a.unsuspend=null,clearTimeout(m),clearTimeout(y)}}:null}function gc(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)yc(this,this.stylesheets);else if(this.unsuspend){var a=this.unsuspend;this.unsuspend=null,a()}}}var vc=null;function yc(a,o){a.stylesheets=null,a.unsuspend!==null&&(a.count++,vc=new Map,o.forEach(qE,a),vc=null,gc.call(a))}function qE(a,o){if(!(o.state.loading&4)){var d=vc.get(a);if(d)var m=d.get(null);else{d=new Map,vc.set(a,d);for(var y=a.querySelectorAll("link[data-precedence],style[data-precedence]"),b=0;b<y.length;b++){var R=y[b];(R.nodeName==="LINK"||R.getAttribute("media")!=="not all")&&(d.set(R.dataset.precedence,R),m=R)}m&&d.set(null,m)}y=o.instance,R=y.getAttribute("data-precedence"),b=d.get(R)||m,b===m&&d.set(null,y),d.set(R,y),this.count++,m=gc.bind(this),y.addEventListener("load",m),y.addEventListener("error",m),b?b.parentNode.insertBefore(y,b.nextSibling):(a=a.nodeType===9?a.head:a,a.insertBefore(y,a.firstChild)),o.state.loading|=4}}var Ul={$$typeof:_,Provider:null,Consumer:null,_currentValue:Y,_currentValue2:Y,_threadCount:0};function QE(a,o,d,m,y,b,R,N,B){this.tag=1,this.containerInfo=a,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=si(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=si(0),this.hiddenUpdates=si(null),this.identifierPrefix=m,this.onUncaughtError=y,this.onCaughtError=b,this.onRecoverableError=R,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=B,this.incompleteTransitions=new Map}function rv(a,o,d,m,y,b,R,N,B,X,re,fe){return a=new QE(a,o,d,R,B,X,re,fe,N),o=1,b===!0&&(o|=24),b=ai(3,null,null,o),a.current=b,b.stateNode=a,o=hd(),o.refCount++,a.pooledCache=o,o.refCount++,b.memoizedState={element:m,isDehydrated:d,cache:o},gd(b),a}function lv(a){return a?(a=nr,a):nr}function ov(a,o,d,m,y,b){y=lv(y),m.context===null?m.context=y:m.pendingContext=y,m=Qn(o),m.payload={element:d},b=b===void 0?null:b,b!==null&&(m.callback=b),d=Wn(a,m,o),d!==null&&(Ys(d,a,o),ml(d,a,o))}function cv(a,o){if(a=a.memoizedState,a!==null&&a.dehydrated!==null){var d=a.retryLane;a.retryLane=d!==0&&d<o?d:o}}function Dh(a,o){cv(a,o),(a=a.alternate)&&cv(a,o)}function uv(a){if(a.tag===13||a.tag===31){var o=Ia(a,67108864);o!==null&&Ys(o,a,67108864),Dh(a,67108864)}}function dv(a){if(a.tag===13||a.tag===31){var o=ui();o=Ne(o);var d=Ia(a,o);d!==null&&Ys(d,a,o),Dh(a,o)}}var xc=!0;function WE(a,o,d,m){var y=D.T;D.T=null;var b=G.p;try{G.p=2,Ph(a,o,d,m)}finally{G.p=b,D.T=y}}function XE(a,o,d,m){var y=D.T;D.T=null;var b=G.p;try{G.p=8,Ph(a,o,d,m)}finally{G.p=b,D.T=y}}function Ph(a,o,d,m){if(xc){var y=Uh(m);if(y===null)bh(a,o,m,Sc,d),fv(a,m);else if(JE(y,a,o,d,m))m.stopPropagation();else if(fv(a,m),o&4&&-1<ZE.indexOf(a)){for(;y!==null;){var b=Mn(y);if(b!==null)switch(b.tag){case 3:if(b=b.stateNode,b.current.memoizedState.isDehydrated){var R=ss(b.pendingLanes);if(R!==0){var N=b;for(N.pendingLanes|=2,N.entangledLanes|=2;R;){var B=1<<31-Et(R);N.entanglements[1]|=B,R&=~B}Wi(b),(pt&6)===0&&(sc=st()+500,Cl(0))}}break;case 31:case 13:N=Ia(b,2),N!==null&&Ys(N,b,2),nc(),Dh(b,2)}if(b=Uh(m),b===null&&bh(a,o,m,Sc,d),b===y)break;y=b}y!==null&&m.stopPropagation()}else bh(a,o,m,null,d)}}function Uh(a){return a=ju(a),Mh(a)}var Sc=null;function Mh(a){if(Sc=null,a=dn(a),a!==null){var o=r(a);if(o===null)a=null;else{var d=o.tag;if(d===13){if(a=l(o),a!==null)return a;a=null}else if(d===31){if(a=c(o),a!==null)return a;a=null}else if(d===3){if(o.stateNode.current.memoizedState.isDehydrated)return o.tag===3?o.stateNode.containerInfo:null;a=null}else o!==a&&(a=null)}}return Sc=a,null}function hv(a){switch(a){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Bt()){case ts:return 2;case ys:return 8;case xs:case Ss:return 32;case Cs:return 268435456;default:return 32}default:return 32}}var jh=!1,la=null,oa=null,ca=null,Ml=new Map,jl=new Map,ua=[],ZE="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function fv(a,o){switch(a){case"focusin":case"focusout":la=null;break;case"dragenter":case"dragleave":oa=null;break;case"mouseover":case"mouseout":ca=null;break;case"pointerover":case"pointerout":Ml.delete(o.pointerId);break;case"gotpointercapture":case"lostpointercapture":jl.delete(o.pointerId)}}function Fl(a,o,d,m,y,b){return a===null||a.nativeEvent!==b?(a={blockedOn:o,domEventName:d,eventSystemFlags:m,nativeEvent:b,targetContainers:[y]},o!==null&&(o=Mn(o),o!==null&&uv(o)),a):(a.eventSystemFlags|=m,o=a.targetContainers,y!==null&&o.indexOf(y)===-1&&o.push(y),a)}function JE(a,o,d,m,y){switch(o){case"focusin":return la=Fl(la,a,o,d,m,y),!0;case"dragenter":return oa=Fl(oa,a,o,d,m,y),!0;case"mouseover":return ca=Fl(ca,a,o,d,m,y),!0;case"pointerover":var b=y.pointerId;return Ml.set(b,Fl(Ml.get(b)||null,a,o,d,m,y)),!0;case"gotpointercapture":return b=y.pointerId,jl.set(b,Fl(jl.get(b)||null,a,o,d,m,y)),!0}return!1}function mv(a){var o=dn(a.target);if(o!==null){var d=r(o);if(d!==null){if(o=d.tag,o===13){if(o=l(d),o!==null){a.blockedOn=o,Ie(a.priority,function(){dv(d)});return}}else if(o===31){if(o=c(d),o!==null){a.blockedOn=o,Ie(a.priority,function(){dv(d)});return}}else if(o===3&&d.stateNode.current.memoizedState.isDehydrated){a.blockedOn=d.tag===3?d.stateNode.containerInfo:null;return}}}a.blockedOn=null}function bc(a){if(a.blockedOn!==null)return!1;for(var o=a.targetContainers;0<o.length;){var d=Uh(a.nativeEvent);if(d===null){d=a.nativeEvent;var m=new d.constructor(d.type,d);Mu=m,d.target.dispatchEvent(m),Mu=null}else return o=Mn(d),o!==null&&uv(o),a.blockedOn=d,!1;o.shift()}return!0}function pv(a,o,d){bc(a)&&d.delete(o)}function eA(){jh=!1,la!==null&&bc(la)&&(la=null),oa!==null&&bc(oa)&&(oa=null),ca!==null&&bc(ca)&&(ca=null),Ml.forEach(pv),jl.forEach(pv)}function Tc(a,o){a.blockedOn===o&&(a.blockedOn=null,jh||(jh=!0,i.unstable_scheduleCallback(i.unstable_NormalPriority,eA)))}var Ec=null;function gv(a){Ec!==a&&(Ec=a,i.unstable_scheduleCallback(i.unstable_NormalPriority,function(){Ec===a&&(Ec=null);for(var o=0;o<a.length;o+=3){var d=a[o],m=a[o+1],y=a[o+2];if(typeof m!="function"){if(Mh(m||d)===null)continue;break}var b=Mn(d);b!==null&&(a.splice(o,3),o-=3,Ud(b,{pending:!0,data:y,method:d.method,action:m},m,y))}}))}function Lr(a){function o(B){return Tc(B,a)}la!==null&&Tc(la,a),oa!==null&&Tc(oa,a),ca!==null&&Tc(ca,a),Ml.forEach(o),jl.forEach(o);for(var d=0;d<ua.length;d++){var m=ua[d];m.blockedOn===a&&(m.blockedOn=null)}for(;0<ua.length&&(d=ua[0],d.blockedOn===null);)mv(d),d.blockedOn===null&&ua.shift();if(d=(a.ownerDocument||a).$$reactFormReplay,d!=null)for(m=0;m<d.length;m+=3){var y=d[m],b=d[m+1],R=y[At]||null;if(typeof b=="function")R||gv(d);else if(R){var N=null;if(b&&b.hasAttribute("formAction")){if(y=b,R=b[At]||null)N=R.formAction;else if(Mh(y)!==null)continue}else N=R.action;typeof N=="function"?d[m+1]=N:(d.splice(m,3),m-=3),gv(d)}}}function vv(){function a(b){b.canIntercept&&b.info==="react-transition"&&b.intercept({handler:function(){return new Promise(function(R){return y=R})},focusReset:"manual",scroll:"manual"})}function o(){y!==null&&(y(),y=null),m||setTimeout(d,20)}function d(){if(!m&&!navigation.transition){var b=navigation.currentEntry;b&&b.url!=null&&navigation.navigate(b.url,{state:b.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var m=!1,y=null;return navigation.addEventListener("navigate",a),navigation.addEventListener("navigatesuccess",o),navigation.addEventListener("navigateerror",o),setTimeout(d,100),function(){m=!0,navigation.removeEventListener("navigate",a),navigation.removeEventListener("navigatesuccess",o),navigation.removeEventListener("navigateerror",o),y!==null&&(y(),y=null)}}}function Fh(a){this._internalRoot=a}Ac.prototype.render=Fh.prototype.render=function(a){var o=this._internalRoot;if(o===null)throw Error(s(409));var d=o.current,m=ui();ov(d,m,a,o,null,null)},Ac.prototype.unmount=Fh.prototype.unmount=function(){var a=this._internalRoot;if(a!==null){this._internalRoot=null;var o=a.containerInfo;ov(a.current,2,null,a,null,null),nc(),o[un]=null}};function Ac(a){this._internalRoot=a}Ac.prototype.unstable_scheduleHydration=function(a){if(a){var o=zt();a={blockedOn:null,target:a,priority:o};for(var d=0;d<ua.length&&o!==0&&o<ua[d].priority;d++);ua.splice(d,0,a),d===0&&mv(a)}};var yv=e.version;if(yv!=="19.2.4")throw Error(s(527,yv,"19.2.4"));G.findDOMNode=function(a){var o=a._reactInternals;if(o===void 0)throw typeof a.render=="function"?Error(s(188)):(a=Object.keys(a).join(","),Error(s(268,a)));return a=u(o),a=a!==null?f(a):null,a=a===null?null:a.stateNode,a};var tA={bundleType:0,version:"19.2.4",rendererPackageName:"react-dom",currentDispatcherRef:D,reconcilerVersion:"19.2.4"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Ic=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Ic.isDisabled&&Ic.supportsFiber)try{bs=Ic.inject(tA),Vt=Ic}catch{}}return Vl.createRoot=function(a,o){if(!n(a))throw Error(s(299));var d=!1,m="",y=Ig,b=_g,R=Rg;return o!=null&&(o.unstable_strictMode===!0&&(d=!0),o.identifierPrefix!==void 0&&(m=o.identifierPrefix),o.onUncaughtError!==void 0&&(y=o.onUncaughtError),o.onCaughtError!==void 0&&(b=o.onCaughtError),o.onRecoverableError!==void 0&&(R=o.onRecoverableError)),o=rv(a,1,!1,null,null,d,m,null,y,b,R,vv),a[un]=o.current,Sh(a),new Fh(o)},Vl.hydrateRoot=function(a,o,d){if(!n(a))throw Error(s(299));var m=!1,y="",b=Ig,R=_g,N=Rg,B=null;return d!=null&&(d.unstable_strictMode===!0&&(m=!0),d.identifierPrefix!==void 0&&(y=d.identifierPrefix),d.onUncaughtError!==void 0&&(b=d.onUncaughtError),d.onCaughtError!==void 0&&(R=d.onCaughtError),d.onRecoverableError!==void 0&&(N=d.onRecoverableError),d.formState!==void 0&&(B=d.formState)),o=rv(a,1,!0,o,d??null,m,y,B,b,R,N,vv),o.context=lv(null),d=o.current,m=ui(),m=Ne(m),y=Qn(m),y.callback=null,Wn(d,y,m),d=m,o.current.lanes=d,Nt(o,d),Wi(o),a[un]=o.current,Sh(a),new Ac(o)},Vl.version="19.2.4",Vl}var Lv;function hA(){if(Lv)return $h.exports;Lv=1;function i(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(i)}catch(e){console.error(e)}}return i(),$h.exports=dA(),$h.exports}var fA=hA();var wv="popstate";function mA(i={}){function e(n,r){let{pathname:l="/",search:c="",hash:h=""}=Ka(n.location.hash.substring(1));return!l.startsWith("/")&&!l.startsWith(".")&&(l="/"+l),_f("",{pathname:l,search:c,hash:h},r.state&&r.state.usr||null,r.state&&r.state.key||"default")}function t(n,r){let l=n.document.querySelector("base"),c="";if(l&&l.getAttribute("href")){let h=n.location.href,u=h.indexOf("#");c=u===-1?h:h.slice(0,u)}return c+"#"+(typeof r=="string"?r:Ql(r))}function s(n,r){Ni(n.pathname.charAt(0)==="/",`relative pathnames are not supported in hash history.push(${JSON.stringify(r)})`)}return gA(e,t,s,i)}function Ft(i,e){if(i===!1||i===null||typeof i>"u")throw new Error(e)}function Ni(i,e){if(!i){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function pA(){return Math.random().toString(36).substring(2,10)}function Cv(i,e){return{usr:i.state,key:i.key,idx:e}}function _f(i,e,t=null,s){return{pathname:typeof i=="string"?i:i.pathname,search:"",hash:"",...typeof e=="string"?Ka(e):e,state:t,key:e&&e.key||s||pA()}}function Ql({pathname:i="/",search:e="",hash:t=""}){return e&&e!=="?"&&(i+=e.charAt(0)==="?"?e:"?"+e),t&&t!=="#"&&(i+=t.charAt(0)==="#"?t:"#"+t),i}function Ka(i){let e={};if(i){let t=i.indexOf("#");t>=0&&(e.hash=i.substring(t),i=i.substring(0,t));let s=i.indexOf("?");s>=0&&(e.search=i.substring(s),i=i.substring(0,s)),i&&(e.pathname=i)}return e}function gA(i,e,t,s={}){let{window:n=document.defaultView,v5Compat:r=!1}=s,l=n.history,c="POP",h=null,u=f();u==null&&(u=0,l.replaceState({...l.state,idx:u},""));function f(){return(l.state||{idx:null}).idx}function p(){c="POP";let T=f(),A=T==null?null:T-u;u=T,h&&h({action:c,location:E.location,delta:A})}function v(T,A){c="PUSH";let I=_f(E.location,T,A);t&&t(I,T),u=f()+1;let _=Cv(I,u),C=E.createHref(I);try{l.pushState(_,"",C)}catch(k){if(k instanceof DOMException&&k.name==="DataCloneError")throw k;n.location.assign(C)}r&&h&&h({action:c,location:E.location,delta:1})}function x(T,A){c="REPLACE";let I=_f(E.location,T,A);t&&t(I,T),u=f();let _=Cv(I,u),C=E.createHref(I);l.replaceState(_,"",C),r&&h&&h({action:c,location:E.location,delta:0})}function S(T){return vA(T)}let E={get action(){return c},get location(){return i(n,l)},listen(T){if(h)throw new Error("A history only accepts one active listener");return n.addEventListener(wv,p),h=T,()=>{n.removeEventListener(wv,p),h=null}},createHref(T){return e(n,T)},createURL:S,encodeLocation(T){let A=S(T);return{pathname:A.pathname,search:A.search,hash:A.hash}},push:v,replace:x,go(T){return l.go(T)}};return E}function vA(i,e=!1){let t="http://localhost";typeof window<"u"&&(t=window.location.origin!=="null"?window.location.origin:window.location.href),Ft(t,"No window.location.(origin|href) available to create URL");let s=typeof i=="string"?i:Ql(i);return s=s.replace(/ $/,"%20"),!e&&s.startsWith("//")&&(s=t+s),new URL(s,t)}function Cx(i,e,t="/"){return yA(i,e,t,!1)}function yA(i,e,t,s){let n=typeof e=="string"?Ka(e):e,r=Pn(n.pathname||"/",t);if(r==null)return null;let l=Ox(i);xA(l);let c=null;for(let h=0;c==null&&h<l.length;++h){let u=CA(r);c=LA(l[h],u,s)}return c}function Ox(i,e=[],t=[],s="",n=!1){let r=(l,c,h=n,u)=>{let f={relativePath:u===void 0?l.path||"":u,caseSensitive:l.caseSensitive===!0,childrenIndex:c,route:l};if(f.relativePath.startsWith("/")){if(!f.relativePath.startsWith(s)&&h)return;Ft(f.relativePath.startsWith(s),`Absolute route path "${f.relativePath}" nested under path "${s}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),f.relativePath=f.relativePath.slice(s.length)}let p=Dn([s,f.relativePath]),v=t.concat(f);l.children&&l.children.length>0&&(Ft(l.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${p}".`),Ox(l.children,e,v,p,h)),!(l.path==null&&!l.index)&&e.push({path:p,score:_A(p,l.index),routesMeta:v})};return i.forEach((l,c)=>{if(l.path===""||!l.path?.includes("?"))r(l,c);else for(let h of Nx(l.path))r(l,c,!0,h)}),e}function Nx(i){let e=i.split("/");if(e.length===0)return[];let[t,...s]=e,n=t.endsWith("?"),r=t.replace(/\?$/,"");if(s.length===0)return n?[r,""]:[r];let l=Nx(s.join("/")),c=[];return c.push(...l.map(h=>h===""?r:[r,h].join("/"))),n&&c.push(...l),c.map(h=>i.startsWith("/")&&h===""?"/":h)}function xA(i){i.sort((e,t)=>e.score!==t.score?t.score-e.score:RA(e.routesMeta.map(s=>s.childrenIndex),t.routesMeta.map(s=>s.childrenIndex)))}var SA=/^:[\w-]+$/,bA=3,TA=2,EA=1,AA=10,IA=-2,Ov=i=>i==="*";function _A(i,e){let t=i.split("/"),s=t.length;return t.some(Ov)&&(s+=IA),e&&(s+=TA),t.filter(n=>!Ov(n)).reduce((n,r)=>n+(SA.test(r)?bA:r===""?EA:AA),s)}function RA(i,e){return i.length===e.length&&i.slice(0,-1).every((s,n)=>s===e[n])?i[i.length-1]-e[e.length-1]:0}function LA(i,e,t=!1){let{routesMeta:s}=i,n={},r="/",l=[];for(let c=0;c<s.length;++c){let h=s[c],u=c===s.length-1,f=r==="/"?e:e.slice(r.length)||"/",p=ru({path:h.relativePath,caseSensitive:h.caseSensitive,end:u},f),v=h.route;if(!p&&u&&t&&!s[s.length-1].route.index&&(p=ru({path:h.relativePath,caseSensitive:h.caseSensitive,end:!1},f)),!p)return null;Object.assign(n,p.params),l.push({params:n,pathname:Dn([r,p.pathname]),pathnameBase:DA(Dn([r,p.pathnameBase])),route:v}),p.pathnameBase!=="/"&&(r=Dn([r,p.pathnameBase]))}return l}function ru(i,e){typeof i=="string"&&(i={path:i,caseSensitive:!1,end:!0});let[t,s]=wA(i.path,i.caseSensitive,i.end),n=e.match(t);if(!n)return null;let r=n[0],l=r.replace(/(.)\/+$/,"$1"),c=n.slice(1);return{params:s.reduce((u,{paramName:f,isOptional:p},v)=>{if(f==="*"){let S=c[v]||"";l=r.slice(0,r.length-S.length).replace(/(.)\/+$/,"$1")}const x=c[v];return p&&!x?u[f]=void 0:u[f]=(x||"").replace(/%2F/g,"/"),u},{}),pathname:r,pathnameBase:l,pattern:i}}function wA(i,e=!1,t=!0){Ni(i==="*"||!i.endsWith("*")||i.endsWith("/*"),`Route path "${i}" will be treated as if it were "${i.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${i.replace(/\*$/,"/*")}".`);let s=[],n="^"+i.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(l,c,h)=>(s.push({paramName:c,isOptional:h!=null}),h?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return i.endsWith("*")?(s.push({paramName:"*"}),n+=i==="*"||i==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?n+="\\/*$":i!==""&&i!=="/"&&(n+="(?:(?=\\/|$))"),[new RegExp(n,e?void 0:"i"),s]}function CA(i){try{return i.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return Ni(!1,`The URL path "${i}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),i}}function Pn(i,e){if(e==="/")return i;if(!i.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,s=i.charAt(t);return s&&s!=="/"?null:i.slice(t)||"/"}var OA=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i;function NA(i,e="/"){let{pathname:t,search:s="",hash:n=""}=typeof i=="string"?Ka(i):i,r;return t?(t=t.replace(/\/\/+/g,"/"),t.startsWith("/")?r=Nv(t.substring(1),"/"):r=Nv(t,e)):r=e,{pathname:r,search:PA(s),hash:UA(n)}}function Nv(i,e){let t=e.replace(/\/+$/,"").split("/");return i.split("/").forEach(n=>{n===".."?t.length>1&&t.pop():n!=="."&&t.push(n)}),t.length>1?t.join("/"):"/"}function Kh(i,e,t,s){return`Cannot include a '${i}' character in a manually specified \`to.${e}\` field [${JSON.stringify(s)}].  Please separate it out to the \`to.${t}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function kA(i){return i.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function em(i){let e=kA(i);return e.map((t,s)=>s===e.length-1?t.pathname:t.pathnameBase)}function tm(i,e,t,s=!1){let n;typeof i=="string"?n=Ka(i):(n={...i},Ft(!n.pathname||!n.pathname.includes("?"),Kh("?","pathname","search",n)),Ft(!n.pathname||!n.pathname.includes("#"),Kh("#","pathname","hash",n)),Ft(!n.search||!n.search.includes("#"),Kh("#","search","hash",n)));let r=i===""||n.pathname==="",l=r?"/":n.pathname,c;if(l==null)c=t;else{let p=e.length-1;if(!s&&l.startsWith("..")){let v=l.split("/");for(;v[0]==="..";)v.shift(),p-=1;n.pathname=v.join("/")}c=p>=0?e[p]:"/"}let h=NA(n,c),u=l&&l!=="/"&&l.endsWith("/"),f=(r||l===".")&&t.endsWith("/");return!h.pathname.endsWith("/")&&(u||f)&&(h.pathname+="/"),h}var Dn=i=>i.join("/").replace(/\/\/+/g,"/"),DA=i=>i.replace(/\/+$/,"").replace(/^\/*/,"/"),PA=i=>!i||i==="?"?"":i.startsWith("?")?i:"?"+i,UA=i=>!i||i==="#"?"":i.startsWith("#")?i:"#"+i,MA=class{constructor(i,e,t,s=!1){this.status=i,this.statusText=e||"",this.internal=s,t instanceof Error?(this.data=t.toString(),this.error=t):this.data=t}};function jA(i){return i!=null&&typeof i.status=="number"&&typeof i.statusText=="string"&&typeof i.internal=="boolean"&&"data"in i}function FA(i){return i.map(e=>e.route.path).filter(Boolean).join("/").replace(/\/\/*/g,"/")||"/"}var kx=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function Dx(i,e){let t=i;if(typeof t!="string"||!OA.test(t))return{absoluteURL:void 0,isExternal:!1,to:t};let s=t,n=!1;if(kx)try{let r=new URL(window.location.href),l=t.startsWith("//")?new URL(r.protocol+t):new URL(t),c=Pn(l.pathname,e);l.origin===r.origin&&c!=null?t=c+l.search+l.hash:n=!0}catch{Ni(!1,`<Link to="${t}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}return{absoluteURL:s,isExternal:n,to:t}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var Px=["POST","PUT","PATCH","DELETE"];new Set(Px);var BA=["GET",...Px];new Set(BA);var zr=w.createContext(null);zr.displayName="DataRouter";var Tu=w.createContext(null);Tu.displayName="DataRouterState";var VA=w.createContext(!1),Ux=w.createContext({isTransitioning:!1});Ux.displayName="ViewTransition";var $A=w.createContext(new Map);$A.displayName="Fetchers";var GA=w.createContext(null);GA.displayName="Await";var yi=w.createContext(null);yi.displayName="Navigation";var io=w.createContext(null);io.displayName="Location";var Di=w.createContext({outlet:null,matches:[],isDataRoute:!1});Di.displayName="Route";var sm=w.createContext(null);sm.displayName="RouteError";var Mx="REACT_ROUTER_ERROR",HA="REDIRECT",zA="ROUTE_ERROR_RESPONSE";function KA(i){if(i.startsWith(`${Mx}:${HA}:{`))try{let e=JSON.parse(i.slice(28));if(typeof e=="object"&&e&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.location=="string"&&typeof e.reloadDocument=="boolean"&&typeof e.replace=="boolean")return e}catch{}}function YA(i){if(i.startsWith(`${Mx}:${zA}:{`))try{let e=JSON.parse(i.slice(40));if(typeof e=="object"&&e&&typeof e.status=="number"&&typeof e.statusText=="string")return new MA(e.status,e.statusText,e.data)}catch{}}function qA(i,{relative:e}={}){Ft(Kr(),"useHref() may be used only in the context of a <Router> component.");let{basename:t,navigator:s}=w.useContext(yi),{hash:n,pathname:r,search:l}=no(i,{relative:e}),c=r;return t!=="/"&&(c=r==="/"?t:Dn([t,r])),s.createHref({pathname:c,search:l,hash:n})}function Kr(){return w.useContext(io)!=null}function Un(){return Ft(Kr(),"useLocation() may be used only in the context of a <Router> component."),w.useContext(io).location}var jx="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function Fx(i){w.useContext(yi).static||w.useLayoutEffect(i)}function Ps(){let{isDataRoute:i}=w.useContext(Di);return i?cI():QA()}function QA(){Ft(Kr(),"useNavigate() may be used only in the context of a <Router> component.");let i=w.useContext(zr),{basename:e,navigator:t}=w.useContext(yi),{matches:s}=w.useContext(Di),{pathname:n}=Un(),r=JSON.stringify(em(s)),l=w.useRef(!1);return Fx(()=>{l.current=!0}),w.useCallback((h,u={})=>{if(Ni(l.current,jx),!l.current)return;if(typeof h=="number"){t.go(h);return}let f=tm(h,JSON.parse(r),n,u.relative==="path");i==null&&e!=="/"&&(f.pathname=f.pathname==="/"?e:Dn([e,f.pathname])),(u.replace?t.replace:t.push)(f,u.state,u)},[e,t,r,n,i])}var WA=w.createContext(null);function XA(i){let e=w.useContext(Di).outlet;return w.useMemo(()=>e&&w.createElement(WA.Provider,{value:i},e),[e,i])}function Eu(){let{matches:i}=w.useContext(Di),e=i[i.length-1];return e?e.params:{}}function no(i,{relative:e}={}){let{matches:t}=w.useContext(Di),{pathname:s}=Un(),n=JSON.stringify(em(t));return w.useMemo(()=>tm(i,JSON.parse(n),s,e==="path"),[i,n,s,e])}function ZA(i,e){return Bx(i,e)}function Bx(i,e,t,s,n){Ft(Kr(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:r}=w.useContext(yi),{matches:l}=w.useContext(Di),c=l[l.length-1],h=c?c.params:{},u=c?c.pathname:"/",f=c?c.pathnameBase:"/",p=c&&c.route;{let I=p&&p.path||"";$x(u,!p||I.endsWith("*")||I.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${u}" (under <Route path="${I}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${I}"> to <Route path="${I==="/"?"*":`${I}/*`}">.`)}let v=Un(),x;if(e){let I=typeof e=="string"?Ka(e):e;Ft(f==="/"||I.pathname?.startsWith(f),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${f}" but pathname "${I.pathname}" was given in the \`location\` prop.`),x=I}else x=v;let S=x.pathname||"/",E=S;if(f!=="/"){let I=f.replace(/^\//,"").split("/");E="/"+S.replace(/^\//,"").split("/").slice(I.length).join("/")}let T=Cx(i,{pathname:E});Ni(p||T!=null,`No routes matched location "${x.pathname}${x.search}${x.hash}" `),Ni(T==null||T[T.length-1].route.element!==void 0||T[T.length-1].route.Component!==void 0||T[T.length-1].route.lazy!==void 0,`Matched leaf route at location "${x.pathname}${x.search}${x.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let A=iI(T&&T.map(I=>Object.assign({},I,{params:Object.assign({},h,I.params),pathname:Dn([f,r.encodeLocation?r.encodeLocation(I.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:I.pathname]),pathnameBase:I.pathnameBase==="/"?f:Dn([f,r.encodeLocation?r.encodeLocation(I.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:I.pathnameBase])})),l,t,s,n);return e&&A?w.createElement(io.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...x},navigationType:"POP"}},A):A}function JA(){let i=oI(),e=jA(i)?`${i.status} ${i.statusText}`:i instanceof Error?i.message:JSON.stringify(i),t=i instanceof Error?i.stack:null,s="rgba(200,200,200, 0.5)",n={padding:"0.5rem",backgroundColor:s},r={padding:"2px 4px",backgroundColor:s},l=null;return console.error("Error handled by React Router default ErrorBoundary:",i),l=w.createElement(w.Fragment,null,w.createElement("p",null," Hey developer "),w.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",w.createElement("code",{style:r},"ErrorBoundary")," or"," ",w.createElement("code",{style:r},"errorElement")," prop on your route.")),w.createElement(w.Fragment,null,w.createElement("h2",null,"Unexpected Application Error!"),w.createElement("h3",{style:{fontStyle:"italic"}},e),t?w.createElement("pre",{style:n},t):null,l)}var eI=w.createElement(JA,null),Vx=class extends w.Component{constructor(i){super(i),this.state={location:i.location,revalidation:i.revalidation,error:i.error}}static getDerivedStateFromError(i){return{error:i}}static getDerivedStateFromProps(i,e){return e.location!==i.location||e.revalidation!=="idle"&&i.revalidation==="idle"?{error:i.error,location:i.location,revalidation:i.revalidation}:{error:i.error!==void 0?i.error:e.error,location:e.location,revalidation:i.revalidation||e.revalidation}}componentDidCatch(i,e){this.props.onError?this.props.onError(i,e):console.error("React Router caught the following error during render",i)}render(){let i=this.state.error;if(this.context&&typeof i=="object"&&i&&"digest"in i&&typeof i.digest=="string"){const t=YA(i.digest);t&&(i=t)}let e=i!==void 0?w.createElement(Di.Provider,{value:this.props.routeContext},w.createElement(sm.Provider,{value:i,children:this.props.component})):this.props.children;return this.context?w.createElement(tI,{error:i},e):e}};Vx.contextType=VA;var Yh=new WeakMap;function tI({children:i,error:e}){let{basename:t}=w.useContext(yi);if(typeof e=="object"&&e&&"digest"in e&&typeof e.digest=="string"){let s=KA(e.digest);if(s){let n=Yh.get(e);if(n)throw n;let r=Dx(s.location,t);if(kx&&!Yh.get(e))if(r.isExternal||s.reloadDocument)window.location.href=r.absoluteURL||r.to;else{const l=Promise.resolve().then(()=>window.__reactRouterDataRouter.navigate(r.to,{replace:s.replace}));throw Yh.set(e,l),l}return w.createElement("meta",{httpEquiv:"refresh",content:`0;url=${r.absoluteURL||r.to}`})}}return i}function sI({routeContext:i,match:e,children:t}){let s=w.useContext(zr);return s&&s.static&&s.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(s.staticContext._deepestRenderedBoundaryId=e.route.id),w.createElement(Di.Provider,{value:i},t)}function iI(i,e=[],t=null,s=null,n=null){if(i==null){if(!t)return null;if(t.errors)i=t.matches;else if(e.length===0&&!t.initialized&&t.matches.length>0)i=t.matches;else return null}let r=i,l=t?.errors;if(l!=null){let f=r.findIndex(p=>p.route.id&&l?.[p.route.id]!==void 0);Ft(f>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(l).join(",")}`),r=r.slice(0,Math.min(r.length,f+1))}let c=!1,h=-1;if(t)for(let f=0;f<r.length;f++){let p=r[f];if((p.route.HydrateFallback||p.route.hydrateFallbackElement)&&(h=f),p.route.id){let{loaderData:v,errors:x}=t,S=p.route.loader&&!v.hasOwnProperty(p.route.id)&&(!x||x[p.route.id]===void 0);if(p.route.lazy||S){c=!0,h>=0?r=r.slice(0,h+1):r=[r[0]];break}}}let u=t&&s?(f,p)=>{s(f,{location:t.location,params:t.matches?.[0]?.params??{},unstable_pattern:FA(t.matches),errorInfo:p})}:void 0;return r.reduceRight((f,p,v)=>{let x,S=!1,E=null,T=null;t&&(x=l&&p.route.id?l[p.route.id]:void 0,E=p.route.errorElement||eI,c&&(h<0&&v===0?($x("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),S=!0,T=null):h===v&&(S=!0,T=p.route.hydrateFallbackElement||null)));let A=e.concat(r.slice(0,v+1)),I=()=>{let _;return x?_=E:S?_=T:p.route.Component?_=w.createElement(p.route.Component,null):p.route.element?_=p.route.element:_=f,w.createElement(sI,{match:p,routeContext:{outlet:f,matches:A,isDataRoute:t!=null},children:_})};return t&&(p.route.ErrorBoundary||p.route.errorElement||v===0)?w.createElement(Vx,{location:t.location,revalidation:t.revalidation,component:E,error:x,children:I(),routeContext:{outlet:null,matches:A,isDataRoute:!0},onError:u}):I()},null)}function im(i){return`${i} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function nI(i){let e=w.useContext(zr);return Ft(e,im(i)),e}function aI(i){let e=w.useContext(Tu);return Ft(e,im(i)),e}function rI(i){let e=w.useContext(Di);return Ft(e,im(i)),e}function nm(i){let e=rI(i),t=e.matches[e.matches.length-1];return Ft(t.route.id,`${i} can only be used on routes that contain a unique "id"`),t.route.id}function lI(){return nm("useRouteId")}function oI(){let i=w.useContext(sm),e=aI("useRouteError"),t=nm("useRouteError");return i!==void 0?i:e.errors?.[t]}function cI(){let{router:i}=nI("useNavigate"),e=nm("useNavigate"),t=w.useRef(!1);return Fx(()=>{t.current=!0}),w.useCallback(async(n,r={})=>{Ni(t.current,jx),t.current&&(typeof n=="number"?await i.navigate(n):await i.navigate(n,{fromRouteId:e,...r}))},[i,e])}var kv={};function $x(i,e,t){!e&&!kv[i]&&(kv[i]=!0,Ni(!1,t))}w.memo(uI);function uI({routes:i,future:e,state:t,onError:s}){return Bx(i,void 0,t,s,e)}function dI({to:i,replace:e,state:t,relative:s}){Ft(Kr(),"<Navigate> may be used only in the context of a <Router> component.");let{static:n}=w.useContext(yi);Ni(!n,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:r}=w.useContext(Di),{pathname:l}=Un(),c=Ps(),h=tm(i,em(r),l,s==="path"),u=JSON.stringify(h);return w.useEffect(()=>{c(JSON.parse(u),{replace:e,state:t,relative:s})},[c,u,s,e,t]),null}function hI(i){return XA(i.context)}function Oi(i){Ft(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function fI({basename:i="/",children:e=null,location:t,navigationType:s="POP",navigator:n,static:r=!1,unstable_useTransitions:l}){Ft(!Kr(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let c=i.replace(/^\/*/,"/"),h=w.useMemo(()=>({basename:c,navigator:n,static:r,unstable_useTransitions:l,future:{}}),[c,n,r,l]);typeof t=="string"&&(t=Ka(t));let{pathname:u="/",search:f="",hash:p="",state:v=null,key:x="default"}=t,S=w.useMemo(()=>{let E=Pn(u,c);return E==null?null:{location:{pathname:E,search:f,hash:p,state:v,key:x},navigationType:s}},[c,u,f,p,v,x,s]);return Ni(S!=null,`<Router basename="${c}"> is not able to match the URL "${u}${f}${p}" because it does not start with the basename, so the <Router> won't render anything.`),S==null?null:w.createElement(yi.Provider,{value:h},w.createElement(io.Provider,{children:e,value:S}))}function mI({children:i,location:e}){return ZA(Rf(i),e)}function Rf(i,e=[]){let t=[];return w.Children.forEach(i,(s,n)=>{if(!w.isValidElement(s))return;let r=[...e,n];if(s.type===w.Fragment){t.push.apply(t,Rf(s.props.children,r));return}Ft(s.type===Oi,`[${typeof s.type=="string"?s.type:s.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),Ft(!s.props.index||!s.props.children,"An index route cannot have child routes.");let l={id:s.props.id||r.join("-"),caseSensitive:s.props.caseSensitive,element:s.props.element,Component:s.props.Component,index:s.props.index,path:s.props.path,middleware:s.props.middleware,loader:s.props.loader,action:s.props.action,hydrateFallbackElement:s.props.hydrateFallbackElement,HydrateFallback:s.props.HydrateFallback,errorElement:s.props.errorElement,ErrorBoundary:s.props.ErrorBoundary,hasErrorBoundary:s.props.hasErrorBoundary===!0||s.props.ErrorBoundary!=null||s.props.errorElement!=null,shouldRevalidate:s.props.shouldRevalidate,handle:s.props.handle,lazy:s.props.lazy};s.props.children&&(l.children=Rf(s.props.children,r)),t.push(l)}),t}var Yc="get",qc="application/x-www-form-urlencoded";function Au(i){return typeof HTMLElement<"u"&&i instanceof HTMLElement}function pI(i){return Au(i)&&i.tagName.toLowerCase()==="button"}function gI(i){return Au(i)&&i.tagName.toLowerCase()==="form"}function vI(i){return Au(i)&&i.tagName.toLowerCase()==="input"}function yI(i){return!!(i.metaKey||i.altKey||i.ctrlKey||i.shiftKey)}function xI(i,e){return i.button===0&&(!e||e==="_self")&&!yI(i)}var _c=null;function SI(){if(_c===null)try{new FormData(document.createElement("form"),0),_c=!1}catch{_c=!0}return _c}var bI=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function qh(i){return i!=null&&!bI.has(i)?(Ni(!1,`"${i}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${qc}"`),null):i}function TI(i,e){let t,s,n,r,l;if(gI(i)){let c=i.getAttribute("action");s=c?Pn(c,e):null,t=i.getAttribute("method")||Yc,n=qh(i.getAttribute("enctype"))||qc,r=new FormData(i)}else if(pI(i)||vI(i)&&(i.type==="submit"||i.type==="image")){let c=i.form;if(c==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let h=i.getAttribute("formaction")||c.getAttribute("action");if(s=h?Pn(h,e):null,t=i.getAttribute("formmethod")||c.getAttribute("method")||Yc,n=qh(i.getAttribute("formenctype"))||qh(c.getAttribute("enctype"))||qc,r=new FormData(c,i),!SI()){let{name:u,type:f,value:p}=i;if(f==="image"){let v=u?`${u}.`:"";r.append(`${v}x`,"0"),r.append(`${v}y`,"0")}else u&&r.append(u,p)}}else{if(Au(i))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');t=Yc,s=null,n=qc,l=i}return r&&n==="text/plain"&&(l=r,r=void 0),{action:s,method:t.toLowerCase(),encType:n,formData:r,body:l}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function am(i,e){if(i===!1||i===null||typeof i>"u")throw new Error(e)}function EI(i,e,t,s){let n=typeof i=="string"?new URL(i,typeof window>"u"?"server://singlefetch/":window.location.origin):i;return t?n.pathname.endsWith("/")?n.pathname=`${n.pathname}_.${s}`:n.pathname=`${n.pathname}.${s}`:n.pathname==="/"?n.pathname=`_root.${s}`:e&&Pn(n.pathname,e)==="/"?n.pathname=`${e.replace(/\/$/,"")}/_root.${s}`:n.pathname=`${n.pathname.replace(/\/$/,"")}.${s}`,n}async function AI(i,e){if(i.id in e)return e[i.id];try{let t=await import(i.module);return e[i.id]=t,t}catch(t){return console.error(`Error loading route module \`${i.module}\`, reloading page...`),console.error(t),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function II(i){return i==null?!1:i.href==null?i.rel==="preload"&&typeof i.imageSrcSet=="string"&&typeof i.imageSizes=="string":typeof i.rel=="string"&&typeof i.href=="string"}async function _I(i,e,t){let s=await Promise.all(i.map(async n=>{let r=e.routes[n.route.id];if(r){let l=await AI(r,t);return l.links?l.links():[]}return[]}));return CI(s.flat(1).filter(II).filter(n=>n.rel==="stylesheet"||n.rel==="preload").map(n=>n.rel==="stylesheet"?{...n,rel:"prefetch",as:"style"}:{...n,rel:"prefetch"}))}function Dv(i,e,t,s,n,r){let l=(h,u)=>t[u]?h.route.id!==t[u].route.id:!0,c=(h,u)=>t[u].pathname!==h.pathname||t[u].route.path?.endsWith("*")&&t[u].params["*"]!==h.params["*"];return r==="assets"?e.filter((h,u)=>l(h,u)||c(h,u)):r==="data"?e.filter((h,u)=>{let f=s.routes[h.route.id];if(!f||!f.hasLoader)return!1;if(l(h,u)||c(h,u))return!0;if(h.route.shouldRevalidate){let p=h.route.shouldRevalidate({currentUrl:new URL(n.pathname+n.search+n.hash,window.origin),currentParams:t[0]?.params||{},nextUrl:new URL(i,window.origin),nextParams:h.params,defaultShouldRevalidate:!0});if(typeof p=="boolean")return p}return!0}):[]}function RI(i,e,{includeHydrateFallback:t}={}){return LI(i.map(s=>{let n=e.routes[s.route.id];if(!n)return[];let r=[n.module];return n.clientActionModule&&(r=r.concat(n.clientActionModule)),n.clientLoaderModule&&(r=r.concat(n.clientLoaderModule)),t&&n.hydrateFallbackModule&&(r=r.concat(n.hydrateFallbackModule)),n.imports&&(r=r.concat(n.imports)),r}).flat(1))}function LI(i){return[...new Set(i)]}function wI(i){let e={},t=Object.keys(i).sort();for(let s of t)e[s]=i[s];return e}function CI(i,e){let t=new Set;return new Set(e),i.reduce((s,n)=>{let r=JSON.stringify(wI(n));return t.has(r)||(t.add(r),s.push({key:r,link:n})),s},[])}function Gx(){let i=w.useContext(zr);return am(i,"You must render this element inside a <DataRouterContext.Provider> element"),i}function OI(){let i=w.useContext(Tu);return am(i,"You must render this element inside a <DataRouterStateContext.Provider> element"),i}var rm=w.createContext(void 0);rm.displayName="FrameworkContext";function Hx(){let i=w.useContext(rm);return am(i,"You must render this element inside a <HydratedRouter> element"),i}function NI(i,e){let t=w.useContext(rm),[s,n]=w.useState(!1),[r,l]=w.useState(!1),{onFocus:c,onBlur:h,onMouseEnter:u,onMouseLeave:f,onTouchStart:p}=e,v=w.useRef(null);w.useEffect(()=>{if(i==="render"&&l(!0),i==="viewport"){let E=A=>{A.forEach(I=>{l(I.isIntersecting)})},T=new IntersectionObserver(E,{threshold:.5});return v.current&&T.observe(v.current),()=>{T.disconnect()}}},[i]),w.useEffect(()=>{if(s){let E=setTimeout(()=>{l(!0)},100);return()=>{clearTimeout(E)}}},[s]);let x=()=>{n(!0)},S=()=>{n(!1),l(!1)};return t?i!=="intent"?[r,v,{}]:[r,v,{onFocus:$l(c,x),onBlur:$l(h,S),onMouseEnter:$l(u,x),onMouseLeave:$l(f,S),onTouchStart:$l(p,x)}]:[!1,v,{}]}function $l(i,e){return t=>{i&&i(t),t.defaultPrevented||e(t)}}function kI({page:i,...e}){let{router:t}=Gx(),s=w.useMemo(()=>Cx(t.routes,i,t.basename),[t.routes,i,t.basename]);return s?w.createElement(PI,{page:i,matches:s,...e}):null}function DI(i){let{manifest:e,routeModules:t}=Hx(),[s,n]=w.useState([]);return w.useEffect(()=>{let r=!1;return _I(i,e,t).then(l=>{r||n(l)}),()=>{r=!0}},[i,e,t]),s}function PI({page:i,matches:e,...t}){let s=Un(),{future:n,manifest:r,routeModules:l}=Hx(),{basename:c}=Gx(),{loaderData:h,matches:u}=OI(),f=w.useMemo(()=>Dv(i,e,u,r,s,"data"),[i,e,u,r,s]),p=w.useMemo(()=>Dv(i,e,u,r,s,"assets"),[i,e,u,r,s]),v=w.useMemo(()=>{if(i===s.pathname+s.search+s.hash)return[];let E=new Set,T=!1;if(e.forEach(I=>{let _=r.routes[I.route.id];!_||!_.hasLoader||(!f.some(C=>C.route.id===I.route.id)&&I.route.id in h&&l[I.route.id]?.shouldRevalidate||_.hasClientLoader?T=!0:E.add(I.route.id))}),E.size===0)return[];let A=EI(i,c,n.unstable_trailingSlashAwareDataRequests,"data");return T&&E.size>0&&A.searchParams.set("_routes",e.filter(I=>E.has(I.route.id)).map(I=>I.route.id).join(",")),[A.pathname+A.search]},[c,n.unstable_trailingSlashAwareDataRequests,h,s,r,f,e,i,l]),x=w.useMemo(()=>RI(p,r),[p,r]),S=DI(p);return w.createElement(w.Fragment,null,v.map(E=>w.createElement("link",{key:E,rel:"prefetch",as:"fetch",href:E,...t})),x.map(E=>w.createElement("link",{key:E,rel:"modulepreload",href:E,...t})),S.map(({key:E,link:T})=>w.createElement("link",{key:E,nonce:t.nonce,...T,crossOrigin:T.crossOrigin??t.crossOrigin})))}function UI(...i){return e=>{i.forEach(t=>{typeof t=="function"?t(e):t!=null&&(t.current=e)})}}var MI=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{MI&&(window.__reactRouterVersion="7.13.0")}catch{}function jI({basename:i,children:e,unstable_useTransitions:t,window:s}){let n=w.useRef();n.current==null&&(n.current=mA({window:s,v5Compat:!0}));let r=n.current,[l,c]=w.useState({action:r.action,location:r.location}),h=w.useCallback(u=>{t===!1?c(u):w.startTransition(()=>c(u))},[t]);return w.useLayoutEffect(()=>r.listen(h),[r,h]),w.createElement(fI,{basename:i,children:e,location:l.location,navigationType:l.action,navigator:r,unstable_useTransitions:t})}var zx=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Vr=w.forwardRef(function({onClick:e,discover:t="render",prefetch:s="none",relative:n,reloadDocument:r,replace:l,state:c,target:h,to:u,preventScrollReset:f,viewTransition:p,unstable_defaultShouldRevalidate:v,...x},S){let{basename:E,unstable_useTransitions:T}=w.useContext(yi),A=typeof u=="string"&&zx.test(u),I=Dx(u,E);u=I.to;let _=qA(u,{relative:n}),[C,k,U]=NI(s,x),O=$I(u,{replace:l,state:c,target:h,preventScrollReset:f,relative:n,viewTransition:p,unstable_defaultShouldRevalidate:v,unstable_useTransitions:T});function F(M){e&&e(M),M.defaultPrevented||O(M)}let j=w.createElement("a",{...x,...U,href:I.absoluteURL||_,onClick:I.isExternal||r?e:F,ref:UI(S,k),target:h,"data-discover":!A&&t==="render"?"true":void 0});return C&&!A?w.createElement(w.Fragment,null,j,w.createElement(kI,{page:_})):j});Vr.displayName="Link";var FI=w.forwardRef(function({"aria-current":e="page",caseSensitive:t=!1,className:s="",end:n=!1,style:r,to:l,viewTransition:c,children:h,...u},f){let p=no(l,{relative:u.relative}),v=Un(),x=w.useContext(Tu),{navigator:S,basename:E}=w.useContext(yi),T=x!=null&&YI(p)&&c===!0,A=S.encodeLocation?S.encodeLocation(p).pathname:p.pathname,I=v.pathname,_=x&&x.navigation&&x.navigation.location?x.navigation.location.pathname:null;t||(I=I.toLowerCase(),_=_?_.toLowerCase():null,A=A.toLowerCase()),_&&E&&(_=Pn(_,E)||_);const C=A!=="/"&&A.endsWith("/")?A.length-1:A.length;let k=I===A||!n&&I.startsWith(A)&&I.charAt(C)==="/",U=_!=null&&(_===A||!n&&_.startsWith(A)&&_.charAt(A.length)==="/"),O={isActive:k,isPending:U,isTransitioning:T},F=k?e:void 0,j;typeof s=="function"?j=s(O):j=[s,k?"active":null,U?"pending":null,T?"transitioning":null].filter(Boolean).join(" ");let M=typeof r=="function"?r(O):r;return w.createElement(Vr,{...u,"aria-current":F,className:j,ref:f,style:M,to:l,viewTransition:c},typeof h=="function"?h(O):h)});FI.displayName="NavLink";var BI=w.forwardRef(({discover:i="render",fetcherKey:e,navigate:t,reloadDocument:s,replace:n,state:r,method:l=Yc,action:c,onSubmit:h,relative:u,preventScrollReset:f,viewTransition:p,unstable_defaultShouldRevalidate:v,...x},S)=>{let{unstable_useTransitions:E}=w.useContext(yi),T=zI(),A=KI(c,{relative:u}),I=l.toLowerCase()==="get"?"get":"post",_=typeof c=="string"&&zx.test(c),C=k=>{if(h&&h(k),k.defaultPrevented)return;k.preventDefault();let U=k.nativeEvent.submitter,O=U?.getAttribute("formmethod")||l,F=()=>T(U||k.currentTarget,{fetcherKey:e,method:O,navigate:t,replace:n,state:r,relative:u,preventScrollReset:f,viewTransition:p,unstable_defaultShouldRevalidate:v});E&&t!==!1?w.startTransition(()=>F()):F()};return w.createElement("form",{ref:S,method:I,action:A,onSubmit:s?h:C,...x,"data-discover":!_&&i==="render"?"true":void 0})});BI.displayName="Form";function VI(i){return`${i} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function Kx(i){let e=w.useContext(zr);return Ft(e,VI(i)),e}function $I(i,{target:e,replace:t,state:s,preventScrollReset:n,relative:r,viewTransition:l,unstable_defaultShouldRevalidate:c,unstable_useTransitions:h}={}){let u=Ps(),f=Un(),p=no(i,{relative:r});return w.useCallback(v=>{if(xI(v,e)){v.preventDefault();let x=t!==void 0?t:Ql(f)===Ql(p),S=()=>u(i,{replace:x,state:s,preventScrollReset:n,relative:r,viewTransition:l,unstable_defaultShouldRevalidate:c});h?w.startTransition(()=>S()):S()}},[f,u,p,t,s,e,i,n,r,l,c,h])}var GI=0,HI=()=>`__${String(++GI)}__`;function zI(){let{router:i}=Kx("useSubmit"),{basename:e}=w.useContext(yi),t=lI(),s=i.fetch,n=i.navigate;return w.useCallback(async(r,l={})=>{let{action:c,method:h,encType:u,formData:f,body:p}=TI(r,e);if(l.navigate===!1){let v=l.fetcherKey||HI();await s(v,t,l.action||c,{unstable_defaultShouldRevalidate:l.unstable_defaultShouldRevalidate,preventScrollReset:l.preventScrollReset,formData:f,body:p,formMethod:l.method||h,formEncType:l.encType||u,flushSync:l.flushSync})}else await n(l.action||c,{unstable_defaultShouldRevalidate:l.unstable_defaultShouldRevalidate,preventScrollReset:l.preventScrollReset,formData:f,body:p,formMethod:l.method||h,formEncType:l.encType||u,replace:l.replace,state:l.state,fromRouteId:t,flushSync:l.flushSync,viewTransition:l.viewTransition})},[s,n,e,t])}function KI(i,{relative:e}={}){let{basename:t}=w.useContext(yi),s=w.useContext(Di);Ft(s,"useFormAction must be used inside a RouteContext");let[n]=s.matches.slice(-1),r={...no(i||".",{relative:e})},l=Un();if(i==null){r.search=l.search;let c=new URLSearchParams(r.search),h=c.getAll("index");if(h.some(f=>f==="")){c.delete("index"),h.filter(p=>p).forEach(p=>c.append("index",p));let f=c.toString();r.search=f?`?${f}`:""}}return(!i||i===".")&&n.route.index&&(r.search=r.search?r.search.replace(/^\?/,"?index&"):"?index"),t!=="/"&&(r.pathname=r.pathname==="/"?t:Dn([t,r.pathname])),Ql(r)}function YI(i,{relative:e}={}){let t=w.useContext(Ux);Ft(t!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:s}=Kx("useViewTransitionState"),n=no(i,{relative:e});if(!t.isTransitioning)return!1;let r=Pn(t.currentLocation.pathname,s)||t.currentLocation.pathname,l=Pn(t.nextLocation.pathname,s)||t.nextLocation.pathname;return ru(n.pathname,l)!=null||ru(n.pathname,r)!=null}var qI=wx();const Yx=w.createContext(),QI={"#ff7e00":"https://raw.githubusercontent.com/gorillasuti/Legitflix-plugin/refs/heads/main/legitflix-client/public/default-logo-orange.png","#00aaff":"https://raw.githubusercontent.com/gorillasuti/Legitflix-plugin/refs/heads/main/legitflix-client/public/default-logo-blue.png","#00ff7e":"https://raw.githubusercontent.com/gorillasuti/Legitflix-plugin/refs/heads/main/legitflix-client/public/default-logo-green.png","#ff3333":"https://raw.githubusercontent.com/gorillasuti/Legitflix-plugin/refs/heads/main/legitflix-client/public/default-logo-red.png","#aa00ff":"https://raw.githubusercontent.com/gorillasuti/Legitflix-plugin/refs/heads/main/legitflix-client/public/default-logo-purple.png","#ff00aa":"https://raw.githubusercontent.com/gorillasuti/Legitflix-plugin/refs/heads/main/legitflix-client/public/default-logo-purple.png"},ao=i=>QI[i?.toLowerCase()]||"https://raw.githubusercontent.com/gorillasuti/Legitflix-plugin/refs/heads/main/legitflix-client/public/default-logo-orange.png",Hi=()=>w.useContext(Yx),WI=({children:i})=>{const[e,t]=w.useState({heroMediaTypes:"Movie,Series",promoMediaTypes:["Movie","Series"],contentTypeFilters:{Movie:!0,Series:!0,MusicAlbum:!1,Audio:!1,MusicVideo:!1},contentSortMode:"latest",heroLimit:20,enableJellyseerr:!0,jellyseerrUrl:"https://request.legitflix.eu",jellyseerrBackground:null,jellyseerrText:"Request Feature",logoType:"text",logoUrl:"",appName:"LegitFlix",fastForwardTime:10,rewindTime:10,hideBackdrop:!1,disableThemeSong:!1,enableSnow:!1,accentColor:"#ff7e00",showNavbarCategories:!0,showNavbarRequests:!0,showLibraryTitles:!0,appBackground:null,playerSeekForward:30,playerSeekBackward:10,defaultAudioLanguage:"auto",defaultSubtitleLanguage:"auto",prioritizeAudioLanguage:!1});w.useEffect(()=>{const l=localStorage.getItem("LegitFlix_Config");if(l)try{const c=JSON.parse(l);t(h=>({...h,...c})),c.accentColor&&s(c.accentColor),c.faviconUrl&&n(c.faviconUrl)}catch(c){console.error("Failed to parse local config",c)}else s(e.accentColor)},[]);const s=l=>{document.documentElement.style.setProperty("--clr-accent",l);const c=parseInt(l.slice(1,3),16),h=parseInt(l.slice(3,5),16),u=parseInt(l.slice(5,7),16);document.documentElement.style.setProperty("--clr-accent-glow",`rgba(${c}, ${h}, ${u}, 0.5)`)},n=l=>{let c=document.querySelector("link[rel~='icon']");c||(c=document.createElement("link"),c.rel="icon",document.head.appendChild(c)),c.href=l||"/favicon.jpg"},r=l=>{t(c=>{const h={...c,...l};return localStorage.setItem("LegitFlix_Config",JSON.stringify(h)),l.accentColor&&s(l.accentColor),l.faviconUrl!==void 0&&n(l.faviconUrl),h})};return g.jsx(Yx.Provider,{value:{config:e,updateConfig:r},children:i})};var Ws;(function(i){i[i.GREAT=2]="GREAT",i[i.GOOD=1]="GOOD",i[i.OK=0]="OK",i[i.BAD=-1]="BAD"})(Ws||(Ws={}));const lu="http:",ou="https:",XI=80,ZI=443;function JI(i){if(i=i.trim(),/^data:/i.test(i))throw new Error("data URLs are not supported");if(/^view-source:/i.test(i))throw new Error("`view-source:` is not supported as it is a non-standard protocol");if(!i.startsWith("//")&&/^\.*\//.test(i)||(i=i.replace(/^(?!(?:\w+:)?\/\/)|^\/\//,lu)),!/^https?:/i.test(i))throw new Error("only http or https protocols are supported");const s=new URL(i);if(s.hash="",s.pathname){const n=/\b[a-z][a-z\d+\-.]{1,50}:\/\//g;let r=0,l="";for(;;){const h=n.exec(s.pathname);if(!h)break;const u=h[0],f=h.index,p=s.pathname.slice(r,f);l+=p.replace(/\/{2,}/g,"/"),l+=u,r=f+u.length}const c=s.pathname.slice(r,s.pathname.length);l+=c.replace(/\/{2,}/g,"/"),s.pathname=l}if(s.pathname)try{s.pathname=decodeURI(s.pathname)}catch{}return s.hostname&&(s.hostname=s.hostname.replace(/\.$/,"")),s.search="",s.pathname=s.pathname.replace(/\/$/,""),i=s.toString(),i}function Rc(i){return new URL(i.toString())}function qx(i){if(i===lu)return XI;if(i===ou)return ZI;throw new Error("Unsupported protocol")}function e_(i,e){const t=e.port||qx(e.protocol);return i.toLowerCase().startsWith(`${e.protocol}//${e.hostname.toLowerCase()}:${t}`)}function Qx(i){return!i.port||i.port===qx(i.protocol).toString()}function t_(i){if(!i?.trim())throw new Error("Input is required");return new URL(JI(i))}const Lf=8096,Wx=8920;function Pv(i){let e=0;return i.protocol===ou?e+=5:e-=5,i.port===Lf.toString()?e+=2:i.port===Wx.toString()&&(e-=1),Qx(i)&&(e+=3),e}function s_(i){const e=[];try{const t=t_(i);if(e_(i,t))return[t.toString()];if(e.push(t),t.protocol===lu){const s=Rc(t);s.protocol=ou,e.push(s)}return e.filter(Qx).forEach(s=>{if(s.protocol===lu){const n=Rc(s);n.port=Lf.toString(),e.push(n)}else if(s.protocol===ou){let n=Rc(s);n.port=Lf.toString(),e.push(n),n=Rc(s),n.port=Wx.toString(),e.push(n)}}),e.sort((s,n)=>Pv(n)-Pv(s)),e.map(s=>s.toString())}catch(t){return console.warn(t),[]}}class Yr{}class i_ extends Yr{constructor(e){super(),this.productName=e}}class n_ extends Yr{constructor(e){super(),this.responseTime=e}}class a_ extends Yr{constructor(e){super(),this.error=e}}class Uv extends Yr{}class r_ extends Yr{constructor(e){super(),this.version=e}}class l_ extends Yr{constructor(e){super(),this.version=e}}function Xx(i,e){return function(){return i.apply(e,arguments)}}const{toString:o_}=Object.prototype,{getPrototypeOf:lm}=Object,{iterator:Iu,toStringTag:Zx}=Symbol,_u=(i=>e=>{const t=o_.call(e);return i[t]||(i[t]=t.slice(8,-1).toLowerCase())})(Object.create(null)),zi=i=>(i=i.toLowerCase(),e=>_u(e)===i),Ru=i=>e=>typeof e===i,{isArray:qr}=Array,$r=Ru("undefined");function ro(i){return i!==null&&!$r(i)&&i.constructor!==null&&!$r(i.constructor)&&Zs(i.constructor.isBuffer)&&i.constructor.isBuffer(i)}const Jx=zi("ArrayBuffer");function c_(i){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(i):e=i&&i.buffer&&Jx(i.buffer),e}const u_=Ru("string"),Zs=Ru("function"),eS=Ru("number"),lo=i=>i!==null&&typeof i=="object",d_=i=>i===!0||i===!1,Qc=i=>{if(_u(i)!=="object")return!1;const e=lm(i);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Zx in i)&&!(Iu in i)},h_=i=>{if(!lo(i)||ro(i))return!1;try{return Object.keys(i).length===0&&Object.getPrototypeOf(i)===Object.prototype}catch{return!1}},f_=zi("Date"),m_=zi("File"),p_=zi("Blob"),g_=zi("FileList"),v_=i=>lo(i)&&Zs(i.pipe),y_=i=>{let e;return i&&(typeof FormData=="function"&&i instanceof FormData||Zs(i.append)&&((e=_u(i))==="formdata"||e==="object"&&Zs(i.toString)&&i.toString()==="[object FormData]"))},x_=zi("URLSearchParams"),[S_,b_,T_,E_]=["ReadableStream","Request","Response","Headers"].map(zi),A_=i=>i.trim?i.trim():i.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function oo(i,e,{allOwnKeys:t=!1}={}){if(i===null||typeof i>"u")return;let s,n;if(typeof i!="object"&&(i=[i]),qr(i))for(s=0,n=i.length;s<n;s++)e.call(null,i[s],s,i);else{if(ro(i))return;const r=t?Object.getOwnPropertyNames(i):Object.keys(i),l=r.length;let c;for(s=0;s<l;s++)c=r[s],e.call(null,i[c],c,i)}}function tS(i,e){if(ro(i))return null;e=e.toLowerCase();const t=Object.keys(i);let s=t.length,n;for(;s-- >0;)if(n=t[s],e===n.toLowerCase())return n;return null}const Va=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,sS=i=>!$r(i)&&i!==Va;function wf(){const{caseless:i,skipUndefined:e}=sS(this)&&this||{},t={},s=(n,r)=>{if(r==="__proto__"||r==="constructor"||r==="prototype")return;const l=i&&tS(t,r)||r;Qc(t[l])&&Qc(n)?t[l]=wf(t[l],n):Qc(n)?t[l]=wf({},n):qr(n)?t[l]=n.slice():(!e||!$r(n))&&(t[l]=n)};for(let n=0,r=arguments.length;n<r;n++)arguments[n]&&oo(arguments[n],s);return t}const I_=(i,e,t,{allOwnKeys:s}={})=>(oo(e,(n,r)=>{t&&Zs(n)?Object.defineProperty(i,r,{value:Xx(n,t),writable:!0,enumerable:!0,configurable:!0}):Object.defineProperty(i,r,{value:n,writable:!0,enumerable:!0,configurable:!0})},{allOwnKeys:s}),i),__=i=>(i.charCodeAt(0)===65279&&(i=i.slice(1)),i),R_=(i,e,t,s)=>{i.prototype=Object.create(e.prototype,s),Object.defineProperty(i.prototype,"constructor",{value:i,writable:!0,enumerable:!1,configurable:!0}),Object.defineProperty(i,"super",{value:e.prototype}),t&&Object.assign(i.prototype,t)},L_=(i,e,t,s)=>{let n,r,l;const c={};if(e=e||{},i==null)return e;do{for(n=Object.getOwnPropertyNames(i),r=n.length;r-- >0;)l=n[r],(!s||s(l,i,e))&&!c[l]&&(e[l]=i[l],c[l]=!0);i=t!==!1&&lm(i)}while(i&&(!t||t(i,e))&&i!==Object.prototype);return e},w_=(i,e,t)=>{i=String(i),(t===void 0||t>i.length)&&(t=i.length),t-=e.length;const s=i.indexOf(e,t);return s!==-1&&s===t},C_=i=>{if(!i)return null;if(qr(i))return i;let e=i.length;if(!eS(e))return null;const t=new Array(e);for(;e-- >0;)t[e]=i[e];return t},O_=(i=>e=>i&&e instanceof i)(typeof Uint8Array<"u"&&lm(Uint8Array)),N_=(i,e)=>{const s=(i&&i[Iu]).call(i);let n;for(;(n=s.next())&&!n.done;){const r=n.value;e.call(i,r[0],r[1])}},k_=(i,e)=>{let t;const s=[];for(;(t=i.exec(e))!==null;)s.push(t);return s},D_=zi("HTMLFormElement"),P_=i=>i.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,s,n){return s.toUpperCase()+n}),Mv=(({hasOwnProperty:i})=>(e,t)=>i.call(e,t))(Object.prototype),U_=zi("RegExp"),iS=(i,e)=>{const t=Object.getOwnPropertyDescriptors(i),s={};oo(t,(n,r)=>{let l;(l=e(n,r,i))!==!1&&(s[r]=l||n)}),Object.defineProperties(i,s)},M_=i=>{iS(i,(e,t)=>{if(Zs(i)&&["arguments","caller","callee"].indexOf(t)!==-1)return!1;const s=i[t];if(Zs(s)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+t+"'")})}})},j_=(i,e)=>{const t={},s=n=>{n.forEach(r=>{t[r]=!0})};return qr(i)?s(i):s(String(i).split(e)),t},F_=()=>{},B_=(i,e)=>i!=null&&Number.isFinite(i=+i)?i:e;function V_(i){return!!(i&&Zs(i.append)&&i[Zx]==="FormData"&&i[Iu])}const $_=i=>{const e=new Array(10),t=(s,n)=>{if(lo(s)){if(e.indexOf(s)>=0)return;if(ro(s))return s;if(!("toJSON"in s)){e[n]=s;const r=qr(s)?[]:{};return oo(s,(l,c)=>{const h=t(l,n+1);!$r(h)&&(r[c]=h)}),e[n]=void 0,r}}return s};return t(i,0)},G_=zi("AsyncFunction"),H_=i=>i&&(lo(i)||Zs(i))&&Zs(i.then)&&Zs(i.catch),nS=((i,e)=>i?setImmediate:e?((t,s)=>(Va.addEventListener("message",({source:n,data:r})=>{n===Va&&r===t&&s.length&&s.shift()()},!1),n=>{s.push(n),Va.postMessage(t,"*")}))(`axios@${Math.random()}`,[]):t=>setTimeout(t))(typeof setImmediate=="function",Zs(Va.postMessage)),z_=typeof queueMicrotask<"u"?queueMicrotask.bind(Va):typeof process<"u"&&process.nextTick||nS,K_=i=>i!=null&&Zs(i[Iu]),ie={isArray:qr,isArrayBuffer:Jx,isBuffer:ro,isFormData:y_,isArrayBufferView:c_,isString:u_,isNumber:eS,isBoolean:d_,isObject:lo,isPlainObject:Qc,isEmptyObject:h_,isReadableStream:S_,isRequest:b_,isResponse:T_,isHeaders:E_,isUndefined:$r,isDate:f_,isFile:m_,isBlob:p_,isRegExp:U_,isFunction:Zs,isStream:v_,isURLSearchParams:x_,isTypedArray:O_,isFileList:g_,forEach:oo,merge:wf,extend:I_,trim:A_,stripBOM:__,inherits:R_,toFlatObject:L_,kindOf:_u,kindOfTest:zi,endsWith:w_,toArray:C_,forEachEntry:N_,matchAll:k_,isHTMLForm:D_,hasOwnProperty:Mv,hasOwnProp:Mv,reduceDescriptors:iS,freezeMethods:M_,toObjectSet:j_,toCamelCase:P_,noop:F_,toFiniteNumber:B_,findKey:tS,global:Va,isContextDefined:sS,isSpecCompliantForm:V_,toJSONObject:$_,isAsyncFn:G_,isThenable:H_,setImmediate:nS,asap:z_,isIterable:K_};let Ke=class aS extends Error{static from(e,t,s,n,r,l){const c=new aS(e.message,t||e.code,s,n,r);return c.cause=e,c.name=e.name,l&&Object.assign(c,l),c}constructor(e,t,s,n,r){super(e),this.name="AxiosError",this.isAxiosError=!0,t&&(this.code=t),s&&(this.config=s),n&&(this.request=n),r&&(this.response=r,this.status=r.status)}toJSON(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:ie.toJSONObject(this.config),code:this.code,status:this.status}}};Ke.ERR_BAD_OPTION_VALUE="ERR_BAD_OPTION_VALUE";Ke.ERR_BAD_OPTION="ERR_BAD_OPTION";Ke.ECONNABORTED="ECONNABORTED";Ke.ETIMEDOUT="ETIMEDOUT";Ke.ERR_NETWORK="ERR_NETWORK";Ke.ERR_FR_TOO_MANY_REDIRECTS="ERR_FR_TOO_MANY_REDIRECTS";Ke.ERR_DEPRECATED="ERR_DEPRECATED";Ke.ERR_BAD_RESPONSE="ERR_BAD_RESPONSE";Ke.ERR_BAD_REQUEST="ERR_BAD_REQUEST";Ke.ERR_CANCELED="ERR_CANCELED";Ke.ERR_NOT_SUPPORT="ERR_NOT_SUPPORT";Ke.ERR_INVALID_URL="ERR_INVALID_URL";const Y_=null;function Cf(i){return ie.isPlainObject(i)||ie.isArray(i)}function rS(i){return ie.endsWith(i,"[]")?i.slice(0,-2):i}function jv(i,e,t){return i?i.concat(e).map(function(n,r){return n=rS(n),!t&&r?"["+n+"]":n}).join(t?".":""):e}function q_(i){return ie.isArray(i)&&!i.some(Cf)}const Q_=ie.toFlatObject(ie,{},null,function(e){return/^is[A-Z]/.test(e)});function Lu(i,e,t){if(!ie.isObject(i))throw new TypeError("target must be an object");e=e||new FormData,t=ie.toFlatObject(t,{metaTokens:!0,dots:!1,indexes:!1},!1,function(E,T){return!ie.isUndefined(T[E])});const s=t.metaTokens,n=t.visitor||f,r=t.dots,l=t.indexes,h=(t.Blob||typeof Blob<"u"&&Blob)&&ie.isSpecCompliantForm(e);if(!ie.isFunction(n))throw new TypeError("visitor must be a function");function u(S){if(S===null)return"";if(ie.isDate(S))return S.toISOString();if(ie.isBoolean(S))return S.toString();if(!h&&ie.isBlob(S))throw new Ke("Blob is not supported. Use a Buffer instead.");return ie.isArrayBuffer(S)||ie.isTypedArray(S)?h&&typeof Blob=="function"?new Blob([S]):Buffer.from(S):S}function f(S,E,T){let A=S;if(S&&!T&&typeof S=="object"){if(ie.endsWith(E,"{}"))E=s?E:E.slice(0,-2),S=JSON.stringify(S);else if(ie.isArray(S)&&q_(S)||(ie.isFileList(S)||ie.endsWith(E,"[]"))&&(A=ie.toArray(S)))return E=rS(E),A.forEach(function(_,C){!(ie.isUndefined(_)||_===null)&&e.append(l===!0?jv([E],C,r):l===null?E:E+"[]",u(_))}),!1}return Cf(S)?!0:(e.append(jv(T,E,r),u(S)),!1)}const p=[],v=Object.assign(Q_,{defaultVisitor:f,convertValue:u,isVisitable:Cf});function x(S,E){if(!ie.isUndefined(S)){if(p.indexOf(S)!==-1)throw Error("Circular reference detected in "+E.join("."));p.push(S),ie.forEach(S,function(A,I){(!(ie.isUndefined(A)||A===null)&&n.call(e,A,ie.isString(I)?I.trim():I,E,v))===!0&&x(A,E?E.concat(I):[I])}),p.pop()}}if(!ie.isObject(i))throw new TypeError("data must be an object");return x(i),e}function Fv(i){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(i).replace(/[!'()~]|%20|%00/g,function(s){return e[s]})}function om(i,e){this._pairs=[],i&&Lu(i,this,e)}const lS=om.prototype;lS.append=function(e,t){this._pairs.push([e,t])};lS.toString=function(e){const t=e?function(s){return e.call(this,s,Fv)}:Fv;return this._pairs.map(function(n){return t(n[0])+"="+t(n[1])},"").join("&")};function W_(i){return encodeURIComponent(i).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function oS(i,e,t){if(!e)return i;const s=t&&t.encode||W_,n=ie.isFunction(t)?{serialize:t}:t,r=n&&n.serialize;let l;if(r?l=r(e,n):l=ie.isURLSearchParams(e)?e.toString():new om(e,n).toString(s),l){const c=i.indexOf("#");c!==-1&&(i=i.slice(0,c)),i+=(i.indexOf("?")===-1?"?":"&")+l}return i}class Bv{constructor(){this.handlers=[]}use(e,t,s){return this.handlers.push({fulfilled:e,rejected:t,synchronous:s?s.synchronous:!1,runWhen:s?s.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){ie.forEach(this.handlers,function(s){s!==null&&e(s)})}}const cm={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1,legacyInterceptorReqResOrdering:!0},X_=typeof URLSearchParams<"u"?URLSearchParams:om,Z_=typeof FormData<"u"?FormData:null,J_=typeof Blob<"u"?Blob:null,eR={isBrowser:!0,classes:{URLSearchParams:X_,FormData:Z_,Blob:J_},protocols:["http","https","file","blob","url","data"]},um=typeof window<"u"&&typeof document<"u",Of=typeof navigator=="object"&&navigator||void 0,tR=um&&(!Of||["ReactNative","NativeScript","NS"].indexOf(Of.product)<0),sR=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",iR=um&&window.location.href||"http://localhost",nR=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:um,hasStandardBrowserEnv:tR,hasStandardBrowserWebWorkerEnv:sR,navigator:Of,origin:iR},Symbol.toStringTag,{value:"Module"})),Ds={...nR,...eR};function aR(i,e){return Lu(i,new Ds.classes.URLSearchParams,{visitor:function(t,s,n,r){return Ds.isNode&&ie.isBuffer(t)?(this.append(s,t.toString("base64")),!1):r.defaultVisitor.apply(this,arguments)},...e})}function rR(i){return ie.matchAll(/\w+|\[(\w*)]/g,i).map(e=>e[0]==="[]"?"":e[1]||e[0])}function lR(i){const e={},t=Object.keys(i);let s;const n=t.length;let r;for(s=0;s<n;s++)r=t[s],e[r]=i[r];return e}function cS(i){function e(t,s,n,r){let l=t[r++];if(l==="__proto__")return!0;const c=Number.isFinite(+l),h=r>=t.length;return l=!l&&ie.isArray(n)?n.length:l,h?(ie.hasOwnProp(n,l)?n[l]=[n[l],s]:n[l]=s,!c):((!n[l]||!ie.isObject(n[l]))&&(n[l]=[]),e(t,s,n[l],r)&&ie.isArray(n[l])&&(n[l]=lR(n[l])),!c)}if(ie.isFormData(i)&&ie.isFunction(i.entries)){const t={};return ie.forEachEntry(i,(s,n)=>{e(rR(s),n,t,0)}),t}return null}function oR(i,e,t){if(ie.isString(i))try{return(e||JSON.parse)(i),ie.trim(i)}catch(s){if(s.name!=="SyntaxError")throw s}return(t||JSON.stringify)(i)}const co={transitional:cm,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const s=t.getContentType()||"",n=s.indexOf("application/json")>-1,r=ie.isObject(e);if(r&&ie.isHTMLForm(e)&&(e=new FormData(e)),ie.isFormData(e))return n?JSON.stringify(cS(e)):e;if(ie.isArrayBuffer(e)||ie.isBuffer(e)||ie.isStream(e)||ie.isFile(e)||ie.isBlob(e)||ie.isReadableStream(e))return e;if(ie.isArrayBufferView(e))return e.buffer;if(ie.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let c;if(r){if(s.indexOf("application/x-www-form-urlencoded")>-1)return aR(e,this.formSerializer).toString();if((c=ie.isFileList(e))||s.indexOf("multipart/form-data")>-1){const h=this.env&&this.env.FormData;return Lu(c?{"files[]":e}:e,h&&new h,this.formSerializer)}}return r||n?(t.setContentType("application/json",!1),oR(e)):e}],transformResponse:[function(e){const t=this.transitional||co.transitional,s=t&&t.forcedJSONParsing,n=this.responseType==="json";if(ie.isResponse(e)||ie.isReadableStream(e))return e;if(e&&ie.isString(e)&&(s&&!this.responseType||n)){const l=!(t&&t.silentJSONParsing)&&n;try{return JSON.parse(e,this.parseReviver)}catch(c){if(l)throw c.name==="SyntaxError"?Ke.from(c,Ke.ERR_BAD_RESPONSE,this,null,this.response):c}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Ds.classes.FormData,Blob:Ds.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};ie.forEach(["delete","get","head","post","put","patch"],i=>{co.headers[i]={}});const cR=ie.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),uR=i=>{const e={};let t,s,n;return i&&i.split(`
`).forEach(function(l){n=l.indexOf(":"),t=l.substring(0,n).trim().toLowerCase(),s=l.substring(n+1).trim(),!(!t||e[t]&&cR[t])&&(t==="set-cookie"?e[t]?e[t].push(s):e[t]=[s]:e[t]=e[t]?e[t]+", "+s:s)}),e},Vv=Symbol("internals");function Gl(i){return i&&String(i).trim().toLowerCase()}function Wc(i){return i===!1||i==null?i:ie.isArray(i)?i.map(Wc):String(i)}function dR(i){const e=Object.create(null),t=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let s;for(;s=t.exec(i);)e[s[1]]=s[2];return e}const hR=i=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(i.trim());function Qh(i,e,t,s,n){if(ie.isFunction(s))return s.call(this,e,t);if(n&&(e=t),!!ie.isString(e)){if(ie.isString(s))return e.indexOf(s)!==-1;if(ie.isRegExp(s))return s.test(e)}}function fR(i){return i.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,s)=>t.toUpperCase()+s)}function mR(i,e){const t=ie.toCamelCase(" "+e);["get","set","has"].forEach(s=>{Object.defineProperty(i,s+t,{value:function(n,r,l){return this[s].call(this,e,n,r,l)},configurable:!0})})}let Js=class{constructor(e){e&&this.set(e)}set(e,t,s){const n=this;function r(c,h,u){const f=Gl(h);if(!f)throw new Error("header name must be a non-empty string");const p=ie.findKey(n,f);(!p||n[p]===void 0||u===!0||u===void 0&&n[p]!==!1)&&(n[p||h]=Wc(c))}const l=(c,h)=>ie.forEach(c,(u,f)=>r(u,f,h));if(ie.isPlainObject(e)||e instanceof this.constructor)l(e,t);else if(ie.isString(e)&&(e=e.trim())&&!hR(e))l(uR(e),t);else if(ie.isObject(e)&&ie.isIterable(e)){let c={},h,u;for(const f of e){if(!ie.isArray(f))throw TypeError("Object iterator must return a key-value pair");c[u=f[0]]=(h=c[u])?ie.isArray(h)?[...h,f[1]]:[h,f[1]]:f[1]}l(c,t)}else e!=null&&r(t,e,s);return this}get(e,t){if(e=Gl(e),e){const s=ie.findKey(this,e);if(s){const n=this[s];if(!t)return n;if(t===!0)return dR(n);if(ie.isFunction(t))return t.call(this,n,s);if(ie.isRegExp(t))return t.exec(n);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=Gl(e),e){const s=ie.findKey(this,e);return!!(s&&this[s]!==void 0&&(!t||Qh(this,this[s],s,t)))}return!1}delete(e,t){const s=this;let n=!1;function r(l){if(l=Gl(l),l){const c=ie.findKey(s,l);c&&(!t||Qh(s,s[c],c,t))&&(delete s[c],n=!0)}}return ie.isArray(e)?e.forEach(r):r(e),n}clear(e){const t=Object.keys(this);let s=t.length,n=!1;for(;s--;){const r=t[s];(!e||Qh(this,this[r],r,e,!0))&&(delete this[r],n=!0)}return n}normalize(e){const t=this,s={};return ie.forEach(this,(n,r)=>{const l=ie.findKey(s,r);if(l){t[l]=Wc(n),delete t[r];return}const c=e?fR(r):String(r).trim();c!==r&&delete t[r],t[c]=Wc(n),s[c]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return ie.forEach(this,(s,n)=>{s!=null&&s!==!1&&(t[n]=e&&ie.isArray(s)?s.join(", "):s)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const s=new this(e);return t.forEach(n=>s.set(n)),s}static accessor(e){const s=(this[Vv]=this[Vv]={accessors:{}}).accessors,n=this.prototype;function r(l){const c=Gl(l);s[c]||(mR(n,l),s[c]=!0)}return ie.isArray(e)?e.forEach(r):r(e),this}};Js.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);ie.reduceDescriptors(Js.prototype,({value:i},e)=>{let t=e[0].toUpperCase()+e.slice(1);return{get:()=>i,set(s){this[t]=s}}});ie.freezeMethods(Js);function Wh(i,e){const t=this||co,s=e||t,n=Js.from(s.headers);let r=s.data;return ie.forEach(i,function(c){r=c.call(t,r,n.normalize(),e?e.status:void 0)}),n.normalize(),r}function uS(i){return!!(i&&i.__CANCEL__)}let uo=class extends Ke{constructor(e,t,s){super(e??"canceled",Ke.ERR_CANCELED,t,s),this.name="CanceledError",this.__CANCEL__=!0}};function dS(i,e,t){const s=t.config.validateStatus;!t.status||!s||s(t.status)?i(t):e(new Ke("Request failed with status code "+t.status,[Ke.ERR_BAD_REQUEST,Ke.ERR_BAD_RESPONSE][Math.floor(t.status/100)-4],t.config,t.request,t))}function pR(i){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(i);return e&&e[1]||""}function gR(i,e){i=i||10;const t=new Array(i),s=new Array(i);let n=0,r=0,l;return e=e!==void 0?e:1e3,function(h){const u=Date.now(),f=s[r];l||(l=u),t[n]=h,s[n]=u;let p=r,v=0;for(;p!==n;)v+=t[p++],p=p%i;if(n=(n+1)%i,n===r&&(r=(r+1)%i),u-l<e)return;const x=f&&u-f;return x?Math.round(v*1e3/x):void 0}}function vR(i,e){let t=0,s=1e3/e,n,r;const l=(u,f=Date.now())=>{t=f,n=null,r&&(clearTimeout(r),r=null),i(...u)};return[(...u)=>{const f=Date.now(),p=f-t;p>=s?l(u,f):(n=u,r||(r=setTimeout(()=>{r=null,l(n)},s-p)))},()=>n&&l(n)]}const cu=(i,e,t=3)=>{let s=0;const n=gR(50,250);return vR(r=>{const l=r.loaded,c=r.lengthComputable?r.total:void 0,h=l-s,u=n(h),f=l<=c;s=l;const p={loaded:l,total:c,progress:c?l/c:void 0,bytes:h,rate:u||void 0,estimated:u&&c&&f?(c-l)/u:void 0,event:r,lengthComputable:c!=null,[e?"download":"upload"]:!0};i(p)},t)},$v=(i,e)=>{const t=i!=null;return[s=>e[0]({lengthComputable:t,total:i,loaded:s}),e[1]]},Gv=i=>(...e)=>ie.asap(()=>i(...e)),yR=Ds.hasStandardBrowserEnv?((i,e)=>t=>(t=new URL(t,Ds.origin),i.protocol===t.protocol&&i.host===t.host&&(e||i.port===t.port)))(new URL(Ds.origin),Ds.navigator&&/(msie|trident)/i.test(Ds.navigator.userAgent)):()=>!0,xR=Ds.hasStandardBrowserEnv?{write(i,e,t,s,n,r,l){if(typeof document>"u")return;const c=[`${i}=${encodeURIComponent(e)}`];ie.isNumber(t)&&c.push(`expires=${new Date(t).toUTCString()}`),ie.isString(s)&&c.push(`path=${s}`),ie.isString(n)&&c.push(`domain=${n}`),r===!0&&c.push("secure"),ie.isString(l)&&c.push(`SameSite=${l}`),document.cookie=c.join("; ")},read(i){if(typeof document>"u")return null;const e=document.cookie.match(new RegExp("(?:^|; )"+i+"=([^;]*)"));return e?decodeURIComponent(e[1]):null},remove(i){this.write(i,"",Date.now()-864e5,"/")}}:{write(){},read(){return null},remove(){}};function SR(i){return typeof i!="string"?!1:/^([a-z][a-z\d+\-.]*:)?\/\//i.test(i)}function bR(i,e){return e?i.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):i}function hS(i,e,t){let s=!SR(e);return i&&(s||t==!1)?bR(i,e):e}const Hv=i=>i instanceof Js?{...i}:i;function Ha(i,e){e=e||{};const t={};function s(u,f,p,v){return ie.isPlainObject(u)&&ie.isPlainObject(f)?ie.merge.call({caseless:v},u,f):ie.isPlainObject(f)?ie.merge({},f):ie.isArray(f)?f.slice():f}function n(u,f,p,v){if(ie.isUndefined(f)){if(!ie.isUndefined(u))return s(void 0,u,p,v)}else return s(u,f,p,v)}function r(u,f){if(!ie.isUndefined(f))return s(void 0,f)}function l(u,f){if(ie.isUndefined(f)){if(!ie.isUndefined(u))return s(void 0,u)}else return s(void 0,f)}function c(u,f,p){if(p in e)return s(u,f);if(p in i)return s(void 0,u)}const h={url:r,method:r,data:r,baseURL:l,transformRequest:l,transformResponse:l,paramsSerializer:l,timeout:l,timeoutMessage:l,withCredentials:l,withXSRFToken:l,adapter:l,responseType:l,xsrfCookieName:l,xsrfHeaderName:l,onUploadProgress:l,onDownloadProgress:l,decompress:l,maxContentLength:l,maxBodyLength:l,beforeRedirect:l,transport:l,httpAgent:l,httpsAgent:l,cancelToken:l,socketPath:l,responseEncoding:l,validateStatus:c,headers:(u,f,p)=>n(Hv(u),Hv(f),p,!0)};return ie.forEach(Object.keys({...i,...e}),function(f){if(f==="__proto__"||f==="constructor"||f==="prototype")return;const p=ie.hasOwnProp(h,f)?h[f]:n,v=p(i[f],e[f],f);ie.isUndefined(v)&&p!==c||(t[f]=v)}),t}const fS=i=>{const e=Ha({},i);let{data:t,withXSRFToken:s,xsrfHeaderName:n,xsrfCookieName:r,headers:l,auth:c}=e;if(e.headers=l=Js.from(l),e.url=oS(hS(e.baseURL,e.url,e.allowAbsoluteUrls),i.params,i.paramsSerializer),c&&l.set("Authorization","Basic "+btoa((c.username||"")+":"+(c.password?unescape(encodeURIComponent(c.password)):""))),ie.isFormData(t)){if(Ds.hasStandardBrowserEnv||Ds.hasStandardBrowserWebWorkerEnv)l.setContentType(void 0);else if(ie.isFunction(t.getHeaders)){const h=t.getHeaders(),u=["content-type","content-length"];Object.entries(h).forEach(([f,p])=>{u.includes(f.toLowerCase())&&l.set(f,p)})}}if(Ds.hasStandardBrowserEnv&&(s&&ie.isFunction(s)&&(s=s(e)),s||s!==!1&&yR(e.url))){const h=n&&r&&xR.read(r);h&&l.set(n,h)}return e},TR=typeof XMLHttpRequest<"u",ER=TR&&function(i){return new Promise(function(t,s){const n=fS(i);let r=n.data;const l=Js.from(n.headers).normalize();let{responseType:c,onUploadProgress:h,onDownloadProgress:u}=n,f,p,v,x,S;function E(){x&&x(),S&&S(),n.cancelToken&&n.cancelToken.unsubscribe(f),n.signal&&n.signal.removeEventListener("abort",f)}let T=new XMLHttpRequest;T.open(n.method.toUpperCase(),n.url,!0),T.timeout=n.timeout;function A(){if(!T)return;const _=Js.from("getAllResponseHeaders"in T&&T.getAllResponseHeaders()),k={data:!c||c==="text"||c==="json"?T.responseText:T.response,status:T.status,statusText:T.statusText,headers:_,config:i,request:T};dS(function(O){t(O),E()},function(O){s(O),E()},k),T=null}"onloadend"in T?T.onloadend=A:T.onreadystatechange=function(){!T||T.readyState!==4||T.status===0&&!(T.responseURL&&T.responseURL.indexOf("file:")===0)||setTimeout(A)},T.onabort=function(){T&&(s(new Ke("Request aborted",Ke.ECONNABORTED,i,T)),T=null)},T.onerror=function(C){const k=C&&C.message?C.message:"Network Error",U=new Ke(k,Ke.ERR_NETWORK,i,T);U.event=C||null,s(U),T=null},T.ontimeout=function(){let C=n.timeout?"timeout of "+n.timeout+"ms exceeded":"timeout exceeded";const k=n.transitional||cm;n.timeoutErrorMessage&&(C=n.timeoutErrorMessage),s(new Ke(C,k.clarifyTimeoutError?Ke.ETIMEDOUT:Ke.ECONNABORTED,i,T)),T=null},r===void 0&&l.setContentType(null),"setRequestHeader"in T&&ie.forEach(l.toJSON(),function(C,k){T.setRequestHeader(k,C)}),ie.isUndefined(n.withCredentials)||(T.withCredentials=!!n.withCredentials),c&&c!=="json"&&(T.responseType=n.responseType),u&&([v,S]=cu(u,!0),T.addEventListener("progress",v)),h&&T.upload&&([p,x]=cu(h),T.upload.addEventListener("progress",p),T.upload.addEventListener("loadend",x)),(n.cancelToken||n.signal)&&(f=_=>{T&&(s(!_||_.type?new uo(null,i,T):_),T.abort(),T=null)},n.cancelToken&&n.cancelToken.subscribe(f),n.signal&&(n.signal.aborted?f():n.signal.addEventListener("abort",f)));const I=pR(n.url);if(I&&Ds.protocols.indexOf(I)===-1){s(new Ke("Unsupported protocol "+I+":",Ke.ERR_BAD_REQUEST,i));return}T.send(r||null)})},AR=(i,e)=>{const{length:t}=i=i?i.filter(Boolean):[];if(e||t){let s=new AbortController,n;const r=function(u){if(!n){n=!0,c();const f=u instanceof Error?u:this.reason;s.abort(f instanceof Ke?f:new uo(f instanceof Error?f.message:f))}};let l=e&&setTimeout(()=>{l=null,r(new Ke(`timeout of ${e}ms exceeded`,Ke.ETIMEDOUT))},e);const c=()=>{i&&(l&&clearTimeout(l),l=null,i.forEach(u=>{u.unsubscribe?u.unsubscribe(r):u.removeEventListener("abort",r)}),i=null)};i.forEach(u=>u.addEventListener("abort",r));const{signal:h}=s;return h.unsubscribe=()=>ie.asap(c),h}},IR=function*(i,e){let t=i.byteLength;if(t<e){yield i;return}let s=0,n;for(;s<t;)n=s+e,yield i.slice(s,n),s=n},_R=async function*(i,e){for await(const t of RR(i))yield*IR(t,e)},RR=async function*(i){if(i[Symbol.asyncIterator]){yield*i;return}const e=i.getReader();try{for(;;){const{done:t,value:s}=await e.read();if(t)break;yield s}}finally{await e.cancel()}},zv=(i,e,t,s)=>{const n=_R(i,e);let r=0,l,c=h=>{l||(l=!0,s&&s(h))};return new ReadableStream({async pull(h){try{const{done:u,value:f}=await n.next();if(u){c(),h.close();return}let p=f.byteLength;if(t){let v=r+=p;t(v)}h.enqueue(new Uint8Array(f))}catch(u){throw c(u),u}},cancel(h){return c(h),n.return()}},{highWaterMark:2})},Kv=64*1024,{isFunction:Lc}=ie,LR=(({Request:i,Response:e})=>({Request:i,Response:e}))(ie.global),{ReadableStream:Yv,TextEncoder:qv}=ie.global,Qv=(i,...e)=>{try{return!!i(...e)}catch{return!1}},wR=i=>{i=ie.merge.call({skipUndefined:!0},LR,i);const{fetch:e,Request:t,Response:s}=i,n=e?Lc(e):typeof fetch=="function",r=Lc(t),l=Lc(s);if(!n)return!1;const c=n&&Lc(Yv),h=n&&(typeof qv=="function"?(S=>E=>S.encode(E))(new qv):async S=>new Uint8Array(await new t(S).arrayBuffer())),u=r&&c&&Qv(()=>{let S=!1;const E=new t(Ds.origin,{body:new Yv,method:"POST",get duplex(){return S=!0,"half"}}).headers.has("Content-Type");return S&&!E}),f=l&&c&&Qv(()=>ie.isReadableStream(new s("").body)),p={stream:f&&(S=>S.body)};n&&["text","arrayBuffer","blob","formData","stream"].forEach(S=>{!p[S]&&(p[S]=(E,T)=>{let A=E&&E[S];if(A)return A.call(E);throw new Ke(`Response type '${S}' is not supported`,Ke.ERR_NOT_SUPPORT,T)})});const v=async S=>{if(S==null)return 0;if(ie.isBlob(S))return S.size;if(ie.isSpecCompliantForm(S))return(await new t(Ds.origin,{method:"POST",body:S}).arrayBuffer()).byteLength;if(ie.isArrayBufferView(S)||ie.isArrayBuffer(S))return S.byteLength;if(ie.isURLSearchParams(S)&&(S=S+""),ie.isString(S))return(await h(S)).byteLength},x=async(S,E)=>{const T=ie.toFiniteNumber(S.getContentLength());return T??v(E)};return async S=>{let{url:E,method:T,data:A,signal:I,cancelToken:_,timeout:C,onDownloadProgress:k,onUploadProgress:U,responseType:O,headers:F,withCredentials:j="same-origin",fetchOptions:M}=fS(S),H=e||fetch;O=O?(O+"").toLowerCase():"text";let K=AR([I,_&&_.toAbortSignal()],C),te=null;const ae=K&&K.unsubscribe&&(()=>{K.unsubscribe()});let me;try{if(U&&u&&T!=="get"&&T!=="head"&&(me=await x(F,A))!==0){let P=new t(E,{method:"POST",body:A,duplex:"half"}),V;if(ie.isFormData(A)&&(V=P.headers.get("content-type"))&&F.setContentType(V),P.body){const[se,he]=$v(me,cu(Gv(U)));A=zv(P.body,Kv,se,he)}}ie.isString(j)||(j=j?"include":"omit");const D=r&&"credentials"in t.prototype,G={...M,signal:K,method:T.toUpperCase(),headers:F.normalize().toJSON(),body:A,duplex:"half",credentials:D?j:void 0};te=r&&new t(E,G);let Y=await(r?H(te,M):H(E,G));const oe=f&&(O==="stream"||O==="response");if(f&&(k||oe&&ae)){const P={};["status","statusText","headers"].forEach(ye=>{P[ye]=Y[ye]});const V=ie.toFiniteNumber(Y.headers.get("content-length")),[se,he]=k&&$v(V,cu(Gv(k),!0))||[];Y=new s(zv(Y.body,Kv,se,()=>{he&&he(),ae&&ae()}),P)}O=O||"text";let pe=await p[ie.findKey(p,O)||"text"](Y,S);return!oe&&ae&&ae(),await new Promise((P,V)=>{dS(P,V,{data:pe,headers:Js.from(Y.headers),status:Y.status,statusText:Y.statusText,config:S,request:te})})}catch(D){throw ae&&ae(),D&&D.name==="TypeError"&&/Load failed|fetch/i.test(D.message)?Object.assign(new Ke("Network Error",Ke.ERR_NETWORK,S,te,D&&D.response),{cause:D.cause||D}):Ke.from(D,D&&D.code,S,te,D&&D.response)}}},CR=new Map,mS=i=>{let e=i&&i.env||{};const{fetch:t,Request:s,Response:n}=e,r=[s,n,t];let l=r.length,c=l,h,u,f=CR;for(;c--;)h=r[c],u=f.get(h),u===void 0&&f.set(h,u=c?new Map:wR(e)),f=u;return u};mS();const dm={http:Y_,xhr:ER,fetch:{get:mS}};ie.forEach(dm,(i,e)=>{if(i){try{Object.defineProperty(i,"name",{value:e})}catch{}Object.defineProperty(i,"adapterName",{value:e})}});const Wv=i=>`- ${i}`,OR=i=>ie.isFunction(i)||i===null||i===!1;function NR(i,e){i=ie.isArray(i)?i:[i];const{length:t}=i;let s,n;const r={};for(let l=0;l<t;l++){s=i[l];let c;if(n=s,!OR(s)&&(n=dm[(c=String(s)).toLowerCase()],n===void 0))throw new Ke(`Unknown adapter '${c}'`);if(n&&(ie.isFunction(n)||(n=n.get(e))))break;r[c||"#"+l]=n}if(!n){const l=Object.entries(r).map(([h,u])=>`adapter ${h} `+(u===!1?"is not supported by the environment":"is not available in the build"));let c=t?l.length>1?`since :
`+l.map(Wv).join(`
`):" "+Wv(l[0]):"as no adapter specified";throw new Ke("There is no suitable adapter to dispatch the request "+c,"ERR_NOT_SUPPORT")}return n}const pS={getAdapter:NR,adapters:dm};function Xh(i){if(i.cancelToken&&i.cancelToken.throwIfRequested(),i.signal&&i.signal.aborted)throw new uo(null,i)}function Xv(i){return Xh(i),i.headers=Js.from(i.headers),i.data=Wh.call(i,i.transformRequest),["post","put","patch"].indexOf(i.method)!==-1&&i.headers.setContentType("application/x-www-form-urlencoded",!1),pS.getAdapter(i.adapter||co.adapter,i)(i).then(function(s){return Xh(i),s.data=Wh.call(i,i.transformResponse,s),s.headers=Js.from(s.headers),s},function(s){return uS(s)||(Xh(i),s&&s.response&&(s.response.data=Wh.call(i,i.transformResponse,s.response),s.response.headers=Js.from(s.response.headers))),Promise.reject(s)})}const gS="1.13.5",wu={};["object","boolean","number","function","string","symbol"].forEach((i,e)=>{wu[i]=function(s){return typeof s===i||"a"+(e<1?"n ":" ")+i}});const Zv={};wu.transitional=function(e,t,s){function n(r,l){return"[Axios v"+gS+"] Transitional option '"+r+"'"+l+(s?". "+s:"")}return(r,l,c)=>{if(e===!1)throw new Ke(n(l," has been removed"+(t?" in "+t:"")),Ke.ERR_DEPRECATED);return t&&!Zv[l]&&(Zv[l]=!0,console.warn(n(l," has been deprecated since v"+t+" and will be removed in the near future"))),e?e(r,l,c):!0}};wu.spelling=function(e){return(t,s)=>(console.warn(`${s} is likely a misspelling of ${e}`),!0)};function kR(i,e,t){if(typeof i!="object")throw new Ke("options must be an object",Ke.ERR_BAD_OPTION_VALUE);const s=Object.keys(i);let n=s.length;for(;n-- >0;){const r=s[n],l=e[r];if(l){const c=i[r],h=c===void 0||l(c,r,i);if(h!==!0)throw new Ke("option "+r+" must be "+h,Ke.ERR_BAD_OPTION_VALUE);continue}if(t!==!0)throw new Ke("Unknown option "+r,Ke.ERR_BAD_OPTION)}}const Xc={assertOptions:kR,validators:wu},Ci=Xc.validators;let $a=class{constructor(e){this.defaults=e||{},this.interceptors={request:new Bv,response:new Bv}}async request(e,t){try{return await this._request(e,t)}catch(s){if(s instanceof Error){let n={};Error.captureStackTrace?Error.captureStackTrace(n):n=new Error;const r=n.stack?n.stack.replace(/^.+\n/,""):"";try{s.stack?r&&!String(s.stack).endsWith(r.replace(/^.+\n.+\n/,""))&&(s.stack+=`
`+r):s.stack=r}catch{}}throw s}}_request(e,t){typeof e=="string"?(t=t||{},t.url=e):t=e||{},t=Ha(this.defaults,t);const{transitional:s,paramsSerializer:n,headers:r}=t;s!==void 0&&Xc.assertOptions(s,{silentJSONParsing:Ci.transitional(Ci.boolean),forcedJSONParsing:Ci.transitional(Ci.boolean),clarifyTimeoutError:Ci.transitional(Ci.boolean),legacyInterceptorReqResOrdering:Ci.transitional(Ci.boolean)},!1),n!=null&&(ie.isFunction(n)?t.paramsSerializer={serialize:n}:Xc.assertOptions(n,{encode:Ci.function,serialize:Ci.function},!0)),t.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),Xc.assertOptions(t,{baseUrl:Ci.spelling("baseURL"),withXsrfToken:Ci.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let l=r&&ie.merge(r.common,r[t.method]);r&&ie.forEach(["delete","get","head","post","put","patch","common"],S=>{delete r[S]}),t.headers=Js.concat(l,r);const c=[];let h=!0;this.interceptors.request.forEach(function(E){if(typeof E.runWhen=="function"&&E.runWhen(t)===!1)return;h=h&&E.synchronous;const T=t.transitional||cm;T&&T.legacyInterceptorReqResOrdering?c.unshift(E.fulfilled,E.rejected):c.push(E.fulfilled,E.rejected)});const u=[];this.interceptors.response.forEach(function(E){u.push(E.fulfilled,E.rejected)});let f,p=0,v;if(!h){const S=[Xv.bind(this),void 0];for(S.unshift(...c),S.push(...u),v=S.length,f=Promise.resolve(t);p<v;)f=f.then(S[p++],S[p++]);return f}v=c.length;let x=t;for(;p<v;){const S=c[p++],E=c[p++];try{x=S(x)}catch(T){E.call(this,T);break}}try{f=Xv.call(this,x)}catch(S){return Promise.reject(S)}for(p=0,v=u.length;p<v;)f=f.then(u[p++],u[p++]);return f}getUri(e){e=Ha(this.defaults,e);const t=hS(e.baseURL,e.url,e.allowAbsoluteUrls);return oS(t,e.params,e.paramsSerializer)}};ie.forEach(["delete","get","head","options"],function(e){$a.prototype[e]=function(t,s){return this.request(Ha(s||{},{method:e,url:t,data:(s||{}).data}))}});ie.forEach(["post","put","patch"],function(e){function t(s){return function(r,l,c){return this.request(Ha(c||{},{method:e,headers:s?{"Content-Type":"multipart/form-data"}:{},url:r,data:l}))}}$a.prototype[e]=t(),$a.prototype[e+"Form"]=t(!0)});let DR=class vS{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(r){t=r});const s=this;this.promise.then(n=>{if(!s._listeners)return;let r=s._listeners.length;for(;r-- >0;)s._listeners[r](n);s._listeners=null}),this.promise.then=n=>{let r;const l=new Promise(c=>{s.subscribe(c),r=c}).then(n);return l.cancel=function(){s.unsubscribe(r)},l},e(function(r,l,c){s.reason||(s.reason=new uo(r,l,c),t(s.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);t!==-1&&this._listeners.splice(t,1)}toAbortSignal(){const e=new AbortController,t=s=>{e.abort(s)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let e;return{token:new vS(function(n){e=n}),cancel:e}}};function PR(i){return function(t){return i.apply(null,t)}}function UR(i){return ie.isObject(i)&&i.isAxiosError===!0}const Nf={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(Nf).forEach(([i,e])=>{Nf[e]=i});function yS(i){const e=new $a(i),t=Xx($a.prototype.request,e);return ie.extend(t,$a.prototype,e,{allOwnKeys:!0}),ie.extend(t,e,null,{allOwnKeys:!0}),t.create=function(n){return yS(Ha(i,n))},t}const le=yS(co);le.Axios=$a;le.CanceledError=uo;le.CancelToken=DR;le.isCancel=uS;le.VERSION=gS;le.toFormData=Lu;le.AxiosError=Ke;le.Cancel=le.CanceledError;le.all=function(e){return Promise.all(e)};le.spread=PR;le.isAxiosError=UR;le.mergeConfig=Ha;le.AxiosHeaders=Js;le.formToJSON=i=>cS(ie.isHTMLForm(i)?new FormData(i):i);le.getAdapter=pS.getAdapter;le.HttpStatusCode=Nf;le.default=le;const{Axios:pk,AxiosError:gk,CanceledError:vk,isCancel:yk,CancelToken:xk,VERSION:Sk,all:bk,Cancel:Tk,isAxiosError:Ek,spread:Ak,toFormData:Ik,AxiosHeaders:_k,HttpStatusCode:Rk,formToJSON:Lk,getAdapter:wk,mergeConfig:Ck}=le,ve="http://localhost".replace(/\/+$/,"");class cn{constructor(e,t=ve,s=le){var n;this.basePath=t,this.axios=s,e&&(this.configuration=e,this.basePath=(n=e.basePath)!==null&&n!==void 0?n:t)}}class MR extends Error{constructor(e,t){super(t),this.field=e,this.name="RequiredError"}}const xe={},Se="https://example.com",Le=function(i,e,t){if(t==null)throw new MR(e,`Required parameter ${e} was null or undefined when calling ${i}.`)},Re=async function(i,e,t){if(t&&t.apiKey){const s=typeof t.apiKey=="function"?await t.apiKey(e):await t.apiKey;i[e]=s}};function kf(i,e,t=""){e!=null&&(typeof e=="object"?Array.isArray(e)?e.forEach(s=>kf(i,s,t)):Object.keys(e).forEach(s=>kf(i,e[s],`${t}${t!==""?".":""}${s}`)):i.has(t)?i.append(t,e):i.set(t,e))}const be=function(i,...e){const t=new URLSearchParams(i.search);kf(t,e),i.search=t.toString()},vs=function(i,e,t){const s=typeof i!="string";return(s&&t&&t.isJsonMime?t.isJsonMime(e.headers["Content-Type"]):s)?JSON.stringify(i!==void 0?i:{}):i||""},Te=function(i){return i.pathname+i.search+i.hash},Ee=function(i,e,t,s){return(n=e,r=t)=>{var l;const c={...i.options,url:(n.defaults.baseURL?"":(l=s?.basePath)!==null&&l!==void 0?l:r)+i.url};return n.request(c)}},jR=function(i){return{getEndpointInfo:async(e={})=>{const t="/System/Endpoint",s=new URL(t,Se);let n;i&&(n=i.baseOptions);const r={method:"GET",...n,...e},l={},c={};await Re(l,"Authorization",i),be(s,c);let h=n&&n.headers?n.headers:{};return r.headers={...l,...h,...e.headers},{url:Te(s),options:r}},getLogFile:async(e,t={})=>{Le("getLogFile","name",e);const s="/System/Logs/Log",n=new URL(s,Se);let r;i&&(r=i.baseOptions);const l={method:"GET",...r,...t},c={},h={};await Re(c,"Authorization",i),e!==void 0&&(h.name=e),be(n,h);let u=r&&r.headers?r.headers:{};return l.headers={...c,...u,...t.headers},{url:Te(n),options:l}},getPingSystem:async(e={})=>{const t="/System/Ping",s=new URL(t,Se);let n;i&&(n=i.baseOptions);const r={method:"GET",...n,...e},l={};be(s,{});let h=n&&n.headers?n.headers:{};return r.headers={...l,...h,...e.headers},{url:Te(s),options:r}},getPublicSystemInfo:async(e={})=>{const t="/System/Info/Public",s=new URL(t,Se);let n;i&&(n=i.baseOptions);const r={method:"GET",...n,...e},l={};be(s,{});let h=n&&n.headers?n.headers:{};return r.headers={...l,...h,...e.headers},{url:Te(s),options:r}},getServerLogs:async(e={})=>{const t="/System/Logs",s=new URL(t,Se);let n;i&&(n=i.baseOptions);const r={method:"GET",...n,...e},l={},c={};await Re(l,"Authorization",i),be(s,c);let h=n&&n.headers?n.headers:{};return r.headers={...l,...h,...e.headers},{url:Te(s),options:r}},getSystemInfo:async(e={})=>{const t="/System/Info",s=new URL(t,Se);let n;i&&(n=i.baseOptions);const r={method:"GET",...n,...e},l={},c={};await Re(l,"Authorization",i),be(s,c);let h=n&&n.headers?n.headers:{};return r.headers={...l,...h,...e.headers},{url:Te(s),options:r}},getSystemStorage:async(e={})=>{const t="/System/Info/Storage",s=new URL(t,Se);let n;i&&(n=i.baseOptions);const r={method:"GET",...n,...e},l={},c={};await Re(l,"Authorization",i),be(s,c);let h=n&&n.headers?n.headers:{};return r.headers={...l,...h,...e.headers},{url:Te(s),options:r}},postPingSystem:async(e={})=>{const t="/System/Ping",s=new URL(t,Se);let n;i&&(n=i.baseOptions);const r={method:"POST",...n,...e},l={};be(s,{});let h=n&&n.headers?n.headers:{};return r.headers={...l,...h,...e.headers},{url:Te(s),options:r}},restartApplication:async(e={})=>{const t="/System/Restart",s=new URL(t,Se);let n;i&&(n=i.baseOptions);const r={method:"POST",...n,...e},l={},c={};await Re(l,"Authorization",i),be(s,c);let h=n&&n.headers?n.headers:{};return r.headers={...l,...h,...e.headers},{url:Te(s),options:r}},shutdownApplication:async(e={})=>{const t="/System/Shutdown",s=new URL(t,Se);let n;i&&(n=i.baseOptions);const r={method:"POST",...n,...e},l={},c={};await Re(l,"Authorization",i),be(s,c);let h=n&&n.headers?n.headers:{};return r.headers={...l,...h,...e.headers},{url:Te(s),options:r}}}},Xi=function(i){const e=jR(i);return{async getEndpointInfo(t){var s,n,r;const l=await e.getEndpointInfo(t),c=(s=i?.serverIndex)!==null&&s!==void 0?s:0,h=(r=(n=xe["SystemApi.getEndpointInfo"])===null||n===void 0?void 0:n[c])===null||r===void 0?void 0:r.url;return(u,f)=>Ee(l,le,ve,i)(u,h||f)},async getLogFile(t,s){var n,r,l;const c=await e.getLogFile(t,s),h=(n=i?.serverIndex)!==null&&n!==void 0?n:0,u=(l=(r=xe["SystemApi.getLogFile"])===null||r===void 0?void 0:r[h])===null||l===void 0?void 0:l.url;return(f,p)=>Ee(c,le,ve,i)(f,u||p)},async getPingSystem(t){var s,n,r;const l=await e.getPingSystem(t),c=(s=i?.serverIndex)!==null&&s!==void 0?s:0,h=(r=(n=xe["SystemApi.getPingSystem"])===null||n===void 0?void 0:n[c])===null||r===void 0?void 0:r.url;return(u,f)=>Ee(l,le,ve,i)(u,h||f)},async getPublicSystemInfo(t){var s,n,r;const l=await e.getPublicSystemInfo(t),c=(s=i?.serverIndex)!==null&&s!==void 0?s:0,h=(r=(n=xe["SystemApi.getPublicSystemInfo"])===null||n===void 0?void 0:n[c])===null||r===void 0?void 0:r.url;return(u,f)=>Ee(l,le,ve,i)(u,h||f)},async getServerLogs(t){var s,n,r;const l=await e.getServerLogs(t),c=(s=i?.serverIndex)!==null&&s!==void 0?s:0,h=(r=(n=xe["SystemApi.getServerLogs"])===null||n===void 0?void 0:n[c])===null||r===void 0?void 0:r.url;return(u,f)=>Ee(l,le,ve,i)(u,h||f)},async getSystemInfo(t){var s,n,r;const l=await e.getSystemInfo(t),c=(s=i?.serverIndex)!==null&&s!==void 0?s:0,h=(r=(n=xe["SystemApi.getSystemInfo"])===null||n===void 0?void 0:n[c])===null||r===void 0?void 0:r.url;return(u,f)=>Ee(l,le,ve,i)(u,h||f)},async getSystemStorage(t){var s,n,r;const l=await e.getSystemStorage(t),c=(s=i?.serverIndex)!==null&&s!==void 0?s:0,h=(r=(n=xe["SystemApi.getSystemStorage"])===null||n===void 0?void 0:n[c])===null||r===void 0?void 0:r.url;return(u,f)=>Ee(l,le,ve,i)(u,h||f)},async postPingSystem(t){var s,n,r;const l=await e.postPingSystem(t),c=(s=i?.serverIndex)!==null&&s!==void 0?s:0,h=(r=(n=xe["SystemApi.postPingSystem"])===null||n===void 0?void 0:n[c])===null||r===void 0?void 0:r.url;return(u,f)=>Ee(l,le,ve,i)(u,h||f)},async restartApplication(t){var s,n,r;const l=await e.restartApplication(t),c=(s=i?.serverIndex)!==null&&s!==void 0?s:0,h=(r=(n=xe["SystemApi.restartApplication"])===null||n===void 0?void 0:n[c])===null||r===void 0?void 0:r.url;return(u,f)=>Ee(l,le,ve,i)(u,h||f)},async shutdownApplication(t){var s,n,r;const l=await e.shutdownApplication(t),c=(s=i?.serverIndex)!==null&&s!==void 0?s:0,h=(r=(n=xe["SystemApi.shutdownApplication"])===null||n===void 0?void 0:n[c])===null||r===void 0?void 0:r.url;return(u,f)=>Ee(l,le,ve,i)(u,h||f)}}};class FR extends cn{getEndpointInfo(e){return Xi(this.configuration).getEndpointInfo(e).then(t=>t(this.axios,this.basePath))}getLogFile(e,t){return Xi(this.configuration).getLogFile(e.name,t).then(s=>s(this.axios,this.basePath))}getPingSystem(e){return Xi(this.configuration).getPingSystem(e).then(t=>t(this.axios,this.basePath))}getPublicSystemInfo(e){return Xi(this.configuration).getPublicSystemInfo(e).then(t=>t(this.axios,this.basePath))}getServerLogs(e){return Xi(this.configuration).getServerLogs(e).then(t=>t(this.axios,this.basePath))}getSystemInfo(e){return Xi(this.configuration).getSystemInfo(e).then(t=>t(this.axios,this.basePath))}getSystemStorage(e){return Xi(this.configuration).getSystemStorage(e).then(t=>t(this.axios,this.basePath))}postPingSystem(e){return Xi(this.configuration).postPingSystem(e).then(t=>t(this.axios,this.basePath))}restartApplication(e){return Xi(this.configuration).restartApplication(e).then(t=>t(this.axios,this.basePath))}shutdownApplication(e){return Xi(this.configuration).shutdownApplication(e).then(t=>t(this.axios,this.basePath))}}function BR(i){return new FR(i.configuration,void 0,i.axiosInstance)}function Jv(i){const e=i.split(".").map(Number);if(e.length===3&&e.every(t=>t>=0))return e}function ey(i,e){const t=Jv(i),s=Jv(e);if(!t||!s)throw new TypeError("Version doesn't match a numeric-only semver format");const[n,r,l]=t,[c,h,u]=s;return n<c||n===c&&r<h||n===c&&r===h&&l<u}const VR="10.11.1",$R="10.10.0",GR="Jellyfin Server",HR=3e3,zR=5e3;function KR(i,e=Ws.GREAT){return i.length>0?Math.min(...i):e}function YR(i){var e,t,s;const n=[],r=[];!(!((e=i.response)===null||e===void 0)&&e.data)||i.error?(n.push(new a_(i.error)),r.push(Ws.BAD)):i.response.data.ProductName!==GR&&(n.push(new i_(i.response.data.ProductName)),r.push(Ws.BAD));const l=(t=i.response)===null||t===void 0?void 0:t.data.Version;try{l?ey(l,$R)?(n.push(new l_(l)),r.push(Ws.OK)):ey(l,VR)&&(n.push(new r_(l)),r.push(Ws.GOOD)):(n.push(new Uv),r.push(Ws.BAD))}catch(c){c instanceof TypeError&&(n.push(new Uv),r.push(Ws.BAD))}return i.responseTime>HR&&(n.push(new n_(i.responseTime)),r.push(Ws.GOOD)),{address:i.address,responseTime:i.responseTime,score:KR(r),issues:n,systemInfo:(s=i.response)===null||s===void 0?void 0:s.data}}class qR{constructor(e){this.jellyfin=e}async fetchRecommendedServerInfo(e){const t=this.jellyfin.createApi(e),s=Date.now();return BR(t).getPublicSystemInfo({timeout:zR}).then(n=>({address:e,response:n,responseTime:Date.now()-s})).catch(n=>({address:e,error:n,responseTime:Date.now()-s})).then(n=>YR(n))}async discover(e,t=Ws.BAD){return(await Promise.all(e.map(s=>this.fetchRecommendedServerInfo(s)))).filter(s=>s.score>=t)}}class QR{constructor(e){this.jellyfin=e,this.recommendedServerDiscovery=new qR(this.jellyfin)}findBestServer(e){let t=e.find(s=>s.score===Ws.GREAT);return t||(t=e.find(s=>s.score===Ws.GOOD)),t||(t=e.find(s=>s.score===Ws.OK)),t}getAddressCandidates(e){return s_(e)}async getRecommendedServers(e,t){return this.recommendedServerDiscovery.discover(e,t)}async getRecommendedServerCandidates(e,t){return this.getRecommendedServers(this.getAddressCandidates(e),t)}}function WR(i,e,t=""){return[`MediaBrowser Client="${encodeURIComponent(i.name)}"`,`Device="${encodeURIComponent(e.name)}"`,`DeviceId="${encodeURIComponent(e.id)}"`,`Version="${encodeURIComponent(i.version)}"`,`Token="${encodeURIComponent(t)}"`].join(", ")}class XR{constructor(e={}){this.apiKey=e.apiKey,this.username=e.username,this.password=e.password,this.accessToken=e.accessToken,this.basePath=e.basePath,this.serverIndex=e.serverIndex,this.baseOptions=e.baseOptions,this.formDataCtor=e.formDataCtor}isJsonMime(e){const t=new RegExp("^(application/json|[^;/ 	]+/[^;/ 	]+[+]json)[ 	]*(;.*)?$","i");return e!==null&&(t.test(e)||e.toLowerCase()==="application/json-patch+json")}}const ZR=function(i){return{addUserToSession:async(e,t,s={})=>{Le("addUserToSession","sessionId",e),Le("addUserToSession","userId",t);const n="/Sessions/{sessionId}/User/{userId}".replace("{sessionId}",encodeURIComponent(String(e))).replace("{userId}",encodeURIComponent(String(t))),r=new URL(n,Se);let l;i&&(l=i.baseOptions);const c={method:"POST",...l,...s},h={},u={};await Re(h,"Authorization",i),be(r,u);let f=l&&l.headers?l.headers:{};return c.headers={...h,...f,...s.headers},{url:Te(r),options:c}},displayContent:async(e,t,s,n,r={})=>{Le("displayContent","sessionId",e),Le("displayContent","itemType",t),Le("displayContent","itemId",s),Le("displayContent","itemName",n);const l="/Sessions/{sessionId}/Viewing".replace("{sessionId}",encodeURIComponent(String(e))),c=new URL(l,Se);let h;i&&(h=i.baseOptions);const u={method:"POST",...h,...r},f={},p={};await Re(f,"Authorization",i),t!==void 0&&(p.itemType=t),s!==void 0&&(p.itemId=s),n!==void 0&&(p.itemName=n),be(c,p);let v=h&&h.headers?h.headers:{};return u.headers={...f,...v,...r.headers},{url:Te(c),options:u}},getAuthProviders:async(e={})=>{const t="/Auth/Providers",s=new URL(t,Se);let n;i&&(n=i.baseOptions);const r={method:"GET",...n,...e},l={},c={};await Re(l,"Authorization",i),be(s,c);let h=n&&n.headers?n.headers:{};return r.headers={...l,...h,...e.headers},{url:Te(s),options:r}},getPasswordResetProviders:async(e={})=>{const t="/Auth/PasswordResetProviders",s=new URL(t,Se);let n;i&&(n=i.baseOptions);const r={method:"GET",...n,...e},l={},c={};await Re(l,"Authorization",i),be(s,c);let h=n&&n.headers?n.headers:{};return r.headers={...l,...h,...e.headers},{url:Te(s),options:r}},getSessions:async(e,t,s,n={})=>{const r="/Sessions",l=new URL(r,Se);let c;i&&(c=i.baseOptions);const h={method:"GET",...c,...n},u={},f={};await Re(u,"Authorization",i),e!==void 0&&(f.controllableByUserId=e),t!==void 0&&(f.deviceId=t),s!==void 0&&(f.activeWithinSeconds=s),be(l,f);let p=c&&c.headers?c.headers:{};return h.headers={...u,...p,...n.headers},{url:Te(l),options:h}},play:async(e,t,s,n,r,l,c,h,u={})=>{Le("play","sessionId",e),Le("play","playCommand",t),Le("play","itemIds",s);const f="/Sessions/{sessionId}/Playing".replace("{sessionId}",encodeURIComponent(String(e))),p=new URL(f,Se);let v;i&&(v=i.baseOptions);const x={method:"POST",...v,...u},S={},E={};await Re(S,"Authorization",i),t!==void 0&&(E.playCommand=t),s&&(E.itemIds=s),n!==void 0&&(E.startPositionTicks=n),r!==void 0&&(E.mediaSourceId=r),l!==void 0&&(E.audioStreamIndex=l),c!==void 0&&(E.subtitleStreamIndex=c),h!==void 0&&(E.startIndex=h),be(p,E);let T=v&&v.headers?v.headers:{};return x.headers={...S,...T,...u.headers},{url:Te(p),options:x}},postCapabilities:async(e,t,s,n,r,l={})=>{const c="/Sessions/Capabilities",h=new URL(c,Se);let u;i&&(u=i.baseOptions);const f={method:"POST",...u,...l},p={},v={};await Re(p,"Authorization",i),e!==void 0&&(v.id=e),t&&(v.playableMediaTypes=t),s&&(v.supportedCommands=s),n!==void 0&&(v.supportsMediaControl=n),r!==void 0&&(v.supportsPersistentIdentifier=r),be(h,v);let x=u&&u.headers?u.headers:{};return f.headers={...p,...x,...l.headers},{url:Te(h),options:f}},postFullCapabilities:async(e,t,s={})=>{Le("postFullCapabilities","clientCapabilitiesDto",e);const n="/Sessions/Capabilities/Full",r=new URL(n,Se);let l;i&&(l=i.baseOptions);const c={method:"POST",...l,...s},h={},u={};await Re(h,"Authorization",i),t!==void 0&&(u.id=t),h["Content-Type"]="application/json",be(r,u);let f=l&&l.headers?l.headers:{};return c.headers={...h,...f,...s.headers},c.data=vs(e,c,i),{url:Te(r),options:c}},removeUserFromSession:async(e,t,s={})=>{Le("removeUserFromSession","sessionId",e),Le("removeUserFromSession","userId",t);const n="/Sessions/{sessionId}/User/{userId}".replace("{sessionId}",encodeURIComponent(String(e))).replace("{userId}",encodeURIComponent(String(t))),r=new URL(n,Se);let l;i&&(l=i.baseOptions);const c={method:"DELETE",...l,...s},h={},u={};await Re(h,"Authorization",i),be(r,u);let f=l&&l.headers?l.headers:{};return c.headers={...h,...f,...s.headers},{url:Te(r),options:c}},reportSessionEnded:async(e={})=>{const t="/Sessions/Logout",s=new URL(t,Se);let n;i&&(n=i.baseOptions);const r={method:"POST",...n,...e},l={},c={};await Re(l,"Authorization",i),be(s,c);let h=n&&n.headers?n.headers:{};return r.headers={...l,...h,...e.headers},{url:Te(s),options:r}},reportViewing:async(e,t,s={})=>{Le("reportViewing","itemId",e);const n="/Sessions/Viewing",r=new URL(n,Se);let l;i&&(l=i.baseOptions);const c={method:"POST",...l,...s},h={},u={};await Re(h,"Authorization",i),t!==void 0&&(u.sessionId=t),e!==void 0&&(u.itemId=e),be(r,u);let f=l&&l.headers?l.headers:{};return c.headers={...h,...f,...s.headers},{url:Te(r),options:c}},sendFullGeneralCommand:async(e,t,s={})=>{Le("sendFullGeneralCommand","sessionId",e),Le("sendFullGeneralCommand","generalCommand",t);const n="/Sessions/{sessionId}/Command".replace("{sessionId}",encodeURIComponent(String(e))),r=new URL(n,Se);let l;i&&(l=i.baseOptions);const c={method:"POST",...l,...s},h={},u={};await Re(h,"Authorization",i),h["Content-Type"]="application/json",be(r,u);let f=l&&l.headers?l.headers:{};return c.headers={...h,...f,...s.headers},c.data=vs(t,c,i),{url:Te(r),options:c}},sendGeneralCommand:async(e,t,s={})=>{Le("sendGeneralCommand","sessionId",e),Le("sendGeneralCommand","command",t);const n="/Sessions/{sessionId}/Command/{command}".replace("{sessionId}",encodeURIComponent(String(e))).replace("{command}",encodeURIComponent(String(t))),r=new URL(n,Se);let l;i&&(l=i.baseOptions);const c={method:"POST",...l,...s},h={},u={};await Re(h,"Authorization",i),be(r,u);let f=l&&l.headers?l.headers:{};return c.headers={...h,...f,...s.headers},{url:Te(r),options:c}},sendMessageCommand:async(e,t,s={})=>{Le("sendMessageCommand","sessionId",e),Le("sendMessageCommand","messageCommand",t);const n="/Sessions/{sessionId}/Message".replace("{sessionId}",encodeURIComponent(String(e))),r=new URL(n,Se);let l;i&&(l=i.baseOptions);const c={method:"POST",...l,...s},h={},u={};await Re(h,"Authorization",i),h["Content-Type"]="application/json",be(r,u);let f=l&&l.headers?l.headers:{};return c.headers={...h,...f,...s.headers},c.data=vs(t,c,i),{url:Te(r),options:c}},sendPlaystateCommand:async(e,t,s,n,r={})=>{Le("sendPlaystateCommand","sessionId",e),Le("sendPlaystateCommand","command",t);const l="/Sessions/{sessionId}/Playing/{command}".replace("{sessionId}",encodeURIComponent(String(e))).replace("{command}",encodeURIComponent(String(t))),c=new URL(l,Se);let h;i&&(h=i.baseOptions);const u={method:"POST",...h,...r},f={},p={};await Re(f,"Authorization",i),s!==void 0&&(p.seekPositionTicks=s),n!==void 0&&(p.controllingUserId=n),be(c,p);let v=h&&h.headers?h.headers:{};return u.headers={...f,...v,...r.headers},{url:Te(c),options:u}},sendSystemCommand:async(e,t,s={})=>{Le("sendSystemCommand","sessionId",e),Le("sendSystemCommand","command",t);const n="/Sessions/{sessionId}/System/{command}".replace("{sessionId}",encodeURIComponent(String(e))).replace("{command}",encodeURIComponent(String(t))),r=new URL(n,Se);let l;i&&(l=i.baseOptions);const c={method:"POST",...l,...s},h={},u={};await Re(h,"Authorization",i),be(r,u);let f=l&&l.headers?l.headers:{};return c.headers={...h,...f,...s.headers},{url:Te(r),options:c}}}},ks=function(i){const e=ZR(i);return{async addUserToSession(t,s,n){var r,l,c;const h=await e.addUserToSession(t,s,n),u=(r=i?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=xe["SessionApi.addUserToSession"])===null||l===void 0?void 0:l[u])===null||c===void 0?void 0:c.url;return(p,v)=>Ee(h,le,ve,i)(p,f||v)},async displayContent(t,s,n,r,l){var c,h,u;const f=await e.displayContent(t,s,n,r,l),p=(c=i?.serverIndex)!==null&&c!==void 0?c:0,v=(u=(h=xe["SessionApi.displayContent"])===null||h===void 0?void 0:h[p])===null||u===void 0?void 0:u.url;return(x,S)=>Ee(f,le,ve,i)(x,v||S)},async getAuthProviders(t){var s,n,r;const l=await e.getAuthProviders(t),c=(s=i?.serverIndex)!==null&&s!==void 0?s:0,h=(r=(n=xe["SessionApi.getAuthProviders"])===null||n===void 0?void 0:n[c])===null||r===void 0?void 0:r.url;return(u,f)=>Ee(l,le,ve,i)(u,h||f)},async getPasswordResetProviders(t){var s,n,r;const l=await e.getPasswordResetProviders(t),c=(s=i?.serverIndex)!==null&&s!==void 0?s:0,h=(r=(n=xe["SessionApi.getPasswordResetProviders"])===null||n===void 0?void 0:n[c])===null||r===void 0?void 0:r.url;return(u,f)=>Ee(l,le,ve,i)(u,h||f)},async getSessions(t,s,n,r){var l,c,h;const u=await e.getSessions(t,s,n,r),f=(l=i?.serverIndex)!==null&&l!==void 0?l:0,p=(h=(c=xe["SessionApi.getSessions"])===null||c===void 0?void 0:c[f])===null||h===void 0?void 0:h.url;return(v,x)=>Ee(u,le,ve,i)(v,p||x)},async play(t,s,n,r,l,c,h,u,f){var p,v,x;const S=await e.play(t,s,n,r,l,c,h,u,f),E=(p=i?.serverIndex)!==null&&p!==void 0?p:0,T=(x=(v=xe["SessionApi.play"])===null||v===void 0?void 0:v[E])===null||x===void 0?void 0:x.url;return(A,I)=>Ee(S,le,ve,i)(A,T||I)},async postCapabilities(t,s,n,r,l,c){var h,u,f;const p=await e.postCapabilities(t,s,n,r,l,c),v=(h=i?.serverIndex)!==null&&h!==void 0?h:0,x=(f=(u=xe["SessionApi.postCapabilities"])===null||u===void 0?void 0:u[v])===null||f===void 0?void 0:f.url;return(S,E)=>Ee(p,le,ve,i)(S,x||E)},async postFullCapabilities(t,s,n){var r,l,c;const h=await e.postFullCapabilities(t,s,n),u=(r=i?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=xe["SessionApi.postFullCapabilities"])===null||l===void 0?void 0:l[u])===null||c===void 0?void 0:c.url;return(p,v)=>Ee(h,le,ve,i)(p,f||v)},async removeUserFromSession(t,s,n){var r,l,c;const h=await e.removeUserFromSession(t,s,n),u=(r=i?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=xe["SessionApi.removeUserFromSession"])===null||l===void 0?void 0:l[u])===null||c===void 0?void 0:c.url;return(p,v)=>Ee(h,le,ve,i)(p,f||v)},async reportSessionEnded(t){var s,n,r;const l=await e.reportSessionEnded(t),c=(s=i?.serverIndex)!==null&&s!==void 0?s:0,h=(r=(n=xe["SessionApi.reportSessionEnded"])===null||n===void 0?void 0:n[c])===null||r===void 0?void 0:r.url;return(u,f)=>Ee(l,le,ve,i)(u,h||f)},async reportViewing(t,s,n){var r,l,c;const h=await e.reportViewing(t,s,n),u=(r=i?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=xe["SessionApi.reportViewing"])===null||l===void 0?void 0:l[u])===null||c===void 0?void 0:c.url;return(p,v)=>Ee(h,le,ve,i)(p,f||v)},async sendFullGeneralCommand(t,s,n){var r,l,c;const h=await e.sendFullGeneralCommand(t,s,n),u=(r=i?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=xe["SessionApi.sendFullGeneralCommand"])===null||l===void 0?void 0:l[u])===null||c===void 0?void 0:c.url;return(p,v)=>Ee(h,le,ve,i)(p,f||v)},async sendGeneralCommand(t,s,n){var r,l,c;const h=await e.sendGeneralCommand(t,s,n),u=(r=i?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=xe["SessionApi.sendGeneralCommand"])===null||l===void 0?void 0:l[u])===null||c===void 0?void 0:c.url;return(p,v)=>Ee(h,le,ve,i)(p,f||v)},async sendMessageCommand(t,s,n){var r,l,c;const h=await e.sendMessageCommand(t,s,n),u=(r=i?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=xe["SessionApi.sendMessageCommand"])===null||l===void 0?void 0:l[u])===null||c===void 0?void 0:c.url;return(p,v)=>Ee(h,le,ve,i)(p,f||v)},async sendPlaystateCommand(t,s,n,r,l){var c,h,u;const f=await e.sendPlaystateCommand(t,s,n,r,l),p=(c=i?.serverIndex)!==null&&c!==void 0?c:0,v=(u=(h=xe["SessionApi.sendPlaystateCommand"])===null||h===void 0?void 0:h[p])===null||u===void 0?void 0:u.url;return(x,S)=>Ee(f,le,ve,i)(x,v||S)},async sendSystemCommand(t,s,n){var r,l,c;const h=await e.sendSystemCommand(t,s,n),u=(r=i?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=xe["SessionApi.sendSystemCommand"])===null||l===void 0?void 0:l[u])===null||c===void 0?void 0:c.url;return(p,v)=>Ee(h,le,ve,i)(p,f||v)}}};class JR extends cn{addUserToSession(e,t){return ks(this.configuration).addUserToSession(e.sessionId,e.userId,t).then(s=>s(this.axios,this.basePath))}displayContent(e,t){return ks(this.configuration).displayContent(e.sessionId,e.itemType,e.itemId,e.itemName,t).then(s=>s(this.axios,this.basePath))}getAuthProviders(e){return ks(this.configuration).getAuthProviders(e).then(t=>t(this.axios,this.basePath))}getPasswordResetProviders(e){return ks(this.configuration).getPasswordResetProviders(e).then(t=>t(this.axios,this.basePath))}getSessions(e={},t){return ks(this.configuration).getSessions(e.controllableByUserId,e.deviceId,e.activeWithinSeconds,t).then(s=>s(this.axios,this.basePath))}play(e,t){return ks(this.configuration).play(e.sessionId,e.playCommand,e.itemIds,e.startPositionTicks,e.mediaSourceId,e.audioStreamIndex,e.subtitleStreamIndex,e.startIndex,t).then(s=>s(this.axios,this.basePath))}postCapabilities(e={},t){return ks(this.configuration).postCapabilities(e.id,e.playableMediaTypes,e.supportedCommands,e.supportsMediaControl,e.supportsPersistentIdentifier,t).then(s=>s(this.axios,this.basePath))}postFullCapabilities(e,t){return ks(this.configuration).postFullCapabilities(e.clientCapabilitiesDto,e.id,t).then(s=>s(this.axios,this.basePath))}removeUserFromSession(e,t){return ks(this.configuration).removeUserFromSession(e.sessionId,e.userId,t).then(s=>s(this.axios,this.basePath))}reportSessionEnded(e){return ks(this.configuration).reportSessionEnded(e).then(t=>t(this.axios,this.basePath))}reportViewing(e,t){return ks(this.configuration).reportViewing(e.itemId,e.sessionId,t).then(s=>s(this.axios,this.basePath))}sendFullGeneralCommand(e,t){return ks(this.configuration).sendFullGeneralCommand(e.sessionId,e.generalCommand,t).then(s=>s(this.axios,this.basePath))}sendGeneralCommand(e,t){return ks(this.configuration).sendGeneralCommand(e.sessionId,e.command,t).then(s=>s(this.axios,this.basePath))}sendMessageCommand(e,t){return ks(this.configuration).sendMessageCommand(e.sessionId,e.messageCommand,t).then(s=>s(this.axios,this.basePath))}sendPlaystateCommand(e,t){return ks(this.configuration).sendPlaystateCommand(e.sessionId,e.command,e.seekPositionTicks,e.controllingUserId,t).then(s=>s(this.axios,this.basePath))}sendSystemCommand(e,t){return ks(this.configuration).sendSystemCommand(e.sessionId,e.command,t).then(s=>s(this.axios,this.basePath))}}class eL extends JR{constructor(e){super(e.configuration,void 0,e.axiosInstance),this.api=e}reportSessionEnded(e){return super.reportSessionEnded(e).then(t=>(this.api.accessToken="",t))}}function tL(i){return new eL(i)}const sL=function(i){return{authenticateUserByName:async(e,t={})=>{Le("authenticateUserByName","authenticateUserByName",e);const s="/Users/AuthenticateByName",n=new URL(s,Se);let r;i&&(r=i.baseOptions);const l={method:"POST",...r,...t},c={},h={};c["Content-Type"]="application/json",be(n,h);let u=r&&r.headers?r.headers:{};return l.headers={...c,...u,...t.headers},l.data=vs(e,l,i),{url:Te(n),options:l}},authenticateWithQuickConnect:async(e,t={})=>{Le("authenticateWithQuickConnect","quickConnectDto",e);const s="/Users/AuthenticateWithQuickConnect",n=new URL(s,Se);let r;i&&(r=i.baseOptions);const l={method:"POST",...r,...t},c={},h={};c["Content-Type"]="application/json",be(n,h);let u=r&&r.headers?r.headers:{};return l.headers={...c,...u,...t.headers},l.data=vs(e,l,i),{url:Te(n),options:l}},createUserByName:async(e,t={})=>{Le("createUserByName","createUserByName",e);const s="/Users/New",n=new URL(s,Se);let r;i&&(r=i.baseOptions);const l={method:"POST",...r,...t},c={},h={};await Re(c,"Authorization",i),c["Content-Type"]="application/json",be(n,h);let u=r&&r.headers?r.headers:{};return l.headers={...c,...u,...t.headers},l.data=vs(e,l,i),{url:Te(n),options:l}},deleteUser:async(e,t={})=>{Le("deleteUser","userId",e);const s="/Users/{userId}".replace("{userId}",encodeURIComponent(String(e))),n=new URL(s,Se);let r;i&&(r=i.baseOptions);const l={method:"DELETE",...r,...t},c={},h={};await Re(c,"Authorization",i),be(n,h);let u=r&&r.headers?r.headers:{};return l.headers={...c,...u,...t.headers},{url:Te(n),options:l}},forgotPassword:async(e,t={})=>{Le("forgotPassword","forgotPasswordDto",e);const s="/Users/ForgotPassword",n=new URL(s,Se);let r;i&&(r=i.baseOptions);const l={method:"POST",...r,...t},c={},h={};c["Content-Type"]="application/json",be(n,h);let u=r&&r.headers?r.headers:{};return l.headers={...c,...u,...t.headers},l.data=vs(e,l,i),{url:Te(n),options:l}},forgotPasswordPin:async(e,t={})=>{Le("forgotPasswordPin","forgotPasswordPinDto",e);const s="/Users/ForgotPassword/Pin",n=new URL(s,Se);let r;i&&(r=i.baseOptions);const l={method:"POST",...r,...t},c={},h={};c["Content-Type"]="application/json",be(n,h);let u=r&&r.headers?r.headers:{};return l.headers={...c,...u,...t.headers},l.data=vs(e,l,i),{url:Te(n),options:l}},getCurrentUser:async(e={})=>{const t="/Users/Me",s=new URL(t,Se);let n;i&&(n=i.baseOptions);const r={method:"GET",...n,...e},l={},c={};await Re(l,"Authorization",i),be(s,c);let h=n&&n.headers?n.headers:{};return r.headers={...l,...h,...e.headers},{url:Te(s),options:r}},getPublicUsers:async(e={})=>{const t="/Users/Public",s=new URL(t,Se);let n;i&&(n=i.baseOptions);const r={method:"GET",...n,...e},l={};be(s,{});let h=n&&n.headers?n.headers:{};return r.headers={...l,...h,...e.headers},{url:Te(s),options:r}},getUserById:async(e,t={})=>{Le("getUserById","userId",e);const s="/Users/{userId}".replace("{userId}",encodeURIComponent(String(e))),n=new URL(s,Se);let r;i&&(r=i.baseOptions);const l={method:"GET",...r,...t},c={},h={};await Re(c,"Authorization",i),be(n,h);let u=r&&r.headers?r.headers:{};return l.headers={...c,...u,...t.headers},{url:Te(n),options:l}},getUsers:async(e,t,s={})=>{const n="/Users",r=new URL(n,Se);let l;i&&(l=i.baseOptions);const c={method:"GET",...l,...s},h={},u={};await Re(h,"Authorization",i),e!==void 0&&(u.isHidden=e),t!==void 0&&(u.isDisabled=t),be(r,u);let f=l&&l.headers?l.headers:{};return c.headers={...h,...f,...s.headers},{url:Te(r),options:c}},updateUser:async(e,t,s={})=>{Le("updateUser","userDto",e);const n="/Users",r=new URL(n,Se);let l;i&&(l=i.baseOptions);const c={method:"POST",...l,...s},h={},u={};await Re(h,"Authorization",i),t!==void 0&&(u.userId=t),h["Content-Type"]="application/json",be(r,u);let f=l&&l.headers?l.headers:{};return c.headers={...h,...f,...s.headers},c.data=vs(e,c,i),{url:Te(r),options:c}},updateUserConfiguration:async(e,t,s={})=>{Le("updateUserConfiguration","userConfiguration",e);const n="/Users/Configuration",r=new URL(n,Se);let l;i&&(l=i.baseOptions);const c={method:"POST",...l,...s},h={},u={};await Re(h,"Authorization",i),t!==void 0&&(u.userId=t),h["Content-Type"]="application/json",be(r,u);let f=l&&l.headers?l.headers:{};return c.headers={...h,...f,...s.headers},c.data=vs(e,c,i),{url:Te(r),options:c}},updateUserPassword:async(e,t,s={})=>{Le("updateUserPassword","updateUserPassword",e);const n="/Users/Password",r=new URL(n,Se);let l;i&&(l=i.baseOptions);const c={method:"POST",...l,...s},h={},u={};await Re(h,"Authorization",i),t!==void 0&&(u.userId=t),h["Content-Type"]="application/json",be(r,u);let f=l&&l.headers?l.headers:{};return c.headers={...h,...f,...s.headers},c.data=vs(e,c,i),{url:Te(r),options:c}},updateUserPolicy:async(e,t,s={})=>{Le("updateUserPolicy","userId",e),Le("updateUserPolicy","userPolicy",t);const n="/Users/{userId}/Policy".replace("{userId}",encodeURIComponent(String(e))),r=new URL(n,Se);let l;i&&(l=i.baseOptions);const c={method:"POST",...l,...s},h={},u={};await Re(h,"Authorization",i),h["Content-Type"]="application/json",be(r,u);let f=l&&l.headers?l.headers:{};return c.headers={...h,...f,...s.headers},c.data=vs(t,c,i),{url:Te(r),options:c}}}},qs=function(i){const e=sL(i);return{async authenticateUserByName(t,s){var n,r,l;const c=await e.authenticateUserByName(t,s),h=(n=i?.serverIndex)!==null&&n!==void 0?n:0,u=(l=(r=xe["UserApi.authenticateUserByName"])===null||r===void 0?void 0:r[h])===null||l===void 0?void 0:l.url;return(f,p)=>Ee(c,le,ve,i)(f,u||p)},async authenticateWithQuickConnect(t,s){var n,r,l;const c=await e.authenticateWithQuickConnect(t,s),h=(n=i?.serverIndex)!==null&&n!==void 0?n:0,u=(l=(r=xe["UserApi.authenticateWithQuickConnect"])===null||r===void 0?void 0:r[h])===null||l===void 0?void 0:l.url;return(f,p)=>Ee(c,le,ve,i)(f,u||p)},async createUserByName(t,s){var n,r,l;const c=await e.createUserByName(t,s),h=(n=i?.serverIndex)!==null&&n!==void 0?n:0,u=(l=(r=xe["UserApi.createUserByName"])===null||r===void 0?void 0:r[h])===null||l===void 0?void 0:l.url;return(f,p)=>Ee(c,le,ve,i)(f,u||p)},async deleteUser(t,s){var n,r,l;const c=await e.deleteUser(t,s),h=(n=i?.serverIndex)!==null&&n!==void 0?n:0,u=(l=(r=xe["UserApi.deleteUser"])===null||r===void 0?void 0:r[h])===null||l===void 0?void 0:l.url;return(f,p)=>Ee(c,le,ve,i)(f,u||p)},async forgotPassword(t,s){var n,r,l;const c=await e.forgotPassword(t,s),h=(n=i?.serverIndex)!==null&&n!==void 0?n:0,u=(l=(r=xe["UserApi.forgotPassword"])===null||r===void 0?void 0:r[h])===null||l===void 0?void 0:l.url;return(f,p)=>Ee(c,le,ve,i)(f,u||p)},async forgotPasswordPin(t,s){var n,r,l;const c=await e.forgotPasswordPin(t,s),h=(n=i?.serverIndex)!==null&&n!==void 0?n:0,u=(l=(r=xe["UserApi.forgotPasswordPin"])===null||r===void 0?void 0:r[h])===null||l===void 0?void 0:l.url;return(f,p)=>Ee(c,le,ve,i)(f,u||p)},async getCurrentUser(t){var s,n,r;const l=await e.getCurrentUser(t),c=(s=i?.serverIndex)!==null&&s!==void 0?s:0,h=(r=(n=xe["UserApi.getCurrentUser"])===null||n===void 0?void 0:n[c])===null||r===void 0?void 0:r.url;return(u,f)=>Ee(l,le,ve,i)(u,h||f)},async getPublicUsers(t){var s,n,r;const l=await e.getPublicUsers(t),c=(s=i?.serverIndex)!==null&&s!==void 0?s:0,h=(r=(n=xe["UserApi.getPublicUsers"])===null||n===void 0?void 0:n[c])===null||r===void 0?void 0:r.url;return(u,f)=>Ee(l,le,ve,i)(u,h||f)},async getUserById(t,s){var n,r,l;const c=await e.getUserById(t,s),h=(n=i?.serverIndex)!==null&&n!==void 0?n:0,u=(l=(r=xe["UserApi.getUserById"])===null||r===void 0?void 0:r[h])===null||l===void 0?void 0:l.url;return(f,p)=>Ee(c,le,ve,i)(f,u||p)},async getUsers(t,s,n){var r,l,c;const h=await e.getUsers(t,s,n),u=(r=i?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=xe["UserApi.getUsers"])===null||l===void 0?void 0:l[u])===null||c===void 0?void 0:c.url;return(p,v)=>Ee(h,le,ve,i)(p,f||v)},async updateUser(t,s,n){var r,l,c;const h=await e.updateUser(t,s,n),u=(r=i?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=xe["UserApi.updateUser"])===null||l===void 0?void 0:l[u])===null||c===void 0?void 0:c.url;return(p,v)=>Ee(h,le,ve,i)(p,f||v)},async updateUserConfiguration(t,s,n){var r,l,c;const h=await e.updateUserConfiguration(t,s,n),u=(r=i?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=xe["UserApi.updateUserConfiguration"])===null||l===void 0?void 0:l[u])===null||c===void 0?void 0:c.url;return(p,v)=>Ee(h,le,ve,i)(p,f||v)},async updateUserPassword(t,s,n){var r,l,c;const h=await e.updateUserPassword(t,s,n),u=(r=i?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=xe["UserApi.updateUserPassword"])===null||l===void 0?void 0:l[u])===null||c===void 0?void 0:c.url;return(p,v)=>Ee(h,le,ve,i)(p,f||v)},async updateUserPolicy(t,s,n){var r,l,c;const h=await e.updateUserPolicy(t,s,n),u=(r=i?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=xe["UserApi.updateUserPolicy"])===null||l===void 0?void 0:l[u])===null||c===void 0?void 0:c.url;return(p,v)=>Ee(h,le,ve,i)(p,f||v)}}};class xS extends cn{authenticateUserByName(e,t){return qs(this.configuration).authenticateUserByName(e.authenticateUserByName,t).then(s=>s(this.axios,this.basePath))}authenticateWithQuickConnect(e,t){return qs(this.configuration).authenticateWithQuickConnect(e.quickConnectDto,t).then(s=>s(this.axios,this.basePath))}createUserByName(e,t){return qs(this.configuration).createUserByName(e.createUserByName,t).then(s=>s(this.axios,this.basePath))}deleteUser(e,t){return qs(this.configuration).deleteUser(e.userId,t).then(s=>s(this.axios,this.basePath))}forgotPassword(e,t){return qs(this.configuration).forgotPassword(e.forgotPasswordDto,t).then(s=>s(this.axios,this.basePath))}forgotPasswordPin(e,t){return qs(this.configuration).forgotPasswordPin(e.forgotPasswordPinDto,t).then(s=>s(this.axios,this.basePath))}getCurrentUser(e){return qs(this.configuration).getCurrentUser(e).then(t=>t(this.axios,this.basePath))}getPublicUsers(e){return qs(this.configuration).getPublicUsers(e).then(t=>t(this.axios,this.basePath))}getUserById(e,t){return qs(this.configuration).getUserById(e.userId,t).then(s=>s(this.axios,this.basePath))}getUsers(e={},t){return qs(this.configuration).getUsers(e.isHidden,e.isDisabled,t).then(s=>s(this.axios,this.basePath))}updateUser(e,t){return qs(this.configuration).updateUser(e.userDto,e.userId,t).then(s=>s(this.axios,this.basePath))}updateUserConfiguration(e,t){return qs(this.configuration).updateUserConfiguration(e.userConfiguration,e.userId,t).then(s=>s(this.axios,this.basePath))}updateUserPassword(e,t){return qs(this.configuration).updateUserPassword(e.updateUserPassword,e.userId,t).then(s=>s(this.axios,this.basePath))}updateUserPolicy(e,t){return qs(this.configuration).updateUserPolicy(e.userId,e.userPolicy,t).then(s=>s(this.axios,this.basePath))}}class iL extends xS{constructor(e){super(e.configuration,void 0,e.axiosInstance),this.api=e}authenticateUserByName(e,t){return super.authenticateUserByName(e,t).then(s=>(this.api.accessToken=s.data.AccessToken||"",s))}authenticateWithQuickConnect(e,t){return super.authenticateWithQuickConnect(e,t).then(s=>(this.api.accessToken=s.data.AccessToken||"",s))}}function nL(i){return new iL(i)}const aL="Authorization";class rL{constructor(e,t,s,n="",r=le){this.basePath=e.endsWith("/")?e.slice(0,-1):e,this.clientInfo=t,this.deviceInfo=s,this.accessToken=n,this.axiosInstance=r}get configuration(){return new XR({basePath:this.basePath,baseOptions:{headers:{[aL]:this.authorizationHeader}}})}authenticateUserByName(e,t){return nL(this).authenticateUserByName({authenticateUserByName:{Username:e,Pw:t}})}getUri(e,t){return this.axiosInstance.getUri({baseURL:this.basePath,url:e,params:t})}logout(){return tL(this).reportSessionEnded()}get authorizationHeader(){return WR(this.clientInfo,this.deviceInfo,this.accessToken)}}class lL{constructor(e){this.clientInfo=e.clientInfo,this.deviceInfo=e.deviceInfo,this.discovery=new QR(this)}createApi(e,t,s){return new rL(e,this.clientInfo,this.deviceInfo,t,s)}}const oL=function(i){return{deleteUserItemRating:async(e,t,s={})=>{Le("deleteUserItemRating","itemId",e);const n="/UserItems/{itemId}/Rating".replace("{itemId}",encodeURIComponent(String(e))),r=new URL(n,Se);let l;i&&(l=i.baseOptions);const c={method:"DELETE",...l,...s},h={},u={};await Re(h,"Authorization",i),t!==void 0&&(u.userId=t),be(r,u);let f=l&&l.headers?l.headers:{};return c.headers={...h,...f,...s.headers},{url:Te(r),options:c}},getIntros:async(e,t,s={})=>{Le("getIntros","itemId",e);const n="/Items/{itemId}/Intros".replace("{itemId}",encodeURIComponent(String(e))),r=new URL(n,Se);let l;i&&(l=i.baseOptions);const c={method:"GET",...l,...s},h={},u={};await Re(h,"Authorization",i),t!==void 0&&(u.userId=t),be(r,u);let f=l&&l.headers?l.headers:{};return c.headers={...h,...f,...s.headers},{url:Te(r),options:c}},getItem:async(e,t,s={})=>{Le("getItem","itemId",e);const n="/Items/{itemId}".replace("{itemId}",encodeURIComponent(String(e))),r=new URL(n,Se);let l;i&&(l=i.baseOptions);const c={method:"GET",...l,...s},h={},u={};await Re(h,"Authorization",i),t!==void 0&&(u.userId=t),be(r,u);let f=l&&l.headers?l.headers:{};return c.headers={...h,...f,...s.headers},{url:Te(r),options:c}},getLatestMedia:async(e,t,s,n,r,l,c,h,u,f,p,v={})=>{const x="/Items/Latest",S=new URL(x,Se);let E;i&&(E=i.baseOptions);const T={method:"GET",...E,...v},A={},I={};await Re(A,"Authorization",i),e!==void 0&&(I.userId=e),t!==void 0&&(I.parentId=t),s&&(I.fields=s),n&&(I.includeItemTypes=n),r!==void 0&&(I.isPlayed=r),l!==void 0&&(I.enableImages=l),c!==void 0&&(I.imageTypeLimit=c),h&&(I.enableImageTypes=h),u!==void 0&&(I.enableUserData=u),f!==void 0&&(I.limit=f),p!==void 0&&(I.groupItems=p),be(S,I);let _=E&&E.headers?E.headers:{};return T.headers={...A,..._,...v.headers},{url:Te(S),options:T}},getLocalTrailers:async(e,t,s={})=>{Le("getLocalTrailers","itemId",e);const n="/Items/{itemId}/LocalTrailers".replace("{itemId}",encodeURIComponent(String(e))),r=new URL(n,Se);let l;i&&(l=i.baseOptions);const c={method:"GET",...l,...s},h={},u={};await Re(h,"Authorization",i),t!==void 0&&(u.userId=t),be(r,u);let f=l&&l.headers?l.headers:{};return c.headers={...h,...f,...s.headers},{url:Te(r),options:c}},getRootFolder:async(e,t={})=>{const s="/Items/Root",n=new URL(s,Se);let r;i&&(r=i.baseOptions);const l={method:"GET",...r,...t},c={},h={};await Re(c,"Authorization",i),e!==void 0&&(h.userId=e),be(n,h);let u=r&&r.headers?r.headers:{};return l.headers={...c,...u,...t.headers},{url:Te(n),options:l}},getSpecialFeatures:async(e,t,s={})=>{Le("getSpecialFeatures","itemId",e);const n="/Items/{itemId}/SpecialFeatures".replace("{itemId}",encodeURIComponent(String(e))),r=new URL(n,Se);let l;i&&(l=i.baseOptions);const c={method:"GET",...l,...s},h={},u={};await Re(h,"Authorization",i),t!==void 0&&(u.userId=t),be(r,u);let f=l&&l.headers?l.headers:{};return c.headers={...h,...f,...s.headers},{url:Te(r),options:c}},markFavoriteItem:async(e,t,s={})=>{Le("markFavoriteItem","itemId",e);const n="/UserFavoriteItems/{itemId}".replace("{itemId}",encodeURIComponent(String(e))),r=new URL(n,Se);let l;i&&(l=i.baseOptions);const c={method:"POST",...l,...s},h={},u={};await Re(h,"Authorization",i),t!==void 0&&(u.userId=t),be(r,u);let f=l&&l.headers?l.headers:{};return c.headers={...h,...f,...s.headers},{url:Te(r),options:c}},unmarkFavoriteItem:async(e,t,s={})=>{Le("unmarkFavoriteItem","itemId",e);const n="/UserFavoriteItems/{itemId}".replace("{itemId}",encodeURIComponent(String(e))),r=new URL(n,Se);let l;i&&(l=i.baseOptions);const c={method:"DELETE",...l,...s},h={},u={};await Re(h,"Authorization",i),t!==void 0&&(u.userId=t),be(r,u);let f=l&&l.headers?l.headers:{};return c.headers={...h,...f,...s.headers},{url:Te(r),options:c}},updateUserItemRating:async(e,t,s,n={})=>{Le("updateUserItemRating","itemId",e);const r="/UserItems/{itemId}/Rating".replace("{itemId}",encodeURIComponent(String(e))),l=new URL(r,Se);let c;i&&(c=i.baseOptions);const h={method:"POST",...c,...n},u={},f={};await Re(u,"Authorization",i),t!==void 0&&(f.userId=t),s!==void 0&&(f.likes=s),be(l,f);let p=c&&c.headers?c.headers:{};return h.headers={...u,...p,...n.headers},{url:Te(l),options:h}}}},Zi=function(i){const e=oL(i);return{async deleteUserItemRating(t,s,n){var r,l,c;const h=await e.deleteUserItemRating(t,s,n),u=(r=i?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=xe["UserLibraryApi.deleteUserItemRating"])===null||l===void 0?void 0:l[u])===null||c===void 0?void 0:c.url;return(p,v)=>Ee(h,le,ve,i)(p,f||v)},async getIntros(t,s,n){var r,l,c;const h=await e.getIntros(t,s,n),u=(r=i?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=xe["UserLibraryApi.getIntros"])===null||l===void 0?void 0:l[u])===null||c===void 0?void 0:c.url;return(p,v)=>Ee(h,le,ve,i)(p,f||v)},async getItem(t,s,n){var r,l,c;const h=await e.getItem(t,s,n),u=(r=i?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=xe["UserLibraryApi.getItem"])===null||l===void 0?void 0:l[u])===null||c===void 0?void 0:c.url;return(p,v)=>Ee(h,le,ve,i)(p,f||v)},async getLatestMedia(t,s,n,r,l,c,h,u,f,p,v,x){var S,E,T;const A=await e.getLatestMedia(t,s,n,r,l,c,h,u,f,p,v,x),I=(S=i?.serverIndex)!==null&&S!==void 0?S:0,_=(T=(E=xe["UserLibraryApi.getLatestMedia"])===null||E===void 0?void 0:E[I])===null||T===void 0?void 0:T.url;return(C,k)=>Ee(A,le,ve,i)(C,_||k)},async getLocalTrailers(t,s,n){var r,l,c;const h=await e.getLocalTrailers(t,s,n),u=(r=i?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=xe["UserLibraryApi.getLocalTrailers"])===null||l===void 0?void 0:l[u])===null||c===void 0?void 0:c.url;return(p,v)=>Ee(h,le,ve,i)(p,f||v)},async getRootFolder(t,s){var n,r,l;const c=await e.getRootFolder(t,s),h=(n=i?.serverIndex)!==null&&n!==void 0?n:0,u=(l=(r=xe["UserLibraryApi.getRootFolder"])===null||r===void 0?void 0:r[h])===null||l===void 0?void 0:l.url;return(f,p)=>Ee(c,le,ve,i)(f,u||p)},async getSpecialFeatures(t,s,n){var r,l,c;const h=await e.getSpecialFeatures(t,s,n),u=(r=i?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=xe["UserLibraryApi.getSpecialFeatures"])===null||l===void 0?void 0:l[u])===null||c===void 0?void 0:c.url;return(p,v)=>Ee(h,le,ve,i)(p,f||v)},async markFavoriteItem(t,s,n){var r,l,c;const h=await e.markFavoriteItem(t,s,n),u=(r=i?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=xe["UserLibraryApi.markFavoriteItem"])===null||l===void 0?void 0:l[u])===null||c===void 0?void 0:c.url;return(p,v)=>Ee(h,le,ve,i)(p,f||v)},async unmarkFavoriteItem(t,s,n){var r,l,c;const h=await e.unmarkFavoriteItem(t,s,n),u=(r=i?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=xe["UserLibraryApi.unmarkFavoriteItem"])===null||l===void 0?void 0:l[u])===null||c===void 0?void 0:c.url;return(p,v)=>Ee(h,le,ve,i)(p,f||v)},async updateUserItemRating(t,s,n,r){var l,c,h;const u=await e.updateUserItemRating(t,s,n,r),f=(l=i?.serverIndex)!==null&&l!==void 0?l:0,p=(h=(c=xe["UserLibraryApi.updateUserItemRating"])===null||c===void 0?void 0:c[f])===null||h===void 0?void 0:h.url;return(v,x)=>Ee(u,le,ve,i)(v,p||x)}}};class cL extends cn{deleteUserItemRating(e,t){return Zi(this.configuration).deleteUserItemRating(e.itemId,e.userId,t).then(s=>s(this.axios,this.basePath))}getIntros(e,t){return Zi(this.configuration).getIntros(e.itemId,e.userId,t).then(s=>s(this.axios,this.basePath))}getItem(e,t){return Zi(this.configuration).getItem(e.itemId,e.userId,t).then(s=>s(this.axios,this.basePath))}getLatestMedia(e={},t){return Zi(this.configuration).getLatestMedia(e.userId,e.parentId,e.fields,e.includeItemTypes,e.isPlayed,e.enableImages,e.imageTypeLimit,e.enableImageTypes,e.enableUserData,e.limit,e.groupItems,t).then(s=>s(this.axios,this.basePath))}getLocalTrailers(e,t){return Zi(this.configuration).getLocalTrailers(e.itemId,e.userId,t).then(s=>s(this.axios,this.basePath))}getRootFolder(e={},t){return Zi(this.configuration).getRootFolder(e.userId,t).then(s=>s(this.axios,this.basePath))}getSpecialFeatures(e,t){return Zi(this.configuration).getSpecialFeatures(e.itemId,e.userId,t).then(s=>s(this.axios,this.basePath))}markFavoriteItem(e,t){return Zi(this.configuration).markFavoriteItem(e.itemId,e.userId,t).then(s=>s(this.axios,this.basePath))}unmarkFavoriteItem(e,t){return Zi(this.configuration).unmarkFavoriteItem(e.itemId,e.userId,t).then(s=>s(this.axios,this.basePath))}updateUserItemRating(e,t){return Zi(this.configuration).updateUserItemRating(e.itemId,e.userId,e.likes,t).then(s=>s(this.axios,this.basePath))}}const uL=function(i){return{getGroupingOptions:async(e,t={})=>{const s="/UserViews/GroupingOptions",n=new URL(s,Se);let r;i&&(r=i.baseOptions);const l={method:"GET",...r,...t},c={},h={};await Re(c,"Authorization",i),e!==void 0&&(h.userId=e),be(n,h);let u=r&&r.headers?r.headers:{};return l.headers={...c,...u,...t.headers},{url:Te(n),options:l}},getUserViews:async(e,t,s,n,r={})=>{const l="/UserViews",c=new URL(l,Se);let h;i&&(h=i.baseOptions);const u={method:"GET",...h,...r},f={},p={};await Re(f,"Authorization",i),e!==void 0&&(p.userId=e),t!==void 0&&(p.includeExternalContent=t),s&&(p.presetViews=s),n!==void 0&&(p.includeHidden=n),be(c,p);let v=h&&h.headers?h.headers:{};return u.headers={...f,...v,...r.headers},{url:Te(c),options:u}}}},ty=function(i){const e=uL(i);return{async getGroupingOptions(t,s){var n,r,l;const c=await e.getGroupingOptions(t,s),h=(n=i?.serverIndex)!==null&&n!==void 0?n:0,u=(l=(r=xe["UserViewsApi.getGroupingOptions"])===null||r===void 0?void 0:r[h])===null||l===void 0?void 0:l.url;return(f,p)=>Ee(c,le,ve,i)(f,u||p)},async getUserViews(t,s,n,r,l){var c,h,u;const f=await e.getUserViews(t,s,n,r,l),p=(c=i?.serverIndex)!==null&&c!==void 0?c:0,v=(u=(h=xe["UserViewsApi.getUserViews"])===null||h===void 0?void 0:h[p])===null||u===void 0?void 0:u.url;return(x,S)=>Ee(f,le,ve,i)(x,v||S)}}};class dL extends cn{getGroupingOptions(e={},t){return ty(this.configuration).getGroupingOptions(e.userId,t).then(s=>s(this.axios,this.basePath))}getUserViews(e={},t){return ty(this.configuration).getUserViews(e.userId,e.includeExternalContent,e.presetViews,e.includeHidden,t).then(s=>s(this.axios,this.basePath))}}const hL=function(i){return{getItemUserData:async(e,t,s={})=>{Le("getItemUserData","itemId",e);const n="/UserItems/{itemId}/UserData".replace("{itemId}",encodeURIComponent(String(e))),r=new URL(n,Se);let l;i&&(l=i.baseOptions);const c={method:"GET",...l,...s},h={},u={};await Re(h,"Authorization",i),t!==void 0&&(u.userId=t),be(r,u);let f=l&&l.headers?l.headers:{};return c.headers={...h,...f,...s.headers},{url:Te(r),options:c}},getItems:async(e,t,s,n,r,l,c,h,u,f,p,v,x,S,E,T,A,I,_,C,k,U,O,F,j,M,H,K,te,ae,me,D,G,Y,oe,pe,P,V,se,he,ye,Ae,Pe,He,Be,ht,dt,Mt,bt,Tt,os,Ve,we,Me,Qe,ge,_e,De,at,st,Bt,ts,ys,xs,Ss,Cs,Ht,Bs,bs,Vt,fs,Et,xi,ei,ti,ms,Wt,Us,ss,Ms,cs,Vs,Si,si,Nt,Ui,Mi={})=>{const Ki="/Items",ue=new URL(Ki,Se);let Ne;i&&(Ne=i.baseOptions);const Xe={method:"GET",...Ne,...Mi},zt={},Ie={};await Re(zt,"Authorization",i),e!==void 0&&(Ie.userId=e),t!==void 0&&(Ie.maxOfficialRating=t),s!==void 0&&(Ie.hasThemeSong=s),n!==void 0&&(Ie.hasThemeVideo=n),r!==void 0&&(Ie.hasSubtitles=r),l!==void 0&&(Ie.hasSpecialFeature=l),c!==void 0&&(Ie.hasTrailer=c),h!==void 0&&(Ie.adjacentTo=h),u!==void 0&&(Ie.indexNumber=u),f!==void 0&&(Ie.parentIndexNumber=f),p!==void 0&&(Ie.hasParentalRating=p),v!==void 0&&(Ie.isHd=v),x!==void 0&&(Ie.is4K=x),S&&(Ie.locationTypes=S),E&&(Ie.excludeLocationTypes=E),T!==void 0&&(Ie.isMissing=T),A!==void 0&&(Ie.isUnaired=A),I!==void 0&&(Ie.minCommunityRating=I),_!==void 0&&(Ie.minCriticRating=_),C!==void 0&&(Ie.minPremiereDate=C instanceof Date?C.toISOString():C),k!==void 0&&(Ie.minDateLastSaved=k instanceof Date?k.toISOString():k),U!==void 0&&(Ie.minDateLastSavedForUser=U instanceof Date?U.toISOString():U),O!==void 0&&(Ie.maxPremiereDate=O instanceof Date?O.toISOString():O),F!==void 0&&(Ie.hasOverview=F),j!==void 0&&(Ie.hasImdbId=j),M!==void 0&&(Ie.hasTmdbId=M),H!==void 0&&(Ie.hasTvdbId=H),K!==void 0&&(Ie.isMovie=K),te!==void 0&&(Ie.isSeries=te),ae!==void 0&&(Ie.isNews=ae),me!==void 0&&(Ie.isKids=me),D!==void 0&&(Ie.isSports=D),G&&(Ie.excludeItemIds=G),Y!==void 0&&(Ie.startIndex=Y),oe!==void 0&&(Ie.limit=oe),pe!==void 0&&(Ie.recursive=pe),P!==void 0&&(Ie.searchTerm=P),V&&(Ie.sortOrder=V),se!==void 0&&(Ie.parentId=se),he&&(Ie.fields=he),ye&&(Ie.excludeItemTypes=ye),Ae&&(Ie.includeItemTypes=Ae),Pe&&(Ie.filters=Pe),He!==void 0&&(Ie.isFavorite=He),Be&&(Ie.mediaTypes=Be),ht&&(Ie.imageTypes=ht),dt&&(Ie.sortBy=dt),Mt!==void 0&&(Ie.isPlayed=Mt),bt&&(Ie.genres=bt),Tt&&(Ie.officialRatings=Tt),os&&(Ie.tags=os),Ve&&(Ie.years=Ve),we!==void 0&&(Ie.enableUserData=we),Me!==void 0&&(Ie.imageTypeLimit=Me),Qe&&(Ie.enableImageTypes=Qe),ge!==void 0&&(Ie.person=ge),_e&&(Ie.personIds=_e),De&&(Ie.personTypes=De),at&&(Ie.studios=at),st&&(Ie.artists=st),Bt&&(Ie.excludeArtistIds=Bt),ts&&(Ie.artistIds=ts),ys&&(Ie.albumArtistIds=ys),xs&&(Ie.contributingArtistIds=xs),Ss&&(Ie.albums=Ss),Cs&&(Ie.albumIds=Cs),Ht&&(Ie.ids=Ht),Bs&&(Ie.videoTypes=Bs),bs!==void 0&&(Ie.minOfficialRating=bs),Vt!==void 0&&(Ie.isLocked=Vt),fs!==void 0&&(Ie.isPlaceHolder=fs),Et!==void 0&&(Ie.hasOfficialRating=Et),xi!==void 0&&(Ie.collapseBoxSetItems=xi),ei!==void 0&&(Ie.minWidth=ei),ti!==void 0&&(Ie.minHeight=ti),ms!==void 0&&(Ie.maxWidth=ms),Wt!==void 0&&(Ie.maxHeight=Wt),Us!==void 0&&(Ie.is3D=Us),ss&&(Ie.seriesStatus=ss),Ms!==void 0&&(Ie.nameStartsWithOrGreater=Ms),cs!==void 0&&(Ie.nameStartsWith=cs),Vs!==void 0&&(Ie.nameLessThan=Vs),Si&&(Ie.studioIds=Si),si&&(Ie.genreIds=si),Nt!==void 0&&(Ie.enableTotalRecordCount=Nt),Ui!==void 0&&(Ie.enableImages=Ui),be(ue,Ie);let Ts=Ne&&Ne.headers?Ne.headers:{};return Xe.headers={...zt,...Ts,...Mi.headers},{url:Te(ue),options:Xe}},getResumeItems:async(e,t,s,n,r,l,c,h,u,f,p,v,x,S,E,T={})=>{const A="/UserItems/Resume",I=new URL(A,Se);let _;i&&(_=i.baseOptions);const C={method:"GET",..._,...T},k={},U={};await Re(k,"Authorization",i),e!==void 0&&(U.userId=e),t!==void 0&&(U.startIndex=t),s!==void 0&&(U.limit=s),n!==void 0&&(U.searchTerm=n),r!==void 0&&(U.parentId=r),l&&(U.fields=l),c&&(U.mediaTypes=c),h!==void 0&&(U.enableUserData=h),u!==void 0&&(U.imageTypeLimit=u),f&&(U.enableImageTypes=f),p&&(U.excludeItemTypes=p),v&&(U.includeItemTypes=v),x!==void 0&&(U.enableTotalRecordCount=x),S!==void 0&&(U.enableImages=S),E!==void 0&&(U.excludeActiveSessions=E),be(I,U);let O=_&&_.headers?_.headers:{};return C.headers={...k,...O,...T.headers},{url:Te(I),options:C}},updateItemUserData:async(e,t,s,n={})=>{Le("updateItemUserData","itemId",e),Le("updateItemUserData","updateUserItemDataDto",t);const r="/UserItems/{itemId}/UserData".replace("{itemId}",encodeURIComponent(String(e))),l=new URL(r,Se);let c;i&&(c=i.baseOptions);const h={method:"POST",...c,...n},u={},f={};await Re(u,"Authorization",i),s!==void 0&&(f.userId=s),u["Content-Type"]="application/json",be(l,f);let p=c&&c.headers?c.headers:{};return h.headers={...u,...p,...n.headers},h.data=vs(t,h,i),{url:Te(l),options:h}}}},wc=function(i){const e=hL(i);return{async getItemUserData(t,s,n){var r,l,c;const h=await e.getItemUserData(t,s,n),u=(r=i?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=xe["ItemsApi.getItemUserData"])===null||l===void 0?void 0:l[u])===null||c===void 0?void 0:c.url;return(p,v)=>Ee(h,le,ve,i)(p,f||v)},async getItems(t,s,n,r,l,c,h,u,f,p,v,x,S,E,T,A,I,_,C,k,U,O,F,j,M,H,K,te,ae,me,D,G,Y,oe,pe,P,V,se,he,ye,Ae,Pe,He,Be,ht,dt,Mt,bt,Tt,os,Ve,we,Me,Qe,ge,_e,De,at,st,Bt,ts,ys,xs,Ss,Cs,Ht,Bs,bs,Vt,fs,Et,xi,ei,ti,ms,Wt,Us,ss,Ms,cs,Vs,Si,si,Nt,Ui,Mi,Ki){var ue,Ne,Xe;const zt=await e.getItems(t,s,n,r,l,c,h,u,f,p,v,x,S,E,T,A,I,_,C,k,U,O,F,j,M,H,K,te,ae,me,D,G,Y,oe,pe,P,V,se,he,ye,Ae,Pe,He,Be,ht,dt,Mt,bt,Tt,os,Ve,we,Me,Qe,ge,_e,De,at,st,Bt,ts,ys,xs,Ss,Cs,Ht,Bs,bs,Vt,fs,Et,xi,ei,ti,ms,Wt,Us,ss,Ms,cs,Vs,Si,si,Nt,Ui,Mi,Ki),Ie=(ue=i?.serverIndex)!==null&&ue!==void 0?ue:0,Ts=(Xe=(Ne=xe["ItemsApi.getItems"])===null||Ne===void 0?void 0:Ne[Ie])===null||Xe===void 0?void 0:Xe.url;return(gt,At)=>Ee(zt,le,ve,i)(gt,Ts||At)},async getResumeItems(t,s,n,r,l,c,h,u,f,p,v,x,S,E,T,A){var I,_,C;const k=await e.getResumeItems(t,s,n,r,l,c,h,u,f,p,v,x,S,E,T,A),U=(I=i?.serverIndex)!==null&&I!==void 0?I:0,O=(C=(_=xe["ItemsApi.getResumeItems"])===null||_===void 0?void 0:_[U])===null||C===void 0?void 0:C.url;return(F,j)=>Ee(k,le,ve,i)(F,O||j)},async updateItemUserData(t,s,n,r){var l,c,h;const u=await e.updateItemUserData(t,s,n,r),f=(l=i?.serverIndex)!==null&&l!==void 0?l:0,p=(h=(c=xe["ItemsApi.updateItemUserData"])===null||c===void 0?void 0:c[f])===null||h===void 0?void 0:h.url;return(v,x)=>Ee(u,le,ve,i)(v,p||x)}}};class fL extends cn{getItemUserData(e,t){return wc(this.configuration).getItemUserData(e.itemId,e.userId,t).then(s=>s(this.axios,this.basePath))}getItems(e={},t){return wc(this.configuration).getItems(e.userId,e.maxOfficialRating,e.hasThemeSong,e.hasThemeVideo,e.hasSubtitles,e.hasSpecialFeature,e.hasTrailer,e.adjacentTo,e.indexNumber,e.parentIndexNumber,e.hasParentalRating,e.isHd,e.is4K,e.locationTypes,e.excludeLocationTypes,e.isMissing,e.isUnaired,e.minCommunityRating,e.minCriticRating,e.minPremiereDate,e.minDateLastSaved,e.minDateLastSavedForUser,e.maxPremiereDate,e.hasOverview,e.hasImdbId,e.hasTmdbId,e.hasTvdbId,e.isMovie,e.isSeries,e.isNews,e.isKids,e.isSports,e.excludeItemIds,e.startIndex,e.limit,e.recursive,e.searchTerm,e.sortOrder,e.parentId,e.fields,e.excludeItemTypes,e.includeItemTypes,e.filters,e.isFavorite,e.mediaTypes,e.imageTypes,e.sortBy,e.isPlayed,e.genres,e.officialRatings,e.tags,e.years,e.enableUserData,e.imageTypeLimit,e.enableImageTypes,e.person,e.personIds,e.personTypes,e.studios,e.artists,e.excludeArtistIds,e.artistIds,e.albumArtistIds,e.contributingArtistIds,e.albums,e.albumIds,e.ids,e.videoTypes,e.minOfficialRating,e.isLocked,e.isPlaceHolder,e.hasOfficialRating,e.collapseBoxSetItems,e.minWidth,e.minHeight,e.maxWidth,e.maxHeight,e.is3D,e.seriesStatus,e.nameStartsWithOrGreater,e.nameStartsWith,e.nameLessThan,e.studioIds,e.genreIds,e.enableTotalRecordCount,e.enableImages,t).then(s=>s(this.axios,this.basePath))}getResumeItems(e={},t){return wc(this.configuration).getResumeItems(e.userId,e.startIndex,e.limit,e.searchTerm,e.parentId,e.fields,e.mediaTypes,e.enableUserData,e.imageTypeLimit,e.enableImageTypes,e.excludeItemTypes,e.includeItemTypes,e.enableTotalRecordCount,e.enableImages,e.excludeActiveSessions,t).then(s=>s(this.axios,this.basePath))}updateItemUserData(e,t){return wc(this.configuration).updateItemUserData(e.itemId,e.updateUserItemDataDto,e.userId,t).then(s=>s(this.axios,this.basePath))}}const mL=function(i){return{getEpisodes:async(e,t,s,n,r,l,c,h,u,f,p,v,x,S,E,T={})=>{Le("getEpisodes","seriesId",e);const A="/Shows/{seriesId}/Episodes".replace("{seriesId}",encodeURIComponent(String(e))),I=new URL(A,Se);let _;i&&(_=i.baseOptions);const C={method:"GET",..._,...T},k={},U={};await Re(k,"Authorization",i),t!==void 0&&(U.userId=t),s&&(U.fields=s),n!==void 0&&(U.season=n),r!==void 0&&(U.seasonId=r),l!==void 0&&(U.isMissing=l),c!==void 0&&(U.adjacentTo=c),h!==void 0&&(U.startItemId=h),u!==void 0&&(U.startIndex=u),f!==void 0&&(U.limit=f),p!==void 0&&(U.enableImages=p),v!==void 0&&(U.imageTypeLimit=v),x&&(U.enableImageTypes=x),S!==void 0&&(U.enableUserData=S),E!==void 0&&(U.sortBy=E),be(I,U);let O=_&&_.headers?_.headers:{};return C.headers={...k,...O,...T.headers},{url:Te(I),options:C}},getNextUp:async(e,t,s,n,r,l,c,h,u,f,p,v,x,S,E,T={})=>{const A="/Shows/NextUp",I=new URL(A,Se);let _;i&&(_=i.baseOptions);const C={method:"GET",..._,...T},k={},U={};await Re(k,"Authorization",i),e!==void 0&&(U.userId=e),t!==void 0&&(U.startIndex=t),s!==void 0&&(U.limit=s),n&&(U.fields=n),r!==void 0&&(U.seriesId=r),l!==void 0&&(U.parentId=l),c!==void 0&&(U.enableImages=c),h!==void 0&&(U.imageTypeLimit=h),u&&(U.enableImageTypes=u),f!==void 0&&(U.enableUserData=f),p!==void 0&&(U.nextUpDateCutoff=p instanceof Date?p.toISOString():p),v!==void 0&&(U.enableTotalRecordCount=v),x!==void 0&&(U.disableFirstEpisode=x),S!==void 0&&(U.enableResumable=S),E!==void 0&&(U.enableRewatching=E),be(I,U);let O=_&&_.headers?_.headers:{};return C.headers={...k,...O,...T.headers},{url:Te(I),options:C}},getSeasons:async(e,t,s,n,r,l,c,h,u,f,p={})=>{Le("getSeasons","seriesId",e);const v="/Shows/{seriesId}/Seasons".replace("{seriesId}",encodeURIComponent(String(e))),x=new URL(v,Se);let S;i&&(S=i.baseOptions);const E={method:"GET",...S,...p},T={},A={};await Re(T,"Authorization",i),t!==void 0&&(A.userId=t),s&&(A.fields=s),n!==void 0&&(A.isSpecialSeason=n),r!==void 0&&(A.isMissing=r),l!==void 0&&(A.adjacentTo=l),c!==void 0&&(A.enableImages=c),h!==void 0&&(A.imageTypeLimit=h),u&&(A.enableImageTypes=u),f!==void 0&&(A.enableUserData=f),be(x,A);let I=S&&S.headers?S.headers:{};return E.headers={...T,...I,...p.headers},{url:Te(x),options:E}},getUpcomingEpisodes:async(e,t,s,n,r,l,c,h,u,f={})=>{const p="/Shows/Upcoming",v=new URL(p,Se);let x;i&&(x=i.baseOptions);const S={method:"GET",...x,...f},E={},T={};await Re(E,"Authorization",i),e!==void 0&&(T.userId=e),t!==void 0&&(T.startIndex=t),s!==void 0&&(T.limit=s),n&&(T.fields=n),r!==void 0&&(T.parentId=r),l!==void 0&&(T.enableImages=l),c!==void 0&&(T.imageTypeLimit=c),h&&(T.enableImageTypes=h),u!==void 0&&(T.enableUserData=u),be(v,T);let A=x&&x.headers?x.headers:{};return S.headers={...E,...A,...f.headers},{url:Te(v),options:S}}}},Cc=function(i){const e=mL(i);return{async getEpisodes(t,s,n,r,l,c,h,u,f,p,v,x,S,E,T,A){var I,_,C;const k=await e.getEpisodes(t,s,n,r,l,c,h,u,f,p,v,x,S,E,T,A),U=(I=i?.serverIndex)!==null&&I!==void 0?I:0,O=(C=(_=xe["TvShowsApi.getEpisodes"])===null||_===void 0?void 0:_[U])===null||C===void 0?void 0:C.url;return(F,j)=>Ee(k,le,ve,i)(F,O||j)},async getNextUp(t,s,n,r,l,c,h,u,f,p,v,x,S,E,T,A){var I,_,C;const k=await e.getNextUp(t,s,n,r,l,c,h,u,f,p,v,x,S,E,T,A),U=(I=i?.serverIndex)!==null&&I!==void 0?I:0,O=(C=(_=xe["TvShowsApi.getNextUp"])===null||_===void 0?void 0:_[U])===null||C===void 0?void 0:C.url;return(F,j)=>Ee(k,le,ve,i)(F,O||j)},async getSeasons(t,s,n,r,l,c,h,u,f,p,v){var x,S,E;const T=await e.getSeasons(t,s,n,r,l,c,h,u,f,p,v),A=(x=i?.serverIndex)!==null&&x!==void 0?x:0,I=(E=(S=xe["TvShowsApi.getSeasons"])===null||S===void 0?void 0:S[A])===null||E===void 0?void 0:E.url;return(_,C)=>Ee(T,le,ve,i)(_,I||C)},async getUpcomingEpisodes(t,s,n,r,l,c,h,u,f,p){var v,x,S;const E=await e.getUpcomingEpisodes(t,s,n,r,l,c,h,u,f,p),T=(v=i?.serverIndex)!==null&&v!==void 0?v:0,A=(S=(x=xe["TvShowsApi.getUpcomingEpisodes"])===null||x===void 0?void 0:x[T])===null||S===void 0?void 0:S.url;return(I,_)=>Ee(E,le,ve,i)(I,A||_)}}};class pL extends cn{getEpisodes(e,t){return Cc(this.configuration).getEpisodes(e.seriesId,e.userId,e.fields,e.season,e.seasonId,e.isMissing,e.adjacentTo,e.startItemId,e.startIndex,e.limit,e.enableImages,e.imageTypeLimit,e.enableImageTypes,e.enableUserData,e.sortBy,t).then(s=>s(this.axios,this.basePath))}getNextUp(e={},t){return Cc(this.configuration).getNextUp(e.userId,e.startIndex,e.limit,e.fields,e.seriesId,e.parentId,e.enableImages,e.imageTypeLimit,e.enableImageTypes,e.enableUserData,e.nextUpDateCutoff,e.enableTotalRecordCount,e.disableFirstEpisode,e.enableResumable,e.enableRewatching,t).then(s=>s(this.axios,this.basePath))}getSeasons(e,t){return Cc(this.configuration).getSeasons(e.seriesId,e.userId,e.fields,e.isSpecialSeason,e.isMissing,e.adjacentTo,e.enableImages,e.imageTypeLimit,e.enableImageTypes,e.enableUserData,t).then(s=>s(this.axios,this.basePath))}getUpcomingEpisodes(e={},t){return Cc(this.configuration).getUpcomingEpisodes(e.userId,e.startIndex,e.limit,e.fields,e.parentId,e.enableImages,e.imageTypeLimit,e.enableImageTypes,e.enableUserData,t).then(s=>s(this.axios,this.basePath))}}const gL=function(i){return{deleteItem:async(e,t={})=>{Le("deleteItem","itemId",e);const s="/Items/{itemId}".replace("{itemId}",encodeURIComponent(String(e))),n=new URL(s,Se);let r;i&&(r=i.baseOptions);const l={method:"DELETE",...r,...t},c={},h={};await Re(c,"Authorization",i),be(n,h);let u=r&&r.headers?r.headers:{};return l.headers={...c,...u,...t.headers},{url:Te(n),options:l}},deleteItems:async(e,t={})=>{const s="/Items",n=new URL(s,Se);let r;i&&(r=i.baseOptions);const l={method:"DELETE",...r,...t},c={},h={};await Re(c,"Authorization",i),e&&(h.ids=e),be(n,h);let u=r&&r.headers?r.headers:{};return l.headers={...c,...u,...t.headers},{url:Te(n),options:l}},getAncestors:async(e,t,s={})=>{Le("getAncestors","itemId",e);const n="/Items/{itemId}/Ancestors".replace("{itemId}",encodeURIComponent(String(e))),r=new URL(n,Se);let l;i&&(l=i.baseOptions);const c={method:"GET",...l,...s},h={},u={};await Re(h,"Authorization",i),t!==void 0&&(u.userId=t),be(r,u);let f=l&&l.headers?l.headers:{};return c.headers={...h,...f,...s.headers},{url:Te(r),options:c}},getCriticReviews:async(e,t={})=>{Le("getCriticReviews","itemId",e);const s="/Items/{itemId}/CriticReviews".replace("{itemId}",encodeURIComponent(String(e))),n=new URL(s,Se);let r;i&&(r=i.baseOptions);const l={method:"GET",...r,...t},c={},h={};await Re(c,"Authorization",i),be(n,h);let u=r&&r.headers?r.headers:{};return l.headers={...c,...u,...t.headers},{url:Te(n),options:l}},getDownload:async(e,t={})=>{Le("getDownload","itemId",e);const s="/Items/{itemId}/Download".replace("{itemId}",encodeURIComponent(String(e))),n=new URL(s,Se);let r;i&&(r=i.baseOptions);const l={method:"GET",...r,...t},c={},h={};await Re(c,"Authorization",i),be(n,h);let u=r&&r.headers?r.headers:{};return l.headers={...c,...u,...t.headers},{url:Te(n),options:l}},getFile:async(e,t={})=>{Le("getFile","itemId",e);const s="/Items/{itemId}/File".replace("{itemId}",encodeURIComponent(String(e))),n=new URL(s,Se);let r;i&&(r=i.baseOptions);const l={method:"GET",...r,...t},c={},h={};await Re(c,"Authorization",i),be(n,h);let u=r&&r.headers?r.headers:{};return l.headers={...c,...u,...t.headers},{url:Te(n),options:l}},getItemCounts:async(e,t,s={})=>{const n="/Items/Counts",r=new URL(n,Se);let l;i&&(l=i.baseOptions);const c={method:"GET",...l,...s},h={},u={};await Re(h,"Authorization",i),e!==void 0&&(u.userId=e),t!==void 0&&(u.isFavorite=t),be(r,u);let f=l&&l.headers?l.headers:{};return c.headers={...h,...f,...s.headers},{url:Te(r),options:c}},getLibraryOptionsInfo:async(e,t,s={})=>{const n="/Libraries/AvailableOptions",r=new URL(n,Se);let l;i&&(l=i.baseOptions);const c={method:"GET",...l,...s},h={},u={};await Re(h,"Authorization",i),e!==void 0&&(u.libraryContentType=e),t!==void 0&&(u.isNewLibrary=t),be(r,u);let f=l&&l.headers?l.headers:{};return c.headers={...h,...f,...s.headers},{url:Te(r),options:c}},getMediaFolders:async(e,t={})=>{const s="/Library/MediaFolders",n=new URL(s,Se);let r;i&&(r=i.baseOptions);const l={method:"GET",...r,...t},c={},h={};await Re(c,"Authorization",i),e!==void 0&&(h.isHidden=e),be(n,h);let u=r&&r.headers?r.headers:{};return l.headers={...c,...u,...t.headers},{url:Te(n),options:l}},getPhysicalPaths:async(e={})=>{const t="/Library/PhysicalPaths",s=new URL(t,Se);let n;i&&(n=i.baseOptions);const r={method:"GET",...n,...e},l={},c={};await Re(l,"Authorization",i),be(s,c);let h=n&&n.headers?n.headers:{};return r.headers={...l,...h,...e.headers},{url:Te(s),options:r}},getSimilarAlbums:async(e,t,s,n,r,l={})=>{Le("getSimilarAlbums","itemId",e);const c="/Albums/{itemId}/Similar".replace("{itemId}",encodeURIComponent(String(e))),h=new URL(c,Se);let u;i&&(u=i.baseOptions);const f={method:"GET",...u,...l},p={},v={};await Re(p,"Authorization",i),t&&(v.excludeArtistIds=t),s!==void 0&&(v.userId=s),n!==void 0&&(v.limit=n),r&&(v.fields=r),be(h,v);let x=u&&u.headers?u.headers:{};return f.headers={...p,...x,...l.headers},{url:Te(h),options:f}},getSimilarArtists:async(e,t,s,n,r,l={})=>{Le("getSimilarArtists","itemId",e);const c="/Artists/{itemId}/Similar".replace("{itemId}",encodeURIComponent(String(e))),h=new URL(c,Se);let u;i&&(u=i.baseOptions);const f={method:"GET",...u,...l},p={},v={};await Re(p,"Authorization",i),t&&(v.excludeArtistIds=t),s!==void 0&&(v.userId=s),n!==void 0&&(v.limit=n),r&&(v.fields=r),be(h,v);let x=u&&u.headers?u.headers:{};return f.headers={...p,...x,...l.headers},{url:Te(h),options:f}},getSimilarItems:async(e,t,s,n,r,l={})=>{Le("getSimilarItems","itemId",e);const c="/Items/{itemId}/Similar".replace("{itemId}",encodeURIComponent(String(e))),h=new URL(c,Se);let u;i&&(u=i.baseOptions);const f={method:"GET",...u,...l},p={},v={};await Re(p,"Authorization",i),t&&(v.excludeArtistIds=t),s!==void 0&&(v.userId=s),n!==void 0&&(v.limit=n),r&&(v.fields=r),be(h,v);let x=u&&u.headers?u.headers:{};return f.headers={...p,...x,...l.headers},{url:Te(h),options:f}},getSimilarMovies:async(e,t,s,n,r,l={})=>{Le("getSimilarMovies","itemId",e);const c="/Movies/{itemId}/Similar".replace("{itemId}",encodeURIComponent(String(e))),h=new URL(c,Se);let u;i&&(u=i.baseOptions);const f={method:"GET",...u,...l},p={},v={};await Re(p,"Authorization",i),t&&(v.excludeArtistIds=t),s!==void 0&&(v.userId=s),n!==void 0&&(v.limit=n),r&&(v.fields=r),be(h,v);let x=u&&u.headers?u.headers:{};return f.headers={...p,...x,...l.headers},{url:Te(h),options:f}},getSimilarShows:async(e,t,s,n,r,l={})=>{Le("getSimilarShows","itemId",e);const c="/Shows/{itemId}/Similar".replace("{itemId}",encodeURIComponent(String(e))),h=new URL(c,Se);let u;i&&(u=i.baseOptions);const f={method:"GET",...u,...l},p={},v={};await Re(p,"Authorization",i),t&&(v.excludeArtistIds=t),s!==void 0&&(v.userId=s),n!==void 0&&(v.limit=n),r&&(v.fields=r),be(h,v);let x=u&&u.headers?u.headers:{};return f.headers={...p,...x,...l.headers},{url:Te(h),options:f}},getSimilarTrailers:async(e,t,s,n,r,l={})=>{Le("getSimilarTrailers","itemId",e);const c="/Trailers/{itemId}/Similar".replace("{itemId}",encodeURIComponent(String(e))),h=new URL(c,Se);let u;i&&(u=i.baseOptions);const f={method:"GET",...u,...l},p={},v={};await Re(p,"Authorization",i),t&&(v.excludeArtistIds=t),s!==void 0&&(v.userId=s),n!==void 0&&(v.limit=n),r&&(v.fields=r),be(h,v);let x=u&&u.headers?u.headers:{};return f.headers={...p,...x,...l.headers},{url:Te(h),options:f}},getThemeMedia:async(e,t,s,n,r,l={})=>{Le("getThemeMedia","itemId",e);const c="/Items/{itemId}/ThemeMedia".replace("{itemId}",encodeURIComponent(String(e))),h=new URL(c,Se);let u;i&&(u=i.baseOptions);const f={method:"GET",...u,...l},p={},v={};await Re(p,"Authorization",i),t!==void 0&&(v.userId=t),s!==void 0&&(v.inheritFromParent=s),n&&(v.sortBy=n),r&&(v.sortOrder=r),be(h,v);let x=u&&u.headers?u.headers:{};return f.headers={...p,...x,...l.headers},{url:Te(h),options:f}},getThemeSongs:async(e,t,s,n,r,l={})=>{Le("getThemeSongs","itemId",e);const c="/Items/{itemId}/ThemeSongs".replace("{itemId}",encodeURIComponent(String(e))),h=new URL(c,Se);let u;i&&(u=i.baseOptions);const f={method:"GET",...u,...l},p={},v={};await Re(p,"Authorization",i),t!==void 0&&(v.userId=t),s!==void 0&&(v.inheritFromParent=s),n&&(v.sortBy=n),r&&(v.sortOrder=r),be(h,v);let x=u&&u.headers?u.headers:{};return f.headers={...p,...x,...l.headers},{url:Te(h),options:f}},getThemeVideos:async(e,t,s,n,r,l={})=>{Le("getThemeVideos","itemId",e);const c="/Items/{itemId}/ThemeVideos".replace("{itemId}",encodeURIComponent(String(e))),h=new URL(c,Se);let u;i&&(u=i.baseOptions);const f={method:"GET",...u,...l},p={},v={};await Re(p,"Authorization",i),t!==void 0&&(v.userId=t),s!==void 0&&(v.inheritFromParent=s),n&&(v.sortBy=n),r&&(v.sortOrder=r),be(h,v);let x=u&&u.headers?u.headers:{};return f.headers={...p,...x,...l.headers},{url:Te(h),options:f}},postAddedMovies:async(e,t,s={})=>{const n="/Library/Movies/Added",r=new URL(n,Se);let l;i&&(l=i.baseOptions);const c={method:"POST",...l,...s},h={},u={};await Re(h,"Authorization",i),e!==void 0&&(u.tmdbId=e),t!==void 0&&(u.imdbId=t),be(r,u);let f=l&&l.headers?l.headers:{};return c.headers={...h,...f,...s.headers},{url:Te(r),options:c}},postAddedSeries:async(e,t={})=>{const s="/Library/Series/Added",n=new URL(s,Se);let r;i&&(r=i.baseOptions);const l={method:"POST",...r,...t},c={},h={};await Re(c,"Authorization",i),e!==void 0&&(h.tvdbId=e),be(n,h);let u=r&&r.headers?r.headers:{};return l.headers={...c,...u,...t.headers},{url:Te(n),options:l}},postUpdatedMedia:async(e,t={})=>{Le("postUpdatedMedia","mediaUpdateInfoDto",e);const s="/Library/Media/Updated",n=new URL(s,Se);let r;i&&(r=i.baseOptions);const l={method:"POST",...r,...t},c={},h={};await Re(c,"Authorization",i),c["Content-Type"]="application/json",be(n,h);let u=r&&r.headers?r.headers:{};return l.headers={...c,...u,...t.headers},l.data=vs(e,l,i),{url:Te(n),options:l}},postUpdatedMovies:async(e,t,s={})=>{const n="/Library/Movies/Updated",r=new URL(n,Se);let l;i&&(l=i.baseOptions);const c={method:"POST",...l,...s},h={},u={};await Re(h,"Authorization",i),e!==void 0&&(u.tmdbId=e),t!==void 0&&(u.imdbId=t),be(r,u);let f=l&&l.headers?l.headers:{};return c.headers={...h,...f,...s.headers},{url:Te(r),options:c}},postUpdatedSeries:async(e,t={})=>{const s="/Library/Series/Updated",n=new URL(s,Se);let r;i&&(r=i.baseOptions);const l={method:"POST",...r,...t},c={},h={};await Re(c,"Authorization",i),e!==void 0&&(h.tvdbId=e),be(n,h);let u=r&&r.headers?r.headers:{};return l.headers={...c,...u,...t.headers},{url:Te(n),options:l}},refreshLibrary:async(e={})=>{const t="/Library/Refresh",s=new URL(t,Se);let n;i&&(n=i.baseOptions);const r={method:"POST",...n,...e},l={},c={};await Re(l,"Authorization",i),be(s,c);let h=n&&n.headers?n.headers:{};return r.headers={...l,...h,...e.headers},{url:Te(s),options:r}}}},Ut=function(i){const e=gL(i);return{async deleteItem(t,s){var n,r,l;const c=await e.deleteItem(t,s),h=(n=i?.serverIndex)!==null&&n!==void 0?n:0,u=(l=(r=xe["LibraryApi.deleteItem"])===null||r===void 0?void 0:r[h])===null||l===void 0?void 0:l.url;return(f,p)=>Ee(c,le,ve,i)(f,u||p)},async deleteItems(t,s){var n,r,l;const c=await e.deleteItems(t,s),h=(n=i?.serverIndex)!==null&&n!==void 0?n:0,u=(l=(r=xe["LibraryApi.deleteItems"])===null||r===void 0?void 0:r[h])===null||l===void 0?void 0:l.url;return(f,p)=>Ee(c,le,ve,i)(f,u||p)},async getAncestors(t,s,n){var r,l,c;const h=await e.getAncestors(t,s,n),u=(r=i?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=xe["LibraryApi.getAncestors"])===null||l===void 0?void 0:l[u])===null||c===void 0?void 0:c.url;return(p,v)=>Ee(h,le,ve,i)(p,f||v)},async getCriticReviews(t,s){var n,r,l;const c=await e.getCriticReviews(t,s),h=(n=i?.serverIndex)!==null&&n!==void 0?n:0,u=(l=(r=xe["LibraryApi.getCriticReviews"])===null||r===void 0?void 0:r[h])===null||l===void 0?void 0:l.url;return(f,p)=>Ee(c,le,ve,i)(f,u||p)},async getDownload(t,s){var n,r,l;const c=await e.getDownload(t,s),h=(n=i?.serverIndex)!==null&&n!==void 0?n:0,u=(l=(r=xe["LibraryApi.getDownload"])===null||r===void 0?void 0:r[h])===null||l===void 0?void 0:l.url;return(f,p)=>Ee(c,le,ve,i)(f,u||p)},async getFile(t,s){var n,r,l;const c=await e.getFile(t,s),h=(n=i?.serverIndex)!==null&&n!==void 0?n:0,u=(l=(r=xe["LibraryApi.getFile"])===null||r===void 0?void 0:r[h])===null||l===void 0?void 0:l.url;return(f,p)=>Ee(c,le,ve,i)(f,u||p)},async getItemCounts(t,s,n){var r,l,c;const h=await e.getItemCounts(t,s,n),u=(r=i?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=xe["LibraryApi.getItemCounts"])===null||l===void 0?void 0:l[u])===null||c===void 0?void 0:c.url;return(p,v)=>Ee(h,le,ve,i)(p,f||v)},async getLibraryOptionsInfo(t,s,n){var r,l,c;const h=await e.getLibraryOptionsInfo(t,s,n),u=(r=i?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=xe["LibraryApi.getLibraryOptionsInfo"])===null||l===void 0?void 0:l[u])===null||c===void 0?void 0:c.url;return(p,v)=>Ee(h,le,ve,i)(p,f||v)},async getMediaFolders(t,s){var n,r,l;const c=await e.getMediaFolders(t,s),h=(n=i?.serverIndex)!==null&&n!==void 0?n:0,u=(l=(r=xe["LibraryApi.getMediaFolders"])===null||r===void 0?void 0:r[h])===null||l===void 0?void 0:l.url;return(f,p)=>Ee(c,le,ve,i)(f,u||p)},async getPhysicalPaths(t){var s,n,r;const l=await e.getPhysicalPaths(t),c=(s=i?.serverIndex)!==null&&s!==void 0?s:0,h=(r=(n=xe["LibraryApi.getPhysicalPaths"])===null||n===void 0?void 0:n[c])===null||r===void 0?void 0:r.url;return(u,f)=>Ee(l,le,ve,i)(u,h||f)},async getSimilarAlbums(t,s,n,r,l,c){var h,u,f;const p=await e.getSimilarAlbums(t,s,n,r,l,c),v=(h=i?.serverIndex)!==null&&h!==void 0?h:0,x=(f=(u=xe["LibraryApi.getSimilarAlbums"])===null||u===void 0?void 0:u[v])===null||f===void 0?void 0:f.url;return(S,E)=>Ee(p,le,ve,i)(S,x||E)},async getSimilarArtists(t,s,n,r,l,c){var h,u,f;const p=await e.getSimilarArtists(t,s,n,r,l,c),v=(h=i?.serverIndex)!==null&&h!==void 0?h:0,x=(f=(u=xe["LibraryApi.getSimilarArtists"])===null||u===void 0?void 0:u[v])===null||f===void 0?void 0:f.url;return(S,E)=>Ee(p,le,ve,i)(S,x||E)},async getSimilarItems(t,s,n,r,l,c){var h,u,f;const p=await e.getSimilarItems(t,s,n,r,l,c),v=(h=i?.serverIndex)!==null&&h!==void 0?h:0,x=(f=(u=xe["LibraryApi.getSimilarItems"])===null||u===void 0?void 0:u[v])===null||f===void 0?void 0:f.url;return(S,E)=>Ee(p,le,ve,i)(S,x||E)},async getSimilarMovies(t,s,n,r,l,c){var h,u,f;const p=await e.getSimilarMovies(t,s,n,r,l,c),v=(h=i?.serverIndex)!==null&&h!==void 0?h:0,x=(f=(u=xe["LibraryApi.getSimilarMovies"])===null||u===void 0?void 0:u[v])===null||f===void 0?void 0:f.url;return(S,E)=>Ee(p,le,ve,i)(S,x||E)},async getSimilarShows(t,s,n,r,l,c){var h,u,f;const p=await e.getSimilarShows(t,s,n,r,l,c),v=(h=i?.serverIndex)!==null&&h!==void 0?h:0,x=(f=(u=xe["LibraryApi.getSimilarShows"])===null||u===void 0?void 0:u[v])===null||f===void 0?void 0:f.url;return(S,E)=>Ee(p,le,ve,i)(S,x||E)},async getSimilarTrailers(t,s,n,r,l,c){var h,u,f;const p=await e.getSimilarTrailers(t,s,n,r,l,c),v=(h=i?.serverIndex)!==null&&h!==void 0?h:0,x=(f=(u=xe["LibraryApi.getSimilarTrailers"])===null||u===void 0?void 0:u[v])===null||f===void 0?void 0:f.url;return(S,E)=>Ee(p,le,ve,i)(S,x||E)},async getThemeMedia(t,s,n,r,l,c){var h,u,f;const p=await e.getThemeMedia(t,s,n,r,l,c),v=(h=i?.serverIndex)!==null&&h!==void 0?h:0,x=(f=(u=xe["LibraryApi.getThemeMedia"])===null||u===void 0?void 0:u[v])===null||f===void 0?void 0:f.url;return(S,E)=>Ee(p,le,ve,i)(S,x||E)},async getThemeSongs(t,s,n,r,l,c){var h,u,f;const p=await e.getThemeSongs(t,s,n,r,l,c),v=(h=i?.serverIndex)!==null&&h!==void 0?h:0,x=(f=(u=xe["LibraryApi.getThemeSongs"])===null||u===void 0?void 0:u[v])===null||f===void 0?void 0:f.url;return(S,E)=>Ee(p,le,ve,i)(S,x||E)},async getThemeVideos(t,s,n,r,l,c){var h,u,f;const p=await e.getThemeVideos(t,s,n,r,l,c),v=(h=i?.serverIndex)!==null&&h!==void 0?h:0,x=(f=(u=xe["LibraryApi.getThemeVideos"])===null||u===void 0?void 0:u[v])===null||f===void 0?void 0:f.url;return(S,E)=>Ee(p,le,ve,i)(S,x||E)},async postAddedMovies(t,s,n){var r,l,c;const h=await e.postAddedMovies(t,s,n),u=(r=i?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=xe["LibraryApi.postAddedMovies"])===null||l===void 0?void 0:l[u])===null||c===void 0?void 0:c.url;return(p,v)=>Ee(h,le,ve,i)(p,f||v)},async postAddedSeries(t,s){var n,r,l;const c=await e.postAddedSeries(t,s),h=(n=i?.serverIndex)!==null&&n!==void 0?n:0,u=(l=(r=xe["LibraryApi.postAddedSeries"])===null||r===void 0?void 0:r[h])===null||l===void 0?void 0:l.url;return(f,p)=>Ee(c,le,ve,i)(f,u||p)},async postUpdatedMedia(t,s){var n,r,l;const c=await e.postUpdatedMedia(t,s),h=(n=i?.serverIndex)!==null&&n!==void 0?n:0,u=(l=(r=xe["LibraryApi.postUpdatedMedia"])===null||r===void 0?void 0:r[h])===null||l===void 0?void 0:l.url;return(f,p)=>Ee(c,le,ve,i)(f,u||p)},async postUpdatedMovies(t,s,n){var r,l,c;const h=await e.postUpdatedMovies(t,s,n),u=(r=i?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=xe["LibraryApi.postUpdatedMovies"])===null||l===void 0?void 0:l[u])===null||c===void 0?void 0:c.url;return(p,v)=>Ee(h,le,ve,i)(p,f||v)},async postUpdatedSeries(t,s){var n,r,l;const c=await e.postUpdatedSeries(t,s),h=(n=i?.serverIndex)!==null&&n!==void 0?n:0,u=(l=(r=xe["LibraryApi.postUpdatedSeries"])===null||r===void 0?void 0:r[h])===null||l===void 0?void 0:l.url;return(f,p)=>Ee(c,le,ve,i)(f,u||p)},async refreshLibrary(t){var s,n,r;const l=await e.refreshLibrary(t),c=(s=i?.serverIndex)!==null&&s!==void 0?s:0,h=(r=(n=xe["LibraryApi.refreshLibrary"])===null||n===void 0?void 0:n[c])===null||r===void 0?void 0:r.url;return(u,f)=>Ee(l,le,ve,i)(u,h||f)}}};class vL extends cn{deleteItem(e,t){return Ut(this.configuration).deleteItem(e.itemId,t).then(s=>s(this.axios,this.basePath))}deleteItems(e={},t){return Ut(this.configuration).deleteItems(e.ids,t).then(s=>s(this.axios,this.basePath))}getAncestors(e,t){return Ut(this.configuration).getAncestors(e.itemId,e.userId,t).then(s=>s(this.axios,this.basePath))}getCriticReviews(e,t){return Ut(this.configuration).getCriticReviews(e.itemId,t).then(s=>s(this.axios,this.basePath))}getDownload(e,t){return Ut(this.configuration).getDownload(e.itemId,t).then(s=>s(this.axios,this.basePath))}getFile(e,t){return Ut(this.configuration).getFile(e.itemId,t).then(s=>s(this.axios,this.basePath))}getItemCounts(e={},t){return Ut(this.configuration).getItemCounts(e.userId,e.isFavorite,t).then(s=>s(this.axios,this.basePath))}getLibraryOptionsInfo(e={},t){return Ut(this.configuration).getLibraryOptionsInfo(e.libraryContentType,e.isNewLibrary,t).then(s=>s(this.axios,this.basePath))}getMediaFolders(e={},t){return Ut(this.configuration).getMediaFolders(e.isHidden,t).then(s=>s(this.axios,this.basePath))}getPhysicalPaths(e){return Ut(this.configuration).getPhysicalPaths(e).then(t=>t(this.axios,this.basePath))}getSimilarAlbums(e,t){return Ut(this.configuration).getSimilarAlbums(e.itemId,e.excludeArtistIds,e.userId,e.limit,e.fields,t).then(s=>s(this.axios,this.basePath))}getSimilarArtists(e,t){return Ut(this.configuration).getSimilarArtists(e.itemId,e.excludeArtistIds,e.userId,e.limit,e.fields,t).then(s=>s(this.axios,this.basePath))}getSimilarItems(e,t){return Ut(this.configuration).getSimilarItems(e.itemId,e.excludeArtistIds,e.userId,e.limit,e.fields,t).then(s=>s(this.axios,this.basePath))}getSimilarMovies(e,t){return Ut(this.configuration).getSimilarMovies(e.itemId,e.excludeArtistIds,e.userId,e.limit,e.fields,t).then(s=>s(this.axios,this.basePath))}getSimilarShows(e,t){return Ut(this.configuration).getSimilarShows(e.itemId,e.excludeArtistIds,e.userId,e.limit,e.fields,t).then(s=>s(this.axios,this.basePath))}getSimilarTrailers(e,t){return Ut(this.configuration).getSimilarTrailers(e.itemId,e.excludeArtistIds,e.userId,e.limit,e.fields,t).then(s=>s(this.axios,this.basePath))}getThemeMedia(e,t){return Ut(this.configuration).getThemeMedia(e.itemId,e.userId,e.inheritFromParent,e.sortBy,e.sortOrder,t).then(s=>s(this.axios,this.basePath))}getThemeSongs(e,t){return Ut(this.configuration).getThemeSongs(e.itemId,e.userId,e.inheritFromParent,e.sortBy,e.sortOrder,t).then(s=>s(this.axios,this.basePath))}getThemeVideos(e,t){return Ut(this.configuration).getThemeVideos(e.itemId,e.userId,e.inheritFromParent,e.sortBy,e.sortOrder,t).then(s=>s(this.axios,this.basePath))}postAddedMovies(e={},t){return Ut(this.configuration).postAddedMovies(e.tmdbId,e.imdbId,t).then(s=>s(this.axios,this.basePath))}postAddedSeries(e={},t){return Ut(this.configuration).postAddedSeries(e.tvdbId,t).then(s=>s(this.axios,this.basePath))}postUpdatedMedia(e,t){return Ut(this.configuration).postUpdatedMedia(e.mediaUpdateInfoDto,t).then(s=>s(this.axios,this.basePath))}postUpdatedMovies(e={},t){return Ut(this.configuration).postUpdatedMovies(e.tmdbId,e.imdbId,t).then(s=>s(this.axios,this.basePath))}postUpdatedSeries(e={},t){return Ut(this.configuration).postUpdatedSeries(e.tvdbId,t).then(s=>s(this.axios,this.basePath))}refreshLibrary(e){return Ut(this.configuration).refreshLibrary(e).then(t=>t(this.axios,this.basePath))}}const yL=function(i){return{deleteSubtitle:async(e,t,s={})=>{Le("deleteSubtitle","itemId",e),Le("deleteSubtitle","index",t);const n="/Videos/{itemId}/Subtitles/{index}".replace("{itemId}",encodeURIComponent(String(e))).replace("{index}",encodeURIComponent(String(t))),r=new URL(n,Se);let l;i&&(l=i.baseOptions);const c={method:"DELETE",...l,...s},h={},u={};await Re(h,"Authorization",i),be(r,u);let f=l&&l.headers?l.headers:{};return c.headers={...h,...f,...s.headers},{url:Te(r),options:c}},downloadRemoteSubtitles:async(e,t,s={})=>{Le("downloadRemoteSubtitles","itemId",e),Le("downloadRemoteSubtitles","subtitleId",t);const n="/Items/{itemId}/RemoteSearch/Subtitles/{subtitleId}".replace("{itemId}",encodeURIComponent(String(e))).replace("{subtitleId}",encodeURIComponent(String(t))),r=new URL(n,Se);let l;i&&(l=i.baseOptions);const c={method:"POST",...l,...s},h={},u={};await Re(h,"Authorization",i),be(r,u);let f=l&&l.headers?l.headers:{};return c.headers={...h,...f,...s.headers},{url:Te(r),options:c}},getFallbackFont:async(e,t={})=>{Le("getFallbackFont","name",e);const s="/FallbackFont/Fonts/{name}".replace("{name}",encodeURIComponent(String(e))),n=new URL(s,Se);let r;i&&(r=i.baseOptions);const l={method:"GET",...r,...t},c={},h={};await Re(c,"Authorization",i),be(n,h);let u=r&&r.headers?r.headers:{};return l.headers={...c,...u,...t.headers},{url:Te(n),options:l}},getFallbackFontList:async(e={})=>{const t="/FallbackFont/Fonts",s=new URL(t,Se);let n;i&&(n=i.baseOptions);const r={method:"GET",...n,...e},l={},c={};await Re(l,"Authorization",i),be(s,c);let h=n&&n.headers?n.headers:{};return r.headers={...l,...h,...e.headers},{url:Te(s),options:r}},getRemoteSubtitles:async(e,t={})=>{Le("getRemoteSubtitles","subtitleId",e);const s="/Providers/Subtitles/Subtitles/{subtitleId}".replace("{subtitleId}",encodeURIComponent(String(e))),n=new URL(s,Se);let r;i&&(r=i.baseOptions);const l={method:"GET",...r,...t},c={},h={};await Re(c,"Authorization",i),be(n,h);let u=r&&r.headers?r.headers:{};return l.headers={...c,...u,...t.headers},{url:Te(n),options:l}},getSubtitle:async(e,t,s,n,r,l,c,h,u,f,p,v,x={})=>{Le("getSubtitle","routeItemId",e),Le("getSubtitle","routeMediaSourceId",t),Le("getSubtitle","routeIndex",s),Le("getSubtitle","routeFormat",n);const S="/Videos/{routeItemId}/{routeMediaSourceId}/Subtitles/{routeIndex}/Stream.{routeFormat}".replace("{routeItemId}",encodeURIComponent(String(e))).replace("{routeMediaSourceId}",encodeURIComponent(String(t))).replace("{routeIndex}",encodeURIComponent(String(s))).replace("{routeFormat}",encodeURIComponent(String(n))),E=new URL(S,Se);let T;i&&(T=i.baseOptions);const A={method:"GET",...T,...x},I={},_={};r!==void 0&&(_.itemId=r),l!==void 0&&(_.mediaSourceId=l),c!==void 0&&(_.index=c),h!==void 0&&(_.format=h),u!==void 0&&(_.endPositionTicks=u),f!==void 0&&(_.copyTimestamps=f),p!==void 0&&(_.addVttTimeMap=p),v!==void 0&&(_.startPositionTicks=v),be(E,_);let C=T&&T.headers?T.headers:{};return A.headers={...I,...C,...x.headers},{url:Te(E),options:A}},getSubtitlePlaylist:async(e,t,s,n,r={})=>{Le("getSubtitlePlaylist","itemId",e),Le("getSubtitlePlaylist","index",t),Le("getSubtitlePlaylist","mediaSourceId",s),Le("getSubtitlePlaylist","segmentLength",n);const l="/Videos/{itemId}/{mediaSourceId}/Subtitles/{index}/subtitles.m3u8".replace("{itemId}",encodeURIComponent(String(e))).replace("{index}",encodeURIComponent(String(t))).replace("{mediaSourceId}",encodeURIComponent(String(s))),c=new URL(l,Se);let h;i&&(h=i.baseOptions);const u={method:"GET",...h,...r},f={},p={};await Re(f,"Authorization",i),n!==void 0&&(p.segmentLength=n),be(c,p);let v=h&&h.headers?h.headers:{};return u.headers={...f,...v,...r.headers},{url:Te(c),options:u}},getSubtitleWithTicks:async(e,t,s,n,r,l,c,h,u,f,p,v,x,S={})=>{Le("getSubtitleWithTicks","routeItemId",e),Le("getSubtitleWithTicks","routeMediaSourceId",t),Le("getSubtitleWithTicks","routeIndex",s),Le("getSubtitleWithTicks","routeStartPositionTicks",n),Le("getSubtitleWithTicks","routeFormat",r);const E="/Videos/{routeItemId}/{routeMediaSourceId}/Subtitles/{routeIndex}/{routeStartPositionTicks}/Stream.{routeFormat}".replace("{routeItemId}",encodeURIComponent(String(e))).replace("{routeMediaSourceId}",encodeURIComponent(String(t))).replace("{routeIndex}",encodeURIComponent(String(s))).replace("{routeStartPositionTicks}",encodeURIComponent(String(n))).replace("{routeFormat}",encodeURIComponent(String(r))),T=new URL(E,Se);let A;i&&(A=i.baseOptions);const I={method:"GET",...A,...S},_={},C={};l!==void 0&&(C.itemId=l),c!==void 0&&(C.mediaSourceId=c),h!==void 0&&(C.index=h),u!==void 0&&(C.startPositionTicks=u),f!==void 0&&(C.format=f),p!==void 0&&(C.endPositionTicks=p),v!==void 0&&(C.copyTimestamps=v),x!==void 0&&(C.addVttTimeMap=x),be(T,C);let k=A&&A.headers?A.headers:{};return I.headers={..._,...k,...S.headers},{url:Te(T),options:I}},searchRemoteSubtitles:async(e,t,s,n={})=>{Le("searchRemoteSubtitles","itemId",e),Le("searchRemoteSubtitles","language",t);const r="/Items/{itemId}/RemoteSearch/Subtitles/{language}".replace("{itemId}",encodeURIComponent(String(e))).replace("{language}",encodeURIComponent(String(t))),l=new URL(r,Se);let c;i&&(c=i.baseOptions);const h={method:"GET",...c,...n},u={},f={};await Re(u,"Authorization",i),s!==void 0&&(f.isPerfectMatch=s),be(l,f);let p=c&&c.headers?c.headers:{};return h.headers={...u,...p,...n.headers},{url:Te(l),options:h}},uploadSubtitle:async(e,t,s={})=>{Le("uploadSubtitle","itemId",e),Le("uploadSubtitle","uploadSubtitleDto",t);const n="/Videos/{itemId}/Subtitles".replace("{itemId}",encodeURIComponent(String(e))),r=new URL(n,Se);let l;i&&(l=i.baseOptions);const c={method:"POST",...l,...s},h={},u={};await Re(h,"Authorization",i),h["Content-Type"]="application/json",be(r,u);let f=l&&l.headers?l.headers:{};return c.headers={...h,...f,...s.headers},c.data=vs(t,c,i),{url:Te(r),options:c}}}},Ji=function(i){const e=yL(i);return{async deleteSubtitle(t,s,n){var r,l,c;const h=await e.deleteSubtitle(t,s,n),u=(r=i?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=xe["SubtitleApi.deleteSubtitle"])===null||l===void 0?void 0:l[u])===null||c===void 0?void 0:c.url;return(p,v)=>Ee(h,le,ve,i)(p,f||v)},async downloadRemoteSubtitles(t,s,n){var r,l,c;const h=await e.downloadRemoteSubtitles(t,s,n),u=(r=i?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=xe["SubtitleApi.downloadRemoteSubtitles"])===null||l===void 0?void 0:l[u])===null||c===void 0?void 0:c.url;return(p,v)=>Ee(h,le,ve,i)(p,f||v)},async getFallbackFont(t,s){var n,r,l;const c=await e.getFallbackFont(t,s),h=(n=i?.serverIndex)!==null&&n!==void 0?n:0,u=(l=(r=xe["SubtitleApi.getFallbackFont"])===null||r===void 0?void 0:r[h])===null||l===void 0?void 0:l.url;return(f,p)=>Ee(c,le,ve,i)(f,u||p)},async getFallbackFontList(t){var s,n,r;const l=await e.getFallbackFontList(t),c=(s=i?.serverIndex)!==null&&s!==void 0?s:0,h=(r=(n=xe["SubtitleApi.getFallbackFontList"])===null||n===void 0?void 0:n[c])===null||r===void 0?void 0:r.url;return(u,f)=>Ee(l,le,ve,i)(u,h||f)},async getRemoteSubtitles(t,s){var n,r,l;const c=await e.getRemoteSubtitles(t,s),h=(n=i?.serverIndex)!==null&&n!==void 0?n:0,u=(l=(r=xe["SubtitleApi.getRemoteSubtitles"])===null||r===void 0?void 0:r[h])===null||l===void 0?void 0:l.url;return(f,p)=>Ee(c,le,ve,i)(f,u||p)},async getSubtitle(t,s,n,r,l,c,h,u,f,p,v,x,S){var E,T,A;const I=await e.getSubtitle(t,s,n,r,l,c,h,u,f,p,v,x,S),_=(E=i?.serverIndex)!==null&&E!==void 0?E:0,C=(A=(T=xe["SubtitleApi.getSubtitle"])===null||T===void 0?void 0:T[_])===null||A===void 0?void 0:A.url;return(k,U)=>Ee(I,le,ve,i)(k,C||U)},async getSubtitlePlaylist(t,s,n,r,l){var c,h,u;const f=await e.getSubtitlePlaylist(t,s,n,r,l),p=(c=i?.serverIndex)!==null&&c!==void 0?c:0,v=(u=(h=xe["SubtitleApi.getSubtitlePlaylist"])===null||h===void 0?void 0:h[p])===null||u===void 0?void 0:u.url;return(x,S)=>Ee(f,le,ve,i)(x,v||S)},async getSubtitleWithTicks(t,s,n,r,l,c,h,u,f,p,v,x,S,E){var T,A,I;const _=await e.getSubtitleWithTicks(t,s,n,r,l,c,h,u,f,p,v,x,S,E),C=(T=i?.serverIndex)!==null&&T!==void 0?T:0,k=(I=(A=xe["SubtitleApi.getSubtitleWithTicks"])===null||A===void 0?void 0:A[C])===null||I===void 0?void 0:I.url;return(U,O)=>Ee(_,le,ve,i)(U,k||O)},async searchRemoteSubtitles(t,s,n,r){var l,c,h;const u=await e.searchRemoteSubtitles(t,s,n,r),f=(l=i?.serverIndex)!==null&&l!==void 0?l:0,p=(h=(c=xe["SubtitleApi.searchRemoteSubtitles"])===null||c===void 0?void 0:c[f])===null||h===void 0?void 0:h.url;return(v,x)=>Ee(u,le,ve,i)(v,p||x)},async uploadSubtitle(t,s,n){var r,l,c;const h=await e.uploadSubtitle(t,s,n),u=(r=i?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=xe["SubtitleApi.uploadSubtitle"])===null||l===void 0?void 0:l[u])===null||c===void 0?void 0:c.url;return(p,v)=>Ee(h,le,ve,i)(p,f||v)}}};class xL extends cn{deleteSubtitle(e,t){return Ji(this.configuration).deleteSubtitle(e.itemId,e.index,t).then(s=>s(this.axios,this.basePath))}downloadRemoteSubtitles(e,t){return Ji(this.configuration).downloadRemoteSubtitles(e.itemId,e.subtitleId,t).then(s=>s(this.axios,this.basePath))}getFallbackFont(e,t){return Ji(this.configuration).getFallbackFont(e.name,t).then(s=>s(this.axios,this.basePath))}getFallbackFontList(e){return Ji(this.configuration).getFallbackFontList(e).then(t=>t(this.axios,this.basePath))}getRemoteSubtitles(e,t){return Ji(this.configuration).getRemoteSubtitles(e.subtitleId,t).then(s=>s(this.axios,this.basePath))}getSubtitle(e,t){return Ji(this.configuration).getSubtitle(e.routeItemId,e.routeMediaSourceId,e.routeIndex,e.routeFormat,e.itemId,e.mediaSourceId,e.index,e.format,e.endPositionTicks,e.copyTimestamps,e.addVttTimeMap,e.startPositionTicks,t).then(s=>s(this.axios,this.basePath))}getSubtitlePlaylist(e,t){return Ji(this.configuration).getSubtitlePlaylist(e.itemId,e.index,e.mediaSourceId,e.segmentLength,t).then(s=>s(this.axios,this.basePath))}getSubtitleWithTicks(e,t){return Ji(this.configuration).getSubtitleWithTicks(e.routeItemId,e.routeMediaSourceId,e.routeIndex,e.routeStartPositionTicks,e.routeFormat,e.itemId,e.mediaSourceId,e.index,e.startPositionTicks,e.format,e.endPositionTicks,e.copyTimestamps,e.addVttTimeMap,t).then(s=>s(this.axios,this.basePath))}searchRemoteSubtitles(e,t){return Ji(this.configuration).searchRemoteSubtitles(e.itemId,e.language,e.isPerfectMatch,t).then(s=>s(this.axios,this.basePath))}uploadSubtitle(e,t){return Ji(this.configuration).uploadSubtitle(e.itemId,e.uploadSubtitleDto,t).then(s=>s(this.axios,this.basePath))}}const SL=function(i){return{markPlayedItem:async(e,t,s,n={})=>{Le("markPlayedItem","itemId",e);const r="/UserPlayedItems/{itemId}".replace("{itemId}",encodeURIComponent(String(e))),l=new URL(r,Se);let c;i&&(c=i.baseOptions);const h={method:"POST",...c,...n},u={},f={};await Re(u,"Authorization",i),t!==void 0&&(f.userId=t),s!==void 0&&(f.datePlayed=s instanceof Date?s.toISOString():s),be(l,f);let p=c&&c.headers?c.headers:{};return h.headers={...u,...p,...n.headers},{url:Te(l),options:h}},markUnplayedItem:async(e,t,s={})=>{Le("markUnplayedItem","itemId",e);const n="/UserPlayedItems/{itemId}".replace("{itemId}",encodeURIComponent(String(e))),r=new URL(n,Se);let l;i&&(l=i.baseOptions);const c={method:"DELETE",...l,...s},h={},u={};await Re(h,"Authorization",i),t!==void 0&&(u.userId=t),be(r,u);let f=l&&l.headers?l.headers:{};return c.headers={...h,...f,...s.headers},{url:Te(r),options:c}},onPlaybackProgress:async(e,t,s,n,r,l,c,h,u,f,p,v,x={})=>{Le("onPlaybackProgress","itemId",e);const S="/PlayingItems/{itemId}/Progress".replace("{itemId}",encodeURIComponent(String(e))),E=new URL(S,Se);let T;i&&(T=i.baseOptions);const A={method:"POST",...T,...x},I={},_={};await Re(I,"Authorization",i),t!==void 0&&(_.mediaSourceId=t),s!==void 0&&(_.positionTicks=s),n!==void 0&&(_.audioStreamIndex=n),r!==void 0&&(_.subtitleStreamIndex=r),l!==void 0&&(_.volumeLevel=l),c!==void 0&&(_.playMethod=c),h!==void 0&&(_.liveStreamId=h),u!==void 0&&(_.playSessionId=u),f!==void 0&&(_.repeatMode=f),p!==void 0&&(_.isPaused=p),v!==void 0&&(_.isMuted=v),be(E,_);let C=T&&T.headers?T.headers:{};return A.headers={...I,...C,...x.headers},{url:Te(E),options:A}},onPlaybackStart:async(e,t,s,n,r,l,c,h,u={})=>{Le("onPlaybackStart","itemId",e);const f="/PlayingItems/{itemId}".replace("{itemId}",encodeURIComponent(String(e))),p=new URL(f,Se);let v;i&&(v=i.baseOptions);const x={method:"POST",...v,...u},S={},E={};await Re(S,"Authorization",i),t!==void 0&&(E.mediaSourceId=t),s!==void 0&&(E.audioStreamIndex=s),n!==void 0&&(E.subtitleStreamIndex=n),r!==void 0&&(E.playMethod=r),l!==void 0&&(E.liveStreamId=l),c!==void 0&&(E.playSessionId=c),h!==void 0&&(E.canSeek=h),be(p,E);let T=v&&v.headers?v.headers:{};return x.headers={...S,...T,...u.headers},{url:Te(p),options:x}},onPlaybackStopped:async(e,t,s,n,r,l,c={})=>{Le("onPlaybackStopped","itemId",e);const h="/PlayingItems/{itemId}".replace("{itemId}",encodeURIComponent(String(e))),u=new URL(h,Se);let f;i&&(f=i.baseOptions);const p={method:"DELETE",...f,...c},v={},x={};await Re(v,"Authorization",i),t!==void 0&&(x.mediaSourceId=t),s!==void 0&&(x.nextMediaType=s),n!==void 0&&(x.positionTicks=n),r!==void 0&&(x.liveStreamId=r),l!==void 0&&(x.playSessionId=l),be(u,x);let S=f&&f.headers?f.headers:{};return p.headers={...v,...S,...c.headers},{url:Te(u),options:p}},pingPlaybackSession:async(e,t={})=>{Le("pingPlaybackSession","playSessionId",e);const s="/Sessions/Playing/Ping",n=new URL(s,Se);let r;i&&(r=i.baseOptions);const l={method:"POST",...r,...t},c={},h={};await Re(c,"Authorization",i),e!==void 0&&(h.playSessionId=e),be(n,h);let u=r&&r.headers?r.headers:{};return l.headers={...c,...u,...t.headers},{url:Te(n),options:l}},reportPlaybackProgress:async(e,t={})=>{const s="/Sessions/Playing/Progress",n=new URL(s,Se);let r;i&&(r=i.baseOptions);const l={method:"POST",...r,...t},c={},h={};await Re(c,"Authorization",i),c["Content-Type"]="application/json",be(n,h);let u=r&&r.headers?r.headers:{};return l.headers={...c,...u,...t.headers},l.data=vs(e,l,i),{url:Te(n),options:l}},reportPlaybackStart:async(e,t={})=>{const s="/Sessions/Playing",n=new URL(s,Se);let r;i&&(r=i.baseOptions);const l={method:"POST",...r,...t},c={},h={};await Re(c,"Authorization",i),c["Content-Type"]="application/json",be(n,h);let u=r&&r.headers?r.headers:{};return l.headers={...c,...u,...t.headers},l.data=vs(e,l,i),{url:Te(n),options:l}},reportPlaybackStopped:async(e,t={})=>{const s="/Sessions/Playing/Stopped",n=new URL(s,Se);let r;i&&(r=i.baseOptions);const l={method:"POST",...r,...t},c={},h={};await Re(c,"Authorization",i),c["Content-Type"]="application/json",be(n,h);let u=r&&r.headers?r.headers:{};return l.headers={...c,...u,...t.headers},l.data=vs(e,l,i),{url:Te(n),options:l}}}},wn=function(i){const e=SL(i);return{async markPlayedItem(t,s,n,r){var l,c,h;const u=await e.markPlayedItem(t,s,n,r),f=(l=i?.serverIndex)!==null&&l!==void 0?l:0,p=(h=(c=xe["PlaystateApi.markPlayedItem"])===null||c===void 0?void 0:c[f])===null||h===void 0?void 0:h.url;return(v,x)=>Ee(u,le,ve,i)(v,p||x)},async markUnplayedItem(t,s,n){var r,l,c;const h=await e.markUnplayedItem(t,s,n),u=(r=i?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=xe["PlaystateApi.markUnplayedItem"])===null||l===void 0?void 0:l[u])===null||c===void 0?void 0:c.url;return(p,v)=>Ee(h,le,ve,i)(p,f||v)},async onPlaybackProgress(t,s,n,r,l,c,h,u,f,p,v,x,S){var E,T,A;const I=await e.onPlaybackProgress(t,s,n,r,l,c,h,u,f,p,v,x,S),_=(E=i?.serverIndex)!==null&&E!==void 0?E:0,C=(A=(T=xe["PlaystateApi.onPlaybackProgress"])===null||T===void 0?void 0:T[_])===null||A===void 0?void 0:A.url;return(k,U)=>Ee(I,le,ve,i)(k,C||U)},async onPlaybackStart(t,s,n,r,l,c,h,u,f){var p,v,x;const S=await e.onPlaybackStart(t,s,n,r,l,c,h,u,f),E=(p=i?.serverIndex)!==null&&p!==void 0?p:0,T=(x=(v=xe["PlaystateApi.onPlaybackStart"])===null||v===void 0?void 0:v[E])===null||x===void 0?void 0:x.url;return(A,I)=>Ee(S,le,ve,i)(A,T||I)},async onPlaybackStopped(t,s,n,r,l,c,h){var u,f,p;const v=await e.onPlaybackStopped(t,s,n,r,l,c,h),x=(u=i?.serverIndex)!==null&&u!==void 0?u:0,S=(p=(f=xe["PlaystateApi.onPlaybackStopped"])===null||f===void 0?void 0:f[x])===null||p===void 0?void 0:p.url;return(E,T)=>Ee(v,le,ve,i)(E,S||T)},async pingPlaybackSession(t,s){var n,r,l;const c=await e.pingPlaybackSession(t,s),h=(n=i?.serverIndex)!==null&&n!==void 0?n:0,u=(l=(r=xe["PlaystateApi.pingPlaybackSession"])===null||r===void 0?void 0:r[h])===null||l===void 0?void 0:l.url;return(f,p)=>Ee(c,le,ve,i)(f,u||p)},async reportPlaybackProgress(t,s){var n,r,l;const c=await e.reportPlaybackProgress(t,s),h=(n=i?.serverIndex)!==null&&n!==void 0?n:0,u=(l=(r=xe["PlaystateApi.reportPlaybackProgress"])===null||r===void 0?void 0:r[h])===null||l===void 0?void 0:l.url;return(f,p)=>Ee(c,le,ve,i)(f,u||p)},async reportPlaybackStart(t,s){var n,r,l;const c=await e.reportPlaybackStart(t,s),h=(n=i?.serverIndex)!==null&&n!==void 0?n:0,u=(l=(r=xe["PlaystateApi.reportPlaybackStart"])===null||r===void 0?void 0:r[h])===null||l===void 0?void 0:l.url;return(f,p)=>Ee(c,le,ve,i)(f,u||p)},async reportPlaybackStopped(t,s){var n,r,l;const c=await e.reportPlaybackStopped(t,s),h=(n=i?.serverIndex)!==null&&n!==void 0?n:0,u=(l=(r=xe["PlaystateApi.reportPlaybackStopped"])===null||r===void 0?void 0:r[h])===null||l===void 0?void 0:l.url;return(f,p)=>Ee(c,le,ve,i)(f,u||p)}}};class bL extends cn{markPlayedItem(e,t){return wn(this.configuration).markPlayedItem(e.itemId,e.userId,e.datePlayed,t).then(s=>s(this.axios,this.basePath))}markUnplayedItem(e,t){return wn(this.configuration).markUnplayedItem(e.itemId,e.userId,t).then(s=>s(this.axios,this.basePath))}onPlaybackProgress(e,t){return wn(this.configuration).onPlaybackProgress(e.itemId,e.mediaSourceId,e.positionTicks,e.audioStreamIndex,e.subtitleStreamIndex,e.volumeLevel,e.playMethod,e.liveStreamId,e.playSessionId,e.repeatMode,e.isPaused,e.isMuted,t).then(s=>s(this.axios,this.basePath))}onPlaybackStart(e,t){return wn(this.configuration).onPlaybackStart(e.itemId,e.mediaSourceId,e.audioStreamIndex,e.subtitleStreamIndex,e.playMethod,e.liveStreamId,e.playSessionId,e.canSeek,t).then(s=>s(this.axios,this.basePath))}onPlaybackStopped(e,t){return wn(this.configuration).onPlaybackStopped(e.itemId,e.mediaSourceId,e.nextMediaType,e.positionTicks,e.liveStreamId,e.playSessionId,t).then(s=>s(this.axios,this.basePath))}pingPlaybackSession(e,t){return wn(this.configuration).pingPlaybackSession(e.playSessionId,t).then(s=>s(this.axios,this.basePath))}reportPlaybackProgress(e={},t){return wn(this.configuration).reportPlaybackProgress(e.playbackProgressInfo,t).then(s=>s(this.axios,this.basePath))}reportPlaybackStart(e={},t){return wn(this.configuration).reportPlaybackStart(e.playbackStartInfo,t).then(s=>s(this.axios,this.basePath))}reportPlaybackStopped(e={},t){return wn(this.configuration).reportPlaybackStopped(e.playbackStopInfo,t).then(s=>s(this.axios,this.basePath))}}class TL{constructor(){this.jellyfin=new lL({clientInfo:{name:"LegitFlix Client",version:"1.0.0.18"},deviceInfo:{name:"LegitFlix Web",id:"legitflix-web"}}),this.api=null}initialize(e=null,t=null){const s=t!==null?t:this.api?.basePath||window.location.origin;this.api=this.jellyfin.createApi(s,e),this.api.user=new xS(this.api.configuration),this.api.userLibrary=new cL(this.api.configuration),this.api.userViews=new dL(this.api.configuration),this.api.items=new fL(this.api.configuration),this.api.tvShows=new pL(this.api.configuration),this.api.library=new vL(this.api.configuration),this.api.subtitle=new xL(this.api.configuration),this.api.playstate=new bL(this.api.configuration),console.log("[LegitFlix] API Initialized. Access Token present:",!!e)}async getCurrentUser(){if(window.ApiClient)try{return await window.ApiClient.getCurrentUser()}catch(t){console.warn("Failed to get current user from window.ApiClient",t)}const e=localStorage.getItem("jellyfin_credentials");if(e)try{const t=JSON.parse(e);if(t.Servers&&t.Servers.length>0){const s=t.Servers.find(n=>n.AccessToken&&n.UserId);if(s){(!this.api||this.api.accessToken!==s.AccessToken)&&(console.log("[LegitFlix] Initializing API with stored token"),this.initialize(s.AccessToken));try{return(await this.api.user.getUserById({userId:s.UserId})).data}catch(n){return console.error("[LegitFlix] Token invalid or user not found. Clearing credentials.",n),this.logout(),null}}}}catch(t){console.error("[LegitFlix] Failed to parse jellyfin_credentials",t)}return null}async validateServer(e){const t=e.replace(/\/$/,""),s=new AbortController,n=setTimeout(()=>s.abort(),5e3);try{const r=await fetch(`${t}/System/Info/Public`,{signal:s.signal});if(clearTimeout(n),r.ok)return{valid:!0,data:await r.json(),baseUrl:t}}catch(r){clearTimeout(n),console.error("Server validation failed",r)}return{valid:!1}}async getPublicUsers(){return this.api||this.initialize(),(await this.api.user.getPublicUsers()).data}async authenticateUser(e,t){this.api||this.initialize();try{const n=(await this.api.user.authenticateUserByName({authenticateUserByName:{Username:e,Pw:t}})).data;if(n.AccessToken&&n.User){this.initialize(n.AccessToken);const r={Servers:[{DateLastAccessed:new Date().toISOString(),AccessToken:n.AccessToken,UserId:n.User.Id,Name:n.User.Name,ManualAddress:this.api.basePath}]};return localStorage.setItem("jellyfin_credentials",JSON.stringify(r)),n.User}}catch(s){throw console.error("Authentication failed",s),s}return null}async getItem(e,t){return this.api||this.initialize(),(await this.api.userLibrary.getItem({userId:e,itemId:t})).data}async getSimilarItems(e,t){return this.api||this.initialize(),(await this.api.library.getSimilarItems({userId:e,itemId:t,limit:12})).data}async getItems(e,t){return this.api||this.initialize(),(await this.api.items.getItems({userId:e,...t})).data}async markPlayed(e,t,s){this.api||this.initialize();const n=s?"POST":"DELETE",l=`${this.api.basePath||""}/Users/${e}/PlayedItems/${t}`;try{const c=this.api.accessToken,h={"Content-Type":"application/json"};c&&(h["X-Emby-Authorization"]=`MediaBrowser Client="${this.jellyfin.clientInfo.name}", Device="${this.jellyfin.deviceInfo.name}", DeviceId="${this.jellyfin.deviceInfo.id}", Version="${this.jellyfin.clientInfo.version}", Token="${c}"`);const u=await fetch(l,{method:n,headers:h});if(!u.ok)throw new Error(`Failed to mark played/unplayed: ${u.status} ${u.statusText}`);return await u.json()}catch(c){throw console.error("markPlayed failed",c),c}}async markFavorite(e,t,s){return this.api||this.initialize(),s?await this.api.userLibrary.markFavoriteItem({userId:e,itemId:t}):await this.api.userLibrary.unmarkFavoriteItem({userId:e,itemId:t})}async getSeasons(e,t){return this.api||this.initialize(),(await this.api.tvShows.getSeasons({userId:e,seriesId:t})).data}async getEpisodes(e,t,s){return this.api||this.initialize(),(await this.api.tvShows.getEpisodes({userId:e,seriesId:t,seasonId:s,fields:["MediaSources","RunTimeTicks","UserData","Overview","Path"]})).data}async getNextUp(e,t){return this.api||this.initialize(),(await this.api.tvShows.getNextUp({userId:e,seriesId:t,limit:1})).data}async getUserViews(e){return this.api||this.initialize(),(await this.api.userViews.getUserViews({userId:e})).data}async getSeries(e,t){this.api||this.initialize();const s=["Overview","Genres","Studios","OfficialRating","CommunityRating","ImageTags","BackdropImageTags","People","RemoteTrailers","LocalTrailers","ChildCount","MediaSources"];return(await this.api.userLibrary.getItem({userId:e,itemId:t,fields:s})).data}async getResumeItems(e,t=12){return this.api||this.initialize(),await this.getItems(e,{filters:["IsResumable"],sortBy:["DatePlayed"],sortOrder:["Descending"],limit:t,recursive:!0,includeItemTypes:["Movie","Episode"]})}async getHistoryItems(e,t=12){return this.api||this.initialize(),await this.getItems(e,{sortBy:["DatePlayed"],sortOrder:["Descending"],limit:t,recursive:!0,filters:["IsPlayed"],includeItemTypes:["Movie","Episode"],fields:["PrimaryImageAspectRatio","Overview","ImageTags","ProductionYear","RunTimeTicks"]})}async getItemDetails(e,t){this.api||this.initialize();try{const s=["RemoteTrailers","LocalTrailers","People","Studios","Genres","Overview","ProductionYear","OfficialRating","RunTimeTicks","Tags","ImageTags","MediaStreams","UserData","MediaSources","Trickplay","Chapters","Width","Height"];return(await this.api.userLibrary.getItem({userId:e,itemId:t,fields:s})).data}catch(s){return console.error("getItemDetails failed",s),null}}async getLatestItems(e,t){this.api||this.initialize();try{return(await this.api.items.getItems({userId:e,parentId:t,sortBy:["DateCreated"],sortOrder:["Descending"],includeItemTypes:["Movie","Series"],recursive:!0,fields:["PrimaryImageAspectRatio","Overview","ImageTags","ProductionYear","RunTimeTicks"]})).data}catch(s){return console.error("getLatestItems failed",s),{Items:[]}}}getImageUrl(e,t="Primary",s={}){if(!e||!e.Id)return"";const{maxWidth:n=800,quality:r=90}=s;this.api||this.initialize();const l=this.api.configuration.basePath||"",c=e.ImageTags&&e.ImageTags[t]?`&tag=${e.ImageTags[t]}`:"";return`${l}/Items/${e.Id}/Images/${t}?maxWidth=${n}&quality=${r}${c}`}getPlaybackUrl(e){return`#/play/${e}`}getStreamUrl(e,t=null,s=null,n=null,r=null){this.api||this.initialize();const l=this.api.accessToken,c=this.jellyfin.deviceInfo.id;let u=`${this.api.configuration.basePath}/Videos/${e}/master.m3u8?PlaySessionId=LegitFlix-${Date.now()}&api_key=${l}&DeviceId=${c}&VideoCodec=h264,hevc,vp9,av1&AudioCodec=aac,mp3,opus,vorbis&TranscodingContainer=ts&TranscodingProtocol=hls`;return n&&(u+=`&MediaSourceId=${n}`),t!==null&&(u+=`&AudioStreamIndex=${t}`),s!==null&&(u+=`&SubtitleStreamIndex=${s}`),r&&(u+=`&VideoBitrate=${r}`),u}async reportPlaybackProgress(e,t,s,n){this.api||this.initialize();try{await this.api.playstate.reportPlaybackProgress({playbackProgressInfo:{ItemId:e,MediaSourceId:n||e,PositionTicks:t,IsPaused:s,EventName:"TimeUpdate"}})}catch(r){console.warn("Report progress failed (silent)",r)}}async reportPlaybackStopped(e,t){this.api||this.initialize();try{await this.api.playstate.reportPlaybackStopped({playbackStopInfo:{ItemId:e,PositionTicks:t}})}catch(s){console.warn("Report stop failed (silent)",s)}}async getTrickplayManifest(e){this.api||this.initialize();const t=this.api.configuration.basePath||"",s=this.api.accessToken;try{const n=await fetch(`${t}/Videos/${e}/Trickplay`,{headers:{Authorization:`MediaBrowser Token="${s}"`}});return n.ok?await n.json():null}catch(n){return console.warn("Failed to fetch trickplay manifest",n),null}}getTrickplayTileUrl(e,t,s){this.api||this.initialize();const n=this.api.configuration.basePath||"",r=this.api.accessToken;return`${n}/Videos/${e}/Trickplay/${t}/${s}.jpg?api_key=${r}`}async deleteSubtitle(e,t){this.api||this.initialize();try{return(await this.api.subtitle.deleteSubtitle({itemId:e,index:t})).data}catch(s){throw console.error("Failed to delete subtitle",s),s}}async searchRemoteSubtitles(e,t){this.api||this.initialize();try{return(await this.api.subtitle.searchRemoteSubtitles({itemId:e,language:t,isPerfectMatch:!1})).data}catch(s){return console.error("Failed to search subtitles",s),[]}}async downloadRemoteSubtitles(e,t){this.api||this.initialize();try{return(await this.api.subtitle.downloadRemoteSubtitles({itemId:e,subtitleId:t})).data}catch(s){throw console.error("Failed to download subtitle",s),s}}async getMediaStreams(e,t){this.api||this.initialize();const s=await this.getItemDetails(e,t);return s&&s.MediaSources&&s.MediaSources[0]?s.MediaSources[0].MediaStreams||[]:[]}async updatePassword(e,t,s){this.api||this.initialize();const n=await fetch(`${this.api.basePath}/Users/${e}/Password`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`MediaBrowser Token="${this.api.accessToken}"`},body:JSON.stringify({CurrentPw:t,NewPw:s})});if(!n.ok){const r=await n.text();throw new Error(r||"Failed to update password")}return!0}async updateUserConfiguration(e,t){if(this.api||this.initialize(),!(await fetch(`${this.api.basePath}/Users/${e}/Configuration`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`MediaBrowser Token="${this.api.accessToken}"`},body:JSON.stringify(t)})).ok)throw new Error("Failed to update user configuration");return!0}async getAllBackdrops(e,t=50){return this.api||this.initialize(),(await this.api.items.getItems({userId:e,includeItemTypes:["Movie","Series"],imageTypes:["Backdrop"],sortBy:["Random"],limit:t,recursive:!0,fields:["BackdropImageTags"]})).data?.Items||[]}async getUserViews(e){return this.api||this.initialize(),(await this.api.userViews.getUserViews({userId:e})).data}async searchItems(e,t,s=[],n=null){this.api||this.initialize();const r={searchTerm:t,recursive:!0,fields:["PrimaryImageAspectRatio","ProductionYear","DateCreated"],includeItemTypes:s,limit:20};return n&&n!=="All"&&(r.parentId=n),await this.getItems(e,r)}async quickConnect(e){if(this.api||this.initialize(),!(await fetch(`${this.api.basePath}/QuickConnect/Authorize?Code=${e}`,{method:"POST",headers:{Authorization:`MediaBrowser Token="${this.api.accessToken}"`}})).ok)throw new Error("Quick Connect failed. Check the code.");return!0}async initiateQuickConnect(){this.api||this.initialize();const e={"X-Emby-Authorization":`MediaBrowser Client="${this.jellyfin.clientInfo.name}", Device="${this.jellyfin.deviceInfo.name}", DeviceId="${this.jellyfin.deviceInfo.id}", Version="${this.jellyfin.clientInfo.version}"`},t=await fetch(`${this.api.basePath||""}/QuickConnect/Initiate`,{method:"POST",headers:e});if(!t.ok)throw new Error("Failed to initiate Quick Connect");return t.json()}async checkQuickConnectStatus(e){this.api||this.initialize();const t=await fetch(`${this.api.basePath||""}/QuickConnect/Connect?Secret=${e}`,{method:"GET"});if(t.status===200){const s=await t.json();if(s.Authenticated){this.initialize(s.AccessToken);const n=await this.api.user.getUserById({userId:s.UserId}),r={Servers:[{DateLastAccessed:new Date().toISOString(),AccessToken:s.AccessToken,UserId:n.data.Id,Name:n.data.Name,ManualAddress:this.api.basePath}]};return localStorage.setItem("jellyfin_credentials",JSON.stringify(r)),n.data}}return null}async logout(){if(console.log("[LegitFlix] Logging out..."),window.ApiClient)try{await window.ApiClient.logout()}catch(e){console.warn("ApiClient logout failed",e)}localStorage.removeItem("jellyfin_credentials"),this.api=null,window.location.href="/#/login/select-user"}async uploadUserImage(e,t,s){this.api||this.initialize();const n=this.api.accessToken;if(!n)throw new Error("No access token available for upload");const r=`MediaBrowser Client="${this.jellyfin.clientInfo.name}", Device="${this.jellyfin.deviceInfo.name}", DeviceId="${this.jellyfin.deviceInfo.id}", Version="${this.jellyfin.clientInfo.version}", Token="${n}"`,l=s.type||"image/png";console.log(`[LegitFlix] Uploading ${t} image. Size: ${s.size}, Type: ${l}`);const c=await fetch(`${this.api.basePath}/Users/${e}/Images/${t}`,{method:"POST",headers:{"Content-Type":l,"X-Emby-Authorization":r},body:s});if(!c.ok){const h=await c.text();throw console.error("Upload failed response:",h),new Error(`Failed to upload image: ${c.status} ${c.statusText}`)}return!0}async deleteUserImage(e,t){this.api||this.initialize();const s=this.api.accessToken;if(!s)throw new Error("No access token available for delete");const n=`MediaBrowser Client="${this.jellyfin.clientInfo.name}", Device="${this.jellyfin.deviceInfo.name}", DeviceId="${this.jellyfin.deviceInfo.id}", Version="${this.jellyfin.clientInfo.version}", Token="${s}"`,r=await fetch(`${this.api.basePath}/Users/${e}/Images/${t}`,{method:"DELETE",headers:{"X-Emby-Authorization":n}});if(!r.ok)throw new Error(`Failed to delete image: ${r.status} ${r.statusText}`);return!0}}const ee=new TL,ze=({type:i="text",width:e,height:t,style:s={}})=>g.jsx("div",{className:`skeleton skeleton-${i}`,style:{width:e,height:t,...s}});function sy(i,e){if(typeof i=="function")return i(e);i!=null&&(i.current=e)}function EL(...i){return e=>{let t=!1;const s=i.map(n=>{const r=sy(n,e);return!t&&typeof r=="function"&&(t=!0),r});if(t)return()=>{for(let n=0;n<s.length;n++){const r=s[n];typeof r=="function"?r():sy(i[n],null)}}}}var AL=Symbol.for("react.lazy"),uu=lA[" use ".trim().toString()];function IL(i){return typeof i=="object"&&i!==null&&"then"in i}function SS(i){return i!=null&&typeof i=="object"&&"$$typeof"in i&&i.$$typeof===AL&&"_payload"in i&&IL(i._payload)}function _L(i){const e=LL(i),t=w.forwardRef((s,n)=>{let{children:r,...l}=s;SS(r)&&typeof uu=="function"&&(r=uu(r._payload));const c=w.Children.toArray(r),h=c.find(CL);if(h){const u=h.props.children,f=c.map(p=>p===h?w.Children.count(u)>1?w.Children.only(null):w.isValidElement(u)?u.props.children:null:p);return g.jsx(e,{...l,ref:n,children:w.isValidElement(u)?w.cloneElement(u,void 0,f):null})}return g.jsx(e,{...l,ref:n,children:r})});return t.displayName=`${i}.Slot`,t}var RL=_L("Slot");function LL(i){const e=w.forwardRef((t,s)=>{let{children:n,...r}=t;if(SS(n)&&typeof uu=="function"&&(n=uu(n._payload)),w.isValidElement(n)){const l=NL(n),c=OL(r,n.props);return n.type!==w.Fragment&&(c.ref=s?EL(s,l):l),w.cloneElement(n,c)}return w.Children.count(n)>1?w.Children.only(null):null});return e.displayName=`${i}.SlotClone`,e}var wL=Symbol("radix.slottable");function CL(i){return w.isValidElement(i)&&typeof i.type=="function"&&"__radixId"in i.type&&i.type.__radixId===wL}function OL(i,e){const t={...e};for(const s in e){const n=i[s],r=e[s];/^on[A-Z]/.test(s)?n&&r?t[s]=(...c)=>{const h=r(...c);return n(...c),h}:n&&(t[s]=n):s==="style"?t[s]={...n,...r}:s==="className"&&(t[s]=[n,r].filter(Boolean).join(" "))}return{...i,...t}}function NL(i){let e=Object.getOwnPropertyDescriptor(i.props,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?i.ref:(e=Object.getOwnPropertyDescriptor(i,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?i.props.ref:i.props.ref||i.ref)}const iy={default:"lf-btn--primary",primary:"lf-btn--primary",ringHover:"lf-btn--ring-hover",glass:"lf-btn--glass",outline:"lf-btn--outline",ghost:"lf-btn--ghost",destructive:"lf-btn--destructive"},kL={default:"",sm:"lf-btn--sm",lg:"lf-btn--lg",icon:"lf-btn--icon"},gi=w.forwardRef(({className:i="",variant:e="default",size:t="default",asChild:s=!1,...n},r)=>{const l=s?RL:"button",c=iy[e]||iy.default,h=kL[t]||"",u=["lf-btn",c,h,i].filter(Boolean).join(" ");return g.jsx(l,{className:u,ref:r,...n})});gi.displayName="Button";const DL=({onInfoClick:i})=>{const{config:e}=Hi();Ps();const[t,s]=w.useState([]),[n,r]=w.useState(0),[l,c]=w.useState(0),[h,u]=w.useState(!0),f=w.useRef(null),p=w.useRef(null);w.useEffect(()=>{(async()=>{try{const k=await ee.getCurrentUser();if(!k){console.error("No user found for HeroCarousel. jellyfinService.api:",ee.api),u(!1);return}console.log("[HeroCarousel] User found:",k.Name,k.Id);const U=e.contentSortMode||"latest",O={latest:{sortBy:"DateCreated",sortOrder:"Descending"},random:{sortBy:"Random",sortOrder:"Descending"},topRated:{sortBy:"CommunityRating",sortOrder:"Descending"}},{sortBy:F,sortOrder:j}=O[U]||O.latest,M={includeItemTypes:e.heroMediaTypes,recursive:!0,sortBy:F,sortOrder:j,limit:20,fields:["PrimaryImageAspectRatio","Overview","ProductionYear","OfficialRating","CommunityRating","RunTimeTicks","Genres","MediaStreams","UserData","ImageTags","BackdropImageTags"],imageTypeLimit:1,enableImageTypes:["Backdrop","Primary","Logo"]};let te=((await ee.getItems(k.Id,M)).Items||[]).filter(me=>me.BackdropImageTags&&me.BackdropImageTags.length>0);const ae=te.length>3?te.slice(3,9):te.slice(0,6);for(const me of ae)if(me.Type==="Series")try{const D=await ee.getNextUp(k.Id,me.Id);D.Items&&D.Items.length>0&&(me._nextUp=D.Items[0])}catch(D){console.warn("Failed to fetch Next Up",D)}s(ae)}catch(k){console.error("HeroCarousel fetch error",k)}finally{u(!1)}})()},[e]);const v=()=>{s(C=>(C.length===0||r(k=>(k+1)%C.length),C)),c(C=>C+1)},x=C=>{r(C),c(k=>k+1),S()},S=()=>{f.current&&clearInterval(f.current),f.current=setInterval(v,8e3),p.current&&p.current.classList.remove("carousel-paused")};w.useEffect(()=>(t.length>0&&S(),()=>clearInterval(f.current)),[t]);const E=async(C,k)=>{C.stopPropagation(),C.currentTarget;const U=k.UserData?.IsFavorite,O={...k,UserData:{...k.UserData,IsFavorite:!U}};s(F=>F.map(j=>j.Id===k.Id?O:j));try{const F=await ee.getCurrentUser();F&&await ee.markFavorite(F.Id,k.Id,!U)}catch(F){console.error("Failed to toggle fav",F),s(j=>j.map(M=>M.Id===k.Id?k:M))}};if(h)return g.jsxs("div",{className:"hero-carousel-container",style:{height:"90vh",background:"#111",position:"relative"},children:[g.jsx(ze,{width:"100%",height:"100%"}),g.jsxs("div",{style:{position:"absolute",top:"42.5%",left:"4%",transform:"translateY(-50%)",width:"40%",maxWidth:"600px",display:"flex",flexDirection:"column",gap:"1.25rem"},children:[g.jsx(ze,{width:"70%",height:"60px",style:{marginBottom:"0"}}),g.jsx(ze,{width:"40%",height:"24px"}),g.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"8px",width:"100%"},children:[g.jsx(ze,{width:"100%",height:"18px"}),g.jsx(ze,{width:"95%",height:"18px"}),g.jsx(ze,{width:"60%",height:"18px"})]}),g.jsxs("div",{style:{display:"flex",gap:"12px",marginTop:"0.5rem"},children:[g.jsx(ze,{width:"160px",height:"46px",style:{borderRadius:"50px"}}),g.jsx(ze,{width:"42px",height:"42px",style:{borderRadius:"50%"}}),g.jsx(ze,{width:"42px",height:"42px",style:{borderRadius:"50%"}})]})]})]});if(t.length===0)return null;const T=C=>`${ee.api.basePath}/Items/${C}/Images/Backdrop/0?maxHeight=1080&quality=96`,A=C=>`${ee.api.basePath}/Items/${C}/Images/Logo?maxHeight=200&maxWidth=450&quality=90`,I=C=>{let k=new Set,U=new Set;C.MediaStreams&&C.MediaStreams.forEach(j=>{j.Type==="Audio"&&j.Language&&k.add(j.Language),j.Type==="Subtitle"&&j.Language&&U.add(j.Language)});const O=U.size>0,F=k.size>1;return O&&F?"Sub | Dub":O?"Sub":F?"Dub":""},_=C=>{if(C.RunTimeTicks&&C.Type!=="Series"){const k=C.RunTimeTicks/1e4,O=new Date(Date.now()+k).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1});return g.jsxs(g.Fragment,{children:[g.jsx("span",{className:"hero-meta-divider",children:""}),g.jsxs("span",{className:"hero-meta-text",children:["Ends at ",O]})]})}return null};return g.jsxs("div",{id:"legit-hero-carousel",className:"hero-carousel-container",ref:p,children:[t.map((C,k)=>{const U=k===n,O=I(C),F=_(C),j=C.ImageTags&&C.ImageTags.Logo;let M="START WATCHING",H="";if(C.Type==="Series")if(C._nextUp){const te=C._nextUp.ParentIndexNumber,ae=C._nextUp.IndexNumber;M="CONTINUE",H=`S${te} E${ae}`}else H="S1 E1";else if(C.UserData&&C.UserData.PlaybackPositionTicks>0){const te=Math.round(C.UserData.PlaybackPositionTicks/C.RunTimeTicks*100);te>2&&te<90&&(M="CONTINUE",H=` - ${te}%`)}const K=C.UserData?.IsFavorite;return g.jsxs("div",{className:`hero-slide ${U?"active":""}`,"data-index":k,children:[g.jsx("div",{className:"hero-backdrop",style:{backgroundImage:`url('${T(C.Id)}')`}}),g.jsx("div",{className:"hero-overlay"}),g.jsxs("div",{className:"hero-content",children:[j?g.jsx("img",{src:A(C.Id),className:"hero-logo",alt:C.Name}):g.jsx("h1",{className:"hero-title",children:C.Name}),g.jsxs("div",{className:"hero-meta-line",children:[g.jsx("span",{className:"hero-badge-age",children:C.OfficialRating||"13+"}),O&&g.jsxs(g.Fragment,{children:[g.jsx("span",{className:"hero-meta-divider",children:""}),g.jsx("span",{className:"hero-meta-text",children:O})]}),g.jsx("span",{className:"hero-meta-divider",children:""}),g.jsx("span",{className:"hero-meta-text",children:C.Genres?C.Genres.slice(0,3).join(", "):"Anime"}),C.CommunityRating&&g.jsxs(g.Fragment,{children:[g.jsx("span",{className:"hero-meta-divider",children:""}),g.jsxs("span",{className:"hero-meta-text",children:[" ",C.CommunityRating.toFixed(1)]})]}),F]}),g.jsx("p",{className:"hero-desc",children:C.Overview}),g.jsxs("div",{className:"hero-actions flex gap-3 items-center",children:[g.jsxs(gi,{variant:"ringHover",onClick:te=>{te.stopPropagation(),window.location.href=`/web/index.html?classic=true#!/playback?id=${C.Id}`},children:[g.jsx("i",{className:"material-icons",children:"play_arrow"}),g.jsxs("span",{children:[M," ",g.jsx("small",{className:"text-sm ml-1",children:H})]})]}),g.jsx(gi,{variant:"outline",size:"icon",className:`rounded-full w-12 h-12 border-2 border-white/20 bg-black/40 hover:bg-white/10 hover:border-white ${K?"text-primary":"text-white"}`,onClick:te=>E(te,C),children:g.jsx("span",{className:K?"material-icons":"material-icons-outlined",children:K?"bookmark":"bookmark_border"})}),g.jsx(gi,{variant:"outline",size:"icon",className:"rounded-full w-12 h-12 border-2 border-white/20 bg-black/40 hover:bg-white/10 hover:border-white text-white",onClick:te=>{te.stopPropagation(),i(C.Id)},title:"More Info",children:g.jsx("span",{className:"material-icons-outlined",children:"info"})})]})]})]},C.Id)}),g.jsx("div",{className:"hero-indicators",children:t.map((C,k)=>{const U=k===n,O=k<n;return g.jsx("div",{className:`hero-indicator ${U?"active":""} ${O?"completed":""}`,onClick:()=>x(k),children:g.jsx("div",{className:"fill"},`fill-${k}-${U?l:"inactive"}`)},k)})})]})},PL=({item:i,onClick:e})=>{const[t,s]=w.useState(!1),[n,r]=w.useState(null),[l,c]=w.useState({top:0,left:0,width:0,height:0}),h=w.useRef(null),u=w.useRef(null),[f,p]=w.useState(i.UserData||{}),v=async()=>{if(h.current&&(clearTimeout(h.current),h.current=null),u.current){const _=u.current.getBoundingClientRect();if(c({top:_.top+window.scrollY,left:_.left+window.scrollX,width:_.width,height:_.height}),s(!0),!n)try{const C=await ee.getCurrentUser();if(C){const k=await ee.getItemDetails(C.Id,i.Id);r(k),p(k.UserData||{})}}catch(C){console.error("Failed to fetch details",C)}}},x=()=>{h.current=setTimeout(()=>{s(!1)},100)},S=()=>{h.current&&(clearTimeout(h.current),h.current=null)},E=async(_,C)=>{if(_.stopPropagation(),!!n)try{const k=await ee.getCurrentUser();if(C==="played"){const U=!f.Played;p(O=>({...O,Played:U})),await ee.markPlayed(k.Id,i.Id,U)}else if(C==="favorite"){const U=!f.IsFavorite;p(O=>({...O,IsFavorite:U})),await ee.markFavorite(k.Id,i.Id,U)}}catch(k){console.error("Action failed",k)}},T=()=>{const _=[];return i.ProductionYear&&_.push(i.ProductionYear),i.Type==="Series"&&i.Status==="Continuing"&&_.push("Airing"),_.join("  ")||""},A=_=>{if(!_||!_.MediaSources||!_.MediaSources[0])return null;const C=_.MediaSources[0].MediaStreams||[];if(C.length===0)return null;const k=C.filter(M=>M.Type==="Audio"),U=C.filter(M=>M.Type==="Subtitle"),O=k.some(M=>M.Language==="eng"||M.Language==="en"||M.Language==="english"||M.DisplayTitle&&M.DisplayTitle.toLowerCase().includes("eng")),F=k.some(M=>M.Language==="jpn"||M.Language==="ja"||M.Language==="japanese"||M.DisplayTitle&&M.DisplayTitle.toLowerCase().includes("jap")),j=U.some(M=>M.Language==="eng"||M.Language==="en"||M.Language==="english"||M.DisplayTitle&&M.DisplayTitle.toLowerCase().includes("eng"));return O&&(F||j)?"Sub | Dub":O?"Dub":j?"Sub":null},I=()=>{if(!t)return null;const _=n||i,C=_.CommunityRating?_.CommunityRating.toFixed(1):"",k=_.VoteCount?`(${(_.VoteCount/1e3).toFixed(1)}K)`:"",U=_.ChildCount,O=_.RecursiveItemCount||_.ChildCount,F=A(_),j=l.width+4,M=l.height+8,H=l.left-2,K=l.top-4,te=`${ee.api.basePath}/Items/${i.Id}/Images/Primary?fillHeight=600&fillWidth=400&quality=90`;return qI.createPortal(g.jsxs("div",{className:"media-card-hover-overlay",style:{top:K,left:H,width:j,minHeight:M,backgroundImage:`url('${te}')`},onMouseEnter:S,onMouseLeave:x,onClick:e,children:[g.jsx("div",{className:"hover-overlay-gradient"}),g.jsxs("div",{className:"hover-overlay-content",children:[g.jsxs("div",{className:"hover-info-group",children:[g.jsx("h3",{className:"hover-title",children:_.Name}),g.jsxs("div",{className:"hover-meta-row",children:[C&&g.jsxs("span",{className:"hover-rating",children:[C," ",g.jsx("span",{className:"material-icons star-icon",children:"star"}),k&&g.jsx("span",{className:"hover-rating-count",children:k})]}),g.jsx("span",{className:"hover-meta-separator",children:""}),g.jsxs("div",{className:"hover-stats",children:[_.Type==="Series"?g.jsxs(g.Fragment,{children:[U?g.jsxs("span",{children:[U," Seasons"]}):null,U&&O?g.jsx("span",{children:"  "}):null,O?g.jsxs("span",{children:[O," Episodes"]}):null]}):g.jsx("span",{children:_.ProductionYear}),F&&g.jsxs(g.Fragment,{children:[g.jsx("span",{children:"  "}),g.jsx("span",{style:{color:"#fff",fontWeight:"bold",border:"1px solid rgba(255,255,255,0.3)",padding:"0 4px",borderRadius:"3px",fontSize:"0.7rem"},children:F})]})]})]}),_.Overview&&g.jsx("p",{className:"hover-desc",children:_.Overview})]}),g.jsxs("div",{className:"hover-actions",children:[g.jsx("button",{className:"btn-action-icon play-icon",title:"Play",onClick:ae=>{ae.stopPropagation(),e&&e()},children:g.jsx("span",{className:"material-icons",children:"play_arrow"})}),g.jsx("button",{className:`btn-action-icon bookmark-icon ${f.IsFavorite?"active":""}`,onClick:ae=>E(ae,"favorite"),title:f.IsFavorite?"Unfavorite":"Favorite",children:g.jsx("span",{className:"material-icons",children:f.IsFavorite?"bookmark":"bookmark_border"})}),g.jsx("button",{className:`btn-action-icon plus-icon ${f.Played?"active":""}`,onClick:ae=>E(ae,"played"),title:f.Played?"Mark Unplayed":"Mark Played",children:g.jsx("span",{className:"material-icons",children:"add"})})]})]})]}),document.body)};return g.jsxs(g.Fragment,{children:[g.jsxs("div",{className:"media-card",ref:u,onMouseEnter:v,onMouseLeave:x,onClick:e,children:[g.jsx("div",{className:"media-card-image-container",children:g.jsx("img",{src:`${ee.api.basePath}/Items/${i.Id}/Images/Primary?fillHeight=500&fillWidth=340&quality=90`,alt:i.Name,className:"media-card-image",loading:"lazy",onError:_=>{_.target.style.display="none"}})}),g.jsxs("div",{className:"media-card-info",children:[g.jsx("div",{className:"media-card-title",children:i.Name}),T()&&g.jsx("div",{className:"media-card-subtitle",children:T()})]})]}),I()]})},UL=({title:i,libraryId:e,onCardClick:t})=>{const[s,n]=w.useState([]),[r,l]=w.useState(!0),[c,h]=w.useState(!1),[u,f]=w.useState(!1),p=w.useRef(null),v=Ps(),x=()=>{if(p.current){const{scrollLeft:E,scrollWidth:T,clientWidth:A}=p.current;h(E>5),f(E+A<T-5)}};w.useEffect(()=>{(async()=>{l(!0);try{const T=await ee.getCurrentUser();if(T&&e){const A=await ee.getLatestItems(T.Id,e);A&&A.Items&&n(A.Items)}}catch(T){console.error("MediaRow fetch error",T)}finally{l(!1)}})()},[e]),w.useEffect(()=>{if(!r&&s.length>0){const E=setTimeout(x,100);return window.addEventListener("resize",x),()=>{window.removeEventListener("resize",x),clearTimeout(E)}}},[r,s]);const S=E=>{if(p.current){const T=p.current,A=window.innerWidth*.8;T.scrollBy({left:E==="left"?-A:A,behavior:"smooth"}),setTimeout(x,500)}};return r?g.jsxs("div",{className:"media-row-container",children:[g.jsx("div",{style:{padding:"0 4%",marginBottom:"15px"},children:g.jsx(ze,{width:"150px",height:"24px"})}),g.jsx("div",{className:"media-row-wrapper",style:{paddingLeft:"4%",display:"flex",gap:"15px",overflow:"hidden"},children:[1,2,3,4,5,6].map(E=>g.jsx("div",{style:{flex:"0 0 160px"},children:g.jsx(ze,{width:"100%",height:"240px",style:{borderRadius:"8px"}})},E))})]}):s.length===0?null:g.jsxs("div",{className:"media-row-container",children:[g.jsxs("h2",{className:"media-row-title",onClick:()=>v(`/library/${e}`),style:{cursor:"pointer",display:"flex",alignItems:"center",gap:"5px"},children:[i," ",g.jsx("span",{style:{fontSize:"0.8em",opacity:.7},children:""})]}),g.jsxs("div",{className:"media-row-wrapper",children:[c&&g.jsx("button",{className:"row-arrow left",onClick:()=>S("left"),children:g.jsx("span",{className:"material-icons",children:"chevron_left"})}),g.jsx("div",{className:"media-row-scroll",ref:p,onScroll:x,children:s.map(E=>g.jsx(PL,{item:E,onClick:()=>t?t(E):v(`/item/${E.Id}`)},E.Id))}),u&&g.jsx("button",{className:"row-arrow right",onClick:()=>S("right"),children:g.jsx("span",{className:"material-icons",children:"chevron_right"})})]})]})},ML=({itemId:i,onClose:e,isOpen:t})=>{const[s,n]=w.useState(null),[r,l]=w.useState([]),[c,h]=w.useState(null),[u,f]=w.useState(!0),[p,v]=w.useState(!1),[x,S]=w.useState(!1),[E,T]=w.useState(null);if(w.useEffect(()=>!t||!i?void 0:((async()=>{S(!0);const M=await ee.getCurrentUser(),H=K=>K?K.includes("v=")?K.split("v=")[1].split("&")[0]:K.includes("youtu.be/")?K.split("youtu.be/")[1].split("?")[0]:K.includes("embed/")?K.split("embed/")[1].split("?")[0]:null:null;if(M){T(M.Id);const K=await ee.getItemDetails(M.Id,i);n(K);const te=[];if(K.RemoteTrailers&&K.RemoteTrailers.forEach(ae=>{const me=H(ae.Url);me&&te.push({title:"Main Trailer",id:me,type:"Movie"})}),K.Type==="Series"&&(await ee.getSeasons(M.Id,i)).forEach(me=>{me.RemoteTrailers&&me.RemoteTrailers.forEach(D=>{const G=H(D.Url);G&&te.push({title:me.Name,id:G})})}),K.LocalTrailers&&K.LocalTrailers.forEach(ae=>{te.push({title:ae.Name||"Local Trailer",id:ae.Id,type:"Local"})}),l(te),te.length>0)h(te[0].id);else if(K.Type==="Series"||K.Type==="Movie"){const ae=`${K.Name} ${K.ProductionYear||""} Trailer`;l([{title:"Search YouTube",id:ae,type:"Search"}]),h(ae)}}})(),document.body.style.overflow="hidden",()=>{document.body.style.overflow="",n(null),l([]),h(null),S(!1)}),[t,i]),w.useEffect(()=>{let j;const M=()=>{v(!1),clearTimeout(j),j=setTimeout(()=>v(!0),5e3)};return window.addEventListener("mousemove",M),window.addEventListener("click",M),M(),()=>{window.removeEventListener("mousemove",M),window.removeEventListener("click",M),clearTimeout(j)}},[t]),!t||!s)return null;const A=async()=>{if(!E||!s)return;const j=!s.UserData?.IsFavorite;n(M=>({...M,UserData:{...M.UserData,IsFavorite:j}}));try{await ee.markFavorite(E,s.Id,j)}catch{n(H=>({...H,UserData:{...H.UserData,IsFavorite:!j}}))}},I=()=>{window.location.href=`#!/details?id=${s.Id}`},_=()=>{f(!u)},C=`${ee.api.basePath}/Items/${s.Id}/Images/Backdrop/0?quality=90&maxWidth=1920`,k=s.ImageTags&&s.ImageTags.Logo?`${ee.api.basePath}/Items/${s.Id}/Images/Logo?maxHeight=140&maxWidth=400&quality=90`:null,U=r.find(j=>j.id===c);let O=null,F=!1;return U&&(U.type==="Local"?(F=!0,O=`${ee.api.basePath}/Videos/${U.id}/stream?Container=mp4&Static=true&api_key=${ee.api.accessToken}`):U.type==="Search"?O=`https://www.youtube.com/embed?listType=search&list=${encodeURIComponent(U.id)}&autoplay=1&mute=${u?1:0}&loop=1&modestbranding=1&rel=0&iv_load_policy=3&fs=0&color=white&controls=0&disablekb=1`:O=`https://www.youtube.com/embed/${U.id}?autoplay=1&mute=${u?1:0}&loop=1&modestbranding=1&rel=0&iv_load_policy=3&fs=0&color=white&controls=0&disablekb=1&playlist=${U.id}&enablejsapi=1`),g.jsxs("div",{className:`legitflix-info-modal ${x?"visible":""}`,children:[g.jsx("div",{className:"info-modal-backdrop",onClick:e}),g.jsxs("div",{className:"info-modal-content",children:[g.jsx(gi,{variant:"ghost",size:"icon",className:"btn-close-modal absolute top-5 right-5 z-50 rounded-full bg-black/50 text-white hover:bg-white/20",onClick:e,children:g.jsx("span",{className:"material-icons",children:"close"})}),g.jsxs("div",{className:"info-video-container",children:[g.jsx("div",{className:"iframe-wrapper",children:O?F?g.jsx("video",{className:"info-video-iframe",src:O,autoPlay:!0,muted:u,loop:!0,playsInline:!0,style:{objectFit:"cover",width:"100%",height:"100%"}}):g.jsx("iframe",{className:"info-video-iframe",src:O,title:"Trailer",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"}):g.jsx("div",{className:"info-backdrop-fallback",style:{backgroundImage:`url('${C}')`}})}),g.jsx("div",{className:"video-overlay-gradient"}),O&&g.jsx("div",{className:"video-mute-overlay",children:g.jsx(gi,{variant:"ghost",size:"icon",className:"rounded-full w-10 h-10 border border-white/30 bg-black/30 hover:bg-white/10 text-white",onClick:_,children:g.jsx("span",{className:"material-icons text-lg",children:u?"volume_off":"volume_up"})})}),g.jsxs("div",{className:`info-hero-content ${p?"idle":""}`,children:[k?g.jsx("img",{src:k,className:"info-logo",alt:s.Name}):g.jsx("h1",{className:"info-title-text",children:s.Name}),g.jsxs("div",{className:"info-actions flex gap-4 mt-6",children:[g.jsxs(gi,{variant:"ringHover",size:"lg",className:"h-12 px-8 text-lg font-bold rounded-md gap-2",onClick:I,children:[g.jsx("span",{className:"material-icons",children:"play_arrow"})," Play"]}),g.jsxs(gi,{variant:"outline",size:"lg",className:`h-12 px-6 text-lg rounded-md gap-2 border-2 bg-transparent hover:bg-white/10 ${s.UserData?.IsFavorite?"border-primary text-primary":"border-white/40 text-white"}`,onClick:A,children:[g.jsx("span",{className:"material-icons",children:s.UserData?.IsFavorite?"check":"add"})," My List"]})]})]})]}),g.jsx("div",{className:"info-details-container",children:g.jsxs("div",{className:"info-col-left",children:[g.jsxs("div",{className:"info-meta-row",children:[g.jsx("span",{className:"info-year",children:s.ProductionYear}),s.OfficialRating&&g.jsx("span",{className:"info-rating",children:s.OfficialRating}),g.jsx("span",{className:"info-duration",children:s.RunTimeTicks?Math.round(s.RunTimeTicks/6e8)+"m":""}),g.jsx("span",{className:"info-quality",children:"HD"})]}),g.jsx("p",{className:"info-desc",children:s.Overview||"No description available."})]})}),g.jsxs("div",{className:"info-trailers-section",children:[g.jsx("h3",{children:"Trailers & More"}),g.jsxs("div",{className:"trailers-grid",children:[r.map(j=>g.jsxs("div",{className:"trailer-card",onClick:()=>h(j.id),children:[g.jsxs("div",{className:"trailer-thumb",children:[j.type==="Local"?g.jsx("div",{className:"local-trailer-placeholder",children:g.jsx("span",{className:"material-icons",children:"movie"})}):g.jsx("img",{src:`https://img.youtube.com/vi/${j.id}/mqdefault.jpg`,alt:j.title,loading:"lazy"}),g.jsx("div",{className:"play-overlay",children:g.jsx("span",{className:"material-icons",children:"play_circle_outline"})})]}),g.jsx("div",{className:"trailer-title",children:j.title})]},j.id)),g.jsxs("a",{href:`https://www.youtube.com/results?search_query=${encodeURIComponent(s.Name+" "+(s.ProductionYear||"")+" trailer")}`,target:"_blank",rel:"noopener noreferrer",className:"trailer-card search-card",children:[g.jsx("div",{className:"trailer-thumb search-thumb",children:g.jsx("span",{className:"material-icons",children:"search"})}),g.jsx("div",{className:"trailer-title",children:"Search YouTube"})]})]})]}),g.jsxs("div",{className:"info-about-section",children:[g.jsxs("h3",{children:["About ",s.Name]}),s.People&&g.jsxs("div",{className:"about-row",children:[g.jsx("span",{className:"label",children:"Cast: "}),g.jsx("span",{className:"value",children:s.People.slice(0,10).map(j=>j.Name).join(", ")})]}),s.Genres&&g.jsxs("div",{className:"about-row",children:[g.jsx("span",{className:"label",children:"Genres: "}),g.jsx("span",{className:"value",children:s.Genres.join(", ")})]})]})]})]})},jL=()=>{const{config:i}=Hi();return i.enableJellyseerr?g.jsx("div",{className:"library-card jellyseerr-card-wrapper",children:g.jsx("a",{href:i.jellyseerrUrl,target:"_blank",rel:"noopener noreferrer",className:"jellyseerr-card",children:g.jsxs("div",{className:"jellyseerr-image",style:{backgroundImage:`url('${i.jellyseerrBackground||"https://raw.githubusercontent.com/gorillasuti/Legitflix-plugin/refs/heads/main/legitflix-client/public/jellyseerr.jpg"}')`},children:[g.jsx("div",{className:"jellyseerr-overlay"}),g.jsxs("div",{className:"jellyseerr-content",children:[g.jsx("span",{className:"material-icons card-icon",children:"add_circle_outline"}),g.jsx("span",{className:"card-label",children:i.jellyseerrText||"Request Feature"})]})]})})}):null},FL=({isOpen:i,onClose:e})=>{const[t,s]=w.useState(""),[n,r]=w.useState([]),[l,c]=w.useState({Name:"All",Id:"All"}),[h,u]=w.useState([{Name:"All",Id:"All"}]),[f,p]=w.useState(!1),v=w.useRef(null),x=Ps();if(w.useEffect(()=>{(async()=>{try{const T=await ee.getCurrentUser();if(T){const A=await ee.getUserViews(T.Id);A&&A.Items&&u([{Name:"All",Id:"All"},...A.Items])}}catch(T){console.error("Failed to fetch views",T)}})()},[]),w.useEffect(()=>{i&&setTimeout(()=>v.current?.focus(),100)},[i]),w.useEffect(()=>{const T=setTimeout(async()=>{if(p(!0),r([]),t.trim().length===0){if(l.Id!=="All")try{const A=await ee.getCurrentUser();if(A){const I=await ee.getItems(A.Id,{parentId:l.Id,limit:20,sortBy:["DateCreated"],sortOrder:["Descending"],includeItemTypes:["Movie","Series","BoxSet"],recursive:!0,fields:["PrimaryImageAspectRatio","ProductionYear"]});r(I.Items||[])}}catch(A){console.error("Category fetch failed",A),r([])}else r([]);p(!1);return}try{const A=await ee.getCurrentUser();if(!A){p(!1);return}const I=await ee.searchItems(A.Id,t,["Movie","Series","Person","BoxSet"],l.Id);r(I.Items||[])}catch(A){console.error("Search failed",A)}finally{p(!1)}},300);return()=>clearTimeout(T)},[t,l]),!i)return null;const S=E=>{e(),E.Type==="Movie"?x(`/movie/${E.Id}`):E.Type==="Series"?x(`/series/${E.Id}`):E.Type==="Person"?x(`/person/${E.Id}`):E.Type==="BoxSet"?x(`/collections/${E.Id}`):x(`/details/${E.Id}`)};return g.jsx("div",{className:`legit-search-overlay ${i?"visible":""}`,onClick:e,children:g.jsxs("div",{className:"legit-search-modal",onClick:E=>E.stopPropagation(),children:[g.jsxs("div",{className:"legit-search-header",children:[g.jsx("span",{className:"material-icons legit-search-icon",children:"search"}),g.jsx("input",{ref:v,className:"legit-search-input",placeholder:"Start typing to search...",value:t,onChange:E=>s(E.target.value),onKeyDown:E=>{E.key==="Escape"&&e()}}),g.jsxs("div",{className:"legit-search-actions",onClick:e,children:[g.jsx("span",{className:"legit-search-esc",children:"esc"}),g.jsx("span",{className:"legit-search-close",children:"Close"})]})]}),g.jsx("div",{className:"legit-search-categories",children:h.map(E=>g.jsx("div",{className:`legit-search-category-pill ${l.Id===E.Id?"active":""}`,onClick:()=>c(E),children:E.Name},E.Id))}),g.jsx("div",{className:"legit-search-results",children:f?Array.from({length:5}).map((E,T)=>g.jsxs("div",{className:"legit-search-result-item skeleton-item",style:{pointerEvents:"none"},children:[g.jsx(ze,{width:"40px",height:"60px",style:{borderRadius:"4px",marginRight:"15px"}}),g.jsxs("div",{className:"legit-result-info",style:{width:"100%"},children:[g.jsx(ze,{width:"60%",height:"20px",style:{marginBottom:"8px"}}),g.jsx(ze,{width:"30%",height:"14px"})]})]},`skeleton-${T}`)):g.jsxs(g.Fragment,{children:[n.length===0&&t.length>0&&g.jsxs("div",{className:"legit-no-results",children:['No results found for "',t,'"']}),n.length===0&&t.length===0&&l.Id!=="All"&&g.jsxs("div",{className:"legit-no-results",children:["No items found in ",l.Name]}),t.length===0&&l.Id==="All"&&g.jsxs("div",{className:"legit-search-helper",children:[g.jsx("span",{className:"material-icons",children:"keyboard"}),g.jsx("p",{children:"Start typing to search..."})]}),n.map(E=>g.jsxs("div",{className:"legit-search-result-item",onClick:()=>S(E),children:[g.jsx("div",{className:"legit-result-thumb",style:{backgroundImage:`url(${ee.api.basePath}/Items/${E.Id}/Images/Primary?fillHeight=60&fillWidth=40&quality=90)`,backgroundColor:"#222"},children:!E.ImageTags?.Primary&&g.jsx("span",{className:"material-icons legit-result-icon-fallback",children:"movie"})}),g.jsxs("div",{className:"legit-result-info",children:[g.jsx("div",{className:"legit-result-title",children:E.Name}),g.jsxs("div",{className:"legit-result-meta",children:[g.jsx("span",{className:"legit-result-tag",children:E.Type?.toUpperCase()}),E.ProductionYear&&g.jsx("span",{children:E.ProductionYear})]})]})]},E.Id))]})})]})})},hm=({isOpen:i,onClose:e,onSave:t,userId:s})=>{const[n,r]=w.useState([]),[l,c]=w.useState(null),[h,u]=w.useState(!1);if(w.useEffect(()=>{if(!i||!s)return;u(!0),c(null),(async()=>{try{const E=(await ee.getAllBackdrops(s,50)).filter(T=>T.BackdropImageTags&&T.BackdropImageTags.length>0);r(E)}catch(S){console.error("[BannerPicker] Failed to fetch backdrops",S)}finally{u(!1)}})()},[i,s]),!i)return null;const f=x=>{const S=x.BackdropImageTags?.[0];return`${ee.api.basePath}/Items/${x.Id}/Images/Backdrop/0?quality=80&maxWidth=600&tag=${S}`},p=x=>{const S=x.BackdropImageTags?.[0];return`${ee.api.basePath}/Items/${x.Id}/Images/Backdrop/0?quality=90&maxWidth=1920&tag=${S}`},v=()=>{l&&t(l),e()};return g.jsxs("div",{className:"banner-picker-overlay",children:[g.jsx("div",{className:"banner-picker-backdrop",onClick:e}),g.jsxs("div",{className:"banner-picker-modal",children:[g.jsx("h2",{className:"banner-picker-title",children:"Select Banner"}),h?g.jsx("div",{className:"banner-picker-grid",children:[1,2,3,4,5,6,7,8,9,10,11,12].map(x=>g.jsx("div",{className:"banner-picker-card",children:g.jsx(ze,{width:"100%",height:"100%",style:{borderRadius:"6px"}})},x))}):g.jsx("div",{className:"banner-picker-grid",children:n.map(x=>{const S=f(x),E=p(x),T=l===E;return g.jsx("div",{className:`banner-picker-card ${T?"selected":""}`,onClick:()=>c(E),children:g.jsx("img",{src:S,alt:x.Name,loading:"lazy"})},x.Id)})}),g.jsxs("div",{className:"banner-picker-actions",children:[g.jsx("button",{className:"btn-picker-close",onClick:e,children:"CLOSE"}),g.jsxs("button",{className:"btn-picker-save",onClick:v,disabled:!l,children:[g.jsx("span",{className:"material-icons",children:"save"})," SAVE"]})]})]})]})},BL=["010c7b9061ece2fbf7bbb8d9bb6d2bee16f4a68c.png","1b2d497a3f909e45b0cdbc08cc6d5aa1a949a1a2.png","1def8ba1616b0966e1db6021f1055ca356d1cea9.png","27c51845bddee8f4ff1c30aeb716d8aa731b6286.png","31687dea129fb21a578977565077d44b0ca92da5.png","3394687450705634476d174e6b395f0aa41db487.png","339bc7408b3c9e38fe40f8d6689bf441bca8357a.png","35d29230db5589057d23849f6369f22e90044cd1.png","38d52512bdd7a762bbadf4ae673d80140a118957.png","3bf2c8889e738213673c1a77803587aedd4a8148.png","45aff5dc4892254211d4982c12e2bf0ac8caef90.png","5e3f3f8dd9ca520c92d2b3dd23ec9737203631d9.png","62c5f931445c1a5a1228cb24f913fa0234a577c2.png","64fd2f5c0fbb5e0c5348f3947e5fd6b762e3e8ea.png","6980956ae6150a0697586505546be9ad377250a0.png","6ef91d4e1b1377703ed9caef1072f327c5ce107f.png","71dcab8c2f39540c99eab624d2bdada0ac9cb44e.png","79b07958e72c796a12eceba7832dc8e3bae85ca9.png","7cafcf32034f4c292574ced3e745a83d0c68e11e.png","8623109ba7bc471ab63ca32e1d820c3806c2c36c.png","98b48b004a2882f1dc3e9f12167304d6417d3bd4.png","99d8a4f741a9f042c71a6d2f5017f39f6f35e350.png","ab21304ad03dc74e4267320069636ca096ec7ea2.png","ae4337ebf3305b6c66020fde433c92257b7c5616.png","aebd06a8792119a23ca1c11a285cfca7468bfa67.png","b0caf3e60209775ab9c34662b7d860ba3e07f17a.png","b20b75517fe91a777d67d434f534378c987c8f89.png","b628ef1fe21c1a97773cab1b8efe341f651a20ef.png","c9d0048f1edf7bd5c415e676ebfce0e600166481.png","cde86a64d2c491f4494c916fc81fdc3a1980654e.png","d96038f9fde13a71369fd3b42bd53832f8db4be0.png","e8b7f5f61a4905834e169f89f3835b905659a44d.png","Netflix-abaya-61.png","Netflix-abaya-69.png","Netflix-academic_gown-27.png","Netflix-academic_gown-75.png","Netflix-affenpinscher-38.png","Netflix-ashcan-38.png","Netflix-balance_beam-10.png","Netflix-balloon-17.png","Netflix-balloon-20.png","Netflix-balloon-24.png","Netflix-balloon-35.png","Netflix-balloon-58.png","Netflix-ballplayer-21.png","Netflix-Band_Aid-23.png","Netflix-Band_Aid-29.png","Netflix-Band_Aid-34.png","Netflix-Band_Aid-54.png","Netflix-Band_Aid-65.png","Netflix-Band_Aid-92.png","Netflix-Band_Aid-94.png","Netflix-barn_spider-14.png","Netflix-basenji-11.png","Netflix-bassoon-11.png","Netflix-bearskin-54.png","Netflix-bikini-14.png","Netflix-bikini-26.png","Netflix-binoculars-62.png","Netflix-book_jacket-14.png","Netflix-bow_tie-10.png","Netflix-bow_tie-13.png","Netflix-bow_tie-39.png","Netflix-bow_tie-66.png","Netflix-bow_tie-97.png","Netflix-brassiere-11.png","Netflix-brassiere-15.png","Netflix-brassiere-18.png","Netflix-brassiere-58.png","Netflix-cardigan-28.png","Netflix-cellular_telephone-73.png","Netflix-chain_saw-43.png","Netflix-chain_saw-82.png","Netflix-chime-11.png","Netflix-coffeepot-11.png","Netflix-comic_book-12.png","Netflix-comic_book-13.png","Netflix-comic_book-14.png","Netflix-comic_book-16.png","Netflix-comic_book-18.png","Netflix-comic_book-20.png","Netflix-comic_book-21.png","Netflix-comic_book-23.png","Netflix-comic_book-26.png","Netflix-comic_book-31.png","Netflix-comic_book-35.png","Netflix-comic_book-36.png","Netflix-comic_book-38.png","Netflix-comic_book-39.png","Netflix-comic_book-45.png","Netflix-comic_book-46.png","Netflix-comic_book-48.png","Netflix-comic_book-49.png","Netflix-comic_book-51.png","Netflix-comic_book-53.png","Netflix-comic_book-55.png","Netflix-comic_book-56.png","Netflix-comic_book-61.png","Netflix-comic_book-64.png","Netflix-comic_book-65.png","Netflix-comic_book-66.png","Netflix-comic_book-69.png","Netflix-comic_book-70.png","Netflix-comic_book-74.png","Netflix-comic_book-76.png","Netflix-comic_book-77.png","Netflix-comic_book-78.png","Netflix-comic_book-81.png","Netflix-comic_book-83.png","Netflix-comic_book-84.png","Netflix-comic_book-85.png","Netflix-comic_book-92.png","Netflix-comic_book-93.png","Netflix-comic_book-95.png","Netflix-comic_book-96.png","Netflix-comic_book-97.png","Netflix-corkscrew-10.png","Netflix-cornet-14.png","Netflix-crane-77.png","Netflix-crash_helmet-56.png","Netflix-Crock_Pot-42.png","Netflix-Crock_Pot-49.png","Netflix-digital_clock-37.png","Netflix-digital_clock-69.png","Netflix-drum-48.png","Netflix-dumbbell-18.png","Netflix-envelope-25.png","Netflix-feather_boa-59.png","Netflix-fountain-41.png","Netflix-fur_coat-21.png","Netflix-fur_coat-31.png","Netflix-gasmask-95.png","Netflix-gasmask-98.png","Netflix-golden_retriever-94.png","Netflix-hair_slide-32.png","Netflix-hair_spray-37.png","Netflix-hen-91.png","Netflix-hippopotamus-13.png","Netflix-hippopotamus-25.png","Netflix-hook-15.png","Netflix-hornbill-25.png","Netflix-hornbill-95.png","Netflix-ice_bear-90.png","Netflix-jaguar-90.png","Netflix-jersey-10.png","Netflix-jersey-11.png","Netflix-jersey-12.png","Netflix-jersey-13.png","Netflix-jersey-21.png","Netflix-jersey-28.png","Netflix-jersey-30.png","Netflix-jersey-31.png","Netflix-jersey-32.png","Netflix-jersey-48.png","Netflix-jersey-70.png","Netflix-jersey-73.png","Netflix-joystick-66.png","Netflix-kimono-16.png","Netflix-king_penguin-93.png","Netflix-lab_coat-29.png","Netflix-lab_coat-36.png","Netflix-loggerhead-81.png","Netflix-loudspeaker-83.png","Netflix-macaque-49.png","Netflix-magnetic_compass-54.png","Netflix-maillot-13.png","Netflix-maillot-14.png","Netflix-maillot-23.png","Netflix-maillot-37.png","Netflix-mask-11.png","Netflix-mask-12.png","Netflix-mask-13.png","Netflix-mask-14.png","Netflix-mask-21.png","Netflix-mask-24.png","Netflix-mask-25.png","Netflix-mask-26.png","Netflix-mask-27.png","Netflix-mask-31.png","Netflix-mask-41.png","Netflix-mask-44.png","Netflix-mask-48.png","Netflix-mask-55.png","Netflix-mask-56.png","Netflix-mask-65.png","Netflix-mask-77.png","Netflix-mask-85.png","Netflix-mask-99.png","Netflix-matchstick-45.png","Netflix-military_uniform-54.png","Netflix-mouse-24.png","Netflix-mushroom-51.png","Netflix-neck_brace-84.png","Netflix-nipple-36.png","Netflix-oboe-10.png","Netflix-orangutan-77.png","Netflix-pajama-16.png","Netflix-palace-23.png","Netflix-Pembroke-97.png","Netflix-pencil_box-40.png","Netflix-pencil_sharpener-34.png","Netflix-perfume-24.png","Netflix-pick-39.png","Netflix-pick-73.png","Netflix-pickelhaube-11.png","Netflix-ping-pong_ball-11.png","Netflix-ping-pong_ball-47.png","Netflix-ping-pong_ball-53.png","Netflix-pinwheel-16.png","Netflix-pinwheel-28.png","Netflix-pole-25.png","Netflix-poncho-36.png","Netflix-pool_table-19.png","Netflix-pool_table-48.png","Netflix-pool_table-58.png","Netflix-pool_table-62.png","Netflix-pool_table-68.png","Netflix-pool_table-80.png","Netflix-pool_table-92.png","Netflix-punching_bag-61.png","Netflix-racket-12.png","Netflix-rapeseed-26.png","Netflix-red_fox-80.png","Netflix-red_wine-49.png","Netflix-ski_mask-11.png","Netflix-ski_mask-41.png","Netflix-soap_dispenser-14.png","Netflix-soap_dispenser-20.png","Netflix-soap_dispenser-27.png","Netflix-soap_dispenser-62.png","Netflix-sombrero-74.png","Netflix-spotlight-39.png","Netflix-stage-43.png","Netflix-stethoscope-11.png","Netflix-stethoscope-12.png","Netflix-street_sign-69.png","Netflix-suit-18.png","Netflix-suit-22.png","Netflix-suit-25.png","Netflix-suit-31.png","Netflix-suit-36.png","Netflix-suit-40.png","Netflix-suit-44.png","Netflix-suit-74.png","Netflix-suit-76.png","Netflix-suit-79.png","Netflix-sulphur_butterfly-33.png","Netflix-sunglass-51.png","Netflix-sweatshirt-11.png","Netflix-sweatshirt-20.png","Netflix-sweatshirt-23.png","Netflix-sweatshirt-35.png","Netflix-sweatshirt-54.png","Netflix-table_lamp-17.png","Netflix-table_lamp-39.png","Netflix-teddy-10.png","Netflix-teddy-11.png","Netflix-teddy-15.png","Netflix-teddy-21.png","Netflix-teddy-27.png","Netflix-teddy-98.png","Netflix-tennis_ball-13.png","Netflix-tiger-72.png","Netflix-tiger_shark-70.png","Netflix-torch-23.png","Netflix-totem_pole-65.png","Netflix-toyshop-11.png","Netflix-tree_frog-97.png","Netflix-trench_coat-83.png","Netflix-triceratops-63.png","Netflix-tub-32.png","Netflix-umbrella-44.png","Netflix-umbrella-83.png","Netflix-violin-17.png","Netflix-violin-67.png","Netflix-water_bottle-18.png","Netflix-water_bottle-68.png","Netflix-Weimaraner-41.png","Netflix-whistle-14.png","Netflix-wig-11.png","Netflix-wig-14.png","Netflix-wig-15.png","Netflix-wig-21.png","Netflix-wig-29.png","Netflix-wig-30.png","Netflix-wig-35.png","Netflix-wig-39.png","Netflix-wig-43.png","Netflix-wig-45.png","Netflix-wig-46.png","Netflix-wig-47.png","Netflix-wig-48.png","Netflix-wig-71.png","Netflix-wig-92.png","Netflix-Windsor_tie-11.png"],VL=JSON.parse('["100001-the-rising-of-the-shield-hero-naofumi.png","100002-the-rising-of-the-shield-hero-raphtalia.png","100003-the-rising-of-the-shield-hero-filo.png","100004-the-rising-of-the-shield-hero-melty.png","100005-the-rising-of-the-shield-hero-rishia.png","100006-spy-x-family-loid.png","100007-spy-x-family-yor.png","100008-spy-x-family-anya-1.png","100009-spy-x-family-anya-2.png","100010-spy-x-family-anya-3.png","1001-the-worlds-finest-assassin-lugh.png","1002-the-worlds-finest-assassin-dia.png","1003-the-worlds-finest-assassin-tart.png","1004-the-worlds-finest-assassin-maha.png","1005-the-worlds-finest-assassin-assassin.png","1011-fena-pirate-princess-fena.png","1012-fena-pirate-princess-yukimaru.png","1013-fena-pirate-princess-shitan.png","1014-fena-pirate-princess-karin.png","1015-fena-pirate-princess-twins.png","1016-fena-pirate-princess-makaba.png","1017-fena-pirate-princess-tsubaki.png","1018-fena-pirate-princess-brule.png","1019-fena-pirate-princess-fena-young.png","1020-fena-pirate-princess-yukimaru-young.png","1021-to-your-eternity-fushi.png","1022-to-your-eternity-joann.png","1023-to-your-eternity-march.png","1024-to-your-eternity-parona.png","1025-to-your-eternity-thebeholder.png","1026-to-your-eternity-gugu.png","1027-to-your-eternity-tonari.png","1028-to-your-eternity-theboy.png","1029-to-your-eternity-fushi.png","1030-to-your-eternity-march.png","1036-tokyo-revengers-takemichi.jpg","1037-tokyo-revengers-mikey.jpg","1038-tokyo-revengers-draken.jpg","1039-tokyo-revengers-mitsuya.jpg","1040-tokyo-revengers-baji.jpg","1041-jujutsu-kaisen-yuji-itadori.png","1042-jujutsu-kaisen-megumi-fushigoro.png","1043-jujutsu-kaisen-nobara-kugisaki.png","1044-jujutsu-kaisen-satoru-gojo.png","1045-jujutsu-kaisen-ryomen-sukuna.png","1046-dr-stone-senku.png","1047-dr-stone-suika.png","1048-dr-stone-kohaku.png","1049-dr-stone-chrome.png","1050-dr-stone-gen.png","1051-so-im-a-spider-so-what-kumoko.png","1052-so-im-a-spider-so-what-shun.png","1053-so-im-a-spider-so-what-katia.png","1054-so-im-a-spider-so-what-sue.png","1055-so-im-a-spider-so-what-fei.png","1056-black-clover-asta.png","1057-black-clover-yuno.png","1058-black-clover-noelle.png","1059-black-clover-yami.png","1060-black-clover-nero.png","11-tower-of-god-bam.png","12-tower-of-god-khun.png","13-tower-of-god-rak.jpg","14-tower-of-god-yuri-jahad.jpg","15-tower-of-god-endorsi-jahad.png","16-the-god-of-high-school-jin-mori.png","17-the-god-of-high-school-han-daewi.png","18-the-god-of-high-school-yoo-mira.png","19-the-god-of-high-school-park-mujin.png","20-the-god-of-high-school-park-ilpyo.png","21-bananya-bananya.png","22-bananya-droopy-eared.png","23-bananya-pirate.png","24-bananya-night-rainbow.png","25-bananya-emo.png","26-inspectre-kotoko-iwanaga.jpg","27-inspectre-kuro-sakuragawa.jpg","28-inspectre-saki-yumihara.jpg","29-inspectre-steel-lady-nanase.jpg","2bluenagi_nagi_avatar.png","30-inspectre-komainu.jpg","31-somali-and-the-forest-spirit-golem.jpg","32-somali-and-the-forest-spirit-somali.jpg","33-somali-and-the-forest-spirit-shizuno.jpg","34-somali-and-the-forest-spirit-uzoi.jpg","35-somali-and-the-forest-spirit-kikila.jpg","36-that-time-i-got-reincarnated-as-a-slime-rimuru-human.png","37-that-time-i-got-reincarnated-as-a-slime-shuna.png","38-that-time-i-got-reincarnated-as-a-slime-shion.png","39-that-time-i-got-reincarnated-as-a-slime-rimuru-slime.png","40-that-time-i-got-reincarnated-as-a-slime-hinata.jpg","41-zombieland-saga-revenge-sakura-minamoto.jpg","42-zombieland-saga-revenge-saki-nikaido.jpg","43-zombieland-saga-revenge-ai-mizuno.jpg","44-zombieland-saga-revenge-junko-konno.jpg","45-zombieland-saga-revenge-yugiri.jpg","46-zombieland-saga-revenge-lily-hoshikawa.jpg","47-zombieland-saga-revenge-tae-yamada.jpg","afdal.png","aot_fc_annie-avatar.png","aot_fc_armin-avatar.png","aot_fc_conny-avatar.png","aot_fc_eren-avatar.png","aot_fc_hange-avatar.png","aot_fc_jean-avatar.png","aot_fc_levi-avatar.png","aot_fc_mikasa-avatar.png","aot_fc_reiner-avatar.png","aot_fc_sasha-avatar.png","apothecary_gaoshun.png","apothecary_gyokuyou.png","apothecary_jinshi-1.png","apothecary_jinshi-2.png","apothecary_lihaku.png","apothecary_maomao-1.png","apothecary_maomao-2.png","apothecary_xiaolan.png","ash.png","avatars-big_mom.png","avatars-brook.png","avatars-chopper.png","avatars-franky.png","avatars-jinbei.png","avatars-kaido.png","avatars-kid.png","avatars-law.png","avatars-luffy.png","avatars-nami.png","avatars-perona.png","avatars-robin.png","avatars-sanji.png","avatars-shanks.png","avatars-usopp.png","avatars-yamato.png","avatars-zoro.png","bachira_avatar.png","bb-ciel-avatar.png","bb-edgar-avatar.png","bb-herman-avatar.png","bb-lawrence-avatar.png","bb_gregory-avatar.png","bb_sebastian-avatar.png","bluelock_bachira_avatar.png","bluelock_bachira_teaser_avatar.png","bluelock_barou_avatar.png","bluelock_chigiri_avatar.png","bluelock_ego_avatar.png","bluelock_hiori_teaser_avatar.png","bluelock_isagi_avatar.png","bluelock_isagi_kv1_avatar.png","bluelock_isagi_teaser_avatar.png","bluelock_karasu_teaser_avatar.png","bluelock_kunigami_avatar.png","bluelock_nagi_avatar.png","bluelock_nagi_teaser_avatar.png","bluelock_nanase_teaser_avatar.png","bluelock_oliver_kv1_avatar.png","bluelock_otoya_teaser_avatar.png","bluelock_reo_avatar.png","bluelock_rin_avatar.png","bluelock_rin_kv1_avatar.png","bluelock_rin_teaser_avatar.png","bluelock_sae_kv1_avatar.png","bluelock_sae_teaser_avatar.png","bluelock_shidou_teaser_avatar.png","bluelock_yukimiya_teaser_avatar.png","bluelock_zantetsu_avatar.png","bluenagi_chigiri_avatar.png","bluenagi_isagi_avatar.png","bluenagi_kunigami_avatar.png","bluenagi_nagi_school_avatar.png","bluenagi_reo_avatar.png","bluenagi_reo_school_avatar.png","bluenagi_rin_avatar.png","bocchi-avatar.jpg","bocchi-iita-kv-avatar.jpg","bocchi-kita-avatar.jpg","bocchi-kv-avatar.jpg","bocchi-nijika-kv-avatar.jpg","bocchi-ryo-avatar.jpg","bocchi-ryo-kv-avatar.jpg","bochhi-nijika-avatar.jpg","chainsawman-aki.jpg","chainsawman-chainsawman.jpg","chainsawman-denji.jpg","chainsawman-himeno.jpg","chainsawman-kishibe.jpg","chainsawman-kobeni.jpg","chainsawman-makima.jpg","chainsawman-pochita.jpg","chainsawman-power.jpg","chris-1.png","chris-2.png","classic-hime-avatar-1.png","classic-hime-avatar-2.png","classic-hime-avatar-3.png","classic-sudachi-avatar-1.png","classic-sudachi-avatar-2.png","classic-sudachi-avatar-3.png","classic-yuzu-avatar-1.png","classic-yuzu-avatar-2.png","classic-yuzu-avatar-3.png","crbrand_avatars_logo_marks_black_orange.jpg","crbrand_avatars_logo_marks_black_taupe.jpg","crbrand_avatars_logo_marks_black_white.jpg","crbrand_avatars_logo_marks_mangaeye_taupe.jpg","crbrand_avatars_logo_marks_mangagirl_taupe.jpg","crbrand_avatars_logo_marks_manga_eye_orange.jpg","crbrand_avatars_logo_marks_manga_skull_orange.jpg","crbrand_avatars_logo_marks_manga_skull_taupe.jpg","crbrand_avatars_logo_marks_mech_orange.jpg","crbrand_avatars_logo_marks_mech_orange2.jpg","crbrand_avatars_logo_marks_mech_taupe.jpg","crbrand_avatars_logo_marks_mech_taupe2.jpg","crbrand_avatars_logo_marks_orange_black.jpg","crbrand_avatars_logo_marks_orange_expressive.jpg","crbrand_avatars_logo_marks_orange_stars.jpg","crbrand_avatars_logo_marks_orange_taupe.jpg","crbrand_avatars_logo_marks_orange_taupe_stars.jpg","crbrand_avatars_logo_marks_orange_white.jpg","crbrand_avatars_logo_marks_taupe_expressive.jpg","crbrand_avatars_logo_marks_the_rings.jpg","dbdiama_avatarbackground2025_avatar_10.jpg","dbdiama_avatarbackground2025_avatar_3.jpg","dbdiama_avatarbackground2025_avatar_4.jpg","dbdiama_avatarbackground2025_avatar_5.jpg","dbdiama_avatarbackground2025_avatar_6.jpg","dbdiama_avatarbackground2025_avatar_7.jpg","dbdiama_avatarbackground2025_avatar_8.jpg","dbdiama_avatarbackground2025_avatar_9.jpg","dotm_avatar_02.png","dr_stone_s4_avatar_2.jpg","dr_stone_s4_avatar_3.jpg","dr_stone_s4_avatar_4.jpg","eden.png","egghead-brook.png","egghead-chopper.png","egghead-franky.png","egghead-jimbei.png","egghead-luffy.png","egghead-nami.png","egghead-robin.png","egghead-sanji.png","egghead-usopp.png","egghead-zoro.png","finn-1.png","finn-2.png","freiren-avatar-1.png","freiren-avatar-2.png","freiren-avatar-3.png","frieren_eisen-avatar-1.png","frieren_eisen-avatar-2.png","frieren_fern-avatar-1.png","frieren_fern-avatar-2.png","frieren_heiter-avatar-1.png","frieren_heiter-avatar-2.png","frieren_himmel-avatar-1.png","frieren_himmel-avatar-2.png","frieren_stark-avatar-1.png","frieren_stark-avatar-2.png","gear5avatar1.png","gear5avatar2.png","gear5avatar3.png","gear5avatar4.png","gear5avatar5.png","gear5avatar6.png","gear5avatar7.png","gear5avatar8.png","gear5avatar9.png","gene-1.png","gene-2.png","giallon-1.png","giallon-2.png","im_in_love_clarie-kv1.png","im_in_love_clarie-kv2.png","im_in_love_clarie.png","im_in_love_lene.png","im_in_love_manaria.png","im_in_love_misha.png","im_in_love_rae-kv1.png","im_in_love_rae-kv2.png","im_in_love_rae.png","inbento_avatar_1.png","inbento_avatar_3.png","inbento_avatar_4.png","inbento_avatar_5.png","jill.png","leo-1.png","leo-2.png","momoka-1.png","momoka-2.png","momoka-3.png","momoka-4.png","momoka-5.png","mushokutensei_ariel.jpg","mushokutensei_cliff.jpg","mushokutensei_elinalise.jpg","mushokutensei_eris.jpg","mushokutensei_ghislaine.jpg","mushokutensei_juli.jpg","mushokutensei_linia.jpg","mushokutensei_luke.jpg","mushokutensei_pursena.jpg","mushokutensei_rudeus-school-uniform.jpg","mushokutensei_rudeus.jpg","mushokutensei_ruijerd.jpg","mushokutensei_sara.jpg","mushokutensei_soldat.jpg","mushokutensei_suzanne.jpg","mushokutensei_sylphie-fitz.jpg","mushokutensei_sylphie.jpg","mushokutensei_zanoba.jpg","my-dress-up-gojo-1-avatar.jpg","my-dress-up-gojo-2-avatar.jpg","my-dress-up-marin-1-avatar.jpg","my-dress-up-marin-2-avatar.jpg","my-dress-up-marin-cosplay-avatar.jpg","my-dress-up-marin-normal-avatar.jpg","my-dress-up-sajuna-1-avatar.jpg","my-dress-up-sajuna-2-avatar.jpg","my-dress-up-shinju-1-avatar.jpg","my-dress-up-shinju-2-avatar.jpg","naomi-1.png","naomi-2.png","nina-1.png","nina-2.png","nina-3.png","nina-4.png","nina-5.png","noid.png","one-piece-chopper-1.png","one-piece-chopper-2.png","one-piece-chopper-3.png","one-piece-franky-1.png","one-piece-franky-2.png","one-piece-franky-3.png","one-piece-jimbei-1.png","one-piece-jimbei-2.png","one-piece-jimbei-3.png","one-piece-jimbei-4.png","one-piece-luffy-1.png","one-piece-luffy-2.png","one-piece-luffy-3.png","one-piece-luffy-4.png","one-piece-luffy-5.png","one-piece-nico-robin-1.png","one-piece-nico-robin-2.png","one-piece-nico-robin-3.png","one-piece-roronoa-zoro-1.png","one-piece-roronoa-zoro-2.png","one-piece-sanji-1.png","one-piece-sanji-2.png","one-piece-sanji-3.png","one-piece-usopp-1.png","one-piece-usopp-2.png","rcg1_avatar_02.png","rcg1_avatar_04.png","rcg2_avatar_01.png","rcg2_avatar_03.png","rcg2_avatar_04.png","rent-a-gf-chizuru-s1-date-kv.jpg","rent-a-gf-chizuru-s2-date-kv.jpg","rent-a-gf-chizuru-s3-date-kv.jpg","rent-a-gf-mami-s1-date-kv.jpg","rent-a-gf-mami-s2-date-kv_1.jpg","rent-a-gf-mami-s2-date-kv_2.jpg","rent-a-gf-mami-s3-date-kv_1.jpg","rent-a-gf-mami-s3-date-kv_2.jpg","rent-a-gf-ruka-s1-date-kv.jpg","rent-a-gf-ruka-s2-date-kv.jpg","rent-a-gf-ruka-s3-date-kv.jpg","rent-a-gf-sumi-s1-date-kv.jpg","rent-a-gf-yaemori-s3-date-kv.jpg","rent-a-gf-yaemori-s3-main-kv.jpg","rent-a-gf-yaemori-s3-teaser-kv.jpg","rezero_s3_avatar_01.jpg","rezero_s3_avatar_02.jpg","rezero_s3_avatar_04.jpg","rezero_s3_avatar_05.jpg","rezero_s3_avatar_06.jpg","rezero_s3_avatar_07.jpg","rezero_s3_avatar_08.jpg","rezero_s3_avatar_09.jpg","rezero_s3_avatar_10.jpg","rezero_s3_avatar_11.jpg","rezero_s3_avatar_12.jpg","rezero_s3_avatar_13.jpg","rezero_s3_avatar_14.jpg","rezero_s3_avatar_15.jpg","rezero_s3_avatar_16.jpg","rezero_s3_avatar_17.jpg","rezero_s3_avatar_18.jpg","rezero_s3_avatar_19.jpg","rezero_s3_avatar_20.jpg","rezero_s3_avatar_21.jpg","rezero_s3_avatar_22.jpg","rezero_s3_avatar_23.jpg","rouge-1.png","rouge-2.png","rouge-3.png","rouge-4.png","rupa-1.png","rupa-2.png","rupa-3.png","rupa-4.png","rupa-5.png","rwby_avatar_01.png","rwby_avatar_03.png","rwby_avatar_04.png","sarah.png","shangrilafrontier_s2_avatar_1.jpg","shangrilafrontier_s2_avatar_10.jpg","shangrilafrontier_s2_avatar_11.jpg","shangrilafrontier_s2_avatar_12.jpg","shangrilafrontier_s2_avatar_13.jpg","shangrilafrontier_s2_avatar_14.jpg","shangrilafrontier_s2_avatar_15.jpg","shangrilafrontier_s2_avatar_2.jpg","shangrilafrontier_s2_avatar_3.jpg","shangrilafrontier_s2_avatar_4.jpg","shangrilafrontier_s2_avatar_5.jpg","shangrilafrontier_s2_avatar_6.jpg","shangrilafrontier_s2_avatar_7.jpg","shangrilafrontier_s2_avatar_8.jpg","shangrilafrontier_s2_avatar_9.jpg","sololeveling_s2_avatar_1_v2_choi_avatar.png","sololeveling_s2_avatar_2_v2_jinwoo_avatar.png","sololeveling_s2_avatar_3_v2_igris_avatar.png","sololeveling_s2_avatar_4_v2_baek_avatar.png","sololeveling_s2_avatar_5_v2_cha_avatar.png","solo_baekyoonho.png","solo_chahaein.png","solo_choijongin.png","solo_gogunhee.png","solo_sungjinwoo.png","solo_teaser_visual.png","solo_woojinchul.png","solo_yoojinho.png","spidersaurs_avatar_02.png","sss_avatar_01.png","subaru-1.png","subaru-2.png","subaru-3.png","subaru-4.png","subaru-5.png","tog_bam_avatar_1.png","tog_bam_avatar_2.png","tog_bam_avatar_3.png","tog_endorsi_avatar_1.png","tog_endorsi_avatar_2.png","tog_hayuri_avatar_1.png","tog_hwaryun_avatar_1.png","tog_ja_avatar_1.png","tog_ja_avatar_2.png","tog_jihwa_avatar_1.png","tog_jihwa_avatar_2.png","tog_khunaa_avatar_1.png","tog_khunaa_avatar_2.png","tog_khunran_avatar_1.png","tog_rak_avatar_1.png","tog_rak_avatar_2.png","tomo-1.png","tomo-2.png","tomo-3.png","tomo-4.png","tomo-5.png","vijay-1.png","vijay-2.png","wendy-1.png","wendy-2.png"]'),$L=["scale(1).png","scale(10).png","scale(100).png","scale(101).png","scale(102).png","scale(103).png","scale(104).png","scale(105).png","scale(106).png","scale(107).png","scale(108).png","scale(11).png","scale(110).png","scale(111).png","scale(112).png","scale(113).png","scale(114).png","scale(115).png","scale(116).png","scale(117).png","scale(118).png","scale(119).png","scale(12).png","scale(120).png","scale(121).png","scale(122).png","scale(123).png","scale(124).png","scale(125).png","scale(126).png","scale(127).png","scale(128).png","scale(129).png","scale(13).png","scale(130).png","scale(131).png","scale(132).png","scale(133).png","scale(134).png","scale(135).png","scale(136).png","scale(137).png","scale(138).png","scale(139).png","scale(14).png","scale(140).png","scale(141).png","scale(142).png","scale(143).png","scale(144).png","scale(145).png","scale(146).png","scale(147).png","scale(148).png","scale(149).png","scale(15).png","scale(150).png","scale(151).png","scale(152).png","scale(153).png","scale(154).png","scale(155).png","scale(156).png","scale(157).png","scale(158).png","scale(159).png","scale(16).png","scale(160).png","scale(161).png","scale(162).png","scale(163).png","scale(164).png","scale(165).png","scale(166).png","scale(167).png","scale(168).png","scale(169).png","scale(17).png","scale(170).png","scale(171).png","scale(172).png","scale(173).png","scale(174).png","scale(175).png","scale(176).png","scale(177).png","scale(178).png","scale(179).png","scale(18).png","scale(180).png","scale(181).png","scale(182).png","scale(183).png","scale(184).png","scale(185).png","scale(186).png","scale(187).png","scale(189).png","scale(19).png","scale(190).png","scale(191).png","scale(192).png","scale(193).png","scale(194).png","scale(195).png","scale(196).png","scale(197).png","scale(198).png","scale(199).png","scale(2).png","scale(20).png","scale(200).png","scale(201).png","scale(202).png","scale(203).png","scale(204).png","scale(205).png","scale(206).png","scale(207).png","scale(208).png","scale(209).png","scale(21).png","scale(210).png","scale(211).png","scale(212).png","scale(22).png","scale(23).png","scale(24).png","scale(25).png","scale(26).png","scale(27).png","scale(28).png","scale(29).png","scale(3).png","scale(30).png","scale(31).png","scale(32).png","scale(33).png","scale(34).png","scale(35).png","scale(36).png","scale(37).png","scale(38).png","scale(39).png","scale(4).png","scale(40).png","scale(41).png","scale(42).png","scale(43).png","scale(44).png","scale(45).png","scale(46).png","scale(47).png","scale(48).png","scale(49).png","scale(5).png","scale(50).png","scale(51).png","scale(52).png","scale(53).png","scale(54).png","scale(55).png","scale(56).png","scale(57).png","scale(58).png","scale(59).png","scale(6).png","scale(60).png","scale(61).png","scale(62).png","scale(63).png","scale(64).png","scale(65).png","scale(66).png","scale(67).png","scale(68).png","scale(69).png","scale(7).png","scale(70).png","scale(71).png","scale(72).png","scale(73).png","scale(74).png","scale(75).png","scale(76).png","scale(77).png","scale(78).png","scale(79).png","scale(8).png","scale(80).png","scale(81).png","scale(82).png","scale(83).png","scale(84).png","scale(85).png","scale(86).png","scale(87).png","scale(88).png","scale(89).png","scale(9).png","scale(90).png","scale(91).png","scale(92).png","scale(93).png","scale(94).png","scale(95).png","scale(96).png","scale(97).png","scale(98).png","scale(99).png"],Oc={Netflix:BL,Crunchyroll:VL,DisneyPlus:$L},Cu=({isOpen:i,onClose:e,onSave:t,userId:s})=>{const[n,r]=w.useState(Object.keys(Oc)[0]),[l,c]=w.useState(null),[h,u]=w.useState(!1);if(w.useEffect(()=>{i&&(r(Object.keys(Oc)[0]),c(null))},[i]),!i)return null;const f=Object.keys(Oc),p=Oc[n]||[],v=async()=>{if(l){u(!0);try{const S=await(await fetch(l)).blob(),T=`avatar.${l.split(".").pop().split("?")[0]||"png"}`,A=new File([S],T,{type:S.type});await t(A)}catch(x){console.error("Failed to fetch avatar blob",x)}finally{u(!1)}}};return g.jsx("div",{className:"apm-overlay",onClick:e,children:g.jsxs("div",{className:"apm-modal",onClick:x=>x.stopPropagation(),children:[g.jsxs("div",{className:"apm-header",children:[g.jsx("h2",{children:"Choose Avatar"}),g.jsx("button",{className:"apm-close",onClick:e,children:""})]}),g.jsxs("div",{className:"apm-body",children:[g.jsx("div",{className:"apm-sidebar",children:f.map(x=>g.jsx("button",{className:`apm-cat-btn ${n===x?"active":""}`,onClick:()=>r(x),children:x},x))}),g.jsx("div",{className:"apm-content",children:g.jsx("div",{className:"apm-grid",children:p.map(x=>{const E=`/legitflix/client/avatars/${n}/${x}`;return g.jsx("div",{className:`apm-item ${l===E?"selected":""}`,onClick:()=>c(E),children:g.jsx("div",{className:"apm-img-wrapper",children:g.jsx("img",{src:E,alt:x,loading:"lazy"})})},x)})})})]}),g.jsxs("div",{className:"apm-footer",children:[g.jsx("button",{className:"apm-btn-cancel",onClick:e,disabled:h,children:"Cancel"}),g.jsx("button",{className:"apm-btn-save",onClick:v,disabled:!l||h,children:h?"Saving...":"Set Avatar"})]})]})})},ny=[{name:"Orange",value:"#ff7e00"},{name:"Blue",value:"#00aaff"},{name:"Pink",value:"#ff00aa"},{name:"Green",value:"#00ff7e"},{name:"Red",value:"#ff3333"},{name:"Purple",value:"#aa00ff"}],bS=({isOpen:i,onClose:e,userId:t})=>{const{config:s,updateConfig:n}=Hi(),[r,l]=w.useState("appearance"),[c,h]=w.useState(""),[u,f]=w.useState(!1),[p,v]=w.useState(!1),[x,S]=w.useState("app"),[E,T]=w.useState(!1),[A,I]=w.useState(s.accentColor||"#ff7e00"),[_,C]=w.useState(s.logoUrl||""),[k,U]=w.useState(s.showNavbarCategories!==!1),[O,F]=w.useState(s.enableJellyseerr!==!1),[j,M]=w.useState(s.jellyseerrUrl||"https://request.legitflix.eu"),[H,K]=w.useState(s.showLibraryTitles!==!1),[te,ae]=w.useState(s.showNavbarRequests!==!1),[me,D]=w.useState(""),[G,Y]=w.useState(s.contentTypeFilters||{Movie:!0,Series:!0,MusicAlbum:!1,Audio:!1,MusicVideo:!1}),[oe,pe]=w.useState(s.contentSortMode||"latest"),[P,V]=w.useState(s.playerSeekForward||30),[se,he]=w.useState(s.playerSeekBackward||10),[ye,Ae]=w.useState(s.defaultAudioLanguage||"auto"),[Pe,He]=w.useState(s.defaultSubtitleLanguage||"auto"),[Be,ht]=w.useState(s.autoSkipIntro||!1),[dt,Mt]=w.useState(s.autoSkipOutro||!1);w.useEffect(()=>{i&&(I(s.accentColor||"#ff7e00"),C(s.logoUrl||""),U(s.showNavbarCategories!==!1),F(s.enableJellyseerr!==!1),M(s.jellyseerrUrl||"https://request.legitflix.eu"),K(s.showLibraryTitles!==!1),ae(s.showNavbarRequests!==!1),Y(s.contentTypeFilters||{Movie:!0,Series:!0,MusicAlbum:!1,Audio:!1,MusicVideo:!1}),pe(s.contentSortMode||"latest"),V(s.playerSeekForward||30),he(s.playerSeekBackward||10),Ae(s.defaultAudioLanguage||"auto"),He(s.defaultSubtitleLanguage||"auto"),ht(s.autoSkipIntro||!1),Mt(s.autoSkipOutro||!1),h(""),ny.some(ge=>ge.value===s.accentColor)||D(s.accentColor))},[i,s]),w.useEffect(()=>(i?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[i]);const bt=ge=>{I(ge),D("")},Tt=ge=>{const _e=ge.target.value;D(_e),/^#[0-9A-F]{6}$/i.test(_e)&&I(_e)},os=()=>{const ge=Object.entries(G).filter(([,at])=>at).map(([at])=>at),_e=ge.length>0?ge.join(","):"Movie,Series",De=ge.length>0?ge:["Movie","Series"];n({accentColor:A,logoUrl:_,logoType:_?"image":"text",showNavbarCategories:k,enableJellyseerr:O,jellyseerrUrl:j,showLibraryTitles:H,showNavbarRequests:te,contentTypeFilters:G,heroMediaTypes:_e,promoMediaTypes:De,contentSortMode:oe,playerSeekForward:P,playerSeekBackward:se,defaultAudioLanguage:ye,defaultSubtitleLanguage:Pe,autoSkipIntro:Be,autoSkipOutro:dt}),e()},Ve=()=>{I("#ff7e00"),C(""),D(""),U(!0),F(!0),M("https://request.legitflix.eu"),K(!0),ae(!0),Y({Movie:!0,Series:!0,MusicAlbum:!1,Audio:!1,MusicVideo:!1}),Y({Movie:!0,Series:!0,MusicAlbum:!1,Audio:!1,MusicVideo:!1}),pe("latest"),V(30),he(10),Ae("auto"),He("auto")},we=async ge=>{if(!(!ge||!t)){T(!0);try{(await fetch(`${ee.api.basePath}/Users/${t}/Images/Primary`,{method:"POST",headers:{"Content-Type":ge.type,"X-Emby-Authorization":ee.api.authHeader},body:ge})).ok&&v(!1)}catch(_e){console.error("Avatar upload failed",_e)}finally{T(!1)}}},Qe=[{id:"accentColor",tab:"appearance",label:"Accent Color",keywords:["color","theme","style","appearance"],render:()=>g.jsxs("div",{className:"setting-section",children:[g.jsx("h3",{children:"Accent Color"}),g.jsx("div",{className:"color-presets",children:ny.map(ge=>g.jsx("div",{className:`color-preset ${A===ge.value?"selected":""}`,style:{backgroundColor:ge.value},onClick:()=>bt(ge.value),title:ge.name,children:A===ge.value&&g.jsx("span",{className:"material-icons",children:"check"})},ge.value))}),g.jsxs("div",{className:"custom-color-input",children:[g.jsx("label",{children:"Custom Hex:"}),g.jsx("input",{type:"text",placeholder:"#RRGGBB",value:me,onChange:Tt,maxLength:7}),g.jsx("div",{className:"color-preview",style:{backgroundColor:A}})]})]},"accentColor")},{id:"logoUrl",tab:"appearance",label:"Custom Logo URL",keywords:["logo","image","branding","appearance"],render:()=>g.jsxs("div",{className:"setting-section",children:[g.jsx("h3",{children:"Custom Logo URL"}),g.jsx("p",{className:"setting-desc",children:"Enter a direct URL to an image to replace the top-left logo."}),g.jsx("input",{type:"text",className:"legit-input",placeholder:"https://example.com/logo.png",value:_,onChange:ge=>C(ge.target.value)})]},"logoUrl")},{id:"faviconUrl",tab:"appearance",label:"Custom Favicon URL",keywords:["favicon","icon","tab","browser","branding"],render:()=>g.jsxs("div",{className:"setting-section",children:[g.jsx("h3",{children:"Custom Favicon URL"}),g.jsx("p",{className:"setting-desc",children:"Enter a direct URL to an image to use as the browser tab icon."}),g.jsx("input",{type:"text",className:"legit-input",placeholder:"https://example.com/favicon.ico",value:s.faviconUrl||"",onChange:ge=>n({faviconUrl:ge.target.value})})]},"faviconUrl")},{id:"avatar",tab:"appearance",label:"Profile Avatar",keywords:["avatar","profile","image","picture","user"],render:()=>g.jsxs("div",{className:"setting-section",children:[g.jsx("h3",{children:"Profile Avatar"}),g.jsx("p",{className:"setting-desc",children:"Change your user profile picture."}),g.jsx("div",{className:"setting-row",children:g.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[g.jsx("img",{src:`${ee.api.basePath}/Users/${t}/Images/Primary?quality=90&t=${Date.now()}`,alt:"Current Avatar",style:{width:"50px",height:"50px",borderRadius:"50%",objectFit:"cover",border:"2px solid rgba(255,255,255,0.1)"},onError:ge=>{ge.target.style.display="none"}}),g.jsxs("button",{className:"lf-btn lf-btn--secondary",onClick:()=>v(!0),children:[g.jsx("span",{className:"material-icons",style:{fontSize:"18px",marginRight:"8px"},children:"face"}),"Change Avatar"]})]})})]},"avatar")},{id:"requestFeature",tab:"home",label:"Request Feature (Jellyseerr)",keywords:["request","jellyseerr","ombi","home","card"],render:()=>g.jsxs(g.Fragment,{children:[g.jsxs("div",{className:"setting-section",children:[g.jsxs("div",{className:"setting-row",children:[g.jsxs("div",{children:[g.jsx("h3",{className:"setting-title",children:"Request Feature"}),g.jsx("p",{className:"setting-desc",children:'Enable "Request" card on Home screen'})]}),g.jsxs("label",{className:"toggle-switch",children:[g.jsx("input",{type:"checkbox",checked:O,onChange:ge=>F(ge.target.checked)}),g.jsx("span",{className:"slider"})]})]}),g.jsxs("div",{className:"fade-in",style:{marginTop:"10px"},children:[g.jsx("p",{className:"setting-desc",children:"Request URL (Required for both Home Card and Navbar):"}),g.jsx("input",{type:"text",className:"legit-input",placeholder:"https://request.legitflix.eu",value:j,onChange:ge=>M(ge.target.value)})]})]},"requestFeature"),g.jsxs("div",{className:"setting-section",children:[g.jsx("h3",{children:"Card Appearance"}),g.jsx("p",{className:"setting-desc",children:"Customize the look of the Request card on the Home screen."}),g.jsx("div",{className:"setting-row",style:{marginBottom:"15px"},children:g.jsxs("div",{style:{flex:1},children:[g.jsx("label",{className:"setting-label",style:{display:"block",marginBottom:"5px",fontSize:"0.9rem"},children:"Card Title"}),g.jsx("input",{type:"text",className:"legit-input",placeholder:"Request Feature",value:s.jellyseerrText||"",onChange:ge=>n({jellyseerrText:ge.target.value})})]})}),g.jsx("div",{className:"setting-row",style:{flexDirection:"column",alignItems:"stretch",gap:"10px"},children:g.jsxs("div",{children:[g.jsx("label",{className:"setting-label",style:{display:"block",marginBottom:"5px",fontSize:"0.9rem"},children:"Card Background URL"}),g.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[g.jsx("div",{style:{width:"120px",height:"68px",borderRadius:"6px",backgroundColor:"#2a2a2a",backgroundImage:`url('${s.jellyseerrBackground||"https://raw.githubusercontent.com/gorillasuti/Legitflix-plugin/refs/heads/main/legitflix-client/public/jellyseerr.jpg"}')`,backgroundSize:"cover",backgroundPosition:"center",border:"1px solid rgba(255,255,255,0.1)",flexShrink:0}}),g.jsx("input",{type:"text",className:"legit-input",style:{marginTop:0},placeholder:"https://example.com/background.jpg",value:s.jellyseerrBackground||"",onChange:ge=>n({jellyseerrBackground:ge.target.value||null})})]})]})})]},"requestFeatureCustomization")]})},{id:"libraryTitles",tab:"home",label:"Show Library Titles",keywords:["library","names","titles","overlay","home"],render:()=>g.jsx("div",{className:"setting-section",children:g.jsxs("div",{className:"setting-row",children:[g.jsxs("div",{children:[g.jsx("h3",{className:"setting-title",children:"Show Library Titles"}),g.jsx("p",{className:"setting-desc",children:"Display text overlay on library cards"})]}),g.jsxs("label",{className:"toggle-switch",children:[g.jsx("input",{type:"checkbox",checked:H,onChange:ge=>K(ge.target.checked)}),g.jsx("span",{className:"slider"})]})]})},"libraryTitles")},{id:"contentFilters",tab:"home",label:"Content Filters",keywords:["content","media","type","movie","series","music","filter","carousel","promo","hero"],render:()=>{const ge=[{key:"Movie",label:"Movies",icon:"movie"},{key:"Series",label:"Series",icon:"tv"},{key:"MusicAlbum",label:"Music Albums",icon:"album"},{key:"Audio",label:"Audio",icon:"audiotrack"},{key:"MusicVideo",label:"Music Videos",icon:"music_video"}];return g.jsxs("div",{className:"setting-section",children:[g.jsx("h3",{children:"Content Filters"}),g.jsx("p",{className:"setting-desc",children:"Choose which media types appear in the Hero Carousel and Promo Banner."}),g.jsx("div",{className:"content-type-grid",children:ge.map(_e=>g.jsxs("label",{className:`content-type-chip ${G[_e.key]?"active":""}`,children:[g.jsx("input",{type:"checkbox",checked:!!G[_e.key],onChange:De=>Y(at=>({...at,[_e.key]:De.target.checked}))}),g.jsx("span",{className:"material-icons",children:_e.icon}),g.jsx("span",{children:_e.label})]},_e.key))})]},"contentFilters")}},{id:"displayOrder",tab:"home",label:"Display Order",keywords:["sort","order","random","latest","rated","carousel","promo","display"],render:()=>{const ge=[{key:"latest",label:"Latest",icon:"schedule",desc:"Newest additions first"},{key:"random",label:"Random",icon:"shuffle",desc:"Shuffled each visit"},{key:"topRated",label:"Top Rated",icon:"star",desc:"Highest community rating"}];return g.jsxs("div",{className:"setting-section",children:[g.jsx("h3",{children:"Display Order"}),g.jsx("p",{className:"setting-desc",children:"How content is sorted in the Hero Carousel and Promo Banner."}),g.jsx("div",{className:"content-type-grid",children:ge.map(_e=>g.jsxs("label",{className:`content-type-chip ${oe===_e.key?"active":""}`,title:_e.desc,children:[g.jsx("input",{type:"radio",name:"sortMode",checked:oe===_e.key,onChange:()=>pe(_e.key)}),g.jsx("span",{className:"material-icons",children:_e.icon}),g.jsx("span",{children:_e.label})]},_e.key))})]},"displayOrder")}},{id:"navbarCategories",tab:"navigation",label:"Show Categories in Navbar",keywords:["navigation","menu","navbar","categories","links"],render:()=>g.jsx("div",{className:"setting-section",children:g.jsxs("div",{className:"setting-row",children:[g.jsxs("div",{children:[g.jsx("h3",{className:"setting-title",children:"Show Categories in Navbar"}),g.jsx("p",{className:"setting-desc",children:"Display library links in the top navigation bar"})]}),g.jsxs("label",{className:"toggle-switch",children:[g.jsx("input",{type:"checkbox",checked:k,onChange:ge=>U(ge.target.checked)}),g.jsx("span",{className:"slider"})]})]})},"navbarCategories")},{id:"navbarRequests",tab:"navigation",label:"Show Requests in Navbar",keywords:["navigation","navbar","requests","jellyseerr"],render:()=>g.jsx("div",{className:"setting-section",children:g.jsxs("div",{className:"setting-row",children:[g.jsxs("div",{children:[g.jsx("h3",{className:"setting-title",children:"Show Requests in Navbar"}),g.jsx("p",{className:"setting-desc",children:'Display the "Requests" link next to categories in the navbar'})]}),g.jsxs("label",{className:"toggle-switch",children:[g.jsx("input",{type:"checkbox",checked:te,onChange:ge=>ae(ge.target.checked)}),g.jsx("span",{className:"slider"})]})]})},"navbarRequests")},{id:"playerSeek",tab:"player",label:"Seek Durations",keywords:["player","seek","skip","forward","backward","time"],render:()=>g.jsxs("div",{className:"setting-section",children:[g.jsx("div",{className:"setting-row",children:g.jsxs("div",{children:[g.jsx("h3",{className:"setting-title",children:"Seek Durations"}),g.jsx("p",{className:"setting-desc",children:"Customize how many seconds to skip forward or backward."})]})}),g.jsxs("div",{className:"setting-row",style:{alignItems:"flex-start",gap:"20px"},children:[g.jsxs("div",{style:{flex:1},children:[g.jsx("label",{className:"setting-label",children:"Seek Forward (Right Arrow)"}),g.jsxs("div",{className:"time-stepper",children:[g.jsx("button",{className:"stepper-btn",onClick:()=>V(ge=>Math.max(5,ge-5)),disabled:P<=5,children:g.jsx("span",{className:"material-icons",children:"remove"})}),g.jsxs("div",{className:"stepper-value",children:[g.jsx("span",{className:"stepper-number",children:P}),g.jsx("span",{className:"stepper-unit",children:"sec"})]}),g.jsx("button",{className:"stepper-btn",onClick:()=>V(ge=>Math.min(300,ge+5)),disabled:P>=300,children:g.jsx("span",{className:"material-icons",children:"add"})})]})]}),g.jsxs("div",{style:{flex:1},children:[g.jsx("label",{className:"setting-label",children:"Seek Backward (Left Arrow)"}),g.jsxs("div",{className:"time-stepper",children:[g.jsx("button",{className:"stepper-btn",onClick:()=>he(ge=>Math.max(5,ge-5)),disabled:se<=5,children:g.jsx("span",{className:"material-icons",children:"remove"})}),g.jsxs("div",{className:"stepper-value",children:[g.jsx("span",{className:"stepper-number",children:se}),g.jsx("span",{className:"stepper-unit",children:"sec"})]}),g.jsx("button",{className:"stepper-btn",onClick:()=>he(ge=>Math.min(300,ge+5)),disabled:se>=300,children:g.jsx("span",{className:"material-icons",children:"add"})})]})]})]})]},"playerSeek")},{id:"playerLanguages",tab:"player",label:"Default Languages",keywords:["player","audio","subtitle","language","default","dub"],render:()=>{const ge=[{code:"auto",label:"Auto (Server Default)"},{code:"eng",label:"English"},{code:"hun",label:"Hungarian (Magyar)"},{code:"ger",label:"German (Deutsch)"},{code:"jpn",label:"Japanese ()"},{code:"spa",label:"Spanish (Espaol)"},{code:"fre",label:"French (Franais)"},{code:"ita",label:"Italian (Italiano)"},{code:"por",label:"Portuguese (Portugus)"},{code:"rus",label:"Russian ()"},{code:"chi",label:"Chinese ()"},{code:"kor",label:"Korean ()"},{code:"ara",label:"Arabic ()"},{code:"hin",label:"Hindi ()"},{code:"pol",label:"Polish (Polski)"},{code:"dut",label:"Dutch (Nederlands)"},{code:"swe",label:"Swedish (Svenska)"},{code:"nor",label:"Norwegian (Norsk)"},{code:"dan",label:"Danish (Dansk)"},{code:"fin",label:"Finnish (Suomi)"},{code:"tur",label:"Turkish (Trke)"},{code:"tha",label:"Thai ()"},{code:"vie",label:"Vietnamese (Ting Vit)"},{code:"ukr",label:"Ukrainian ()"},{code:"cze",label:"Czech (etina)"},{code:"rum",label:"Romanian (Romn)"},{code:"gre",label:"Greek ()"},{code:"heb",label:"Hebrew ()"}],_e=[{code:"auto",label:"Auto (Server Default)"},{code:"none",label:"None (Disabled)"},...ge.filter(De=>De.code!=="auto")];return g.jsxs("div",{className:"setting-section",children:[g.jsx("div",{className:"setting-row",children:g.jsxs("div",{children:[g.jsx("h3",{className:"setting-title",children:"Default Languages"}),g.jsx("p",{className:"setting-desc",children:"Preferred audio and subtitle languages for new playback."})]})}),g.jsxs("div",{className:"setting-row",style:{alignItems:"flex-start",gap:"20px"},children:[g.jsxs("div",{style:{flex:1},children:[g.jsx("label",{className:"setting-label",children:"Default Audio Language"}),g.jsx("select",{className:"legit-input",value:ye,onChange:De=>Ae(De.target.value),children:ge.map(De=>g.jsx("option",{value:De.code,children:De.label},De.code))})]}),g.jsxs("div",{style:{flex:1},children:[g.jsx("label",{className:"setting-label",children:"Default Subtitle Language"}),g.jsx("select",{className:"legit-input",value:Pe,onChange:De=>He(De.target.value),children:_e.map(De=>g.jsx("option",{value:De.code,children:De.label},De.code))})]})]})]},"playerLanguages")}},{id:"playerAutoSkip",tab:"player",label:"Auto Skip",keywords:["player","skip","intro","outro","auto","chapter"],render:()=>g.jsxs("div",{className:"setting-section",children:[g.jsxs("div",{className:"setting-row",children:[g.jsxs("div",{children:[g.jsx("h3",{className:"setting-title",children:"Auto Skip Intro"}),g.jsx("p",{className:"setting-desc",children:"Automatically skip intro segments when detected by Jellyfin chapters."})]}),g.jsxs("label",{className:"toggle-switch",children:[g.jsx("input",{type:"checkbox",checked:Be,onChange:ge=>ht(ge.target.checked)}),g.jsx("span",{className:"slider"})]})]}),g.jsxs("div",{className:"setting-row",children:[g.jsxs("div",{children:[g.jsx("h3",{className:"setting-title",children:"Auto Skip Outro"}),g.jsx("p",{className:"setting-desc",children:"Automatically skip outro/credits segments when detected by Jellyfin chapters."})]}),g.jsxs("label",{className:"toggle-switch",children:[g.jsx("input",{type:"checkbox",checked:dt,onChange:ge=>Mt(ge.target.checked)}),g.jsx("span",{className:"slider"})]})]})]},"playerAutoSkip")}].filter(ge=>{if(!c)return ge.tab===r;const _e=c.toLowerCase();return ge.label.toLowerCase().includes(_e)||ge.keywords.some(De=>De.includes(_e))});return i?g.jsxs(g.Fragment,{children:[g.jsx("div",{className:"legit-settings-overlay",onClick:e,children:g.jsxs("div",{className:"legit-settings-modal expanded",onClick:ge=>ge.stopPropagation(),children:[g.jsxs("div",{className:"legit-settings-sidebar",children:[g.jsx("div",{className:"sidebar-header",children:g.jsx("h2",{children:"Settings"})}),g.jsxs("div",{className:"sidebar-tabs",children:[g.jsxs("button",{className:`sidebar-tab ${r==="appearance"&&!c?"active":""}`,onClick:()=>{l("appearance"),h("")},children:[g.jsx("span",{className:"material-icons",children:"palette"})," Appearance"]}),g.jsxs("button",{className:`sidebar-tab ${r==="home"&&!c?"active":""}`,onClick:()=>{l("home"),h("")},children:[g.jsx("span",{className:"material-icons",children:"home"})," Home Screen"]}),g.jsxs("button",{className:`sidebar-tab ${r==="navigation"&&!c?"active":""}`,onClick:()=>{l("navigation"),h("")},children:[g.jsx("span",{className:"material-icons",children:"menu"})," Navigation"]}),g.jsxs("button",{className:`sidebar-tab ${r==="player"&&!c?"active":""}`,onClick:()=>{l("player"),h("")},children:[g.jsx("span",{className:"material-icons",children:"play_circle"})," Player"]})]})]}),g.jsxs("div",{className:"legit-settings-content",children:[g.jsxs("div",{className:"content-header",children:[g.jsxs("div",{className:"search-container",children:[g.jsx("span",{className:"material-icons search-icon",children:"search"}),g.jsx("input",{type:"text",placeholder:"Search settings...",value:c,onChange:ge=>h(ge.target.value)}),c&&g.jsx("button",{className:"clear-search",onClick:()=>h(""),children:g.jsx("span",{className:"material-icons",children:"close"})})]}),g.jsx("button",{className:"close-btn-icon",onClick:e,children:""})]}),g.jsx("div",{className:"content-body",children:Qe.length>0?Qe.map(ge=>ge.render()):g.jsxs("div",{className:"no-results",children:[g.jsx("span",{className:"material-icons",children:"search_off"}),g.jsxs("p",{children:['No settings found for "',c,'"']})]})}),g.jsxs("div",{className:"content-footer",children:[g.jsx("button",{className:"btn-reset",onClick:Ve,children:"Reset Defaults"}),g.jsx("button",{className:"btn-save lf-btn--ring-hover",onClick:os,children:"Save Changes"})]})]})]})}),g.jsx(hm,{isOpen:u,onClose:()=>f(!1),onSave:ge=>{x==="app"?n({appBackground:ge}):x==="jellyseerr"&&n({jellyseerrBackground:ge}),f(!1)},userId:t}),g.jsx(Cu,{isOpen:p,onClose:()=>v(!1),onSave:we,userId:t})]}):null},GL=({isOpen:i,onClose:e})=>{const[t,s]=w.useState(""),[n,r]=w.useState(""),[l,c]=w.useState(""),h=async()=>{if(t.trim()){r("loading"),c("");try{const u=await fetch(`${ee.api.basePath}/QuickConnect/Authorize`,{method:"POST",headers:{"Content-Type":"application/json","X-Emby-Authorization":ee.api.authHeader},body:JSON.stringify({Code:t.trim()})});if(u.ok)r("success"),setTimeout(()=>{s(""),r(""),e()},1500);else{const f=await u.json().catch(()=>({}));r("error"),c(f.Message||"Invalid code. Please try again.")}}catch{r("error"),c("Connection failed. Please try again.")}}};return i?g.jsx("div",{className:"qc-overlay",onClick:e,children:g.jsxs("div",{className:"qc-modal",onClick:u=>u.stopPropagation(),children:[g.jsxs("div",{className:"qc-header",children:[g.jsx("span",{className:"material-icons qc-icon",children:"qr_code"}),g.jsx("h2",{children:"Quick Connect"}),g.jsx("button",{className:"qc-close",onClick:e,children:""})]}),g.jsx("p",{className:"qc-desc",children:"Enter the code displayed on your other device to link it to your account."}),g.jsx("input",{className:"qc-input",type:"text",placeholder:"Enter Quick Connect code",value:t,onChange:u=>s(u.target.value),onKeyDown:u=>{u.key==="Enter"&&h()},autoFocus:!0}),n==="error"&&g.jsx("p",{className:"qc-error",children:l}),n==="success"&&g.jsx("p",{className:"qc-success",children:"Connected successfully!"}),g.jsx("button",{className:"qc-submit",onClick:h,disabled:n==="loading"||!t.trim(),children:n==="loading"?"Connecting...":"Authorize"})]})}):null},HL=({isOpen:i,onClose:e,user:t})=>{const[s,n]=w.useState(!1),[r,l]=w.useState(""),[c,h]=w.useState(!1),[u,f]=w.useState(!1),p=w.useRef(null),v=t?t.ImageTags?.Banner?`${ee.api.basePath}/Users/${t.Id}/Images/Banner?tag=${t.ImageTags.Banner}&quality=90`:t.BackdropImageTags?.[0]?`${ee.api.basePath}/Users/${t.Id}/Images/Backdrop/0?tag=${t.BackdropImageTags[0]}&quality=90`:"":"",x=async A=>{if(!(!t||!A)){l("Updating banner..."),n(!0);try{const _=await(await fetch(A)).blob();await ee.uploadUserImage(t.Id,"Banner",_),l("Banner updated! Refresh to see changes.")}catch(I){console.error(I),l("Banner upload failed.")}finally{n(!1)}}};if(!i||!t)return null;const S=async A=>{if(A){n(!0),l("");try{await ee.uploadUserImage(t.Id,"Primary",A),l("Profile image updated! Refresh to see changes."),f(!1)}catch(I){console.error(I),l("Upload failed. Check your connection.")}finally{n(!1)}}},E=A=>{const I=A.target.files?.[0];S(I)},T=async()=>{n(!0),l("");try{await ee.deleteUserImage(t.Id,"Primary"),l("Profile image removed.")}catch(A){console.error(A),l("Failed to remove image.")}finally{n(!1)}};return g.jsxs(g.Fragment,{children:[g.jsx("div",{className:"pm-overlay",onClick:e,children:g.jsxs("div",{className:"pm-modal",onClick:A=>A.stopPropagation(),children:[g.jsx("button",{className:"pm-close-floating",onClick:e,children:g.jsx("span",{className:"material-icons",children:"close"})}),g.jsxs("div",{className:"pm-cover",children:[v?g.jsx("img",{src:v,alt:"Banner",className:"pm-cover-img"}):g.jsx("div",{style:{width:"100%",height:"100%",background:"#333",display:"flex",alignItems:"center",justifyContent:"center"},children:g.jsx("span",{className:"material-icons",style:{fontSize:"48px",opacity:.1},children:"wallpaper"})}),g.jsx("div",{className:"pm-cover-overlay",children:g.jsxs("button",{className:"pm-edit-cover-btn",onClick:()=>h(!0),disabled:s,children:[g.jsx("span",{className:"material-icons",children:"edit"}),"Change Cover"]})})]}),g.jsxs("div",{className:"pm-profile-header",children:[g.jsxs("div",{className:"pm-avatar-container",children:[g.jsx("img",{src:`${ee.api.basePath}/Users/${t.Id}/Images/Primary?quality=90&t=${Date.now()}`,alt:t.Name,className:"pm-avatar-img",onError:A=>{A.target.style.display="none"}}),g.jsx("div",{className:"pm-avatar-edit-overlay",onClick:()=>f(!0),children:g.jsx("span",{className:"material-icons",children:"photo_camera"})})]}),g.jsxs("div",{className:"pm-user-details",children:[g.jsx("h2",{children:t.Name}),g.jsxs("p",{children:[g.jsx("span",{className:"material-icons",style:{fontSize:"16px"},children:t?.Policy?.IsAdministrator?"shield":"person"}),t?.Policy?.IsAdministrator?"Administrator":"User"]})]})]}),g.jsx("div",{className:"pm-divider"}),g.jsxs("div",{className:"pm-actions",children:[g.jsxs("button",{className:"pm-action-row",onClick:()=>p.current?.click(),disabled:s,children:[g.jsx("span",{className:"material-icons",children:"upload"}),g.jsx("span",{children:"Upload Custom Avatar"})]}),g.jsxs("button",{className:"pm-action-row danger",onClick:T,disabled:s,children:[g.jsx("span",{className:"material-icons",children:"delete"}),g.jsx("span",{children:"Remove Avatar"})]})]}),r&&g.jsx("div",{className:"pm-status",children:r}),g.jsx("input",{ref:p,type:"file",accept:"image/*",style:{display:"none"},onChange:E})]})}),g.jsx(hm,{isOpen:c,onClose:()=>h(!1),onSave:A=>{x(A),h(!1)},userId:t?.Id}),g.jsx(Cu,{isOpen:u,onClose:()=>f(!1),onSave:S,userId:t?.Id})]})},va=({alwaysFilled:i=!1})=>{const{config:e}=Hi(),[t,s]=w.useState(null),[n,r]=w.useState([]),[l,c]=w.useState(!1),[h,u]=w.useState(!1),[f,p]=w.useState(!1),[v,x]=w.useState(!1),[S,E]=w.useState(!1),[T,A]=w.useState(!1),[I,_]=w.useState(!1),[C,k]=w.useState(!1),[U,O]=w.useState(!1),F=Ps(),j=Lx.useRef(null);w.useEffect(()=>{(async()=>{try{const te=await ee.getCurrentUser();if(s(te),te&&e.showNavbarCategories){const ae=await ee.getUserViews(te.Id);ae&&ae.Items&&r(ae.Items)}}catch(te){console.error("Navbar fetch error",te)}})()},[e.showNavbarCategories]),w.useEffect(()=>{const K=()=>{c(window.scrollY>50)};return window.addEventListener("scroll",K),()=>window.removeEventListener("scroll",K)},[]),w.useEffect(()=>{const K=te=>{te.target.closest(".nav-avatar-container")||p(!1)};return document.addEventListener("click",K),()=>document.removeEventListener("click",K)},[]),w.useEffect(()=>{(async()=>{try{if(!ee.api)return;const te=ee.api.accessToken,ae=ee.api.configuration?.basePath||ee.api.basePath;if(!te||!ae)return;const me=`MediaBrowser Client="${ee.jellyfin.clientInfo.name}", Device="${ee.jellyfin.deviceInfo.name}", DeviceId="${ee.jellyfin.deviceInfo.id}", Version="${ee.jellyfin.clientInfo.version}", Token="${te}"`,D=await fetch(`${ae}/Plugins`,{headers:{"X-Emby-Authorization":me}});if(D.ok){const Y=(await D.json()).some(oe=>oe.Name?.toLowerCase().includes("enhanced")||oe.Name?.toLowerCase().includes("random button"));O(Y)}}catch{}})()},[]);const M=t?.Policy?.IsAdministrator,H=async K=>{if(!(!K||!t?.Id)){k(!0);try{await ee.uploadUserImage(t.Id,"Primary",K),_(!1),window.dispatchEvent(new CustomEvent("userUpdated",{detail:t})),window.location.reload()}catch(te){console.error("Avatar upload failed",te),alert("Failed to upload avatar. Please try again.")}finally{k(!1)}}};return g.jsxs(g.Fragment,{children:[g.jsx("nav",{className:`navbar ${l||i?"scrolled":""}`,children:g.jsxs("div",{className:"nav-content",children:[g.jsxs("div",{className:"nav-start",children:[g.jsx(Vr,{to:"/",className:"nav-logo",children:e.logoUrl?g.jsx("img",{src:e.logoUrl,alt:e.appName}):g.jsx("img",{src:ao(e.accentColor),alt:e.appName})}),g.jsxs("div",{className:"nav-links primary-links",children:[g.jsx(Vr,{to:"/",className:"nav-link",children:"Home"}),e.showNavbarCategories&&n.map(K=>g.jsx("span",{className:"nav-link",onClick:()=>F(`/library/${K.Id}`),children:K.Name},K.Id)),e.jellyseerrUrl&&e.showNavbarRequests!==!1&&g.jsxs(g.Fragment,{children:[g.jsx("span",{className:"nav-divider"}),g.jsx("a",{href:e.jellyseerrUrl,target:"_blank",rel:"noopener noreferrer",className:"nav-link",children:"Requests"})]})]})]}),g.jsx("div",{className:"nav-end",children:g.jsxs("div",{className:"nav-actions",children:[g.jsx("button",{className:"nav-icon-btn",onClick:()=>u(!0),title:"Search",children:g.jsx("span",{className:"material-icons",children:"search"})}),g.jsx("button",{className:"nav-icon-btn",onClick:()=>F("/favorites"),title:"Watchlist",children:g.jsx("span",{className:"material-icons",children:"bookmark_border"})}),U&&g.jsx("button",{className:"nav-icon-btn",onClick:()=>{window.location.href="/web/index.html?classic#!/randomitems"},title:"Random",children:g.jsx("span",{className:"material-icons",children:"shuffle"})}),g.jsxs("div",{className:`nav-avatar-container ${f?"active":""}`,onClick:K=>{K.stopPropagation(),p(!f)},ref:j,children:[t?g.jsxs("div",{className:"nav-avatar-wrapper",children:[g.jsx("img",{src:`${ee.api.basePath}/Users/${t.Id}/Images/Primary?quality=90&${new Date().getTime()}`,alt:t.Name,className:"nav-avatar",onError:K=>{K.target.style.display="none"}}),g.jsx("span",{className:"material-icons avatar-arrow",children:"expand_more"})]}):g.jsxs("div",{className:"nav-avatar-wrapper",children:[g.jsx("span",{className:"material-icons nav-avatar-placeholder",children:"account_circle"}),g.jsx("span",{className:"material-icons avatar-arrow",children:"expand_more"})]}),f&&g.jsxs("div",{className:"nav-dropdown-menu usermenu",children:[t&&g.jsxs("div",{className:"user-menu-header",onClick:()=>{p(!1),A(!0)},children:[g.jsx("div",{className:"header-avatar-container",children:g.jsx("img",{src:`${ee.api.basePath}/Users/${t.Id}/Images/Primary?quality=90&${new Date().getTime()}`,alt:t.Name,className:"menu-avatar",onError:K=>{K.target.style.display="none"}})}),g.jsxs("div",{className:"user-menu-info",children:[g.jsx("span",{className:"user-name",children:t.Name}),g.jsxs("span",{className:"user-status",children:[g.jsx("span",{className:"material-icons",children:M?"shield":"person"}),M?"Administrator":"User"]})]}),g.jsx("span",{className:"material-icons edit-icon",children:"edit"})]}),g.jsx("div",{className:"menu-section-label",children:"General"}),g.jsxs("button",{onClick:()=>{p(!1),u(!0)},children:[g.jsx("span",{className:"material-icons",children:"search"})," Search"]}),g.jsxs("button",{onClick:()=>{p(!1),window.location.href="/web/index.html?classic#!/remotecontrol"},children:[g.jsx("span",{className:"material-icons",children:"cast"})," Cast to Device"]}),g.jsxs("button",{onClick:()=>{p(!1),window.location.href="/web/index.html?classic#!/syncplay"},children:[g.jsx("span",{className:"material-icons",children:"sync"})," SyncPlay"]}),g.jsxs("button",{onClick:()=>{p(!1),window.location.href="/web/index.html?classic#!/playback"},children:[g.jsx("span",{className:"material-icons",children:"play_circle"})," Player"]}),U&&g.jsxs("button",{onClick:()=>{p(!1),window.location.href="/web/index.html?classic#!/randomitems"},children:[g.jsx("span",{className:"material-icons",children:"shuffle"})," Random"]}),M&&g.jsxs(g.Fragment,{children:[g.jsx("div",{className:"dropdown-divider"}),g.jsx("div",{className:"menu-section-label",children:"Administration"}),g.jsxs("button",{onClick:()=>{p(!1),window.location.href="/web/index.html?classic#!/dashboard"},children:[g.jsx("span",{className:"material-icons",children:"dashboard"})," Dashboard"]})]}),g.jsx("div",{className:"dropdown-divider"}),g.jsx("div",{className:"menu-section-label",children:"Preferences"}),g.jsxs("button",{onClick:()=>{p(!1),window.location.href="/web/index.html?#/profile"},children:[g.jsx("span",{className:"material-icons",children:"settings"})," User Settings"]}),g.jsxs("button",{onClick:()=>{p(!1),x(!0)},children:[g.jsx("span",{className:"material-icons",children:"palette"})," Theme Settings"]}),U&&g.jsxs("button",{onClick:()=>{p(!1),window.location.href="/web/index.html#!/configurationpage?name=JellyfinEnhanced"},children:[g.jsx("span",{className:"material-icons",children:"auto_awesome"})," Jellyfin Enhanced"]}),g.jsx("div",{className:"dropdown-divider"}),g.jsx("div",{className:"menu-section-label",children:"Account"}),g.jsxs("button",{onClick:()=>{p(!1),_(!0)},children:[g.jsx("span",{className:"material-icons",children:"face"})," Change Avatar"]}),g.jsxs("button",{onClick:()=>{p(!1),E(!0)},children:[g.jsx("span",{className:"material-icons",children:"qr_code"})," Quick Connect"]}),g.jsxs("button",{onClick:()=>{p(!1),F("/login/select-server")},children:[g.jsx("span",{className:"material-icons",children:"dns"})," Change Server"]}),g.jsxs("button",{onClick:()=>{p(!1),localStorage.removeItem("jellyfin_credentials"),window.location.reload()},children:[g.jsx("span",{className:"material-icons",children:"logout"})," Log Out"]})]})]})]})})]})}),g.jsx(FL,{isOpen:h,onClose:()=>u(!1)}),g.jsx(bS,{isOpen:v,onClose:()=>x(!1),userId:t?.Id}),g.jsx(GL,{isOpen:S,onClose:()=>E(!1)}),g.jsx(HL,{isOpen:T,onClose:()=>A(!1),user:t}),g.jsx(Cu,{isOpen:I,onClose:()=>_(!1),onSave:H,userId:t?.Id,uploading:C})]})},zL=()=>{const{config:i}=Hi();return g.jsx("div",{className:"legitflix-footer",children:g.jsxs("div",{className:"footer-content",children:[g.jsx("div",{className:"footer-logo",children:g.jsx("a",{href:"https://github.com/gorillasuti/Legitflix-plugin",target:"_blank",rel:"noopener noreferrer",className:"footer-link",children:g.jsx("img",{className:"footer-logo-img",src:ao(i.accentColor),alt:i.appName})})}),g.jsx("div",{className:"footer-divider"}),g.jsxs("div",{className:"footer-author",children:["Created by ",g.jsx("a",{href:"https://github.com/gorillasuti",target:"_blank",rel:"noopener noreferrer",className:"footer-link",children:g.jsx("strong",{children:"gorillasuti"})})]})]})})},ay=()=>{const[i,e]=w.useState([]),[t,s]=w.useState([]),[n,r]=w.useState([]),[l,c]=w.useState([]),[h,u]=w.useState(!0),[f,p]=w.useState(null),{config:v}=Hi(),x=Ps();w.useEffect(()=>{(async()=>{u(!0);try{const A=await ee.getCurrentUser();if(A){const I=await ee.getUserViews(A.Id);e(I.Items||[]);const C=(await ee.getResumeItems(A.Id)).Items||[];s(C);const U=((await ee.getHistoryItems(A.Id,12)).Items||[]).filter(M=>!C.some(H=>H.Id===M.Id));r(U);const j=(await(async()=>{const M=v.contentSortMode||"latest",H={latest:{sortBy:"DateCreated",sortOrder:"Descending"},random:{sortBy:"Random",sortOrder:"Descending"},topRated:{sortBy:"CommunityRating",sortOrder:"Descending"}},{sortBy:K,sortOrder:te}=H[M]||H.latest;return ee.getItems(A.Id,{limit:20,recursive:!0,includeItemTypes:v.promoMediaTypes||["Movie","Series"],sortBy:K,sortOrder:te,imageTypeLimit:1,enableImageTypes:["Primary","Backdrop","Thumb","Logo"],fields:["Overview","ProductionYear","ImageTags","OfficialRating","CommunityRating","Genres"]})})()).Items||[];c(j.slice(0,3))}}catch(A){console.error("Failed to fetch data",A)}finally{u(!1)}})()},[v]);const S=T=>{p(T)},E=()=>{p(null)};return g.jsxs("div",{className:"home-page",children:[g.jsx(va,{}),g.jsx(DL,{onInfoClick:S}),g.jsx("div",{className:"home-content-container",style:{position:"relative",zIndex:10},children:h?g.jsxs("div",{style:{padding:"0 4.2%",marginTop:"40px"},children:[g.jsx(ze,{width:"180px",height:"24px",style:{marginBottom:"20px"}}),g.jsx("div",{style:{display:"flex",gap:"15px",overflow:"hidden",marginBottom:"50px"},children:[1,2,3,4,5,6].map(T=>g.jsx("div",{style:{flex:"0 0 160px"},children:g.jsx(ze,{width:"100%",height:"240px",style:{borderRadius:"8px"}})},T))}),g.jsx(ze,{width:"220px",height:"24px",style:{marginBottom:"20px"}}),g.jsx("div",{style:{display:"flex",gap:"15px",overflow:"hidden",marginBottom:"50px"},children:[1,2,3,4,5].map(T=>g.jsxs("div",{style:{flex:"0 0 280px"},children:[g.jsx(ze,{width:"100%",height:"157px",style:{borderRadius:"4px",marginBottom:"8px"}}),g.jsx(ze,{width:"70%",height:"14px",style:{marginBottom:"4px"}}),g.jsx(ze,{width:"40%",height:"12px"})]},T))}),g.jsxs("div",{style:{marginBottom:"50px"},children:[g.jsx(ze,{width:"100%",height:"300px",style:{borderRadius:"12px",marginBottom:"15px"}}),g.jsxs("div",{style:{display:"flex",gap:"15px"},children:[g.jsx(ze,{width:"50%",height:"180px",style:{borderRadius:"12px"}}),g.jsx(ze,{width:"50%",height:"180px",style:{borderRadius:"12px"}})]})]}),g.jsx(ze,{width:"180px",height:"24px",style:{marginBottom:"20px"}}),g.jsx("div",{style:{display:"flex",gap:"15px",overflow:"hidden"},children:[1,2,3,4,5].map(T=>g.jsx("div",{style:{flex:"0 0 220px"},children:g.jsx(ze,{width:"100%",height:"330px",style:{borderRadius:"4px"}})},T))})]}):g.jsxs(g.Fragment,{children:[g.jsxs("section",{className:"home-section",style:{paddingLeft:"4%",paddingRight:"4%",marginBottom:"40px"},children:[g.jsx("h2",{className:"section-title",style:{fontSize:"1.4rem",fontWeight:"bold",marginBottom:"15px",color:"#cacaca"},children:"Browse Libraries"}),g.jsxs("div",{className:"libraries-grid",children:[i.map(T=>g.jsxs("div",{className:"library-card",onClick:()=>x(`/library/${T.Id}`),children:[g.jsx("img",{src:`${ee.api.basePath}/Items/${T.Id}/Images/Primary?fillHeight=480&fillWidth=320&quality=90`,alt:T.Name,className:"library-card-image",onError:A=>{A.target.style.display="none",A.target.nextSibling.style.display="flex"}}),g.jsx("div",{className:"library-card-content fallback",style:{display:"none"},children:g.jsx("span",{className:"material-icons library-icon",children:T.CollectionType==="movies"?"movie":T.CollectionType==="tvshows"?"tv":"folder"})}),v.showLibraryTitles&&g.jsx("div",{className:"library-card-overlay",children:g.jsx("span",{className:"library-name",children:T.Name})})]},T.Id)),g.jsx(jL,{})]})]}),t.length>0&&g.jsxs("section",{className:"home-section",style:{paddingLeft:"4%",paddingRight:"4%",marginBottom:"40px"},children:[g.jsx("h2",{className:"section-title",style:{fontSize:"1.4rem",fontWeight:"bold",marginBottom:"15px",color:"#cacaca"},children:"Continue Watching"}),g.jsx("div",{className:"backdrop-scroll-container",children:t.map(T=>{const A=T.UserData?.PlayedPercentage>=100||T.UserData?.Played,I=T.RunTimeTicks&&T.UserData?.PlaybackPositionTicks?T.RunTimeTicks-T.UserData.PlaybackPositionTicks:0,_=I>0?Math.round(I/6e8):0;return g.jsxs("div",{className:"backdrop-card",onClick:()=>window.location.href=`/web/index.html?classic=true#!/playback?id=${T.Id}`,title:`Resume: ${T.Name}`,children:[g.jsxs("div",{className:"backdrop-card-image",children:[g.jsx("img",{src:`${ee.api.basePath}/Items/${T.Id}/Images/Backdrop/0?maxWidth=500&quality=90`,alt:T.Name,onError:C=>{C.target.src=`${ee.api.basePath}/Items/${T.Id}/Images/Primary?maxWidth=500`}}),g.jsx("div",{className:"backdrop-play-overlay",children:g.jsx("span",{className:"material-icons",children:"play_arrow"})}),A?g.jsx("div",{className:"backdrop-badge watched",children:"Watched"}):_>0?g.jsxs("div",{className:"backdrop-badge time-left",children:[_,"m left"]}):null]}),T.UserData&&T.RunTimeTicks>0&&!A&&g.jsx("div",{className:"backdrop-progress-track",children:g.jsx("div",{className:"backdrop-progress-fill",style:{width:`${Math.min(100,T.UserData.PlaybackPositionTicks/T.RunTimeTicks*100)}%`}})}),g.jsxs("div",{className:"backdrop-card-info",children:[g.jsx("span",{className:"backdrop-card-series",children:T.SeriesName||""}),g.jsx("span",{className:"backdrop-card-title",children:T.SeriesName&&T.ParentIndexNumber!=null&&T.IndexNumber!=null?`S${T.ParentIndexNumber} E${T.IndexNumber}  ${T.Name}`:T.Name})]})]},T.Id)})})]}),n.length>0&&g.jsxs("section",{className:"home-section",style:{paddingLeft:"4%",paddingRight:"4%",marginBottom:"40px"},children:[g.jsx("h2",{className:"section-title",style:{fontSize:"1.4rem",fontWeight:"bold",marginBottom:"15px",color:"#cacaca"},children:"History"}),g.jsx("div",{className:"backdrop-scroll-container",children:n.map(T=>g.jsxs("div",{className:"backdrop-card",onClick:()=>x(`/item/${T.Id}`),title:T.Name,children:[g.jsxs("div",{className:"backdrop-card-image",children:[g.jsx("img",{src:`${ee.api.basePath}/Items/${T.Id}/Images/Backdrop/0?maxWidth=500&quality=90`,alt:T.Name,onError:A=>{A.target.src=`${ee.api.basePath}/Items/${T.Id}/Images/Primary?maxWidth=500`}}),g.jsx("div",{className:"backdrop-play-overlay",children:g.jsx("span",{className:"material-icons",children:"info"})})]}),g.jsxs("div",{className:"backdrop-card-info",children:[g.jsx("span",{className:"backdrop-card-series",children:T.SeriesName||""}),g.jsx("span",{className:"backdrop-card-title",children:T.SeriesName&&T.ParentIndexNumber!=null&&T.IndexNumber!=null?`S${T.ParentIndexNumber} E${T.IndexNumber}  ${T.Name}`:T.Name})]})]},T.Id))})]}),l.length>0&&g.jsx("section",{className:"home-section",style:{paddingLeft:"4%",paddingRight:"4%",marginBottom:"50px"},children:g.jsxs("div",{className:"promo2-wrapper",children:[g.jsxs("div",{className:"promo2-hero",onClick:()=>x(`/item/${l[0].Id}`),children:[g.jsx("img",{src:`${ee.api.basePath}/Items/${l[0].Id}/Images/Backdrop/0?maxWidth=1400&quality=90`,className:"promo2-hero-img",alt:l[0].Name}),g.jsx("div",{className:"promo2-hero-gradient"}),g.jsxs("div",{className:"promo2-hero-content",children:[l[0].ImageTags?.Logo?g.jsx("img",{src:`${ee.api.basePath}/Items/${l[0].Id}/Images/Logo/0?maxWidth=350&quality=90`,className:"promo2-hero-logo",alt:l[0].Name}):g.jsx("h2",{className:"promo2-hero-title",children:l[0].Name}),g.jsxs("div",{className:"promo2-meta-line",children:[g.jsx("span",{className:"promo2-badge",children:l[0].OfficialRating||"13+"}),l[0].ProductionYear&&g.jsxs(g.Fragment,{children:[g.jsx("span",{className:"promo2-meta-dot",children:""}),g.jsx("span",{className:"promo2-meta-text",children:l[0].ProductionYear})]}),l[0].Genres&&l[0].Genres.length>0&&g.jsxs(g.Fragment,{children:[g.jsx("span",{className:"promo2-meta-dot",children:""}),g.jsx("span",{className:"promo2-meta-text",children:l[0].Genres.slice(0,3).join(", ")})]}),l[0].CommunityRating&&g.jsxs(g.Fragment,{children:[g.jsx("span",{className:"promo2-meta-dot",children:""}),g.jsxs("span",{className:"promo2-meta-text",children:[" ",l[0].CommunityRating.toFixed(1)]})]})]}),l[0].Overview&&g.jsx("p",{className:"promo2-hero-desc",children:l[0].Overview}),g.jsx(gi,{variant:"ringHover",size:"lg",className:"promo2-btn",onClick:T=>{T.stopPropagation(),x(`/item/${l[0].Id}`)},children:"WATCH NOW"})]})]}),(l[1]||l[2])&&g.jsx("div",{className:"promo2-row",children:l.slice(1,3).map(T=>g.jsxs("div",{className:"promo2-card",onClick:()=>x(`/item/${T.Id}`),children:[g.jsxs("div",{className:"promo2-card-text",children:[T.ImageTags?.Logo?g.jsx("img",{src:`${ee.api.basePath}/Items/${T.Id}/Images/Logo/0?maxWidth=220&quality=90`,className:"promo2-card-logo",alt:T.Name}):g.jsx("h3",{className:"promo2-card-title",children:T.Name}),g.jsxs("div",{className:"promo2-meta-line promo2-meta-line--card",children:[g.jsx("span",{className:"promo2-badge",children:T.OfficialRating||"13+"}),T.ProductionYear&&g.jsxs(g.Fragment,{children:[g.jsx("span",{className:"promo2-meta-dot",children:""}),g.jsx("span",{className:"promo2-meta-text",children:T.ProductionYear})]}),T.Genres&&T.Genres.length>0&&g.jsxs(g.Fragment,{children:[g.jsx("span",{className:"promo2-meta-dot",children:""}),g.jsx("span",{className:"promo2-meta-text",children:T.Genres.slice(0,2).join(", ")})]}),T.CommunityRating&&g.jsxs(g.Fragment,{children:[g.jsx("span",{className:"promo2-meta-dot",children:""}),g.jsxs("span",{className:"promo2-meta-text",children:[" ",T.CommunityRating.toFixed(1)]})]})]}),g.jsx("p",{className:"promo2-card-desc",children:T.Overview}),g.jsx(gi,{variant:"ringHover",className:"promo2-btn",onClick:A=>{A.stopPropagation(),x(`/item/${T.Id}`)},children:"START WATCHING"})]}),g.jsx("div",{className:"promo2-card-img",children:g.jsx("img",{src:`${ee.api.basePath}/Items/${T.Id}/Images/Backdrop/0?maxWidth=500&quality=90`,alt:T.Name,onError:A=>{A.target.src=`${ee.api.basePath}/Items/${T.Id}/Images/Primary?maxWidth=400`}})})]},T.Id))})]})}),i.map(T=>g.jsx(UL,{title:`Latest ${T.Name}`,libraryId:T.Id,onCardClick:A=>x(`/item/${A.Id}`)},T.Id)),g.jsx(zL,{})]})}),g.jsx(ML,{itemId:f,isOpen:!!f,onClose:E})]})};var Zh={exports:{}},Jh,ry;function KL(){if(ry)return Jh;ry=1;var i="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return Jh=i,Jh}var ef,ly;function YL(){if(ly)return ef;ly=1;var i=KL();function e(){}function t(){}return t.resetWarningCache=e,ef=function(){function s(l,c,h,u,f,p){if(p!==i){var v=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw v.name="Invariant Violation",v}}s.isRequired=s;function n(){return s}var r={array:s,bigint:s,bool:s,func:s,number:s,object:s,string:s,symbol:s,any:s,arrayOf:n,element:s,elementType:s,instanceOf:n,node:s,objectOf:n,oneOf:n,oneOfType:n,shape:n,exact:n,checkPropTypes:t,resetWarningCache:e};return r.PropTypes=r,r},ef}var oy;function qL(){return oy||(oy=1,Zh.exports=YL()()),Zh.exports}var QL=qL();const wr=Rx(QL),cy={popular:[{code:"eng",name:"English"},{code:"spa",name:"Spanish"},{code:"jpn",name:"Japanese"},{code:"hun",name:"Hungarian"}],more:[{code:"ara",name:"Arabic"},{code:"bul",name:"Bulgarian"},{code:"chi",name:"Chinese"},{code:"hrv",name:"Croatian"},{code:"cze",name:"Czech"},{code:"dan",name:"Danish"},{code:"dut",name:"Dutch"},{code:"fin",name:"Finnish"},{code:"fre",name:"French"},{code:"ger",name:"German"},{code:"gre",name:"Greek"},{code:"heb",name:"Hebrew"},{code:"hin",name:"Hindi"},{code:"ind",name:"Indonesian"},{code:"ita",name:"Italian"},{code:"kor",name:"Korean"},{code:"may",name:"Malay"},{code:"nor",name:"Norwegian"},{code:"per",name:"Persian"},{code:"pol",name:"Polish"},{code:"por",name:"Portuguese"},{code:"rum",name:"Romanian"},{code:"rus",name:"Russian"},{code:"srp",name:"Serbian"},{code:"slo",name:"Slovak"},{code:"slv",name:"Slovenian"},{code:"swe",name:"Swedish"},{code:"tha",name:"Thai"},{code:"tur",name:"Turkish"},{code:"ukr",name:"Ukrainian"},{code:"vie",name:"Vietnamese"}]},fm=({isOpen:i,onClose:e,seriesId:t,initialSeasonId:s,initialEpisodeId:n,isMovie:r=!1})=>{const[l,c]=w.useState([]),[h,u]=w.useState([]),[f,p]=w.useState(s||""),[v,x]=w.useState(n||""),[S,E]=w.useState([]),[T,A]=w.useState([]),[I,_]=w.useState("eng"),[C,k]=w.useState(!1),[U,O]=w.useState(!1),[F,j]=w.useState(null);w.useEffect(()=>{i&&t&&(r?x(n||t):M())},[i,t,r]),w.useEffect(()=>{f&&H(f)},[f]),w.useEffect(()=>{v&&K()},[v]);const M=async()=>{try{const D=await ee.getCurrentUser(),G=await ee.getSeasons(D.Id,t);c(G.Items||[]),!f&&G.Items.length>0&&p(G.Items[0].Id)}catch(D){console.error("Failed to load seasons",D)}},H=async D=>{try{const G=await ee.getCurrentUser(),Y=await ee.getEpisodes(G.Id,t,D);u(Y.Items||[]),!v&&Y.Items.length>0?x(Y.Items[0].Id):v&&(Y.Items.find(oe=>oe.Id===v)||x(Y.Items[0]?Y.Items[0].Id:""))}catch(G){console.error("Failed to load episodes",G)}},K=async()=>{if(v){k(!0),j(null);try{const D=await ee.getCurrentUser(),G=await ee.getMediaStreams(D.Id,v);E(G.filter(Y=>Y.Type==="Subtitle"))}catch(D){j("Failed to load subtitles."),console.error(D)}finally{k(!1)}}},te=async D=>{if(window.confirm("Are you sure you want to delete this subtitle?"))try{await ee.deleteSubtitle(v,D),K()}catch{alert("Failed to delete subtitle")}},ae=async D=>{if(D.preventDefault(),!!v){O(!0),A([]);try{const G=await ee.searchRemoteSubtitles(v,I);A(G||[])}catch{alert("Search failed")}finally{O(!1)}}},me=async D=>{try{await ee.downloadRemoteSubtitles(v,D),alert("Subtitle downloaded!"),K()}catch{alert("Download failed")}};return i?g.jsx("div",{className:"lf-sub-overlay",onClick:e,children:g.jsxs("div",{className:"lf-sub-modal",onClick:D=>D.stopPropagation(),children:[g.jsxs("div",{className:"lf-sub-header",children:[g.jsx("h3",{children:"Subtitles Manager"}),g.jsx("button",{className:"lf-sub-header__close",onClick:e,children:g.jsx("span",{className:"material-icons",children:"close"})})]}),g.jsxs("div",{className:"lf-sub-content",children:[!r&&g.jsxs("div",{className:"lf-sub-selectors",children:[g.jsxs("div",{children:[g.jsx("label",{className:"lf-sub-label",children:"Season"}),g.jsx("select",{className:"lf-sub-select",value:f,onChange:D=>{p(D.target.value),x("")},children:l.map(D=>g.jsx("option",{value:D.Id,children:D.Name},D.Id))})]}),g.jsxs("div",{children:[g.jsx("label",{className:"lf-sub-label",children:"Episode"}),g.jsx("select",{className:"lf-sub-select",value:v,onChange:D=>x(D.target.value),children:h.map(D=>g.jsxs("option",{value:D.Id,children:[D.IndexNumber,". ",D.Name]},D.Id))})]})]}),g.jsxs("div",{className:"lf-sub-section",children:[g.jsx("h4",{className:"lf-sub-section-title",children:"Current Subtitles"}),C?g.jsxs("div",{className:"lf-sub-loading",children:[g.jsx("span",{className:"material-icons",children:"sync"}),"Loading"]}):g.jsx("div",{className:"lf-sub-list",children:S.length===0?g.jsx("div",{className:"lf-sub-list__empty",children:"No subtitles found."}):S.map((D,G)=>g.jsxs("div",{className:"lf-sub-list__item",children:[g.jsxs("div",{children:[g.jsx("div",{className:"lf-sub-list__name",children:D.DisplayTitle||D.Language||"Unknown"}),g.jsxs("div",{className:"lf-sub-list__meta",children:[D.IsExternal?"External":"Embedded","  ",D.Codec]})]}),D.IsExternal&&g.jsxs("button",{className:"lf-sub-action-btn lf-sub-action-btn--delete",onClick:()=>te(D.Index),children:[g.jsx("span",{className:"material-icons",children:"delete_outline"}),"Delete"]})]},G))})]}),g.jsxs("div",{className:"lf-sub-section",children:[g.jsx("h4",{className:"lf-sub-section-title",children:"Search Subtitles"}),g.jsxs("form",{onSubmit:ae,className:"lf-sub-search-row",children:[g.jsxs("select",{className:"lf-sub-select",value:I,onChange:D=>_(D.target.value),style:{flex:1},children:[g.jsx("optgroup",{label:"Popular",children:cy.popular.map(D=>g.jsx("option",{value:D.code,children:D.name},D.code))}),g.jsx("optgroup",{label:"More Languages",children:cy.more.map(D=>g.jsx("option",{value:D.code,children:D.name},D.code))})]}),g.jsxs("button",{type:"submit",disabled:U||!v,className:"lf-sub-action-btn lf-sub-action-btn--search",children:[g.jsx("span",{className:"material-icons",children:"search"}),U?"Searching":"Search"]})]}),T.length>0&&g.jsx("div",{className:"lf-sub-list",children:T.map(D=>g.jsxs("div",{className:"lf-sub-list__item",children:[g.jsxs("div",{className:"lf-sub-list__info",children:[g.jsx("div",{className:"lf-sub-list__name",children:D.Name}),g.jsxs("div",{className:"lf-sub-list__meta",children:[D.Format,"  ",D.ProviderName,"  ",D.DownloadCount," DLs"]})]}),g.jsxs("button",{className:"lf-sub-action-btn lf-sub-action-btn--download",onClick:()=>me(D.Id),children:[g.jsx("span",{className:"material-icons",children:"download"}),"Download"]})]},D.Id))})]})]})]})}):null};fm.propTypes={isOpen:wr.bool.isRequired,onClose:wr.func.isRequired,seriesId:wr.string,initialSeasonId:wr.string,initialEpisodeId:wr.string,isMovie:wr.bool};const WL=()=>{const{id:i}=Eu(),e=Ps(),[t,s]=w.useState(null),[n,r]=w.useState([]),[l,c]=w.useState([]),[h,u]=w.useState(null),[f,p]=w.useState([]),[v,x]=w.useState(!0),[S,E]=w.useState(!1),[T,A]=w.useState(!1),[I,_]=w.useState(null),[C,k]=w.useState(!1),[U,O]=w.useState(!1),[F,j]=w.useState(!1),[M,H]=w.useState([]),[K,te]=w.useState(localStorage.getItem("legitflix-audio-pref")||"en"),[ae,me]=w.useState(localStorage.getItem("legitflix-sub-pref")||"en"),[D,G]=w.useState(!1),[Y,oe]=w.useState("all"),[pe,P]=w.useState("default"),[V,se]=w.useState(!1),[he,ye]=w.useState(!1),[Ae,Pe]=w.useState(!1),[He,Be]=w.useState(!1),[ht,dt]=w.useState(!1),[Mt,bt]=w.useState(!1),[Tt,os]=w.useState(null),[Ve,we]=w.useState(!1),[Me,Qe]=w.useState(!1),ge=w.useRef(null),_e=w.useRef(null),De=w.useRef(null),at=w.useRef(null),st=w.useRef(null),Bt=w.useRef(null),ts=w.useRef(null),ys=w.useRef(null);w.useEffect(()=>{(async()=>{x(!0);try{const Ne=await ee.getCurrentUser();if(!Ne)return;const Xe=await ee.getSeries(Ne.Id,i);if(s(Xe),Qe(Xe.UserData?.IsFavorite||!1),Xe.RemoteTrailers&&Xe.RemoteTrailers.length>0){const At=Xe.RemoteTrailers[0].Url.match(/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/);At&&At[1]&&os(At[1])}const zt=await ee.getSeasons(Ne.Id,i);let Ie=null;zt.Items&&zt.Items.length>0&&(r(zt.Items),Ie=zt.Items[0].Id);try{const gt=await ee.getNextUp(Ne.Id,i);if(gt&&gt.Items&&gt.Items.length>0){const At=gt.Items[0];_(At),At.SeasonId&&zt.Items.find(Sa=>Sa.Id===At.SeasonId)&&(Ie=At.SeasonId)}}catch(gt){console.warn("Failed to fetch Next Up for smart season selection",gt)}Ie&&u(Ie);const Ts=await ee.getSimilarItems(Ne.Id,i);p(Ts.Items||[])}catch(Ne){console.error("Failed to load series data",Ne)}finally{x(!1)}})()},[i]);const xs=async()=>{if(!(!t||!h))try{const ue=await ee.getCurrentUser(),Ne=await ee.getEpisodes(ue.Id,t.Id,h);c(Ne.Items||[])}catch(ue){console.error("Failed to load episodes",ue)}};w.useEffect(()=>{xs()},[h,t]),w.useEffect(()=>{const ue=Ne=>{ge.current&&!ge.current.contains(Ne.target)&&O(!1),_e.current&&!_e.current.contains(Ne.target)&&G(!1),De.current&&!De.current.contains(Ne.target)&&se(!1),at.current&&!at.current.contains(Ne.target)&&ye(!1)};return document.addEventListener("mousedown",ue),()=>document.removeEventListener("mousedown",ue)},[]);const Ss=()=>{j(!F),H([])},Cs=ue=>{e(`/play/${ue}`)},Ht=ue=>{F?M.includes(ue)?H(M.filter(Ne=>Ne!==ue)):H([...M,ue]):Cs(ue)},Bs=async ue=>{if(!(M.length===0||T)){A(!0),c(Ne=>Ne.map(Xe=>M.includes(Xe.Id)?{...Xe,UserData:{...Xe.UserData||{},Played:ue}}:Xe));try{const Ne=await ee.getCurrentUser();if(!Ne)throw new Error("No user");await Promise.all(M.map(Xe=>ee.markPlayed(Ne.Id,Xe,ue))),await xs()}catch(Ne){console.error("Failed to mark episodes",Ne),await xs()}finally{A(!1),H([])}}},bs=()=>{const ue=l.map(Xe=>Xe.Id),Ne=ue.every(Xe=>M.includes(Xe));H(Ne?[]:ue)},Vt=(ue,Ne)=>{ue==="audio"?(te(Ne),localStorage.setItem("legitflix-audio-pref",Ne)):(me(Ne),localStorage.setItem("legitflix-sub-pref",Ne)),G(!1)},fs=async()=>{try{const ue=await ee.getCurrentUser(),Ne=!Me;await ee.markFavorite(ue.Id,t.Id,Ne),Qe(Ne)}catch(ue){console.error("Favorite toggle failed",ue)}},Et=()=>{const ue=!Ve;we(ue);const Ne=ue?"mute":"unMute";ys.current?.contentWindow?.postMessage(JSON.stringify({event:"command",func:Ne,args:[]}),"*")},xi=()=>{Bt.current&&clearTimeout(Bt.current),Bt.current=setTimeout(()=>{Ae&&Be(!0)},5e3)},ei=()=>{Be(!1),Ae&&xi()},ti=()=>{if(Ae){ms();return}Pe(!0),Be(!1),xi();let ue=!1;const Ne=Xe=>{typeof Xe.data=="string"&&(Xe.data.includes('"event"')||Xe.data.includes('"id"'))&&(ue=!0,st.current&&clearTimeout(st.current))};window.addEventListener("message",Ne),window.lfMessageHandler=Ne,st.current=setTimeout(()=>{!ue&&Ae&&(console.log("Possible block detected: No YT API message received."),dt(!0))},4e3)},ms=()=>{Pe(!1),Be(!1),dt(!1),bt(!1),we(!1),Bt.current&&(clearTimeout(Bt.current),Bt.current=null),st.current&&(clearTimeout(st.current),st.current=null),window.lfMessageHandler&&(window.removeEventListener("message",window.lfMessageHandler),delete window.lfMessageHandler)},Wt=ue=>{F||(ts.current=setTimeout(()=>{j(!0),H([ue]),navigator.vibrate&&navigator.vibrate(50)},600))},Us=()=>{ts.current&&clearTimeout(ts.current)},Ms=M.length===0?{label:"Mark Watched",icon:"visibility"}:M.every(Ne=>l.find(zt=>zt.Id===Ne)?.UserData?.Played)?{label:"Mark Unwatched",icon:"visibility_off",isPlayed:!1}:{label:"Mark Watched",icon:"visibility",isPlayed:!0},cs=w.useMemo(()=>{let ue=[...l];return Y==="unwatched"?ue=ue.filter(Ne=>!Ne.UserData?.Played):Y==="watched"&&(ue=ue.filter(Ne=>Ne.UserData?.Played)),pe==="newest"?ue.sort((Ne,Xe)=>(Xe.IndexNumber||0)-(Ne.IndexNumber||0)):pe==="oldest"&&ue.sort((Ne,Xe)=>(Ne.IndexNumber||0)-(Xe.IndexNumber||0)),ue},[l,Y,pe]);if(w.useEffect(()=>()=>{Bt.current&&clearTimeout(Bt.current),st.current&&clearTimeout(st.current),window.lfMessageHandler&&window.removeEventListener("message",window.lfMessageHandler)},[]),v)return g.jsxs("div",{className:"lf-series-container",children:[g.jsx(va,{alwaysFilled:!0}),g.jsxs("section",{className:"lf-series-hero",children:[g.jsx("div",{className:"lf-series-hero__backdrop",style:{background:"#141414"}}),g.jsxs("div",{className:"lf-series-hero__content",children:[g.jsx("div",{className:"lf-series-hero__poster",children:g.jsx(ze,{type:"rect",width:"100%",height:"100%",style:{aspectRatio:"2/3",borderRadius:"8px"}})}),g.jsxs("div",{className:"lf-series-hero__info",children:[g.jsx("h1",{className:"lf-series-hero__title",style:{marginBottom:"1rem"},children:g.jsx(ze,{type:"text",width:"60%",height:"3rem"})}),g.jsxs("div",{className:"lf-series-hero__meta",style:{display:"flex",gap:"1rem",marginBottom:"1.5rem"},children:[g.jsx(ze,{type:"text",width:"60px"}),g.jsx(ze,{type:"text",width:"40px"}),g.jsx(ze,{type:"text",width:"80px"})]}),g.jsxs("div",{className:"lf-series-hero__details",children:[g.jsxs("div",{className:"lf-series-hero__description",children:[g.jsx(ze,{type:"text",width:"100%"}),g.jsx(ze,{type:"text",width:"95%"}),g.jsx(ze,{type:"text",width:"90%"})]}),g.jsxs("div",{className:"lf-series-hero__cast-info",style:{marginTop:"1rem"},children:[g.jsx(ze,{type:"text",width:"80%"}),g.jsx(ze,{type:"text",width:"70%"})]})]}),g.jsxs("div",{className:"lf-series-hero__actions",style:{marginTop:"2rem",display:"flex",gap:"1rem"},children:[g.jsx(ze,{type:"rect",width:"180px",height:"48px",style:{borderRadius:"24px"}}),g.jsx(ze,{type:"rect",width:"160px",height:"48px",style:{borderRadius:"24px"}})]})]})]})]})]});if(!t)return g.jsx("div",{className:"lf-series-container",style:{color:"white"},children:"Series not found"});const Vs=ee.getImageUrl(t,"Backdrop"),Si=ee.getImageUrl(t,"Primary"),si=ee.getImageUrl(t,"Logo"),Nt=t.People?t.People.slice(0,10):[],Ui=n.find(ue=>ue.Id===h),Mi=[{code:"en",name:"English"},{code:"ja",name:"Japanese"}],Ki=[{code:"en",name:"English"},{code:"es",name:"Spanish"},{code:"hu",name:"Hungarian"}];return g.jsxs("div",{className:"lf-series-container",children:[g.jsx(va,{alwaysFilled:!0}),g.jsxs("section",{className:`lf-series-hero ${He?"is-clean-view":""}`,onMouseMove:ei,onClick:ei,children:[g.jsx("div",{className:`lf-series-hero__backdrop ${Ae?"is-hidden":""}`,style:{backgroundImage:`url('${Vs}')`}}),g.jsx("div",{className:`lf-series-hero__trailer ${Ae?"is-playing":""}`,children:Ae&&Tt&&g.jsx("iframe",{ref:ys,src:`https://www.youtube.com/embed/${Tt}?autoplay=1&mute=0&loop=1&modestbranding=1&rel=0&iv_load_policy=3&fs=0&color=white&controls=0&disablekb=1&playlist=${Tt}&enablejsapi=1&origin=${window.location.origin}&widget_referrer=${window.location.origin}`,frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",referrerPolicy:"strict-origin-when-cross-origin",allowFullScreen:!0,title:"Trailer"})}),Ae&&g.jsxs("button",{className:"lf-trailer-help-btn",onClick:ue=>{ue.stopPropagation(),bt(!0)},children:[g.jsx("span",{className:"material-icons",children:"help_outline"}),g.jsx("span",{children:"Trouble playing?"})]}),si&&g.jsx("img",{className:"lf-series-hero__logo",src:si,alt:t.Name}),g.jsxs("div",{className:"lf-series-hero__content",children:[g.jsx("img",{className:"lf-series-hero__poster",src:Si,alt:t.Name}),g.jsxs("div",{className:"lf-series-hero__info",children:[g.jsx("h1",{className:"lf-series-hero__title",children:t.Name}),g.jsxs("div",{className:"lf-series-hero__meta",children:[g.jsx("span",{children:t.ProductionYear}),g.jsx("span",{children:""}),g.jsx("span",{children:t.OfficialRating}),g.jsx("span",{children:""}),g.jsxs("div",{className:"lf-series-hero__rating",children:[g.jsx("span",{className:"material-icons",children:"star"}),g.jsx("span",{children:t.CommunityRating?t.CommunityRating.toFixed(1):""})]})]}),g.jsxs("div",{className:"lf-series-hero__details",children:[g.jsxs("div",{className:"lf-series-hero__description",children:[g.jsx("p",{className:`lf-series-hero__description-text ${C?"is-expanded":""}`,children:t.Overview}),t.Overview&&t.Overview.length>200&&g.jsxs("button",{className:`lf-series-hero__load-more ${C?"is-expanded":""}`,onClick:()=>k(!C),children:[C?"Show Less":"Read More",g.jsx("span",{className:"material-icons",children:"expand_more"})]})]}),Nt.length>0&&g.jsxs("div",{className:"lf-series-hero__cast-info",children:[g.jsxs("div",{style:{marginBottom:8},children:[g.jsx("strong",{children:"Starring: "}),Nt.slice(0,3).map(ue=>ue.Name).join(", "),Nt.length>3&&g.jsx("span",{children:"..."})]}),g.jsxs("div",{children:[g.jsx("strong",{children:"Genres: "}),t.Genres?t.Genres.join(", "):""]})]})]}),g.jsxs("div",{className:"lf-series-hero__actions",children:[g.jsxs("button",{className:"lf-btn lf-btn--primary lf-btn--ring-hover",onClick:()=>{I?Cs(I.Id):l.length>0&&Cs(l[0].Id)},children:[g.jsx("span",{className:"material-icons",children:"play_arrow"}),I?I.UserData?.PlaybackPositionTicks>0?`Resume S${I.ParentIndexNumber} E${I.IndexNumber}`:`Continue S${I.ParentIndexNumber} E${I.IndexNumber}`:"Start Watching"]}),g.jsxs("button",{className:"lf-btn lf-btn--glass lf-btn--ring-hover-secondary",onClick:ti,style:Tt?{}:{opacity:.5,pointerEvents:"none"},children:[g.jsx("span",{className:"material-icons",children:Ae?"stop_circle":"theaters"}),Ae?"Stop Trailer":"Watch Trailer"]}),Ae&&g.jsx("button",{className:`lf-btn lf-btn--glass lf-btn--icon-only ${Ve?"is-muted":""}`,onClick:Et,title:Ve?"Unmute":"Mute",children:g.jsx("span",{className:"material-icons",children:Ve?"volume_off":"volume_up"})}),g.jsx("button",{className:`lf-btn lf-btn--glass lf-btn--icon-only ${Me?"is-active":""}`,onClick:fs,title:"Add to List",children:g.jsx("span",{className:"material-icons",children:Me?"bookmark":"bookmark_border"})}),g.jsx("button",{className:"lf-btn lf-btn--glass lf-btn--icon-only",onClick:()=>E(!0),title:"Edit Subtitles",children:g.jsx("span",{className:"material-icons",children:"subtitles"})})]})]})]})]}),g.jsx("hr",{className:"lf-section-divider"}),g.jsxs("div",{className:"lf-content-section",children:[g.jsxs("div",{className:"lf-episodes-header",children:[g.jsxs("div",{className:`lf-season-selector ${U?"is-open":""}`,ref:ge,children:[g.jsxs("div",{className:"lf-season-selector__button",onClick:()=>O(!U),children:[g.jsx("span",{children:Ui?Ui.Name:"Select Season"}),g.jsx("span",{className:"material-icons",children:"expand_more"})]}),g.jsx("div",{className:"lf-season-selector__dropdown",children:n.map(ue=>g.jsx("div",{className:`lf-season-selector__option ${h===ue.Id?"is-selected":""}`,onClick:()=>{u(ue.Id),O(!1)},children:g.jsx("span",{children:ue.Name})},ue.Id))})]}),g.jsxs("div",{className:"lf-filter-controls",children:[g.jsxs("div",{className:`lf-filter-dropdown ${D?"is-open":""}`,ref:_e,children:[g.jsxs("button",{className:"lf-filter-btn",onClick:()=>G(!D),title:"Audio & Subtitles",children:[g.jsx("span",{className:"material-icons",children:"subtitles"}),g.jsx("span",{children:"Audio & Subs"}),g.jsx("span",{className:"material-icons",children:"expand_more"})]}),g.jsxs("div",{className:"lf-filter-dropdown__menu lf-lang-menu",children:[g.jsxs("div",{className:"lf-lang-section",children:[g.jsx("div",{className:"lf-dropdown-section-title",children:"Audio"}),Mi.map(ue=>g.jsxs("div",{className:`lf-filter-dropdown__option ${K===ue.code?"is-selected":""}`,onClick:()=>Vt("audio",ue.code),children:[g.jsx("span",{children:ue.name}),K===ue.code&&g.jsx("span",{className:"material-icons",children:"check"})]},ue.code))]}),g.jsx("div",{className:"lf-lang-separator"}),g.jsxs("div",{className:"lf-lang-section",children:[g.jsx("div",{className:"lf-dropdown-section-title",children:"Subtitles"}),Ki.map(ue=>g.jsxs("div",{className:`lf-filter-dropdown__option ${ae===ue.code?"is-selected":""}`,onClick:()=>Vt("sub",ue.code),children:[g.jsx("span",{children:ue.name}),ae===ue.code&&g.jsx("span",{className:"material-icons",children:"check"})]},ue.code))]}),g.jsx("div",{className:"lf-lang-footer",children:g.jsxs("button",{className:"lf-edit-subs-btn",onClick:()=>{G(!1),E(!0)},children:[g.jsx("span",{className:"material-icons",children:"edit"}),g.jsx("span",{children:"Edit Subtitles"})]})})]})]}),F?g.jsxs(g.Fragment,{children:[g.jsxs("button",{className:"lf-edit-subs-btn",style:{width:"auto",padding:"8px 16px",opacity:T?.6:1},onClick:()=>Bs(Ms.isPlayed),disabled:T||M.length===0,children:[g.jsx("span",{className:"material-icons",style:T?{animation:"lf-spin 1s linear infinite"}:{},children:T?"sync":Ms.icon}),g.jsx("span",{children:T?"Updating":Ms.label})]}),g.jsxs("button",{className:"lf-filter-btn",onClick:bs,children:[g.jsx("span",{className:"material-icons",children:"select_all"}),g.jsx("span",{children:l.length>0&&l.every(ue=>M.includes(ue.Id))?"Deselect All":"Select All"})]}),g.jsxs("button",{className:"lf-filter-btn is-active",onClick:Ss,title:"Cancel",children:[g.jsx("span",{className:"material-icons",children:"close"}),g.jsx("span",{children:"Cancel"})]})]}):g.jsxs(g.Fragment,{children:[g.jsxs("div",{className:`lf-filter-dropdown ${V?"is-open":""}`,ref:De,children:[g.jsxs("button",{className:`lf-filter-btn ${Y!=="all"?"is-active":""}`,onClick:()=>se(!V),title:"Filter episodes",children:[g.jsx("span",{className:"material-icons",children:"filter_list"}),g.jsx("span",{children:Y==="all"?"Filter":Y==="unwatched"?"Unwatched":"Watched"}),g.jsx("span",{className:"material-icons",children:"expand_more"})]}),g.jsx("div",{className:"lf-filter-dropdown__menu",children:[{key:"all",label:"All"},{key:"unwatched",label:"Unwatched"},{key:"watched",label:"Watched"}].map(ue=>g.jsxs("div",{className:`lf-filter-dropdown__option ${Y===ue.key?"is-selected":""}`,onClick:()=>{oe(ue.key),se(!1)},children:[g.jsx("span",{children:ue.label}),Y===ue.key&&g.jsx("span",{className:"material-icons",children:"check"})]},ue.key))})]}),g.jsxs("div",{className:`lf-filter-dropdown ${he?"is-open":""}`,ref:at,children:[g.jsxs("button",{className:`lf-filter-btn ${pe!=="default"?"is-active":""}`,onClick:()=>ye(!he),title:"Sort episodes",children:[g.jsx("span",{className:"material-icons",children:"sort"}),g.jsx("span",{children:pe==="default"?"Sort":pe==="newest"?"Newest":"Oldest"}),g.jsx("span",{className:"material-icons",children:"expand_more"})]}),g.jsx("div",{className:"lf-filter-dropdown__menu",children:[{key:"default",label:"Default"},{key:"newest",label:"Newest First"},{key:"oldest",label:"Oldest First"}].map(ue=>g.jsxs("div",{className:`lf-filter-dropdown__option ${pe===ue.key?"is-selected":""}`,onClick:()=>{P(ue.key),ye(!1)},children:[g.jsx("span",{children:ue.label}),pe===ue.key&&g.jsx("span",{className:"material-icons",children:"check"})]},ue.key))})]}),g.jsxs("button",{className:"lf-filter-btn",onClick:Ss,title:"Bulk Edit",children:[g.jsx("span",{className:"material-icons",children:"done_all"}),g.jsx("span",{children:"Select Item"})]})]})]})]}),g.jsx("div",{className:"lf-episode-grid",children:cs.map(ue=>{const Ne=M.includes(ue.Id),Xe=ue.UserData?.Played;return g.jsxs("div",{className:`lf-episode-card ${F?"is-selecting-mode":""} ${Ne?"is-selected":""} ${Xe?"is-watched":""}`,onClick:()=>Ht(ue.Id),onPointerDown:()=>Wt(ue.Id),onPointerUp:Us,onPointerLeave:Us,children:[g.jsxs("div",{className:"lf-episode-card__thumbnail",children:[g.jsx("img",{src:ee.getImageUrl(ue,"Primary"),alt:ue.Name,loading:"lazy"}),ue.IndexNumber&&g.jsx("span",{className:"lf-episode-card__badge",children:ue.IndexNumber}),g.jsx("div",{className:"lf-episode-card__play-icon",children:g.jsx("span",{className:"material-icons",children:"play_arrow"})}),g.jsx("div",{className:"lf-episode-checkbox",children:g.jsx("span",{className:"material-icons",children:"check"})}),Xe&&!F&&g.jsx("div",{className:"lf-episode-checkbox",style:{opacity:1,background:"#4caf50",borderColor:"#4caf50"},children:g.jsx("span",{className:"material-icons",style:{opacity:1,transform:"scale(1)"},children:"check"})})]}),g.jsxs("div",{className:"lf-episode-card__info",children:[g.jsx("h3",{className:"lf-episode-card__title",children:ue.Name}),g.jsx("p",{className:"lf-episode-card__subtitle",children:ue.Overview})]})]},ue.Id)})})]}),g.jsx("hr",{className:"lf-section-divider"}),Nt.length>0&&g.jsxs("div",{className:"lf-content-section",children:[g.jsx("h2",{className:"lf-section-title",children:"Cast & Crew"}),g.jsx("div",{className:"lf-cast-grid",children:Nt.map(ue=>g.jsxs("div",{className:"lf-cast-card",children:[g.jsx("img",{src:ee.getImageUrl(ue,"Primary")||"https://via.placeholder.com/80x80?text=?",alt:ue.Name,className:"lf-cast-card__image",onError:Ne=>{Ne.target.src="https://via.placeholder.com/80x80?text=?"}}),g.jsx("div",{className:"lf-cast-card__name",children:ue.Name}),g.jsx("div",{className:"lf-cast-card__role",children:ue.Role})]},ue.Id||ue.Name))})]}),g.jsx("hr",{className:"lf-section-divider"}),f.length>0&&g.jsxs("div",{className:"lf-content-section",style:{marginBottom:40},children:[g.jsx("h2",{className:"lf-section-title",children:"More Like This"}),g.jsx("div",{className:"lf-similar-grid",children:f.map(ue=>g.jsxs(Vr,{to:`/series/${ue.Id}`,className:"lf-similar-card",children:[g.jsx("img",{className:"lf-similar-card__poster",src:ee.getImageUrl(ue,"Primary"),alt:ue.Name,loading:"lazy"}),g.jsx("div",{className:"lf-similar-card__title",children:ue.Name})]},ue.Id))})]}),g.jsx(fm,{isOpen:S,onClose:()=>E(!1),seriesId:t?t.Id:"",initialSeasonId:h,initialEpisodeId:l.length>0?l[0].Id:""}),Mt&&g.jsx("div",{className:"lf-blocked-modal-overlay",onClick:()=>{bt(!1),ms()},children:g.jsxs("div",{className:"lf-blocked-modal",onClick:ue=>ue.stopPropagation(),children:[g.jsx("button",{className:"lf-blocked-modal__close",onClick:()=>{bt(!1),ms()},children:g.jsx("span",{className:"material-icons",children:"close"})}),g.jsx("span",{className:"material-icons lf-blocked-icon",children:"error_outline"}),g.jsx("h3",{children:"Playback issue"}),g.jsx("p",{children:"The trailer can't play  your browser's tracking protection or ad blocker is likely blocking the YouTube embed."}),g.jsx("button",{className:"lf-btn lf-btn--glass",onClick:()=>{bt(!1),ms()},children:"Got it"})]})})]})},XL=()=>{const{id:i}=Eu(),e=Ps(),[t,s]=w.useState(null),[n,r]=w.useState([]),[l,c]=w.useState(!0),[h,u]=w.useState(!1),[f,p]=w.useState(!1),[v,x]=w.useState(localStorage.getItem("legitflix-audio-pref")||"en"),[S,E]=w.useState(localStorage.getItem("legitflix-sub-pref")||"en"),[T,A]=w.useState(!1),[I,_]=w.useState(!1),[C,k]=w.useState(!1),[U,O]=w.useState(!1),[F,j]=w.useState(!1),[M,H]=w.useState(!1),[K,te]=w.useState(null),[ae,me]=w.useState(!1),[D,G]=w.useState(!1);w.useRef(null);const Y=w.useRef(null),oe=w.useRef(null),pe=w.useRef(null),P=w.useRef(null);w.useEffect(()=>{(async()=>{c(!0);try{const Me=await ee.getCurrentUser();if(!Me)return;const Qe=await ee.getItemDetails(Me.Id,i);if(s(Qe),me(Qe.UserData?.IsFavorite||!1),G(Qe.UserData?.Played||!1),Qe.RemoteTrailers&&Qe.RemoteTrailers.length>0){const De=Qe.RemoteTrailers[0].Url.match(/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/);De&&De[1]&&te(De[1])}const ge=await ee.getSimilarItems(Me.Id,i);r(ge.Items||[])}catch(Me){console.error("Failed to load movie data",Me)}finally{c(!1)}})()},[i]),w.useEffect(()=>{const we=Me=>{Y.current&&!Y.current.contains(Me.target)&&A(!1)};return document.addEventListener("mousedown",we),()=>document.removeEventListener("mousedown",we)},[]);const V=(we,Me)=>{we==="audio"?(x(Me),localStorage.setItem("legitflix-audio-pref",Me)):(E(Me),localStorage.setItem("legitflix-sub-pref",Me)),A(!1)},se=async()=>{try{const we=await ee.getCurrentUser(),Me=!ae;await ee.markFavorite(we.Id,t.Id,Me),me(Me)}catch(we){console.error("Favorite toggle failed",we)}},he=async()=>{try{const we=await ee.getCurrentUser(),Me=!D;await ee.markPlayed(we.Id,t.Id,Me),G(Me),s(Qe=>({...Qe,UserData:{...Qe.UserData,Played:Me}}))}catch(we){console.error("Played toggle failed",we)}},ye=()=>{const we=!C;k(we);const Me=we?"mute":"unMute";P.current?.contentWindow?.postMessage(JSON.stringify({event:"command",func:Me,args:[]}),"*")},Ae=()=>{pe.current&&clearTimeout(pe.current),pe.current=setTimeout(()=>{I&&O(!0)},5e3)},Pe=()=>{O(!1),I&&Ae()},He=()=>{if(I){Be();return}_(!0),O(!1),Ae();let we=!1;const Me=Qe=>{typeof Qe.data=="string"&&(Qe.data.includes('"event"')||Qe.data.includes('"id"'))&&(we=!0,oe.current&&clearTimeout(oe.current))};window.addEventListener("message",Me),window.lfMessageHandler=Me,oe.current=setTimeout(()=>{!we&&I&&(console.log("Possible block detected: No YT API message received."),j(!0))},4e3)},Be=()=>{_(!1),O(!1),j(!1),H(!1),k(!1),pe.current&&clearTimeout(pe.current),oe.current&&clearTimeout(oe.current),window.lfMessageHandler&&(window.removeEventListener("message",window.lfMessageHandler),delete window.lfMessageHandler)};if(w.useEffect(()=>()=>{pe.current&&clearTimeout(pe.current),oe.current&&clearTimeout(oe.current),window.lfMessageHandler&&window.removeEventListener("message",window.lfMessageHandler)},[]),l)return g.jsx("div",{className:"lf-movie-container",style:{color:"white"},children:"Loading..."});if(!t)return g.jsx("div",{className:"lf-movie-container",style:{color:"white"},children:"Movie not found"});const ht=ee.getImageUrl(t,"Backdrop"),dt=ee.getImageUrl(t,"Primary"),Mt=ee.getImageUrl(t,"Logo"),bt=t.People?t.People.slice(0,10):[],Tt=[{code:"en",name:"English"},{code:"ja",name:"Japanese"}],os=[{code:"en",name:"English"},{code:"es",name:"Spanish"},{code:"hu",name:"Hungarian"}],Ve=we=>{if(!we)return"";const Me=Math.floor(we/6e8),Qe=Math.floor(Me/60),ge=Me%60;return Qe>0?`${Qe}h ${ge}m`:`${Me}m`};return g.jsxs("div",{className:"lf-movie-container",children:[g.jsx(va,{alwaysFilled:!0}),g.jsxs("section",{className:`lf-movie-hero ${U?"is-clean-view":""}`,onMouseMove:Pe,onClick:Pe,children:[g.jsx("div",{className:`lf-movie-hero__backdrop ${I?"is-hidden":""}`,style:{backgroundImage:`url('${ht}')`}}),g.jsxs("div",{className:`lf-movie-hero__trailer ${I?"is-playing":""}`,children:[I&&K&&g.jsx("iframe",{ref:P,src:`https://www.youtube.com/embed/${K}?autoplay=1&mute=0&loop=1&modestbranding=1&rel=0&iv_load_policy=3&fs=0&color=white&controls=0&disablekb=1&playlist=${K}&enablejsapi=1&origin=${window.location.origin}&widget_referrer=${window.location.origin}`,frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",referrerPolicy:"strict-origin-when-cross-origin",allowFullScreen:!0,title:"Trailer"}),I&&g.jsxs("button",{className:"lf-trailer-help-btn",onClick:we=>{we.stopPropagation(),H(!0)},children:[g.jsx("span",{className:"material-icons",children:"help_outline"}),g.jsx("span",{children:"Trouble playing?"})]})]}),Mt&&g.jsx("img",{className:"lf-movie-hero__logo",src:Mt,alt:t.Name}),g.jsxs("div",{className:"lf-movie-hero__content",children:[g.jsx("img",{className:"lf-movie-hero__poster",src:dt,alt:t.Name}),g.jsxs("div",{className:"lf-movie-hero__info",children:[g.jsx("h1",{className:"lf-movie-hero__title",children:t.Name}),g.jsxs("div",{className:"lf-movie-hero__meta",children:[g.jsx("span",{children:t.ProductionYear}),g.jsx("span",{children:""}),g.jsx("span",{children:t.OfficialRating}),g.jsx("span",{children:""}),g.jsx("span",{children:Ve(t.RunTimeTicks)}),g.jsx("span",{children:""}),g.jsxs("div",{className:"lf-movie-hero__rating",children:[g.jsx("span",{className:"material-icons",children:"star"}),g.jsx("span",{children:t.CommunityRating?t.CommunityRating.toFixed(1):""})]})]}),g.jsxs("div",{className:"lf-movie-hero__details",children:[g.jsxs("div",{className:"lf-movie-hero__description",children:[g.jsx("p",{className:`lf-movie-hero__description-text ${f?"is-expanded":""}`,children:t.Overview}),t.Overview&&t.Overview.length>200&&g.jsxs("button",{className:`lf-movie-hero__load-more ${f?"is-expanded":""}`,onClick:()=>p(!f),children:[f?"Show Less":"Read More",g.jsx("span",{className:"material-icons",children:"expand_more"})]})]}),bt.length>0&&g.jsxs("div",{className:"lf-movie-hero__cast-info",children:[g.jsxs("div",{style:{marginBottom:8},children:[g.jsx("strong",{children:"Starring: "}),bt.slice(0,3).map(we=>we.Name).join(", "),bt.length>3&&g.jsx("span",{children:"..."})]}),g.jsxs("div",{children:[g.jsx("strong",{children:"Genres: "}),t.Genres?t.Genres.join(", "):""]})]})]}),g.jsxs("div",{className:"lf-movie-hero__actions",children:[g.jsxs("button",{className:"lf-btn lf-btn--primary lf-btn--ring-hover",onClick:()=>e(`/play/${t.Id}`),children:[g.jsx("span",{className:"material-icons",children:"play_arrow"}),"Start Watching"]}),g.jsxs("button",{className:"lf-btn lf-btn--glass lf-btn--ring-hover-secondary",onClick:He,style:K?{}:{opacity:.5,pointerEvents:"none"},children:[g.jsx("span",{className:"material-icons",children:I?"stop_circle":"theaters"}),I?"Stop Trailer":"Watch Trailer"]}),I&&g.jsx("button",{className:`lf-btn lf-btn--glass lf-btn--icon-only ${C?"is-muted":""}`,onClick:ye,title:C?"Unmute":"Mute",children:g.jsx("span",{className:"material-icons",children:C?"volume_off":"volume_up"})}),g.jsx("button",{className:`lf-btn lf-btn--glass lf-btn--icon-only ${ae?"is-active":""}`,onClick:se,title:"Add to List",children:g.jsx("span",{className:"material-icons",children:ae?"bookmark":"bookmark_border"})}),g.jsx("button",{className:"lf-btn lf-btn--glass lf-btn--icon-only",onClick:()=>u(!0),title:"Edit Subtitles",children:g.jsx("span",{className:"material-icons",children:"subtitles"})})]})]})]})]}),g.jsx("hr",{className:"lf-section-divider"}),g.jsxs("div",{className:"lf-content-section",id:"lfDirectPlayer",children:[g.jsxs("div",{className:"lf-section-header",children:[g.jsx("h2",{className:"lf-section-title",children:t.Name}),g.jsxs("div",{className:"lf-filter-controls",children:[g.jsxs("div",{className:`lf-filter-dropdown ${T?"is-open":""}`,ref:Y,children:[g.jsxs("button",{className:"lf-filter-btn",onClick:()=>A(!T),title:"Audio & Subtitles",children:[g.jsx("span",{className:"material-icons",children:"subtitles"}),g.jsx("span",{children:"Audio & Subs"}),g.jsx("span",{className:"material-icons",children:"expand_more"})]}),g.jsxs("div",{className:"lf-filter-dropdown__menu lf-lang-menu",children:[g.jsxs("div",{className:"lf-lang-section",children:[g.jsx("div",{className:"lf-dropdown-section-title",children:"Audio"}),Tt.map(we=>g.jsxs("div",{className:`lf-filter-dropdown__option ${v===we.code?"is-selected":""}`,onClick:()=>V("audio",we.code),children:[g.jsx("span",{children:we.name}),v===we.code&&g.jsx("span",{className:"material-icons",children:"check"})]},we.code))]}),g.jsx("div",{className:"lf-lang-separator"}),g.jsxs("div",{className:"lf-lang-section",children:[g.jsx("div",{className:"lf-dropdown-section-title",children:"Subtitles"}),os.map(we=>g.jsxs("div",{className:`lf-filter-dropdown__option ${S===we.code?"is-selected":""}`,onClick:()=>V("sub",we.code),children:[g.jsx("span",{children:we.name}),S===we.code&&g.jsx("span",{className:"material-icons",children:"check"})]},we.code))]}),g.jsx("div",{className:"lf-lang-footer",children:g.jsxs("button",{className:"lf-edit-subs-btn",onClick:()=>{A(!1),u(!0)},children:[g.jsx("span",{className:"material-icons",children:"edit"}),g.jsx("span",{children:"Edit Subtitles"})]})})]})]}),g.jsxs("button",{className:"lf-filter-btn",onClick:he,title:D?"Mark as Unwatched":"Mark as Watched",children:[g.jsx("span",{className:"material-icons",children:D?"visibility_off":"visibility"}),g.jsx("span",{children:D?"Mark Unwatched":"Mark Watched"})]})]})]}),g.jsx("div",{className:"lf-movie-player-main",children:g.jsxs("div",{className:"lf-movie-player-placeholder",children:[g.jsx("span",{className:"material-icons",style:{fontSize:"64px",opacity:.5},children:"play_circle_outline"}),g.jsx("p",{style:{marginTop:"10px",fontWeight:500},children:"Click 'Start Watching' to play movie"})]})})]}),g.jsx("hr",{className:"lf-section-divider"}),bt.length>0&&g.jsxs("div",{className:"lf-content-section",children:[g.jsx("h2",{className:"lf-section-title",children:"Cast & Crew"}),g.jsx("div",{className:"lf-cast-grid",children:bt.map(we=>g.jsxs("div",{className:"lf-cast-card",children:[g.jsx("img",{src:ee.getImageUrl(we,"Primary")||"https://via.placeholder.com/80x80?text=?",alt:we.Name,className:"lf-cast-card__image",onError:Me=>{Me.target.src="https://via.placeholder.com/80x80?text=?"}}),g.jsx("div",{className:"lf-cast-card__name",children:we.Name}),g.jsx("div",{className:"lf-cast-card__role",children:we.Role})]},we.Id||we.Name))})]}),g.jsx("hr",{className:"lf-section-divider"}),n.length>0&&g.jsxs("div",{className:"lf-content-section",style:{marginBottom:40},children:[g.jsx("h2",{className:"lf-section-title",children:"More Like This"}),g.jsx("div",{className:"lf-similar-grid",children:n.map(we=>g.jsxs(Vr,{to:`/movie/${we.Id}`,className:"lf-similar-card",children:[g.jsx("img",{className:"lf-similar-card__poster",src:ee.getImageUrl(we,"Primary"),alt:we.Name,loading:"lazy"}),g.jsx("div",{className:"lf-similar-card__title",children:we.Name})]},we.Id))})]}),g.jsx(fm,{isOpen:h,onClose:()=>u(!1),seriesId:t?t.Id:"",initialSeasonId:null,initialEpisodeId:t?t.Id:"",isMovie:!0}),M&&g.jsx("div",{className:"lf-blocked-modal-overlay",children:g.jsxs("div",{className:"lf-blocked-modal",children:[g.jsx("span",{className:"material-icons lf-blocked-icon",children:"block"}),g.jsx("h3",{children:"Content blocked by browser"}),g.jsx("p",{children:"The trailer cannot be played because your browser blocked it. This usually happens due to tracking protection or ad blockers affecting the YouTube player."}),g.jsx("button",{className:"lf-btn lf-btn--primary",onClick:()=>{H(!1),Be()},children:"Close"})]})})]})},ZL=[{id:"details",label:"My details"},{id:"display",label:"Display"},{id:"home",label:"Home Screen"},{id:"playback",label:"Playback"},{id:"subtitles",label:"Subtitles"},{id:"quickconnect",label:"Quick Connect"},{id:"advanced",label:"Advanced"}],JL=()=>{Ps();const[i,e]=w.useState(null),[t,s]=w.useState("details"),[n,r]=w.useState(""),[l,c]=w.useState(!1),[h,u]=w.useState(!1),[f,p]=w.useState(!1),[v,x]=w.useState(""),[S,E]=w.useState(""),[T,A]=w.useState(""),[I,_]=w.useState(null),[C,k]=w.useState(!1),[U,O]=w.useState("en-US"),[F,j]=w.useState("default"),[M,H]=w.useState(""),[K,te]=w.useState(""),[ae,me]=w.useState("Default"),[D,G]=w.useState(""),[Y,oe]=w.useState("Default"),[pe,P]=w.useState(""),[V,se]=w.useState(null),[he,ye]=w.useState([{id:"resume",label:"Continue Watching",enabled:!0},{id:"latestMedia",label:"Latest Media",enabled:!0},{id:"nextUp",label:"Next Up",enabled:!0},{id:"favorites",label:"My Favorites",enabled:!0}]);w.useEffect(()=>{(async()=>{const De=await ee.getCurrentUser();if(De){e(De);const at=De.Configuration||{};at.AudioLanguagePreference&&H(at.AudioLanguagePreference),at.SubtitleLanguagePreference&&G(at.SubtitleLanguagePreference),at.SubtitleMode&&oe(at.SubtitleMode);const st=localStorage.getItem(`LegitFlix_Banner_${De.Id}`);st?r(st):De.ImageTags&&De.ImageTags.Banner?r(`${ee.api.basePath}/Users/${De.Id}/Images/Banner?tag=${De.ImageTags.Banner}&quality=90`):De.BackdropImageTags&&De.BackdropImageTags.length>0&&r(`${ee.api.basePath}/Users/${De.Id}/Images/Backdrop/0?tag=${De.BackdropImageTags[0]}&quality=90`)}})()},[]);const Ae=_e=>{i&&(localStorage.setItem(`LegitFlix_Banner_${i.Id}`,_e),r(_e))},Pe=async _e=>{if(!(!_e||!i))try{await ee.uploadUserImage(i.Id,"Primary",_e),e(at=>({...at,PrimaryImageTag:Date.now().toString()}));const De=await ee.getCurrentUser();De&&e(De),u(!1)}catch(De){console.error("Failed to upload avatar",De)}},He=async _e=>{if(_e.preventDefault(),_(null),S!==T){_({type:"error",text:"New passwords do not match."});return}if(!S){_({type:"error",text:"New password cannot be empty."});return}k(!0);try{await ee.updatePassword(i.Id,v,S),_({type:"success",text:"Password updated successfully!"}),x(""),E(""),A("")}catch(De){_({type:"error",text:De.message||"Failed to update password."})}finally{k(!1)}},Be=async()=>{if(se(null),!pe.trim()){se({type:"error",text:"Please enter a code."});return}try{await ee.quickConnect(pe.trim()),se({type:"success",text:"Device authorized successfully!"}),P("")}catch(_e){se({type:"error",text:_e.message||"Authorization failed."})}},ht=_e=>{ye(De=>De.map(at=>at.id===_e?{...at,enabled:!at.enabled}:at))},dt=async()=>{await ee.logout()};if(!i)return g.jsxs("div",{className:"profile-page",children:[g.jsx(va,{}),g.jsxs("div",{className:"settings-container",children:[g.jsx(ze,{type:"text",width:"200px",height:"32px",style:{marginBottom:"20px"}}),g.jsx("div",{className:"settings-tabs",children:[1,2,3,4,5,6].map(_e=>g.jsx(ze,{width:"100px",height:"40px",style:{display:"inline-block",marginRight:"8px",borderRadius:"20px"}},_e))}),g.jsx(ze,{width:"100%",height:"250px",style:{margin:"20px 0",borderRadius:"12px"}}),g.jsx("div",{style:{display:"flex",gap:"20px",marginTop:"-55px",paddingLeft:"30px",position:"relative",marginBottom:"28px"},children:g.jsx(ze,{type:"circle",width:"110px",height:"110px",style:{border:"4px solid #0e0e0e"}})}),g.jsxs("div",{className:"settings-card",style:{padding:"28px",border:"1px solid rgba(255,255,255,0.05)",borderRadius:"14px"},children:[g.jsx(ze,{width:"180px",height:"24px",style:{marginBottom:"24px"}}),g.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(180px, 1fr))",gap:"18px"},children:[1,2,3,4].map(_e=>g.jsxs("div",{children:[g.jsx(ze,{width:"80px",height:"14px",style:{marginBottom:"8px"}}),g.jsx(ze,{width:"140px",height:"20px"})]},_e))})]})]})]});const Mt=i.PrimaryImageTag?`${ee.api.basePath}/Users/${i.Id}/Images/Primary?tag=${i.PrimaryImageTag}&quality=90`:null,bt=()=>g.jsxs(g.Fragment,{children:[g.jsxs("div",{className:"settings-card",children:[g.jsx("h3",{className:"settings-card-title",children:"User Information"}),g.jsxs("div",{className:"info-grid",children:[g.jsxs("div",{className:"info-item",children:[g.jsx("label",{children:"Username"}),g.jsx("div",{className:"info-value",children:i.Name})]}),g.jsxs("div",{className:"info-item",children:[g.jsx("label",{children:"Last Login"}),g.jsx("div",{className:"info-value",children:i.LastLoginDate?new Date(i.LastLoginDate).toLocaleDateString():""})]}),g.jsxs("div",{className:"info-item",children:[g.jsx("label",{children:"Administrator"}),g.jsx("div",{className:"info-value",children:i.Policy?.IsAdministrator?"Yes":"No"})]}),g.jsxs("div",{className:"info-item",children:[g.jsx("label",{children:"User ID"}),g.jsx("div",{className:"info-value info-value-small",children:i.Id})]})]})]}),g.jsxs("div",{className:"settings-card",children:[g.jsx("h3",{className:"settings-card-title",children:"Change Password"}),g.jsxs("form",{className:"password-form",onSubmit:He,children:[g.jsxs("div",{className:"form-group",children:[g.jsx("label",{children:"Current Password"}),g.jsx("input",{type:"password",value:v,onChange:_e=>x(_e.target.value),className:"settings-input",autoComplete:"current-password"})]}),g.jsxs("div",{className:"form-group",children:[g.jsx("label",{children:"New Password"}),g.jsx("input",{type:"password",value:S,onChange:_e=>E(_e.target.value),className:"settings-input",autoComplete:"new-password"})]}),g.jsxs("div",{className:"form-group",children:[g.jsx("label",{children:"Confirm New Password"}),g.jsx("input",{type:"password",value:T,onChange:_e=>A(_e.target.value),className:"settings-input",autoComplete:"new-password"})]}),I&&g.jsxs("div",{className:`form-message ${I.type}`,children:[g.jsx("span",{className:"material-icons",children:I.type==="success"?"check_circle":"error"}),I.text]}),g.jsx("button",{type:"submit",className:"btn-accent",disabled:C,children:C?"SAVING...":"SAVE PASSWORD"})]})]})]}),Tt=()=>g.jsxs("div",{className:"settings-card",children:[g.jsx("h3",{className:"settings-card-title",children:"Display Preferences"}),g.jsxs("div",{className:"form-group",children:[g.jsx("label",{children:"Display Language"}),g.jsxs("select",{className:"settings-select",value:U,onChange:_e=>O(_e.target.value),children:[g.jsx("option",{value:"en-US",children:"English (United States)"}),g.jsx("option",{value:"hu",children:"Magyar (Hungarian)"}),g.jsx("option",{value:"de",children:"Deutsch (German)"}),g.jsx("option",{value:"fr",children:"Franais (French)"}),g.jsx("option",{value:"es",children:"Espaol (Spanish)"}),g.jsx("option",{value:"ja",children:" (Japanese)"})]})]}),g.jsxs("div",{className:"form-group",children:[g.jsx("label",{children:"Date Format"}),g.jsxs("select",{className:"settings-select",value:F,onChange:_e=>j(_e.target.value),children:[g.jsx("option",{value:"default",children:"Use browser default"}),g.jsx("option",{value:"yyyy-MM-dd",children:"YYYY-MM-DD"}),g.jsx("option",{value:"dd/MM/yyyy",children:"DD/MM/YYYY"}),g.jsx("option",{value:"MM/dd/yyyy",children:"MM/DD/YYYY"})]})]}),g.jsxs("div",{className:"setting-row",children:[g.jsxs("div",{className:"setting-row-label",children:[g.jsx("span",{children:"Enable LegitFlix Theme"}),g.jsx("span",{className:"setting-hint",children:"Use the custom gaming profile theme"})]}),g.jsxs("label",{className:"toggle-switch",children:[g.jsx("input",{type:"checkbox",defaultChecked:!0}),g.jsx("span",{className:"slider"})]})]})]}),os=()=>g.jsxs("div",{className:"settings-card",children:[g.jsx("h3",{className:"settings-card-title",children:"Home Screen Sections"}),g.jsx("p",{className:"settings-description",children:"Choose which sections to display on your home screen."}),he.map(_e=>g.jsxs("div",{className:"setting-row",children:[g.jsx("div",{className:"setting-row-label",children:g.jsx("span",{children:_e.label})}),g.jsxs("label",{className:"toggle-switch",children:[g.jsx("input",{type:"checkbox",checked:_e.enabled,onChange:()=>ht(_e.id)}),g.jsx("span",{className:"slider"})]})]},_e.id))]}),Ve=()=>g.jsxs("div",{className:"settings-card",children:[g.jsx("h3",{className:"settings-card-title",children:"Playback Settings"}),g.jsxs("div",{className:"form-group",children:[g.jsx("label",{children:"Preferred Audio Language"}),g.jsxs("select",{className:"settings-select",value:M,onChange:_e=>H(_e.target.value),children:[g.jsx("option",{value:"",children:"Auto / Server Default"}),g.jsx("option",{value:"eng",children:"English"}),g.jsx("option",{value:"hun",children:"Hungarian"}),g.jsx("option",{value:"jpn",children:"Japanese"}),g.jsx("option",{value:"ger",children:"German"}),g.jsx("option",{value:"fre",children:"French"}),g.jsx("option",{value:"spa",children:"Spanish"})]})]}),g.jsxs("div",{className:"form-group",children:[g.jsx("label",{children:"Max Streaming Bitrate"}),g.jsxs("select",{className:"settings-select",value:K,onChange:_e=>te(_e.target.value),children:[g.jsx("option",{value:"",children:"Auto"}),g.jsx("option",{value:"120000000",children:"120 Mbps (4K)"}),g.jsx("option",{value:"80000000",children:"80 Mbps"}),g.jsx("option",{value:"60000000",children:"60 Mbps"}),g.jsx("option",{value:"40000000",children:"40 Mbps"}),g.jsx("option",{value:"20000000",children:"20 Mbps (1080p)"}),g.jsx("option",{value:"8000000",children:"8 Mbps (720p)"}),g.jsx("option",{value:"4000000",children:"4 Mbps"}),g.jsx("option",{value:"2000000",children:"2 Mbps"})]})]}),g.jsxs("div",{className:"setting-row",children:[g.jsxs("div",{className:"setting-row-label",children:[g.jsx("span",{children:"Prefer fMP4-HLS Container"}),g.jsx("span",{className:"setting-hint",children:"Uses fMP4 container for HLS playback when available"})]}),g.jsxs("label",{className:"toggle-switch",children:[g.jsx("input",{type:"checkbox",defaultChecked:!1}),g.jsx("span",{className:"slider"})]})]}),g.jsxs("div",{className:"setting-row",children:[g.jsxs("div",{className:"setting-row-label",children:[g.jsx("span",{children:"Enable Cinema Mode"}),g.jsx("span",{className:"setting-hint",children:"Play trailers and custom intros before the main feature"})]}),g.jsxs("label",{className:"toggle-switch",children:[g.jsx("input",{type:"checkbox",defaultChecked:!0}),g.jsx("span",{className:"slider"})]})]})]}),we=()=>g.jsxs("div",{className:"settings-card",children:[g.jsx("h3",{className:"settings-card-title",children:"Subtitle Preferences"}),g.jsxs("div",{className:"form-group",children:[g.jsx("label",{children:"Preferred Subtitle Language"}),g.jsxs("select",{className:"settings-select",value:D,onChange:_e=>G(_e.target.value),children:[g.jsx("option",{value:"",children:"None"}),g.jsx("option",{value:"eng",children:"English"}),g.jsx("option",{value:"hun",children:"Hungarian"}),g.jsx("option",{value:"jpn",children:"Japanese"}),g.jsx("option",{value:"ger",children:"German"}),g.jsx("option",{value:"fre",children:"French"}),g.jsx("option",{value:"spa",children:"Spanish"})]})]}),g.jsxs("div",{className:"form-group",children:[g.jsx("label",{children:"Subtitle Mode"}),g.jsxs("select",{className:"settings-select",value:Y,onChange:_e=>oe(_e.target.value),children:[g.jsx("option",{value:"Default",children:"Default"}),g.jsx("option",{value:"Always",children:"Always Show"}),g.jsx("option",{value:"OnlyForced",children:"Only Forced"}),g.jsx("option",{value:"None",children:"None"}),g.jsx("option",{value:"Smart",children:"Smart (match audio)"})]})]}),g.jsxs("div",{className:"setting-row",children:[g.jsxs("div",{className:"setting-row-label",children:[g.jsx("span",{children:"Burn in Subtitles"}),g.jsx("span",{className:"setting-hint",children:"Permanently render subtitles into the video stream"})]}),g.jsxs("label",{className:"toggle-switch",children:[g.jsx("input",{type:"checkbox",defaultChecked:!1}),g.jsx("span",{className:"slider"})]})]})]}),Me=()=>g.jsxs("div",{className:"settings-card",children:[g.jsx("h3",{className:"settings-card-title",children:"Quick Connect"}),g.jsx("p",{className:"settings-description",children:"Enter the code displayed on your device to authorize it with your account."}),g.jsxs("div",{className:"qc-row",children:[g.jsx("input",{type:"text",className:"settings-input qc-input",placeholder:"Enter code",value:pe,onChange:_e=>P(_e.target.value),maxLength:10}),g.jsx("button",{className:"btn-accent",onClick:Be,children:"AUTHORIZE"})]}),V&&g.jsxs("div",{className:`form-message ${V.type}`,style:{marginTop:"12px"},children:[g.jsx("span",{className:"material-icons",children:V.type==="success"?"check_circle":"error"}),V.text]})]}),Qe=()=>g.jsxs("div",{className:"settings-card",children:[g.jsx("h3",{className:"settings-card-title",children:"Advanced"}),i.Policy?.IsAdministrator&&g.jsxs("button",{className:"btn-link-row",onClick:()=>window.location.href="/web/index.html#!/dashboard",children:[g.jsx("span",{className:"material-icons",children:"dashboard"}),g.jsxs("div",{children:[g.jsx("span",{children:"Server Dashboard"}),g.jsx("span",{className:"setting-hint",children:"Manage server settings, users, and libraries"})]}),g.jsx("span",{className:"material-icons link-arrow",children:"chevron_right"})]}),g.jsxs("button",{className:"btn-link-row",onClick:()=>window.location.href="/web/index.html#!/playback/profile",children:[g.jsx("span",{className:"material-icons",children:"tune"}),g.jsxs("div",{children:[g.jsx("span",{children:"Playback Profiles"}),g.jsx("span",{className:"setting-hint",children:"Configure device playback profiles"})]}),g.jsx("span",{className:"material-icons link-arrow",children:"chevron_right"})]}),g.jsxs("button",{className:"btn-link-row",onClick:()=>window.location.href="/web/index.html#!/networking",children:[g.jsx("span",{className:"material-icons",children:"lan"}),g.jsxs("div",{children:[g.jsx("span",{children:"Networking"}),g.jsx("span",{className:"setting-hint",children:"Server networking and remote access settings"})]}),g.jsx("span",{className:"material-icons link-arrow",children:"chevron_right"})]}),g.jsxs("button",{className:"btn-link-row",onClick:()=>window.location.href="/web/index.html#!/mypreferencesmenu",children:[g.jsx("span",{className:"material-icons",children:"settings_applications"}),g.jsxs("div",{children:[g.jsx("span",{children:"Classic User Settings"}),g.jsx("span",{className:"setting-hint",children:"Open the default Jellyfin user preferences"})]}),g.jsx("span",{className:"material-icons link-arrow",children:"chevron_right"})]}),i.Policy?.IsAdministrator&&g.jsxs("button",{className:"btn-link-row",onClick:()=>window.location.href="/web/index.html#!/plugins",children:[g.jsx("span",{className:"material-icons",children:"extension"}),g.jsxs("div",{children:[g.jsx("span",{children:"Plugins"}),g.jsx("span",{className:"setting-hint",children:"Manage installed plugins"})]}),g.jsx("span",{className:"material-icons link-arrow",children:"chevron_right"})]}),g.jsx("div",{className:"dropdown-divider",style:{margin:"16px 0",borderColor:"rgba(255,255,255,0.05)"}}),g.jsxs("button",{className:"btn-link-row",onClick:()=>p(!0),children:[g.jsx("span",{className:"material-icons",children:"palette"}),g.jsxs("div",{children:[g.jsx("span",{children:"LegitFlix Settings"}),g.jsx("span",{className:"setting-hint",children:"Customize theme colors and logo"})]}),g.jsx("span",{className:"material-icons link-arrow",children:"chevron_right"})]})]}),ge=()=>{switch(t){case"details":return bt();case"display":return Tt();case"home":return os();case"playback":return Ve();case"subtitles":return we();case"quickconnect":return Me();case"advanced":return Qe();default:return null}};return g.jsxs("div",{className:"profile-page",children:[g.jsx(va,{}),g.jsxs("div",{className:"settings-container",children:[g.jsx("h1",{className:"settings-page-title",children:"Account Settings"}),g.jsxs("div",{className:"settings-tabs",children:[ZL.map(_e=>g.jsx("button",{className:`settings-tab ${t===_e.id?"active":""}`,onClick:()=>s(_e.id),children:_e.label},_e.id)),g.jsx("button",{className:"settings-tab settings-tab-logout",onClick:dt,title:"Sign Out",children:g.jsx("span",{className:"material-icons",children:"exit_to_app"})})]}),g.jsxs("div",{className:`settings-banner ${n?"has-banner":""}`,style:n?{backgroundImage:`url('${n}')`}:{},children:[g.jsx("div",{className:"banner-overlay"}),g.jsxs("div",{className:"banner-edit-btn",onClick:()=>c(!0),children:[g.jsx("span",{className:"material-icons-outlined",children:n?"edit":"add_photo_alternate"}),g.jsx("span",{children:n?"Change profile banner":"Add profile banner"})]})]}),g.jsxs("div",{className:"settings-avatar-wrap",children:[g.jsx("div",{className:"settings-avatar",style:Mt?{backgroundImage:`url('${Mt}')`}:{},children:!Mt&&g.jsx("span",{className:"material-icons avatar-placeholder",children:"person"})}),g.jsx("div",{className:"avatar-edit-badge",title:"Change avatar",onClick:()=>u(!0),children:g.jsx("span",{className:"material-icons",children:"edit"})})]}),g.jsx("div",{className:"settings-content",children:ge()})]}),g.jsx(hm,{isOpen:l,onClose:()=>c(!1),onSave:Ae,userId:i?.Id}),g.jsx(bS,{isOpen:f,onClose:()=>p(!1),userId:i?.Id}),g.jsx(Cu,{isOpen:h,onClose:()=>u(!1),onSave:Pe,userId:i?.Id})]})},e1=()=>{const i=Ps(),{config:e}=Hi(),[t,s]=w.useState(window.location.origin),[n,r]=w.useState(!1),[l,c]=w.useState(""),h=async u=>{u.preventDefault(),r(!0),c("");try{const f=await ee.validateServer(t);f&&f.valid?(ee.initialize(null,f.baseUrl),i("/login/select-user")):c("Could not connect to server. Please check the URL.")}catch(f){console.error("Validation error",f),c("An error occurred while connecting.")}finally{r(!1)}};return g.jsx("div",{className:"auth-page",children:g.jsxs("div",{className:"auth-container",children:[g.jsxs("div",{className:"auth-logo",children:[e.logoUrl?g.jsx("img",{src:e.logoUrl,alt:"LegitFlix",className:"auth-logo-img"}):g.jsx("img",{src:ao(e.accentColor),alt:"LegitFlix",className:"auth-logo-img"}),g.jsx("p",{children:"Connect to Server"})]}),g.jsxs("form",{onSubmit:h,className:"auth-form",children:[g.jsxs("div",{className:"form-group",children:[g.jsx("label",{children:"Server URL"}),g.jsx("input",{type:"text",className:"auth-input",value:t,onChange:u=>s(u.target.value),placeholder:"http://myserver:8096"})]}),l&&g.jsx("div",{className:"auth-error",children:l}),g.jsx(gi,{type:"submit",variant:"ringHover",size:"lg",disabled:n,className:"w-full",children:n?"Connecting...":"Connect"})]})]})})},t1=()=>{const i=Ps(),{config:e}=Hi(),[t,s]=w.useState([]),[n,r]=w.useState(!0);w.useEffect(()=>{(async()=>{try{const f=await ee.getPublicUsers();f&&s(f)}catch(f){console.error("Failed to load users",f)}finally{r(!1)}})()},[]);const l=u=>{i("/login",{state:{username:u.Name,userId:u.Id}})},c=()=>{i("/login")},h=()=>{i("/login/select-server")};return g.jsx("div",{className:"auth-page",children:g.jsxs("div",{className:"auth-container",children:[g.jsxs("div",{className:"auth-logo",children:[e.logoUrl?g.jsx("img",{src:e.logoUrl,alt:"LegitFlix",className:"auth-logo-img"}):g.jsx("img",{src:ao(e.accentColor),alt:"LegitFlix",className:"auth-logo-img"}),g.jsx("p",{children:"Who's watching?"})]}),n?g.jsx("div",{className:"user-grid",children:[1,2,3].map(u=>g.jsxs("div",{className:"user-card",style:{cursor:"default"},children:[g.jsx("div",{className:"user-avatar-container",style:{border:"none",padding:0},children:g.jsx(ze,{type:"circle",width:"100px",height:"100px"})}),g.jsx(ze,{type:"text",width:"80px",height:"20px",style:{marginTop:"10px"}})]},u))}):g.jsxs(g.Fragment,{children:[g.jsx("div",{className:"user-grid",children:t.map(u=>g.jsxs("button",{className:"user-card",onClick:()=>l(u),children:[g.jsxs("div",{className:"user-avatar-container",children:[g.jsx("div",{className:"auth-avatar-wrapper",children:g.jsx("img",{src:`${ee.api.basePath||""}/Users/${u.Id}/Images/Primary?quality=90`,alt:u.Name,className:"auth-avatar",onError:f=>{f.target.style.display="none",f.target.parentElement.nextSibling.style.display="flex"}})}),g.jsx("div",{className:"user-avatar-placeholder",style:{display:"none"},children:g.jsx("span",{className:"material-icons",children:"person"})})]}),g.jsx("span",{className:"user-card-name",children:u.Name})]},u.Id))}),g.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"10px",alignItems:"center"},children:[g.jsx("button",{className:"text-link",onClick:c,children:"Manual Login"}),g.jsx("button",{className:"text-link",style:{fontSize:"0.8rem",opacity:.7},onClick:h,children:"Switch Server"})]})]})]})})},s1=()=>{const i=Ps(),e=Un(),{config:t}=Hi(),s=e.state?.username||"",[n,r]=w.useState(s),[l,c]=w.useState(""),[h,u]=w.useState(!1),[f,p]=w.useState(""),[v,x]=w.useState(!1),[S,E]=w.useState(""),[T,A]=w.useState("");w.useEffect(()=>{let _;return v?(async()=>{try{u(!0);const k=await ee.initiateQuickConnect();E(k.Code),A(k.Secret),u(!1),_=setInterval(async()=>{if(k.Secret)try{await ee.checkQuickConnectStatus(k.Secret)&&(clearInterval(_),i("/"))}catch(U){console.warn("Polling error",U)}},2e3)}catch(k){console.error("Quick Connect Init Failed",k),p("Failed to initialize Quick Connect."),u(!1)}})():(E(""),A(""),_&&clearInterval(_)),()=>{_&&clearInterval(_)}},[v,i]);const I=async _=>{_.preventDefault(),u(!0),p("");try{await ee.authenticateUser(n,l),await ee.getCurrentUser()?i("/"):p("Login succeeded but failed to retrieve user session.")}catch(C){console.error("Login error",C),p("Invalid username or password.")}finally{u(!1)}};return g.jsx("div",{className:"auth-page",children:g.jsxs("div",{className:"auth-container",children:[g.jsxs("div",{className:"auth-logo",children:[t.logoUrl?g.jsx("img",{src:t.logoUrl,alt:"LegitFlix",className:"auth-logo-img"}):g.jsx("img",{src:ao(t.accentColor),alt:"LegitFlix",className:"auth-logo-img"}),g.jsx("p",{children:v?"Quick Connect":"Sign In"})]}),v?g.jsxs("div",{className:"qc-container",children:[h?g.jsx("div",{className:"qc-spinner"}):g.jsxs(g.Fragment,{children:[g.jsx("div",{className:"qc-instructions",children:"Use your mobile device to scan the code or enter it manually."}),g.jsx("div",{className:"qc-code-display",children:S}),g.jsx("div",{className:"qc-instructions",children:"Waiting for authorization..."}),g.jsx("div",{className:"qc-spinner"})]}),g.jsx("button",{type:"button",className:"text-link",onClick:()=>x(!1),children:"Cancel"})]}):g.jsxs("form",{onSubmit:I,className:"auth-form",children:[g.jsxs("div",{className:"form-group",children:[g.jsx("label",{children:"Username"}),g.jsx("input",{type:"text",className:"auth-input",value:n,onChange:_=>r(_.target.value),placeholder:"Enter username"})]}),g.jsxs("div",{className:"form-group",children:[g.jsx("label",{children:"Password"}),g.jsx("input",{type:"password",className:"auth-input",value:l,onChange:_=>c(_.target.value),placeholder:"Enter password"})]}),f&&g.jsx("div",{className:"auth-error",children:f}),g.jsxs("div",{className:"auth-btn-group",children:[g.jsx(gi,{type:"submit",variant:"ringHover",size:"lg",disabled:h,className:"w-full",children:h?"Signing in...":"Sign In"}),g.jsx(gi,{type:"button",variant:"outline",size:"lg",onClick:()=>x(!0),className:"w-full",children:"Quick Connect"})]}),g.jsx("button",{type:"button",className:"text-link",onClick:()=>i("/login/select-user"),children:"Back to Users"})]})]})})},i1=()=>{const[i,e]=w.useState(null);return w.useEffect(()=>{(async()=>{try{const s=await ee.getCurrentUser();e(!!s)}catch(s){console.error("Auth check failed",s),e(!1)}})()},[]),i===null?g.jsx("div",{style:{padding:"20px"},children:g.jsx(ze,{width:"100%",height:"100vh"})}):i?g.jsx(hI,{}):g.jsx(dI,{to:"/login/select-user",replace:!0})},n1=()=>{const i=Ps();return w.useEffect(()=>{const e=window.location.hash;if(e.startsWith("#!/")){if(e==="#!/"||e==="#!/home"||e==="#!/home.html")return;if(console.log("[LegitFlix] Intercepted legacy hash:",e),e.includes("details?id=")){const r=new URLSearchParams(e.split("?")[1]).get("id");if(r){i(`/item/${r}`);return}}if(["mypreferencesmenu","user","settings"].some(n=>e.includes(n))){console.log("[LegitFlix] Redirecting settings hash to /profile:",e),i("/profile");return}if(e.includes("selectserver.html")||e.includes("login.html")){console.log("[LegitFlix] Redirecting auth hash to /login/select-user:",e),i("/login/select-user");return}if(["dashboard","plugins","wizard","scheduledtasks","server","networking","devices","api","logs","notifications","librarydisplay","playback","transcoding","live-tv","dlna","intro-s","activity","itemdetails","edititem"].some(n=>e.includes(n))){console.log("[LegitFlix] Redirecting to Classic Mode for:",e),window.location.replace(`/web/index.html?classic=true${e}`);return}}},[i]),null},a1=()=>{const{id:i}=Eu(),e=Ps(),[t,s]=w.useState(null);return w.useEffect(()=>{i&&(async()=>{try{const r=await ee.getCurrentUser();if(!r)return;const l=await ee.getItem(r.Id,i);if(!l){s("Item not found");return}switch(console.log("[LegitFlix] Resolved item type:",l.Type),l.Type){case"Series":e(`/series/${l.Id}`,{replace:!0});break;case"Movie":e(`/movie/${l.Id}`,{replace:!0});break;case"Season":case"Episode":l.SeriesId?e(`/series/${l.SeriesId}`,{replace:!0}):window.location.href=`/web/index.html?classic=true#!/details?id=${l.Id}`;break;default:console.log("[LegitFlix] Unsupported item type, falling back to classic:",l.Type),window.location.href=`/web/index.html?classic=true#!/details?id=${l.Id}`;break}}catch(r){console.error("Failed to resolve item:",r),s("Failed to resolve item link."),setTimeout(()=>{window.location.href=`/web/index.html?classic=true#!/details?id=${i}`},2e3)}})()},[i,e]),g.jsxs("div",{style:{minHeight:"100vh",background:"#000",color:"#fff",display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column"},children:[g.jsx(va,{}),t&&g.jsxs("div",{style:{marginTop:100},children:[g.jsx("h2",{children:t}),g.jsx("p",{children:"Redirecting to classic view..."})]})]})},Oe=Number.isFinite||function(i){return typeof i=="number"&&isFinite(i)},r1=Number.isSafeInteger||function(i){return typeof i=="number"&&Math.abs(i)<=l1},l1=Number.MAX_SAFE_INTEGER||9007199254740991;let Fe=(function(i){return i.NETWORK_ERROR="networkError",i.MEDIA_ERROR="mediaError",i.KEY_SYSTEM_ERROR="keySystemError",i.MUX_ERROR="muxError",i.OTHER_ERROR="otherError",i})({}),Q=(function(i){return i.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",i.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",i.KEY_SYSTEM_NO_SESSION="keySystemNoSession",i.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",i.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",i.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",i.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",i.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",i.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",i.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",i.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",i.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",i.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",i.MANIFEST_LOAD_ERROR="manifestLoadError",i.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",i.MANIFEST_PARSING_ERROR="manifestParsingError",i.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",i.LEVEL_EMPTY_ERROR="levelEmptyError",i.LEVEL_LOAD_ERROR="levelLoadError",i.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",i.LEVEL_PARSING_ERROR="levelParsingError",i.LEVEL_SWITCH_ERROR="levelSwitchError",i.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",i.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",i.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",i.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",i.FRAG_LOAD_ERROR="fragLoadError",i.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",i.FRAG_DECRYPT_ERROR="fragDecryptError",i.FRAG_PARSING_ERROR="fragParsingError",i.FRAG_GAP="fragGap",i.REMUX_ALLOC_ERROR="remuxAllocError",i.KEY_LOAD_ERROR="keyLoadError",i.KEY_LOAD_TIMEOUT="keyLoadTimeOut",i.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",i.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",i.BUFFER_APPEND_ERROR="bufferAppendError",i.BUFFER_APPENDING_ERROR="bufferAppendingError",i.BUFFER_STALLED_ERROR="bufferStalledError",i.BUFFER_FULL_ERROR="bufferFullError",i.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",i.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",i.ASSET_LIST_LOAD_ERROR="assetListLoadError",i.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",i.ASSET_LIST_PARSING_ERROR="assetListParsingError",i.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",i.INTERNAL_EXCEPTION="internalException",i.INTERNAL_ABORTED="aborted",i.ATTACH_MEDIA_ERROR="attachMediaError",i.UNKNOWN="unknown",i})({}),L=(function(i){return i.MEDIA_ATTACHING="hlsMediaAttaching",i.MEDIA_ATTACHED="hlsMediaAttached",i.MEDIA_DETACHING="hlsMediaDetaching",i.MEDIA_DETACHED="hlsMediaDetached",i.MEDIA_ENDED="hlsMediaEnded",i.STALL_RESOLVED="hlsStallResolved",i.BUFFER_RESET="hlsBufferReset",i.BUFFER_CODECS="hlsBufferCodecs",i.BUFFER_CREATED="hlsBufferCreated",i.BUFFER_APPENDING="hlsBufferAppending",i.BUFFER_APPENDED="hlsBufferAppended",i.BUFFER_EOS="hlsBufferEos",i.BUFFERED_TO_END="hlsBufferedToEnd",i.BUFFER_FLUSHING="hlsBufferFlushing",i.BUFFER_FLUSHED="hlsBufferFlushed",i.MANIFEST_LOADING="hlsManifestLoading",i.MANIFEST_LOADED="hlsManifestLoaded",i.MANIFEST_PARSED="hlsManifestParsed",i.LEVEL_SWITCHING="hlsLevelSwitching",i.LEVEL_SWITCHED="hlsLevelSwitched",i.LEVEL_LOADING="hlsLevelLoading",i.LEVEL_LOADED="hlsLevelLoaded",i.LEVEL_UPDATED="hlsLevelUpdated",i.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",i.LEVELS_UPDATED="hlsLevelsUpdated",i.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",i.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",i.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",i.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",i.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",i.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",i.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",i.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",i.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",i.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",i.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",i.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",i.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",i.CUES_PARSED="hlsCuesParsed",i.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",i.INIT_PTS_FOUND="hlsInitPtsFound",i.FRAG_LOADING="hlsFragLoading",i.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",i.FRAG_LOADED="hlsFragLoaded",i.FRAG_DECRYPTED="hlsFragDecrypted",i.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",i.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",i.FRAG_PARSING_METADATA="hlsFragParsingMetadata",i.FRAG_PARSED="hlsFragParsed",i.FRAG_BUFFERED="hlsFragBuffered",i.FRAG_CHANGED="hlsFragChanged",i.FPS_DROP="hlsFpsDrop",i.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",i.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",i.ERROR="hlsError",i.DESTROYING="hlsDestroying",i.KEY_LOADING="hlsKeyLoading",i.KEY_LOADED="hlsKeyLoaded",i.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",i.BACK_BUFFER_REACHED="hlsBackBufferReached",i.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",i.ASSET_LIST_LOADING="hlsAssetListLoading",i.ASSET_LIST_LOADED="hlsAssetListLoaded",i.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",i.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",i.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",i.INTERSTITIAL_STARTED="hlsInterstitialStarted",i.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",i.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",i.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",i.INTERSTITIAL_ENDED="hlsInterstitialEnded",i.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",i.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",i.EVENT_CUE_ENTER="hlsEventCueEnter",i})({});var nt={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},ke={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};class Cr{constructor(e,t=0,s=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=s}sample(e,t){const s=Math.pow(this.alpha_,e);this.estimate_=t*(1-s)+s*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class o1{constructor(e,t,s,n=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=s,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new Cr(e),this.fast_=new Cr(t),this.defaultTTFB_=n,this.ttfb_=new Cr(e)}update(e,t){const{slow_:s,fast_:n,ttfb_:r}=this;s.halfLife!==e&&(this.slow_=new Cr(e,s.getEstimate(),s.getTotalWeight())),n.halfLife!==t&&(this.fast_=new Cr(t,n.getEstimate(),n.getTotalWeight())),r.halfLife!==e&&(this.ttfb_=new Cr(e,r.getEstimate(),r.getTotalWeight()))}sample(e,t){e=Math.max(e,this.minDelayMs_);const s=8*t,n=e/1e3,r=s/n;this.fast_.sample(n,r),this.slow_.sample(n,r)}sampleTTFB(e){const t=e/1e3,s=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(s,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}get defaultEstimate(){return this.defaultEstimate_}destroy(){}}function c1(i,e,t){return(e=d1(e))in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function Lt(){return Lt=Object.assign?Object.assign.bind():function(i){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var s in t)({}).hasOwnProperty.call(t,s)&&(i[s]=t[s])}return i},Lt.apply(null,arguments)}function uy(i,e){var t=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);e&&(s=s.filter(function(n){return Object.getOwnPropertyDescriptor(i,n).enumerable})),t.push.apply(t,s)}return t}function xt(i){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?uy(Object(t),!0).forEach(function(s){c1(i,s,t[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(t)):uy(Object(t)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(t,s))})}return i}function u1(i,e){if(typeof i!="object"||!i)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}function d1(i){var e=u1(i,"string");return typeof e=="symbol"?e:e+""}class Pi{constructor(e,t){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;const s=`[${e}]:`;this.trace=ma,this.debug=t.debug.bind(null,s),this.log=t.log.bind(null,s),this.warn=t.warn.bind(null,s),this.info=t.info.bind(null,s),this.error=t.error.bind(null,s)}}const ma=function(){},h1={trace:ma,debug:ma,log:ma,warn:ma,info:ma,error:ma};function Df(){return Lt({},h1)}function f1(i,e){const t=self.console[i];return t?t.bind(self.console,`${e?"["+e+"] ":""}[${i}] >`):ma}function dy(i,e,t){return e[i]?e[i].bind(e):f1(i,t)}const Pf=Df();function m1(i,e,t){const s=Df();if(typeof console=="object"&&i===!0||typeof i=="object"){const n=["debug","log","info","warn","error"];n.forEach(r=>{s[r]=dy(r,i,t)});try{s.log(`Debug logs enabled for "${e}" in hls.js version 1.6.15`)}catch{return Df()}n.forEach(r=>{Pf[r]=dy(r,i)})}else Lt(Pf,s);return s}const St=Pf;function ya(i=!0){return typeof self>"u"?void 0:(i||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function p1(i){return typeof self<"u"&&i===self.ManagedMediaSource}function TS(i,e){const t=Object.keys(i),s=Object.keys(e),n=t.length,r=s.length;return!n||!r||n===r&&!t.some(l=>s.indexOf(l)===-1)}function vi(i,e=!1){if(typeof TextDecoder<"u"){const u=new TextDecoder("utf-8").decode(i);if(e){const f=u.indexOf("\0");return f!==-1?u.substring(0,f):u}return u.replace(/\0/g,"")}const t=i.length;let s,n,r,l="",c=0;for(;c<t;){if(s=i[c++],s===0&&e)return l;if(s===0||s===3)continue;switch(s>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:l+=String.fromCharCode(s);break;case 12:case 13:n=i[c++],l+=String.fromCharCode((s&31)<<6|n&63);break;case 14:n=i[c++],r=i[c++],l+=String.fromCharCode((s&15)<<12|(n&63)<<6|(r&63)<<0);break}}return l}function Ls(i){let e="";for(let t=0;t<i.length;t++){let s=i[t].toString(16);s.length<2&&(s="0"+s),e+=s}return e}function ES(i){return Uint8Array.from(i.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}function g1(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var tf={exports:{}},hy;function v1(){return hy||(hy=1,(function(i,e){(function(t){var s=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,n=/^(?=([^\/?#]*))\1([^]*)$/,r=/(?:\/|^)\.(?=\/)/g,l=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,c={buildAbsoluteURL:function(h,u,f){if(f=f||{},h=h.trim(),u=u.trim(),!u){if(!f.alwaysNormalize)return h;var p=c.parseURL(h);if(!p)throw new Error("Error trying to parse base URL.");return p.path=c.normalizePath(p.path),c.buildURLFromParts(p)}var v=c.parseURL(u);if(!v)throw new Error("Error trying to parse relative URL.");if(v.scheme)return f.alwaysNormalize?(v.path=c.normalizePath(v.path),c.buildURLFromParts(v)):u;var x=c.parseURL(h);if(!x)throw new Error("Error trying to parse base URL.");if(!x.netLoc&&x.path&&x.path[0]!=="/"){var S=n.exec(x.path);x.netLoc=S[1],x.path=S[2]}x.netLoc&&!x.path&&(x.path="/");var E={scheme:x.scheme,netLoc:v.netLoc,path:null,params:v.params,query:v.query,fragment:v.fragment};if(!v.netLoc&&(E.netLoc=x.netLoc,v.path[0]!=="/"))if(!v.path)E.path=x.path,v.params||(E.params=x.params,v.query||(E.query=x.query));else{var T=x.path,A=T.substring(0,T.lastIndexOf("/")+1)+v.path;E.path=c.normalizePath(A)}return E.path===null&&(E.path=f.alwaysNormalize?c.normalizePath(v.path):v.path),c.buildURLFromParts(E)},parseURL:function(h){var u=s.exec(h);return u?{scheme:u[1]||"",netLoc:u[2]||"",path:u[3]||"",params:u[4]||"",query:u[5]||"",fragment:u[6]||""}:null},normalizePath:function(h){for(h=h.split("").reverse().join("").replace(r,"");h.length!==(h=h.replace(l,"")).length;);return h.split("").reverse().join("")},buildURLFromParts:function(h){return h.scheme+h.netLoc+h.path+h.params+h.query+h.fragment}};i.exports=c})()})(tf)),tf.exports}var mm=v1();class pm{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var Ct={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class AS{constructor(e){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,typeof e=="string"&&(e={url:e}),this.base=e,x1(this,"stats")}setByteRange(e,t){const s=e.split("@",2);let n;s.length===1?n=t?.byteRangeEndOffset||0:n=parseInt(s[1]),this._byteRange=[n,parseInt(s[0])+n]}get baseurl(){return this.base.url}get byteRange(){return this._byteRange===null?[]:this._byteRange}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get elementaryStreams(){return this._streams===null&&(this._streams={[Ct.AUDIO]:null,[Ct.VIDEO]:null,[Ct.AUDIOVIDEO]:null}),this._streams}set elementaryStreams(e){this._streams=e}get hasStats(){return this._stats!==null}get hasStreams(){return this._streams!==null}get stats(){return this._stats===null&&(this._stats=new pm),this._stats}set stats(e){this._stats=e}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=mm.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[Ct.AUDIO]=null,e[Ct.VIDEO]=null,e[Ct.AUDIOVIDEO]=null}}function es(i){return i.sn!=="initSegment"}class sf extends AS{constructor(e,t){super(t),this._decryptdata=null,this._programDateTime=null,this._ref=null,this._bitrate=void 0,this.rawProgramDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.playlistOffset=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get byteLength(){if(this.hasStats){const e=this.stats.total;if(e)return e}if(this.byteRange.length){const e=this.byteRange[0],t=this.byteRange[1];if(Oe(e)&&Oe(t))return t-e}return null}get bitrate(){return this.byteLength?this.byteLength*8/this.duration:this._bitrate?this._bitrate:null}set bitrate(e){this._bitrate=e}get decryptdata(){var e;const{levelkeys:t}=this;if(!t||t.NONE)return null;if(t.identity)this._decryptdata||(this._decryptdata=t.identity.getDecryptData(this.sn));else if(!((e=this._decryptdata)!=null&&e.keyId)){const s=Object.keys(t);if(s.length===1){const n=this._decryptdata=t[s[0]]||null;n&&(this._decryptdata=n.getDecryptData(this.sn,t))}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null)return null;const e=Oe(this.duration)?this.duration:0;return this.programDateTime+e*1e3}get encrypted(){var e;if((e=this._decryptdata)!=null&&e.encrypted)return!0;if(this.levelkeys){var t;const s=Object.keys(this.levelkeys),n=s.length;if(n>1||n===1&&(t=this.levelkeys[s[0]])!=null&&t.encrypted)return!0}return!1}get programDateTime(){return this._programDateTime===null&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime}set programDateTime(e){if(!Oe(e)){this._programDateTime=this.rawProgramDateTime=null;return}this._programDateTime=e}get ref(){return es(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}addStart(e){this.setStart(this.start+e)}setStart(e){this.start=e,this._ref&&(this._ref.start=e)}setDuration(e){this.duration=e,this._ref&&(this._ref.duration=e)}setKeyFormat(e){const t=this.levelkeys;if(t){var s;const n=t[e];n&&!((s=this._decryptdata)!=null&&s.keyId)&&(this._decryptdata=n.getDecryptData(this.sn,t))}}abortRequests(){var e,t;(e=this.loader)==null||e.abort(),(t=this.keyLoader)==null||t.abort()}setElementaryStreamInfo(e,t,s,n,r,l=!1){const{elementaryStreams:c}=this,h=c[e];if(!h){c[e]={startPTS:t,endPTS:s,startDTS:n,endDTS:r,partial:l};return}h.startPTS=Math.min(h.startPTS,t),h.endPTS=Math.max(h.endPTS,s),h.startDTS=Math.min(h.startDTS,n),h.endDTS=Math.max(h.endDTS,r)}}class y1 extends AS{constructor(e,t,s,n,r){super(s),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=n;const l=e.enumeratedString("BYTERANGE");l&&this.setByteRange(l,r),r&&(this.fragOffset=r.fragOffset+r.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}function IS(i,e){const t=Object.getPrototypeOf(i);if(t){const s=Object.getOwnPropertyDescriptor(t,e);return s||IS(t,e)}}function x1(i,e){const t=IS(i,e);t&&(t.enumerable=!0,Object.defineProperty(i,e,t))}const fy=Math.pow(2,32)-1,S1=[].push,_S={video:1,audio:2,id3:3,text:4};function ds(i){return String.fromCharCode.apply(null,i)}function RS(i,e){const t=i[e]<<8|i[e+1];return t<0?65536+t:t}function Ye(i,e){const t=LS(i,e);return t<0?4294967296+t:t}function my(i,e){let t=Ye(i,e);return t*=Math.pow(2,32),t+=Ye(i,e+4),t}function LS(i,e){return i[e]<<24|i[e+1]<<16|i[e+2]<<8|i[e+3]}function b1(i){const e=i.byteLength;for(let t=0;t<e;){const s=Ye(i,t);if(s>8&&i[t+4]===109&&i[t+5]===111&&i[t+6]===111&&i[t+7]===102)return!0;t=s>1?t+s:e}return!1}function tt(i,e){const t=[];if(!e.length)return t;const s=i.byteLength;for(let n=0;n<s;){const r=Ye(i,n),l=ds(i.subarray(n+4,n+8)),c=r>1?n+r:s;if(l===e[0])if(e.length===1)t.push(i.subarray(n+8,c));else{const h=tt(i.subarray(n+8,c),e.slice(1));h.length&&S1.apply(t,h)}n=c}return t}function T1(i){const e=[],t=i[0];let s=8;const n=Ye(i,s);s+=4;let r=0,l=0;t===0?(r=Ye(i,s),l=Ye(i,s+4),s+=8):(r=my(i,s),l=my(i,s+8),s+=16),s+=2;let c=i.length+l;const h=RS(i,s);s+=2;for(let u=0;u<h;u++){let f=s;const p=Ye(i,f);f+=4;const v=p&2147483647;if((p&2147483648)>>>31===1)return St.warn("SIDX has hierarchical references (not supported)"),null;const S=Ye(i,f);f+=4,e.push({referenceSize:v,subsegmentDuration:S,info:{duration:S/n,start:c,end:c+v-1}}),c+=v,f+=4,s=f}return{earliestPresentationTime:r,timescale:n,version:t,referencesCount:h,references:e}}function wS(i){const e=[],t=tt(i,["moov","trak"]);for(let n=0;n<t.length;n++){const r=t[n],l=tt(r,["tkhd"])[0];if(l){let c=l[0];const h=Ye(l,c===0?12:20),u=tt(r,["mdia","mdhd"])[0];if(u){c=u[0];const f=Ye(u,c===0?12:20),p=tt(r,["mdia","hdlr"])[0];if(p){const v=ds(p.subarray(8,12)),x={soun:Ct.AUDIO,vide:Ct.VIDEO}[v],S=tt(r,["mdia","minf","stbl","stsd"])[0],E=E1(S);x?(e[h]={timescale:f,type:x,stsd:E},e[x]=xt({timescale:f,id:h},E)):e[h]={timescale:f,type:v,stsd:E}}}}}return tt(i,["moov","mvex","trex"]).forEach(n=>{const r=Ye(n,4),l=e[r];l&&(l.default={duration:Ye(n,12),flags:Ye(n,20)})}),e}function E1(i){const e=i.subarray(8),t=e.subarray(86),s=ds(e.subarray(4,8));let n=s,r;const l=s==="enca"||s==="encv";if(l){const u=tt(e,[s])[0].subarray(s==="enca"?28:78);tt(u,["sinf"]).forEach(p=>{const v=tt(p,["schm"])[0];if(v){const x=ds(v.subarray(4,8));if(x==="cbcs"||x==="cenc"){const S=tt(p,["frma"])[0];S&&(n=ds(S))}}})}const c=n;switch(n){case"avc1":case"avc2":case"avc3":case"avc4":{const h=tt(t,["avcC"])[0];h&&h.length>3&&(n+="."+kc(h[1])+kc(h[2])+kc(h[3]),r=Nc(c==="avc1"?"dva1":"dvav",t));break}case"mp4a":{const h=tt(e,[s])[0],u=tt(h.subarray(28),["esds"])[0];if(u&&u.length>7){let f=4;if(u[f++]!==3)break;f=nf(u,f),f+=2;const p=u[f++];if(p&128&&(f+=2),p&64&&(f+=u[f++]),u[f++]!==4)break;f=nf(u,f);const v=u[f++];if(v===64)n+="."+kc(v);else break;if(f+=12,u[f++]!==5)break;f=nf(u,f);const x=u[f++];let S=(x&248)>>3;S===31&&(S+=1+((x&7)<<3)+((u[f]&224)>>5)),n+="."+S}break}case"hvc1":case"hev1":{const h=tt(t,["hvcC"])[0];if(h&&h.length>12){const u=h[1],f=["","A","B","C"][u>>6],p=u&31,v=Ye(h,2),x=(u&32)>>5?"H":"L",S=h[12],E=h.subarray(6,12);n+="."+f+p,n+="."+A1(v).toString(16).toUpperCase(),n+="."+x+S;let T="";for(let A=E.length;A--;){const I=E[A];(I||T)&&(T="."+I.toString(16).toUpperCase()+T)}n+=T}r=Nc(c=="hev1"?"dvhe":"dvh1",t);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":{n=Nc(n,t)||n;break}case"vp09":{const h=tt(t,["vpcC"])[0];if(h&&h.length>6){const u=h[4],f=h[5],p=h[6]>>4&15;n+="."+sn(u)+"."+sn(f)+"."+sn(p)}break}case"av01":{const h=tt(t,["av1C"])[0];if(h&&h.length>2){const u=h[1]>>>5,f=h[1]&31,p=h[2]>>>7?"H":"M",v=(h[2]&64)>>6,x=(h[2]&32)>>5,S=u===2&&v?x?12:10:v?10:8,E=(h[2]&16)>>4,T=(h[2]&8)>>3,A=(h[2]&4)>>2,I=h[2]&3;n+="."+u+"."+sn(f)+p+"."+sn(S)+"."+E+"."+T+A+I+"."+sn(1)+"."+sn(1)+"."+sn(1)+"."+0,r=Nc("dav1",t)}break}}return{codec:n,encrypted:l,supplemental:r}}function Nc(i,e){const t=tt(e,["dvvC"]),s=t.length?t[0]:tt(e,["dvcC"])[0];if(s){const n=s[2]>>1&127,r=s[2]<<5&32|s[3]>>3&31;return i+"."+sn(n)+"."+sn(r)}}function A1(i){let e=0;for(let t=0;t<32;t++)e|=(i>>t&1)<<31-t;return e>>>0}function nf(i,e){const t=e+5;for(;i[e++]&128&&e<t;);return e}function kc(i){return("0"+i.toString(16).toUpperCase()).slice(-2)}function sn(i){return(i<10?"0":"")+i}function I1(i,e){if(!i||!e)return;const t=e.keyId;t&&e.isCommonEncryption&&CS(i,(s,n)=>{const r=s.subarray(8,24);r.some(l=>l!==0)||(St.log(`[eme] Patching keyId in 'enc${n?"a":"v"}>sinf>>tenc' box: ${Ls(r)} -> ${Ls(t)}`),s.set(t,8))})}function _1(i){const e=[];return CS(i,t=>e.push(t.subarray(8,24))),e}function CS(i,e){tt(i,["moov","trak"]).forEach(s=>{const n=tt(s,["mdia","minf","stbl","stsd"])[0];if(!n)return;const r=n.subarray(8);let l=tt(r,["enca"]);const c=l.length>0;c||(l=tt(r,["encv"])),l.forEach(h=>{const u=c?h.subarray(28):h.subarray(78);tt(u,["sinf"]).forEach(p=>{const v=OS(p);v&&e(v,c)})})})}function OS(i){const e=tt(i,["schm"])[0];if(e){const t=ds(e.subarray(4,8));if(t==="cbcs"||t==="cenc"){const s=tt(i,["schi","tenc"])[0];if(s)return s}}}function R1(i,e,t){const s={},n=tt(i,["moof","traf"]);for(let r=0;r<n.length;r++){const l=n[r],c=tt(l,["tfhd"])[0],h=Ye(c,4),u=e[h];if(!u)continue;s[h]||(s[h]={start:NaN,duration:0,sampleCount:0,timescale:u.timescale,type:u.type});const f=s[h],p=tt(l,["tfdt"])[0];if(p){const _=p[0];let C=Ye(p,4);_===1&&(C===fy?t.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"):(C*=fy+1,C+=Ye(p,8))),Oe(C)&&(!Oe(f.start)||C<f.start)&&(f.start=C)}const v=u.default,x=Ye(c,0)|v?.flags;let S=v?.duration||0;x&8&&(x&2?S=Ye(c,12):S=Ye(c,8));const E=tt(l,["trun"]);let T=f.start||0,A=0,I=S;for(let _=0;_<E.length;_++){const C=E[_],k=Ye(C,4),U=f.sampleCount;f.sampleCount+=k;const O=C[3]&1,F=C[3]&4,j=C[2]&1,M=C[2]&2,H=C[2]&4,K=C[2]&8;let te=8,ae=k;for(O&&(te+=4),F&&k&&(!(C[te+1]&1)&&f.keyFrameIndex===void 0&&(f.keyFrameIndex=U),te+=4,j?(I=Ye(C,te),te+=4):I=S,M&&(te+=4),K&&(te+=4),T+=I,A+=I,ae--);ae--;)j?(I=Ye(C,te),te+=4):I=S,M&&(te+=4),H&&(C[te+1]&1||f.keyFrameIndex===void 0&&(f.keyFrameIndex=f.sampleCount-(ae+1),f.keyFrameStart=T),te+=4),K&&(te+=4),T+=I,A+=I;!A&&S&&(A+=S*k)}f.duration+=A}if(!Object.keys(s).some(r=>s[r].duration)){let r=1/0,l=0;const c=tt(i,["sidx"]);for(let h=0;h<c.length;h++){const u=T1(c[h]);if(u!=null&&u.references){r=Math.min(r,u.earliestPresentationTime/u.timescale);const f=u.references.reduce((p,v)=>p+v.info.duration||0,0);l=Math.max(l,f+u.earliestPresentationTime/u.timescale)}}l&&Oe(l)&&Object.keys(s).forEach(h=>{s[h].duration||(s[h].duration=l*s[h].timescale-s[h].start)})}return s}function L1(i){const e={valid:null,remainder:null},t=tt(i,["moof"]);if(t.length<2)return e.remainder=i,e;const s=t[t.length-1];return e.valid=i.slice(0,s.byteOffset-8),e.remainder=i.slice(s.byteOffset-8),e}function ki(i,e){const t=new Uint8Array(i.length+e.length);return t.set(i),t.set(e,i.length),t}function py(i,e){const t=[],s=e.samples,n=e.timescale,r=e.id;let l=!1;return tt(s,["moof"]).map(h=>{const u=h.byteOffset-8;tt(h,["traf"]).map(p=>{const v=tt(p,["tfdt"]).map(x=>{const S=x[0];let E=Ye(x,4);return S===1&&(E*=Math.pow(2,32),E+=Ye(x,8)),E/n})[0];return v!==void 0&&(i=v),tt(p,["tfhd"]).map(x=>{const S=Ye(x,4),E=Ye(x,0)&16777215,T=(E&1)!==0,A=(E&2)!==0,I=(E&8)!==0;let _=0;const C=(E&16)!==0;let k=0;const U=(E&32)!==0;let O=8;S===r&&(T&&(O+=8),A&&(O+=4),I&&(_=Ye(x,O),O+=4),C&&(k=Ye(x,O),O+=4),U&&(O+=4),e.type==="video"&&(l=Ou(e.codec)),tt(p,["trun"]).map(F=>{const j=F[0],M=Ye(F,0)&16777215,H=(M&1)!==0;let K=0;const te=(M&4)!==0,ae=(M&256)!==0;let me=0;const D=(M&512)!==0;let G=0;const Y=(M&1024)!==0,oe=(M&2048)!==0;let pe=0;const P=Ye(F,4);let V=8;H&&(K=Ye(F,V),V+=4),te&&(V+=4);let se=K+u;for(let he=0;he<P;he++){if(ae?(me=Ye(F,V),V+=4):me=_,D?(G=Ye(F,V),V+=4):G=k,Y&&(V+=4),oe&&(j===0?pe=Ye(F,V):pe=LS(F,V),V+=4),e.type===Ct.VIDEO){let ye=0;for(;ye<G;){const Ae=Ye(s,se);if(se+=4,w1(l,s[se])){const Pe=s.subarray(se,se+Ae);gm(Pe,l?2:1,i+pe/n,t)}se+=Ae,ye+=Ae+4}}i+=me/n}}))})})}),t}function Ou(i){if(!i)return!1;const e=i.substring(0,4);return e==="hvc1"||e==="hev1"||e==="dvh1"||e==="dvhe"}function w1(i,e){if(i){const t=e>>1&63;return t===39||t===40}else return(e&31)===6}function gm(i,e,t,s){const n=NS(i);let r=0;r+=e;let l=0,c=0,h=0;for(;r<n.length;){l=0;do{if(r>=n.length)break;h=n[r++],l+=h}while(h===255);c=0;do{if(r>=n.length)break;h=n[r++],c+=h}while(h===255);const u=n.length-r;let f=r;if(c<u)r+=c;else if(c>u){St.error(`Malformed SEI payload. ${c} is too small, only ${u} bytes left to parse.`);break}if(l===4){if(n[f++]===181){const v=RS(n,f);if(f+=2,v===49){const x=Ye(n,f);if(f+=4,x===1195456820){const S=n[f++];if(S===3){const E=n[f++],T=31&E,A=64&E,I=A?2+T*3:0,_=new Uint8Array(I);if(A){_[0]=E;for(let C=1;C<I;C++)_[C]=n[f++]}s.push({type:S,payloadType:l,pts:t,bytes:_})}}}}}else if(l===5&&c>16){const p=[];for(let S=0;S<16;S++){const E=n[f++].toString(16);p.push(E.length==1?"0"+E:E),(S===3||S===5||S===7||S===9)&&p.push("-")}const v=c-16,x=new Uint8Array(v);for(let S=0;S<v;S++)x[S]=n[f++];s.push({payloadType:l,pts:t,uuid:p.join(""),userData:vi(x),userDataBytes:x})}}}function NS(i){const e=i.byteLength,t=[];let s=1;for(;s<e-2;)i[s]===0&&i[s+1]===0&&i[s+2]===3?(t.push(s+2),s+=2):s++;if(t.length===0)return i;const n=e-t.length,r=new Uint8Array(n);let l=0;for(s=0;s<n;l++,s++)l===t[0]&&(l++,t.shift()),r[s]=i[l];return r}function C1(i){const e=i[0];let t="",s="",n=0,r=0,l=0,c=0,h=0,u=0;if(e===0){for(;ds(i.subarray(u,u+1))!=="\0";)t+=ds(i.subarray(u,u+1)),u+=1;for(t+=ds(i.subarray(u,u+1)),u+=1;ds(i.subarray(u,u+1))!=="\0";)s+=ds(i.subarray(u,u+1)),u+=1;s+=ds(i.subarray(u,u+1)),u+=1,n=Ye(i,12),r=Ye(i,16),c=Ye(i,20),h=Ye(i,24),u=28}else if(e===1){u+=4,n=Ye(i,u),u+=4;const p=Ye(i,u);u+=4;const v=Ye(i,u);for(u+=4,l=2**32*p+v,r1(l)||(l=Number.MAX_SAFE_INTEGER,St.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),c=Ye(i,u),u+=4,h=Ye(i,u),u+=4;ds(i.subarray(u,u+1))!=="\0";)t+=ds(i.subarray(u,u+1)),u+=1;for(t+=ds(i.subarray(u,u+1)),u+=1;ds(i.subarray(u,u+1))!=="\0";)s+=ds(i.subarray(u,u+1)),u+=1;s+=ds(i.subarray(u,u+1)),u+=1}const f=i.subarray(u,i.byteLength);return{schemeIdUri:t,value:s,timeScale:n,presentationTime:l,presentationTimeDelta:r,eventDuration:c,id:h,payload:f}}function O1(i,...e){const t=e.length;let s=8,n=t;for(;n--;)s+=e[n].byteLength;const r=new Uint8Array(s);for(r[0]=s>>24&255,r[1]=s>>16&255,r[2]=s>>8&255,r[3]=s&255,r.set(i,4),n=0,s=8;n<t;n++)r.set(e[n],s),s+=e[n].byteLength;return r}function N1(i,e,t){if(i.byteLength!==16)throw new RangeError("Invalid system id");let s,n;s=0,n=new Uint8Array;let r;s>0?(r=new Uint8Array(4),e.length>0&&new DataView(r.buffer).setUint32(0,e.length,!1)):r=new Uint8Array;const l=new Uint8Array(4);return t.byteLength>0&&new DataView(l.buffer).setUint32(0,t.byteLength,!1),O1([112,115,115,104],new Uint8Array([s,0,0,0]),i,r,n,l,t)}function k1(i){const e=[];if(i instanceof ArrayBuffer){const t=i.byteLength;let s=0;for(;s+32<t;){const n=new DataView(i,s),r=D1(n);e.push(r),s+=r.size}}return e}function D1(i){const e=i.getUint32(0),t=i.byteOffset,s=i.byteLength;if(s<e)return{offset:t,size:s};if(i.getUint32(4)!==1886614376)return{offset:t,size:e};const r=i.getUint32(8)>>>24;if(r!==0&&r!==1)return{offset:t,size:e};const l=i.buffer,c=Ls(new Uint8Array(l,t+12,16));let h=null,u=null,f=0;if(r===0)f=28;else{const v=i.getUint32(28);if(!v||s<32+v*16)return{offset:t,size:e};h=[];for(let x=0;x<v;x++)h.push(new Uint8Array(l,t+32+x*16,16));f=32+v*16}if(!f)return{offset:t,size:e};const p=i.getUint32(f);return e-32<p?{offset:t,size:e}:(u=new Uint8Array(l,t+f+4,p),{version:r,systemId:c,kids:h,data:u,offset:t,size:e})}const kS=()=>/\(Windows.+Firefox\//i.test(navigator.userAgent),Gr={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function vm(i,e){const t=Gr[e];return!!t&&!!t[i.slice(0,4)]}function Wl(i,e,t=!0){return!i.split(",").some(s=>!ym(s,e,t))}function ym(i,e,t=!0){var s;const n=ya(t);return(s=n?.isTypeSupported(Xl(i,e)))!=null?s:!1}function Xl(i,e){return`${e}/mp4;codecs=${i}`}function gy(i){if(i){const e=i.substring(0,4);return Gr.video[e]}return 2}function du(i){const e=kS();return i.split(",").reduce((t,s)=>{const r=e&&Ou(s)?9:Gr.video[s];return r?(r*2+t)/(t?3:2):(Gr.audio[s]+t)/(t?2:1)},0)}const af={};function P1(i,e=!0){if(af[i])return af[i];const t={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[i];for(let n=0;n<t.length;n++){var s;if(ym(t[n],"audio",e))return af[i]=t[n],t[n];if(t[n]==="mp3"&&(s=ya(e))!=null&&s.isTypeSupported("audio/mpeg"))return""}return i}const U1=/flac|opus|mp4a\.40\.34/i;function hu(i,e=!0){return i.replace(U1,t=>P1(t.toLowerCase(),e))}function M1(i,e){const t=[];if(i){const s=i.split(",");for(let n=0;n<s.length;n++)vm(s[n],"video")||t.push(s[n])}return e&&t.push(e),t.join(",")}function Zc(i,e){if(i&&(i.length>4||["ac-3","ec-3","alac","fLaC","Opus"].indexOf(i)!==-1)&&(vy(i,"audio")||vy(i,"video")))return i;if(e){const t=e.split(",");if(t.length>1){if(i){for(let s=t.length;s--;)if(t[s].substring(0,4)===i.substring(0,4))return t[s]}return t[0]}}return e||i}function vy(i,e){return vm(i,e)&&ym(i,e)}function j1(i){const e=i.split(",");for(let t=0;t<e.length;t++){const s=e[t].split(".");s.length>2&&s[0]==="avc1"&&(e[t]=`avc1.${parseInt(s[1]).toString(16)}${("000"+parseInt(s[2]).toString(16)).slice(-4)}`)}return e.join(",")}function F1(i){if(i.startsWith("av01.")){const e=i.split("."),t=["0","111","01","01","01","0"];for(let s=e.length;s>4&&s<10;s++)e[s]=t[s-4];return e.join(".")}return i}function yy(i){const e=ya(i)||{isTypeSupported:()=>!1};return{mpeg:e.isTypeSupported("audio/mpeg"),mp3:e.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:e.isTypeSupported('audio/mp4; codecs="ac-3"')}}function Uf(i){return i.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}const B1={supported:!0,powerEfficient:!0,smooth:!0},V1={supported:!1,smooth:!1,powerEfficient:!1},DS={supported:!0,configurations:[],decodingInfoResults:[B1]};function PS(i,e){return{supported:!1,configurations:e,decodingInfoResults:[V1],error:i}}function $1(i,e,t,s,n,r){const l=i.videoCodec,c=i.audioCodec?i.audioGroups:null,h=r?.audioCodec,u=r?.channels,f=u?parseInt(u):h?1/0:2;let p=null;if(c!=null&&c.length)try{c.length===1&&c[0]?p=e.groups[c[0]].channels:p=c.reduce((v,x)=>{if(x){const S=e.groups[x];if(!S)throw new Error(`Audio track group ${x} not found`);Object.keys(S.channels).forEach(E=>{v[E]=(v[E]||0)+S.channels[E]})}return v},{2:0})}catch{return!0}return l!==void 0&&(l.split(",").some(v=>Ou(v))||i.width>1920&&i.height>1088||i.height>1920&&i.width>1088||i.frameRate>Math.max(s,30)||i.videoRange!=="SDR"&&i.videoRange!==t||i.bitrate>Math.max(n,8e6))||!!p&&Oe(f)&&Object.keys(p).some(v=>parseInt(v)>f)}function US(i,e,t,s={}){const n=i.videoCodec;if(!n&&!i.audioCodec||!t)return Promise.resolve(DS);const r=[],l=G1(i),c=l.length,h=H1(i,e,c>0),u=h.length;for(let f=c||1*u||1;f--;){const p={type:"media-source"};if(c&&(p.video=l[f%c]),u){p.audio=h[f%u];const v=p.audio.bitrate;p.video&&v&&(p.video.bitrate-=v)}r.push(p)}if(n){const f=navigator.userAgent;if(n.split(",").some(p=>Ou(p))&&kS())return Promise.resolve(PS(new Error(`Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent string: (${f})`),r))}return Promise.all(r.map(f=>{const p=K1(f);return s[p]||(s[p]=t.decodingInfo(f))})).then(f=>({supported:!f.some(p=>!p.supported),configurations:r,decodingInfoResults:f})).catch(f=>({supported:!1,configurations:r,decodingInfoResults:[],error:f}))}function G1(i){var e;const t=(e=i.videoCodec)==null?void 0:e.split(","),s=MS(i),n=i.width||640,r=i.height||480,l=i.frameRate||30,c=i.videoRange.toLowerCase();return t?t.map(h=>{const u={contentType:Xl(F1(h),"video"),width:n,height:r,bitrate:s,framerate:l};return c!=="sdr"&&(u.transferFunction=c),u}):[]}function H1(i,e,t){var s;const n=(s=i.audioCodec)==null?void 0:s.split(","),r=MS(i);return n&&i.audioGroups?i.audioGroups.reduce((l,c)=>{var h;const u=c?(h=e.groups[c])==null?void 0:h.tracks:null;return u?u.reduce((f,p)=>{if(p.groupId===c){const v=parseFloat(p.channels||"");n.forEach(x=>{const S={contentType:Xl(x,"audio"),bitrate:t?z1(x,r):r};v&&(S.channels=""+v),f.push(S)})}return f},l):l},[]):[]}function z1(i,e){if(e<=1)return 1;let t=128e3;return i==="ec-3"?t=768e3:i==="ac-3"&&(t=64e4),Math.min(e/2,t)}function MS(i){return Math.ceil(Math.max(i.bitrate*.9,i.averageBitrate)/1e3)*1e3||1}function K1(i){let e="";const{audio:t,video:s}=i;if(s){const n=Uf(s.contentType);e+=`${n}_r${s.height}x${s.width}f${Math.ceil(s.framerate)}${s.transferFunction||"sd"}_${Math.ceil(s.bitrate/1e5)}`}if(t){const n=Uf(t.contentType);e+=`${s?"_":""}${n}_c${t.channels}`}return e}const Mf=["NONE","TYPE-0","TYPE-1",null];function Y1(i){return Mf.indexOf(i)>-1}const fu=["SDR","PQ","HLG"];function q1(i){return!!i&&fu.indexOf(i)>-1}var Jc={No:"",Yes:"YES",v2:"v2"};function xy(i){const{canSkipUntil:e,canSkipDateRanges:t,age:s}=i,n=s<e/2;return e&&n?t?Jc.v2:Jc.Yes:Jc.No}class Sy{constructor(e,t,s){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=s}addDirectives(e){const t=new self.URL(e);return this.msn!==void 0&&t.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class Zl{constructor(e){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter(s=>!!s).map(s=>s.substring(0,4)).join(","),"supplemental"in e){var t;this.supplemental=e.supplemental;const s=(t=e.supplemental)==null?void 0:t.videoCodec;s&&s!==e.videoCodec&&(this.codecSet+=`,${s.substring(0,4)}`)}this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return by(this._audioGroups,e)}hasSubtitleGroup(e){return by(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,t){if(t){if(e==="audio"){let s=this._audioGroups;s||(s=this._audioGroups=[]),s.indexOf(t)===-1&&s.push(t)}else if(e==="text"){let s=this._subtitleGroups;s||(s=this._subtitleGroups=[]),s.indexOf(t)===-1&&s.push(t)}}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return(e=this.audioGroups)==null?void 0:e[0]}get textGroupId(){var e;return(e=this.subtitleGroups)==null?void 0:e[0]}addFallback(){}}function by(i,e){return!e||!i?!1:i.indexOf(e)!==-1}function Q1(){if(typeof matchMedia=="function"){const i=matchMedia("(dynamic-range: high)"),e=matchMedia("bad query");if(i.media!==e.media)return i.matches===!0}return!1}function W1(i,e){let t=!1,s=[];if(i&&(t=i!=="SDR",s=[i]),e){s=e.allowedVideoRanges||fu.slice(0);const n=s.join("")!=="SDR"&&!e.videoCodec;t=e.preferHDR!==void 0?e.preferHDR:n&&Q1(),t||(s=["SDR"])}return{preferHDR:t,allowedVideoRanges:s}}const X1=i=>{const e=new WeakSet;return(t,s)=>{if(i&&(s=i(t,s)),typeof s=="object"&&s!==null){if(e.has(s))return;e.add(s)}return s}},Ot=(i,e)=>JSON.stringify(i,X1(e));function Z1(i,e,t,s,n){const r=Object.keys(i),l=s?.channels,c=s?.audioCodec,h=n?.videoCodec,u=l&&parseInt(l)===2;let f=!1,p=!1,v=1/0,x=1/0,S=1/0,E=1/0,T=0,A=[];const{preferHDR:I,allowedVideoRanges:_}=W1(e,n);for(let F=r.length;F--;){const j=i[r[F]];f||(f=j.channels[2]>0),v=Math.min(v,j.minHeight),x=Math.min(x,j.minFramerate),S=Math.min(S,j.minBitrate),_.filter(H=>j.videoRanges[H]>0).length>0&&(p=!0)}v=Oe(v)?v:0,x=Oe(x)?x:0;const C=Math.max(1080,v),k=Math.max(30,x);S=Oe(S)?S:t,t=Math.max(S,t),p||(e=void 0);const U=r.length>1;return{codecSet:r.reduce((F,j)=>{const M=i[j];if(j===F)return F;if(A=p?_.filter(H=>M.videoRanges[H]>0):[],U){if(M.minBitrate>t)return en(j,`min bitrate of ${M.minBitrate} > current estimate of ${t}`),F;if(!M.hasDefaultAudio)return en(j,"no renditions with default or auto-select sound found"),F;if(c&&j.indexOf(c.substring(0,4))%5!==0)return en(j,`audio codec preference "${c}" not found`),F;if(l&&!u){if(!M.channels[l])return en(j,`no renditions with ${l} channel sound found (channels options: ${Object.keys(M.channels)})`),F}else if((!c||u)&&f&&M.channels[2]===0)return en(j,"no renditions with stereo sound found"),F;if(M.minHeight>C)return en(j,`min resolution of ${M.minHeight} > maximum of ${C}`),F;if(M.minFramerate>k)return en(j,`min framerate of ${M.minFramerate} > maximum of ${k}`),F;if(!A.some(H=>M.videoRanges[H]>0))return en(j,`no variants with VIDEO-RANGE of ${Ot(A)} found`),F;if(h&&j.indexOf(h.substring(0,4))%5!==0)return en(j,`video codec preference "${h}" not found`),F;if(M.maxScore<T)return en(j,`max score of ${M.maxScore} < selected max of ${T}`),F}return F&&(du(j)>=du(F)||M.fragmentError>i[F].fragmentError)?F:(E=M.minIndex,T=M.maxScore,j)},void 0),videoRanges:A,preferHDR:I,minFramerate:x,minBitrate:S,minIndex:E}}function en(i,e){St.log(`[abr] start candidates with "${i}" ignored because ${e}`)}function jS(i){return i.reduce((e,t)=>{let s=e.groups[t.groupId];s||(s=e.groups[t.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),s.tracks.push(t);const n=t.channels||"2";return s.channels[n]=(s.channels[n]||0)+1,s.hasDefault=s.hasDefault||t.default,s.hasAutoSelect=s.hasAutoSelect||t.autoselect,s.hasDefault&&(e.hasDefaultAudio=!0),s.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function J1(i,e,t,s){return i.slice(t,s+1).reduce((n,r,l)=>{if(!r.codecSet)return n;const c=r.audioGroups;let h=n[r.codecSet];h||(n[r.codecSet]=h={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:l,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!c,fragmentError:0}),h.minBitrate=Math.min(h.minBitrate,r.bitrate);const u=Math.min(r.height,r.width);return h.minHeight=Math.min(h.minHeight,u),h.minFramerate=Math.min(h.minFramerate,r.frameRate),h.minIndex=Math.min(h.minIndex,l),h.maxScore=Math.max(h.maxScore,r.score),h.fragmentError+=r.fragmentError,h.videoRanges[r.videoRange]=(h.videoRanges[r.videoRange]||0)+1,c&&c.forEach(f=>{if(!f)return;const p=e.groups[f];p&&(h.hasDefaultAudio=h.hasDefaultAudio||e.hasDefaultAudio?p.hasDefault:p.hasAutoSelect||!e.hasDefaultAudio&&!e.hasAutoSelectAudio,Object.keys(p.channels).forEach(v=>{h.channels[v]=(h.channels[v]||0)+p.channels[v]}))}),n},{})}function Ty(i){if(!i)return i;const{lang:e,assocLang:t,characteristics:s,channels:n,audioCodec:r}=i;return{lang:e,assocLang:t,characteristics:s,channels:n,audioCodec:r}}function an(i,e,t){if("attrs"in i){const s=e.indexOf(i);if(s!==-1)return s}for(let s=0;s<e.length;s++){const n=e[s];if(Ga(i,n,t))return s}return-1}function Ga(i,e,t){const{groupId:s,name:n,lang:r,assocLang:l,default:c}=i,h=i.forced;return(s===void 0||e.groupId===s)&&(n===void 0||e.name===n)&&(r===void 0||ew(r,e.lang))&&(r===void 0||e.assocLang===l)&&(c===void 0||e.default===c)&&(h===void 0||e.forced===h)&&(!("characteristics"in i)||tw(i.characteristics||"",e.characteristics))&&(t===void 0||t(i,e))}function ew(i,e="--"){return i.length===e.length?i===e:i.startsWith(e)||e.startsWith(i)}function tw(i,e=""){const t=i.split(","),s=e.split(",");return t.length===s.length&&!t.some(n=>s.indexOf(n)===-1)}function Ba(i,e){const{audioCodec:t,channels:s}=i;return(t===void 0||(e.audioCodec||"").substring(0,4)===t.substring(0,4))&&(s===void 0||s===(e.channels||"2"))}function sw(i,e,t,s,n){const r=e[s],c=e.reduce((v,x,S)=>{const E=x.uri;return(v[E]||(v[E]=[])).push(S),v},{})[r.uri];c.length>1&&(s=Math.max.apply(Math,c));const h=r.videoRange,u=r.frameRate,f=r.codecSet.substring(0,4),p=Ey(e,s,v=>{if(v.videoRange!==h||v.frameRate!==u||v.codecSet.substring(0,4)!==f)return!1;const x=v.audioGroups,S=t.filter(E=>!x||x.indexOf(E.groupId)!==-1);return an(i,S,n)>-1});return p>-1?p:Ey(e,s,v=>{const x=v.audioGroups,S=t.filter(E=>!x||x.indexOf(E.groupId)!==-1);return an(i,S,n)>-1})}function Ey(i,e,t){for(let s=e;s>-1;s--)if(t(i[s]))return s;for(let s=e+1;s<i.length;s++)if(t(i[s]))return s;return-1}function mu(i,e){var t;return!!i&&i!==((t=e.loadLevelObj)==null?void 0:t.uri)}class iw extends Pi{constructor(e){super("abr",e.logger),this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.rebufferNotice=-1,this.supportedCache={},this.bwEstimator=void 0,this._abandonRulesCheck=t=>{var s;const{fragCurrent:n,partCurrent:r,hls:l}=this,{autoLevelEnabled:c,media:h}=l;if(!n||!h)return;const u=performance.now(),f=r?r.stats:n.stats,p=r?r.duration:n.duration,v=u-f.loading.start,x=l.minAutoLevel,S=n.level,E=this._nextAutoLevel;if(f.aborted||f.loaded&&f.loaded===f.total||S<=x){this.clearTimer(),this._nextAutoLevel=-1;return}if(!c)return;const T=E>-1&&E!==S,A=!!t||T;if(!A&&(h.paused||!h.playbackRate||!h.readyState))return;const I=l.mainForwardBufferInfo;if(!A&&I===null)return;const _=this.bwEstimator.getEstimateTTFB(),C=Math.abs(h.playbackRate);if(v<=Math.max(_,1e3*(p/(C*2))))return;const k=I?I.len/C:0,U=f.loading.first?f.loading.first-f.loading.start:-1,O=f.loaded&&U>-1,F=this.getBwEstimate(),j=l.levels,M=j[S],H=Math.max(f.loaded,Math.round(p*(n.bitrate||M.averageBitrate)/8));let K=O?v-U:v;K<1&&O&&(K=Math.min(v,f.loaded*8/F));const te=O?f.loaded*1e3/K:0,ae=_/1e3,me=te?(H-f.loaded)/te:H*8/F+ae;if(me<=k)return;const D=te?te*8:F,G=((s=t?.details||this.hls.latestLevelDetails)==null?void 0:s.live)===!0,Y=this.hls.config.abrBandWidthUpFactor;let oe=Number.POSITIVE_INFINITY,pe;for(pe=S-1;pe>x;pe--){const he=j[pe].maxBitrate,ye=!j[pe].details||G;if(oe=this.getTimeToLoadFrag(ae,D,p*he,ye),oe<Math.min(k,p+ae))break}if(oe>=me||oe>p*10)return;O?this.bwEstimator.sample(v-Math.min(_,U),f.loaded):this.bwEstimator.sampleTTFB(v);const P=j[pe].maxBitrate;this.getBwEstimate()*Y>P&&this.resetEstimator(P);const V=this.findBestLevel(P,x,pe,0,k,1,1);V>-1&&(pe=V),this.warn(`Fragment ${n.sn}${r?" part "+r.index:""} of level ${S} is loading too slowly;
      Fragment duration: ${n.duration.toFixed(3)}
      Time to underbuffer: ${k.toFixed(3)} s
      Estimated load time for current fragment: ${me.toFixed(3)} s
      Estimated load time for down switch fragment: ${oe.toFixed(3)} s
      TTFB estimate: ${U|0} ms
      Current BW estimate: ${Oe(F)?F|0:"Unknown"} bps
      New BW estimate: ${this.getBwEstimate()|0} bps
      Switching to level ${pe} @ ${P|0} bps`),l.nextLoadLevel=l.nextAutoLevel=pe,this.clearTimer();const se=()=>{if(this.clearTimer(),this.fragCurrent===n&&this.hls.loadLevel===pe&&pe>0){const he=this.getStarvationDelay();if(this.warn(`Aborting inflight request ${pe>0?"and switching down":""}
      Fragment duration: ${n.duration.toFixed(3)} s
      Time to underbuffer: ${he.toFixed(3)} s`),n.abortRequests(),this.fragCurrent=this.partCurrent=null,pe>x){let ye=this.findBestLevel(this.hls.levels[x].bitrate,x,pe,0,he,1,1);ye===-1&&(ye=x),this.hls.nextLoadLevel=this.hls.nextAutoLevel=ye,this.resetEstimator(this.hls.levels[ye].bitrate)}}};T||me>oe*2?se():this.timer=self.setInterval(se,oe*1e3),l.trigger(L.FRAG_LOAD_EMERGENCY_ABORTED,{frag:n,part:r,stats:f})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(this.log(`setting initial bwe to ${e}`),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const e=this.hls.config;return new o1(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){const{hls:e}=this;e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.FRAG_LOADING,this.onFragLoading,this),e.on(L.FRAG_LOADED,this.onFragLoaded,this),e.on(L.FRAG_BUFFERED,this.onFragBuffered,this),e.on(L.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(L.LEVEL_LOADED,this.onLevelLoaded,this),e.on(L.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(L.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(L.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e&&(e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.FRAG_LOADING,this.onFragLoading,this),e.off(L.FRAG_LOADED,this.onFragLoaded,this),e.off(L.FRAG_BUFFERED,this.onFragBuffered,this),e.off(L.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(L.LEVEL_LOADED,this.onLevelLoaded,this),e.off(L.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(L.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(L.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=this.supportedCache=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.supportedCache={},this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,t){const s=t.frag;if(!this.ignoreFragment(s)){if(!s.bitrateTest){var n;this.fragCurrent=s,this.partCurrent=(n=t.part)!=null?n:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,t){this.clearTimer()}onError(e,t){if(!t.fatal)switch(t.details){case Q.BUFFER_ADD_CODEC_ERROR:case Q.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case Q.FRAG_LOAD_TIMEOUT:{const s=t.frag,{fragCurrent:n,partCurrent:r}=this;if(s&&n&&s.sn===n.sn&&s.level===n.level){const l=performance.now(),c=r?r.stats:s.stats,h=l-c.loading.start,u=c.loading.first?c.loading.first-c.loading.start:-1;if(c.loaded&&u>-1){const p=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(h-Math.min(p,u),c.loaded)}else this.bwEstimator.sampleTTFB(h)}break}}}getTimeToLoadFrag(e,t,s,n){const r=e+s/t,l=n?e+this.lastLevelLoadSec:0;return r+l}onLevelLoaded(e,t){const s=this.hls.config,{loading:n}=t.stats,r=n.end-n.first;Oe(r)&&(this.lastLevelLoadSec=r/1e3),t.details.live?this.bwEstimator.update(s.abrEwmaSlowLive,s.abrEwmaFastLive):this.bwEstimator.update(s.abrEwmaSlowVoD,s.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(t.levelInfo)}onFragLoaded(e,{frag:t,part:s}){const n=s?s.stats:t.stats;if(t.type===ke.MAIN&&this.bwEstimator.sampleTTFB(n.loading.first-n.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),t.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const r=s?s.duration:t.duration,l=this.hls.levels[t.level],c=(l.loaded?l.loaded.bytes:0)+n.loaded,h=(l.loaded?l.loaded.duration:0)+r;l.loaded={bytes:c,duration:h},l.realBitrate=Math.round(8*c/h)}if(t.bitrateTest){const r={stats:n,frag:t,part:s,id:t.type};this.onFragBuffered(L.FRAG_BUFFERED,r),t.bitrateTest=!1}else this.lastLoadedFragLevel=t.level}}onFragBuffered(e,t){const{frag:s,part:n}=t,r=n!=null&&n.stats.loaded?n.stats:s.stats;if(r.aborted||this.ignoreFragment(s))return;const l=r.parsing.end-r.loading.start-Math.min(r.loading.first-r.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(l,r.loaded),r.bwEstimate=this.getBwEstimate(),s.bitrateTest?this.bitrateTestDelay=l/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==ke.MAIN||e.sn==="initSegment"}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:e,minAutoLevel:t}=this.hls,s=this.getBwEstimate(),n=this.hls.config.maxStarvationDelay,r=this.findBestLevel(s,t,e,0,n,1,1);if(r>-1)return r;const l=this.hls.firstLevel,c=Math.min(Math.max(l,t),e);return this.warn(`Could not find best starting auto level. Defaulting to first in playlist ${l} clamped to ${c}`),c}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const e=this.forcedAutoLevel,s=this.bwEstimator.canEstimate(),n=this.lastLoadedFragLevel>-1;if(e!==-1&&(!s||!n||this.nextAutoLevelKey===this.getAutoLevelKey()))return e;const r=s&&n?this.getNextABRAutoLevel():this.firstAutoLevel;if(e!==-1){const l=this.hls.levels;if(l.length>Math.max(e,r)&&l[e].loadError<=l[r].loadError)return e}return this._nextAutoLevel=r,this.nextAutoLevelKey=this.getAutoLevelKey(),r}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:t,hls:s}=this;if(s.levels.length<=1)return s.loadLevel;const{maxAutoLevel:n,config:r,minAutoLevel:l}=s,c=t?t.duration:e?e.duration:0,h=this.getBwEstimate(),u=this.getStarvationDelay();let f=r.abrBandWidthFactor,p=r.abrBandWidthUpFactor;if(u){const T=this.findBestLevel(h,l,n,u,0,f,p);if(T>=0)return this.rebufferNotice=-1,T}let v=c?Math.min(c,r.maxStarvationDelay):r.maxStarvationDelay;if(!u){const T=this.bitrateTestDelay;T&&(v=(c?Math.min(c,r.maxLoadingDelay):r.maxLoadingDelay)-T,this.info(`bitrate test took ${Math.round(1e3*T)}ms, set first fragment max fetchDuration to ${Math.round(1e3*v)} ms`),f=p=1)}const x=this.findBestLevel(h,l,n,u,v,f,p);if(this.rebufferNotice!==x&&(this.rebufferNotice=x,this.info(`${u?"rebuffering expected":"buffer is empty"}, optimal quality level ${x}`)),x>-1)return x;const S=s.levels[l],E=s.loadLevelObj;return E&&S?.bitrate<E.bitrate?l:s.loadLevel}getStarvationDelay(){const e=this.hls,t=e.media;if(!t)return 1/0;const s=t&&t.playbackRate!==0?Math.abs(t.playbackRate):1,n=e.mainForwardBufferInfo;return(n?n.len:0)/s}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,t,s,n,r,l,c){var h;const u=n+r,f=this.lastLoadedFragLevel,p=f===-1?this.hls.firstLevel:f,{fragCurrent:v,partCurrent:x}=this,{levels:S,allAudioTracks:E,loadLevel:T,config:A}=this.hls;if(S.length===1)return 0;const I=S[p],_=!!((h=this.hls.latestLevelDetails)!=null&&h.live),C=T===-1||f===-1;let k,U="SDR",O=I?.frameRate||0;const{audioPreference:F,videoPreference:j}=A,M=this.audioTracksByGroup||(this.audioTracksByGroup=jS(E));let H=-1;if(C){if(this.firstSelection!==-1)return this.firstSelection;const D=this.codecTiers||(this.codecTiers=J1(S,M,t,s)),G=Z1(D,U,e,F,j),{codecSet:Y,videoRanges:oe,minFramerate:pe,minBitrate:P,minIndex:V,preferHDR:se}=G;H=V,k=Y,U=se?oe[oe.length-1]:oe[0],O=pe,e=Math.max(e,P),this.log(`picked start tier ${Ot(G)}`)}else k=I?.codecSet,U=I?.videoRange;const K=x?x.duration:v?v.duration:0,te=this.bwEstimator.getEstimateTTFB()/1e3,ae=[];for(let D=s;D>=t;D--){var me;const G=S[D],Y=D>p;if(!G)continue;if(A.useMediaCapabilities&&!G.supportedResult&&!G.supportedPromise){const ye=navigator.mediaCapabilities;typeof ye?.decodingInfo=="function"&&$1(G,M,U,O,e,F)?(G.supportedPromise=US(G,M,ye,this.supportedCache),G.supportedPromise.then(Ae=>{if(!this.hls)return;G.supportedResult=Ae;const Pe=this.hls.levels,He=Pe.indexOf(G);Ae.error?this.warn(`MediaCapabilities decodingInfo error: "${Ae.error}" for level ${He} ${Ot(Ae)}`):Ae.supported?Ae.decodingInfoResults.some(Be=>Be.smooth===!1||Be.powerEfficient===!1)&&this.log(`MediaCapabilities decodingInfo for level ${He} not smooth or powerEfficient: ${Ot(Ae)}`):(this.warn(`Unsupported MediaCapabilities decodingInfo result for level ${He} ${Ot(Ae)}`),He>-1&&Pe.length>1&&(this.log(`Removing unsupported level ${He}`),this.hls.removeLevel(He),this.hls.loadLevel===-1&&(this.hls.nextLoadLevel=0)))}).catch(Ae=>{this.warn(`Error handling MediaCapabilities decodingInfo: ${Ae}`)})):G.supportedResult=DS}if((k&&G.codecSet!==k||U&&G.videoRange!==U||Y&&O>G.frameRate||!Y&&O>0&&O<G.frameRate||(me=G.supportedResult)!=null&&(me=me.decodingInfoResults)!=null&&me.some(ye=>ye.smooth===!1))&&(!C||D!==H)){ae.push(D);continue}const oe=G.details,pe=(x?oe?.partTarget:oe?.averagetargetduration)||K;let P;Y?P=c*e:P=l*e;const V=K&&n>=K*2&&r===0?G.averageBitrate:G.maxBitrate,se=this.getTimeToLoadFrag(te,P,V*pe,oe===void 0);if(P>=V&&(D===f||G.loadError===0&&G.fragmentError===0)&&(se<=te||!Oe(se)||_&&!this.bitrateTestDelay||se<u)){const ye=this.forcedAutoLevel;return D!==T&&(ye===-1||ye!==T)&&(ae.length&&this.trace(`Skipped level(s) ${ae.join(",")} of ${s} max with CODECS and VIDEO-RANGE:"${S[ae[0]].codecs}" ${S[ae[0]].videoRange}; not compatible with "${k}" ${U}`),this.info(`switch candidate:${p}->${D} adjustedbw(${Math.round(P)})-bitrate=${Math.round(P-V)} ttfb:${te.toFixed(1)} avgDuration:${pe.toFixed(1)} maxFetchDuration:${u.toFixed(1)} fetchDuration:${se.toFixed(1)} firstSelection:${C} codecSet:${G.codecSet} videoRange:${G.videoRange} hls.loadLevel:${T}`)),C&&(this.firstSelection=D),D}}return-1}set nextAutoLevel(e){const t=this.deriveNextAutoLevel(e);this._nextAutoLevel!==t&&(this.nextAutoLevelKey="",this._nextAutoLevel=t)}deriveNextAutoLevel(e){const{maxAutoLevel:t,minAutoLevel:s}=this.hls;return Math.min(Math.max(e,s),t)}}const FS={search:function(i,e){let t=0,s=i.length-1,n=null,r=null;for(;t<=s;){n=(t+s)/2|0,r=i[n];const l=e(r);if(l>0)t=n+1;else if(l<0)s=n-1;else return r}return null}};function nw(i,e,t){if(e===null||!Array.isArray(i)||!i.length||!Oe(e))return null;const s=i[0].programDateTime;if(e<(s||0))return null;const n=i[i.length-1].endProgramDateTime;if(e>=(n||0))return null;for(let r=0;r<i.length;++r){const l=i[r];if(rw(e,t,l))return l}return null}function za(i,e,t=0,s=0,n=.005){let r=null;if(i){r=e[1+i.sn-e[0].sn]||null;const c=i.endDTS-t;c>0&&c<15e-7&&(t+=15e-7),r&&i.level!==r.level&&r.end<=i.end&&(r=e[2+i.sn-e[0].sn]||null)}else t===0&&e[0].start===0&&(r=e[0]);if(r&&((!i||i.level===r.level)&&Ay(t,s,r)===0||aw(r,i,Math.min(n,s))))return r;const l=FS.search(e,Ay.bind(null,t,s));return l&&(l!==i||!r)?l:r}function aw(i,e,t){if(e&&e.start===0&&e.level<i.level&&(e.endPTS||0)>0){const s=e.tagList.reduce((n,r)=>(r[0]==="INF"&&(n+=parseFloat(r[1])),n),t);return i.start<=s}return!1}function Ay(i=0,e=0,t){if(t.start<=i&&t.start+t.duration>i)return 0;const s=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0));return t.start+t.duration-s<=i?1:t.start-s>i&&t.start?-1:0}function rw(i,e,t){const s=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0))*1e3;return(t.endProgramDateTime||0)-s>i}function BS(i,e,t){if(i&&i.startCC<=e&&i.endCC>=e){let s=i.fragments;const{fragmentHint:n}=i;n&&(s=s.concat(n));let r;return FS.search(s,l=>l.cc<e?1:l.cc>e?-1:(r=l,l.end<=t?1:l.start>t?-1:0)),r||null}return null}function pu(i){switch(i.details){case Q.FRAG_LOAD_TIMEOUT:case Q.KEY_LOAD_TIMEOUT:case Q.LEVEL_LOAD_TIMEOUT:case Q.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function VS(i){return i.details.startsWith("key")}function $S(i){return VS(i)&&!!i.frag&&!i.frag.decryptdata}function Iy(i,e){const t=pu(e);return i.default[`${t?"timeout":"error"}Retry`]}function xm(i,e){const t=i.backoff==="linear"?1:Math.pow(2,e);return Math.min(t*i.retryDelayMs,i.maxRetryDelayMs)}function _y(i){return xt(xt({},i),{errorRetry:null,timeoutRetry:null})}function gu(i,e,t,s){if(!i)return!1;const n=s?.code,r=e<i.maxNumRetry&&(lw(n)||!!t);return i.shouldRetry?i.shouldRetry(i,e,t,s,r):r}function lw(i){return jf(i)||!!i&&(i<400||i>499)}function jf(i){return i===0&&navigator.onLine===!1}var Rs={DoNothing:0,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,RetryRequest:5},hi={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,MoveAllAlternatesMatchingKey:4};class ow extends Pi{constructor(e){super("error-controller",e.logger),this.hls=void 0,this.playlistError=0,this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(L.ERROR,this.onError,this),e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off(L.ERROR,this.onError,this),e.off(L.ERROR,this.onErrorOut,this),e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return e?.type===ke.MAIN?e.level:this.getVariantIndex()}getVariantIndex(){var e;const t=this.hls,s=t.currentLevel;return(e=t.loadLevelObj)!=null&&e.details||s===-1?t.loadLevel:s}variantHasKey(e,t){if(e){var s;if((s=e.details)!=null&&s.hasKey(t))return!0;const n=e.audioGroups;if(n)return this.hls.allAudioTracks.filter(l=>n.indexOf(l.groupId)>=0).some(l=>{var c;return(c=l.details)==null?void 0:c.hasKey(t)})}return!1}onManifestLoading(){this.playlistError=0}onLevelUpdated(){this.playlistError=0}onError(e,t){var s;if(t.fatal)return;const n=this.hls,r=t.context;switch(t.details){case Q.FRAG_LOAD_ERROR:case Q.FRAG_LOAD_TIMEOUT:case Q.KEY_LOAD_ERROR:case Q.KEY_LOAD_TIMEOUT:t.errorAction=this.getFragRetryOrSwitchAction(t);return;case Q.FRAG_PARSING_ERROR:if((s=t.frag)!=null&&s.gap){t.errorAction=Mr();return}case Q.FRAG_GAP:case Q.FRAG_DECRYPT_ERROR:{t.errorAction=this.getFragRetryOrSwitchAction(t),t.errorAction.action=Rs.SendAlternateToPenaltyBox;return}case Q.LEVEL_EMPTY_ERROR:case Q.LEVEL_PARSING_ERROR:{var l;const h=t.parent===ke.MAIN?t.level:n.loadLevel;t.details===Q.LEVEL_EMPTY_ERROR&&((l=t.context)!=null&&(l=l.levelDetails)!=null&&l.live)?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,h):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,h))}return;case Q.LEVEL_LOAD_ERROR:case Q.LEVEL_LOAD_TIMEOUT:typeof r?.level=="number"&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,r.level));return;case Q.AUDIO_TRACK_LOAD_ERROR:case Q.AUDIO_TRACK_LOAD_TIMEOUT:case Q.SUBTITLE_LOAD_ERROR:case Q.SUBTITLE_TRACK_LOAD_TIMEOUT:if(r){const h=n.loadLevelObj;if(h&&(r.type===nt.AUDIO_TRACK&&h.hasAudioGroup(r.groupId)||r.type===nt.SUBTITLE_TRACK&&h.hasSubtitleGroup(r.groupId))){t.errorAction=this.getPlaylistRetryOrSwitchAction(t,n.loadLevel),t.errorAction.action=Rs.SendAlternateToPenaltyBox,t.errorAction.flags=hi.MoveAllAlternatesMatchingHost;return}}return;case Q.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:t.errorAction={action:Rs.SendAlternateToPenaltyBox,flags:hi.MoveAllAlternatesMatchingHDCP};return;case Q.KEY_SYSTEM_SESSION_UPDATE_FAILED:case Q.KEY_SYSTEM_STATUS_INTERNAL_ERROR:case Q.KEY_SYSTEM_NO_SESSION:t.errorAction={action:Rs.SendAlternateToPenaltyBox,flags:hi.MoveAllAlternatesMatchingKey};return;case Q.BUFFER_ADD_CODEC_ERROR:case Q.REMUX_ALLOC_ERROR:case Q.BUFFER_APPEND_ERROR:if(!t.errorAction){var c;t.errorAction=this.getLevelSwitchAction(t,(c=t.level)!=null?c:n.loadLevel)}return;case Q.INTERNAL_EXCEPTION:case Q.BUFFER_APPENDING_ERROR:case Q.BUFFER_FULL_ERROR:case Q.LEVEL_SWITCH_ERROR:case Q.BUFFER_STALLED_ERROR:case Q.BUFFER_SEEK_OVER_HOLE:case Q.BUFFER_NUDGE_ON_STALL:t.errorAction=Mr();return}t.type===Fe.KEY_SYSTEM_ERROR&&(t.levelRetry=!1,t.errorAction=Mr())}getPlaylistRetryOrSwitchAction(e,t){const s=this.hls,n=Iy(s.config.playlistLoadPolicy,e),r=this.playlistError++;if(gu(n,r,pu(e),e.response))return{action:Rs.RetryRequest,flags:hi.None,retryConfig:n,retryCount:r};const c=this.getLevelSwitchAction(e,t);return n&&(c.retryConfig=n,c.retryCount=r),c}getFragRetryOrSwitchAction(e){const t=this.hls,s=this.getVariantLevelIndex(e.frag),n=t.levels[s],{fragLoadPolicy:r,keyLoadPolicy:l}=t.config,c=Iy(VS(e)?l:r,e),h=t.levels.reduce((f,p)=>f+p.fragmentError,0);if(n&&(e.details!==Q.FRAG_GAP&&n.fragmentError++,!$S(e)&&gu(c,h,pu(e),e.response)))return{action:Rs.RetryRequest,flags:hi.None,retryConfig:c,retryCount:h};const u=this.getLevelSwitchAction(e,s);return c&&(u.retryConfig=c,u.retryCount=h),u}getLevelSwitchAction(e,t){const s=this.hls;t==null&&(t=s.loadLevel);const n=this.hls.levels[t];if(n){var r,l;const u=e.details;n.loadError++,u===Q.BUFFER_APPEND_ERROR&&n.fragmentError++;let f=-1;const{levels:p,loadLevel:v,minAutoLevel:x,maxAutoLevel:S}=s;!s.autoLevelEnabled&&!s.config.preserveManualLevelOnError&&(s.loadLevel=-1);const E=(r=e.frag)==null?void 0:r.type,A=(E===ke.AUDIO&&u===Q.FRAG_PARSING_ERROR||e.sourceBufferName==="audio"&&(u===Q.BUFFER_ADD_CODEC_ERROR||u===Q.BUFFER_APPEND_ERROR))&&p.some(({audioCodec:U})=>n.audioCodec!==U),_=e.sourceBufferName==="video"&&(u===Q.BUFFER_ADD_CODEC_ERROR||u===Q.BUFFER_APPEND_ERROR)&&p.some(({codecSet:U,audioCodec:O})=>n.codecSet!==U&&n.audioCodec===O),{type:C,groupId:k}=(l=e.context)!=null?l:{};for(let U=p.length;U--;){const O=(U+v)%p.length;if(O!==v&&O>=x&&O<=S&&p[O].loadError===0){var c,h;const F=p[O];if(u===Q.FRAG_GAP&&E===ke.MAIN&&e.frag){const j=p[O].details;if(j){const M=za(e.frag,j.fragments,e.frag.start);if(M!=null&&M.gap)continue}}else{if(C===nt.AUDIO_TRACK&&F.hasAudioGroup(k)||C===nt.SUBTITLE_TRACK&&F.hasSubtitleGroup(k))continue;if(E===ke.AUDIO&&(c=n.audioGroups)!=null&&c.some(j=>F.hasAudioGroup(j))||E===ke.SUBTITLE&&(h=n.subtitleGroups)!=null&&h.some(j=>F.hasSubtitleGroup(j))||A&&n.audioCodec===F.audioCodec||_&&n.codecSet===F.codecSet||!A&&n.codecSet!==F.codecSet)continue}f=O;break}}if(f>-1&&s.loadLevel!==f)return e.levelRetry=!0,this.playlistError=0,{action:Rs.SendAlternateToPenaltyBox,flags:hi.None,nextAutoLevel:f}}return{action:Rs.SendAlternateToPenaltyBox,flags:hi.MoveAllAlternatesMatchingHost}}onErrorOut(e,t){var s;switch((s=t.errorAction)==null?void 0:s.action){case Rs.DoNothing:break;case Rs.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(t),!t.errorAction.resolved&&t.details!==Q.FRAG_GAP?t.fatal=!0:/MediaSource readyState: ended/.test(t.error.message)&&(this.warn(`MediaSource ended after "${t.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError());break}if(t.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(e){const t=this.hls,s=e.errorAction;if(!s)return;const{flags:n}=s,r=s.nextAutoLevel;switch(n){case hi.None:this.switchLevel(e,r);break;case hi.MoveAllAlternatesMatchingHDCP:{const h=this.getVariantLevelIndex(e.frag),u=t.levels[h],f=u?.attrs["HDCP-LEVEL"];if(s.hdcpLevel=f,f==="NONE")this.warn("HDCP policy resticted output with HDCP-LEVEL=NONE");else if(f){t.maxHdcpLevel=Mf[Mf.indexOf(f)-1],s.resolved=!0,this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`);break}}case hi.MoveAllAlternatesMatchingKey:{const h=e.decryptdata;if(h){const u=this.hls.levels,f=u.length;for(let v=f;v--;)if(this.variantHasKey(u[v],h)){var l,c;this.log(`Banned key found in level ${v} (${u[v].bitrate}bps) or audio group "${(l=u[v].audioGroups)==null?void 0:l.join(",")}" (${(c=e.frag)==null?void 0:c.type} fragment) ${Ls(h.keyId||[])}`),u[v].fragmentError++,u[v].loadError++,this.log(`Removing level ${v} with key error (${e.error})`),this.hls.removeLevel(v)}const p=e.frag;if(this.hls.levels.length<f)s.resolved=!0;else if(p&&p.type!==ke.MAIN){const v=p.decryptdata;v&&!h.matches(v)&&(s.resolved=!0)}}break}}s.resolved||this.switchLevel(e,r)}switchLevel(e,t){if(t!==void 0&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,e.details===Q.BUFFER_ADD_CODEC_ERROR&&e.mimeType&&e.sourceBufferName!=="audiovideo")){const s=Uf(e.mimeType),n=this.hls.levels;for(let r=n.length;r--;)n[r][`${e.sourceBufferName}Codec`]===s&&(this.log(`Removing level ${r} for ${e.details} ("${s}" not supported)`),this.hls.removeLevel(r))}}}function Mr(i){const e={action:Rs.DoNothing,flags:hi.None};return i&&(e.resolved=!0),e}var hs={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class cw{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e&&(e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.BUFFER_APPENDED,this.onBufferAppended,this),e.on(L.FRAG_BUFFERED,this.onFragBuffered,this),e.on(L.FRAG_LOADED,this.onFragLoaded,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.BUFFER_APPENDED,this.onBufferAppended,this),e.off(L.FRAG_BUFFERED,this.onFragBuffered,this),e.off(L.FRAG_LOADED,this.onFragLoaded,this))}destroy(){this._unregisterListeners(),this.hls=this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){const s=this.activePartLists[t];if(s)for(let n=s.length;n--;){const r=s[n];if(!r)break;if(r.start<=e&&e<=r.end&&r.loaded)return r}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){return this.getFragAtPos(e,t,!0)}getFragAtPos(e,t,s){const{fragments:n}=this,r=Object.keys(n);for(let l=r.length;l--;){const c=n[r[l]];if(c?.body.type===t&&(!s||c.buffered)){const h=c.body;if(h.start<=e&&e<=h.end)return h}}return null}detectEvictedFragments(e,t,s,n,r){this.timeRanges&&(this.timeRanges[e]=t);const l=n?.fragment.sn||-1;Object.keys(this.fragments).forEach(c=>{const h=this.fragments[c];if(!h||l>=h.body.sn)return;if(!h.buffered&&(!h.loaded||r)){h.body.type===s&&this.removeFragment(h.body);return}const u=h.range[e];if(u){if(u.time.length===0){this.removeFragment(h.body);return}u.time.some(f=>{const p=!this.isTimeBuffered(f.startPTS,f.endPTS,t);return p&&this.removeFragment(h.body),p})}})}detectPartialFragments(e){const t=this.timeRanges;if(!t||e.frag.sn==="initSegment")return;const s=e.frag,n=Or(s),r=this.fragments[n];if(!r||r.buffered&&s.gap)return;const l=!s.relurl;Object.keys(t).forEach(c=>{const h=s.elementaryStreams[c];if(!h)return;const u=t[c],f=l||h.partial===!0;r.range[c]=this.getBufferedTimes(s,e.part,f,u)}),r.loaded=null,Object.keys(r.range).length?(this.bufferedEnd(r,s),Dc(r)||this.removeParts(s.sn-1,s.type)):this.removeFragment(r.body)}bufferedEnd(e,t){e.buffered=!0,(e.body.endList=t.endList||e.body.endList)&&(this.endListFragments[e.body.type]=e)}removeParts(e,t){const s=this.activePartLists[t];s&&(this.activePartLists[t]=Ry(s,n=>n.fragment.sn>=e))}fragBuffered(e,t){const s=Or(e);let n=this.fragments[s];!n&&t&&(n=this.fragments[s]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),n&&(n.loaded=null,this.bufferedEnd(n,e))}getBufferedTimes(e,t,s,n){const r={time:[],partial:s},l=e.start,c=e.end,h=e.minEndPTS||c,u=e.maxStartPTS||l;for(let f=0;f<n.length;f++){const p=n.start(f)-this.bufferPadding,v=n.end(f)+this.bufferPadding;if(u>=p&&h<=v){r.time.push({startPTS:Math.max(l,n.start(f)),endPTS:Math.min(c,n.end(f))});break}else if(l<v&&c>p){const x=Math.max(l,n.start(f)),S=Math.min(c,n.end(f));S>x&&(r.partial=!0,r.time.push({startPTS:x,endPTS:S}))}else if(c<=p)break}return r}getPartialFragment(e){let t=null,s,n,r,l=0;const{bufferPadding:c,fragments:h}=this;return Object.keys(h).forEach(u=>{const f=h[u];f&&Dc(f)&&(n=f.body.start-c,r=f.body.end+c,e>=n&&e<=r&&(s=Math.min(e-n,r-e),l<=s&&(t=f.body,l=s)))}),t}isEndListAppended(e){const t=this.endListFragments[e];return t!==void 0&&(t.buffered||Dc(t))}getState(e){const t=Or(e),s=this.fragments[t];return s?s.buffered?Dc(s)?hs.PARTIAL:hs.OK:hs.APPENDING:hs.NOT_LOADED}isTimeBuffered(e,t,s){let n,r;for(let l=0;l<s.length;l++){if(n=s.start(l)-this.bufferPadding,r=s.end(l)+this.bufferPadding,e>=n&&t<=r)return!0;if(t<=n)return!1}return!1}onManifestLoading(){this.removeAllFragments()}onFragLoaded(e,t){if(t.frag.sn==="initSegment"||t.frag.bitrateTest)return;const s=t.frag,n=t.part?null:t,r=Or(s);this.fragments[r]={body:s,appendedPTS:null,loaded:n,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){const{frag:s,part:n,timeRanges:r,type:l}=t;if(s.sn==="initSegment")return;const c=s.type;if(n){let u=this.activePartLists[c];u||(this.activePartLists[c]=u=[]),u.push(n)}this.timeRanges=r;const h=r[l];this.detectEvictedFragments(l,h,c,n)}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){const t=Or(e);return!!this.fragments[t]}hasFragments(e){const{fragments:t}=this,s=Object.keys(t);if(!e)return s.length>0;for(let n=s.length;n--;){const r=t[s[n]];if(r?.body.type===e)return!0}return!1}hasParts(e){var t;return!!((t=this.activePartLists[e])!=null&&t.length)}removeFragmentsInRange(e,t,s,n,r){n&&!this.hasGaps||Object.keys(this.fragments).forEach(l=>{const c=this.fragments[l];if(!c)return;const h=c.body;h.type!==s||n&&!h.gap||h.start<t&&h.end>e&&(c.buffered||r)&&this.removeFragment(h)})}removeFragment(e){const t=Or(e);e.clearElementaryStreamInfo();const s=this.activePartLists[e.type];if(s){const n=e.sn;this.activePartLists[e.type]=Ry(s,r=>r.fragment.sn!==n)}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){var e;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;const t=(e=this.hls)==null||(e=e.latestLevelDetails)==null?void 0:e.partList;t&&t.forEach(s=>s.clearElementaryStreamInfo())}}function Dc(i){var e,t,s;return i.buffered&&!!(i.body.gap||(e=i.range.video)!=null&&e.partial||(t=i.range.audio)!=null&&t.partial||(s=i.range.audiovideo)!=null&&s.partial)}function Or(i){return`${i.type}_${i.level}_${i.sn}`}function Ry(i,e){return i.filter(t=>{const s=e(t);return s||t.clearElementaryStreamInfo(),s})}var xa={cbc:0,ctr:1};class uw{constructor(e,t,s){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=e,this.aesIV=t,this.aesMode=s}decrypt(e,t){switch(this.aesMode){case xa.cbc:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e);case xa.ctr:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},t,e);default:throw new Error(`[AESCrypto] invalid aes mode ${this.aesMode}`)}}}function dw(i){const e=i.byteLength,t=e&&new DataView(i.buffer).getUint8(e-1);return t?i.slice(0,e-t):i}class hw{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),s=new Uint32Array(4);for(let n=0;n<4;n++)s[n]=t.getUint32(n*4);return s}initTable(){const e=this.sBox,t=this.invSBox,s=this.subMix,n=s[0],r=s[1],l=s[2],c=s[3],h=this.invSubMix,u=h[0],f=h[1],p=h[2],v=h[3],x=new Uint32Array(256);let S=0,E=0,T=0;for(T=0;T<256;T++)T<128?x[T]=T<<1:x[T]=T<<1^283;for(T=0;T<256;T++){let A=E^E<<1^E<<2^E<<3^E<<4;A=A>>>8^A&255^99,e[S]=A,t[A]=S;const I=x[S],_=x[I],C=x[_];let k=x[A]*257^A*16843008;n[S]=k<<24|k>>>8,r[S]=k<<16|k>>>16,l[S]=k<<8|k>>>24,c[S]=k,k=C*16843009^_*65537^I*257^S*16843008,u[A]=k<<24|k>>>8,f[A]=k<<16|k>>>16,p[A]=k<<8|k>>>24,v[A]=k,S?(S=I^x[x[x[C^I]]],E^=x[x[E]]):S=E=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let s=!0,n=0;for(;n<t.length&&s;)s=t[n]===this.key[n],n++;if(s)return;this.key=t;const r=this.keySize=t.length;if(r!==4&&r!==6&&r!==8)throw new Error("Invalid aes key size="+r);const l=this.ksRows=(r+6+1)*4;let c,h;const u=this.keySchedule=new Uint32Array(l),f=this.invKeySchedule=new Uint32Array(l),p=this.sBox,v=this.rcon,x=this.invSubMix,S=x[0],E=x[1],T=x[2],A=x[3];let I,_;for(c=0;c<l;c++){if(c<r){I=u[c]=t[c];continue}_=I,c%r===0?(_=_<<8|_>>>24,_=p[_>>>24]<<24|p[_>>>16&255]<<16|p[_>>>8&255]<<8|p[_&255],_^=v[c/r|0]<<24):r>6&&c%r===4&&(_=p[_>>>24]<<24|p[_>>>16&255]<<16|p[_>>>8&255]<<8|p[_&255]),u[c]=I=(u[c-r]^_)>>>0}for(h=0;h<l;h++)c=l-h,h&3?_=u[c]:_=u[c-4],h<4||c<=4?f[h]=_:f[h]=S[p[_>>>24]]^E[p[_>>>16&255]]^T[p[_>>>8&255]]^A[p[_&255]],f[h]=f[h]>>>0}networkToHostOrderSwap(e){return e<<24|(e&65280)<<8|(e&16711680)>>8|e>>>24}decrypt(e,t,s){const n=this.keySize+6,r=this.invKeySchedule,l=this.invSBox,c=this.invSubMix,h=c[0],u=c[1],f=c[2],p=c[3],v=this.uint8ArrayToUint32Array_(s);let x=v[0],S=v[1],E=v[2],T=v[3];const A=new Int32Array(e),I=new Int32Array(A.length);let _,C,k,U,O,F,j,M,H,K,te,ae,me,D;const G=this.networkToHostOrderSwap;for(;t<A.length;){for(H=G(A[t]),K=G(A[t+1]),te=G(A[t+2]),ae=G(A[t+3]),O=H^r[0],F=ae^r[1],j=te^r[2],M=K^r[3],me=4,D=1;D<n;D++)_=h[O>>>24]^u[F>>16&255]^f[j>>8&255]^p[M&255]^r[me],C=h[F>>>24]^u[j>>16&255]^f[M>>8&255]^p[O&255]^r[me+1],k=h[j>>>24]^u[M>>16&255]^f[O>>8&255]^p[F&255]^r[me+2],U=h[M>>>24]^u[O>>16&255]^f[F>>8&255]^p[j&255]^r[me+3],O=_,F=C,j=k,M=U,me=me+4;_=l[O>>>24]<<24^l[F>>16&255]<<16^l[j>>8&255]<<8^l[M&255]^r[me],C=l[F>>>24]<<24^l[j>>16&255]<<16^l[M>>8&255]<<8^l[O&255]^r[me+1],k=l[j>>>24]<<24^l[M>>16&255]<<16^l[O>>8&255]<<8^l[F&255]^r[me+2],U=l[M>>>24]<<24^l[O>>16&255]<<16^l[F>>8&255]<<8^l[j&255]^r[me+3],I[t]=G(_^x),I[t+1]=G(U^S),I[t+2]=G(k^E),I[t+3]=G(C^T),x=H,S=K,E=te,T=ae,t=t+4}return I.buffer}}class fw{constructor(e,t,s){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=e,this.key=t,this.aesMode=s}expandKey(){const e=mw(this.aesMode);return this.subtle.importKey("raw",this.key,{name:e},!1,["encrypt","decrypt"])}}function mw(i){switch(i){case xa.cbc:return"AES-CBC";case xa.ctr:return"AES-CTR";default:throw new Error(`[FastAESKey] invalid aes mode ${i}`)}}const pw=16;class Sm{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const s=self.crypto;s&&(this.subtle=s.subtle||s.webkitSubtle)}catch{}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;const s=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?dw(s):s}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,s,n){return this.useSoftware?new Promise((r,l)=>{const c=ArrayBuffer.isView(e)?e:new Uint8Array(e);this.softwareDecrypt(c,t,s,n);const h=this.flush();h?r(h.buffer):l(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,s,n)}softwareDecrypt(e,t,s,n){const{currentIV:r,currentResult:l,remainderData:c}=this;if(n!==xa.cbc||t.byteLength!==16)return St.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),c&&(e=ki(c,e),this.remainderData=null);const h=this.getValidChunk(e);if(!h.length)return null;r&&(s=r);let u=this.softwareDecrypter;u||(u=this.softwareDecrypter=new hw),u.expandKey(t);const f=l;return this.currentResult=u.decrypt(h.buffer,0,s),this.currentIV=h.slice(-16).buffer,f||null}webCryptoDecrypt(e,t,s,n){if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,t,s,n));this.key=t,this.fastAesKey=new fw(this.subtle,t,n)}return this.fastAesKey.expandKey().then(r=>this.subtle?(this.logOnce("WebCrypto AES decrypt"),new uw(this.subtle,new Uint8Array(s),n).decrypt(e.buffer,r)):Promise.reject(new Error("web crypto not initialized"))).catch(r=>(St.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${r.name}: ${r.message}`),this.onWebCryptoError(e,t,s,n)))}onWebCryptoError(e,t,s,n){const r=this.enableSoftwareAES;if(r){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,s,n);const l=this.flush();if(l)return l.buffer}throw new Error("WebCrypto"+(r?" and softwareDecrypt":"")+": failed to decrypt data")}getValidChunk(e){let t=e;const s=e.length-e.length%pw;return s!==e.length&&(t=e.slice(0,s),this.remainderData=e.slice(s)),t}logOnce(e){this.logEnabled&&(St.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}const Ly=Math.pow(2,17);class gw{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){const s=e.url;if(!s)return Promise.reject(new Nn({type:Fe.NETWORK_ERROR,details:Q.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error(`Fragment does not have a ${s?"part list":"url"}`),networkDetails:null}));this.abort();const n=this.config,r=n.fLoader,l=n.loader;return new Promise((c,h)=>{if(this.loader&&this.loader.destroy(),e.gap)if(e.tagList.some(S=>S[0]==="GAP")){h(Cy(e));return}else e.gap=!1;const u=this.loader=r?new r(n):new l(n),f=wy(e);e.loader=u;const p=_y(n.fragLoadPolicy.default),v={loadPolicy:p,timeout:p.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:e.sn==="initSegment"?1/0:Ly};e.stats=u.stats;const x={onSuccess:(S,E,T,A)=>{this.resetLoader(e,u);let I=S.data;T.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(I.slice(0,16)),I=I.slice(16)),c({frag:e,part:null,payload:I,networkDetails:A})},onError:(S,E,T,A)=>{this.resetLoader(e,u),h(new Nn({type:Fe.NETWORK_ERROR,details:Q.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:xt({url:s,data:void 0},S),error:new Error(`HTTP Error ${S.code} ${S.text}`),networkDetails:T,stats:A}))},onAbort:(S,E,T)=>{this.resetLoader(e,u),h(new Nn({type:Fe.NETWORK_ERROR,details:Q.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:T,stats:S}))},onTimeout:(S,E,T)=>{this.resetLoader(e,u),h(new Nn({type:Fe.NETWORK_ERROR,details:Q.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${v.timeout}ms`),networkDetails:T,stats:S}))}};t&&(x.onProgress=(S,E,T,A)=>t({frag:e,part:null,payload:T,networkDetails:A})),u.load(f,v,x)})}loadPart(e,t,s){this.abort();const n=this.config,r=n.fLoader,l=n.loader;return new Promise((c,h)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap){h(Cy(e,t));return}const u=this.loader=r?new r(n):new l(n),f=wy(e,t);e.loader=u;const p=_y(n.fragLoadPolicy.default),v={loadPolicy:p,timeout:p.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:Ly};t.stats=u.stats,u.load(f,v,{onSuccess:(x,S,E,T)=>{this.resetLoader(e,u),this.updateStatsFromPart(e,t);const A={frag:e,part:t,payload:x.data,networkDetails:T};s(A),c(A)},onError:(x,S,E,T)=>{this.resetLoader(e,u),h(new Nn({type:Fe.NETWORK_ERROR,details:Q.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:xt({url:f.url,data:void 0},x),error:new Error(`HTTP Error ${x.code} ${x.text}`),networkDetails:E,stats:T}))},onAbort:(x,S,E)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,u),h(new Nn({type:Fe.NETWORK_ERROR,details:Q.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:E,stats:x}))},onTimeout:(x,S,E)=>{this.resetLoader(e,u),h(new Nn({type:Fe.NETWORK_ERROR,details:Q.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error(`Timeout after ${v.timeout}ms`),networkDetails:E,stats:x}))}})})}updateStatsFromPart(e,t){const s=e.stats,n=t.stats,r=n.total;if(s.loaded+=n.loaded,r){const h=Math.round(e.duration/t.duration),u=Math.min(Math.round(s.loaded/r),h),p=(h-u)*Math.round(s.loaded/u);s.total=s.loaded+p}else s.total=Math.max(s.loaded,s.total);const l=s.loading,c=n.loading;l.start?l.first+=c.first-c.start:(l.start=c.start,l.first=c.first),l.end=c.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function wy(i,e=null){const t=e||i,s={frag:i,part:e,responseType:"arraybuffer",url:t.url,headers:{},rangeStart:0,rangeEnd:0},n=t.byteRangeStartOffset,r=t.byteRangeEndOffset;if(Oe(n)&&Oe(r)){var l;let c=n,h=r;if(i.sn==="initSegment"&&vw((l=i.decryptdata)==null?void 0:l.method)){const u=r-n;u%16&&(h=r+(16-u%16)),n!==0&&(s.resetIV=!0,c=n-16)}s.rangeStart=c,s.rangeEnd=h}return s}function Cy(i,e){const t=new Error(`GAP ${i.gap?"tag":"attribute"} found`),s={type:Fe.MEDIA_ERROR,details:Q.FRAG_GAP,fatal:!1,frag:i,error:t,networkDetails:null};return e&&(s.part=e),(e||i).stats.aborted=!0,new Nn(s)}function vw(i){return i==="AES-128"||i==="AES-256"}class Nn extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class GS extends Pi{constructor(e,t){super(e,t),this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}class bm{constructor(e,t,s,n=0,r=-1,l=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=Pc(),this.buffering={audio:Pc(),video:Pc(),audiovideo:Pc()},this.level=e,this.sn=t,this.id=s,this.size=n,this.part=r,this.partial=l}}function Pc(){return{start:0,executeStart:0,executeEnd:0,end:0}}const Oy={length:0,start:()=>0,end:()=>0};class qe{static isBuffered(e,t){if(e){const s=qe.getBuffered(e);for(let n=s.length;n--;)if(t>=s.start(n)&&t<=s.end(n))return!0}return!1}static bufferedRanges(e){if(e){const t=qe.getBuffered(e);return qe.timeRangesToArray(t)}return[]}static timeRangesToArray(e){const t=[];for(let s=0;s<e.length;s++)t.push({start:e.start(s),end:e.end(s)});return t}static bufferInfo(e,t,s){if(e){const n=qe.bufferedRanges(e);if(n.length)return qe.bufferedInfo(n,t,s)}return{len:0,start:t,end:t,bufferedIndex:-1}}static bufferedInfo(e,t,s){t=Math.max(0,t),e.length>1&&e.sort((f,p)=>f.start-p.start||p.end-f.end);let n=-1,r=[];if(s)for(let f=0;f<e.length;f++){t>=e[f].start&&t<=e[f].end&&(n=f);const p=r.length;if(p){const v=r[p-1].end;e[f].start-v<s?e[f].end>v&&(r[p-1].end=e[f].end):r.push(e[f])}else r.push(e[f])}else r=e;let l=0,c,h=t,u=t;for(let f=0;f<r.length;f++){const p=r[f].start,v=r[f].end;if(n===-1&&t>=p&&t<=v&&(n=f),t+s>=p&&t<v)h=p,u=v,l=u-t;else if(t+s<p){c=p;break}}return{len:l,start:h||0,end:u||0,nextStart:c,buffered:e,bufferedIndex:n}}static getBuffered(e){try{return e.buffered||Oy}catch(t){return St.log("failed to get media.buffered",t),Oy}}}const HS=/\{\$([a-zA-Z0-9-_]+)\}/g;function Ny(i){return HS.test(i)}function Ff(i,e){if(i.variableList!==null||i.hasVariableRefs){const t=i.variableList;return e.replace(HS,s=>{const n=s.substring(2,s.length-1),r=t?.[n];return r===void 0?(i.playlistParsingError||(i.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${n}"`)),s):r})}return e}function ky(i,e,t){let s=i.variableList;s||(i.variableList=s={});let n,r;if("QUERYPARAM"in e){n=e.QUERYPARAM;try{const l=new self.URL(t).searchParams;if(l.has(n))r=l.get(n);else throw new Error(`"${n}" does not match any query parameter in URI: "${t}"`)}catch(l){i.playlistParsingError||(i.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${l.message}`))}}else n=e.NAME,r=e.VALUE;n in s?i.playlistParsingError||(i.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${n}"`)):s[n]=r||""}function yw(i,e,t){const s=e.IMPORT;if(t&&s in t){let n=i.variableList;n||(i.variableList=n={}),n[s]=t[s]}else i.playlistParsingError||(i.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${s}"`))}const xw=/^(\d+)x(\d+)$/,Dy=/(.+?)=(".*?"|.*?)(?:,|$)/g;class $t{constructor(e,t){typeof e=="string"&&(e=$t.parseAttrList(e,t)),Lt(this,e)}get clientAttrs(){return Object.keys(this).filter(e=>e.substring(0,2)==="X-")}decimalInteger(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(t.length&1?"0":"")+t;const s=new Uint8Array(t.length/2);for(let n=0;n<t.length/2;n++)s[n]=parseInt(t.slice(n*2,n*2+2),16);return s}return null}hexadecimalIntegerAsNumber(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){const s=this[e];return s?parseFloat(s):t}enumeratedString(e){return this[e]}enumeratedStringList(e,t){const s=this[e];return(s?s.split(/[ ,]+/):[]).reduce((n,r)=>(n[r.toLowerCase()]=!0,n),t)}bool(e){return this[e]==="YES"}decimalResolution(e){const t=xw.exec(this[e]);if(t!==null)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e,t){let s;const n={};for(Dy.lastIndex=0;(s=Dy.exec(e))!==null;){const l=s[1].trim();let c=s[2];const h=c.indexOf('"')===0&&c.lastIndexOf('"')===c.length-1;let u=!1;if(h)c=c.slice(1,-1);else switch(l){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":u=!0}if(t&&(h||u))c=Ff(t,c);else if(!u&&!h)switch(l){case"CLOSED-CAPTIONS":if(c==="NONE")break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":St.warn(`${e}: attribute ${l} is missing quotes`)}n[l]=c}return n}}const Sw="com.apple.hls.interstitial";function bw(i){return i!=="ID"&&i!=="CLASS"&&i!=="CUE"&&i!=="START-DATE"&&i!=="DURATION"&&i!=="END-DATE"&&i!=="END-ON-NEXT"}function Tw(i){return i==="SCTE35-OUT"||i==="SCTE35-IN"||i==="SCTE35-CMD"}class zS{constructor(e,t,s=0){var n;if(this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=t?.tagAnchor||null,this.tagOrder=(n=t?.tagOrder)!=null?n:s,t){const r=t.attr;for(const l in r)if(Object.prototype.hasOwnProperty.call(e,l)&&e[l]!==r[l]){St.warn(`DATERANGE tag attribute: "${l}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=l;break}e=Lt(new $t({}),r,e)}if(this.attr=e,t?(this._startDate=t._startDate,this._cue=t._cue,this._endDate=t._endDate,this._dateAtEnd=t._dateAtEnd):this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const r=t?.endDate||new Date(this.attr["END-DATE"]);Oe(r.getTime())&&(this._endDate=r)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get cue(){const e=this._cue;return e===void 0?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):e}get startTime(){const{tagAnchor:e}=this;return e===null||e.programDateTime===null?(St.warn(`Expected tagAnchor Fragment with PDT set for DateRange "${this.id}": ${e}`),NaN):e.start+(this.startDate.getTime()-e.programDateTime)/1e3}get startDate(){return this._startDate}get endDate(){const e=this._endDate||this._dateAtEnd;if(e)return e;const t=this.duration;return t!==null?this._dateAtEnd=new Date(this._startDate.getTime()+t*1e3):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(Oe(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isInterstitial(){return this.class===Sw}get isValid(){return!!this.id&&!this._badValueForSameId&&Oe(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}const Ew=10;class Aw{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e){this.advanced=!0,this.updated=!0;return}const t=this.lastPartSn-e.lastPartSn,s=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!s||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||t===0&&s>0,this.updated||this.advanced?this.misses=Math.floor(e.misses*.6):this.misses=e.misses+1}hasKey(e){return this.encryptedFragments.some(t=>{let s=t.decryptdata;return s||(t.setKeyFormat(e.keyFormat),s=t.decryptdata),!!s&&e.matches(s)})}get hasProgramDateTime(){return this.fragments.length?Oe(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||Ew}get drift(){const e=this.driftEndTime-this.driftStartTime;return e>0?(this.driftEnd-this.driftStart)*1e3/e:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){return this.fragments.length?this.fragments[this.fragments.length-1].end:0}get fragmentStart(){return this.fragments.length?this.fragments[0].start:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].index:-1}get maxPartIndex(){const e=this.partList;if(e){const t=this.lastPartIndex;if(t!==-1){for(let s=e.length;s--;)if(e[s].index>t)return e[s].index;return t}}return 0}get lastPartSn(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}get expired(){if(this.live&&this.age&&this.misses<3){const e=this.partEnd-this.fragmentStart;return this.age>Math.max(e,this.totalduration)+this.levelTargetDuration}return!1}}function vu(i,e){return i.length===e.length?!i.some((t,s)=>t!==e[s]):!1}function Py(i,e){return!i&&!e?!0:!i||!e?!1:vu(i,e)}function jr(i){return i==="AES-128"||i==="AES-256"||i==="AES-256-CTR"}function Tm(i){switch(i){case"AES-128":case"AES-256":return xa.cbc;case"AES-256-CTR":return xa.ctr;default:throw new Error(`invalid full segment method ${i}`)}}function Em(i){return Uint8Array.from(atob(i),e=>e.charCodeAt(0))}function Bf(i){return Uint8Array.from(unescape(encodeURIComponent(i)),e=>e.charCodeAt(0))}function Iw(i){const e=Bf(i).subarray(0,16),t=new Uint8Array(16);return t.set(e,16-e.length),t}function KS(i){const e=function(s,n,r){const l=s[n];s[n]=s[r],s[r]=l};e(i,0,3),e(i,1,2),e(i,4,5),e(i,6,7)}function YS(i){const e=i.split(":");let t=null;if(e[0]==="data"&&e.length===2){const s=e[1].split(";"),n=s[s.length-1].split(",");if(n.length===2){const r=n[0]==="base64",l=n[1];r?(s.splice(-1,1),t=Em(l)):t=Iw(l)}}return t}const yu=typeof self<"u"?self:void 0;var Gt={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},ws={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function eu(i){switch(i){case ws.FAIRPLAY:return Gt.FAIRPLAY;case ws.PLAYREADY:return Gt.PLAYREADY;case ws.WIDEVINE:return Gt.WIDEVINE;case ws.CLEARKEY:return Gt.CLEARKEY}}function rf(i){switch(i){case Gt.FAIRPLAY:return ws.FAIRPLAY;case Gt.PLAYREADY:return ws.PLAYREADY;case Gt.WIDEVINE:return ws.WIDEVINE;case Gt.CLEARKEY:return ws.CLEARKEY}}function zl(i){const{drmSystems:e,widevineLicenseUrl:t}=i,s=e?[Gt.FAIRPLAY,Gt.WIDEVINE,Gt.PLAYREADY,Gt.CLEARKEY].filter(n=>!!e[n]):[];return!s[Gt.WIDEVINE]&&t&&s.push(Gt.WIDEVINE),s}const qS=(function(i){return yu!=null&&(i=yu.navigator)!=null&&i.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null})();function _w(i,e,t,s){let n;switch(i){case Gt.FAIRPLAY:n=["cenc","sinf"];break;case Gt.WIDEVINE:case Gt.PLAYREADY:n=["cenc"];break;case Gt.CLEARKEY:n=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${i}`)}return Rw(n,e,t,s)}function Rw(i,e,t,s){return[{initDataTypes:i,persistentState:s.persistentState||"optional",distinctiveIdentifier:s.distinctiveIdentifier||"optional",sessionTypes:s.sessionTypes||[s.sessionType||"temporary"],audioCapabilities:e.map(r=>({contentType:`audio/mp4; codecs=${r}`,robustness:s.audioRobustness||"",encryptionScheme:s.audioEncryptionScheme||null})),videoCapabilities:t.map(r=>({contentType:`video/mp4; codecs=${r}`,robustness:s.videoRobustness||"",encryptionScheme:s.videoEncryptionScheme||null}))}]}function Lw(i){var e;return!!i&&(i.sessionType==="persistent-license"||!!((e=i.sessionTypes)!=null&&e.some(t=>t==="persistent-license")))}function QS(i){const e=new Uint16Array(i.buffer,i.byteOffset,i.byteLength/2),t=String.fromCharCode.apply(null,Array.from(e)),s=t.substring(t.indexOf("<"),t.length),l=new DOMParser().parseFromString(s,"text/xml").getElementsByTagName("KID")[0];if(l){const c=l.childNodes[0]?l.childNodes[0].nodeValue:l.getAttribute("VALUE");if(c){const h=Em(c).subarray(0,16);return KS(h),h}}return null}let Nr={};class ga{static clearKeyUriToKeyIdMap(){Nr={}}static setKeyIdForUri(e,t){Nr[e]=t}static addKeyIdForUri(e){const t=Object.keys(Nr).length%Number.MAX_SAFE_INTEGER,s=new Uint8Array(16);return new DataView(s.buffer,12,4).setUint32(0,t),Nr[e]=s,s}constructor(e,t,s,n=[1],r=null,l){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=s,this.keyFormatVersions=n,this.iv=r,this.encrypted=e?e!=="NONE":!1,this.isCommonEncryption=this.encrypted&&!jr(e),l!=null&&l.startsWith("0x")&&(this.keyId=new Uint8Array(ES(l)))}matches(e){return e.uri===this.uri&&e.method===this.method&&e.encrypted===this.encrypted&&e.keyFormat===this.keyFormat&&vu(e.keyFormatVersions,this.keyFormatVersions)&&Py(e.iv,this.iv)&&Py(e.keyId,this.keyId)}isSupported(){if(this.method){if(jr(this.method)||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case ws.FAIRPLAY:case ws.WIDEVINE:case ws.PLAYREADY:case ws.CLEARKEY:return["SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(e,t){if(!this.encrypted||!this.uri)return null;if(jr(this.method)){let r=this.iv;return r||(typeof e!="number"&&(St.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0),r=Cw(e)),new ga(this.method,this.uri,"identity",this.keyFormatVersions,r)}if(this.keyId){const r=Nr[this.uri];if(r&&!vu(this.keyId,r)&&ga.setKeyIdForUri(this.uri,this.keyId),this.pssh)return this}const s=YS(this.uri);if(s)switch(this.keyFormat){case ws.WIDEVINE:if(this.pssh=s,!this.keyId){const r=k1(s.buffer);if(r.length){var n;const l=r[0];this.keyId=(n=l.kids)!=null&&n.length?l.kids[0]:null}}this.keyId||(this.keyId=Uy(t));break;case ws.PLAYREADY:{const r=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=N1(r,null,s),this.keyId=QS(s);break}default:{let r=s.subarray(0,16);if(r.length!==16){const l=new Uint8Array(16);l.set(r,16-r.length),r=l}this.keyId=r;break}}if(!this.keyId||this.keyId.byteLength!==16){let r;r=ww(t),r||(r=Uy(t),r||(r=Nr[this.uri])),r&&(this.keyId=r,ga.setKeyIdForUri(this.uri,r))}return this}}function ww(i){const e=i?.[ws.WIDEVINE];return e?e.keyId:null}function Uy(i){const e=i?.[ws.PLAYREADY];if(e){const t=YS(e.uri);if(t)return QS(t)}return null}function Cw(i){const e=new Uint8Array(16);for(let t=12;t<16;t++)e[t]=i>>8*(15-t)&255;return e}const My=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,jy=/#EXT-X-MEDIA:(.*)/g,Ow=/^#EXT(?:INF|-X-TARGETDURATION):/m,lf=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),Nw=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class rn{static findGroup(e,t){for(let s=0;s<e.length;s++){const n=e[s];if(n.id===t)return n}}static resolve(e,t){return mm.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return Ow.test(e)}static parseMasterPlaylist(e,t){const s=Ny(e),n={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:s},r=[];if(My.lastIndex=0,!e.startsWith("#EXTM3U"))return n.playlistParsingError=new Error("no EXTM3U delimiter"),n;let l;for(;(l=My.exec(e))!=null;)if(l[1]){var c;const u=new $t(l[1],n),f=Ff(n,l[2]),p={attrs:u,bitrate:u.decimalInteger("BANDWIDTH")||u.decimalInteger("AVERAGE-BANDWIDTH"),name:u.NAME,url:rn.resolve(f,t)},v=u.decimalResolution("RESOLUTION");v&&(p.width=v.width,p.height=v.height),Vy(u.CODECS,p);const x=u["SUPPLEMENTAL-CODECS"];x&&(p.supplemental={},Vy(x,p.supplemental)),(c=p.unknownCodecs)!=null&&c.length||r.push(p),n.levels.push(p)}else if(l[3]){const u=l[3],f=l[4];switch(u){case"SESSION-DATA":{const p=new $t(f,n),v=p["DATA-ID"];v&&(n.sessionData===null&&(n.sessionData={}),n.sessionData[v]=p);break}case"SESSION-KEY":{const p=Fy(f,t,n);p.encrypted&&p.isSupported()?(n.sessionKeys===null&&(n.sessionKeys=[]),n.sessionKeys.push(p)):St.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${f}"`);break}case"DEFINE":{{const p=new $t(f,n);ky(n,p,t)}break}case"CONTENT-STEERING":{const p=new $t(f,n);n.contentSteering={uri:rn.resolve(p["SERVER-URI"],t),pathwayId:p["PATHWAY-ID"]||"."};break}case"START":{n.startTimeOffset=By(f);break}}}const h=r.length>0&&r.length<n.levels.length;return n.levels=h?r:n.levels,n.levels.length===0&&(n.playlistParsingError=new Error("no levels found in manifest")),n}static parseMasterPlaylistMedia(e,t,s){let n;const r={},l=s.levels,c={AUDIO:l.map(u=>({id:u.attrs.AUDIO,audioCodec:u.audioCodec})),SUBTITLES:l.map(u=>({id:u.attrs.SUBTITLES,textCodec:u.textCodec})),"CLOSED-CAPTIONS":[]};let h=0;for(jy.lastIndex=0;(n=jy.exec(e))!==null;){const u=new $t(n[1],s),f=u.TYPE;if(f){const p=c[f],v=r[f]||[];r[f]=v;const x=u.LANGUAGE,S=u["ASSOC-LANGUAGE"],E=u.CHANNELS,T=u.CHARACTERISTICS,A=u["INSTREAM-ID"],I={attrs:u,bitrate:0,id:h++,groupId:u["GROUP-ID"]||"",name:u.NAME||x||"",type:f,default:u.bool("DEFAULT"),autoselect:u.bool("AUTOSELECT"),forced:u.bool("FORCED"),lang:x,url:u.URI?rn.resolve(u.URI,t):""};if(S&&(I.assocLang=S),E&&(I.channels=E),T&&(I.characteristics=T),A&&(I.instreamId=A),p!=null&&p.length){const _=rn.findGroup(p,I.groupId)||p[0];$y(I,_,"audioCodec"),$y(I,_,"textCodec")}v.push(I)}}return r}static parseLevelPlaylist(e,t,s,n,r,l){var c;const h={url:t},u=new Aw(t),f=u.fragments,p=[];let v=null,x=0,S=0,E=0,T=0,A=0,I=null,_=new sf(n,h),C,k,U,O=-1,F=!1,j=null,M;if(lf.lastIndex=0,u.m3u8=e,u.hasVariableRefs=Ny(e),((c=lf.exec(e))==null?void 0:c[0])!=="#EXTM3U")return u.playlistParsingError=new Error("Missing format identifier #EXTM3U"),u;for(;(C=lf.exec(e))!==null;){F&&(F=!1,_=new sf(n,h),_.playlistOffset=E,_.setStart(E),_.sn=x,_.cc=T,A&&(_.bitrate=A),_.level=s,v&&(_.initSegment=v,v.rawProgramDateTime&&(_.rawProgramDateTime=v.rawProgramDateTime,v.rawProgramDateTime=null),j&&(_.setByteRange(j),j=null)));const ae=C[1];if(ae){_.duration=parseFloat(ae);const me=(" "+C[2]).slice(1);_.title=me||null,_.tagList.push(me?["INF",ae,me]:["INF",ae])}else if(C[3]){if(Oe(_.duration)){_.playlistOffset=E,_.setStart(E),U&&Hy(_,U,u),_.sn=x,_.level=s,_.cc=T,f.push(_);const me=(" "+C[3]).slice(1);_.relurl=Ff(u,me),Vf(_,I,p),I=_,E+=_.duration,x++,S=0,F=!0}}else{if(C=C[0].match(Nw),!C){St.warn("No matches on slow regex match for level playlist!");continue}for(k=1;k<C.length&&C[k]===void 0;k++);const me=(" "+C[k]).slice(1),D=(" "+C[k+1]).slice(1),G=C[k+2]?(" "+C[k+2]).slice(1):null;switch(me){case"BYTERANGE":I?_.setByteRange(D,I):_.setByteRange(D);break;case"PROGRAM-DATE-TIME":_.rawProgramDateTime=D,_.tagList.push(["PROGRAM-DATE-TIME",D]),O===-1&&(O=f.length);break;case"PLAYLIST-TYPE":u.type&&Cn(u,me,C),u.type=D.toUpperCase();break;case"MEDIA-SEQUENCE":u.startSN!==0?Cn(u,me,C):f.length>0&&zy(u,me,C),x=u.startSN=parseInt(D);break;case"SKIP":{u.skippedSegments&&Cn(u,me,C);const Y=new $t(D,u),oe=Y.decimalInteger("SKIPPED-SEGMENTS");if(Oe(oe)){u.skippedSegments+=oe;for(let P=oe;P--;)f.push(null);x+=oe}const pe=Y.enumeratedString("RECENTLY-REMOVED-DATERANGES");pe&&(u.recentlyRemovedDateranges=(u.recentlyRemovedDateranges||[]).concat(pe.split("	")));break}case"TARGETDURATION":u.targetduration!==0&&Cn(u,me,C),u.targetduration=Math.max(parseInt(D),1);break;case"VERSION":u.version!==null&&Cn(u,me,C),u.version=parseInt(D);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":u.live||Cn(u,me,C),u.live=!1;break;case"#":(D||G)&&_.tagList.push(G?[D,G]:[D]);break;case"DISCONTINUITY":T++,_.tagList.push(["DIS"]);break;case"GAP":_.gap=!0,_.tagList.push([me]);break;case"BITRATE":_.tagList.push([me,D]),A=parseInt(D)*1e3,Oe(A)?_.bitrate=A:A=0;break;case"DATERANGE":{const Y=new $t(D,u),oe=new zS(Y,u.dateRanges[Y.ID],u.dateRangeTagCount);u.dateRangeTagCount++,oe.isValid||u.skippedSegments?u.dateRanges[oe.id]=oe:St.warn(`Ignoring invalid DATERANGE tag: "${D}"`),_.tagList.push(["EXT-X-DATERANGE",D]);break}case"DEFINE":{{const Y=new $t(D,u);"IMPORT"in Y?yw(u,Y,l):ky(u,Y,t)}break}case"DISCONTINUITY-SEQUENCE":u.startCC!==0?Cn(u,me,C):f.length>0&&zy(u,me,C),u.startCC=T=parseInt(D);break;case"KEY":{const Y=Fy(D,t,u);if(Y.isSupported()){if(Y.method==="NONE"){U=void 0;break}U||(U={});const oe=U[Y.keyFormat];oe!=null&&oe.matches(Y)||(oe&&(U=Lt({},U)),U[Y.keyFormat]=Y)}else St.warn(`[Keys] Ignoring unsupported EXT-X-KEY tag: "${D}"`);break}case"START":u.startTimeOffset=By(D);break;case"MAP":{const Y=new $t(D,u);if(_.duration){const oe=new sf(n,h);Gy(oe,Y,s,U),v=oe,_.initSegment=v,v.rawProgramDateTime&&!_.rawProgramDateTime&&(_.rawProgramDateTime=v.rawProgramDateTime)}else{const oe=_.byteRangeEndOffset;if(oe){const pe=_.byteRangeStartOffset;j=`${oe-pe}@${pe}`}else j=null;Gy(_,Y,s,U),v=_,F=!0}v.cc=T;break}case"SERVER-CONTROL":{M&&Cn(u,me,C),M=new $t(D),u.canBlockReload=M.bool("CAN-BLOCK-RELOAD"),u.canSkipUntil=M.optionalFloat("CAN-SKIP-UNTIL",0),u.canSkipDateRanges=u.canSkipUntil>0&&M.bool("CAN-SKIP-DATERANGES"),u.partHoldBack=M.optionalFloat("PART-HOLD-BACK",0),u.holdBack=M.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{u.partTarget&&Cn(u,me,C);const Y=new $t(D);u.partTarget=Y.decimalFloatingPoint("PART-TARGET");break}case"PART":{let Y=u.partList;Y||(Y=u.partList=[]);const oe=S>0?Y[Y.length-1]:void 0,pe=S++,P=new $t(D,u),V=new y1(P,_,h,pe,oe);Y.push(V),_.duration+=V.duration;break}case"PRELOAD-HINT":{const Y=new $t(D,u);u.preloadHint=Y;break}case"RENDITION-REPORT":{const Y=new $t(D,u);u.renditionReports=u.renditionReports||[],u.renditionReports.push(Y);break}default:St.warn(`line parsed but not handled: ${C}`);break}}}I&&!I.relurl?(f.pop(),E-=I.duration,u.partList&&(u.fragmentHint=I)):u.partList&&(Vf(_,I,p),_.cc=T,u.fragmentHint=_,U&&Hy(_,U,u)),u.targetduration||(u.playlistParsingError=new Error("Missing Target Duration"));const H=f.length,K=f[0],te=f[H-1];if(E+=u.skippedSegments*u.targetduration,E>0&&H&&te){u.averagetargetduration=E/H;const ae=te.sn;u.endSN=ae!=="initSegment"?ae:0,u.live||(te.endList=!0),O>0&&(Dw(f,O),K&&p.unshift(K))}return u.fragmentHint&&(E+=u.fragmentHint.duration),u.totalduration=E,p.length&&u.dateRangeTagCount&&K&&WS(p,u),u.endCC=T,u}}function WS(i,e){let t=i.length;if(!t)if(e.hasProgramDateTime){const c=e.fragments[e.fragments.length-1];i.push(c),t++}else return;const s=i[t-1],n=e.live?1/0:e.totalduration,r=Object.keys(e.dateRanges);for(let c=r.length;c--;){const h=e.dateRanges[r[c]],u=h.startDate.getTime();h.tagAnchor=s.ref;for(let f=t;f--;){var l;if(((l=i[f])==null?void 0:l.sn)<e.startSN)break;const p=kw(e,u,i,f,n);if(p!==-1){h.tagAnchor=e.fragments[p].ref;break}}}}function kw(i,e,t,s,n){const r=t[s];if(r){const c=r.programDateTime;if(e>=c||s===0){var l;const h=(((l=t[s+1])==null?void 0:l.start)||n)-r.start;if(e<=c+h*1e3){const u=t[s].sn-i.startSN;if(u<0)return-1;const f=i.fragments;if(f.length>t.length){const v=(t[s+1]||f[f.length-1]).sn-i.startSN;for(let x=v;x>u;x--){const S=f[x].programDateTime;if(e>=S&&e<S+f[x].duration*1e3)return x}}return u}}}return-1}function Fy(i,e,t){var s,n;const r=new $t(i,t),l=(s=r.METHOD)!=null?s:"",c=r.URI,h=r.hexadecimalInteger("IV"),u=r.KEYFORMATVERSIONS,f=(n=r.KEYFORMAT)!=null?n:"identity";c&&r.IV&&!h&&St.error(`Invalid IV: ${r.IV}`);const p=c?rn.resolve(c,e):"",v=(u||"1").split("/").map(Number).filter(Number.isFinite);return new ga(l,p,f,v,h,r.KEYID)}function By(i){const t=new $t(i).decimalFloatingPoint("TIME-OFFSET");return Oe(t)?t:null}function Vy(i,e){let t=(i||"").split(/[ ,]+/).filter(s=>s);["video","audio","text"].forEach(s=>{const n=t.filter(r=>vm(r,s));n.length&&(e[`${s}Codec`]=n.map(r=>r.split("/")[0]).join(","),t=t.filter(r=>n.indexOf(r)===-1))}),e.unknownCodecs=t}function $y(i,e,t){const s=e[t];s&&(i[t]=s)}function Dw(i,e){let t=i[e];for(let s=e;s--;){const n=i[s];if(!n)return;n.programDateTime=t.programDateTime-n.duration*1e3,t=n}}function Vf(i,e,t){i.rawProgramDateTime?t.push(i):e!=null&&e.programDateTime&&(i.programDateTime=e.endProgramDateTime)}function Gy(i,e,t,s){i.relurl=e.URI,e.BYTERANGE&&i.setByteRange(e.BYTERANGE),i.level=t,i.sn="initSegment",s&&(i.levelkeys=s),i.initSegment=null}function Hy(i,e,t){i.levelkeys=e;const{encryptedFragments:s}=t;(!s.length||s[s.length-1].levelkeys!==e)&&Object.keys(e).some(n=>e[n].isCommonEncryption)&&s.push(i)}function Cn(i,e,t){i.playlistParsingError=new Error(`#EXT-X-${e} must not appear more than once (${t[0]})`)}function zy(i,e,t){i.playlistParsingError=new Error(`#EXT-X-${e} must appear before the first Media Segment (${t[0]})`)}function of(i,e){const t=e.startPTS;if(Oe(t)){let s=0,n;e.sn>i.sn?(s=t-i.start,n=i):(s=i.start-t,n=e),n.duration!==s&&n.setDuration(s)}else e.sn>i.sn?i.cc===e.cc&&i.minEndPTS?e.setStart(i.start+(i.minEndPTS-i.start)):e.setStart(i.start+i.duration):e.setStart(Math.max(i.start-e.duration,0))}function XS(i,e,t,s,n,r,l){s-t<=0&&(l.warn("Fragment should have a positive duration",e),s=t+e.duration,r=n+e.duration);let h=t,u=s;const f=e.startPTS,p=e.endPTS;if(Oe(f)){const A=Math.abs(f-t);i&&A>i.totalduration?l.warn(`media timestamps and playlist times differ by ${A}s for level ${e.level} ${i.url}`):Oe(e.deltaPTS)?e.deltaPTS=Math.max(A,e.deltaPTS):e.deltaPTS=A,h=Math.max(t,f),t=Math.min(t,f),n=e.startDTS!==void 0?Math.min(n,e.startDTS):n,u=Math.min(s,p),s=Math.max(s,p),r=e.endDTS!==void 0?Math.max(r,e.endDTS):r}const v=t-e.start;e.start!==0&&e.setStart(t),e.setDuration(s-e.start),e.startPTS=t,e.maxStartPTS=h,e.startDTS=n,e.endPTS=s,e.minEndPTS=u,e.endDTS=r;const x=e.sn;if(!i||x<i.startSN||x>i.endSN)return 0;let S;const E=x-i.startSN,T=i.fragments;for(T[E]=e,S=E;S>0;S--)of(T[S],T[S-1]);for(S=E;S<T.length-1;S++)of(T[S],T[S+1]);return i.fragmentHint&&of(T[T.length-1],i.fragmentHint),i.PTSKnown=i.alignedSliding=!0,v}function Pw(i,e,t){if(i===e)return;let s=null;const n=i.fragments;for(let f=n.length-1;f>=0;f--){const p=n[f].initSegment;if(p){s=p;break}}i.fragmentHint&&delete i.fragmentHint.endPTS;let r;jw(i,e,(f,p,v,x)=>{if((!e.startCC||e.skippedSegments)&&p.cc!==f.cc){const S=f.cc-p.cc;for(let E=v;E<x.length;E++)x[E].cc+=S;e.endCC=x[x.length-1].cc}Oe(f.startPTS)&&Oe(f.endPTS)&&(p.setStart(p.startPTS=f.startPTS),p.startDTS=f.startDTS,p.maxStartPTS=f.maxStartPTS,p.endPTS=f.endPTS,p.endDTS=f.endDTS,p.minEndPTS=f.minEndPTS,p.setDuration(f.endPTS-f.startPTS),p.duration&&(r=p),e.PTSKnown=e.alignedSliding=!0),f.hasStreams&&(p.elementaryStreams=f.elementaryStreams),p.loader=f.loader,f.hasStats&&(p.stats=f.stats),f.initSegment&&(p.initSegment=f.initSegment,s=f.initSegment)});const l=e.fragments,c=e.fragmentHint?l.concat(e.fragmentHint):l;if(s&&c.forEach(f=>{var p;f&&(!f.initSegment||f.initSegment.relurl===((p=s)==null?void 0:p.relurl))&&(f.initSegment=s)}),e.skippedSegments){if(e.deltaUpdateFailed=l.some(f=>!f),e.deltaUpdateFailed){t.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let f=e.skippedSegments;f--;)l.shift();e.startSN=l[0].sn}else{e.canSkipDateRanges&&(e.dateRanges=Uw(i.dateRanges,e,t));const f=i.fragments.filter(p=>p.rawProgramDateTime);if(i.hasProgramDateTime&&!e.hasProgramDateTime)for(let p=1;p<c.length;p++)c[p].programDateTime===null&&Vf(c[p],c[p-1],f);WS(f,e)}e.endCC=l[l.length-1].cc}if(!e.startCC){var h;const f=eb(i,e.startSN-1);e.startCC=(h=f?.cc)!=null?h:l[0].cc}Mw(i.partList,e.partList,(f,p)=>{p.elementaryStreams=f.elementaryStreams,p.stats=f.stats}),r?XS(e,r,r.startPTS,r.endPTS,r.startDTS,r.endDTS,t):ZS(i,e),l.length&&(e.totalduration=e.edge-l[0].start),e.driftStartTime=i.driftStartTime,e.driftStart=i.driftStart;const u=e.advancedDateTime;if(e.advanced&&u){const f=e.edge;e.driftStart||(e.driftStartTime=u,e.driftStart=f),e.driftEndTime=u,e.driftEnd=f}else e.driftEndTime=i.driftEndTime,e.driftEnd=i.driftEnd,e.advancedDateTime=i.advancedDateTime;e.requestScheduled===-1&&(e.requestScheduled=i.requestScheduled)}function Uw(i,e,t){const{dateRanges:s,recentlyRemovedDateranges:n}=e,r=Lt({},i);n&&n.forEach(h=>{delete r[h]});const c=Object.keys(r).length;return c?(Object.keys(s).forEach(h=>{const u=r[h],f=new zS(s[h].attr,u);f.isValid?(r[h]=f,u||(f.tagOrder+=c)):t.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${Ot(s[h].attr)}"`)}),r):s}function Mw(i,e,t){if(i&&e){let s=0;for(let n=0,r=i.length;n<=r;n++){const l=i[n],c=e[n+s];l&&c&&l.index===c.index&&l.fragment.sn===c.fragment.sn?t(l,c):s--}}}function jw(i,e,t){const s=e.skippedSegments,n=Math.max(i.startSN,e.startSN)-e.startSN,r=(i.fragmentHint?1:0)+(s?e.endSN:Math.min(i.endSN,e.endSN))-e.startSN,l=e.startSN-i.startSN,c=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,h=i.fragmentHint?i.fragments.concat(i.fragmentHint):i.fragments;for(let u=n;u<=r;u++){const f=h[l+u];let p=c[u];if(s&&!p&&f&&(p=e.fragments[u]=f),f&&p){t(f,p,u,c);const v=f.relurl,x=p.relurl;if(v&&Fw(v,x)){e.playlistParsingError=Ky(`media sequence mismatch ${p.sn}:`,i,e,f,p);return}else if(f.cc!==p.cc){e.playlistParsingError=Ky(`discontinuity sequence mismatch (${f.cc}!=${p.cc})`,i,e,f,p);return}}}}function Ky(i,e,t,s,n){return new Error(`${i} ${n.url}
Playlist starting @${e.startSN}
${e.m3u8}

Playlist starting @${t.startSN}
${t.m3u8}`)}function ZS(i,e,t=!0){const s=e.startSN+e.skippedSegments-i.startSN,n=i.fragments,r=s>=0;let l=0;if(r&&s<n.length)l=n[s].start;else if(r&&e.startSN===i.endSN+1)l=i.fragmentEnd;else if(r&&t)l=i.fragmentStart+s*e.levelTargetDuration;else if(!e.skippedSegments&&e.fragmentStart===0)l=i.fragmentStart;else return;$f(e,l)}function $f(i,e){if(e){const t=i.fragments;for(let s=i.skippedSegments;s<t.length;s++)t[s].addStart(e);i.fragmentHint&&i.fragmentHint.addStart(e)}}function JS(i,e=1/0){let t=1e3*i.targetduration;if(i.updated){const s=i.fragments;if(s.length&&t*4>e){const r=s[s.length-1].duration*1e3;r<t&&(t=r)}}else t/=2;return Math.round(t)}function eb(i,e,t){if(!i)return null;let s=i.fragments[e-i.startSN];return s||(s=i.fragmentHint,s&&s.sn===e)?s:e<i.startSN&&t&&t.sn===e?t:null}function Yy(i,e,t){return i?tb(i.partList,e,t):null}function tb(i,e,t){if(i)for(let s=i.length;s--;){const n=i[s];if(n.index===t&&n.fragment.sn===e)return n}return null}function sb(i){i.forEach((e,t)=>{var s;(s=e.details)==null||s.fragments.forEach(n=>{n.level=t,n.initSegment&&(n.initSegment.level=t)})})}function Fw(i,e){return i!==e&&e?qy(i)!==qy(e):!1}function qy(i){return i.replace(/\?[^?]*$/,"")}function Kl(i,e){for(let s=0,n=i.length;s<n;s++){var t;if(((t=i[s])==null?void 0:t.cc)===e)return i[s]}return null}function Bw(i,e){return!!(i&&e.startCC<i.endCC&&e.endCC>i.startCC)}function Qy(i,e){const t=i.start+e;i.startPTS=t,i.setStart(t),i.endPTS=t+i.duration}function ib(i,e){const t=e.fragments;for(let s=0,n=t.length;s<n;s++)Qy(t[s],i);e.fragmentHint&&Qy(e.fragmentHint,i),e.alignedSliding=!0}function Vw(i,e){i&&(nb(e,i),e.alignedSliding||xu(e,i),!e.alignedSliding&&!e.skippedSegments&&ZS(i,e,!1))}function nb(i,e){if(!Bw(e,i))return;const t=Math.min(e.endCC,i.endCC),s=Kl(e.fragments,t),n=Kl(i.fragments,t);if(!s||!n)return;St.log(`Aligning playlist at start of dicontinuity sequence ${t}`);const r=s.start-n.start;ib(r,i)}function xu(i,e){if(!i.hasProgramDateTime||!e.hasProgramDateTime)return;const t=i.fragments,s=e.fragments;if(!t.length||!s.length)return;let n,r;const l=Math.min(e.endCC,i.endCC);e.startCC<l&&i.startCC<l&&(n=Kl(s,l),r=Kl(t,l)),(!n||!r)&&(n=s[Math.floor(s.length/2)],r=Kl(t,n.cc)||t[Math.floor(t.length/2)]);const c=n.programDateTime,h=r.programDateTime;if(!c||!h)return;const u=(h-c)/1e3-(r.start-n.start);ib(u,i)}function Fs(i,e,t){Xs(i,e,t),i.addEventListener(e,t)}function Xs(i,e,t){i.removeEventListener(e,t)}const $w={toString:function(i){let e="";const t=i.length;for(let s=0;s<t;s++)e+=`[${i.start(s).toFixed(3)}-${i.end(s).toFixed(3)}]`;return e}},ce={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class Am extends GS{constructor(e,t,s,n,r){super(n,e.logger),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=ce.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.loadingParts=!1,this.loopSn=void 0,this.onMediaSeeking=()=>{const{config:l,fragCurrent:c,media:h,mediaBuffer:u,state:f}=this,p=h?h.currentTime:0,v=qe.bufferInfo(u||h,p,l.maxBufferHole),x=!v.len;if(this.log(`Media seeking to ${Oe(p)?p.toFixed(3):p}, state: ${f}, ${x?"out of":"in"} buffer`),this.state===ce.ENDED)this.resetLoadingState();else if(c){const S=l.maxFragLookUpTolerance,E=c.start-S,T=c.start+c.duration+S;if(x||T<v.start||E>v.end){const A=p>T;(p<E||A)&&(A&&c.loader&&(this.log(`Cancelling fragment load for seek (sn: ${c.sn})`),c.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}if(h){this.fragmentTracker.removeFragmentsInRange(p,1/0,this.playlistType,!0);const S=this.lastCurrentTime;if(p>S&&(this.lastCurrentTime=p),!this.loadingParts){const E=Math.max(v.end,p),T=this.shouldLoadParts(this.getLevelDetails(),E);T&&(this.log(`LL-Part loading ON after seeking to ${p.toFixed(2)} with buffer @${E.toFixed(2)}`),this.loadingParts=T)}}this.hls.hasEnoughToStart||(this.log(`Setting ${x?"startPosition":"nextLoadPosition"} to ${p} for seek without enough to start`),this.nextLoadPosition=p,x&&(this.startPosition=p)),x&&this.state===ce.IDLE&&this.tickImmediate()},this.onMediaEnded=()=>{this.log("setting startPosition to 0 because media ended"),this.startPosition=this.lastCurrentTime=0},this.playlistType=r,this.hls=e,this.fragmentLoader=new gw(e.config),this.keyLoader=s,this.fragmentTracker=t,this.config=e.config,this.decrypter=new Sm(e.config)}registerListeners(){const{hls:e}=this;e.on(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(L.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(L.ERROR,this.onError,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){if(this.state===ce.STOPPED)return;this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;e!=null&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=ce.STOPPED}get startPositionValue(){const{nextLoadPosition:e,startPosition:t}=this;return t===-1&&e?e:t}get bufferingEnabled(){return this.buffering}pauseBuffering(){this.buffering=!1}resumeBuffering(){this.buffering=!0}get inFlightFrag(){return{frag:this.fragCurrent,state:this.state}}_streamEnded(e,t){if(t.live||!this.media)return!1;const s=e.end||0,n=this.config.timelineOffset||0;if(s<=n)return!1;const r=e.buffered;this.config.maxBufferHole&&r&&r.length>1&&(e=qe.bufferedInfo(r,e.start,0));const l=e.nextStart;if(l&&l>n&&l<t.edge||this.media.currentTime<e.start)return!1;const h=t.partList;if(h!=null&&h.length){const f=h[h.length-1];return qe.isBuffered(this.media,f.start+f.duration/2)}const u=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(u)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null)return this.levelLastLoaded.details}get timelineOffset(){const e=this.config.timelineOffset;if(e){var t;return((t=this.getLevelDetails())==null?void 0:t.appliedTimelineOffset)||e}return 0}onMediaAttached(e,t){const s=this.media=this.mediaBuffer=t.media;Fs(s,"seeking",this.onMediaSeeking),Fs(s,"ended",this.onMediaEnded);const n=this.config;this.levels&&n.autoStartLoad&&this.state===ce.STOPPED&&this.startLoad(n.startPosition)}onMediaDetaching(e,t){const s=!!t.transferMedia,n=this.media;if(n!==null){if(n.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),Xs(n,"seeking",this.onMediaSeeking),Xs(n,"ended",this.onMediaEnded),this.keyLoader&&!s&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,s){this.resetLoadingState(),this.resetTransmuxer();return}this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}}onManifestLoading(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1}onError(e,t){}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset}onHandlerDestroying(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),super.onHandlerDestroying(),this.hls=this.onMediaSeeking=this.onMediaEnded=null}onHandlerDestroyed(){this.state=ce.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,s){this.startFragRequested=!0,this._loadFragForPlayback(e,t,s)}_loadFragForPlayback(e,t,s){const n=r=>{const l=r.frag;if(this.fragContextChanged(l)){this.warn(`${l.type} sn: ${l.sn}${r.part?" part: "+r.part.index:""} of ${this.fragInfo(l,!1,r.part)}) was dropped during download.`),this.fragmentTracker.removeFragment(l);return}l.stats.chunkCount++,this._handleFragmentLoadProgress(r)};this._doFragLoad(e,t,s,n).then(r=>{if(!r)return;const l=this.state,c=r.frag;if(this.fragContextChanged(c)){(l===ce.FRAG_LOADING||!this.fragCurrent&&l===ce.PARSING)&&(this.fragmentTracker.removeFragment(c),this.state=ce.IDLE);return}"payload"in r&&(this.log(`Loaded ${c.type} sn: ${c.sn} of ${this.playlistLabel()} ${c.level}`),this.hls.trigger(L.FRAG_LOADED,r)),this._handleFragmentLoadComplete(r)}).catch(r=>{this.state===ce.STOPPED||this.state===ce.ERROR||(this.warn(`Frag error: ${r?.message||r}`),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var t;const{fragmentTracker:s}=this;if(s.getState(e)===hs.APPENDING){const r=e.type,l=this.getFwdBufferInfo(this.mediaBuffer,r),c=Math.max(e.duration,l?l.len:this.config.maxBufferLength),h=this.backtrackFragment;((h?e.sn-h.sn:0)===1||this.reduceMaxBufferLength(c,e.duration))&&s.removeFragment(e)}else((t=this.mediaBuffer)==null?void 0:t.buffered.length)===0?s.removeAllFragments():s.hasParts(e.type)&&(s.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),s.getState(e)===hs.PARTIAL&&s.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}waitForLive(e){const t=e.details;return t?.live&&t.type!=="EVENT"&&(this.levelLastLoaded!==e||t.expired)}flushMainBuffer(e,t,s=null){if(!(e-t))return;const n={startOffset:e,endOffset:t,type:s};this.hls.trigger(L.BUFFER_FLUSHING,n)}_loadInitSegment(e,t){this._doFragLoad(e,t).then(s=>{const n=s?.frag;if(!n||this.fragContextChanged(n)||!this.levels)throw new Error("init load aborted");return s}).then(s=>{const{hls:n}=this,{frag:r,payload:l}=s,c=r.decryptdata;if(l&&l.byteLength>0&&c!=null&&c.key&&c.iv&&jr(c.method)){const h=self.performance.now();return this.decrypter.decrypt(new Uint8Array(l),c.key.buffer,c.iv.buffer,Tm(c.method)).catch(u=>{throw n.trigger(L.ERROR,{type:Fe.MEDIA_ERROR,details:Q.FRAG_DECRYPT_ERROR,fatal:!1,error:u,reason:u.message,frag:r}),u}).then(u=>{const f=self.performance.now();return n.trigger(L.FRAG_DECRYPTED,{frag:r,payload:u,stats:{tstart:h,tdecrypt:f}}),s.payload=u,this.completeInitSegmentLoad(s)})}return this.completeInitSegmentLoad(s)}).catch(s=>{this.state===ce.STOPPED||this.state===ce.ERROR||(this.warn(s),this.resetFragmentLoading(e))})}completeInitSegmentLoad(e){const{levels:t}=this;if(!t)throw new Error("init load aborted, missing levels");const s=e.frag.stats;this.state!==ce.STOPPED&&(this.state=ce.IDLE),e.frag.data=new Uint8Array(e.payload),s.parsing.start=s.buffering.start=self.performance.now(),s.parsing.end=s.buffering.end=self.performance.now(),this.tick()}unhandledEncryptionError(e,t){var s,n;const r=e.tracks;if(r&&!t.encrypted&&((s=r.audio)!=null&&s.encrypted||(n=r.video)!=null&&n.encrypted)&&(!this.config.emeEnabled||!this.keyLoader.emeController)){const l=this.media,c=new Error(`Encrypted track with no key in ${this.fragInfo(t)} (media ${l?"attached mediaKeys: "+l.mediaKeys:"detached"})`);return this.warn(c.message),!l||l.mediaKeys?!1:(this.hls.trigger(L.ERROR,{type:Fe.KEY_SYSTEM_ERROR,details:Q.KEY_SYSTEM_NO_KEYS,fatal:!1,error:c,frag:t}),this.resetTransmuxer(),!0)}return!1}fragContextChanged(e){const{fragCurrent:t}=this;return!e||!t||e.sn!==t.sn||e.level!==t.level}fragBufferedComplete(e,t){const s=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)} > buffer:${s?$w.toString(qe.getBuffered(s)):"(detached)"})`),es(e)){var n;if(e.type!==ke.SUBTITLE){const l=e.elementaryStreams;if(!Object.keys(l).some(c=>!!l[c])){this.state=ce.IDLE;return}}const r=(n=this.levels)==null?void 0:n[e.level];r!=null&&r.fragmentError&&(this.log(`Resetting level fragment error count of ${r.fragmentError} on frag buffered`),r.fragmentError=0)}this.state=ce.IDLE}_handleFragmentLoadComplete(e){const{transmuxer:t}=this;if(!t)return;const{frag:s,part:n,partsLoaded:r}=e,l=!r||r.length===0||r.some(h=>!h),c=new bm(s.level,s.sn,s.stats.chunkCount+1,0,n?n.index:-1,!l);t.flush(c)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,s=null,n){var r;this.fragCurrent=e;const l=t.details;if(!this.levels||!l)throw new Error(`frag load aborted, missing level${l?"":" detail"}s`);let c=null;if(e.encrypted&&!((r=e.decryptdata)!=null&&r.key)){if(this.log(`Loading key for ${e.sn} of [${l.startSN}-${l.endSN}], ${this.playlistLabel()} ${e.level}`),this.state=ce.KEY_LOADING,this.fragCurrent=e,c=this.keyLoader.load(e).then(v=>{if(!this.fragContextChanged(v.frag))return this.hls.trigger(L.KEY_LOADED,v),this.state===ce.KEY_LOADING&&(this.state=ce.IDLE),v}),this.hls.trigger(L.KEY_LOADING,{frag:e}),this.fragCurrent===null)return this.log("context changed in KEY_LOADING"),Promise.resolve(null)}else e.encrypted||(c=this.keyLoader.loadClear(e,l.encryptedFragments,this.startFragRequested),c&&this.log("[eme] blocking frag load until media-keys acquired"));const h=this.fragPrevious;if(es(e)&&(!h||e.sn!==h.sn)){const v=this.shouldLoadParts(t.details,e.end);v!==this.loadingParts&&(this.log(`LL-Part loading ${v?"ON":"OFF"} loading sn ${h?.sn}->${e.sn}`),this.loadingParts=v)}if(s=Math.max(e.start,s||0),this.loadingParts&&es(e)){const v=l.partList;if(v&&n){s>l.fragmentEnd&&l.fragmentHint&&(e=l.fragmentHint);const x=this.getNextPart(v,e,s);if(x>-1){const S=v[x];e=this.fragCurrent=S.fragment,this.log(`Loading ${e.type} sn: ${e.sn} part: ${S.index} (${x}/${v.length-1}) of ${this.fragInfo(e,!1,S)}) cc: ${e.cc} [${l.startSN}-${l.endSN}], target: ${parseFloat(s.toFixed(3))}`),this.nextLoadPosition=S.start+S.duration,this.state=ce.FRAG_LOADING;let E;return c?E=c.then(T=>!T||this.fragContextChanged(T.frag)?null:this.doFragPartsLoad(e,S,t,n)).catch(T=>this.handleFragLoadError(T)):E=this.doFragPartsLoad(e,S,t,n).catch(T=>this.handleFragLoadError(T)),this.hls.trigger(L.FRAG_LOADING,{frag:e,part:S,targetBufferTime:s}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):E}else if(!e.url||this.loadedEndOfParts(v,s))return Promise.resolve(null)}}if(es(e)&&this.loadingParts){var u;this.log(`LL-Part loading OFF after next part miss @${s.toFixed(2)} Check buffer at sn: ${e.sn} loaded parts: ${(u=l.partList)==null?void 0:u.filter(v=>v.loaded).map(v=>`[${v.start}-${v.end}]`)}`),this.loadingParts=!1}else if(!e.url)return Promise.resolve(null);this.log(`Loading ${e.type} sn: ${e.sn} of ${this.fragInfo(e,!1)}) cc: ${e.cc} ${"["+l.startSN+"-"+l.endSN+"]"}, target: ${parseFloat(s.toFixed(3))}`),Oe(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=ce.FRAG_LOADING;const f=this.config.progressive&&e.type!==ke.SUBTITLE;let p;return f&&c?p=c.then(v=>!v||this.fragContextChanged(v.frag)?null:this.fragmentLoader.load(e,n)).catch(v=>this.handleFragLoadError(v)):p=Promise.all([this.fragmentLoader.load(e,f?n:void 0),c]).then(([v])=>(!f&&n&&n(v),v)).catch(v=>this.handleFragLoadError(v)),this.hls.trigger(L.FRAG_LOADING,{frag:e,targetBufferTime:s}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):p}doFragPartsLoad(e,t,s,n){return new Promise((r,l)=>{var c;const h=[],u=(c=s.details)==null?void 0:c.partList,f=p=>{this.fragmentLoader.loadPart(e,p,n).then(v=>{h[p.index]=v;const x=v.part;this.hls.trigger(L.FRAG_LOADED,v);const S=Yy(s.details,e.sn,p.index+1)||tb(u,e.sn,p.index+1);if(S)f(S);else return r({frag:e,part:x,partsLoaded:h})}).catch(l)};f(t)})}handleFragLoadError(e){if("data"in e){const t=e.data;t.frag&&t.details===Q.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):t.frag&&t.type===Fe.KEY_SYSTEM_ERROR?(t.frag.abortRequests(),this.resetStartWhenNotLoaded(),this.resetFragmentLoading(t.frag)):this.hls.trigger(L.ERROR,t)}else this.hls.trigger(L.ERROR,{type:Fe.OTHER_ERROR,details:Q.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const t=this.getCurrentContext(e);if(!t||this.state!==ce.PARSING){!this.fragCurrent&&this.state!==ce.STOPPED&&this.state!==ce.ERROR&&(this.state=ce.IDLE);return}const{frag:s,part:n,level:r}=t,l=self.performance.now();s.stats.parsing.end=l,n&&(n.stats.parsing.end=l);const c=this.getLevelDetails(),u=c&&s.sn>c.endSN||this.shouldLoadParts(c,s.end);u!==this.loadingParts&&(this.log(`LL-Part loading ${u?"ON":"OFF"} after parsing segment ending @${s.end.toFixed(2)}`),this.loadingParts=u),this.updateLevelTiming(s,n,r,e.partial)}shouldLoadParts(e,t){if(this.config.lowLatencyMode){if(!e)return this.loadingParts;if(e.partList){var s;const r=e.partList[0];if(r.fragment.type===ke.SUBTITLE)return!1;const l=r.end+(((s=e.fragmentHint)==null?void 0:s.duration)||0);if(t>=l){var n;if((this.hls.hasEnoughToStart?((n=this.media)==null?void 0:n.currentTime)||this.lastCurrentTime:this.getLoadPosition())>r.start-r.fragment.duration)return!0}}}return!1}getCurrentContext(e){const{levels:t,fragCurrent:s}=this,{level:n,sn:r,part:l}=e;if(!(t!=null&&t[n]))return this.warn(`Levels object was unset while buffering fragment ${r} of ${this.playlistLabel()} ${n}. The current chunk will not be buffered.`),null;const c=t[n],h=c.details,u=l>-1?Yy(h,r,l):null,f=u?u.fragment:eb(h,r,s);return f?(s&&s!==f&&(f.stats=s.stats),{frag:f,part:u,level:c}):null}bufferFragmentData(e,t,s,n,r){if(this.state!==ce.PARSING)return;const{data1:l,data2:c}=e;let h=l;if(c&&(h=ki(l,c)),!h.length)return;const u=this.initPTS[t.cc],f=u?-u.baseTime/u.timescale:void 0,p={type:e.type,frag:t,part:s,chunkMeta:n,offset:f,parent:t.type,data:h};if(this.hls.trigger(L.BUFFER_APPENDING,p),e.dropped&&e.independent&&!s){if(r)return;this.flushBufferGap(t)}}flushBufferGap(e){const t=this.media;if(!t)return;if(!qe.isBuffered(t,t.currentTime)){this.flushMainBuffer(0,e.start);return}const s=t.currentTime,n=qe.bufferInfo(t,s,0),r=e.duration,l=Math.min(this.config.maxFragLookUpTolerance*2,r*.25),c=Math.max(Math.min(e.start-l,n.end-l),s+l);e.start-c>l&&this.flushMainBuffer(c,e.start)}getFwdBufferInfo(e,t){var s;const n=this.getLoadPosition();if(!Oe(n))return null;const l=this.lastCurrentTime>n||(s=this.media)!=null&&s.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(e,n,t,l)}getFwdBufferInfoAtPos(e,t,s,n){const r=qe.bufferInfo(e,t,n);if(r.len===0&&r.nextStart!==void 0){const l=this.fragmentTracker.getBufferedFrag(t,s);if(l&&(r.nextStart<=l.end||l.gap)){const c=Math.max(Math.min(r.nextStart,l.end)-t,n);return qe.bufferInfo(e,t,c)}}return r}getMaxBufferLength(e){const{config:t}=this;let s;return e?s=Math.max(8*t.maxBufferSize/e,t.maxBufferLength):s=t.maxBufferLength,Math.min(s,t.maxMaxBufferLength)}reduceMaxBufferLength(e,t){const s=this.config,n=Math.max(Math.min(e-t,s.maxBufferLength),t),r=Math.max(e-t*3,s.maxMaxBufferLength/2,n);return r>=n?(s.maxMaxBufferLength=r,this.warn(`Reduce max buffer length to ${r}s`),!0):!1}getAppendedFrag(e,t=ke.MAIN){const s=this.fragmentTracker?this.fragmentTracker.getAppendedFrag(e,t):null;return s&&"fragment"in s?s.fragment:s}getNextFragment(e,t){const s=t.fragments,n=s.length;if(!n)return null;const{config:r}=this,l=s[0].start,c=r.lowLatencyMode&&!!t.partList;let h=null;if(t.live){const p=r.initialLiveManifestSize;if(n<p)return this.warn(`Not enough fragments to start playback (have: ${n}, need: ${p})`),null;if(!t.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||e<l){var u;c&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),h=this.getInitialLiveFragment(t);const v=this.hls.startPosition,x=this.hls.liveSyncPosition,S=h?(v!==-1&&v>=l?v:x)||h.start:e;this.log(`Setting startPosition to ${S} to match start frag at live edge. mainStart: ${v} liveSyncPosition: ${x} frag.start: ${(u=h)==null?void 0:u.start}`),this.startPosition=this.nextLoadPosition=S}}else e<=l&&(h=s[0]);if(!h){const p=this.loadingParts?t.partEnd:t.fragmentEnd;h=this.getFragmentAtPosition(e,p,t)}let f=this.filterReplacedPrimary(h,t);if(!f&&h){const p=h.sn-t.startSN;f=this.filterReplacedPrimary(s[p+1]||null,t)}return this.mapToInitFragWhenRequired(f)}isLoopLoading(e,t){const s=this.fragmentTracker.getState(e);return(s===hs.OK||s===hs.PARTIAL&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,s,n,r){let l=null;if(e.gap&&(l=this.getNextFragment(this.nextLoadPosition,t),l&&!l.gap&&s.nextStart)){const c=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,s.nextStart,n,0);if(c!==null&&s.len+c.len>=r){const h=l.sn;return this.loopSn!==h&&(this.log(`buffer full after gaps in "${n}" playlist starting at sn: ${h}`),this.loopSn=h),null}}return this.loopSn=void 0,l}get primaryPrefetch(){if(Wy(this.config)){var e;if((e=this.hls.interstitialsManager)==null||(e=e.playingItem)==null?void 0:e.event)return!0}return!1}filterReplacedPrimary(e,t){if(!e)return e;if(Wy(this.config)&&e.type!==ke.SUBTITLE){const s=this.hls.interstitialsManager,n=s?.bufferingItem;if(n){const l=n.event;if(l){if(l.appendInPlace||Math.abs(e.start-n.start)>1||n.start===0)return null}else if(e.end<=n.start&&t?.live===!1||e.start>n.end&&n.nextEvent&&(n.nextEvent.appendInPlace||e.start-n.end>1))return null}const r=s?.playerQueue;if(r)for(let l=r.length;l--;){const c=r[l].interstitial;if(c.appendInPlace&&e.start>=c.startTime&&e.end<=c.resumeTime)return null}}return e}mapToInitFragWhenRequired(e){return e!=null&&e.initSegment&&!e.initSegment.data&&!this.bitrateTest?e.initSegment:e}getNextPart(e,t,s){let n=-1,r=!1,l=!0;for(let c=0,h=e.length;c<h;c++){const u=e[c];if(l=l&&!u.independent,n>-1&&s<u.start)break;const f=u.loaded;f?n=-1:(r||(u.independent||l)&&u.fragment===t)&&(u.fragment!==t&&this.warn(`Need buffer at ${s} but next unloaded part starts at ${u.start}`),n=c),r=f}return n}loadedEndOfParts(e,t){let s;for(let n=e.length;n--;){if(s=e[n],!s.loaded)return!1;if(t>s.start)return!0}return!1}getInitialLiveFragment(e){const t=e.fragments,s=this.fragPrevious;let n=null;if(s){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${s.programDateTime}`),n=nw(t,s.endProgramDateTime,this.config.maxFragLookUpTolerance)),!n){const r=s.sn+1;if(r>=e.startSN&&r<=e.endSN){const l=t[r-e.startSN];s.cc===l.cc&&(n=l,this.log(`Live playlist, switching playlist, load frag with next SN: ${n.sn}`))}n||(n=BS(e,s.cc,s.end),n&&this.log(`Live playlist, switching playlist, load frag with same CC: ${n.sn}`))}}else{const r=this.hls.liveSyncPosition;r!==null&&(n=this.getFragmentAtPosition(r,this.bitrateTest?e.fragmentEnd:e.edge,e))}return n}getFragmentAtPosition(e,t,s){const{config:n}=this;let{fragPrevious:r}=this,{fragments:l,endSN:c}=s;const{fragmentHint:h}=s,{maxFragLookUpTolerance:u}=n,f=s.partList,p=!!(this.loadingParts&&f!=null&&f.length&&h);p&&!this.bitrateTest&&f[f.length-1].fragment.sn===h.sn&&(l=l.concat(h),c=h.sn);let v;if(e<t){var x;const E=e<this.lastCurrentTime||e>t-u||(x=this.media)!=null&&x.paused||!this.startFragRequested?0:u;v=za(r,l,e,E)}else v=l[l.length-1];if(v){const S=v.sn-s.startSN,E=this.fragmentTracker.getState(v);if((E===hs.OK||E===hs.PARTIAL&&v.gap)&&(r=v),r&&v.sn===r.sn&&(!p||f[0].fragment.sn>v.sn||!s.live)&&v.level===r.level){const A=l[S+1];v.sn<c&&this.fragmentTracker.getState(A)!==hs.OK?v=A:v=null}}return v}alignPlaylists(e,t,s){const n=e.fragments.length;if(!n)return this.warn("No fragments in live playlist"),0;const r=e.fragmentStart,l=!t,c=e.alignedSliding&&Oe(r);if(l||!c&&!r){Vw(s,e);const h=e.fragmentStart;return this.log(`Live playlist sliding: ${h.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} fragments: ${n}`),h}return r}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,e.partTarget*3)}setStartPosition(e,t){let s=this.startPosition;s<t&&(s=-1);const n=this.timelineOffset;if(s===-1){const r=this.startTimeOffset!==null,l=r?this.startTimeOffset:e.startTimeOffset;l!==null&&Oe(l)?(s=t+l,l<0&&(s+=e.edge),s=Math.min(Math.max(t,s),t+e.totalduration),this.log(`Setting startPosition to ${s} for start time offset ${l} found in ${r?"multivariant":"media"} playlist`),this.startPosition=s):e.live?(s=this.hls.liveSyncPosition||t,this.log(`Setting startPosition to -1 to start at live edge ${s}`),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=s=0),this.lastCurrentTime=s+n}this.nextLoadPosition=s+n}getLoadPosition(){var e;const{media:t}=this;let s=0;return(e=this.hls)!=null&&e.hasEnoughToStart&&t?s=t.currentTime:this.nextLoadPosition>=0&&(s=this.nextLoadPosition),s}handleFragLoadAborted(e,t){this.transmuxer&&e.type===this.playlistType&&es(e)&&e.stats.aborted&&(this.log(`Fragment ${e.sn}${t?" part "+t.index:""} of ${this.playlistLabel()} ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){(!this.fragCurrent||!this.fragContextChanged(e)&&this.state!==ce.FRAG_LOADING_WAITING_RETRY)&&(this.state=ce.IDLE)}onFragmentOrKeyLoadError(e,t){var s;if(t.chunkMeta&&!t.frag){const A=this.getCurrentContext(t.chunkMeta);A&&(t.frag=A.frag)}const n=t.frag;if(!n||n.type!==e||!this.levels)return;if(this.fragContextChanged(n)){var r;this.warn(`Frag load error must match current frag to retry ${n.url} > ${(r=this.fragCurrent)==null?void 0:r.url}`);return}const l=t.details===Q.FRAG_GAP;l&&this.fragmentTracker.fragBuffered(n,!0);const c=t.errorAction;if(!c){this.state=ce.ERROR;return}const{action:h,flags:u,retryCount:f=0,retryConfig:p}=c,v=!!p,x=v&&h===Rs.RetryRequest,S=v&&!c.resolved&&u===hi.MoveAllAlternatesMatchingHost,E=(s=this.hls.latestLevelDetails)==null?void 0:s.live;if(!x&&S&&es(n)&&!n.endList&&E&&!$S(t))this.resetFragmentErrors(e),this.treatAsGap(n),c.resolved=!0;else if((x||S)&&f<p.maxNumRetry){var T;const A=jf((T=t.response)==null?void 0:T.code),I=xm(p,f);if(this.resetStartWhenNotLoaded(),this.retryDate=self.performance.now()+I,this.state=ce.FRAG_LOADING_WAITING_RETRY,c.resolved=!0,A){this.log("Waiting for connection (offline)"),this.retryDate=1/0,t.reason="offline";return}this.warn(`Fragment ${n.sn} of ${e} ${n.level} errored with ${t.details}, retrying loading ${f+1}/${p.maxNumRetry} in ${I}ms`)}else if(p)if(this.resetFragmentErrors(e),f<p.maxNumRetry)!l&&h!==Rs.RemoveAlternatePermanently&&(c.resolved=!0);else{this.warn(`${t.details} reached or exceeded max retry (${f})`);return}else h===Rs.SendAlternateToPenaltyBox?this.state=ce.WAITING_LEVEL:this.state=ce.ERROR;this.tickImmediate()}checkRetryDate(){const e=self.performance.now(),t=this.retryDate,s=t===1/0;(!t||e>=t||s&&!jf(0))&&(s&&this.log("Connection restored (online)"),this.resetStartWhenNotLoaded(),this.state=ce.IDLE)}reduceLengthAndFlushBuffer(e){if(this.state===ce.PARSING||this.state===ce.PARSED){const t=e.frag,s=e.parent,n=this.getFwdBufferInfo(this.mediaBuffer,s),r=n&&n.len>.5;r&&this.reduceMaxBufferLength(n.len,t?.duration||10);const l=!r;return l&&this.warn(`Buffer full error while media.currentTime (${this.getLoadPosition()}) is not buffered, flush ${s} buffer`),t&&(this.fragmentTracker.removeFragment(t),this.nextLoadPosition=t.start),this.resetLoadingState(),l}return!1}resetFragmentErrors(e){e===ke.AUDIO&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==ce.STOPPED&&(this.state=ce.IDLE)}afterBufferFlushed(e,t,s){if(!e)return;const n=qe.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,n,s),this.state===ce.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==ce.STOPPED&&(this.state=ce.IDLE)}resetStartWhenNotLoaded(){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;const e=this.levelLastLoaded,t=e?e.details:null;t!=null&&t.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(t,t.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.log(`Loading context changed while buffering sn ${e.sn} of ${this.playlistLabel()} ${e.level===-1?"<removed>":e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,s,n){const r=s.details;if(!r){this.warn("level.details undefined");return}if(!Object.keys(e.elementaryStreams).reduce((h,u)=>{const f=e.elementaryStreams[u];if(f){const p=f.endPTS-f.startPTS;if(p<=0)return this.warn(`Could not parse fragment ${e.sn} ${u} duration reliably (${p})`),h||!1;const v=n?0:XS(r,e,f.startPTS,f.endPTS,f.startDTS,f.endDTS,this);return this.hls.trigger(L.LEVEL_PTS_UPDATED,{details:r,level:s,drift:v,type:u,frag:e,start:f.startPTS,end:f.endPTS}),!0}return h},!1)){var c;const h=((c=this.transmuxer)==null?void 0:c.error)===null;if((s.fragmentError===0||h&&(s.fragmentError<2||e.endList))&&this.treatAsGap(e,s),h){const u=new Error(`Found no media in fragment ${e.sn} of ${this.playlistLabel()} ${e.level} resetting transmuxer to fallback to playlist timing`);if(this.warn(u.message),this.hls.trigger(L.ERROR,{type:Fe.MEDIA_ERROR,details:Q.FRAG_PARSING_ERROR,fatal:!1,error:u,frag:e,reason:`Found no media in msn ${e.sn} of ${this.playlistLabel()} "${s.url}"`}),!this.hls)return;this.resetTransmuxer()}}this.state=ce.PARSED,this.log(`Parsed ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)})`),this.hls.trigger(L.FRAG_PARSED,{frag:e,part:t})}playlistLabel(){return this.playlistType===ke.MAIN?"level":"track"}fragInfo(e,t=!0,s){var n,r;return`${this.playlistLabel()} ${e.level} (${s?"part":"frag"}:[${((n=t&&!s?e.startPTS:(s||e).start)!=null?n:NaN).toFixed(3)}-${((r=t&&!s?e.endPTS:(s||e).end)!=null?r:NaN).toFixed(3)}]${s&&e.type==="main"?"INDEPENDENT="+(s.independent?"YES":"NO"):""}`}treatAsGap(e,t){t&&t.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)}resetTransmuxer(){var e;(e=this.transmuxer)==null||e.reset()}recoverWorkerError(e){e.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(),this.resetLoadingState())}set state(e){const t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}}function Wy(i){return!!i.interstitialsController&&i.enableInterstitialPlayback!==!1}class ab{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:t}=this;let s;if(e.length)e.length===1?s=e[0]:s=Gw(e,t);else return new Uint8Array(0);return this.reset(),s}reset(){this.chunks.length=0,this.dataLength=0}}function Gw(i,e){const t=new Uint8Array(e);let s=0;for(let n=0;n<i.length;n++){const r=i[n];t.set(r,s),s+=r.length}return t}var cf={exports:{}},Xy;function Hw(){return Xy||(Xy=1,(function(i){var e=Object.prototype.hasOwnProperty,t="~";function s(){}Object.create&&(s.prototype=Object.create(null),new s().__proto__||(t=!1));function n(h,u,f){this.fn=h,this.context=u,this.once=f||!1}function r(h,u,f,p,v){if(typeof f!="function")throw new TypeError("The listener must be a function");var x=new n(f,p||h,v),S=t?t+u:u;return h._events[S]?h._events[S].fn?h._events[S]=[h._events[S],x]:h._events[S].push(x):(h._events[S]=x,h._eventsCount++),h}function l(h,u){--h._eventsCount===0?h._events=new s:delete h._events[u]}function c(){this._events=new s,this._eventsCount=0}c.prototype.eventNames=function(){var u=[],f,p;if(this._eventsCount===0)return u;for(p in f=this._events)e.call(f,p)&&u.push(t?p.slice(1):p);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(f)):u},c.prototype.listeners=function(u){var f=t?t+u:u,p=this._events[f];if(!p)return[];if(p.fn)return[p.fn];for(var v=0,x=p.length,S=new Array(x);v<x;v++)S[v]=p[v].fn;return S},c.prototype.listenerCount=function(u){var f=t?t+u:u,p=this._events[f];return p?p.fn?1:p.length:0},c.prototype.emit=function(u,f,p,v,x,S){var E=t?t+u:u;if(!this._events[E])return!1;var T=this._events[E],A=arguments.length,I,_;if(T.fn){switch(T.once&&this.removeListener(u,T.fn,void 0,!0),A){case 1:return T.fn.call(T.context),!0;case 2:return T.fn.call(T.context,f),!0;case 3:return T.fn.call(T.context,f,p),!0;case 4:return T.fn.call(T.context,f,p,v),!0;case 5:return T.fn.call(T.context,f,p,v,x),!0;case 6:return T.fn.call(T.context,f,p,v,x,S),!0}for(_=1,I=new Array(A-1);_<A;_++)I[_-1]=arguments[_];T.fn.apply(T.context,I)}else{var C=T.length,k;for(_=0;_<C;_++)switch(T[_].once&&this.removeListener(u,T[_].fn,void 0,!0),A){case 1:T[_].fn.call(T[_].context);break;case 2:T[_].fn.call(T[_].context,f);break;case 3:T[_].fn.call(T[_].context,f,p);break;case 4:T[_].fn.call(T[_].context,f,p,v);break;default:if(!I)for(k=1,I=new Array(A-1);k<A;k++)I[k-1]=arguments[k];T[_].fn.apply(T[_].context,I)}}return!0},c.prototype.on=function(u,f,p){return r(this,u,f,p,!1)},c.prototype.once=function(u,f,p){return r(this,u,f,p,!0)},c.prototype.removeListener=function(u,f,p,v){var x=t?t+u:u;if(!this._events[x])return this;if(!f)return l(this,x),this;var S=this._events[x];if(S.fn)S.fn===f&&(!v||S.once)&&(!p||S.context===p)&&l(this,x);else{for(var E=0,T=[],A=S.length;E<A;E++)(S[E].fn!==f||v&&!S[E].once||p&&S[E].context!==p)&&T.push(S[E]);T.length?this._events[x]=T.length===1?T[0]:T:l(this,x)}return this},c.prototype.removeAllListeners=function(u){var f;return u?(f=t?t+u:u,this._events[f]&&l(this,f)):(this._events=new s,this._eventsCount=0),this},c.prototype.off=c.prototype.removeListener,c.prototype.addListener=c.prototype.on,c.prefixed=t,c.EventEmitter=c,i.exports=c})(cf)),cf.exports}var zw=Hw(),Im=g1(zw);const Jl="1.6.15",Hr={};function Kw(){return typeof __HLS_WORKER_BUNDLE__=="function"}function Yw(){const i=Hr[Jl];if(i)return i.clientCount++,i;const e=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),t=self.URL.createObjectURL(e),n={worker:new self.Worker(t),objectURL:t,clientCount:1};return Hr[Jl]=n,n}function qw(i){const e=Hr[i];if(e)return e.clientCount++,e;const t=new self.URL(i,self.location.href).href,n={worker:new self.Worker(t),scriptURL:t,clientCount:1};return Hr[i]=n,n}function Qw(i){const e=Hr[i||Jl];if(e&&e.clientCount--===1){const{worker:s,objectURL:n}=e;delete Hr[i||Jl],n&&self.URL.revokeObjectURL(n),s.terminate()}}function rb(i,e){return e+10<=i.length&&i[e]===51&&i[e+1]===68&&i[e+2]===73&&i[e+3]<255&&i[e+4]<255&&i[e+6]<128&&i[e+7]<128&&i[e+8]<128&&i[e+9]<128}function _m(i,e){return e+10<=i.length&&i[e]===73&&i[e+1]===68&&i[e+2]===51&&i[e+3]<255&&i[e+4]<255&&i[e+6]<128&&i[e+7]<128&&i[e+8]<128&&i[e+9]<128}function Nu(i,e){let t=0;return t=(i[e]&127)<<21,t|=(i[e+1]&127)<<14,t|=(i[e+2]&127)<<7,t|=i[e+3]&127,t}function eo(i,e){const t=e;let s=0;for(;_m(i,e);){s+=10;const n=Nu(i,e+6);s+=n,rb(i,e+10)&&(s+=10),e+=s}if(s>0)return i.subarray(t,t+s)}function Ww(i,e,t,s){const n=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],r=e[t+2],l=r>>2&15;if(l>12){const x=new Error(`invalid ADTS sampling index:${l}`);i.emit(L.ERROR,L.ERROR,{type:Fe.MEDIA_ERROR,details:Q.FRAG_PARSING_ERROR,fatal:!0,error:x,reason:x.message});return}const c=(r>>6&3)+1,h=e[t+3]>>6&3|(r&1)<<2,u="mp4a.40."+c,f=n[l];let p=l;(c===5||c===29)&&(p-=3);const v=[c<<3|(p&14)>>1,(p&1)<<7|h<<3];return St.log(`manifest codec:${s}, parsed codec:${u}, channels:${h}, rate:${f} (ADTS object type:${c} sampling index:${l})`),{config:v,samplerate:f,channelCount:h,codec:u,parsedCodec:u,manifestCodec:s}}function lb(i,e){return i[e]===255&&(i[e+1]&246)===240}function ob(i,e){return i[e+1]&1?7:9}function Rm(i,e){return(i[e+3]&3)<<11|i[e+4]<<3|(i[e+5]&224)>>>5}function Xw(i,e){return e+5<i.length}function Su(i,e){return e+1<i.length&&lb(i,e)}function Zw(i,e){return Xw(i,e)&&lb(i,e)&&Rm(i,e)<=i.length-e}function Jw(i,e){if(Su(i,e)){const t=ob(i,e);if(e+t>=i.length)return!1;const s=Rm(i,e);if(s<=t)return!1;const n=e+s;return n===i.length||Su(i,n)}return!1}function cb(i,e,t,s,n){if(!i.samplerate){const r=Ww(e,t,s,n);if(!r)return;Lt(i,r)}}function ub(i){return 1024*9e4/i}function eC(i,e){const t=ob(i,e);if(e+t<=i.length){const s=Rm(i,e)-t;if(s>0)return{headerLength:t,frameLength:s}}}function db(i,e,t,s,n){const r=ub(i.samplerate),l=s+n*r,c=eC(e,t);let h;if(c){const{frameLength:p,headerLength:v}=c,x=v+p,S=Math.max(0,t+x-e.length);S?(h=new Uint8Array(x-v),h.set(e.subarray(t+v,e.length),0)):h=e.subarray(t+v,t+x);const E={unit:h,pts:l};return S||i.samples.push(E),{sample:E,length:x,missing:S}}const u=e.length-t;return h=new Uint8Array(u),h.set(e.subarray(t,e.length),0),{sample:{unit:h,pts:l},length:u,missing:-1}}function tC(i,e){return _m(i,e)&&Nu(i,e+6)+10<=i.length-e}function sC(i){return i instanceof ArrayBuffer?i:i.byteOffset==0&&i.byteLength==i.buffer.byteLength?i.buffer:new Uint8Array(i).buffer}function uf(i,e=0,t=1/0){return iC(i,e,t,Uint8Array)}function iC(i,e,t,s){const n=nC(i);let r=1;"BYTES_PER_ELEMENT"in s&&(r=s.BYTES_PER_ELEMENT);const l=aC(i)?i.byteOffset:0,c=(l+i.byteLength)/r,h=(l+e)/r,u=Math.floor(Math.max(0,Math.min(h,c))),f=Math.floor(Math.min(u+Math.max(t,0),c));return new s(n,u,f-u)}function nC(i){return i instanceof ArrayBuffer?i:i.buffer}function aC(i){return i&&i.buffer instanceof ArrayBuffer&&i.byteLength!==void 0&&i.byteOffset!==void 0}function rC(i){const e={key:i.type,description:"",data:"",mimeType:null,pictureType:null},t=3;if(i.size<2)return;if(i.data[0]!==t){console.log("Ignore frame with unrecognized character encoding");return}const s=i.data.subarray(1).indexOf(0);if(s===-1)return;const n=vi(uf(i.data,1,s)),r=i.data[2+s],l=i.data.subarray(3+s).indexOf(0);if(l===-1)return;const c=vi(uf(i.data,3+s,l));let h;return n==="-->"?h=vi(uf(i.data,4+s+l)):h=sC(i.data.subarray(4+s+l)),e.mimeType=n,e.pictureType=r,e.description=c,e.data=h,e}function lC(i){if(i.size<2)return;const e=vi(i.data,!0),t=new Uint8Array(i.data.subarray(e.length+1));return{key:i.type,info:e,data:t.buffer}}function oC(i){if(i.size<2)return;if(i.type==="TXXX"){let t=1;const s=vi(i.data.subarray(t),!0);t+=s.length+1;const n=vi(i.data.subarray(t));return{key:i.type,info:s,data:n}}const e=vi(i.data.subarray(1));return{key:i.type,info:"",data:e}}function cC(i){if(i.type==="WXXX"){if(i.size<2)return;let t=1;const s=vi(i.data.subarray(t),!0);t+=s.length+1;const n=vi(i.data.subarray(t));return{key:i.type,info:s,data:n}}const e=vi(i.data);return{key:i.type,info:"",data:e}}function uC(i){return i.type==="PRIV"?lC(i):i.type[0]==="W"?cC(i):i.type==="APIC"?rC(i):oC(i)}function dC(i){const e=String.fromCharCode(i[0],i[1],i[2],i[3]),t=Nu(i,4),s=10;return{type:e,size:t,data:i.subarray(s,s+t)}}const Uc=10,hC=10;function hb(i){let e=0;const t=[];for(;_m(i,e);){const s=Nu(i,e+6);i[e+5]>>6&1&&(e+=Uc),e+=Uc;const n=e+s;for(;e+hC<n;){const r=dC(i.subarray(e)),l=uC(r);l&&t.push(l),e+=r.size+Uc}rb(i,e)&&(e+=Uc)}return t}function fb(i){return i&&i.key==="PRIV"&&i.info==="com.apple.streaming.transportStreamTimestamp"}function fC(i){if(i.data.byteLength===8){const e=new Uint8Array(i.data),t=e[3]&1;let s=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return s/=45,t&&(s+=4772185884e-2),Math.round(s)}}function Lm(i){const e=hb(i);for(let t=0;t<e.length;t++){const s=e[t];if(fb(s))return fC(s)}}let mi=(function(i){return i.audioId3="org.id3",i.dateRange="com.apple.quicktime.HLS",i.emsg="https://aomedia.org/emsg/ID3",i.misbklv="urn:misb:KLV:bin:1910.1",i})({});function nn(i="",e=9e4){return{type:i,id:-1,pid:-1,inputTimeScale:e,sequenceNumber:-1,samples:[],dropped:0}}class wm{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,s,n){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,s){}demux(e,t){this.cachedData&&(e=ki(this.cachedData,e),this.cachedData=null);let s=eo(e,0),n=s?s.length:0,r;const l=this._audioTrack,c=this._id3Track,h=s?Lm(s):void 0,u=e.length;for((this.basePTS===null||this.frameIndex===0&&Oe(h))&&(this.basePTS=mC(h,t,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),s&&s.length>0&&c.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:s,type:mi.audioId3,duration:Number.POSITIVE_INFINITY});n<u;){if(this.canParse(e,n)){const f=this.appendFrame(l,e,n);f?(this.frameIndex++,this.lastPTS=f.sample.pts,n+=f.length,r=n):n=u}else tC(e,n)?(s=eo(e,n),c.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:s,type:mi.audioId3,duration:Number.POSITIVE_INFINITY}),n+=s.length,r=n):n++;if(n===u&&r!==u){const f=e.slice(r);this.cachedData?this.cachedData=ki(this.cachedData,f):this.cachedData=f}}return{audioTrack:l,videoTrack:nn(),id3Track:c,textTrack:nn()}}demuxSampleAes(e,t,s){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:nn(),id3Track:this._id3Track,textTrack:nn()}}destroy(){this.cachedData=null,this._audioTrack=this._id3Track=void 0}}const mC=(i,e,t)=>{if(Oe(i))return i*90;const s=t?t.baseTime*9e4/t.timescale:0;return e*9e4+s};let Mc=null;const pC=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],gC=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],vC=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],yC=[0,1,1,4];function mb(i,e,t,s,n){if(t+24>e.length)return;const r=pb(e,t);if(r&&t+r.frameLength<=e.length){const l=r.samplesPerFrame*9e4/r.sampleRate,c=s+n*l,h={unit:e.subarray(t,t+r.frameLength),pts:c,dts:c};return i.config=[],i.channelCount=r.channelCount,i.samplerate=r.sampleRate,i.samples.push(h),{sample:h,length:r.frameLength,missing:0}}}function pb(i,e){const t=i[e+1]>>3&3,s=i[e+1]>>1&3,n=i[e+2]>>4&15,r=i[e+2]>>2&3;if(t!==1&&n!==0&&n!==15&&r!==3){const l=i[e+2]>>1&1,c=i[e+3]>>6,h=t===3?3-s:s===3?3:4,u=pC[h*14+n-1]*1e3,p=gC[(t===3?0:t===2?1:2)*3+r],v=c===3?1:2,x=vC[t][s],S=yC[s],E=x*8*S,T=Math.floor(x*u/p+l)*S;if(Mc===null){const _=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Mc=_?parseInt(_[1]):0}return Mc&&Mc<=87&&s===2&&u>=224e3&&c===0&&(i[e+3]=i[e+3]|128),{sampleRate:p,channelCount:v,frameLength:T,samplesPerFrame:E}}}function Cm(i,e){return i[e]===255&&(i[e+1]&224)===224&&(i[e+1]&6)!==0}function gb(i,e){return e+1<i.length&&Cm(i,e)}function xC(i,e){return Cm(i,e)&&4<=i.length-e}function vb(i,e){if(e+1<i.length&&Cm(i,e)){const s=pb(i,e);let n=4;s!=null&&s.frameLength&&(n=s.frameLength);const r=e+n;return r===i.length||gb(i,r)}return!1}class SC extends wm{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,s,n){super.resetInitSegment(e,t,s,n),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:n,inputTimeScale:9e4,dropped:0}}static probe(e,t){if(!e)return!1;const s=eo(e,0);let n=s?.length||0;if(vb(e,n))return!1;for(let r=e.length;n<r;n++)if(Jw(e,n))return t.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return Zw(e,t)}appendFrame(e,t,s){cb(e,this.observer,t,s,e.manifestCodec);const n=db(e,t,s,this.basePTS,this.frameIndex);if(n&&n.missing===0)return n}}const yb=(i,e)=>{let t=0,s=5;e+=s;const n=new Uint32Array(1),r=new Uint32Array(1),l=new Uint8Array(1);for(;s>0;){l[0]=i[e];const c=Math.min(s,8),h=8-c;r[0]=4278190080>>>24+h<<h,n[0]=(l[0]&r[0])>>h,t=t?t<<c|n[0]:n[0],e+=1,s-=c}return t};class bC extends wm{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,t,s,n){super.resetInitSegment(e,t,s,n),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:t,duration:n,inputTimeScale:9e4,dropped:0}}canParse(e,t){return t+64<e.length}appendFrame(e,t,s){const n=xb(e,t,s,this.basePTS,this.frameIndex);if(n!==-1)return{sample:e.samples[e.samples.length-1],length:n,missing:0}}static probe(e){if(!e)return!1;const t=eo(e,0);if(!t)return!1;const s=t.length;return e[s]===11&&e[s+1]===119&&Lm(t)!==void 0&&yb(e,s)<16}}function xb(i,e,t,s,n){if(t+8>e.length||e[t]!==11||e[t+1]!==119)return-1;const r=e[t+4]>>6;if(r>=3)return-1;const c=[48e3,44100,32e3][r],h=e[t+4]&63,f=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][h*3+r]*2;if(t+f>e.length)return-1;const p=e[t+6]>>5;let v=0;p===2?v+=2:(p&1&&p!==1&&(v+=2),p&4&&(v+=2));const x=(e[t+6]<<8|e[t+7])>>12-v&1,E=[2,1,2,3,3,4,4,5][p]+x,T=e[t+5]>>3,A=e[t+5]&7,I=new Uint8Array([r<<6|T<<1|A>>2,(A&3)<<6|p<<3|x<<2|h>>4,h<<4&224]),_=1536/c*9e4,C=s+n*_,k=e.subarray(t,t+f);return i.config=I,i.channelCount=E,i.samplerate=c,i.samples.push({unit:k,pts:C}),f}class TC extends wm{resetInitSegment(e,t,s,n){super.resetInitSegment(e,t,s,n),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:n,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=eo(e,0);let s=t?.length||0;if(t&&e[s]===11&&e[s+1]===119&&Lm(t)!==void 0&&yb(e,s)<=16)return!1;for(let n=e.length;s<n;s++)if(vb(e,s))return St.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return xC(e,t)}appendFrame(e,t,s){if(this.basePTS!==null)return mb(e,t,s,this.basePTS,this.frameIndex)}}const EC=/\/emsg[-/]ID3/i;class AC{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,s,n){const r=this.videoTrack=nn("video",1),l=this.audioTrack=nn("audio",1),c=this.txtTrack=nn("text",1);if(this.id3Track=nn("id3",1),this.timeOffset=0,!(e!=null&&e.byteLength))return;const h=wS(e);if(h.video){const{id:u,timescale:f,codec:p,supplemental:v}=h.video;r.id=u,r.timescale=c.timescale=f,r.codec=p,r.supplemental=v}if(h.audio){const{id:u,timescale:f,codec:p}=h.audio;l.id=u,l.timescale=f,l.codec=p}c.id=_S.text,r.sampleDuration=0,r.duration=l.duration=n}resetContiguity(){this.remainderData=null}static probe(e){return b1(e)}demux(e,t){this.timeOffset=t;let s=e;const n=this.videoTrack,r=this.txtTrack;if(this.config.progressive){this.remainderData&&(s=ki(this.remainderData,e));const c=L1(s);this.remainderData=c.remainder,n.samples=c.valid||new Uint8Array}else n.samples=s;const l=this.extractID3Track(n,t);return r.samples=py(t,n),{videoTrack:n,audioTrack:this.audioTrack,id3Track:l,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,t=this.videoTrack,s=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const n=this.extractID3Track(t,this.timeOffset);return s.samples=py(e,t),{videoTrack:t,audioTrack:nn(),id3Track:n,textTrack:nn()}}extractID3Track(e,t){const s=this.id3Track;if(e.samples.length){const n=tt(e.samples,["emsg"]);n&&n.forEach(r=>{const l=C1(r);if(EC.test(l.schemeIdUri)){const c=Zy(l,t);let h=l.eventDuration===4294967295?Number.POSITIVE_INFINITY:l.eventDuration/l.timeScale;h<=.001&&(h=Number.POSITIVE_INFINITY);const u=l.payload;s.samples.push({data:u,len:u.byteLength,dts:c,pts:c,type:mi.emsg,duration:h})}else if(this.config.enableEmsgKLVMetadata&&l.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){const c=Zy(l,t);s.samples.push({data:l.payload,len:l.payload.byteLength,dts:c,pts:c,type:mi.misbklv,duration:Number.POSITIVE_INFINITY})}})}return s}demuxSampleAes(e,t,s){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0}}function Zy(i,e){return Oe(i.presentationTime)?i.presentationTime/i.timeScale:e+i.presentationTimeDelta/i.timeScale}class IC{constructor(e,t,s){this.keyData=void 0,this.decrypter=void 0,this.keyData=s,this.decrypter=new Sm(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer,xa.cbc)}decryptAacSample(e,t,s){const n=e[t].unit;if(n.length<=16)return;const r=n.subarray(16,n.length-n.length%16),l=r.buffer.slice(r.byteOffset,r.byteOffset+r.length);this.decryptBuffer(l).then(c=>{const h=new Uint8Array(c);n.set(h,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,s)}).catch(s)}decryptAacSamples(e,t,s){for(;;t++){if(t>=e.length){s();return}if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,s),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){const t=Math.floor((e.length-48)/160)*16+16,s=new Int8Array(t);let n=0;for(let r=32;r<e.length-16;r+=160,n+=16)s.set(e.subarray(r,r+16),n);return s}getAvcDecryptedUnit(e,t){const s=new Uint8Array(t);let n=0;for(let r=32;r<e.length-16;r+=160,n+=16)e.set(s.subarray(n,n+16),r);return e}decryptAvcSample(e,t,s,n,r){const l=NS(r.data),c=this.getAvcEncryptedData(l);this.decryptBuffer(c.buffer).then(h=>{r.data=this.getAvcDecryptedUnit(l,h),this.decrypter.isSync()||this.decryptAvcSamples(e,t,s+1,n)}).catch(n)}decryptAvcSamples(e,t,s,n){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,s=0){if(t>=e.length){n();return}const r=e[t].units;for(;!(s>=r.length);s++){const l=r[s];if(!(l.data.length<=48||l.type!==1&&l.type!==5)&&(this.decryptAvcSample(e,t,s,n,l),!this.decrypter.isSync()))return}}}}class Sb{constructor(){this.VideoSample=null}createVideoSample(e,t,s){return{key:e,frame:!1,pts:t,dts:s,units:[],length:0}}getLastNalUnit(e){var t;let s=this.VideoSample,n;if((!s||s.units.length===0)&&(s=e[e.length-1]),(t=s)!=null&&t.units){const r=s.units;n=r[r.length-1]}return n}pushAccessUnit(e,t){if(e.units.length&&e.frame){if(e.pts===void 0){const s=t.samples,n=s.length;if(n){const r=s[n-1];e.pts=r.pts,e.dts=r.dts}else{t.dropped++;return}}t.samples.push(e)}}parseNALu(e,t,s){const n=t.byteLength;let r=e.naluState||0;const l=r,c=[];let h=0,u,f,p,v=-1,x=0;for(r===-1&&(v=0,x=this.getNALuType(t,0),r=0,h=1);h<n;){if(u=t[h++],!r){r=u?0:1;continue}if(r===1){r=u?0:2;continue}if(!u)r=3;else if(u===1){if(f=h-r-1,v>=0){const S={data:t.subarray(v,f),type:x};c.push(S)}else{const S=this.getLastNalUnit(e.samples);S&&(l&&h<=4-l&&S.state&&(S.data=S.data.subarray(0,S.data.byteLength-l)),f>0&&(S.data=ki(S.data,t.subarray(0,f)),S.state=0))}h<n?(p=this.getNALuType(t,h),v=h,x=p,r=0):r=-1}else r=0}if(v>=0&&r>=0){const S={data:t.subarray(v,n),type:x,state:r};c.push(S)}if(c.length===0){const S=this.getLastNalUnit(e.samples);S&&(S.data=ki(S.data,t))}return e.naluState=r,c}}class Yl{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,s=e.byteLength-t,n=new Uint8Array(4),r=Math.min(4,t);if(r===0)throw new Error("no bytes available");n.set(e.subarray(s,s+r)),this.word=new DataView(n.buffer).getUint32(0),this.bitsAvailable=r*8,this.bytesAvailable-=r}skipBits(e){let t;e=Math.min(e,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const s=this.word>>>32-t;if(e>32&&St.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return t=e-t,t>0&&this.bitsAvailable?s<<t|this.readBits(t):s}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if((this.word&2147483648>>>e)!==0)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}}class _C extends Sb{parsePES(e,t,s,n){const r=this.parseNALu(e,s.data,n);let l=this.VideoSample,c,h=!1;s.data=null,l&&r.length&&!e.audFound&&(this.pushAccessUnit(l,e),l=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts)),r.forEach(u=>{var f,p;switch(u.type){case 1:{let E=!1;c=!0;const T=u.data;if(h&&T.length>4){const A=this.readSliceType(T);(A===2||A===4||A===7||A===9)&&(E=!0)}if(E){var v;(v=l)!=null&&v.frame&&!l.key&&(this.pushAccessUnit(l,e),l=this.VideoSample=null)}l||(l=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),l.frame=!0,l.key=E;break}case 5:c=!0,(f=l)!=null&&f.frame&&!l.key&&(this.pushAccessUnit(l,e),l=this.VideoSample=null),l||(l=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),l.key=!0,l.frame=!0;break;case 6:{c=!0,gm(u.data,1,s.pts,t.samples);break}case 7:{var x,S;c=!0,h=!0;const E=u.data,T=this.readSPS(E);if(!e.sps||e.width!==T.width||e.height!==T.height||((x=e.pixelRatio)==null?void 0:x[0])!==T.pixelRatio[0]||((S=e.pixelRatio)==null?void 0:S[1])!==T.pixelRatio[1]){e.width=T.width,e.height=T.height,e.pixelRatio=T.pixelRatio,e.sps=[E];const A=E.subarray(1,4);let I="avc1.";for(let _=0;_<3;_++){let C=A[_].toString(16);C.length<2&&(C="0"+C),I+=C}e.codec=I}break}case 8:c=!0,e.pps=[u.data];break;case 9:c=!0,e.audFound=!0,(p=l)!=null&&p.frame&&(this.pushAccessUnit(l,e),l=null),l||(l=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts));break;case 12:c=!0;break;default:c=!1;break}l&&c&&l.units.push(u)}),n&&l&&(this.pushAccessUnit(l,e),this.VideoSample=null)}getNALuType(e,t){return e[t]&31}readSliceType(e){const t=new Yl(e);return t.readUByte(),t.readUEG(),t.readUEG()}skipScalingList(e,t){let s=8,n=8,r;for(let l=0;l<e;l++)n!==0&&(r=t.readEG(),n=(s+r+256)%256),s=n===0?s:n}readSPS(e){const t=new Yl(e);let s=0,n=0,r=0,l=0,c,h,u;const f=t.readUByte.bind(t),p=t.readBits.bind(t),v=t.readUEG.bind(t),x=t.readBoolean.bind(t),S=t.skipBits.bind(t),E=t.skipEG.bind(t),T=t.skipUEG.bind(t),A=this.skipScalingList.bind(this);f();const I=f();if(p(5),S(3),f(),T(),I===100||I===110||I===122||I===244||I===44||I===83||I===86||I===118||I===128){const F=v();if(F===3&&S(1),T(),T(),S(1),x())for(h=F!==3?8:12,u=0;u<h;u++)x()&&(u<6?A(16,t):A(64,t))}T();const _=v();if(_===0)v();else if(_===1)for(S(1),E(),E(),c=v(),u=0;u<c;u++)E();T(),S(1);const C=v(),k=v(),U=p(1);U===0&&S(1),S(1),x()&&(s=v(),n=v(),r=v(),l=v());let O=[1,1];if(x()&&x())switch(f()){case 1:O=[1,1];break;case 2:O=[12,11];break;case 3:O=[10,11];break;case 4:O=[16,11];break;case 5:O=[40,33];break;case 6:O=[24,11];break;case 7:O=[20,11];break;case 8:O=[32,11];break;case 9:O=[80,33];break;case 10:O=[18,11];break;case 11:O=[15,11];break;case 12:O=[64,33];break;case 13:O=[160,99];break;case 14:O=[4,3];break;case 15:O=[3,2];break;case 16:O=[2,1];break;case 255:{O=[f()<<8|f(),f()<<8|f()];break}}return{width:Math.ceil((C+1)*16-s*2-n*2),height:(2-U)*(k+1)*16-(U?2:4)*(r+l),pixelRatio:O}}}class RC extends Sb{constructor(...e){super(...e),this.initVPS=null}parsePES(e,t,s,n){const r=this.parseNALu(e,s.data,n);let l=this.VideoSample,c,h=!1;s.data=null,l&&r.length&&!e.audFound&&(this.pushAccessUnit(l,e),l=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts)),r.forEach(u=>{var f,p;switch(u.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:l||(l=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts)),l.frame=!0,c=!0;break;case 16:case 17:case 18:case 21:if(c=!0,h){var v;(v=l)!=null&&v.frame&&!l.key&&(this.pushAccessUnit(l,e),l=this.VideoSample=null)}l||(l=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),l.key=!0,l.frame=!0;break;case 19:case 20:c=!0,(f=l)!=null&&f.frame&&!l.key&&(this.pushAccessUnit(l,e),l=this.VideoSample=null),l||(l=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),l.key=!0,l.frame=!0;break;case 39:c=!0,gm(u.data,2,s.pts,t.samples);break;case 32:c=!0,e.vps||(typeof e.params!="object"&&(e.params={}),e.params=Lt(e.params,this.readVPS(u.data)),this.initVPS=u.data),e.vps=[u.data];break;case 33:if(c=!0,h=!0,e.vps!==void 0&&e.vps[0]!==this.initVPS&&e.sps!==void 0&&!this.matchSPS(e.sps[0],u.data)&&(this.initVPS=e.vps[0],e.sps=e.pps=void 0),!e.sps){const x=this.readSPS(u.data);e.width=x.width,e.height=x.height,e.pixelRatio=x.pixelRatio,e.codec=x.codecString,e.sps=[],typeof e.params!="object"&&(e.params={});for(const S in x.params)e.params[S]=x.params[S]}this.pushParameterSet(e.sps,u.data,e.vps),l||(l=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),l.key=!0;break;case 34:if(c=!0,typeof e.params=="object"){if(!e.pps){e.pps=[];const x=this.readPPS(u.data);for(const S in x)e.params[S]=x[S]}this.pushParameterSet(e.pps,u.data,e.vps)}break;case 35:c=!0,e.audFound=!0,(p=l)!=null&&p.frame&&(this.pushAccessUnit(l,e),l=null),l||(l=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts));break;default:c=!1;break}l&&c&&l.units.push(u)}),n&&l&&(this.pushAccessUnit(l,e),this.VideoSample=null)}pushParameterSet(e,t,s){(s&&s[0]===this.initVPS||!s&&!e.length)&&e.push(t)}getNALuType(e,t){return(e[t]&126)>>>1}ebsp2rbsp(e){const t=new Uint8Array(e.byteLength);let s=0;for(let n=0;n<e.byteLength;n++)n>=2&&e[n]===3&&e[n-1]===0&&e[n-2]===0||(t[s]=e[n],s++);return new Uint8Array(t.buffer,0,s)}pushAccessUnit(e,t){super.pushAccessUnit(e,t),this.initVPS&&(this.initVPS=null)}readVPS(e){const t=new Yl(e);t.readUByte(),t.readUByte(),t.readBits(4),t.skipBits(2),t.readBits(6);const s=t.readBits(3),n=t.readBoolean();return{numTemporalLayers:s+1,temporalIdNested:n}}readSPS(e){const t=new Yl(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.readBits(4);const s=t.readBits(3);t.readBoolean();const n=t.readBits(2),r=t.readBoolean(),l=t.readBits(5),c=t.readUByte(),h=t.readUByte(),u=t.readUByte(),f=t.readUByte(),p=t.readUByte(),v=t.readUByte(),x=t.readUByte(),S=t.readUByte(),E=t.readUByte(),T=t.readUByte(),A=t.readUByte(),I=[],_=[];for(let Ve=0;Ve<s;Ve++)I.push(t.readBoolean()),_.push(t.readBoolean());if(s>0)for(let Ve=s;Ve<8;Ve++)t.readBits(2);for(let Ve=0;Ve<s;Ve++)I[Ve]&&(t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte()),_[Ve]&&t.readUByte();t.readUEG();const C=t.readUEG();C==3&&t.skipBits(1);const k=t.readUEG(),U=t.readUEG(),O=t.readBoolean();let F=0,j=0,M=0,H=0;O&&(F+=t.readUEG(),j+=t.readUEG(),M+=t.readUEG(),H+=t.readUEG());const K=t.readUEG(),te=t.readUEG(),ae=t.readUEG(),me=t.readBoolean();for(let Ve=me?0:s;Ve<=s;Ve++)t.skipUEG(),t.skipUEG(),t.skipUEG();if(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.readBoolean()&&t.readBoolean())for(let we=0;we<4;we++)for(let Me=0;Me<(we===3?2:6);Me++)if(!t.readBoolean())t.readUEG();else{const ge=Math.min(64,1<<4+(we<<1));we>1&&t.readEG();for(let _e=0;_e<ge;_e++)t.readEG()}t.readBoolean(),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.skipUEG(),t.skipUEG(),t.readBoolean());const Y=t.readUEG();let oe=0;for(let Ve=0;Ve<Y;Ve++){let we=!1;if(Ve!==0&&(we=t.readBoolean()),we){Ve===Y&&t.readUEG(),t.readBoolean(),t.readUEG();let Me=0;for(let Qe=0;Qe<=oe;Qe++){const ge=t.readBoolean();let _e=!1;ge||(_e=t.readBoolean()),(ge||_e)&&Me++}oe=Me}else{const Me=t.readUEG(),Qe=t.readUEG();oe=Me+Qe;for(let ge=0;ge<Me;ge++)t.readUEG(),t.readBoolean();for(let ge=0;ge<Qe;ge++)t.readUEG(),t.readBoolean()}}if(t.readBoolean()){const Ve=t.readUEG();for(let we=0;we<Ve;we++){for(let Me=0;Me<ae+4;Me++)t.readBits(1);t.readBits(1)}}let P=0,V=1,se=1,he=!0,ye=1,Ae=0;t.readBoolean(),t.readBoolean();let Pe=!1;if(t.readBoolean()){if(t.readBoolean()){const De=t.readUByte(),at=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],st=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];De>0&&De<16?(V=at[De-1],se=st[De-1]):De===255&&(V=t.readBits(16),se=t.readBits(16))}if(t.readBoolean()&&t.readBoolean(),t.readBoolean()&&(t.readBits(3),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.readUByte(),t.readUByte())),t.readBoolean()&&(t.readUEG(),t.readUEG()),t.readBoolean(),t.readBoolean(),t.readBoolean(),Pe=t.readBoolean(),Pe&&(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG()),t.readBoolean()&&(ye=t.readBits(32),Ae=t.readBits(32),t.readBoolean()&&t.readUEG(),t.readBoolean())){const st=t.readBoolean(),Bt=t.readBoolean();let ts=!1;(st||Bt)&&(ts=t.readBoolean(),ts&&(t.readUByte(),t.readBits(5),t.readBoolean(),t.readBits(5)),t.readBits(4),t.readBits(4),ts&&t.readBits(4),t.readBits(5),t.readBits(5),t.readBits(5));for(let ys=0;ys<=s;ys++){he=t.readBoolean();const xs=he||t.readBoolean();let Ss=!1;xs?t.readEG():Ss=t.readBoolean();const Cs=Ss?1:t.readUEG()+1;if(st)for(let Ht=0;Ht<Cs;Ht++)t.readUEG(),t.readUEG(),ts&&(t.readUEG(),t.readUEG()),t.skipBits(1);if(Bt)for(let Ht=0;Ht<Cs;Ht++)t.readUEG(),t.readUEG(),ts&&(t.readUEG(),t.readUEG()),t.skipBits(1)}}t.readBoolean()&&(t.readBoolean(),t.readBoolean(),t.readBoolean(),P=t.readUEG())}let Be=k,ht=U;if(O){let Ve=1,we=1;C===1?Ve=we=2:C==2&&(Ve=2),Be=k-Ve*j-Ve*F,ht=U-we*H-we*M}const dt=n?["A","B","C"][n]:"",Mt=c<<24|h<<16|u<<8|f;let bt=0;for(let Ve=0;Ve<32;Ve++)bt=(bt|(Mt>>Ve&1)<<31-Ve)>>>0;let Tt=bt.toString(16);return l===1&&Tt==="2"&&(Tt="6"),{codecString:`hvc1.${dt}${l}.${Tt}.${r?"H":"L"}${A}.B0`,params:{general_tier_flag:r,general_profile_idc:l,general_profile_space:n,general_profile_compatibility_flags:[c,h,u,f],general_constraint_indicator_flags:[p,v,x,S,E,T],general_level_idc:A,bit_depth:K+8,bit_depth_luma_minus8:K,bit_depth_chroma_minus8:te,min_spatial_segmentation_idc:P,chroma_format_idc:C,frame_rate:{fixed:he,fps:Ae/ye}},width:Be,height:ht,pixelRatio:[V,se]}}readPPS(e){const t=new Yl(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.skipUEG(),t.skipUEG(),t.skipBits(2),t.skipBits(3),t.skipBits(2),t.skipUEG(),t.skipUEG(),t.skipEG(),t.skipBits(2),t.readBoolean()&&t.skipUEG(),t.skipEG(),t.skipEG(),t.skipBits(4);const n=t.readBoolean(),r=t.readBoolean();let l=1;return r&&n?l=0:r?l=3:n&&(l=2),{parallelismType:l}}matchSPS(e,t){return String.fromCharCode.apply(null,e).substr(3)===String.fromCharCode.apply(null,t).substr(3)}}const gs=188;class pa{constructor(e,t,s,n){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=t,this.typeSupported=s,this.logger=n,this.videoParser=null}static probe(e,t){const s=pa.syncOffset(e);return s>0&&t.warn(`MPEG2-TS detected but first sync word found @ offset ${s}`),s!==-1}static syncOffset(e){const t=e.length;let s=Math.min(gs*5,t-gs)+1,n=0;for(;n<s;){let r=!1,l=-1,c=0;for(let h=n;h<t;h+=gs)if(e[h]===71&&(t-h===gs||e[h+gs]===71)){if(c++,l===-1&&(l=h,l!==0&&(s=Math.min(l+gs*99,e.length-gs)+1)),r||(r=Gf(e,h)===0),r&&c>1&&(l===0&&c>2||h+gs>s))return l}else{if(c)return-1;break}n++}return-1}static createTrack(e,t){return{container:e==="video"||e==="audio"?"video/mp2t":void 0,type:e,id:_S[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:e==="audio"?t:void 0}}resetInitSegment(e,t,s,n){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=pa.createTrack("video"),this._videoTrack.duration=n,this._audioTrack=pa.createTrack("audio",n),this._id3Track=pa.createTrack("id3"),this._txtTrack=pa.createTrack("text"),this._audioTrack.segmentCodec="aac",this.videoParser=null,this.aacOverFlow=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=s}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_videoTrack:t,_id3Track:s}=this;e&&(e.pesData=null),t&&(t.pesData=null),s&&(s.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,t,s=!1,n=!1){s||(this.sampleAes=null);let r;const l=this._videoTrack,c=this._audioTrack,h=this._id3Track,u=this._txtTrack;let f=l.pid,p=l.pesData,v=c.pid,x=h.pid,S=c.pesData,E=h.pesData,T=null,A=this.pmtParsed,I=this._pmtId,_=e.length;if(this.remainderData&&(e=ki(this.remainderData,e),_=e.length,this.remainderData=null),_<gs&&!n)return this.remainderData=e,{audioTrack:c,videoTrack:l,id3Track:h,textTrack:u};const C=Math.max(0,pa.syncOffset(e));_-=(_-C)%gs,_<e.byteLength&&!n&&(this.remainderData=new Uint8Array(e.buffer,_,e.buffer.byteLength-_));let k=0;for(let O=C;O<_;O+=gs)if(e[O]===71){const F=!!(e[O+1]&64),j=Gf(e,O),M=(e[O+3]&48)>>4;let H;if(M>1){if(H=O+5+e[O+4],H===O+gs)continue}else H=O+4;switch(j){case f:F&&(p&&(r=kr(p,this.logger))&&(this.readyVideoParser(l.segmentCodec),this.videoParser!==null&&this.videoParser.parsePES(l,u,r,!1)),p={data:[],size:0}),p&&(p.data.push(e.subarray(H,O+gs)),p.size+=O+gs-H);break;case v:if(F){if(S&&(r=kr(S,this.logger)))switch(c.segmentCodec){case"aac":this.parseAACPES(c,r);break;case"mp3":this.parseMPEGPES(c,r);break;case"ac3":this.parseAC3PES(c,r);break}S={data:[],size:0}}S&&(S.data.push(e.subarray(H,O+gs)),S.size+=O+gs-H);break;case x:F&&(E&&(r=kr(E,this.logger))&&this.parseID3PES(h,r),E={data:[],size:0}),E&&(E.data.push(e.subarray(H,O+gs)),E.size+=O+gs-H);break;case 0:F&&(H+=e[H]+1),I=this._pmtId=LC(e,H);break;case I:{F&&(H+=e[H]+1);const K=wC(e,H,this.typeSupported,s,this.observer,this.logger);f=K.videoPid,f>0&&(l.pid=f,l.segmentCodec=K.segmentVideoCodec),v=K.audioPid,v>0&&(c.pid=v,c.segmentCodec=K.segmentAudioCodec),x=K.id3Pid,x>0&&(h.pid=x),T!==null&&!A&&(this.logger.warn(`MPEG-TS PMT found at ${O} after unknown PID '${T}'. Backtracking to sync byte @${C} to parse all TS packets.`),T=null,O=C-188),A=this.pmtParsed=!0;break}case 17:case 8191:break;default:T=j;break}}else k++;k>0&&Hf(this.observer,new Error(`Found ${k} TS packet/s that do not start with 0x47`),void 0,this.logger),l.pesData=p,c.pesData=S,h.pesData=E;const U={audioTrack:c,videoTrack:l,id3Track:h,textTrack:u};return n&&this.extractRemainingSamples(U),U}flush(){const{remainderData:e}=this;this.remainderData=null;let t;return e?t=this.demux(e,-1,!1,!0):t={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){const{audioTrack:t,videoTrack:s,id3Track:n,textTrack:r}=e,l=s.pesData,c=t.pesData,h=n.pesData;let u;if(l&&(u=kr(l,this.logger))?(this.readyVideoParser(s.segmentCodec),this.videoParser!==null&&(this.videoParser.parsePES(s,r,u,!0),s.pesData=null)):s.pesData=l,c&&(u=kr(c,this.logger))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,u);break;case"mp3":this.parseMPEGPES(t,u);break;case"ac3":this.parseAC3PES(t,u);break}t.pesData=null}else c!=null&&c.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=c;h&&(u=kr(h,this.logger))?(this.parseID3PES(n,u),n.pesData=null):n.pesData=h}demuxSampleAes(e,t,s){const n=this.demux(e,s,!0,!this.config.progressive),r=this.sampleAes=new IC(this.observer,this.config,t);return this.decrypt(n,r)}readyVideoParser(e){this.videoParser===null&&(e==="avc"?this.videoParser=new _C:e==="hevc"&&(this.videoParser=new RC))}decrypt(e,t){return new Promise(s=>{const{audioTrack:n,videoTrack:r}=e;n.samples&&n.segmentCodec==="aac"?t.decryptAacSamples(n.samples,0,()=>{r.samples?t.decryptAvcSamples(r.samples,0,0,()=>{s(e)}):s(e)}):r.samples&&t.decryptAvcSamples(r.samples,0,0,()=>{s(e)})})}destroy(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0}parseAACPES(e,t){let s=0;const n=this.aacOverFlow;let r=t.data;if(n){this.aacOverFlow=null;const p=n.missing,v=n.sample.unit.byteLength;if(p===-1)r=ki(n.sample.unit,r);else{const x=v-p;n.sample.unit.set(r.subarray(0,p),x),e.samples.push(n.sample),s=n.missing}}let l,c;for(l=s,c=r.length;l<c-1&&!Su(r,l);l++);if(l!==s){let p;const v=l<c-1;if(v?p=`AAC PES did not start with ADTS header,offset:${l}`:p="No ADTS header found in AAC PES",Hf(this.observer,new Error(p),v,this.logger),!v)return}cb(e,this.observer,r,l,this.audioCodec);let h;if(t.pts!==void 0)h=t.pts;else if(n){const p=ub(e.samplerate);h=n.sample.pts+p}else{this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}let u=0,f;for(;l<c;)if(f=db(e,r,l,h,u),l+=f.length,f.missing){this.aacOverFlow=f;break}else for(u++;l<c-1&&!Su(r,l);l++);}parseMPEGPES(e,t){const s=t.data,n=s.length;let r=0,l=0;const c=t.pts;if(c===void 0){this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;l<n;)if(gb(s,l)){const h=mb(e,s,l,c,r);if(h)l+=h.length,r++;else break}else l++}parseAC3PES(e,t){{const s=t.data,n=t.pts;if(n===void 0){this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");return}const r=s.length;let l=0,c=0,h;for(;c<r&&(h=xb(e,s,c,n,l++))>0;)c+=h}}parseID3PES(e,t){if(t.pts===void 0){this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}const s=Lt({},t,{type:this._videoTrack?mi.emsg:mi.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(s)}}function Gf(i,e){return((i[e+1]&31)<<8)+i[e+2]}function LC(i,e){return(i[e+10]&31)<<8|i[e+11]}function wC(i,e,t,s,n,r){const l={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},c=(i[e+1]&15)<<8|i[e+2],h=e+3+c-4,u=(i[e+10]&15)<<8|i[e+11];for(e+=12+u;e<h;){const f=Gf(i,e),p=(i[e+3]&15)<<8|i[e+4];switch(i[e]){case 207:if(!s){df("ADTS AAC",r);break}case 15:l.audioPid===-1&&(l.audioPid=f);break;case 21:l.id3Pid===-1&&(l.id3Pid=f);break;case 219:if(!s){df("H.264",r);break}case 27:l.videoPid===-1&&(l.videoPid=f);break;case 3:case 4:!t.mpeg&&!t.mp3?r.log("MPEG audio found, not supported in this browser"):l.audioPid===-1&&(l.audioPid=f,l.segmentAudioCodec="mp3");break;case 193:if(!s){df("AC-3",r);break}case 129:t.ac3?l.audioPid===-1&&(l.audioPid=f,l.segmentAudioCodec="ac3"):r.log("AC-3 audio found, not supported in this browser");break;case 6:if(l.audioPid===-1&&p>0){let v=e+5,x=p;for(;x>2;){i[v]===106&&(t.ac3!==!0?r.log("AC-3 audio found, not supported in this browser for now"):(l.audioPid=f,l.segmentAudioCodec="ac3"));const E=i[v+1]+2;v+=E,x-=E}}break;case 194:case 135:return Hf(n,new Error("Unsupported EC-3 in M2TS found"),void 0,r),l;case 36:l.videoPid===-1&&(l.videoPid=f,l.segmentVideoCodec="hevc",r.log("HEVC in M2TS found"));break}e+=p+5}return l}function Hf(i,e,t,s){s.warn(`parsing error: ${e.message}`),i.emit(L.ERROR,L.ERROR,{type:Fe.MEDIA_ERROR,details:Q.FRAG_PARSING_ERROR,fatal:!1,levelRetry:t,error:e,reason:e.message})}function df(i,e){e.log(`${i} with AES-128-CBC encryption found in unencrypted stream`)}function kr(i,e){let t=0,s,n,r,l,c;const h=i.data;if(!i||i.size===0)return null;for(;h[0].length<19&&h.length>1;)h[0]=ki(h[0],h[1]),h.splice(1,1);if(s=h[0],(s[0]<<16)+(s[1]<<8)+s[2]===1){if(n=(s[4]<<8)+s[5],n&&n>i.size-6)return null;const f=s[7];f&192&&(l=(s[9]&14)*536870912+(s[10]&255)*4194304+(s[11]&254)*16384+(s[12]&255)*128+(s[13]&254)/2,f&64?(c=(s[14]&14)*536870912+(s[15]&255)*4194304+(s[16]&254)*16384+(s[17]&255)*128+(s[18]&254)/2,l-c>60*9e4&&(e.warn(`${Math.round((l-c)/9e4)}s delta between PTS and DTS, align them`),l=c)):c=l),r=s[8];let p=r+9;if(i.size<=p)return null;i.size-=p;const v=new Uint8Array(i.size);for(let x=0,S=h.length;x<S;x++){s=h[x];let E=s.byteLength;if(p)if(p>E){p-=E;continue}else s=s.subarray(p),E-=p,p=0;v.set(s,t),t+=E}return n&&(n-=r+3),{data:v,pts:l,dts:c,len:n}}return null}class CC{static getSilentFrame(e,t){switch(e){case"mp4a.40.2":if(t===1)return new Uint8Array([0,200,0,128,35,128]);if(t===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(t===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(t===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(t===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(t===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(t===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const ha=Math.pow(2,32)-1;class q{static init(){q.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let e;for(e in q.types)q.types.hasOwnProperty(e)&&(q.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),s=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);q.HDLR_TYPES={video:t,audio:s};const n=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),r=new Uint8Array([0,0,0,0,0,0,0,0]);q.STTS=q.STSC=q.STCO=r,q.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),q.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),q.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),q.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const l=new Uint8Array([105,115,111,109]),c=new Uint8Array([97,118,99,49]),h=new Uint8Array([0,0,0,1]);q.FTYP=q.box(q.types.ftyp,l,h,l,c),q.DINF=q.box(q.types.dinf,q.box(q.types.dref,n))}static box(e,...t){let s=8,n=t.length;const r=n;for(;n--;)s+=t[n].byteLength;const l=new Uint8Array(s);for(l[0]=s>>24&255,l[1]=s>>16&255,l[2]=s>>8&255,l[3]=s&255,l.set(e,4),n=0,s=8;n<r;n++)l.set(t[n],s),s+=t[n].byteLength;return l}static hdlr(e){return q.box(q.types.hdlr,q.HDLR_TYPES[e])}static mdat(e){return q.box(q.types.mdat,e)}static mdhd(e,t){t*=e;const s=Math.floor(t/(ha+1)),n=Math.floor(t%(ha+1));return q.box(q.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,s>>24,s>>16&255,s>>8&255,s&255,n>>24,n>>16&255,n>>8&255,n&255,85,196,0,0]))}static mdia(e){return q.box(q.types.mdia,q.mdhd(e.timescale||0,e.duration||0),q.hdlr(e.type),q.minf(e))}static mfhd(e){return q.box(q.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255]))}static minf(e){return e.type==="audio"?q.box(q.types.minf,q.box(q.types.smhd,q.SMHD),q.DINF,q.stbl(e)):q.box(q.types.minf,q.box(q.types.vmhd,q.VMHD),q.DINF,q.stbl(e))}static moof(e,t,s){return q.box(q.types.moof,q.mfhd(e),q.traf(s,t))}static moov(e){let t=e.length;const s=[];for(;t--;)s[t]=q.trak(e[t]);return q.box.apply(null,[q.types.moov,q.mvhd(e[0].timescale||0,e[0].duration||0)].concat(s).concat(q.mvex(e)))}static mvex(e){let t=e.length;const s=[];for(;t--;)s[t]=q.trex(e[t]);return q.box.apply(null,[q.types.mvex,...s])}static mvhd(e,t){t*=e;const s=Math.floor(t/(ha+1)),n=Math.floor(t%(ha+1)),r=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,s>>24,s>>16&255,s>>8&255,s&255,n>>24,n>>16&255,n>>8&255,n&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return q.box(q.types.mvhd,r)}static sdtp(e){const t=e.samples||[],s=new Uint8Array(4+t.length);let n,r;for(n=0;n<t.length;n++)r=t[n].flags,s[n+4]=r.dependsOn<<4|r.isDependedOn<<2|r.hasRedundancy;return q.box(q.types.sdtp,s)}static stbl(e){return q.box(q.types.stbl,q.stsd(e),q.box(q.types.stts,q.STTS),q.box(q.types.stsc,q.STSC),q.box(q.types.stsz,q.STSZ),q.box(q.types.stco,q.STCO))}static avc1(e){let t=[],s=[],n,r,l;for(n=0;n<e.sps.length;n++)r=e.sps[n],l=r.byteLength,t.push(l>>>8&255),t.push(l&255),t=t.concat(Array.prototype.slice.call(r));for(n=0;n<e.pps.length;n++)r=e.pps[n],l=r.byteLength,s.push(l>>>8&255),s.push(l&255),s=s.concat(Array.prototype.slice.call(r));const c=q.box(q.types.avcC,new Uint8Array([1,t[3],t[4],t[5],255,224|e.sps.length].concat(t).concat([e.pps.length]).concat(s))),h=e.width,u=e.height,f=e.pixelRatio[0],p=e.pixelRatio[1];return q.box(q.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,h>>8&255,h&255,u>>8&255,u&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),c,q.box(q.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),q.box(q.types.pasp,new Uint8Array([f>>24,f>>16&255,f>>8&255,f&255,p>>24,p>>16&255,p>>8&255,p&255])))}static esds(e){const t=e.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2,...t,6,1,2])}static audioStsd(e){const t=e.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount||0,0,16,0,0,0,0,t>>8&255,t&255,0,0])}static mp4a(e){return q.box(q.types.mp4a,q.audioStsd(e),q.box(q.types.esds,q.esds(e)))}static mp3(e){return q.box(q.types[".mp3"],q.audioStsd(e))}static ac3(e){return q.box(q.types["ac-3"],q.audioStsd(e),q.box(q.types.dac3,e.config))}static stsd(e){const{segmentCodec:t}=e;if(e.type==="audio"){if(t==="aac")return q.box(q.types.stsd,q.STSD,q.mp4a(e));if(t==="ac3"&&e.config)return q.box(q.types.stsd,q.STSD,q.ac3(e));if(t==="mp3"&&e.codec==="mp3")return q.box(q.types.stsd,q.STSD,q.mp3(e))}else if(e.pps&&e.sps){if(t==="avc")return q.box(q.types.stsd,q.STSD,q.avc1(e));if(t==="hevc"&&e.vps)return q.box(q.types.stsd,q.STSD,q.hvc1(e))}else throw new Error("video track missing pps or sps");throw new Error(`unsupported ${e.type} segment codec (${t}/${e.codec})`)}static tkhd(e){const t=e.id,s=(e.duration||0)*(e.timescale||0),n=e.width||0,r=e.height||0,l=Math.floor(s/(ha+1)),c=Math.floor(s%(ha+1));return q.box(q.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,0,0,0,0,l>>24,l>>16&255,l>>8&255,l&255,c>>24,c>>16&255,c>>8&255,c&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,n>>8&255,n&255,0,0,r>>8&255,r&255,0,0]))}static traf(e,t){const s=q.sdtp(e),n=e.id,r=Math.floor(t/(ha+1)),l=Math.floor(t%(ha+1));return q.box(q.types.traf,q.box(q.types.tfhd,new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,n&255])),q.box(q.types.tfdt,new Uint8Array([1,0,0,0,r>>24,r>>16&255,r>>8&255,r&255,l>>24,l>>16&255,l>>8&255,l&255])),q.trun(e,s.length+16+20+8+16+8+8),s)}static trak(e){return e.duration=e.duration||4294967295,q.box(q.types.trak,q.tkhd(e),q.mdia(e))}static trex(e){const t=e.id;return q.box(q.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){const s=e.samples||[],n=s.length,r=12+16*n,l=new Uint8Array(r);let c,h,u,f,p,v;for(t+=8+r,l.set([e.type==="video"?1:0,0,15,1,n>>>24&255,n>>>16&255,n>>>8&255,n&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255],0),c=0;c<n;c++)h=s[c],u=h.duration,f=h.size,p=h.flags,v=h.cts,l.set([u>>>24&255,u>>>16&255,u>>>8&255,u&255,f>>>24&255,f>>>16&255,f>>>8&255,f&255,p.isLeading<<2|p.dependsOn,p.isDependedOn<<6|p.hasRedundancy<<4|p.paddingValue<<1|p.isNonSync,p.degradPrio&61440,p.degradPrio&15,v>>>24&255,v>>>16&255,v>>>8&255,v&255],12+16*c);return q.box(q.types.trun,l)}static initSegment(e){q.types||q.init();const t=q.moov(e);return ki(q.FTYP,t)}static hvc1(e){const t=e.params,s=[e.vps,e.sps,e.pps],n=4,r=new Uint8Array([1,t.general_profile_space<<6|(t.general_tier_flag?32:0)|t.general_profile_idc,t.general_profile_compatibility_flags[0],t.general_profile_compatibility_flags[1],t.general_profile_compatibility_flags[2],t.general_profile_compatibility_flags[3],t.general_constraint_indicator_flags[0],t.general_constraint_indicator_flags[1],t.general_constraint_indicator_flags[2],t.general_constraint_indicator_flags[3],t.general_constraint_indicator_flags[4],t.general_constraint_indicator_flags[5],t.general_level_idc,240|t.min_spatial_segmentation_idc>>8,255&t.min_spatial_segmentation_idc,252|t.parallelismType,252|t.chroma_format_idc,248|t.bit_depth_luma_minus8,248|t.bit_depth_chroma_minus8,0,parseInt(t.frame_rate.fps),n-1|t.temporal_id_nested<<2|t.num_temporal_layers<<3|(t.frame_rate.fixed?64:0),s.length]);let l=r.length;for(let S=0;S<s.length;S+=1){l+=3;for(let E=0;E<s[S].length;E+=1)l+=2+s[S][E].length}const c=new Uint8Array(l);c.set(r,0),l=r.length;const h=s.length-1;for(let S=0;S<s.length;S+=1){c.set(new Uint8Array([32+S|(S===h?128:0),0,s[S].length]),l),l+=3;for(let E=0;E<s[S].length;E+=1)c.set(new Uint8Array([s[S][E].length>>8,s[S][E].length&255]),l),l+=2,c.set(s[S][E],l),l+=s[S][E].length}const u=q.box(q.types.hvcC,c),f=e.width,p=e.height,v=e.pixelRatio[0],x=e.pixelRatio[1];return q.box(q.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,f>>8&255,f&255,p>>8&255,p&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),u,q.box(q.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),q.box(q.types.pasp,new Uint8Array([v>>24,v>>16&255,v>>8&255,v&255,x>>24,x>>16&255,x>>8&255,x&255])))}}q.types=void 0;q.HDLR_TYPES=void 0;q.STTS=void 0;q.STSC=void 0;q.STCO=void 0;q.STSZ=void 0;q.VMHD=void 0;q.SMHD=void 0;q.STSD=void 0;q.FTYP=void 0;q.DINF=void 0;const bb=9e4;function Om(i,e,t=1,s=!1){const n=i*e*t;return s?Math.round(n):n}function OC(i,e,t=1,s=!1){return Om(i,e,1/t,s)}function Hl(i,e=!1){return Om(i,1e3,1/bb,e)}function NC(i,e=1){return Om(i,bb,1/e)}function Jy(i){const{baseTime:e,timescale:t,trackId:s}=i;return`${e/t} (${e}/${t}) trackId: ${s}`}const kC=10*1e3,DC=1024,PC=1152,UC=1536;let Dr=null,hf=null;function ex(i,e,t,s){return{duration:e,size:t,cts:s,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:i?2:1,isNonSync:i?0:1}}}class tu extends Pi{constructor(e,t,s,n){if(super("mp4-remuxer",n),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextVideoTs=null,this.nextAudioTs=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=t,this.typeSupported=s,this.ISGenerated=!1,Dr===null){const l=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Dr=l?parseInt(l[1]):0}if(hf===null){const r=navigator.userAgent.match(/Safari\/(\d+)/i);hf=r?parseInt(r[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){const t=this._initPTS;(!t||!e||e.trackId!==t.trackId||e.baseTime!==t.baseTime||e.timescale!==t.timescale)&&this.log(`Reset initPTS: ${t&&Jy(t)} > ${e&&Jy(e)}`),this._initPTS=this._initDTS=e}resetNextTimestamp(){this.log("reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){this.log("ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let t=!1;const s=e[0].pts,n=e.reduce((r,l)=>{let c=l.pts,h=c-r;return h<-4294967296&&(t=!0,c=fi(c,s),h=c-r),h>0?r:c},s);return t&&this.debug("PTS rollover detected"),n}remux(e,t,s,n,r,l,c,h){let u,f,p,v,x,S,E=r,T=r;const A=e.pid>-1,I=t.pid>-1,_=t.samples.length,C=e.samples.length>0,k=c&&_>0||_>1;if((!A||C)&&(!I||k)||this.ISGenerated||c){if(this.ISGenerated){var O,F,j,M;const ae=this.videoTrackConfig;(ae&&(t.width!==ae.width||t.height!==ae.height||((O=t.pixelRatio)==null?void 0:O[0])!==((F=ae.pixelRatio)==null?void 0:F[0])||((j=t.pixelRatio)==null?void 0:j[1])!==((M=ae.pixelRatio)==null?void 0:M[1]))||!ae&&k||this.nextAudioTs===null&&C)&&this.resetInitSegment()}this.ISGenerated||(p=this.generateIS(e,t,r,l));const H=this.isVideoContiguous;let K=-1,te;if(k&&(K=MC(t.samples),!H&&this.config.forceKeyFrameOnDiscontinuity))if(S=!0,K>0){this.warn(`Dropped ${K} out of ${_} video samples due to a missing keyframe`);const ae=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(K),t.dropped+=K,T+=(t.samples[0].pts-ae)/t.inputTimeScale,te=T}else K===-1&&(this.warn(`No keyframe found out of ${_} video samples`),S=!1);if(this.ISGenerated){if(C&&k){const ae=this.getVideoStartPts(t.samples),D=(fi(e.samples[0].pts,ae)-ae)/t.inputTimeScale;E+=Math.max(0,D),T+=Math.max(0,-D)}if(C){if(e.samplerate||(this.warn("regenerate InitSegment as audio detected"),p=this.generateIS(e,t,r,l)),f=this.remuxAudio(e,E,this.isAudioContiguous,l,I||k||h===ke.AUDIO?T:void 0),k){const ae=f?f.endPTS-f.startPTS:0;t.inputTimeScale||(this.warn("regenerate InitSegment as video detected"),p=this.generateIS(e,t,r,l)),u=this.remuxVideo(t,T,H,ae)}}else k&&(u=this.remuxVideo(t,T,H,0));u&&(u.firstKeyFrame=K,u.independent=K!==-1,u.firstKeyFramePTS=te)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(s.samples.length&&(x=Tb(s,r,this._initPTS,this._initDTS)),n.samples.length&&(v=Eb(n,r,this._initPTS))),{audio:f,video:u,initSegment:p,independent:S,text:v,id3:x}}computeInitPts(e,t,s,n){const r=Math.round(s*t);let l=fi(e,r);if(l<r+t)for(this.log(`Adjusting PTS for rollover in timeline near ${(r-l)/t} ${n}`);l<r+t;)l+=8589934592;return l-r}generateIS(e,t,s,n){const r=e.samples,l=t.samples,c=this.typeSupported,h={},u=this._initPTS;let f=!u||n,p="audio/mp4",v,x,S,E=-1;if(f&&(v=x=1/0),e.config&&r.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":c.mpeg?(p="audio/mpeg",e.codec=""):c.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3";break}h.audio={id:"audio",container:p,codec:e.codec,initSegment:e.segmentCodec==="mp3"&&c.mpeg?new Uint8Array(0):q.initSegment([e]),metadata:{channelCount:e.channelCount}},f&&(E=e.id,S=e.inputTimeScale,!u||S!==u.timescale?v=x=this.computeInitPts(r[0].pts,S,s,"audio"):f=!1)}if(t.sps&&t.pps&&l.length){if(t.timescale=t.inputTimeScale,h.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:q.initSegment([t]),metadata:{width:t.width,height:t.height}},f)if(E=t.id,S=t.inputTimeScale,!u||S!==u.timescale){const T=this.getVideoStartPts(l),A=fi(l[0].dts,T),I=this.computeInitPts(A,S,s,"video"),_=this.computeInitPts(T,S,s,"video");x=Math.min(x,I),v=Math.min(v,_)}else f=!1;this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(h).length)return this.ISGenerated=!0,f?(u&&this.warn(`Timestamps at playlist time: ${n?"":"~"}${s} ${v/S} != initPTS: ${u.baseTime/u.timescale} (${u.baseTime}/${u.timescale}) trackId: ${u.trackId}`),this.log(`Found initPTS at playlist time: ${s} offset: ${v/S} (${v}/${S}) trackId: ${E}`),this._initPTS={baseTime:v,timescale:S,trackId:E},this._initDTS={baseTime:x,timescale:S,trackId:E}):v=S=void 0,{tracks:h,initPTS:v,timescale:S,trackId:E}}remuxVideo(e,t,s,n){const r=e.inputTimeScale,l=e.samples,c=[],h=l.length,u=this._initPTS,f=u.baseTime*r/u.timescale;let p=this.nextVideoTs,v=8,x=this.videoSampleDuration,S,E,T=Number.POSITIVE_INFINITY,A=Number.NEGATIVE_INFINITY,I=!1;if(!s||p===null){const P=f+t*r,V=l[0].pts-fi(l[0].dts,l[0].pts);Dr&&p!==null&&Math.abs(P-V-(p+f))<15e3?s=!0:p=P-V-f}const _=p+f;for(let P=0;P<h;P++){const V=l[P];V.pts=fi(V.pts,_),V.dts=fi(V.dts,_),V.dts<l[P>0?P-1:P].dts&&(I=!0)}I&&l.sort(function(P,V){const se=P.dts-V.dts,he=P.pts-V.pts;return se||he}),S=l[0].dts,E=l[l.length-1].dts;const C=E-S,k=C?Math.round(C/(h-1)):x||e.inputTimeScale/30;if(s){const P=S-_,V=P>k,se=P<-1;if((V||se)&&(V?this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${Hl(P,!0)} ms (${P}dts) hole between fragments detected at ${t.toFixed(3)}`):this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${Hl(-P,!0)} ms (${P}dts) overlapping between fragments detected at ${t.toFixed(3)}`),!se||_>=l[0].pts||Dr)){S=_;const he=l[0].pts-P;if(V)l[0].dts=S,l[0].pts=he;else{let ye=!0;for(let Ae=0;Ae<l.length&&!(l[Ae].dts>he&&ye);Ae++){const Pe=l[Ae].pts;if(l[Ae].dts-=P,l[Ae].pts-=P,Ae<l.length-1){const He=l[Ae+1].pts,Be=l[Ae].pts,ht=He<=Be,dt=He<=Pe;ye=ht==dt}}}this.log(`Video: Initial PTS/DTS adjusted: ${Hl(he,!0)}/${Hl(S,!0)}, delta: ${Hl(P,!0)} ms`)}}S=Math.max(0,S);let U=0,O=0,F=S;for(let P=0;P<h;P++){const V=l[P],se=V.units,he=se.length;let ye=0;for(let Ae=0;Ae<he;Ae++)ye+=se[Ae].data.length;O+=ye,U+=he,V.length=ye,V.dts<F?(V.dts=F,F+=k/4|0||1):F=V.dts,T=Math.min(V.pts,T),A=Math.max(V.pts,A)}E=l[h-1].dts;const j=O+4*U+8;let M;try{M=new Uint8Array(j)}catch(P){this.observer.emit(L.ERROR,L.ERROR,{type:Fe.MUX_ERROR,details:Q.REMUX_ALLOC_ERROR,fatal:!1,error:P,bytes:j,reason:`fail allocating video mdat ${j}`});return}const H=new DataView(M.buffer);H.setUint32(0,j),M.set(q.types.mdat,4);let K=!1,te=Number.POSITIVE_INFINITY,ae=Number.POSITIVE_INFINITY,me=Number.NEGATIVE_INFINITY,D=Number.NEGATIVE_INFINITY;for(let P=0;P<h;P++){const V=l[P],se=V.units;let he=0;for(let Pe=0,He=se.length;Pe<He;Pe++){const Be=se[Pe],ht=Be.data,dt=Be.data.byteLength;H.setUint32(v,dt),v+=4,M.set(ht,v),v+=dt,he+=4+dt}let ye;if(P<h-1)x=l[P+1].dts-V.dts,ye=l[P+1].pts-V.pts;else{const Pe=this.config,He=P>0?V.dts-l[P-1].dts:k;if(ye=P>0?V.pts-l[P-1].pts:k,Pe.stretchShortVideoTrack&&this.nextAudioTs!==null){const Be=Math.floor(Pe.maxBufferHole*r),ht=(n?T+n*r:this.nextAudioTs+f)-V.pts;ht>Be?(x=ht-He,x<0?x=He:K=!0,this.log(`It is approximately ${ht/90} ms to the next segment; using duration ${x/90} ms for the last video frame.`)):x=He}else x=He}const Ae=Math.round(V.pts-V.dts);te=Math.min(te,x),me=Math.max(me,x),ae=Math.min(ae,ye),D=Math.max(D,ye),c.push(ex(V.key,x,he,Ae))}if(c.length){if(Dr){if(Dr<70){const P=c[0].flags;P.dependsOn=2,P.isNonSync=0}}else if(hf&&D-ae<me-te&&k/me<.025&&c[0].cts===0){this.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let P=S;for(let V=0,se=c.length;V<se;V++){const he=P+c[V].duration,ye=P+c[V].cts;if(V<se-1){const Ae=he+c[V+1].cts;c[V].duration=Ae-ye}else c[V].duration=V?c[V-1].duration:k;c[V].cts=0,P=he}}}x=K||!x?k:x;const G=E+x;this.nextVideoTs=p=G-f,this.videoSampleDuration=x,this.isVideoContiguous=!0;const pe={data1:q.moof(e.sequenceNumber++,S,Lt(e,{samples:c})),data2:M,startPTS:(T-f)/r,endPTS:(A+x-f)/r,startDTS:(S-f)/r,endDTS:p/r,type:"video",hasAudio:!1,hasVideo:!0,nb:c.length,dropped:e.dropped};return e.samples=[],e.dropped=0,pe}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return PC;case"ac3":return UC;default:return DC}}remuxAudio(e,t,s,n,r){const l=e.inputTimeScale,c=e.samplerate?e.samplerate:l,h=l/c,u=this.getSamplesPerFrame(e),f=u*h,p=this._initPTS,v=e.segmentCodec==="mp3"&&this.typeSupported.mpeg,x=[],S=r!==void 0;let E=e.samples,T=v?0:8,A=this.nextAudioTs||-1;const I=p.baseTime*l/p.timescale,_=I+t*l;if(this.isAudioContiguous=s=s||E.length&&A>0&&(n&&Math.abs(_-(A+I))<9e3||Math.abs(fi(E[0].pts,_)-(A+I))<20*f),E.forEach(function(D){D.pts=fi(D.pts,_)}),!s||A<0){const D=E.length;if(E=E.filter(G=>G.pts>=0),D!==E.length&&this.warn(`Removed ${E.length-D} of ${D} samples (initPTS ${I} / ${l})`),!E.length)return;r===0?A=0:n&&!S?A=Math.max(0,_-I):A=E[0].pts-I}if(e.segmentCodec==="aac"){const D=this.config.maxAudioFramesDrift;for(let G=0,Y=A+I;G<E.length;G++){const oe=E[G],pe=oe.pts,P=pe-Y,V=Math.abs(1e3*P/l);if(P<=-D*f&&S)G===0&&(this.warn(`Audio frame @ ${(pe/l).toFixed(3)}s overlaps marker by ${Math.round(1e3*P/l)} ms.`),this.nextAudioTs=A=pe-I,Y=pe);else if(P>=D*f&&V<kC&&S){let se=Math.round(P/f);for(Y=pe-se*f;Y<0&&se&&f;)se--,Y+=f;G===0&&(this.nextAudioTs=A=Y-I),this.warn(`Injecting ${se} audio frames @ ${((Y-I)/l).toFixed(3)}s due to ${Math.round(1e3*P/l)} ms gap.`);for(let he=0;he<se;he++){let ye=CC.getSilentFrame(e.parsedCodec||e.manifestCodec||e.codec,e.channelCount);ye||(this.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),ye=oe.unit.subarray()),E.splice(G,0,{unit:ye,pts:Y}),Y+=f,G++}}oe.pts=Y,Y+=f}}let C=null,k=null,U,O=0,F=E.length;for(;F--;)O+=E[F].unit.byteLength;for(let D=0,G=E.length;D<G;D++){const Y=E[D],oe=Y.unit;let pe=Y.pts;if(k!==null){const V=x[D-1];V.duration=Math.round((pe-k)/h)}else if(s&&e.segmentCodec==="aac"&&(pe=A+I),C=pe,O>0){O+=T;try{U=new Uint8Array(O)}catch(V){this.observer.emit(L.ERROR,L.ERROR,{type:Fe.MUX_ERROR,details:Q.REMUX_ALLOC_ERROR,fatal:!1,error:V,bytes:O,reason:`fail allocating audio mdat ${O}`});return}v||(new DataView(U.buffer).setUint32(0,O),U.set(q.types.mdat,4))}else return;U.set(oe,T);const P=oe.byteLength;T+=P,x.push(ex(!0,u,P,0)),k=pe}const j=x.length;if(!j)return;const M=x[x.length-1];A=k-I,this.nextAudioTs=A+h*M.duration;const H=v?new Uint8Array(0):q.moof(e.sequenceNumber++,C/h,Lt({},e,{samples:x}));e.samples=[];const K=(C-I)/l,te=this.nextAudioTs/l,me={data1:H,data2:U,startPTS:K,endPTS:te,startDTS:K,endDTS:te,type:"audio",hasAudio:!0,hasVideo:!1,nb:j};return this.isAudioContiguous=!0,me}}function fi(i,e){let t;if(e===null)return i;for(e<i?t=-8589934592:t=8589934592;Math.abs(i-e)>4294967296;)i+=t;return i}function MC(i){for(let e=0;e<i.length;e++)if(i[e].key)return e;return-1}function Tb(i,e,t,s){const n=i.samples.length;if(!n)return;const r=i.inputTimeScale;for(let c=0;c<n;c++){const h=i.samples[c];h.pts=fi(h.pts-t.baseTime*r/t.timescale,e*r)/r,h.dts=fi(h.dts-s.baseTime*r/s.timescale,e*r)/r}const l=i.samples;return i.samples=[],{samples:l}}function Eb(i,e,t){const s=i.samples.length;if(!s)return;const n=i.inputTimeScale;for(let l=0;l<s;l++){const c=i.samples[l];c.pts=fi(c.pts-t.baseTime*n/t.timescale,e*n)/n}i.samples.sort((l,c)=>l.pts-c.pts);const r=i.samples;return i.samples=[],{samples:r}}class jC extends Pi{constructor(e,t,s,n){super("passthrough-remuxer",n),this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null,this.isVideoContiguous=!1}destroy(){}resetTimeStamp(e){this.lastEndTime=null;const t=this.initPTS;t&&e&&t.baseTime===e.baseTime&&t.timescale===e.timescale||(this.initPTS=e)}resetNextTimestamp(){this.isVideoContiguous=!1,this.lastEndTime=null}resetInitSegment(e,t,s,n){this.audioCodec=t,this.videoCodec=s,this.generateInitSegment(e,n),this.emitInitSegment=!0}generateInitSegment(e,t){let{audioCodec:s,videoCodec:n}=this;if(!(e!=null&&e.byteLength)){this.initTracks=void 0,this.initData=void 0;return}const{audio:r,video:l}=this.initData=wS(e);if(t)I1(e,t);else{const h=r||l;h!=null&&h.encrypted&&this.warn(`Init segment with encrypted track with has no key ("${h.codec}")!`)}r&&(s=tx(r,Ct.AUDIO,this)),l&&(n=tx(l,Ct.VIDEO,this));const c={};r&&l?c.audiovideo={container:"video/mp4",codec:s+","+n,supplemental:l.supplemental,encrypted:l.encrypted,initSegment:e,id:"main"}:r?c.audio={container:"audio/mp4",codec:s,encrypted:r.encrypted,initSegment:e,id:"audio"}:l?c.video={container:"video/mp4",codec:n,supplemental:l.supplemental,encrypted:l.encrypted,initSegment:e,id:"main"}:this.warn("initSegment does not contain moov or trak boxes."),this.initTracks=c}remux(e,t,s,n,r,l){var c,h;let{initPTS:u,lastEndTime:f}=this;const p={audio:void 0,video:void 0,text:n,id3:s,initSegment:void 0};Oe(f)||(f=this.lastEndTime=r||0);const v=t.samples;if(!v.length)return p;const x={initPTS:void 0,timescale:void 0,trackId:void 0};let S=this.initData;if((c=S)!=null&&c.length||(this.generateInitSegment(v),S=this.initData),!((h=S)!=null&&h.length))return this.warn("Failed to generate initSegment."),p;this.emitInitSegment&&(x.tracks=this.initTracks,this.emitInitSegment=!1);const E=R1(v,S,this),T=S.audio?E[S.audio.id]:null,A=S.video?E[S.video.id]:null,I=jc(A,1/0),_=jc(T,1/0),C=jc(A,0,!0),k=jc(T,0,!0);let U=r,O=0;const F=T&&(!A||!u&&_<I||u&&u.trackId===S.audio.id),j=F?T:A;if(j){const Y=j.timescale,oe=j.start-r*Y,pe=F?S.audio.id:S.video.id;U=j.start/Y,O=F?k-_:C-I,(l||!u)&&(FC(u,U,r,O)||Y!==u.timescale)&&(u&&this.warn(`Timestamps at playlist time: ${l?"":"~"}${r} ${oe/Y} != initPTS: ${u.baseTime/u.timescale} (${u.baseTime}/${u.timescale}) trackId: ${u.trackId}`),this.log(`Found initPTS at playlist time: ${r} offset: ${U-r} (${oe}/${Y}) trackId: ${pe}`),u=null,x.initPTS=oe,x.timescale=Y,x.trackId=pe)}else this.warn(`No audio or video samples found for initPTS at playlist time: ${r}`);u?(x.initPTS=u.baseTime,x.timescale=u.timescale,x.trackId=u.trackId):((!x.timescale||x.trackId===void 0||x.initPTS===void 0)&&(this.warn("Could not set initPTS"),x.initPTS=U,x.timescale=1,x.trackId=-1),this.initPTS=u={baseTime:x.initPTS,timescale:x.timescale,trackId:x.trackId});const M=U-u.baseTime/u.timescale,H=M+O;O>0?this.lastEndTime=H:(this.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const K=!!S.audio,te=!!S.video;let ae="";K&&(ae+="audio"),te&&(ae+="video");const me=(S.audio?S.audio.encrypted:!1)||(S.video?S.video.encrypted:!1),D={data1:v,startPTS:M,startDTS:M,endPTS:H,endDTS:H,type:ae,hasAudio:K,hasVideo:te,nb:1,dropped:0,encrypted:me};p.audio=K&&!te?D:void 0,p.video=te?D:void 0;const G=A?.sampleCount;if(G){const Y=A.keyFrameIndex,oe=Y!==-1;D.nb=G,D.dropped=Y===0||this.isVideoContiguous?0:oe?Y:G,D.independent=oe,D.firstKeyFrame=Y,oe&&A.keyFrameStart&&(D.firstKeyFramePTS=(A.keyFrameStart-u.baseTime)/u.timescale),this.isVideoContiguous||(p.independent=oe),this.isVideoContiguous||(this.isVideoContiguous=oe),D.dropped&&this.warn(`fmp4 does not start with IDR: firstIDR ${Y}/${G} dropped: ${D.dropped} start: ${D.firstKeyFramePTS||"NA"}`)}return p.initSegment=x,p.id3=Tb(s,r,u,u),n.samples.length&&(p.text=Eb(n,r,u)),p}}function jc(i,e,t=!1){return i?.start!==void 0?(i.start+(t?i.duration:0))/i.timescale:e}function FC(i,e,t,s){if(i===null)return!0;const n=Math.max(s,1),r=e-i.baseTime/i.timescale;return Math.abs(r-t)>n}function tx(i,e,t){const s=i.codec;return s&&s.length>4?s:e===Ct.AUDIO?s==="ec-3"||s==="ac-3"||s==="alac"?s:s==="fLaC"||s==="Opus"?hu(s,!1):(t.warn(`Unhandled audio codec "${s}" in mp4 MAP`),s||"mp4a"):(t.warn(`Unhandled video codec "${s}" in mp4 MAP`),s||"avc1")}let kn;try{kn=self.performance.now.bind(self.performance)}catch{kn=Date.now}const su=[{demux:AC,remux:jC},{demux:pa,remux:tu},{demux:SC,remux:tu},{demux:TC,remux:tu}];su.splice(2,0,{demux:bC,remux:tu});class sx{constructor(e,t,s,n,r,l){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=s,this.id=r,this.logger=l}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,s,n){const r=s.transmuxing;r.executeStart=kn();let l=new Uint8Array(e);const{currentTransmuxState:c,transmuxConfig:h}=this;n&&(this.currentTransmuxState=n);const{contiguous:u,discontinuity:f,trackSwitch:p,accurateTimeOffset:v,timeOffset:x,initSegmentChange:S}=n||c,{audioCodec:E,videoCodec:T,defaultInitPts:A,duration:I,initSegmentData:_}=h,C=BC(l,t);if(C&&jr(C.method)){const F=this.getDecrypter(),j=Tm(C.method);if(F.isSync()){let M=F.softwareDecrypt(l,C.key.buffer,C.iv.buffer,j);if(s.part>-1){const K=F.flush();M=K&&K.buffer}if(!M)return r.executeEnd=kn(),ff(s);l=new Uint8Array(M)}else return this.asyncResult=!0,this.decryptionPromise=F.webCryptoDecrypt(l,C.key.buffer,C.iv.buffer,j).then(M=>{const H=this.push(M,null,s);return this.decryptionPromise=null,H}),this.decryptionPromise}const k=this.needsProbing(f,p);if(k){const F=this.configureTransmuxer(l);if(F)return this.logger.warn(`[transmuxer] ${F.message}`),this.observer.emit(L.ERROR,L.ERROR,{type:Fe.MEDIA_ERROR,details:Q.FRAG_PARSING_ERROR,fatal:!1,error:F,reason:F.message}),r.executeEnd=kn(),ff(s)}(f||p||S||k)&&this.resetInitSegment(_,E,T,I,t),(f||S||k)&&this.resetInitialTimestamp(A),u||this.resetContiguity();const U=this.transmux(l,C,x,v,s);this.asyncResult=to(U);const O=this.currentTransmuxState;return O.contiguous=!0,O.discontinuity=!1,O.trackSwitch=!1,r.executeEnd=kn(),U}flush(e){const t=e.transmuxing;t.executeStart=kn();const{decrypter:s,currentTransmuxState:n,decryptionPromise:r}=this;if(r)return this.asyncResult=!0,r.then(()=>this.flush(e));const l=[],{timeOffset:c}=n;if(s){const p=s.flush();p&&l.push(this.push(p.buffer,null,e))}const{demuxer:h,remuxer:u}=this;if(!h||!u){t.executeEnd=kn();const p=[ff(e)];return this.asyncResult?Promise.resolve(p):p}const f=h.flush(c);return to(f)?(this.asyncResult=!0,f.then(p=>(this.flushRemux(l,p,e),l))):(this.flushRemux(l,f,e),this.asyncResult?Promise.resolve(l):l)}flushRemux(e,t,s){const{audioTrack:n,videoTrack:r,id3Track:l,textTrack:c}=t,{accurateTimeOffset:h,timeOffset:u}=this.currentTransmuxState;this.logger.log(`[transmuxer.ts]: Flushed ${this.id} sn: ${s.sn}${s.part>-1?" part: "+s.part:""} of ${this.id===ke.MAIN?"level":"track"} ${s.level}`);const f=this.remuxer.remux(n,r,l,c,u,h,!0,this.id);e.push({remuxResult:f,chunkMeta:s}),s.transmuxing.executeEnd=kn()}resetInitialTimestamp(e){const{demuxer:t,remuxer:s}=this;!t||!s||(t.resetTimeStamp(e),s.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:t}=this;!e||!t||(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,s,n,r){const{demuxer:l,remuxer:c}=this;!l||!c||(l.resetInitSegment(e,t,s,n),c.resetInitSegment(e,t,s,r))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,s,n,r){let l;return t&&t.method==="SAMPLE-AES"?l=this.transmuxSampleAes(e,t,s,n,r):l=this.transmuxUnencrypted(e,s,n,r),l}transmuxUnencrypted(e,t,s,n){const{audioTrack:r,videoTrack:l,id3Track:c,textTrack:h}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(r,l,c,h,t,s,!1,this.id),chunkMeta:n}}transmuxSampleAes(e,t,s,n,r){return this.demuxer.demuxSampleAes(e,t,s).then(l=>({remuxResult:this.remuxer.remux(l.audioTrack,l.videoTrack,l.id3Track,l.textTrack,s,n,!1,this.id),chunkMeta:r}))}configureTransmuxer(e){const{config:t,observer:s,typeSupported:n}=this;let r;for(let p=0,v=su.length;p<v;p++){var l;if((l=su[p].demux)!=null&&l.probe(e,this.logger)){r=su[p];break}}if(!r)return new Error("Failed to find demuxer by probing fragment data");const c=this.demuxer,h=this.remuxer,u=r.remux,f=r.demux;(!h||!(h instanceof u))&&(this.remuxer=new u(s,t,n,this.logger)),(!c||!(c instanceof f))&&(this.demuxer=new f(s,t,n,this.logger),this.probe=f.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new Sm(this.config)),e}}function BC(i,e){let t=null;return i.byteLength>0&&e?.key!=null&&e.iv!==null&&e.method!=null&&(t=e),t}const ff=i=>({remuxResult:{},chunkMeta:i});function to(i){return"then"in i&&i.then instanceof Function}class VC{constructor(e,t,s,n,r){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=s,this.duration=n,this.defaultInitPts=r||null}}class $C{constructor(e,t,s,n,r,l){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=s,this.trackSwitch=n,this.timeOffset=r,this.initSegmentChange=l}}let ix=0;class Ab{constructor(e,t,s,n){this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=ix++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=h=>{const u=h.data,f=this.hls;if(!(!f||!(u!=null&&u.event)||u.instanceNo!==this.instanceNo))switch(u.event){case"init":{var p;const v=(p=this.workerContext)==null?void 0:p.objectURL;v&&self.URL.revokeObjectURL(v);break}case"transmuxComplete":{this.handleTransmuxComplete(u.data);break}case"flush":{this.onFlush(u.data);break}case"workerLog":{f.logger[u.data.logType]&&f.logger[u.data.logType](u.data.message);break}default:{u.data=u.data||{},u.data.frag=this.frag,u.data.part=this.part,u.data.id=this.id,f.trigger(u.event,u.data);break}}},this.onWorkerError=h=>{if(!this.hls)return;const u=new Error(`${h.message}  (${h.filename}:${h.lineno})`);this.hls.config.enableWorker=!1,this.hls.logger.warn(`Error in "${this.id}" Web Worker, fallback to inline`),this.hls.trigger(L.ERROR,{type:Fe.OTHER_ERROR,details:Q.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:u})};const r=e.config;this.hls=e,this.id=t,this.useWorker=!!r.enableWorker,this.onTransmuxComplete=s,this.onFlush=n;const l=(h,u)=>{u=u||{},u.frag=this.frag||void 0,h===L.ERROR&&(u=u,u.parent=this.id,u.part=this.part,this.error=u.error),this.hls.trigger(h,u)};this.observer=new Im,this.observer.on(L.FRAG_DECRYPTED,l),this.observer.on(L.ERROR,l);const c=yy(r.preferManagedMediaSource);if(this.useWorker&&typeof Worker<"u"){const h=this.hls.logger;if(r.workerPath||Kw()){try{r.workerPath?(h.log(`loading Web Worker ${r.workerPath} for "${t}"`),this.workerContext=qw(r.workerPath)):(h.log(`injecting Web Worker for "${t}"`),this.workerContext=Yw());const{worker:f}=this.workerContext;f.addEventListener("message",this.onWorkerMessage),f.addEventListener("error",this.onWorkerError),f.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:c,id:t,config:Ot(r)})}catch(f){h.warn(`Error setting up "${t}" Web Worker, fallback to inline`,f),this.terminateWorker(),this.error=null,this.transmuxer=new sx(this.observer,c,r,"",t,e.logger)}return}}this.transmuxer=new sx(this.observer,c,r,"",t,e.logger)}reset(){if(this.frag=null,this.part=null,this.workerContext){const e=this.instanceNo;this.instanceNo=ix++;const t=this.hls.config,s=yy(t.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:e,typeSupported:s,id:this.id,config:Ot(t)})}}terminateWorker(){if(this.workerContext){const{worker:e}=this.workerContext;this.workerContext=null,e.removeEventListener("message",this.onWorkerMessage),e.removeEventListener("error",this.onWorkerError),Qw(this.hls.config.workerPath)}}destroy(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{const t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null}push(e,t,s,n,r,l,c,h,u,f){var p,v;u.transmuxing.start=self.performance.now();const{instanceNo:x,transmuxer:S}=this,E=l?l.start:r.start,T=r.decryptdata,A=this.frag,I=!(A&&r.cc===A.cc),_=!(A&&u.level===A.level),C=A?u.sn-A.sn:-1,k=this.part?u.part-this.part.index:-1,U=C===0&&u.id>1&&u.id===A?.stats.chunkCount,O=!_&&(C===1||C===0&&(k===1||U&&k<=0)),F=self.performance.now();(_||C||r.stats.parsing.start===0)&&(r.stats.parsing.start=F),l&&(k||!O)&&(l.stats.parsing.start=F);const j=!(A&&((p=r.initSegment)==null?void 0:p.url)===((v=A.initSegment)==null?void 0:v.url)),M=new $C(I,O,h,_,E,j);if(!O||I||j){this.hls.logger.log(`[transmuxer-interface]: Starting new transmux session for ${r.type} sn: ${u.sn}${u.part>-1?" part: "+u.part:""} ${this.id===ke.MAIN?"level":"track"}: ${u.level} id: ${u.id}
        discontinuity: ${I}
        trackSwitch: ${_}
        contiguous: ${O}
        accurateTimeOffset: ${h}
        timeOffset: ${E}
        initSegmentChange: ${j}`);const H=new VC(s,n,t,c,f);this.configureTransmuxer(H)}if(this.frag=r,this.part=l,this.workerContext)this.workerContext.worker.postMessage({instanceNo:x,cmd:"demux",data:e,decryptdata:T,chunkMeta:u,state:M},e instanceof ArrayBuffer?[e]:[]);else if(S){const H=S.push(e,T,u,M);to(H)?H.then(K=>{this.handleTransmuxComplete(K)}).catch(K=>{this.transmuxerError(K,u,"transmuxer-interface push error")}):this.handleTransmuxComplete(H)}}flush(e){e.transmuxing.start=self.performance.now();const{instanceNo:t,transmuxer:s}=this;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:t,cmd:"flush",chunkMeta:e});else if(s){const n=s.flush(e);to(n)?n.then(r=>{this.handleFlushResult(r,e)}).catch(r=>{this.transmuxerError(r,e,"transmuxer-interface flush error")}):this.handleFlushResult(n,e)}}transmuxerError(e,t,s){this.hls&&(this.error=e,this.hls.trigger(L.ERROR,{type:Fe.MEDIA_ERROR,details:Q.FRAG_PARSING_ERROR,chunkMeta:t,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:e,err:e,reason:s}))}handleFlushResult(e,t){e.forEach(s=>{this.handleTransmuxComplete(s)}),this.onFlush(t)}configureTransmuxer(e){const{instanceNo:t,transmuxer:s}=this;this.workerContext?this.workerContext.worker.postMessage({instanceNo:t,cmd:"configure",config:e}):s&&s.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}const nx=100;class GC extends Am{constructor(e,t,s){super(e,t,s,"audio-stream-controller",ke.AUDIO),this.mainAnchor=null,this.mainFragLoading=null,this.audioOnly=!1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.resetItem()}resetItem(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(L.LEVEL_LOADED,this.onLevelLoaded,this),e.on(L.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(L.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(L.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(L.BUFFER_RESET,this.onBufferReset,this),e.on(L.BUFFER_CREATED,this.onBufferCreated,this),e.on(L.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(L.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(L.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(L.FRAG_LOADING,this.onFragLoading,this),e.on(L.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){const{hls:e}=this;e&&(super.unregisterListeners(),e.off(L.LEVEL_LOADED,this.onLevelLoaded,this),e.off(L.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(L.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(L.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(L.BUFFER_RESET,this.onBufferReset,this),e.off(L.BUFFER_CREATED,this.onBufferCreated,this),e.off(L.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(L.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(L.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(L.FRAG_LOADING,this.onFragLoading,this),e.off(L.FRAG_BUFFERED,this.onFragBuffered,this))}onInitPtsFound(e,{frag:t,id:s,initPTS:n,timescale:r,trackId:l}){if(s===ke.MAIN){const c=t.cc,h=this.fragCurrent;if(this.initPTS[c]={baseTime:n,timescale:r,trackId:l},this.log(`InitPTS for cc: ${c} found from main: ${n/r} (${n}/${r}) trackId: ${l}`),this.mainAnchor=t,this.state===ce.WAITING_INIT_PTS){const u=this.waitingData;(!u&&!this.loadingParts||u&&u.frag.cc!==c)&&this.syncWithAnchor(t,u?.frag)}else!this.hls.hasEnoughToStart&&h&&h.cc!==c?(h.abortRequests(),this.syncWithAnchor(t,h)):this.state===ce.IDLE&&this.tick()}}getLoadPosition(){return!this.startFragRequested&&this.nextLoadPosition>=0?this.nextLoadPosition:super.getLoadPosition()}syncWithAnchor(e,t){var s;const n=((s=this.mainFragLoading)==null?void 0:s.frag)||null;if(t&&n?.cc===t.cc)return;const r=(n||e).cc,l=this.getLevelDetails(),c=this.getLoadPosition(),h=BS(l,r,c);h&&(this.log(`Syncing with main frag at ${h.start} cc ${h.cc}`),this.startFragRequested=!1,this.nextLoadPosition=h.start,this.resetLoadingState(),this.state===ce.IDLE&&this.doTickIdle())}startLoad(e,t){if(!this.levels){this.startPosition=e,this.state=ce.STOPPED;return}const s=this.lastCurrentTime;this.stopLoad(),this.setInterval(nx),s>0&&e===-1?(this.log(`Override startPosition with lastCurrentTime @${s.toFixed(3)}`),e=s,this.state=ce.IDLE):this.state=ce.WAITING_TRACK,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}doTick(){switch(this.state){case ce.IDLE:this.doTickIdle();break;case ce.WAITING_TRACK:{const{levels:e,trackId:t}=this,s=e?.[t],n=s?.details;if(n&&!this.waitForLive(s)){if(this.waitForCdnTuneIn(n))break;this.state=ce.WAITING_INIT_PTS}break}case ce.FRAG_LOADING_WAITING_RETRY:{this.checkRetryDate();break}case ce.WAITING_INIT_PTS:{const e=this.waitingData;if(e){const{frag:t,part:s,cache:n,complete:r}=e,l=this.mainAnchor;if(this.initPTS[t.cc]!==void 0){this.waitingData=null,this.state=ce.FRAG_LOADING;const c=n.flush().buffer,h={frag:t,part:s,payload:c,networkDetails:null};this._handleFragmentLoadProgress(h),r&&super._handleFragmentLoadComplete(h)}else l&&l.cc!==e.frag.cc&&this.syncWithAnchor(l,e.frag)}else this.state=ce.IDLE}}this.onTickEnd()}resetLoadingState(){const e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null),super.resetLoadingState()}onTickEnd(){const{media:e}=this;e!=null&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){var e;const{hls:t,levels:s,media:n,trackId:r}=this,l=t.config;if(!this.buffering||!n&&!this.primaryPrefetch&&(this.startFragRequested||!l.startFragPrefetch)||!(s!=null&&s[r]))return;const c=s[r],h=c.details;if(!h||this.waitForLive(c)||this.waitForCdnTuneIn(h)){this.state=ce.WAITING_TRACK,this.startFragRequested=!1;return}const u=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&u&&(this.bufferFlushed=!1,this.afterBufferFlushed(u,Ct.AUDIO,ke.AUDIO));const f=this.getFwdBufferInfo(u,ke.AUDIO);if(f===null)return;if(!this.switchingTrack&&this._streamEnded(f,h)){t.trigger(L.BUFFER_EOS,{type:"audio"}),this.state=ce.ENDED;return}const p=f.len,v=t.maxBufferLength,x=h.fragments,S=x[0].start,E=this.getLoadPosition(),T=this.flushing?E:f.end;if(this.switchingTrack&&n){const _=E;h.PTSKnown&&_<S&&(f.end>S||f.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),n.currentTime=S+.05)}if(p>=v&&!this.switchingTrack&&T<x[x.length-1].start)return;let A=this.getNextFragment(T,h);if(A&&this.isLoopLoading(A,T)&&(A=this.getNextFragmentLoopLoading(A,h,f,ke.MAIN,v)),!A){this.bufferFlushed=!0;return}let I=((e=this.mainFragLoading)==null?void 0:e.frag)||null;if(!this.audioOnly&&this.startFragRequested&&I&&es(A)&&!A.endList&&(!h.live||!this.loadingParts&&T<this.hls.liveSyncPosition)&&(this.fragmentTracker.getState(I)===hs.OK&&(this.mainFragLoading=I=null),I&&es(I))){if(A.start>I.end){const C=this.fragmentTracker.getFragAtPos(T,ke.MAIN);C&&C.end>I.end&&(I=C,this.mainFragLoading={frag:C,targetBufferTime:null})}if(A.start>I.end)return}this.loadFragment(A,c,T)}onMediaDetaching(e,t){this.bufferFlushed=this.flushing=!1,super.onMediaDetaching(e,t)}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map(s=>new Zl(s))}onAudioTrackSwitching(e,t){const s=!!t.url;this.trackId=t.id;const{fragCurrent:n}=this;n&&(n.abortRequests(),this.removeUnbufferedFrags(n.start)),this.resetLoadingState(),s?(this.switchingTrack=t,this.flushAudioIfNeeded(t),this.state!==ce.STOPPED&&(this.setInterval(nx),this.state=ce.IDLE,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=t,this.clearInterval())}onManifestLoading(){super.onManifestLoading(),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1}onLevelLoaded(e,t){this.mainDetails=t.details;const s=this.cachedTrackLoadedData;s&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded(L.AUDIO_TRACK_LOADED,s))}onAudioTrackLoaded(e,t){var s;const{levels:n}=this,{details:r,id:l,groupId:c,track:h}=t;if(!n){this.warn(`Audio tracks reset while loading track ${l} "${h.name}" of "${c}"`);return}const u=this.mainDetails;if(!u||r.endCC>u.endCC||u.expired){this.cachedTrackLoadedData=t,this.state!==ce.STOPPED&&(this.state=ce.WAITING_TRACK);return}this.cachedTrackLoadedData=null,this.log(`Audio track ${l} "${h.name}" of "${c}" loaded [${r.startSN},${r.endSN}]${r.lastPartSn?`[part-${r.lastPartSn}-${r.lastPartIndex}]`:""},duration:${r.totalduration}`);const f=n[l];let p=0;if(r.live||(s=f.details)!=null&&s.live){if(this.checkLiveUpdate(r),r.deltaUpdateFailed)return;if(f.details){var v;p=this.alignPlaylists(r,f.details,(v=this.levelLastLoaded)==null?void 0:v.details)}r.alignedSliding||(nb(r,u),r.alignedSliding||xu(r,u),p=r.fragmentStart)}f.details=r,this.levelLastLoaded=f,this.startFragRequested||this.setStartPosition(u,p),this.hls.trigger(L.AUDIO_TRACK_UPDATED,{details:r,id:l,groupId:t.groupId}),this.state===ce.WAITING_TRACK&&!this.waitForCdnTuneIn(r)&&(this.state=ce.IDLE),this.tick()}_handleFragmentLoadProgress(e){var t;const s=e.frag,{part:n,payload:r}=e,{config:l,trackId:c,levels:h}=this;if(!h){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${s.sn} of level ${s.level} will not be buffered`);return}const u=h[c];if(!u){this.warn("Audio track is undefined on fragment load progress");return}const f=u.details;if(!f){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(s.start);return}const p=l.defaultAudioCodec||u.audioCodec||"mp4a.40.2";let v=this.transmuxer;v||(v=this.transmuxer=new Ab(this.hls,ke.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const x=this.initPTS[s.cc],S=(t=s.initSegment)==null?void 0:t.data;if(x!==void 0){const T=n?n.index:-1,A=T!==-1,I=new bm(s.level,s.sn,s.stats.chunkCount,r.byteLength,T,A);v.push(r,S,p,"",s,n,f.totalduration,!1,I,x)}else{this.log(`Unknown video PTS for cc ${s.cc}, waiting for video PTS before demuxing audio frag ${s.sn} of [${f.startSN} ,${f.endSN}],track ${c}`);const{cache:E}=this.waitingData=this.waitingData||{frag:s,part:n,cache:new ab,complete:!1};E.push(new Uint8Array(r)),this.state!==ce.STOPPED&&(this.state=ce.WAITING_INIT_PTS)}}_handleFragmentLoadComplete(e){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=null}onBufferCreated(e,t){this.bufferFlushed=this.flushing=!1;const s=t.tracks.audio;s&&(this.mediaBuffer=s.buffer||null)}onFragLoading(e,t){!this.audioOnly&&t.frag.type===ke.MAIN&&es(t.frag)&&(this.mainFragLoading=t,this.state===ce.IDLE&&this.tick())}onFragBuffered(e,t){const{frag:s,part:n}=t;if(s.type!==ke.AUDIO){!this.audioOnly&&s.type===ke.MAIN&&!s.elementaryStreams.video&&!s.elementaryStreams.audiovideo&&(this.audioOnly=!0,this.mainFragLoading=null);return}if(this.fragContextChanged(s)){this.warn(`Fragment ${s.sn}${n?" p: "+n.index:""} of level ${s.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(es(s)){this.fragPrevious=s;const r=this.switchingTrack;r&&(this.bufferedTrack=r,this.switchingTrack=null,this.hls.trigger(L.AUDIO_TRACK_SWITCHED,xt({},r)))}this.fragBufferedComplete(s,n),this.media&&this.tick()}onError(e,t){var s;if(t.fatal){this.state=ce.ERROR;return}switch(t.details){case Q.FRAG_GAP:case Q.FRAG_PARSING_ERROR:case Q.FRAG_DECRYPT_ERROR:case Q.FRAG_LOAD_ERROR:case Q.FRAG_LOAD_TIMEOUT:case Q.KEY_LOAD_ERROR:case Q.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(ke.AUDIO,t);break;case Q.AUDIO_TRACK_LOAD_ERROR:case Q.AUDIO_TRACK_LOAD_TIMEOUT:case Q.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===ce.WAITING_TRACK&&((s=t.context)==null?void 0:s.type)===nt.AUDIO_TRACK&&(this.state=ce.IDLE);break;case Q.BUFFER_ADD_CODEC_ERROR:case Q.BUFFER_APPEND_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)||this.resetLoadingState();break;case Q.BUFFER_FULL_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case Q.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onBufferFlushing(e,{type:t}){t!==Ct.VIDEO&&(this.flushing=!0)}onBufferFlushed(e,{type:t}){if(t!==Ct.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===ce.ENDED&&(this.state=ce.IDLE);const s=this.mediaBuffer||this.media;s&&(this.afterBufferFlushed(s,t,ke.AUDIO),this.tick())}}_handleTransmuxComplete(e){var t;const s="audio",{hls:n}=this,{remuxResult:r,chunkMeta:l}=e,c=this.getCurrentContext(l);if(!c){this.resetWhenMissingContext(l);return}const{frag:h,part:u,level:f}=c,{details:p}=f,{audio:v,text:x,id3:S,initSegment:E}=r;if(this.fragContextChanged(h)||!p){this.fragmentTracker.removeFragment(h);return}if(this.state=ce.PARSING,this.switchingTrack&&v&&this.completeAudioSwitch(this.switchingTrack),E!=null&&E.tracks){const T=h.initSegment||h;if(this.unhandledEncryptionError(E,h))return;this._bufferInitSegment(f,E.tracks,T,l),n.trigger(L.FRAG_PARSING_INIT_SEGMENT,{frag:T,id:s,tracks:E.tracks})}if(v){const{startPTS:T,endPTS:A,startDTS:I,endDTS:_}=v;u&&(u.elementaryStreams[Ct.AUDIO]={startPTS:T,endPTS:A,startDTS:I,endDTS:_}),h.setElementaryStreamInfo(Ct.AUDIO,T,A,I,_),this.bufferFragmentData(v,h,u,l)}if(S!=null&&(t=S.samples)!=null&&t.length){const T=Lt({id:s,frag:h,details:p},S);n.trigger(L.FRAG_PARSING_METADATA,T)}if(x){const T=Lt({id:s,frag:h,details:p},x);n.trigger(L.FRAG_PARSING_USERDATA,T)}}_bufferInitSegment(e,t,s,n){if(this.state!==ce.PARSING||(t.video&&delete t.video,t.audiovideo&&delete t.audiovideo,!t.audio))return;const r=t.audio;r.id=ke.AUDIO;const l=e.audioCodec;this.log(`Init audio buffer, container:${r.container}, codecs[level/parsed]=[${l}/${r.codec}]`),l&&l.split(",").length===1&&(r.levelCodec=l),this.hls.trigger(L.BUFFER_CODECS,t);const c=r.initSegment;if(c!=null&&c.byteLength){const h={type:"audio",frag:s,part:null,chunkMeta:n,parent:s.type,data:c};this.hls.trigger(L.BUFFER_APPENDING,h)}this.tickImmediate()}loadFragment(e,t,s){const n=this.fragmentTracker.getState(e);if(this.switchingTrack||n===hs.NOT_LOADED||n===hs.PARTIAL){var r;if(!es(e))this._loadInitSegment(e,t);else if((r=t.details)!=null&&r.live&&!this.initPTS[e.cc]){this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=ce.WAITING_INIT_PTS;const l=this.mainDetails;l&&l.fragmentStart!==t.details.fragmentStart&&xu(t.details,l)}else super.loadFragment(e,t,s)}else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){if(this.media&&this.bufferedTrack){const{name:t,lang:s,assocLang:n,characteristics:r,audioCodec:l,channels:c}=this.bufferedTrack;Ga({name:t,lang:s,assocLang:n,characteristics:r,audioCodec:l,channels:c},e,Ba)||(mu(e.url,this.hls)?(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null):this.bufferedTrack=e)}}completeAudioSwitch(e){const{hls:t}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(L.AUDIO_TRACK_SWITCHED,xt({},e))}}class Nm extends Pi{constructor(e,t){super(t,e.logger),this.hls=void 0,this.canLoad=!1,this.timer=-1,this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t,s){const n=t?.renditionReports;if(n){let r=-1;for(let l=0;l<n.length;l++){const c=n[l];let h;try{h=new self.URL(c.URI,t.url).href}catch(u){this.warn(`Could not construct new URL for Rendition Report: ${u}`),h=c.URI||""}if(h===e){r=l;break}else h===e.substring(0,h.length)&&(r=l)}if(r!==-1){const l=n[r],c=parseInt(l["LAST-MSN"])||t.lastPartSn;let h=parseInt(l["LAST-PART"])||t.lastPartIndex;if(this.hls.config.lowLatencyMode){const f=Math.min(t.age-t.partTarget,t.targetduration);h>=0&&f>t.partTarget&&(h+=1)}const u=s&&xy(s);return new Sy(c,h>=0?h:void 0,u)}}}loadPlaylist(e){this.clearTimer()}loadingPlaylist(e,t){this.clearTimer()}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}getUrlWithDirectives(e,t){if(t)try{return t.addDirectives(e)}catch(s){this.warn(`Could not construct new URL with HLS Delivery Directives: ${s}`)}return e}playlistLoaded(e,t,s){const{details:n,stats:r}=t,l=self.performance.now(),c=r.loading.first?Math.max(0,l-r.loading.first):0;n.advancedDateTime=Date.now()-c;const h=this.hls.config.timelineOffset;if(h!==n.appliedTimelineOffset){const f=Math.max(h||0,0);n.appliedTimelineOffset=f,n.fragments.forEach(p=>{p.setStart(p.playlistOffset+f)})}if(n.live||s!=null&&s.live){const f="levelInfo"in t?t.levelInfo:t.track;if(n.reloaded(s),s&&n.fragments.length>0){Pw(s,n,this);const I=n.playlistParsingError;if(I){this.warn(I);const _=this.hls;if(!_.config.ignorePlaylistParsingErrors){var u;const{networkDetails:C}=t;_.trigger(L.ERROR,{type:Fe.NETWORK_ERROR,details:Q.LEVEL_PARSING_ERROR,fatal:!1,url:n.url,error:I,reason:I.message,level:t.level||void 0,parent:(u=n.fragments[0])==null?void 0:u.type,networkDetails:C,stats:r});return}n.playlistParsingError=null}}n.requestScheduled===-1&&(n.requestScheduled=r.loading.start);const p=this.hls.mainForwardBufferInfo,v=p?p.end-p.len:0,x=(n.edge-v)*1e3,S=JS(n,x);if(n.requestScheduled+S<l?n.requestScheduled=l:n.requestScheduled+=S,this.log(`live playlist ${e} ${n.advanced?"REFRESHED "+n.lastPartSn+"-"+n.lastPartIndex:n.updated?"UPDATED":"MISSED"}`),!this.canLoad||!n.live)return;let E,T,A;if(n.canBlockReload&&n.endSN&&n.advanced){const I=this.hls.config.lowLatencyMode,_=n.lastPartSn,C=n.endSN,k=n.lastPartIndex,U=k!==-1,O=_===C;U?O?(T=C+1,A=I?0:k):(T=_,A=I?k+1:n.maxPartIndex):T=C+1;const F=n.age,j=F+n.ageHeader;let M=Math.min(j-n.partTarget,n.targetduration*1.5);if(M>0){if(j>n.targetduration*3)this.log(`Playlist last advanced ${F.toFixed(2)}s ago. Omitting segment and part directives.`),T=void 0,A=void 0;else if(s!=null&&s.tuneInGoal&&j-n.partTarget>s.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${s.tuneInGoal} to: ${M} with playlist age: ${n.age}`),M=0;else{const H=Math.floor(M/n.targetduration);if(T+=H,A!==void 0){const K=Math.round(M%n.targetduration/n.partTarget);A+=K}this.log(`CDN Tune-in age: ${n.ageHeader}s last advanced ${F.toFixed(2)}s goal: ${M} skip sn ${H} to part ${A}`)}n.tuneInGoal=M}if(E=this.getDeliveryDirectives(n,t.deliveryDirectives,T,A),I||!O){n.requestScheduled=l,this.loadingPlaylist(f,E);return}}else(n.canBlockReload||n.canSkipUntil)&&(E=this.getDeliveryDirectives(n,t.deliveryDirectives,T,A));E&&T!==void 0&&n.canBlockReload&&(n.requestScheduled=r.loading.first+Math.max(S-c*2,S/2)),this.scheduleLoading(f,E,n)}else this.clearTimer()}scheduleLoading(e,t,s){const n=s||e.details;if(!n){this.loadingPlaylist(e,t);return}const r=self.performance.now(),l=n.requestScheduled;if(r>=l){this.loadingPlaylist(e,t);return}const c=l-r;this.log(`reload live playlist ${e.name||e.bitrate+"bps"} in ${Math.round(c)} ms`),this.clearTimer(),this.timer=self.setTimeout(()=>this.loadingPlaylist(e,t),c)}getDeliveryDirectives(e,t,s,n){let r=xy(e);return t!=null&&t.skip&&e.deltaUpdateFailed&&(s=t.msn,n=t.part,r=Jc.No),new Sy(s,n,r)}checkRetry(e){const t=e.details,s=pu(e),n=e.errorAction,{action:r,retryCount:l=0,retryConfig:c}=n||{},h=!!n&&!!c&&(r===Rs.RetryRequest||!n.resolved&&r===Rs.SendAlternateToPenaltyBox);if(h){var u;if(l>=c.maxNumRetry)return!1;if(s&&(u=e.context)!=null&&u.deliveryDirectives)this.warn(`Retrying playlist loading ${l+1}/${c.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{const f=xm(c,l);this.clearTimer(),this.timer=self.setTimeout(()=>this.loadPlaylist(),f),this.warn(`Retrying playlist loading ${l+1}/${c.maxNumRetry} after "${t}" in ${f}ms`)}e.levelRetry=!0,n.resolved=!0}return h}}function Ib(i,e){if(i.length!==e.length)return!1;for(let t=0;t<i.length;t++)if(!so(i[t].attrs,e[t].attrs))return!1;return!0}function so(i,e,t){const s=i["STABLE-RENDITION-ID"];return s&&!t?s===e["STABLE-RENDITION-ID"]:!(t||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(n=>i[n]!==e[n])}function zf(i,e){return e.label.toLowerCase()===i.name.toLowerCase()&&(!e.language||e.language.toLowerCase()===(i.lang||"").toLowerCase())}class HC extends Nm{constructor(e){super(e,"audio-track-controller"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.MANIFEST_PARSED,this.onManifestParsed,this),e.on(L.LEVEL_LOADING,this.onLevelLoading,this),e.on(L.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(L.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(L.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.MANIFEST_PARSED,this.onManifestParsed,this),e.off(L.LEVEL_LOADING,this.onLevelLoading,this),e.off(L.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(L.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(L.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){const{id:s,groupId:n,details:r}=t,l=this.tracksInGroup[s];if(!l||l.groupId!==n){this.warn(`Audio track with id:${s} and group:${n} not found in active group ${l?.groupId}`);return}const c=l.details;l.details=t.details,this.log(`Audio track ${s} "${l.name}" lang:${l.lang} group:${n} loaded [${r.startSN}-${r.endSN}]`),s===this.trackId&&this.playlistLoaded(s,t,c)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const s=t.audioGroups||null,n=this.groupIds;let r=this.currentTrack;if(!s||n?.length!==s?.length||s!=null&&s.some(c=>n?.indexOf(c)===-1)){this.groupIds=s,this.trackId=-1,this.currentTrack=null;const c=this.tracks.filter(v=>!s||s.indexOf(v.groupId)!==-1);if(c.length)this.selectDefaultTrack&&!c.some(v=>v.default)&&(this.selectDefaultTrack=!1),c.forEach((v,x)=>{v.id=x});else if(!r&&!this.tracksInGroup.length)return;this.tracksInGroup=c;const h=this.hls.config.audioPreference;if(!r&&h){const v=an(h,c,Ba);if(v>-1)r=c[v];else{const x=an(h,this.tracks);r=this.tracks[x]}}let u=this.findTrackId(r);u===-1&&r&&(u=this.findTrackId(null));const f={audioTracks:c};this.log(`Updating audio tracks, ${c.length} track(s) found in group(s): ${s?.join(",")}`),this.hls.trigger(L.AUDIO_TRACKS_UPDATED,f);const p=this.trackId;if(u!==-1&&p===-1)this.setAudioTrack(u);else if(c.length&&p===-1){var l;const v=new Error(`No audio track selected for current audio group-ID(s): ${(l=this.groupIds)==null?void 0:l.join(",")} track count: ${c.length}`);this.warn(v.message),this.hls.trigger(L.ERROR,{type:Fe.MEDIA_ERROR,details:Q.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:v})}}}onError(e,t){t.fatal||!t.context||t.context.type===nt.AUDIO_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){const t=this.hls;if(t.config.audioPreference=e,e){const s=this.allAudioTracks;if(this.selectDefaultTrack=!1,s.length){const n=this.currentTrack;if(n&&Ga(e,n,Ba))return n;const r=an(e,this.tracksInGroup,Ba);if(r>-1){const l=this.tracksInGroup[r];return this.setAudioTrack(r),l}else if(n){let l=t.loadLevel;l===-1&&(l=t.firstAutoLevel);const c=sw(e,t.levels,s,l,Ba);if(c===-1)return null;t.nextLoadLevel=c}if(e.channels||e.audioCodec){const l=an(e,s);if(l>-1)return s[l]}}}return null}setAudioTrack(e){const t=this.tracksInGroup;if(e<0||e>=t.length){this.warn(`Invalid audio track id: ${e}`);return}this.selectDefaultTrack=!1;const s=this.currentTrack,n=t[e],r=n.details&&!n.details.live;if(e===this.trackId&&n===s&&r||(this.log(`Switching to audio-track ${e} "${n.name}" lang:${n.lang} group:${n.groupId} channels:${n.channels}`),this.trackId=e,this.currentTrack=n,this.hls.trigger(L.AUDIO_TRACK_SWITCHING,xt({},n)),r))return;const l=this.switchParams(n.url,s?.details,n.details);this.loadPlaylist(l)}findTrackId(e){const t=this.tracksInGroup;for(let s=0;s<t.length;s++){const n=t[s];if(!(this.selectDefaultTrack&&!n.default)&&(!e||Ga(e,n,Ba)))return s}if(e){const{name:s,lang:n,assocLang:r,characteristics:l,audioCodec:c,channels:h}=e;for(let u=0;u<t.length;u++){const f=t[u];if(Ga({name:s,lang:n,assocLang:r,characteristics:l,audioCodec:c,channels:h},f,Ba))return u}for(let u=0;u<t.length;u++){const f=t[u];if(so(e.attrs,f.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return u}for(let u=0;u<t.length;u++){const f=t[u];if(so(e.attrs,f.attrs,["LANGUAGE"]))return u}}return-1}loadPlaylist(e){super.loadPlaylist();const t=this.currentTrack;this.shouldLoadPlaylist(t)&&mu(t.url,this.hls)&&this.scheduleLoading(t,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const s=e.id,n=e.groupId,r=this.getUrlWithDirectives(e.url,t),l=e.details,c=l?.age;this.log(`Loading audio-track ${s} "${e.name}" lang:${e.lang} group:${n}${t?.msn!==void 0?" at sn "+t.msn+" part "+t.part:""}${c&&l.live?" age "+c.toFixed(1)+(l.type&&" "+l.type||""):""} ${r}`),this.hls.trigger(L.AUDIO_TRACK_LOADING,{url:r,id:s,groupId:n,deliveryDirectives:t||null,track:e})}}class zC{constructor(e){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=e}destroy(){this.tracks=this.queues=null}append(e,t,s){if(this.queues===null||this.tracks===null)return;const n=this.queues[t];n.push(e),n.length===1&&!s&&this.executeNext(t)}appendBlocker(e){return new Promise(t=>{const s={label:"async-blocker",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.append(s,e)})}prependBlocker(e){return new Promise(t=>{if(this.queues){const s={label:"async-blocker-prepend",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.queues[e].unshift(s)}})}removeBlockers(){this.queues!==null&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach(e=>{var t;const s=(t=e[0])==null?void 0:t.label;(s==="async-blocker"||s==="async-blocker-prepend")&&(e[0].execute(),e.splice(0,1))})}unblockAudio(e){if(this.queues===null)return;this.queues.audio[0]===e&&this.shiftAndExecuteNext("audio")}executeNext(e){if(this.queues===null||this.tracks===null)return;const t=this.queues[e];if(t.length){const n=t[0];try{n.execute()}catch(r){var s;if(n.onError(r),this.queues===null||this.tracks===null)return;const l=(s=this.tracks[e])==null?void 0:s.buffer;l!=null&&l.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){this.queues!==null&&(this.queues[e].shift(),this.executeNext(e))}current(e){var t;return((t=this.queues)==null?void 0:t[e][0])||null}toString(){const{queues:e,tracks:t}=this;return e===null||t===null?"<destroyed>":`
${this.list("video")}
${this.list("audio")}
${this.list("audiovideo")}}`}list(e){var t,s;return(t=this.queues)!=null&&t[e]||(s=this.tracks)!=null&&s[e]?`${e}: (${this.listSbInfo(e)}) ${this.listOps(e)}`:""}listSbInfo(e){var t;const s=(t=this.tracks)==null?void 0:t[e],n=s?.buffer;return n?`SourceBuffer${n.updating?" updating":""}${s.ended?" ended":""}${s.ending?" ending":""}`:"none"}listOps(e){var t;return((t=this.queues)==null?void 0:t[e].map(s=>s.label).join(", "))||""}}const ax=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,_b="HlsJsTrackRemovedError";class KC extends Error{constructor(e){super(e),this.name=_b}}class YC extends Pi{constructor(e,t){super("buffer-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.details=null,this._objectUrl=null,this.operationQueue=null,this.bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.blockedAudioAppend=null,this.lastVideoAppendEnd=0,this.appendSource=void 0,this.transferData=void 0,this.overrides=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.sourceBuffers=[[null,null],[null,null]],this._onEndStreaming=s=>{var n;this.hls&&((n=this.mediaSource)==null?void 0:n.readyState)==="open"&&this.hls.pauseBuffering()},this._onStartStreaming=s=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=s=>{const{media:n,mediaSource:r}=this;s&&this.log("Media source opened"),!(!n||!r)&&(r.removeEventListener("sourceopen",this._onMediaSourceOpen),n.removeEventListener("emptied",this._onMediaEmptied),this.updateDuration(),this.hls.trigger(L.MEDIA_ATTACHED,{media:n,mediaSource:r}),this.mediaSource!==null&&this.checkPendingTracks())},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:s,_objectUrl:n}=this;s!==n&&this.error(`Media element src was set while attaching MediaSource (${n} > ${s})`)},this.hls=e,this.fragmentTracker=t,this.appendSource=p1(ya(e.config.preferManagedMediaSource)),this.initTracks(),this.registerListeners()}hasSourceTypes(){return Object.keys(this.tracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null}registerListeners(){const{hls:e}=this;e.on(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.MANIFEST_PARSED,this.onManifestParsed,this),e.on(L.BUFFER_RESET,this.onBufferReset,this),e.on(L.BUFFER_APPENDING,this.onBufferAppending,this),e.on(L.BUFFER_CODECS,this.onBufferCodecs,this),e.on(L.BUFFER_EOS,this.onBufferEos,this),e.on(L.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(L.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(L.FRAG_PARSED,this.onFragParsed,this),e.on(L.FRAG_CHANGED,this.onFragChanged,this),e.on(L.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.MANIFEST_PARSED,this.onManifestParsed,this),e.off(L.BUFFER_RESET,this.onBufferReset,this),e.off(L.BUFFER_APPENDING,this.onBufferAppending,this),e.off(L.BUFFER_CODECS,this.onBufferCodecs,this),e.off(L.BUFFER_EOS,this.onBufferEos,this),e.off(L.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(L.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(L.FRAG_PARSED,this.onFragParsed,this),e.off(L.FRAG_CHANGED,this.onFragChanged,this),e.off(L.ERROR,this.onError,this)}transferMedia(){const{media:e,mediaSource:t}=this;if(!e)return null;const s={};if(this.operationQueue){const r=this.isUpdating();r||this.operationQueue.removeBlockers();const l=this.isQueued();(r||l)&&this.warn(`Transfering MediaSource with${l?" operations in queue":""}${r?" updating SourceBuffer(s)":""} ${this.operationQueue}`),this.operationQueue.destroy()}const n=this.transferData;return!this.sourceBufferCount&&n&&n.mediaSource===t?Lt(s,n.tracks):this.sourceBuffers.forEach(r=>{const[l]=r;l&&(s[l]=Lt({},this.tracks[l]),this.removeBuffer(l)),r[0]=r[1]=null}),{media:e,mediaSource:t,tracks:s}}initTracks(){const e={};this.sourceBuffers=[[null,null],[null,null]],this.tracks=e,this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0}onManifestLoading(){this.bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){var s;let n=2;(t.audio&&!t.video||!t.altAudio)&&(n=1),this.bufferCodecEventsTotal=n,this.log(`${n} bufferCodec event(s) expected.`),(s=this.transferData)!=null&&s.mediaSource&&this.sourceBufferCount&&n&&this.bufferCreated()}onMediaAttaching(e,t){const s=this.media=t.media;this.transferData=this.overrides=void 0;const n=ya(this.appendSource);if(n){const r=!!t.mediaSource;(r||t.overrides)&&(this.transferData=t,this.overrides=t.overrides);const l=this.mediaSource=t.mediaSource||new n;if(this.assignMediaSource(l),r)this._objectUrl=s.src,this.attachTransferred();else{const c=this._objectUrl=self.URL.createObjectURL(l);if(this.appendSource)try{s.removeAttribute("src");const h=self.ManagedMediaSource;s.disableRemotePlayback=s.disableRemotePlayback||h&&l instanceof h,rx(s),qC(s,c),s.load()}catch{s.src=c}else s.src=c}s.addEventListener("emptied",this._onMediaEmptied)}}assignMediaSource(e){var t,s;this.log(`${((t=this.transferData)==null?void 0:t.mediaSource)===e?"transferred":"created"} media source: ${(s=e.constructor)==null?void 0:s.name}`),e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.addEventListener("startstreaming",this._onStartStreaming),e.addEventListener("endstreaming",this._onEndStreaming))}attachTransferred(){const e=this.media,t=this.transferData;if(!t||!e)return;const s=this.tracks,n=t.tracks,r=n?Object.keys(n):null,l=r?r.length:0,c=()=>{Promise.resolve().then(()=>{this.media&&this.mediaSourceOpenOrEnded&&this._onMediaSourceOpen()})};if(n&&r&&l){if(!this.tracksReady){this.hls.config.startFragPrefetch=!0,this.log("attachTransferred: waiting for SourceBuffer track info");return}if(this.log(`attachTransferred: (bufferCodecEventsTotal ${this.bufferCodecEventsTotal})
required tracks: ${Ot(s,(h,u)=>h==="initSegment"?void 0:u)};
transfer tracks: ${Ot(n,(h,u)=>h==="initSegment"?void 0:u)}}`),!TS(n,s)){t.mediaSource=null,t.tracks=void 0;const h=e.currentTime,u=this.details,f=Math.max(h,u?.fragments[0].start||0);if(f-h>1){this.log(`attachTransferred: waiting for playback to reach new tracks start time ${h} -> ${f}`);return}this.warn(`attachTransferred: resetting MediaSource for incompatible tracks ("${Object.keys(n)}"->"${Object.keys(s)}") start time: ${f} currentTime: ${h}`),this.onMediaDetaching(L.MEDIA_DETACHING,{}),this.onMediaAttaching(L.MEDIA_ATTACHING,t),e.currentTime=f;return}this.transferData=void 0,r.forEach(h=>{const u=h,f=n[u];if(f){const p=f.buffer;if(p){const v=this.fragmentTracker,x=f.id;if(v.hasFragments(x)||v.hasParts(x)){const T=qe.getBuffered(p);v.detectEvictedFragments(u,T,x,null,!0)}const S=mf(u),E=[u,p];this.sourceBuffers[S]=E,p.updating&&this.operationQueue&&this.operationQueue.prependBlocker(u),this.trackSourceBuffer(u,f)}}}),c(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),c()}get mediaSourceOpenOrEnded(){var e;const t=(e=this.mediaSource)==null?void 0:e.readyState;return t==="open"||t==="ended"}onMediaDetaching(e,t){const s=!!t.transferMedia;this.transferData=this.overrides=void 0;const{media:n,mediaSource:r,_objectUrl:l}=this;if(r){if(this.log(`media source ${s?"transferring":"detaching"}`),s)this.sourceBuffers.forEach(([c])=>{c&&this.removeBuffer(c)}),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){const c=r.readyState==="open";try{const h=r.sourceBuffers;for(let u=h.length;u--;)c&&h[u].abort(),r.removeSourceBuffer(h[u]);c&&r.endOfStream()}catch(h){this.warn(`onMediaDetaching: ${h.message} while calling endOfStream`)}}this.sourceBufferCount&&this.onBufferReset()}r.removeEventListener("sourceopen",this._onMediaSourceOpen),r.removeEventListener("sourceended",this._onMediaSourceEnded),r.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(r.removeEventListener("startstreaming",this._onStartStreaming),r.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}n&&(n.removeEventListener("emptied",this._onMediaEmptied),s||(l&&self.URL.revokeObjectURL(l),this.mediaSrc===l?(n.removeAttribute("src"),this.appendSource&&rx(n),n.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(L.MEDIA_DETACHED,t)}onBufferReset(){this.sourceBuffers.forEach(([e])=>{e&&this.resetBuffer(e)}),this.initTracks()}resetBuffer(e){var t;const s=(t=this.tracks[e])==null?void 0:t.buffer;if(this.removeBuffer(e),s)try{var n;(n=this.mediaSource)!=null&&n.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(s)}catch(r){this.warn(`onBufferReset ${e}`,r)}delete this.tracks[e]}removeBuffer(e){this.removeBufferListeners(e),this.sourceBuffers[mf(e)]=[null,null];const t=this.tracks[e];t&&(t.buffer=void 0)}resetQueue(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new zC(this.tracks)}onBufferCodecs(e,t){var s;const n=this.tracks,r=Object.keys(t);this.log(`BUFFER_CODECS: "${r}" (current SB count ${this.sourceBufferCount})`);const l="audiovideo"in t&&(n.audio||n.video)||n.audiovideo&&("audio"in t||"video"in t),c=!l&&this.sourceBufferCount&&this.media&&r.some(h=>!n[h]);if(l||c){this.warn(`Unsupported transition between "${Object.keys(n)}" and "${r}" SourceBuffers`);return}r.forEach(h=>{var u,f;const p=t[h],{id:v,codec:x,levelCodec:S,container:E,metadata:T,supplemental:A}=p;let I=n[h];const _=(u=this.transferData)==null||(u=u.tracks)==null?void 0:u[h],C=_!=null&&_.buffer?_:I,k=C?.pendingCodec||C?.codec,U=C?.levelCodec;I||(I=n[h]={buffer:void 0,listeners:[],codec:x,supplemental:A,container:E,levelCodec:S,metadata:T,id:v});const O=Zc(k,U),F=O?.replace(ax,"$1");let j=Zc(x,S);const M=(f=j)==null?void 0:f.replace(ax,"$1");j&&O&&F!==M&&(h.slice(0,5)==="audio"&&(j=hu(j,this.appendSource)),this.log(`switching codec ${k} to ${j}`),j!==(I.pendingCodec||I.codec)&&(I.pendingCodec=j),I.container=E,this.appendChangeType(h,E,j))}),(this.tracksReady||this.sourceBufferCount)&&(t.tracks=this.sourceBufferTracks),!this.sourceBufferCount&&(this.bufferCodecEventsTotal>1&&!this.tracks.video&&!t.video&&((s=t.audio)==null?void 0:s.id)==="main"&&(this.log("Main audio-only"),this.bufferCodecEventsTotal=1),this.mediaSourceOpenOrEnded&&this.checkPendingTracks())}get sourceBufferTracks(){return Object.keys(this.tracks).reduce((e,t)=>{const s=this.tracks[t];return e[t]={id:s.id,container:s.container,codec:s.codec,levelCodec:s.levelCodec},e},{})}appendChangeType(e,t,s){const n=`${t};codecs=${s}`,r={label:`change-type=${n}`,execute:()=>{const l=this.tracks[e];if(l){const c=l.buffer;c!=null&&c.changeType&&(this.log(`changing ${e} sourceBuffer type to ${n}`),c.changeType(n),l.codec=s,l.container=t)}this.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:l=>{this.warn(`Failed to change ${e} SourceBuffer type`,l)}};this.append(r,e,this.isPending(this.tracks[e]))}blockAudio(e){var t;const s=e.start,n=s+e.duration*.05;if(((t=this.fragmentTracker.getAppendedFrag(s,ke.MAIN))==null?void 0:t.gap)===!0)return;const l={label:"block-audio",execute:()=>{var c;const h=this.tracks.video;(this.lastVideoAppendEnd>n||h!=null&&h.buffer&&qe.isBuffered(h.buffer,n)||((c=this.fragmentTracker.getAppendedFrag(n,ke.MAIN))==null?void 0:c.gap)===!0)&&(this.blockedAudioAppend=null,this.shiftAndExecuteNext("audio"))},onStart:()=>{},onComplete:()=>{},onError:c=>{this.warn("Error executing block-audio operation",c)}};this.blockedAudioAppend={op:l,frag:e},this.append(l,"audio",!0)}unblockAudio(){const{blockedAudioAppend:e,operationQueue:t}=this;e&&t&&(this.blockedAudioAppend=null,t.unblockAudio(e.op))}onBufferAppending(e,t){const{tracks:s}=this,{data:n,type:r,parent:l,frag:c,part:h,chunkMeta:u,offset:f}=t,p=u.buffering[r],{sn:v,cc:x}=c,S=self.performance.now();p.start=S;const E=c.stats.buffering,T=h?h.stats.buffering:null;E.start===0&&(E.start=S),T&&T.start===0&&(T.start=S);const A=s.audio;let I=!1;r==="audio"&&A?.container==="audio/mpeg"&&(I=!this.lastMpegAudioChunk||u.id===1||this.lastMpegAudioChunk.sn!==u.sn,this.lastMpegAudioChunk=u);const _=s.video,C=_?.buffer;if(C&&v!=="initSegment"){const O=h||c,F=this.blockedAudioAppend;if(r==="audio"&&l!=="main"&&!this.blockedAudioAppend&&!(_.ending||_.ended)){const M=O.start+O.duration*.05,H=C.buffered,K=this.currentOp("video");!H.length&&!K?this.blockAudio(O):!K&&!qe.isBuffered(C,M)&&this.lastVideoAppendEnd<M&&this.blockAudio(O)}else if(r==="video"){const j=O.end;if(F){const M=F.frag.start;(j>M||j<this.lastVideoAppendEnd||qe.isBuffered(C,M))&&this.unblockAudio()}this.lastVideoAppendEnd=j}}const k=(h||c).start,U={label:`append-${r}`,execute:()=>{var O;p.executeStart=self.performance.now();const F=(O=this.tracks[r])==null?void 0:O.buffer;F&&(I?this.updateTimestampOffset(F,k,.1,r,v,x):f!==void 0&&Oe(f)&&this.updateTimestampOffset(F,f,1e-6,r,v,x)),this.appendExecutor(n,r)},onStart:()=>{},onComplete:()=>{const O=self.performance.now();p.executeEnd=p.end=O,E.first===0&&(E.first=O),T&&T.first===0&&(T.first=O);const F={};this.sourceBuffers.forEach(([j,M])=>{j&&(F[j]=qe.getBuffered(M))}),this.appendErrors[r]=0,r==="audio"||r==="video"?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(L.BUFFER_APPENDED,{type:r,frag:c,part:h,chunkMeta:u,parent:c.type,timeRanges:F})},onError:O=>{var F;const j={type:Fe.MEDIA_ERROR,parent:c.type,details:Q.BUFFER_APPEND_ERROR,sourceBufferName:r,frag:c,part:h,chunkMeta:u,error:O,err:O,fatal:!1},M=(F=this.media)==null?void 0:F.error;if(O.code===DOMException.QUOTA_EXCEEDED_ERR||O.name=="QuotaExceededError"||"quota"in O)j.details=Q.BUFFER_FULL_ERROR;else if(O.code===DOMException.INVALID_STATE_ERR&&this.mediaSourceOpenOrEnded&&!M)j.errorAction=Mr(!0);else if(O.name===_b&&this.sourceBufferCount===0)j.errorAction=Mr(!0);else{const H=++this.appendErrors[r];this.warn(`Failed ${H}/${this.hls.config.appendErrorMaxRetry} times to append segment in "${r}" sourceBuffer (${M||"no media error"})`),(H>=this.hls.config.appendErrorMaxRetry||M)&&(j.fatal=!0)}this.hls.trigger(L.ERROR,j)}};this.log(`queuing "${r}" append sn: ${v}${h?" p: "+h.index:""} of ${c.type===ke.MAIN?"level":"track"} ${c.level} cc: ${x}`),this.append(U,r,this.isPending(this.tracks[r]))}getFlushOp(e,t,s){return this.log(`queuing "${e}" remove ${t}-${s}`),{label:"remove",execute:()=>{this.removeExecutor(e,t,s)},onStart:()=>{},onComplete:()=>{this.hls.trigger(L.BUFFER_FLUSHED,{type:e})},onError:n=>{this.warn(`Failed to remove ${t}-${s} from "${e}" SourceBuffer`,n)}}}onBufferFlushing(e,t){const{type:s,startOffset:n,endOffset:r}=t;s?this.append(this.getFlushOp(s,n,r),s):this.sourceBuffers.forEach(([l])=>{l&&this.append(this.getFlushOp(l,n,r),l)})}onFragParsed(e,t){const{frag:s,part:n}=t,r=[],l=n?n.elementaryStreams:s.elementaryStreams;l[Ct.AUDIOVIDEO]?r.push("audiovideo"):(l[Ct.AUDIO]&&r.push("audio"),l[Ct.VIDEO]&&r.push("video"));const c=()=>{const h=self.performance.now();s.stats.buffering.end=h,n&&(n.stats.buffering.end=h);const u=n?n.stats:s.stats;this.hls.trigger(L.FRAG_BUFFERED,{frag:s,part:n,stats:u,id:s.type})};r.length===0&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${s.type} level: ${s.level} sn: ${s.sn}`),this.blockBuffers(c,r).catch(h=>{this.warn(`Fragment buffered callback ${h}`),this.stepOperationQueue(this.sourceBufferTypes)})}onFragChanged(e,t){this.trimBuffers()}get bufferedToEnd(){return this.sourceBufferCount>0&&!this.sourceBuffers.some(([e])=>{if(e){const t=this.tracks[e];if(t)return!t.ended||t.ending}return!1})}onBufferEos(e,t){var s;this.sourceBuffers.forEach(([l])=>{if(l){const c=this.tracks[l];(!t.type||t.type===l)&&(c.ending=!0,c.ended||(c.ended=!0,this.log(`${l} buffer reached EOS`)))}});const n=((s=this.overrides)==null?void 0:s.endOfStream)!==!1;this.sourceBufferCount>0&&!this.sourceBuffers.some(([l])=>{var c;return l&&!((c=this.tracks[l])!=null&&c.ended)})?n?(this.log("Queueing EOS"),this.blockUntilOpen(()=>{this.tracksEnded();const{mediaSource:l}=this;if(!l||l.readyState!=="open"){l&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${l.readyState}`);return}this.log("Calling mediaSource.endOfStream()"),l.endOfStream(),this.hls.trigger(L.BUFFERED_TO_END,void 0)})):(this.tracksEnded(),this.hls.trigger(L.BUFFERED_TO_END,void 0)):t.type==="video"&&this.unblockAudio()}tracksEnded(){this.sourceBuffers.forEach(([e])=>{if(e!==null){const t=this.tracks[e];t&&(t.ending=!1)}})}onLevelUpdated(e,{details:t}){t.fragments.length&&(this.details=t,this.updateDuration())}updateDuration(){this.blockUntilOpen(()=>{const e=this.getDurationAndRange();e&&this.updateMediaSource(e)})}onError(e,t){if(t.details===Q.BUFFER_APPEND_ERROR&&t.frag){var s;const n=(s=t.errorAction)==null?void 0:s.nextAutoLevel;Oe(n)&&n!==t.frag.level&&this.resetAppendErrors()}}resetAppendErrors(){this.appendErrors={audio:0,video:0,audiovideo:0}}trimBuffers(){const{hls:e,details:t,media:s}=this;if(!s||t===null||!this.sourceBufferCount)return;const n=e.config,r=s.currentTime,l=t.levelTargetDuration,c=t.live&&n.liveBackBufferLength!==null?n.liveBackBufferLength:n.backBufferLength;if(Oe(c)&&c>=0){const u=Math.max(c,l),f=Math.floor(r/l)*l-u;this.flushBackBuffer(r,l,f)}const h=n.frontBufferFlushThreshold;if(Oe(h)&&h>0){const u=Math.max(n.maxBufferLength,h),f=Math.max(u,l),p=Math.floor(r/l)*l+f;this.flushFrontBuffer(r,l,p)}}flushBackBuffer(e,t,s){this.sourceBuffers.forEach(([n,r])=>{if(r){const c=qe.getBuffered(r);if(c.length>0&&s>c.start(0)){var l;this.hls.trigger(L.BACK_BUFFER_REACHED,{bufferEnd:s});const h=this.tracks[n];if((l=this.details)!=null&&l.live)this.hls.trigger(L.LIVE_BACK_BUFFER_REACHED,{bufferEnd:s});else if(h!=null&&h.ended){this.log(`Cannot flush ${n} back buffer while SourceBuffer is in ended state`);return}this.hls.trigger(L.BUFFER_FLUSHING,{startOffset:0,endOffset:s,type:n})}}})}flushFrontBuffer(e,t,s){this.sourceBuffers.forEach(([n,r])=>{if(r){const l=qe.getBuffered(r),c=l.length;if(c<2)return;const h=l.start(c-1),u=l.end(c-1);if(s>h||e>=h&&e<=u)return;this.hls.trigger(L.BUFFER_FLUSHING,{startOffset:h,endOffset:1/0,type:n})}})}getDurationAndRange(){var e;const{details:t,mediaSource:s}=this;if(!t||!this.media||s?.readyState!=="open")return null;const n=t.edge;if(t.live&&this.hls.config.liveDurationInfinity){if(t.fragments.length&&s.setLiveSeekableRange){const u=Math.max(0,t.fragmentStart),f=Math.max(u,n);return{duration:1/0,start:u,end:f}}return{duration:1/0}}const r=(e=this.overrides)==null?void 0:e.duration;if(r)return Oe(r)?{duration:r}:null;const l=this.media.duration,c=Oe(s.duration)?s.duration:0;return n>c&&n>l||!Oe(l)?{duration:n}:null}updateMediaSource({duration:e,start:t,end:s}){const n=this.mediaSource;!this.media||!n||n.readyState!=="open"||(n.duration!==e&&(Oe(e)&&this.log(`Updating MediaSource duration to ${e.toFixed(3)}`),n.duration=e),t!==void 0&&s!==void 0&&(this.log(`MediaSource duration is set to ${n.duration}. Setting seekable range to ${t}-${s}.`),n.setLiveSeekableRange(t,s)))}get tracksReady(){const e=this.pendingTrackCount;return e>0&&(e>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}checkPendingTracks(){const{bufferCodecEventsTotal:e,pendingTrackCount:t,tracks:s}=this;if(this.log(`checkPendingTracks (pending: ${t} codec events expected: ${e}) ${Ot(s)}`),this.tracksReady){var n;const r=(n=this.transferData)==null?void 0:n.tracks;r&&Object.keys(r).length?this.attachTransferred():this.createSourceBuffers()}}bufferCreated(){if(this.sourceBufferCount){const e={};this.sourceBuffers.forEach(([t,s])=>{if(t){const n=this.tracks[t];e[t]={buffer:s,container:n.container,codec:n.codec,supplemental:n.supplemental,levelCodec:n.levelCodec,id:n.id,metadata:n.metadata}}}),this.hls.trigger(L.BUFFER_CREATED,{tracks:e}),this.log(`SourceBuffers created. Running queue: ${this.operationQueue}`),this.sourceBuffers.forEach(([t])=>{this.executeNext(t)})}else{const e=new Error("could not create source buffer for media codec(s)");this.hls.trigger(L.ERROR,{type:Fe.MEDIA_ERROR,details:Q.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:e,reason:e.message})}}createSourceBuffers(){const{tracks:e,sourceBuffers:t,mediaSource:s}=this;if(!s)throw new Error("createSourceBuffers called when mediaSource was null");for(const r in e){const l=r,c=e[l];if(this.isPending(c)){const h=this.getTrackCodec(c,l),u=`${c.container};codecs=${h}`;c.codec=h,this.log(`creating sourceBuffer(${u})${this.currentOp(l)?" Queued":""} ${Ot(c)}`);try{const f=s.addSourceBuffer(u),p=mf(l),v=[l,f];t[p]=v,c.buffer=f}catch(f){var n;this.error(`error while trying to add sourceBuffer: ${f.message}`),this.shiftAndExecuteNext(l),(n=this.operationQueue)==null||n.removeBlockers(),delete this.tracks[l],this.hls.trigger(L.ERROR,{type:Fe.MEDIA_ERROR,details:Q.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:f,sourceBufferName:l,mimeType:u,parent:c.id});return}this.trackSourceBuffer(l,c)}}this.bufferCreated()}getTrackCodec(e,t){const s=e.supplemental;let n=e.codec;s&&(t==="video"||t==="audiovideo")&&Wl(s,"video")&&(n=M1(n,s));const r=Zc(n,e.levelCodec);return r?t.slice(0,5)==="audio"?hu(r,this.appendSource):r:""}trackSourceBuffer(e,t){const s=t.buffer;if(!s)return;const n=this.getTrackCodec(t,e);this.tracks[e]={buffer:s,codec:n,container:t.container,levelCodec:t.levelCodec,supplemental:t.supplemental,metadata:t.metadata,id:t.id,listeners:[]},this.removeBufferListeners(e),this.addBufferListener(e,"updatestart",this.onSBUpdateStart),this.addBufferListener(e,"updateend",this.onSBUpdateEnd),this.addBufferListener(e,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(e,"bufferedchange",(r,l)=>{const c=l.removedRanges;c!=null&&c.length&&this.hls.trigger(L.BUFFER_FLUSHED,{type:r})})}get mediaSrc(){var e,t;const s=((e=this.media)==null||(t=e.querySelector)==null?void 0:t.call(e,"source"))||this.media;return s?.src}onSBUpdateStart(e){const t=this.currentOp(e);t&&t.onStart()}onSBUpdateEnd(e){var t;if(((t=this.mediaSource)==null?void 0:t.readyState)==="closed"){this.resetBuffer(e);return}const s=this.currentOp(e);s&&(s.onComplete(),this.shiftAndExecuteNext(e))}onSBUpdateError(e,t){var s;const n=new Error(`${e} SourceBuffer error. MediaSource readyState: ${(s=this.mediaSource)==null?void 0:s.readyState}`);this.error(`${n}`,t),this.hls.trigger(L.ERROR,{type:Fe.MEDIA_ERROR,details:Q.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:n,fatal:!1});const r=this.currentOp(e);r&&r.onError(n)}updateTimestampOffset(e,t,s,n,r,l){const c=t-e.timestampOffset;Math.abs(c)>=s&&(this.log(`Updating ${n} SourceBuffer timestampOffset to ${t} (sn: ${r} cc: ${l})`),e.timestampOffset=t)}removeExecutor(e,t,s){const{media:n,mediaSource:r}=this,l=this.tracks[e],c=l?.buffer;if(!n||!r||!c){this.warn(`Attempting to remove from the ${e} SourceBuffer, but it does not exist`),this.shiftAndExecuteNext(e);return}const h=Oe(n.duration)?n.duration:1/0,u=Oe(r.duration)?r.duration:1/0,f=Math.max(0,t),p=Math.min(s,h,u);p>f&&(!l.ending||l.ended)?(l.ended=!1,this.log(`Removing [${f},${p}] from the ${e} SourceBuffer`),c.remove(f,p)):this.shiftAndExecuteNext(e)}appendExecutor(e,t){const s=this.tracks[t],n=s?.buffer;if(!n)throw new KC(`Attempting to append to the ${t} SourceBuffer, but it does not exist`);s.ending=!1,s.ended=!1,n.appendBuffer(e)}blockUntilOpen(e){if(this.isUpdating()||this.isQueued())this.blockBuffers(e).catch(t=>{this.warn(`SourceBuffer blocked callback ${t}`),this.stepOperationQueue(this.sourceBufferTypes)});else try{e()}catch(t){this.warn(`Callback run without blocking ${this.operationQueue} ${t}`)}}isUpdating(){return this.sourceBuffers.some(([e,t])=>e&&t.updating)}isQueued(){return this.sourceBuffers.some(([e])=>e&&!!this.currentOp(e))}isPending(e){return!!e&&!e.buffer}blockBuffers(e,t=this.sourceBufferTypes){if(!t.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);const{operationQueue:s}=this,n=t.map(l=>this.appendBlocker(l));return t.length>1&&this.blockedAudioAppend&&this.unblockAudio(),Promise.all(n).then(l=>{s===this.operationQueue&&(e(),this.stepOperationQueue(this.sourceBufferTypes))})}stepOperationQueue(e){e.forEach(t=>{var s;const n=(s=this.tracks[t])==null?void 0:s.buffer;!n||n.updating||this.shiftAndExecuteNext(t)})}append(e,t,s){this.operationQueue&&this.operationQueue.append(e,t,s)}appendBlocker(e){if(this.operationQueue)return this.operationQueue.appendBlocker(e)}currentOp(e){return this.operationQueue?this.operationQueue.current(e):null}executeNext(e){e&&this.operationQueue&&this.operationQueue.executeNext(e)}shiftAndExecuteNext(e){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(e)}get pendingTrackCount(){return Object.keys(this.tracks).reduce((e,t)=>e+(this.isPending(this.tracks[t])?1:0),0)}get sourceBufferCount(){return this.sourceBuffers.reduce((e,[t])=>e+(t?1:0),0)}get sourceBufferTypes(){return this.sourceBuffers.map(([e])=>e).filter(e=>!!e)}addBufferListener(e,t,s){const n=this.tracks[e];if(!n)return;const r=n.buffer;if(!r)return;const l=s.bind(this,e);n.listeners.push({event:t,listener:l}),r.addEventListener(t,l)}removeBufferListeners(e){const t=this.tracks[e];if(!t)return;const s=t.buffer;s&&(t.listeners.forEach(n=>{s.removeEventListener(n.event,n.listener)}),t.listeners.length=0)}}function rx(i){const e=i.querySelectorAll("source");[].slice.call(e).forEach(t=>{i.removeChild(t)})}function qC(i,e){const t=self.document.createElement("source");t.type="video/mp4",t.src=e,i.appendChild(t)}function mf(i){return i==="audio"?1:0}class km{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(L.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(L.MANIFEST_PARSED,this.onManifestParsed,this),e.on(L.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(L.BUFFER_CODECS,this.onBufferCodecs,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(L.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(L.MANIFEST_PARSED,this.onManifestParsed,this),e.off(L.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(L.BUFFER_CODECS,this.onBufferCodecs,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){const s=this.hls.levels[t.droppedLevel];this.isLevelAllowed(s)&&this.restrictedLevels.push({bitrate:s.bitrate,height:s.height,width:s.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,t){const s=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,s.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onLevelsUpdated(e,t){this.timer&&Oe(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping(),this.media=null}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}const e=this.hls.levels;if(e.length){const t=this.hls,s=this.getMaxLevel(e.length-1);s!==this.autoLevelCapping&&t.logger.log(`Setting autoLevelCapping to ${s}: ${e[s].height}p@${e[s].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),t.autoLevelCapping=s,t.autoLevelEnabled&&t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){const t=this.hls.levels;if(!t.length)return-1;const s=t.filter((n,r)=>this.isLevelAllowed(n)&&r<=e);return this.clientRect=null,km.getMaxLevelByMediaSize(s,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,t={width:0,height:0};if(e){const s=e.getBoundingClientRect();t.width=s.width,t.height=s.height,!t.width&&!t.height&&(t.width=s.right-s.left||e.width||0,t.height=s.bottom-s.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch{}return Math.min(e,this.hls.config.maxDevicePixelRatio)}isLevelAllowed(e){return!this.restrictedLevels.some(s=>e.bitrate===s.bitrate&&e.width===s.width&&e.height===s.height)}static getMaxLevelByMediaSize(e,t,s){if(!(e!=null&&e.length))return-1;const n=(c,h)=>h?c.width!==h.width||c.height!==h.height:!0;let r=e.length-1;const l=Math.max(t,s);for(let c=0;c<e.length;c+=1){const h=e[c];if((h.width>=l||h.height>=l)&&n(h,e[c+1])){r=c;break}}return r}}const QC={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"},Qs=QC,WC={HLS:"h"},XC=WC;class ln{constructor(e,t){Array.isArray(e)&&(e=e.map(s=>s instanceof ln?s:new ln(s))),this.value=e,this.params=t}}const ZC="Dict";function JC(i){return Array.isArray(i)?JSON.stringify(i):i instanceof Map?"Map{}":i instanceof Set?"Set{}":typeof i=="object"?JSON.stringify(i):String(i)}function eO(i,e,t,s){return new Error(`failed to ${i} "${JC(e)}" as ${t}`,{cause:s})}function on(i,e,t){return eO("serialize",i,e,t)}class Rb{constructor(e){this.description=e}}const lx="Bare Item",tO="Boolean";function sO(i){if(typeof i!="boolean")throw on(i,tO);return i?"?1":"?0"}function iO(i){return btoa(String.fromCharCode(...i))}const nO="Byte Sequence";function aO(i){if(ArrayBuffer.isView(i)===!1)throw on(i,nO);return`:${iO(i)}:`}const rO="Integer";function lO(i){return i<-999999999999999||999999999999999<i}function Lb(i){if(lO(i))throw on(i,rO);return i.toString()}function oO(i){return`@${Lb(i.getTime()/1e3)}`}function wb(i,e){if(i<0)return-wb(-i,e);const t=Math.pow(10,e);if(Math.abs(i*t%1-.5)<Number.EPSILON){const n=Math.floor(i*t);return(n%2===0?n:n+1)/t}else return Math.round(i*t)/t}const cO="Decimal";function uO(i){const e=wb(i,3);if(Math.floor(Math.abs(e)).toString().length>12)throw on(i,cO);const t=e.toString();return t.includes(".")?t:`${t}.0`}const dO="String",hO=/[\x00-\x1f\x7f]+/;function fO(i){if(hO.test(i))throw on(i,dO);return`"${i.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}function mO(i){return i.description||i.toString().slice(7,-1)}const pO="Token";function ox(i){const e=mO(i);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(e)===!1)throw on(e,pO);return e}function Kf(i){switch(typeof i){case"number":if(!Oe(i))throw on(i,lx);return Number.isInteger(i)?Lb(i):uO(i);case"string":return fO(i);case"symbol":return ox(i);case"boolean":return sO(i);case"object":if(i instanceof Date)return oO(i);if(i instanceof Uint8Array)return aO(i);if(i instanceof Rb)return ox(i);default:throw on(i,lx)}}const gO="Key";function Yf(i){if(/^[a-z*][a-z0-9\-_.*]*$/.test(i)===!1)throw on(i,gO);return i}function Dm(i){return i==null?"":Object.entries(i).map(([e,t])=>t===!0?`;${Yf(e)}`:`;${Yf(e)}=${Kf(t)}`).join("")}function Cb(i){return i instanceof ln?`${Kf(i.value)}${Dm(i.params)}`:Kf(i)}function vO(i){return`(${i.value.map(Cb).join(" ")})${Dm(i.params)}`}function yO(i,e={whitespace:!0}){if(typeof i!="object"||i==null)throw on(i,ZC);const t=i instanceof Map?i.entries():Object.entries(i),s=e?.whitespace?" ":"";return Array.from(t).map(([n,r])=>{r instanceof ln||(r=new ln(r));let l=Yf(n);return r.value===!0?l+=Dm(r.params):(l+="=",Array.isArray(r.value)?l+=vO(r):l+=Cb(r)),l}).join(`,${s}`)}function Ob(i,e){return yO(i,e)}const tn="CMCD-Object",Qt="CMCD-Request",ja="CMCD-Session",fa="CMCD-Status",xO={br:tn,ab:tn,d:tn,ot:tn,tb:tn,tpb:tn,lb:tn,tab:tn,lab:tn,url:tn,pb:Qt,bl:Qt,tbl:Qt,dl:Qt,ltc:Qt,mtp:Qt,nor:Qt,nrr:Qt,rc:Qt,sn:Qt,sta:Qt,su:Qt,ttfb:Qt,ttfbb:Qt,ttlb:Qt,cmsdd:Qt,cmsds:Qt,smrt:Qt,df:Qt,cs:Qt,ts:Qt,cid:ja,pr:ja,sf:ja,sid:ja,st:ja,v:ja,msd:ja,bs:fa,bsd:fa,cdn:fa,rtp:fa,bg:fa,pt:fa,ec:fa,e:fa},SO={REQUEST:Qt};function bO(i){return Object.keys(i).reduce((e,t)=>{var s;return(s=i[t])===null||s===void 0||s.forEach(n=>e[n]=t),e},{})}function TO(i,e){const t={};if(!i)return t;const s=Object.keys(i),n=e?bO(e):{};return s.reduce((r,l)=>{var c;const h=xO[l]||n[l]||SO.REQUEST,u=(c=r[h])!==null&&c!==void 0?c:r[h]={};return u[l]=i[l],r},t)}function EO(i){return["ot","sf","st","e","sta"].includes(i)}function AO(i){return typeof i=="number"?Oe(i):i!=null&&i!==""&&i!==!1}const Nb="event";function IO(i,e){const t=new URL(i),s=new URL(e);if(t.origin!==s.origin)return i;const n=t.pathname.split("/").slice(1),r=s.pathname.split("/").slice(1,-1);for(;n[0]===r[0];)n.shift(),r.shift();for(;r.length;)r.shift(),n.unshift("..");return n.join("/")+t.search+t.hash}const iu=i=>Math.round(i),qf=(i,e)=>Array.isArray(i)?i.map(t=>qf(t,e)):i instanceof ln&&typeof i.value=="string"?new ln(qf(i.value,e),i.params):(e.baseUrl&&(i=IO(i,e.baseUrl)),e.version===1?encodeURIComponent(i):i),Fc=i=>iu(i/100)*100,_O=(i,e)=>{let t=i;return e.version>=2&&(i instanceof ln&&typeof i.value=="string"?t=new ln([i]):typeof i=="string"&&(t=[i])),qf(t,e)},RO={br:iu,d:iu,bl:Fc,dl:Fc,mtp:Fc,nor:_O,rtp:Fc,tb:iu},kb="request",Db="response",Pm=["ab","bg","bl","br","bs","bsd","cdn","cid","cs","df","ec","lab","lb","ltc","msd","mtp","pb","pr","pt","sf","sid","sn","st","sta","tab","tb","tbl","tpb","ts","v"],LO=["e"],wO=/^[a-zA-Z0-9-.]+-[a-zA-Z0-9-.]+$/;function ku(i){return wO.test(i)}function CO(i){return Pm.includes(i)||LO.includes(i)||ku(i)}const Pb=["d","dl","nor","ot","rtp","su"];function OO(i){return Pm.includes(i)||Pb.includes(i)||ku(i)}const NO=["cmsdd","cmsds","rc","smrt","ttfb","ttfbb","ttlb","url"];function kO(i){return Pm.includes(i)||Pb.includes(i)||NO.includes(i)||ku(i)}const DO=["bl","br","bs","cid","d","dl","mtp","nor","nrr","ot","pr","rtp","sf","sid","st","su","tb","v"];function PO(i){return DO.includes(i)||ku(i)}const UO={[Db]:kO,[Nb]:CO,[kb]:OO};function Ub(i,e={}){const t={};if(i==null||typeof i!="object")return t;const s=e.version||i.v||1,n=e.reportingMode||kb,r=s===1?PO:UO[n];let l=Object.keys(i).filter(r);const c=e.filter;typeof c=="function"&&(l=l.filter(c));const h=n===Db||n===Nb;h&&!l.includes("ts")&&l.push("ts"),s>1&&!l.includes("v")&&l.push("v");const u=Lt({},RO,e.formatters),f={version:s,reportingMode:n,baseUrl:e.baseUrl};return l.sort().forEach(p=>{let v=i[p];const x=u[p];if(typeof x=="function"&&(v=x(v,f)),p==="v"){if(s===1)return;v=s}p=="pr"&&v===1||(h&&p==="ts"&&!Oe(v)&&(v=Date.now()),AO(v)&&(EO(p)&&typeof v=="string"&&(v=new Rb(v)),t[p]=v))}),t}function MO(i,e={}){const t={};if(!i)return t;const s=Ub(i,e),n=TO(s,e?.customHeaderMap);return Object.entries(n).reduce((r,[l,c])=>{const h=Ob(c,{whitespace:!1});return h&&(r[l]=h),r},t)}function jO(i,e,t){return Lt(i,MO(e,t))}const FO="CMCD";function BO(i,e={}){return i?Ob(Ub(i,e),{whitespace:!1}):""}function VO(i,e={}){if(!i)return"";const t=BO(i,e);return encodeURIComponent(t)}function $O(i,e={}){if(!i)return"";const t=VO(i,e);return`${FO}=${t}`}const cx=/CMCD=[^&#]+/;function GO(i,e,t){const s=$O(e,t);if(!s)return i;if(cx.test(i))return i.replace(cx,s);const n=i.includes("?")?"&":"?";return`${i}${n}${s}`}class HO{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=n=>{try{this.apply(n,{ot:Qs.MANIFEST,su:!this.initialized})}catch(r){this.hls.logger.warn("Could not generate manifest CMCD data.",r)}},this.applyFragmentData=n=>{try{const{frag:r,part:l}=n,c=this.hls.levels[r.level],h=this.getObjectType(r),u={d:(l||r).duration*1e3,ot:h};(h===Qs.VIDEO||h===Qs.AUDIO||h==Qs.MUXED)&&(u.br=c.bitrate/1e3,u.tb=this.getTopBandwidth(h)/1e3,u.bl=this.getBufferLength(h));const f=l?this.getNextPart(l):this.getNextFrag(r);f!=null&&f.url&&f.url!==r.url&&(u.nor=f.url),this.apply(n,u)}catch(r){this.hls.logger.warn("Could not generate segment CMCD data.",r)}},this.hls=e;const t=this.config=e.config,{cmcd:s}=t;s!=null&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=s.sessionId||e.sessionId,this.cid=s.contentId,this.useHeaders=s.useHeaders===!0,this.includeKeys=s.includeKeys,this.registerListeners())}registerListeners(){const e=this.hls;e.on(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(L.MEDIA_DETACHED,this.onMediaDetached,this),e.on(L.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(L.MEDIA_DETACHED,this.onMediaDetached,this),e.off(L.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var s,n;this.audioBuffer=(s=t.tracks.audio)==null?void 0:s.buffer,this.videoBuffer=(n=t.tracks.video)==null?void 0:n.buffer}createData(){var e;return{v:1,sf:XC.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)==null?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){Lt(t,this.createData());const s=t.ot===Qs.INIT||t.ot===Qs.VIDEO||t.ot===Qs.MUXED;this.starved&&s&&(t.bs=!0,t.su=!0,this.starved=!1),t.su==null&&(t.su=this.buffering);const{includeKeys:n}=this;n&&(t=Object.keys(t).reduce((l,c)=>(n.includes(c)&&(l[c]=t[c]),l),{}));const r={baseUrl:e.url};this.useHeaders?(e.headers||(e.headers={}),jO(e.headers,t,r)):e.url=GO(e.url,t,r)}getNextFrag(e){var t;const s=(t=this.hls.levels[e.level])==null?void 0:t.details;if(s){const n=e.sn-s.startSN;return s.fragments[n+1]}}getNextPart(e){var t;const{index:s,fragment:n}=e,r=(t=this.hls.levels[n.level])==null||(t=t.details)==null?void 0:t.partList;if(r){const{sn:l}=n;for(let c=r.length-1;c>=0;c--){const h=r[c];if(h.index===s&&h.fragment.sn===l)return r[c+1]}}}getObjectType(e){const{type:t}=e;if(t==="subtitle")return Qs.TIMED_TEXT;if(e.sn==="initSegment")return Qs.INIT;if(t==="audio")return Qs.AUDIO;if(t==="main")return this.hls.audioTracks.length?Qs.VIDEO:Qs.MUXED}getTopBandwidth(e){let t=0,s;const n=this.hls;if(e===Qs.AUDIO)s=n.audioTracks;else{const r=n.maxAutoLevel,l=r>-1?r+1:n.levels.length;s=n.levels.slice(0,l)}return s.forEach(r=>{r.bitrate>t&&(t=r.bitrate)}),t>0?t:NaN}getBufferLength(e){const t=this.media,s=e===Qs.AUDIO?this.audioBuffer:this.videoBuffer;return!s||!t?NaN:qe.bufferInfo(s,t.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){const{pLoader:e}=this.config,t=this.applyPlaylistData,s=e||this.config.loader;return class{constructor(r){this.loader=void 0,this.loader=new s(r)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(r,l,c){t(r),this.loader.load(r,l,c)}}}createFragmentLoader(){const{fLoader:e}=this.config,t=this.applyFragmentData,s=e||this.config.loader;return class{constructor(r){this.loader=void 0,this.loader=new s(r)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(r,l,c){t(r),this.loader.load(r,l,c)}}}}const zO=3e5;class KO extends Pi{constructor(e){super("content-steering",e.logger),this.hls=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this._pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(L.MANIFEST_PARSED,this.onManifestParsed,this),e.on(L.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(L.MANIFEST_PARSED,this.onManifestParsed,this),e.off(L.ERROR,this.onError,this))}pathways(){return(this.levels||[]).reduce((e,t)=>(e.indexOf(t.pathwayId)===-1&&e.push(t.pathwayId),e),[])}get pathwayPriority(){return this._pathwayPriority}set pathwayPriority(e){this.updatePathwayPriority(e)}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const e=this.timeToLoad*1e3-(performance.now()-this.updated);if(e>0){this.scheduleRefresh(this.uri,e);return}}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const t=this.levels;t&&(this.levels=t.filter(s=>s!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){const{contentSteering:s}=t;s!==null&&(this.pathwayId=s.pathwayId,this.uri=s.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){const{errorAction:s}=t;if(s?.action===Rs.SendAlternateToPenaltyBox&&s.flags===hi.MoveAllAlternatesMatchingHost){const n=this.levels;let r=this._pathwayPriority,l=this.pathwayId;if(t.context){const{groupId:c,pathwayId:h,type:u}=t.context;c&&n?l=this.getPathwayForGroupId(c,u,l):h&&(l=h)}l in this.penalizedPathways||(this.penalizedPathways[l]=performance.now()),!r&&n&&(r=this.pathways()),r&&r.length>1&&(this.updatePathwayPriority(r),s.resolved=this.pathwayId!==l),t.details===Q.BUFFER_APPEND_ERROR&&!t.fatal?s.resolved=!0:s.resolved||this.warn(`Could not resolve ${t.details} ("${t.error.message}") with content-steering for Pathway: ${l} levels: ${n&&n.length} priorities: ${Ot(r)} penalized: ${Ot(this.penalizedPathways)}`)}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(t.length===0){const s=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${s}"`),t=this.getLevelsForPathway(s),this.pathwayId=s}return t.length!==e.length&&this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t}getLevelsForPathway(e){return this.levels===null?[]:this.levels.filter(t=>e===t.pathwayId)}updatePathwayPriority(e){this._pathwayPriority=e;let t;const s=this.penalizedPathways,n=performance.now();Object.keys(s).forEach(r=>{n-s[r]>zO&&delete s[r]});for(let r=0;r<e.length;r++){const l=e[r];if(l in s)continue;if(l===this.pathwayId)return;const c=this.hls.nextLoadLevel,h=this.hls.levels[c];if(t=this.getLevelsForPathway(l),t.length>0){this.log(`Setting Pathway to "${l}"`),this.pathwayId=l,sb(t),this.hls.trigger(L.LEVELS_UPDATED,{levels:t});const u=this.hls.levels[c];h&&u&&this.levels&&(u.attrs["STABLE-VARIANT-ID"]!==h.attrs["STABLE-VARIANT-ID"]&&u.bitrate!==h.bitrate&&this.log(`Unstable Pathways change from bitrate ${h.bitrate} to ${u.bitrate}`),this.hls.nextLoadLevel=c);break}}}getPathwayForGroupId(e,t,s){const n=this.getLevelsForPathway(s).concat(this.levels||[]);for(let r=0;r<n.length;r++)if(t===nt.AUDIO_TRACK&&n[r].hasAudioGroup(e)||t===nt.SUBTITLE_TRACK&&n[r].hasSubtitleGroup(e))return n[r].pathwayId;return s}clonePathways(e){const t=this.levels;if(!t)return;const s={},n={};e.forEach(r=>{const{ID:l,"BASE-ID":c,"URI-REPLACEMENT":h}=r;if(t.some(f=>f.pathwayId===l))return;const u=this.getLevelsForPathway(c).map(f=>{const p=new $t(f.attrs);p["PATHWAY-ID"]=l;const v=p.AUDIO&&`${p.AUDIO}_clone_${l}`,x=p.SUBTITLES&&`${p.SUBTITLES}_clone_${l}`;v&&(s[p.AUDIO]=v,p.AUDIO=v),x&&(n[p.SUBTITLES]=x,p.SUBTITLES=x);const S=Mb(f.uri,p["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",h),E=new Zl({attrs:p,audioCodec:f.audioCodec,bitrate:f.bitrate,height:f.height,name:f.name,url:S,videoCodec:f.videoCodec,width:f.width});if(f.audioGroups)for(let T=1;T<f.audioGroups.length;T++)E.addGroupId("audio",`${f.audioGroups[T]}_clone_${l}`);if(f.subtitleGroups)for(let T=1;T<f.subtitleGroups.length;T++)E.addGroupId("text",`${f.subtitleGroups[T]}_clone_${l}`);return E});t.push(...u),ux(this.audioTracks,s,h,l),ux(this.subtitleTracks,n,h,l)})}loadSteeringManifest(e){const t=this.hls.config,s=t.loader;this.loader&&this.loader.destroy(),this.loader=new s(t);let n;try{n=new self.URL(e)}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${e}`);return}if(n.protocol!=="data:"){const f=(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate)|0;n.searchParams.set("_HLS_pathway",this.pathwayId),n.searchParams.set("_HLS_throughput",""+f)}const r={responseType:"json",url:n.href},l=t.steeringManifestLoadPolicy.default,c=l.errorRetry||l.timeoutRetry||{},h={loadPolicy:l,timeout:l.maxLoadTimeMs,maxRetry:c.maxNumRetry||0,retryDelay:c.retryDelayMs||0,maxRetryDelay:c.maxRetryDelayMs||0},u={onSuccess:(f,p,v,x)=>{this.log(`Loaded steering manifest: "${n}"`);const S=f.data;if(S?.VERSION!==1){this.log(`Steering VERSION ${S.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=S.TTL;const{"RELOAD-URI":E,"PATHWAY-CLONES":T,"PATHWAY-PRIORITY":A}=S;if(E)try{this.uri=new self.URL(E,n).href}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${E}`);return}this.scheduleRefresh(this.uri||v.url),T&&this.clonePathways(T);const I={steeringManifest:S,url:n.toString()};this.hls.trigger(L.STEERING_MANIFEST_LOADED,I),A&&this.updatePathwayPriority(A)},onError:(f,p,v,x)=>{if(this.log(`Error loading steering manifest: ${f.code} ${f.text} (${p.url})`),this.stopLoad(),f.code===410){this.enabled=!1,this.log(`Steering manifest ${p.url} no longer available`);return}let S=this.timeToLoad*1e3;if(f.code===429){const E=this.loader;if(typeof E?.getResponseHeader=="function"){const T=E.getResponseHeader("Retry-After");T&&(S=parseFloat(T)*1e3)}this.log(`Steering manifest ${p.url} rate limited`);return}this.scheduleRefresh(this.uri||p.url,S)},onTimeout:(f,p,v)=>{this.log(`Timeout loading steering manifest (${p.url})`),this.scheduleRefresh(this.uri||p.url)}};this.log(`Requesting steering manifest: ${n}`),this.loader.load(r,h,u)}scheduleRefresh(e,t=this.timeToLoad*1e3){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var s;const n=(s=this.hls)==null?void 0:s.media;if(n&&!n.ended){this.loadSteeringManifest(e);return}this.scheduleRefresh(e,this.timeToLoad*1e3)},t)}}function ux(i,e,t,s){i&&Object.keys(e).forEach(n=>{const r=i.filter(l=>l.groupId===n).map(l=>{const c=Lt({},l);return c.details=void 0,c.attrs=new $t(c.attrs),c.url=c.attrs.URI=Mb(l.url,l.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",t),c.groupId=c.attrs["GROUP-ID"]=e[n],c.attrs["PATHWAY-ID"]=s,c});i.push(...r)})}function Mb(i,e,t,s){const{HOST:n,PARAMS:r,[t]:l}=s;let c;e&&(c=l?.[e],c&&(i=c));const h=new self.URL(i);return n&&!c&&(h.host=n),r&&Object.keys(r).sort().forEach(u=>{u&&h.searchParams.set(u,r[u])}),h.href}class Fr extends Pi{constructor(e){super("eme",e.logger),this.hls=void 0,this.config=void 0,this.media=null,this.mediaResolved=void 0,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.mediaKeys=null,this.setMediaKeysQueue=Fr.CDMCleanupPromise?[Fr.CDMCleanupPromise]:[],this.bannedKeyIds={},this.onMediaEncrypted=t=>{const{initDataType:s,initData:n}=t,r=`"${t.type}" event: init data type: "${s}"`;if(this.debug(r),n!==null){if(!this.keyFormatPromise){let l=Object.keys(this.keySystemAccessPromises);l.length||(l=zl(this.config));const c=l.map(rf).filter(h=>!!h);this.keyFormatPromise=this.getKeyFormatPromise(c)}this.keyFormatPromise.then(l=>{const c=eu(l);if(s!=="sinf"||c!==Gt.FAIRPLAY){this.log(`Ignoring "${t.type}" event with init data type: "${s}" for selected key-system ${c}`);return}let h;try{const x=ds(new Uint8Array(n)),S=Em(JSON.parse(x).sinf),E=OS(S);if(!E)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");h=new Uint8Array(E.subarray(8,24))}catch(x){this.warn(`${r} Failed to parse sinf: ${x}`);return}const u=Ls(h),{keyIdToKeySessionPromise:f,mediaKeySessions:p}=this;let v=f[u];for(let x=0;x<p.length;x++){const S=p[x],E=S.decryptdata;if(!E.keyId)continue;const T=Ls(E.keyId);if(vu(h,E.keyId)||E.uri.replace(/-/g,"").indexOf(u)!==-1){if(v=f[T],!v)continue;if(E.pssh)break;delete f[T],E.pssh=new Uint8Array(n),E.keyId=h,v=f[u]=v.then(()=>this.generateRequestWithPreferredKeySession(S,s,n,"encrypted-event-key-match")),v.catch(A=>this.handleError(A));break}}v||this.handleError(new Error(`Key ID ${u} not encountered in playlist. Key-system sessions ${p.length}.`))}).catch(l=>this.handleError(l))}},this.onWaitingForKey=t=>{this.log(`"${t.type}" event`)},this.hls=e,this.config=e.config,this.registerListeners()}destroy(){this.onDestroying(),this.onMediaDetached();const e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onMediaEncrypted=this.onWaitingForKey=null}registerListeners(){this.hls.on(L.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(L.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(L.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(L.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.on(L.DESTROYING,this.onDestroying,this)}unregisterListeners(){this.hls.off(L.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(L.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(L.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(L.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.off(L.DESTROYING,this.onDestroying,this)}getLicenseServerUrl(e){const{drmSystems:t,widevineLicenseUrl:s}=this.config,n=t?.[e];if(n)return n.licenseUrl;if(e===Gt.WIDEVINE&&s)return s}getLicenseServerUrlOrThrow(e){const t=this.getLicenseServerUrl(e);if(t===void 0)throw new Error(`no license server URL configured for key-system "${e}"`);return t}getServerCertificateUrl(e){const{drmSystems:t}=this.config,s=t?.[e];if(s)return s.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){const t=this.hls.levels,s=(l,c,h)=>!!l&&h.indexOf(l)===c,n=t.map(l=>l.audioCodec).filter(s),r=t.map(l=>l.videoCodec).filter(s);return n.length+r.length===0&&r.push("avc1.42e01e"),new Promise((l,c)=>{const h=u=>{const f=u.shift();this.getMediaKeysPromise(f,n,r).then(p=>l({keySystem:f,mediaKeys:p})).catch(p=>{u.length?h(u):p instanceof di?c(p):c(new di({type:Fe.KEY_SYSTEM_ERROR,details:Q.KEY_SYSTEM_NO_ACCESS,error:p,fatal:!0},p.message))})};h(e)})}requestMediaKeySystemAccess(e,t){const{requestMediaKeySystemAccessFunc:s}=this.config;if(typeof s!="function"){let n=`Configured requestMediaKeySystemAccess is not a function ${s}`;return qS===null&&self.location.protocol==="http:"&&(n=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(n))}return s(e,t)}getMediaKeysPromise(e,t,s){var n;const r=_w(e,t,s,this.config.drmSystemOptions||{});let l=this.keySystemAccessPromises[e],c=(n=l)==null?void 0:n.keySystemAccess;if(!c){this.log(`Requesting encrypted media "${e}" key-system access with config: ${Ot(r)}`),c=this.requestMediaKeySystemAccess(e,r);const h=l=this.keySystemAccessPromises[e]={keySystemAccess:c};return c.catch(u=>{this.log(`Failed to obtain access to key-system "${e}": ${u}`)}),c.then(u=>{this.log(`Access for key-system "${u.keySystem}" obtained`);const f=this.fetchServerCertificate(e);this.log(`Create media-keys for "${e}"`);const p=h.mediaKeys=u.createMediaKeys().then(v=>(this.log(`Media-keys created for "${e}"`),h.hasMediaKeys=!0,f.then(x=>x?this.setMediaKeysServerCertificate(v,e,x):v)));return p.catch(v=>{this.error(`Failed to create media-keys for "${e}"}: ${v}`)}),p})}return c.then(()=>l.mediaKeys)}createMediaKeySessionContext({decryptdata:e,keySystem:t,mediaKeys:s}){this.log(`Creating key-system session "${t}" keyId: ${Ls(e.keyId||[])} keyUri: ${e.uri}`);const n=s.createSession(),r={decryptdata:e,keySystem:t,mediaKeys:s,mediaKeysSession:n,keyStatus:"status-pending"};return this.mediaKeySessions.push(r),r}renewKeySession(e){const t=e.decryptdata;if(t.pssh){const s=this.createMediaKeySessionContext(e),n=Bc(t),r="cenc";this.keyIdToKeySessionPromise[n]=this.generateRequestWithPreferredKeySession(s,r,t.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}updateKeySession(e,t){const s=e.mediaKeysSession;return this.log(`Updating key-session "${s.sessionId}" for keyId ${Ls(e.decryptdata.keyId||[])}
      } (data length: ${t.byteLength})`),s.update(t)}getSelectedKeySystemFormats(){return Object.keys(this.keySystemAccessPromises).map(e=>({keySystem:e,hasMediaKeys:this.keySystemAccessPromises[e].hasMediaKeys})).filter(({hasMediaKeys:e})=>!!e).map(({keySystem:e})=>rf(e)).filter(e=>!!e)}getKeySystemAccess(e){return this.getKeySystemSelectionPromise(e).then(({keySystem:t,mediaKeys:s})=>this.attemptSetMediaKeys(t,s))}selectKeySystem(e){return new Promise((t,s)=>{this.getKeySystemSelectionPromise(e).then(({keySystem:n})=>{const r=rf(n);r?t(r):s(new Error(`Unable to find format for key-system "${n}"`))}).catch(s)})}selectKeySystemFormat(e){const t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${t.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){const t=zl(this.config),s=e.map(eu).filter(n=>!!n&&t.indexOf(n)!==-1);return this.selectKeySystem(s)}getKeyStatus(e){const{mediaKeySessions:t}=this;for(let s=0;s<t.length;s++){const n=YO(e,t[s]);if(n)return n}}loadKey(e){const t=e.keyInfo.decryptdata,s=Bc(t),n=this.bannedKeyIds[s];if(n||this.getKeyStatus(t)==="internal-error"){const c=dx(n||"internal-error",t);return this.handleError(c,e.frag),Promise.reject(c)}const r=`(keyId: ${s} format: "${t.keyFormat}" method: ${t.method} uri: ${t.uri})`;this.log(`Starting session for key ${r}`);const l=this.keyIdToKeySessionPromise[s];if(!l){const c=this.getKeySystemForKeyPromise(t).then(({keySystem:h,mediaKeys:u})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${r}`),this.attemptSetMediaKeys(h,u).then(()=>(this.throwIfDestroyed(),this.createMediaKeySessionContext({keySystem:h,mediaKeys:u,decryptdata:t}))))).then(h=>{const u="cenc",f=t.pssh?t.pssh.buffer:null;return this.generateRequestWithPreferredKeySession(h,u,f,"playlist-key")});return c.catch(h=>this.handleError(h,e.frag)),this.keyIdToKeySessionPromise[s]=c,c}return l.catch(c=>{if(c instanceof di){const h=xt({},c.data);this.getKeyStatus(t)==="internal-error"&&(h.decryptdata=t);const u=new di(h,c.message);this.handleError(u,e.frag)}}),l}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(e,t){if(this.hls)if(e instanceof di){t&&(e.data.frag=t);const s=e.data.decryptdata;this.error(`${e.message}${s?` (${Ls(s.keyId||[])})`:""}`),this.hls.trigger(L.ERROR,e.data)}else this.error(e.message),this.hls.trigger(L.ERROR,{type:Fe.KEY_SYSTEM_ERROR,details:Q.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0})}getKeySystemForKeyPromise(e){const t=Bc(e),s=this.keyIdToKeySessionPromise[t];if(!s){const n=eu(e.keyFormat),r=n?[n]:zl(this.config);return this.attemptKeySystemAccess(r)}return s}getKeySystemSelectionPromise(e){if(e.length||(e=zl(this.config)),e.length===0)throw new di({type:Fe.KEY_SYSTEM_ERROR,details:Q.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${Ot({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}attemptSetMediaKeys(e,t){if(this.mediaResolved=void 0,this.mediaKeys===t)return Promise.resolve();const s=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);const n=Promise.all(s).then(()=>this.media?this.media.setMediaKeys(t):new Promise((r,l)=>{this.mediaResolved=()=>{if(this.mediaResolved=void 0,!this.media)return l(new Error("Attempted to set mediaKeys without media element attached"));this.mediaKeys=t,this.media.setMediaKeys(t).then(r).catch(l)}}));return this.mediaKeys=t,this.setMediaKeysQueue.push(n),n.then(()=>{this.log(`Media-keys set for "${e}"`),s.push(n),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(r=>s.indexOf(r)===-1)})}generateRequestWithPreferredKeySession(e,t,s,n){var r;const l=(r=this.config.drmSystems)==null||(r=r[e.keySystem])==null?void 0:r.generateRequest;if(l)try{const S=l.call(this.hls,t,s,e);if(!S)throw new Error("Invalid response from configured generateRequest filter");t=S.initDataType,s=S.initData?S.initData:null,e.decryptdata.pssh=s?new Uint8Array(s):null}catch(S){if(this.warn(S.message),this.hls&&this.hls.config.debug)throw S}if(s===null)return this.log(`Skipping key-session request for "${n}" (no initData)`),Promise.resolve(e);const c=Bc(e.decryptdata),h=e.decryptdata.uri;this.log(`Generating key-session request for "${n}" keyId: ${c} URI: ${h} (init data type: ${t} length: ${s.byteLength})`);const u=new Im,f=e._onmessage=S=>{const E=e.mediaKeysSession;if(!E){u.emit("error",new Error("invalid state"));return}const{messageType:T,message:A}=S;this.log(`"${T}" message event for session "${E.sessionId}" message size: ${A.byteLength}`),T==="license-request"||T==="license-renewal"?this.renewLicense(e,A).catch(I=>{u.eventNames().length?u.emit("error",I):this.handleError(I)}):T==="license-release"?e.keySystem===Gt.FAIRPLAY&&this.updateKeySession(e,Bf("acknowledged")).then(()=>this.removeSession(e)).catch(I=>this.handleError(I)):this.warn(`unhandled media key message type "${T}"`)},p=(S,E)=>{E.keyStatus=S;let T;S.startsWith("usable")?u.emit("resolved"):S==="internal-error"||S==="output-restricted"||S==="output-downscaled"?T=dx(S,E.decryptdata):S==="expired"?T=new Error(`key expired (keyId: ${c})`):S==="released"?T=new Error("key released"):S==="status-pending"||this.warn(`unhandled key status change "${S}" (keyId: ${c})`),T&&(u.eventNames().length?u.emit("error",T):this.handleError(T))},v=e._onkeystatuseschange=S=>{if(!e.mediaKeysSession){u.emit("error",new Error("invalid state"));return}const T=this.getKeyStatuses(e);if(!Object.keys(T).some(C=>T[C]!=="status-pending"))return;if(T[c]==="expired"){this.log(`Expired key ${Ot(T)} in key-session "${e.mediaKeysSession.sessionId}"`),this.renewKeySession(e);return}let I=T[c];if(I)p(I,e);else{var _;e.keyStatusTimeouts||(e.keyStatusTimeouts={}),(_=e.keyStatusTimeouts)[c]||(_[c]=self.setTimeout(()=>{if(!e.mediaKeysSession||!this.mediaKeys)return;const k=this.getKeyStatus(e.decryptdata);if(k&&k!=="status-pending")return this.log(`No status for keyId ${c} in key-session "${e.mediaKeysSession.sessionId}". Using session key-status ${k} from other session.`),p(k,e);this.log(`key status for ${c} in key-session "${e.mediaKeysSession.sessionId}" timed out after 1000ms`),I="internal-error",p(I,e)},1e3)),this.log(`No status for keyId ${c} (${Ot(T)}).`)}};Fs(e.mediaKeysSession,"message",f),Fs(e.mediaKeysSession,"keystatuseschange",v);const x=new Promise((S,E)=>{u.on("error",E),u.on("resolved",S)});return e.mediaKeysSession.generateRequest(t,s).then(()=>{this.log(`Request generated for key-session "${e.mediaKeysSession.sessionId}" keyId: ${c} URI: ${h}`)}).catch(S=>{throw new di({type:Fe.KEY_SYSTEM_ERROR,details:Q.KEY_SYSTEM_NO_SESSION,error:S,decryptdata:e.decryptdata,fatal:!1},`Error generating key-session request: ${S}`)}).then(()=>x).catch(S=>(u.removeAllListeners(),this.removeSession(e).then(()=>{throw S}))).then(()=>(u.removeAllListeners(),e))}getKeyStatuses(e){const t={};return e.mediaKeysSession.keyStatuses.forEach((s,n)=>{if(typeof n=="string"&&typeof s=="object"){const c=n;n=s,s=c}const r="buffer"in n?new Uint8Array(n.buffer,n.byteOffset,n.byteLength):new Uint8Array(n);if(e.keySystem===Gt.PLAYREADY&&r.length===16){const c=Ls(r);t[c]=s,KS(r)}const l=Ls(r);s==="internal-error"&&(this.bannedKeyIds[l]=s),this.log(`key status change "${s}" for keyStatuses keyId: ${l} key-session "${e.mediaKeysSession.sessionId}"`),t[l]=s}),t}fetchServerCertificate(e){const t=this.config,s=t.loader,n=new s(t),r=this.getServerCertificateUrl(e);return r?(this.log(`Fetching server certificate for "${e}"`),new Promise((l,c)=>{const h={responseType:"arraybuffer",url:r},u=t.certLoadPolicy.default,f={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},p={onSuccess:(v,x,S,E)=>{l(v.data)},onError:(v,x,S,E)=>{c(new di({type:Fe.KEY_SYSTEM_ERROR,details:Q.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:S,response:xt({url:h.url,data:void 0},v)},`"${e}" certificate request failed (${r}). Status: ${v.code} (${v.text})`))},onTimeout:(v,x,S)=>{c(new di({type:Fe.KEY_SYSTEM_ERROR,details:Q.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:S,response:{url:h.url,data:void 0}},`"${e}" certificate request timed out (${r})`))},onAbort:(v,x,S)=>{c(new Error("aborted"))}};n.load(h,f,p)})):Promise.resolve()}setMediaKeysServerCertificate(e,t,s){return new Promise((n,r)=>{e.setServerCertificate(s).then(l=>{this.log(`setServerCertificate ${l?"success":"not supported by CDM"} (${s.byteLength}) on "${t}"`),n(e)}).catch(l=>{r(new di({type:Fe.KEY_SYSTEM_ERROR,details:Q.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:l,fatal:!0},l.message))})})}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then(s=>this.updateKeySession(e,new Uint8Array(s)).catch(n=>{throw new di({type:Fe.KEY_SYSTEM_ERROR,details:Q.KEY_SYSTEM_SESSION_UPDATE_FAILED,decryptdata:e.decryptdata,error:n,fatal:!1},n.message)}))}unpackPlayReadyKeyMessage(e,t){const s=String.fromCharCode.apply(null,new Uint16Array(t.buffer));if(!s.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),t;const n=new DOMParser().parseFromString(s,"application/xml"),r=n.querySelectorAll("HttpHeader");if(r.length>0){let f;for(let p=0,v=r.length;p<v;p++){var l,c;f=r[p];const x=(l=f.querySelector("name"))==null?void 0:l.textContent,S=(c=f.querySelector("value"))==null?void 0:c.textContent;x&&S&&e.setRequestHeader(x,S)}}const h=n.querySelector("Challenge"),u=h?.textContent;if(!u)throw new Error("Cannot find <Challenge> in key message");return Bf(atob(u))}setupLicenseXHR(e,t,s,n){const r=this.config.licenseXhrSetup;return r?Promise.resolve().then(()=>{if(!s.decryptdata)throw new Error("Key removed");return r.call(this.hls,e,t,s,n)}).catch(l=>{if(!s.decryptdata)throw l;return e.open("POST",t,!0),r.call(this.hls,e,t,s,n)}).then(l=>(e.readyState||e.open("POST",t,!0),{xhr:e,licenseChallenge:l||n})):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:n}))}requestLicense(e,t){const s=this.config.keyLoadPolicy.default;return new Promise((n,r)=>{const l=this.getLicenseServerUrlOrThrow(e.keySystem);this.log(`Sending license request to URL: ${l}`);const c=new XMLHttpRequest;c.responseType="arraybuffer",c.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return r(new Error("invalid state"));if(c.readyState===4)if(c.status===200){this._requestLicenseFailureCount=0;let h=c.response;this.log(`License received ${h instanceof ArrayBuffer?h.byteLength:h}`);const u=this.config.licenseResponseCallback;if(u)try{h=u.call(this.hls,c,l,e)}catch(f){this.error(f)}n(h)}else{const h=s.errorRetry,u=h?h.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>u||c.status>=400&&c.status<500)r(new di({type:Fe.KEY_SYSTEM_ERROR,details:Q.KEY_SYSTEM_LICENSE_REQUEST_FAILED,decryptdata:e.decryptdata,fatal:!0,networkDetails:c,response:{url:l,data:void 0,code:c.status,text:c.statusText}},`License Request XHR failed (${l}). Status: ${c.status} (${c.statusText})`));else{const f=u-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${f} attempts left`),this.requestLicense(e,t).then(n,r)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=c,this.setupLicenseXHR(c,l,e,t).then(({xhr:h,licenseChallenge:u})=>{e.keySystem==Gt.PLAYREADY&&(u=this.unpackPlayReadyKeyMessage(h,u)),h.send(u)}).catch(r)})}onDestroying(){this.unregisterListeners(),this._clear()}onMediaAttached(e,t){if(!this.config.emeEnabled)return;const s=t.media;this.media=s,Fs(s,"encrypted",this.onMediaEncrypted),Fs(s,"waitingforkey",this.onWaitingForKey);const n=this.mediaResolved;n?n():this.mediaKeys=s.mediaKeys}onMediaDetached(){const e=this.media;e&&(Xs(e,"encrypted",this.onMediaEncrypted),Xs(e,"waitingforkey",this.onWaitingForKey),this.media=null,this.mediaKeys=null)}_clear(){var e;this._requestLicenseFailureCount=0,this.keyIdToKeySessionPromise={},this.bannedKeyIds={};const t=this.mediaResolved;if(t&&t(),!this.mediaKeys&&!this.mediaKeySessions.length)return;const s=this.media,n=this.mediaKeySessions.slice();this.mediaKeySessions=[],this.mediaKeys=null,ga.clearKeyUriToKeyIdMap();const r=n.length;Fr.CDMCleanupPromise=Promise.all(n.map(l=>this.removeSession(l)).concat((s==null||(e=s.setMediaKeys(null))==null?void 0:e.catch(l=>{this.log(`Could not clear media keys: ${l}`),this.hls&&this.hls.trigger(L.ERROR,{type:Fe.OTHER_ERROR,details:Q.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:new Error(`Could not clear media keys: ${l}`)})}))||Promise.resolve())).catch(l=>{this.log(`Could not close sessions and clear media keys: ${l}`),this.hls&&this.hls.trigger(L.ERROR,{type:Fe.OTHER_ERROR,details:Q.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close sessions and clear media keys: ${l}`)})}).then(()=>{r&&this.log("finished closing key sessions and clearing media keys")})}onManifestLoading(){this._clear()}onManifestLoaded(e,{sessionKeys:t}){if(!(!t||!this.config.emeEnabled)&&!this.keyFormatPromise){const s=t.reduce((n,r)=>(n.indexOf(r.keyFormat)===-1&&n.push(r.keyFormat),n),[]);this.log(`Selecting key-system from session-keys ${s.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(s)}}removeSession(e){const{mediaKeysSession:t,licenseXhr:s,decryptdata:n}=e;if(t){this.log(`Remove licenses and keys and close session "${t.sessionId}" keyId: ${Ls(n?.keyId||[])}`),e._onmessage&&(t.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(t.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),s&&s.readyState!==XMLHttpRequest.DONE&&s.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const r=this.mediaKeySessions.indexOf(e);r>-1&&this.mediaKeySessions.splice(r,1);const{keyStatusTimeouts:l}=e;l&&Object.keys(l).forEach(u=>self.clearTimeout(l[u]));const{drmSystemOptions:c}=this.config;return(Lw(c)?new Promise((u,f)=>{self.setTimeout(()=>f(new Error("MediaKeySession.remove() timeout")),8e3),t.remove().then(u).catch(f)}):Promise.resolve()).catch(u=>{this.log(`Could not remove session: ${u}`),this.hls&&this.hls.trigger(L.ERROR,{type:Fe.OTHER_ERROR,details:Q.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:new Error(`Could not remove session: ${u}`)})}).then(()=>t.close()).catch(u=>{this.log(`Could not close session: ${u}`),this.hls&&this.hls.trigger(L.ERROR,{type:Fe.OTHER_ERROR,details:Q.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close session: ${u}`)})})}return Promise.resolve()}}Fr.CDMCleanupPromise=void 0;function Bc(i){if(!i)throw new Error("Could not read keyId of undefined decryptdata");if(i.keyId===null)throw new Error("keyId is null");return Ls(i.keyId)}function YO(i,e){if(i.keyId&&e.mediaKeysSession.keyStatuses.has(i.keyId))return e.mediaKeysSession.keyStatuses.get(i.keyId);if(i.matches(e.decryptdata))return e.keyStatus}class di extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}function dx(i,e){const t=i==="output-restricted",s=t?Q.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:Q.KEY_SYSTEM_STATUS_INTERNAL_ERROR;return new di({type:Fe.KEY_SYSTEM_ERROR,details:s,fatal:!1,decryptdata:e},t?"HDCP level output restricted":`key status changed to "${i}"`)}class qO{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(L.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(L.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListeners(){this.hls.off(L.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(L.MEDIA_DETACHING,this.onMediaDetaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){const s=this.hls.config;if(s.capLevelOnFPSDrop){const n=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=n,n&&typeof n.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),s.fpsDroppedMonitoringPeriod)}}onMediaDetaching(){this.media=null}checkFPS(e,t,s){const n=performance.now();if(t){if(this.lastTime){const r=n-this.lastTime,l=s-this.lastDroppedFrames,c=t-this.lastDecodedFrames,h=1e3*l/r,u=this.hls;if(u.trigger(L.FPS_DROP,{currentDropped:l,currentDecoded:c,totalDroppedFrames:s}),h>0&&l>u.config.fpsDroppedMonitoringThreshold*c){let f=u.currentLevel;u.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+f),f>0&&(u.autoLevelCapping===-1||u.autoLevelCapping>=f)&&(f=f-1,u.trigger(L.FPS_DROP_LEVEL_CAPPING,{level:f,droppedLevel:u.currentLevel}),u.autoLevelCapping=f,this.streamController.nextLevelSwitch())}}this.lastTime=n,this.lastDroppedFrames=s,this.lastDecodedFrames=t}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}function jb(i,e){let t;try{t=new Event("addtrack")}catch{t=document.createEvent("Event"),t.initEvent("addtrack",!1,!1)}t.track=i,e.dispatchEvent(t)}function Fb(i,e){const t=i.mode;if(t==="disabled"&&(i.mode="hidden"),i.cues&&!i.cues.getCueById(e.id))try{if(i.addCue(e),!i.cues.getCueById(e.id))throw new Error(`addCue is failed for: ${e}`)}catch(s){St.debug(`[texttrack-utils]: ${s}`);try{const n=new self.TextTrackCue(e.startTime,e.endTime,e.text);n.id=e.id,i.addCue(n)}catch(n){St.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${n}`)}}t==="disabled"&&(i.mode=t)}function Ur(i,e){const t=i.mode;if(t==="disabled"&&(i.mode="hidden"),i.cues)for(let s=i.cues.length;s--;)e&&i.cues[s].removeEventListener("enter",e),i.removeCue(i.cues[s]);t==="disabled"&&(i.mode=t)}function Qf(i,e,t,s){const n=i.mode;if(n==="disabled"&&(i.mode="hidden"),i.cues&&i.cues.length>0){const r=WO(i.cues,e,t);for(let l=0;l<r.length;l++)(!s||s(r[l]))&&i.removeCue(r[l])}n==="disabled"&&(i.mode=n)}function QO(i,e){if(e<=i[0].startTime)return 0;const t=i.length-1;if(e>i[t].endTime)return-1;let s=0,n=t,r;for(;s<=n;)if(r=Math.floor((n+s)/2),e<i[r].startTime)n=r-1;else if(e>i[r].startTime&&s<t)s=r+1;else return r;return i[s].startTime-e<e-i[n].startTime?s:n}function WO(i,e,t){const s=[],n=QO(i,e);if(n>-1)for(let r=n,l=i.length;r<l;r++){const c=i[r];if(c.startTime>=e&&c.endTime<=t)s.push(c);else if(c.startTime>t)return s}return s}function nu(i){const e=[];for(let t=0;t<i.length;t++){const s=i[t];(s.kind==="subtitles"||s.kind==="captions")&&s.label&&e.push(i[t])}return e}class XO extends Nm{constructor(e){super(e,"subtitle-track-controller"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let t=null;const s=nu(this.media.textTracks);for(let r=0;r<s.length;r++)if(s[r].mode==="hidden")t=s[r];else if(s[r].mode==="showing"){t=s[r];break}const n=this.findTrackForTextTrack(t);this.subtitleTrack!==n&&this.setSubtitleTrack(n)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:e}=this;e.on(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.MANIFEST_PARSED,this.onManifestParsed,this),e.on(L.LEVEL_LOADING,this.onLevelLoading,this),e.on(L.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(L.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(L.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.MANIFEST_PARSED,this.onManifestParsed,this),e.off(L.LEVEL_LOADING,this.onLevelLoading,this),e.off(L.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(L.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(L.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(e,t){const s=this.media;if(!s)return;const n=!!t.transferMedia;if(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||s.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,n)return;nu(s.textTracks).forEach(l=>{Ur(l)})}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){const{id:s,groupId:n,details:r}=t,l=this.tracksInGroup[s];if(!l||l.groupId!==n){this.warn(`Subtitle track with id:${s} and group:${n} not found in active group ${l?.groupId}`);return}const c=l.details;l.details=t.details,this.log(`Subtitle track ${s} "${l.name}" lang:${l.lang} group:${n} loaded [${r.startSN}-${r.endSN}]`),s===this.trackId&&this.playlistLoaded(s,t,c)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const s=t.subtitleGroups||null,n=this.groupIds;let r=this.currentTrack;if(!s||n?.length!==s?.length||s!=null&&s.some(l=>n?.indexOf(l)===-1)){this.groupIds=s,this.trackId=-1,this.currentTrack=null;const l=this.tracks.filter(f=>!s||s.indexOf(f.groupId)!==-1);if(l.length)this.selectDefaultTrack&&!l.some(f=>f.default)&&(this.selectDefaultTrack=!1),l.forEach((f,p)=>{f.id=p});else if(!r&&!this.tracksInGroup.length)return;this.tracksInGroup=l;const c=this.hls.config.subtitlePreference;if(!r&&c){this.selectDefaultTrack=!1;const f=an(c,l);if(f>-1)r=l[f];else{const p=an(c,this.tracks);r=this.tracks[p]}}let h=this.findTrackId(r);h===-1&&r&&(h=this.findTrackId(null));const u={subtitleTracks:l};this.log(`Updating subtitle tracks, ${l.length} track(s) found in "${s?.join(",")}" group-id`),this.hls.trigger(L.SUBTITLE_TRACKS_UPDATED,u),h!==-1&&this.trackId===-1&&this.setSubtitleTrack(h)}}findTrackId(e){const t=this.tracksInGroup,s=this.selectDefaultTrack;for(let n=0;n<t.length;n++){const r=t[n];if(!(s&&!r.default||!s&&!e)&&(!e||Ga(r,e)))return n}if(e){for(let n=0;n<t.length;n++){const r=t[n];if(so(e.attrs,r.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return n}for(let n=0;n<t.length;n++){const r=t[n];if(so(e.attrs,r.attrs,["LANGUAGE"]))return n}}return-1}findTrackForTextTrack(e){if(e){const t=this.tracksInGroup;for(let s=0;s<t.length;s++){const n=t[s];if(zf(n,e))return s}}return-1}onError(e,t){t.fatal||!t.context||t.context.type===nt.SUBTITLE_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){if(e.id===-1)return this.setSubtitleTrack(-1),null;const t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){const s=this.currentTrack;if(s&&Ga(e,s))return s;const n=an(e,this.tracksInGroup);if(n>-1){const r=this.tracksInGroup[n];return this.setSubtitleTrack(n),r}else{if(s)return null;{const r=an(e,t);if(r>-1)return t[r]}}}}return null}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const s=e.id,n=e.groupId,r=this.getUrlWithDirectives(e.url,t),l=e.details,c=l?.age;this.log(`Loading subtitle ${s} "${e.name}" lang:${e.lang} group:${n}${t?.msn!==void 0?" at sn "+t.msn+" part "+t.part:""}${c&&l.live?" age "+c.toFixed(1)+(l.type&&" "+l.type||""):""} ${r}`),this.hls.trigger(L.SUBTITLE_TRACK_LOADING,{url:r,id:s,groupId:n,deliveryDirectives:t||null,track:e})}toggleTrackModes(){const{media:e}=this;if(!e)return;const t=nu(e.textTracks),s=this.currentTrack;let n;if(s&&(n=t.filter(r=>zf(s,r))[0],n||this.warn(`Unable to find subtitle TextTrack with name "${s.name}" and language "${s.lang}"`)),[].slice.call(t).forEach(r=>{r.mode!=="disabled"&&r!==n&&(r.mode="disabled")}),n){const r=this.subtitleDisplay?"showing":"hidden";n.mode!==r&&(n.mode=r)}}setSubtitleTrack(e){const t=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(e<-1||e>=t.length||!Oe(e)){this.warn(`Invalid subtitle track id: ${e}`);return}this.selectDefaultTrack=!1;const s=this.currentTrack,n=t[e]||null;if(this.trackId=e,this.currentTrack=n,this.toggleTrackModes(),!n){this.hls.trigger(L.SUBTITLE_TRACK_SWITCH,{id:e});return}const r=!!n.details&&!n.details.live;if(e===this.trackId&&n===s&&r)return;this.log(`Switching to subtitle-track ${e}`+(n?` "${n.name}" lang:${n.lang} group:${n.groupId}`:""));const{id:l,groupId:c="",name:h,type:u,url:f}=n;this.hls.trigger(L.SUBTITLE_TRACK_SWITCH,{id:l,groupId:c,name:h,type:u,url:f});const p=this.switchParams(n.url,s?.details,n.details);this.loadPlaylist(p)}}function ZO(){try{return crypto.randomUUID()}catch{try{const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}catch{let t=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,n=>{const r=(t+Math.random()*16)%16|0;return t=Math.floor(t/16),(n=="x"?r:r&3|8).toString(16)})}}}function ql(i){let e=5381,t=i.length;for(;t;)e=e*33^i.charCodeAt(--t);return(e>>>0).toString()}const Br=.025;let bu=(function(i){return i[i.Point=0]="Point",i[i.Range=1]="Range",i})({});function JO(i,e,t){return`${i.identifier}-${t+1}-${ql(e)}`}class eN{constructor(e,t){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=t,this.dateRange=e,this.setDateRange(e)}setDateRange(e){this.dateRange=e,this.resumeOffset=e.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=e.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=e.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=e.attr.enumeratedStringList("X-SNAP",this.snapOptions)}reset(){var e;this.appendInPlaceStarted=!1,(e=this.assetListLoader)==null||e.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)}isAssetPastPlayoutLimit(e){var t;if(e>0&&e>=this.assetList.length)return!0;const s=this.playoutLimit;return e<=0||isNaN(s)?!1:s===0?!0:(((t=this.assetList[e])==null?void 0:t.startOffset)||0)>s}findAssetIndex(e){return this.assetList.indexOf(e)}get identifier(){return this.dateRange.id}get startDate(){return this.dateRange.startDate}get startTime(){const e=this.dateRange.startTime;if(this.snapOptions.out){const t=this.dateRange.tagAnchor;if(t)return pf(e,t)}return e}get startOffset(){return this.cue.pre?0:this.startTime}get startIsAligned(){if(this.startTime===0||this.snapOptions.out)return!0;const e=this.dateRange.tagAnchor;if(e){const t=this.dateRange.startTime,s=pf(t,e);return t-s<.1}return!1}get resumptionOffset(){const e=this.resumeOffset,t=Oe(e)?e:this.duration;return this.cumulativeDuration+t}get resumeTime(){const e=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){const t=this.resumeAnchor;if(t)return pf(e,t)}return e}get appendInPlace(){return this.appendInPlaceStarted?!0:this.appendInPlaceDisabled?!1:!!(!this.cue.once&&!this.cue.pre&&this.startIsAligned&&(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&Math.abs(this.resumeOffset-this.duration)<Br))}set appendInPlace(e){if(this.appendInPlaceStarted){this.resetOnResume=!e;return}this.appendInPlaceDisabled=!e}get timelineStart(){return this._timelineStart!==null?this._timelineStart:this.startTime}set timelineStart(e){this._timelineStart=e}get duration(){const e=this.playoutLimit;let t;return this._duration!==null?t=this._duration:this.dateRange.duration?t=this.dateRange.duration:t=this.dateRange.plannedDuration||0,!isNaN(e)&&e<t&&(t=e),t}set duration(e){this._duration=e}get cue(){return this.dateRange.cue}get timelineOccupancy(){return this.dateRange.attr["X-TIMELINE-OCCUPIES"]==="RANGE"?bu.Range:bu.Point}get supplementsPrimary(){return this.dateRange.attr["X-TIMELINE-STYLE"]==="PRIMARY"}get contentMayVary(){return this.dateRange.attr["X-CONTENT-MAY-VARY"]!=="NO"}get assetUrl(){return this.dateRange.attr["X-ASSET-URI"]}get assetListUrl(){return this.dateRange.attr["X-ASSET-LIST"]}get baseUrl(){return this.base.url}get assetListLoaded(){return this.assetList.length>0||this.assetListResponse!==null}toString(){return tN(this)}}function pf(i,e){return i-e.start<e.duration/2&&!(Math.abs(i-(e.start+e.duration))<Br)?e.start:e.start+e.duration}function Bb(i,e,t){const s=new self.URL(i,t);return s.protocol!=="data:"&&s.searchParams.set("_HLS_primary_id",e),s}function gf(i,e){for(;(t=i.assetList[++e])!=null&&t.error;)var t;return e}function tN(i){return`["${i.identifier}" ${i.cue.pre?"<pre>":i.cue.post?"<post>":""}${i.timelineStart.toFixed(2)}-${i.resumeTime.toFixed(2)}]`}function Pr(i){const e=i.timelineStart,t=i.duration||0;return`["${i.identifier}" ${e.toFixed(2)}-${(e+t).toFixed(2)}]`}class sN{constructor(e,t,s,n){this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=()=>{this.reachedPlayout(this.currentTime)&&this.hls&&this.hls.trigger(L.PLAYOUT_LIMIT_REACHED,{})};const r=this.hls=new e(t);this.interstitial=s,this.assetItem=n;const l=()=>{this.hasDetails=!0};r.once(L.LEVEL_LOADED,l),r.once(L.AUDIO_TRACK_LOADED,l),r.once(L.SUBTITLE_TRACK_LOADED,l),r.on(L.MEDIA_ATTACHING,(c,{media:h})=>{this.removeMediaListeners(),this.mediaAttached=h,this.interstitial.playoutLimit&&(h.addEventListener("timeupdate",this.checkPlayout),this.appendInPlace&&r.on(L.BUFFER_APPENDED,()=>{const f=this.bufferedEnd;this.reachedPlayout(f)&&(this._bufferedEosTime=f,r.trigger(L.BUFFERED_TO_END,void 0))}))})}get appendInPlace(){return this.interstitial.appendInPlace}loadSource(){const e=this.hls;if(e)if(e.url)e.levels.length&&!e.started&&e.startLoad(-1,!0);else{let t=this.assetItem.uri;try{t=Bb(t,e.config.primarySessionId||"").href}catch{}e.loadSource(t)}}bufferedInPlaceToEnd(e){var t;if(!this.appendInPlace)return!1;if((t=this.hls)!=null&&t.bufferedToEnd)return!0;if(!e)return!1;const s=Math.min(this._bufferedEosTime||1/0,this.duration),n=this.timelineOffset,r=qe.bufferInfo(e,n,0);return this.getAssetTime(r.end)>=s-.02}reachedPlayout(e){const s=this.interstitial.playoutLimit;return this.startOffset+e>=s}get destroyed(){var e;return!((e=this.hls)!=null&&e.userConfig)}get assetId(){return this.assetItem.identifier}get interstitialId(){return this.assetItem.parentIdentifier}get media(){var e;return((e=this.hls)==null?void 0:e.media)||null}get bufferedEnd(){const e=this.media||this.mediaAttached;if(!e)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;const t=qe.bufferInfo(e,e.currentTime,.001);return this.getAssetTime(t.end)}get currentTime(){const e=this.media||this.mediaAttached;return e?this.getAssetTime(e.currentTime):this._currentTime||0}get duration(){const e=this.assetItem.duration;if(!e)return 0;const t=this.interstitial.playoutLimit;if(t){const s=t-this.startOffset;if(s>0&&s<e)return s}return e}get remaining(){const e=this.duration;return e?Math.max(0,e-this.currentTime):0}get startOffset(){return this.assetItem.startOffset}get timelineOffset(){var e;return((e=this.hls)==null?void 0:e.config.timelineOffset)||0}set timelineOffset(e){const t=this.timelineOffset;if(e!==t){const s=e-t;if(Math.abs(s)>1/9e4&&this.hls){if(this.hasDetails)throw new Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=e}}}getAssetTime(e){const t=this.timelineOffset,s=this.duration;return Math.min(Math.max(0,e-t),s)}removeMediaListeners(){const e=this.mediaAttached;e&&(this._currentTime=e.currentTime,this.bufferSnapShot(),e.removeEventListener("timeupdate",this.checkPlayout))}bufferSnapShot(){if(this.mediaAttached){var e;(e=this.hls)!=null&&e.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd)}}destroy(){this.removeMediaListeners(),this.hls&&this.hls.destroy(),this.hls=null,this.tracks=this.mediaAttached=this.checkPlayout=null}attachMedia(e){var t;this.loadSource(),(t=this.hls)==null||t.attachMedia(e)}detachMedia(){var e;this.removeMediaListeners(),this.mediaAttached=null,(e=this.hls)==null||e.detachMedia()}resumeBuffering(){var e;(e=this.hls)==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.hls)==null||e.pauseBuffering()}transferMedia(){var e;return this.bufferSnapShot(),((e=this.hls)==null?void 0:e.transferMedia())||null}resetDetails(){const e=this.hls;if(e&&this.hasDetails){e.stopLoad();const t=s=>delete s.details;e.levels.forEach(t),e.allAudioTracks.forEach(t),e.allSubtitleTracks.forEach(t),this.hasDetails=!1}}on(e,t,s){var n;(n=this.hls)==null||n.on(e,t)}once(e,t,s){var n;(n=this.hls)==null||n.once(e,t)}off(e,t,s){var n;(n=this.hls)==null||n.off(e,t)}toString(){var e;return`HlsAssetPlayer: ${Pr(this.assetItem)} ${(e=this.hls)==null?void 0:e.sessionId} ${this.appendInPlace?"append-in-place":""}`}}const hx=.033;class iN extends Pi{constructor(e,t){super("interstitials-sched",t),this.onScheduleUpdate=void 0,this.eventMap={},this.events=null,this.items=null,this.durations={primary:0,playout:0,integrated:0},this.onScheduleUpdate=e}destroy(){this.reset(),this.onScheduleUpdate=null}reset(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach(e=>e.reset()),this.events=this.items=null}resetErrorsInRange(e,t){return this.events?this.events.reduce((s,n)=>e<=n.startOffset&&t>n.startOffset?(delete n.error,s+1):s,0):0}get duration(){const e=this.items;return e?e[e.length-1].end:0}get length(){return this.items?this.items.length:0}getEvent(e){return e&&this.eventMap[e]||null}hasEvent(e){return e in this.eventMap}findItemIndex(e,t){if(e.event)return this.findEventIndex(e.event.identifier);let s=-1;e.nextEvent?s=this.findEventIndex(e.nextEvent.identifier)-1:e.previousEvent&&(s=this.findEventIndex(e.previousEvent.identifier)+1);const n=this.items;if(n)for(n[s]||(t===void 0&&(t=e.start),s=this.findItemIndexAtTime(t));s>=0&&(r=n[s])!=null&&r.event;){var r;s--}return s}findItemIndexAtTime(e,t){const s=this.items;if(s)for(let n=0;n<s.length;n++){let r=s[n];if(t&&t!=="primary"&&(r=r[t]),e===r.start||e>r.start&&e<r.end)return n}return-1}findJumpRestrictedIndex(e,t){const s=this.items;if(s)for(let n=e;n<=t&&s[n];n++){const r=s[n].event;if(r!=null&&r.restrictions.jump&&!r.appendInPlace)return n}return-1}findEventIndex(e){const t=this.items;if(t)for(let n=t.length;n--;){var s;if(((s=t[n].event)==null?void 0:s.identifier)===e)return n}return-1}findAssetIndex(e,t){const s=e.assetList,n=s.length;if(n>1)for(let r=0;r<n;r++){const l=s[r];if(!l.error){const c=l.timelineStart;if(t===c||t>c&&(t<c+(l.duration||0)||r===n-1))return r}}return 0}get assetIdAtEnd(){var e;const t=(e=this.items)==null||(e=e[this.length-1])==null?void 0:e.event;if(t){const s=t.assetList,n=s[s.length-1];if(n)return n.identifier}return null}parseInterstitialDateRanges(e,t){const s=e.main.details,{dateRanges:n}=s,r=this.events,l=this.parseDateRanges(n,{url:s.url},t),c=Object.keys(n),h=r?r.filter(u=>!c.includes(u.identifier)):[];l.length&&l.sort((u,f)=>{const p=u.cue.pre,v=u.cue.post,x=f.cue.pre,S=f.cue.post;if(p&&!x)return-1;if(x&&!p||v&&!S)return 1;if(S&&!v)return-1;if(!p&&!x&&!v&&!S){const E=u.startTime,T=f.startTime;if(E!==T)return E-T}return u.dateRange.tagOrder-f.dateRange.tagOrder}),this.events=l,h.forEach(u=>{this.removeEvent(u)}),this.updateSchedule(e,h)}updateSchedule(e,t=[],s=!1){const n=this.events||[];if(n.length||t.length||this.length<2){const r=this.items,l=this.parseSchedule(n,e);(s||t.length||r?.length!==l.length||l.some((h,u)=>Math.abs(h.playout.start-r[u].playout.start)>.005||Math.abs(h.playout.end-r[u].playout.end)>.005))&&(this.items=l,this.onScheduleUpdate(t,r))}}parseDateRanges(e,t,s){const n=[],r=Object.keys(e);for(let l=0;l<r.length;l++){const c=r[l],h=e[c];if(h.isInterstitial){let u=this.eventMap[c];u?u.setDateRange(h):(u=new eN(h,t),this.eventMap[c]=u,s===!1&&(u.appendInPlace=s)),n.push(u)}}return n}parseSchedule(e,t){const s=[],n=t.main.details,r=n.live?1/0:n.edge;let l=0;if(e=e.filter(h=>!h.error&&!(h.cue.once&&h.hasPlayed)),e.length){this.resolveOffsets(e,t);let h=0,u=0;if(e.forEach((f,p)=>{const v=f.cue.pre,x=f.cue.post,S=e[p-1]||null,E=f.appendInPlace,T=x?r:f.startOffset,A=f.duration,I=f.timelineOccupancy===bu.Range?A:0,_=f.resumptionOffset,C=S?.startTime===T,k=T+f.cumulativeDuration;let U=E?k+A:T+_;if(v||!x&&T<=0){const F=u;u+=I,f.timelineStart=k;const j=l;l+=A,s.push({event:f,start:k,end:U,playout:{start:j,end:l},integrated:{start:F,end:u}})}else if(T<=r){if(!C){const M=T-h;if(M>hx){const H=h,K=u;u+=M;const te=l;l+=M;const ae={previousEvent:e[p-1]||null,nextEvent:f,start:H,end:H+M,playout:{start:te,end:l},integrated:{start:K,end:u}};s.push(ae)}else M>0&&S&&(S.cumulativeDuration+=M,s[s.length-1].end=T)}x&&(U=k),f.timelineStart=k;const F=u;u+=I;const j=l;l+=A,s.push({event:f,start:k,end:U,playout:{start:j,end:l},integrated:{start:F,end:u}})}else return;const O=f.resumeTime;x||O>r?h=r:h=O}),h<r){var c;const f=h,p=u,v=r-h;u+=v;const x=l;l+=v,s.push({previousEvent:((c=s[s.length-1])==null?void 0:c.event)||null,nextEvent:null,start:h,end:f+v,playout:{start:x,end:l},integrated:{start:p,end:u}})}this.setDurations(r,l,u)}else s.push({previousEvent:null,nextEvent:null,start:0,end:r,playout:{start:0,end:r},integrated:{start:0,end:r}}),this.setDurations(r,r,r);return s}setDurations(e,t,s){this.durations={primary:e,playout:t,integrated:s}}resolveOffsets(e,t){const s=t.main.details,n=s.live?1/0:s.edge;let r=0,l=-1;e.forEach((c,h)=>{const u=c.cue.pre,f=c.cue.post,p=u?0:f?n:c.startTime;this.updateAssetDurations(c),l===p?c.cumulativeDuration=r:(r=0,l=p),!f&&c.snapOptions.in&&(c.resumeAnchor=za(null,s.fragments,c.startOffset+c.resumptionOffset,0,0)||void 0),c.appendInPlace&&!c.appendInPlaceStarted&&(this.primaryCanResumeInPlaceAt(c,t)||(c.appendInPlace=!1)),!c.appendInPlace&&h+1<e.length&&e[h+1].startTime-e[h].resumeTime<hx&&(e[h+1].appendInPlace=!1,e[h+1].appendInPlace&&this.warn(`Could not change append strategy for abutting event ${c}`));const x=Oe(c.resumeOffset)?c.resumeOffset:c.duration;r+=x})}primaryCanResumeInPlaceAt(e,t){const s=e.resumeTime,n=e.startTime+e.resumptionOffset;return Math.abs(s-n)>Br?(this.log(`"${e.identifier}" resumption ${s} not aligned with estimated timeline end ${n}`),!1):!Object.keys(t).some(l=>{const c=t[l].details,h=c.edge;if(s>=h)return this.log(`"${e.identifier}" resumption ${s} past ${l} playlist end ${h}`),!1;const u=za(null,c.fragments,s);if(!u)return this.log(`"${e.identifier}" resumption ${s} does not align with any fragments in ${l} playlist (${c.fragStart}-${c.fragmentEnd})`),!0;const f=l==="audio"?.175:0;return Math.abs(u.start-s)<Br+f||Math.abs(u.end-s)<Br+f?!1:(this.log(`"${e.identifier}" resumption ${s} not aligned with ${l} fragment bounds (${u.start}-${u.end} sn: ${u.sn} cc: ${u.cc})`),!0)})}updateAssetDurations(e){if(!e.assetListLoaded)return;const t=e.timelineStart;let s=0,n=!1,r=!1;for(let l=0;l<e.assetList.length;l++){const c=e.assetList[l],h=t+s;c.startOffset=s,c.timelineStart=h,n||(n=c.duration===null),r||(r=!!c.error);const u=c.error?0:c.duration||0;s+=u}n&&!r?e.duration=Math.max(s,e.duration):e.duration=s}removeEvent(e){e.reset(),delete this.eventMap[e.identifier]}}function $i(i){return`[${i.event?'"'+i.event.identifier+'"':"primary"}: ${i.start.toFixed(2)}-${i.end.toFixed(2)}]`}class nN{constructor(e){this.hls=void 0,this.hls=e}destroy(){this.hls=null}loadAssetList(e,t){const s=e.assetListUrl;let n;try{n=Bb(s,this.hls.sessionId,e.baseUrl)}catch(v){const x=this.assignAssetListError(e,Q.ASSET_LIST_LOAD_ERROR,v,s);this.hls.trigger(L.ERROR,x);return}t&&n.protocol!=="data:"&&n.searchParams.set("_HLS_start_offset",""+t);const r=this.hls.config,l=r.loader,c=new l(r),h={responseType:"json",url:n.href},u=r.interstitialAssetListLoadPolicy.default,f={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},p={onSuccess:(v,x,S,E)=>{const T=v.data,A=T?.ASSETS;if(!Array.isArray(A)){const I=this.assignAssetListError(e,Q.ASSET_LIST_PARSING_ERROR,new Error("Invalid interstitial asset list"),S.url,x,E);this.hls.trigger(L.ERROR,I);return}e.assetListResponse=T,this.hls.trigger(L.ASSET_LIST_LOADED,{event:e,assetListResponse:T,networkDetails:E})},onError:(v,x,S,E)=>{const T=this.assignAssetListError(e,Q.ASSET_LIST_LOAD_ERROR,new Error(`Error loading X-ASSET-LIST: HTTP status ${v.code} ${v.text} (${x.url})`),x.url,E,S);this.hls.trigger(L.ERROR,T)},onTimeout:(v,x,S)=>{const E=this.assignAssetListError(e,Q.ASSET_LIST_LOAD_TIMEOUT,new Error(`Timeout loading X-ASSET-LIST (${x.url})`),x.url,v,S);this.hls.trigger(L.ERROR,E)}};return c.load(h,f,p),this.hls.trigger(L.ASSET_LIST_LOADING,{event:e}),c}assignAssetListError(e,t,s,n,r,l){return e.error=s,{type:Fe.NETWORK_ERROR,details:t,fatal:!1,interstitial:e,url:n,error:s,networkDetails:l,stats:r}}}function fx(i){var e;i==null||(e=i.play())==null||e.catch(()=>{})}function Vc(i,e){return`[${i}] Advancing timeline position to ${e}`}class aN extends Pi{constructor(e,t){super("interstitials",e.logger),this.HlsPlayerClass=void 0,this.hls=void 0,this.assetListLoader=void 0,this.mediaSelection=null,this.altSelection=null,this.media=null,this.detachedData=null,this.requiredTracks=null,this.manager=null,this.playerQueue=[],this.bufferedPos=-1,this.timelinePos=-1,this.schedule=void 0,this.playingItem=null,this.bufferingItem=null,this.waitingItem=null,this.endedItem=null,this.playingAsset=null,this.endedAsset=null,this.bufferingAsset=null,this.shouldPlay=!1,this.onPlay=()=>{this.shouldPlay=!0},this.onPause=()=>{this.shouldPlay=!1},this.onSeeking=()=>{const s=this.currentTime;if(s===void 0||this.playbackDisabled||!this.schedule)return;const n=s-this.timelinePos;if(Math.abs(n)<1/7056e5)return;const l=n<=-.01;this.timelinePos=s,this.bufferedPos=s;const c=this.playingItem;if(!c){this.checkBuffer();return}if(l&&this.schedule.resetErrorsInRange(s,s-n)&&this.updateSchedule(!0),this.checkBuffer(),l&&s<c.start||s>=c.end){var h;const x=this.findItemIndex(c);let S=this.schedule.findItemIndexAtTime(s);if(S===-1&&(S=x+(l?-1:1),this.log(`seeked ${l?"back ":""}to position not covered by schedule ${s} (resolving from ${x} to ${S})`)),!this.isInterstitial(c)&&(h=this.media)!=null&&h.paused&&(this.shouldPlay=!1),!l&&S>x){const E=this.schedule.findJumpRestrictedIndex(x+1,S);if(E>x){this.setSchedulePosition(E);return}}this.setSchedulePosition(S);return}const u=this.playingAsset;if(!u){if(this.playingLastItem&&this.isInterstitial(c)){const x=c.event.assetList[0];x&&(this.endedItem=this.playingItem,this.playingItem=null,this.setScheduleToAssetAtTime(s,x))}return}const f=u.timelineStart,p=u.duration||0;if(l&&s<f||s>=f+p){var v;(v=c.event)!=null&&v.appendInPlace&&(this.clearAssetPlayers(c.event,c),this.flushFrontBuffer(s)),this.setScheduleToAssetAtTime(s,u)}},this.onTimeupdate=()=>{const s=this.currentTime;if(s===void 0||this.playbackDisabled)return;if(s>this.timelinePos)this.timelinePos=s,s>this.bufferedPos&&this.checkBuffer();else return;const n=this.playingItem;if(!n||this.playingLastItem)return;if(s>=n.end){this.timelinePos=n.end;const c=this.findItemIndex(n);this.setSchedulePosition(c+1)}const r=this.playingAsset;if(!r)return;const l=r.timelineStart+(r.duration||0);s>=l&&this.setScheduleToAssetAtTime(s,r)},this.onScheduleUpdate=(s,n)=>{const r=this.schedule;if(!r)return;const l=this.playingItem,c=r.events||[],h=r.items||[],u=r.durations,f=s.map(E=>E.identifier),p=!!(c.length||f.length);(p||n)&&this.log(`INTERSTITIALS_UPDATED (${c.length}): ${c}
Schedule: ${h.map(E=>$i(E))} pos: ${this.timelinePos}`),f.length&&this.log(`Removed events ${f}`);let v=null,x=null;l&&(v=this.updateItem(l,this.timelinePos),this.itemsMatch(l,v)?this.playingItem=v:this.waitingItem=this.endedItem=null),this.waitingItem=this.updateItem(this.waitingItem),this.endedItem=this.updateItem(this.endedItem);const S=this.bufferingItem;if(S&&(x=this.updateItem(S,this.bufferedPos),this.itemsMatch(S,x)?this.bufferingItem=x:S.event&&(this.bufferingItem=this.playingItem,this.clearInterstitial(S.event,null))),s.forEach(E=>{E.assetList.forEach(T=>{this.clearAssetPlayer(T.identifier,null)})}),this.playerQueue.forEach(E=>{if(E.interstitial.appendInPlace){const T=E.assetItem.timelineStart,A=E.timelineOffset-T;if(A)try{E.timelineOffset=T}catch(I){Math.abs(A)>Br&&this.warn(`${I} ("${E.assetId}" ${E.timelineOffset}->${T})`)}}}),p||n){if(this.hls.trigger(L.INTERSTITIALS_UPDATED,{events:c.slice(0),schedule:h.slice(0),durations:u,removedIds:f}),this.isInterstitial(l)&&f.includes(l.event.identifier)){this.warn(`Interstitial "${l.event.identifier}" removed while playing`),this.primaryFallback(l.event);return}l&&this.trimInPlace(v,l),S&&x!==v&&this.trimInPlace(x,S),this.checkBuffer()}},this.hls=e,this.HlsPlayerClass=t,this.assetListLoader=new nN(e),this.schedule=new iN(this.onScheduleUpdate,e.logger),this.registerListeners()}registerListeners(){const e=this.hls;e&&(e.on(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(L.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(L.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.on(L.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(L.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.on(L.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.on(L.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.on(L.BUFFER_APPENDED,this.onBufferAppended,this),e.on(L.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(L.BUFFERED_TO_END,this.onBufferedToEnd,this),e.on(L.MEDIA_ENDED,this.onMediaEnded,this),e.on(L.ERROR,this.onError,this),e.on(L.DESTROYING,this.onDestroying,this))}unregisterListeners(){const e=this.hls;e&&(e.off(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(L.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(L.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.off(L.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(L.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.off(L.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.off(L.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.off(L.BUFFER_CODECS,this.onBufferCodecs,this),e.off(L.BUFFER_APPENDED,this.onBufferAppended,this),e.off(L.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(L.BUFFERED_TO_END,this.onBufferedToEnd,this),e.off(L.MEDIA_ENDED,this.onMediaEnded,this),e.off(L.ERROR,this.onError,this),e.off(L.DESTROYING,this.onDestroying,this))}startLoad(){this.resumeBuffering()}stopLoad(){this.pauseBuffering()}resumeBuffering(){var e;(e=this.getBufferingPlayer())==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.getBufferingPlayer())==null||e.pauseBuffering()}destroy(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.schedule=this.manager=null,this.hls=this.HlsPlayerClass=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null}onDestroying(){const e=this.primaryMedia||this.media;e&&this.removeMediaListeners(e)}removeMediaListeners(e){Xs(e,"play",this.onPlay),Xs(e,"pause",this.onPause),Xs(e,"seeking",this.onSeeking),Xs(e,"timeupdate",this.onTimeupdate)}onMediaAttaching(e,t){const s=this.media=t.media;Fs(s,"seeking",this.onSeeking),Fs(s,"timeupdate",this.onTimeupdate),Fs(s,"play",this.onPlay),Fs(s,"pause",this.onPause)}onMediaAttached(e,t){const s=this.effectivePlayingItem,n=this.detachedData;if(this.detachedData=null,s===null)this.checkStart();else if(!n){this.clearScheduleState();const r=this.findItemIndex(s);this.setSchedulePosition(r)}}clearScheduleState(){this.log("clear schedule state"),this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null}onMediaDetaching(e,t){const s=!!t.transferMedia,n=this.media;if(this.media=null,!s&&(n&&this.removeMediaListeners(n),this.detachedData)){const r=this.getBufferingPlayer();r&&(this.log(`Removing schedule state for detachedData and ${r}`),this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,r.detachMedia()),this.shouldPlay=!1}}get interstitialsManager(){if(!this.hls)return null;if(this.manager)return this.manager;const e=this,t=()=>e.bufferingItem||e.waitingItem,s=p=>p&&e.getAssetPlayer(p.identifier),n=(p,v,x,S,E)=>{if(p){let T=p[v].start;const A=p.event;if(A){if(v==="playout"||A.timelineOccupancy!==bu.Point){const I=s(x);I?.interstitial===A&&(T+=I.assetItem.startOffset+I[E])}}else{const I=S==="bufferedPos"?l():e[S];T+=I-p.start}return T}return 0},r=(p,v)=>{var x;if(p!==0&&v!=="primary"&&(x=e.schedule)!=null&&x.length){var S;const E=e.schedule.findItemIndexAtTime(p),T=(S=e.schedule.items)==null?void 0:S[E];if(T){const A=T[v].start-T.start;return p+A}}return p},l=()=>{const p=e.bufferedPos;return p===Number.MAX_VALUE?c("primary"):Math.max(p,0)},c=p=>{var v,x;return(v=e.primaryDetails)!=null&&v.live?e.primaryDetails.edge:((x=e.schedule)==null?void 0:x.durations[p])||0},h=(p,v)=>{var x,S;const E=e.effectivePlayingItem;if(E!=null&&(x=E.event)!=null&&x.restrictions.skip||!e.schedule)return;e.log(`seek to ${p} "${v}"`);const T=e.effectivePlayingItem,A=e.schedule.findItemIndexAtTime(p,v),I=(S=e.schedule.items)==null?void 0:S[A],_=e.getBufferingPlayer(),C=_?.interstitial,k=C?.appendInPlace,U=T&&e.itemsMatch(T,I);if(T&&(k||U)){const O=s(e.playingAsset),F=O?.media||e.primaryMedia;if(F){const j=v==="primary"?F.currentTime:n(T,v,e.playingAsset,"timelinePos","currentTime"),M=p-j,H=(k?j:F.currentTime)+M;if(H>=0&&(!O||k||H<=O.duration)){F.currentTime=H;return}}}if(I){let O=p;if(v!=="primary"){const j=I[v].start,M=p-j;O=I.start+M}const F=!e.isInterstitial(I);if((!e.isInterstitial(T)||T.event.appendInPlace)&&(F||I.event.appendInPlace)){const j=e.media||(k?_?.media:null);j&&(j.currentTime=O)}else if(T){const j=e.findItemIndex(T);if(A>j){const H=e.schedule.findJumpRestrictedIndex(j+1,A);if(H>j){e.setSchedulePosition(H);return}}let M=0;if(F)e.timelinePos=O,e.checkBuffer();else{const H=I.event.assetList,K=p-(I[v]||I).start;for(let te=H.length;te--;){const ae=H[te];if(ae.duration&&K>=ae.startOffset&&K<ae.startOffset+ae.duration){M=te;break}}}e.setSchedulePosition(A,M)}}},u=()=>{const p=e.effectivePlayingItem;if(e.isInterstitial(p))return p;const v=t();return e.isInterstitial(v)?v:null},f={get bufferedEnd(){const p=t(),v=e.bufferingItem;if(v&&v===p){var x;return n(v,"playout",e.bufferingAsset,"bufferedPos","bufferedEnd")-v.playout.start||((x=e.bufferingAsset)==null?void 0:x.startOffset)||0}return 0},get currentTime(){const p=u(),v=e.effectivePlayingItem;return v&&v===p?n(v,"playout",e.effectivePlayingAsset,"timelinePos","currentTime")-v.playout.start:0},set currentTime(p){const v=u(),x=e.effectivePlayingItem;x&&x===v&&h(p+x.playout.start,"playout")},get duration(){const p=u();return p?p.playout.end-p.playout.start:0},get assetPlayers(){var p;const v=(p=u())==null?void 0:p.event.assetList;return v?v.map(x=>e.getAssetPlayer(x.identifier)):[]},get playingIndex(){var p;const v=(p=u())==null?void 0:p.event;return v&&e.effectivePlayingAsset?v.findAssetIndex(e.effectivePlayingAsset):-1},get scheduleItem(){return u()}};return this.manager={get events(){var p;return((p=e.schedule)==null||(p=p.events)==null?void 0:p.slice(0))||[]},get schedule(){var p;return((p=e.schedule)==null||(p=p.items)==null?void 0:p.slice(0))||[]},get interstitialPlayer(){return u()?f:null},get playerQueue(){return e.playerQueue.slice(0)},get bufferingAsset(){return e.bufferingAsset},get bufferingItem(){return t()},get bufferingIndex(){const p=t();return e.findItemIndex(p)},get playingAsset(){return e.effectivePlayingAsset},get playingItem(){return e.effectivePlayingItem},get playingIndex(){const p=e.effectivePlayingItem;return e.findItemIndex(p)},primary:{get bufferedEnd(){return l()},get currentTime(){const p=e.timelinePos;return p>0?p:0},set currentTime(p){h(p,"primary")},get duration(){return c("primary")},get seekableStart(){var p;return((p=e.primaryDetails)==null?void 0:p.fragmentStart)||0}},integrated:{get bufferedEnd(){return n(t(),"integrated",e.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return n(e.effectivePlayingItem,"integrated",e.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(p){h(p,"integrated")},get duration(){return c("integrated")},get seekableStart(){var p;return r(((p=e.primaryDetails)==null?void 0:p.fragmentStart)||0,"integrated")}},skip:()=>{const p=e.effectivePlayingItem,v=p?.event;if(v&&!v.restrictions.skip){const x=e.findItemIndex(p);if(v.appendInPlace){const S=p.playout.start+p.event.duration;h(S+.001,"playout")}else e.advanceAfterAssetEnded(v,x,1/0)}}}}get effectivePlayingItem(){return this.waitingItem||this.playingItem||this.endedItem}get effectivePlayingAsset(){return this.playingAsset||this.endedAsset}get playingLastItem(){var e;const t=this.playingItem,s=(e=this.schedule)==null?void 0:e.items;return!this.playbackStarted||!t||!s?!1:this.findItemIndex(t)===s.length-1}get playbackStarted(){return this.effectivePlayingItem!==null}get currentTime(){var e,t;if(this.mediaSelection===null)return;const s=this.waitingItem||this.playingItem;if(this.isInterstitial(s)&&!s.event.appendInPlace)return;let n=this.media;!n&&(e=this.bufferingItem)!=null&&(e=e.event)!=null&&e.appendInPlace&&(n=this.primaryMedia);const r=(t=n)==null?void 0:t.currentTime;if(!(r===void 0||!Oe(r)))return r}get primaryMedia(){var e;return this.media||((e=this.detachedData)==null?void 0:e.media)||null}isInterstitial(e){return!!(e!=null&&e.event)}retreiveMediaSource(e,t){const s=this.getAssetPlayer(e);s&&this.transferMediaFromPlayer(s,t)}transferMediaFromPlayer(e,t){const s=e.interstitial.appendInPlace,n=e.media;if(s&&n===this.primaryMedia){if(this.bufferingAsset=null,(!t||this.isInterstitial(t)&&!t.event.appendInPlace)&&t&&n){this.detachedData={media:n};return}const r=e.transferMedia();this.log(`transfer MediaSource from ${e} ${Ot(r)}`),this.detachedData=r}else t&&n&&(this.shouldPlay||(this.shouldPlay=!n.paused))}transferMediaTo(e,t){var s,n;if(e.media===t)return;let r=null;const l=this.hls,c=e!==l,h=c&&e.interstitial.appendInPlace,u=(s=this.detachedData)==null?void 0:s.mediaSource;let f;if(l.media)h&&(r=l.transferMedia(),this.detachedData=r),f="Primary";else if(u){const S=this.getBufferingPlayer();S?(r=S.transferMedia(),f=`${S}`):f="detached MediaSource"}else f="detached media";if(!r){if(u)r=this.detachedData,this.log(`using detachedData: MediaSource ${Ot(r)}`);else if(!this.detachedData||l.media===t){const S=this.playerQueue;S.length>1&&S.forEach(E=>{if(c&&E.interstitial.appendInPlace!==h){const T=E.interstitial;this.clearInterstitial(E.interstitial,null),T.appendInPlace=!1,T.appendInPlace&&this.warn(`Could not change append strategy for queued assets ${T}`)}}),this.hls.detachMedia(),this.detachedData={media:t}}}const p=r&&"mediaSource"in r&&((n=r.mediaSource)==null?void 0:n.readyState)!=="closed",v=p&&r?r:t;this.log(`${p?"transfering MediaSource":"attaching media"} to ${c?e:"Primary"} from ${f} (media.currentTime: ${t.currentTime})`);const x=this.schedule;if(v===r&&x){const S=c&&e.assetId===x.assetIdAtEnd;v.overrides={duration:x.duration,endOfStream:!c||S,cueRemoval:!c}}e.attachMedia(v)}onInterstitialCueEnter(){this.onTimeupdate()}checkStart(){const e=this.schedule,t=e?.events;if(!t||this.playbackDisabled||!this.media)return;this.bufferedPos===-1&&(this.bufferedPos=0);const s=this.timelinePos,n=this.effectivePlayingItem;if(s===-1){const r=this.hls.startPosition;if(this.log(Vc("checkStart",r)),this.timelinePos=r,t.length&&t[0].cue.pre){const l=e.findEventIndex(t[0].identifier);this.setSchedulePosition(l)}else if(r>=0||!this.primaryLive){const l=this.timelinePos=r>0?r:0,c=e.findItemIndexAtTime(l);this.setSchedulePosition(c)}}else if(n&&!this.playingItem){const r=e.findItemIndex(n);this.setSchedulePosition(r)}}advanceAssetBuffering(e,t){const s=e.event,n=s.findAssetIndex(t),r=gf(s,n);if(!s.isAssetPastPlayoutLimit(r))this.bufferedToEvent(e,r);else if(this.schedule){var l;const c=(l=this.schedule.items)==null?void 0:l[this.findItemIndex(e)+1];c&&this.bufferedToItem(c)}}advanceAfterAssetEnded(e,t,s){const n=gf(e,s);if(e.isAssetPastPlayoutLimit(n)){if(this.schedule){const r=this.schedule.items;if(r){const l=t+1,c=r.length;if(l>=c){this.setSchedulePosition(-1);return}const h=e.resumeTime;this.timelinePos<h&&(this.log(Vc("advanceAfterAssetEnded",h)),this.timelinePos=h,e.appendInPlace&&this.advanceInPlace(h),this.checkBuffer(this.bufferedPos<h)),this.setSchedulePosition(l)}}}else{if(e.appendInPlace){const r=e.assetList[n];r&&this.advanceInPlace(r.timelineStart)}this.setSchedulePosition(t,n)}}setScheduleToAssetAtTime(e,t){const s=this.schedule;if(!s)return;const n=t.parentIdentifier,r=s.getEvent(n);if(r){const l=s.findEventIndex(n),c=s.findAssetIndex(r,e);this.advanceAfterAssetEnded(r,l,c-1)}}setSchedulePosition(e,t){var s;const n=(s=this.schedule)==null?void 0:s.items;if(!n||this.playbackDisabled)return;const r=e>=0?n[e]:null;this.log(`setSchedulePosition ${e}, ${t} (${r&&$i(r)}) pos: ${this.timelinePos}`);const l=this.waitingItem||this.playingItem,c=this.playingLastItem;if(this.isInterstitial(l)){const f=l.event,p=this.playingAsset,v=p?.identifier,x=v?this.getAssetPlayer(v):null;if(x&&v&&(!this.eventItemsMatch(l,r)||t!==void 0&&v!==f.assetList[t].identifier)){var h;const S=f.findAssetIndex(p);if(this.log(`INTERSTITIAL_ASSET_ENDED ${S+1}/${f.assetList.length} ${Pr(p)}`),this.endedAsset=p,this.playingAsset=null,this.hls.trigger(L.INTERSTITIAL_ASSET_ENDED,{asset:p,assetListIndex:S,event:f,schedule:n.slice(0),scheduleIndex:e,player:x}),l!==this.playingItem){this.itemsMatch(l,this.playingItem)&&!this.playingAsset&&this.advanceAfterAssetEnded(f,this.findItemIndex(this.playingItem),S);return}this.retreiveMediaSource(v,r),x.media&&!((h=this.detachedData)!=null&&h.mediaSource)&&x.detachMedia()}if(!this.eventItemsMatch(l,r)&&(this.endedItem=l,this.playingItem=null,this.log(`INTERSTITIAL_ENDED ${f} ${$i(l)}`),f.hasPlayed=!0,this.hls.trigger(L.INTERSTITIAL_ENDED,{event:f,schedule:n.slice(0),scheduleIndex:e}),f.cue.once)){var u;this.updateSchedule();const S=(u=this.schedule)==null?void 0:u.items;if(r&&S){const E=this.findItemIndex(r);this.advanceSchedule(E,S,t,l,c)}return}}this.advanceSchedule(e,n,t,l,c)}advanceSchedule(e,t,s,n,r){const l=this.schedule;if(!l)return;const c=t[e]||null,h=this.primaryMedia,u=this.playerQueue;if(u.length&&u.forEach(f=>{const p=f.interstitial,v=l.findEventIndex(p.identifier);(v<e||v>e+1)&&this.clearInterstitial(p,c)}),this.isInterstitial(c)){this.timelinePos=Math.min(Math.max(this.timelinePos,c.start),c.end);const f=c.event;if(s===void 0){s=l.findAssetIndex(f,this.timelinePos);const S=gf(f,s-1);if(f.isAssetPastPlayoutLimit(S)||f.appendInPlace&&this.timelinePos===c.end){this.advanceAfterAssetEnded(f,e,s);return}s=S}const p=this.waitingItem;this.assetsBuffered(c,h)||this.setBufferingItem(c);let v=this.preloadAssets(f,s);if(this.eventItemsMatch(c,p||n)||(this.waitingItem=c,this.log(`INTERSTITIAL_STARTED ${$i(c)} ${f.appendInPlace?"append in place":""}`),this.hls.trigger(L.INTERSTITIAL_STARTED,{event:f,schedule:t.slice(0),scheduleIndex:e})),!f.assetListLoaded){this.log(`Waiting for ASSET-LIST to complete loading ${f}`);return}if(f.assetListLoader&&(f.assetListLoader.destroy(),f.assetListLoader=void 0),!h){this.log(`Waiting for attachMedia to start Interstitial ${f}`);return}this.waitingItem=this.endedItem=null,this.playingItem=c;const x=f.assetList[s];if(!x){this.advanceAfterAssetEnded(f,e,s||0);return}if(v||(v=this.getAssetPlayer(x.identifier)),v===null||v.destroyed){const S=f.assetList.length;this.warn(`asset ${s+1}/${S} player destroyed ${f}`),v=this.createAssetPlayer(f,x,s),v.loadSource()}if(!this.eventItemsMatch(c,this.bufferingItem)&&f.appendInPlace&&this.isAssetBuffered(x))return;this.startAssetPlayer(v,s,t,e,h),this.shouldPlay&&fx(v.media)}else c?(this.resumePrimary(c,e,n),this.shouldPlay&&fx(this.hls.media)):r&&this.isInterstitial(n)&&(this.endedItem=null,this.playingItem=n,n.event.appendInPlace||this.attachPrimary(l.durations.primary,null))}get playbackDisabled(){return this.hls.config.enableInterstitialPlayback===!1}get primaryDetails(){var e;return(e=this.mediaSelection)==null?void 0:e.main.details}get primaryLive(){var e;return!!((e=this.primaryDetails)!=null&&e.live)}resumePrimary(e,t,s){var n,r;if(this.playingItem=e,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(e),this.log(`resuming ${$i(e)}`),!((n=this.detachedData)!=null&&n.mediaSource)){let c=this.timelinePos;(c<e.start||c>=e.end)&&(c=this.getPrimaryResumption(e,t),this.log(Vc("resumePrimary",c)),this.timelinePos=c),this.attachPrimary(c,e)}if(!s)return;const l=(r=this.schedule)==null?void 0:r.items;l&&(this.log(`INTERSTITIALS_PRIMARY_RESUMED ${$i(e)}`),this.hls.trigger(L.INTERSTITIALS_PRIMARY_RESUMED,{schedule:l.slice(0),scheduleIndex:t}),this.checkBuffer())}getPrimaryResumption(e,t){const s=e.start;if(this.primaryLive){const n=this.primaryDetails;if(t===0)return this.hls.startPosition;if(n&&(s<n.fragmentStart||s>n.edge))return this.hls.liveSyncPosition||-1}return s}isAssetBuffered(e){const t=this.getAssetPlayer(e.identifier);return t!=null&&t.hls?t.hls.bufferedToEnd:qe.bufferInfo(this.primaryMedia,this.timelinePos,0).end+1>=e.timelineStart+(e.duration||0)}attachPrimary(e,t,s){t?this.setBufferingItem(t):this.bufferingItem=this.playingItem,this.bufferingAsset=null;const n=this.primaryMedia;if(!n)return;const r=this.hls;r.media?this.checkBuffer():(this.transferMediaTo(r,n),s&&this.startLoadingPrimaryAt(e,s)),s||(this.log(Vc("attachPrimary",e)),this.timelinePos=e,this.startLoadingPrimaryAt(e,s))}startLoadingPrimaryAt(e,t){var s;const n=this.hls;!n.loadingEnabled||!n.media||Math.abs((((s=n.mainForwardBufferInfo)==null?void 0:s.start)||n.media.currentTime)-e)>.5?n.startLoad(e,t):n.bufferingEnabled||n.resumeBuffering()}onManifestLoading(){var e;this.stopLoad(),(e=this.schedule)==null||e.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off(L.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on(L.BUFFER_CODECS,this.onBufferCodecs,this)}onLevelUpdated(e,t){if(t.level===-1||!this.schedule)return;const s=this.hls.levels[t.level];if(!s.details)return;const n=xt(xt({},this.mediaSelection||this.altSelection),{},{main:s});this.mediaSelection=n,this.schedule.parseInterstitialDateRanges(n,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}onAudioTrackUpdated(e,t){const s=this.hls.audioTracks[t.id],n=this.mediaSelection;if(!n){this.altSelection=xt(xt({},this.altSelection),{},{audio:s});return}const r=xt(xt({},n),{},{audio:s});this.mediaSelection=r}onSubtitleTrackUpdated(e,t){const s=this.hls.subtitleTracks[t.id],n=this.mediaSelection;if(!n){this.altSelection=xt(xt({},this.altSelection),{},{subtitles:s});return}const r=xt(xt({},n),{},{subtitles:s});this.mediaSelection=r}onAudioTrackSwitching(e,t){const s=Ty(t);this.playerQueue.forEach(({hls:n})=>n&&(n.setAudioOption(t)||n.setAudioOption(s)))}onSubtitleTrackSwitch(e,t){const s=Ty(t);this.playerQueue.forEach(({hls:n})=>n&&(n.setSubtitleOption(t)||t.id!==-1&&n.setSubtitleOption(s)))}onBufferCodecs(e,t){const s=t.tracks;s&&(this.requiredTracks=s)}onBufferAppended(e,t){this.checkBuffer()}onBufferFlushed(e,t){const s=this.playingItem;if(s&&!this.itemsMatch(s,this.bufferingItem)&&!this.isInterstitial(s)){const n=this.timelinePos;this.bufferedPos=n,this.checkBuffer()}}onBufferedToEnd(e){if(!this.schedule)return;const t=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&t){for(let n=0;n<t.length;n++){const r=t[n];if(r.cue.post){var s;const l=this.schedule.findEventIndex(r.identifier),c=(s=this.schedule.items)==null?void 0:s[l];this.isInterstitial(c)&&this.eventItemsMatch(c,this.bufferingItem)&&this.bufferedToItem(c,0);break}}this.bufferedPos=Number.MAX_VALUE}}onMediaEnded(e){const t=this.playingItem;if(!this.playingLastItem&&t){const s=this.findItemIndex(t);this.setSchedulePosition(s+1)}else this.shouldPlay=!1}updateItem(e,t){var s;const n=(s=this.schedule)==null?void 0:s.items;if(e&&n){const r=this.findItemIndex(e,t);return n[r]||null}return null}trimInPlace(e,t){if(this.isInterstitial(e)&&e.event.appendInPlace&&t.end-e.end>.25){e.event.assetList.forEach((r,l)=>{e.event.isAssetPastPlayoutLimit(l)&&this.clearAssetPlayer(r.identifier,null)});const s=e.end+.25,n=qe.bufferInfo(this.primaryMedia,s,0);(n.end>s||(n.nextStart||0)>s)&&(this.log(`trim buffered interstitial ${$i(e)} (was ${$i(t)})`),this.attachPrimary(s,null,!0),this.flushFrontBuffer(s))}}itemsMatch(e,t){return!!t&&(e===t||e.event&&t.event&&this.eventItemsMatch(e,t)||!e.event&&!t.event&&this.findItemIndex(e)===this.findItemIndex(t))}eventItemsMatch(e,t){var s;return!!t&&(e===t||e.event.identifier===((s=t.event)==null?void 0:s.identifier))}findItemIndex(e,t){return e&&this.schedule?this.schedule.findItemIndex(e,t):-1}updateSchedule(e=!1){var t;const s=this.mediaSelection;s&&((t=this.schedule)==null||t.updateSchedule(s,[],e))}checkBuffer(e){var t;const s=(t=this.schedule)==null?void 0:t.items;if(!s)return;const n=qe.bufferInfo(this.primaryMedia,this.timelinePos,0);e&&(this.bufferedPos=this.timelinePos),e||(e=n.len<1),this.updateBufferedPos(n.end,s,e)}updateBufferedPos(e,t,s){const n=this.schedule,r=this.bufferingItem;if(this.bufferedPos>e||!n)return;if(t.length===1&&this.itemsMatch(t[0],r)){this.bufferedPos=e;return}const l=this.playingItem,c=this.findItemIndex(l);let h=n.findItemIndexAtTime(e);if(this.bufferedPos<e){var u;const f=this.findItemIndex(r),p=Math.min(f+1,t.length-1),v=t[p];if((h===-1&&r&&e>=r.end||(u=v.event)!=null&&u.appendInPlace&&e+.01>=v.start)&&(h=p),this.isInterstitial(r)){const x=r.event;if(p-c>1&&x.appendInPlace===!1||x.assetList.length===0&&x.assetListLoader)return}if(this.bufferedPos=e,h>f&&h>c)this.bufferedToItem(v);else{const x=this.primaryDetails;this.primaryLive&&x&&e>x.edge-x.targetduration&&v.start<x.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(v)&&this.preloadAssets(v.event,0)}}else s&&l&&!this.itemsMatch(l,r)&&(h===c?this.bufferedToItem(l):h===c+1&&this.bufferedToItem(t[h]))}assetsBuffered(e,t){return e.event.assetList.length===0?!1:!e.event.assetList.some(n=>{const r=this.getAssetPlayer(n.identifier);return!(r!=null&&r.bufferedInPlaceToEnd(t))})}setBufferingItem(e){const t=this.bufferingItem,s=this.schedule;if(!this.itemsMatch(e,t)&&s){const{items:n,events:r}=s;if(!n||!r)return t;const l=this.isInterstitial(e),c=this.getBufferingPlayer();this.bufferingItem=e,this.bufferedPos=Math.max(e.start,Math.min(e.end,this.timelinePos));const h=c?c.remaining:t?t.end-this.timelinePos:0;if(this.log(`INTERSTITIALS_BUFFERED_TO_BOUNDARY ${$i(e)}`+(t?` (${h.toFixed(2)} remaining)`:"")),!this.playbackDisabled)if(l){const u=s.findAssetIndex(e.event,this.bufferedPos);e.event.assetList.forEach((f,p)=>{const v=this.getAssetPlayer(f.identifier);v&&(p===u&&v.loadSource(),v.resumeBuffering())})}else this.hls.resumeBuffering(),this.playerQueue.forEach(u=>u.pauseBuffering());this.hls.trigger(L.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:r.slice(0),schedule:n.slice(0),bufferingIndex:this.findItemIndex(e),playingIndex:this.findItemIndex(this.playingItem)})}else this.bufferingItem!==e&&(this.bufferingItem=e);return t}bufferedToItem(e,t=0){const s=this.setBufferingItem(e);if(!this.playbackDisabled){if(this.isInterstitial(e))this.bufferedToEvent(e,t);else if(s!==null){this.bufferingAsset=null;const n=this.detachedData;n?n.mediaSource?this.attachPrimary(e.start,e,!0):this.preloadPrimary(e):this.preloadPrimary(e)}}}preloadPrimary(e){const t=this.findItemIndex(e),s=this.getPrimaryResumption(e,t);this.startLoadingPrimaryAt(s)}bufferedToEvent(e,t){const s=e.event,n=s.assetList.length===0&&!s.assetListLoader,r=s.cue.once;if(n||!r){const l=this.preloadAssets(s,t);if(l!=null&&l.interstitial.appendInPlace){const c=this.primaryMedia;c&&this.bufferAssetPlayer(l,c)}}}preloadAssets(e,t){const s=e.assetUrl,n=e.assetList.length,r=n===0&&!e.assetListLoader,l=e.cue.once;if(r){const h=e.timelineStart;if(e.appendInPlace){var c;const v=this.playingItem;!this.isInterstitial(v)&&(v==null||(c=v.nextEvent)==null?void 0:c.identifier)===e.identifier&&this.flushFrontBuffer(h+.25)}let u,f=0;if(!this.playingItem&&this.primaryLive&&(f=this.hls.startPosition,f===-1&&(f=this.hls.liveSyncPosition||0)),f&&!(e.cue.pre||e.cue.post)){const v=f-h;v>0&&(u=Math.round(v*1e3)/1e3)}if(this.log(`Load interstitial asset ${t+1}/${s?1:n} ${e}${u?` live-start: ${f} start-offset: ${u}`:""}`),s)return this.createAsset(e,0,0,h,e.duration,s);const p=this.assetListLoader.loadAssetList(e,u);p&&(e.assetListLoader=p)}else if(!l&&n){for(let u=t;u<n;u++){const f=e.assetList[u],p=this.getAssetPlayerQueueIndex(f.identifier);(p===-1||this.playerQueue[p].destroyed)&&!f.error&&this.createAssetPlayer(e,f,u)}const h=e.assetList[t];if(h){const u=this.getAssetPlayer(h.identifier);return u&&u.loadSource(),u}}return null}flushFrontBuffer(e){const t=this.requiredTracks;if(!t)return;this.log(`Removing front buffer starting at ${e}`),Object.keys(t).forEach(n=>{this.hls.trigger(L.BUFFER_FLUSHING,{startOffset:e,endOffset:1/0,type:n})})}getAssetPlayerQueueIndex(e){const t=this.playerQueue;for(let s=0;s<t.length;s++)if(e===t[s].assetId)return s;return-1}getAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);return this.playerQueue[t]||null}getBufferingPlayer(){const{playerQueue:e,primaryMedia:t}=this;if(t){for(let s=0;s<e.length;s++)if(e[s].media===t)return e[s]}return null}createAsset(e,t,s,n,r,l){const c={parentIdentifier:e.identifier,identifier:JO(e,l,t),duration:r,startOffset:s,timelineStart:n,uri:l};return this.createAssetPlayer(e,c,t)}createAssetPlayer(e,t,s){const n=this.hls,r=n.userConfig;let l=r.videoPreference;const c=n.loadLevelObj||n.levels[n.currentLevel];(l||c)&&(l=Lt({},l),c.videoCodec&&(l.videoCodec=c.videoCodec),c.videoRange&&(l.allowedVideoRanges=[c.videoRange]));const h=n.audioTracks[n.audioTrack],u=n.subtitleTracks[n.subtitleTrack];let f=0;if(this.primaryLive||e.appendInPlace){const C=this.timelinePos-t.timelineStart;if(C>1){const k=t.duration;k&&C<k&&(f=C)}}const p=t.identifier,v=xt(xt({},r),{},{maxMaxBufferLength:Math.min(180,n.config.maxMaxBufferLength),autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:n.sessionId,assetPlayerId:p,abrEwmaDefaultEstimate:n.bandwidthEstimate,interstitialsController:void 0,startPosition:f,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:l,audioPreference:h||r.audioPreference,subtitlePreference:u||r.subtitlePreference});e.appendInPlace&&(e.appendInPlaceStarted=!0,t.timelineStart&&(v.timelineOffset=t.timelineStart));const x=v.cmcd;x!=null&&x.sessionId&&x.contentId&&(v.cmcd=Lt({},x,{contentId:ql(t.uri)})),this.getAssetPlayer(p)&&this.warn(`Duplicate date range identifier ${e} and asset ${p}`);const S=new sN(this.HlsPlayerClass,v,e,t);this.playerQueue.push(S),e.assetList[s]=t;let E=!0;const T=C=>{if(C.live){var k;const F=new Error(`Interstitials MUST be VOD assets ${e}`),j={fatal:!0,type:Fe.OTHER_ERROR,details:Q.INTERSTITIAL_ASSET_ITEM_ERROR,error:F},M=((k=this.schedule)==null?void 0:k.findEventIndex(e.identifier))||-1;this.handleAssetItemError(j,e,M,s,F.message);return}const U=C.edge-C.fragmentStart,O=t.duration;(E||O===null||U>O)&&(E=!1,this.log(`Interstitial asset "${p}" duration change ${O} > ${U}`),t.duration=U,this.updateSchedule())};S.on(L.LEVEL_UPDATED,(C,{details:k})=>T(k)),S.on(L.LEVEL_PTS_UPDATED,(C,{details:k})=>T(k)),S.on(L.EVENT_CUE_ENTER,()=>this.onInterstitialCueEnter());const A=(C,k)=>{const U=this.getAssetPlayer(p);if(U&&k.tracks){U.off(L.BUFFER_CODECS,A),U.tracks=k.tracks;const O=this.primaryMedia;this.bufferingAsset===U.assetItem&&O&&!U.media&&this.bufferAssetPlayer(U,O)}};S.on(L.BUFFER_CODECS,A);const I=()=>{var C;const k=this.getAssetPlayer(p);if(this.log(`buffered to end of asset ${k}`),!k||!this.schedule)return;const U=this.schedule.findEventIndex(e.identifier),O=(C=this.schedule.items)==null?void 0:C[U];this.isInterstitial(O)&&this.advanceAssetBuffering(O,t)};S.on(L.BUFFERED_TO_END,I);const _=C=>()=>{if(!this.getAssetPlayer(p)||!this.schedule)return;this.shouldPlay=!0;const U=this.schedule.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,U,C)};return S.once(L.MEDIA_ENDED,_(s)),S.once(L.PLAYOUT_LIMIT_REACHED,_(1/0)),S.on(L.ERROR,(C,k)=>{if(!this.schedule)return;const U=this.getAssetPlayer(p);if(k.details===Q.BUFFER_STALLED_ERROR){if(U!=null&&U.appendInPlace){this.handleInPlaceStall(e);return}this.onTimeupdate(),this.checkBuffer(!0);return}this.handleAssetItemError(k,e,this.schedule.findEventIndex(e.identifier),s,`Asset player error ${k.error} ${e}`)}),S.on(L.DESTROYING,()=>{if(!this.getAssetPlayer(p)||!this.schedule)return;const k=new Error(`Asset player destroyed unexpectedly ${p}`),U={fatal:!0,type:Fe.OTHER_ERROR,details:Q.INTERSTITIAL_ASSET_ITEM_ERROR,error:k};this.handleAssetItemError(U,e,this.schedule.findEventIndex(e.identifier),s,k.message)}),this.log(`INTERSTITIAL_ASSET_PLAYER_CREATED ${Pr(t)}`),this.hls.trigger(L.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:t,assetListIndex:s,event:e,player:S}),S}clearInterstitial(e,t){this.clearAssetPlayers(e,t),e.reset()}clearAssetPlayers(e,t){e.assetList.forEach(s=>{this.clearAssetPlayer(s.identifier,t)})}resetAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);if(t!==-1){this.log(`reset asset player "${e}" after error`);const s=this.playerQueue[t];this.transferMediaFromPlayer(s,null),s.resetDetails()}}clearAssetPlayer(e,t){const s=this.getAssetPlayerQueueIndex(e);if(s!==-1){const n=this.playerQueue[s];this.log(`clear ${n} toSegment: ${t&&$i(t)}`),this.transferMediaFromPlayer(n,t),this.playerQueue.splice(s,1),n.destroy()}}emptyPlayerQueue(){let e;for(;e=this.playerQueue.pop();)e.destroy();this.playerQueue=[]}startAssetPlayer(e,t,s,n,r){const{interstitial:l,assetItem:c,assetId:h}=e,u=l.assetList.length,f=this.playingAsset;this.endedAsset=null,this.playingAsset=c,(!f||f.identifier!==h)&&(f&&(this.clearAssetPlayer(f.identifier,s[n]),delete f.error),this.log(`INTERSTITIAL_ASSET_STARTED ${t+1}/${u} ${Pr(c)}`),this.hls.trigger(L.INTERSTITIAL_ASSET_STARTED,{asset:c,assetListIndex:t,event:l,schedule:s.slice(0),scheduleIndex:n,player:e})),this.bufferAssetPlayer(e,r)}bufferAssetPlayer(e,t){var s,n;if(!this.schedule)return;const{interstitial:r,assetItem:l}=e,c=this.schedule.findEventIndex(r.identifier),h=(s=this.schedule.items)==null?void 0:s[c];if(!h)return;e.loadSource(),this.setBufferingItem(h),this.bufferingAsset=l;const u=this.getBufferingPlayer();if(u===e)return;const f=r.appendInPlace;if(f&&u?.interstitial.appendInPlace===!1)return;const p=u?.tracks||((n=this.detachedData)==null?void 0:n.tracks)||this.requiredTracks;if(f&&l!==this.playingAsset){if(!e.tracks){this.log(`Waiting for track info before buffering ${e}`);return}if(p&&!TS(p,e.tracks)){const v=new Error(`Asset ${Pr(l)} SourceBuffer tracks ('${Object.keys(e.tracks)}') are not compatible with primary content tracks ('${Object.keys(p)}')`),x={fatal:!0,type:Fe.OTHER_ERROR,details:Q.INTERSTITIAL_ASSET_ITEM_ERROR,error:v},S=r.findAssetIndex(l);this.handleAssetItemError(x,r,c,S,v.message);return}}this.transferMediaTo(e,t)}handleInPlaceStall(e){const t=this.schedule,s=this.primaryMedia;if(!t||!s)return;const n=s.currentTime,r=t.findAssetIndex(e,n),l=e.assetList[r];if(l){const c=this.getAssetPlayer(l.identifier);if(c){const h=c.currentTime||n-l.timelineStart,u=c.duration-h;if(this.warn(`Stalled at ${h} of ${h+u} in ${c} ${e} (media.currentTime: ${n})`),h&&(u/s.playbackRate<.5||c.bufferedInPlaceToEnd(s))&&c.hls){const f=t.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,f,r)}}}}advanceInPlace(e){const t=this.primaryMedia;t&&t.currentTime<e&&(t.currentTime=e)}handleAssetItemError(e,t,s,n,r){if(e.details===Q.BUFFER_STALLED_ERROR)return;const l=t.assetList[n]||null;if(this.warn(`INTERSTITIAL_ASSET_ERROR ${l&&Pr(l)} ${e.error}`),!this.schedule)return;const c=l?.identifier||"",h=this.getAssetPlayerQueueIndex(c),u=this.playerQueue[h]||null,f=this.schedule.items,p=Lt({},e,{fatal:!1,errorAction:Mr(!0),asset:l,assetListIndex:n,event:t,schedule:f,scheduleIndex:s,player:u});if(this.hls.trigger(L.INTERSTITIAL_ASSET_ERROR,p),!e.fatal)return;const v=this.playingAsset,x=this.bufferingAsset,S=new Error(r);if(l&&(this.clearAssetPlayer(c,null),l.error=S),!t.assetList.some(E=>!E.error))t.error=S;else for(let E=n;E<t.assetList.length;E++)this.resetAssetPlayer(t.assetList[E].identifier);this.updateSchedule(!0),t.error?this.primaryFallback(t):v&&v.identifier===c?this.advanceAfterAssetEnded(t,s,n):x&&x.identifier===c&&this.isInterstitial(this.bufferingItem)&&this.advanceAssetBuffering(this.bufferingItem,x)}primaryFallback(e){const t=e.timelineStart,s=this.effectivePlayingItem;let n=this.timelinePos;if(s){this.log(`Fallback to primary from event "${e.identifier}" start: ${t} pos: ${n} playing: ${$i(s)} error: ${e.error}`),n===-1&&(n=this.hls.startPosition);const l=this.updateItem(s,n);this.itemsMatch(s,l)&&this.clearInterstitial(e,null),e.appendInPlace&&(this.attachPrimary(t,null),this.flushFrontBuffer(t))}else if(n===-1){this.checkStart();return}if(!this.schedule)return;const r=this.schedule.findItemIndexAtTime(n);this.setSchedulePosition(r)}onAssetListLoaded(e,t){var s,n;const r=t.event,l=r.identifier,c=t.assetListResponse.ASSETS;if(!((s=this.schedule)!=null&&s.hasEvent(l)))return;const h=r.timelineStart,u=r.duration;let f=0;c.forEach((E,T)=>{const A=parseFloat(E.DURATION);this.createAsset(r,T,f,h+f,A,E.URI),f+=A}),r.duration=f,this.log(`Loaded asset-list with duration: ${f} (was: ${u}) ${r}`);const p=this.waitingItem,v=p?.event.identifier===l;this.updateSchedule();const x=(n=this.bufferingItem)==null?void 0:n.event;if(v){var S;const E=this.schedule.findEventIndex(l),T=(S=this.schedule.items)==null?void 0:S[E];if(T){if(!this.playingItem&&this.timelinePos>T.end&&this.schedule.findItemIndexAtTime(this.timelinePos)!==E){r.error=new Error(`Interstitial ${c.length?"no longer within playback range":"asset-list is empty"} ${this.timelinePos} ${r}`),this.log(r.error.message),this.updateSchedule(!0),this.primaryFallback(r);return}this.setBufferingItem(T)}this.setSchedulePosition(E)}else if(x?.identifier===l){const E=r.assetList[0];if(E){const T=this.getAssetPlayer(E.identifier);if(x.appendInPlace){const A=this.primaryMedia;T&&A&&this.bufferAssetPlayer(T,A)}else T&&T.loadSource()}}}onError(e,t){if(this.schedule)switch(t.details){case Q.ASSET_LIST_PARSING_ERROR:case Q.ASSET_LIST_LOAD_ERROR:case Q.ASSET_LIST_LOAD_TIMEOUT:{const s=t.interstitial;s&&(this.updateSchedule(!0),this.primaryFallback(s));break}case Q.BUFFER_STALLED_ERROR:{const s=this.endedItem||this.waitingItem||this.playingItem;if(this.isInterstitial(s)&&s.event.appendInPlace){this.handleInPlaceStall(s.event);return}this.log(`Primary player stall @${this.timelinePos} bufferedPos: ${this.bufferedPos}`),this.onTimeupdate(),this.checkBuffer(!0);break}}}}const mx=500;class rN extends Am{constructor(e,t,s){super(e,t,s,"subtitle-stream-controller",ke.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(L.LEVEL_LOADED,this.onLevelLoaded,this),e.on(L.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(L.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(L.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(L.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(L.BUFFER_FLUSHING,this.onBufferFlushing,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(L.LEVEL_LOADED,this.onLevelLoaded,this),e.off(L.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(L.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(L.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(L.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(L.BUFFER_FLUSHING,this.onBufferFlushing,this)}startLoad(e,t){this.stopLoad(),this.state=ce.IDLE,this.setInterval(mx),this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}onManifestLoading(){super.onManifestLoading(),this.mainDetails=null}onMediaDetaching(e,t){this.tracksBuffered=[],super.onMediaDetaching(e,t)}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){const{frag:s,success:n}=t;if(this.fragContextChanged(s)||(es(s)&&(this.fragPrevious=s),this.state=ce.IDLE),!n)return;const r=this.tracksBuffered[this.currentTrackId];if(!r)return;let l;const c=s.start;for(let u=0;u<r.length;u++)if(c>=r[u].start&&c<=r[u].end){l=r[u];break}const h=s.start+s.duration;l?l.end=h:(l={start:c,end:h},r.push(l)),this.fragmentTracker.fragBuffered(s),this.fragBufferedComplete(s,null),this.media&&this.tick()}onBufferFlushing(e,t){const{startOffset:s,endOffset:n}=t;if(s===0&&n!==Number.POSITIVE_INFINITY){const r=n-1;if(r<=0)return;t.endOffsetSubtitles=Math.max(0,r),this.tracksBuffered.forEach(l=>{for(let c=0;c<l.length;){if(l[c].end<=r){l.shift();continue}else if(l[c].start<r)l[c].start=r;else break;c++}}),this.fragmentTracker.removeFragmentsInRange(s,r,ke.SUBTITLE)}}onError(e,t){const s=t.frag;s?.type===ke.SUBTITLE&&(t.details===Q.FRAG_GAP&&this.fragmentTracker.fragBuffered(s,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==ce.STOPPED&&(this.state=ce.IDLE))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){if(this.levels&&Ib(this.levels,t)){this.levels=t.map(s=>new Zl(s));return}this.tracksBuffered=[],this.levels=t.map(s=>{const n=new Zl(s);return this.tracksBuffered[n.id]=[],n}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,ke.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(e,t){var s;if(this.currentTrackId=t.id,!((s=this.levels)!=null&&s.length)||this.currentTrackId===-1){this.clearInterval();return}const n=this.levels[this.currentTrackId];n!=null&&n.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,n&&this.state!==ce.STOPPED&&this.setInterval(mx)}onSubtitleTrackLoaded(e,t){var s;const{currentTrackId:n,levels:r}=this,{details:l,id:c}=t;if(!r){this.warn(`Subtitle tracks were reset while loading level ${c}`);return}const h=r[c];if(c>=r.length||!h)return;this.log(`Subtitle track ${c} loaded [${l.startSN},${l.endSN}]${l.lastPartSn?`[part-${l.lastPartSn}-${l.lastPartIndex}]`:""},duration:${l.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let u=0;if(l.live||(s=h.details)!=null&&s.live){if(l.deltaUpdateFailed)return;const p=this.mainDetails;if(!p){this.startFragRequested=!1;return}const v=p.fragments[0];if(!h.details)l.hasProgramDateTime&&p.hasProgramDateTime?(xu(l,p),u=l.fragmentStart):v&&(u=v.start,$f(l,u));else{var f;u=this.alignPlaylists(l,h.details,(f=this.levelLastLoaded)==null?void 0:f.details),u===0&&v&&(u=v.start,$f(l,u))}p&&!this.startFragRequested&&this.setStartPosition(p,u)}h.details=l,this.levelLastLoaded=h,c===n&&(this.hls.trigger(L.SUBTITLE_TRACK_UPDATED,{details:l,id:c,groupId:t.groupId}),this.tick(),l.live&&!this.fragCurrent&&this.media&&this.state===ce.IDLE&&(za(null,l.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),h.details=void 0)))}_handleFragmentLoadComplete(e){const{frag:t,payload:s}=e,n=t.decryptdata,r=this.hls;if(!this.fragContextChanged(t)&&s&&s.byteLength>0&&n!=null&&n.key&&n.iv&&jr(n.method)){const l=performance.now();this.decrypter.decrypt(new Uint8Array(s),n.key.buffer,n.iv.buffer,Tm(n.method)).catch(c=>{throw r.trigger(L.ERROR,{type:Fe.MEDIA_ERROR,details:Q.FRAG_DECRYPT_ERROR,fatal:!1,error:c,reason:c.message,frag:t}),c}).then(c=>{const h=performance.now();r.trigger(L.FRAG_DECRYPTED,{frag:t,payload:c,stats:{tstart:l,tdecrypt:h}})}).catch(c=>{this.warn(`${c.name}: ${c.message}`),this.state=ce.IDLE})}}doTick(){if(!this.media){this.state=ce.IDLE;return}if(this.state===ce.IDLE){const{currentTrackId:e,levels:t}=this,s=t?.[e];if(!s||!t.length||!s.details||this.waitForLive(s))return;const{config:n}=this,r=this.getLoadPosition(),l=qe.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],r,n.maxBufferHole),{end:c,len:h}=l,u=s.details,f=this.hls.maxBufferLength+u.levelTargetDuration;if(h>f)return;const p=u.fragments,v=p.length,x=u.edge;let S=null;const E=this.fragPrevious;if(c<x){const I=n.maxFragLookUpTolerance,_=c>x-I?0:I;S=za(E,p,Math.max(p[0].start,c),_),!S&&E&&E.start<p[0].start&&(S=p[0])}else S=p[v-1];if(S=this.filterReplacedPrimary(S,s.details),!S)return;const T=S.sn-u.startSN,A=p[T-1];if(A&&A.cc===S.cc&&this.fragmentTracker.getState(A)===hs.NOT_LOADED&&(S=A),this.fragmentTracker.getState(S)===hs.NOT_LOADED){const I=this.mapToInitFragWhenRequired(S);I&&this.loadFragment(I,s,c)}}}loadFragment(e,t,s){es(e)?super.loadFragment(e,t,s):this._loadInitSegment(e,t)}get mediaBufferTimeRanges(){return new lN(this.tracksBuffered[this.currentTrackId]||[])}}class lN{constructor(e){this.buffered=void 0;const t=(s,n,r)=>{if(n=n>>>0,n>r-1)throw new DOMException(`Failed to execute '${s}' on 'TimeRanges': The index provided (${n}) is greater than the maximum bound (${r})`);return e[n][s]};this.buffered={get length(){return e.length},end(s){return t("end",s,e.length)},start(s){return t("start",s,e.length)}}}}const oN={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},Vb=i=>String.fromCharCode(oN[i]||i),Gi=15,On=100,cN={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},uN={17:2,18:4,21:6,22:8,23:10,19:13,20:15},dN={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},hN={25:2,26:4,29:6,30:8,31:10,27:13,28:15},fN=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class mN{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){const s=typeof t=="function"?t():t;St.log(`${this.time} [${e}] ${s}`)}}}const Fa=function(e){const t=[];for(let s=0;s<e.length;s++)t.push(e[s].toString(16));return t};class $b{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const t=["foreground","underline","italics","background","flash"];for(let s=0;s<t.length;s++){const n=t[s];e.hasOwnProperty(n)&&(this[n]=e[n])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class pN{constructor(){this.uchar=" ",this.penState=new $b}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}}class gN{constructor(e){this.chars=[],this.pos=0,this.currPenState=new $b,this.cueStartTime=null,this.logger=void 0;for(let t=0;t<On;t++)this.chars.push(new pN);this.logger=e}equals(e){for(let t=0;t<On;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0}copy(e){for(let t=0;t<On;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<On;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>On&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=On)}moveCursor(e){const t=this.pos+e;if(e>1)for(let s=this.pos+1;s<t+1;s++)this.chars[s].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const t=Vb(e);if(this.pos>=On){this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1)}clearFromPos(e){let t;for(t=e;t<On;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let t=!0;for(let s=0;s<On;s++){const n=this.chars[s].uchar;n!==" "&&(t=!1),e.push(n)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}class vf{constructor(e){this.rows=[],this.currRow=Gi-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let t=0;t<Gi;t++)this.rows.push(new gN(e));this.logger=e}reset(){for(let e=0;e<Gi;e++)this.rows[e].clear();this.currRow=Gi-1}equals(e){let t=!0;for(let s=0;s<Gi;s++)if(!this.rows[s].equals(e.rows[s])){t=!1;break}return t}copy(e){for(let t=0;t<Gi;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<Gi;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+Ot(e));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let c=0;c<Gi;c++)this.rows[c].clear();const r=this.currRow+1-this.nrRollUpRows,l=this.lastOutputScreen;if(l){const c=l.rows[r].cueStartTime,h=this.logger.time;if(c!==null&&h!==null&&c<h)for(let u=0;u<this.nrRollUpRows;u++)this.rows[t-this.nrRollUpRows+u+1].copy(l.rows[r+u])}}this.currRow=t;const s=this.rows[this.currRow];if(e.indent!==null){const r=e.indent,l=Math.max(r-1,0);s.setCursor(e.indent),e.color=s.chars[l].penState.foreground}const n={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(n)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+Ot(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());const e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const t=[];let s="",n=-1;for(let r=0;r<Gi;r++){const l=this.rows[r].getTextString();l&&(n=r+1,e?t.push("Row "+n+": '"+l+"'"):t.push(l.trim()))}return t.length>0&&(e?s="["+t.join(" | ")+"]":s=t.join(`
`)),s}getTextAndFormat(){return this.rows}}class px{constructor(e,t,s){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new vf(s),this.nonDisplayedMemory=new vf(s),this.lastOutputScreen=new vf(s),this.currRollUpRow=this.displayedMemory.rows[Gi-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=s}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[Gi-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let s=0;s<e.length;s++)this.writeScreen.insertChar(e[s]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>t+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const t={flash:!1};if(t.underline=e%2===1,t.italics=e>=46,t.italics)t.foreground="white";else{const s=Math.floor(e/2)-16,n=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=n[s]}this.logger.log(2,"MIDROW: "+Ot(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){const t=this.logger.time;t!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=t:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class gx{constructor(e,t,s){this.channels=void 0,this.currentChannel=0,this.cmdHistory=yN(),this.logger=void 0;const n=this.logger=new mN;this.channels=[null,new px(e,t,n),new px(e+1,s,n)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){this.logger.time=e;for(let s=0;s<t.length;s+=2){const n=t[s]&127,r=t[s+1]&127;let l=!1,c=null;if(n===0&&r===0)continue;this.logger.log(3,()=>"["+Fa([t[s],t[s+1]])+"] -> ("+Fa([n,r])+")");const h=this.cmdHistory;if(n>=16&&n<=31){if(vN(n,r,h)){$c(null,null,h),this.logger.log(3,()=>"Repeated command ("+Fa([n,r])+") is dropped");continue}$c(n,r,this.cmdHistory),l=this.parseCmd(n,r),l||(l=this.parseMidrow(n,r)),l||(l=this.parsePAC(n,r)),l||(l=this.parseBackgroundAttributes(n,r))}else $c(null,null,h);if(!l&&(c=this.parseChars(n,r),c)){const f=this.currentChannel;f&&f>0?this.channels[f].insertChars(c):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!l&&!c&&this.logger.log(2,()=>"Couldn't parse cleaned data "+Fa([n,r])+" orig: "+Fa([t[s],t[s+1]]))}}parseCmd(e,t){const s=(e===20||e===28||e===21||e===29)&&t>=32&&t<=47,n=(e===23||e===31)&&t>=33&&t<=35;if(!(s||n))return!1;const r=e===20||e===21||e===23?1:2,l=this.channels[r];return e===20||e===21||e===28||e===29?t===32?l.ccRCL():t===33?l.ccBS():t===34?l.ccAOF():t===35?l.ccAON():t===36?l.ccDER():t===37?l.ccRU(2):t===38?l.ccRU(3):t===39?l.ccRU(4):t===40?l.ccFON():t===41?l.ccRDC():t===42?l.ccTR():t===43?l.ccRTD():t===44?l.ccEDM():t===45?l.ccCR():t===46?l.ccENM():t===47&&l.ccEOC():l.ccTO(t-32),this.currentChannel=r,!0}parseMidrow(e,t){let s=0;if((e===17||e===25)&&t>=32&&t<=47){if(e===17?s=1:s=2,s!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const n=this.channels[s];return n?(n.ccMIDROW(t),this.logger.log(3,()=>"MIDROW ("+Fa([e,t])+")"),!0):!1}return!1}parsePAC(e,t){let s;const n=(e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127,r=(e===16||e===24)&&t>=64&&t<=95;if(!(n||r))return!1;const l=e<=23?1:2;t>=64&&t<=95?s=l===1?cN[e]:dN[e]:s=l===1?uN[e]:hN[e];const c=this.channels[l];return c?(c.setPAC(this.interpretPAC(s,t)),this.currentChannel=l,!0):!1}interpretPAC(e,t){let s;const n={color:null,italics:!1,indent:null,underline:!1,row:e};return t>95?s=t-96:s=t-64,n.underline=(s&1)===1,s<=13?n.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(s/2)]:s<=15?(n.italics=!0,n.color="white"):n.indent=Math.floor((s-16)/2)*4,n}parseChars(e,t){let s,n=null,r=null;if(e>=25?(s=2,r=e-8):(s=1,r=e),r>=17&&r<=19){let l;r===17?l=t+80:r===18?l=t+112:l=t+144,this.logger.log(2,()=>"Special char '"+Vb(l)+"' in channel "+s),n=[l]}else e>=32&&e<=127&&(n=t===0?[e]:[e,t]);return n&&this.logger.log(3,()=>"Char codes =  "+Fa(n).join(",")),n}parseBackgroundAttributes(e,t){const s=(e===16||e===24)&&t>=32&&t<=47,n=(e===23||e===31)&&t>=45&&t<=47;if(!(s||n))return!1;let r;const l={};e===16||e===24?(r=Math.floor((t-32)/2),l.background=fN[r],t%2===1&&(l.background=l.background+"_semi")):t===45?l.background="transparent":(l.foreground="black",t===47&&(l.underline=!0));const c=e<=23?1:2;return this.channels[c].setBkgData(l),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}$c(null,null,this.cmdHistory)}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){const s=this.channels[t];s&&s.cueSplitAtTime(e)}}}function $c(i,e,t){t.a=i,t.b=e}function vN(i,e,t){return t.a===i&&t.b===e}function yN(){return{a:null,b:null}}var Um=(function(){if(yu!=null&&yu.VTTCue)return self.VTTCue;const i=["","lr","rl"],e=["start","middle","end","left","right"];function t(c,h){if(typeof h!="string"||!Array.isArray(c))return!1;const u=h.toLowerCase();return~c.indexOf(u)?u:!1}function s(c){return t(i,c)}function n(c){return t(e,c)}function r(c,...h){let u=1;for(;u<arguments.length;u++){const f=arguments[u];for(const p in f)c[p]=f[p]}return c}function l(c,h,u){const f=this,p={enumerable:!0};f.hasBeenReset=!1;let v="",x=!1,S=c,E=h,T=u,A=null,I="",_=!0,C="auto",k="start",U=50,O="middle",F=50,j="middle";Object.defineProperty(f,"id",r({},p,{get:function(){return v},set:function(M){v=""+M}})),Object.defineProperty(f,"pauseOnExit",r({},p,{get:function(){return x},set:function(M){x=!!M}})),Object.defineProperty(f,"startTime",r({},p,{get:function(){return S},set:function(M){if(typeof M!="number")throw new TypeError("Start time must be set to a number.");S=M,this.hasBeenReset=!0}})),Object.defineProperty(f,"endTime",r({},p,{get:function(){return E},set:function(M){if(typeof M!="number")throw new TypeError("End time must be set to a number.");E=M,this.hasBeenReset=!0}})),Object.defineProperty(f,"text",r({},p,{get:function(){return T},set:function(M){T=""+M,this.hasBeenReset=!0}})),Object.defineProperty(f,"region",r({},p,{get:function(){return A},set:function(M){A=M,this.hasBeenReset=!0}})),Object.defineProperty(f,"vertical",r({},p,{get:function(){return I},set:function(M){const H=s(M);if(H===!1)throw new SyntaxError("An invalid or illegal string was specified.");I=H,this.hasBeenReset=!0}})),Object.defineProperty(f,"snapToLines",r({},p,{get:function(){return _},set:function(M){_=!!M,this.hasBeenReset=!0}})),Object.defineProperty(f,"line",r({},p,{get:function(){return C},set:function(M){if(typeof M!="number"&&M!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");C=M,this.hasBeenReset=!0}})),Object.defineProperty(f,"lineAlign",r({},p,{get:function(){return k},set:function(M){const H=n(M);if(!H)throw new SyntaxError("An invalid or illegal string was specified.");k=H,this.hasBeenReset=!0}})),Object.defineProperty(f,"position",r({},p,{get:function(){return U},set:function(M){if(M<0||M>100)throw new Error("Position must be between 0 and 100.");U=M,this.hasBeenReset=!0}})),Object.defineProperty(f,"positionAlign",r({},p,{get:function(){return O},set:function(M){const H=n(M);if(!H)throw new SyntaxError("An invalid or illegal string was specified.");O=H,this.hasBeenReset=!0}})),Object.defineProperty(f,"size",r({},p,{get:function(){return F},set:function(M){if(M<0||M>100)throw new Error("Size must be between 0 and 100.");F=M,this.hasBeenReset=!0}})),Object.defineProperty(f,"align",r({},p,{get:function(){return j},set:function(M){const H=n(M);if(!H)throw new SyntaxError("An invalid or illegal string was specified.");j=H,this.hasBeenReset=!0}})),f.displayState=void 0}return l.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},l})();class xN{decode(e,t){if(!e)return"";if(typeof e!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function Gb(i){function e(s,n,r,l){return(s|0)*3600+(n|0)*60+(r|0)+parseFloat(l||0)}const t=i.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return t?parseFloat(t[2])>59?e(t[2],t[3],0,t[4]):e(t[1],t[2],t[3],t[4]):null}class SN{constructor(){this.values=Object.create(null)}set(e,t){!this.get(e)&&t!==""&&(this.values[e]=t)}get(e,t,s){return s?this.has(e)?this.values[e]:t[s]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,s){for(let n=0;n<s.length;++n)if(t===s[n]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const s=parseFloat(t);if(s>=0&&s<=100)return this.set(e,s),!0}return!1}}function Hb(i,e,t,s){const n=s?i.split(s):[i];for(const r in n){if(typeof n[r]!="string")continue;const l=n[r].split(t);if(l.length!==2)continue;const c=l[0],h=l[1];e(c,h)}}const Wf=new Um(0,0,""),Gc=Wf.align==="middle"?"middle":"center";function bN(i,e,t){const s=i;function n(){const c=Gb(i);if(c===null)throw new Error("Malformed timestamp: "+s);return i=i.replace(/^[^\sa-zA-Z-]+/,""),c}function r(c,h){const u=new SN;Hb(c,function(v,x){let S;switch(v){case"region":for(let E=t.length-1;E>=0;E--)if(t[E].id===x){u.set(v,t[E].region);break}break;case"vertical":u.alt(v,x,["rl","lr"]);break;case"line":S=x.split(","),u.integer(v,S[0]),u.percent(v,S[0])&&u.set("snapToLines",!1),u.alt(v,S[0],["auto"]),S.length===2&&u.alt("lineAlign",S[1],["start",Gc,"end"]);break;case"position":S=x.split(","),u.percent(v,S[0]),S.length===2&&u.alt("positionAlign",S[1],["start",Gc,"end","line-left","line-right","auto"]);break;case"size":u.percent(v,x);break;case"align":u.alt(v,x,["start",Gc,"end","left","right"]);break}},/:/,/\s/),h.region=u.get("region",null),h.vertical=u.get("vertical","");let f=u.get("line","auto");f==="auto"&&Wf.line===-1&&(f=-1),h.line=f,h.lineAlign=u.get("lineAlign","start"),h.snapToLines=u.get("snapToLines",!0),h.size=u.get("size",100),h.align=u.get("align",Gc);let p=u.get("position","auto");p==="auto"&&Wf.position===50&&(p=h.align==="start"||h.align==="left"?0:h.align==="end"||h.align==="right"?100:50),h.position=p}function l(){i=i.replace(/^\s+/,"")}if(l(),e.startTime=n(),l(),i.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+s);i=i.slice(3),l(),e.endTime=n(),l(),r(i,e)}function zb(i){return i.replace(/<br(?: \/)?>/gi,`
`)}class TN{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new xN,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const t=this;e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));function s(){let r=t.buffer,l=0;for(r=zb(r);l<r.length&&r[l]!=="\r"&&r[l]!==`
`;)++l;const c=r.slice(0,l);return r[l]==="\r"&&++l,r[l]===`
`&&++l,t.buffer=r.slice(l),c}function n(r){Hb(r,function(l,c){},/:/)}try{let r="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;r=s();const c=r.match(/^()?WEBVTT([ \t].*)?$/);if(!(c!=null&&c[0]))throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let l=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(l?l=!1:r=s(),t.state){case"HEADER":/:/.test(r)?n(r):r||(t.state="ID");continue;case"NOTE":r||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(r)){t.state="NOTE";break}if(!r)continue;if(t.cue=new Um(0,0,""),t.state="CUE",r.indexOf("-->")===-1){t.cue.id=r;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{bN(r,t.cue,t.regionList)}catch{t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const c=r.indexOf("-->")!==-1;if(!r||c&&(l=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=r}continue;case"BADCUE":r||(t.state="ID")}}}catch{t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||e.state==="HEADER")&&(e.buffer+=`

`,e.parse()),e.state==="INITIAL"||e.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}}const EN=/\r\n|\n\r|\n|\r/g,yf=function(e,t,s=0){return e.slice(s,s+t.length)===t},AN=function(e){let t=parseInt(e.slice(-3));const s=parseInt(e.slice(-6,-4)),n=parseInt(e.slice(-9,-7)),r=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!Oe(t)||!Oe(s)||!Oe(n)||!Oe(r))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*s,t+=60*1e3*n,t+=3600*1e3*r,t};function Mm(i,e,t){return ql(i.toString())+ql(e.toString())+ql(t)}const IN=function(e,t,s){let n=e[t],r=e[n.prevCC];if(!r||!r.new&&n.new){e.ccOffset=e.presentationOffset=n.start,n.new=!1;return}for(;(l=r)!=null&&l.new;){var l;e.ccOffset+=n.start-r.start,n.new=!1,n=r,r=e[n.prevCC]}e.presentationOffset=s};function _N(i,e,t,s,n,r,l){const c=new TN,h=vi(new Uint8Array(i)).trim().replace(EN,`
`).split(`
`),u=[],f=e?NC(e.baseTime,e.timescale):0;let p="00:00.000",v=0,x=0,S,E=!0;c.oncue=function(T){const A=t[s];let I=t.ccOffset;const _=(v-f)/9e4;if(A!=null&&A.new&&(x!==void 0?I=t.ccOffset=A.start:IN(t,s,_)),_){if(!e){S=new Error("Missing initPTS for VTT MPEGTS");return}I=_-t.presentationOffset}const C=T.endTime-T.startTime,k=fi((T.startTime+I-x)*9e4,n*9e4)/9e4;T.startTime=Math.max(k,0),T.endTime=Math.max(k+C,0);const U=T.text.trim();T.text=decodeURIComponent(encodeURIComponent(U)),T.id||(T.id=Mm(T.startTime,T.endTime,U)),T.endTime>0&&u.push(T)},c.onparsingerror=function(T){S=T},c.onflush=function(){if(S){l(S);return}r(u)},h.forEach(T=>{if(E)if(yf(T,"X-TIMESTAMP-MAP=")){E=!1,T.slice(16).split(",").forEach(A=>{yf(A,"LOCAL:")?p=A.slice(6):yf(A,"MPEGTS:")&&(v=parseInt(A.slice(7)))});try{x=AN(p)/1e3}catch(A){S=A}return}else T===""&&(E=!1);c.parse(T+`
`)}),c.flush()}const xf="stpp.ttml.im1t",Kb=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,Yb=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,RN={left:"start",center:"center",right:"end",start:"start",end:"end"};function vx(i,e,t,s){const n=tt(new Uint8Array(i),["mdat"]);if(n.length===0){s(new Error("Could not parse IMSC1 mdat"));return}const r=n.map(c=>vi(c)),l=OC(e.baseTime,1,e.timescale);try{r.forEach(c=>t(LN(c,l)))}catch(c){s(c)}}function LN(i,e){const n=new DOMParser().parseFromString(i,"text/xml").getElementsByTagName("tt")[0];if(!n)throw new Error("Invalid ttml");const r={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},l=Object.keys(r).reduce((p,v)=>(p[v]=n.getAttribute(`ttp:${v}`)||r[v],p),{}),c=n.getAttribute("xml:space")!=="preserve",h=yx(Sf(n,"styling","style")),u=yx(Sf(n,"layout","region")),f=Sf(n,"body","[begin]");return[].map.call(f,p=>{const v=qb(p,c);if(!v||!p.hasAttribute("begin"))return null;const x=Tf(p.getAttribute("begin"),l),S=Tf(p.getAttribute("dur"),l);let E=Tf(p.getAttribute("end"),l);if(x===null)throw xx(p);if(E===null){if(S===null)throw xx(p);E=x+S}const T=new Um(x-e,E-e,v);T.id=Mm(T.startTime,T.endTime,T.text);const A=u[p.getAttribute("region")],I=h[p.getAttribute("style")],_=wN(A,I,h),{textAlign:C}=_;if(C){const k=RN[C];k&&(T.lineAlign=k),T.align=C}return Lt(T,_),T}).filter(p=>p!==null)}function Sf(i,e,t){const s=i.getElementsByTagName(e)[0];return s?[].slice.call(s.querySelectorAll(t)):[]}function yx(i){return i.reduce((e,t)=>{const s=t.getAttribute("xml:id");return s&&(e[s]=t),e},{})}function qb(i,e){return[].slice.call(i.childNodes).reduce((t,s,n)=>{var r;return s.nodeName==="br"&&n?t+`
`:(r=s.childNodes)!=null&&r.length?qb(s,e):e?t+s.textContent.trim().replace(/\s+/g," "):t+s.textContent},"")}function wN(i,e,t){const s="http://www.w3.org/ns/ttml#styling";let n=null;const r=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],l=i!=null&&i.hasAttribute("style")?i.getAttribute("style"):null;return l&&t.hasOwnProperty(l)&&(n=t[l]),r.reduce((c,h)=>{const u=bf(e,s,h)||bf(i,s,h)||bf(n,s,h);return u&&(c[h]=u),c},{})}function bf(i,e,t){return i&&i.hasAttributeNS(e,t)?i.getAttributeNS(e,t):null}function xx(i){return new Error(`Could not parse ttml timestamp ${i}`)}function Tf(i,e){if(!i)return null;let t=Gb(i);return t===null&&(Kb.test(i)?t=CN(i,e):Yb.test(i)&&(t=ON(i,e))),t}function CN(i,e){const t=Kb.exec(i),s=(t[4]|0)+(t[5]|0)/e.subFrameRate;return(t[1]|0)*3600+(t[2]|0)*60+(t[3]|0)+s/e.frameRate}function ON(i,e){const t=Yb.exec(i),s=Number(t[1]);switch(t[2]){case"h":return s*3600;case"m":return s*60;case"ms":return s*1e3;case"f":return s/e.frameRate;case"t":return s/e.tickRate}return s}class Hc{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,s){(this.startTime===null||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=s,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}class NN{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=bx(),this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(L.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(L.FRAG_LOADING,this.onFragLoading,this),e.on(L.FRAG_LOADED,this.onFragLoaded,this),e.on(L.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(L.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(L.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(L.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(L.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(L.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(L.FRAG_LOADING,this.onFragLoading,this),e.off(L.FRAG_LOADED,this.onFragLoaded,this),e.off(L.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(L.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(L.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(L.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(L.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){const e=new Hc(this,"textTrack1"),t=new Hc(this,"textTrack2"),s=new Hc(this,"textTrack3"),n=new Hc(this,"textTrack4");this.cea608Parser1=new gx(1,e,t),this.cea608Parser2=new gx(3,s,n)}addCues(e,t,s,n,r){let l=!1;for(let c=r.length;c--;){const h=r[c],u=kN(h[0],h[1],t,s);if(u>=0&&(h[0]=Math.min(h[0],t),h[1]=Math.max(h[1],s),l=!0,u/(s-t)>.5))return}if(l||r.push([t,s]),this.config.renderTextTracksNatively){const c=this.captionsTracks[e];this.Cues.newCue(c,t,s,n)}else{const c=this.Cues.newCue(null,t,s,n);this.hls.trigger(L.CUES_PARSED,{type:"captions",cues:c,track:e})}}onInitPtsFound(e,{frag:t,id:s,initPTS:n,timescale:r,trackId:l}){const{unparsedVttFrags:c}=this;s===ke.MAIN&&(this.initPTS[t.cc]={baseTime:n,timescale:r,trackId:l}),c.length&&(this.unparsedVttFrags=[],c.forEach(h=>{this.initPTS[h.frag.cc]?this.onFragLoaded(L.FRAG_LOADED,h):this.hls.trigger(L.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:h.frag,error:new Error("Subtitle discontinuity domain does not match main")})}))}getExistingTrack(e,t){const{media:s}=this;if(s)for(let n=0;n<s.textTracks.length;n++){const r=s.textTracks[n];if(Sx(r,{name:e,lang:t,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return r}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:t,captionsTracks:s,media:n}=this,{label:r,languageCode:l}=t[e],c=this.getExistingTrack(r,l);if(c)s[e]=c,Ur(s[e]),jb(s[e],n);else{const h=this.createTextTrack("captions",r,l);h&&(h[e]=!0,s[e]=h)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const s=t.label,n={_id:e,label:s,kind:"captions",default:t.media?!!t.media.default:!1,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=n,this.hls.trigger(L.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[n]})}createTextTrack(e,t,s){const n=this.media;if(n)return n.addTextTrack(e,t,s)}onMediaAttaching(e,t){this.media=t.media,t.mediaSource||this._cleanTracks()}onMediaDetaching(e,t){const s=!!t.transferMedia;if(this.media=null,s)return;const{captionsTracks:n}=this;Object.keys(n).forEach(r=>{Ur(n[r]),delete n[r]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=bx(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const t=e.textTracks;if(t)for(let s=0;s<t.length;s++)Ur(t[s])}onSubtitleTracksUpdated(e,t){const s=t.subtitleTracks||[],n=s.some(r=>r.textCodec===xf);if(this.config.enableWebVTT||n&&this.config.enableIMSC1){if(Ib(this.tracks,s)){this.tracks=s;return}if(this.textTracks=[],this.tracks=s,this.config.renderTextTracksNatively){const l=this.media,c=l?nu(l.textTracks):null;if(this.tracks.forEach((h,u)=>{let f;if(c){let p=null;for(let v=0;v<c.length;v++)if(c[v]&&Sx(c[v],h)){p=c[v],c[v]=null;break}p&&(f=p)}if(f)Ur(f);else{const p=Qb(h);f=this.createTextTrack(p,h.name,h.lang),f&&(f.mode="disabled")}f&&this.textTracks.push(f)}),c!=null&&c.length){const h=c.filter(u=>u!==null).map(u=>u.label);h.length&&this.hls.logger.warn(`Media element contains unused subtitle tracks: ${h.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const l=this.tracks.map(c=>({label:c.name,kind:c.type.toLowerCase(),default:c.default,subtitleTrack:c}));this.hls.trigger(L.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:l})}}}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(s=>{const n=/(?:CC|SERVICE)([1-4])/.exec(s.instreamId);if(!n)return;const r=`textTrack${n[1]}`,l=this.captionsProperties[r];l&&(l.label=s.name,s.lang&&(l.languageCode=s.lang),l.media=s)})}closedCaptionsForLevel(e){const t=this.hls.levels[e.level];return t?.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){if(this.enabled&&t.frag.type===ke.MAIN){var s,n;const{cea608Parser1:r,cea608Parser2:l,lastSn:c}=this,{cc:h,sn:u}=t.frag,f=(s=(n=t.part)==null?void 0:n.index)!=null?s:-1;r&&l&&(u!==c+1||u===c&&f!==this.lastPartIndex+1||h!==this.lastCc)&&(r.reset(),l.reset()),this.lastCc=h,this.lastSn=u,this.lastPartIndex=f}}onFragLoaded(e,t){const{frag:s,payload:n}=t;if(s.type===ke.SUBTITLE)if(n.byteLength){const r=s.decryptdata,l="stats"in t;if(r==null||!r.encrypted||l){const c=this.tracks[s.level],h=this.vttCCs;h[s.cc]||(h[s.cc]={start:s.start,prevCC:this.prevCC,new:!0},this.prevCC=s.cc),c&&c.textCodec===xf?this._parseIMSC1(s,n):this._parseVTTs(t)}}else this.hls.trigger(L.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:s,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){const s=this.hls;vx(t,this.initPTS[e.cc],n=>{this._appendCues(n,e.level),s.trigger(L.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},n=>{s.logger.log(`Failed to parse IMSC1: ${n}`),s.trigger(L.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:n})})}_parseVTTs(e){var t;const{frag:s,payload:n}=e,{initPTS:r,unparsedVttFrags:l}=this,c=r.length-1;if(!r[s.cc]&&c===-1){l.push(e);return}const h=this.hls,u=(t=s.initSegment)!=null&&t.data?ki(s.initSegment.data,new Uint8Array(n)).buffer:n;_N(u,this.initPTS[s.cc],this.vttCCs,s.cc,s.start,f=>{this._appendCues(f,s.level),h.trigger(L.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:s})},f=>{const p=f.message==="Missing initPTS for VTT MPEGTS";p?l.push(e):this._fallbackToIMSC1(s,n),h.logger.log(`Failed to parse VTT cue: ${f}`),!(p&&c>s.cc)&&h.trigger(L.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:s,error:f})})}_fallbackToIMSC1(e,t){const s=this.tracks[e.level];s.textCodec||vx(t,this.initPTS[e.cc],()=>{s.textCodec=xf,this._parseIMSC1(e,t)},()=>{s.textCodec="wvtt"})}_appendCues(e,t){const s=this.hls;if(this.config.renderTextTracksNatively){const n=this.textTracks[t];if(!n||n.mode==="disabled")return;e.forEach(r=>Fb(n,r))}else{const n=this.tracks[t];if(!n)return;const r=n.default?"default":"subtitles"+t;s.trigger(L.CUES_PARSED,{type:"subtitles",cues:e,track:r})}}onFragDecrypted(e,t){const{frag:s}=t;s.type===ke.SUBTITLE&&this.onFragLoaded(L.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){if(!this.enabled||!this.config.enableCEA708Captions)return;const{frag:s,samples:n}=t;if(!(s.type===ke.MAIN&&this.closedCaptionsForLevel(s)==="NONE"))for(let r=0;r<n.length;r++){const l=n[r].bytes;if(l){this.cea608Parser1||this.initCea608Parsers();const c=this.extractCea608Data(l);this.cea608Parser1.addData(n[r].pts,c[0]),this.cea608Parser2.addData(n[r].pts,c[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:s,endOffsetSubtitles:n,type:r}){const{media:l}=this;if(!(!l||l.currentTime<s)){if(!r||r==="video"){const{captionsTracks:c}=this;Object.keys(c).forEach(h=>Qf(c[h],t,s))}if(this.config.renderTextTracksNatively&&t===0&&n!==void 0){const{textTracks:c}=this;Object.keys(c).forEach(h=>Qf(c[h],t,n))}}}extractCea608Data(e){const t=[[],[]],s=e[0]&31;let n=2;for(let r=0;r<s;r++){const l=e[n++],c=127&e[n++],h=127&e[n++];if(c===0&&h===0)continue;if((4&l)!==0){const f=3&l;(f===0||f===1)&&(t[f].push(c),t[f].push(h))}}return t}}function Qb(i){return i.characteristics&&/transcribes-spoken-dialog/gi.test(i.characteristics)&&/describes-music-and-sound/gi.test(i.characteristics)?"captions":"subtitles"}function Sx(i,e){return!!i&&i.kind===Qb(e)&&zf(e,i)}function kN(i,e,t,s){return Math.min(e,s)-Math.max(i,t)}function bx(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}const DN=/\s/,PN={newCue(i,e,t,s){const n=[];let r,l,c,h,u;const f=self.VTTCue||self.TextTrackCue;for(let v=0;v<s.rows.length;v++)if(r=s.rows[v],c=!0,h=0,u="",!r.isEmpty()){var p;for(let E=0;E<r.chars.length;E++)DN.test(r.chars[E].uchar)&&c?h++:(u+=r.chars[E].uchar,c=!1);r.cueStartTime=e,e===t&&(t+=1e-4),h>=16?h--:h++;const x=zb(u.trim()),S=Mm(e,t,x);i!=null&&(p=i.cues)!=null&&p.getCueById(S)||(l=new f(e,t,x),l.id=S,l.line=v+1,l.align="left",l.position=10+Math.min(80,Math.floor(h*8/32)*10),n.push(l))}return i&&n.length&&(n.sort((v,x)=>v.line==="auto"||x.line==="auto"?0:v.line>8&&x.line>8?x.line-v.line:v.line-x.line),n.forEach(v=>Fb(i,v))),n}};function UN(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}const MN=/(\d+)-(\d+)\/(\d+)/;class Tx{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||VN,this.controller=new self.AbortController,this.stats=new pm}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,s){const n=this.stats;if(n.loading.start)throw new Error("Loader can only be used once.");n.loading.start=self.performance.now();const r=jN(e,this.controller.signal),l=e.responseType==="arraybuffer",c=l?"byteLength":"length",{maxTimeToFirstByteMs:h,maxLoadTimeMs:u}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=s,this.request=this.fetchSetup(e,r),self.clearTimeout(this.requestTimeout),t.timeout=h&&Oe(h)?h:u,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(n,e,this.response))},t.timeout),(to(this.request)?this.request.then(self.fetch):self.fetch(this.request)).then(p=>{var v;this.response=this.loader=p;const x=Math.max(self.performance.now(),n.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=u,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(n,e,this.response))},u-(x-n.loading.start)),!p.ok){const{status:E,statusText:T}=p;throw new $N(T||"fetch, bad network response",E,p)}n.loading.first=x,n.total=BN(p.headers)||n.total;const S=(v=this.callbacks)==null?void 0:v.onProgress;return S&&Oe(t.highWaterMark)?this.loadProgressively(p,n,e,t.highWaterMark,S):l?p.arrayBuffer():e.responseType==="json"?p.json():p.text()}).then(p=>{var v,x;const S=this.response;if(!S)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),n.loading.end=Math.max(self.performance.now(),n.loading.first);const E=p[c];E&&(n.loaded=n.total=E);const T={url:S.url,data:p,code:S.status},A=(v=this.callbacks)==null?void 0:v.onProgress;A&&!Oe(t.highWaterMark)&&A(n,e,p,S),(x=this.callbacks)==null||x.onSuccess(T,n,e,S)}).catch(p=>{var v;if(self.clearTimeout(this.requestTimeout),n.aborted)return;const x=p&&p.code||0,S=p?p.message:null;(v=this.callbacks)==null||v.onError({code:x,text:S},e,p?p.details:null,n)})}getCacheAge(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,s,n=0,r){const l=new ab,c=e.body.getReader(),h=()=>c.read().then(u=>{if(u.done)return l.dataLength&&r(t,s,l.flush().buffer,e),Promise.resolve(new ArrayBuffer(0));const f=u.value,p=f.length;return t.loaded+=p,p<n||l.dataLength?(l.push(f),l.dataLength>=n&&r(t,s,l.flush().buffer,e)):r(t,s,f.buffer,e),h()}).catch(()=>Promise.reject());return h()}}function jN(i,e){const t={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers(Lt({},i.headers))};return i.rangeEnd&&t.headers.set("Range","bytes="+i.rangeStart+"-"+String(i.rangeEnd-1)),t}function FN(i){const e=MN.exec(i);if(e)return parseInt(e[2])-parseInt(e[1])+1}function BN(i){const e=i.get("Content-Range");if(e){const s=FN(e);if(Oe(s))return s}const t=i.get("Content-Length");if(t)return parseInt(t)}function VN(i,e){return new self.Request(i.url,e)}class $N extends Error{constructor(e,t,s){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=s}}const GN=/^age:\s*[\d.]+\s*$/im;class Wb{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new pm,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,e.readyState!==4&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,s){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=s,this.loadInternal()}loadInternal(){const{config:e,context:t}=this;if(!e||!t)return;const s=this.loader=new self.XMLHttpRequest,n=this.stats;n.loading.first=0,n.loaded=0,n.aborted=!1;const r=this.xhrSetup;r?Promise.resolve().then(()=>{if(!(this.loader!==s||this.stats.aborted))return r(s,t.url)}).catch(l=>{if(!(this.loader!==s||this.stats.aborted))return s.open("GET",t.url,!0),r(s,t.url)}).then(()=>{this.loader!==s||this.stats.aborted||this.openAndSendXhr(s,t,e)}).catch(l=>{var c;(c=this.callbacks)==null||c.onError({code:s.status,text:l.message},t,s,n)}):this.openAndSendXhr(s,t,e)}openAndSendXhr(e,t,s){e.readyState||e.open("GET",t.url,!0);const n=t.headers,{maxTimeToFirstByteMs:r,maxLoadTimeMs:l}=s.loadPolicy;if(n)for(const c in n)e.setRequestHeader(c,n[c]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),s.timeout=r&&Oe(r)?r:l,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),s.timeout),e.send()}readystatechange(){const{context:e,loader:t,stats:s}=this;if(!e||!t)return;const n=t.readyState,r=this.config;if(!s.aborted&&n>=2&&(s.loading.first===0&&(s.loading.first=Math.max(self.performance.now(),s.loading.start),r.timeout!==r.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),r.timeout=r.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),r.loadPolicy.maxLoadTimeMs-(s.loading.first-s.loading.start)))),n===4)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const u=t.status,f=t.responseType==="text"?t.responseText:null;if(u>=200&&u<300){const S=f??t.response;if(S!=null){var l,c;s.loading.end=Math.max(self.performance.now(),s.loading.first);const E=t.responseType==="arraybuffer"?S.byteLength:S.length;s.loaded=s.total=E,s.bwEstimate=s.total*8e3/(s.loading.end-s.loading.first);const T=(l=this.callbacks)==null?void 0:l.onProgress;T&&T(s,e,S,t);const A={url:t.responseURL,data:S,code:u};(c=this.callbacks)==null||c.onSuccess(A,s,e,t);return}}const p=r.loadPolicy.errorRetry,v=s.retry,x={url:e.url,data:void 0,code:u};if(gu(p,v,!1,x))this.retry(p);else{var h;St.error(`${u} while loading ${e.url}`),(h=this.callbacks)==null||h.onError({code:u,text:t.statusText},e,t,s)}}}loadtimeout(){if(!this.config)return;const e=this.config.loadPolicy.timeoutRetry,t=this.stats.retry;if(gu(e,t,!0))this.retry(e);else{var s;St.warn(`timeout while loading ${(s=this.context)==null?void 0:s.url}`);const n=this.callbacks;n&&(this.abortInternal(),n.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:t,stats:s}=this;this.retryDelay=xm(e,s.retry),s.retry++,St.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${t?.url}, retrying ${s.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&GN.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}const HN={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},zN=xt(xt({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,startOnSegmentBoundary:!1,maxBufferSize:60*1e3*1e3,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncMode:"edge",liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:Wb,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:iw,bufferController:YC,capLevelController:km,errorController:ow,fpsController:qO,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:qS,requireKeySystemAccessOnStart:!1,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,preserveManualLevelOnError:!1,certLoadPolicy:{default:HN},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},KN()),{},{subtitleStreamController:rN,subtitleTrackController:XO,timelineController:NN,audioStreamController:GC,audioTrackController:HC,emeController:Fr,cmcdController:HO,contentSteeringController:KO,interstitialsController:aN});function KN(){return{cueHandler:PN,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function YN(i,e,t){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(e.liveMaxLatencyDurationCount!==void 0&&(e.liveSyncDurationCount===void 0||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(e.liveMaxLatencyDuration!==void 0&&(e.liveSyncDuration===void 0||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const s=Xf(i),n=["manifest","level","frag"],r=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return n.forEach(l=>{const c=`${l==="level"?"playlist":l}LoadPolicy`,h=e[c]===void 0,u=[];r.forEach(f=>{const p=`${l}Loading${f}`,v=e[p];if(v!==void 0&&h){u.push(p);const x=s[c].default;switch(e[c]={default:x},f){case"TimeOut":x.maxLoadTimeMs=v,x.maxTimeToFirstByteMs=v;break;case"MaxRetry":x.errorRetry.maxNumRetry=v,x.timeoutRetry.maxNumRetry=v;break;case"RetryDelay":x.errorRetry.retryDelayMs=v,x.timeoutRetry.retryDelayMs=v;break;case"MaxRetryTimeout":x.errorRetry.maxRetryDelayMs=v,x.timeoutRetry.maxRetryDelayMs=v;break}}}),u.length&&t.warn(`hls.js config: "${u.join('", "')}" setting(s) are deprecated, use "${c}": ${Ot(e[c])}`)}),xt(xt({},s),e)}function Xf(i){return i&&typeof i=="object"?Array.isArray(i)?i.map(Xf):Object.keys(i).reduce((e,t)=>(e[t]=Xf(i[t]),e),{}):i}function qN(i,e){const t=i.loader;t!==Tx&&t!==Wb?(e.log("[config]: Custom loader detected, cannot enable progressive streaming"),i.progressive=!1):UN()&&(i.loader=Tx,i.progressive=!0,i.enableSoftwareAES=!0,e.log("[config]: Progressive streaming enabled, using FetchLoader"))}const au=2,QN=.1,WN=.05,XN=100;class ZN extends GS{constructor(e,t){super("gap-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.media=null,this.mediaSource=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.buffered={},this.lastCurrentTime=0,this.ended=0,this.waiting=0,this.onMediaPlaying=()=>{this.ended=0,this.waiting=0},this.onMediaWaiting=()=>{var s;(s=this.media)!=null&&s.seeking||(this.waiting=self.performance.now(),this.tick())},this.onMediaEnded=()=>{if(this.hls){var s;this.ended=((s=this.media)==null?void 0:s.currentTime)||1,this.hls.trigger(L.MEDIA_ENDED,{stalled:!1})}},this.hls=e,this.fragmentTracker=t,this.registerListeners()}registerListeners(){const{hls:e}=this;e&&(e.on(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(L.BUFFER_APPENDED,this.onBufferAppended,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(L.BUFFER_APPENDED,this.onBufferAppended,this))}destroy(){super.destroy(),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0}onMediaAttached(e,t){this.setInterval(XN),this.mediaSource=t.mediaSource;const s=this.media=t.media;Fs(s,"playing",this.onMediaPlaying),Fs(s,"waiting",this.onMediaWaiting),Fs(s,"ended",this.onMediaEnded)}onMediaDetaching(e,t){this.clearInterval();const{media:s}=this;s&&(Xs(s,"playing",this.onMediaPlaying),Xs(s,"waiting",this.onMediaWaiting),Xs(s,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0}onBufferAppended(e,t){this.buffered=t.timeRanges}get hasBuffered(){return Object.keys(this.buffered).length>0}tick(){var e;if(!((e=this.media)!=null&&e.readyState)||!this.hasBuffered)return;const t=this.media.currentTime;this.poll(t,this.lastCurrentTime),this.lastCurrentTime=t}poll(e,t){var s,n;const r=(s=this.hls)==null?void 0:s.config;if(!r)return;const l=this.media;if(!l)return;const{seeking:c}=l,h=this.seeking&&!c,u=!this.seeking&&c,f=l.paused&&!c||l.ended||l.playbackRate===0;if(this.seeking=c,e!==t){t&&(this.ended=0),this.moved=!0,c||(this.nudgeRetry=0,r.nudgeOnVideoHole&&!f&&e>t&&this.nudgeOnVideoHole(e,t)),this.waiting===0&&this.stallResolved(e);return}if(u||h){h&&this.stallResolved(e);return}if(f){this.nudgeRetry=0,this.stallResolved(e),!this.ended&&l.ended&&this.hls&&(this.ended=e||1,this.hls.trigger(L.MEDIA_ENDED,{stalled:!1}));return}if(!qe.getBuffered(l).length){this.nudgeRetry=0;return}const p=qe.bufferInfo(l,e,0),v=p.nextStart||0,x=this.fragmentTracker;if(c&&x&&this.hls){const U=Ex(this.hls.inFlightFragments,e),O=p.len>au,F=!v||U||v-e>au&&!x.getPartialFragment(e);if(O||F)return;this.moved=!1}const S=(n=this.hls)==null?void 0:n.latestLevelDetails;if(!this.moved&&this.stalled!==null&&x){if(!(p.len>0)&&!v)return;const O=Math.max(v,p.start||0)-e,j=!!(S!=null&&S.live)?S.targetduration*2:au,M=zc(e,x);if(O>0&&(O<=j||M)){l.paused||this._trySkipBufferHole(M);return}}const E=r.detectStallWithCurrentTimeMs,T=self.performance.now(),A=this.waiting;let I=this.stalled;if(I===null)if(A>0&&T-A<E)I=this.stalled=A;else{this.stalled=T;return}const _=T-I;if(!c&&(_>=E||A)&&this.hls){var C;if(((C=this.mediaSource)==null?void 0:C.readyState)==="ended"&&!(S!=null&&S.live)&&Math.abs(e-(S?.edge||0))<1){if(this.ended)return;this.ended=e||1,this.hls.trigger(L.MEDIA_ENDED,{stalled:!0});return}if(this._reportStall(p),!this.media||!this.hls)return}const k=qe.bufferInfo(l,e,r.maxBufferHole);this._tryFixBufferStall(k,_,e)}stallResolved(e){const t=this.stalled;if(t&&this.hls&&(this.stalled=null,this.stallReported)){const s=self.performance.now()-t;this.log(`playback not stuck anymore @${e}, after ${Math.round(s)}ms`),this.stallReported=!1,this.waiting=0,this.hls.trigger(L.STALL_RESOLVED,{})}}nudgeOnVideoHole(e,t){var s;const n=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&(s=this.buffered.audio)!=null&&s.length&&n&&n.length>1&&e>n.end(0)){const r=qe.bufferedInfo(qe.timeRangesToArray(this.buffered.audio),e,0);if(r.len>1&&t>=r.start){const l=qe.timeRangesToArray(n),c=qe.bufferedInfo(l,t,0).bufferedIndex;if(c>-1&&c<l.length-1){const h=qe.bufferedInfo(l,e,0).bufferedIndex,u=l[c].end,f=l[c+1].start;if((h===-1||h>c)&&f-u<1&&e-u<2){const p=new Error(`nudging playhead to flush pipeline after video hole. currentTime: ${e} hole: ${u} -> ${f} buffered index: ${h}`);this.warn(p.message),this.media.currentTime+=1e-6;let v=zc(e,this.fragmentTracker);v&&"fragment"in v?v=v.fragment:v||(v=void 0);const x=qe.bufferInfo(this.media,e,0);this.hls.trigger(L.ERROR,{type:Fe.MEDIA_ERROR,details:Q.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:p,reason:p.message,frag:v,buffer:x.len,bufferInfo:x})}}}}}_tryFixBufferStall(e,t,s){var n,r;const{fragmentTracker:l,media:c}=this,h=(n=this.hls)==null?void 0:n.config;if(!c||!l||!h)return;const u=(r=this.hls)==null?void 0:r.latestLevelDetails,f=zc(s,l);if((f||u!=null&&u.live&&s<u.fragmentStart)&&(this._trySkipBufferHole(f)||!this.media))return;const p=e.buffered,v=this.adjacentTraversal(e,s);(p&&p.length>1&&e.len>h.maxBufferHole||e.nextStart&&(e.nextStart-s<h.maxBufferHole||v))&&(t>h.highBufferWatchdogPeriod*1e3||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(e))}adjacentTraversal(e,t){const s=this.fragmentTracker,n=e.nextStart;if(s&&n){const r=s.getFragAtPos(t,ke.MAIN),l=s.getFragAtPos(n,ke.MAIN);if(r&&l)return l.sn-r.sn<2}return!1}_reportStall(e){const{hls:t,media:s,stallReported:n,stalled:r}=this;if(!n&&r!==null&&s&&t){this.stallReported=!0;const l=new Error(`Playback stalling at @${s.currentTime} due to low buffer (${Ot(e)})`);this.warn(l.message),t.trigger(L.ERROR,{type:Fe.MEDIA_ERROR,details:Q.BUFFER_STALLED_ERROR,fatal:!1,error:l,buffer:e.len,bufferInfo:e,stalled:{start:r}})}}_trySkipBufferHole(e){var t;const{fragmentTracker:s,media:n}=this,r=(t=this.hls)==null?void 0:t.config;if(!n||!s||!r)return 0;const l=n.currentTime,c=qe.bufferInfo(n,l,0),h=l<c.start?c.start:c.nextStart;if(h&&this.hls){const f=c.len<=r.maxBufferHole,p=c.len>0&&c.len<1&&n.readyState<3,v=h-l;if(v>0&&(f||p)){if(v>r.maxBufferHole){let S=!1;if(l===0){const E=s.getAppendedFrag(0,ke.MAIN);E&&h<E.end&&(S=!0)}if(!S&&e){var u;if(!((u=this.hls.loadLevelObj)!=null&&u.details)||Ex(this.hls.inFlightFragments,h))return 0;let T=!1,A=e.end;for(;A<h;){const I=zc(A,s);if(I)A+=I.duration;else{T=!0;break}}if(T)return 0}}const x=Math.max(h+WN,l+QN);if(this.warn(`skipping hole, adjusting currentTime from ${l} to ${x}`),this.moved=!0,n.currentTime=x,!(e!=null&&e.gap)){const S=new Error(`fragment loaded with buffer holes, seeking from ${l} to ${x}`),E={type:Fe.MEDIA_ERROR,details:Q.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:S,reason:S.message,buffer:c.len,bufferInfo:c};e&&("fragment"in e?E.part=e:E.frag=e),this.hls.trigger(L.ERROR,E)}return x}}return 0}_tryNudgeBuffer(e){const{hls:t,media:s,nudgeRetry:n}=this,r=t?.config;if(!s||!r)return 0;const l=s.currentTime;if(this.nudgeRetry++,n<r.nudgeMaxRetry){const c=l+(n+1)*r.nudgeOffset,h=new Error(`Nudging 'currentTime' from ${l} to ${c}`);this.warn(h.message),s.currentTime=c,t.trigger(L.ERROR,{type:Fe.MEDIA_ERROR,details:Q.BUFFER_NUDGE_ON_STALL,error:h,fatal:!1,buffer:e.len,bufferInfo:e})}else{const c=new Error(`Playhead still not moving while enough data buffered @${l} after ${r.nudgeMaxRetry} nudges`);this.error(c.message),t.trigger(L.ERROR,{type:Fe.MEDIA_ERROR,details:Q.BUFFER_STALLED_ERROR,error:c,fatal:!0,buffer:e.len,bufferInfo:e})}}}function Ex(i,e){const t=Ax(i.main);if(t&&t.start<=e)return t;const s=Ax(i.audio);return s&&s.start<=e?s:null}function Ax(i){if(!i)return null;switch(i.state){case ce.IDLE:case ce.STOPPED:case ce.ENDED:case ce.ERROR:return null}return i.frag}function zc(i,e){return e.getAppendedFrag(i,ke.MAIN)||e.getPartialFragment(i)}const JN=.25;function Zf(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function Ef(i,e,t,s,n){let r=new i(e,t,"");try{r.value=s,n&&(r.type=n)}catch{r=new i(e,t,Ot(n?xt({type:n},s):s))}return r}const Kc=(()=>{const i=Zf();try{i&&new i(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();class ek{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.assetCue=void 0,this.onEventCueEnter=()=>{this.hls&&this.hls.trigger(L.EVENT_CUE_ENTER,{})},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null}_registerListeners(){const{hls:e}=this;e&&(e.on(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(L.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(L.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(L.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(L.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(L.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(L.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}onMediaAttaching(e,t){var s;this.media=t.media,((s=t.overrides)==null?void 0:s.cueRemoval)===!1&&(this.removeCues=!1)}onMediaAttached(){var e;const t=(e=this.hls)==null?void 0:e.latestLevelDetails;t&&this.updateDateRangeCues(t)}onMediaDetaching(e,t){this.media=null,!t.transferMedia&&(this.id3Track&&(this.removeCues&&Ur(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){const s=e[t];if(s.kind==="metadata"&&s.label==="id3")return jb(s,this.media),s}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media||!this.hls)return;const{enableEmsgMetadataCues:s,enableID3MetadataCues:n}=this.hls.config;if(!s&&!n)return;const{samples:r}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const l=Zf();if(l)for(let c=0;c<r.length;c++){const h=r[c].type;if(h===mi.emsg&&!s||!n)continue;const u=hb(r[c].data),f=r[c].pts;let p=f+r[c].duration;p>Kc&&(p=Kc),p-f<=0&&(p=f+JN);for(let x=0;x<u.length;x++){const S=u[x];if(!fb(S)){this.updateId3CueEnds(f,h);const E=Ef(l,f,p,S,h);E&&this.id3Track.addCue(E)}}}}updateId3CueEnds(e,t){var s;const n=(s=this.id3Track)==null?void 0:s.cues;if(n)for(let r=n.length;r--;){const l=n[r];l.type===t&&l.startTime<e&&l.endTime===Kc&&(l.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:s,type:n}){const{id3Track:r,hls:l}=this;if(!l)return;const{config:{enableEmsgMetadataCues:c,enableID3MetadataCues:h}}=l;if(r&&(c||h)){let u;n==="audio"?u=f=>f.type===mi.audioId3&&h:n==="video"?u=f=>f.type===mi.emsg&&c:u=f=>f.type===mi.audioId3&&h||f.type===mi.emsg&&c,Qf(r,t,s,u)}}onLevelUpdated(e,{details:t}){this.updateDateRangeCues(t,!0)}onLevelPtsUpdated(e,t){Math.abs(t.drift)>.01&&this.updateDateRangeCues(t.details)}updateDateRangeCues(e,t){if(!this.hls||!this.media)return;const{assetPlayerId:s,timelineOffset:n,enableDateRangeMetadataCues:r,interstitialsController:l}=this.hls.config;if(!r)return;const c=Zf();if(s&&n&&!l){const{fragmentStart:E,fragmentEnd:T}=e;let A=this.assetCue;A?(A.startTime=E,A.endTime=T):c&&(A=this.assetCue=Ef(c,E,T,{assetPlayerId:this.hls.config.assetPlayerId},"hlsjs.interstitial.asset"),A&&(A.id=s,this.id3Track||(this.id3Track=this.createTrack(this.media)),this.id3Track.addCue(A),A.addEventListener("enter",this.onEventCueEnter)))}if(!e.hasProgramDateTime)return;const{id3Track:h}=this,{dateRanges:u}=e,f=Object.keys(u);let p=this.dateRangeCuesAppended;if(h&&t){var v;if((v=h.cues)!=null&&v.length){const E=Object.keys(p).filter(T=>!f.includes(T));for(let T=E.length;T--;){var x;const A=E[T],I=(x=p[A])==null?void 0:x.cues;delete p[A],I&&Object.keys(I).forEach(_=>{const C=I[_];if(C){C.removeEventListener("enter",this.onEventCueEnter);try{h.removeCue(C)}catch{}}})}}else p=this.dateRangeCuesAppended={}}const S=e.fragments[e.fragments.length-1];if(!(f.length===0||!Oe(S?.programDateTime))){this.id3Track||(this.id3Track=this.createTrack(this.media));for(let E=0;E<f.length;E++){const T=f[E],A=u[T],I=A.startTime,_=p[T],C=_?.cues||{};let k=_?.durationKnown||!1,U=Kc;const{duration:O,endDate:F}=A;if(F&&O!==null)U=I+O,k=!0;else if(A.endOnNext&&!k){const M=f.reduce((H,K)=>{if(K!==A.id){const te=u[K];if(te.class===A.class&&te.startDate>A.startDate&&(!H||A.startDate<H.startDate))return te}return H},null);M&&(U=M.startTime,k=!0)}const j=Object.keys(A.attr);for(let M=0;M<j.length;M++){const H=j[M];if(!bw(H))continue;const K=C[H];if(K)k&&!(_!=null&&_.durationKnown)?K.endTime=U:Math.abs(K.startTime-I)>.01&&(K.startTime=I,K.endTime=U);else if(c){let te=A.attr[H];Tw(H)&&(te=ES(te));const me=Ef(c,I,U,{key:H,data:te},mi.dateRange);me&&(me.id=T,this.id3Track.addCue(me),C[H]=me,l&&(H==="X-ASSET-LIST"||H==="X-ASSET-URL")&&me.addEventListener("enter",this.onEventCueEnter))}}p[T]={cues:C,dateRange:A,durationKnown:k}}}}}class tk{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=()=>{const{media:t}=this,s=this.levelDetails;if(!t||!s)return;this.currentTime=t.currentTime;const n=this.computeLatency();if(n===null)return;this._latency=n;const{lowLatencyMode:r,maxLiveSyncPlaybackRate:l}=this.config;if(!r||l===1||!s.live)return;const c=this.targetLatency;if(c===null)return;const h=n-c,u=Math.min(this.maxLatency,c+s.targetduration);if(h<u&&h>.05&&this.forwardBufferLength>1){const p=Math.min(2,Math.max(1,l)),v=Math.round(2/(1+Math.exp(-.75*h-this.edgeStalled))*20)/20,x=Math.min(p,Math.max(1,v));this.changeMediaPlaybackRate(t,x)}else t.playbackRate!==1&&t.playbackRate!==0&&this.changeMediaPlaybackRate(t,1)},this.hls=e,this.config=e.config,this.registerListeners()}get levelDetails(){var e;return((e=this.hls)==null?void 0:e.latestLevelDetails)||null}get latency(){return this._latency||0}get maxLatency(){const{config:e}=this;if(e.liveMaxLatencyDuration!==void 0)return e.liveMaxLatencyDuration;const t=this.levelDetails;return t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){const e=this.levelDetails;if(e===null||this.hls===null)return null;const{holdBack:t,partHoldBack:s,targetduration:n}=e,{liveSyncDuration:r,liveSyncDurationCount:l,lowLatencyMode:c}=this.config,h=this.hls.userConfig;let u=c&&s||t;(this._targetLatencyUpdated||h.liveSyncDuration||h.liveSyncDurationCount||u===0)&&(u=r!==void 0?r:l*n);const f=n;return u+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,f)}set targetLatency(e){this.stallCount=0,this.config.liveSyncDuration=e,this._targetLatencyUpdated=!0}get liveSyncPosition(){const e=this.estimateLiveEdge(),t=this.targetLatency;if(e===null||t===null)return null;const s=this.levelDetails;if(s===null)return null;const n=s.edge,r=e-t-this.edgeStalled,l=n-s.totalduration,c=n-(this.config.lowLatencyMode&&s.partTarget||s.targetduration);return Math.min(Math.max(l,r),c)}get drift(){const e=this.levelDetails;return e===null?1:e.drift}get edgeStalled(){const e=this.levelDetails;if(e===null)return 0;const t=(this.config.lowLatencyMode&&e.partTarget||e.targetduration)*3;return Math.max(e.age-t,0)}get forwardBufferLength(){const{media:e}=this,t=this.levelDetails;if(!e||!t)return 0;const s=e.buffered.length;return(s?e.buffered.end(s-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null}registerListeners(){const{hls:e}=this;e&&(e.on(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(L.ERROR,this.onError,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(L.ERROR,this.onError,this))}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.onTimeupdate)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)}onManifestLoading(){this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){t.advanced&&this.onTimeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)}onError(e,t){var s;t.details===Q.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&(s=this.levelDetails)!=null&&s.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))}changeMediaPlaybackRate(e,t){var s,n;e.playbackRate!==t&&((s=this.hls)==null||s.logger.debug(`[latency-controller]: latency=${this.latency.toFixed(3)}, targetLatency=${(n=this.targetLatency)==null?void 0:n.toFixed(3)}, forwardBufferLength=${this.forwardBufferLength.toFixed(3)}: adjusting playback rate from ${e.playbackRate} to ${t}`),e.playbackRate=t)}estimateLiveEdge(){const e=this.levelDetails;return e===null?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return e===null?null:e-this.currentTime}}class sk extends Nm{constructor(e,t){super(e,"level-controller"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(L.LEVEL_LOADED,this.onLevelLoaded,this),e.on(L.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(L.FRAG_BUFFERED,this.onFragBuffered,this),e.on(L.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(L.LEVEL_LOADED,this.onLevelLoaded,this),e.off(L.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(L.FRAG_BUFFERED,this.onFragBuffered,this),e.off(L.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(t=>{t.loadError=0,t.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){const s=this.hls.config.preferManagedMediaSource,n=[],r={},l={};let c=!1,h=!1,u=!1;t.levels.forEach(f=>{const p=f.attrs;let{audioCodec:v,videoCodec:x}=f;v&&(f.audioCodec=v=hu(v,s)||void 0),x&&(x=f.videoCodec=j1(x));const{width:S,height:E,unknownCodecs:T}=f,A=T?.length||0;if(c||(c=!!(S&&E)),h||(h=!!x),u||(u=!!v),A||v&&!this.isAudioSupported(v)||x&&!this.isVideoSupported(x)){this.log(`Some or all CODECS not supported "${p.CODECS}"`);return}const{CODECS:I,"FRAME-RATE":_,"HDCP-LEVEL":C,"PATHWAY-ID":k,RESOLUTION:U,"VIDEO-RANGE":O}=p,j=`${`${k||"."}-`}${f.bitrate}-${U}-${_}-${I}-${O}-${C}`;if(r[j])if(r[j].uri!==f.url&&!f.attrs["PATHWAY-ID"]){const M=l[j]+=1;f.attrs["PATHWAY-ID"]=new Array(M+1).join(".");const H=this.createLevel(f);r[j]=H,n.push(H)}else r[j].addGroupId("audio",p.AUDIO),r[j].addGroupId("text",p.SUBTITLES);else{const M=this.createLevel(f);r[j]=M,l[j]=1,n.push(M)}}),this.filterAndSortMediaOptions(n,t,c,h,u)}createLevel(e){const t=new Zl(e),s=e.supplemental;if(s!=null&&s.videoCodec&&!this.isVideoSupported(s.videoCodec)){const n=new Error(`SUPPLEMENTAL-CODECS not supported "${s.videoCodec}"`);this.log(n.message),t.supportedResult=PS(n,[])}return t}isAudioSupported(e){return Wl(e,"audio",this.hls.config.preferManagedMediaSource)}isVideoSupported(e){return Wl(e,"video",this.hls.config.preferManagedMediaSource)}filterAndSortMediaOptions(e,t,s,n,r){var l;let c=[],h=[],u=e;const f=((l=t.stats)==null?void 0:l.parsing)||{};if((s||n)&&r&&(u=u.filter(({videoCodec:I,videoRange:_,width:C,height:k})=>(!!I||!!(C&&k))&&q1(_))),u.length===0){Promise.resolve().then(()=>{if(this.hls){let I="no level with compatible codecs found in manifest",_=I;t.levels.length&&(_=`one or more CODECS in variant not supported: ${Ot(t.levels.map(k=>k.attrs.CODECS).filter((k,U,O)=>O.indexOf(k)===U))}`,this.warn(_),I+=` (${_})`);const C=new Error(I);this.hls.trigger(L.ERROR,{type:Fe.MEDIA_ERROR,details:Q.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:C,reason:_})}}),f.end=performance.now();return}t.audioTracks&&(c=t.audioTracks.filter(I=>!I.audioCodec||this.isAudioSupported(I.audioCodec)),Ix(c)),t.subtitles&&(h=t.subtitles,Ix(h));const p=u.slice(0);u.sort((I,_)=>{if(I.attrs["HDCP-LEVEL"]!==_.attrs["HDCP-LEVEL"])return(I.attrs["HDCP-LEVEL"]||"")>(_.attrs["HDCP-LEVEL"]||"")?1:-1;if(s&&I.height!==_.height)return I.height-_.height;if(I.frameRate!==_.frameRate)return I.frameRate-_.frameRate;if(I.videoRange!==_.videoRange)return fu.indexOf(I.videoRange)-fu.indexOf(_.videoRange);if(I.videoCodec!==_.videoCodec){const C=gy(I.videoCodec),k=gy(_.videoCodec);if(C!==k)return k-C}if(I.uri===_.uri&&I.codecSet!==_.codecSet){const C=du(I.codecSet),k=du(_.codecSet);if(C!==k)return k-C}return I.averageBitrate!==_.averageBitrate?I.averageBitrate-_.averageBitrate:0});let v=p[0];if(this.steering&&(u=this.steering.filterParsedLevels(u),u.length!==p.length)){for(let I=0;I<p.length;I++)if(p[I].pathwayId===u[0].pathwayId){v=p[I];break}}this._levels=u;for(let I=0;I<u.length;I++)if(u[I]===v){var x;this._firstLevel=I;const _=v.bitrate,C=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${u.length} level(s) found, first bitrate: ${_}`),((x=this.hls.userConfig)==null?void 0:x.abrEwmaDefaultEstimate)===void 0){const k=Math.min(_,this.hls.config.abrEwmaDefaultEstimateMax);k>C&&C===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=k)}break}const S=r&&!n,E=this.hls.config,T=!!(E.audioStreamController&&E.audioTrackController),A={levels:u,audioTracks:c,subtitleTracks:h,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:r,video:n,altAudio:T&&!S&&c.some(I=>!!I.url)};f.end=performance.now(),this.hls.trigger(L.MANIFEST_PARSED,A)}get levels(){return this._levels.length===0?null:this._levels}get loadLevelObj(){return this.currentLevel}get level(){return this.currentLevelIndex}set level(e){const t=this._levels;if(t.length===0)return;if(e<0||e>=t.length){const f=new Error("invalid level idx"),p=e<0;if(this.hls.trigger(L.ERROR,{type:Fe.OTHER_ERROR,details:Q.LEVEL_SWITCH_ERROR,level:e,fatal:p,error:f,reason:f.message}),p)return;e=Math.min(e,t.length-1)}const s=this.currentLevelIndex,n=this.currentLevel,r=n?n.attrs["PATHWAY-ID"]:void 0,l=t[e],c=l.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=l,s===e&&n&&r===c)return;this.log(`Switching to level ${e} (${l.height?l.height+"p ":""}${l.videoRange?l.videoRange+" ":""}${l.codecSet?l.codecSet+" ":""}@${l.bitrate})${c?" with Pathway "+c:""} from level ${s}${r?" with Pathway "+r:""}`);const h={level:e,attrs:l.attrs,details:l.details,bitrate:l.bitrate,averageBitrate:l.averageBitrate,maxBitrate:l.maxBitrate,realBitrate:l.realBitrate,width:l.width,height:l.height,codecSet:l.codecSet,audioCodec:l.audioCodec,videoCodec:l.videoCodec,audioGroups:l.audioGroups,subtitleGroups:l.subtitleGroups,loaded:l.loaded,loadError:l.loadError,fragmentError:l.fragmentError,name:l.name,id:l.id,uri:l.uri,url:l.url,urlId:0,audioGroupIds:l.audioGroupIds,textGroupIds:l.textGroupIds};this.hls.trigger(L.LEVEL_SWITCHING,h);const u=l.details;if(!u||u.live){const f=this.switchParams(l.uri,n?.details,u);this.loadPlaylist(f)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,this._startLevel===void 0&&(this._startLevel=e),e!==-1&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(this._startLevel===void 0){const e=this.hls.config.startLevel;return e!==void 0?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}get pathways(){return this.steering?this.steering.pathways():[]}get pathwayPriority(){return this.steering?this.steering.pathwayPriority:null}set pathwayPriority(e){if(this.steering){const t=this.steering.pathways(),s=e.filter(n=>t.indexOf(n)!==-1);if(e.length<1){this.warn(`pathwayPriority ${e} should contain at least one pathway from list: ${t}`);return}this.steering.pathwayPriority=s}}onError(e,t){t.fatal||!t.context||t.context.type===nt.LEVEL&&t.context.level===this.level&&this.checkRetry(t)}onFragBuffered(e,{frag:t}){if(t!==void 0&&t.type===ke.MAIN){const s=t.elementaryStreams;if(!Object.keys(s).some(r=>!!s[r]))return;const n=this._levels[t.level];n!=null&&n.loadError&&(this.log(`Resetting level error count of ${n.loadError} on frag buffered`),n.loadError=0)}}onLevelLoaded(e,t){var s;const{level:n,details:r}=t,l=t.levelInfo;if(!l){var c;this.warn(`Invalid level index ${n}`),(c=t.deliveryDirectives)!=null&&c.skip&&(r.deltaUpdateFailed=!0);return}if(l===this.currentLevel||t.withoutMultiVariant){l.fragmentError===0&&(l.loadError=0);let h=l.details;h===t.details&&h.advanced&&(h=void 0),this.playlistLoaded(n,t,h)}else(s=t.deliveryDirectives)!=null&&s.skip&&(r.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const s=this.getUrlWithDirectives(e.uri,t),n=this.currentLevelIndex,r=e.attrs["PATHWAY-ID"],l=e.details,c=l?.age;this.log(`Loading level index ${n}${t?.msn!==void 0?" at sn "+t.msn+" part "+t.part:""}${r?" Pathway "+r:""}${c&&l.live?" age "+c.toFixed(1)+(l.type&&" "+l.type||""):""} ${s}`),this.hls.trigger(L.LEVEL_LOADING,{url:s,level:n,levelInfo:e,pathwayId:e.attrs["PATHWAY-ID"],id:0,deliveryDirectives:t||null})}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=e)}removeLevel(e){var t;if(this._levels.length===1)return;const s=this._levels.filter((r,l)=>l!==e?!0:(this.steering&&this.steering.removeLevel(r),r===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,r.details&&r.details.fragments.forEach(c=>c.level=-1)),!1));sb(s),this._levels=s,this.currentLevelIndex>-1&&(t=this.currentLevel)!=null&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);const n=s.length-1;this._firstLevel=Math.min(this._firstLevel,n),this._startLevel&&(this._startLevel=Math.min(this._startLevel,n)),this.hls.trigger(L.LEVELS_UPDATED,{levels:s})}onLevelsUpdated(e,{levels:t}){this._levels=t}checkMaxAutoUpdated(){const{autoLevelCapping:e,maxAutoLevel:t,maxHdcpLevel:s}=this.hls;this._maxAutoLevel!==t&&(this._maxAutoLevel=t,this.hls.trigger(L.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:t,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:s}))}}function Ix(i){const e={};i.forEach(t=>{const s=t.groupId||"";t.id=e[s]=e[s]||0,e[s]++})}function Xb(){return self.SourceBuffer||self.WebKitSourceBuffer}function Zb(){if(!ya())return!1;const e=Xb();return!e||e.prototype&&typeof e.prototype.appendBuffer=="function"&&typeof e.prototype.remove=="function"}function ik(){if(!Zb())return!1;const i=ya();return typeof i?.isTypeSupported=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(e=>i.isTypeSupported(Xl(e,"video")))||["mp4a.40.2","fLaC"].some(e=>i.isTypeSupported(Xl(e,"audio"))))}function nk(){var i;const e=Xb();return typeof(e==null||(i=e.prototype)==null?void 0:i.changeType)=="function"}const ak=100;class rk extends Am{constructor(e,t,s){super(e,t,s,"stream-controller",ke.MAIN),this.audioCodecSwap=!1,this.level=-1,this._forceStartLoad=!1,this._hasEnoughToStart=!1,this.altAudio=0,this.audioOnly=!1,this.fragPlaying=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this.onMediaPlaying=()=>{this.tick()},this.onMediaSeeked=()=>{const n=this.media,r=n?n.currentTime:null;if(r===null||!Oe(r)||(this.log(`Media seeked to ${r.toFixed(3)}`),!this.getBufferedFrag(r)))return;const l=this.getFwdBufferInfoAtPos(n,r,ke.MAIN,0);if(l===null||l.len===0){this.warn(`Main forward buffer length at ${r} on "seeked" event ${l?l.len:"empty"})`);return}this.tick()},this.registerListeners()}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(L.MANIFEST_PARSED,this.onManifestParsed,this),e.on(L.LEVEL_LOADING,this.onLevelLoading,this),e.on(L.LEVEL_LOADED,this.onLevelLoaded,this),e.on(L.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(L.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(L.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(L.BUFFER_CREATED,this.onBufferCreated,this),e.on(L.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(L.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(L.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(L.MANIFEST_PARSED,this.onManifestParsed,this),e.off(L.LEVEL_LOADED,this.onLevelLoaded,this),e.off(L.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(L.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(L.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(L.BUFFER_CREATED,this.onBufferCreated,this),e.off(L.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(L.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(L.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),super.onHandlerDestroying()}startLoad(e,t){if(this.levels){const{lastCurrentTime:s,hls:n}=this;if(this.stopLoad(),this.setInterval(ak),this.level=-1,!this.startFragRequested){let r=n.startLevel;r===-1&&(n.config.testBandwidth&&this.levels.length>1?(r=0,this.bitrateTest=!0):r=n.firstAutoLevel),n.nextLoadLevel=r,this.level=n.loadLevel,this._hasEnoughToStart=!!t}s>0&&e===-1&&!t&&(this.log(`Override startPosition with lastCurrentTime @${s.toFixed(3)}`),e=s),this.state=ce.IDLE,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}else this._forceStartLoad=!0,this.state=ce.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case ce.WAITING_LEVEL:{const{levels:e,level:t}=this,s=e?.[t],n=s?.details;if(n&&(!n.live||this.levelLastLoaded===s&&!this.waitForLive(s))){if(this.waitForCdnTuneIn(n))break;this.state=ce.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=ce.IDLE;break}break}case ce.FRAG_LOADING_WAITING_RETRY:this.checkRetryDate();break}this.state===ce.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){var e;super.onTickEnd(),(e=this.media)!=null&&e.readyState&&this.media.seeking===!1&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:t,levels:s,media:n}=this;if(t===null||!n&&!this.primaryPrefetch&&(this.startFragRequested||!e.config.startFragPrefetch)||this.altAudio&&this.audioOnly)return;const r=this.buffering?e.nextLoadLevel:e.loadLevel;if(!(s!=null&&s[r]))return;const l=s[r],c=this.getMainFwdBufferInfo();if(c===null)return;const h=this.getLevelDetails();if(h&&this._streamEnded(c,h)){const E={};this.altAudio===2&&(E.type="video"),this.hls.trigger(L.BUFFER_EOS,E),this.state=ce.ENDED;return}if(!this.buffering)return;e.loadLevel!==r&&e.manualLevel===-1&&this.log(`Adapting to level ${r} from level ${this.level}`),this.level=e.nextLoadLevel=r;const u=l.details;if(!u||this.state===ce.WAITING_LEVEL||this.waitForLive(l)){this.level=r,this.state=ce.WAITING_LEVEL,this.startFragRequested=!1;return}const f=c.len,p=this.getMaxBufferLength(l.maxBitrate);if(f>=p)return;this.backtrackFragment&&this.backtrackFragment.start>c.end&&(this.backtrackFragment=null);const v=this.backtrackFragment?this.backtrackFragment.start:c.end;let x=this.getNextFragment(v,u);if(this.couldBacktrack&&!this.fragPrevious&&x&&es(x)&&this.fragmentTracker.getState(x)!==hs.OK){var S;const T=((S=this.backtrackFragment)!=null?S:x).sn-u.startSN,A=u.fragments[T-1];A&&x.cc===A.cc&&(x=A,this.fragmentTracker.removeFragment(A))}else this.backtrackFragment&&c.len&&(this.backtrackFragment=null);if(x&&this.isLoopLoading(x,v)){if(!x.gap){const T=this.audioOnly&&!this.altAudio?Ct.AUDIO:Ct.VIDEO,A=(T===Ct.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;A&&this.afterBufferFlushed(A,T,ke.MAIN)}x=this.getNextFragmentLoopLoading(x,u,c,ke.MAIN,p)}x&&(x.initSegment&&!x.initSegment.data&&!this.bitrateTest&&(x=x.initSegment),this.loadFragment(x,l,v))}loadFragment(e,t,s){const n=this.fragmentTracker.getState(e);n===hs.NOT_LOADED||n===hs.PARTIAL?es(e)?this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):super.loadFragment(e,t,s):this._loadInitSegment(e,t):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,ke.MAIN)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:t}=this;if(t!=null&&t.readyState){let s;const n=this.getAppendedFrag(t.currentTime);n&&n.start>1&&this.flushMainBuffer(0,n.start-1);const r=this.getLevelDetails();if(r!=null&&r.live){const c=this.getMainFwdBufferInfo();if(!c||c.len<r.targetduration*2)return}if(!t.paused&&e){const c=this.hls.nextLoadLevel,h=e[c],u=this.fragLastKbps;u&&this.fragCurrent?s=this.fragCurrent.duration*h.maxBitrate/(1e3*u)+1:s=0}else s=0;const l=this.getBufferedFrag(t.currentTime+s);if(l){const c=this.followingBufferedFrag(l);if(c){this.abortCurrentFrag();const h=c.maxStartPTS?c.maxStartPTS:c.start,u=c.duration,f=Math.max(l.end,h+Math.min(Math.max(u-this.config.maxFragLookUpTolerance,u*(this.couldBacktrack?.5:.125)),u*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(f,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case ce.KEY_LOADING:case ce.FRAG_LOADING:case ce.FRAG_LOADING_WAITING_RETRY:case ce.PARSING:case ce.PARSED:this.state=ce.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,this.altAudio===2?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);const s=t.media;Fs(s,"playing",this.onMediaPlaying),Fs(s,"seeked",this.onMediaSeeked)}onMediaDetaching(e,t){const{media:s}=this;s&&(Xs(s,"playing",this.onMediaPlaying),Xs(s,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,super.onMediaDetaching(e,t),!t.transferMedia&&(this._hasEnoughToStart=!1)}onManifestLoading(){super.onManifestLoading(),this.log("Trigger BUFFER_RESET"),this.hls.trigger(L.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1}onManifestParsed(e,t){let s=!1,n=!1;for(let r=0;r<t.levels.length;r++){const l=t.levels[r].audioCodec;l&&(s=s||l.indexOf("mp4a.40.2")!==-1,n=n||l.indexOf("mp4a.40.5")!==-1)}this.audioCodecSwitch=s&&n&&!nk(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){const{levels:s}=this;if(!s||this.state!==ce.IDLE)return;const n=t.levelInfo;(!n.details||n.details.live&&(this.levelLastLoaded!==n||n.details.expired)||this.waitForCdnTuneIn(n.details))&&(this.state=ce.WAITING_LEVEL)}onLevelLoaded(e,t){var s;const{levels:n,startFragRequested:r}=this,l=t.level,c=t.details,h=c.totalduration;if(!n){this.warn(`Levels were reset while loading level ${l}`);return}this.log(`Level ${l} loaded [${c.startSN},${c.endSN}]${c.lastPartSn?`[part-${c.lastPartSn}-${c.lastPartIndex}]`:""}, cc [${c.startCC}, ${c.endCC}] duration:${h}`);const u=t.levelInfo,f=this.fragCurrent;f&&(this.state===ce.FRAG_LOADING||this.state===ce.FRAG_LOADING_WAITING_RETRY)&&f.level!==t.level&&f.loader&&this.abortCurrentFrag();let p=0;if(c.live||(s=u.details)!=null&&s.live){var v;if(this.checkLiveUpdate(c),c.deltaUpdateFailed)return;p=this.alignPlaylists(c,u.details,(v=this.levelLastLoaded)==null?void 0:v.details)}if(u.details=c,this.levelLastLoaded=u,r||this.setStartPosition(c,p),this.hls.trigger(L.LEVEL_UPDATED,{details:c,level:l}),this.state===ce.WAITING_LEVEL){if(this.waitForCdnTuneIn(c))return;this.state=ce.IDLE}r&&c.live&&this.synchronizeToLiveEdge(c),this.tick()}synchronizeToLiveEdge(e){const{config:t,media:s}=this;if(!s)return;const n=this.hls.liveSyncPosition,r=this.getLoadPosition(),l=e.fragmentStart,c=e.edge,h=r>=l-t.maxFragLookUpTolerance&&r<=c;if(n!==null&&s.duration>n&&(r<n||!h)){const f=t.liveMaxLatencyDuration!==void 0?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;if((!h&&s.readyState<4||r<c-f)&&(this._hasEnoughToStart||(this.nextLoadPosition=n),s.readyState))if(this.warn(`Playback: ${r.toFixed(3)} is located too far from the end of live sliding playlist: ${c}, reset currentTime to : ${n.toFixed(3)}`),this.config.liveSyncMode==="buffered"){var u;const p=qe.bufferInfo(s,n,0);if(!((u=p.buffered)!=null&&u.length)){s.currentTime=n;return}if(p.start<=r){s.currentTime=n;return}const{nextStart:x}=qe.bufferedInfo(p.buffered,r,0);x&&(s.currentTime=x)}else s.currentTime=n}}_handleFragmentLoadProgress(e){var t;const s=e.frag,{part:n,payload:r}=e,{levels:l}=this;if(!l){this.warn(`Levels were reset while fragment load was in progress. Fragment ${s.sn} of level ${s.level} will not be buffered`);return}const c=l[s.level];if(!c){this.warn(`Level ${s.level} not found on progress`);return}const h=c.details;if(!h){this.warn(`Dropping fragment ${s.sn} of level ${s.level} after level details were reset`),this.fragmentTracker.removeFragment(s);return}const u=c.videoCodec,f=h.PTSKnown||!h.live,p=(t=s.initSegment)==null?void 0:t.data,v=this._getAudioCodec(c),x=this.transmuxer=this.transmuxer||new Ab(this.hls,ke.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),S=n?n.index:-1,E=S!==-1,T=new bm(s.level,s.sn,s.stats.chunkCount,r.byteLength,S,E),A=this.initPTS[s.cc];x.push(r,p,v,u,s,n,h.totalduration,f,T,A)}onAudioTrackSwitching(e,t){const s=this.hls,n=this.altAudio!==0;if(mu(t.url,s))this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const l=this.fragCurrent;l&&(this.log("Switching to main audio track, cancel main fragment load"),l.abortRequests(),this.fragmentTracker.removeFragment(l)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(n){this.altAudio=0,this.fragmentTracker.removeAllFragments(),s.once(L.BUFFER_FLUSHED,()=>{this.hls&&this.hls.trigger(L.AUDIO_TRACK_SWITCHED,t)}),s.trigger(L.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});return}s.trigger(L.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){const s=mu(t.url,this.hls);if(s){const n=this.videoBuffer;n&&this.mediaBuffer!==n&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=n)}this.altAudio=s?2:0,this.tick()}onBufferCreated(e,t){const s=t.tracks;let n,r,l=!1;for(const c in s){const h=s[c];if(h.id==="main"){if(r=c,n=h,c==="video"){const u=s[c];u&&(this.videoBuffer=u.buffer)}}else l=!0}l&&n?(this.log(`Alternate track found, use ${r}.buffered to schedule main fragment loading`),this.mediaBuffer=n.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){const{frag:s,part:n}=t,r=s.type===ke.MAIN;if(r){if(this.fragContextChanged(s)){this.warn(`Fragment ${s.sn}${n?" p: "+n.index:""} of level ${s.level} finished buffering, but was aborted. state: ${this.state}`),this.state===ce.PARSED&&(this.state=ce.IDLE);return}const c=n?n.stats:s.stats;this.fragLastKbps=Math.round(8*c.total/(c.buffering.end-c.loading.first)),es(s)&&(this.fragPrevious=s),this.fragBufferedComplete(s,n)}const l=this.media;l&&(!this._hasEnoughToStart&&qe.getBuffered(l).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),r&&this.tick())}get hasEnoughToStart(){return this._hasEnoughToStart}onError(e,t){var s;if(t.fatal){this.state=ce.ERROR;return}switch(t.details){case Q.FRAG_GAP:case Q.FRAG_PARSING_ERROR:case Q.FRAG_DECRYPT_ERROR:case Q.FRAG_LOAD_ERROR:case Q.FRAG_LOAD_TIMEOUT:case Q.KEY_LOAD_ERROR:case Q.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(ke.MAIN,t);break;case Q.LEVEL_LOAD_ERROR:case Q.LEVEL_LOAD_TIMEOUT:case Q.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===ce.WAITING_LEVEL&&((s=t.context)==null?void 0:s.type)===nt.LEVEL&&(this.state=ce.IDLE);break;case Q.BUFFER_ADD_CODEC_ERROR:case Q.BUFFER_APPEND_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&this.resetLoadingState();break;case Q.BUFFER_FULL_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&(!this.config.interstitialsController&&this.config.assetPlayerId?this._hasEnoughToStart=!0:this.flushMainBuffer(0,Number.POSITIVE_INFINITY));break;case Q.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onFragLoadEmergencyAborted(){this.state=ce.IDLE,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()}onBufferFlushed(e,{type:t}){if(t!==Ct.AUDIO||!this.altAudio){const s=(t===Ct.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;s&&(this.afterBufferFlushed(s,t,ke.MAIN),this.tick())}}onLevelsUpdated(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,this.level===-1&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const t=e.currentTime;let s=this.startPosition;if(s>=0&&t<s){if(e.seeking){this.log(`could not seek to ${s}, already seeking at ${t}`);return}const n=this.timelineOffset;n&&s&&(s+=n);const r=this.getLevelDetails(),l=qe.getBuffered(e),c=l.length?l.start(0):0,h=c-s,u=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);(this.config.startOnSegmentBoundary||h>0&&(h<u||this.loadingParts&&h<2*(r?.partTarget||0)))&&(this.log(`adjusting start position by ${h} to match buffer start`),s+=h,this.startPosition=s),t<s&&(this.log(`seek to target start position ${s} from current time ${t} buffer start ${c}`),e.currentTime=s)}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t.indexOf("mp4a.40.5")!==-1?t="mp4a.40.2":t="mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then(s=>{const{hls:n}=this,r=s?.frag;if(!r||this.fragContextChanged(r))return;t.fragmentError=0,this.state=ce.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const l=r.stats;l.parsing.start=l.parsing.end=l.buffering.start=l.buffering.end=self.performance.now(),n.trigger(L.FRAG_LOADED,s),r.bitrateTest=!1}).catch(s=>{this.state===ce.STOPPED||this.state===ce.ERROR||(this.warn(s),this.resetFragmentLoading(e))})}_handleTransmuxComplete(e){const t=this.playlistType,{hls:s}=this,{remuxResult:n,chunkMeta:r}=e,l=this.getCurrentContext(r);if(!l){this.resetWhenMissingContext(r);return}const{frag:c,part:h,level:u}=l,{video:f,text:p,id3:v,initSegment:x}=n,{details:S}=u,E=this.altAudio?void 0:n.audio;if(this.fragContextChanged(c)){this.fragmentTracker.removeFragment(c);return}if(this.state=ce.PARSING,x){const T=x.tracks;if(T){const C=c.initSegment||c;if(this.unhandledEncryptionError(x,c))return;this._bufferInitSegment(u,T,C,r),s.trigger(L.FRAG_PARSING_INIT_SEGMENT,{frag:C,id:t,tracks:T})}const A=x.initPTS,I=x.timescale,_=this.initPTS[c.cc];if(Oe(A)&&(!_||_.baseTime!==A||_.timescale!==I)){const C=x.trackId;this.initPTS[c.cc]={baseTime:A,timescale:I,trackId:C},s.trigger(L.INIT_PTS_FOUND,{frag:c,id:t,initPTS:A,timescale:I,trackId:C})}}if(f&&S){E&&f.type==="audiovideo"&&this.logMuxedErr(c);const T=S.fragments[c.sn-1-S.startSN],A=c.sn===S.startSN,I=!T||c.cc>T.cc;if(n.independent!==!1){const{startPTS:_,endPTS:C,startDTS:k,endDTS:U}=f;if(h)h.elementaryStreams[f.type]={startPTS:_,endPTS:C,startDTS:k,endDTS:U};else if(f.firstKeyFrame&&f.independent&&r.id===1&&!I&&(this.couldBacktrack=!0),f.dropped&&f.independent){const O=this.getMainFwdBufferInfo(),F=(O?O.end:this.getLoadPosition())+this.config.maxBufferHole,j=f.firstKeyFramePTS?f.firstKeyFramePTS:_;if(!A&&F<j-this.config.maxBufferHole&&!I){this.backtrack(c);return}else I&&(c.gap=!0);c.setElementaryStreamInfo(f.type,c.start,C,c.start,U,!0)}else A&&_-(S.appliedTimelineOffset||0)>au&&(c.gap=!0);c.setElementaryStreamInfo(f.type,_,C,k,U),this.backtrackFragment&&(this.backtrackFragment=c),this.bufferFragmentData(f,c,h,r,A||I)}else if(A||I)c.gap=!0;else{this.backtrack(c);return}}if(E){const{startPTS:T,endPTS:A,startDTS:I,endDTS:_}=E;h&&(h.elementaryStreams[Ct.AUDIO]={startPTS:T,endPTS:A,startDTS:I,endDTS:_}),c.setElementaryStreamInfo(Ct.AUDIO,T,A,I,_),this.bufferFragmentData(E,c,h,r)}if(S&&v!=null&&v.samples.length){const T={id:t,frag:c,details:S,samples:v.samples};s.trigger(L.FRAG_PARSING_METADATA,T)}if(S&&p){const T={id:t,frag:c,details:S,samples:p.samples};s.trigger(L.FRAG_PARSING_USERDATA,T)}}logMuxedErr(e){this.warn(`${es(e)?"Media":"Init"} segment with muxed audiovideo where only video expected: ${e.url}`)}_bufferInitSegment(e,t,s,n){if(this.state!==ce.PARSING)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&(delete t.audio,t.audiovideo&&this.logMuxedErr(s));const{audio:r,video:l,audiovideo:c}=t;if(r){const u=e.audioCodec;let f=Zc(r.codec,u);f==="mp4a"&&(f="mp4a.40.5");const p=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){f&&(f.indexOf("mp4a.40.5")!==-1?f="mp4a.40.2":f="mp4a.40.5");const v=r.metadata;v&&"channelCount"in v&&(v.channelCount||1)!==1&&p.indexOf("firefox")===-1&&(f="mp4a.40.5")}f&&f.indexOf("mp4a.40.5")!==-1&&p.indexOf("android")!==-1&&r.container!=="audio/mpeg"&&(f="mp4a.40.2",this.log(`Android: force audio codec to ${f}`)),u&&u!==f&&this.log(`Swapping manifest audio codec "${u}" for "${f}"`),r.levelCodec=f,r.id=ke.MAIN,this.log(`Init audio buffer, container:${r.container}, codecs[selected/level/parsed]=[${f||""}/${u||""}/${r.codec}]`),delete t.audiovideo}if(l){l.levelCodec=e.videoCodec,l.id=ke.MAIN;const u=l.codec;if(u?.length===4)switch(u){case"hvc1":case"hev1":l.codec="hvc1.1.6.L120.90";break;case"av01":l.codec="av01.0.04M.08";break;case"avc1":l.codec="avc1.42e01e";break}this.log(`Init video buffer, container:${l.container}, codecs[level/parsed]=[${e.videoCodec||""}/${u}]${l.codec!==u?" parsed-corrected="+l.codec:""}${l.supplemental?" supplemental="+l.supplemental:""}`),delete t.audiovideo}c&&(this.log(`Init audiovideo buffer, container:${c.container}, codecs[level/parsed]=[${e.codecs}/${c.codec}]`),delete t.video,delete t.audio);const h=Object.keys(t);if(h.length){if(this.hls.trigger(L.BUFFER_CODECS,t),!this.hls)return;h.forEach(u=>{const p=t[u].initSegment;p!=null&&p.byteLength&&this.hls.trigger(L.BUFFER_APPENDING,{type:u,data:p,frag:s,part:null,chunkMeta:n,parent:s.type})})}this.tickImmediate()}getMainFwdBufferInfo(){const e=this.mediaBuffer&&this.altAudio===2?this.mediaBuffer:this.media;return this.getFwdBufferInfo(e,ke.MAIN)}get maxBufferLength(){const{levels:e,level:t}=this,s=e?.[t];return s?this.getMaxBufferLength(s.maxBitrate):this.config.maxBufferLength}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=ce.IDLE}checkFragmentChanged(){const e=this.media;let t=null;if(e&&e.readyState>1&&e.seeking===!1){const s=e.currentTime;if(qe.isBuffered(e,s)?t=this.getAppendedFrag(s):qe.isBuffered(e,s+.1)&&(t=this.getAppendedFrag(s+.1)),t){this.backtrackFragment=null;const n=this.fragPlaying,r=t.level;(!n||t.sn!==n.sn||n.level!==r)&&(this.fragPlaying=t,this.hls.trigger(L.FRAG_CHANGED,{frag:t}),(!n||n.level!==r)&&this.hls.trigger(L.LEVEL_SWITCHED,{level:r}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){var e;if(this.fragPlaying)return this.fragPlaying;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;return Oe(t)?this.getAppendedFrag(t):null}get currentProgramDateTime(){var e;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;if(Oe(t)){const s=this.getLevelDetails(),n=this.currentFrag||(s?za(null,s.fragments,t):null);if(n){const r=n.programDateTime;if(r!==null){const l=r+(t-n.start)*1e3;return new Date(l)}}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class lk extends Pi{constructor(e,t){super("key-loader",t),this.config=void 0,this.keyIdToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const s in this.keyIdToKeyInfo){const n=this.keyIdToKeyInfo[s].loader;if(n){var t;if(e&&e!==((t=n.context)==null?void 0:t.frag.type))return;n.abort()}}}detach(){for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyIdToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e].loader;t&&t.destroy()}this.keyIdToKeyInfo={}}createKeyLoadError(e,t=Q.KEY_LOAD_ERROR,s,n,r){return new Nn({type:Fe.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:r,error:s,networkDetails:n})}loadClear(e,t,s){if(this.emeController&&this.config.emeEnabled&&!this.emeController.getSelectedKeySystemFormats().length){if(t.length)for(let n=0,r=t.length;n<r;n++){const l=t[n];if(e.cc<=l.cc&&(!es(e)||!es(l)||e.sn<l.sn)||!s&&n==r-1)return this.emeController.selectKeySystemFormat(l).then(c=>{if(!this.emeController)return;l.setKeyFormat(c);const h=eu(c);if(h)return this.emeController.getKeySystemAccess([h])})}if(this.config.requireKeySystemAccessOnStart){const n=zl(this.config);if(n.length)return this.emeController.getKeySystemAccess(n)}}return null}load(e){return!e.decryptdata&&e.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(e).then(t=>this.loadInternal(e,t)):this.loadInternal(e)}loadInternal(e,t){var s,n;t&&e.setKeyFormat(t);const r=e.decryptdata;if(!r){const u=new Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:`Missing decryption data on fragment in onKeyLoading (emeEnabled with controller: ${this.emeController&&this.config.emeEnabled})`);return Promise.reject(this.createKeyLoadError(e,Q.KEY_LOAD_ERROR,u))}const l=r.uri;if(!l)return Promise.reject(this.createKeyLoadError(e,Q.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${l}"`)));const c=Af(r);let h=this.keyIdToKeyInfo[c];if((s=h)!=null&&s.decryptdata.key)return r.key=h.decryptdata.key,Promise.resolve({frag:e,keyInfo:h});if(this.emeController&&(n=h)!=null&&n.keyLoadPromise)switch(this.emeController.getKeyStatus(h.decryptdata)){case"usable":case"usable-in-future":return h.keyLoadPromise.then(f=>{const{keyInfo:p}=f;return r.key=p.decryptdata.key,{frag:e,keyInfo:p}})}switch(this.log(`${this.keyIdToKeyInfo[c]?"Rel":"L"}oading${r.keyId?" keyId: "+Ls(r.keyId):""} URI: ${r.uri} from ${e.type} ${e.level}`),h=this.keyIdToKeyInfo[c]={decryptdata:r,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},r.method){case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return r.keyFormat==="identity"?this.loadKeyHTTP(h,e):this.loadKeyEME(h,e);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(h,e);default:return Promise.reject(this.createKeyLoadError(e,Q.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${r.method}"`)))}}loadKeyEME(e,t){const s={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){var n;if(!e.decryptdata.keyId&&(n=t.initSegment)!=null&&n.data){const l=_1(t.initSegment.data);if(l.length){let c=l[0];c.some(h=>h!==0)?(this.log(`Using keyId found in init segment ${Ls(c)}`),ga.setKeyIdForUri(e.decryptdata.uri,c)):(c=ga.addKeyIdForUri(e.decryptdata.uri),this.log(`Generating keyId to patch media ${Ls(c)}`)),e.decryptdata.keyId=c}}if(!e.decryptdata.keyId&&!es(t))return Promise.resolve(s);const r=this.emeController.loadKey(s);return(e.keyLoadPromise=r.then(l=>(e.mediaKeySessionContext=l,s))).catch(l=>{throw e.keyLoadPromise=null,"data"in l&&(l.data.frag=t),l})}return Promise.resolve(s)}loadKeyHTTP(e,t){const s=this.config,n=s.loader,r=new n(s);return t.keyLoader=e.loader=r,e.keyLoadPromise=new Promise((l,c)=>{const h={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},u=s.keyLoadPolicy.default,f={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},p={onSuccess:(v,x,S,E)=>{const{frag:T,keyInfo:A}=S,I=Af(A.decryptdata);if(!T.decryptdata||A!==this.keyIdToKeyInfo[I])return c(this.createKeyLoadError(T,Q.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),E));A.decryptdata.key=T.decryptdata.key=new Uint8Array(v.data),T.keyLoader=null,A.loader=null,l({frag:T,keyInfo:A})},onError:(v,x,S,E)=>{this.resetLoader(x),c(this.createKeyLoadError(t,Q.KEY_LOAD_ERROR,new Error(`HTTP Error ${v.code} loading key ${v.text}`),S,xt({url:h.url,data:void 0},v)))},onTimeout:(v,x,S)=>{this.resetLoader(x),c(this.createKeyLoadError(t,Q.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),S))},onAbort:(v,x,S)=>{this.resetLoader(x),c(this.createKeyLoadError(t,Q.INTERNAL_ABORTED,new Error("key loading aborted"),S))}};r.load(h,f,p)})}resetLoader(e){const{frag:t,keyInfo:s,url:n}=e,r=s.loader;t.keyLoader===r&&(t.keyLoader=null,s.loader=null);const l=Af(s.decryptdata)||n;delete this.keyIdToKeyInfo[l],r&&r.destroy()}}function Af(i){if(i.keyFormat!==ws.FAIRPLAY){const e=i.keyId;if(e)return Ls(e)}return i.uri}function _x(i){const{type:e}=i;switch(e){case nt.AUDIO_TRACK:return ke.AUDIO;case nt.SUBTITLE_TRACK:return ke.SUBTITLE;default:return ke.MAIN}}function If(i,e){let t=i.url;return(t===void 0||t.indexOf("data:")===0)&&(t=e.url),t}class ok{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.LEVEL_LOADING,this.onLevelLoading,this),e.on(L.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(L.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.on(L.LEVELS_UPDATED,this.onLevelsUpdated,this)}unregisterListeners(){const{hls:e}=this;e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.LEVEL_LOADING,this.onLevelLoading,this),e.off(L.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(L.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.off(L.LEVELS_UPDATED,this.onLevelsUpdated,this)}createInternalLoader(e){const t=this.hls.config,s=t.pLoader,n=t.loader,r=s||n,l=new r(t);return this.loaders[e.type]=l,l}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){const{url:s}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:nt.MANIFEST,url:s,deliveryDirectives:null,levelOrTrack:null})}onLevelLoading(e,t){const{id:s,level:n,pathwayId:r,url:l,deliveryDirectives:c,levelInfo:h}=t;this.load({id:s,level:n,pathwayId:r,responseType:"text",type:nt.LEVEL,url:l,deliveryDirectives:c,levelOrTrack:h})}onAudioTrackLoading(e,t){const{id:s,groupId:n,url:r,deliveryDirectives:l,track:c}=t;this.load({id:s,groupId:n,level:null,responseType:"text",type:nt.AUDIO_TRACK,url:r,deliveryDirectives:l,levelOrTrack:c})}onSubtitleTrackLoading(e,t){const{id:s,groupId:n,url:r,deliveryDirectives:l,track:c}=t;this.load({id:s,groupId:n,level:null,responseType:"text",type:nt.SUBTITLE_TRACK,url:r,deliveryDirectives:l,levelOrTrack:c})}onLevelsUpdated(e,t){const s=this.loaders[nt.LEVEL];if(s){const n=s.context;n&&!t.levels.some(r=>r===n.levelOrTrack)&&(s.abort(),delete this.loaders[nt.LEVEL])}}load(e){var t;const s=this.hls.config;let n=this.getInternalLoader(e);if(n){const u=this.hls.logger,f=n.context;if(f&&f.levelOrTrack===e.levelOrTrack&&(f.url===e.url||f.deliveryDirectives&&!e.deliveryDirectives)){f.url===e.url?u.log(`[playlist-loader]: ignore ${e.url} ongoing request`):u.log(`[playlist-loader]: ignore ${e.url} in favor of ${f.url}`);return}u.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),n.abort()}let r;if(e.type===nt.MANIFEST?r=s.manifestLoadPolicy.default:r=Lt({},s.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),n=this.createInternalLoader(e),Oe((t=e.deliveryDirectives)==null?void 0:t.part)){let u;if(e.type===nt.LEVEL&&e.level!==null?u=this.hls.levels[e.level].details:e.type===nt.AUDIO_TRACK&&e.id!==null?u=this.hls.audioTracks[e.id].details:e.type===nt.SUBTITLE_TRACK&&e.id!==null&&(u=this.hls.subtitleTracks[e.id].details),u){const f=u.partTarget,p=u.targetduration;if(f&&p){const v=Math.max(f*3,p*.8)*1e3;r=Lt({},r,{maxTimeToFirstByteMs:Math.min(v,r.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(v,r.maxTimeToFirstByteMs)})}}}const l=r.errorRetry||r.timeoutRetry||{},c={loadPolicy:r,timeout:r.maxLoadTimeMs,maxRetry:l.maxNumRetry||0,retryDelay:l.retryDelayMs||0,maxRetryDelay:l.maxRetryDelayMs||0},h={onSuccess:(u,f,p,v)=>{const x=this.getInternalLoader(p);this.resetInternalLoader(p.type);const S=u.data;f.parsing.start=performance.now(),rn.isMediaPlaylist(S)||p.type!==nt.MANIFEST?this.handleTrackOrLevelPlaylist(u,f,p,v||null,x):this.handleMasterPlaylist(u,f,p,v)},onError:(u,f,p,v)=>{this.handleNetworkError(f,p,!1,u,v)},onTimeout:(u,f,p)=>{this.handleNetworkError(f,p,!0,void 0,u)}};n.load(e,c,h)}checkAutostartLoad(){if(!this.hls)return;const{config:{autoStartLoad:e,startPosition:t},forceStartLoad:s}=this.hls;(e||s)&&(this.hls.logger.log(`${e?"auto":"force"} startLoad with configured startPosition ${t}`),this.hls.startLoad(t))}handleMasterPlaylist(e,t,s,n){const r=this.hls,l=e.data,c=If(e,s),h=rn.parseMasterPlaylist(l,c);if(h.playlistParsingError){t.parsing.end=performance.now(),this.handleManifestParsingError(e,s,h.playlistParsingError,n,t);return}const{contentSteering:u,levels:f,sessionData:p,sessionKeys:v,startTimeOffset:x,variableList:S}=h;this.variableList=S,f.forEach(I=>{const{unknownCodecs:_}=I;if(_){const{preferManagedMediaSource:C}=this.hls.config;let{audioCodec:k,videoCodec:U}=I;for(let O=_.length;O--;){const F=_[O];Wl(F,"audio",C)?(I.audioCodec=k=k?`${k},${F}`:F,Gr.audio[k.substring(0,4)]=2,_.splice(O,1)):Wl(F,"video",C)&&(I.videoCodec=U=U?`${U},${F}`:F,Gr.video[U.substring(0,4)]=2,_.splice(O,1))}}});const{AUDIO:E=[],SUBTITLES:T,"CLOSED-CAPTIONS":A}=rn.parseMasterPlaylistMedia(l,c,h);E.length&&!E.some(_=>!_.url)&&f[0].audioCodec&&!f[0].attrs.AUDIO&&(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),E.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new $t({}),bitrate:0,url:""})),r.trigger(L.MANIFEST_LOADED,{levels:f,audioTracks:E,subtitles:T,captions:A,contentSteering:u,url:c,stats:t,networkDetails:n,sessionData:p,sessionKeys:v,startTimeOffset:x,variableList:S})}handleTrackOrLevelPlaylist(e,t,s,n,r){const l=this.hls,{id:c,level:h,type:u}=s,f=If(e,s),p=Oe(h)?h:Oe(c)?c:0,v=_x(s),x=rn.parseLevelPlaylist(e.data,f,p,v,0,this.variableList);if(u===nt.MANIFEST){const S={attrs:new $t({}),bitrate:0,details:x,name:"",url:f};x.requestScheduled=t.loading.start+JS(x,0),l.trigger(L.MANIFEST_LOADED,{levels:[S],audioTracks:[],url:f,stats:t,networkDetails:n,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),s.levelDetails=x,this.handlePlaylistLoaded(x,e,t,s,n,r)}handleManifestParsingError(e,t,s,n,r){this.hls.trigger(L.ERROR,{type:Fe.NETWORK_ERROR,details:Q.MANIFEST_PARSING_ERROR,fatal:t.type===nt.MANIFEST,url:e.url,err:s,error:s,reason:s.message,response:e,context:t,networkDetails:n,stats:r})}handleNetworkError(e,t,s=!1,n,r){let l=`A network ${s?"timeout":"error"+(n?" (status "+n.code+")":"")} occurred while loading ${e.type}`;e.type===nt.LEVEL?l+=`: ${e.level} id: ${e.id}`:(e.type===nt.AUDIO_TRACK||e.type===nt.SUBTITLE_TRACK)&&(l+=` id: ${e.id} group-id: "${e.groupId}"`);const c=new Error(l);this.hls.logger.warn(`[playlist-loader]: ${l}`);let h=Q.UNKNOWN,u=!1;const f=this.getInternalLoader(e);switch(e.type){case nt.MANIFEST:h=s?Q.MANIFEST_LOAD_TIMEOUT:Q.MANIFEST_LOAD_ERROR,u=!0;break;case nt.LEVEL:h=s?Q.LEVEL_LOAD_TIMEOUT:Q.LEVEL_LOAD_ERROR,u=!1;break;case nt.AUDIO_TRACK:h=s?Q.AUDIO_TRACK_LOAD_TIMEOUT:Q.AUDIO_TRACK_LOAD_ERROR,u=!1;break;case nt.SUBTITLE_TRACK:h=s?Q.SUBTITLE_TRACK_LOAD_TIMEOUT:Q.SUBTITLE_LOAD_ERROR,u=!1;break}f&&this.resetInternalLoader(e.type);const p={type:Fe.NETWORK_ERROR,details:h,fatal:u,url:e.url,loader:f,context:e,error:c,networkDetails:t,stats:r};if(n){const v=t?.url||e.url;p.response=xt({url:v,data:void 0},n)}this.hls.trigger(L.ERROR,p)}handlePlaylistLoaded(e,t,s,n,r,l){const c=this.hls,{type:h,level:u,levelOrTrack:f,id:p,groupId:v,deliveryDirectives:x}=n,S=If(t,n),E=_x(n);let T=typeof n.level=="number"&&E===ke.MAIN?u:void 0;const A=e.playlistParsingError;if(A){if(this.hls.logger.warn(`${A} ${e.url}`),!c.config.ignorePlaylistParsingErrors){c.trigger(L.ERROR,{type:Fe.NETWORK_ERROR,details:Q.LEVEL_PARSING_ERROR,fatal:!1,url:S,error:A,reason:A.message,response:t,context:n,level:T,parent:E,networkDetails:r,stats:s});return}e.playlistParsingError=null}if(!e.fragments.length){const I=e.playlistParsingError=new Error("No Segments found in Playlist");c.trigger(L.ERROR,{type:Fe.NETWORK_ERROR,details:Q.LEVEL_EMPTY_ERROR,fatal:!1,url:S,error:I,reason:I.message,response:t,context:n,level:T,parent:E,networkDetails:r,stats:s});return}switch(e.live&&l&&(l.getCacheAge&&(e.ageHeader=l.getCacheAge()||0),(!l.getCacheAge||isNaN(e.ageHeader))&&(e.ageHeader=0)),h){case nt.MANIFEST:case nt.LEVEL:if(T){if(!f)T=0;else if(f!==c.levels[T]){const I=c.levels.indexOf(f);I>-1&&(T=I)}}c.trigger(L.LEVEL_LOADED,{details:e,levelInfo:f||c.levels[0],level:T||0,id:p||0,stats:s,networkDetails:r,deliveryDirectives:x,withoutMultiVariant:h===nt.MANIFEST});break;case nt.AUDIO_TRACK:c.trigger(L.AUDIO_TRACK_LOADED,{details:e,track:f,id:p||0,groupId:v||"",stats:s,networkDetails:r,deliveryDirectives:x});break;case nt.SUBTITLE_TRACK:c.trigger(L.SUBTITLE_TRACK_LOADED,{details:e,track:f,id:p||0,groupId:v||"",stats:s,networkDetails:r,deliveryDirectives:x});break}}}class pi{static get version(){return Jl}static isMSESupported(){return Zb()}static isSupported(){return ik()}static getMediaSource(){return ya()}static get Events(){return L}static get MetadataSchema(){return mi}static get ErrorTypes(){return Fe}static get ErrorDetails(){return Q}static get DefaultConfig(){return pi.defaultConfig?pi.defaultConfig:zN}static set DefaultConfig(e){pi.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new Im,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;const t=this.logger=m1(e.debug||!1,"Hls instance",e.assetPlayerId),s=this.config=YN(pi.DefaultConfig,e,t);this.userConfig=e,s.progressive&&qN(s,t);const{abrController:n,bufferController:r,capLevelController:l,errorController:c,fpsController:h}=s,u=new c(this),f=this.abrController=new n(this),p=new cw(this),v=s.interstitialsController,x=v?this.interstitialsController=new v(this,pi):null,S=this.bufferController=new r(this,p),E=this.capLevelController=new l(this),T=new h(this),A=new ok(this),I=s.contentSteeringController,_=I?new I(this):null,C=this.levelController=new sk(this,_),k=new ek(this),U=new lk(this.config,this.logger),O=this.streamController=new rk(this,p,U),F=this.gapController=new ZN(this,p);E.setStreamController(O),T.setStreamController(O);const j=[A,C,O];x&&j.splice(1,0,x),_&&j.splice(1,0,_),this.networkControllers=j;const M=[f,S,F,E,T,k,p];this.audioTrackController=this.createController(s.audioTrackController,j);const H=s.audioStreamController;H&&j.push(this.audioStreamController=new H(this,p,U)),this.subtitleTrackController=this.createController(s.subtitleTrackController,j);const K=s.subtitleStreamController;K&&j.push(this.subtititleStreamController=new K(this,p,U)),this.createController(s.timelineController,M),U.emeController=this.emeController=this.createController(s.emeController,M),this.cmcdController=this.createController(s.cmcdController,M),this.latencyController=this.createController(tk,M),this.coreComponents=M,j.push(u);const te=u.onErrorOut;typeof te=="function"&&this.on(L.ERROR,te,u),this.on(L.MANIFEST_LOADED,A.onManifestLoaded,A)}createController(e,t){if(e){const s=new e(this);return t&&t.push(s),s}return null}on(e,t,s=this){this._emitter.on(e,t,s)}once(e,t,s=this){this._emitter.once(e,t,s)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t,s=this,n){this._emitter.off(e,t,s,n)}listeners(e){return this._emitter.listeners(e)}emit(e,t,s){return this._emitter.emit(e,t,s)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(s){if(this.logger.error("An internal error happened while handling event "+e+'. Error message: "'+s.message+'". Here is a stacktrace:',s),!this.triggeringException){this.triggeringException=!0;const n=e===L.ERROR;this.trigger(L.ERROR,{type:Fe.OTHER_ERROR,details:Q.INTERNAL_EXCEPTION,fatal:n,event:e,error:s}),this.triggeringException=!1}}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){this.logger.log("destroy"),this.trigger(L.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach(t=>t.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(t=>t.destroy()),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){if(!e||"media"in e&&!e.media){const r=new Error(`attachMedia failed: invalid argument (${e})`);this.trigger(L.ERROR,{type:Fe.OTHER_ERROR,details:Q.ATTACH_MEDIA_ERROR,fatal:!0,error:r});return}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());const t="media"in e,s=t?e.media:e,n=t?e:{media:s};this._media=s,this.trigger(L.MEDIA_ATTACHING,n)}detachMedia(){this.logger.log("detachMedia"),this.trigger(L.MEDIA_DETACHING,{}),this._media=null}transferMedia(){this._media=null;const e=this.bufferController.transferMedia();return this.trigger(L.MEDIA_DETACHING,{transferMedia:e}),e}loadSource(e){this.stopLoad();const t=this.media,s=this._url,n=this._url=mm.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log(`loadSource:${n}`),t&&s&&(s!==n||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(L.MANIFEST_LOADING,{url:e})}get url(){return this._url}get hasEnoughToStart(){return this.streamController.hasEnoughToStart}get startPosition(){return this.streamController.startPositionValue}startLoad(e=-1,t){this.logger.log(`startLoad(${e+(t?", <skip seek to start>":"")})`),this.started=!0,this.resumeBuffering();for(let s=0;s<this.networkControllers.length&&(this.networkControllers[s].startLoad(e,t),!(!this.started||!this.networkControllers));s++);}stopLoad(){this.logger.log("stopLoad"),this.started=!1;for(let e=0;e<this.networkControllers.length&&(this.networkControllers[e].stopLoad(),!(this.started||!this.networkControllers));e++);}get loadingEnabled(){return this.started}get bufferingEnabled(){return this.streamController.bufferingEnabled}resumeBuffering(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach(e=>{e.resumeBuffering&&e.resumeBuffering()}))}pauseBuffering(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach(e=>{e.pauseBuffering&&e.pauseBuffering()}))}get inFlightFragments(){const e={[ke.MAIN]:this.streamController.inFlightFrag};return this.audioStreamController&&(e[ke.AUDIO]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(e[ke.SUBTITLE]=this.subtititleStreamController.inFlightFrag),e}swapAudioCodec(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){this.logger.log("recoverMediaError");const e=this._media,t=e?.currentTime;this.detachMedia(),e&&(this.attachMedia(e),t&&this.startLoad(t))}removeLevel(e){this.levelController.removeLevel(e)}get sessionId(){let e=this._sessionId;return e||(e=this._sessionId=ZO()),e}get levels(){const e=this.levelController.levels;return e||[]}get latestLevelDetails(){return this.streamController.getLevelDetails()||null}get loadLevelObj(){return this.levelController.loadLevelObj}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){this.logger.log(`set currentLevel:${e}`),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){this.logger.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){this.logger.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){this.logger.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){const e=this.levelController.startLevel;return e===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e}set startLevel(e){this.logger.log(`set startLevel:${e}`),e!==-1&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}set bandwidthEstimate(e){this.abrController.resetEstimator(e)}get abrEwmaDefaultEstimate(){const{bwEstimator:e}=this.abrController;return e?e.defaultEstimate:NaN}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(this.logger.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){Y1(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;const s=e.length;for(let n=0;n<s;n++)if(e[n].maxBitrate>=t)return n;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:t,maxHdcpLevel:s}=this;let n;if(t===-1&&e!=null&&e.length?n=e.length-1:n=t,s)for(let r=n;r--;){const l=e[r].attrs["HDCP-LEVEL"];if(l&&l<=s)return r}return n}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(e){this.abrController.nextAutoLevel=e}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get maxBufferLength(){return this.streamController.maxBufferLength}setAudioOption(e){var t;return((t=this.audioTrackController)==null?void 0:t.setAudioOption(e))||null}setSubtitleOption(e){var t;return((t=this.subtitleTrackController)==null?void 0:t.setSubtitleOption(e))||null}get allAudioTracks(){const e=this.audioTrackController;return e?e.allAudioTracks:[]}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const t=this.audioTrackController;t&&(t.audioTrack=e)}get allSubtitleTracks(){const e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return e?e.subtitleDisplay:!1}set subtitleDisplay(e){const t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}set targetLatency(e){this.latencyController.targetLatency=e}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}get pathways(){return this.levelController.pathways}get pathwayPriority(){return this.levelController.pathwayPriority}set pathwayPriority(e){this.levelController.pathwayPriority=e}get bufferedToEnd(){var e;return!!((e=this.bufferController)!=null&&e.bufferedToEnd)}get interstitialsManager(){var e;return((e=this.interstitialsController)==null?void 0:e.interstitialsManager)||null}getMediaDecodingInfo(e,t=this.allAudioTracks){const s=jS(t);return US(e,s,navigator.mediaCapabilities)}}pi.defaultConfig=void 0;const ck=()=>{const{id:i}=Eu(),e=Ps(),{config:t}=Hi(),s=w.useRef(null),n=w.useRef(null),[r,l]=w.useState(!0),[c,h]=w.useState(0),[u,f]=w.useState(0),[p,v]=w.useState(1),[x,S]=w.useState(!1),[E,T]=w.useState(!0),[A,I]=w.useState(!0),[_,C]=w.useState(null),[k,U]=w.useState(0),[O,F]=w.useState(null),[j,M]=w.useState(null),[H,K]=w.useState(null),[te,ae]=w.useState(!1),[me,D]=w.useState(!1),[G,Y]=w.useState(null),[oe,pe]=w.useState(null),[P,V]=w.useState(0),[se,he]=w.useState(!1),[ye,Ae]=w.useState(null),[Pe,He]=w.useState([]),[Be,ht]=w.useState(null),[dt,Mt]=w.useState([]),[bt,Tt]=w.useState([]),[os,Ve]=w.useState(!1),[we,Me]=w.useState(!1);t?.player?.seekForward,t?.player?.seekBackward;const[Qe,ge]=w.useState([]),[_e,De]=w.useState([]),[at,st]=w.useState(null),[Bt,ts]=w.useState(null),[ys,xs]=w.useState(1),[Ss,Cs]=w.useState(!0),[Ht,Bs]=w.useState(null),[bs,Vt]=w.useState(null),[fs,Et]=w.useState(!1),[xi,ei]=w.useState(null),[ti,ms]=w.useState(null),[Wt,Us]=w.useState(null),[ss,Ms]=w.useState("Quality"),cs=w.useRef(null),Vs=w.useRef(null),Si=w.useRef(null);w.useEffect(()=>{(async()=>{try{I(!0),C(null);const Ce=await ee.getCurrentUser();if(!Ce){e("/login");return}const Ze=await ee.getItemDetails(Ce.Id,i);if(F(Ze),typeof ii<"u"&&ii.current&&(ii.current={intro:!1,outro:!1}),Ze.MediaSources&&Ze.MediaSources.length>0){const it=Ze.MediaSources[0];Vt(it.Id);const kt=it.MediaStreams||[],bi=kt.filter(Os=>Os.Type==="Audio"),Xt=kt.filter(Os=>Os.Type==="Subtitle");ge(bi),De(Xt);const Bn=bi.find(Os=>Os.IsDefault)||bi[0],Kt=Xt.find(Os=>Os.IsDefault)||Xt.filter(Os=>Os.IsForced)[0];st(Bn?Bn.Index:null),ts(Kt?Kt.Index:null)}if(Ze.Chapters){const it=Ze.Chapters.find(kt=>kt.Name.toLowerCase().includes("intro")||kt.Name.toLowerCase().includes("opening"));if(it){ei(it.StartPositionTicks/1e7);const kt=Ze.Chapters.indexOf(it);kt<Ze.Chapters.length-1?ms(Ze.Chapters[kt+1].StartPositionTicks/1e7):ms(it.StartPositionTicks/1e7+85)}else ei(null),ms(null)}if(Ze.Type==="Episode"&&Ze.SeriesId){si(Ce.Id,Ze.SeriesId,Ze.SeasonId);try{const it=await ee.getItem(Ce.Id,Ze.SeriesId);ae(it.UserData?.IsFavorite||!1)}catch(it){console.warn("Failed to fetch series data",it)}}Mi(Ze.Id)}catch(Ce){console.error("Failed to load item",Ce),C("Failed to load content."),I(!1)}})()},[i,e]),w.useEffect(()=>{if(!O)return;const Z=ee.getStreamUrl(O.Id,at,Bt,bs,Ht);M(Z)},[O,at,Bt,Ht]);const si=async(Z,Ce,Ze)=>{try{const it=await ee.getSeasons(Z,Ce);He(it.Items||[]);const kt=Ze||it.Items?.[0]?.Id;ht(kt)}catch(it){console.error("Failed to load seasons",it)}};w.useEffect(()=>{Be&&O?.SeriesId&&(async()=>{Ve(!0);try{const Ce=await ee.getCurrentUser(),Ze=await ee.getEpisodes(Ce.Id,O.SeriesId,Be);Mt(Ze.Items||[])}catch(Ce){console.error("Failed to load episodes",Ce)}finally{Ve(!1)}})()},[Be,O?.SeriesId]),w.useEffect(()=>{if(O&&O.Type==="Episode"&&dt.length>0){const Z=dt.findIndex(Ce=>Ce.Id===O.Id);Z!==-1&&Z<dt.length-1?Us(dt[Z+1].Id):Us(null)}},[O,dt]);const[Nt,Ui]=w.useState(null),Mi=async Z=>{try{const Ce=await ee.getTrickplayManifest(Z);if(!Ce)return;const Ze=Object.keys(Ce);if(Ze.length===0)return;const it=Ce[Ze[0]],kt=Object.keys(it).map(Number).sort((Bn,Kt)=>Bn-Kt);if(kt.length===0)return;const bi=kt[0],Xt=it[bi];Ui({itemId:Z,width:bi,interval:Xt.Interval,tileWidth:Xt.TileWidth,tileHeight:Xt.TileHeight,thumbWidth:Xt.Width,thumbHeight:Xt.Height,thumbnailCount:Xt.ThumbnailCount}),console.log("[Trickplay] Loaded:",{width:bi,interval:Xt.Interval,cols:Xt.TileWidth,rows:Xt.TileHeight,thumbs:Xt.ThumbnailCount})}catch(Ce){console.warn("Failed to load trickplay data",Ce)}},Ki=Z=>{if(!u)return;const Ce=Z.currentTarget.getBoundingClientRect(),Ze=Z.clientX-Ce.left,it=Math.max(0,Math.min(1,Ze/Ce.width)),kt=it*u;if(pe(kt),V(it),he(!0),Nt){const{itemId:bi,width:Xt,interval:Bn,tileWidth:Kt,tileHeight:Os}=Nt,Xr=Kt*Os,Xa=Math.floor(kt*1e3/Bn),Vn=Math.floor(Xa/Xr),Zr=Xa%Xr,go=Zr%Kt,$n=Math.floor(Zr/Kt),Pu=ee.getTrickplayTileUrl(bi,Xt,Vn);Ae(Pu),Y({x:-(go*Nt.thumbWidth),y:-($n*Nt.thumbHeight),totalWidth:Kt*Nt.thumbWidth,totalHeight:Os*Nt.thumbHeight})}},ue=()=>{he(!1),pe(null),Ae(null)};w.useEffect(()=>{if(j){if(pi.isSupported()){Vs.current&&Vs.current.destroy();const Z=new pi({capLevelToPlayerSize:!0,autoStartLoad:!0});Z.loadSource(j),Z.attachMedia(s.current),Vs.current=Z,Z.on(pi.Events.MANIFEST_PARSED,()=>{s.current&&r&&s.current.play().catch(Ce=>console.log("Autoplay prevented",Ce)),I(!1)}),Z.on(pi.Events.ERROR,(Ce,Ze)=>{if(Ze.fatal)switch(console.error("HLS Fatal Error",Ze),Ze.type){case pi.ErrorTypes.NETWORK_ERROR:Z.startLoad();break;case pi.ErrorTypes.MEDIA_ERROR:Z.recoverMediaError();break;default:Z.destroy();break}})}else s.current.canPlayType("application/vnd.apple.mpegurl")?(s.current.src=j,s.current.addEventListener("loadedmetadata",()=>{r&&s.current.play(),I(!1)})):(s.current.src=j,s.current.addEventListener("loadedmetadata",()=>{r&&s.current.play(),I(!1)}));return()=>{Vs.current&&Vs.current.destroy()}}},[j]),w.useEffect(()=>{s.current&&(s.current.playbackRate=ys)},[ys]),w.useEffect(()=>{if(!(!O||!s.current)&&O.UserData&&O.UserData.PlaybackPositionTicks){const Z=O.UserData.PlaybackPositionTicks/1e7,Ce=()=>{Z>0&&Z<s.current.duration&&(s.current.currentTime=Z)};return s.current.addEventListener("loadedmetadata",Ce),s.current.readyState>=1&&Ce(),()=>s.current?.removeEventListener("loadedmetadata",Ce)}},[O]),w.useEffect(()=>{if(!(!O||!bs))return Si.current=setInterval(()=>{if(s.current&&!s.current.paused){const Z=s.current.currentTime;ee.reportPlaybackProgress(O.Id,Math.floor(Z*1e7),!1,bs).catch(Ce=>console.warn("Report progress failed",Ce))}},1e4),()=>clearInterval(Si.current)},[O,bs]);const Ne=w.useCallback(()=>{O&&s.current&&ee.reportPlaybackStopped(O.Id,Math.floor(s.current.currentTime*1e7))},[O]);w.useEffect(()=>()=>{Ne()},[Ne]);const Xe=w.useCallback(()=>{s.current&&(s.current.paused?(s.current.play().catch(Z=>console.log("Play prevented:",Z)),l(!0)):(s.current.pause(),l(!1)))},[s]),zt=Z=>{K(Z),setTimeout(()=>K(null),600)},Ie=w.useCallback(()=>{if(s.current){const Z=t.playerSeekForward||30;s.current.currentTime=Math.min(s.current.duration,s.current.currentTime+Z),h(s.current.currentTime),zt("fast_forward")}},[t.playerSeekForward]),Ts=w.useCallback(()=>{if(s.current){const Z=t.playerSeekBackward||10;s.current.currentTime=Math.max(0,s.current.currentTime-Z),h(s.current.currentTime),zt("fast_rewind")}},[t.playerSeekBackward]),gt=w.useCallback(()=>{document.fullscreenElement?document.exitFullscreen&&document.exitFullscreen():n.current&&n.current.requestFullscreen().catch(Z=>{console.error(`Error attempting to enable full-screen mode: ${Z.message} (${Z.name})`)})},[]),At=w.useCallback(()=>{const Z=s.current;if(Z)if(Z.muted=!x,S(!x),!x)v(0),Z.volume=0;else{const Ce=Z.volume>0?Z.volume:1;v(Ce),Z.volume=Ce}},[x,s]);w.useEffect(()=>{const Z=Ce=>{if(!we)switch([" ","ArrowLeft","ArrowRight"].includes(Ce.key)&&Ce.preventDefault(),Ce.key){case" ":case"k":Xe();break;case"ArrowLeft":Ts();break;case"ArrowRight":Ie();break;case"f":gt();break;case"m":At();break}};return document.addEventListener("keydown",Z),()=>{document.removeEventListener("keydown",Z)}},[r,we]);const un=w.useCallback(Z=>{Z.target.closest(".lf-player-controls")||Z.target.closest(".lf-player-back-button")||Z.target.closest(".lf-skip-btn")||Z.target.closest(".center-play-btn")||(s.current&&(s.current.paused?(s.current.play().catch(Ce=>console.log("Play prevented:",Ce)),l(!0),zt("play_arrow")):(s.current.pause(),l(!1),zt("pause"))),T(!0),cs.current&&clearTimeout(cs.current),cs.current=setTimeout(()=>{T(!1)},3e3))},[s]),[Sa,Ya]=w.useState(!1),[jm,ho]=w.useState(null),ii=w.useRef({intro:!1,outro:!1}),Qr=w.useCallback(Z=>{if(!O?.Chapters)return;const Ce=O.Chapters.find(Ze=>(Ze.Name.toLowerCase().includes("intro")||Ze.Name.toLowerCase().includes("opening"))&&Z>=Ze.StartPositionTicks/1e7&&Z<Ze.StartPositionTicks/1e7+80);if(Ce){const Ze=O.Chapters.indexOf(Ce),it=O.Chapters[Ze+1];if(it){const kt=it.StartPositionTicks/1e7;Et(!0),ho(kt),t.autoSkipIntro&&!ii.current.intro&&s.current&&(ii.current.intro=!0,s.current.currentTime=kt,h(kt),zt("skip_next"),console.log("[AutoSkip] Skipped intro to",kt))}else Et(!1)}else Et(!1),u>0&&u-Z<120&&O.Chapters.find(it=>(it.Name.toLowerCase().includes("outro")||it.Name.toLowerCase().includes("ending")||it.Name.toLowerCase().includes("credits"))&&Z>=it.StartPositionTicks/1e7)?(Ya(!0),t.autoSkipOutro&&!ii.current.outro&&s.current&&(ii.current.outro=!0,Wt&&e(`/player/${Wt}`))):Ya(!1)},[O,u,t.autoSkipIntro,t.autoSkipOutro,Wt,e]),dn=()=>{Ne(),window.history.length>2?e(-1):O&&O.SeriesId?e(`/series/${O.SeriesId}`):O&&O.ParentId?e("/library"):e("/")},Mn=Z=>{if(s.current){const Ce=s.current.currentTime;h(Ce),f(s.current.duration||0),s.current.buffered.length>0&&U(s.current.buffered.end(s.current.buffered.length-1)),xi!==null&&ti!==null&&(Ce>=xi&&Ce<ti?Et(!0):Et(!1)),Qr(Ce)}},ba=()=>{},jn=()=>{Ss&&Wt?setTimeout(()=>qa(),1500):(l(!1),Ne(),T(!0))},is=()=>{s.current&&ti&&(s.current.currentTime=ti,zt("fast_forward"),Et(!1))},fo=()=>{Ya(!1),Wt?qa():s.current&&(s.current.currentTime=s.current.duration)},qa=()=>{Wt&&(Ne(),ge([]),De([]),ei(null),Et(!1),e(`/play/${Wt}`))},ji=(Z,Ce)=>{Z==="Audio"&&st(Ce),Z==="Subtitle"&&ts(Ce)},Fn=w.useCallback(()=>{T(!0),cs.current&&clearTimeout(cs.current),cs.current=setTimeout(()=>{s.current&&!s.current.paused&&T(!1)},3e3)},[]),Du=Z=>{ht(Z)},mo=Z=>{Z!==O.Id&&(Ne(),e(`/play/${Z}`))},po=async()=>{if(!(!O||!O.SeriesId))try{const Z=await ee.getCurrentUser(),Ce=!te;await ee.markFavorite(Z.Id,O.SeriesId,Ce),ae(Ce)}catch(Z){console.error("Favorite toggle failed",Z)}},Wr=Z=>{if(!Z||isNaN(Z))return"0:00";const Ce=Math.floor(Z/3600),Ze=Math.floor(Z%3600/60),it=Math.floor(Z%60);return Ce>0?`${Ce}:${Ze.toString().padStart(2,"0")}:${it.toString().padStart(2,"0")}`:`${Ze}:${it.toString().padStart(2,"0")}`},Qa=u?c/u*100:0,Wa=u?k/u*100:0;return g.jsxs("div",{className:"lf-player-page",children:[g.jsx(va,{alwaysFilled:!0}),g.jsx("div",{ref:n,className:`lf-player-video-container ${document.fullscreenElement?"is-fullscreen":""}`,onMouseMove:Fn,onMouseLeave:()=>r&&T(!1),onClick:un,children:g.jsxs("div",{className:"lf-player-video-wrapper",children:[g.jsx("video",{ref:s,className:"lf-player-video",onTimeUpdate:Mn,onLoadedMetadata:ba,onEnded:jn,onWaiting:()=>I(!0),onCanPlay:()=>I(!1),crossOrigin:"anonymous"}),fs&&g.jsx("button",{className:"lf-skip-btn",onClick:is,children:"Skip Intro"}),Sa&&!fs&&g.jsx("button",{className:"lf-skip-btn",onClick:fo,children:Wt?"Next Episode":"Skip Credits"}),A&&g.jsx("div",{className:"lf-player-loader",children:g.jsx("div",{className:"spinner"})}),_&&g.jsxs("div",{className:"lf-player-error",children:[g.jsx("div",{className:"error-icon",children:"!"}),g.jsx("p",{children:_}),g.jsx("button",{onClick:dn,children:"Go Back"})]}),g.jsx("div",{className:`lf-player-center-icon ${H?"visible":""}`,children:g.jsx("span",{className:"material-icons",children:H})}),g.jsxs("div",{className:`lf-player-controls ${E?"visible":""}`,children:[g.jsxs("div",{className:"lf-player-controls-top",children:[g.jsx("button",{className:"icon-btn back-btn",onClick:dn,children:g.jsx("span",{className:"material-icons",children:"arrow_back"})}),g.jsx("div",{className:"player-title",children:O?g.jsxs(g.Fragment,{children:[g.jsx("span",{className:"series-title",children:O.SeriesName}),O.SeriesName&&O.Name&&g.jsx("span",{className:"divider",children:"|"}),g.jsx("span",{className:"episode-title",children:O.Name})]}):"Loading..."})]}),!r&&!A&&!_&&!we&&g.jsx("button",{className:"center-play-btn",onClick:Z=>{Z.stopPropagation(),Xe()},children:g.jsx("span",{className:"material-icons",children:"play_arrow"})}),we&&g.jsxs("div",{className:"lf-settings-modal",children:[g.jsxs("div",{className:"lf-settings-header",children:[g.jsx("h3",{children:"Settings"}),g.jsx("button",{onClick:()=>Me(!1),className:"close-btn",children:g.jsx("span",{className:"material-icons",children:"close"})})]}),g.jsx("div",{className:"lf-settings-tabs",children:["Quality","Audio","Subtitles","Speed","General"].map(Z=>g.jsx("button",{className:`tab-btn ${ss===Z?"active":""}`,onClick:()=>Ms(Z),children:Z},Z))}),g.jsxs("div",{className:"lf-settings-content",children:[ss==="Quality"&&g.jsxs("div",{className:"settings-list",children:[g.jsx("button",{className:Ht?"":"active",onClick:()=>Bs(null),children:"Auto"}),g.jsx("button",{className:Ht===12e7?"active":"",onClick:()=>Bs(12e7),children:"4K (120Mbps)"}),g.jsx("button",{className:Ht===6e7?"active":"",onClick:()=>Bs(6e7),children:"1080p High (60Mbps)"}),g.jsx("button",{className:Ht===2e7?"active":"",onClick:()=>Bs(2e7),children:"1080p (20Mbps)"}),g.jsx("button",{className:Ht===1e7?"active":"",onClick:()=>Bs(1e7),children:"720p (10Mbps)"})]}),ss==="Audio"&&g.jsxs("div",{className:"settings-list",children:[Qe.map(Z=>g.jsxs("button",{className:at===Z.Index?"active":"",onClick:()=>ji("Audio",Z.Index),children:[Z.Language||"Unknown"," - ",Z.Codec," ",Z.Title?`(${Z.Title})`:""]},Z.Index)),Qe.length===0&&g.jsx("p",{children:"No audio streams found."})]}),ss==="Subtitles"&&g.jsxs("div",{className:"settings-list",children:[g.jsx("button",{className:Bt===null?"active":"",onClick:()=>ji("Subtitle",null),children:"Off"}),_e.map(Z=>g.jsxs("button",{className:Bt===Z.Index?"active":"",onClick:()=>ji("Subtitle",Z.Index),children:[Z.Language||"Unknown"," ",Z.Title?`(${Z.Title})`:""," ",Z.IsForced?"[Forced]":""]},Z.Index))]}),ss==="Speed"&&g.jsx("div",{className:"settings-list",children:[.5,.75,1,1.25,1.5,2].map(Z=>g.jsxs("button",{className:ys===Z?"active":"",onClick:()=>xs(Z),children:[Z,"x"]},Z))}),ss==="General"&&g.jsx("div",{className:"settings-list",children:g.jsxs("button",{className:Ss?"active":"",onClick:()=>Cs(!Ss),children:["Auto Play: ",Ss?"On":"Off"]})})]})]}),g.jsxs("div",{className:"lf-player-controls-bottom",children:[g.jsxs("div",{className:"lf-player-timeline-container",onClick:Z=>{Z.stopPropagation();const Ce=Z.currentTarget.getBoundingClientRect(),it=(Z.clientX-Ce.left)/Ce.width*(u||0);s.current&&(s.current.currentTime=it,h(it))},onMouseMove:Ki,onMouseLeave:ue,children:[g.jsxs("div",{className:"lf-player-timeline-track",children:[g.jsx("div",{className:"lf-player-timeline-buffered",style:{width:`${Wa}%`}}),g.jsx("div",{className:"lf-player-timeline-fill",style:{width:`${Qa}%`},children:g.jsx("div",{className:"lf-player-timeline-thumb"})})]}),se&&oe!==null&&g.jsxs("div",{className:"lf-timeline-tooltip",style:{left:`${P*100}%`},children:[ye&&G&&g.jsx("div",{className:"lf-timeline-thumbnail",style:{backgroundImage:`url(${ye})`,backgroundPosition:`${G.x}px ${G.y}px`,backgroundSize:`${G.totalWidth}px ${G.totalHeight}px`,width:`${Nt?.thumbWidth||160}px`,height:`${Nt?.thumbHeight||90}px`}}),g.jsx("span",{className:"lf-timeline-time",children:Wr(oe)})]})]}),g.jsxs("div",{className:"lf-player-controls-row",children:[g.jsxs("div",{className:"controls-left",children:[g.jsx("button",{className:"icon-btn",onClick:Z=>{Z.stopPropagation(),Xe()},children:g.jsx("span",{className:"material-icons",children:r?"pause":"play_arrow"})}),g.jsx("button",{className:"icon-btn",onClick:Z=>{Z.stopPropagation(),Ts()},children:g.jsx("span",{className:"material-icons",children:"replay_10"})}),g.jsx("button",{className:"icon-btn",onClick:Z=>{Z.stopPropagation(),Ie()},children:g.jsx("span",{className:"material-icons",children:"forward_30"})}),Wt&&g.jsx("button",{className:"icon-btn",onClick:Z=>{Z.stopPropagation(),qa()},title:"Next Episode",children:g.jsx("span",{className:"material-icons",children:"skip_next"})}),g.jsxs("div",{className:"volume-container",children:[g.jsx("button",{className:"icon-btn",onClick:Z=>{Z.stopPropagation(),At()},children:g.jsx("span",{className:"material-icons",children:x||p===0?"volume_off":p<.5?"volume_down":"volume_up"})}),g.jsx("div",{className:"volume-slider-wrapper",children:g.jsx("input",{type:"range",className:"volume-slider",min:"0",max:"1",step:"0.05",value:x?0:p,onChange:Z=>{const Ce=parseFloat(Z.target.value);v(Ce),s.current&&(s.current.volume=Ce,s.current.muted=Ce===0),S(Ce===0)},onClick:Z=>Z.stopPropagation()})})]}),g.jsxs("span",{className:"time-display",children:[Wr(c)," / ",Wr(u)]})]}),g.jsxs("div",{className:"controls-right",children:[g.jsx("button",{className:"icon-btn",onClick:Z=>{Z.stopPropagation(),Me(!we)},children:g.jsx("span",{className:"material-icons",children:"settings"})}),g.jsx("button",{className:"icon-btn",onClick:Z=>{Z.stopPropagation(),gt()},children:g.jsx("span",{className:"material-icons",children:document.fullscreenElement?"fullscreen_exit":"fullscreen"})})]})]})]})]})]})}),O&&O.Type==="Episode"&&g.jsxs("div",{className:"lf-player-content-container",children:[g.jsxs("div",{className:"lf-player-column-left",children:[g.jsxs("div",{className:"lf-player-header-row",children:[g.jsxs("div",{className:"lf-player-title-block",children:[g.jsx("h4",{className:"lf-series-link",onClick:()=>e(/series/),children:O.SeriesName}),g.jsxs("h1",{className:"lf-episode-name",children:["E",O.IndexNumber," - ",O.Name]})]}),g.jsx("div",{className:"lf-player-actions",children:g.jsx("button",{className:`lf-action-btn ${te?"is-active":""}`,onClick:po,title:te?"Remove from Watchlist":"Add to Watchlist",children:g.jsx("span",{className:"material-icons",children:te?"bookmark":"bookmark_border"})})})]}),g.jsxs("div",{className:"lf-player-tags-row",children:[O.OfficialRating&&g.jsx("span",{className:"lf-tag-rating",children:O.OfficialRating}),g.jsx("span",{className:"lf-tag-text",children:"Sub | Dub"}),O.PremiereDate&&g.jsxs("span",{className:"lf-release-date",children:["Released on ",new Date(O.PremiereDate).toLocaleDateString()]})]}),g.jsxs("div",{className:"lf-player-metadata",children:[g.jsx("h1",{children:O.Name}),g.jsx("p",{className:"lf-player-description",children:O.Overview})]})]}),g.jsx("div",{className:"lf-player-column-right",children:g.jsxs("div",{className:"lf-player-episodes-panel",children:[g.jsxs("div",{className:"lf-episodes-panel-header",children:[g.jsx("span",{className:"lf-panel-title",children:"Episodes"}),g.jsxs("div",{className:"season-select-wrapper",children:[g.jsx("select",{className:"lf-season-dropdown",value:Be||"",onChange:Z=>Du(Z.target.value),children:Pe.map(Z=>g.jsx("option",{value:Z.Id,children:Z.Name},Z.Id))}),g.jsx("span",{className:"material-icons dropdown-icon",children:"expand_more"})]})]}),g.jsx("div",{className:"lf-episodes-grid",children:os?g.jsx("div",{className:"loading-txt",children:"Loading..."}):dt.map(Z=>g.jsxs("div",{className:`lf-episode-card-small ${Z.Id===O.Id?"current":""}`,onClick:()=>mo(Z.Id),children:[g.jsxs("div",{className:"ep-card-img",children:[g.jsx("img",{src:ee.getImageUrl(Z,"Primary",{maxWidth:300}),alt:Z.Name,onError:Ce=>Ce.target.style.display="none"}),Z.Id===O.Id&&g.jsx("div",{className:"ep-playing-overlay",children:g.jsx("span",{className:"material-icons",children:"play_circle"})})]}),g.jsxs("div",{className:"ep-card-info",children:[g.jsxs("div",{className:"ep-card-title",children:[g.jsxs("span",{className:"ep-prefix",children:["E",Z.IndexNumber]})," - ",Z.Name]}),g.jsx("div",{className:"ep-card-meta",children:"Sub | Dub"})]})]},Z.Id))})]})})]})]})};function uk(){const{config:i}=Hi();return g.jsxs(g.Fragment,{children:[i.appBackground&&g.jsx("div",{style:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",backgroundImage:`url('${i.appBackground}')`,backgroundSize:"cover",backgroundPosition:"center",zIndex:-1,opacity:.3,filter:"grayscale(0.5) brightness(0.5)"}}),g.jsxs(jI,{children:[g.jsx(n1,{}),g.jsxs(mI,{children:[g.jsx(Oi,{path:"/login",element:g.jsx(s1,{})}),g.jsx(Oi,{path:"/login/select-server",element:g.jsx(e1,{})}),g.jsx(Oi,{path:"/login/select-user",element:g.jsx(t1,{})}),g.jsxs(Oi,{element:g.jsx(i1,{}),children:[g.jsx(Oi,{path:"/",element:g.jsx(ay,{})}),g.jsx(Oi,{path:"/series/:id",element:g.jsx(WL,{})}),g.jsx(Oi,{path:"/movie/:id",element:g.jsx(XL,{})}),g.jsx(Oi,{path:"/item/:id",element:g.jsx(a1,{})}),g.jsx(Oi,{path:"/profile",element:g.jsx(JL,{})}),g.jsx(Oi,{path:"/play/:id",element:g.jsx(ck,{})}),g.jsx(Oi,{path:"*",element:g.jsx(ay,{})})]})]})]})]})}function dk(){return g.jsx(WI,{children:g.jsx(uk,{})})}fA.createRoot(document.getElementById("root")).render(g.jsx(w.StrictMode,{children:g.jsx(dk,{})}));
