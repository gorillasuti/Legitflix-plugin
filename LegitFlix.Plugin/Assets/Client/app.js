function sA(i,e){for(var t=0;t<e.length;t++){const s=e[t];if(typeof s!="string"&&!Array.isArray(s)){for(const n in s)if(n!=="default"&&!(n in i)){const r=Object.getOwnPropertyDescriptor(s,n);r&&Object.defineProperty(i,n,r.get?r:{enumerable:!0,get:()=>s[n]})}}}return Object.freeze(Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&s(l)}).observe(document,{childList:!0,subtree:!0});function t(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(n){if(n.ep)return;n.ep=!0;const r=t(n);fetch(n.href,r)}})();function xx(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var Th={exports:{}},Tl={};var dv;function iA(){if(dv)return Tl;dv=1;var i=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(s,n,r){var l=null;if(r!==void 0&&(l=""+r),n.key!==void 0&&(l=""+n.key),"key"in n){r={};for(var c in n)c!=="key"&&(r[c]=n[c])}else r=n;return n=r.ref,{$$typeof:i,type:s,key:l,ref:n!==void 0?n:null,props:r}}return Tl.Fragment=e,Tl.jsx=t,Tl.jsxs=t,Tl}var hv;function nA(){return hv||(hv=1,Th.exports=iA()),Th.exports}var g=nA(),Ah={exports:{}},Qe={};var fv;function aA(){if(fv)return Qe;fv=1;var i=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),n=Symbol.for("react.profiler"),r=Symbol.for("react.consumer"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),h=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),f=Symbol.for("react.lazy"),p=Symbol.for("react.activity"),v=Symbol.iterator;function x(P){return P===null||typeof P!="object"?null:(P=v&&P[v]||P["@@iterator"],typeof P=="function"?P:null)}var S={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},T=Object.assign,E={};function A(P,$,ie){this.props=P,this.context=$,this.refs=E,this.updater=ie||S}A.prototype.isReactComponent={},A.prototype.setState=function(P,$){if(typeof P!="object"&&typeof P!="function"&&P!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,P,$,"setState")},A.prototype.forceUpdate=function(P){this.updater.enqueueForceUpdate(this,P,"forceUpdate")};function _(){}_.prototype=A.prototype;function R(P,$,ie){this.props=P,this.context=$,this.refs=E,this.updater=ie||S}var w=R.prototype=new _;w.constructor=R,T(w,A.prototype),w.isPureReactComponent=!0;var N=Array.isArray;function U(){}var D={H:null,A:null,T:null,S:null},F=Object.prototype.hasOwnProperty;function j(P,$,ie){var fe=ie.ref;return{$$typeof:i,type:P,key:$,ref:fe!==void 0?fe:null,props:ie}}function M(P,$){return j(P.type,$,P.props)}function H(P){return typeof P=="object"&&P!==null&&P.$$typeof===i}function K(P){var $={"=":"=0",":":"=2"};return"$"+P.replace(/[=:]/g,function(ie){return $[ie]})}var se=/\/+/g;function ne(P,$){return typeof P=="object"&&P!==null&&P.key!=null?K(""+P.key):$.toString(36)}function de(P){switch(P.status){case"fulfilled":return P.value;case"rejected":throw P.reason;default:switch(typeof P.status=="string"?P.then(U,U):(P.status="pending",P.then(function($){P.status==="pending"&&(P.status="fulfilled",P.value=$)},function($){P.status==="pending"&&(P.status="rejected",P.reason=$)})),P.status){case"fulfilled":return P.value;case"rejected":throw P.reason}}throw P}function k(P,$,ie,fe,ge){var ve=typeof P;(ve==="undefined"||ve==="boolean")&&(P=null);var Ne=!1;if(P===null)Ne=!0;else switch(ve){case"bigint":case"string":case"number":Ne=!0;break;case"object":switch(P.$$typeof){case i:case e:Ne=!0;break;case f:return Ne=P._init,k(Ne(P._payload),$,ie,fe,ge)}}if(Ne)return ge=ge(P),Ne=fe===""?"."+ne(P,0):fe,N(ge)?(ie="",Ne!=null&&(ie=Ne.replace(se,"$&/")+"/"),k(ge,$,ie,"",function(ot){return ot})):ge!=null&&(H(ge)&&(ge=M(ge,ie+(ge.key==null||P&&P.key===ge.key?"":(""+ge.key).replace(se,"$&/")+"/")+Ne)),$.push(ge)),1;Ne=0;var pe=fe===""?".":fe+":";if(N(P))for(var we=0;we<P.length;we++)fe=P[we],ve=pe+ne(fe,we),Ne+=k(fe,$,ie,ve,ge);else if(we=x(P),typeof we=="function")for(P=we.call(P),we=0;!(fe=P.next()).done;)fe=fe.value,ve=pe+ne(fe,we++),Ne+=k(fe,$,ie,ve,ge);else if(ve==="object"){if(typeof P.then=="function")return k(de(P),$,ie,fe,ge);throw $=String(P),Error("Objects are not valid as a React child (found: "+($==="[object Object]"?"object with keys {"+Object.keys(P).join(", ")+"}":$)+"). If you meant to render a collection of children, use an array instead.")}return Ne}function G(P,$,ie){if(P==null)return P;var fe=[],ge=0;return k(P,fe,"","",function(ve){return $.call(ie,ve,ge++)}),fe}function Y(P){if(P._status===-1){var $=P._result;$=$(),$.then(function(ie){(P._status===0||P._status===-1)&&(P._status=1,P._result=ie)},function(ie){(P._status===0||P._status===-1)&&(P._status=2,P._result=ie)}),P._status===-1&&(P._status=0,P._result=$)}if(P._status===1)return P._result.default;throw P._result}var le=typeof reportError=="function"?reportError:function(P){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var $=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof P=="object"&&P!==null&&typeof P.message=="string"?String(P.message):String(P),error:P});if(!window.dispatchEvent($))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",P);return}console.error(P)},me={map:G,forEach:function(P,$,ie){G(P,function(){$.apply(this,arguments)},ie)},count:function(P){var $=0;return G(P,function(){$++}),$},toArray:function(P){return G(P,function($){return $})||[]},only:function(P){if(!H(P))throw Error("React.Children.only expected to receive a single React element child.");return P}};return Qe.Activity=p,Qe.Children=me,Qe.Component=A,Qe.Fragment=t,Qe.Profiler=n,Qe.PureComponent=R,Qe.StrictMode=s,Qe.Suspense=h,Qe.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=D,Qe.__COMPILER_RUNTIME={__proto__:null,c:function(P){return D.H.useMemoCache(P)}},Qe.cache=function(P){return function(){return P.apply(null,arguments)}},Qe.cacheSignal=function(){return null},Qe.cloneElement=function(P,$,ie){if(P==null)throw Error("The argument must be a React element, but you passed "+P+".");var fe=T({},P.props),ge=P.key;if($!=null)for(ve in $.key!==void 0&&(ge=""+$.key),$)!F.call($,ve)||ve==="key"||ve==="__self"||ve==="__source"||ve==="ref"&&$.ref===void 0||(fe[ve]=$[ve]);var ve=arguments.length-2;if(ve===1)fe.children=ie;else if(1<ve){for(var Ne=Array(ve),pe=0;pe<ve;pe++)Ne[pe]=arguments[pe+2];fe.children=Ne}return j(P.type,ge,fe)},Qe.createContext=function(P){return P={$$typeof:l,_currentValue:P,_currentValue2:P,_threadCount:0,Provider:null,Consumer:null},P.Provider=P,P.Consumer={$$typeof:r,_context:P},P},Qe.createElement=function(P,$,ie){var fe,ge={},ve=null;if($!=null)for(fe in $.key!==void 0&&(ve=""+$.key),$)F.call($,fe)&&fe!=="key"&&fe!=="__self"&&fe!=="__source"&&(ge[fe]=$[fe]);var Ne=arguments.length-2;if(Ne===1)ge.children=ie;else if(1<Ne){for(var pe=Array(Ne),we=0;we<Ne;we++)pe[we]=arguments[we+2];ge.children=pe}if(P&&P.defaultProps)for(fe in Ne=P.defaultProps,Ne)ge[fe]===void 0&&(ge[fe]=Ne[fe]);return j(P,ve,ge)},Qe.createRef=function(){return{current:null}},Qe.forwardRef=function(P){return{$$typeof:c,render:P}},Qe.isValidElement=H,Qe.lazy=function(P){return{$$typeof:f,_payload:{_status:-1,_result:P},_init:Y}},Qe.memo=function(P,$){return{$$typeof:d,type:P,compare:$===void 0?null:$}},Qe.startTransition=function(P){var $=D.T,ie={};D.T=ie;try{var fe=P(),ge=D.S;ge!==null&&ge(ie,fe),typeof fe=="object"&&fe!==null&&typeof fe.then=="function"&&fe.then(U,le)}catch(ve){le(ve)}finally{$!==null&&ie.types!==null&&($.types=ie.types),D.T=$}},Qe.unstable_useCacheRefresh=function(){return D.H.useCacheRefresh()},Qe.use=function(P){return D.H.use(P)},Qe.useActionState=function(P,$,ie){return D.H.useActionState(P,$,ie)},Qe.useCallback=function(P,$){return D.H.useCallback(P,$)},Qe.useContext=function(P){return D.H.useContext(P)},Qe.useDebugValue=function(){},Qe.useDeferredValue=function(P,$){return D.H.useDeferredValue(P,$)},Qe.useEffect=function(P,$){return D.H.useEffect(P,$)},Qe.useEffectEvent=function(P){return D.H.useEffectEvent(P)},Qe.useId=function(){return D.H.useId()},Qe.useImperativeHandle=function(P,$,ie){return D.H.useImperativeHandle(P,$,ie)},Qe.useInsertionEffect=function(P,$){return D.H.useInsertionEffect(P,$)},Qe.useLayoutEffect=function(P,$){return D.H.useLayoutEffect(P,$)},Qe.useMemo=function(P,$){return D.H.useMemo(P,$)},Qe.useOptimistic=function(P,$){return D.H.useOptimistic(P,$)},Qe.useReducer=function(P,$,ie){return D.H.useReducer(P,$,ie)},Qe.useRef=function(P){return D.H.useRef(P)},Qe.useState=function(P){return D.H.useState(P)},Qe.useSyncExternalStore=function(P,$,ie){return D.H.useSyncExternalStore(P,$,ie)},Qe.useTransition=function(){return D.H.useTransition()},Qe.version="19.2.4",Qe}var mv;function Uf(){return mv||(mv=1,Ah.exports=aA()),Ah.exports}var C=Uf();const Sx=xx(C),rA=sA({__proto__:null,default:Sx},[C]);var _h={exports:{}},Al={},Ih={exports:{}},Rh={};var pv;function lA(){return pv||(pv=1,(function(i){function e(k,G){var Y=k.length;k.push(G);e:for(;0<Y;){var le=Y-1>>>1,me=k[le];if(0<n(me,G))k[le]=G,k[Y]=me,Y=le;else break e}}function t(k){return k.length===0?null:k[0]}function s(k){if(k.length===0)return null;var G=k[0],Y=k.pop();if(Y!==G){k[0]=Y;e:for(var le=0,me=k.length,P=me>>>1;le<P;){var $=2*(le+1)-1,ie=k[$],fe=$+1,ge=k[fe];if(0>n(ie,Y))fe<me&&0>n(ge,ie)?(k[le]=ge,k[fe]=Y,le=fe):(k[le]=ie,k[$]=Y,le=$);else if(fe<me&&0>n(ge,Y))k[le]=ge,k[fe]=Y,le=fe;else break e}}return G}function n(k,G){var Y=k.sortIndex-G.sortIndex;return Y!==0?Y:k.id-G.id}if(i.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var r=performance;i.unstable_now=function(){return r.now()}}else{var l=Date,c=l.now();i.unstable_now=function(){return l.now()-c}}var h=[],d=[],f=1,p=null,v=3,x=!1,S=!1,T=!1,E=!1,A=typeof setTimeout=="function"?setTimeout:null,_=typeof clearTimeout=="function"?clearTimeout:null,R=typeof setImmediate<"u"?setImmediate:null;function w(k){for(var G=t(d);G!==null;){if(G.callback===null)s(d);else if(G.startTime<=k)s(d),G.sortIndex=G.expirationTime,e(h,G);else break;G=t(d)}}function N(k){if(T=!1,w(k),!S)if(t(h)!==null)S=!0,U||(U=!0,K());else{var G=t(d);G!==null&&de(N,G.startTime-k)}}var U=!1,D=-1,F=5,j=-1;function M(){return E?!0:!(i.unstable_now()-j<F)}function H(){if(E=!1,U){var k=i.unstable_now();j=k;var G=!0;try{e:{S=!1,T&&(T=!1,_(D),D=-1),x=!0;var Y=v;try{t:{for(w(k),p=t(h);p!==null&&!(p.expirationTime>k&&M());){var le=p.callback;if(typeof le=="function"){p.callback=null,v=p.priorityLevel;var me=le(p.expirationTime<=k);if(k=i.unstable_now(),typeof me=="function"){p.callback=me,w(k),G=!0;break t}p===t(h)&&s(h),w(k)}else s(h);p=t(h)}if(p!==null)G=!0;else{var P=t(d);P!==null&&de(N,P.startTime-k),G=!1}}break e}finally{p=null,v=Y,x=!1}G=void 0}}finally{G?K():U=!1}}}var K;if(typeof R=="function")K=function(){R(H)};else if(typeof MessageChannel<"u"){var se=new MessageChannel,ne=se.port2;se.port1.onmessage=H,K=function(){ne.postMessage(null)}}else K=function(){A(H,0)};function de(k,G){D=A(function(){k(i.unstable_now())},G)}i.unstable_IdlePriority=5,i.unstable_ImmediatePriority=1,i.unstable_LowPriority=4,i.unstable_NormalPriority=3,i.unstable_Profiling=null,i.unstable_UserBlockingPriority=2,i.unstable_cancelCallback=function(k){k.callback=null},i.unstable_forceFrameRate=function(k){0>k||125<k?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):F=0<k?Math.floor(1e3/k):5},i.unstable_getCurrentPriorityLevel=function(){return v},i.unstable_next=function(k){switch(v){case 1:case 2:case 3:var G=3;break;default:G=v}var Y=v;v=G;try{return k()}finally{v=Y}},i.unstable_requestPaint=function(){E=!0},i.unstable_runWithPriority=function(k,G){switch(k){case 1:case 2:case 3:case 4:case 5:break;default:k=3}var Y=v;v=k;try{return G()}finally{v=Y}},i.unstable_scheduleCallback=function(k,G,Y){var le=i.unstable_now();switch(typeof Y=="object"&&Y!==null?(Y=Y.delay,Y=typeof Y=="number"&&0<Y?le+Y:le):Y=le,k){case 1:var me=-1;break;case 2:me=250;break;case 5:me=1073741823;break;case 4:me=1e4;break;default:me=5e3}return me=Y+me,k={id:f++,callback:G,priorityLevel:k,startTime:Y,expirationTime:me,sortIndex:-1},Y>le?(k.sortIndex=Y,e(d,k),t(h)===null&&k===t(d)&&(T?(_(D),D=-1):T=!0,de(N,Y-le))):(k.sortIndex=me,e(h,k),S||x||(S=!0,U||(U=!0,K()))),k},i.unstable_shouldYield=M,i.unstable_wrapCallback=function(k){var G=v;return function(){var Y=v;v=G;try{return k.apply(this,arguments)}finally{v=Y}}}})(Rh)),Rh}var gv;function oA(){return gv||(gv=1,Ih.exports=lA()),Ih.exports}var Lh={exports:{}},bs={};var vv;function cA(){if(vv)return bs;vv=1;var i=Uf();function e(h){var d="https://react.dev/errors/"+h;if(1<arguments.length){d+="?args[]="+encodeURIComponent(arguments[1]);for(var f=2;f<arguments.length;f++)d+="&args[]="+encodeURIComponent(arguments[f])}return"Minified React error #"+h+"; visit "+d+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function t(){}var s={d:{f:t,r:function(){throw Error(e(522))},D:t,C:t,L:t,m:t,X:t,S:t,M:t},p:0,findDOMNode:null},n=Symbol.for("react.portal");function r(h,d,f){var p=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:n,key:p==null?null:""+p,children:h,containerInfo:d,implementation:f}}var l=i.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function c(h,d){if(h==="font")return"";if(typeof d=="string")return d==="use-credentials"?d:""}return bs.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=s,bs.createPortal=function(h,d){var f=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!d||d.nodeType!==1&&d.nodeType!==9&&d.nodeType!==11)throw Error(e(299));return r(h,d,null,f)},bs.flushSync=function(h){var d=l.T,f=s.p;try{if(l.T=null,s.p=2,h)return h()}finally{l.T=d,s.p=f,s.d.f()}},bs.preconnect=function(h,d){typeof h=="string"&&(d?(d=d.crossOrigin,d=typeof d=="string"?d==="use-credentials"?d:"":void 0):d=null,s.d.C(h,d))},bs.prefetchDNS=function(h){typeof h=="string"&&s.d.D(h)},bs.preinit=function(h,d){if(typeof h=="string"&&d&&typeof d.as=="string"){var f=d.as,p=c(f,d.crossOrigin),v=typeof d.integrity=="string"?d.integrity:void 0,x=typeof d.fetchPriority=="string"?d.fetchPriority:void 0;f==="style"?s.d.S(h,typeof d.precedence=="string"?d.precedence:void 0,{crossOrigin:p,integrity:v,fetchPriority:x}):f==="script"&&s.d.X(h,{crossOrigin:p,integrity:v,fetchPriority:x,nonce:typeof d.nonce=="string"?d.nonce:void 0})}},bs.preinitModule=function(h,d){if(typeof h=="string")if(typeof d=="object"&&d!==null){if(d.as==null||d.as==="script"){var f=c(d.as,d.crossOrigin);s.d.M(h,{crossOrigin:f,integrity:typeof d.integrity=="string"?d.integrity:void 0,nonce:typeof d.nonce=="string"?d.nonce:void 0})}}else d==null&&s.d.M(h)},bs.preload=function(h,d){if(typeof h=="string"&&typeof d=="object"&&d!==null&&typeof d.as=="string"){var f=d.as,p=c(f,d.crossOrigin);s.d.L(h,f,{crossOrigin:p,integrity:typeof d.integrity=="string"?d.integrity:void 0,nonce:typeof d.nonce=="string"?d.nonce:void 0,type:typeof d.type=="string"?d.type:void 0,fetchPriority:typeof d.fetchPriority=="string"?d.fetchPriority:void 0,referrerPolicy:typeof d.referrerPolicy=="string"?d.referrerPolicy:void 0,imageSrcSet:typeof d.imageSrcSet=="string"?d.imageSrcSet:void 0,imageSizes:typeof d.imageSizes=="string"?d.imageSizes:void 0,media:typeof d.media=="string"?d.media:void 0})}},bs.preloadModule=function(h,d){if(typeof h=="string")if(d){var f=c(d.as,d.crossOrigin);s.d.m(h,{as:typeof d.as=="string"&&d.as!=="script"?d.as:void 0,crossOrigin:f,integrity:typeof d.integrity=="string"?d.integrity:void 0})}else s.d.m(h)},bs.requestFormReset=function(h){s.d.r(h)},bs.unstable_batchedUpdates=function(h,d){return h(d)},bs.useFormState=function(h,d,f){return l.H.useFormState(h,d,f)},bs.useFormStatus=function(){return l.H.useHostTransitionStatus()},bs.version="19.2.4",bs}var yv;function bx(){if(yv)return Lh.exports;yv=1;function i(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(i)}catch(e){console.error(e)}}return i(),Lh.exports=cA(),Lh.exports}var xv;function uA(){if(xv)return Al;xv=1;var i=oA(),e=Uf(),t=bx();function s(a){var o="https://react.dev/errors/"+a;if(1<arguments.length){o+="?args[]="+encodeURIComponent(arguments[1]);for(var u=2;u<arguments.length;u++)o+="&args[]="+encodeURIComponent(arguments[u])}return"Minified React error #"+a+"; visit "+o+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function n(a){return!(!a||a.nodeType!==1&&a.nodeType!==9&&a.nodeType!==11)}function r(a){var o=a,u=a;if(a.alternate)for(;o.return;)o=o.return;else{a=o;do o=a,(o.flags&4098)!==0&&(u=o.return),a=o.return;while(a)}return o.tag===3?u:null}function l(a){if(a.tag===13){var o=a.memoizedState;if(o===null&&(a=a.alternate,a!==null&&(o=a.memoizedState)),o!==null)return o.dehydrated}return null}function c(a){if(a.tag===31){var o=a.memoizedState;if(o===null&&(a=a.alternate,a!==null&&(o=a.memoizedState)),o!==null)return o.dehydrated}return null}function h(a){if(r(a)!==a)throw Error(s(188))}function d(a){var o=a.alternate;if(!o){if(o=r(a),o===null)throw Error(s(188));return o!==a?null:a}for(var u=a,m=o;;){var y=u.return;if(y===null)break;var b=y.alternate;if(b===null){if(m=y.return,m!==null){u=m;continue}break}if(y.child===b.child){for(b=y.child;b;){if(b===u)return h(y),a;if(b===m)return h(y),o;b=b.sibling}throw Error(s(188))}if(u.return!==m.return)u=y,m=b;else{for(var I=!1,O=y.child;O;){if(O===u){I=!0,u=y,m=b;break}if(O===m){I=!0,m=y,u=b;break}O=O.sibling}if(!I){for(O=b.child;O;){if(O===u){I=!0,u=b,m=y;break}if(O===m){I=!0,m=b,u=y;break}O=O.sibling}if(!I)throw Error(s(189))}}if(u.alternate!==m)throw Error(s(190))}if(u.tag!==3)throw Error(s(188));return u.stateNode.current===u?a:o}function f(a){var o=a.tag;if(o===5||o===26||o===27||o===6)return a;for(a=a.child;a!==null;){if(o=f(a),o!==null)return o;a=a.sibling}return null}var p=Object.assign,v=Symbol.for("react.element"),x=Symbol.for("react.transitional.element"),S=Symbol.for("react.portal"),T=Symbol.for("react.fragment"),E=Symbol.for("react.strict_mode"),A=Symbol.for("react.profiler"),_=Symbol.for("react.consumer"),R=Symbol.for("react.context"),w=Symbol.for("react.forward_ref"),N=Symbol.for("react.suspense"),U=Symbol.for("react.suspense_list"),D=Symbol.for("react.memo"),F=Symbol.for("react.lazy"),j=Symbol.for("react.activity"),M=Symbol.for("react.memo_cache_sentinel"),H=Symbol.iterator;function K(a){return a===null||typeof a!="object"?null:(a=H&&a[H]||a["@@iterator"],typeof a=="function"?a:null)}var se=Symbol.for("react.client.reference");function ne(a){if(a==null)return null;if(typeof a=="function")return a.$$typeof===se?null:a.displayName||a.name||null;if(typeof a=="string")return a;switch(a){case T:return"Fragment";case A:return"Profiler";case E:return"StrictMode";case N:return"Suspense";case U:return"SuspenseList";case j:return"Activity"}if(typeof a=="object")switch(a.$$typeof){case S:return"Portal";case R:return a.displayName||"Context";case _:return(a._context.displayName||"Context")+".Consumer";case w:var o=a.render;return a=a.displayName,a||(a=o.displayName||o.name||"",a=a!==""?"ForwardRef("+a+")":"ForwardRef"),a;case D:return o=a.displayName||null,o!==null?o:ne(a.type)||"Memo";case F:o=a._payload,a=a._init;try{return ne(a(o))}catch{}}return null}var de=Array.isArray,k=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,G=t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Y={pending:!1,data:null,method:null,action:null},le=[],me=-1;function P(a){return{current:a}}function $(a){0>me||(a.current=le[me],le[me]=null,me--)}function ie(a,o){me++,le[me]=a.current,a.current=o}var fe=P(null),ge=P(null),ve=P(null),Ne=P(null);function pe(a,o){switch(ie(ve,o),ie(ge,a),ie(fe,null),o.nodeType){case 9:case 11:a=(a=o.documentElement)&&(a=a.namespaceURI)?k0(a):0;break;default:if(a=o.tagName,o=o.namespaceURI)o=k0(o),a=P0(o,a);else switch(a){case"svg":a=1;break;case"math":a=2;break;default:a=0}}$(fe),ie(fe,a)}function we(){$(fe),$(ge),$(ve)}function ot(a){a.memoizedState!==null&&ie(Ne,a);var o=fe.current,u=P0(o,a.type);o!==u&&(ie(ge,a),ie(fe,u))}function ct(a){ge.current===a&&($(fe),$(ge)),Ne.current===a&&($(Ne),xl._currentValue=Y)}var zt,_t;function xt(a){if(zt===void 0)try{throw Error()}catch(u){var o=u.stack.trim().match(/\n( *(at )?)/);zt=o&&o[1]||"",_t=-1<u.stack.indexOf(`
    at`)?" (<anonymous>)":-1<u.stack.indexOf("@")?"@unknown:0:0":""}return`
`+zt+a+_t}var os=!1;function Ve(a,o){if(!a||os)return"";os=!0;var u=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var m={DetermineComponentFrameRoot:function(){try{if(o){var he=function(){throw Error()};if(Object.defineProperty(he.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(he,[])}catch(te){var Z=te}Reflect.construct(a,[],he)}else{try{he.call()}catch(te){Z=te}a.call(he.prototype)}}else{try{throw Error()}catch(te){Z=te}(he=a())&&typeof he.catch=="function"&&he.catch(function(){})}}catch(te){if(te&&Z&&typeof te.stack=="string")return[te.stack,Z.stack]}return[null,null]}};m.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var y=Object.getOwnPropertyDescriptor(m.DetermineComponentFrameRoot,"name");y&&y.configurable&&Object.defineProperty(m.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var b=m.DetermineComponentFrameRoot(),I=b[0],O=b[1];if(I&&O){var B=I.split(`
`),W=O.split(`
`);for(y=m=0;m<B.length&&!B[m].includes("DetermineComponentFrameRoot");)m++;for(;y<W.length&&!W[y].includes("DetermineComponentFrameRoot");)y++;if(m===B.length||y===W.length)for(m=B.length-1,y=W.length-1;1<=m&&0<=y&&B[m]!==W[y];)y--;for(;1<=m&&0<=y;m--,y--)if(B[m]!==W[y]){if(m!==1||y!==1)do if(m--,y--,0>y||B[m]!==W[y]){var ae=`
`+B[m].replace(" at new "," at ");return a.displayName&&ae.includes("<anonymous>")&&(ae=ae.replace("<anonymous>",a.displayName)),ae}while(1<=m&&0<=y);break}}}finally{os=!1,Error.prepareStackTrace=u}return(u=a?a.displayName||a.name:"")?xt(u):""}function Le(a,o){switch(a.tag){case 26:case 27:case 5:return xt(a.type);case 16:return xt("Lazy");case 13:return a.child!==o&&o!==null?xt("Suspense Fallback"):xt("Suspense");case 19:return xt("SuspenseList");case 0:case 15:return Ve(a.type,!1);case 11:return Ve(a.type.render,!1);case 1:return Ve(a.type,!0);case 31:return xt("Activity");default:return""}}function Fe(a){try{var o="",u=null;do o+=Le(a,u),u=a,a=a.return;while(a);return o}catch(m){return`
Error generating stack: `+m.message+`
`+m.stack}}var Ze=Object.prototype.hasOwnProperty,ut=i.unstable_scheduleCallback,Oe=i.unstable_cancelCallback,Ye=i.unstable_shouldYield,mt=i.unstable_requestPaint,st=i.unstable_now,Kt=i.unstable_getCurrentPriorityLevel,Xt=i.unstable_ImmediatePriority,_s=i.unstable_UserBlockingPriority,ye=i.unstable_NormalPriority,$e=i.unstable_LowPriority,De=i.unstable_IdlePriority,St=i.log,xs=i.unstable_setDisableYieldValue,ss=null,It=null;function Wt(a){if(typeof St=="function"&&xs(a),It&&typeof It.setStrictMode=="function")try{It.setStrictMode(ss,a)}catch{}}var Nt=Math.clz32?Math.clz32:Mt,Is=Math.log,Rt=Math.LN2;function Mt(a){return a>>>=0,a===0?32:31-(Is(a)/Rt|0)|0}var is=256,ns=262144,ri=4194304;function Hs(a){var o=a&42;if(o!==0)return o;switch(a&-a){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return a&261888;case 262144:case 524288:case 1048576:case 2097152:return a&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return a&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return a}}function zs(a,o,u){var m=a.pendingLanes;if(m===0)return 0;var y=0,b=a.suspendedLanes,I=a.pingedLanes;a=a.warmLanes;var O=m&134217727;return O!==0?(m=O&~b,m!==0?y=Hs(m):(I&=O,I!==0?y=Hs(I):u||(u=O&~a,u!==0&&(y=Hs(u))))):(O=m&~b,O!==0?y=Hs(O):I!==0?y=Hs(I):u||(u=m&~a,u!==0&&(y=Hs(u)))),y===0?0:o!==0&&o!==y&&(o&b)===0&&(b=y&-y,u=o&-o,b>=u||b===32&&(u&4194048)!==0)?o:y}function li(a,o){return(a.pendingLanes&~(a.suspendedLanes&~a.pingedLanes)&o)===0}function An(a,o){switch(a){case 1:case 2:case 4:case 8:case 64:return o+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function qi(){var a=ri;return ri<<=1,(ri&62914560)===0&&(ri=4194304),a}function Ai(a){for(var o=[],u=0;31>u;u++)o.push(a);return o}function Ss(a,o){a.pendingLanes|=o,o!==268435456&&(a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0)}function Qi(a,o,u,m,y,b){var I=a.pendingLanes;a.pendingLanes=u,a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0,a.expiredLanes&=u,a.entangledLanes&=u,a.errorRecoveryDisabledLanes&=u,a.shellSuspendCounter=0;var O=a.entanglements,B=a.expirationTimes,W=a.hiddenUpdates;for(u=I&~u;0<u;){var ae=31-Nt(u),he=1<<ae;O[ae]=0,B[ae]=-1;var Z=W[ae];if(Z!==null)for(W[ae]=null,ae=0;ae<Z.length;ae++){var te=Z[ae];te!==null&&(te.lane&=-536870913)}u&=~he}m!==0&&Xi(a,m,0),b!==0&&y===0&&a.tag!==0&&(a.suspendedLanes|=b&~(I&~o))}function Xi(a,o,u){a.pendingLanes|=o,a.suspendedLanes&=~o;var m=31-Nt(o);a.entangledLanes|=o,a.entanglements[m]=a.entanglements[m]|1073741824|u&261930}function _n(a,o){var u=a.entangledLanes|=o;for(a=a.entanglements;u;){var m=31-Nt(u),y=1<<m;y&o|a[m]&o&&(a[m]|=o),u&=~y}}function ce(a,o){var u=o&-o;return u=(u&42)!==0?1:Pe(u),(u&(a.suspendedLanes|o))!==0?0:u}function Pe(a){switch(a){case 2:a=1;break;case 8:a=4;break;case 32:a=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:a=128;break;case 268435456:a=134217728;break;default:a=0}return a}function Je(a){return a&=-a,2<a?8<a?(a&134217727)!==0?32:268435456:8:2}function Rs(){var a=G.p;return a!==0?a:(a=window.event,a===void 0?32:nv(a.type))}function xe(a,o){var u=G.p;try{return G.p=a,o()}finally{G.p=u}}var Os=Math.random().toString(36).slice(2),Lt="__reactFiber$"+Os,Dt="__reactProps$"+Os,sa="__reactContainer$"+Os,Dr="__reactEvents$"+Os,zb="__reactListeners$"+Os,Kb="__reactHandles$"+Os,bm="__reactResources$"+Os,kr="__reactMarker$"+Os;function pu(a){delete a[Lt],delete a[Dt],delete a[Dr],delete a[zb],delete a[Kb]}function Ca(a){var o=a[Lt];if(o)return o;for(var u=a.parentNode;u;){if(o=u[sa]||u[Lt]){if(u=o.alternate,o.child!==null||u!==null&&u.child!==null)for(a=V0(a);a!==null;){if(u=a[Lt])return u;a=V0(a)}return o}a=u,u=a.parentNode}return null}function Oa(a){if(a=a[Lt]||a[sa]){var o=a.tag;if(o===5||o===6||o===13||o===31||o===26||o===27||o===3)return a}return null}function Pr(a){var o=a.tag;if(o===5||o===26||o===27||o===6)return a.stateNode;throw Error(s(33))}function Na(a){var o=a[bm];return o||(o=a[bm]={hoistableStyles:new Map,hoistableScripts:new Map}),o}function cs(a){a[kr]=!0}var Em=new Set,Tm={};function ia(a,o){Da(a,o),Da(a+"Capture",o)}function Da(a,o){for(Tm[a]=o,a=0;a<o.length;a++)Em.add(o[a])}var Yb=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Am={},_m={};function qb(a){return Ze.call(_m,a)?!0:Ze.call(Am,a)?!1:Yb.test(a)?_m[a]=!0:(Am[a]=!0,!1)}function ql(a,o,u){if(qb(o))if(u===null)a.removeAttribute(o);else{switch(typeof u){case"undefined":case"function":case"symbol":a.removeAttribute(o);return;case"boolean":var m=o.toLowerCase().slice(0,5);if(m!=="data-"&&m!=="aria-"){a.removeAttribute(o);return}}a.setAttribute(o,""+u)}}function Ql(a,o,u){if(u===null)a.removeAttribute(o);else{switch(typeof u){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(o);return}a.setAttribute(o,""+u)}}function Wi(a,o,u,m){if(m===null)a.removeAttribute(u);else{switch(typeof m){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(u);return}a.setAttributeNS(o,u,""+m)}}function oi(a){switch(typeof a){case"bigint":case"boolean":case"number":case"string":case"undefined":return a;case"object":return a;default:return""}}function Im(a){var o=a.type;return(a=a.nodeName)&&a.toLowerCase()==="input"&&(o==="checkbox"||o==="radio")}function Qb(a,o,u){var m=Object.getOwnPropertyDescriptor(a.constructor.prototype,o);if(!a.hasOwnProperty(o)&&typeof m<"u"&&typeof m.get=="function"&&typeof m.set=="function"){var y=m.get,b=m.set;return Object.defineProperty(a,o,{configurable:!0,get:function(){return y.call(this)},set:function(I){u=""+I,b.call(this,I)}}),Object.defineProperty(a,o,{enumerable:m.enumerable}),{getValue:function(){return u},setValue:function(I){u=""+I},stopTracking:function(){a._valueTracker=null,delete a[o]}}}}function gu(a){if(!a._valueTracker){var o=Im(a)?"checked":"value";a._valueTracker=Qb(a,o,""+a[o])}}function Rm(a){if(!a)return!1;var o=a._valueTracker;if(!o)return!0;var u=o.getValue(),m="";return a&&(m=Im(a)?a.checked?"true":"false":a.value),a=m,a!==u?(o.setValue(a),!0):!1}function Xl(a){if(a=a||(typeof document<"u"?document:void 0),typeof a>"u")return null;try{return a.activeElement||a.body}catch{return a.body}}var Xb=/[\n"\\]/g;function ci(a){return a.replace(Xb,function(o){return"\\"+o.charCodeAt(0).toString(16)+" "})}function vu(a,o,u,m,y,b,I,O){a.name="",I!=null&&typeof I!="function"&&typeof I!="symbol"&&typeof I!="boolean"?a.type=I:a.removeAttribute("type"),o!=null?I==="number"?(o===0&&a.value===""||a.value!=o)&&(a.value=""+oi(o)):a.value!==""+oi(o)&&(a.value=""+oi(o)):I!=="submit"&&I!=="reset"||a.removeAttribute("value"),o!=null?yu(a,I,oi(o)):u!=null?yu(a,I,oi(u)):m!=null&&a.removeAttribute("value"),y==null&&b!=null&&(a.defaultChecked=!!b),y!=null&&(a.checked=y&&typeof y!="function"&&typeof y!="symbol"),O!=null&&typeof O!="function"&&typeof O!="symbol"&&typeof O!="boolean"?a.name=""+oi(O):a.removeAttribute("name")}function Lm(a,o,u,m,y,b,I,O){if(b!=null&&typeof b!="function"&&typeof b!="symbol"&&typeof b!="boolean"&&(a.type=b),o!=null||u!=null){if(!(b!=="submit"&&b!=="reset"||o!=null)){gu(a);return}u=u!=null?""+oi(u):"",o=o!=null?""+oi(o):u,O||o===a.value||(a.value=o),a.defaultValue=o}m=m??y,m=typeof m!="function"&&typeof m!="symbol"&&!!m,a.checked=O?a.checked:!!m,a.defaultChecked=!!m,I!=null&&typeof I!="function"&&typeof I!="symbol"&&typeof I!="boolean"&&(a.name=I),gu(a)}function yu(a,o,u){o==="number"&&Xl(a.ownerDocument)===a||a.defaultValue===""+u||(a.defaultValue=""+u)}function ka(a,o,u,m){if(a=a.options,o){o={};for(var y=0;y<u.length;y++)o["$"+u[y]]=!0;for(u=0;u<a.length;u++)y=o.hasOwnProperty("$"+a[u].value),a[u].selected!==y&&(a[u].selected=y),y&&m&&(a[u].defaultSelected=!0)}else{for(u=""+oi(u),o=null,y=0;y<a.length;y++){if(a[y].value===u){a[y].selected=!0,m&&(a[y].defaultSelected=!0);return}o!==null||a[y].disabled||(o=a[y])}o!==null&&(o.selected=!0)}}function wm(a,o,u){if(o!=null&&(o=""+oi(o),o!==a.value&&(a.value=o),u==null)){a.defaultValue!==o&&(a.defaultValue=o);return}a.defaultValue=u!=null?""+oi(u):""}function Cm(a,o,u,m){if(o==null){if(m!=null){if(u!=null)throw Error(s(92));if(de(m)){if(1<m.length)throw Error(s(93));m=m[0]}u=m}u==null&&(u=""),o=u}u=oi(o),a.defaultValue=u,m=a.textContent,m===u&&m!==""&&m!==null&&(a.value=m),gu(a)}function Pa(a,o){if(o){var u=a.firstChild;if(u&&u===a.lastChild&&u.nodeType===3){u.nodeValue=o;return}}a.textContent=o}var Wb=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Om(a,o,u){var m=o.indexOf("--")===0;u==null||typeof u=="boolean"||u===""?m?a.setProperty(o,""):o==="float"?a.cssFloat="":a[o]="":m?a.setProperty(o,u):typeof u!="number"||u===0||Wb.has(o)?o==="float"?a.cssFloat=u:a[o]=(""+u).trim():a[o]=u+"px"}function Nm(a,o,u){if(o!=null&&typeof o!="object")throw Error(s(62));if(a=a.style,u!=null){for(var m in u)!u.hasOwnProperty(m)||o!=null&&o.hasOwnProperty(m)||(m.indexOf("--")===0?a.setProperty(m,""):m==="float"?a.cssFloat="":a[m]="");for(var y in o)m=o[y],o.hasOwnProperty(y)&&u[y]!==m&&Om(a,y,m)}else for(var b in o)o.hasOwnProperty(b)&&Om(a,b,o[b])}function xu(a){if(a.indexOf("-")===-1)return!1;switch(a){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Zb=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Jb=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Wl(a){return Jb.test(""+a)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":a}function Zi(){}var Su=null;function bu(a){return a=a.target||a.srcElement||window,a.correspondingUseElement&&(a=a.correspondingUseElement),a.nodeType===3?a.parentNode:a}var Ua=null,Ma=null;function Dm(a){var o=Oa(a);if(o&&(a=o.stateNode)){var u=a[Dt]||null;e:switch(a=o.stateNode,o.type){case"input":if(vu(a,u.value,u.defaultValue,u.defaultValue,u.checked,u.defaultChecked,u.type,u.name),o=u.name,u.type==="radio"&&o!=null){for(u=a;u.parentNode;)u=u.parentNode;for(u=u.querySelectorAll('input[name="'+ci(""+o)+'"][type="radio"]'),o=0;o<u.length;o++){var m=u[o];if(m!==a&&m.form===a.form){var y=m[Dt]||null;if(!y)throw Error(s(90));vu(m,y.value,y.defaultValue,y.defaultValue,y.checked,y.defaultChecked,y.type,y.name)}}for(o=0;o<u.length;o++)m=u[o],m.form===a.form&&Rm(m)}break e;case"textarea":wm(a,u.value,u.defaultValue);break e;case"select":o=u.value,o!=null&&ka(a,!!u.multiple,o,!1)}}}var Eu=!1;function km(a,o,u){if(Eu)return a(o,u);Eu=!0;try{var m=a(o);return m}finally{if(Eu=!1,(Ua!==null||Ma!==null)&&(Fo(),Ua&&(o=Ua,a=Ma,Ma=Ua=null,Dm(o),a)))for(o=0;o<a.length;o++)Dm(a[o])}}function Ur(a,o){var u=a.stateNode;if(u===null)return null;var m=u[Dt]||null;if(m===null)return null;u=m[o];e:switch(o){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(m=!m.disabled)||(a=a.type,m=!(a==="button"||a==="input"||a==="select"||a==="textarea")),a=!m;break e;default:a=!1}if(a)return null;if(u&&typeof u!="function")throw Error(s(231,o,typeof u));return u}var Ji=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Tu=!1;if(Ji)try{var Mr={};Object.defineProperty(Mr,"passive",{get:function(){Tu=!0}}),window.addEventListener("test",Mr,Mr),window.removeEventListener("test",Mr,Mr)}catch{Tu=!1}var In=null,Au=null,Zl=null;function Pm(){if(Zl)return Zl;var a,o=Au,u=o.length,m,y="value"in In?In.value:In.textContent,b=y.length;for(a=0;a<u&&o[a]===y[a];a++);var I=u-a;for(m=1;m<=I&&o[u-m]===y[b-m];m++);return Zl=y.slice(a,1<m?1-m:void 0)}function Jl(a){var o=a.keyCode;return"charCode"in a?(a=a.charCode,a===0&&o===13&&(a=13)):a=o,a===10&&(a=13),32<=a||a===13?a:0}function eo(){return!0}function Um(){return!1}function Ns(a){function o(u,m,y,b,I){this._reactName=u,this._targetInst=y,this.type=m,this.nativeEvent=b,this.target=I,this.currentTarget=null;for(var O in a)a.hasOwnProperty(O)&&(u=a[O],this[O]=u?u(b):b[O]);return this.isDefaultPrevented=(b.defaultPrevented!=null?b.defaultPrevented:b.returnValue===!1)?eo:Um,this.isPropagationStopped=Um,this}return p(o.prototype,{preventDefault:function(){this.defaultPrevented=!0;var u=this.nativeEvent;u&&(u.preventDefault?u.preventDefault():typeof u.returnValue!="unknown"&&(u.returnValue=!1),this.isDefaultPrevented=eo)},stopPropagation:function(){var u=this.nativeEvent;u&&(u.stopPropagation?u.stopPropagation():typeof u.cancelBubble!="unknown"&&(u.cancelBubble=!0),this.isPropagationStopped=eo)},persist:function(){},isPersistent:eo}),o}var na={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(a){return a.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},to=Ns(na),jr=p({},na,{view:0,detail:0}),eE=Ns(jr),_u,Iu,Fr,so=p({},jr,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Lu,button:0,buttons:0,relatedTarget:function(a){return a.relatedTarget===void 0?a.fromElement===a.srcElement?a.toElement:a.fromElement:a.relatedTarget},movementX:function(a){return"movementX"in a?a.movementX:(a!==Fr&&(Fr&&a.type==="mousemove"?(_u=a.screenX-Fr.screenX,Iu=a.screenY-Fr.screenY):Iu=_u=0,Fr=a),_u)},movementY:function(a){return"movementY"in a?a.movementY:Iu}}),Mm=Ns(so),tE=p({},so,{dataTransfer:0}),sE=Ns(tE),iE=p({},jr,{relatedTarget:0}),Ru=Ns(iE),nE=p({},na,{animationName:0,elapsedTime:0,pseudoElement:0}),aE=Ns(nE),rE=p({},na,{clipboardData:function(a){return"clipboardData"in a?a.clipboardData:window.clipboardData}}),lE=Ns(rE),oE=p({},na,{data:0}),jm=Ns(oE),cE={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},uE={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},dE={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function hE(a){var o=this.nativeEvent;return o.getModifierState?o.getModifierState(a):(a=dE[a])?!!o[a]:!1}function Lu(){return hE}var fE=p({},jr,{key:function(a){if(a.key){var o=cE[a.key]||a.key;if(o!=="Unidentified")return o}return a.type==="keypress"?(a=Jl(a),a===13?"Enter":String.fromCharCode(a)):a.type==="keydown"||a.type==="keyup"?uE[a.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Lu,charCode:function(a){return a.type==="keypress"?Jl(a):0},keyCode:function(a){return a.type==="keydown"||a.type==="keyup"?a.keyCode:0},which:function(a){return a.type==="keypress"?Jl(a):a.type==="keydown"||a.type==="keyup"?a.keyCode:0}}),mE=Ns(fE),pE=p({},so,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Fm=Ns(pE),gE=p({},jr,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Lu}),vE=Ns(gE),yE=p({},na,{propertyName:0,elapsedTime:0,pseudoElement:0}),xE=Ns(yE),SE=p({},so,{deltaX:function(a){return"deltaX"in a?a.deltaX:"wheelDeltaX"in a?-a.wheelDeltaX:0},deltaY:function(a){return"deltaY"in a?a.deltaY:"wheelDeltaY"in a?-a.wheelDeltaY:"wheelDelta"in a?-a.wheelDelta:0},deltaZ:0,deltaMode:0}),bE=Ns(SE),EE=p({},na,{newState:0,oldState:0}),TE=Ns(EE),AE=[9,13,27,32],wu=Ji&&"CompositionEvent"in window,Br=null;Ji&&"documentMode"in document&&(Br=document.documentMode);var _E=Ji&&"TextEvent"in window&&!Br,Bm=Ji&&(!wu||Br&&8<Br&&11>=Br),$m=" ",Vm=!1;function Gm(a,o){switch(a){case"keyup":return AE.indexOf(o.keyCode)!==-1;case"keydown":return o.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Hm(a){return a=a.detail,typeof a=="object"&&"data"in a?a.data:null}var ja=!1;function IE(a,o){switch(a){case"compositionend":return Hm(o);case"keypress":return o.which!==32?null:(Vm=!0,$m);case"textInput":return a=o.data,a===$m&&Vm?null:a;default:return null}}function RE(a,o){if(ja)return a==="compositionend"||!wu&&Gm(a,o)?(a=Pm(),Zl=Au=In=null,ja=!1,a):null;switch(a){case"paste":return null;case"keypress":if(!(o.ctrlKey||o.altKey||o.metaKey)||o.ctrlKey&&o.altKey){if(o.char&&1<o.char.length)return o.char;if(o.which)return String.fromCharCode(o.which)}return null;case"compositionend":return Bm&&o.locale!=="ko"?null:o.data;default:return null}}var LE={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function zm(a){var o=a&&a.nodeName&&a.nodeName.toLowerCase();return o==="input"?!!LE[a.type]:o==="textarea"}function Km(a,o,u,m){Ua?Ma?Ma.push(m):Ma=[m]:Ua=m,o=Ko(o,"onChange"),0<o.length&&(u=new to("onChange","change",null,u,m),a.push({event:u,listeners:o}))}var $r=null,Vr=null;function wE(a){L0(a,0)}function io(a){var o=Pr(a);if(Rm(o))return a}function Ym(a,o){if(a==="change")return o}var qm=!1;if(Ji){var Cu;if(Ji){var Ou="oninput"in document;if(!Ou){var Qm=document.createElement("div");Qm.setAttribute("oninput","return;"),Ou=typeof Qm.oninput=="function"}Cu=Ou}else Cu=!1;qm=Cu&&(!document.documentMode||9<document.documentMode)}function Xm(){$r&&($r.detachEvent("onpropertychange",Wm),Vr=$r=null)}function Wm(a){if(a.propertyName==="value"&&io(Vr)){var o=[];Km(o,Vr,a,bu(a)),km(wE,o)}}function CE(a,o,u){a==="focusin"?(Xm(),$r=o,Vr=u,$r.attachEvent("onpropertychange",Wm)):a==="focusout"&&Xm()}function OE(a){if(a==="selectionchange"||a==="keyup"||a==="keydown")return io(Vr)}function NE(a,o){if(a==="click")return io(o)}function DE(a,o){if(a==="input"||a==="change")return io(o)}function kE(a,o){return a===o&&(a!==0||1/a===1/o)||a!==a&&o!==o}var Ks=typeof Object.is=="function"?Object.is:kE;function Gr(a,o){if(Ks(a,o))return!0;if(typeof a!="object"||a===null||typeof o!="object"||o===null)return!1;var u=Object.keys(a),m=Object.keys(o);if(u.length!==m.length)return!1;for(m=0;m<u.length;m++){var y=u[m];if(!Ze.call(o,y)||!Ks(a[y],o[y]))return!1}return!0}function Zm(a){for(;a&&a.firstChild;)a=a.firstChild;return a}function Jm(a,o){var u=Zm(a);a=0;for(var m;u;){if(u.nodeType===3){if(m=a+u.textContent.length,a<=o&&m>=o)return{node:u,offset:o-a};a=m}e:{for(;u;){if(u.nextSibling){u=u.nextSibling;break e}u=u.parentNode}u=void 0}u=Zm(u)}}function ep(a,o){return a&&o?a===o?!0:a&&a.nodeType===3?!1:o&&o.nodeType===3?ep(a,o.parentNode):"contains"in a?a.contains(o):a.compareDocumentPosition?!!(a.compareDocumentPosition(o)&16):!1:!1}function tp(a){a=a!=null&&a.ownerDocument!=null&&a.ownerDocument.defaultView!=null?a.ownerDocument.defaultView:window;for(var o=Xl(a.document);o instanceof a.HTMLIFrameElement;){try{var u=typeof o.contentWindow.location.href=="string"}catch{u=!1}if(u)a=o.contentWindow;else break;o=Xl(a.document)}return o}function Nu(a){var o=a&&a.nodeName&&a.nodeName.toLowerCase();return o&&(o==="input"&&(a.type==="text"||a.type==="search"||a.type==="tel"||a.type==="url"||a.type==="password")||o==="textarea"||a.contentEditable==="true")}var PE=Ji&&"documentMode"in document&&11>=document.documentMode,Fa=null,Du=null,Hr=null,ku=!1;function sp(a,o,u){var m=u.window===u?u.document:u.nodeType===9?u:u.ownerDocument;ku||Fa==null||Fa!==Xl(m)||(m=Fa,"selectionStart"in m&&Nu(m)?m={start:m.selectionStart,end:m.selectionEnd}:(m=(m.ownerDocument&&m.ownerDocument.defaultView||window).getSelection(),m={anchorNode:m.anchorNode,anchorOffset:m.anchorOffset,focusNode:m.focusNode,focusOffset:m.focusOffset}),Hr&&Gr(Hr,m)||(Hr=m,m=Ko(Du,"onSelect"),0<m.length&&(o=new to("onSelect","select",null,o,u),a.push({event:o,listeners:m}),o.target=Fa)))}function aa(a,o){var u={};return u[a.toLowerCase()]=o.toLowerCase(),u["Webkit"+a]="webkit"+o,u["Moz"+a]="moz"+o,u}var Ba={animationend:aa("Animation","AnimationEnd"),animationiteration:aa("Animation","AnimationIteration"),animationstart:aa("Animation","AnimationStart"),transitionrun:aa("Transition","TransitionRun"),transitionstart:aa("Transition","TransitionStart"),transitioncancel:aa("Transition","TransitionCancel"),transitionend:aa("Transition","TransitionEnd")},Pu={},ip={};Ji&&(ip=document.createElement("div").style,"AnimationEvent"in window||(delete Ba.animationend.animation,delete Ba.animationiteration.animation,delete Ba.animationstart.animation),"TransitionEvent"in window||delete Ba.transitionend.transition);function ra(a){if(Pu[a])return Pu[a];if(!Ba[a])return a;var o=Ba[a],u;for(u in o)if(o.hasOwnProperty(u)&&u in ip)return Pu[a]=o[u];return a}var np=ra("animationend"),ap=ra("animationiteration"),rp=ra("animationstart"),UE=ra("transitionrun"),ME=ra("transitionstart"),jE=ra("transitioncancel"),lp=ra("transitionend"),op=new Map,Uu="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Uu.push("scrollEnd");function _i(a,o){op.set(a,o),ia(o,[a])}var no=typeof reportError=="function"?reportError:function(a){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var o=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof a=="object"&&a!==null&&typeof a.message=="string"?String(a.message):String(a),error:a});if(!window.dispatchEvent(o))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",a);return}console.error(a)},ui=[],$a=0,Mu=0;function ao(){for(var a=$a,o=Mu=$a=0;o<a;){var u=ui[o];ui[o++]=null;var m=ui[o];ui[o++]=null;var y=ui[o];ui[o++]=null;var b=ui[o];if(ui[o++]=null,m!==null&&y!==null){var I=m.pending;I===null?y.next=y:(y.next=I.next,I.next=y),m.pending=y}b!==0&&cp(u,y,b)}}function ro(a,o,u,m){ui[$a++]=a,ui[$a++]=o,ui[$a++]=u,ui[$a++]=m,Mu|=m,a.lanes|=m,a=a.alternate,a!==null&&(a.lanes|=m)}function ju(a,o,u,m){return ro(a,o,u,m),lo(a)}function la(a,o){return ro(a,null,null,o),lo(a)}function cp(a,o,u){a.lanes|=u;var m=a.alternate;m!==null&&(m.lanes|=u);for(var y=!1,b=a.return;b!==null;)b.childLanes|=u,m=b.alternate,m!==null&&(m.childLanes|=u),b.tag===22&&(a=b.stateNode,a===null||a._visibility&1||(y=!0)),a=b,b=b.return;return a.tag===3?(b=a.stateNode,y&&o!==null&&(y=31-Nt(u),a=b.hiddenUpdates,m=a[y],m===null?a[y]=[o]:m.push(o),o.lane=u|536870912),b):null}function lo(a){if(50<hl)throw hl=0,Yd=null,Error(s(185));for(var o=a.return;o!==null;)a=o,o=a.return;return a.tag===3?a.stateNode:null}var Va={};function FE(a,o,u,m){this.tag=a,this.key=u,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=o,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=m,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ys(a,o,u,m){return new FE(a,o,u,m)}function Fu(a){return a=a.prototype,!(!a||!a.isReactComponent)}function en(a,o){var u=a.alternate;return u===null?(u=Ys(a.tag,o,a.key,a.mode),u.elementType=a.elementType,u.type=a.type,u.stateNode=a.stateNode,u.alternate=a,a.alternate=u):(u.pendingProps=o,u.type=a.type,u.flags=0,u.subtreeFlags=0,u.deletions=null),u.flags=a.flags&65011712,u.childLanes=a.childLanes,u.lanes=a.lanes,u.child=a.child,u.memoizedProps=a.memoizedProps,u.memoizedState=a.memoizedState,u.updateQueue=a.updateQueue,o=a.dependencies,u.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext},u.sibling=a.sibling,u.index=a.index,u.ref=a.ref,u.refCleanup=a.refCleanup,u}function up(a,o){a.flags&=65011714;var u=a.alternate;return u===null?(a.childLanes=0,a.lanes=o,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=u.childLanes,a.lanes=u.lanes,a.child=u.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=u.memoizedProps,a.memoizedState=u.memoizedState,a.updateQueue=u.updateQueue,a.type=u.type,o=u.dependencies,a.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext}),a}function oo(a,o,u,m,y,b){var I=0;if(m=a,typeof a=="function")Fu(a)&&(I=1);else if(typeof a=="string")I=HT(a,u,fe.current)?26:a==="html"||a==="head"||a==="body"?27:5;else e:switch(a){case j:return a=Ys(31,u,o,y),a.elementType=j,a.lanes=b,a;case T:return oa(u.children,y,b,o);case E:I=8,y|=24;break;case A:return a=Ys(12,u,o,y|2),a.elementType=A,a.lanes=b,a;case N:return a=Ys(13,u,o,y),a.elementType=N,a.lanes=b,a;case U:return a=Ys(19,u,o,y),a.elementType=U,a.lanes=b,a;default:if(typeof a=="object"&&a!==null)switch(a.$$typeof){case R:I=10;break e;case _:I=9;break e;case w:I=11;break e;case D:I=14;break e;case F:I=16,m=null;break e}I=29,u=Error(s(130,a===null?"null":typeof a,"")),m=null}return o=Ys(I,u,o,y),o.elementType=a,o.type=m,o.lanes=b,o}function oa(a,o,u,m){return a=Ys(7,a,m,o),a.lanes=u,a}function Bu(a,o,u){return a=Ys(6,a,null,o),a.lanes=u,a}function dp(a){var o=Ys(18,null,null,0);return o.stateNode=a,o}function $u(a,o,u){return o=Ys(4,a.children!==null?a.children:[],a.key,o),o.lanes=u,o.stateNode={containerInfo:a.containerInfo,pendingChildren:null,implementation:a.implementation},o}var hp=new WeakMap;function di(a,o){if(typeof a=="object"&&a!==null){var u=hp.get(a);return u!==void 0?u:(o={value:a,source:o,stack:Fe(o)},hp.set(a,o),o)}return{value:a,source:o,stack:Fe(o)}}var Ga=[],Ha=0,co=null,zr=0,hi=[],fi=0,Rn=null,Ni=1,Di="";function tn(a,o){Ga[Ha++]=zr,Ga[Ha++]=co,co=a,zr=o}function fp(a,o,u){hi[fi++]=Ni,hi[fi++]=Di,hi[fi++]=Rn,Rn=a;var m=Ni;a=Di;var y=32-Nt(m)-1;m&=~(1<<y),u+=1;var b=32-Nt(o)+y;if(30<b){var I=y-y%5;b=(m&(1<<I)-1).toString(32),m>>=I,y-=I,Ni=1<<32-Nt(o)+y|u<<y|m,Di=b+a}else Ni=1<<b|u<<y|m,Di=a}function Vu(a){a.return!==null&&(tn(a,1),fp(a,1,0))}function Gu(a){for(;a===co;)co=Ga[--Ha],Ga[Ha]=null,zr=Ga[--Ha],Ga[Ha]=null;for(;a===Rn;)Rn=hi[--fi],hi[fi]=null,Di=hi[--fi],hi[fi]=null,Ni=hi[--fi],hi[fi]=null}function mp(a,o){hi[fi++]=Ni,hi[fi++]=Di,hi[fi++]=Rn,Ni=o.id,Di=o.overflow,Rn=a}var hs=null,kt=null,lt=!1,Ln=null,mi=!1,Hu=Error(s(519));function wn(a){var o=Error(s(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Kr(di(o,a)),Hu}function pp(a){var o=a.stateNode,u=a.type,m=a.memoizedProps;switch(o[Lt]=a,o[Dt]=m,u){case"dialog":nt("cancel",o),nt("close",o);break;case"iframe":case"object":case"embed":nt("load",o);break;case"video":case"audio":for(u=0;u<ml.length;u++)nt(ml[u],o);break;case"source":nt("error",o);break;case"img":case"image":case"link":nt("error",o),nt("load",o);break;case"details":nt("toggle",o);break;case"input":nt("invalid",o),Lm(o,m.value,m.defaultValue,m.checked,m.defaultChecked,m.type,m.name,!0);break;case"select":nt("invalid",o);break;case"textarea":nt("invalid",o),Cm(o,m.value,m.defaultValue,m.children)}u=m.children,typeof u!="string"&&typeof u!="number"&&typeof u!="bigint"||o.textContent===""+u||m.suppressHydrationWarning===!0||N0(o.textContent,u)?(m.popover!=null&&(nt("beforetoggle",o),nt("toggle",o)),m.onScroll!=null&&nt("scroll",o),m.onScrollEnd!=null&&nt("scrollend",o),m.onClick!=null&&(o.onclick=Zi),o=!0):o=!1,o||wn(a,!0)}function gp(a){for(hs=a.return;hs;)switch(hs.tag){case 5:case 31:case 13:mi=!1;return;case 27:case 3:mi=!0;return;default:hs=hs.return}}function za(a){if(a!==hs)return!1;if(!lt)return gp(a),lt=!0,!1;var o=a.tag,u;if((u=o!==3&&o!==27)&&((u=o===5)&&(u=a.type,u=!(u!=="form"&&u!=="button")||oh(a.type,a.memoizedProps)),u=!u),u&&kt&&wn(a),gp(a),o===13){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(s(317));kt=$0(a)}else if(o===31){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(s(317));kt=$0(a)}else o===27?(o=kt,Gn(a.type)?(a=fh,fh=null,kt=a):kt=o):kt=hs?gi(a.stateNode.nextSibling):null;return!0}function ca(){kt=hs=null,lt=!1}function zu(){var a=Ln;return a!==null&&(Us===null?Us=a:Us.push.apply(Us,a),Ln=null),a}function Kr(a){Ln===null?Ln=[a]:Ln.push(a)}var Ku=P(null),ua=null,sn=null;function Cn(a,o,u){ie(Ku,o._currentValue),o._currentValue=u}function nn(a){a._currentValue=Ku.current,$(Ku)}function Yu(a,o,u){for(;a!==null;){var m=a.alternate;if((a.childLanes&o)!==o?(a.childLanes|=o,m!==null&&(m.childLanes|=o)):m!==null&&(m.childLanes&o)!==o&&(m.childLanes|=o),a===u)break;a=a.return}}function qu(a,o,u,m){var y=a.child;for(y!==null&&(y.return=a);y!==null;){var b=y.dependencies;if(b!==null){var I=y.child;b=b.firstContext;e:for(;b!==null;){var O=b;b=y;for(var B=0;B<o.length;B++)if(O.context===o[B]){b.lanes|=u,O=b.alternate,O!==null&&(O.lanes|=u),Yu(b.return,u,a),m||(I=null);break e}b=O.next}}else if(y.tag===18){if(I=y.return,I===null)throw Error(s(341));I.lanes|=u,b=I.alternate,b!==null&&(b.lanes|=u),Yu(I,u,a),I=null}else I=y.child;if(I!==null)I.return=y;else for(I=y;I!==null;){if(I===a){I=null;break}if(y=I.sibling,y!==null){y.return=I.return,I=y;break}I=I.return}y=I}}function Ka(a,o,u,m){a=null;for(var y=o,b=!1;y!==null;){if(!b){if((y.flags&524288)!==0)b=!0;else if((y.flags&262144)!==0)break}if(y.tag===10){var I=y.alternate;if(I===null)throw Error(s(387));if(I=I.memoizedProps,I!==null){var O=y.type;Ks(y.pendingProps.value,I.value)||(a!==null?a.push(O):a=[O])}}else if(y===Ne.current){if(I=y.alternate,I===null)throw Error(s(387));I.memoizedState.memoizedState!==y.memoizedState.memoizedState&&(a!==null?a.push(xl):a=[xl])}y=y.return}a!==null&&qu(o,a,u,m),o.flags|=262144}function uo(a){for(a=a.firstContext;a!==null;){if(!Ks(a.context._currentValue,a.memoizedValue))return!0;a=a.next}return!1}function da(a){ua=a,sn=null,a=a.dependencies,a!==null&&(a.firstContext=null)}function fs(a){return vp(ua,a)}function ho(a,o){return ua===null&&da(a),vp(a,o)}function vp(a,o){var u=o._currentValue;if(o={context:o,memoizedValue:u,next:null},sn===null){if(a===null)throw Error(s(308));sn=o,a.dependencies={lanes:0,firstContext:o},a.flags|=524288}else sn=sn.next=o;return u}var BE=typeof AbortController<"u"?AbortController:function(){var a=[],o=this.signal={aborted:!1,addEventListener:function(u,m){a.push(m)}};this.abort=function(){o.aborted=!0,a.forEach(function(u){return u()})}},$E=i.unstable_scheduleCallback,VE=i.unstable_NormalPriority,Zt={$$typeof:R,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Qu(){return{controller:new BE,data:new Map,refCount:0}}function Yr(a){a.refCount--,a.refCount===0&&$E(VE,function(){a.controller.abort()})}var qr=null,Xu=0,Ya=0,qa=null;function GE(a,o){if(qr===null){var u=qr=[];Xu=0,Ya=Jd(),qa={status:"pending",value:void 0,then:function(m){u.push(m)}}}return Xu++,o.then(yp,yp),o}function yp(){if(--Xu===0&&qr!==null){qa!==null&&(qa.status="fulfilled");var a=qr;qr=null,Ya=0,qa=null;for(var o=0;o<a.length;o++)(0,a[o])()}}function HE(a,o){var u=[],m={status:"pending",value:null,reason:null,then:function(y){u.push(y)}};return a.then(function(){m.status="fulfilled",m.value=o;for(var y=0;y<u.length;y++)(0,u[y])(o)},function(y){for(m.status="rejected",m.reason=y,y=0;y<u.length;y++)(0,u[y])(void 0)}),m}var xp=k.S;k.S=function(a,o){s0=st(),typeof o=="object"&&o!==null&&typeof o.then=="function"&&GE(a,o),xp!==null&&xp(a,o)};var ha=P(null);function Wu(){var a=ha.current;return a!==null?a:wt.pooledCache}function fo(a,o){o===null?ie(ha,ha.current):ie(ha,o.pool)}function Sp(){var a=Wu();return a===null?null:{parent:Zt._currentValue,pool:a}}var Qa=Error(s(460)),Zu=Error(s(474)),mo=Error(s(542)),po={then:function(){}};function bp(a){return a=a.status,a==="fulfilled"||a==="rejected"}function Ep(a,o,u){switch(u=a[u],u===void 0?a.push(o):u!==o&&(o.then(Zi,Zi),o=u),o.status){case"fulfilled":return o.value;case"rejected":throw a=o.reason,Ap(a),a;default:if(typeof o.status=="string")o.then(Zi,Zi);else{if(a=wt,a!==null&&100<a.shellSuspendCounter)throw Error(s(482));a=o,a.status="pending",a.then(function(m){if(o.status==="pending"){var y=o;y.status="fulfilled",y.value=m}},function(m){if(o.status==="pending"){var y=o;y.status="rejected",y.reason=m}})}switch(o.status){case"fulfilled":return o.value;case"rejected":throw a=o.reason,Ap(a),a}throw ma=o,Qa}}function fa(a){try{var o=a._init;return o(a._payload)}catch(u){throw u!==null&&typeof u=="object"&&typeof u.then=="function"?(ma=u,Qa):u}}var ma=null;function Tp(){if(ma===null)throw Error(s(459));var a=ma;return ma=null,a}function Ap(a){if(a===Qa||a===mo)throw Error(s(483))}var Xa=null,Qr=0;function go(a){var o=Qr;return Qr+=1,Xa===null&&(Xa=[]),Ep(Xa,a,o)}function Xr(a,o){o=o.props.ref,a.ref=o!==void 0?o:null}function vo(a,o){throw o.$$typeof===v?Error(s(525)):(a=Object.prototype.toString.call(o),Error(s(31,a==="[object Object]"?"object with keys {"+Object.keys(o).join(", ")+"}":a)))}function _p(a){function o(z,V){if(a){var X=z.deletions;X===null?(z.deletions=[V],z.flags|=16):X.push(V)}}function u(z,V){if(!a)return null;for(;V!==null;)o(z,V),V=V.sibling;return null}function m(z){for(var V=new Map;z!==null;)z.key!==null?V.set(z.key,z):V.set(z.index,z),z=z.sibling;return V}function y(z,V){return z=en(z,V),z.index=0,z.sibling=null,z}function b(z,V,X){return z.index=X,a?(X=z.alternate,X!==null?(X=X.index,X<V?(z.flags|=67108866,V):X):(z.flags|=67108866,V)):(z.flags|=1048576,V)}function I(z){return a&&z.alternate===null&&(z.flags|=67108866),z}function O(z,V,X,oe){return V===null||V.tag!==6?(V=Bu(X,z.mode,oe),V.return=z,V):(V=y(V,X),V.return=z,V)}function B(z,V,X,oe){var Be=X.type;return Be===T?ae(z,V,X.props.children,oe,X.key):V!==null&&(V.elementType===Be||typeof Be=="object"&&Be!==null&&Be.$$typeof===F&&fa(Be)===V.type)?(V=y(V,X.props),Xr(V,X),V.return=z,V):(V=oo(X.type,X.key,X.props,null,z.mode,oe),Xr(V,X),V.return=z,V)}function W(z,V,X,oe){return V===null||V.tag!==4||V.stateNode.containerInfo!==X.containerInfo||V.stateNode.implementation!==X.implementation?(V=$u(X,z.mode,oe),V.return=z,V):(V=y(V,X.children||[]),V.return=z,V)}function ae(z,V,X,oe,Be){return V===null||V.tag!==7?(V=oa(X,z.mode,oe,Be),V.return=z,V):(V=y(V,X),V.return=z,V)}function he(z,V,X){if(typeof V=="string"&&V!==""||typeof V=="number"||typeof V=="bigint")return V=Bu(""+V,z.mode,X),V.return=z,V;if(typeof V=="object"&&V!==null){switch(V.$$typeof){case x:return X=oo(V.type,V.key,V.props,null,z.mode,X),Xr(X,V),X.return=z,X;case S:return V=$u(V,z.mode,X),V.return=z,V;case F:return V=fa(V),he(z,V,X)}if(de(V)||K(V))return V=oa(V,z.mode,X,null),V.return=z,V;if(typeof V.then=="function")return he(z,go(V),X);if(V.$$typeof===R)return he(z,ho(z,V),X);vo(z,V)}return null}function Z(z,V,X,oe){var Be=V!==null?V.key:null;if(typeof X=="string"&&X!==""||typeof X=="number"||typeof X=="bigint")return Be!==null?null:O(z,V,""+X,oe);if(typeof X=="object"&&X!==null){switch(X.$$typeof){case x:return X.key===Be?B(z,V,X,oe):null;case S:return X.key===Be?W(z,V,X,oe):null;case F:return X=fa(X),Z(z,V,X,oe)}if(de(X)||K(X))return Be!==null?null:ae(z,V,X,oe,null);if(typeof X.then=="function")return Z(z,V,go(X),oe);if(X.$$typeof===R)return Z(z,V,ho(z,X),oe);vo(z,X)}return null}function te(z,V,X,oe,Be){if(typeof oe=="string"&&oe!==""||typeof oe=="number"||typeof oe=="bigint")return z=z.get(X)||null,O(V,z,""+oe,Be);if(typeof oe=="object"&&oe!==null){switch(oe.$$typeof){case x:return z=z.get(oe.key===null?X:oe.key)||null,B(V,z,oe,Be);case S:return z=z.get(oe.key===null?X:oe.key)||null,W(V,z,oe,Be);case F:return oe=fa(oe),te(z,V,X,oe,Be)}if(de(oe)||K(oe))return z=z.get(X)||null,ae(V,z,oe,Be,null);if(typeof oe.then=="function")return te(z,V,X,go(oe),Be);if(oe.$$typeof===R)return te(z,V,X,ho(V,oe),Be);vo(V,oe)}return null}function Ue(z,V,X,oe){for(var Be=null,dt=null,Me=V,We=V=0,rt=null;Me!==null&&We<X.length;We++){Me.index>We?(rt=Me,Me=null):rt=Me.sibling;var ht=Z(z,Me,X[We],oe);if(ht===null){Me===null&&(Me=rt);break}a&&Me&&ht.alternate===null&&o(z,Me),V=b(ht,V,We),dt===null?Be=ht:dt.sibling=ht,dt=ht,Me=rt}if(We===X.length)return u(z,Me),lt&&tn(z,We),Be;if(Me===null){for(;We<X.length;We++)Me=he(z,X[We],oe),Me!==null&&(V=b(Me,V,We),dt===null?Be=Me:dt.sibling=Me,dt=Me);return lt&&tn(z,We),Be}for(Me=m(Me);We<X.length;We++)rt=te(Me,z,We,X[We],oe),rt!==null&&(a&&rt.alternate!==null&&Me.delete(rt.key===null?We:rt.key),V=b(rt,V,We),dt===null?Be=rt:dt.sibling=rt,dt=rt);return a&&Me.forEach(function(qn){return o(z,qn)}),lt&&tn(z,We),Be}function Ge(z,V,X,oe){if(X==null)throw Error(s(151));for(var Be=null,dt=null,Me=V,We=V=0,rt=null,ht=X.next();Me!==null&&!ht.done;We++,ht=X.next()){Me.index>We?(rt=Me,Me=null):rt=Me.sibling;var qn=Z(z,Me,ht.value,oe);if(qn===null){Me===null&&(Me=rt);break}a&&Me&&qn.alternate===null&&o(z,Me),V=b(qn,V,We),dt===null?Be=qn:dt.sibling=qn,dt=qn,Me=rt}if(ht.done)return u(z,Me),lt&&tn(z,We),Be;if(Me===null){for(;!ht.done;We++,ht=X.next())ht=he(z,ht.value,oe),ht!==null&&(V=b(ht,V,We),dt===null?Be=ht:dt.sibling=ht,dt=ht);return lt&&tn(z,We),Be}for(Me=m(Me);!ht.done;We++,ht=X.next())ht=te(Me,z,We,ht.value,oe),ht!==null&&(a&&ht.alternate!==null&&Me.delete(ht.key===null?We:ht.key),V=b(ht,V,We),dt===null?Be=ht:dt.sibling=ht,dt=ht);return a&&Me.forEach(function(tA){return o(z,tA)}),lt&&tn(z,We),Be}function Tt(z,V,X,oe){if(typeof X=="object"&&X!==null&&X.type===T&&X.key===null&&(X=X.props.children),typeof X=="object"&&X!==null){switch(X.$$typeof){case x:e:{for(var Be=X.key;V!==null;){if(V.key===Be){if(Be=X.type,Be===T){if(V.tag===7){u(z,V.sibling),oe=y(V,X.props.children),oe.return=z,z=oe;break e}}else if(V.elementType===Be||typeof Be=="object"&&Be!==null&&Be.$$typeof===F&&fa(Be)===V.type){u(z,V.sibling),oe=y(V,X.props),Xr(oe,X),oe.return=z,z=oe;break e}u(z,V);break}else o(z,V);V=V.sibling}X.type===T?(oe=oa(X.props.children,z.mode,oe,X.key),oe.return=z,z=oe):(oe=oo(X.type,X.key,X.props,null,z.mode,oe),Xr(oe,X),oe.return=z,z=oe)}return I(z);case S:e:{for(Be=X.key;V!==null;){if(V.key===Be)if(V.tag===4&&V.stateNode.containerInfo===X.containerInfo&&V.stateNode.implementation===X.implementation){u(z,V.sibling),oe=y(V,X.children||[]),oe.return=z,z=oe;break e}else{u(z,V);break}else o(z,V);V=V.sibling}oe=$u(X,z.mode,oe),oe.return=z,z=oe}return I(z);case F:return X=fa(X),Tt(z,V,X,oe)}if(de(X))return Ue(z,V,X,oe);if(K(X)){if(Be=K(X),typeof Be!="function")throw Error(s(150));return X=Be.call(X),Ge(z,V,X,oe)}if(typeof X.then=="function")return Tt(z,V,go(X),oe);if(X.$$typeof===R)return Tt(z,V,ho(z,X),oe);vo(z,X)}return typeof X=="string"&&X!==""||typeof X=="number"||typeof X=="bigint"?(X=""+X,V!==null&&V.tag===6?(u(z,V.sibling),oe=y(V,X),oe.return=z,z=oe):(u(z,V),oe=Bu(X,z.mode,oe),oe.return=z,z=oe),I(z)):u(z,V)}return function(z,V,X,oe){try{Qr=0;var Be=Tt(z,V,X,oe);return Xa=null,Be}catch(Me){if(Me===Qa||Me===mo)throw Me;var dt=Ys(29,Me,null,z.mode);return dt.lanes=oe,dt.return=z,dt}}}var pa=_p(!0),Ip=_p(!1),On=!1;function Ju(a){a.updateQueue={baseState:a.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function ed(a,o){a=a.updateQueue,o.updateQueue===a&&(o.updateQueue={baseState:a.baseState,firstBaseUpdate:a.firstBaseUpdate,lastBaseUpdate:a.lastBaseUpdate,shared:a.shared,callbacks:null})}function Nn(a){return{lane:a,tag:0,payload:null,callback:null,next:null}}function Dn(a,o,u){var m=a.updateQueue;if(m===null)return null;if(m=m.shared,(ft&2)!==0){var y=m.pending;return y===null?o.next=o:(o.next=y.next,y.next=o),m.pending=o,o=lo(a),cp(a,null,u),o}return ro(a,m,o,u),lo(a)}function Wr(a,o,u){if(o=o.updateQueue,o!==null&&(o=o.shared,(u&4194048)!==0)){var m=o.lanes;m&=a.pendingLanes,u|=m,o.lanes=u,_n(a,u)}}function td(a,o){var u=a.updateQueue,m=a.alternate;if(m!==null&&(m=m.updateQueue,u===m)){var y=null,b=null;if(u=u.firstBaseUpdate,u!==null){do{var I={lane:u.lane,tag:u.tag,payload:u.payload,callback:null,next:null};b===null?y=b=I:b=b.next=I,u=u.next}while(u!==null);b===null?y=b=o:b=b.next=o}else y=b=o;u={baseState:m.baseState,firstBaseUpdate:y,lastBaseUpdate:b,shared:m.shared,callbacks:m.callbacks},a.updateQueue=u;return}a=u.lastBaseUpdate,a===null?u.firstBaseUpdate=o:a.next=o,u.lastBaseUpdate=o}var sd=!1;function Zr(){if(sd){var a=qa;if(a!==null)throw a}}function Jr(a,o,u,m){sd=!1;var y=a.updateQueue;On=!1;var b=y.firstBaseUpdate,I=y.lastBaseUpdate,O=y.shared.pending;if(O!==null){y.shared.pending=null;var B=O,W=B.next;B.next=null,I===null?b=W:I.next=W,I=B;var ae=a.alternate;ae!==null&&(ae=ae.updateQueue,O=ae.lastBaseUpdate,O!==I&&(O===null?ae.firstBaseUpdate=W:O.next=W,ae.lastBaseUpdate=B))}if(b!==null){var he=y.baseState;I=0,ae=W=B=null,O=b;do{var Z=O.lane&-536870913,te=Z!==O.lane;if(te?(at&Z)===Z:(m&Z)===Z){Z!==0&&Z===Ya&&(sd=!0),ae!==null&&(ae=ae.next={lane:0,tag:O.tag,payload:O.payload,callback:null,next:null});e:{var Ue=a,Ge=O;Z=o;var Tt=u;switch(Ge.tag){case 1:if(Ue=Ge.payload,typeof Ue=="function"){he=Ue.call(Tt,he,Z);break e}he=Ue;break e;case 3:Ue.flags=Ue.flags&-65537|128;case 0:if(Ue=Ge.payload,Z=typeof Ue=="function"?Ue.call(Tt,he,Z):Ue,Z==null)break e;he=p({},he,Z);break e;case 2:On=!0}}Z=O.callback,Z!==null&&(a.flags|=64,te&&(a.flags|=8192),te=y.callbacks,te===null?y.callbacks=[Z]:te.push(Z))}else te={lane:Z,tag:O.tag,payload:O.payload,callback:O.callback,next:null},ae===null?(W=ae=te,B=he):ae=ae.next=te,I|=Z;if(O=O.next,O===null){if(O=y.shared.pending,O===null)break;te=O,O=te.next,te.next=null,y.lastBaseUpdate=te,y.shared.pending=null}}while(!0);ae===null&&(B=he),y.baseState=B,y.firstBaseUpdate=W,y.lastBaseUpdate=ae,b===null&&(y.shared.lanes=0),jn|=I,a.lanes=I,a.memoizedState=he}}function Rp(a,o){if(typeof a!="function")throw Error(s(191,a));a.call(o)}function Lp(a,o){var u=a.callbacks;if(u!==null)for(a.callbacks=null,a=0;a<u.length;a++)Rp(u[a],o)}var Wa=P(null),yo=P(0);function wp(a,o){a=fn,ie(yo,a),ie(Wa,o),fn=a|o.baseLanes}function id(){ie(yo,fn),ie(Wa,Wa.current)}function nd(){fn=yo.current,$(Wa),$(yo)}var qs=P(null),pi=null;function kn(a){var o=a.alternate;ie(Yt,Yt.current&1),ie(qs,a),pi===null&&(o===null||Wa.current!==null||o.memoizedState!==null)&&(pi=a)}function ad(a){ie(Yt,Yt.current),ie(qs,a),pi===null&&(pi=a)}function Cp(a){a.tag===22?(ie(Yt,Yt.current),ie(qs,a),pi===null&&(pi=a)):Pn()}function Pn(){ie(Yt,Yt.current),ie(qs,qs.current)}function Qs(a){$(qs),pi===a&&(pi=null),$(Yt)}var Yt=P(0);function xo(a){for(var o=a;o!==null;){if(o.tag===13){var u=o.memoizedState;if(u!==null&&(u=u.dehydrated,u===null||dh(u)||hh(u)))return o}else if(o.tag===19&&(o.memoizedProps.revealOrder==="forwards"||o.memoizedProps.revealOrder==="backwards"||o.memoizedProps.revealOrder==="unstable_legacy-backwards"||o.memoizedProps.revealOrder==="together")){if((o.flags&128)!==0)return o}else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===a)break;for(;o.sibling===null;){if(o.return===null||o.return===a)return null;o=o.return}o.sibling.return=o.return,o=o.sibling}return null}var an=0,Xe=null,bt=null,Jt=null,So=!1,Za=!1,ga=!1,bo=0,el=0,Ja=null,zE=0;function Vt(){throw Error(s(321))}function rd(a,o){if(o===null)return!1;for(var u=0;u<o.length&&u<a.length;u++)if(!Ks(a[u],o[u]))return!1;return!0}function ld(a,o,u,m,y,b){return an=b,Xe=o,o.memoizedState=null,o.updateQueue=null,o.lanes=0,k.H=a===null||a.memoizedState===null?fg:Ed,ga=!1,b=u(m,y),ga=!1,Za&&(b=Np(o,u,m,y)),Op(a),b}function Op(a){k.H=il;var o=bt!==null&&bt.next!==null;if(an=0,Jt=bt=Xe=null,So=!1,el=0,Ja=null,o)throw Error(s(300));a===null||es||(a=a.dependencies,a!==null&&uo(a)&&(es=!0))}function Np(a,o,u,m){Xe=a;var y=0;do{if(Za&&(Ja=null),el=0,Za=!1,25<=y)throw Error(s(301));if(y+=1,Jt=bt=null,a.updateQueue!=null){var b=a.updateQueue;b.lastEffect=null,b.events=null,b.stores=null,b.memoCache!=null&&(b.memoCache.index=0)}k.H=mg,b=o(u,m)}while(Za);return b}function KE(){var a=k.H,o=a.useState()[0];return o=typeof o.then=="function"?tl(o):o,a=a.useState()[0],(bt!==null?bt.memoizedState:null)!==a&&(Xe.flags|=1024),o}function od(){var a=bo!==0;return bo=0,a}function cd(a,o,u){o.updateQueue=a.updateQueue,o.flags&=-2053,a.lanes&=~u}function ud(a){if(So){for(a=a.memoizedState;a!==null;){var o=a.queue;o!==null&&(o.pending=null),a=a.next}So=!1}an=0,Jt=bt=Xe=null,Za=!1,el=bo=0,Ja=null}function Ls(){var a={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Jt===null?Xe.memoizedState=Jt=a:Jt=Jt.next=a,Jt}function qt(){if(bt===null){var a=Xe.alternate;a=a!==null?a.memoizedState:null}else a=bt.next;var o=Jt===null?Xe.memoizedState:Jt.next;if(o!==null)Jt=o,bt=a;else{if(a===null)throw Xe.alternate===null?Error(s(467)):Error(s(310));bt=a,a={memoizedState:bt.memoizedState,baseState:bt.baseState,baseQueue:bt.baseQueue,queue:bt.queue,next:null},Jt===null?Xe.memoizedState=Jt=a:Jt=Jt.next=a}return Jt}function Eo(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function tl(a){var o=el;return el+=1,Ja===null&&(Ja=[]),a=Ep(Ja,a,o),o=Xe,(Jt===null?o.memoizedState:Jt.next)===null&&(o=o.alternate,k.H=o===null||o.memoizedState===null?fg:Ed),a}function To(a){if(a!==null&&typeof a=="object"){if(typeof a.then=="function")return tl(a);if(a.$$typeof===R)return fs(a)}throw Error(s(438,String(a)))}function dd(a){var o=null,u=Xe.updateQueue;if(u!==null&&(o=u.memoCache),o==null){var m=Xe.alternate;m!==null&&(m=m.updateQueue,m!==null&&(m=m.memoCache,m!=null&&(o={data:m.data.map(function(y){return y.slice()}),index:0})))}if(o==null&&(o={data:[],index:0}),u===null&&(u=Eo(),Xe.updateQueue=u),u.memoCache=o,u=o.data[o.index],u===void 0)for(u=o.data[o.index]=Array(a),m=0;m<a;m++)u[m]=M;return o.index++,u}function rn(a,o){return typeof o=="function"?o(a):o}function Ao(a){var o=qt();return hd(o,bt,a)}function hd(a,o,u){var m=a.queue;if(m===null)throw Error(s(311));m.lastRenderedReducer=u;var y=a.baseQueue,b=m.pending;if(b!==null){if(y!==null){var I=y.next;y.next=b.next,b.next=I}o.baseQueue=y=b,m.pending=null}if(b=a.baseState,y===null)a.memoizedState=b;else{o=y.next;var O=I=null,B=null,W=o,ae=!1;do{var he=W.lane&-536870913;if(he!==W.lane?(at&he)===he:(an&he)===he){var Z=W.revertLane;if(Z===0)B!==null&&(B=B.next={lane:0,revertLane:0,gesture:null,action:W.action,hasEagerState:W.hasEagerState,eagerState:W.eagerState,next:null}),he===Ya&&(ae=!0);else if((an&Z)===Z){W=W.next,Z===Ya&&(ae=!0);continue}else he={lane:0,revertLane:W.revertLane,gesture:null,action:W.action,hasEagerState:W.hasEagerState,eagerState:W.eagerState,next:null},B===null?(O=B=he,I=b):B=B.next=he,Xe.lanes|=Z,jn|=Z;he=W.action,ga&&u(b,he),b=W.hasEagerState?W.eagerState:u(b,he)}else Z={lane:he,revertLane:W.revertLane,gesture:W.gesture,action:W.action,hasEagerState:W.hasEagerState,eagerState:W.eagerState,next:null},B===null?(O=B=Z,I=b):B=B.next=Z,Xe.lanes|=he,jn|=he;W=W.next}while(W!==null&&W!==o);if(B===null?I=b:B.next=O,!Ks(b,a.memoizedState)&&(es=!0,ae&&(u=qa,u!==null)))throw u;a.memoizedState=b,a.baseState=I,a.baseQueue=B,m.lastRenderedState=b}return y===null&&(m.lanes=0),[a.memoizedState,m.dispatch]}function fd(a){var o=qt(),u=o.queue;if(u===null)throw Error(s(311));u.lastRenderedReducer=a;var m=u.dispatch,y=u.pending,b=o.memoizedState;if(y!==null){u.pending=null;var I=y=y.next;do b=a(b,I.action),I=I.next;while(I!==y);Ks(b,o.memoizedState)||(es=!0),o.memoizedState=b,o.baseQueue===null&&(o.baseState=b),u.lastRenderedState=b}return[b,m]}function Dp(a,o,u){var m=Xe,y=qt(),b=lt;if(b){if(u===void 0)throw Error(s(407));u=u()}else u=o();var I=!Ks((bt||y).memoizedState,u);if(I&&(y.memoizedState=u,es=!0),y=y.queue,gd(Up.bind(null,m,y,a),[a]),y.getSnapshot!==o||I||Jt!==null&&Jt.memoizedState.tag&1){if(m.flags|=2048,er(9,{destroy:void 0},Pp.bind(null,m,y,u,o),null),wt===null)throw Error(s(349));b||(an&127)!==0||kp(m,o,u)}return u}function kp(a,o,u){a.flags|=16384,a={getSnapshot:o,value:u},o=Xe.updateQueue,o===null?(o=Eo(),Xe.updateQueue=o,o.stores=[a]):(u=o.stores,u===null?o.stores=[a]:u.push(a))}function Pp(a,o,u,m){o.value=u,o.getSnapshot=m,Mp(o)&&jp(a)}function Up(a,o,u){return u(function(){Mp(o)&&jp(a)})}function Mp(a){var o=a.getSnapshot;a=a.value;try{var u=o();return!Ks(a,u)}catch{return!0}}function jp(a){var o=la(a,2);o!==null&&Ms(o,a,2)}function md(a){var o=Ls();if(typeof a=="function"){var u=a;if(a=u(),ga){Wt(!0);try{u()}finally{Wt(!1)}}}return o.memoizedState=o.baseState=a,o.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:rn,lastRenderedState:a},o}function Fp(a,o,u,m){return a.baseState=u,hd(a,bt,typeof m=="function"?m:rn)}function YE(a,o,u,m,y){if(Ro(a))throw Error(s(485));if(a=o.action,a!==null){var b={payload:y,action:a,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(I){b.listeners.push(I)}};k.T!==null?u(!0):b.isTransition=!1,m(b),u=o.pending,u===null?(b.next=o.pending=b,Bp(o,b)):(b.next=u.next,o.pending=u.next=b)}}function Bp(a,o){var u=o.action,m=o.payload,y=a.state;if(o.isTransition){var b=k.T,I={};k.T=I;try{var O=u(y,m),B=k.S;B!==null&&B(I,O),$p(a,o,O)}catch(W){pd(a,o,W)}finally{b!==null&&I.types!==null&&(b.types=I.types),k.T=b}}else try{b=u(y,m),$p(a,o,b)}catch(W){pd(a,o,W)}}function $p(a,o,u){u!==null&&typeof u=="object"&&typeof u.then=="function"?u.then(function(m){Vp(a,o,m)},function(m){return pd(a,o,m)}):Vp(a,o,u)}function Vp(a,o,u){o.status="fulfilled",o.value=u,Gp(o),a.state=u,o=a.pending,o!==null&&(u=o.next,u===o?a.pending=null:(u=u.next,o.next=u,Bp(a,u)))}function pd(a,o,u){var m=a.pending;if(a.pending=null,m!==null){m=m.next;do o.status="rejected",o.reason=u,Gp(o),o=o.next;while(o!==m)}a.action=null}function Gp(a){a=a.listeners;for(var o=0;o<a.length;o++)(0,a[o])()}function Hp(a,o){return o}function zp(a,o){if(lt){var u=wt.formState;if(u!==null){e:{var m=Xe;if(lt){if(kt){t:{for(var y=kt,b=mi;y.nodeType!==8;){if(!b){y=null;break t}if(y=gi(y.nextSibling),y===null){y=null;break t}}b=y.data,y=b==="F!"||b==="F"?y:null}if(y){kt=gi(y.nextSibling),m=y.data==="F!";break e}}wn(m)}m=!1}m&&(o=u[0])}}return u=Ls(),u.memoizedState=u.baseState=o,m={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Hp,lastRenderedState:o},u.queue=m,u=ug.bind(null,Xe,m),m.dispatch=u,m=md(!1),b=bd.bind(null,Xe,!1,m.queue),m=Ls(),y={state:o,dispatch:null,action:a,pending:null},m.queue=y,u=YE.bind(null,Xe,y,b,u),y.dispatch=u,m.memoizedState=a,[o,u,!1]}function Kp(a){var o=qt();return Yp(o,bt,a)}function Yp(a,o,u){if(o=hd(a,o,Hp)[0],a=Ao(rn)[0],typeof o=="object"&&o!==null&&typeof o.then=="function")try{var m=tl(o)}catch(I){throw I===Qa?mo:I}else m=o;o=qt();var y=o.queue,b=y.dispatch;return u!==o.memoizedState&&(Xe.flags|=2048,er(9,{destroy:void 0},qE.bind(null,y,u),null)),[m,b,a]}function qE(a,o){a.action=o}function qp(a){var o=qt(),u=bt;if(u!==null)return Yp(o,u,a);qt(),o=o.memoizedState,u=qt();var m=u.queue.dispatch;return u.memoizedState=a,[o,m,!1]}function er(a,o,u,m){return a={tag:a,create:u,deps:m,inst:o,next:null},o=Xe.updateQueue,o===null&&(o=Eo(),Xe.updateQueue=o),u=o.lastEffect,u===null?o.lastEffect=a.next=a:(m=u.next,u.next=a,a.next=m,o.lastEffect=a),a}function Qp(){return qt().memoizedState}function _o(a,o,u,m){var y=Ls();Xe.flags|=a,y.memoizedState=er(1|o,{destroy:void 0},u,m===void 0?null:m)}function Io(a,o,u,m){var y=qt();m=m===void 0?null:m;var b=y.memoizedState.inst;bt!==null&&m!==null&&rd(m,bt.memoizedState.deps)?y.memoizedState=er(o,b,u,m):(Xe.flags|=a,y.memoizedState=er(1|o,b,u,m))}function Xp(a,o){_o(8390656,8,a,o)}function gd(a,o){Io(2048,8,a,o)}function QE(a){Xe.flags|=4;var o=Xe.updateQueue;if(o===null)o=Eo(),Xe.updateQueue=o,o.events=[a];else{var u=o.events;u===null?o.events=[a]:u.push(a)}}function Wp(a){var o=qt().memoizedState;return QE({ref:o,nextImpl:a}),function(){if((ft&2)!==0)throw Error(s(440));return o.impl.apply(void 0,arguments)}}function Zp(a,o){return Io(4,2,a,o)}function Jp(a,o){return Io(4,4,a,o)}function eg(a,o){if(typeof o=="function"){a=a();var u=o(a);return function(){typeof u=="function"?u():o(null)}}if(o!=null)return a=a(),o.current=a,function(){o.current=null}}function tg(a,o,u){u=u!=null?u.concat([a]):null,Io(4,4,eg.bind(null,o,a),u)}function vd(){}function sg(a,o){var u=qt();o=o===void 0?null:o;var m=u.memoizedState;return o!==null&&rd(o,m[1])?m[0]:(u.memoizedState=[a,o],a)}function ig(a,o){var u=qt();o=o===void 0?null:o;var m=u.memoizedState;if(o!==null&&rd(o,m[1]))return m[0];if(m=a(),ga){Wt(!0);try{a()}finally{Wt(!1)}}return u.memoizedState=[m,o],m}function yd(a,o,u){return u===void 0||(an&1073741824)!==0&&(at&261930)===0?a.memoizedState=o:(a.memoizedState=u,a=n0(),Xe.lanes|=a,jn|=a,u)}function ng(a,o,u,m){return Ks(u,o)?u:Wa.current!==null?(a=yd(a,u,m),Ks(a,o)||(es=!0),a):(an&42)===0||(an&1073741824)!==0&&(at&261930)===0?(es=!0,a.memoizedState=u):(a=n0(),Xe.lanes|=a,jn|=a,o)}function ag(a,o,u,m,y){var b=G.p;G.p=b!==0&&8>b?b:8;var I=k.T,O={};k.T=O,bd(a,!1,o,u);try{var B=y(),W=k.S;if(W!==null&&W(O,B),B!==null&&typeof B=="object"&&typeof B.then=="function"){var ae=HE(B,m);sl(a,o,ae,Zs(a))}else sl(a,o,m,Zs(a))}catch(he){sl(a,o,{then:function(){},status:"rejected",reason:he},Zs())}finally{G.p=b,I!==null&&O.types!==null&&(I.types=O.types),k.T=I}}function XE(){}function xd(a,o,u,m){if(a.tag!==5)throw Error(s(476));var y=rg(a).queue;ag(a,y,o,Y,u===null?XE:function(){return lg(a),u(m)})}function rg(a){var o=a.memoizedState;if(o!==null)return o;o={memoizedState:Y,baseState:Y,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:rn,lastRenderedState:Y},next:null};var u={};return o.next={memoizedState:u,baseState:u,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:rn,lastRenderedState:u},next:null},a.memoizedState=o,a=a.alternate,a!==null&&(a.memoizedState=o),o}function lg(a){var o=rg(a);o.next===null&&(o=a.alternate.memoizedState),sl(a,o.next.queue,{},Zs())}function Sd(){return fs(xl)}function og(){return qt().memoizedState}function cg(){return qt().memoizedState}function WE(a){for(var o=a.return;o!==null;){switch(o.tag){case 24:case 3:var u=Zs();a=Nn(u);var m=Dn(o,a,u);m!==null&&(Ms(m,o,u),Wr(m,o,u)),o={cache:Qu()},a.payload=o;return}o=o.return}}function ZE(a,o,u){var m=Zs();u={lane:m,revertLane:0,gesture:null,action:u,hasEagerState:!1,eagerState:null,next:null},Ro(a)?dg(o,u):(u=ju(a,o,u,m),u!==null&&(Ms(u,a,m),hg(u,o,m)))}function ug(a,o,u){var m=Zs();sl(a,o,u,m)}function sl(a,o,u,m){var y={lane:m,revertLane:0,gesture:null,action:u,hasEagerState:!1,eagerState:null,next:null};if(Ro(a))dg(o,y);else{var b=a.alternate;if(a.lanes===0&&(b===null||b.lanes===0)&&(b=o.lastRenderedReducer,b!==null))try{var I=o.lastRenderedState,O=b(I,u);if(y.hasEagerState=!0,y.eagerState=O,Ks(O,I))return ro(a,o,y,0),wt===null&&ao(),!1}catch{}if(u=ju(a,o,y,m),u!==null)return Ms(u,a,m),hg(u,o,m),!0}return!1}function bd(a,o,u,m){if(m={lane:2,revertLane:Jd(),gesture:null,action:m,hasEagerState:!1,eagerState:null,next:null},Ro(a)){if(o)throw Error(s(479))}else o=ju(a,u,m,2),o!==null&&Ms(o,a,2)}function Ro(a){var o=a.alternate;return a===Xe||o!==null&&o===Xe}function dg(a,o){Za=So=!0;var u=a.pending;u===null?o.next=o:(o.next=u.next,u.next=o),a.pending=o}function hg(a,o,u){if((u&4194048)!==0){var m=o.lanes;m&=a.pendingLanes,u|=m,o.lanes=u,_n(a,u)}}var il={readContext:fs,use:To,useCallback:Vt,useContext:Vt,useEffect:Vt,useImperativeHandle:Vt,useLayoutEffect:Vt,useInsertionEffect:Vt,useMemo:Vt,useReducer:Vt,useRef:Vt,useState:Vt,useDebugValue:Vt,useDeferredValue:Vt,useTransition:Vt,useSyncExternalStore:Vt,useId:Vt,useHostTransitionStatus:Vt,useFormState:Vt,useActionState:Vt,useOptimistic:Vt,useMemoCache:Vt,useCacheRefresh:Vt};il.useEffectEvent=Vt;var fg={readContext:fs,use:To,useCallback:function(a,o){return Ls().memoizedState=[a,o===void 0?null:o],a},useContext:fs,useEffect:Xp,useImperativeHandle:function(a,o,u){u=u!=null?u.concat([a]):null,_o(4194308,4,eg.bind(null,o,a),u)},useLayoutEffect:function(a,o){return _o(4194308,4,a,o)},useInsertionEffect:function(a,o){_o(4,2,a,o)},useMemo:function(a,o){var u=Ls();o=o===void 0?null:o;var m=a();if(ga){Wt(!0);try{a()}finally{Wt(!1)}}return u.memoizedState=[m,o],m},useReducer:function(a,o,u){var m=Ls();if(u!==void 0){var y=u(o);if(ga){Wt(!0);try{u(o)}finally{Wt(!1)}}}else y=o;return m.memoizedState=m.baseState=y,a={pending:null,lanes:0,dispatch:null,lastRenderedReducer:a,lastRenderedState:y},m.queue=a,a=a.dispatch=ZE.bind(null,Xe,a),[m.memoizedState,a]},useRef:function(a){var o=Ls();return a={current:a},o.memoizedState=a},useState:function(a){a=md(a);var o=a.queue,u=ug.bind(null,Xe,o);return o.dispatch=u,[a.memoizedState,u]},useDebugValue:vd,useDeferredValue:function(a,o){var u=Ls();return yd(u,a,o)},useTransition:function(){var a=md(!1);return a=ag.bind(null,Xe,a.queue,!0,!1),Ls().memoizedState=a,[!1,a]},useSyncExternalStore:function(a,o,u){var m=Xe,y=Ls();if(lt){if(u===void 0)throw Error(s(407));u=u()}else{if(u=o(),wt===null)throw Error(s(349));(at&127)!==0||kp(m,o,u)}y.memoizedState=u;var b={value:u,getSnapshot:o};return y.queue=b,Xp(Up.bind(null,m,b,a),[a]),m.flags|=2048,er(9,{destroy:void 0},Pp.bind(null,m,b,u,o),null),u},useId:function(){var a=Ls(),o=wt.identifierPrefix;if(lt){var u=Di,m=Ni;u=(m&~(1<<32-Nt(m)-1)).toString(32)+u,o="_"+o+"R_"+u,u=bo++,0<u&&(o+="H"+u.toString(32)),o+="_"}else u=zE++,o="_"+o+"r_"+u.toString(32)+"_";return a.memoizedState=o},useHostTransitionStatus:Sd,useFormState:zp,useActionState:zp,useOptimistic:function(a){var o=Ls();o.memoizedState=o.baseState=a;var u={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return o.queue=u,o=bd.bind(null,Xe,!0,u),u.dispatch=o,[a,o]},useMemoCache:dd,useCacheRefresh:function(){return Ls().memoizedState=WE.bind(null,Xe)},useEffectEvent:function(a){var o=Ls(),u={impl:a};return o.memoizedState=u,function(){if((ft&2)!==0)throw Error(s(440));return u.impl.apply(void 0,arguments)}}},Ed={readContext:fs,use:To,useCallback:sg,useContext:fs,useEffect:gd,useImperativeHandle:tg,useInsertionEffect:Zp,useLayoutEffect:Jp,useMemo:ig,useReducer:Ao,useRef:Qp,useState:function(){return Ao(rn)},useDebugValue:vd,useDeferredValue:function(a,o){var u=qt();return ng(u,bt.memoizedState,a,o)},useTransition:function(){var a=Ao(rn)[0],o=qt().memoizedState;return[typeof a=="boolean"?a:tl(a),o]},useSyncExternalStore:Dp,useId:og,useHostTransitionStatus:Sd,useFormState:Kp,useActionState:Kp,useOptimistic:function(a,o){var u=qt();return Fp(u,bt,a,o)},useMemoCache:dd,useCacheRefresh:cg};Ed.useEffectEvent=Wp;var mg={readContext:fs,use:To,useCallback:sg,useContext:fs,useEffect:gd,useImperativeHandle:tg,useInsertionEffect:Zp,useLayoutEffect:Jp,useMemo:ig,useReducer:fd,useRef:Qp,useState:function(){return fd(rn)},useDebugValue:vd,useDeferredValue:function(a,o){var u=qt();return bt===null?yd(u,a,o):ng(u,bt.memoizedState,a,o)},useTransition:function(){var a=fd(rn)[0],o=qt().memoizedState;return[typeof a=="boolean"?a:tl(a),o]},useSyncExternalStore:Dp,useId:og,useHostTransitionStatus:Sd,useFormState:qp,useActionState:qp,useOptimistic:function(a,o){var u=qt();return bt!==null?Fp(u,bt,a,o):(u.baseState=a,[a,u.queue.dispatch])},useMemoCache:dd,useCacheRefresh:cg};mg.useEffectEvent=Wp;function Td(a,o,u,m){o=a.memoizedState,u=u(m,o),u=u==null?o:p({},o,u),a.memoizedState=u,a.lanes===0&&(a.updateQueue.baseState=u)}var Ad={enqueueSetState:function(a,o,u){a=a._reactInternals;var m=Zs(),y=Nn(m);y.payload=o,u!=null&&(y.callback=u),o=Dn(a,y,m),o!==null&&(Ms(o,a,m),Wr(o,a,m))},enqueueReplaceState:function(a,o,u){a=a._reactInternals;var m=Zs(),y=Nn(m);y.tag=1,y.payload=o,u!=null&&(y.callback=u),o=Dn(a,y,m),o!==null&&(Ms(o,a,m),Wr(o,a,m))},enqueueForceUpdate:function(a,o){a=a._reactInternals;var u=Zs(),m=Nn(u);m.tag=2,o!=null&&(m.callback=o),o=Dn(a,m,u),o!==null&&(Ms(o,a,u),Wr(o,a,u))}};function pg(a,o,u,m,y,b,I){return a=a.stateNode,typeof a.shouldComponentUpdate=="function"?a.shouldComponentUpdate(m,b,I):o.prototype&&o.prototype.isPureReactComponent?!Gr(u,m)||!Gr(y,b):!0}function gg(a,o,u,m){a=o.state,typeof o.componentWillReceiveProps=="function"&&o.componentWillReceiveProps(u,m),typeof o.UNSAFE_componentWillReceiveProps=="function"&&o.UNSAFE_componentWillReceiveProps(u,m),o.state!==a&&Ad.enqueueReplaceState(o,o.state,null)}function va(a,o){var u=o;if("ref"in o){u={};for(var m in o)m!=="ref"&&(u[m]=o[m])}if(a=a.defaultProps){u===o&&(u=p({},u));for(var y in a)u[y]===void 0&&(u[y]=a[y])}return u}function vg(a){no(a)}function yg(a){console.error(a)}function xg(a){no(a)}function Lo(a,o){try{var u=a.onUncaughtError;u(o.value,{componentStack:o.stack})}catch(m){setTimeout(function(){throw m})}}function Sg(a,o,u){try{var m=a.onCaughtError;m(u.value,{componentStack:u.stack,errorBoundary:o.tag===1?o.stateNode:null})}catch(y){setTimeout(function(){throw y})}}function _d(a,o,u){return u=Nn(u),u.tag=3,u.payload={element:null},u.callback=function(){Lo(a,o)},u}function bg(a){return a=Nn(a),a.tag=3,a}function Eg(a,o,u,m){var y=u.type.getDerivedStateFromError;if(typeof y=="function"){var b=m.value;a.payload=function(){return y(b)},a.callback=function(){Sg(o,u,m)}}var I=u.stateNode;I!==null&&typeof I.componentDidCatch=="function"&&(a.callback=function(){Sg(o,u,m),typeof y!="function"&&(Fn===null?Fn=new Set([this]):Fn.add(this));var O=m.stack;this.componentDidCatch(m.value,{componentStack:O!==null?O:""})})}function JE(a,o,u,m,y){if(u.flags|=32768,m!==null&&typeof m=="object"&&typeof m.then=="function"){if(o=u.alternate,o!==null&&Ka(o,u,y,!0),u=qs.current,u!==null){switch(u.tag){case 31:case 13:return pi===null?Bo():u.alternate===null&&Gt===0&&(Gt=3),u.flags&=-257,u.flags|=65536,u.lanes=y,m===po?u.flags|=16384:(o=u.updateQueue,o===null?u.updateQueue=new Set([m]):o.add(m),Xd(a,m,y)),!1;case 22:return u.flags|=65536,m===po?u.flags|=16384:(o=u.updateQueue,o===null?(o={transitions:null,markerInstances:null,retryQueue:new Set([m])},u.updateQueue=o):(u=o.retryQueue,u===null?o.retryQueue=new Set([m]):u.add(m)),Xd(a,m,y)),!1}throw Error(s(435,u.tag))}return Xd(a,m,y),Bo(),!1}if(lt)return o=qs.current,o!==null?((o.flags&65536)===0&&(o.flags|=256),o.flags|=65536,o.lanes=y,m!==Hu&&(a=Error(s(422),{cause:m}),Kr(di(a,u)))):(m!==Hu&&(o=Error(s(423),{cause:m}),Kr(di(o,u))),a=a.current.alternate,a.flags|=65536,y&=-y,a.lanes|=y,m=di(m,u),y=_d(a.stateNode,m,y),td(a,y),Gt!==4&&(Gt=2)),!1;var b=Error(s(520),{cause:m});if(b=di(b,u),dl===null?dl=[b]:dl.push(b),Gt!==4&&(Gt=2),o===null)return!0;m=di(m,u),u=o;do{switch(u.tag){case 3:return u.flags|=65536,a=y&-y,u.lanes|=a,a=_d(u.stateNode,m,a),td(u,a),!1;case 1:if(o=u.type,b=u.stateNode,(u.flags&128)===0&&(typeof o.getDerivedStateFromError=="function"||b!==null&&typeof b.componentDidCatch=="function"&&(Fn===null||!Fn.has(b))))return u.flags|=65536,y&=-y,u.lanes|=y,y=bg(y),Eg(y,a,u,m),td(u,y),!1}u=u.return}while(u!==null);return!1}var Id=Error(s(461)),es=!1;function ms(a,o,u,m){o.child=a===null?Ip(o,null,u,m):pa(o,a.child,u,m)}function Tg(a,o,u,m,y){u=u.render;var b=o.ref;if("ref"in m){var I={};for(var O in m)O!=="ref"&&(I[O]=m[O])}else I=m;return da(o),m=ld(a,o,u,I,b,y),O=od(),a!==null&&!es?(cd(a,o,y),ln(a,o,y)):(lt&&O&&Vu(o),o.flags|=1,ms(a,o,m,y),o.child)}function Ag(a,o,u,m,y){if(a===null){var b=u.type;return typeof b=="function"&&!Fu(b)&&b.defaultProps===void 0&&u.compare===null?(o.tag=15,o.type=b,_g(a,o,b,m,y)):(a=oo(u.type,null,m,o,o.mode,y),a.ref=o.ref,a.return=o,o.child=a)}if(b=a.child,!kd(a,y)){var I=b.memoizedProps;if(u=u.compare,u=u!==null?u:Gr,u(I,m)&&a.ref===o.ref)return ln(a,o,y)}return o.flags|=1,a=en(b,m),a.ref=o.ref,a.return=o,o.child=a}function _g(a,o,u,m,y){if(a!==null){var b=a.memoizedProps;if(Gr(b,m)&&a.ref===o.ref)if(es=!1,o.pendingProps=m=b,kd(a,y))(a.flags&131072)!==0&&(es=!0);else return o.lanes=a.lanes,ln(a,o,y)}return Rd(a,o,u,m,y)}function Ig(a,o,u,m){var y=m.children,b=a!==null?a.memoizedState:null;if(a===null&&o.stateNode===null&&(o.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),m.mode==="hidden"){if((o.flags&128)!==0){if(b=b!==null?b.baseLanes|u:u,a!==null){for(m=o.child=a.child,y=0;m!==null;)y=y|m.lanes|m.childLanes,m=m.sibling;m=y&~b}else m=0,o.child=null;return Rg(a,o,b,u,m)}if((u&536870912)!==0)o.memoizedState={baseLanes:0,cachePool:null},a!==null&&fo(o,b!==null?b.cachePool:null),b!==null?wp(o,b):id(),Cp(o);else return m=o.lanes=536870912,Rg(a,o,b!==null?b.baseLanes|u:u,u,m)}else b!==null?(fo(o,b.cachePool),wp(o,b),Pn(),o.memoizedState=null):(a!==null&&fo(o,null),id(),Pn());return ms(a,o,y,u),o.child}function nl(a,o){return a!==null&&a.tag===22||o.stateNode!==null||(o.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),o.sibling}function Rg(a,o,u,m,y){var b=Wu();return b=b===null?null:{parent:Zt._currentValue,pool:b},o.memoizedState={baseLanes:u,cachePool:b},a!==null&&fo(o,null),id(),Cp(o),a!==null&&Ka(a,o,m,!0),o.childLanes=y,null}function wo(a,o){return o=Oo({mode:o.mode,children:o.children},a.mode),o.ref=a.ref,a.child=o,o.return=a,o}function Lg(a,o,u){return pa(o,a.child,null,u),a=wo(o,o.pendingProps),a.flags|=2,Qs(o),o.memoizedState=null,a}function eT(a,o,u){var m=o.pendingProps,y=(o.flags&128)!==0;if(o.flags&=-129,a===null){if(lt){if(m.mode==="hidden")return a=wo(o,m),o.lanes=536870912,nl(null,a);if(ad(o),(a=kt)?(a=B0(a,mi),a=a!==null&&a.data==="&"?a:null,a!==null&&(o.memoizedState={dehydrated:a,treeContext:Rn!==null?{id:Ni,overflow:Di}:null,retryLane:536870912,hydrationErrors:null},u=dp(a),u.return=o,o.child=u,hs=o,kt=null)):a=null,a===null)throw wn(o);return o.lanes=536870912,null}return wo(o,m)}var b=a.memoizedState;if(b!==null){var I=b.dehydrated;if(ad(o),y)if(o.flags&256)o.flags&=-257,o=Lg(a,o,u);else if(o.memoizedState!==null)o.child=a.child,o.flags|=128,o=null;else throw Error(s(558));else if(es||Ka(a,o,u,!1),y=(u&a.childLanes)!==0,es||y){if(m=wt,m!==null&&(I=ce(m,u),I!==0&&I!==b.retryLane))throw b.retryLane=I,la(a,I),Ms(m,a,I),Id;Bo(),o=Lg(a,o,u)}else a=b.treeContext,kt=gi(I.nextSibling),hs=o,lt=!0,Ln=null,mi=!1,a!==null&&mp(o,a),o=wo(o,m),o.flags|=4096;return o}return a=en(a.child,{mode:m.mode,children:m.children}),a.ref=o.ref,o.child=a,a.return=o,a}function Co(a,o){var u=o.ref;if(u===null)a!==null&&a.ref!==null&&(o.flags|=4194816);else{if(typeof u!="function"&&typeof u!="object")throw Error(s(284));(a===null||a.ref!==u)&&(o.flags|=4194816)}}function Rd(a,o,u,m,y){return da(o),u=ld(a,o,u,m,void 0,y),m=od(),a!==null&&!es?(cd(a,o,y),ln(a,o,y)):(lt&&m&&Vu(o),o.flags|=1,ms(a,o,u,y),o.child)}function wg(a,o,u,m,y,b){return da(o),o.updateQueue=null,u=Np(o,m,u,y),Op(a),m=od(),a!==null&&!es?(cd(a,o,b),ln(a,o,b)):(lt&&m&&Vu(o),o.flags|=1,ms(a,o,u,b),o.child)}function Cg(a,o,u,m,y){if(da(o),o.stateNode===null){var b=Va,I=u.contextType;typeof I=="object"&&I!==null&&(b=fs(I)),b=new u(m,b),o.memoizedState=b.state!==null&&b.state!==void 0?b.state:null,b.updater=Ad,o.stateNode=b,b._reactInternals=o,b=o.stateNode,b.props=m,b.state=o.memoizedState,b.refs={},Ju(o),I=u.contextType,b.context=typeof I=="object"&&I!==null?fs(I):Va,b.state=o.memoizedState,I=u.getDerivedStateFromProps,typeof I=="function"&&(Td(o,u,I,m),b.state=o.memoizedState),typeof u.getDerivedStateFromProps=="function"||typeof b.getSnapshotBeforeUpdate=="function"||typeof b.UNSAFE_componentWillMount!="function"&&typeof b.componentWillMount!="function"||(I=b.state,typeof b.componentWillMount=="function"&&b.componentWillMount(),typeof b.UNSAFE_componentWillMount=="function"&&b.UNSAFE_componentWillMount(),I!==b.state&&Ad.enqueueReplaceState(b,b.state,null),Jr(o,m,b,y),Zr(),b.state=o.memoizedState),typeof b.componentDidMount=="function"&&(o.flags|=4194308),m=!0}else if(a===null){b=o.stateNode;var O=o.memoizedProps,B=va(u,O);b.props=B;var W=b.context,ae=u.contextType;I=Va,typeof ae=="object"&&ae!==null&&(I=fs(ae));var he=u.getDerivedStateFromProps;ae=typeof he=="function"||typeof b.getSnapshotBeforeUpdate=="function",O=o.pendingProps!==O,ae||typeof b.UNSAFE_componentWillReceiveProps!="function"&&typeof b.componentWillReceiveProps!="function"||(O||W!==I)&&gg(o,b,m,I),On=!1;var Z=o.memoizedState;b.state=Z,Jr(o,m,b,y),Zr(),W=o.memoizedState,O||Z!==W||On?(typeof he=="function"&&(Td(o,u,he,m),W=o.memoizedState),(B=On||pg(o,u,B,m,Z,W,I))?(ae||typeof b.UNSAFE_componentWillMount!="function"&&typeof b.componentWillMount!="function"||(typeof b.componentWillMount=="function"&&b.componentWillMount(),typeof b.UNSAFE_componentWillMount=="function"&&b.UNSAFE_componentWillMount()),typeof b.componentDidMount=="function"&&(o.flags|=4194308)):(typeof b.componentDidMount=="function"&&(o.flags|=4194308),o.memoizedProps=m,o.memoizedState=W),b.props=m,b.state=W,b.context=I,m=B):(typeof b.componentDidMount=="function"&&(o.flags|=4194308),m=!1)}else{b=o.stateNode,ed(a,o),I=o.memoizedProps,ae=va(u,I),b.props=ae,he=o.pendingProps,Z=b.context,W=u.contextType,B=Va,typeof W=="object"&&W!==null&&(B=fs(W)),O=u.getDerivedStateFromProps,(W=typeof O=="function"||typeof b.getSnapshotBeforeUpdate=="function")||typeof b.UNSAFE_componentWillReceiveProps!="function"&&typeof b.componentWillReceiveProps!="function"||(I!==he||Z!==B)&&gg(o,b,m,B),On=!1,Z=o.memoizedState,b.state=Z,Jr(o,m,b,y),Zr();var te=o.memoizedState;I!==he||Z!==te||On||a!==null&&a.dependencies!==null&&uo(a.dependencies)?(typeof O=="function"&&(Td(o,u,O,m),te=o.memoizedState),(ae=On||pg(o,u,ae,m,Z,te,B)||a!==null&&a.dependencies!==null&&uo(a.dependencies))?(W||typeof b.UNSAFE_componentWillUpdate!="function"&&typeof b.componentWillUpdate!="function"||(typeof b.componentWillUpdate=="function"&&b.componentWillUpdate(m,te,B),typeof b.UNSAFE_componentWillUpdate=="function"&&b.UNSAFE_componentWillUpdate(m,te,B)),typeof b.componentDidUpdate=="function"&&(o.flags|=4),typeof b.getSnapshotBeforeUpdate=="function"&&(o.flags|=1024)):(typeof b.componentDidUpdate!="function"||I===a.memoizedProps&&Z===a.memoizedState||(o.flags|=4),typeof b.getSnapshotBeforeUpdate!="function"||I===a.memoizedProps&&Z===a.memoizedState||(o.flags|=1024),o.memoizedProps=m,o.memoizedState=te),b.props=m,b.state=te,b.context=B,m=ae):(typeof b.componentDidUpdate!="function"||I===a.memoizedProps&&Z===a.memoizedState||(o.flags|=4),typeof b.getSnapshotBeforeUpdate!="function"||I===a.memoizedProps&&Z===a.memoizedState||(o.flags|=1024),m=!1)}return b=m,Co(a,o),m=(o.flags&128)!==0,b||m?(b=o.stateNode,u=m&&typeof u.getDerivedStateFromError!="function"?null:b.render(),o.flags|=1,a!==null&&m?(o.child=pa(o,a.child,null,y),o.child=pa(o,null,u,y)):ms(a,o,u,y),o.memoizedState=b.state,a=o.child):a=ln(a,o,y),a}function Og(a,o,u,m){return ca(),o.flags|=256,ms(a,o,u,m),o.child}var Ld={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function wd(a){return{baseLanes:a,cachePool:Sp()}}function Cd(a,o,u){return a=a!==null?a.childLanes&~u:0,o&&(a|=Ws),a}function Ng(a,o,u){var m=o.pendingProps,y=!1,b=(o.flags&128)!==0,I;if((I=b)||(I=a!==null&&a.memoizedState===null?!1:(Yt.current&2)!==0),I&&(y=!0,o.flags&=-129),I=(o.flags&32)!==0,o.flags&=-33,a===null){if(lt){if(y?kn(o):Pn(),(a=kt)?(a=B0(a,mi),a=a!==null&&a.data!=="&"?a:null,a!==null&&(o.memoizedState={dehydrated:a,treeContext:Rn!==null?{id:Ni,overflow:Di}:null,retryLane:536870912,hydrationErrors:null},u=dp(a),u.return=o,o.child=u,hs=o,kt=null)):a=null,a===null)throw wn(o);return hh(a)?o.lanes=32:o.lanes=536870912,null}var O=m.children;return m=m.fallback,y?(Pn(),y=o.mode,O=Oo({mode:"hidden",children:O},y),m=oa(m,y,u,null),O.return=o,m.return=o,O.sibling=m,o.child=O,m=o.child,m.memoizedState=wd(u),m.childLanes=Cd(a,I,u),o.memoizedState=Ld,nl(null,m)):(kn(o),Od(o,O))}var B=a.memoizedState;if(B!==null&&(O=B.dehydrated,O!==null)){if(b)o.flags&256?(kn(o),o.flags&=-257,o=Nd(a,o,u)):o.memoizedState!==null?(Pn(),o.child=a.child,o.flags|=128,o=null):(Pn(),O=m.fallback,y=o.mode,m=Oo({mode:"visible",children:m.children},y),O=oa(O,y,u,null),O.flags|=2,m.return=o,O.return=o,m.sibling=O,o.child=m,pa(o,a.child,null,u),m=o.child,m.memoizedState=wd(u),m.childLanes=Cd(a,I,u),o.memoizedState=Ld,o=nl(null,m));else if(kn(o),hh(O)){if(I=O.nextSibling&&O.nextSibling.dataset,I)var W=I.dgst;I=W,m=Error(s(419)),m.stack="",m.digest=I,Kr({value:m,source:null,stack:null}),o=Nd(a,o,u)}else if(es||Ka(a,o,u,!1),I=(u&a.childLanes)!==0,es||I){if(I=wt,I!==null&&(m=ce(I,u),m!==0&&m!==B.retryLane))throw B.retryLane=m,la(a,m),Ms(I,a,m),Id;dh(O)||Bo(),o=Nd(a,o,u)}else dh(O)?(o.flags|=192,o.child=a.child,o=null):(a=B.treeContext,kt=gi(O.nextSibling),hs=o,lt=!0,Ln=null,mi=!1,a!==null&&mp(o,a),o=Od(o,m.children),o.flags|=4096);return o}return y?(Pn(),O=m.fallback,y=o.mode,B=a.child,W=B.sibling,m=en(B,{mode:"hidden",children:m.children}),m.subtreeFlags=B.subtreeFlags&65011712,W!==null?O=en(W,O):(O=oa(O,y,u,null),O.flags|=2),O.return=o,m.return=o,m.sibling=O,o.child=m,nl(null,m),m=o.child,O=a.child.memoizedState,O===null?O=wd(u):(y=O.cachePool,y!==null?(B=Zt._currentValue,y=y.parent!==B?{parent:B,pool:B}:y):y=Sp(),O={baseLanes:O.baseLanes|u,cachePool:y}),m.memoizedState=O,m.childLanes=Cd(a,I,u),o.memoizedState=Ld,nl(a.child,m)):(kn(o),u=a.child,a=u.sibling,u=en(u,{mode:"visible",children:m.children}),u.return=o,u.sibling=null,a!==null&&(I=o.deletions,I===null?(o.deletions=[a],o.flags|=16):I.push(a)),o.child=u,o.memoizedState=null,u)}function Od(a,o){return o=Oo({mode:"visible",children:o},a.mode),o.return=a,a.child=o}function Oo(a,o){return a=Ys(22,a,null,o),a.lanes=0,a}function Nd(a,o,u){return pa(o,a.child,null,u),a=Od(o,o.pendingProps.children),a.flags|=2,o.memoizedState=null,a}function Dg(a,o,u){a.lanes|=o;var m=a.alternate;m!==null&&(m.lanes|=o),Yu(a.return,o,u)}function Dd(a,o,u,m,y,b){var I=a.memoizedState;I===null?a.memoizedState={isBackwards:o,rendering:null,renderingStartTime:0,last:m,tail:u,tailMode:y,treeForkCount:b}:(I.isBackwards=o,I.rendering=null,I.renderingStartTime=0,I.last=m,I.tail=u,I.tailMode=y,I.treeForkCount=b)}function kg(a,o,u){var m=o.pendingProps,y=m.revealOrder,b=m.tail;m=m.children;var I=Yt.current,O=(I&2)!==0;if(O?(I=I&1|2,o.flags|=128):I&=1,ie(Yt,I),ms(a,o,m,u),m=lt?zr:0,!O&&a!==null&&(a.flags&128)!==0)e:for(a=o.child;a!==null;){if(a.tag===13)a.memoizedState!==null&&Dg(a,u,o);else if(a.tag===19)Dg(a,u,o);else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===o)break e;for(;a.sibling===null;){if(a.return===null||a.return===o)break e;a=a.return}a.sibling.return=a.return,a=a.sibling}switch(y){case"forwards":for(u=o.child,y=null;u!==null;)a=u.alternate,a!==null&&xo(a)===null&&(y=u),u=u.sibling;u=y,u===null?(y=o.child,o.child=null):(y=u.sibling,u.sibling=null),Dd(o,!1,y,u,b,m);break;case"backwards":case"unstable_legacy-backwards":for(u=null,y=o.child,o.child=null;y!==null;){if(a=y.alternate,a!==null&&xo(a)===null){o.child=y;break}a=y.sibling,y.sibling=u,u=y,y=a}Dd(o,!0,u,null,b,m);break;case"together":Dd(o,!1,null,null,void 0,m);break;default:o.memoizedState=null}return o.child}function ln(a,o,u){if(a!==null&&(o.dependencies=a.dependencies),jn|=o.lanes,(u&o.childLanes)===0)if(a!==null){if(Ka(a,o,u,!1),(u&o.childLanes)===0)return null}else return null;if(a!==null&&o.child!==a.child)throw Error(s(153));if(o.child!==null){for(a=o.child,u=en(a,a.pendingProps),o.child=u,u.return=o;a.sibling!==null;)a=a.sibling,u=u.sibling=en(a,a.pendingProps),u.return=o;u.sibling=null}return o.child}function kd(a,o){return(a.lanes&o)!==0?!0:(a=a.dependencies,!!(a!==null&&uo(a)))}function tT(a,o,u){switch(o.tag){case 3:pe(o,o.stateNode.containerInfo),Cn(o,Zt,a.memoizedState.cache),ca();break;case 27:case 5:ot(o);break;case 4:pe(o,o.stateNode.containerInfo);break;case 10:Cn(o,o.type,o.memoizedProps.value);break;case 31:if(o.memoizedState!==null)return o.flags|=128,ad(o),null;break;case 13:var m=o.memoizedState;if(m!==null)return m.dehydrated!==null?(kn(o),o.flags|=128,null):(u&o.child.childLanes)!==0?Ng(a,o,u):(kn(o),a=ln(a,o,u),a!==null?a.sibling:null);kn(o);break;case 19:var y=(a.flags&128)!==0;if(m=(u&o.childLanes)!==0,m||(Ka(a,o,u,!1),m=(u&o.childLanes)!==0),y){if(m)return kg(a,o,u);o.flags|=128}if(y=o.memoizedState,y!==null&&(y.rendering=null,y.tail=null,y.lastEffect=null),ie(Yt,Yt.current),m)break;return null;case 22:return o.lanes=0,Ig(a,o,u,o.pendingProps);case 24:Cn(o,Zt,a.memoizedState.cache)}return ln(a,o,u)}function Pg(a,o,u){if(a!==null)if(a.memoizedProps!==o.pendingProps)es=!0;else{if(!kd(a,u)&&(o.flags&128)===0)return es=!1,tT(a,o,u);es=(a.flags&131072)!==0}else es=!1,lt&&(o.flags&1048576)!==0&&fp(o,zr,o.index);switch(o.lanes=0,o.tag){case 16:e:{var m=o.pendingProps;if(a=fa(o.elementType),o.type=a,typeof a=="function")Fu(a)?(m=va(a,m),o.tag=1,o=Cg(null,o,a,m,u)):(o.tag=0,o=Rd(null,o,a,m,u));else{if(a!=null){var y=a.$$typeof;if(y===w){o.tag=11,o=Tg(null,o,a,m,u);break e}else if(y===D){o.tag=14,o=Ag(null,o,a,m,u);break e}}throw o=ne(a)||a,Error(s(306,o,""))}}return o;case 0:return Rd(a,o,o.type,o.pendingProps,u);case 1:return m=o.type,y=va(m,o.pendingProps),Cg(a,o,m,y,u);case 3:e:{if(pe(o,o.stateNode.containerInfo),a===null)throw Error(s(387));m=o.pendingProps;var b=o.memoizedState;y=b.element,ed(a,o),Jr(o,m,null,u);var I=o.memoizedState;if(m=I.cache,Cn(o,Zt,m),m!==b.cache&&qu(o,[Zt],u,!0),Zr(),m=I.element,b.isDehydrated)if(b={element:m,isDehydrated:!1,cache:I.cache},o.updateQueue.baseState=b,o.memoizedState=b,o.flags&256){o=Og(a,o,m,u);break e}else if(m!==y){y=di(Error(s(424)),o),Kr(y),o=Og(a,o,m,u);break e}else for(a=o.stateNode.containerInfo,a.nodeType===9?a=a.body:a=a.nodeName==="HTML"?a.ownerDocument.body:a,kt=gi(a.firstChild),hs=o,lt=!0,Ln=null,mi=!0,u=Ip(o,null,m,u),o.child=u;u;)u.flags=u.flags&-3|4096,u=u.sibling;else{if(ca(),m===y){o=ln(a,o,u);break e}ms(a,o,m,u)}o=o.child}return o;case 26:return Co(a,o),a===null?(u=K0(o.type,null,o.pendingProps,null))?o.memoizedState=u:lt||(u=o.type,a=o.pendingProps,m=Yo(ve.current).createElement(u),m[Lt]=o,m[Dt]=a,ps(m,u,a),cs(m),o.stateNode=m):o.memoizedState=K0(o.type,a.memoizedProps,o.pendingProps,a.memoizedState),null;case 27:return ot(o),a===null&&lt&&(m=o.stateNode=G0(o.type,o.pendingProps,ve.current),hs=o,mi=!0,y=kt,Gn(o.type)?(fh=y,kt=gi(m.firstChild)):kt=y),ms(a,o,o.pendingProps.children,u),Co(a,o),a===null&&(o.flags|=4194304),o.child;case 5:return a===null&&lt&&((y=m=kt)&&(m=OT(m,o.type,o.pendingProps,mi),m!==null?(o.stateNode=m,hs=o,kt=gi(m.firstChild),mi=!1,y=!0):y=!1),y||wn(o)),ot(o),y=o.type,b=o.pendingProps,I=a!==null?a.memoizedProps:null,m=b.children,oh(y,b)?m=null:I!==null&&oh(y,I)&&(o.flags|=32),o.memoizedState!==null&&(y=ld(a,o,KE,null,null,u),xl._currentValue=y),Co(a,o),ms(a,o,m,u),o.child;case 6:return a===null&&lt&&((a=u=kt)&&(u=NT(u,o.pendingProps,mi),u!==null?(o.stateNode=u,hs=o,kt=null,a=!0):a=!1),a||wn(o)),null;case 13:return Ng(a,o,u);case 4:return pe(o,o.stateNode.containerInfo),m=o.pendingProps,a===null?o.child=pa(o,null,m,u):ms(a,o,m,u),o.child;case 11:return Tg(a,o,o.type,o.pendingProps,u);case 7:return ms(a,o,o.pendingProps,u),o.child;case 8:return ms(a,o,o.pendingProps.children,u),o.child;case 12:return ms(a,o,o.pendingProps.children,u),o.child;case 10:return m=o.pendingProps,Cn(o,o.type,m.value),ms(a,o,m.children,u),o.child;case 9:return y=o.type._context,m=o.pendingProps.children,da(o),y=fs(y),m=m(y),o.flags|=1,ms(a,o,m,u),o.child;case 14:return Ag(a,o,o.type,o.pendingProps,u);case 15:return _g(a,o,o.type,o.pendingProps,u);case 19:return kg(a,o,u);case 31:return eT(a,o,u);case 22:return Ig(a,o,u,o.pendingProps);case 24:return da(o),m=fs(Zt),a===null?(y=Wu(),y===null&&(y=wt,b=Qu(),y.pooledCache=b,b.refCount++,b!==null&&(y.pooledCacheLanes|=u),y=b),o.memoizedState={parent:m,cache:y},Ju(o),Cn(o,Zt,y)):((a.lanes&u)!==0&&(ed(a,o),Jr(o,null,null,u),Zr()),y=a.memoizedState,b=o.memoizedState,y.parent!==m?(y={parent:m,cache:m},o.memoizedState=y,o.lanes===0&&(o.memoizedState=o.updateQueue.baseState=y),Cn(o,Zt,m)):(m=b.cache,Cn(o,Zt,m),m!==y.cache&&qu(o,[Zt],u,!0))),ms(a,o,o.pendingProps.children,u),o.child;case 29:throw o.pendingProps}throw Error(s(156,o.tag))}function on(a){a.flags|=4}function Pd(a,o,u,m,y){if((o=(a.mode&32)!==0)&&(o=!1),o){if(a.flags|=16777216,(y&335544128)===y)if(a.stateNode.complete)a.flags|=8192;else if(o0())a.flags|=8192;else throw ma=po,Zu}else a.flags&=-16777217}function Ug(a,o){if(o.type!=="stylesheet"||(o.state.loading&4)!==0)a.flags&=-16777217;else if(a.flags|=16777216,!W0(o))if(o0())a.flags|=8192;else throw ma=po,Zu}function No(a,o){o!==null&&(a.flags|=4),a.flags&16384&&(o=a.tag!==22?qi():536870912,a.lanes|=o,nr|=o)}function al(a,o){if(!lt)switch(a.tailMode){case"hidden":o=a.tail;for(var u=null;o!==null;)o.alternate!==null&&(u=o),o=o.sibling;u===null?a.tail=null:u.sibling=null;break;case"collapsed":u=a.tail;for(var m=null;u!==null;)u.alternate!==null&&(m=u),u=u.sibling;m===null?o||a.tail===null?a.tail=null:a.tail.sibling=null:m.sibling=null}}function Pt(a){var o=a.alternate!==null&&a.alternate.child===a.child,u=0,m=0;if(o)for(var y=a.child;y!==null;)u|=y.lanes|y.childLanes,m|=y.subtreeFlags&65011712,m|=y.flags&65011712,y.return=a,y=y.sibling;else for(y=a.child;y!==null;)u|=y.lanes|y.childLanes,m|=y.subtreeFlags,m|=y.flags,y.return=a,y=y.sibling;return a.subtreeFlags|=m,a.childLanes=u,o}function sT(a,o,u){var m=o.pendingProps;switch(Gu(o),o.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Pt(o),null;case 1:return Pt(o),null;case 3:return u=o.stateNode,m=null,a!==null&&(m=a.memoizedState.cache),o.memoizedState.cache!==m&&(o.flags|=2048),nn(Zt),we(),u.pendingContext&&(u.context=u.pendingContext,u.pendingContext=null),(a===null||a.child===null)&&(za(o)?on(o):a===null||a.memoizedState.isDehydrated&&(o.flags&256)===0||(o.flags|=1024,zu())),Pt(o),null;case 26:var y=o.type,b=o.memoizedState;return a===null?(on(o),b!==null?(Pt(o),Ug(o,b)):(Pt(o),Pd(o,y,null,m,u))):b?b!==a.memoizedState?(on(o),Pt(o),Ug(o,b)):(Pt(o),o.flags&=-16777217):(a=a.memoizedProps,a!==m&&on(o),Pt(o),Pd(o,y,a,m,u)),null;case 27:if(ct(o),u=ve.current,y=o.type,a!==null&&o.stateNode!=null)a.memoizedProps!==m&&on(o);else{if(!m){if(o.stateNode===null)throw Error(s(166));return Pt(o),null}a=fe.current,za(o)?pp(o):(a=G0(y,m,u),o.stateNode=a,on(o))}return Pt(o),null;case 5:if(ct(o),y=o.type,a!==null&&o.stateNode!=null)a.memoizedProps!==m&&on(o);else{if(!m){if(o.stateNode===null)throw Error(s(166));return Pt(o),null}if(b=fe.current,za(o))pp(o);else{var I=Yo(ve.current);switch(b){case 1:b=I.createElementNS("http://www.w3.org/2000/svg",y);break;case 2:b=I.createElementNS("http://www.w3.org/1998/Math/MathML",y);break;default:switch(y){case"svg":b=I.createElementNS("http://www.w3.org/2000/svg",y);break;case"math":b=I.createElementNS("http://www.w3.org/1998/Math/MathML",y);break;case"script":b=I.createElement("div"),b.innerHTML="<script><\/script>",b=b.removeChild(b.firstChild);break;case"select":b=typeof m.is=="string"?I.createElement("select",{is:m.is}):I.createElement("select"),m.multiple?b.multiple=!0:m.size&&(b.size=m.size);break;default:b=typeof m.is=="string"?I.createElement(y,{is:m.is}):I.createElement(y)}}b[Lt]=o,b[Dt]=m;e:for(I=o.child;I!==null;){if(I.tag===5||I.tag===6)b.appendChild(I.stateNode);else if(I.tag!==4&&I.tag!==27&&I.child!==null){I.child.return=I,I=I.child;continue}if(I===o)break e;for(;I.sibling===null;){if(I.return===null||I.return===o)break e;I=I.return}I.sibling.return=I.return,I=I.sibling}o.stateNode=b;e:switch(ps(b,y,m),y){case"button":case"input":case"select":case"textarea":m=!!m.autoFocus;break e;case"img":m=!0;break e;default:m=!1}m&&on(o)}}return Pt(o),Pd(o,o.type,a===null?null:a.memoizedProps,o.pendingProps,u),null;case 6:if(a&&o.stateNode!=null)a.memoizedProps!==m&&on(o);else{if(typeof m!="string"&&o.stateNode===null)throw Error(s(166));if(a=ve.current,za(o)){if(a=o.stateNode,u=o.memoizedProps,m=null,y=hs,y!==null)switch(y.tag){case 27:case 5:m=y.memoizedProps}a[Lt]=o,a=!!(a.nodeValue===u||m!==null&&m.suppressHydrationWarning===!0||N0(a.nodeValue,u)),a||wn(o,!0)}else a=Yo(a).createTextNode(m),a[Lt]=o,o.stateNode=a}return Pt(o),null;case 31:if(u=o.memoizedState,a===null||a.memoizedState!==null){if(m=za(o),u!==null){if(a===null){if(!m)throw Error(s(318));if(a=o.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(s(557));a[Lt]=o}else ca(),(o.flags&128)===0&&(o.memoizedState=null),o.flags|=4;Pt(o),a=!1}else u=zu(),a!==null&&a.memoizedState!==null&&(a.memoizedState.hydrationErrors=u),a=!0;if(!a)return o.flags&256?(Qs(o),o):(Qs(o),null);if((o.flags&128)!==0)throw Error(s(558))}return Pt(o),null;case 13:if(m=o.memoizedState,a===null||a.memoizedState!==null&&a.memoizedState.dehydrated!==null){if(y=za(o),m!==null&&m.dehydrated!==null){if(a===null){if(!y)throw Error(s(318));if(y=o.memoizedState,y=y!==null?y.dehydrated:null,!y)throw Error(s(317));y[Lt]=o}else ca(),(o.flags&128)===0&&(o.memoizedState=null),o.flags|=4;Pt(o),y=!1}else y=zu(),a!==null&&a.memoizedState!==null&&(a.memoizedState.hydrationErrors=y),y=!0;if(!y)return o.flags&256?(Qs(o),o):(Qs(o),null)}return Qs(o),(o.flags&128)!==0?(o.lanes=u,o):(u=m!==null,a=a!==null&&a.memoizedState!==null,u&&(m=o.child,y=null,m.alternate!==null&&m.alternate.memoizedState!==null&&m.alternate.memoizedState.cachePool!==null&&(y=m.alternate.memoizedState.cachePool.pool),b=null,m.memoizedState!==null&&m.memoizedState.cachePool!==null&&(b=m.memoizedState.cachePool.pool),b!==y&&(m.flags|=2048)),u!==a&&u&&(o.child.flags|=8192),No(o,o.updateQueue),Pt(o),null);case 4:return we(),a===null&&ih(o.stateNode.containerInfo),Pt(o),null;case 10:return nn(o.type),Pt(o),null;case 19:if($(Yt),m=o.memoizedState,m===null)return Pt(o),null;if(y=(o.flags&128)!==0,b=m.rendering,b===null)if(y)al(m,!1);else{if(Gt!==0||a!==null&&(a.flags&128)!==0)for(a=o.child;a!==null;){if(b=xo(a),b!==null){for(o.flags|=128,al(m,!1),a=b.updateQueue,o.updateQueue=a,No(o,a),o.subtreeFlags=0,a=u,u=o.child;u!==null;)up(u,a),u=u.sibling;return ie(Yt,Yt.current&1|2),lt&&tn(o,m.treeForkCount),o.child}a=a.sibling}m.tail!==null&&st()>Mo&&(o.flags|=128,y=!0,al(m,!1),o.lanes=4194304)}else{if(!y)if(a=xo(b),a!==null){if(o.flags|=128,y=!0,a=a.updateQueue,o.updateQueue=a,No(o,a),al(m,!0),m.tail===null&&m.tailMode==="hidden"&&!b.alternate&&!lt)return Pt(o),null}else 2*st()-m.renderingStartTime>Mo&&u!==536870912&&(o.flags|=128,y=!0,al(m,!1),o.lanes=4194304);m.isBackwards?(b.sibling=o.child,o.child=b):(a=m.last,a!==null?a.sibling=b:o.child=b,m.last=b)}return m.tail!==null?(a=m.tail,m.rendering=a,m.tail=a.sibling,m.renderingStartTime=st(),a.sibling=null,u=Yt.current,ie(Yt,y?u&1|2:u&1),lt&&tn(o,m.treeForkCount),a):(Pt(o),null);case 22:case 23:return Qs(o),nd(),m=o.memoizedState!==null,a!==null?a.memoizedState!==null!==m&&(o.flags|=8192):m&&(o.flags|=8192),m?(u&536870912)!==0&&(o.flags&128)===0&&(Pt(o),o.subtreeFlags&6&&(o.flags|=8192)):Pt(o),u=o.updateQueue,u!==null&&No(o,u.retryQueue),u=null,a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(u=a.memoizedState.cachePool.pool),m=null,o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(m=o.memoizedState.cachePool.pool),m!==u&&(o.flags|=2048),a!==null&&$(ha),null;case 24:return u=null,a!==null&&(u=a.memoizedState.cache),o.memoizedState.cache!==u&&(o.flags|=2048),nn(Zt),Pt(o),null;case 25:return null;case 30:return null}throw Error(s(156,o.tag))}function iT(a,o){switch(Gu(o),o.tag){case 1:return a=o.flags,a&65536?(o.flags=a&-65537|128,o):null;case 3:return nn(Zt),we(),a=o.flags,(a&65536)!==0&&(a&128)===0?(o.flags=a&-65537|128,o):null;case 26:case 27:case 5:return ct(o),null;case 31:if(o.memoizedState!==null){if(Qs(o),o.alternate===null)throw Error(s(340));ca()}return a=o.flags,a&65536?(o.flags=a&-65537|128,o):null;case 13:if(Qs(o),a=o.memoizedState,a!==null&&a.dehydrated!==null){if(o.alternate===null)throw Error(s(340));ca()}return a=o.flags,a&65536?(o.flags=a&-65537|128,o):null;case 19:return $(Yt),null;case 4:return we(),null;case 10:return nn(o.type),null;case 22:case 23:return Qs(o),nd(),a!==null&&$(ha),a=o.flags,a&65536?(o.flags=a&-65537|128,o):null;case 24:return nn(Zt),null;case 25:return null;default:return null}}function Mg(a,o){switch(Gu(o),o.tag){case 3:nn(Zt),we();break;case 26:case 27:case 5:ct(o);break;case 4:we();break;case 31:o.memoizedState!==null&&Qs(o);break;case 13:Qs(o);break;case 19:$(Yt);break;case 10:nn(o.type);break;case 22:case 23:Qs(o),nd(),a!==null&&$(ha);break;case 24:nn(Zt)}}function rl(a,o){try{var u=o.updateQueue,m=u!==null?u.lastEffect:null;if(m!==null){var y=m.next;u=y;do{if((u.tag&a)===a){m=void 0;var b=u.create,I=u.inst;m=b(),I.destroy=m}u=u.next}while(u!==y)}}catch(O){gt(o,o.return,O)}}function Un(a,o,u){try{var m=o.updateQueue,y=m!==null?m.lastEffect:null;if(y!==null){var b=y.next;m=b;do{if((m.tag&a)===a){var I=m.inst,O=I.destroy;if(O!==void 0){I.destroy=void 0,y=o;var B=u,W=O;try{W()}catch(ae){gt(y,B,ae)}}}m=m.next}while(m!==b)}}catch(ae){gt(o,o.return,ae)}}function jg(a){var o=a.updateQueue;if(o!==null){var u=a.stateNode;try{Lp(o,u)}catch(m){gt(a,a.return,m)}}}function Fg(a,o,u){u.props=va(a.type,a.memoizedProps),u.state=a.memoizedState;try{u.componentWillUnmount()}catch(m){gt(a,o,m)}}function ll(a,o){try{var u=a.ref;if(u!==null){switch(a.tag){case 26:case 27:case 5:var m=a.stateNode;break;case 30:m=a.stateNode;break;default:m=a.stateNode}typeof u=="function"?a.refCleanup=u(m):u.current=m}}catch(y){gt(a,o,y)}}function ki(a,o){var u=a.ref,m=a.refCleanup;if(u!==null)if(typeof m=="function")try{m()}catch(y){gt(a,o,y)}finally{a.refCleanup=null,a=a.alternate,a!=null&&(a.refCleanup=null)}else if(typeof u=="function")try{u(null)}catch(y){gt(a,o,y)}else u.current=null}function Bg(a){var o=a.type,u=a.memoizedProps,m=a.stateNode;try{e:switch(o){case"button":case"input":case"select":case"textarea":u.autoFocus&&m.focus();break e;case"img":u.src?m.src=u.src:u.srcSet&&(m.srcset=u.srcSet)}}catch(y){gt(a,a.return,y)}}function Ud(a,o,u){try{var m=a.stateNode;_T(m,a.type,u,o),m[Dt]=o}catch(y){gt(a,a.return,y)}}function $g(a){return a.tag===5||a.tag===3||a.tag===26||a.tag===27&&Gn(a.type)||a.tag===4}function Md(a){e:for(;;){for(;a.sibling===null;){if(a.return===null||$g(a.return))return null;a=a.return}for(a.sibling.return=a.return,a=a.sibling;a.tag!==5&&a.tag!==6&&a.tag!==18;){if(a.tag===27&&Gn(a.type)||a.flags&2||a.child===null||a.tag===4)continue e;a.child.return=a,a=a.child}if(!(a.flags&2))return a.stateNode}}function jd(a,o,u){var m=a.tag;if(m===5||m===6)a=a.stateNode,o?(u.nodeType===9?u.body:u.nodeName==="HTML"?u.ownerDocument.body:u).insertBefore(a,o):(o=u.nodeType===9?u.body:u.nodeName==="HTML"?u.ownerDocument.body:u,o.appendChild(a),u=u._reactRootContainer,u!=null||o.onclick!==null||(o.onclick=Zi));else if(m!==4&&(m===27&&Gn(a.type)&&(u=a.stateNode,o=null),a=a.child,a!==null))for(jd(a,o,u),a=a.sibling;a!==null;)jd(a,o,u),a=a.sibling}function Do(a,o,u){var m=a.tag;if(m===5||m===6)a=a.stateNode,o?u.insertBefore(a,o):u.appendChild(a);else if(m!==4&&(m===27&&Gn(a.type)&&(u=a.stateNode),a=a.child,a!==null))for(Do(a,o,u),a=a.sibling;a!==null;)Do(a,o,u),a=a.sibling}function Vg(a){var o=a.stateNode,u=a.memoizedProps;try{for(var m=a.type,y=o.attributes;y.length;)o.removeAttributeNode(y[0]);ps(o,m,u),o[Lt]=a,o[Dt]=u}catch(b){gt(a,a.return,b)}}var cn=!1,ts=!1,Fd=!1,Gg=typeof WeakSet=="function"?WeakSet:Set,us=null;function nT(a,o){if(a=a.containerInfo,rh=ec,a=tp(a),Nu(a)){if("selectionStart"in a)var u={start:a.selectionStart,end:a.selectionEnd};else e:{u=(u=a.ownerDocument)&&u.defaultView||window;var m=u.getSelection&&u.getSelection();if(m&&m.rangeCount!==0){u=m.anchorNode;var y=m.anchorOffset,b=m.focusNode;m=m.focusOffset;try{u.nodeType,b.nodeType}catch{u=null;break e}var I=0,O=-1,B=-1,W=0,ae=0,he=a,Z=null;t:for(;;){for(var te;he!==u||y!==0&&he.nodeType!==3||(O=I+y),he!==b||m!==0&&he.nodeType!==3||(B=I+m),he.nodeType===3&&(I+=he.nodeValue.length),(te=he.firstChild)!==null;)Z=he,he=te;for(;;){if(he===a)break t;if(Z===u&&++W===y&&(O=I),Z===b&&++ae===m&&(B=I),(te=he.nextSibling)!==null)break;he=Z,Z=he.parentNode}he=te}u=O===-1||B===-1?null:{start:O,end:B}}else u=null}u=u||{start:0,end:0}}else u=null;for(lh={focusedElem:a,selectionRange:u},ec=!1,us=o;us!==null;)if(o=us,a=o.child,(o.subtreeFlags&1028)!==0&&a!==null)a.return=o,us=a;else for(;us!==null;){switch(o=us,b=o.alternate,a=o.flags,o.tag){case 0:if((a&4)!==0&&(a=o.updateQueue,a=a!==null?a.events:null,a!==null))for(u=0;u<a.length;u++)y=a[u],y.ref.impl=y.nextImpl;break;case 11:case 15:break;case 1:if((a&1024)!==0&&b!==null){a=void 0,u=o,y=b.memoizedProps,b=b.memoizedState,m=u.stateNode;try{var Ue=va(u.type,y);a=m.getSnapshotBeforeUpdate(Ue,b),m.__reactInternalSnapshotBeforeUpdate=a}catch(Ge){gt(u,u.return,Ge)}}break;case 3:if((a&1024)!==0){if(a=o.stateNode.containerInfo,u=a.nodeType,u===9)uh(a);else if(u===1)switch(a.nodeName){case"HEAD":case"HTML":case"BODY":uh(a);break;default:a.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((a&1024)!==0)throw Error(s(163))}if(a=o.sibling,a!==null){a.return=o.return,us=a;break}us=o.return}}function Hg(a,o,u){var m=u.flags;switch(u.tag){case 0:case 11:case 15:dn(a,u),m&4&&rl(5,u);break;case 1:if(dn(a,u),m&4)if(a=u.stateNode,o===null)try{a.componentDidMount()}catch(I){gt(u,u.return,I)}else{var y=va(u.type,o.memoizedProps);o=o.memoizedState;try{a.componentDidUpdate(y,o,a.__reactInternalSnapshotBeforeUpdate)}catch(I){gt(u,u.return,I)}}m&64&&jg(u),m&512&&ll(u,u.return);break;case 3:if(dn(a,u),m&64&&(a=u.updateQueue,a!==null)){if(o=null,u.child!==null)switch(u.child.tag){case 27:case 5:o=u.child.stateNode;break;case 1:o=u.child.stateNode}try{Lp(a,o)}catch(I){gt(u,u.return,I)}}break;case 27:o===null&&m&4&&Vg(u);case 26:case 5:dn(a,u),o===null&&m&4&&Bg(u),m&512&&ll(u,u.return);break;case 12:dn(a,u);break;case 31:dn(a,u),m&4&&Yg(a,u);break;case 13:dn(a,u),m&4&&qg(a,u),m&64&&(a=u.memoizedState,a!==null&&(a=a.dehydrated,a!==null&&(u=fT.bind(null,u),DT(a,u))));break;case 22:if(m=u.memoizedState!==null||cn,!m){o=o!==null&&o.memoizedState!==null||ts,y=cn;var b=ts;cn=m,(ts=o)&&!b?hn(a,u,(u.subtreeFlags&8772)!==0):dn(a,u),cn=y,ts=b}break;case 30:break;default:dn(a,u)}}function zg(a){var o=a.alternate;o!==null&&(a.alternate=null,zg(o)),a.child=null,a.deletions=null,a.sibling=null,a.tag===5&&(o=a.stateNode,o!==null&&pu(o)),a.stateNode=null,a.return=null,a.dependencies=null,a.memoizedProps=null,a.memoizedState=null,a.pendingProps=null,a.stateNode=null,a.updateQueue=null}var jt=null,Ds=!1;function un(a,o,u){for(u=u.child;u!==null;)Kg(a,o,u),u=u.sibling}function Kg(a,o,u){if(It&&typeof It.onCommitFiberUnmount=="function")try{It.onCommitFiberUnmount(ss,u)}catch{}switch(u.tag){case 26:ts||ki(u,o),un(a,o,u),u.memoizedState?u.memoizedState.count--:u.stateNode&&(u=u.stateNode,u.parentNode.removeChild(u));break;case 27:ts||ki(u,o);var m=jt,y=Ds;Gn(u.type)&&(jt=u.stateNode,Ds=!1),un(a,o,u),gl(u.stateNode),jt=m,Ds=y;break;case 5:ts||ki(u,o);case 6:if(m=jt,y=Ds,jt=null,un(a,o,u),jt=m,Ds=y,jt!==null)if(Ds)try{(jt.nodeType===9?jt.body:jt.nodeName==="HTML"?jt.ownerDocument.body:jt).removeChild(u.stateNode)}catch(b){gt(u,o,b)}else try{jt.removeChild(u.stateNode)}catch(b){gt(u,o,b)}break;case 18:jt!==null&&(Ds?(a=jt,j0(a.nodeType===9?a.body:a.nodeName==="HTML"?a.ownerDocument.body:a,u.stateNode),hr(a)):j0(jt,u.stateNode));break;case 4:m=jt,y=Ds,jt=u.stateNode.containerInfo,Ds=!0,un(a,o,u),jt=m,Ds=y;break;case 0:case 11:case 14:case 15:Un(2,u,o),ts||Un(4,u,o),un(a,o,u);break;case 1:ts||(ki(u,o),m=u.stateNode,typeof m.componentWillUnmount=="function"&&Fg(u,o,m)),un(a,o,u);break;case 21:un(a,o,u);break;case 22:ts=(m=ts)||u.memoizedState!==null,un(a,o,u),ts=m;break;default:un(a,o,u)}}function Yg(a,o){if(o.memoizedState===null&&(a=o.alternate,a!==null&&(a=a.memoizedState,a!==null))){a=a.dehydrated;try{hr(a)}catch(u){gt(o,o.return,u)}}}function qg(a,o){if(o.memoizedState===null&&(a=o.alternate,a!==null&&(a=a.memoizedState,a!==null&&(a=a.dehydrated,a!==null))))try{hr(a)}catch(u){gt(o,o.return,u)}}function aT(a){switch(a.tag){case 31:case 13:case 19:var o=a.stateNode;return o===null&&(o=a.stateNode=new Gg),o;case 22:return a=a.stateNode,o=a._retryCache,o===null&&(o=a._retryCache=new Gg),o;default:throw Error(s(435,a.tag))}}function ko(a,o){var u=aT(a);o.forEach(function(m){if(!u.has(m)){u.add(m);var y=mT.bind(null,a,m);m.then(y,y)}})}function ks(a,o){var u=o.deletions;if(u!==null)for(var m=0;m<u.length;m++){var y=u[m],b=a,I=o,O=I;e:for(;O!==null;){switch(O.tag){case 27:if(Gn(O.type)){jt=O.stateNode,Ds=!1;break e}break;case 5:jt=O.stateNode,Ds=!1;break e;case 3:case 4:jt=O.stateNode.containerInfo,Ds=!0;break e}O=O.return}if(jt===null)throw Error(s(160));Kg(b,I,y),jt=null,Ds=!1,b=y.alternate,b!==null&&(b.return=null),y.return=null}if(o.subtreeFlags&13886)for(o=o.child;o!==null;)Qg(o,a),o=o.sibling}var Ii=null;function Qg(a,o){var u=a.alternate,m=a.flags;switch(a.tag){case 0:case 11:case 14:case 15:ks(o,a),Ps(a),m&4&&(Un(3,a,a.return),rl(3,a),Un(5,a,a.return));break;case 1:ks(o,a),Ps(a),m&512&&(ts||u===null||ki(u,u.return)),m&64&&cn&&(a=a.updateQueue,a!==null&&(m=a.callbacks,m!==null&&(u=a.shared.hiddenCallbacks,a.shared.hiddenCallbacks=u===null?m:u.concat(m))));break;case 26:var y=Ii;if(ks(o,a),Ps(a),m&512&&(ts||u===null||ki(u,u.return)),m&4){var b=u!==null?u.memoizedState:null;if(m=a.memoizedState,u===null)if(m===null)if(a.stateNode===null){e:{m=a.type,u=a.memoizedProps,y=y.ownerDocument||y;t:switch(m){case"title":b=y.getElementsByTagName("title")[0],(!b||b[kr]||b[Lt]||b.namespaceURI==="http://www.w3.org/2000/svg"||b.hasAttribute("itemprop"))&&(b=y.createElement(m),y.head.insertBefore(b,y.querySelector("head > title"))),ps(b,m,u),b[Lt]=a,cs(b),m=b;break e;case"link":var I=Q0("link","href",y).get(m+(u.href||""));if(I){for(var O=0;O<I.length;O++)if(b=I[O],b.getAttribute("href")===(u.href==null||u.href===""?null:u.href)&&b.getAttribute("rel")===(u.rel==null?null:u.rel)&&b.getAttribute("title")===(u.title==null?null:u.title)&&b.getAttribute("crossorigin")===(u.crossOrigin==null?null:u.crossOrigin)){I.splice(O,1);break t}}b=y.createElement(m),ps(b,m,u),y.head.appendChild(b);break;case"meta":if(I=Q0("meta","content",y).get(m+(u.content||""))){for(O=0;O<I.length;O++)if(b=I[O],b.getAttribute("content")===(u.content==null?null:""+u.content)&&b.getAttribute("name")===(u.name==null?null:u.name)&&b.getAttribute("property")===(u.property==null?null:u.property)&&b.getAttribute("http-equiv")===(u.httpEquiv==null?null:u.httpEquiv)&&b.getAttribute("charset")===(u.charSet==null?null:u.charSet)){I.splice(O,1);break t}}b=y.createElement(m),ps(b,m,u),y.head.appendChild(b);break;default:throw Error(s(468,m))}b[Lt]=a,cs(b),m=b}a.stateNode=m}else X0(y,a.type,a.stateNode);else a.stateNode=q0(y,m,a.memoizedProps);else b!==m?(b===null?u.stateNode!==null&&(u=u.stateNode,u.parentNode.removeChild(u)):b.count--,m===null?X0(y,a.type,a.stateNode):q0(y,m,a.memoizedProps)):m===null&&a.stateNode!==null&&Ud(a,a.memoizedProps,u.memoizedProps)}break;case 27:ks(o,a),Ps(a),m&512&&(ts||u===null||ki(u,u.return)),u!==null&&m&4&&Ud(a,a.memoizedProps,u.memoizedProps);break;case 5:if(ks(o,a),Ps(a),m&512&&(ts||u===null||ki(u,u.return)),a.flags&32){y=a.stateNode;try{Pa(y,"")}catch(Ue){gt(a,a.return,Ue)}}m&4&&a.stateNode!=null&&(y=a.memoizedProps,Ud(a,y,u!==null?u.memoizedProps:y)),m&1024&&(Fd=!0);break;case 6:if(ks(o,a),Ps(a),m&4){if(a.stateNode===null)throw Error(s(162));m=a.memoizedProps,u=a.stateNode;try{u.nodeValue=m}catch(Ue){gt(a,a.return,Ue)}}break;case 3:if(Xo=null,y=Ii,Ii=qo(o.containerInfo),ks(o,a),Ii=y,Ps(a),m&4&&u!==null&&u.memoizedState.isDehydrated)try{hr(o.containerInfo)}catch(Ue){gt(a,a.return,Ue)}Fd&&(Fd=!1,Xg(a));break;case 4:m=Ii,Ii=qo(a.stateNode.containerInfo),ks(o,a),Ps(a),Ii=m;break;case 12:ks(o,a),Ps(a);break;case 31:ks(o,a),Ps(a),m&4&&(m=a.updateQueue,m!==null&&(a.updateQueue=null,ko(a,m)));break;case 13:ks(o,a),Ps(a),a.child.flags&8192&&a.memoizedState!==null!=(u!==null&&u.memoizedState!==null)&&(Uo=st()),m&4&&(m=a.updateQueue,m!==null&&(a.updateQueue=null,ko(a,m)));break;case 22:y=a.memoizedState!==null;var B=u!==null&&u.memoizedState!==null,W=cn,ae=ts;if(cn=W||y,ts=ae||B,ks(o,a),ts=ae,cn=W,Ps(a),m&8192)e:for(o=a.stateNode,o._visibility=y?o._visibility&-2:o._visibility|1,y&&(u===null||B||cn||ts||ya(a)),u=null,o=a;;){if(o.tag===5||o.tag===26){if(u===null){B=u=o;try{if(b=B.stateNode,y)I=b.style,typeof I.setProperty=="function"?I.setProperty("display","none","important"):I.display="none";else{O=B.stateNode;var he=B.memoizedProps.style,Z=he!=null&&he.hasOwnProperty("display")?he.display:null;O.style.display=Z==null||typeof Z=="boolean"?"":(""+Z).trim()}}catch(Ue){gt(B,B.return,Ue)}}}else if(o.tag===6){if(u===null){B=o;try{B.stateNode.nodeValue=y?"":B.memoizedProps}catch(Ue){gt(B,B.return,Ue)}}}else if(o.tag===18){if(u===null){B=o;try{var te=B.stateNode;y?F0(te,!0):F0(B.stateNode,!1)}catch(Ue){gt(B,B.return,Ue)}}}else if((o.tag!==22&&o.tag!==23||o.memoizedState===null||o===a)&&o.child!==null){o.child.return=o,o=o.child;continue}if(o===a)break e;for(;o.sibling===null;){if(o.return===null||o.return===a)break e;u===o&&(u=null),o=o.return}u===o&&(u=null),o.sibling.return=o.return,o=o.sibling}m&4&&(m=a.updateQueue,m!==null&&(u=m.retryQueue,u!==null&&(m.retryQueue=null,ko(a,u))));break;case 19:ks(o,a),Ps(a),m&4&&(m=a.updateQueue,m!==null&&(a.updateQueue=null,ko(a,m)));break;case 30:break;case 21:break;default:ks(o,a),Ps(a)}}function Ps(a){var o=a.flags;if(o&2){try{for(var u,m=a.return;m!==null;){if($g(m)){u=m;break}m=m.return}if(u==null)throw Error(s(160));switch(u.tag){case 27:var y=u.stateNode,b=Md(a);Do(a,b,y);break;case 5:var I=u.stateNode;u.flags&32&&(Pa(I,""),u.flags&=-33);var O=Md(a);Do(a,O,I);break;case 3:case 4:var B=u.stateNode.containerInfo,W=Md(a);jd(a,W,B);break;default:throw Error(s(161))}}catch(ae){gt(a,a.return,ae)}a.flags&=-3}o&4096&&(a.flags&=-4097)}function Xg(a){if(a.subtreeFlags&1024)for(a=a.child;a!==null;){var o=a;Xg(o),o.tag===5&&o.flags&1024&&o.stateNode.reset(),a=a.sibling}}function dn(a,o){if(o.subtreeFlags&8772)for(o=o.child;o!==null;)Hg(a,o.alternate,o),o=o.sibling}function ya(a){for(a=a.child;a!==null;){var o=a;switch(o.tag){case 0:case 11:case 14:case 15:Un(4,o,o.return),ya(o);break;case 1:ki(o,o.return);var u=o.stateNode;typeof u.componentWillUnmount=="function"&&Fg(o,o.return,u),ya(o);break;case 27:gl(o.stateNode);case 26:case 5:ki(o,o.return),ya(o);break;case 22:o.memoizedState===null&&ya(o);break;case 30:ya(o);break;default:ya(o)}a=a.sibling}}function hn(a,o,u){for(u=u&&(o.subtreeFlags&8772)!==0,o=o.child;o!==null;){var m=o.alternate,y=a,b=o,I=b.flags;switch(b.tag){case 0:case 11:case 15:hn(y,b,u),rl(4,b);break;case 1:if(hn(y,b,u),m=b,y=m.stateNode,typeof y.componentDidMount=="function")try{y.componentDidMount()}catch(W){gt(m,m.return,W)}if(m=b,y=m.updateQueue,y!==null){var O=m.stateNode;try{var B=y.shared.hiddenCallbacks;if(B!==null)for(y.shared.hiddenCallbacks=null,y=0;y<B.length;y++)Rp(B[y],O)}catch(W){gt(m,m.return,W)}}u&&I&64&&jg(b),ll(b,b.return);break;case 27:Vg(b);case 26:case 5:hn(y,b,u),u&&m===null&&I&4&&Bg(b),ll(b,b.return);break;case 12:hn(y,b,u);break;case 31:hn(y,b,u),u&&I&4&&Yg(y,b);break;case 13:hn(y,b,u),u&&I&4&&qg(y,b);break;case 22:b.memoizedState===null&&hn(y,b,u),ll(b,b.return);break;case 30:break;default:hn(y,b,u)}o=o.sibling}}function Bd(a,o){var u=null;a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(u=a.memoizedState.cachePool.pool),a=null,o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(a=o.memoizedState.cachePool.pool),a!==u&&(a!=null&&a.refCount++,u!=null&&Yr(u))}function $d(a,o){a=null,o.alternate!==null&&(a=o.alternate.memoizedState.cache),o=o.memoizedState.cache,o!==a&&(o.refCount++,a!=null&&Yr(a))}function Ri(a,o,u,m){if(o.subtreeFlags&10256)for(o=o.child;o!==null;)Wg(a,o,u,m),o=o.sibling}function Wg(a,o,u,m){var y=o.flags;switch(o.tag){case 0:case 11:case 15:Ri(a,o,u,m),y&2048&&rl(9,o);break;case 1:Ri(a,o,u,m);break;case 3:Ri(a,o,u,m),y&2048&&(a=null,o.alternate!==null&&(a=o.alternate.memoizedState.cache),o=o.memoizedState.cache,o!==a&&(o.refCount++,a!=null&&Yr(a)));break;case 12:if(y&2048){Ri(a,o,u,m),a=o.stateNode;try{var b=o.memoizedProps,I=b.id,O=b.onPostCommit;typeof O=="function"&&O(I,o.alternate===null?"mount":"update",a.passiveEffectDuration,-0)}catch(B){gt(o,o.return,B)}}else Ri(a,o,u,m);break;case 31:Ri(a,o,u,m);break;case 13:Ri(a,o,u,m);break;case 23:break;case 22:b=o.stateNode,I=o.alternate,o.memoizedState!==null?b._visibility&2?Ri(a,o,u,m):ol(a,o):b._visibility&2?Ri(a,o,u,m):(b._visibility|=2,tr(a,o,u,m,(o.subtreeFlags&10256)!==0||!1)),y&2048&&Bd(I,o);break;case 24:Ri(a,o,u,m),y&2048&&$d(o.alternate,o);break;default:Ri(a,o,u,m)}}function tr(a,o,u,m,y){for(y=y&&((o.subtreeFlags&10256)!==0||!1),o=o.child;o!==null;){var b=a,I=o,O=u,B=m,W=I.flags;switch(I.tag){case 0:case 11:case 15:tr(b,I,O,B,y),rl(8,I);break;case 23:break;case 22:var ae=I.stateNode;I.memoizedState!==null?ae._visibility&2?tr(b,I,O,B,y):ol(b,I):(ae._visibility|=2,tr(b,I,O,B,y)),y&&W&2048&&Bd(I.alternate,I);break;case 24:tr(b,I,O,B,y),y&&W&2048&&$d(I.alternate,I);break;default:tr(b,I,O,B,y)}o=o.sibling}}function ol(a,o){if(o.subtreeFlags&10256)for(o=o.child;o!==null;){var u=a,m=o,y=m.flags;switch(m.tag){case 22:ol(u,m),y&2048&&Bd(m.alternate,m);break;case 24:ol(u,m),y&2048&&$d(m.alternate,m);break;default:ol(u,m)}o=o.sibling}}var cl=8192;function sr(a,o,u){if(a.subtreeFlags&cl)for(a=a.child;a!==null;)Zg(a,o,u),a=a.sibling}function Zg(a,o,u){switch(a.tag){case 26:sr(a,o,u),a.flags&cl&&a.memoizedState!==null&&zT(u,Ii,a.memoizedState,a.memoizedProps);break;case 5:sr(a,o,u);break;case 3:case 4:var m=Ii;Ii=qo(a.stateNode.containerInfo),sr(a,o,u),Ii=m;break;case 22:a.memoizedState===null&&(m=a.alternate,m!==null&&m.memoizedState!==null?(m=cl,cl=16777216,sr(a,o,u),cl=m):sr(a,o,u));break;default:sr(a,o,u)}}function Jg(a){var o=a.alternate;if(o!==null&&(a=o.child,a!==null)){o.child=null;do o=a.sibling,a.sibling=null,a=o;while(a!==null)}}function ul(a){var o=a.deletions;if((a.flags&16)!==0){if(o!==null)for(var u=0;u<o.length;u++){var m=o[u];us=m,t0(m,a)}Jg(a)}if(a.subtreeFlags&10256)for(a=a.child;a!==null;)e0(a),a=a.sibling}function e0(a){switch(a.tag){case 0:case 11:case 15:ul(a),a.flags&2048&&Un(9,a,a.return);break;case 3:ul(a);break;case 12:ul(a);break;case 22:var o=a.stateNode;a.memoizedState!==null&&o._visibility&2&&(a.return===null||a.return.tag!==13)?(o._visibility&=-3,Po(a)):ul(a);break;default:ul(a)}}function Po(a){var o=a.deletions;if((a.flags&16)!==0){if(o!==null)for(var u=0;u<o.length;u++){var m=o[u];us=m,t0(m,a)}Jg(a)}for(a=a.child;a!==null;){switch(o=a,o.tag){case 0:case 11:case 15:Un(8,o,o.return),Po(o);break;case 22:u=o.stateNode,u._visibility&2&&(u._visibility&=-3,Po(o));break;default:Po(o)}a=a.sibling}}function t0(a,o){for(;us!==null;){var u=us;switch(u.tag){case 0:case 11:case 15:Un(8,u,o);break;case 23:case 22:if(u.memoizedState!==null&&u.memoizedState.cachePool!==null){var m=u.memoizedState.cachePool.pool;m!=null&&m.refCount++}break;case 24:Yr(u.memoizedState.cache)}if(m=u.child,m!==null)m.return=u,us=m;else e:for(u=a;us!==null;){m=us;var y=m.sibling,b=m.return;if(zg(m),m===u){us=null;break e}if(y!==null){y.return=b,us=y;break e}us=b}}}var rT={getCacheForType:function(a){var o=fs(Zt),u=o.data.get(a);return u===void 0&&(u=a(),o.data.set(a,u)),u},cacheSignal:function(){return fs(Zt).controller.signal}},lT=typeof WeakMap=="function"?WeakMap:Map,ft=0,wt=null,it=null,at=0,pt=0,Xs=null,Mn=!1,ir=!1,Vd=!1,fn=0,Gt=0,jn=0,xa=0,Gd=0,Ws=0,nr=0,dl=null,Us=null,Hd=!1,Uo=0,s0=0,Mo=1/0,jo=null,Fn=null,as=0,Bn=null,ar=null,mn=0,zd=0,Kd=null,i0=null,hl=0,Yd=null;function Zs(){return(ft&2)!==0&&at!==0?at&-at:k.T!==null?Jd():Rs()}function n0(){if(Ws===0)if((at&536870912)===0||lt){var a=ns;ns<<=1,(ns&3932160)===0&&(ns=262144),Ws=a}else Ws=536870912;return a=qs.current,a!==null&&(a.flags|=32),Ws}function Ms(a,o,u){(a===wt&&(pt===2||pt===9)||a.cancelPendingCommit!==null)&&(rr(a,0),$n(a,at,Ws,!1)),Ss(a,u),((ft&2)===0||a!==wt)&&(a===wt&&((ft&2)===0&&(xa|=u),Gt===4&&$n(a,at,Ws,!1)),Pi(a))}function a0(a,o,u){if((ft&6)!==0)throw Error(s(327));var m=!u&&(o&127)===0&&(o&a.expiredLanes)===0||li(a,o),y=m?uT(a,o):Qd(a,o,!0),b=m;do{if(y===0){ir&&!m&&$n(a,o,0,!1);break}else{if(u=a.current.alternate,b&&!oT(u)){y=Qd(a,o,!1),b=!1;continue}if(y===2){if(b=o,a.errorRecoveryDisabledLanes&b)var I=0;else I=a.pendingLanes&-536870913,I=I!==0?I:I&536870912?536870912:0;if(I!==0){o=I;e:{var O=a;y=dl;var B=O.current.memoizedState.isDehydrated;if(B&&(rr(O,I).flags|=256),I=Qd(O,I,!1),I!==2){if(Vd&&!B){O.errorRecoveryDisabledLanes|=b,xa|=b,y=4;break e}b=Us,Us=y,b!==null&&(Us===null?Us=b:Us.push.apply(Us,b))}y=I}if(b=!1,y!==2)continue}}if(y===1){rr(a,0),$n(a,o,0,!0);break}e:{switch(m=a,b=y,b){case 0:case 1:throw Error(s(345));case 4:if((o&4194048)!==o)break;case 6:$n(m,o,Ws,!Mn);break e;case 2:Us=null;break;case 3:case 5:break;default:throw Error(s(329))}if((o&62914560)===o&&(y=Uo+300-st(),10<y)){if($n(m,o,Ws,!Mn),zs(m,0,!0)!==0)break e;mn=o,m.timeoutHandle=U0(r0.bind(null,m,u,Us,jo,Hd,o,Ws,xa,nr,Mn,b,"Throttled",-0,0),y);break e}r0(m,u,Us,jo,Hd,o,Ws,xa,nr,Mn,b,null,-0,0)}}break}while(!0);Pi(a)}function r0(a,o,u,m,y,b,I,O,B,W,ae,he,Z,te){if(a.timeoutHandle=-1,he=o.subtreeFlags,he&8192||(he&16785408)===16785408){he={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Zi},Zg(o,b,he);var Ue=(b&62914560)===b?Uo-st():(b&4194048)===b?s0-st():0;if(Ue=KT(he,Ue),Ue!==null){mn=b,a.cancelPendingCommit=Ue(m0.bind(null,a,o,b,u,m,y,I,O,B,ae,he,null,Z,te)),$n(a,b,I,!W);return}}m0(a,o,b,u,m,y,I,O,B)}function oT(a){for(var o=a;;){var u=o.tag;if((u===0||u===11||u===15)&&o.flags&16384&&(u=o.updateQueue,u!==null&&(u=u.stores,u!==null)))for(var m=0;m<u.length;m++){var y=u[m],b=y.getSnapshot;y=y.value;try{if(!Ks(b(),y))return!1}catch{return!1}}if(u=o.child,o.subtreeFlags&16384&&u!==null)u.return=o,o=u;else{if(o===a)break;for(;o.sibling===null;){if(o.return===null||o.return===a)return!0;o=o.return}o.sibling.return=o.return,o=o.sibling}}return!0}function $n(a,o,u,m){o&=~Gd,o&=~xa,a.suspendedLanes|=o,a.pingedLanes&=~o,m&&(a.warmLanes|=o),m=a.expirationTimes;for(var y=o;0<y;){var b=31-Nt(y),I=1<<b;m[b]=-1,y&=~I}u!==0&&Xi(a,u,o)}function Fo(){return(ft&6)===0?(fl(0),!1):!0}function qd(){if(it!==null){if(pt===0)var a=it.return;else a=it,sn=ua=null,ud(a),Xa=null,Qr=0,a=it;for(;a!==null;)Mg(a.alternate,a),a=a.return;it=null}}function rr(a,o){var u=a.timeoutHandle;u!==-1&&(a.timeoutHandle=-1,LT(u)),u=a.cancelPendingCommit,u!==null&&(a.cancelPendingCommit=null,u()),mn=0,qd(),wt=a,it=u=en(a.current,null),at=o,pt=0,Xs=null,Mn=!1,ir=li(a,o),Vd=!1,nr=Ws=Gd=xa=jn=Gt=0,Us=dl=null,Hd=!1,(o&8)!==0&&(o|=o&32);var m=a.entangledLanes;if(m!==0)for(a=a.entanglements,m&=o;0<m;){var y=31-Nt(m),b=1<<y;o|=a[y],m&=~b}return fn=o,ao(),u}function l0(a,o){Xe=null,k.H=il,o===Qa||o===mo?(o=Tp(),pt=3):o===Zu?(o=Tp(),pt=4):pt=o===Id?8:o!==null&&typeof o=="object"&&typeof o.then=="function"?6:1,Xs=o,it===null&&(Gt=1,Lo(a,di(o,a.current)))}function o0(){var a=qs.current;return a===null?!0:(at&4194048)===at?pi===null:(at&62914560)===at||(at&536870912)!==0?a===pi:!1}function c0(){var a=k.H;return k.H=il,a===null?il:a}function u0(){var a=k.A;return k.A=rT,a}function Bo(){Gt=4,Mn||(at&4194048)!==at&&qs.current!==null||(ir=!0),(jn&134217727)===0&&(xa&134217727)===0||wt===null||$n(wt,at,Ws,!1)}function Qd(a,o,u){var m=ft;ft|=2;var y=c0(),b=u0();(wt!==a||at!==o)&&(jo=null,rr(a,o)),o=!1;var I=Gt;e:do try{if(pt!==0&&it!==null){var O=it,B=Xs;switch(pt){case 8:qd(),I=6;break e;case 3:case 2:case 9:case 6:qs.current===null&&(o=!0);var W=pt;if(pt=0,Xs=null,lr(a,O,B,W),u&&ir){I=0;break e}break;default:W=pt,pt=0,Xs=null,lr(a,O,B,W)}}cT(),I=Gt;break}catch(ae){l0(a,ae)}while(!0);return o&&a.shellSuspendCounter++,sn=ua=null,ft=m,k.H=y,k.A=b,it===null&&(wt=null,at=0,ao()),I}function cT(){for(;it!==null;)d0(it)}function uT(a,o){var u=ft;ft|=2;var m=c0(),y=u0();wt!==a||at!==o?(jo=null,Mo=st()+500,rr(a,o)):ir=li(a,o);e:do try{if(pt!==0&&it!==null){o=it;var b=Xs;t:switch(pt){case 1:pt=0,Xs=null,lr(a,o,b,1);break;case 2:case 9:if(bp(b)){pt=0,Xs=null,h0(o);break}o=function(){pt!==2&&pt!==9||wt!==a||(pt=7),Pi(a)},b.then(o,o);break e;case 3:pt=7;break e;case 4:pt=5;break e;case 7:bp(b)?(pt=0,Xs=null,h0(o)):(pt=0,Xs=null,lr(a,o,b,7));break;case 5:var I=null;switch(it.tag){case 26:I=it.memoizedState;case 5:case 27:var O=it;if(I?W0(I):O.stateNode.complete){pt=0,Xs=null;var B=O.sibling;if(B!==null)it=B;else{var W=O.return;W!==null?(it=W,$o(W)):it=null}break t}}pt=0,Xs=null,lr(a,o,b,5);break;case 6:pt=0,Xs=null,lr(a,o,b,6);break;case 8:qd(),Gt=6;break e;default:throw Error(s(462))}}dT();break}catch(ae){l0(a,ae)}while(!0);return sn=ua=null,k.H=m,k.A=y,ft=u,it!==null?0:(wt=null,at=0,ao(),Gt)}function dT(){for(;it!==null&&!Ye();)d0(it)}function d0(a){var o=Pg(a.alternate,a,fn);a.memoizedProps=a.pendingProps,o===null?$o(a):it=o}function h0(a){var o=a,u=o.alternate;switch(o.tag){case 15:case 0:o=wg(u,o,o.pendingProps,o.type,void 0,at);break;case 11:o=wg(u,o,o.pendingProps,o.type.render,o.ref,at);break;case 5:ud(o);default:Mg(u,o),o=it=up(o,fn),o=Pg(u,o,fn)}a.memoizedProps=a.pendingProps,o===null?$o(a):it=o}function lr(a,o,u,m){sn=ua=null,ud(o),Xa=null,Qr=0;var y=o.return;try{if(JE(a,y,o,u,at)){Gt=1,Lo(a,di(u,a.current)),it=null;return}}catch(b){if(y!==null)throw it=y,b;Gt=1,Lo(a,di(u,a.current)),it=null;return}o.flags&32768?(lt||m===1?a=!0:ir||(at&536870912)!==0?a=!1:(Mn=a=!0,(m===2||m===9||m===3||m===6)&&(m=qs.current,m!==null&&m.tag===13&&(m.flags|=16384))),f0(o,a)):$o(o)}function $o(a){var o=a;do{if((o.flags&32768)!==0){f0(o,Mn);return}a=o.return;var u=sT(o.alternate,o,fn);if(u!==null){it=u;return}if(o=o.sibling,o!==null){it=o;return}it=o=a}while(o!==null);Gt===0&&(Gt=5)}function f0(a,o){do{var u=iT(a.alternate,a);if(u!==null){u.flags&=32767,it=u;return}if(u=a.return,u!==null&&(u.flags|=32768,u.subtreeFlags=0,u.deletions=null),!o&&(a=a.sibling,a!==null)){it=a;return}it=a=u}while(a!==null);Gt=6,it=null}function m0(a,o,u,m,y,b,I,O,B){a.cancelPendingCommit=null;do Vo();while(as!==0);if((ft&6)!==0)throw Error(s(327));if(o!==null){if(o===a.current)throw Error(s(177));if(b=o.lanes|o.childLanes,b|=Mu,Qi(a,u,b,I,O,B),a===wt&&(it=wt=null,at=0),ar=o,Bn=a,mn=u,zd=b,Kd=y,i0=m,(o.subtreeFlags&10256)!==0||(o.flags&10256)!==0?(a.callbackNode=null,a.callbackPriority=0,pT(ye,function(){return x0(),null})):(a.callbackNode=null,a.callbackPriority=0),m=(o.flags&13878)!==0,(o.subtreeFlags&13878)!==0||m){m=k.T,k.T=null,y=G.p,G.p=2,I=ft,ft|=4;try{nT(a,o,u)}finally{ft=I,G.p=y,k.T=m}}as=1,p0(),g0(),v0()}}function p0(){if(as===1){as=0;var a=Bn,o=ar,u=(o.flags&13878)!==0;if((o.subtreeFlags&13878)!==0||u){u=k.T,k.T=null;var m=G.p;G.p=2;var y=ft;ft|=4;try{Qg(o,a);var b=lh,I=tp(a.containerInfo),O=b.focusedElem,B=b.selectionRange;if(I!==O&&O&&O.ownerDocument&&ep(O.ownerDocument.documentElement,O)){if(B!==null&&Nu(O)){var W=B.start,ae=B.end;if(ae===void 0&&(ae=W),"selectionStart"in O)O.selectionStart=W,O.selectionEnd=Math.min(ae,O.value.length);else{var he=O.ownerDocument||document,Z=he&&he.defaultView||window;if(Z.getSelection){var te=Z.getSelection(),Ue=O.textContent.length,Ge=Math.min(B.start,Ue),Tt=B.end===void 0?Ge:Math.min(B.end,Ue);!te.extend&&Ge>Tt&&(I=Tt,Tt=Ge,Ge=I);var z=Jm(O,Ge),V=Jm(O,Tt);if(z&&V&&(te.rangeCount!==1||te.anchorNode!==z.node||te.anchorOffset!==z.offset||te.focusNode!==V.node||te.focusOffset!==V.offset)){var X=he.createRange();X.setStart(z.node,z.offset),te.removeAllRanges(),Ge>Tt?(te.addRange(X),te.extend(V.node,V.offset)):(X.setEnd(V.node,V.offset),te.addRange(X))}}}}for(he=[],te=O;te=te.parentNode;)te.nodeType===1&&he.push({element:te,left:te.scrollLeft,top:te.scrollTop});for(typeof O.focus=="function"&&O.focus(),O=0;O<he.length;O++){var oe=he[O];oe.element.scrollLeft=oe.left,oe.element.scrollTop=oe.top}}ec=!!rh,lh=rh=null}finally{ft=y,G.p=m,k.T=u}}a.current=o,as=2}}function g0(){if(as===2){as=0;var a=Bn,o=ar,u=(o.flags&8772)!==0;if((o.subtreeFlags&8772)!==0||u){u=k.T,k.T=null;var m=G.p;G.p=2;var y=ft;ft|=4;try{Hg(a,o.alternate,o)}finally{ft=y,G.p=m,k.T=u}}as=3}}function v0(){if(as===4||as===3){as=0,mt();var a=Bn,o=ar,u=mn,m=i0;(o.subtreeFlags&10256)!==0||(o.flags&10256)!==0?as=5:(as=0,ar=Bn=null,y0(a,a.pendingLanes));var y=a.pendingLanes;if(y===0&&(Fn=null),Je(u),o=o.stateNode,It&&typeof It.onCommitFiberRoot=="function")try{It.onCommitFiberRoot(ss,o,void 0,(o.current.flags&128)===128)}catch{}if(m!==null){o=k.T,y=G.p,G.p=2,k.T=null;try{for(var b=a.onRecoverableError,I=0;I<m.length;I++){var O=m[I];b(O.value,{componentStack:O.stack})}}finally{k.T=o,G.p=y}}(mn&3)!==0&&Vo(),Pi(a),y=a.pendingLanes,(u&261930)!==0&&(y&42)!==0?a===Yd?hl++:(hl=0,Yd=a):hl=0,fl(0)}}function y0(a,o){(a.pooledCacheLanes&=o)===0&&(o=a.pooledCache,o!=null&&(a.pooledCache=null,Yr(o)))}function Vo(){return p0(),g0(),v0(),x0()}function x0(){if(as!==5)return!1;var a=Bn,o=zd;zd=0;var u=Je(mn),m=k.T,y=G.p;try{G.p=32>u?32:u,k.T=null,u=Kd,Kd=null;var b=Bn,I=mn;if(as=0,ar=Bn=null,mn=0,(ft&6)!==0)throw Error(s(331));var O=ft;if(ft|=4,e0(b.current),Wg(b,b.current,I,u),ft=O,fl(0,!1),It&&typeof It.onPostCommitFiberRoot=="function")try{It.onPostCommitFiberRoot(ss,b)}catch{}return!0}finally{G.p=y,k.T=m,y0(a,o)}}function S0(a,o,u){o=di(u,o),o=_d(a.stateNode,o,2),a=Dn(a,o,2),a!==null&&(Ss(a,2),Pi(a))}function gt(a,o,u){if(a.tag===3)S0(a,a,u);else for(;o!==null;){if(o.tag===3){S0(o,a,u);break}else if(o.tag===1){var m=o.stateNode;if(typeof o.type.getDerivedStateFromError=="function"||typeof m.componentDidCatch=="function"&&(Fn===null||!Fn.has(m))){a=di(u,a),u=bg(2),m=Dn(o,u,2),m!==null&&(Eg(u,m,o,a),Ss(m,2),Pi(m));break}}o=o.return}}function Xd(a,o,u){var m=a.pingCache;if(m===null){m=a.pingCache=new lT;var y=new Set;m.set(o,y)}else y=m.get(o),y===void 0&&(y=new Set,m.set(o,y));y.has(u)||(Vd=!0,y.add(u),a=hT.bind(null,a,o,u),o.then(a,a))}function hT(a,o,u){var m=a.pingCache;m!==null&&m.delete(o),a.pingedLanes|=a.suspendedLanes&u,a.warmLanes&=~u,wt===a&&(at&u)===u&&(Gt===4||Gt===3&&(at&62914560)===at&&300>st()-Uo?(ft&2)===0&&rr(a,0):Gd|=u,nr===at&&(nr=0)),Pi(a)}function b0(a,o){o===0&&(o=qi()),a=la(a,o),a!==null&&(Ss(a,o),Pi(a))}function fT(a){var o=a.memoizedState,u=0;o!==null&&(u=o.retryLane),b0(a,u)}function mT(a,o){var u=0;switch(a.tag){case 31:case 13:var m=a.stateNode,y=a.memoizedState;y!==null&&(u=y.retryLane);break;case 19:m=a.stateNode;break;case 22:m=a.stateNode._retryCache;break;default:throw Error(s(314))}m!==null&&m.delete(o),b0(a,u)}function pT(a,o){return ut(a,o)}var Go=null,or=null,Wd=!1,Ho=!1,Zd=!1,Vn=0;function Pi(a){a!==or&&a.next===null&&(or===null?Go=or=a:or=or.next=a),Ho=!0,Wd||(Wd=!0,vT())}function fl(a,o){if(!Zd&&Ho){Zd=!0;do for(var u=!1,m=Go;m!==null;){if(a!==0){var y=m.pendingLanes;if(y===0)var b=0;else{var I=m.suspendedLanes,O=m.pingedLanes;b=(1<<31-Nt(42|a)+1)-1,b&=y&~(I&~O),b=b&201326741?b&201326741|1:b?b|2:0}b!==0&&(u=!0,_0(m,b))}else b=at,b=zs(m,m===wt?b:0,m.cancelPendingCommit!==null||m.timeoutHandle!==-1),(b&3)===0||li(m,b)||(u=!0,_0(m,b));m=m.next}while(u);Zd=!1}}function gT(){E0()}function E0(){Ho=Wd=!1;var a=0;Vn!==0&&RT()&&(a=Vn);for(var o=st(),u=null,m=Go;m!==null;){var y=m.next,b=T0(m,o);b===0?(m.next=null,u===null?Go=y:u.next=y,y===null&&(or=u)):(u=m,(a!==0||(b&3)!==0)&&(Ho=!0)),m=y}as!==0&&as!==5||fl(a),Vn!==0&&(Vn=0)}function T0(a,o){for(var u=a.suspendedLanes,m=a.pingedLanes,y=a.expirationTimes,b=a.pendingLanes&-62914561;0<b;){var I=31-Nt(b),O=1<<I,B=y[I];B===-1?((O&u)===0||(O&m)!==0)&&(y[I]=An(O,o)):B<=o&&(a.expiredLanes|=O),b&=~O}if(o=wt,u=at,u=zs(a,a===o?u:0,a.cancelPendingCommit!==null||a.timeoutHandle!==-1),m=a.callbackNode,u===0||a===o&&(pt===2||pt===9)||a.cancelPendingCommit!==null)return m!==null&&m!==null&&Oe(m),a.callbackNode=null,a.callbackPriority=0;if((u&3)===0||li(a,u)){if(o=u&-u,o===a.callbackPriority)return o;switch(m!==null&&Oe(m),Je(u)){case 2:case 8:u=_s;break;case 32:u=ye;break;case 268435456:u=De;break;default:u=ye}return m=A0.bind(null,a),u=ut(u,m),a.callbackPriority=o,a.callbackNode=u,o}return m!==null&&m!==null&&Oe(m),a.callbackPriority=2,a.callbackNode=null,2}function A0(a,o){if(as!==0&&as!==5)return a.callbackNode=null,a.callbackPriority=0,null;var u=a.callbackNode;if(Vo()&&a.callbackNode!==u)return null;var m=at;return m=zs(a,a===wt?m:0,a.cancelPendingCommit!==null||a.timeoutHandle!==-1),m===0?null:(a0(a,m,o),T0(a,st()),a.callbackNode!=null&&a.callbackNode===u?A0.bind(null,a):null)}function _0(a,o){if(Vo())return null;a0(a,o,!0)}function vT(){wT(function(){(ft&6)!==0?ut(Xt,gT):E0()})}function Jd(){if(Vn===0){var a=Ya;a===0&&(a=is,is<<=1,(is&261888)===0&&(is=256)),Vn=a}return Vn}function I0(a){return a==null||typeof a=="symbol"||typeof a=="boolean"?null:typeof a=="function"?a:Wl(""+a)}function R0(a,o){var u=o.ownerDocument.createElement("input");return u.name=o.name,u.value=o.value,a.id&&u.setAttribute("form",a.id),o.parentNode.insertBefore(u,o),a=new FormData(a),u.parentNode.removeChild(u),a}function yT(a,o,u,m,y){if(o==="submit"&&u&&u.stateNode===y){var b=I0((y[Dt]||null).action),I=m.submitter;I&&(o=(o=I[Dt]||null)?I0(o.formAction):I.getAttribute("formAction"),o!==null&&(b=o,I=null));var O=new to("action","action",null,m,y);a.push({event:O,listeners:[{instance:null,listener:function(){if(m.defaultPrevented){if(Vn!==0){var B=I?R0(y,I):new FormData(y);xd(u,{pending:!0,data:B,method:y.method,action:b},null,B)}}else typeof b=="function"&&(O.preventDefault(),B=I?R0(y,I):new FormData(y),xd(u,{pending:!0,data:B,method:y.method,action:b},b,B))},currentTarget:y}]})}}for(var eh=0;eh<Uu.length;eh++){var th=Uu[eh],xT=th.toLowerCase(),ST=th[0].toUpperCase()+th.slice(1);_i(xT,"on"+ST)}_i(np,"onAnimationEnd"),_i(ap,"onAnimationIteration"),_i(rp,"onAnimationStart"),_i("dblclick","onDoubleClick"),_i("focusin","onFocus"),_i("focusout","onBlur"),_i(UE,"onTransitionRun"),_i(ME,"onTransitionStart"),_i(jE,"onTransitionCancel"),_i(lp,"onTransitionEnd"),Da("onMouseEnter",["mouseout","mouseover"]),Da("onMouseLeave",["mouseout","mouseover"]),Da("onPointerEnter",["pointerout","pointerover"]),Da("onPointerLeave",["pointerout","pointerover"]),ia("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),ia("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),ia("onBeforeInput",["compositionend","keypress","textInput","paste"]),ia("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),ia("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),ia("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ml="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),bT=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(ml));function L0(a,o){o=(o&4)!==0;for(var u=0;u<a.length;u++){var m=a[u],y=m.event;m=m.listeners;e:{var b=void 0;if(o)for(var I=m.length-1;0<=I;I--){var O=m[I],B=O.instance,W=O.currentTarget;if(O=O.listener,B!==b&&y.isPropagationStopped())break e;b=O,y.currentTarget=W;try{b(y)}catch(ae){no(ae)}y.currentTarget=null,b=B}else for(I=0;I<m.length;I++){if(O=m[I],B=O.instance,W=O.currentTarget,O=O.listener,B!==b&&y.isPropagationStopped())break e;b=O,y.currentTarget=W;try{b(y)}catch(ae){no(ae)}y.currentTarget=null,b=B}}}}function nt(a,o){var u=o[Dr];u===void 0&&(u=o[Dr]=new Set);var m=a+"__bubble";u.has(m)||(w0(o,a,2,!1),u.add(m))}function sh(a,o,u){var m=0;o&&(m|=4),w0(u,a,m,o)}var zo="_reactListening"+Math.random().toString(36).slice(2);function ih(a){if(!a[zo]){a[zo]=!0,Em.forEach(function(u){u!=="selectionchange"&&(bT.has(u)||sh(u,!1,a),sh(u,!0,a))});var o=a.nodeType===9?a:a.ownerDocument;o===null||o[zo]||(o[zo]=!0,sh("selectionchange",!1,o))}}function w0(a,o,u,m){switch(nv(o)){case 2:var y=QT;break;case 8:y=XT;break;default:y=yh}u=y.bind(null,o,u,a),y=void 0,!Tu||o!=="touchstart"&&o!=="touchmove"&&o!=="wheel"||(y=!0),m?y!==void 0?a.addEventListener(o,u,{capture:!0,passive:y}):a.addEventListener(o,u,!0):y!==void 0?a.addEventListener(o,u,{passive:y}):a.addEventListener(o,u,!1)}function nh(a,o,u,m,y){var b=m;if((o&1)===0&&(o&2)===0&&m!==null)e:for(;;){if(m===null)return;var I=m.tag;if(I===3||I===4){var O=m.stateNode.containerInfo;if(O===y)break;if(I===4)for(I=m.return;I!==null;){var B=I.tag;if((B===3||B===4)&&I.stateNode.containerInfo===y)return;I=I.return}for(;O!==null;){if(I=Ca(O),I===null)return;if(B=I.tag,B===5||B===6||B===26||B===27){m=b=I;continue e}O=O.parentNode}}m=m.return}km(function(){var W=b,ae=bu(u),he=[];e:{var Z=op.get(a);if(Z!==void 0){var te=to,Ue=a;switch(a){case"keypress":if(Jl(u)===0)break e;case"keydown":case"keyup":te=mE;break;case"focusin":Ue="focus",te=Ru;break;case"focusout":Ue="blur",te=Ru;break;case"beforeblur":case"afterblur":te=Ru;break;case"click":if(u.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":te=Mm;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":te=sE;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":te=vE;break;case np:case ap:case rp:te=aE;break;case lp:te=xE;break;case"scroll":case"scrollend":te=eE;break;case"wheel":te=bE;break;case"copy":case"cut":case"paste":te=lE;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":te=Fm;break;case"toggle":case"beforetoggle":te=TE}var Ge=(o&4)!==0,Tt=!Ge&&(a==="scroll"||a==="scrollend"),z=Ge?Z!==null?Z+"Capture":null:Z;Ge=[];for(var V=W,X;V!==null;){var oe=V;if(X=oe.stateNode,oe=oe.tag,oe!==5&&oe!==26&&oe!==27||X===null||z===null||(oe=Ur(V,z),oe!=null&&Ge.push(pl(V,oe,X))),Tt)break;V=V.return}0<Ge.length&&(Z=new te(Z,Ue,null,u,ae),he.push({event:Z,listeners:Ge}))}}if((o&7)===0){e:{if(Z=a==="mouseover"||a==="pointerover",te=a==="mouseout"||a==="pointerout",Z&&u!==Su&&(Ue=u.relatedTarget||u.fromElement)&&(Ca(Ue)||Ue[sa]))break e;if((te||Z)&&(Z=ae.window===ae?ae:(Z=ae.ownerDocument)?Z.defaultView||Z.parentWindow:window,te?(Ue=u.relatedTarget||u.toElement,te=W,Ue=Ue?Ca(Ue):null,Ue!==null&&(Tt=r(Ue),Ge=Ue.tag,Ue!==Tt||Ge!==5&&Ge!==27&&Ge!==6)&&(Ue=null)):(te=null,Ue=W),te!==Ue)){if(Ge=Mm,oe="onMouseLeave",z="onMouseEnter",V="mouse",(a==="pointerout"||a==="pointerover")&&(Ge=Fm,oe="onPointerLeave",z="onPointerEnter",V="pointer"),Tt=te==null?Z:Pr(te),X=Ue==null?Z:Pr(Ue),Z=new Ge(oe,V+"leave",te,u,ae),Z.target=Tt,Z.relatedTarget=X,oe=null,Ca(ae)===W&&(Ge=new Ge(z,V+"enter",Ue,u,ae),Ge.target=X,Ge.relatedTarget=Tt,oe=Ge),Tt=oe,te&&Ue)t:{for(Ge=ET,z=te,V=Ue,X=0,oe=z;oe;oe=Ge(oe))X++;oe=0;for(var Be=V;Be;Be=Ge(Be))oe++;for(;0<X-oe;)z=Ge(z),X--;for(;0<oe-X;)V=Ge(V),oe--;for(;X--;){if(z===V||V!==null&&z===V.alternate){Ge=z;break t}z=Ge(z),V=Ge(V)}Ge=null}else Ge=null;te!==null&&C0(he,Z,te,Ge,!1),Ue!==null&&Tt!==null&&C0(he,Tt,Ue,Ge,!0)}}e:{if(Z=W?Pr(W):window,te=Z.nodeName&&Z.nodeName.toLowerCase(),te==="select"||te==="input"&&Z.type==="file")var dt=Ym;else if(zm(Z))if(qm)dt=DE;else{dt=OE;var Me=CE}else te=Z.nodeName,!te||te.toLowerCase()!=="input"||Z.type!=="checkbox"&&Z.type!=="radio"?W&&xu(W.elementType)&&(dt=Ym):dt=NE;if(dt&&(dt=dt(a,W))){Km(he,dt,u,ae);break e}Me&&Me(a,Z,W),a==="focusout"&&W&&Z.type==="number"&&W.memoizedProps.value!=null&&yu(Z,"number",Z.value)}switch(Me=W?Pr(W):window,a){case"focusin":(zm(Me)||Me.contentEditable==="true")&&(Fa=Me,Du=W,Hr=null);break;case"focusout":Hr=Du=Fa=null;break;case"mousedown":ku=!0;break;case"contextmenu":case"mouseup":case"dragend":ku=!1,sp(he,u,ae);break;case"selectionchange":if(PE)break;case"keydown":case"keyup":sp(he,u,ae)}var We;if(wu)e:{switch(a){case"compositionstart":var rt="onCompositionStart";break e;case"compositionend":rt="onCompositionEnd";break e;case"compositionupdate":rt="onCompositionUpdate";break e}rt=void 0}else ja?Gm(a,u)&&(rt="onCompositionEnd"):a==="keydown"&&u.keyCode===229&&(rt="onCompositionStart");rt&&(Bm&&u.locale!=="ko"&&(ja||rt!=="onCompositionStart"?rt==="onCompositionEnd"&&ja&&(We=Pm()):(In=ae,Au="value"in In?In.value:In.textContent,ja=!0)),Me=Ko(W,rt),0<Me.length&&(rt=new jm(rt,a,null,u,ae),he.push({event:rt,listeners:Me}),We?rt.data=We:(We=Hm(u),We!==null&&(rt.data=We)))),(We=_E?IE(a,u):RE(a,u))&&(rt=Ko(W,"onBeforeInput"),0<rt.length&&(Me=new jm("onBeforeInput","beforeinput",null,u,ae),he.push({event:Me,listeners:rt}),Me.data=We)),yT(he,a,W,u,ae)}L0(he,o)})}function pl(a,o,u){return{instance:a,listener:o,currentTarget:u}}function Ko(a,o){for(var u=o+"Capture",m=[];a!==null;){var y=a,b=y.stateNode;if(y=y.tag,y!==5&&y!==26&&y!==27||b===null||(y=Ur(a,u),y!=null&&m.unshift(pl(a,y,b)),y=Ur(a,o),y!=null&&m.push(pl(a,y,b))),a.tag===3)return m;a=a.return}return[]}function ET(a){if(a===null)return null;do a=a.return;while(a&&a.tag!==5&&a.tag!==27);return a||null}function C0(a,o,u,m,y){for(var b=o._reactName,I=[];u!==null&&u!==m;){var O=u,B=O.alternate,W=O.stateNode;if(O=O.tag,B!==null&&B===m)break;O!==5&&O!==26&&O!==27||W===null||(B=W,y?(W=Ur(u,b),W!=null&&I.unshift(pl(u,W,B))):y||(W=Ur(u,b),W!=null&&I.push(pl(u,W,B)))),u=u.return}I.length!==0&&a.push({event:o,listeners:I})}var TT=/\r\n?/g,AT=/\u0000|\uFFFD/g;function O0(a){return(typeof a=="string"?a:""+a).replace(TT,`
`).replace(AT,"")}function N0(a,o){return o=O0(o),O0(a)===o}function Et(a,o,u,m,y,b){switch(u){case"children":typeof m=="string"?o==="body"||o==="textarea"&&m===""||Pa(a,m):(typeof m=="number"||typeof m=="bigint")&&o!=="body"&&Pa(a,""+m);break;case"className":Ql(a,"class",m);break;case"tabIndex":Ql(a,"tabindex",m);break;case"dir":case"role":case"viewBox":case"width":case"height":Ql(a,u,m);break;case"style":Nm(a,m,b);break;case"data":if(o!=="object"){Ql(a,"data",m);break}case"src":case"href":if(m===""&&(o!=="a"||u!=="href")){a.removeAttribute(u);break}if(m==null||typeof m=="function"||typeof m=="symbol"||typeof m=="boolean"){a.removeAttribute(u);break}m=Wl(""+m),a.setAttribute(u,m);break;case"action":case"formAction":if(typeof m=="function"){a.setAttribute(u,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof b=="function"&&(u==="formAction"?(o!=="input"&&Et(a,o,"name",y.name,y,null),Et(a,o,"formEncType",y.formEncType,y,null),Et(a,o,"formMethod",y.formMethod,y,null),Et(a,o,"formTarget",y.formTarget,y,null)):(Et(a,o,"encType",y.encType,y,null),Et(a,o,"method",y.method,y,null),Et(a,o,"target",y.target,y,null)));if(m==null||typeof m=="symbol"||typeof m=="boolean"){a.removeAttribute(u);break}m=Wl(""+m),a.setAttribute(u,m);break;case"onClick":m!=null&&(a.onclick=Zi);break;case"onScroll":m!=null&&nt("scroll",a);break;case"onScrollEnd":m!=null&&nt("scrollend",a);break;case"dangerouslySetInnerHTML":if(m!=null){if(typeof m!="object"||!("__html"in m))throw Error(s(61));if(u=m.__html,u!=null){if(y.children!=null)throw Error(s(60));a.innerHTML=u}}break;case"multiple":a.multiple=m&&typeof m!="function"&&typeof m!="symbol";break;case"muted":a.muted=m&&typeof m!="function"&&typeof m!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(m==null||typeof m=="function"||typeof m=="boolean"||typeof m=="symbol"){a.removeAttribute("xlink:href");break}u=Wl(""+m),a.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",u);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":m!=null&&typeof m!="function"&&typeof m!="symbol"?a.setAttribute(u,""+m):a.removeAttribute(u);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":m&&typeof m!="function"&&typeof m!="symbol"?a.setAttribute(u,""):a.removeAttribute(u);break;case"capture":case"download":m===!0?a.setAttribute(u,""):m!==!1&&m!=null&&typeof m!="function"&&typeof m!="symbol"?a.setAttribute(u,m):a.removeAttribute(u);break;case"cols":case"rows":case"size":case"span":m!=null&&typeof m!="function"&&typeof m!="symbol"&&!isNaN(m)&&1<=m?a.setAttribute(u,m):a.removeAttribute(u);break;case"rowSpan":case"start":m==null||typeof m=="function"||typeof m=="symbol"||isNaN(m)?a.removeAttribute(u):a.setAttribute(u,m);break;case"popover":nt("beforetoggle",a),nt("toggle",a),ql(a,"popover",m);break;case"xlinkActuate":Wi(a,"http://www.w3.org/1999/xlink","xlink:actuate",m);break;case"xlinkArcrole":Wi(a,"http://www.w3.org/1999/xlink","xlink:arcrole",m);break;case"xlinkRole":Wi(a,"http://www.w3.org/1999/xlink","xlink:role",m);break;case"xlinkShow":Wi(a,"http://www.w3.org/1999/xlink","xlink:show",m);break;case"xlinkTitle":Wi(a,"http://www.w3.org/1999/xlink","xlink:title",m);break;case"xlinkType":Wi(a,"http://www.w3.org/1999/xlink","xlink:type",m);break;case"xmlBase":Wi(a,"http://www.w3.org/XML/1998/namespace","xml:base",m);break;case"xmlLang":Wi(a,"http://www.w3.org/XML/1998/namespace","xml:lang",m);break;case"xmlSpace":Wi(a,"http://www.w3.org/XML/1998/namespace","xml:space",m);break;case"is":ql(a,"is",m);break;case"innerText":case"textContent":break;default:(!(2<u.length)||u[0]!=="o"&&u[0]!=="O"||u[1]!=="n"&&u[1]!=="N")&&(u=Zb.get(u)||u,ql(a,u,m))}}function ah(a,o,u,m,y,b){switch(u){case"style":Nm(a,m,b);break;case"dangerouslySetInnerHTML":if(m!=null){if(typeof m!="object"||!("__html"in m))throw Error(s(61));if(u=m.__html,u!=null){if(y.children!=null)throw Error(s(60));a.innerHTML=u}}break;case"children":typeof m=="string"?Pa(a,m):(typeof m=="number"||typeof m=="bigint")&&Pa(a,""+m);break;case"onScroll":m!=null&&nt("scroll",a);break;case"onScrollEnd":m!=null&&nt("scrollend",a);break;case"onClick":m!=null&&(a.onclick=Zi);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Tm.hasOwnProperty(u))e:{if(u[0]==="o"&&u[1]==="n"&&(y=u.endsWith("Capture"),o=u.slice(2,y?u.length-7:void 0),b=a[Dt]||null,b=b!=null?b[u]:null,typeof b=="function"&&a.removeEventListener(o,b,y),typeof m=="function")){typeof b!="function"&&b!==null&&(u in a?a[u]=null:a.hasAttribute(u)&&a.removeAttribute(u)),a.addEventListener(o,m,y);break e}u in a?a[u]=m:m===!0?a.setAttribute(u,""):ql(a,u,m)}}}function ps(a,o,u){switch(o){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":nt("error",a),nt("load",a);var m=!1,y=!1,b;for(b in u)if(u.hasOwnProperty(b)){var I=u[b];if(I!=null)switch(b){case"src":m=!0;break;case"srcSet":y=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(s(137,o));default:Et(a,o,b,I,u,null)}}y&&Et(a,o,"srcSet",u.srcSet,u,null),m&&Et(a,o,"src",u.src,u,null);return;case"input":nt("invalid",a);var O=b=I=y=null,B=null,W=null;for(m in u)if(u.hasOwnProperty(m)){var ae=u[m];if(ae!=null)switch(m){case"name":y=ae;break;case"type":I=ae;break;case"checked":B=ae;break;case"defaultChecked":W=ae;break;case"value":b=ae;break;case"defaultValue":O=ae;break;case"children":case"dangerouslySetInnerHTML":if(ae!=null)throw Error(s(137,o));break;default:Et(a,o,m,ae,u,null)}}Lm(a,b,O,B,W,I,y,!1);return;case"select":nt("invalid",a),m=I=b=null;for(y in u)if(u.hasOwnProperty(y)&&(O=u[y],O!=null))switch(y){case"value":b=O;break;case"defaultValue":I=O;break;case"multiple":m=O;default:Et(a,o,y,O,u,null)}o=b,u=I,a.multiple=!!m,o!=null?ka(a,!!m,o,!1):u!=null&&ka(a,!!m,u,!0);return;case"textarea":nt("invalid",a),b=y=m=null;for(I in u)if(u.hasOwnProperty(I)&&(O=u[I],O!=null))switch(I){case"value":m=O;break;case"defaultValue":y=O;break;case"children":b=O;break;case"dangerouslySetInnerHTML":if(O!=null)throw Error(s(91));break;default:Et(a,o,I,O,u,null)}Cm(a,m,y,b);return;case"option":for(B in u)u.hasOwnProperty(B)&&(m=u[B],m!=null)&&(B==="selected"?a.selected=m&&typeof m!="function"&&typeof m!="symbol":Et(a,o,B,m,u,null));return;case"dialog":nt("beforetoggle",a),nt("toggle",a),nt("cancel",a),nt("close",a);break;case"iframe":case"object":nt("load",a);break;case"video":case"audio":for(m=0;m<ml.length;m++)nt(ml[m],a);break;case"image":nt("error",a),nt("load",a);break;case"details":nt("toggle",a);break;case"embed":case"source":case"link":nt("error",a),nt("load",a);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(W in u)if(u.hasOwnProperty(W)&&(m=u[W],m!=null))switch(W){case"children":case"dangerouslySetInnerHTML":throw Error(s(137,o));default:Et(a,o,W,m,u,null)}return;default:if(xu(o)){for(ae in u)u.hasOwnProperty(ae)&&(m=u[ae],m!==void 0&&ah(a,o,ae,m,u,void 0));return}}for(O in u)u.hasOwnProperty(O)&&(m=u[O],m!=null&&Et(a,o,O,m,u,null))}function _T(a,o,u,m){switch(o){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var y=null,b=null,I=null,O=null,B=null,W=null,ae=null;for(te in u){var he=u[te];if(u.hasOwnProperty(te)&&he!=null)switch(te){case"checked":break;case"value":break;case"defaultValue":B=he;default:m.hasOwnProperty(te)||Et(a,o,te,null,m,he)}}for(var Z in m){var te=m[Z];if(he=u[Z],m.hasOwnProperty(Z)&&(te!=null||he!=null))switch(Z){case"type":b=te;break;case"name":y=te;break;case"checked":W=te;break;case"defaultChecked":ae=te;break;case"value":I=te;break;case"defaultValue":O=te;break;case"children":case"dangerouslySetInnerHTML":if(te!=null)throw Error(s(137,o));break;default:te!==he&&Et(a,o,Z,te,m,he)}}vu(a,I,O,B,W,ae,b,y);return;case"select":te=I=O=Z=null;for(b in u)if(B=u[b],u.hasOwnProperty(b)&&B!=null)switch(b){case"value":break;case"multiple":te=B;default:m.hasOwnProperty(b)||Et(a,o,b,null,m,B)}for(y in m)if(b=m[y],B=u[y],m.hasOwnProperty(y)&&(b!=null||B!=null))switch(y){case"value":Z=b;break;case"defaultValue":O=b;break;case"multiple":I=b;default:b!==B&&Et(a,o,y,b,m,B)}o=O,u=I,m=te,Z!=null?ka(a,!!u,Z,!1):!!m!=!!u&&(o!=null?ka(a,!!u,o,!0):ka(a,!!u,u?[]:"",!1));return;case"textarea":te=Z=null;for(O in u)if(y=u[O],u.hasOwnProperty(O)&&y!=null&&!m.hasOwnProperty(O))switch(O){case"value":break;case"children":break;default:Et(a,o,O,null,m,y)}for(I in m)if(y=m[I],b=u[I],m.hasOwnProperty(I)&&(y!=null||b!=null))switch(I){case"value":Z=y;break;case"defaultValue":te=y;break;case"children":break;case"dangerouslySetInnerHTML":if(y!=null)throw Error(s(91));break;default:y!==b&&Et(a,o,I,y,m,b)}wm(a,Z,te);return;case"option":for(var Ue in u)Z=u[Ue],u.hasOwnProperty(Ue)&&Z!=null&&!m.hasOwnProperty(Ue)&&(Ue==="selected"?a.selected=!1:Et(a,o,Ue,null,m,Z));for(B in m)Z=m[B],te=u[B],m.hasOwnProperty(B)&&Z!==te&&(Z!=null||te!=null)&&(B==="selected"?a.selected=Z&&typeof Z!="function"&&typeof Z!="symbol":Et(a,o,B,Z,m,te));return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Ge in u)Z=u[Ge],u.hasOwnProperty(Ge)&&Z!=null&&!m.hasOwnProperty(Ge)&&Et(a,o,Ge,null,m,Z);for(W in m)if(Z=m[W],te=u[W],m.hasOwnProperty(W)&&Z!==te&&(Z!=null||te!=null))switch(W){case"children":case"dangerouslySetInnerHTML":if(Z!=null)throw Error(s(137,o));break;default:Et(a,o,W,Z,m,te)}return;default:if(xu(o)){for(var Tt in u)Z=u[Tt],u.hasOwnProperty(Tt)&&Z!==void 0&&!m.hasOwnProperty(Tt)&&ah(a,o,Tt,void 0,m,Z);for(ae in m)Z=m[ae],te=u[ae],!m.hasOwnProperty(ae)||Z===te||Z===void 0&&te===void 0||ah(a,o,ae,Z,m,te);return}}for(var z in u)Z=u[z],u.hasOwnProperty(z)&&Z!=null&&!m.hasOwnProperty(z)&&Et(a,o,z,null,m,Z);for(he in m)Z=m[he],te=u[he],!m.hasOwnProperty(he)||Z===te||Z==null&&te==null||Et(a,o,he,Z,m,te)}function D0(a){switch(a){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function IT(){if(typeof performance.getEntriesByType=="function"){for(var a=0,o=0,u=performance.getEntriesByType("resource"),m=0;m<u.length;m++){var y=u[m],b=y.transferSize,I=y.initiatorType,O=y.duration;if(b&&O&&D0(I)){for(I=0,O=y.responseEnd,m+=1;m<u.length;m++){var B=u[m],W=B.startTime;if(W>O)break;var ae=B.transferSize,he=B.initiatorType;ae&&D0(he)&&(B=B.responseEnd,I+=ae*(B<O?1:(O-W)/(B-W)))}if(--m,o+=8*(b+I)/(y.duration/1e3),a++,10<a)break}}if(0<a)return o/a/1e6}return navigator.connection&&(a=navigator.connection.downlink,typeof a=="number")?a:5}var rh=null,lh=null;function Yo(a){return a.nodeType===9?a:a.ownerDocument}function k0(a){switch(a){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function P0(a,o){if(a===0)switch(o){case"svg":return 1;case"math":return 2;default:return 0}return a===1&&o==="foreignObject"?0:a}function oh(a,o){return a==="textarea"||a==="noscript"||typeof o.children=="string"||typeof o.children=="number"||typeof o.children=="bigint"||typeof o.dangerouslySetInnerHTML=="object"&&o.dangerouslySetInnerHTML!==null&&o.dangerouslySetInnerHTML.__html!=null}var ch=null;function RT(){var a=window.event;return a&&a.type==="popstate"?a===ch?!1:(ch=a,!0):(ch=null,!1)}var U0=typeof setTimeout=="function"?setTimeout:void 0,LT=typeof clearTimeout=="function"?clearTimeout:void 0,M0=typeof Promise=="function"?Promise:void 0,wT=typeof queueMicrotask=="function"?queueMicrotask:typeof M0<"u"?function(a){return M0.resolve(null).then(a).catch(CT)}:U0;function CT(a){setTimeout(function(){throw a})}function Gn(a){return a==="head"}function j0(a,o){var u=o,m=0;do{var y=u.nextSibling;if(a.removeChild(u),y&&y.nodeType===8)if(u=y.data,u==="/$"||u==="/&"){if(m===0){a.removeChild(y),hr(o);return}m--}else if(u==="$"||u==="$?"||u==="$~"||u==="$!"||u==="&")m++;else if(u==="html")gl(a.ownerDocument.documentElement);else if(u==="head"){u=a.ownerDocument.head,gl(u);for(var b=u.firstChild;b;){var I=b.nextSibling,O=b.nodeName;b[kr]||O==="SCRIPT"||O==="STYLE"||O==="LINK"&&b.rel.toLowerCase()==="stylesheet"||u.removeChild(b),b=I}}else u==="body"&&gl(a.ownerDocument.body);u=y}while(u);hr(o)}function F0(a,o){var u=a;a=0;do{var m=u.nextSibling;if(u.nodeType===1?o?(u._stashedDisplay=u.style.display,u.style.display="none"):(u.style.display=u._stashedDisplay||"",u.getAttribute("style")===""&&u.removeAttribute("style")):u.nodeType===3&&(o?(u._stashedText=u.nodeValue,u.nodeValue=""):u.nodeValue=u._stashedText||""),m&&m.nodeType===8)if(u=m.data,u==="/$"){if(a===0)break;a--}else u!=="$"&&u!=="$?"&&u!=="$~"&&u!=="$!"||a++;u=m}while(u)}function uh(a){var o=a.firstChild;for(o&&o.nodeType===10&&(o=o.nextSibling);o;){var u=o;switch(o=o.nextSibling,u.nodeName){case"HTML":case"HEAD":case"BODY":uh(u),pu(u);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(u.rel.toLowerCase()==="stylesheet")continue}a.removeChild(u)}}function OT(a,o,u,m){for(;a.nodeType===1;){var y=u;if(a.nodeName.toLowerCase()!==o.toLowerCase()){if(!m&&(a.nodeName!=="INPUT"||a.type!=="hidden"))break}else if(m){if(!a[kr])switch(o){case"meta":if(!a.hasAttribute("itemprop"))break;return a;case"link":if(b=a.getAttribute("rel"),b==="stylesheet"&&a.hasAttribute("data-precedence"))break;if(b!==y.rel||a.getAttribute("href")!==(y.href==null||y.href===""?null:y.href)||a.getAttribute("crossorigin")!==(y.crossOrigin==null?null:y.crossOrigin)||a.getAttribute("title")!==(y.title==null?null:y.title))break;return a;case"style":if(a.hasAttribute("data-precedence"))break;return a;case"script":if(b=a.getAttribute("src"),(b!==(y.src==null?null:y.src)||a.getAttribute("type")!==(y.type==null?null:y.type)||a.getAttribute("crossorigin")!==(y.crossOrigin==null?null:y.crossOrigin))&&b&&a.hasAttribute("async")&&!a.hasAttribute("itemprop"))break;return a;default:return a}}else if(o==="input"&&a.type==="hidden"){var b=y.name==null?null:""+y.name;if(y.type==="hidden"&&a.getAttribute("name")===b)return a}else return a;if(a=gi(a.nextSibling),a===null)break}return null}function NT(a,o,u){if(o==="")return null;for(;a.nodeType!==3;)if((a.nodeType!==1||a.nodeName!=="INPUT"||a.type!=="hidden")&&!u||(a=gi(a.nextSibling),a===null))return null;return a}function B0(a,o){for(;a.nodeType!==8;)if((a.nodeType!==1||a.nodeName!=="INPUT"||a.type!=="hidden")&&!o||(a=gi(a.nextSibling),a===null))return null;return a}function dh(a){return a.data==="$?"||a.data==="$~"}function hh(a){return a.data==="$!"||a.data==="$?"&&a.ownerDocument.readyState!=="loading"}function DT(a,o){var u=a.ownerDocument;if(a.data==="$~")a._reactRetry=o;else if(a.data!=="$?"||u.readyState!=="loading")o();else{var m=function(){o(),u.removeEventListener("DOMContentLoaded",m)};u.addEventListener("DOMContentLoaded",m),a._reactRetry=m}}function gi(a){for(;a!=null;a=a.nextSibling){var o=a.nodeType;if(o===1||o===3)break;if(o===8){if(o=a.data,o==="$"||o==="$!"||o==="$?"||o==="$~"||o==="&"||o==="F!"||o==="F")break;if(o==="/$"||o==="/&")return null}}return a}var fh=null;function $0(a){a=a.nextSibling;for(var o=0;a;){if(a.nodeType===8){var u=a.data;if(u==="/$"||u==="/&"){if(o===0)return gi(a.nextSibling);o--}else u!=="$"&&u!=="$!"&&u!=="$?"&&u!=="$~"&&u!=="&"||o++}a=a.nextSibling}return null}function V0(a){a=a.previousSibling;for(var o=0;a;){if(a.nodeType===8){var u=a.data;if(u==="$"||u==="$!"||u==="$?"||u==="$~"||u==="&"){if(o===0)return a;o--}else u!=="/$"&&u!=="/&"||o++}a=a.previousSibling}return null}function G0(a,o,u){switch(o=Yo(u),a){case"html":if(a=o.documentElement,!a)throw Error(s(452));return a;case"head":if(a=o.head,!a)throw Error(s(453));return a;case"body":if(a=o.body,!a)throw Error(s(454));return a;default:throw Error(s(451))}}function gl(a){for(var o=a.attributes;o.length;)a.removeAttributeNode(o[0]);pu(a)}var vi=new Map,H0=new Set;function qo(a){return typeof a.getRootNode=="function"?a.getRootNode():a.nodeType===9?a:a.ownerDocument}var pn=G.d;G.d={f:kT,r:PT,D:UT,C:MT,L:jT,m:FT,X:$T,S:BT,M:VT};function kT(){var a=pn.f(),o=Fo();return a||o}function PT(a){var o=Oa(a);o!==null&&o.tag===5&&o.type==="form"?lg(o):pn.r(a)}var cr=typeof document>"u"?null:document;function z0(a,o,u){var m=cr;if(m&&typeof o=="string"&&o){var y=ci(o);y='link[rel="'+a+'"][href="'+y+'"]',typeof u=="string"&&(y+='[crossorigin="'+u+'"]'),H0.has(y)||(H0.add(y),a={rel:a,crossOrigin:u,href:o},m.querySelector(y)===null&&(o=m.createElement("link"),ps(o,"link",a),cs(o),m.head.appendChild(o)))}}function UT(a){pn.D(a),z0("dns-prefetch",a,null)}function MT(a,o){pn.C(a,o),z0("preconnect",a,o)}function jT(a,o,u){pn.L(a,o,u);var m=cr;if(m&&a&&o){var y='link[rel="preload"][as="'+ci(o)+'"]';o==="image"&&u&&u.imageSrcSet?(y+='[imagesrcset="'+ci(u.imageSrcSet)+'"]',typeof u.imageSizes=="string"&&(y+='[imagesizes="'+ci(u.imageSizes)+'"]')):y+='[href="'+ci(a)+'"]';var b=y;switch(o){case"style":b=ur(a);break;case"script":b=dr(a)}vi.has(b)||(a=p({rel:"preload",href:o==="image"&&u&&u.imageSrcSet?void 0:a,as:o},u),vi.set(b,a),m.querySelector(y)!==null||o==="style"&&m.querySelector(vl(b))||o==="script"&&m.querySelector(yl(b))||(o=m.createElement("link"),ps(o,"link",a),cs(o),m.head.appendChild(o)))}}function FT(a,o){pn.m(a,o);var u=cr;if(u&&a){var m=o&&typeof o.as=="string"?o.as:"script",y='link[rel="modulepreload"][as="'+ci(m)+'"][href="'+ci(a)+'"]',b=y;switch(m){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":b=dr(a)}if(!vi.has(b)&&(a=p({rel:"modulepreload",href:a},o),vi.set(b,a),u.querySelector(y)===null)){switch(m){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(u.querySelector(yl(b)))return}m=u.createElement("link"),ps(m,"link",a),cs(m),u.head.appendChild(m)}}}function BT(a,o,u){pn.S(a,o,u);var m=cr;if(m&&a){var y=Na(m).hoistableStyles,b=ur(a);o=o||"default";var I=y.get(b);if(!I){var O={loading:0,preload:null};if(I=m.querySelector(vl(b)))O.loading=5;else{a=p({rel:"stylesheet",href:a,"data-precedence":o},u),(u=vi.get(b))&&mh(a,u);var B=I=m.createElement("link");cs(B),ps(B,"link",a),B._p=new Promise(function(W,ae){B.onload=W,B.onerror=ae}),B.addEventListener("load",function(){O.loading|=1}),B.addEventListener("error",function(){O.loading|=2}),O.loading|=4,Qo(I,o,m)}I={type:"stylesheet",instance:I,count:1,state:O},y.set(b,I)}}}function $T(a,o){pn.X(a,o);var u=cr;if(u&&a){var m=Na(u).hoistableScripts,y=dr(a),b=m.get(y);b||(b=u.querySelector(yl(y)),b||(a=p({src:a,async:!0},o),(o=vi.get(y))&&ph(a,o),b=u.createElement("script"),cs(b),ps(b,"link",a),u.head.appendChild(b)),b={type:"script",instance:b,count:1,state:null},m.set(y,b))}}function VT(a,o){pn.M(a,o);var u=cr;if(u&&a){var m=Na(u).hoistableScripts,y=dr(a),b=m.get(y);b||(b=u.querySelector(yl(y)),b||(a=p({src:a,async:!0,type:"module"},o),(o=vi.get(y))&&ph(a,o),b=u.createElement("script"),cs(b),ps(b,"link",a),u.head.appendChild(b)),b={type:"script",instance:b,count:1,state:null},m.set(y,b))}}function K0(a,o,u,m){var y=(y=ve.current)?qo(y):null;if(!y)throw Error(s(446));switch(a){case"meta":case"title":return null;case"style":return typeof u.precedence=="string"&&typeof u.href=="string"?(o=ur(u.href),u=Na(y).hoistableStyles,m=u.get(o),m||(m={type:"style",instance:null,count:0,state:null},u.set(o,m)),m):{type:"void",instance:null,count:0,state:null};case"link":if(u.rel==="stylesheet"&&typeof u.href=="string"&&typeof u.precedence=="string"){a=ur(u.href);var b=Na(y).hoistableStyles,I=b.get(a);if(I||(y=y.ownerDocument||y,I={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},b.set(a,I),(b=y.querySelector(vl(a)))&&!b._p&&(I.instance=b,I.state.loading=5),vi.has(a)||(u={rel:"preload",as:"style",href:u.href,crossOrigin:u.crossOrigin,integrity:u.integrity,media:u.media,hrefLang:u.hrefLang,referrerPolicy:u.referrerPolicy},vi.set(a,u),b||GT(y,a,u,I.state))),o&&m===null)throw Error(s(528,""));return I}if(o&&m!==null)throw Error(s(529,""));return null;case"script":return o=u.async,u=u.src,typeof u=="string"&&o&&typeof o!="function"&&typeof o!="symbol"?(o=dr(u),u=Na(y).hoistableScripts,m=u.get(o),m||(m={type:"script",instance:null,count:0,state:null},u.set(o,m)),m):{type:"void",instance:null,count:0,state:null};default:throw Error(s(444,a))}}function ur(a){return'href="'+ci(a)+'"'}function vl(a){return'link[rel="stylesheet"]['+a+"]"}function Y0(a){return p({},a,{"data-precedence":a.precedence,precedence:null})}function GT(a,o,u,m){a.querySelector('link[rel="preload"][as="style"]['+o+"]")?m.loading=1:(o=a.createElement("link"),m.preload=o,o.addEventListener("load",function(){return m.loading|=1}),o.addEventListener("error",function(){return m.loading|=2}),ps(o,"link",u),cs(o),a.head.appendChild(o))}function dr(a){return'[src="'+ci(a)+'"]'}function yl(a){return"script[async]"+a}function q0(a,o,u){if(o.count++,o.instance===null)switch(o.type){case"style":var m=a.querySelector('style[data-href~="'+ci(u.href)+'"]');if(m)return o.instance=m,cs(m),m;var y=p({},u,{"data-href":u.href,"data-precedence":u.precedence,href:null,precedence:null});return m=(a.ownerDocument||a).createElement("style"),cs(m),ps(m,"style",y),Qo(m,u.precedence,a),o.instance=m;case"stylesheet":y=ur(u.href);var b=a.querySelector(vl(y));if(b)return o.state.loading|=4,o.instance=b,cs(b),b;m=Y0(u),(y=vi.get(y))&&mh(m,y),b=(a.ownerDocument||a).createElement("link"),cs(b);var I=b;return I._p=new Promise(function(O,B){I.onload=O,I.onerror=B}),ps(b,"link",m),o.state.loading|=4,Qo(b,u.precedence,a),o.instance=b;case"script":return b=dr(u.src),(y=a.querySelector(yl(b)))?(o.instance=y,cs(y),y):(m=u,(y=vi.get(b))&&(m=p({},u),ph(m,y)),a=a.ownerDocument||a,y=a.createElement("script"),cs(y),ps(y,"link",m),a.head.appendChild(y),o.instance=y);case"void":return null;default:throw Error(s(443,o.type))}else o.type==="stylesheet"&&(o.state.loading&4)===0&&(m=o.instance,o.state.loading|=4,Qo(m,u.precedence,a));return o.instance}function Qo(a,o,u){for(var m=u.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),y=m.length?m[m.length-1]:null,b=y,I=0;I<m.length;I++){var O=m[I];if(O.dataset.precedence===o)b=O;else if(b!==y)break}b?b.parentNode.insertBefore(a,b.nextSibling):(o=u.nodeType===9?u.head:u,o.insertBefore(a,o.firstChild))}function mh(a,o){a.crossOrigin==null&&(a.crossOrigin=o.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=o.referrerPolicy),a.title==null&&(a.title=o.title)}function ph(a,o){a.crossOrigin==null&&(a.crossOrigin=o.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=o.referrerPolicy),a.integrity==null&&(a.integrity=o.integrity)}var Xo=null;function Q0(a,o,u){if(Xo===null){var m=new Map,y=Xo=new Map;y.set(u,m)}else y=Xo,m=y.get(u),m||(m=new Map,y.set(u,m));if(m.has(a))return m;for(m.set(a,null),u=u.getElementsByTagName(a),y=0;y<u.length;y++){var b=u[y];if(!(b[kr]||b[Lt]||a==="link"&&b.getAttribute("rel")==="stylesheet")&&b.namespaceURI!=="http://www.w3.org/2000/svg"){var I=b.getAttribute(o)||"";I=a+I;var O=m.get(I);O?O.push(b):m.set(I,[b])}}return m}function X0(a,o,u){a=a.ownerDocument||a,a.head.insertBefore(u,o==="title"?a.querySelector("head > title"):null)}function HT(a,o,u){if(u===1||o.itemProp!=null)return!1;switch(a){case"meta":case"title":return!0;case"style":if(typeof o.precedence!="string"||typeof o.href!="string"||o.href==="")break;return!0;case"link":if(typeof o.rel!="string"||typeof o.href!="string"||o.href===""||o.onLoad||o.onError)break;return o.rel==="stylesheet"?(a=o.disabled,typeof o.precedence=="string"&&a==null):!0;case"script":if(o.async&&typeof o.async!="function"&&typeof o.async!="symbol"&&!o.onLoad&&!o.onError&&o.src&&typeof o.src=="string")return!0}return!1}function W0(a){return!(a.type==="stylesheet"&&(a.state.loading&3)===0)}function zT(a,o,u,m){if(u.type==="stylesheet"&&(typeof m.media!="string"||matchMedia(m.media).matches!==!1)&&(u.state.loading&4)===0){if(u.instance===null){var y=ur(m.href),b=o.querySelector(vl(y));if(b){o=b._p,o!==null&&typeof o=="object"&&typeof o.then=="function"&&(a.count++,a=Wo.bind(a),o.then(a,a)),u.state.loading|=4,u.instance=b,cs(b);return}b=o.ownerDocument||o,m=Y0(m),(y=vi.get(y))&&mh(m,y),b=b.createElement("link"),cs(b);var I=b;I._p=new Promise(function(O,B){I.onload=O,I.onerror=B}),ps(b,"link",m),u.instance=b}a.stylesheets===null&&(a.stylesheets=new Map),a.stylesheets.set(u,o),(o=u.state.preload)&&(u.state.loading&3)===0&&(a.count++,u=Wo.bind(a),o.addEventListener("load",u),o.addEventListener("error",u))}}var gh=0;function KT(a,o){return a.stylesheets&&a.count===0&&Jo(a,a.stylesheets),0<a.count||0<a.imgCount?function(u){var m=setTimeout(function(){if(a.stylesheets&&Jo(a,a.stylesheets),a.unsuspend){var b=a.unsuspend;a.unsuspend=null,b()}},6e4+o);0<a.imgBytes&&gh===0&&(gh=62500*IT());var y=setTimeout(function(){if(a.waitingForImages=!1,a.count===0&&(a.stylesheets&&Jo(a,a.stylesheets),a.unsuspend)){var b=a.unsuspend;a.unsuspend=null,b()}},(a.imgBytes>gh?50:800)+o);return a.unsuspend=u,function(){a.unsuspend=null,clearTimeout(m),clearTimeout(y)}}:null}function Wo(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)Jo(this,this.stylesheets);else if(this.unsuspend){var a=this.unsuspend;this.unsuspend=null,a()}}}var Zo=null;function Jo(a,o){a.stylesheets=null,a.unsuspend!==null&&(a.count++,Zo=new Map,o.forEach(YT,a),Zo=null,Wo.call(a))}function YT(a,o){if(!(o.state.loading&4)){var u=Zo.get(a);if(u)var m=u.get(null);else{u=new Map,Zo.set(a,u);for(var y=a.querySelectorAll("link[data-precedence],style[data-precedence]"),b=0;b<y.length;b++){var I=y[b];(I.nodeName==="LINK"||I.getAttribute("media")!=="not all")&&(u.set(I.dataset.precedence,I),m=I)}m&&u.set(null,m)}y=o.instance,I=y.getAttribute("data-precedence"),b=u.get(I)||m,b===m&&u.set(null,y),u.set(I,y),this.count++,m=Wo.bind(this),y.addEventListener("load",m),y.addEventListener("error",m),b?b.parentNode.insertBefore(y,b.nextSibling):(a=a.nodeType===9?a.head:a,a.insertBefore(y,a.firstChild)),o.state.loading|=4}}var xl={$$typeof:R,Provider:null,Consumer:null,_currentValue:Y,_currentValue2:Y,_threadCount:0};function qT(a,o,u,m,y,b,I,O,B){this.tag=1,this.containerInfo=a,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Ai(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ai(0),this.hiddenUpdates=Ai(null),this.identifierPrefix=m,this.onUncaughtError=y,this.onCaughtError=b,this.onRecoverableError=I,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=B,this.incompleteTransitions=new Map}function Z0(a,o,u,m,y,b,I,O,B,W,ae,he){return a=new qT(a,o,u,I,B,W,ae,he,O),o=1,b===!0&&(o|=24),b=Ys(3,null,null,o),a.current=b,b.stateNode=a,o=Qu(),o.refCount++,a.pooledCache=o,o.refCount++,b.memoizedState={element:m,isDehydrated:u,cache:o},Ju(b),a}function J0(a){return a?(a=Va,a):Va}function ev(a,o,u,m,y,b){y=J0(y),m.context===null?m.context=y:m.pendingContext=y,m=Nn(o),m.payload={element:u},b=b===void 0?null:b,b!==null&&(m.callback=b),u=Dn(a,m,o),u!==null&&(Ms(u,a,o),Wr(u,a,o))}function tv(a,o){if(a=a.memoizedState,a!==null&&a.dehydrated!==null){var u=a.retryLane;a.retryLane=u!==0&&u<o?u:o}}function vh(a,o){tv(a,o),(a=a.alternate)&&tv(a,o)}function sv(a){if(a.tag===13||a.tag===31){var o=la(a,67108864);o!==null&&Ms(o,a,67108864),vh(a,67108864)}}function iv(a){if(a.tag===13||a.tag===31){var o=Zs();o=Pe(o);var u=la(a,o);u!==null&&Ms(u,a,o),vh(a,o)}}var ec=!0;function QT(a,o,u,m){var y=k.T;k.T=null;var b=G.p;try{G.p=2,yh(a,o,u,m)}finally{G.p=b,k.T=y}}function XT(a,o,u,m){var y=k.T;k.T=null;var b=G.p;try{G.p=8,yh(a,o,u,m)}finally{G.p=b,k.T=y}}function yh(a,o,u,m){if(ec){var y=xh(m);if(y===null)nh(a,o,m,tc,u),av(a,m);else if(ZT(y,a,o,u,m))m.stopPropagation();else if(av(a,m),o&4&&-1<WT.indexOf(a)){for(;y!==null;){var b=Oa(y);if(b!==null)switch(b.tag){case 3:if(b=b.stateNode,b.current.memoizedState.isDehydrated){var I=Hs(b.pendingLanes);if(I!==0){var O=b;for(O.pendingLanes|=2,O.entangledLanes|=2;I;){var B=1<<31-Nt(I);O.entanglements[1]|=B,I&=~B}Pi(b),(ft&6)===0&&(Mo=st()+500,fl(0))}}break;case 31:case 13:O=la(b,2),O!==null&&Ms(O,b,2),Fo(),vh(b,2)}if(b=xh(m),b===null&&nh(a,o,m,tc,u),b===y)break;y=b}y!==null&&m.stopPropagation()}else nh(a,o,m,null,u)}}function xh(a){return a=bu(a),Sh(a)}var tc=null;function Sh(a){if(tc=null,a=Ca(a),a!==null){var o=r(a);if(o===null)a=null;else{var u=o.tag;if(u===13){if(a=l(o),a!==null)return a;a=null}else if(u===31){if(a=c(o),a!==null)return a;a=null}else if(u===3){if(o.stateNode.current.memoizedState.isDehydrated)return o.tag===3?o.stateNode.containerInfo:null;a=null}else o!==a&&(a=null)}}return tc=a,null}function nv(a){switch(a){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Kt()){case Xt:return 2;case _s:return 8;case ye:case $e:return 32;case De:return 268435456;default:return 32}default:return 32}}var bh=!1,Hn=null,zn=null,Kn=null,Sl=new Map,bl=new Map,Yn=[],WT="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function av(a,o){switch(a){case"focusin":case"focusout":Hn=null;break;case"dragenter":case"dragleave":zn=null;break;case"mouseover":case"mouseout":Kn=null;break;case"pointerover":case"pointerout":Sl.delete(o.pointerId);break;case"gotpointercapture":case"lostpointercapture":bl.delete(o.pointerId)}}function El(a,o,u,m,y,b){return a===null||a.nativeEvent!==b?(a={blockedOn:o,domEventName:u,eventSystemFlags:m,nativeEvent:b,targetContainers:[y]},o!==null&&(o=Oa(o),o!==null&&sv(o)),a):(a.eventSystemFlags|=m,o=a.targetContainers,y!==null&&o.indexOf(y)===-1&&o.push(y),a)}function ZT(a,o,u,m,y){switch(o){case"focusin":return Hn=El(Hn,a,o,u,m,y),!0;case"dragenter":return zn=El(zn,a,o,u,m,y),!0;case"mouseover":return Kn=El(Kn,a,o,u,m,y),!0;case"pointerover":var b=y.pointerId;return Sl.set(b,El(Sl.get(b)||null,a,o,u,m,y)),!0;case"gotpointercapture":return b=y.pointerId,bl.set(b,El(bl.get(b)||null,a,o,u,m,y)),!0}return!1}function rv(a){var o=Ca(a.target);if(o!==null){var u=r(o);if(u!==null){if(o=u.tag,o===13){if(o=l(u),o!==null){a.blockedOn=o,xe(a.priority,function(){iv(u)});return}}else if(o===31){if(o=c(u),o!==null){a.blockedOn=o,xe(a.priority,function(){iv(u)});return}}else if(o===3&&u.stateNode.current.memoizedState.isDehydrated){a.blockedOn=u.tag===3?u.stateNode.containerInfo:null;return}}}a.blockedOn=null}function sc(a){if(a.blockedOn!==null)return!1;for(var o=a.targetContainers;0<o.length;){var u=xh(a.nativeEvent);if(u===null){u=a.nativeEvent;var m=new u.constructor(u.type,u);Su=m,u.target.dispatchEvent(m),Su=null}else return o=Oa(u),o!==null&&sv(o),a.blockedOn=u,!1;o.shift()}return!0}function lv(a,o,u){sc(a)&&u.delete(o)}function JT(){bh=!1,Hn!==null&&sc(Hn)&&(Hn=null),zn!==null&&sc(zn)&&(zn=null),Kn!==null&&sc(Kn)&&(Kn=null),Sl.forEach(lv),bl.forEach(lv)}function ic(a,o){a.blockedOn===o&&(a.blockedOn=null,bh||(bh=!0,i.unstable_scheduleCallback(i.unstable_NormalPriority,JT)))}var nc=null;function ov(a){nc!==a&&(nc=a,i.unstable_scheduleCallback(i.unstable_NormalPriority,function(){nc===a&&(nc=null);for(var o=0;o<a.length;o+=3){var u=a[o],m=a[o+1],y=a[o+2];if(typeof m!="function"){if(Sh(m||u)===null)continue;break}var b=Oa(u);b!==null&&(a.splice(o,3),o-=3,xd(b,{pending:!0,data:y,method:u.method,action:m},m,y))}}))}function hr(a){function o(B){return ic(B,a)}Hn!==null&&ic(Hn,a),zn!==null&&ic(zn,a),Kn!==null&&ic(Kn,a),Sl.forEach(o),bl.forEach(o);for(var u=0;u<Yn.length;u++){var m=Yn[u];m.blockedOn===a&&(m.blockedOn=null)}for(;0<Yn.length&&(u=Yn[0],u.blockedOn===null);)rv(u),u.blockedOn===null&&Yn.shift();if(u=(a.ownerDocument||a).$$reactFormReplay,u!=null)for(m=0;m<u.length;m+=3){var y=u[m],b=u[m+1],I=y[Dt]||null;if(typeof b=="function")I||ov(u);else if(I){var O=null;if(b&&b.hasAttribute("formAction")){if(y=b,I=b[Dt]||null)O=I.formAction;else if(Sh(y)!==null)continue}else O=I.action;typeof O=="function"?u[m+1]=O:(u.splice(m,3),m-=3),ov(u)}}}function cv(){function a(b){b.canIntercept&&b.info==="react-transition"&&b.intercept({handler:function(){return new Promise(function(I){return y=I})},focusReset:"manual",scroll:"manual"})}function o(){y!==null&&(y(),y=null),m||setTimeout(u,20)}function u(){if(!m&&!navigation.transition){var b=navigation.currentEntry;b&&b.url!=null&&navigation.navigate(b.url,{state:b.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var m=!1,y=null;return navigation.addEventListener("navigate",a),navigation.addEventListener("navigatesuccess",o),navigation.addEventListener("navigateerror",o),setTimeout(u,100),function(){m=!0,navigation.removeEventListener("navigate",a),navigation.removeEventListener("navigatesuccess",o),navigation.removeEventListener("navigateerror",o),y!==null&&(y(),y=null)}}}function Eh(a){this._internalRoot=a}ac.prototype.render=Eh.prototype.render=function(a){var o=this._internalRoot;if(o===null)throw Error(s(409));var u=o.current,m=Zs();ev(u,m,a,o,null,null)},ac.prototype.unmount=Eh.prototype.unmount=function(){var a=this._internalRoot;if(a!==null){this._internalRoot=null;var o=a.containerInfo;ev(a.current,2,null,a,null,null),Fo(),o[sa]=null}};function ac(a){this._internalRoot=a}ac.prototype.unstable_scheduleHydration=function(a){if(a){var o=Rs();a={blockedOn:null,target:a,priority:o};for(var u=0;u<Yn.length&&o!==0&&o<Yn[u].priority;u++);Yn.splice(u,0,a),u===0&&rv(a)}};var uv=e.version;if(uv!=="19.2.4")throw Error(s(527,uv,"19.2.4"));G.findDOMNode=function(a){var o=a._reactInternals;if(o===void 0)throw typeof a.render=="function"?Error(s(188)):(a=Object.keys(a).join(","),Error(s(268,a)));return a=d(o),a=a!==null?f(a):null,a=a===null?null:a.stateNode,a};var eA={bundleType:0,version:"19.2.4",rendererPackageName:"react-dom",currentDispatcherRef:k,reconcilerVersion:"19.2.4"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var rc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!rc.isDisabled&&rc.supportsFiber)try{ss=rc.inject(eA),It=rc}catch{}}return Al.createRoot=function(a,o){if(!n(a))throw Error(s(299));var u=!1,m="",y=vg,b=yg,I=xg;return o!=null&&(o.unstable_strictMode===!0&&(u=!0),o.identifierPrefix!==void 0&&(m=o.identifierPrefix),o.onUncaughtError!==void 0&&(y=o.onUncaughtError),o.onCaughtError!==void 0&&(b=o.onCaughtError),o.onRecoverableError!==void 0&&(I=o.onRecoverableError)),o=Z0(a,1,!1,null,null,u,m,null,y,b,I,cv),a[sa]=o.current,ih(a),new Eh(o)},Al.hydrateRoot=function(a,o,u){if(!n(a))throw Error(s(299));var m=!1,y="",b=vg,I=yg,O=xg,B=null;return u!=null&&(u.unstable_strictMode===!0&&(m=!0),u.identifierPrefix!==void 0&&(y=u.identifierPrefix),u.onUncaughtError!==void 0&&(b=u.onUncaughtError),u.onCaughtError!==void 0&&(I=u.onCaughtError),u.onRecoverableError!==void 0&&(O=u.onRecoverableError),u.formState!==void 0&&(B=u.formState)),o=Z0(a,1,!0,o,u??null,m,y,B,b,I,O,cv),o.context=J0(null),u=o.current,m=Zs(),m=Pe(m),y=Nn(m),y.callback=null,Dn(u,y,m),u=m,o.current.lanes=u,Ss(o,u),Pi(o),a[sa]=o.current,ih(a),new ac(o)},Al.version="19.2.4",Al}var Sv;function dA(){if(Sv)return _h.exports;Sv=1;function i(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(i)}catch(e){console.error(e)}}return i(),_h.exports=uA(),_h.exports}var hA=dA();var bv="popstate";function fA(i={}){function e(n,r){let{pathname:l="/",search:c="",hash:h=""}=wa(n.location.hash.substring(1));return!l.startsWith("/")&&!l.startsWith(".")&&(l="/"+l),cf("",{pathname:l,search:c,hash:h},r.state&&r.state.usr||null,r.state&&r.state.key||"default")}function t(n,r){let l=n.document.querySelector("base"),c="";if(l&&l.getAttribute("href")){let h=n.location.href,d=h.indexOf("#");c=d===-1?h:h.slice(0,d)}return c+"#"+(typeof r=="string"?r:Nl(r))}function s(n,r){Si(n.pathname.charAt(0)==="/",`relative pathnames are not supported in hash history.push(${JSON.stringify(r)})`)}return pA(e,t,s,i)}function Ft(i,e){if(i===!1||i===null||typeof i>"u")throw new Error(e)}function Si(i,e){if(!i){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function mA(){return Math.random().toString(36).substring(2,10)}function Ev(i,e){return{usr:i.state,key:i.key,idx:e}}function cf(i,e,t=null,s){return{pathname:typeof i=="string"?i:i.pathname,search:"",hash:"",...typeof e=="string"?wa(e):e,state:t,key:e&&e.key||s||mA()}}function Nl({pathname:i="/",search:e="",hash:t=""}){return e&&e!=="?"&&(i+=e.charAt(0)==="?"?e:"?"+e),t&&t!=="#"&&(i+=t.charAt(0)==="#"?t:"#"+t),i}function wa(i){let e={};if(i){let t=i.indexOf("#");t>=0&&(e.hash=i.substring(t),i=i.substring(0,t));let s=i.indexOf("?");s>=0&&(e.search=i.substring(s),i=i.substring(0,s)),i&&(e.pathname=i)}return e}function pA(i,e,t,s={}){let{window:n=document.defaultView,v5Compat:r=!1}=s,l=n.history,c="POP",h=null,d=f();d==null&&(d=0,l.replaceState({...l.state,idx:d},""));function f(){return(l.state||{idx:null}).idx}function p(){c="POP";let E=f(),A=E==null?null:E-d;d=E,h&&h({action:c,location:T.location,delta:A})}function v(E,A){c="PUSH";let _=cf(T.location,E,A);t&&t(_,E),d=f()+1;let R=Ev(_,d),w=T.createHref(_);try{l.pushState(R,"",w)}catch(N){if(N instanceof DOMException&&N.name==="DataCloneError")throw N;n.location.assign(w)}r&&h&&h({action:c,location:T.location,delta:1})}function x(E,A){c="REPLACE";let _=cf(T.location,E,A);t&&t(_,E),d=f();let R=Ev(_,d),w=T.createHref(_);l.replaceState(R,"",w),r&&h&&h({action:c,location:T.location,delta:0})}function S(E){return gA(E)}let T={get action(){return c},get location(){return i(n,l)},listen(E){if(h)throw new Error("A history only accepts one active listener");return n.addEventListener(bv,p),h=E,()=>{n.removeEventListener(bv,p),h=null}},createHref(E){return e(n,E)},createURL:S,encodeLocation(E){let A=S(E);return{pathname:A.pathname,search:A.search,hash:A.hash}},push:v,replace:x,go(E){return l.go(E)}};return T}function gA(i,e=!1){let t="http://localhost";typeof window<"u"&&(t=window.location.origin!=="null"?window.location.origin:window.location.href),Ft(t,"No window.location.(origin|href) available to create URL");let s=typeof i=="string"?i:Nl(i);return s=s.replace(/ $/,"%20"),!e&&s.startsWith("//")&&(s=t+s),new URL(s,t)}function Ex(i,e,t="/"){return vA(i,e,t,!1)}function vA(i,e,t,s){let n=typeof e=="string"?wa(e):e,r=bn(n.pathname||"/",t);if(r==null)return null;let l=Tx(i);yA(l);let c=null;for(let h=0;c==null&&h<l.length;++h){let d=wA(r);c=RA(l[h],d,s)}return c}function Tx(i,e=[],t=[],s="",n=!1){let r=(l,c,h=n,d)=>{let f={relativePath:d===void 0?l.path||"":d,caseSensitive:l.caseSensitive===!0,childrenIndex:c,route:l};if(f.relativePath.startsWith("/")){if(!f.relativePath.startsWith(s)&&h)return;Ft(f.relativePath.startsWith(s),`Absolute route path "${f.relativePath}" nested under path "${s}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),f.relativePath=f.relativePath.slice(s.length)}let p=Sn([s,f.relativePath]),v=t.concat(f);l.children&&l.children.length>0&&(Ft(l.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${p}".`),Tx(l.children,e,v,p,h)),!(l.path==null&&!l.index)&&e.push({path:p,score:_A(p,l.index),routesMeta:v})};return i.forEach((l,c)=>{if(l.path===""||!l.path?.includes("?"))r(l,c);else for(let h of Ax(l.path))r(l,c,!0,h)}),e}function Ax(i){let e=i.split("/");if(e.length===0)return[];let[t,...s]=e,n=t.endsWith("?"),r=t.replace(/\?$/,"");if(s.length===0)return n?[r,""]:[r];let l=Ax(s.join("/")),c=[];return c.push(...l.map(h=>h===""?r:[r,h].join("/"))),n&&c.push(...l),c.map(h=>i.startsWith("/")&&h===""?"/":h)}function yA(i){i.sort((e,t)=>e.score!==t.score?t.score-e.score:IA(e.routesMeta.map(s=>s.childrenIndex),t.routesMeta.map(s=>s.childrenIndex)))}var xA=/^:[\w-]+$/,SA=3,bA=2,EA=1,TA=10,AA=-2,Tv=i=>i==="*";function _A(i,e){let t=i.split("/"),s=t.length;return t.some(Tv)&&(s+=AA),e&&(s+=bA),t.filter(n=>!Tv(n)).reduce((n,r)=>n+(xA.test(r)?SA:r===""?EA:TA),s)}function IA(i,e){return i.length===e.length&&i.slice(0,-1).every((s,n)=>s===e[n])?i[i.length-1]-e[e.length-1]:0}function RA(i,e,t=!1){let{routesMeta:s}=i,n={},r="/",l=[];for(let c=0;c<s.length;++c){let h=s[c],d=c===s.length-1,f=r==="/"?e:e.slice(r.length)||"/",p=$c({path:h.relativePath,caseSensitive:h.caseSensitive,end:d},f),v=h.route;if(!p&&d&&t&&!s[s.length-1].route.index&&(p=$c({path:h.relativePath,caseSensitive:h.caseSensitive,end:!1},f)),!p)return null;Object.assign(n,p.params),l.push({params:n,pathname:Sn([r,p.pathname]),pathnameBase:DA(Sn([r,p.pathnameBase])),route:v}),p.pathnameBase!=="/"&&(r=Sn([r,p.pathnameBase]))}return l}function $c(i,e){typeof i=="string"&&(i={path:i,caseSensitive:!1,end:!0});let[t,s]=LA(i.path,i.caseSensitive,i.end),n=e.match(t);if(!n)return null;let r=n[0],l=r.replace(/(.)\/+$/,"$1"),c=n.slice(1);return{params:s.reduce((d,{paramName:f,isOptional:p},v)=>{if(f==="*"){let S=c[v]||"";l=r.slice(0,r.length-S.length).replace(/(.)\/+$/,"$1")}const x=c[v];return p&&!x?d[f]=void 0:d[f]=(x||"").replace(/%2F/g,"/"),d},{}),pathname:r,pathnameBase:l,pattern:i}}function LA(i,e=!1,t=!0){Si(i==="*"||!i.endsWith("*")||i.endsWith("/*"),`Route path "${i}" will be treated as if it were "${i.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${i.replace(/\*$/,"/*")}".`);let s=[],n="^"+i.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(l,c,h)=>(s.push({paramName:c,isOptional:h!=null}),h?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return i.endsWith("*")?(s.push({paramName:"*"}),n+=i==="*"||i==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?n+="\\/*$":i!==""&&i!=="/"&&(n+="(?:(?=\\/|$))"),[new RegExp(n,e?void 0:"i"),s]}function wA(i){try{return i.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return Si(!1,`The URL path "${i}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),i}}function bn(i,e){if(e==="/")return i;if(!i.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,s=i.charAt(t);return s&&s!=="/"?null:i.slice(t)||"/"}var CA=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i;function OA(i,e="/"){let{pathname:t,search:s="",hash:n=""}=typeof i=="string"?wa(i):i,r;return t?(t=t.replace(/\/\/+/g,"/"),t.startsWith("/")?r=Av(t.substring(1),"/"):r=Av(t,e)):r=e,{pathname:r,search:kA(s),hash:PA(n)}}function Av(i,e){let t=e.replace(/\/+$/,"").split("/");return i.split("/").forEach(n=>{n===".."?t.length>1&&t.pop():n!=="."&&t.push(n)}),t.length>1?t.join("/"):"/"}function wh(i,e,t,s){return`Cannot include a '${i}' character in a manually specified \`to.${e}\` field [${JSON.stringify(s)}].  Please separate it out to the \`to.${t}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function NA(i){return i.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function Mf(i){let e=NA(i);return e.map((t,s)=>s===e.length-1?t.pathname:t.pathnameBase)}function jf(i,e,t,s=!1){let n;typeof i=="string"?n=wa(i):(n={...i},Ft(!n.pathname||!n.pathname.includes("?"),wh("?","pathname","search",n)),Ft(!n.pathname||!n.pathname.includes("#"),wh("#","pathname","hash",n)),Ft(!n.search||!n.search.includes("#"),wh("#","search","hash",n)));let r=i===""||n.pathname==="",l=r?"/":n.pathname,c;if(l==null)c=t;else{let p=e.length-1;if(!s&&l.startsWith("..")){let v=l.split("/");for(;v[0]==="..";)v.shift(),p-=1;n.pathname=v.join("/")}c=p>=0?e[p]:"/"}let h=OA(n,c),d=l&&l!=="/"&&l.endsWith("/"),f=(r||l===".")&&t.endsWith("/");return!h.pathname.endsWith("/")&&(d||f)&&(h.pathname+="/"),h}var Sn=i=>i.join("/").replace(/\/\/+/g,"/"),DA=i=>i.replace(/\/+$/,"").replace(/^\/*/,"/"),kA=i=>!i||i==="?"?"":i.startsWith("?")?i:"?"+i,PA=i=>!i||i==="#"?"":i.startsWith("#")?i:"#"+i,UA=class{constructor(i,e,t,s=!1){this.status=i,this.statusText=e||"",this.internal=s,t instanceof Error?(this.data=t.toString(),this.error=t):this.data=t}};function MA(i){return i!=null&&typeof i.status=="number"&&typeof i.statusText=="string"&&typeof i.internal=="boolean"&&"data"in i}function jA(i){return i.map(e=>e.route.path).filter(Boolean).join("/").replace(/\/\/*/g,"/")||"/"}var _x=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function Ix(i,e){let t=i;if(typeof t!="string"||!CA.test(t))return{absoluteURL:void 0,isExternal:!1,to:t};let s=t,n=!1;if(_x)try{let r=new URL(window.location.href),l=t.startsWith("//")?new URL(r.protocol+t):new URL(t),c=bn(l.pathname,e);l.origin===r.origin&&c!=null?t=c+l.search+l.hash:n=!0}catch{Si(!1,`<Link to="${t}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}return{absoluteURL:s,isExternal:n,to:t}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var Rx=["POST","PUT","PATCH","DELETE"];new Set(Rx);var FA=["GET",...Rx];new Set(FA);var wr=C.createContext(null);wr.displayName="DataRouter";var iu=C.createContext(null);iu.displayName="DataRouterState";var BA=C.createContext(!1),Lx=C.createContext({isTransitioning:!1});Lx.displayName="ViewTransition";var $A=C.createContext(new Map);$A.displayName="Fetchers";var VA=C.createContext(null);VA.displayName="Await";var ai=C.createContext(null);ai.displayName="Navigation";var Bl=C.createContext(null);Bl.displayName="Location";var Ei=C.createContext({outlet:null,matches:[],isDataRoute:!1});Ei.displayName="Route";var Ff=C.createContext(null);Ff.displayName="RouteError";var wx="REACT_ROUTER_ERROR",GA="REDIRECT",HA="ROUTE_ERROR_RESPONSE";function zA(i){if(i.startsWith(`${wx}:${GA}:{`))try{let e=JSON.parse(i.slice(28));if(typeof e=="object"&&e&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.location=="string"&&typeof e.reloadDocument=="boolean"&&typeof e.replace=="boolean")return e}catch{}}function KA(i){if(i.startsWith(`${wx}:${HA}:{`))try{let e=JSON.parse(i.slice(40));if(typeof e=="object"&&e&&typeof e.status=="number"&&typeof e.statusText=="string")return new UA(e.status,e.statusText,e.data)}catch{}}function YA(i,{relative:e}={}){Ft(Cr(),"useHref() may be used only in the context of a <Router> component.");let{basename:t,navigator:s}=C.useContext(ai),{hash:n,pathname:r,search:l}=$l(i,{relative:e}),c=r;return t!=="/"&&(c=r==="/"?t:Sn([t,r])),s.createHref({pathname:c,search:l,hash:n})}function Cr(){return C.useContext(Bl)!=null}function En(){return Ft(Cr(),"useLocation() may be used only in the context of a <Router> component."),C.useContext(Bl).location}var Cx="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function Ox(i){C.useContext(ai).static||C.useLayoutEffect(i)}function As(){let{isDataRoute:i}=C.useContext(Ei);return i?o_():qA()}function qA(){Ft(Cr(),"useNavigate() may be used only in the context of a <Router> component.");let i=C.useContext(wr),{basename:e,navigator:t}=C.useContext(ai),{matches:s}=C.useContext(Ei),{pathname:n}=En(),r=JSON.stringify(Mf(s)),l=C.useRef(!1);return Ox(()=>{l.current=!0}),C.useCallback((h,d={})=>{if(Si(l.current,Cx),!l.current)return;if(typeof h=="number"){t.go(h);return}let f=jf(h,JSON.parse(r),n,d.relative==="path");i==null&&e!=="/"&&(f.pathname=f.pathname==="/"?e:Sn([e,f.pathname])),(d.replace?t.replace:t.push)(f,d.state,d)},[e,t,r,n,i])}var QA=C.createContext(null);function XA(i){let e=C.useContext(Ei).outlet;return C.useMemo(()=>e&&C.createElement(QA.Provider,{value:i},e),[e,i])}function nu(){let{matches:i}=C.useContext(Ei),e=i[i.length-1];return e?e.params:{}}function $l(i,{relative:e}={}){let{matches:t}=C.useContext(Ei),{pathname:s}=En(),n=JSON.stringify(Mf(t));return C.useMemo(()=>jf(i,JSON.parse(n),s,e==="path"),[i,n,s,e])}function WA(i,e){return Nx(i,e)}function Nx(i,e,t,s,n){Ft(Cr(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:r}=C.useContext(ai),{matches:l}=C.useContext(Ei),c=l[l.length-1],h=c?c.params:{},d=c?c.pathname:"/",f=c?c.pathnameBase:"/",p=c&&c.route;{let _=p&&p.path||"";kx(d,!p||_.endsWith("*")||_.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${d}" (under <Route path="${_}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${_}"> to <Route path="${_==="/"?"*":`${_}/*`}">.`)}let v=En(),x;if(e){let _=typeof e=="string"?wa(e):e;Ft(f==="/"||_.pathname?.startsWith(f),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${f}" but pathname "${_.pathname}" was given in the \`location\` prop.`),x=_}else x=v;let S=x.pathname||"/",T=S;if(f!=="/"){let _=f.replace(/^\//,"").split("/");T="/"+S.replace(/^\//,"").split("/").slice(_.length).join("/")}let E=Ex(i,{pathname:T});Si(p||E!=null,`No routes matched location "${x.pathname}${x.search}${x.hash}" `),Si(E==null||E[E.length-1].route.element!==void 0||E[E.length-1].route.Component!==void 0||E[E.length-1].route.lazy!==void 0,`Matched leaf route at location "${x.pathname}${x.search}${x.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let A=s_(E&&E.map(_=>Object.assign({},_,{params:Object.assign({},h,_.params),pathname:Sn([f,r.encodeLocation?r.encodeLocation(_.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:_.pathname]),pathnameBase:_.pathnameBase==="/"?f:Sn([f,r.encodeLocation?r.encodeLocation(_.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:_.pathnameBase])})),l,t,s,n);return e&&A?C.createElement(Bl.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...x},navigationType:"POP"}},A):A}function ZA(){let i=l_(),e=MA(i)?`${i.status} ${i.statusText}`:i instanceof Error?i.message:JSON.stringify(i),t=i instanceof Error?i.stack:null,s="rgba(200,200,200, 0.5)",n={padding:"0.5rem",backgroundColor:s},r={padding:"2px 4px",backgroundColor:s},l=null;return console.error("Error handled by React Router default ErrorBoundary:",i),l=C.createElement(C.Fragment,null,C.createElement("p",null," Hey developer "),C.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",C.createElement("code",{style:r},"ErrorBoundary")," or"," ",C.createElement("code",{style:r},"errorElement")," prop on your route.")),C.createElement(C.Fragment,null,C.createElement("h2",null,"Unexpected Application Error!"),C.createElement("h3",{style:{fontStyle:"italic"}},e),t?C.createElement("pre",{style:n},t):null,l)}var JA=C.createElement(ZA,null),Dx=class extends C.Component{constructor(i){super(i),this.state={location:i.location,revalidation:i.revalidation,error:i.error}}static getDerivedStateFromError(i){return{error:i}}static getDerivedStateFromProps(i,e){return e.location!==i.location||e.revalidation!=="idle"&&i.revalidation==="idle"?{error:i.error,location:i.location,revalidation:i.revalidation}:{error:i.error!==void 0?i.error:e.error,location:e.location,revalidation:i.revalidation||e.revalidation}}componentDidCatch(i,e){this.props.onError?this.props.onError(i,e):console.error("React Router caught the following error during render",i)}render(){let i=this.state.error;if(this.context&&typeof i=="object"&&i&&"digest"in i&&typeof i.digest=="string"){const t=KA(i.digest);t&&(i=t)}let e=i!==void 0?C.createElement(Ei.Provider,{value:this.props.routeContext},C.createElement(Ff.Provider,{value:i,children:this.props.component})):this.props.children;return this.context?C.createElement(e_,{error:i},e):e}};Dx.contextType=BA;var Ch=new WeakMap;function e_({children:i,error:e}){let{basename:t}=C.useContext(ai);if(typeof e=="object"&&e&&"digest"in e&&typeof e.digest=="string"){let s=zA(e.digest);if(s){let n=Ch.get(e);if(n)throw n;let r=Ix(s.location,t);if(_x&&!Ch.get(e))if(r.isExternal||s.reloadDocument)window.location.href=r.absoluteURL||r.to;else{const l=Promise.resolve().then(()=>window.__reactRouterDataRouter.navigate(r.to,{replace:s.replace}));throw Ch.set(e,l),l}return C.createElement("meta",{httpEquiv:"refresh",content:`0;url=${r.absoluteURL||r.to}`})}}return i}function t_({routeContext:i,match:e,children:t}){let s=C.useContext(wr);return s&&s.static&&s.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(s.staticContext._deepestRenderedBoundaryId=e.route.id),C.createElement(Ei.Provider,{value:i},t)}function s_(i,e=[],t=null,s=null,n=null){if(i==null){if(!t)return null;if(t.errors)i=t.matches;else if(e.length===0&&!t.initialized&&t.matches.length>0)i=t.matches;else return null}let r=i,l=t?.errors;if(l!=null){let f=r.findIndex(p=>p.route.id&&l?.[p.route.id]!==void 0);Ft(f>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(l).join(",")}`),r=r.slice(0,Math.min(r.length,f+1))}let c=!1,h=-1;if(t)for(let f=0;f<r.length;f++){let p=r[f];if((p.route.HydrateFallback||p.route.hydrateFallbackElement)&&(h=f),p.route.id){let{loaderData:v,errors:x}=t,S=p.route.loader&&!v.hasOwnProperty(p.route.id)&&(!x||x[p.route.id]===void 0);if(p.route.lazy||S){c=!0,h>=0?r=r.slice(0,h+1):r=[r[0]];break}}}let d=t&&s?(f,p)=>{s(f,{location:t.location,params:t.matches?.[0]?.params??{},unstable_pattern:jA(t.matches),errorInfo:p})}:void 0;return r.reduceRight((f,p,v)=>{let x,S=!1,T=null,E=null;t&&(x=l&&p.route.id?l[p.route.id]:void 0,T=p.route.errorElement||JA,c&&(h<0&&v===0?(kx("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),S=!0,E=null):h===v&&(S=!0,E=p.route.hydrateFallbackElement||null)));let A=e.concat(r.slice(0,v+1)),_=()=>{let R;return x?R=T:S?R=E:p.route.Component?R=C.createElement(p.route.Component,null):p.route.element?R=p.route.element:R=f,C.createElement(t_,{match:p,routeContext:{outlet:f,matches:A,isDataRoute:t!=null},children:R})};return t&&(p.route.ErrorBoundary||p.route.errorElement||v===0)?C.createElement(Dx,{location:t.location,revalidation:t.revalidation,component:T,error:x,children:_(),routeContext:{outlet:null,matches:A,isDataRoute:!0},onError:d}):_()},null)}function Bf(i){return`${i} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function i_(i){let e=C.useContext(wr);return Ft(e,Bf(i)),e}function n_(i){let e=C.useContext(iu);return Ft(e,Bf(i)),e}function a_(i){let e=C.useContext(Ei);return Ft(e,Bf(i)),e}function $f(i){let e=a_(i),t=e.matches[e.matches.length-1];return Ft(t.route.id,`${i} can only be used on routes that contain a unique "id"`),t.route.id}function r_(){return $f("useRouteId")}function l_(){let i=C.useContext(Ff),e=n_("useRouteError"),t=$f("useRouteError");return i!==void 0?i:e.errors?.[t]}function o_(){let{router:i}=i_("useNavigate"),e=$f("useNavigate"),t=C.useRef(!1);return Ox(()=>{t.current=!0}),C.useCallback(async(n,r={})=>{Si(t.current,Cx),t.current&&(typeof n=="number"?await i.navigate(n):await i.navigate(n,{fromRouteId:e,...r}))},[i,e])}var _v={};function kx(i,e,t){!e&&!_v[i]&&(_v[i]=!0,Si(!1,t))}C.memo(c_);function c_({routes:i,future:e,state:t,onError:s}){return Nx(i,void 0,t,s,e)}function u_({to:i,replace:e,state:t,relative:s}){Ft(Cr(),"<Navigate> may be used only in the context of a <Router> component.");let{static:n}=C.useContext(ai);Si(!n,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:r}=C.useContext(Ei),{pathname:l}=En(),c=As(),h=jf(i,Mf(r),l,s==="path"),d=JSON.stringify(h);return C.useEffect(()=>{c(JSON.parse(d),{replace:e,state:t,relative:s})},[c,d,s,e,t]),null}function d_(i){return XA(i.context)}function xi(i){Ft(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function h_({basename:i="/",children:e=null,location:t,navigationType:s="POP",navigator:n,static:r=!1,unstable_useTransitions:l}){Ft(!Cr(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let c=i.replace(/^\/*/,"/"),h=C.useMemo(()=>({basename:c,navigator:n,static:r,unstable_useTransitions:l,future:{}}),[c,n,r,l]);typeof t=="string"&&(t=wa(t));let{pathname:d="/",search:f="",hash:p="",state:v=null,key:x="default"}=t,S=C.useMemo(()=>{let T=bn(d,c);return T==null?null:{location:{pathname:T,search:f,hash:p,state:v,key:x},navigationType:s}},[c,d,f,p,v,x,s]);return Si(S!=null,`<Router basename="${c}"> is not able to match the URL "${d}${f}${p}" because it does not start with the basename, so the <Router> won't render anything.`),S==null?null:C.createElement(ai.Provider,{value:h},C.createElement(Bl.Provider,{children:e,value:S}))}function f_({children:i,location:e}){return WA(uf(i),e)}function uf(i,e=[]){let t=[];return C.Children.forEach(i,(s,n)=>{if(!C.isValidElement(s))return;let r=[...e,n];if(s.type===C.Fragment){t.push.apply(t,uf(s.props.children,r));return}Ft(s.type===xi,`[${typeof s.type=="string"?s.type:s.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),Ft(!s.props.index||!s.props.children,"An index route cannot have child routes.");let l={id:s.props.id||r.join("-"),caseSensitive:s.props.caseSensitive,element:s.props.element,Component:s.props.Component,index:s.props.index,path:s.props.path,middleware:s.props.middleware,loader:s.props.loader,action:s.props.action,hydrateFallbackElement:s.props.hydrateFallbackElement,HydrateFallback:s.props.HydrateFallback,errorElement:s.props.errorElement,ErrorBoundary:s.props.ErrorBoundary,hasErrorBoundary:s.props.hasErrorBoundary===!0||s.props.ErrorBoundary!=null||s.props.errorElement!=null,shouldRevalidate:s.props.shouldRevalidate,handle:s.props.handle,lazy:s.props.lazy};s.props.children&&(l.children=uf(s.props.children,r)),t.push(l)}),t}var Lc="get",wc="application/x-www-form-urlencoded";function au(i){return typeof HTMLElement<"u"&&i instanceof HTMLElement}function m_(i){return au(i)&&i.tagName.toLowerCase()==="button"}function p_(i){return au(i)&&i.tagName.toLowerCase()==="form"}function g_(i){return au(i)&&i.tagName.toLowerCase()==="input"}function v_(i){return!!(i.metaKey||i.altKey||i.ctrlKey||i.shiftKey)}function y_(i,e){return i.button===0&&(!e||e==="_self")&&!v_(i)}var lc=null;function x_(){if(lc===null)try{new FormData(document.createElement("form"),0),lc=!1}catch{lc=!0}return lc}var S_=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function Oh(i){return i!=null&&!S_.has(i)?(Si(!1,`"${i}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${wc}"`),null):i}function b_(i,e){let t,s,n,r,l;if(p_(i)){let c=i.getAttribute("action");s=c?bn(c,e):null,t=i.getAttribute("method")||Lc,n=Oh(i.getAttribute("enctype"))||wc,r=new FormData(i)}else if(m_(i)||g_(i)&&(i.type==="submit"||i.type==="image")){let c=i.form;if(c==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let h=i.getAttribute("formaction")||c.getAttribute("action");if(s=h?bn(h,e):null,t=i.getAttribute("formmethod")||c.getAttribute("method")||Lc,n=Oh(i.getAttribute("formenctype"))||Oh(c.getAttribute("enctype"))||wc,r=new FormData(c,i),!x_()){let{name:d,type:f,value:p}=i;if(f==="image"){let v=d?`${d}.`:"";r.append(`${v}x`,"0"),r.append(`${v}y`,"0")}else d&&r.append(d,p)}}else{if(au(i))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');t=Lc,s=null,n=wc,l=i}return r&&n==="text/plain"&&(l=r,r=void 0),{action:s,method:t.toLowerCase(),encType:n,formData:r,body:l}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function Vf(i,e){if(i===!1||i===null||typeof i>"u")throw new Error(e)}function E_(i,e,t,s){let n=typeof i=="string"?new URL(i,typeof window>"u"?"server://singlefetch/":window.location.origin):i;return t?n.pathname.endsWith("/")?n.pathname=`${n.pathname}_.${s}`:n.pathname=`${n.pathname}.${s}`:n.pathname==="/"?n.pathname=`_root.${s}`:e&&bn(n.pathname,e)==="/"?n.pathname=`${e.replace(/\/$/,"")}/_root.${s}`:n.pathname=`${n.pathname.replace(/\/$/,"")}.${s}`,n}async function T_(i,e){if(i.id in e)return e[i.id];try{let t=await import(i.module);return e[i.id]=t,t}catch(t){return console.error(`Error loading route module \`${i.module}\`, reloading page...`),console.error(t),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function A_(i){return i==null?!1:i.href==null?i.rel==="preload"&&typeof i.imageSrcSet=="string"&&typeof i.imageSizes=="string":typeof i.rel=="string"&&typeof i.href=="string"}async function __(i,e,t){let s=await Promise.all(i.map(async n=>{let r=e.routes[n.route.id];if(r){let l=await T_(r,t);return l.links?l.links():[]}return[]}));return w_(s.flat(1).filter(A_).filter(n=>n.rel==="stylesheet"||n.rel==="preload").map(n=>n.rel==="stylesheet"?{...n,rel:"prefetch",as:"style"}:{...n,rel:"prefetch"}))}function Iv(i,e,t,s,n,r){let l=(h,d)=>t[d]?h.route.id!==t[d].route.id:!0,c=(h,d)=>t[d].pathname!==h.pathname||t[d].route.path?.endsWith("*")&&t[d].params["*"]!==h.params["*"];return r==="assets"?e.filter((h,d)=>l(h,d)||c(h,d)):r==="data"?e.filter((h,d)=>{let f=s.routes[h.route.id];if(!f||!f.hasLoader)return!1;if(l(h,d)||c(h,d))return!0;if(h.route.shouldRevalidate){let p=h.route.shouldRevalidate({currentUrl:new URL(n.pathname+n.search+n.hash,window.origin),currentParams:t[0]?.params||{},nextUrl:new URL(i,window.origin),nextParams:h.params,defaultShouldRevalidate:!0});if(typeof p=="boolean")return p}return!0}):[]}function I_(i,e,{includeHydrateFallback:t}={}){return R_(i.map(s=>{let n=e.routes[s.route.id];if(!n)return[];let r=[n.module];return n.clientActionModule&&(r=r.concat(n.clientActionModule)),n.clientLoaderModule&&(r=r.concat(n.clientLoaderModule)),t&&n.hydrateFallbackModule&&(r=r.concat(n.hydrateFallbackModule)),n.imports&&(r=r.concat(n.imports)),r}).flat(1))}function R_(i){return[...new Set(i)]}function L_(i){let e={},t=Object.keys(i).sort();for(let s of t)e[s]=i[s];return e}function w_(i,e){let t=new Set;return new Set(e),i.reduce((s,n)=>{let r=JSON.stringify(L_(n));return t.has(r)||(t.add(r),s.push({key:r,link:n})),s},[])}function Px(){let i=C.useContext(wr);return Vf(i,"You must render this element inside a <DataRouterContext.Provider> element"),i}function C_(){let i=C.useContext(iu);return Vf(i,"You must render this element inside a <DataRouterStateContext.Provider> element"),i}var Gf=C.createContext(void 0);Gf.displayName="FrameworkContext";function Ux(){let i=C.useContext(Gf);return Vf(i,"You must render this element inside a <HydratedRouter> element"),i}function O_(i,e){let t=C.useContext(Gf),[s,n]=C.useState(!1),[r,l]=C.useState(!1),{onFocus:c,onBlur:h,onMouseEnter:d,onMouseLeave:f,onTouchStart:p}=e,v=C.useRef(null);C.useEffect(()=>{if(i==="render"&&l(!0),i==="viewport"){let T=A=>{A.forEach(_=>{l(_.isIntersecting)})},E=new IntersectionObserver(T,{threshold:.5});return v.current&&E.observe(v.current),()=>{E.disconnect()}}},[i]),C.useEffect(()=>{if(s){let T=setTimeout(()=>{l(!0)},100);return()=>{clearTimeout(T)}}},[s]);let x=()=>{n(!0)},S=()=>{n(!1),l(!1)};return t?i!=="intent"?[r,v,{}]:[r,v,{onFocus:_l(c,x),onBlur:_l(h,S),onMouseEnter:_l(d,x),onMouseLeave:_l(f,S),onTouchStart:_l(p,x)}]:[!1,v,{}]}function _l(i,e){return t=>{i&&i(t),t.defaultPrevented||e(t)}}function N_({page:i,...e}){let{router:t}=Px(),s=C.useMemo(()=>Ex(t.routes,i,t.basename),[t.routes,i,t.basename]);return s?C.createElement(k_,{page:i,matches:s,...e}):null}function D_(i){let{manifest:e,routeModules:t}=Ux(),[s,n]=C.useState([]);return C.useEffect(()=>{let r=!1;return __(i,e,t).then(l=>{r||n(l)}),()=>{r=!0}},[i,e,t]),s}function k_({page:i,matches:e,...t}){let s=En(),{future:n,manifest:r,routeModules:l}=Ux(),{basename:c}=Px(),{loaderData:h,matches:d}=C_(),f=C.useMemo(()=>Iv(i,e,d,r,s,"data"),[i,e,d,r,s]),p=C.useMemo(()=>Iv(i,e,d,r,s,"assets"),[i,e,d,r,s]),v=C.useMemo(()=>{if(i===s.pathname+s.search+s.hash)return[];let T=new Set,E=!1;if(e.forEach(_=>{let R=r.routes[_.route.id];!R||!R.hasLoader||(!f.some(w=>w.route.id===_.route.id)&&_.route.id in h&&l[_.route.id]?.shouldRevalidate||R.hasClientLoader?E=!0:T.add(_.route.id))}),T.size===0)return[];let A=E_(i,c,n.unstable_trailingSlashAwareDataRequests,"data");return E&&T.size>0&&A.searchParams.set("_routes",e.filter(_=>T.has(_.route.id)).map(_=>_.route.id).join(",")),[A.pathname+A.search]},[c,n.unstable_trailingSlashAwareDataRequests,h,s,r,f,e,i,l]),x=C.useMemo(()=>I_(p,r),[p,r]),S=D_(p);return C.createElement(C.Fragment,null,v.map(T=>C.createElement("link",{key:T,rel:"prefetch",as:"fetch",href:T,...t})),x.map(T=>C.createElement("link",{key:T,rel:"modulepreload",href:T,...t})),S.map(({key:T,link:E})=>C.createElement("link",{key:T,nonce:t.nonce,...E,crossOrigin:E.crossOrigin??t.crossOrigin})))}function P_(...i){return e=>{i.forEach(t=>{typeof t=="function"?t(e):t!=null&&(t.current=e)})}}var U_=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{U_&&(window.__reactRouterVersion="7.13.0")}catch{}function M_({basename:i,children:e,unstable_useTransitions:t,window:s}){let n=C.useRef();n.current==null&&(n.current=fA({window:s,v5Compat:!0}));let r=n.current,[l,c]=C.useState({action:r.action,location:r.location}),h=C.useCallback(d=>{t===!1?c(d):C.startTransition(()=>c(d))},[t]);return C.useLayoutEffect(()=>r.listen(h),[r,h]),C.createElement(h_,{basename:i,children:e,location:l.location,navigationType:l.action,navigator:r,unstable_useTransitions:t})}var Mx=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,_r=C.forwardRef(function({onClick:e,discover:t="render",prefetch:s="none",relative:n,reloadDocument:r,replace:l,state:c,target:h,to:d,preventScrollReset:f,viewTransition:p,unstable_defaultShouldRevalidate:v,...x},S){let{basename:T,unstable_useTransitions:E}=C.useContext(ai),A=typeof d=="string"&&Mx.test(d),_=Ix(d,T);d=_.to;let R=YA(d,{relative:n}),[w,N,U]=O_(s,x),D=$_(d,{replace:l,state:c,target:h,preventScrollReset:f,relative:n,viewTransition:p,unstable_defaultShouldRevalidate:v,unstable_useTransitions:E});function F(M){e&&e(M),M.defaultPrevented||D(M)}let j=C.createElement("a",{...x,...U,href:_.absoluteURL||R,onClick:_.isExternal||r?e:F,ref:P_(S,N),target:h,"data-discover":!A&&t==="render"?"true":void 0});return w&&!A?C.createElement(C.Fragment,null,j,C.createElement(N_,{page:R})):j});_r.displayName="Link";var j_=C.forwardRef(function({"aria-current":e="page",caseSensitive:t=!1,className:s="",end:n=!1,style:r,to:l,viewTransition:c,children:h,...d},f){let p=$l(l,{relative:d.relative}),v=En(),x=C.useContext(iu),{navigator:S,basename:T}=C.useContext(ai),E=x!=null&&K_(p)&&c===!0,A=S.encodeLocation?S.encodeLocation(p).pathname:p.pathname,_=v.pathname,R=x&&x.navigation&&x.navigation.location?x.navigation.location.pathname:null;t||(_=_.toLowerCase(),R=R?R.toLowerCase():null,A=A.toLowerCase()),R&&T&&(R=bn(R,T)||R);const w=A!=="/"&&A.endsWith("/")?A.length-1:A.length;let N=_===A||!n&&_.startsWith(A)&&_.charAt(w)==="/",U=R!=null&&(R===A||!n&&R.startsWith(A)&&R.charAt(A.length)==="/"),D={isActive:N,isPending:U,isTransitioning:E},F=N?e:void 0,j;typeof s=="function"?j=s(D):j=[s,N?"active":null,U?"pending":null,E?"transitioning":null].filter(Boolean).join(" ");let M=typeof r=="function"?r(D):r;return C.createElement(_r,{...d,"aria-current":F,className:j,ref:f,style:M,to:l,viewTransition:c},typeof h=="function"?h(D):h)});j_.displayName="NavLink";var F_=C.forwardRef(({discover:i="render",fetcherKey:e,navigate:t,reloadDocument:s,replace:n,state:r,method:l=Lc,action:c,onSubmit:h,relative:d,preventScrollReset:f,viewTransition:p,unstable_defaultShouldRevalidate:v,...x},S)=>{let{unstable_useTransitions:T}=C.useContext(ai),E=H_(),A=z_(c,{relative:d}),_=l.toLowerCase()==="get"?"get":"post",R=typeof c=="string"&&Mx.test(c),w=N=>{if(h&&h(N),N.defaultPrevented)return;N.preventDefault();let U=N.nativeEvent.submitter,D=U?.getAttribute("formmethod")||l,F=()=>E(U||N.currentTarget,{fetcherKey:e,method:D,navigate:t,replace:n,state:r,relative:d,preventScrollReset:f,viewTransition:p,unstable_defaultShouldRevalidate:v});T&&t!==!1?C.startTransition(()=>F()):F()};return C.createElement("form",{ref:S,method:_,action:A,onSubmit:s?h:w,...x,"data-discover":!R&&i==="render"?"true":void 0})});F_.displayName="Form";function B_(i){return`${i} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function jx(i){let e=C.useContext(wr);return Ft(e,B_(i)),e}function $_(i,{target:e,replace:t,state:s,preventScrollReset:n,relative:r,viewTransition:l,unstable_defaultShouldRevalidate:c,unstable_useTransitions:h}={}){let d=As(),f=En(),p=$l(i,{relative:r});return C.useCallback(v=>{if(y_(v,e)){v.preventDefault();let x=t!==void 0?t:Nl(f)===Nl(p),S=()=>d(i,{replace:x,state:s,preventScrollReset:n,relative:r,viewTransition:l,unstable_defaultShouldRevalidate:c});h?C.startTransition(()=>S()):S()}},[f,d,p,t,s,e,i,n,r,l,c,h])}var V_=0,G_=()=>`__${String(++V_)}__`;function H_(){let{router:i}=jx("useSubmit"),{basename:e}=C.useContext(ai),t=r_(),s=i.fetch,n=i.navigate;return C.useCallback(async(r,l={})=>{let{action:c,method:h,encType:d,formData:f,body:p}=b_(r,e);if(l.navigate===!1){let v=l.fetcherKey||G_();await s(v,t,l.action||c,{unstable_defaultShouldRevalidate:l.unstable_defaultShouldRevalidate,preventScrollReset:l.preventScrollReset,formData:f,body:p,formMethod:l.method||h,formEncType:l.encType||d,flushSync:l.flushSync})}else await n(l.action||c,{unstable_defaultShouldRevalidate:l.unstable_defaultShouldRevalidate,preventScrollReset:l.preventScrollReset,formData:f,body:p,formMethod:l.method||h,formEncType:l.encType||d,replace:l.replace,state:l.state,fromRouteId:t,flushSync:l.flushSync,viewTransition:l.viewTransition})},[s,n,e,t])}function z_(i,{relative:e}={}){let{basename:t}=C.useContext(ai),s=C.useContext(Ei);Ft(s,"useFormAction must be used inside a RouteContext");let[n]=s.matches.slice(-1),r={...$l(i||".",{relative:e})},l=En();if(i==null){r.search=l.search;let c=new URLSearchParams(r.search),h=c.getAll("index");if(h.some(f=>f==="")){c.delete("index"),h.filter(p=>p).forEach(p=>c.append("index",p));let f=c.toString();r.search=f?`?${f}`:""}}return(!i||i===".")&&n.route.index&&(r.search=r.search?r.search.replace(/^\?/,"?index&"):"?index"),t!=="/"&&(r.pathname=r.pathname==="/"?t:Sn([t,r.pathname])),Nl(r)}function K_(i,{relative:e}={}){let t=C.useContext(Lx);Ft(t!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:s}=jx("useViewTransitionState"),n=$l(i,{relative:e});if(!t.isTransitioning)return!1;let r=bn(t.currentLocation.pathname,s)||t.currentLocation.pathname,l=bn(t.nextLocation.pathname,s)||t.nextLocation.pathname;return $c(n.pathname,l)!=null||$c(n.pathname,r)!=null}var Y_=bx();const Fx=C.createContext(),q_={"#ff7e00":"https://raw.githubusercontent.com/gorillasuti/Legitflix-plugin/refs/heads/main/legitflix-client/public/default-logo-orange.png","#00aaff":"https://raw.githubusercontent.com/gorillasuti/Legitflix-plugin/refs/heads/main/legitflix-client/public/default-logo-blue.png","#00ff7e":"https://raw.githubusercontent.com/gorillasuti/Legitflix-plugin/refs/heads/main/legitflix-client/public/default-logo-green.png","#ff3333":"https://raw.githubusercontent.com/gorillasuti/Legitflix-plugin/refs/heads/main/legitflix-client/public/default-logo-red.png","#aa00ff":"https://raw.githubusercontent.com/gorillasuti/Legitflix-plugin/refs/heads/main/legitflix-client/public/default-logo-purple.png","#ff00aa":"https://raw.githubusercontent.com/gorillasuti/Legitflix-plugin/refs/heads/main/legitflix-client/public/default-logo-purple.png"},Vl=i=>q_[i?.toLowerCase()]||"https://raw.githubusercontent.com/gorillasuti/Legitflix-plugin/refs/heads/main/legitflix-client/public/default-logo-orange.png",Yi=()=>C.useContext(Fx),Q_=({children:i})=>{const[e,t]=C.useState({heroMediaTypes:"Movie,Series",promoMediaTypes:["Movie","Series"],contentTypeFilters:{Movie:!0,Series:!0,MusicAlbum:!1,Audio:!1,MusicVideo:!1},contentSortMode:"latest",heroLimit:20,enableJellyseerr:!0,jellyseerrUrl:"https://request.legitflix.eu",jellyseerrBackground:null,jellyseerrText:"Request Feature",logoType:"text",logoUrl:"",appName:"LegitFlix",enableBackdrops:!0,accentColor:"#ff7e00",showNavbarCategories:!0,showNavbarRequests:!0,showLibraryTitles:!0,appBackground:null});C.useEffect(()=>{const l=localStorage.getItem("LegitFlix_Config");if(l)try{const c=JSON.parse(l);t(h=>({...h,...c})),c.accentColor&&s(c.accentColor),c.faviconUrl&&n(c.faviconUrl)}catch(c){console.error("Failed to parse local config",c)}else s(e.accentColor)},[]);const s=l=>{document.documentElement.style.setProperty("--clr-accent",l);const c=parseInt(l.slice(1,3),16),h=parseInt(l.slice(3,5),16),d=parseInt(l.slice(5,7),16);document.documentElement.style.setProperty("--clr-accent-glow",`rgba(${c}, ${h}, ${d}, 0.5)`)},n=l=>{let c=document.querySelector("link[rel~='icon']");c||(c=document.createElement("link"),c.rel="icon",document.head.appendChild(c)),c.href=l||"/favicon.jpg"},r=l=>{t(c=>{const h={...c,...l};return localStorage.setItem("LegitFlix_Config",JSON.stringify(h)),l.accentColor&&s(l.accentColor),l.faviconUrl!==void 0&&n(l.faviconUrl),h})};return g.jsx(Fx.Provider,{value:{config:e,updateConfig:r},children:i})};var Bs;(function(i){i[i.GREAT=2]="GREAT",i[i.GOOD=1]="GOOD",i[i.OK=0]="OK",i[i.BAD=-1]="BAD"})(Bs||(Bs={}));const Vc="http:",Gc="https:",X_=80,W_=443;function Z_(i){if(i=i.trim(),/^data:/i.test(i))throw new Error("data URLs are not supported");if(/^view-source:/i.test(i))throw new Error("`view-source:` is not supported as it is a non-standard protocol");if(!i.startsWith("//")&&/^\.*\//.test(i)||(i=i.replace(/^(?!(?:\w+:)?\/\/)|^\/\//,Vc)),!/^https?:/i.test(i))throw new Error("only http or https protocols are supported");const s=new URL(i);if(s.hash="",s.pathname){const n=/\b[a-z][a-z\d+\-.]{1,50}:\/\//g;let r=0,l="";for(;;){const h=n.exec(s.pathname);if(!h)break;const d=h[0],f=h.index,p=s.pathname.slice(r,f);l+=p.replace(/\/{2,}/g,"/"),l+=d,r=f+d.length}const c=s.pathname.slice(r,s.pathname.length);l+=c.replace(/\/{2,}/g,"/"),s.pathname=l}if(s.pathname)try{s.pathname=decodeURI(s.pathname)}catch{}return s.hostname&&(s.hostname=s.hostname.replace(/\.$/,"")),s.search="",s.pathname=s.pathname.replace(/\/$/,""),i=s.toString(),i}function oc(i){return new URL(i.toString())}function Bx(i){if(i===Vc)return X_;if(i===Gc)return W_;throw new Error("Unsupported protocol")}function J_(i,e){const t=e.port||Bx(e.protocol);return i.toLowerCase().startsWith(`${e.protocol}//${e.hostname.toLowerCase()}:${t}`)}function $x(i){return!i.port||i.port===Bx(i.protocol).toString()}function eI(i){if(!i?.trim())throw new Error("Input is required");return new URL(Z_(i))}const df=8096,Vx=8920;function Rv(i){let e=0;return i.protocol===Gc?e+=5:e-=5,i.port===df.toString()?e+=2:i.port===Vx.toString()&&(e-=1),$x(i)&&(e+=3),e}function tI(i){const e=[];try{const t=eI(i);if(J_(i,t))return[t.toString()];if(e.push(t),t.protocol===Vc){const s=oc(t);s.protocol=Gc,e.push(s)}return e.filter($x).forEach(s=>{if(s.protocol===Vc){const n=oc(s);n.port=df.toString(),e.push(n)}else if(s.protocol===Gc){let n=oc(s);n.port=df.toString(),e.push(n),n=oc(s),n.port=Vx.toString(),e.push(n)}}),e.sort((s,n)=>Rv(n)-Rv(s)),e.map(s=>s.toString())}catch(t){return console.warn(t),[]}}class Or{}class sI extends Or{constructor(e){super(),this.productName=e}}class iI extends Or{constructor(e){super(),this.responseTime=e}}class nI extends Or{constructor(e){super(),this.error=e}}class Lv extends Or{}class aI extends Or{constructor(e){super(),this.version=e}}class rI extends Or{constructor(e){super(),this.version=e}}function Gx(i,e){return function(){return i.apply(e,arguments)}}const{toString:lI}=Object.prototype,{getPrototypeOf:Hf}=Object,{iterator:ru,toStringTag:Hx}=Symbol,lu=(i=>e=>{const t=lI.call(e);return i[t]||(i[t]=t.slice(8,-1).toLowerCase())})(Object.create(null)),Oi=i=>(i=i.toLowerCase(),e=>lu(e)===i),ou=i=>e=>typeof e===i,{isArray:Nr}=Array,Ir=ou("undefined");function Gl(i){return i!==null&&!Ir(i)&&i.constructor!==null&&!Ir(i.constructor)&&Vs(i.constructor.isBuffer)&&i.constructor.isBuffer(i)}const zx=Oi("ArrayBuffer");function oI(i){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(i):e=i&&i.buffer&&zx(i.buffer),e}const cI=ou("string"),Vs=ou("function"),Kx=ou("number"),Hl=i=>i!==null&&typeof i=="object",uI=i=>i===!0||i===!1,Cc=i=>{if(lu(i)!=="object")return!1;const e=Hf(i);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Hx in i)&&!(ru in i)},dI=i=>{if(!Hl(i)||Gl(i))return!1;try{return Object.keys(i).length===0&&Object.getPrototypeOf(i)===Object.prototype}catch{return!1}},hI=Oi("Date"),fI=Oi("File"),mI=Oi("Blob"),pI=Oi("FileList"),gI=i=>Hl(i)&&Vs(i.pipe),vI=i=>{let e;return i&&(typeof FormData=="function"&&i instanceof FormData||Vs(i.append)&&((e=lu(i))==="formdata"||e==="object"&&Vs(i.toString)&&i.toString()==="[object FormData]"))},yI=Oi("URLSearchParams"),[xI,SI,bI,EI]=["ReadableStream","Request","Response","Headers"].map(Oi),TI=i=>i.trim?i.trim():i.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function zl(i,e,{allOwnKeys:t=!1}={}){if(i===null||typeof i>"u")return;let s,n;if(typeof i!="object"&&(i=[i]),Nr(i))for(s=0,n=i.length;s<n;s++)e.call(null,i[s],s,i);else{if(Gl(i))return;const r=t?Object.getOwnPropertyNames(i):Object.keys(i),l=r.length;let c;for(s=0;s<l;s++)c=r[s],e.call(null,i[c],c,i)}}function Yx(i,e){if(Gl(i))return null;e=e.toLowerCase();const t=Object.keys(i);let s=t.length,n;for(;s-- >0;)if(n=t[s],e===n.toLowerCase())return n;return null}const Ta=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,qx=i=>!Ir(i)&&i!==Ta;function hf(){const{caseless:i,skipUndefined:e}=qx(this)&&this||{},t={},s=(n,r)=>{if(r==="__proto__"||r==="constructor"||r==="prototype")return;const l=i&&Yx(t,r)||r;Cc(t[l])&&Cc(n)?t[l]=hf(t[l],n):Cc(n)?t[l]=hf({},n):Nr(n)?t[l]=n.slice():(!e||!Ir(n))&&(t[l]=n)};for(let n=0,r=arguments.length;n<r;n++)arguments[n]&&zl(arguments[n],s);return t}const AI=(i,e,t,{allOwnKeys:s}={})=>(zl(e,(n,r)=>{t&&Vs(n)?Object.defineProperty(i,r,{value:Gx(n,t),writable:!0,enumerable:!0,configurable:!0}):Object.defineProperty(i,r,{value:n,writable:!0,enumerable:!0,configurable:!0})},{allOwnKeys:s}),i),_I=i=>(i.charCodeAt(0)===65279&&(i=i.slice(1)),i),II=(i,e,t,s)=>{i.prototype=Object.create(e.prototype,s),Object.defineProperty(i.prototype,"constructor",{value:i,writable:!0,enumerable:!1,configurable:!0}),Object.defineProperty(i,"super",{value:e.prototype}),t&&Object.assign(i.prototype,t)},RI=(i,e,t,s)=>{let n,r,l;const c={};if(e=e||{},i==null)return e;do{for(n=Object.getOwnPropertyNames(i),r=n.length;r-- >0;)l=n[r],(!s||s(l,i,e))&&!c[l]&&(e[l]=i[l],c[l]=!0);i=t!==!1&&Hf(i)}while(i&&(!t||t(i,e))&&i!==Object.prototype);return e},LI=(i,e,t)=>{i=String(i),(t===void 0||t>i.length)&&(t=i.length),t-=e.length;const s=i.indexOf(e,t);return s!==-1&&s===t},wI=i=>{if(!i)return null;if(Nr(i))return i;let e=i.length;if(!Kx(e))return null;const t=new Array(e);for(;e-- >0;)t[e]=i[e];return t},CI=(i=>e=>i&&e instanceof i)(typeof Uint8Array<"u"&&Hf(Uint8Array)),OI=(i,e)=>{const s=(i&&i[ru]).call(i);let n;for(;(n=s.next())&&!n.done;){const r=n.value;e.call(i,r[0],r[1])}},NI=(i,e)=>{let t;const s=[];for(;(t=i.exec(e))!==null;)s.push(t);return s},DI=Oi("HTMLFormElement"),kI=i=>i.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,s,n){return s.toUpperCase()+n}),wv=(({hasOwnProperty:i})=>(e,t)=>i.call(e,t))(Object.prototype),PI=Oi("RegExp"),Qx=(i,e)=>{const t=Object.getOwnPropertyDescriptors(i),s={};zl(t,(n,r)=>{let l;(l=e(n,r,i))!==!1&&(s[r]=l||n)}),Object.defineProperties(i,s)},UI=i=>{Qx(i,(e,t)=>{if(Vs(i)&&["arguments","caller","callee"].indexOf(t)!==-1)return!1;const s=i[t];if(Vs(s)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+t+"'")})}})},MI=(i,e)=>{const t={},s=n=>{n.forEach(r=>{t[r]=!0})};return Nr(i)?s(i):s(String(i).split(e)),t},jI=()=>{},FI=(i,e)=>i!=null&&Number.isFinite(i=+i)?i:e;function BI(i){return!!(i&&Vs(i.append)&&i[Hx]==="FormData"&&i[ru])}const $I=i=>{const e=new Array(10),t=(s,n)=>{if(Hl(s)){if(e.indexOf(s)>=0)return;if(Gl(s))return s;if(!("toJSON"in s)){e[n]=s;const r=Nr(s)?[]:{};return zl(s,(l,c)=>{const h=t(l,n+1);!Ir(h)&&(r[c]=h)}),e[n]=void 0,r}}return s};return t(i,0)},VI=Oi("AsyncFunction"),GI=i=>i&&(Hl(i)||Vs(i))&&Vs(i.then)&&Vs(i.catch),Xx=((i,e)=>i?setImmediate:e?((t,s)=>(Ta.addEventListener("message",({source:n,data:r})=>{n===Ta&&r===t&&s.length&&s.shift()()},!1),n=>{s.push(n),Ta.postMessage(t,"*")}))(`axios@${Math.random()}`,[]):t=>setTimeout(t))(typeof setImmediate=="function",Vs(Ta.postMessage)),HI=typeof queueMicrotask<"u"?queueMicrotask.bind(Ta):typeof process<"u"&&process.nextTick||Xx,zI=i=>i!=null&&Vs(i[ru]),J={isArray:Nr,isArrayBuffer:zx,isBuffer:Gl,isFormData:vI,isArrayBufferView:oI,isString:cI,isNumber:Kx,isBoolean:uI,isObject:Hl,isPlainObject:Cc,isEmptyObject:dI,isReadableStream:xI,isRequest:SI,isResponse:bI,isHeaders:EI,isUndefined:Ir,isDate:hI,isFile:fI,isBlob:mI,isRegExp:PI,isFunction:Vs,isStream:gI,isURLSearchParams:yI,isTypedArray:CI,isFileList:pI,forEach:zl,merge:hf,extend:AI,trim:TI,stripBOM:_I,inherits:II,toFlatObject:RI,kindOf:lu,kindOfTest:Oi,endsWith:LI,toArray:wI,forEachEntry:OI,matchAll:NI,isHTMLForm:DI,hasOwnProperty:wv,hasOwnProp:wv,reduceDescriptors:Qx,freezeMethods:UI,toObjectSet:MI,toCamelCase:kI,noop:jI,toFiniteNumber:FI,findKey:Yx,global:Ta,isContextDefined:qx,isSpecCompliantForm:BI,toJSONObject:$I,isAsyncFn:VI,isThenable:GI,setImmediate:Xx,asap:HI,isIterable:zI};let ze=class Wx extends Error{static from(e,t,s,n,r,l){const c=new Wx(e.message,t||e.code,s,n,r);return c.cause=e,c.name=e.name,l&&Object.assign(c,l),c}constructor(e,t,s,n,r){super(e),this.name="AxiosError",this.isAxiosError=!0,t&&(this.code=t),s&&(this.config=s),n&&(this.request=n),r&&(this.response=r,this.status=r.status)}toJSON(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:J.toJSONObject(this.config),code:this.code,status:this.status}}};ze.ERR_BAD_OPTION_VALUE="ERR_BAD_OPTION_VALUE";ze.ERR_BAD_OPTION="ERR_BAD_OPTION";ze.ECONNABORTED="ECONNABORTED";ze.ETIMEDOUT="ETIMEDOUT";ze.ERR_NETWORK="ERR_NETWORK";ze.ERR_FR_TOO_MANY_REDIRECTS="ERR_FR_TOO_MANY_REDIRECTS";ze.ERR_DEPRECATED="ERR_DEPRECATED";ze.ERR_BAD_RESPONSE="ERR_BAD_RESPONSE";ze.ERR_BAD_REQUEST="ERR_BAD_REQUEST";ze.ERR_CANCELED="ERR_CANCELED";ze.ERR_NOT_SUPPORT="ERR_NOT_SUPPORT";ze.ERR_INVALID_URL="ERR_INVALID_URL";const KI=null;function ff(i){return J.isPlainObject(i)||J.isArray(i)}function Zx(i){return J.endsWith(i,"[]")?i.slice(0,-2):i}function Cv(i,e,t){return i?i.concat(e).map(function(n,r){return n=Zx(n),!t&&r?"["+n+"]":n}).join(t?".":""):e}function YI(i){return J.isArray(i)&&!i.some(ff)}const qI=J.toFlatObject(J,{},null,function(e){return/^is[A-Z]/.test(e)});function cu(i,e,t){if(!J.isObject(i))throw new TypeError("target must be an object");e=e||new FormData,t=J.toFlatObject(t,{metaTokens:!0,dots:!1,indexes:!1},!1,function(T,E){return!J.isUndefined(E[T])});const s=t.metaTokens,n=t.visitor||f,r=t.dots,l=t.indexes,h=(t.Blob||typeof Blob<"u"&&Blob)&&J.isSpecCompliantForm(e);if(!J.isFunction(n))throw new TypeError("visitor must be a function");function d(S){if(S===null)return"";if(J.isDate(S))return S.toISOString();if(J.isBoolean(S))return S.toString();if(!h&&J.isBlob(S))throw new ze("Blob is not supported. Use a Buffer instead.");return J.isArrayBuffer(S)||J.isTypedArray(S)?h&&typeof Blob=="function"?new Blob([S]):Buffer.from(S):S}function f(S,T,E){let A=S;if(S&&!E&&typeof S=="object"){if(J.endsWith(T,"{}"))T=s?T:T.slice(0,-2),S=JSON.stringify(S);else if(J.isArray(S)&&YI(S)||(J.isFileList(S)||J.endsWith(T,"[]"))&&(A=J.toArray(S)))return T=Zx(T),A.forEach(function(R,w){!(J.isUndefined(R)||R===null)&&e.append(l===!0?Cv([T],w,r):l===null?T:T+"[]",d(R))}),!1}return ff(S)?!0:(e.append(Cv(E,T,r),d(S)),!1)}const p=[],v=Object.assign(qI,{defaultVisitor:f,convertValue:d,isVisitable:ff});function x(S,T){if(!J.isUndefined(S)){if(p.indexOf(S)!==-1)throw Error("Circular reference detected in "+T.join("."));p.push(S),J.forEach(S,function(A,_){(!(J.isUndefined(A)||A===null)&&n.call(e,A,J.isString(_)?_.trim():_,T,v))===!0&&x(A,T?T.concat(_):[_])}),p.pop()}}if(!J.isObject(i))throw new TypeError("data must be an object");return x(i),e}function Ov(i){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(i).replace(/[!'()~]|%20|%00/g,function(s){return e[s]})}function zf(i,e){this._pairs=[],i&&cu(i,this,e)}const Jx=zf.prototype;Jx.append=function(e,t){this._pairs.push([e,t])};Jx.toString=function(e){const t=e?function(s){return e.call(this,s,Ov)}:Ov;return this._pairs.map(function(n){return t(n[0])+"="+t(n[1])},"").join("&")};function QI(i){return encodeURIComponent(i).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function eS(i,e,t){if(!e)return i;const s=t&&t.encode||QI,n=J.isFunction(t)?{serialize:t}:t,r=n&&n.serialize;let l;if(r?l=r(e,n):l=J.isURLSearchParams(e)?e.toString():new zf(e,n).toString(s),l){const c=i.indexOf("#");c!==-1&&(i=i.slice(0,c)),i+=(i.indexOf("?")===-1?"?":"&")+l}return i}class Nv{constructor(){this.handlers=[]}use(e,t,s){return this.handlers.push({fulfilled:e,rejected:t,synchronous:s?s.synchronous:!1,runWhen:s?s.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){J.forEach(this.handlers,function(s){s!==null&&e(s)})}}const Kf={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1,legacyInterceptorReqResOrdering:!0},XI=typeof URLSearchParams<"u"?URLSearchParams:zf,WI=typeof FormData<"u"?FormData:null,ZI=typeof Blob<"u"?Blob:null,JI={isBrowser:!0,classes:{URLSearchParams:XI,FormData:WI,Blob:ZI},protocols:["http","https","file","blob","url","data"]},Yf=typeof window<"u"&&typeof document<"u",mf=typeof navigator=="object"&&navigator||void 0,eR=Yf&&(!mf||["ReactNative","NativeScript","NS"].indexOf(mf.product)<0),tR=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",sR=Yf&&window.location.href||"http://localhost",iR=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Yf,hasStandardBrowserEnv:eR,hasStandardBrowserWebWorkerEnv:tR,navigator:mf,origin:sR},Symbol.toStringTag,{value:"Module"})),Ts={...iR,...JI};function nR(i,e){return cu(i,new Ts.classes.URLSearchParams,{visitor:function(t,s,n,r){return Ts.isNode&&J.isBuffer(t)?(this.append(s,t.toString("base64")),!1):r.defaultVisitor.apply(this,arguments)},...e})}function aR(i){return J.matchAll(/\w+|\[(\w*)]/g,i).map(e=>e[0]==="[]"?"":e[1]||e[0])}function rR(i){const e={},t=Object.keys(i);let s;const n=t.length;let r;for(s=0;s<n;s++)r=t[s],e[r]=i[r];return e}function tS(i){function e(t,s,n,r){let l=t[r++];if(l==="__proto__")return!0;const c=Number.isFinite(+l),h=r>=t.length;return l=!l&&J.isArray(n)?n.length:l,h?(J.hasOwnProp(n,l)?n[l]=[n[l],s]:n[l]=s,!c):((!n[l]||!J.isObject(n[l]))&&(n[l]=[]),e(t,s,n[l],r)&&J.isArray(n[l])&&(n[l]=rR(n[l])),!c)}if(J.isFormData(i)&&J.isFunction(i.entries)){const t={};return J.forEachEntry(i,(s,n)=>{e(aR(s),n,t,0)}),t}return null}function lR(i,e,t){if(J.isString(i))try{return(e||JSON.parse)(i),J.trim(i)}catch(s){if(s.name!=="SyntaxError")throw s}return(t||JSON.stringify)(i)}const Kl={transitional:Kf,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const s=t.getContentType()||"",n=s.indexOf("application/json")>-1,r=J.isObject(e);if(r&&J.isHTMLForm(e)&&(e=new FormData(e)),J.isFormData(e))return n?JSON.stringify(tS(e)):e;if(J.isArrayBuffer(e)||J.isBuffer(e)||J.isStream(e)||J.isFile(e)||J.isBlob(e)||J.isReadableStream(e))return e;if(J.isArrayBufferView(e))return e.buffer;if(J.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let c;if(r){if(s.indexOf("application/x-www-form-urlencoded")>-1)return nR(e,this.formSerializer).toString();if((c=J.isFileList(e))||s.indexOf("multipart/form-data")>-1){const h=this.env&&this.env.FormData;return cu(c?{"files[]":e}:e,h&&new h,this.formSerializer)}}return r||n?(t.setContentType("application/json",!1),lR(e)):e}],transformResponse:[function(e){const t=this.transitional||Kl.transitional,s=t&&t.forcedJSONParsing,n=this.responseType==="json";if(J.isResponse(e)||J.isReadableStream(e))return e;if(e&&J.isString(e)&&(s&&!this.responseType||n)){const l=!(t&&t.silentJSONParsing)&&n;try{return JSON.parse(e,this.parseReviver)}catch(c){if(l)throw c.name==="SyntaxError"?ze.from(c,ze.ERR_BAD_RESPONSE,this,null,this.response):c}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Ts.classes.FormData,Blob:Ts.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};J.forEach(["delete","get","head","post","put","patch"],i=>{Kl.headers[i]={}});const oR=J.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),cR=i=>{const e={};let t,s,n;return i&&i.split(`
`).forEach(function(l){n=l.indexOf(":"),t=l.substring(0,n).trim().toLowerCase(),s=l.substring(n+1).trim(),!(!t||e[t]&&oR[t])&&(t==="set-cookie"?e[t]?e[t].push(s):e[t]=[s]:e[t]=e[t]?e[t]+", "+s:s)}),e},Dv=Symbol("internals");function Il(i){return i&&String(i).trim().toLowerCase()}function Oc(i){return i===!1||i==null?i:J.isArray(i)?i.map(Oc):String(i)}function uR(i){const e=Object.create(null),t=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let s;for(;s=t.exec(i);)e[s[1]]=s[2];return e}const dR=i=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(i.trim());function Nh(i,e,t,s,n){if(J.isFunction(s))return s.call(this,e,t);if(n&&(e=t),!!J.isString(e)){if(J.isString(s))return e.indexOf(s)!==-1;if(J.isRegExp(s))return s.test(e)}}function hR(i){return i.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,s)=>t.toUpperCase()+s)}function fR(i,e){const t=J.toCamelCase(" "+e);["get","set","has"].forEach(s=>{Object.defineProperty(i,s+t,{value:function(n,r,l){return this[s].call(this,e,n,r,l)},configurable:!0})})}let Gs=class{constructor(e){e&&this.set(e)}set(e,t,s){const n=this;function r(c,h,d){const f=Il(h);if(!f)throw new Error("header name must be a non-empty string");const p=J.findKey(n,f);(!p||n[p]===void 0||d===!0||d===void 0&&n[p]!==!1)&&(n[p||h]=Oc(c))}const l=(c,h)=>J.forEach(c,(d,f)=>r(d,f,h));if(J.isPlainObject(e)||e instanceof this.constructor)l(e,t);else if(J.isString(e)&&(e=e.trim())&&!dR(e))l(cR(e),t);else if(J.isObject(e)&&J.isIterable(e)){let c={},h,d;for(const f of e){if(!J.isArray(f))throw TypeError("Object iterator must return a key-value pair");c[d=f[0]]=(h=c[d])?J.isArray(h)?[...h,f[1]]:[h,f[1]]:f[1]}l(c,t)}else e!=null&&r(t,e,s);return this}get(e,t){if(e=Il(e),e){const s=J.findKey(this,e);if(s){const n=this[s];if(!t)return n;if(t===!0)return uR(n);if(J.isFunction(t))return t.call(this,n,s);if(J.isRegExp(t))return t.exec(n);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=Il(e),e){const s=J.findKey(this,e);return!!(s&&this[s]!==void 0&&(!t||Nh(this,this[s],s,t)))}return!1}delete(e,t){const s=this;let n=!1;function r(l){if(l=Il(l),l){const c=J.findKey(s,l);c&&(!t||Nh(s,s[c],c,t))&&(delete s[c],n=!0)}}return J.isArray(e)?e.forEach(r):r(e),n}clear(e){const t=Object.keys(this);let s=t.length,n=!1;for(;s--;){const r=t[s];(!e||Nh(this,this[r],r,e,!0))&&(delete this[r],n=!0)}return n}normalize(e){const t=this,s={};return J.forEach(this,(n,r)=>{const l=J.findKey(s,r);if(l){t[l]=Oc(n),delete t[r];return}const c=e?hR(r):String(r).trim();c!==r&&delete t[r],t[c]=Oc(n),s[c]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return J.forEach(this,(s,n)=>{s!=null&&s!==!1&&(t[n]=e&&J.isArray(s)?s.join(", "):s)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const s=new this(e);return t.forEach(n=>s.set(n)),s}static accessor(e){const s=(this[Dv]=this[Dv]={accessors:{}}).accessors,n=this.prototype;function r(l){const c=Il(l);s[c]||(fR(n,l),s[c]=!0)}return J.isArray(e)?e.forEach(r):r(e),this}};Gs.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);J.reduceDescriptors(Gs.prototype,({value:i},e)=>{let t=e[0].toUpperCase()+e.slice(1);return{get:()=>i,set(s){this[t]=s}}});J.freezeMethods(Gs);function Dh(i,e){const t=this||Kl,s=e||t,n=Gs.from(s.headers);let r=s.data;return J.forEach(i,function(c){r=c.call(t,r,n.normalize(),e?e.status:void 0)}),n.normalize(),r}function sS(i){return!!(i&&i.__CANCEL__)}let Yl=class extends ze{constructor(e,t,s){super(e??"canceled",ze.ERR_CANCELED,t,s),this.name="CanceledError",this.__CANCEL__=!0}};function iS(i,e,t){const s=t.config.validateStatus;!t.status||!s||s(t.status)?i(t):e(new ze("Request failed with status code "+t.status,[ze.ERR_BAD_REQUEST,ze.ERR_BAD_RESPONSE][Math.floor(t.status/100)-4],t.config,t.request,t))}function mR(i){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(i);return e&&e[1]||""}function pR(i,e){i=i||10;const t=new Array(i),s=new Array(i);let n=0,r=0,l;return e=e!==void 0?e:1e3,function(h){const d=Date.now(),f=s[r];l||(l=d),t[n]=h,s[n]=d;let p=r,v=0;for(;p!==n;)v+=t[p++],p=p%i;if(n=(n+1)%i,n===r&&(r=(r+1)%i),d-l<e)return;const x=f&&d-f;return x?Math.round(v*1e3/x):void 0}}function gR(i,e){let t=0,s=1e3/e,n,r;const l=(d,f=Date.now())=>{t=f,n=null,r&&(clearTimeout(r),r=null),i(...d)};return[(...d)=>{const f=Date.now(),p=f-t;p>=s?l(d,f):(n=d,r||(r=setTimeout(()=>{r=null,l(n)},s-p)))},()=>n&&l(n)]}const Hc=(i,e,t=3)=>{let s=0;const n=pR(50,250);return gR(r=>{const l=r.loaded,c=r.lengthComputable?r.total:void 0,h=l-s,d=n(h),f=l<=c;s=l;const p={loaded:l,total:c,progress:c?l/c:void 0,bytes:h,rate:d||void 0,estimated:d&&c&&f?(c-l)/d:void 0,event:r,lengthComputable:c!=null,[e?"download":"upload"]:!0};i(p)},t)},kv=(i,e)=>{const t=i!=null;return[s=>e[0]({lengthComputable:t,total:i,loaded:s}),e[1]]},Pv=i=>(...e)=>J.asap(()=>i(...e)),vR=Ts.hasStandardBrowserEnv?((i,e)=>t=>(t=new URL(t,Ts.origin),i.protocol===t.protocol&&i.host===t.host&&(e||i.port===t.port)))(new URL(Ts.origin),Ts.navigator&&/(msie|trident)/i.test(Ts.navigator.userAgent)):()=>!0,yR=Ts.hasStandardBrowserEnv?{write(i,e,t,s,n,r,l){if(typeof document>"u")return;const c=[`${i}=${encodeURIComponent(e)}`];J.isNumber(t)&&c.push(`expires=${new Date(t).toUTCString()}`),J.isString(s)&&c.push(`path=${s}`),J.isString(n)&&c.push(`domain=${n}`),r===!0&&c.push("secure"),J.isString(l)&&c.push(`SameSite=${l}`),document.cookie=c.join("; ")},read(i){if(typeof document>"u")return null;const e=document.cookie.match(new RegExp("(?:^|; )"+i+"=([^;]*)"));return e?decodeURIComponent(e[1]):null},remove(i){this.write(i,"",Date.now()-864e5,"/")}}:{write(){},read(){return null},remove(){}};function xR(i){return typeof i!="string"?!1:/^([a-z][a-z\d+\-.]*:)?\/\//i.test(i)}function SR(i,e){return e?i.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):i}function nS(i,e,t){let s=!xR(e);return i&&(s||t==!1)?SR(i,e):e}const Uv=i=>i instanceof Gs?{...i}:i;function Ia(i,e){e=e||{};const t={};function s(d,f,p,v){return J.isPlainObject(d)&&J.isPlainObject(f)?J.merge.call({caseless:v},d,f):J.isPlainObject(f)?J.merge({},f):J.isArray(f)?f.slice():f}function n(d,f,p,v){if(J.isUndefined(f)){if(!J.isUndefined(d))return s(void 0,d,p,v)}else return s(d,f,p,v)}function r(d,f){if(!J.isUndefined(f))return s(void 0,f)}function l(d,f){if(J.isUndefined(f)){if(!J.isUndefined(d))return s(void 0,d)}else return s(void 0,f)}function c(d,f,p){if(p in e)return s(d,f);if(p in i)return s(void 0,d)}const h={url:r,method:r,data:r,baseURL:l,transformRequest:l,transformResponse:l,paramsSerializer:l,timeout:l,timeoutMessage:l,withCredentials:l,withXSRFToken:l,adapter:l,responseType:l,xsrfCookieName:l,xsrfHeaderName:l,onUploadProgress:l,onDownloadProgress:l,decompress:l,maxContentLength:l,maxBodyLength:l,beforeRedirect:l,transport:l,httpAgent:l,httpsAgent:l,cancelToken:l,socketPath:l,responseEncoding:l,validateStatus:c,headers:(d,f,p)=>n(Uv(d),Uv(f),p,!0)};return J.forEach(Object.keys({...i,...e}),function(f){if(f==="__proto__"||f==="constructor"||f==="prototype")return;const p=J.hasOwnProp(h,f)?h[f]:n,v=p(i[f],e[f],f);J.isUndefined(v)&&p!==c||(t[f]=v)}),t}const aS=i=>{const e=Ia({},i);let{data:t,withXSRFToken:s,xsrfHeaderName:n,xsrfCookieName:r,headers:l,auth:c}=e;if(e.headers=l=Gs.from(l),e.url=eS(nS(e.baseURL,e.url,e.allowAbsoluteUrls),i.params,i.paramsSerializer),c&&l.set("Authorization","Basic "+btoa((c.username||"")+":"+(c.password?unescape(encodeURIComponent(c.password)):""))),J.isFormData(t)){if(Ts.hasStandardBrowserEnv||Ts.hasStandardBrowserWebWorkerEnv)l.setContentType(void 0);else if(J.isFunction(t.getHeaders)){const h=t.getHeaders(),d=["content-type","content-length"];Object.entries(h).forEach(([f,p])=>{d.includes(f.toLowerCase())&&l.set(f,p)})}}if(Ts.hasStandardBrowserEnv&&(s&&J.isFunction(s)&&(s=s(e)),s||s!==!1&&vR(e.url))){const h=n&&r&&yR.read(r);h&&l.set(n,h)}return e},bR=typeof XMLHttpRequest<"u",ER=bR&&function(i){return new Promise(function(t,s){const n=aS(i);let r=n.data;const l=Gs.from(n.headers).normalize();let{responseType:c,onUploadProgress:h,onDownloadProgress:d}=n,f,p,v,x,S;function T(){x&&x(),S&&S(),n.cancelToken&&n.cancelToken.unsubscribe(f),n.signal&&n.signal.removeEventListener("abort",f)}let E=new XMLHttpRequest;E.open(n.method.toUpperCase(),n.url,!0),E.timeout=n.timeout;function A(){if(!E)return;const R=Gs.from("getAllResponseHeaders"in E&&E.getAllResponseHeaders()),N={data:!c||c==="text"||c==="json"?E.responseText:E.response,status:E.status,statusText:E.statusText,headers:R,config:i,request:E};iS(function(D){t(D),T()},function(D){s(D),T()},N),E=null}"onloadend"in E?E.onloadend=A:E.onreadystatechange=function(){!E||E.readyState!==4||E.status===0&&!(E.responseURL&&E.responseURL.indexOf("file:")===0)||setTimeout(A)},E.onabort=function(){E&&(s(new ze("Request aborted",ze.ECONNABORTED,i,E)),E=null)},E.onerror=function(w){const N=w&&w.message?w.message:"Network Error",U=new ze(N,ze.ERR_NETWORK,i,E);U.event=w||null,s(U),E=null},E.ontimeout=function(){let w=n.timeout?"timeout of "+n.timeout+"ms exceeded":"timeout exceeded";const N=n.transitional||Kf;n.timeoutErrorMessage&&(w=n.timeoutErrorMessage),s(new ze(w,N.clarifyTimeoutError?ze.ETIMEDOUT:ze.ECONNABORTED,i,E)),E=null},r===void 0&&l.setContentType(null),"setRequestHeader"in E&&J.forEach(l.toJSON(),function(w,N){E.setRequestHeader(N,w)}),J.isUndefined(n.withCredentials)||(E.withCredentials=!!n.withCredentials),c&&c!=="json"&&(E.responseType=n.responseType),d&&([v,S]=Hc(d,!0),E.addEventListener("progress",v)),h&&E.upload&&([p,x]=Hc(h),E.upload.addEventListener("progress",p),E.upload.addEventListener("loadend",x)),(n.cancelToken||n.signal)&&(f=R=>{E&&(s(!R||R.type?new Yl(null,i,E):R),E.abort(),E=null)},n.cancelToken&&n.cancelToken.subscribe(f),n.signal&&(n.signal.aborted?f():n.signal.addEventListener("abort",f)));const _=mR(n.url);if(_&&Ts.protocols.indexOf(_)===-1){s(new ze("Unsupported protocol "+_+":",ze.ERR_BAD_REQUEST,i));return}E.send(r||null)})},TR=(i,e)=>{const{length:t}=i=i?i.filter(Boolean):[];if(e||t){let s=new AbortController,n;const r=function(d){if(!n){n=!0,c();const f=d instanceof Error?d:this.reason;s.abort(f instanceof ze?f:new Yl(f instanceof Error?f.message:f))}};let l=e&&setTimeout(()=>{l=null,r(new ze(`timeout of ${e}ms exceeded`,ze.ETIMEDOUT))},e);const c=()=>{i&&(l&&clearTimeout(l),l=null,i.forEach(d=>{d.unsubscribe?d.unsubscribe(r):d.removeEventListener("abort",r)}),i=null)};i.forEach(d=>d.addEventListener("abort",r));const{signal:h}=s;return h.unsubscribe=()=>J.asap(c),h}},AR=function*(i,e){let t=i.byteLength;if(t<e){yield i;return}let s=0,n;for(;s<t;)n=s+e,yield i.slice(s,n),s=n},_R=async function*(i,e){for await(const t of IR(i))yield*AR(t,e)},IR=async function*(i){if(i[Symbol.asyncIterator]){yield*i;return}const e=i.getReader();try{for(;;){const{done:t,value:s}=await e.read();if(t)break;yield s}}finally{await e.cancel()}},Mv=(i,e,t,s)=>{const n=_R(i,e);let r=0,l,c=h=>{l||(l=!0,s&&s(h))};return new ReadableStream({async pull(h){try{const{done:d,value:f}=await n.next();if(d){c(),h.close();return}let p=f.byteLength;if(t){let v=r+=p;t(v)}h.enqueue(new Uint8Array(f))}catch(d){throw c(d),d}},cancel(h){return c(h),n.return()}},{highWaterMark:2})},jv=64*1024,{isFunction:cc}=J,RR=(({Request:i,Response:e})=>({Request:i,Response:e}))(J.global),{ReadableStream:Fv,TextEncoder:Bv}=J.global,$v=(i,...e)=>{try{return!!i(...e)}catch{return!1}},LR=i=>{i=J.merge.call({skipUndefined:!0},RR,i);const{fetch:e,Request:t,Response:s}=i,n=e?cc(e):typeof fetch=="function",r=cc(t),l=cc(s);if(!n)return!1;const c=n&&cc(Fv),h=n&&(typeof Bv=="function"?(S=>T=>S.encode(T))(new Bv):async S=>new Uint8Array(await new t(S).arrayBuffer())),d=r&&c&&$v(()=>{let S=!1;const T=new t(Ts.origin,{body:new Fv,method:"POST",get duplex(){return S=!0,"half"}}).headers.has("Content-Type");return S&&!T}),f=l&&c&&$v(()=>J.isReadableStream(new s("").body)),p={stream:f&&(S=>S.body)};n&&["text","arrayBuffer","blob","formData","stream"].forEach(S=>{!p[S]&&(p[S]=(T,E)=>{let A=T&&T[S];if(A)return A.call(T);throw new ze(`Response type '${S}' is not supported`,ze.ERR_NOT_SUPPORT,E)})});const v=async S=>{if(S==null)return 0;if(J.isBlob(S))return S.size;if(J.isSpecCompliantForm(S))return(await new t(Ts.origin,{method:"POST",body:S}).arrayBuffer()).byteLength;if(J.isArrayBufferView(S)||J.isArrayBuffer(S))return S.byteLength;if(J.isURLSearchParams(S)&&(S=S+""),J.isString(S))return(await h(S)).byteLength},x=async(S,T)=>{const E=J.toFiniteNumber(S.getContentLength());return E??v(T)};return async S=>{let{url:T,method:E,data:A,signal:_,cancelToken:R,timeout:w,onDownloadProgress:N,onUploadProgress:U,responseType:D,headers:F,withCredentials:j="same-origin",fetchOptions:M}=aS(S),H=e||fetch;D=D?(D+"").toLowerCase():"text";let K=TR([_,R&&R.toAbortSignal()],w),se=null;const ne=K&&K.unsubscribe&&(()=>{K.unsubscribe()});let de;try{if(U&&d&&E!=="get"&&E!=="head"&&(de=await x(F,A))!==0){let P=new t(T,{method:"POST",body:A,duplex:"half"}),$;if(J.isFormData(A)&&($=P.headers.get("content-type"))&&F.setContentType($),P.body){const[ie,fe]=kv(de,Hc(Pv(U)));A=Mv(P.body,jv,ie,fe)}}J.isString(j)||(j=j?"include":"omit");const k=r&&"credentials"in t.prototype,G={...M,signal:K,method:E.toUpperCase(),headers:F.normalize().toJSON(),body:A,duplex:"half",credentials:k?j:void 0};se=r&&new t(T,G);let Y=await(r?H(se,M):H(T,G));const le=f&&(D==="stream"||D==="response");if(f&&(N||le&&ne)){const P={};["status","statusText","headers"].forEach(ge=>{P[ge]=Y[ge]});const $=J.toFiniteNumber(Y.headers.get("content-length")),[ie,fe]=N&&kv($,Hc(Pv(N),!0))||[];Y=new s(Mv(Y.body,jv,ie,()=>{fe&&fe(),ne&&ne()}),P)}D=D||"text";let me=await p[J.findKey(p,D)||"text"](Y,S);return!le&&ne&&ne(),await new Promise((P,$)=>{iS(P,$,{data:me,headers:Gs.from(Y.headers),status:Y.status,statusText:Y.statusText,config:S,request:se})})}catch(k){throw ne&&ne(),k&&k.name==="TypeError"&&/Load failed|fetch/i.test(k.message)?Object.assign(new ze("Network Error",ze.ERR_NETWORK,S,se,k&&k.response),{cause:k.cause||k}):ze.from(k,k&&k.code,S,se,k&&k.response)}}},wR=new Map,rS=i=>{let e=i&&i.env||{};const{fetch:t,Request:s,Response:n}=e,r=[s,n,t];let l=r.length,c=l,h,d,f=wR;for(;c--;)h=r[c],d=f.get(h),d===void 0&&f.set(h,d=c?new Map:LR(e)),f=d;return d};rS();const qf={http:KI,xhr:ER,fetch:{get:rS}};J.forEach(qf,(i,e)=>{if(i){try{Object.defineProperty(i,"name",{value:e})}catch{}Object.defineProperty(i,"adapterName",{value:e})}});const Vv=i=>`- ${i}`,CR=i=>J.isFunction(i)||i===null||i===!1;function OR(i,e){i=J.isArray(i)?i:[i];const{length:t}=i;let s,n;const r={};for(let l=0;l<t;l++){s=i[l];let c;if(n=s,!CR(s)&&(n=qf[(c=String(s)).toLowerCase()],n===void 0))throw new ze(`Unknown adapter '${c}'`);if(n&&(J.isFunction(n)||(n=n.get(e))))break;r[c||"#"+l]=n}if(!n){const l=Object.entries(r).map(([h,d])=>`adapter ${h} `+(d===!1?"is not supported by the environment":"is not available in the build"));let c=t?l.length>1?`since :
`+l.map(Vv).join(`
`):" "+Vv(l[0]):"as no adapter specified";throw new ze("There is no suitable adapter to dispatch the request "+c,"ERR_NOT_SUPPORT")}return n}const lS={getAdapter:OR,adapters:qf};function kh(i){if(i.cancelToken&&i.cancelToken.throwIfRequested(),i.signal&&i.signal.aborted)throw new Yl(null,i)}function Gv(i){return kh(i),i.headers=Gs.from(i.headers),i.data=Dh.call(i,i.transformRequest),["post","put","patch"].indexOf(i.method)!==-1&&i.headers.setContentType("application/x-www-form-urlencoded",!1),lS.getAdapter(i.adapter||Kl.adapter,i)(i).then(function(s){return kh(i),s.data=Dh.call(i,i.transformResponse,s),s.headers=Gs.from(s.headers),s},function(s){return sS(s)||(kh(i),s&&s.response&&(s.response.data=Dh.call(i,i.transformResponse,s.response),s.response.headers=Gs.from(s.response.headers))),Promise.reject(s)})}const oS="1.13.5",uu={};["object","boolean","number","function","string","symbol"].forEach((i,e)=>{uu[i]=function(s){return typeof s===i||"a"+(e<1?"n ":" ")+i}});const Hv={};uu.transitional=function(e,t,s){function n(r,l){return"[Axios v"+oS+"] Transitional option '"+r+"'"+l+(s?". "+s:"")}return(r,l,c)=>{if(e===!1)throw new ze(n(l," has been removed"+(t?" in "+t:"")),ze.ERR_DEPRECATED);return t&&!Hv[l]&&(Hv[l]=!0,console.warn(n(l," has been deprecated since v"+t+" and will be removed in the near future"))),e?e(r,l,c):!0}};uu.spelling=function(e){return(t,s)=>(console.warn(`${s} is likely a misspelling of ${e}`),!0)};function NR(i,e,t){if(typeof i!="object")throw new ze("options must be an object",ze.ERR_BAD_OPTION_VALUE);const s=Object.keys(i);let n=s.length;for(;n-- >0;){const r=s[n],l=e[r];if(l){const c=i[r],h=c===void 0||l(c,r,i);if(h!==!0)throw new ze("option "+r+" must be "+h,ze.ERR_BAD_OPTION_VALUE);continue}if(t!==!0)throw new ze("Unknown option "+r,ze.ERR_BAD_OPTION)}}const Nc={assertOptions:NR,validators:uu},yi=Nc.validators;let Aa=class{constructor(e){this.defaults=e||{},this.interceptors={request:new Nv,response:new Nv}}async request(e,t){try{return await this._request(e,t)}catch(s){if(s instanceof Error){let n={};Error.captureStackTrace?Error.captureStackTrace(n):n=new Error;const r=n.stack?n.stack.replace(/^.+\n/,""):"";try{s.stack?r&&!String(s.stack).endsWith(r.replace(/^.+\n.+\n/,""))&&(s.stack+=`
`+r):s.stack=r}catch{}}throw s}}_request(e,t){typeof e=="string"?(t=t||{},t.url=e):t=e||{},t=Ia(this.defaults,t);const{transitional:s,paramsSerializer:n,headers:r}=t;s!==void 0&&Nc.assertOptions(s,{silentJSONParsing:yi.transitional(yi.boolean),forcedJSONParsing:yi.transitional(yi.boolean),clarifyTimeoutError:yi.transitional(yi.boolean),legacyInterceptorReqResOrdering:yi.transitional(yi.boolean)},!1),n!=null&&(J.isFunction(n)?t.paramsSerializer={serialize:n}:Nc.assertOptions(n,{encode:yi.function,serialize:yi.function},!0)),t.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),Nc.assertOptions(t,{baseUrl:yi.spelling("baseURL"),withXsrfToken:yi.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let l=r&&J.merge(r.common,r[t.method]);r&&J.forEach(["delete","get","head","post","put","patch","common"],S=>{delete r[S]}),t.headers=Gs.concat(l,r);const c=[];let h=!0;this.interceptors.request.forEach(function(T){if(typeof T.runWhen=="function"&&T.runWhen(t)===!1)return;h=h&&T.synchronous;const E=t.transitional||Kf;E&&E.legacyInterceptorReqResOrdering?c.unshift(T.fulfilled,T.rejected):c.push(T.fulfilled,T.rejected)});const d=[];this.interceptors.response.forEach(function(T){d.push(T.fulfilled,T.rejected)});let f,p=0,v;if(!h){const S=[Gv.bind(this),void 0];for(S.unshift(...c),S.push(...d),v=S.length,f=Promise.resolve(t);p<v;)f=f.then(S[p++],S[p++]);return f}v=c.length;let x=t;for(;p<v;){const S=c[p++],T=c[p++];try{x=S(x)}catch(E){T.call(this,E);break}}try{f=Gv.call(this,x)}catch(S){return Promise.reject(S)}for(p=0,v=d.length;p<v;)f=f.then(d[p++],d[p++]);return f}getUri(e){e=Ia(this.defaults,e);const t=nS(e.baseURL,e.url,e.allowAbsoluteUrls);return eS(t,e.params,e.paramsSerializer)}};J.forEach(["delete","get","head","options"],function(e){Aa.prototype[e]=function(t,s){return this.request(Ia(s||{},{method:e,url:t,data:(s||{}).data}))}});J.forEach(["post","put","patch"],function(e){function t(s){return function(r,l,c){return this.request(Ia(c||{},{method:e,headers:s?{"Content-Type":"multipart/form-data"}:{},url:r,data:l}))}}Aa.prototype[e]=t(),Aa.prototype[e+"Form"]=t(!0)});let DR=class cS{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(r){t=r});const s=this;this.promise.then(n=>{if(!s._listeners)return;let r=s._listeners.length;for(;r-- >0;)s._listeners[r](n);s._listeners=null}),this.promise.then=n=>{let r;const l=new Promise(c=>{s.subscribe(c),r=c}).then(n);return l.cancel=function(){s.unsubscribe(r)},l},e(function(r,l,c){s.reason||(s.reason=new Yl(r,l,c),t(s.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);t!==-1&&this._listeners.splice(t,1)}toAbortSignal(){const e=new AbortController,t=s=>{e.abort(s)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let e;return{token:new cS(function(n){e=n}),cancel:e}}};function kR(i){return function(t){return i.apply(null,t)}}function PR(i){return J.isObject(i)&&i.isAxiosError===!0}const pf={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(pf).forEach(([i,e])=>{pf[e]=i});function uS(i){const e=new Aa(i),t=Gx(Aa.prototype.request,e);return J.extend(t,Aa.prototype,e,{allOwnKeys:!0}),J.extend(t,e,null,{allOwnKeys:!0}),t.create=function(n){return uS(Ia(i,n))},t}const ue=uS(Kl);ue.Axios=Aa;ue.CanceledError=Yl;ue.CancelToken=DR;ue.isCancel=sS;ue.VERSION=oS;ue.toFormData=cu;ue.AxiosError=ze;ue.Cancel=ue.CanceledError;ue.all=function(e){return Promise.all(e)};ue.spread=kR;ue.isAxiosError=PR;ue.mergeConfig=Ia;ue.AxiosHeaders=Gs;ue.formToJSON=i=>tS(J.isHTMLForm(i)?new FormData(i):i);ue.getAdapter=lS.getAdapter;ue.HttpStatusCode=pf;ue.default=ue;const{Axios:hD,AxiosError:fD,CanceledError:mD,isCancel:pD,CancelToken:gD,VERSION:vD,all:yD,Cancel:xD,isAxiosError:SD,spread:bD,toFormData:ED,AxiosHeaders:TD,HttpStatusCode:AD,formToJSON:_D,getAdapter:ID,mergeConfig:RD}=ue,Se="http://localhost".replace(/\/+$/,"");class Tn{constructor(e,t=Se,s=ue){var n;this.basePath=t,this.axios=s,e&&(this.configuration=e,this.basePath=(n=e.basePath)!==null&&n!==void 0?n:t)}}class UR extends Error{constructor(e,t){super(t),this.field=e,this.name="RequiredError"}}const be={},Ee="https://example.com",Ie=function(i,e,t){if(t==null)throw new UR(e,`Required parameter ${e} was null or undefined when calling ${i}.`)},Re=async function(i,e,t){if(t&&t.apiKey){const s=typeof t.apiKey=="function"?await t.apiKey(e):await t.apiKey;i[e]=s}};function gf(i,e,t=""){e!=null&&(typeof e=="object"?Array.isArray(e)?e.forEach(s=>gf(i,s,t)):Object.keys(e).forEach(s=>gf(i,e[s],`${t}${t!==""?".":""}${s}`)):i.has(t)?i.append(t,e):i.set(t,e))}const Te=function(i,...e){const t=new URLSearchParams(i.search);gf(t,e),i.search=t.toString()},ws=function(i,e,t){const s=typeof i!="string";return(s&&t&&t.isJsonMime?t.isJsonMime(e.headers["Content-Type"]):s)?JSON.stringify(i!==void 0?i:{}):i||""},Ae=function(i){return i.pathname+i.search+i.hash},_e=function(i,e,t,s){return(n=e,r=t)=>{var l;const c={...i.options,url:(n.defaults.baseURL?"":(l=s?.basePath)!==null&&l!==void 0?l:r)+i.url};return n.request(c)}},MR=function(i){return{getEndpointInfo:async(e={})=>{const t="/System/Endpoint",s=new URL(t,Ee);let n;i&&(n=i.baseOptions);const r={method:"GET",...n,...e},l={},c={};await Re(l,"Authorization",i),Te(s,c);let h=n&&n.headers?n.headers:{};return r.headers={...l,...h,...e.headers},{url:Ae(s),options:r}},getLogFile:async(e,t={})=>{Ie("getLogFile","name",e);const s="/System/Logs/Log",n=new URL(s,Ee);let r;i&&(r=i.baseOptions);const l={method:"GET",...r,...t},c={},h={};await Re(c,"Authorization",i),e!==void 0&&(h.name=e),Te(n,h);let d=r&&r.headers?r.headers:{};return l.headers={...c,...d,...t.headers},{url:Ae(n),options:l}},getPingSystem:async(e={})=>{const t="/System/Ping",s=new URL(t,Ee);let n;i&&(n=i.baseOptions);const r={method:"GET",...n,...e},l={};Te(s,{});let h=n&&n.headers?n.headers:{};return r.headers={...l,...h,...e.headers},{url:Ae(s),options:r}},getPublicSystemInfo:async(e={})=>{const t="/System/Info/Public",s=new URL(t,Ee);let n;i&&(n=i.baseOptions);const r={method:"GET",...n,...e},l={};Te(s,{});let h=n&&n.headers?n.headers:{};return r.headers={...l,...h,...e.headers},{url:Ae(s),options:r}},getServerLogs:async(e={})=>{const t="/System/Logs",s=new URL(t,Ee);let n;i&&(n=i.baseOptions);const r={method:"GET",...n,...e},l={},c={};await Re(l,"Authorization",i),Te(s,c);let h=n&&n.headers?n.headers:{};return r.headers={...l,...h,...e.headers},{url:Ae(s),options:r}},getSystemInfo:async(e={})=>{const t="/System/Info",s=new URL(t,Ee);let n;i&&(n=i.baseOptions);const r={method:"GET",...n,...e},l={},c={};await Re(l,"Authorization",i),Te(s,c);let h=n&&n.headers?n.headers:{};return r.headers={...l,...h,...e.headers},{url:Ae(s),options:r}},getSystemStorage:async(e={})=>{const t="/System/Info/Storage",s=new URL(t,Ee);let n;i&&(n=i.baseOptions);const r={method:"GET",...n,...e},l={},c={};await Re(l,"Authorization",i),Te(s,c);let h=n&&n.headers?n.headers:{};return r.headers={...l,...h,...e.headers},{url:Ae(s),options:r}},postPingSystem:async(e={})=>{const t="/System/Ping",s=new URL(t,Ee);let n;i&&(n=i.baseOptions);const r={method:"POST",...n,...e},l={};Te(s,{});let h=n&&n.headers?n.headers:{};return r.headers={...l,...h,...e.headers},{url:Ae(s),options:r}},restartApplication:async(e={})=>{const t="/System/Restart",s=new URL(t,Ee);let n;i&&(n=i.baseOptions);const r={method:"POST",...n,...e},l={},c={};await Re(l,"Authorization",i),Te(s,c);let h=n&&n.headers?n.headers:{};return r.headers={...l,...h,...e.headers},{url:Ae(s),options:r}},shutdownApplication:async(e={})=>{const t="/System/Shutdown",s=new URL(t,Ee);let n;i&&(n=i.baseOptions);const r={method:"POST",...n,...e},l={},c={};await Re(l,"Authorization",i),Te(s,c);let h=n&&n.headers?n.headers:{};return r.headers={...l,...h,...e.headers},{url:Ae(s),options:r}}}},Ui=function(i){const e=MR(i);return{async getEndpointInfo(t){var s,n,r;const l=await e.getEndpointInfo(t),c=(s=i?.serverIndex)!==null&&s!==void 0?s:0,h=(r=(n=be["SystemApi.getEndpointInfo"])===null||n===void 0?void 0:n[c])===null||r===void 0?void 0:r.url;return(d,f)=>_e(l,ue,Se,i)(d,h||f)},async getLogFile(t,s){var n,r,l;const c=await e.getLogFile(t,s),h=(n=i?.serverIndex)!==null&&n!==void 0?n:0,d=(l=(r=be["SystemApi.getLogFile"])===null||r===void 0?void 0:r[h])===null||l===void 0?void 0:l.url;return(f,p)=>_e(c,ue,Se,i)(f,d||p)},async getPingSystem(t){var s,n,r;const l=await e.getPingSystem(t),c=(s=i?.serverIndex)!==null&&s!==void 0?s:0,h=(r=(n=be["SystemApi.getPingSystem"])===null||n===void 0?void 0:n[c])===null||r===void 0?void 0:r.url;return(d,f)=>_e(l,ue,Se,i)(d,h||f)},async getPublicSystemInfo(t){var s,n,r;const l=await e.getPublicSystemInfo(t),c=(s=i?.serverIndex)!==null&&s!==void 0?s:0,h=(r=(n=be["SystemApi.getPublicSystemInfo"])===null||n===void 0?void 0:n[c])===null||r===void 0?void 0:r.url;return(d,f)=>_e(l,ue,Se,i)(d,h||f)},async getServerLogs(t){var s,n,r;const l=await e.getServerLogs(t),c=(s=i?.serverIndex)!==null&&s!==void 0?s:0,h=(r=(n=be["SystemApi.getServerLogs"])===null||n===void 0?void 0:n[c])===null||r===void 0?void 0:r.url;return(d,f)=>_e(l,ue,Se,i)(d,h||f)},async getSystemInfo(t){var s,n,r;const l=await e.getSystemInfo(t),c=(s=i?.serverIndex)!==null&&s!==void 0?s:0,h=(r=(n=be["SystemApi.getSystemInfo"])===null||n===void 0?void 0:n[c])===null||r===void 0?void 0:r.url;return(d,f)=>_e(l,ue,Se,i)(d,h||f)},async getSystemStorage(t){var s,n,r;const l=await e.getSystemStorage(t),c=(s=i?.serverIndex)!==null&&s!==void 0?s:0,h=(r=(n=be["SystemApi.getSystemStorage"])===null||n===void 0?void 0:n[c])===null||r===void 0?void 0:r.url;return(d,f)=>_e(l,ue,Se,i)(d,h||f)},async postPingSystem(t){var s,n,r;const l=await e.postPingSystem(t),c=(s=i?.serverIndex)!==null&&s!==void 0?s:0,h=(r=(n=be["SystemApi.postPingSystem"])===null||n===void 0?void 0:n[c])===null||r===void 0?void 0:r.url;return(d,f)=>_e(l,ue,Se,i)(d,h||f)},async restartApplication(t){var s,n,r;const l=await e.restartApplication(t),c=(s=i?.serverIndex)!==null&&s!==void 0?s:0,h=(r=(n=be["SystemApi.restartApplication"])===null||n===void 0?void 0:n[c])===null||r===void 0?void 0:r.url;return(d,f)=>_e(l,ue,Se,i)(d,h||f)},async shutdownApplication(t){var s,n,r;const l=await e.shutdownApplication(t),c=(s=i?.serverIndex)!==null&&s!==void 0?s:0,h=(r=(n=be["SystemApi.shutdownApplication"])===null||n===void 0?void 0:n[c])===null||r===void 0?void 0:r.url;return(d,f)=>_e(l,ue,Se,i)(d,h||f)}}};class jR extends Tn{getEndpointInfo(e){return Ui(this.configuration).getEndpointInfo(e).then(t=>t(this.axios,this.basePath))}getLogFile(e,t){return Ui(this.configuration).getLogFile(e.name,t).then(s=>s(this.axios,this.basePath))}getPingSystem(e){return Ui(this.configuration).getPingSystem(e).then(t=>t(this.axios,this.basePath))}getPublicSystemInfo(e){return Ui(this.configuration).getPublicSystemInfo(e).then(t=>t(this.axios,this.basePath))}getServerLogs(e){return Ui(this.configuration).getServerLogs(e).then(t=>t(this.axios,this.basePath))}getSystemInfo(e){return Ui(this.configuration).getSystemInfo(e).then(t=>t(this.axios,this.basePath))}getSystemStorage(e){return Ui(this.configuration).getSystemStorage(e).then(t=>t(this.axios,this.basePath))}postPingSystem(e){return Ui(this.configuration).postPingSystem(e).then(t=>t(this.axios,this.basePath))}restartApplication(e){return Ui(this.configuration).restartApplication(e).then(t=>t(this.axios,this.basePath))}shutdownApplication(e){return Ui(this.configuration).shutdownApplication(e).then(t=>t(this.axios,this.basePath))}}function FR(i){return new jR(i.configuration,void 0,i.axiosInstance)}function zv(i){const e=i.split(".").map(Number);if(e.length===3&&e.every(t=>t>=0))return e}function Kv(i,e){const t=zv(i),s=zv(e);if(!t||!s)throw new TypeError("Version doesn't match a numeric-only semver format");const[n,r,l]=t,[c,h,d]=s;return n<c||n===c&&r<h||n===c&&r===h&&l<d}const BR="10.11.1",$R="10.10.0",VR="Jellyfin Server",GR=3e3,HR=5e3;function zR(i,e=Bs.GREAT){return i.length>0?Math.min(...i):e}function KR(i){var e,t,s;const n=[],r=[];!(!((e=i.response)===null||e===void 0)&&e.data)||i.error?(n.push(new nI(i.error)),r.push(Bs.BAD)):i.response.data.ProductName!==VR&&(n.push(new sI(i.response.data.ProductName)),r.push(Bs.BAD));const l=(t=i.response)===null||t===void 0?void 0:t.data.Version;try{l?Kv(l,$R)?(n.push(new rI(l)),r.push(Bs.OK)):Kv(l,BR)&&(n.push(new aI(l)),r.push(Bs.GOOD)):(n.push(new Lv),r.push(Bs.BAD))}catch(c){c instanceof TypeError&&(n.push(new Lv),r.push(Bs.BAD))}return i.responseTime>GR&&(n.push(new iI(i.responseTime)),r.push(Bs.GOOD)),{address:i.address,responseTime:i.responseTime,score:zR(r),issues:n,systemInfo:(s=i.response)===null||s===void 0?void 0:s.data}}class YR{constructor(e){this.jellyfin=e}async fetchRecommendedServerInfo(e){const t=this.jellyfin.createApi(e),s=Date.now();return FR(t).getPublicSystemInfo({timeout:HR}).then(n=>({address:e,response:n,responseTime:Date.now()-s})).catch(n=>({address:e,error:n,responseTime:Date.now()-s})).then(n=>KR(n))}async discover(e,t=Bs.BAD){return(await Promise.all(e.map(s=>this.fetchRecommendedServerInfo(s)))).filter(s=>s.score>=t)}}class qR{constructor(e){this.jellyfin=e,this.recommendedServerDiscovery=new YR(this.jellyfin)}findBestServer(e){let t=e.find(s=>s.score===Bs.GREAT);return t||(t=e.find(s=>s.score===Bs.GOOD)),t||(t=e.find(s=>s.score===Bs.OK)),t}getAddressCandidates(e){return tI(e)}async getRecommendedServers(e,t){return this.recommendedServerDiscovery.discover(e,t)}async getRecommendedServerCandidates(e,t){return this.getRecommendedServers(this.getAddressCandidates(e),t)}}function QR(i,e,t=""){return[`MediaBrowser Client="${encodeURIComponent(i.name)}"`,`Device="${encodeURIComponent(e.name)}"`,`DeviceId="${encodeURIComponent(e.id)}"`,`Version="${encodeURIComponent(i.version)}"`,`Token="${encodeURIComponent(t)}"`].join(", ")}class XR{constructor(e={}){this.apiKey=e.apiKey,this.username=e.username,this.password=e.password,this.accessToken=e.accessToken,this.basePath=e.basePath,this.serverIndex=e.serverIndex,this.baseOptions=e.baseOptions,this.formDataCtor=e.formDataCtor}isJsonMime(e){const t=new RegExp("^(application/json|[^;/ 	]+/[^;/ 	]+[+]json)[ 	]*(;.*)?$","i");return e!==null&&(t.test(e)||e.toLowerCase()==="application/json-patch+json")}}const WR=function(i){return{addUserToSession:async(e,t,s={})=>{Ie("addUserToSession","sessionId",e),Ie("addUserToSession","userId",t);const n="/Sessions/{sessionId}/User/{userId}".replace("{sessionId}",encodeURIComponent(String(e))).replace("{userId}",encodeURIComponent(String(t))),r=new URL(n,Ee);let l;i&&(l=i.baseOptions);const c={method:"POST",...l,...s},h={},d={};await Re(h,"Authorization",i),Te(r,d);let f=l&&l.headers?l.headers:{};return c.headers={...h,...f,...s.headers},{url:Ae(r),options:c}},displayContent:async(e,t,s,n,r={})=>{Ie("displayContent","sessionId",e),Ie("displayContent","itemType",t),Ie("displayContent","itemId",s),Ie("displayContent","itemName",n);const l="/Sessions/{sessionId}/Viewing".replace("{sessionId}",encodeURIComponent(String(e))),c=new URL(l,Ee);let h;i&&(h=i.baseOptions);const d={method:"POST",...h,...r},f={},p={};await Re(f,"Authorization",i),t!==void 0&&(p.itemType=t),s!==void 0&&(p.itemId=s),n!==void 0&&(p.itemName=n),Te(c,p);let v=h&&h.headers?h.headers:{};return d.headers={...f,...v,...r.headers},{url:Ae(c),options:d}},getAuthProviders:async(e={})=>{const t="/Auth/Providers",s=new URL(t,Ee);let n;i&&(n=i.baseOptions);const r={method:"GET",...n,...e},l={},c={};await Re(l,"Authorization",i),Te(s,c);let h=n&&n.headers?n.headers:{};return r.headers={...l,...h,...e.headers},{url:Ae(s),options:r}},getPasswordResetProviders:async(e={})=>{const t="/Auth/PasswordResetProviders",s=new URL(t,Ee);let n;i&&(n=i.baseOptions);const r={method:"GET",...n,...e},l={},c={};await Re(l,"Authorization",i),Te(s,c);let h=n&&n.headers?n.headers:{};return r.headers={...l,...h,...e.headers},{url:Ae(s),options:r}},getSessions:async(e,t,s,n={})=>{const r="/Sessions",l=new URL(r,Ee);let c;i&&(c=i.baseOptions);const h={method:"GET",...c,...n},d={},f={};await Re(d,"Authorization",i),e!==void 0&&(f.controllableByUserId=e),t!==void 0&&(f.deviceId=t),s!==void 0&&(f.activeWithinSeconds=s),Te(l,f);let p=c&&c.headers?c.headers:{};return h.headers={...d,...p,...n.headers},{url:Ae(l),options:h}},play:async(e,t,s,n,r,l,c,h,d={})=>{Ie("play","sessionId",e),Ie("play","playCommand",t),Ie("play","itemIds",s);const f="/Sessions/{sessionId}/Playing".replace("{sessionId}",encodeURIComponent(String(e))),p=new URL(f,Ee);let v;i&&(v=i.baseOptions);const x={method:"POST",...v,...d},S={},T={};await Re(S,"Authorization",i),t!==void 0&&(T.playCommand=t),s&&(T.itemIds=s),n!==void 0&&(T.startPositionTicks=n),r!==void 0&&(T.mediaSourceId=r),l!==void 0&&(T.audioStreamIndex=l),c!==void 0&&(T.subtitleStreamIndex=c),h!==void 0&&(T.startIndex=h),Te(p,T);let E=v&&v.headers?v.headers:{};return x.headers={...S,...E,...d.headers},{url:Ae(p),options:x}},postCapabilities:async(e,t,s,n,r,l={})=>{const c="/Sessions/Capabilities",h=new URL(c,Ee);let d;i&&(d=i.baseOptions);const f={method:"POST",...d,...l},p={},v={};await Re(p,"Authorization",i),e!==void 0&&(v.id=e),t&&(v.playableMediaTypes=t),s&&(v.supportedCommands=s),n!==void 0&&(v.supportsMediaControl=n),r!==void 0&&(v.supportsPersistentIdentifier=r),Te(h,v);let x=d&&d.headers?d.headers:{};return f.headers={...p,...x,...l.headers},{url:Ae(h),options:f}},postFullCapabilities:async(e,t,s={})=>{Ie("postFullCapabilities","clientCapabilitiesDto",e);const n="/Sessions/Capabilities/Full",r=new URL(n,Ee);let l;i&&(l=i.baseOptions);const c={method:"POST",...l,...s},h={},d={};await Re(h,"Authorization",i),t!==void 0&&(d.id=t),h["Content-Type"]="application/json",Te(r,d);let f=l&&l.headers?l.headers:{};return c.headers={...h,...f,...s.headers},c.data=ws(e,c,i),{url:Ae(r),options:c}},removeUserFromSession:async(e,t,s={})=>{Ie("removeUserFromSession","sessionId",e),Ie("removeUserFromSession","userId",t);const n="/Sessions/{sessionId}/User/{userId}".replace("{sessionId}",encodeURIComponent(String(e))).replace("{userId}",encodeURIComponent(String(t))),r=new URL(n,Ee);let l;i&&(l=i.baseOptions);const c={method:"DELETE",...l,...s},h={},d={};await Re(h,"Authorization",i),Te(r,d);let f=l&&l.headers?l.headers:{};return c.headers={...h,...f,...s.headers},{url:Ae(r),options:c}},reportSessionEnded:async(e={})=>{const t="/Sessions/Logout",s=new URL(t,Ee);let n;i&&(n=i.baseOptions);const r={method:"POST",...n,...e},l={},c={};await Re(l,"Authorization",i),Te(s,c);let h=n&&n.headers?n.headers:{};return r.headers={...l,...h,...e.headers},{url:Ae(s),options:r}},reportViewing:async(e,t,s={})=>{Ie("reportViewing","itemId",e);const n="/Sessions/Viewing",r=new URL(n,Ee);let l;i&&(l=i.baseOptions);const c={method:"POST",...l,...s},h={},d={};await Re(h,"Authorization",i),t!==void 0&&(d.sessionId=t),e!==void 0&&(d.itemId=e),Te(r,d);let f=l&&l.headers?l.headers:{};return c.headers={...h,...f,...s.headers},{url:Ae(r),options:c}},sendFullGeneralCommand:async(e,t,s={})=>{Ie("sendFullGeneralCommand","sessionId",e),Ie("sendFullGeneralCommand","generalCommand",t);const n="/Sessions/{sessionId}/Command".replace("{sessionId}",encodeURIComponent(String(e))),r=new URL(n,Ee);let l;i&&(l=i.baseOptions);const c={method:"POST",...l,...s},h={},d={};await Re(h,"Authorization",i),h["Content-Type"]="application/json",Te(r,d);let f=l&&l.headers?l.headers:{};return c.headers={...h,...f,...s.headers},c.data=ws(t,c,i),{url:Ae(r),options:c}},sendGeneralCommand:async(e,t,s={})=>{Ie("sendGeneralCommand","sessionId",e),Ie("sendGeneralCommand","command",t);const n="/Sessions/{sessionId}/Command/{command}".replace("{sessionId}",encodeURIComponent(String(e))).replace("{command}",encodeURIComponent(String(t))),r=new URL(n,Ee);let l;i&&(l=i.baseOptions);const c={method:"POST",...l,...s},h={},d={};await Re(h,"Authorization",i),Te(r,d);let f=l&&l.headers?l.headers:{};return c.headers={...h,...f,...s.headers},{url:Ae(r),options:c}},sendMessageCommand:async(e,t,s={})=>{Ie("sendMessageCommand","sessionId",e),Ie("sendMessageCommand","messageCommand",t);const n="/Sessions/{sessionId}/Message".replace("{sessionId}",encodeURIComponent(String(e))),r=new URL(n,Ee);let l;i&&(l=i.baseOptions);const c={method:"POST",...l,...s},h={},d={};await Re(h,"Authorization",i),h["Content-Type"]="application/json",Te(r,d);let f=l&&l.headers?l.headers:{};return c.headers={...h,...f,...s.headers},c.data=ws(t,c,i),{url:Ae(r),options:c}},sendPlaystateCommand:async(e,t,s,n,r={})=>{Ie("sendPlaystateCommand","sessionId",e),Ie("sendPlaystateCommand","command",t);const l="/Sessions/{sessionId}/Playing/{command}".replace("{sessionId}",encodeURIComponent(String(e))).replace("{command}",encodeURIComponent(String(t))),c=new URL(l,Ee);let h;i&&(h=i.baseOptions);const d={method:"POST",...h,...r},f={},p={};await Re(f,"Authorization",i),s!==void 0&&(p.seekPositionTicks=s),n!==void 0&&(p.controllingUserId=n),Te(c,p);let v=h&&h.headers?h.headers:{};return d.headers={...f,...v,...r.headers},{url:Ae(c),options:d}},sendSystemCommand:async(e,t,s={})=>{Ie("sendSystemCommand","sessionId",e),Ie("sendSystemCommand","command",t);const n="/Sessions/{sessionId}/System/{command}".replace("{sessionId}",encodeURIComponent(String(e))).replace("{command}",encodeURIComponent(String(t))),r=new URL(n,Ee);let l;i&&(l=i.baseOptions);const c={method:"POST",...l,...s},h={},d={};await Re(h,"Authorization",i),Te(r,d);let f=l&&l.headers?l.headers:{};return c.headers={...h,...f,...s.headers},{url:Ae(r),options:c}}}},Es=function(i){const e=WR(i);return{async addUserToSession(t,s,n){var r,l,c;const h=await e.addUserToSession(t,s,n),d=(r=i?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=be["SessionApi.addUserToSession"])===null||l===void 0?void 0:l[d])===null||c===void 0?void 0:c.url;return(p,v)=>_e(h,ue,Se,i)(p,f||v)},async displayContent(t,s,n,r,l){var c,h,d;const f=await e.displayContent(t,s,n,r,l),p=(c=i?.serverIndex)!==null&&c!==void 0?c:0,v=(d=(h=be["SessionApi.displayContent"])===null||h===void 0?void 0:h[p])===null||d===void 0?void 0:d.url;return(x,S)=>_e(f,ue,Se,i)(x,v||S)},async getAuthProviders(t){var s,n,r;const l=await e.getAuthProviders(t),c=(s=i?.serverIndex)!==null&&s!==void 0?s:0,h=(r=(n=be["SessionApi.getAuthProviders"])===null||n===void 0?void 0:n[c])===null||r===void 0?void 0:r.url;return(d,f)=>_e(l,ue,Se,i)(d,h||f)},async getPasswordResetProviders(t){var s,n,r;const l=await e.getPasswordResetProviders(t),c=(s=i?.serverIndex)!==null&&s!==void 0?s:0,h=(r=(n=be["SessionApi.getPasswordResetProviders"])===null||n===void 0?void 0:n[c])===null||r===void 0?void 0:r.url;return(d,f)=>_e(l,ue,Se,i)(d,h||f)},async getSessions(t,s,n,r){var l,c,h;const d=await e.getSessions(t,s,n,r),f=(l=i?.serverIndex)!==null&&l!==void 0?l:0,p=(h=(c=be["SessionApi.getSessions"])===null||c===void 0?void 0:c[f])===null||h===void 0?void 0:h.url;return(v,x)=>_e(d,ue,Se,i)(v,p||x)},async play(t,s,n,r,l,c,h,d,f){var p,v,x;const S=await e.play(t,s,n,r,l,c,h,d,f),T=(p=i?.serverIndex)!==null&&p!==void 0?p:0,E=(x=(v=be["SessionApi.play"])===null||v===void 0?void 0:v[T])===null||x===void 0?void 0:x.url;return(A,_)=>_e(S,ue,Se,i)(A,E||_)},async postCapabilities(t,s,n,r,l,c){var h,d,f;const p=await e.postCapabilities(t,s,n,r,l,c),v=(h=i?.serverIndex)!==null&&h!==void 0?h:0,x=(f=(d=be["SessionApi.postCapabilities"])===null||d===void 0?void 0:d[v])===null||f===void 0?void 0:f.url;return(S,T)=>_e(p,ue,Se,i)(S,x||T)},async postFullCapabilities(t,s,n){var r,l,c;const h=await e.postFullCapabilities(t,s,n),d=(r=i?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=be["SessionApi.postFullCapabilities"])===null||l===void 0?void 0:l[d])===null||c===void 0?void 0:c.url;return(p,v)=>_e(h,ue,Se,i)(p,f||v)},async removeUserFromSession(t,s,n){var r,l,c;const h=await e.removeUserFromSession(t,s,n),d=(r=i?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=be["SessionApi.removeUserFromSession"])===null||l===void 0?void 0:l[d])===null||c===void 0?void 0:c.url;return(p,v)=>_e(h,ue,Se,i)(p,f||v)},async reportSessionEnded(t){var s,n,r;const l=await e.reportSessionEnded(t),c=(s=i?.serverIndex)!==null&&s!==void 0?s:0,h=(r=(n=be["SessionApi.reportSessionEnded"])===null||n===void 0?void 0:n[c])===null||r===void 0?void 0:r.url;return(d,f)=>_e(l,ue,Se,i)(d,h||f)},async reportViewing(t,s,n){var r,l,c;const h=await e.reportViewing(t,s,n),d=(r=i?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=be["SessionApi.reportViewing"])===null||l===void 0?void 0:l[d])===null||c===void 0?void 0:c.url;return(p,v)=>_e(h,ue,Se,i)(p,f||v)},async sendFullGeneralCommand(t,s,n){var r,l,c;const h=await e.sendFullGeneralCommand(t,s,n),d=(r=i?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=be["SessionApi.sendFullGeneralCommand"])===null||l===void 0?void 0:l[d])===null||c===void 0?void 0:c.url;return(p,v)=>_e(h,ue,Se,i)(p,f||v)},async sendGeneralCommand(t,s,n){var r,l,c;const h=await e.sendGeneralCommand(t,s,n),d=(r=i?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=be["SessionApi.sendGeneralCommand"])===null||l===void 0?void 0:l[d])===null||c===void 0?void 0:c.url;return(p,v)=>_e(h,ue,Se,i)(p,f||v)},async sendMessageCommand(t,s,n){var r,l,c;const h=await e.sendMessageCommand(t,s,n),d=(r=i?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=be["SessionApi.sendMessageCommand"])===null||l===void 0?void 0:l[d])===null||c===void 0?void 0:c.url;return(p,v)=>_e(h,ue,Se,i)(p,f||v)},async sendPlaystateCommand(t,s,n,r,l){var c,h,d;const f=await e.sendPlaystateCommand(t,s,n,r,l),p=(c=i?.serverIndex)!==null&&c!==void 0?c:0,v=(d=(h=be["SessionApi.sendPlaystateCommand"])===null||h===void 0?void 0:h[p])===null||d===void 0?void 0:d.url;return(x,S)=>_e(f,ue,Se,i)(x,v||S)},async sendSystemCommand(t,s,n){var r,l,c;const h=await e.sendSystemCommand(t,s,n),d=(r=i?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=be["SessionApi.sendSystemCommand"])===null||l===void 0?void 0:l[d])===null||c===void 0?void 0:c.url;return(p,v)=>_e(h,ue,Se,i)(p,f||v)}}};class ZR extends Tn{addUserToSession(e,t){return Es(this.configuration).addUserToSession(e.sessionId,e.userId,t).then(s=>s(this.axios,this.basePath))}displayContent(e,t){return Es(this.configuration).displayContent(e.sessionId,e.itemType,e.itemId,e.itemName,t).then(s=>s(this.axios,this.basePath))}getAuthProviders(e){return Es(this.configuration).getAuthProviders(e).then(t=>t(this.axios,this.basePath))}getPasswordResetProviders(e){return Es(this.configuration).getPasswordResetProviders(e).then(t=>t(this.axios,this.basePath))}getSessions(e={},t){return Es(this.configuration).getSessions(e.controllableByUserId,e.deviceId,e.activeWithinSeconds,t).then(s=>s(this.axios,this.basePath))}play(e,t){return Es(this.configuration).play(e.sessionId,e.playCommand,e.itemIds,e.startPositionTicks,e.mediaSourceId,e.audioStreamIndex,e.subtitleStreamIndex,e.startIndex,t).then(s=>s(this.axios,this.basePath))}postCapabilities(e={},t){return Es(this.configuration).postCapabilities(e.id,e.playableMediaTypes,e.supportedCommands,e.supportsMediaControl,e.supportsPersistentIdentifier,t).then(s=>s(this.axios,this.basePath))}postFullCapabilities(e,t){return Es(this.configuration).postFullCapabilities(e.clientCapabilitiesDto,e.id,t).then(s=>s(this.axios,this.basePath))}removeUserFromSession(e,t){return Es(this.configuration).removeUserFromSession(e.sessionId,e.userId,t).then(s=>s(this.axios,this.basePath))}reportSessionEnded(e){return Es(this.configuration).reportSessionEnded(e).then(t=>t(this.axios,this.basePath))}reportViewing(e,t){return Es(this.configuration).reportViewing(e.itemId,e.sessionId,t).then(s=>s(this.axios,this.basePath))}sendFullGeneralCommand(e,t){return Es(this.configuration).sendFullGeneralCommand(e.sessionId,e.generalCommand,t).then(s=>s(this.axios,this.basePath))}sendGeneralCommand(e,t){return Es(this.configuration).sendGeneralCommand(e.sessionId,e.command,t).then(s=>s(this.axios,this.basePath))}sendMessageCommand(e,t){return Es(this.configuration).sendMessageCommand(e.sessionId,e.messageCommand,t).then(s=>s(this.axios,this.basePath))}sendPlaystateCommand(e,t){return Es(this.configuration).sendPlaystateCommand(e.sessionId,e.command,e.seekPositionTicks,e.controllingUserId,t).then(s=>s(this.axios,this.basePath))}sendSystemCommand(e,t){return Es(this.configuration).sendSystemCommand(e.sessionId,e.command,t).then(s=>s(this.axios,this.basePath))}}class JR extends ZR{constructor(e){super(e.configuration,void 0,e.axiosInstance),this.api=e}reportSessionEnded(e){return super.reportSessionEnded(e).then(t=>(this.api.accessToken="",t))}}function eL(i){return new JR(i)}const tL=function(i){return{authenticateUserByName:async(e,t={})=>{Ie("authenticateUserByName","authenticateUserByName",e);const s="/Users/AuthenticateByName",n=new URL(s,Ee);let r;i&&(r=i.baseOptions);const l={method:"POST",...r,...t},c={},h={};c["Content-Type"]="application/json",Te(n,h);let d=r&&r.headers?r.headers:{};return l.headers={...c,...d,...t.headers},l.data=ws(e,l,i),{url:Ae(n),options:l}},authenticateWithQuickConnect:async(e,t={})=>{Ie("authenticateWithQuickConnect","quickConnectDto",e);const s="/Users/AuthenticateWithQuickConnect",n=new URL(s,Ee);let r;i&&(r=i.baseOptions);const l={method:"POST",...r,...t},c={},h={};c["Content-Type"]="application/json",Te(n,h);let d=r&&r.headers?r.headers:{};return l.headers={...c,...d,...t.headers},l.data=ws(e,l,i),{url:Ae(n),options:l}},createUserByName:async(e,t={})=>{Ie("createUserByName","createUserByName",e);const s="/Users/New",n=new URL(s,Ee);let r;i&&(r=i.baseOptions);const l={method:"POST",...r,...t},c={},h={};await Re(c,"Authorization",i),c["Content-Type"]="application/json",Te(n,h);let d=r&&r.headers?r.headers:{};return l.headers={...c,...d,...t.headers},l.data=ws(e,l,i),{url:Ae(n),options:l}},deleteUser:async(e,t={})=>{Ie("deleteUser","userId",e);const s="/Users/{userId}".replace("{userId}",encodeURIComponent(String(e))),n=new URL(s,Ee);let r;i&&(r=i.baseOptions);const l={method:"DELETE",...r,...t},c={},h={};await Re(c,"Authorization",i),Te(n,h);let d=r&&r.headers?r.headers:{};return l.headers={...c,...d,...t.headers},{url:Ae(n),options:l}},forgotPassword:async(e,t={})=>{Ie("forgotPassword","forgotPasswordDto",e);const s="/Users/ForgotPassword",n=new URL(s,Ee);let r;i&&(r=i.baseOptions);const l={method:"POST",...r,...t},c={},h={};c["Content-Type"]="application/json",Te(n,h);let d=r&&r.headers?r.headers:{};return l.headers={...c,...d,...t.headers},l.data=ws(e,l,i),{url:Ae(n),options:l}},forgotPasswordPin:async(e,t={})=>{Ie("forgotPasswordPin","forgotPasswordPinDto",e);const s="/Users/ForgotPassword/Pin",n=new URL(s,Ee);let r;i&&(r=i.baseOptions);const l={method:"POST",...r,...t},c={},h={};c["Content-Type"]="application/json",Te(n,h);let d=r&&r.headers?r.headers:{};return l.headers={...c,...d,...t.headers},l.data=ws(e,l,i),{url:Ae(n),options:l}},getCurrentUser:async(e={})=>{const t="/Users/Me",s=new URL(t,Ee);let n;i&&(n=i.baseOptions);const r={method:"GET",...n,...e},l={},c={};await Re(l,"Authorization",i),Te(s,c);let h=n&&n.headers?n.headers:{};return r.headers={...l,...h,...e.headers},{url:Ae(s),options:r}},getPublicUsers:async(e={})=>{const t="/Users/Public",s=new URL(t,Ee);let n;i&&(n=i.baseOptions);const r={method:"GET",...n,...e},l={};Te(s,{});let h=n&&n.headers?n.headers:{};return r.headers={...l,...h,...e.headers},{url:Ae(s),options:r}},getUserById:async(e,t={})=>{Ie("getUserById","userId",e);const s="/Users/{userId}".replace("{userId}",encodeURIComponent(String(e))),n=new URL(s,Ee);let r;i&&(r=i.baseOptions);const l={method:"GET",...r,...t},c={},h={};await Re(c,"Authorization",i),Te(n,h);let d=r&&r.headers?r.headers:{};return l.headers={...c,...d,...t.headers},{url:Ae(n),options:l}},getUsers:async(e,t,s={})=>{const n="/Users",r=new URL(n,Ee);let l;i&&(l=i.baseOptions);const c={method:"GET",...l,...s},h={},d={};await Re(h,"Authorization",i),e!==void 0&&(d.isHidden=e),t!==void 0&&(d.isDisabled=t),Te(r,d);let f=l&&l.headers?l.headers:{};return c.headers={...h,...f,...s.headers},{url:Ae(r),options:c}},updateUser:async(e,t,s={})=>{Ie("updateUser","userDto",e);const n="/Users",r=new URL(n,Ee);let l;i&&(l=i.baseOptions);const c={method:"POST",...l,...s},h={},d={};await Re(h,"Authorization",i),t!==void 0&&(d.userId=t),h["Content-Type"]="application/json",Te(r,d);let f=l&&l.headers?l.headers:{};return c.headers={...h,...f,...s.headers},c.data=ws(e,c,i),{url:Ae(r),options:c}},updateUserConfiguration:async(e,t,s={})=>{Ie("updateUserConfiguration","userConfiguration",e);const n="/Users/Configuration",r=new URL(n,Ee);let l;i&&(l=i.baseOptions);const c={method:"POST",...l,...s},h={},d={};await Re(h,"Authorization",i),t!==void 0&&(d.userId=t),h["Content-Type"]="application/json",Te(r,d);let f=l&&l.headers?l.headers:{};return c.headers={...h,...f,...s.headers},c.data=ws(e,c,i),{url:Ae(r),options:c}},updateUserPassword:async(e,t,s={})=>{Ie("updateUserPassword","updateUserPassword",e);const n="/Users/Password",r=new URL(n,Ee);let l;i&&(l=i.baseOptions);const c={method:"POST",...l,...s},h={},d={};await Re(h,"Authorization",i),t!==void 0&&(d.userId=t),h["Content-Type"]="application/json",Te(r,d);let f=l&&l.headers?l.headers:{};return c.headers={...h,...f,...s.headers},c.data=ws(e,c,i),{url:Ae(r),options:c}},updateUserPolicy:async(e,t,s={})=>{Ie("updateUserPolicy","userId",e),Ie("updateUserPolicy","userPolicy",t);const n="/Users/{userId}/Policy".replace("{userId}",encodeURIComponent(String(e))),r=new URL(n,Ee);let l;i&&(l=i.baseOptions);const c={method:"POST",...l,...s},h={},d={};await Re(h,"Authorization",i),h["Content-Type"]="application/json",Te(r,d);let f=l&&l.headers?l.headers:{};return c.headers={...h,...f,...s.headers},c.data=ws(t,c,i),{url:Ae(r),options:c}}}},js=function(i){const e=tL(i);return{async authenticateUserByName(t,s){var n,r,l;const c=await e.authenticateUserByName(t,s),h=(n=i?.serverIndex)!==null&&n!==void 0?n:0,d=(l=(r=be["UserApi.authenticateUserByName"])===null||r===void 0?void 0:r[h])===null||l===void 0?void 0:l.url;return(f,p)=>_e(c,ue,Se,i)(f,d||p)},async authenticateWithQuickConnect(t,s){var n,r,l;const c=await e.authenticateWithQuickConnect(t,s),h=(n=i?.serverIndex)!==null&&n!==void 0?n:0,d=(l=(r=be["UserApi.authenticateWithQuickConnect"])===null||r===void 0?void 0:r[h])===null||l===void 0?void 0:l.url;return(f,p)=>_e(c,ue,Se,i)(f,d||p)},async createUserByName(t,s){var n,r,l;const c=await e.createUserByName(t,s),h=(n=i?.serverIndex)!==null&&n!==void 0?n:0,d=(l=(r=be["UserApi.createUserByName"])===null||r===void 0?void 0:r[h])===null||l===void 0?void 0:l.url;return(f,p)=>_e(c,ue,Se,i)(f,d||p)},async deleteUser(t,s){var n,r,l;const c=await e.deleteUser(t,s),h=(n=i?.serverIndex)!==null&&n!==void 0?n:0,d=(l=(r=be["UserApi.deleteUser"])===null||r===void 0?void 0:r[h])===null||l===void 0?void 0:l.url;return(f,p)=>_e(c,ue,Se,i)(f,d||p)},async forgotPassword(t,s){var n,r,l;const c=await e.forgotPassword(t,s),h=(n=i?.serverIndex)!==null&&n!==void 0?n:0,d=(l=(r=be["UserApi.forgotPassword"])===null||r===void 0?void 0:r[h])===null||l===void 0?void 0:l.url;return(f,p)=>_e(c,ue,Se,i)(f,d||p)},async forgotPasswordPin(t,s){var n,r,l;const c=await e.forgotPasswordPin(t,s),h=(n=i?.serverIndex)!==null&&n!==void 0?n:0,d=(l=(r=be["UserApi.forgotPasswordPin"])===null||r===void 0?void 0:r[h])===null||l===void 0?void 0:l.url;return(f,p)=>_e(c,ue,Se,i)(f,d||p)},async getCurrentUser(t){var s,n,r;const l=await e.getCurrentUser(t),c=(s=i?.serverIndex)!==null&&s!==void 0?s:0,h=(r=(n=be["UserApi.getCurrentUser"])===null||n===void 0?void 0:n[c])===null||r===void 0?void 0:r.url;return(d,f)=>_e(l,ue,Se,i)(d,h||f)},async getPublicUsers(t){var s,n,r;const l=await e.getPublicUsers(t),c=(s=i?.serverIndex)!==null&&s!==void 0?s:0,h=(r=(n=be["UserApi.getPublicUsers"])===null||n===void 0?void 0:n[c])===null||r===void 0?void 0:r.url;return(d,f)=>_e(l,ue,Se,i)(d,h||f)},async getUserById(t,s){var n,r,l;const c=await e.getUserById(t,s),h=(n=i?.serverIndex)!==null&&n!==void 0?n:0,d=(l=(r=be["UserApi.getUserById"])===null||r===void 0?void 0:r[h])===null||l===void 0?void 0:l.url;return(f,p)=>_e(c,ue,Se,i)(f,d||p)},async getUsers(t,s,n){var r,l,c;const h=await e.getUsers(t,s,n),d=(r=i?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=be["UserApi.getUsers"])===null||l===void 0?void 0:l[d])===null||c===void 0?void 0:c.url;return(p,v)=>_e(h,ue,Se,i)(p,f||v)},async updateUser(t,s,n){var r,l,c;const h=await e.updateUser(t,s,n),d=(r=i?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=be["UserApi.updateUser"])===null||l===void 0?void 0:l[d])===null||c===void 0?void 0:c.url;return(p,v)=>_e(h,ue,Se,i)(p,f||v)},async updateUserConfiguration(t,s,n){var r,l,c;const h=await e.updateUserConfiguration(t,s,n),d=(r=i?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=be["UserApi.updateUserConfiguration"])===null||l===void 0?void 0:l[d])===null||c===void 0?void 0:c.url;return(p,v)=>_e(h,ue,Se,i)(p,f||v)},async updateUserPassword(t,s,n){var r,l,c;const h=await e.updateUserPassword(t,s,n),d=(r=i?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=be["UserApi.updateUserPassword"])===null||l===void 0?void 0:l[d])===null||c===void 0?void 0:c.url;return(p,v)=>_e(h,ue,Se,i)(p,f||v)},async updateUserPolicy(t,s,n){var r,l,c;const h=await e.updateUserPolicy(t,s,n),d=(r=i?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=be["UserApi.updateUserPolicy"])===null||l===void 0?void 0:l[d])===null||c===void 0?void 0:c.url;return(p,v)=>_e(h,ue,Se,i)(p,f||v)}}};class dS extends Tn{authenticateUserByName(e,t){return js(this.configuration).authenticateUserByName(e.authenticateUserByName,t).then(s=>s(this.axios,this.basePath))}authenticateWithQuickConnect(e,t){return js(this.configuration).authenticateWithQuickConnect(e.quickConnectDto,t).then(s=>s(this.axios,this.basePath))}createUserByName(e,t){return js(this.configuration).createUserByName(e.createUserByName,t).then(s=>s(this.axios,this.basePath))}deleteUser(e,t){return js(this.configuration).deleteUser(e.userId,t).then(s=>s(this.axios,this.basePath))}forgotPassword(e,t){return js(this.configuration).forgotPassword(e.forgotPasswordDto,t).then(s=>s(this.axios,this.basePath))}forgotPasswordPin(e,t){return js(this.configuration).forgotPasswordPin(e.forgotPasswordPinDto,t).then(s=>s(this.axios,this.basePath))}getCurrentUser(e){return js(this.configuration).getCurrentUser(e).then(t=>t(this.axios,this.basePath))}getPublicUsers(e){return js(this.configuration).getPublicUsers(e).then(t=>t(this.axios,this.basePath))}getUserById(e,t){return js(this.configuration).getUserById(e.userId,t).then(s=>s(this.axios,this.basePath))}getUsers(e={},t){return js(this.configuration).getUsers(e.isHidden,e.isDisabled,t).then(s=>s(this.axios,this.basePath))}updateUser(e,t){return js(this.configuration).updateUser(e.userDto,e.userId,t).then(s=>s(this.axios,this.basePath))}updateUserConfiguration(e,t){return js(this.configuration).updateUserConfiguration(e.userConfiguration,e.userId,t).then(s=>s(this.axios,this.basePath))}updateUserPassword(e,t){return js(this.configuration).updateUserPassword(e.updateUserPassword,e.userId,t).then(s=>s(this.axios,this.basePath))}updateUserPolicy(e,t){return js(this.configuration).updateUserPolicy(e.userId,e.userPolicy,t).then(s=>s(this.axios,this.basePath))}}class sL extends dS{constructor(e){super(e.configuration,void 0,e.axiosInstance),this.api=e}authenticateUserByName(e,t){return super.authenticateUserByName(e,t).then(s=>(this.api.accessToken=s.data.AccessToken||"",s))}authenticateWithQuickConnect(e,t){return super.authenticateWithQuickConnect(e,t).then(s=>(this.api.accessToken=s.data.AccessToken||"",s))}}function iL(i){return new sL(i)}const nL="Authorization";class aL{constructor(e,t,s,n="",r=ue){this.basePath=e.endsWith("/")?e.slice(0,-1):e,this.clientInfo=t,this.deviceInfo=s,this.accessToken=n,this.axiosInstance=r}get configuration(){return new XR({basePath:this.basePath,baseOptions:{headers:{[nL]:this.authorizationHeader}}})}authenticateUserByName(e,t){return iL(this).authenticateUserByName({authenticateUserByName:{Username:e,Pw:t}})}getUri(e,t){return this.axiosInstance.getUri({baseURL:this.basePath,url:e,params:t})}logout(){return eL(this).reportSessionEnded()}get authorizationHeader(){return QR(this.clientInfo,this.deviceInfo,this.accessToken)}}class rL{constructor(e){this.clientInfo=e.clientInfo,this.deviceInfo=e.deviceInfo,this.discovery=new qR(this)}createApi(e,t,s){return new aL(e,this.clientInfo,this.deviceInfo,t,s)}}const lL=function(i){return{deleteUserItemRating:async(e,t,s={})=>{Ie("deleteUserItemRating","itemId",e);const n="/UserItems/{itemId}/Rating".replace("{itemId}",encodeURIComponent(String(e))),r=new URL(n,Ee);let l;i&&(l=i.baseOptions);const c={method:"DELETE",...l,...s},h={},d={};await Re(h,"Authorization",i),t!==void 0&&(d.userId=t),Te(r,d);let f=l&&l.headers?l.headers:{};return c.headers={...h,...f,...s.headers},{url:Ae(r),options:c}},getIntros:async(e,t,s={})=>{Ie("getIntros","itemId",e);const n="/Items/{itemId}/Intros".replace("{itemId}",encodeURIComponent(String(e))),r=new URL(n,Ee);let l;i&&(l=i.baseOptions);const c={method:"GET",...l,...s},h={},d={};await Re(h,"Authorization",i),t!==void 0&&(d.userId=t),Te(r,d);let f=l&&l.headers?l.headers:{};return c.headers={...h,...f,...s.headers},{url:Ae(r),options:c}},getItem:async(e,t,s={})=>{Ie("getItem","itemId",e);const n="/Items/{itemId}".replace("{itemId}",encodeURIComponent(String(e))),r=new URL(n,Ee);let l;i&&(l=i.baseOptions);const c={method:"GET",...l,...s},h={},d={};await Re(h,"Authorization",i),t!==void 0&&(d.userId=t),Te(r,d);let f=l&&l.headers?l.headers:{};return c.headers={...h,...f,...s.headers},{url:Ae(r),options:c}},getLatestMedia:async(e,t,s,n,r,l,c,h,d,f,p,v={})=>{const x="/Items/Latest",S=new URL(x,Ee);let T;i&&(T=i.baseOptions);const E={method:"GET",...T,...v},A={},_={};await Re(A,"Authorization",i),e!==void 0&&(_.userId=e),t!==void 0&&(_.parentId=t),s&&(_.fields=s),n&&(_.includeItemTypes=n),r!==void 0&&(_.isPlayed=r),l!==void 0&&(_.enableImages=l),c!==void 0&&(_.imageTypeLimit=c),h&&(_.enableImageTypes=h),d!==void 0&&(_.enableUserData=d),f!==void 0&&(_.limit=f),p!==void 0&&(_.groupItems=p),Te(S,_);let R=T&&T.headers?T.headers:{};return E.headers={...A,...R,...v.headers},{url:Ae(S),options:E}},getLocalTrailers:async(e,t,s={})=>{Ie("getLocalTrailers","itemId",e);const n="/Items/{itemId}/LocalTrailers".replace("{itemId}",encodeURIComponent(String(e))),r=new URL(n,Ee);let l;i&&(l=i.baseOptions);const c={method:"GET",...l,...s},h={},d={};await Re(h,"Authorization",i),t!==void 0&&(d.userId=t),Te(r,d);let f=l&&l.headers?l.headers:{};return c.headers={...h,...f,...s.headers},{url:Ae(r),options:c}},getRootFolder:async(e,t={})=>{const s="/Items/Root",n=new URL(s,Ee);let r;i&&(r=i.baseOptions);const l={method:"GET",...r,...t},c={},h={};await Re(c,"Authorization",i),e!==void 0&&(h.userId=e),Te(n,h);let d=r&&r.headers?r.headers:{};return l.headers={...c,...d,...t.headers},{url:Ae(n),options:l}},getSpecialFeatures:async(e,t,s={})=>{Ie("getSpecialFeatures","itemId",e);const n="/Items/{itemId}/SpecialFeatures".replace("{itemId}",encodeURIComponent(String(e))),r=new URL(n,Ee);let l;i&&(l=i.baseOptions);const c={method:"GET",...l,...s},h={},d={};await Re(h,"Authorization",i),t!==void 0&&(d.userId=t),Te(r,d);let f=l&&l.headers?l.headers:{};return c.headers={...h,...f,...s.headers},{url:Ae(r),options:c}},markFavoriteItem:async(e,t,s={})=>{Ie("markFavoriteItem","itemId",e);const n="/UserFavoriteItems/{itemId}".replace("{itemId}",encodeURIComponent(String(e))),r=new URL(n,Ee);let l;i&&(l=i.baseOptions);const c={method:"POST",...l,...s},h={},d={};await Re(h,"Authorization",i),t!==void 0&&(d.userId=t),Te(r,d);let f=l&&l.headers?l.headers:{};return c.headers={...h,...f,...s.headers},{url:Ae(r),options:c}},unmarkFavoriteItem:async(e,t,s={})=>{Ie("unmarkFavoriteItem","itemId",e);const n="/UserFavoriteItems/{itemId}".replace("{itemId}",encodeURIComponent(String(e))),r=new URL(n,Ee);let l;i&&(l=i.baseOptions);const c={method:"DELETE",...l,...s},h={},d={};await Re(h,"Authorization",i),t!==void 0&&(d.userId=t),Te(r,d);let f=l&&l.headers?l.headers:{};return c.headers={...h,...f,...s.headers},{url:Ae(r),options:c}},updateUserItemRating:async(e,t,s,n={})=>{Ie("updateUserItemRating","itemId",e);const r="/UserItems/{itemId}/Rating".replace("{itemId}",encodeURIComponent(String(e))),l=new URL(r,Ee);let c;i&&(c=i.baseOptions);const h={method:"POST",...c,...n},d={},f={};await Re(d,"Authorization",i),t!==void 0&&(f.userId=t),s!==void 0&&(f.likes=s),Te(l,f);let p=c&&c.headers?c.headers:{};return h.headers={...d,...p,...n.headers},{url:Ae(l),options:h}}}},Mi=function(i){const e=lL(i);return{async deleteUserItemRating(t,s,n){var r,l,c;const h=await e.deleteUserItemRating(t,s,n),d=(r=i?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=be["UserLibraryApi.deleteUserItemRating"])===null||l===void 0?void 0:l[d])===null||c===void 0?void 0:c.url;return(p,v)=>_e(h,ue,Se,i)(p,f||v)},async getIntros(t,s,n){var r,l,c;const h=await e.getIntros(t,s,n),d=(r=i?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=be["UserLibraryApi.getIntros"])===null||l===void 0?void 0:l[d])===null||c===void 0?void 0:c.url;return(p,v)=>_e(h,ue,Se,i)(p,f||v)},async getItem(t,s,n){var r,l,c;const h=await e.getItem(t,s,n),d=(r=i?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=be["UserLibraryApi.getItem"])===null||l===void 0?void 0:l[d])===null||c===void 0?void 0:c.url;return(p,v)=>_e(h,ue,Se,i)(p,f||v)},async getLatestMedia(t,s,n,r,l,c,h,d,f,p,v,x){var S,T,E;const A=await e.getLatestMedia(t,s,n,r,l,c,h,d,f,p,v,x),_=(S=i?.serverIndex)!==null&&S!==void 0?S:0,R=(E=(T=be["UserLibraryApi.getLatestMedia"])===null||T===void 0?void 0:T[_])===null||E===void 0?void 0:E.url;return(w,N)=>_e(A,ue,Se,i)(w,R||N)},async getLocalTrailers(t,s,n){var r,l,c;const h=await e.getLocalTrailers(t,s,n),d=(r=i?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=be["UserLibraryApi.getLocalTrailers"])===null||l===void 0?void 0:l[d])===null||c===void 0?void 0:c.url;return(p,v)=>_e(h,ue,Se,i)(p,f||v)},async getRootFolder(t,s){var n,r,l;const c=await e.getRootFolder(t,s),h=(n=i?.serverIndex)!==null&&n!==void 0?n:0,d=(l=(r=be["UserLibraryApi.getRootFolder"])===null||r===void 0?void 0:r[h])===null||l===void 0?void 0:l.url;return(f,p)=>_e(c,ue,Se,i)(f,d||p)},async getSpecialFeatures(t,s,n){var r,l,c;const h=await e.getSpecialFeatures(t,s,n),d=(r=i?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=be["UserLibraryApi.getSpecialFeatures"])===null||l===void 0?void 0:l[d])===null||c===void 0?void 0:c.url;return(p,v)=>_e(h,ue,Se,i)(p,f||v)},async markFavoriteItem(t,s,n){var r,l,c;const h=await e.markFavoriteItem(t,s,n),d=(r=i?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=be["UserLibraryApi.markFavoriteItem"])===null||l===void 0?void 0:l[d])===null||c===void 0?void 0:c.url;return(p,v)=>_e(h,ue,Se,i)(p,f||v)},async unmarkFavoriteItem(t,s,n){var r,l,c;const h=await e.unmarkFavoriteItem(t,s,n),d=(r=i?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=be["UserLibraryApi.unmarkFavoriteItem"])===null||l===void 0?void 0:l[d])===null||c===void 0?void 0:c.url;return(p,v)=>_e(h,ue,Se,i)(p,f||v)},async updateUserItemRating(t,s,n,r){var l,c,h;const d=await e.updateUserItemRating(t,s,n,r),f=(l=i?.serverIndex)!==null&&l!==void 0?l:0,p=(h=(c=be["UserLibraryApi.updateUserItemRating"])===null||c===void 0?void 0:c[f])===null||h===void 0?void 0:h.url;return(v,x)=>_e(d,ue,Se,i)(v,p||x)}}};class oL extends Tn{deleteUserItemRating(e,t){return Mi(this.configuration).deleteUserItemRating(e.itemId,e.userId,t).then(s=>s(this.axios,this.basePath))}getIntros(e,t){return Mi(this.configuration).getIntros(e.itemId,e.userId,t).then(s=>s(this.axios,this.basePath))}getItem(e,t){return Mi(this.configuration).getItem(e.itemId,e.userId,t).then(s=>s(this.axios,this.basePath))}getLatestMedia(e={},t){return Mi(this.configuration).getLatestMedia(e.userId,e.parentId,e.fields,e.includeItemTypes,e.isPlayed,e.enableImages,e.imageTypeLimit,e.enableImageTypes,e.enableUserData,e.limit,e.groupItems,t).then(s=>s(this.axios,this.basePath))}getLocalTrailers(e,t){return Mi(this.configuration).getLocalTrailers(e.itemId,e.userId,t).then(s=>s(this.axios,this.basePath))}getRootFolder(e={},t){return Mi(this.configuration).getRootFolder(e.userId,t).then(s=>s(this.axios,this.basePath))}getSpecialFeatures(e,t){return Mi(this.configuration).getSpecialFeatures(e.itemId,e.userId,t).then(s=>s(this.axios,this.basePath))}markFavoriteItem(e,t){return Mi(this.configuration).markFavoriteItem(e.itemId,e.userId,t).then(s=>s(this.axios,this.basePath))}unmarkFavoriteItem(e,t){return Mi(this.configuration).unmarkFavoriteItem(e.itemId,e.userId,t).then(s=>s(this.axios,this.basePath))}updateUserItemRating(e,t){return Mi(this.configuration).updateUserItemRating(e.itemId,e.userId,e.likes,t).then(s=>s(this.axios,this.basePath))}}const cL=function(i){return{getGroupingOptions:async(e,t={})=>{const s="/UserViews/GroupingOptions",n=new URL(s,Ee);let r;i&&(r=i.baseOptions);const l={method:"GET",...r,...t},c={},h={};await Re(c,"Authorization",i),e!==void 0&&(h.userId=e),Te(n,h);let d=r&&r.headers?r.headers:{};return l.headers={...c,...d,...t.headers},{url:Ae(n),options:l}},getUserViews:async(e,t,s,n,r={})=>{const l="/UserViews",c=new URL(l,Ee);let h;i&&(h=i.baseOptions);const d={method:"GET",...h,...r},f={},p={};await Re(f,"Authorization",i),e!==void 0&&(p.userId=e),t!==void 0&&(p.includeExternalContent=t),s&&(p.presetViews=s),n!==void 0&&(p.includeHidden=n),Te(c,p);let v=h&&h.headers?h.headers:{};return d.headers={...f,...v,...r.headers},{url:Ae(c),options:d}}}},Yv=function(i){const e=cL(i);return{async getGroupingOptions(t,s){var n,r,l;const c=await e.getGroupingOptions(t,s),h=(n=i?.serverIndex)!==null&&n!==void 0?n:0,d=(l=(r=be["UserViewsApi.getGroupingOptions"])===null||r===void 0?void 0:r[h])===null||l===void 0?void 0:l.url;return(f,p)=>_e(c,ue,Se,i)(f,d||p)},async getUserViews(t,s,n,r,l){var c,h,d;const f=await e.getUserViews(t,s,n,r,l),p=(c=i?.serverIndex)!==null&&c!==void 0?c:0,v=(d=(h=be["UserViewsApi.getUserViews"])===null||h===void 0?void 0:h[p])===null||d===void 0?void 0:d.url;return(x,S)=>_e(f,ue,Se,i)(x,v||S)}}};class uL extends Tn{getGroupingOptions(e={},t){return Yv(this.configuration).getGroupingOptions(e.userId,t).then(s=>s(this.axios,this.basePath))}getUserViews(e={},t){return Yv(this.configuration).getUserViews(e.userId,e.includeExternalContent,e.presetViews,e.includeHidden,t).then(s=>s(this.axios,this.basePath))}}const dL=function(i){return{getItemUserData:async(e,t,s={})=>{Ie("getItemUserData","itemId",e);const n="/UserItems/{itemId}/UserData".replace("{itemId}",encodeURIComponent(String(e))),r=new URL(n,Ee);let l;i&&(l=i.baseOptions);const c={method:"GET",...l,...s},h={},d={};await Re(h,"Authorization",i),t!==void 0&&(d.userId=t),Te(r,d);let f=l&&l.headers?l.headers:{};return c.headers={...h,...f,...s.headers},{url:Ae(r),options:c}},getItems:async(e,t,s,n,r,l,c,h,d,f,p,v,x,S,T,E,A,_,R,w,N,U,D,F,j,M,H,K,se,ne,de,k,G,Y,le,me,P,$,ie,fe,ge,ve,Ne,pe,we,ot,ct,zt,_t,xt,os,Ve,Le,Fe,Ze,ut,Oe,Ye,mt,st,Kt,Xt,_s,ye,$e,De,St,xs,ss,It,Wt,Nt,Is,Rt,Mt,is,ns,ri,Hs,zs,li,An,qi,Ai,Ss,Qi,Xi={})=>{const _n="/Items",ce=new URL(_n,Ee);let Pe;i&&(Pe=i.baseOptions);const Je={method:"GET",...Pe,...Xi},Rs={},xe={};await Re(Rs,"Authorization",i),e!==void 0&&(xe.userId=e),t!==void 0&&(xe.maxOfficialRating=t),s!==void 0&&(xe.hasThemeSong=s),n!==void 0&&(xe.hasThemeVideo=n),r!==void 0&&(xe.hasSubtitles=r),l!==void 0&&(xe.hasSpecialFeature=l),c!==void 0&&(xe.hasTrailer=c),h!==void 0&&(xe.adjacentTo=h),d!==void 0&&(xe.indexNumber=d),f!==void 0&&(xe.parentIndexNumber=f),p!==void 0&&(xe.hasParentalRating=p),v!==void 0&&(xe.isHd=v),x!==void 0&&(xe.is4K=x),S&&(xe.locationTypes=S),T&&(xe.excludeLocationTypes=T),E!==void 0&&(xe.isMissing=E),A!==void 0&&(xe.isUnaired=A),_!==void 0&&(xe.minCommunityRating=_),R!==void 0&&(xe.minCriticRating=R),w!==void 0&&(xe.minPremiereDate=w instanceof Date?w.toISOString():w),N!==void 0&&(xe.minDateLastSaved=N instanceof Date?N.toISOString():N),U!==void 0&&(xe.minDateLastSavedForUser=U instanceof Date?U.toISOString():U),D!==void 0&&(xe.maxPremiereDate=D instanceof Date?D.toISOString():D),F!==void 0&&(xe.hasOverview=F),j!==void 0&&(xe.hasImdbId=j),M!==void 0&&(xe.hasTmdbId=M),H!==void 0&&(xe.hasTvdbId=H),K!==void 0&&(xe.isMovie=K),se!==void 0&&(xe.isSeries=se),ne!==void 0&&(xe.isNews=ne),de!==void 0&&(xe.isKids=de),k!==void 0&&(xe.isSports=k),G&&(xe.excludeItemIds=G),Y!==void 0&&(xe.startIndex=Y),le!==void 0&&(xe.limit=le),me!==void 0&&(xe.recursive=me),P!==void 0&&(xe.searchTerm=P),$&&(xe.sortOrder=$),ie!==void 0&&(xe.parentId=ie),fe&&(xe.fields=fe),ge&&(xe.excludeItemTypes=ge),ve&&(xe.includeItemTypes=ve),Ne&&(xe.filters=Ne),pe!==void 0&&(xe.isFavorite=pe),we&&(xe.mediaTypes=we),ot&&(xe.imageTypes=ot),ct&&(xe.sortBy=ct),zt!==void 0&&(xe.isPlayed=zt),_t&&(xe.genres=_t),xt&&(xe.officialRatings=xt),os&&(xe.tags=os),Ve&&(xe.years=Ve),Le!==void 0&&(xe.enableUserData=Le),Fe!==void 0&&(xe.imageTypeLimit=Fe),Ze&&(xe.enableImageTypes=Ze),ut!==void 0&&(xe.person=ut),Oe&&(xe.personIds=Oe),Ye&&(xe.personTypes=Ye),mt&&(xe.studios=mt),st&&(xe.artists=st),Kt&&(xe.excludeArtistIds=Kt),Xt&&(xe.artistIds=Xt),_s&&(xe.albumArtistIds=_s),ye&&(xe.contributingArtistIds=ye),$e&&(xe.albums=$e),De&&(xe.albumIds=De),St&&(xe.ids=St),xs&&(xe.videoTypes=xs),ss!==void 0&&(xe.minOfficialRating=ss),It!==void 0&&(xe.isLocked=It),Wt!==void 0&&(xe.isPlaceHolder=Wt),Nt!==void 0&&(xe.hasOfficialRating=Nt),Is!==void 0&&(xe.collapseBoxSetItems=Is),Rt!==void 0&&(xe.minWidth=Rt),Mt!==void 0&&(xe.minHeight=Mt),is!==void 0&&(xe.maxWidth=is),ns!==void 0&&(xe.maxHeight=ns),ri!==void 0&&(xe.is3D=ri),Hs&&(xe.seriesStatus=Hs),zs!==void 0&&(xe.nameStartsWithOrGreater=zs),li!==void 0&&(xe.nameStartsWith=li),An!==void 0&&(xe.nameLessThan=An),qi&&(xe.studioIds=qi),Ai&&(xe.genreIds=Ai),Ss!==void 0&&(xe.enableTotalRecordCount=Ss),Qi!==void 0&&(xe.enableImages=Qi),Te(ce,xe);let Os=Pe&&Pe.headers?Pe.headers:{};return Je.headers={...Rs,...Os,...Xi.headers},{url:Ae(ce),options:Je}},getResumeItems:async(e,t,s,n,r,l,c,h,d,f,p,v,x,S,T,E={})=>{const A="/UserItems/Resume",_=new URL(A,Ee);let R;i&&(R=i.baseOptions);const w={method:"GET",...R,...E},N={},U={};await Re(N,"Authorization",i),e!==void 0&&(U.userId=e),t!==void 0&&(U.startIndex=t),s!==void 0&&(U.limit=s),n!==void 0&&(U.searchTerm=n),r!==void 0&&(U.parentId=r),l&&(U.fields=l),c&&(U.mediaTypes=c),h!==void 0&&(U.enableUserData=h),d!==void 0&&(U.imageTypeLimit=d),f&&(U.enableImageTypes=f),p&&(U.excludeItemTypes=p),v&&(U.includeItemTypes=v),x!==void 0&&(U.enableTotalRecordCount=x),S!==void 0&&(U.enableImages=S),T!==void 0&&(U.excludeActiveSessions=T),Te(_,U);let D=R&&R.headers?R.headers:{};return w.headers={...N,...D,...E.headers},{url:Ae(_),options:w}},updateItemUserData:async(e,t,s,n={})=>{Ie("updateItemUserData","itemId",e),Ie("updateItemUserData","updateUserItemDataDto",t);const r="/UserItems/{itemId}/UserData".replace("{itemId}",encodeURIComponent(String(e))),l=new URL(r,Ee);let c;i&&(c=i.baseOptions);const h={method:"POST",...c,...n},d={},f={};await Re(d,"Authorization",i),s!==void 0&&(f.userId=s),d["Content-Type"]="application/json",Te(l,f);let p=c&&c.headers?c.headers:{};return h.headers={...d,...p,...n.headers},h.data=ws(t,h,i),{url:Ae(l),options:h}}}},uc=function(i){const e=dL(i);return{async getItemUserData(t,s,n){var r,l,c;const h=await e.getItemUserData(t,s,n),d=(r=i?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=be["ItemsApi.getItemUserData"])===null||l===void 0?void 0:l[d])===null||c===void 0?void 0:c.url;return(p,v)=>_e(h,ue,Se,i)(p,f||v)},async getItems(t,s,n,r,l,c,h,d,f,p,v,x,S,T,E,A,_,R,w,N,U,D,F,j,M,H,K,se,ne,de,k,G,Y,le,me,P,$,ie,fe,ge,ve,Ne,pe,we,ot,ct,zt,_t,xt,os,Ve,Le,Fe,Ze,ut,Oe,Ye,mt,st,Kt,Xt,_s,ye,$e,De,St,xs,ss,It,Wt,Nt,Is,Rt,Mt,is,ns,ri,Hs,zs,li,An,qi,Ai,Ss,Qi,Xi,_n){var ce,Pe,Je;const Rs=await e.getItems(t,s,n,r,l,c,h,d,f,p,v,x,S,T,E,A,_,R,w,N,U,D,F,j,M,H,K,se,ne,de,k,G,Y,le,me,P,$,ie,fe,ge,ve,Ne,pe,we,ot,ct,zt,_t,xt,os,Ve,Le,Fe,Ze,ut,Oe,Ye,mt,st,Kt,Xt,_s,ye,$e,De,St,xs,ss,It,Wt,Nt,Is,Rt,Mt,is,ns,ri,Hs,zs,li,An,qi,Ai,Ss,Qi,Xi,_n),xe=(ce=i?.serverIndex)!==null&&ce!==void 0?ce:0,Os=(Je=(Pe=be["ItemsApi.getItems"])===null||Pe===void 0?void 0:Pe[xe])===null||Je===void 0?void 0:Je.url;return(Lt,Dt)=>_e(Rs,ue,Se,i)(Lt,Os||Dt)},async getResumeItems(t,s,n,r,l,c,h,d,f,p,v,x,S,T,E,A){var _,R,w;const N=await e.getResumeItems(t,s,n,r,l,c,h,d,f,p,v,x,S,T,E,A),U=(_=i?.serverIndex)!==null&&_!==void 0?_:0,D=(w=(R=be["ItemsApi.getResumeItems"])===null||R===void 0?void 0:R[U])===null||w===void 0?void 0:w.url;return(F,j)=>_e(N,ue,Se,i)(F,D||j)},async updateItemUserData(t,s,n,r){var l,c,h;const d=await e.updateItemUserData(t,s,n,r),f=(l=i?.serverIndex)!==null&&l!==void 0?l:0,p=(h=(c=be["ItemsApi.updateItemUserData"])===null||c===void 0?void 0:c[f])===null||h===void 0?void 0:h.url;return(v,x)=>_e(d,ue,Se,i)(v,p||x)}}};class hL extends Tn{getItemUserData(e,t){return uc(this.configuration).getItemUserData(e.itemId,e.userId,t).then(s=>s(this.axios,this.basePath))}getItems(e={},t){return uc(this.configuration).getItems(e.userId,e.maxOfficialRating,e.hasThemeSong,e.hasThemeVideo,e.hasSubtitles,e.hasSpecialFeature,e.hasTrailer,e.adjacentTo,e.indexNumber,e.parentIndexNumber,e.hasParentalRating,e.isHd,e.is4K,e.locationTypes,e.excludeLocationTypes,e.isMissing,e.isUnaired,e.minCommunityRating,e.minCriticRating,e.minPremiereDate,e.minDateLastSaved,e.minDateLastSavedForUser,e.maxPremiereDate,e.hasOverview,e.hasImdbId,e.hasTmdbId,e.hasTvdbId,e.isMovie,e.isSeries,e.isNews,e.isKids,e.isSports,e.excludeItemIds,e.startIndex,e.limit,e.recursive,e.searchTerm,e.sortOrder,e.parentId,e.fields,e.excludeItemTypes,e.includeItemTypes,e.filters,e.isFavorite,e.mediaTypes,e.imageTypes,e.sortBy,e.isPlayed,e.genres,e.officialRatings,e.tags,e.years,e.enableUserData,e.imageTypeLimit,e.enableImageTypes,e.person,e.personIds,e.personTypes,e.studios,e.artists,e.excludeArtistIds,e.artistIds,e.albumArtistIds,e.contributingArtistIds,e.albums,e.albumIds,e.ids,e.videoTypes,e.minOfficialRating,e.isLocked,e.isPlaceHolder,e.hasOfficialRating,e.collapseBoxSetItems,e.minWidth,e.minHeight,e.maxWidth,e.maxHeight,e.is3D,e.seriesStatus,e.nameStartsWithOrGreater,e.nameStartsWith,e.nameLessThan,e.studioIds,e.genreIds,e.enableTotalRecordCount,e.enableImages,t).then(s=>s(this.axios,this.basePath))}getResumeItems(e={},t){return uc(this.configuration).getResumeItems(e.userId,e.startIndex,e.limit,e.searchTerm,e.parentId,e.fields,e.mediaTypes,e.enableUserData,e.imageTypeLimit,e.enableImageTypes,e.excludeItemTypes,e.includeItemTypes,e.enableTotalRecordCount,e.enableImages,e.excludeActiveSessions,t).then(s=>s(this.axios,this.basePath))}updateItemUserData(e,t){return uc(this.configuration).updateItemUserData(e.itemId,e.updateUserItemDataDto,e.userId,t).then(s=>s(this.axios,this.basePath))}}const fL=function(i){return{getEpisodes:async(e,t,s,n,r,l,c,h,d,f,p,v,x,S,T,E={})=>{Ie("getEpisodes","seriesId",e);const A="/Shows/{seriesId}/Episodes".replace("{seriesId}",encodeURIComponent(String(e))),_=new URL(A,Ee);let R;i&&(R=i.baseOptions);const w={method:"GET",...R,...E},N={},U={};await Re(N,"Authorization",i),t!==void 0&&(U.userId=t),s&&(U.fields=s),n!==void 0&&(U.season=n),r!==void 0&&(U.seasonId=r),l!==void 0&&(U.isMissing=l),c!==void 0&&(U.adjacentTo=c),h!==void 0&&(U.startItemId=h),d!==void 0&&(U.startIndex=d),f!==void 0&&(U.limit=f),p!==void 0&&(U.enableImages=p),v!==void 0&&(U.imageTypeLimit=v),x&&(U.enableImageTypes=x),S!==void 0&&(U.enableUserData=S),T!==void 0&&(U.sortBy=T),Te(_,U);let D=R&&R.headers?R.headers:{};return w.headers={...N,...D,...E.headers},{url:Ae(_),options:w}},getNextUp:async(e,t,s,n,r,l,c,h,d,f,p,v,x,S,T,E={})=>{const A="/Shows/NextUp",_=new URL(A,Ee);let R;i&&(R=i.baseOptions);const w={method:"GET",...R,...E},N={},U={};await Re(N,"Authorization",i),e!==void 0&&(U.userId=e),t!==void 0&&(U.startIndex=t),s!==void 0&&(U.limit=s),n&&(U.fields=n),r!==void 0&&(U.seriesId=r),l!==void 0&&(U.parentId=l),c!==void 0&&(U.enableImages=c),h!==void 0&&(U.imageTypeLimit=h),d&&(U.enableImageTypes=d),f!==void 0&&(U.enableUserData=f),p!==void 0&&(U.nextUpDateCutoff=p instanceof Date?p.toISOString():p),v!==void 0&&(U.enableTotalRecordCount=v),x!==void 0&&(U.disableFirstEpisode=x),S!==void 0&&(U.enableResumable=S),T!==void 0&&(U.enableRewatching=T),Te(_,U);let D=R&&R.headers?R.headers:{};return w.headers={...N,...D,...E.headers},{url:Ae(_),options:w}},getSeasons:async(e,t,s,n,r,l,c,h,d,f,p={})=>{Ie("getSeasons","seriesId",e);const v="/Shows/{seriesId}/Seasons".replace("{seriesId}",encodeURIComponent(String(e))),x=new URL(v,Ee);let S;i&&(S=i.baseOptions);const T={method:"GET",...S,...p},E={},A={};await Re(E,"Authorization",i),t!==void 0&&(A.userId=t),s&&(A.fields=s),n!==void 0&&(A.isSpecialSeason=n),r!==void 0&&(A.isMissing=r),l!==void 0&&(A.adjacentTo=l),c!==void 0&&(A.enableImages=c),h!==void 0&&(A.imageTypeLimit=h),d&&(A.enableImageTypes=d),f!==void 0&&(A.enableUserData=f),Te(x,A);let _=S&&S.headers?S.headers:{};return T.headers={...E,..._,...p.headers},{url:Ae(x),options:T}},getUpcomingEpisodes:async(e,t,s,n,r,l,c,h,d,f={})=>{const p="/Shows/Upcoming",v=new URL(p,Ee);let x;i&&(x=i.baseOptions);const S={method:"GET",...x,...f},T={},E={};await Re(T,"Authorization",i),e!==void 0&&(E.userId=e),t!==void 0&&(E.startIndex=t),s!==void 0&&(E.limit=s),n&&(E.fields=n),r!==void 0&&(E.parentId=r),l!==void 0&&(E.enableImages=l),c!==void 0&&(E.imageTypeLimit=c),h&&(E.enableImageTypes=h),d!==void 0&&(E.enableUserData=d),Te(v,E);let A=x&&x.headers?x.headers:{};return S.headers={...T,...A,...f.headers},{url:Ae(v),options:S}}}},dc=function(i){const e=fL(i);return{async getEpisodes(t,s,n,r,l,c,h,d,f,p,v,x,S,T,E,A){var _,R,w;const N=await e.getEpisodes(t,s,n,r,l,c,h,d,f,p,v,x,S,T,E,A),U=(_=i?.serverIndex)!==null&&_!==void 0?_:0,D=(w=(R=be["TvShowsApi.getEpisodes"])===null||R===void 0?void 0:R[U])===null||w===void 0?void 0:w.url;return(F,j)=>_e(N,ue,Se,i)(F,D||j)},async getNextUp(t,s,n,r,l,c,h,d,f,p,v,x,S,T,E,A){var _,R,w;const N=await e.getNextUp(t,s,n,r,l,c,h,d,f,p,v,x,S,T,E,A),U=(_=i?.serverIndex)!==null&&_!==void 0?_:0,D=(w=(R=be["TvShowsApi.getNextUp"])===null||R===void 0?void 0:R[U])===null||w===void 0?void 0:w.url;return(F,j)=>_e(N,ue,Se,i)(F,D||j)},async getSeasons(t,s,n,r,l,c,h,d,f,p,v){var x,S,T;const E=await e.getSeasons(t,s,n,r,l,c,h,d,f,p,v),A=(x=i?.serverIndex)!==null&&x!==void 0?x:0,_=(T=(S=be["TvShowsApi.getSeasons"])===null||S===void 0?void 0:S[A])===null||T===void 0?void 0:T.url;return(R,w)=>_e(E,ue,Se,i)(R,_||w)},async getUpcomingEpisodes(t,s,n,r,l,c,h,d,f,p){var v,x,S;const T=await e.getUpcomingEpisodes(t,s,n,r,l,c,h,d,f,p),E=(v=i?.serverIndex)!==null&&v!==void 0?v:0,A=(S=(x=be["TvShowsApi.getUpcomingEpisodes"])===null||x===void 0?void 0:x[E])===null||S===void 0?void 0:S.url;return(_,R)=>_e(T,ue,Se,i)(_,A||R)}}};class mL extends Tn{getEpisodes(e,t){return dc(this.configuration).getEpisodes(e.seriesId,e.userId,e.fields,e.season,e.seasonId,e.isMissing,e.adjacentTo,e.startItemId,e.startIndex,e.limit,e.enableImages,e.imageTypeLimit,e.enableImageTypes,e.enableUserData,e.sortBy,t).then(s=>s(this.axios,this.basePath))}getNextUp(e={},t){return dc(this.configuration).getNextUp(e.userId,e.startIndex,e.limit,e.fields,e.seriesId,e.parentId,e.enableImages,e.imageTypeLimit,e.enableImageTypes,e.enableUserData,e.nextUpDateCutoff,e.enableTotalRecordCount,e.disableFirstEpisode,e.enableResumable,e.enableRewatching,t).then(s=>s(this.axios,this.basePath))}getSeasons(e,t){return dc(this.configuration).getSeasons(e.seriesId,e.userId,e.fields,e.isSpecialSeason,e.isMissing,e.adjacentTo,e.enableImages,e.imageTypeLimit,e.enableImageTypes,e.enableUserData,t).then(s=>s(this.axios,this.basePath))}getUpcomingEpisodes(e={},t){return dc(this.configuration).getUpcomingEpisodes(e.userId,e.startIndex,e.limit,e.fields,e.parentId,e.enableImages,e.imageTypeLimit,e.enableImageTypes,e.enableUserData,t).then(s=>s(this.axios,this.basePath))}}const pL=function(i){return{deleteItem:async(e,t={})=>{Ie("deleteItem","itemId",e);const s="/Items/{itemId}".replace("{itemId}",encodeURIComponent(String(e))),n=new URL(s,Ee);let r;i&&(r=i.baseOptions);const l={method:"DELETE",...r,...t},c={},h={};await Re(c,"Authorization",i),Te(n,h);let d=r&&r.headers?r.headers:{};return l.headers={...c,...d,...t.headers},{url:Ae(n),options:l}},deleteItems:async(e,t={})=>{const s="/Items",n=new URL(s,Ee);let r;i&&(r=i.baseOptions);const l={method:"DELETE",...r,...t},c={},h={};await Re(c,"Authorization",i),e&&(h.ids=e),Te(n,h);let d=r&&r.headers?r.headers:{};return l.headers={...c,...d,...t.headers},{url:Ae(n),options:l}},getAncestors:async(e,t,s={})=>{Ie("getAncestors","itemId",e);const n="/Items/{itemId}/Ancestors".replace("{itemId}",encodeURIComponent(String(e))),r=new URL(n,Ee);let l;i&&(l=i.baseOptions);const c={method:"GET",...l,...s},h={},d={};await Re(h,"Authorization",i),t!==void 0&&(d.userId=t),Te(r,d);let f=l&&l.headers?l.headers:{};return c.headers={...h,...f,...s.headers},{url:Ae(r),options:c}},getCriticReviews:async(e,t={})=>{Ie("getCriticReviews","itemId",e);const s="/Items/{itemId}/CriticReviews".replace("{itemId}",encodeURIComponent(String(e))),n=new URL(s,Ee);let r;i&&(r=i.baseOptions);const l={method:"GET",...r,...t},c={},h={};await Re(c,"Authorization",i),Te(n,h);let d=r&&r.headers?r.headers:{};return l.headers={...c,...d,...t.headers},{url:Ae(n),options:l}},getDownload:async(e,t={})=>{Ie("getDownload","itemId",e);const s="/Items/{itemId}/Download".replace("{itemId}",encodeURIComponent(String(e))),n=new URL(s,Ee);let r;i&&(r=i.baseOptions);const l={method:"GET",...r,...t},c={},h={};await Re(c,"Authorization",i),Te(n,h);let d=r&&r.headers?r.headers:{};return l.headers={...c,...d,...t.headers},{url:Ae(n),options:l}},getFile:async(e,t={})=>{Ie("getFile","itemId",e);const s="/Items/{itemId}/File".replace("{itemId}",encodeURIComponent(String(e))),n=new URL(s,Ee);let r;i&&(r=i.baseOptions);const l={method:"GET",...r,...t},c={},h={};await Re(c,"Authorization",i),Te(n,h);let d=r&&r.headers?r.headers:{};return l.headers={...c,...d,...t.headers},{url:Ae(n),options:l}},getItemCounts:async(e,t,s={})=>{const n="/Items/Counts",r=new URL(n,Ee);let l;i&&(l=i.baseOptions);const c={method:"GET",...l,...s},h={},d={};await Re(h,"Authorization",i),e!==void 0&&(d.userId=e),t!==void 0&&(d.isFavorite=t),Te(r,d);let f=l&&l.headers?l.headers:{};return c.headers={...h,...f,...s.headers},{url:Ae(r),options:c}},getLibraryOptionsInfo:async(e,t,s={})=>{const n="/Libraries/AvailableOptions",r=new URL(n,Ee);let l;i&&(l=i.baseOptions);const c={method:"GET",...l,...s},h={},d={};await Re(h,"Authorization",i),e!==void 0&&(d.libraryContentType=e),t!==void 0&&(d.isNewLibrary=t),Te(r,d);let f=l&&l.headers?l.headers:{};return c.headers={...h,...f,...s.headers},{url:Ae(r),options:c}},getMediaFolders:async(e,t={})=>{const s="/Library/MediaFolders",n=new URL(s,Ee);let r;i&&(r=i.baseOptions);const l={method:"GET",...r,...t},c={},h={};await Re(c,"Authorization",i),e!==void 0&&(h.isHidden=e),Te(n,h);let d=r&&r.headers?r.headers:{};return l.headers={...c,...d,...t.headers},{url:Ae(n),options:l}},getPhysicalPaths:async(e={})=>{const t="/Library/PhysicalPaths",s=new URL(t,Ee);let n;i&&(n=i.baseOptions);const r={method:"GET",...n,...e},l={},c={};await Re(l,"Authorization",i),Te(s,c);let h=n&&n.headers?n.headers:{};return r.headers={...l,...h,...e.headers},{url:Ae(s),options:r}},getSimilarAlbums:async(e,t,s,n,r,l={})=>{Ie("getSimilarAlbums","itemId",e);const c="/Albums/{itemId}/Similar".replace("{itemId}",encodeURIComponent(String(e))),h=new URL(c,Ee);let d;i&&(d=i.baseOptions);const f={method:"GET",...d,...l},p={},v={};await Re(p,"Authorization",i),t&&(v.excludeArtistIds=t),s!==void 0&&(v.userId=s),n!==void 0&&(v.limit=n),r&&(v.fields=r),Te(h,v);let x=d&&d.headers?d.headers:{};return f.headers={...p,...x,...l.headers},{url:Ae(h),options:f}},getSimilarArtists:async(e,t,s,n,r,l={})=>{Ie("getSimilarArtists","itemId",e);const c="/Artists/{itemId}/Similar".replace("{itemId}",encodeURIComponent(String(e))),h=new URL(c,Ee);let d;i&&(d=i.baseOptions);const f={method:"GET",...d,...l},p={},v={};await Re(p,"Authorization",i),t&&(v.excludeArtistIds=t),s!==void 0&&(v.userId=s),n!==void 0&&(v.limit=n),r&&(v.fields=r),Te(h,v);let x=d&&d.headers?d.headers:{};return f.headers={...p,...x,...l.headers},{url:Ae(h),options:f}},getSimilarItems:async(e,t,s,n,r,l={})=>{Ie("getSimilarItems","itemId",e);const c="/Items/{itemId}/Similar".replace("{itemId}",encodeURIComponent(String(e))),h=new URL(c,Ee);let d;i&&(d=i.baseOptions);const f={method:"GET",...d,...l},p={},v={};await Re(p,"Authorization",i),t&&(v.excludeArtistIds=t),s!==void 0&&(v.userId=s),n!==void 0&&(v.limit=n),r&&(v.fields=r),Te(h,v);let x=d&&d.headers?d.headers:{};return f.headers={...p,...x,...l.headers},{url:Ae(h),options:f}},getSimilarMovies:async(e,t,s,n,r,l={})=>{Ie("getSimilarMovies","itemId",e);const c="/Movies/{itemId}/Similar".replace("{itemId}",encodeURIComponent(String(e))),h=new URL(c,Ee);let d;i&&(d=i.baseOptions);const f={method:"GET",...d,...l},p={},v={};await Re(p,"Authorization",i),t&&(v.excludeArtistIds=t),s!==void 0&&(v.userId=s),n!==void 0&&(v.limit=n),r&&(v.fields=r),Te(h,v);let x=d&&d.headers?d.headers:{};return f.headers={...p,...x,...l.headers},{url:Ae(h),options:f}},getSimilarShows:async(e,t,s,n,r,l={})=>{Ie("getSimilarShows","itemId",e);const c="/Shows/{itemId}/Similar".replace("{itemId}",encodeURIComponent(String(e))),h=new URL(c,Ee);let d;i&&(d=i.baseOptions);const f={method:"GET",...d,...l},p={},v={};await Re(p,"Authorization",i),t&&(v.excludeArtistIds=t),s!==void 0&&(v.userId=s),n!==void 0&&(v.limit=n),r&&(v.fields=r),Te(h,v);let x=d&&d.headers?d.headers:{};return f.headers={...p,...x,...l.headers},{url:Ae(h),options:f}},getSimilarTrailers:async(e,t,s,n,r,l={})=>{Ie("getSimilarTrailers","itemId",e);const c="/Trailers/{itemId}/Similar".replace("{itemId}",encodeURIComponent(String(e))),h=new URL(c,Ee);let d;i&&(d=i.baseOptions);const f={method:"GET",...d,...l},p={},v={};await Re(p,"Authorization",i),t&&(v.excludeArtistIds=t),s!==void 0&&(v.userId=s),n!==void 0&&(v.limit=n),r&&(v.fields=r),Te(h,v);let x=d&&d.headers?d.headers:{};return f.headers={...p,...x,...l.headers},{url:Ae(h),options:f}},getThemeMedia:async(e,t,s,n,r,l={})=>{Ie("getThemeMedia","itemId",e);const c="/Items/{itemId}/ThemeMedia".replace("{itemId}",encodeURIComponent(String(e))),h=new URL(c,Ee);let d;i&&(d=i.baseOptions);const f={method:"GET",...d,...l},p={},v={};await Re(p,"Authorization",i),t!==void 0&&(v.userId=t),s!==void 0&&(v.inheritFromParent=s),n&&(v.sortBy=n),r&&(v.sortOrder=r),Te(h,v);let x=d&&d.headers?d.headers:{};return f.headers={...p,...x,...l.headers},{url:Ae(h),options:f}},getThemeSongs:async(e,t,s,n,r,l={})=>{Ie("getThemeSongs","itemId",e);const c="/Items/{itemId}/ThemeSongs".replace("{itemId}",encodeURIComponent(String(e))),h=new URL(c,Ee);let d;i&&(d=i.baseOptions);const f={method:"GET",...d,...l},p={},v={};await Re(p,"Authorization",i),t!==void 0&&(v.userId=t),s!==void 0&&(v.inheritFromParent=s),n&&(v.sortBy=n),r&&(v.sortOrder=r),Te(h,v);let x=d&&d.headers?d.headers:{};return f.headers={...p,...x,...l.headers},{url:Ae(h),options:f}},getThemeVideos:async(e,t,s,n,r,l={})=>{Ie("getThemeVideos","itemId",e);const c="/Items/{itemId}/ThemeVideos".replace("{itemId}",encodeURIComponent(String(e))),h=new URL(c,Ee);let d;i&&(d=i.baseOptions);const f={method:"GET",...d,...l},p={},v={};await Re(p,"Authorization",i),t!==void 0&&(v.userId=t),s!==void 0&&(v.inheritFromParent=s),n&&(v.sortBy=n),r&&(v.sortOrder=r),Te(h,v);let x=d&&d.headers?d.headers:{};return f.headers={...p,...x,...l.headers},{url:Ae(h),options:f}},postAddedMovies:async(e,t,s={})=>{const n="/Library/Movies/Added",r=new URL(n,Ee);let l;i&&(l=i.baseOptions);const c={method:"POST",...l,...s},h={},d={};await Re(h,"Authorization",i),e!==void 0&&(d.tmdbId=e),t!==void 0&&(d.imdbId=t),Te(r,d);let f=l&&l.headers?l.headers:{};return c.headers={...h,...f,...s.headers},{url:Ae(r),options:c}},postAddedSeries:async(e,t={})=>{const s="/Library/Series/Added",n=new URL(s,Ee);let r;i&&(r=i.baseOptions);const l={method:"POST",...r,...t},c={},h={};await Re(c,"Authorization",i),e!==void 0&&(h.tvdbId=e),Te(n,h);let d=r&&r.headers?r.headers:{};return l.headers={...c,...d,...t.headers},{url:Ae(n),options:l}},postUpdatedMedia:async(e,t={})=>{Ie("postUpdatedMedia","mediaUpdateInfoDto",e);const s="/Library/Media/Updated",n=new URL(s,Ee);let r;i&&(r=i.baseOptions);const l={method:"POST",...r,...t},c={},h={};await Re(c,"Authorization",i),c["Content-Type"]="application/json",Te(n,h);let d=r&&r.headers?r.headers:{};return l.headers={...c,...d,...t.headers},l.data=ws(e,l,i),{url:Ae(n),options:l}},postUpdatedMovies:async(e,t,s={})=>{const n="/Library/Movies/Updated",r=new URL(n,Ee);let l;i&&(l=i.baseOptions);const c={method:"POST",...l,...s},h={},d={};await Re(h,"Authorization",i),e!==void 0&&(d.tmdbId=e),t!==void 0&&(d.imdbId=t),Te(r,d);let f=l&&l.headers?l.headers:{};return c.headers={...h,...f,...s.headers},{url:Ae(r),options:c}},postUpdatedSeries:async(e,t={})=>{const s="/Library/Series/Updated",n=new URL(s,Ee);let r;i&&(r=i.baseOptions);const l={method:"POST",...r,...t},c={},h={};await Re(c,"Authorization",i),e!==void 0&&(h.tvdbId=e),Te(n,h);let d=r&&r.headers?r.headers:{};return l.headers={...c,...d,...t.headers},{url:Ae(n),options:l}},refreshLibrary:async(e={})=>{const t="/Library/Refresh",s=new URL(t,Ee);let n;i&&(n=i.baseOptions);const r={method:"POST",...n,...e},l={},c={};await Re(l,"Authorization",i),Te(s,c);let h=n&&n.headers?n.headers:{};return r.headers={...l,...h,...e.headers},{url:Ae(s),options:r}}}},Ut=function(i){const e=pL(i);return{async deleteItem(t,s){var n,r,l;const c=await e.deleteItem(t,s),h=(n=i?.serverIndex)!==null&&n!==void 0?n:0,d=(l=(r=be["LibraryApi.deleteItem"])===null||r===void 0?void 0:r[h])===null||l===void 0?void 0:l.url;return(f,p)=>_e(c,ue,Se,i)(f,d||p)},async deleteItems(t,s){var n,r,l;const c=await e.deleteItems(t,s),h=(n=i?.serverIndex)!==null&&n!==void 0?n:0,d=(l=(r=be["LibraryApi.deleteItems"])===null||r===void 0?void 0:r[h])===null||l===void 0?void 0:l.url;return(f,p)=>_e(c,ue,Se,i)(f,d||p)},async getAncestors(t,s,n){var r,l,c;const h=await e.getAncestors(t,s,n),d=(r=i?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=be["LibraryApi.getAncestors"])===null||l===void 0?void 0:l[d])===null||c===void 0?void 0:c.url;return(p,v)=>_e(h,ue,Se,i)(p,f||v)},async getCriticReviews(t,s){var n,r,l;const c=await e.getCriticReviews(t,s),h=(n=i?.serverIndex)!==null&&n!==void 0?n:0,d=(l=(r=be["LibraryApi.getCriticReviews"])===null||r===void 0?void 0:r[h])===null||l===void 0?void 0:l.url;return(f,p)=>_e(c,ue,Se,i)(f,d||p)},async getDownload(t,s){var n,r,l;const c=await e.getDownload(t,s),h=(n=i?.serverIndex)!==null&&n!==void 0?n:0,d=(l=(r=be["LibraryApi.getDownload"])===null||r===void 0?void 0:r[h])===null||l===void 0?void 0:l.url;return(f,p)=>_e(c,ue,Se,i)(f,d||p)},async getFile(t,s){var n,r,l;const c=await e.getFile(t,s),h=(n=i?.serverIndex)!==null&&n!==void 0?n:0,d=(l=(r=be["LibraryApi.getFile"])===null||r===void 0?void 0:r[h])===null||l===void 0?void 0:l.url;return(f,p)=>_e(c,ue,Se,i)(f,d||p)},async getItemCounts(t,s,n){var r,l,c;const h=await e.getItemCounts(t,s,n),d=(r=i?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=be["LibraryApi.getItemCounts"])===null||l===void 0?void 0:l[d])===null||c===void 0?void 0:c.url;return(p,v)=>_e(h,ue,Se,i)(p,f||v)},async getLibraryOptionsInfo(t,s,n){var r,l,c;const h=await e.getLibraryOptionsInfo(t,s,n),d=(r=i?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=be["LibraryApi.getLibraryOptionsInfo"])===null||l===void 0?void 0:l[d])===null||c===void 0?void 0:c.url;return(p,v)=>_e(h,ue,Se,i)(p,f||v)},async getMediaFolders(t,s){var n,r,l;const c=await e.getMediaFolders(t,s),h=(n=i?.serverIndex)!==null&&n!==void 0?n:0,d=(l=(r=be["LibraryApi.getMediaFolders"])===null||r===void 0?void 0:r[h])===null||l===void 0?void 0:l.url;return(f,p)=>_e(c,ue,Se,i)(f,d||p)},async getPhysicalPaths(t){var s,n,r;const l=await e.getPhysicalPaths(t),c=(s=i?.serverIndex)!==null&&s!==void 0?s:0,h=(r=(n=be["LibraryApi.getPhysicalPaths"])===null||n===void 0?void 0:n[c])===null||r===void 0?void 0:r.url;return(d,f)=>_e(l,ue,Se,i)(d,h||f)},async getSimilarAlbums(t,s,n,r,l,c){var h,d,f;const p=await e.getSimilarAlbums(t,s,n,r,l,c),v=(h=i?.serverIndex)!==null&&h!==void 0?h:0,x=(f=(d=be["LibraryApi.getSimilarAlbums"])===null||d===void 0?void 0:d[v])===null||f===void 0?void 0:f.url;return(S,T)=>_e(p,ue,Se,i)(S,x||T)},async getSimilarArtists(t,s,n,r,l,c){var h,d,f;const p=await e.getSimilarArtists(t,s,n,r,l,c),v=(h=i?.serverIndex)!==null&&h!==void 0?h:0,x=(f=(d=be["LibraryApi.getSimilarArtists"])===null||d===void 0?void 0:d[v])===null||f===void 0?void 0:f.url;return(S,T)=>_e(p,ue,Se,i)(S,x||T)},async getSimilarItems(t,s,n,r,l,c){var h,d,f;const p=await e.getSimilarItems(t,s,n,r,l,c),v=(h=i?.serverIndex)!==null&&h!==void 0?h:0,x=(f=(d=be["LibraryApi.getSimilarItems"])===null||d===void 0?void 0:d[v])===null||f===void 0?void 0:f.url;return(S,T)=>_e(p,ue,Se,i)(S,x||T)},async getSimilarMovies(t,s,n,r,l,c){var h,d,f;const p=await e.getSimilarMovies(t,s,n,r,l,c),v=(h=i?.serverIndex)!==null&&h!==void 0?h:0,x=(f=(d=be["LibraryApi.getSimilarMovies"])===null||d===void 0?void 0:d[v])===null||f===void 0?void 0:f.url;return(S,T)=>_e(p,ue,Se,i)(S,x||T)},async getSimilarShows(t,s,n,r,l,c){var h,d,f;const p=await e.getSimilarShows(t,s,n,r,l,c),v=(h=i?.serverIndex)!==null&&h!==void 0?h:0,x=(f=(d=be["LibraryApi.getSimilarShows"])===null||d===void 0?void 0:d[v])===null||f===void 0?void 0:f.url;return(S,T)=>_e(p,ue,Se,i)(S,x||T)},async getSimilarTrailers(t,s,n,r,l,c){var h,d,f;const p=await e.getSimilarTrailers(t,s,n,r,l,c),v=(h=i?.serverIndex)!==null&&h!==void 0?h:0,x=(f=(d=be["LibraryApi.getSimilarTrailers"])===null||d===void 0?void 0:d[v])===null||f===void 0?void 0:f.url;return(S,T)=>_e(p,ue,Se,i)(S,x||T)},async getThemeMedia(t,s,n,r,l,c){var h,d,f;const p=await e.getThemeMedia(t,s,n,r,l,c),v=(h=i?.serverIndex)!==null&&h!==void 0?h:0,x=(f=(d=be["LibraryApi.getThemeMedia"])===null||d===void 0?void 0:d[v])===null||f===void 0?void 0:f.url;return(S,T)=>_e(p,ue,Se,i)(S,x||T)},async getThemeSongs(t,s,n,r,l,c){var h,d,f;const p=await e.getThemeSongs(t,s,n,r,l,c),v=(h=i?.serverIndex)!==null&&h!==void 0?h:0,x=(f=(d=be["LibraryApi.getThemeSongs"])===null||d===void 0?void 0:d[v])===null||f===void 0?void 0:f.url;return(S,T)=>_e(p,ue,Se,i)(S,x||T)},async getThemeVideos(t,s,n,r,l,c){var h,d,f;const p=await e.getThemeVideos(t,s,n,r,l,c),v=(h=i?.serverIndex)!==null&&h!==void 0?h:0,x=(f=(d=be["LibraryApi.getThemeVideos"])===null||d===void 0?void 0:d[v])===null||f===void 0?void 0:f.url;return(S,T)=>_e(p,ue,Se,i)(S,x||T)},async postAddedMovies(t,s,n){var r,l,c;const h=await e.postAddedMovies(t,s,n),d=(r=i?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=be["LibraryApi.postAddedMovies"])===null||l===void 0?void 0:l[d])===null||c===void 0?void 0:c.url;return(p,v)=>_e(h,ue,Se,i)(p,f||v)},async postAddedSeries(t,s){var n,r,l;const c=await e.postAddedSeries(t,s),h=(n=i?.serverIndex)!==null&&n!==void 0?n:0,d=(l=(r=be["LibraryApi.postAddedSeries"])===null||r===void 0?void 0:r[h])===null||l===void 0?void 0:l.url;return(f,p)=>_e(c,ue,Se,i)(f,d||p)},async postUpdatedMedia(t,s){var n,r,l;const c=await e.postUpdatedMedia(t,s),h=(n=i?.serverIndex)!==null&&n!==void 0?n:0,d=(l=(r=be["LibraryApi.postUpdatedMedia"])===null||r===void 0?void 0:r[h])===null||l===void 0?void 0:l.url;return(f,p)=>_e(c,ue,Se,i)(f,d||p)},async postUpdatedMovies(t,s,n){var r,l,c;const h=await e.postUpdatedMovies(t,s,n),d=(r=i?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=be["LibraryApi.postUpdatedMovies"])===null||l===void 0?void 0:l[d])===null||c===void 0?void 0:c.url;return(p,v)=>_e(h,ue,Se,i)(p,f||v)},async postUpdatedSeries(t,s){var n,r,l;const c=await e.postUpdatedSeries(t,s),h=(n=i?.serverIndex)!==null&&n!==void 0?n:0,d=(l=(r=be["LibraryApi.postUpdatedSeries"])===null||r===void 0?void 0:r[h])===null||l===void 0?void 0:l.url;return(f,p)=>_e(c,ue,Se,i)(f,d||p)},async refreshLibrary(t){var s,n,r;const l=await e.refreshLibrary(t),c=(s=i?.serverIndex)!==null&&s!==void 0?s:0,h=(r=(n=be["LibraryApi.refreshLibrary"])===null||n===void 0?void 0:n[c])===null||r===void 0?void 0:r.url;return(d,f)=>_e(l,ue,Se,i)(d,h||f)}}};class gL extends Tn{deleteItem(e,t){return Ut(this.configuration).deleteItem(e.itemId,t).then(s=>s(this.axios,this.basePath))}deleteItems(e={},t){return Ut(this.configuration).deleteItems(e.ids,t).then(s=>s(this.axios,this.basePath))}getAncestors(e,t){return Ut(this.configuration).getAncestors(e.itemId,e.userId,t).then(s=>s(this.axios,this.basePath))}getCriticReviews(e,t){return Ut(this.configuration).getCriticReviews(e.itemId,t).then(s=>s(this.axios,this.basePath))}getDownload(e,t){return Ut(this.configuration).getDownload(e.itemId,t).then(s=>s(this.axios,this.basePath))}getFile(e,t){return Ut(this.configuration).getFile(e.itemId,t).then(s=>s(this.axios,this.basePath))}getItemCounts(e={},t){return Ut(this.configuration).getItemCounts(e.userId,e.isFavorite,t).then(s=>s(this.axios,this.basePath))}getLibraryOptionsInfo(e={},t){return Ut(this.configuration).getLibraryOptionsInfo(e.libraryContentType,e.isNewLibrary,t).then(s=>s(this.axios,this.basePath))}getMediaFolders(e={},t){return Ut(this.configuration).getMediaFolders(e.isHidden,t).then(s=>s(this.axios,this.basePath))}getPhysicalPaths(e){return Ut(this.configuration).getPhysicalPaths(e).then(t=>t(this.axios,this.basePath))}getSimilarAlbums(e,t){return Ut(this.configuration).getSimilarAlbums(e.itemId,e.excludeArtistIds,e.userId,e.limit,e.fields,t).then(s=>s(this.axios,this.basePath))}getSimilarArtists(e,t){return Ut(this.configuration).getSimilarArtists(e.itemId,e.excludeArtistIds,e.userId,e.limit,e.fields,t).then(s=>s(this.axios,this.basePath))}getSimilarItems(e,t){return Ut(this.configuration).getSimilarItems(e.itemId,e.excludeArtistIds,e.userId,e.limit,e.fields,t).then(s=>s(this.axios,this.basePath))}getSimilarMovies(e,t){return Ut(this.configuration).getSimilarMovies(e.itemId,e.excludeArtistIds,e.userId,e.limit,e.fields,t).then(s=>s(this.axios,this.basePath))}getSimilarShows(e,t){return Ut(this.configuration).getSimilarShows(e.itemId,e.excludeArtistIds,e.userId,e.limit,e.fields,t).then(s=>s(this.axios,this.basePath))}getSimilarTrailers(e,t){return Ut(this.configuration).getSimilarTrailers(e.itemId,e.excludeArtistIds,e.userId,e.limit,e.fields,t).then(s=>s(this.axios,this.basePath))}getThemeMedia(e,t){return Ut(this.configuration).getThemeMedia(e.itemId,e.userId,e.inheritFromParent,e.sortBy,e.sortOrder,t).then(s=>s(this.axios,this.basePath))}getThemeSongs(e,t){return Ut(this.configuration).getThemeSongs(e.itemId,e.userId,e.inheritFromParent,e.sortBy,e.sortOrder,t).then(s=>s(this.axios,this.basePath))}getThemeVideos(e,t){return Ut(this.configuration).getThemeVideos(e.itemId,e.userId,e.inheritFromParent,e.sortBy,e.sortOrder,t).then(s=>s(this.axios,this.basePath))}postAddedMovies(e={},t){return Ut(this.configuration).postAddedMovies(e.tmdbId,e.imdbId,t).then(s=>s(this.axios,this.basePath))}postAddedSeries(e={},t){return Ut(this.configuration).postAddedSeries(e.tvdbId,t).then(s=>s(this.axios,this.basePath))}postUpdatedMedia(e,t){return Ut(this.configuration).postUpdatedMedia(e.mediaUpdateInfoDto,t).then(s=>s(this.axios,this.basePath))}postUpdatedMovies(e={},t){return Ut(this.configuration).postUpdatedMovies(e.tmdbId,e.imdbId,t).then(s=>s(this.axios,this.basePath))}postUpdatedSeries(e={},t){return Ut(this.configuration).postUpdatedSeries(e.tvdbId,t).then(s=>s(this.axios,this.basePath))}refreshLibrary(e){return Ut(this.configuration).refreshLibrary(e).then(t=>t(this.axios,this.basePath))}}const vL=function(i){return{deleteSubtitle:async(e,t,s={})=>{Ie("deleteSubtitle","itemId",e),Ie("deleteSubtitle","index",t);const n="/Videos/{itemId}/Subtitles/{index}".replace("{itemId}",encodeURIComponent(String(e))).replace("{index}",encodeURIComponent(String(t))),r=new URL(n,Ee);let l;i&&(l=i.baseOptions);const c={method:"DELETE",...l,...s},h={},d={};await Re(h,"Authorization",i),Te(r,d);let f=l&&l.headers?l.headers:{};return c.headers={...h,...f,...s.headers},{url:Ae(r),options:c}},downloadRemoteSubtitles:async(e,t,s={})=>{Ie("downloadRemoteSubtitles","itemId",e),Ie("downloadRemoteSubtitles","subtitleId",t);const n="/Items/{itemId}/RemoteSearch/Subtitles/{subtitleId}".replace("{itemId}",encodeURIComponent(String(e))).replace("{subtitleId}",encodeURIComponent(String(t))),r=new URL(n,Ee);let l;i&&(l=i.baseOptions);const c={method:"POST",...l,...s},h={},d={};await Re(h,"Authorization",i),Te(r,d);let f=l&&l.headers?l.headers:{};return c.headers={...h,...f,...s.headers},{url:Ae(r),options:c}},getFallbackFont:async(e,t={})=>{Ie("getFallbackFont","name",e);const s="/FallbackFont/Fonts/{name}".replace("{name}",encodeURIComponent(String(e))),n=new URL(s,Ee);let r;i&&(r=i.baseOptions);const l={method:"GET",...r,...t},c={},h={};await Re(c,"Authorization",i),Te(n,h);let d=r&&r.headers?r.headers:{};return l.headers={...c,...d,...t.headers},{url:Ae(n),options:l}},getFallbackFontList:async(e={})=>{const t="/FallbackFont/Fonts",s=new URL(t,Ee);let n;i&&(n=i.baseOptions);const r={method:"GET",...n,...e},l={},c={};await Re(l,"Authorization",i),Te(s,c);let h=n&&n.headers?n.headers:{};return r.headers={...l,...h,...e.headers},{url:Ae(s),options:r}},getRemoteSubtitles:async(e,t={})=>{Ie("getRemoteSubtitles","subtitleId",e);const s="/Providers/Subtitles/Subtitles/{subtitleId}".replace("{subtitleId}",encodeURIComponent(String(e))),n=new URL(s,Ee);let r;i&&(r=i.baseOptions);const l={method:"GET",...r,...t},c={},h={};await Re(c,"Authorization",i),Te(n,h);let d=r&&r.headers?r.headers:{};return l.headers={...c,...d,...t.headers},{url:Ae(n),options:l}},getSubtitle:async(e,t,s,n,r,l,c,h,d,f,p,v,x={})=>{Ie("getSubtitle","routeItemId",e),Ie("getSubtitle","routeMediaSourceId",t),Ie("getSubtitle","routeIndex",s),Ie("getSubtitle","routeFormat",n);const S="/Videos/{routeItemId}/{routeMediaSourceId}/Subtitles/{routeIndex}/Stream.{routeFormat}".replace("{routeItemId}",encodeURIComponent(String(e))).replace("{routeMediaSourceId}",encodeURIComponent(String(t))).replace("{routeIndex}",encodeURIComponent(String(s))).replace("{routeFormat}",encodeURIComponent(String(n))),T=new URL(S,Ee);let E;i&&(E=i.baseOptions);const A={method:"GET",...E,...x},_={},R={};r!==void 0&&(R.itemId=r),l!==void 0&&(R.mediaSourceId=l),c!==void 0&&(R.index=c),h!==void 0&&(R.format=h),d!==void 0&&(R.endPositionTicks=d),f!==void 0&&(R.copyTimestamps=f),p!==void 0&&(R.addVttTimeMap=p),v!==void 0&&(R.startPositionTicks=v),Te(T,R);let w=E&&E.headers?E.headers:{};return A.headers={..._,...w,...x.headers},{url:Ae(T),options:A}},getSubtitlePlaylist:async(e,t,s,n,r={})=>{Ie("getSubtitlePlaylist","itemId",e),Ie("getSubtitlePlaylist","index",t),Ie("getSubtitlePlaylist","mediaSourceId",s),Ie("getSubtitlePlaylist","segmentLength",n);const l="/Videos/{itemId}/{mediaSourceId}/Subtitles/{index}/subtitles.m3u8".replace("{itemId}",encodeURIComponent(String(e))).replace("{index}",encodeURIComponent(String(t))).replace("{mediaSourceId}",encodeURIComponent(String(s))),c=new URL(l,Ee);let h;i&&(h=i.baseOptions);const d={method:"GET",...h,...r},f={},p={};await Re(f,"Authorization",i),n!==void 0&&(p.segmentLength=n),Te(c,p);let v=h&&h.headers?h.headers:{};return d.headers={...f,...v,...r.headers},{url:Ae(c),options:d}},getSubtitleWithTicks:async(e,t,s,n,r,l,c,h,d,f,p,v,x,S={})=>{Ie("getSubtitleWithTicks","routeItemId",e),Ie("getSubtitleWithTicks","routeMediaSourceId",t),Ie("getSubtitleWithTicks","routeIndex",s),Ie("getSubtitleWithTicks","routeStartPositionTicks",n),Ie("getSubtitleWithTicks","routeFormat",r);const T="/Videos/{routeItemId}/{routeMediaSourceId}/Subtitles/{routeIndex}/{routeStartPositionTicks}/Stream.{routeFormat}".replace("{routeItemId}",encodeURIComponent(String(e))).replace("{routeMediaSourceId}",encodeURIComponent(String(t))).replace("{routeIndex}",encodeURIComponent(String(s))).replace("{routeStartPositionTicks}",encodeURIComponent(String(n))).replace("{routeFormat}",encodeURIComponent(String(r))),E=new URL(T,Ee);let A;i&&(A=i.baseOptions);const _={method:"GET",...A,...S},R={},w={};l!==void 0&&(w.itemId=l),c!==void 0&&(w.mediaSourceId=c),h!==void 0&&(w.index=h),d!==void 0&&(w.startPositionTicks=d),f!==void 0&&(w.format=f),p!==void 0&&(w.endPositionTicks=p),v!==void 0&&(w.copyTimestamps=v),x!==void 0&&(w.addVttTimeMap=x),Te(E,w);let N=A&&A.headers?A.headers:{};return _.headers={...R,...N,...S.headers},{url:Ae(E),options:_}},searchRemoteSubtitles:async(e,t,s,n={})=>{Ie("searchRemoteSubtitles","itemId",e),Ie("searchRemoteSubtitles","language",t);const r="/Items/{itemId}/RemoteSearch/Subtitles/{language}".replace("{itemId}",encodeURIComponent(String(e))).replace("{language}",encodeURIComponent(String(t))),l=new URL(r,Ee);let c;i&&(c=i.baseOptions);const h={method:"GET",...c,...n},d={},f={};await Re(d,"Authorization",i),s!==void 0&&(f.isPerfectMatch=s),Te(l,f);let p=c&&c.headers?c.headers:{};return h.headers={...d,...p,...n.headers},{url:Ae(l),options:h}},uploadSubtitle:async(e,t,s={})=>{Ie("uploadSubtitle","itemId",e),Ie("uploadSubtitle","uploadSubtitleDto",t);const n="/Videos/{itemId}/Subtitles".replace("{itemId}",encodeURIComponent(String(e))),r=new URL(n,Ee);let l;i&&(l=i.baseOptions);const c={method:"POST",...l,...s},h={},d={};await Re(h,"Authorization",i),h["Content-Type"]="application/json",Te(r,d);let f=l&&l.headers?l.headers:{};return c.headers={...h,...f,...s.headers},c.data=ws(t,c,i),{url:Ae(r),options:c}}}},ji=function(i){const e=vL(i);return{async deleteSubtitle(t,s,n){var r,l,c;const h=await e.deleteSubtitle(t,s,n),d=(r=i?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=be["SubtitleApi.deleteSubtitle"])===null||l===void 0?void 0:l[d])===null||c===void 0?void 0:c.url;return(p,v)=>_e(h,ue,Se,i)(p,f||v)},async downloadRemoteSubtitles(t,s,n){var r,l,c;const h=await e.downloadRemoteSubtitles(t,s,n),d=(r=i?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=be["SubtitleApi.downloadRemoteSubtitles"])===null||l===void 0?void 0:l[d])===null||c===void 0?void 0:c.url;return(p,v)=>_e(h,ue,Se,i)(p,f||v)},async getFallbackFont(t,s){var n,r,l;const c=await e.getFallbackFont(t,s),h=(n=i?.serverIndex)!==null&&n!==void 0?n:0,d=(l=(r=be["SubtitleApi.getFallbackFont"])===null||r===void 0?void 0:r[h])===null||l===void 0?void 0:l.url;return(f,p)=>_e(c,ue,Se,i)(f,d||p)},async getFallbackFontList(t){var s,n,r;const l=await e.getFallbackFontList(t),c=(s=i?.serverIndex)!==null&&s!==void 0?s:0,h=(r=(n=be["SubtitleApi.getFallbackFontList"])===null||n===void 0?void 0:n[c])===null||r===void 0?void 0:r.url;return(d,f)=>_e(l,ue,Se,i)(d,h||f)},async getRemoteSubtitles(t,s){var n,r,l;const c=await e.getRemoteSubtitles(t,s),h=(n=i?.serverIndex)!==null&&n!==void 0?n:0,d=(l=(r=be["SubtitleApi.getRemoteSubtitles"])===null||r===void 0?void 0:r[h])===null||l===void 0?void 0:l.url;return(f,p)=>_e(c,ue,Se,i)(f,d||p)},async getSubtitle(t,s,n,r,l,c,h,d,f,p,v,x,S){var T,E,A;const _=await e.getSubtitle(t,s,n,r,l,c,h,d,f,p,v,x,S),R=(T=i?.serverIndex)!==null&&T!==void 0?T:0,w=(A=(E=be["SubtitleApi.getSubtitle"])===null||E===void 0?void 0:E[R])===null||A===void 0?void 0:A.url;return(N,U)=>_e(_,ue,Se,i)(N,w||U)},async getSubtitlePlaylist(t,s,n,r,l){var c,h,d;const f=await e.getSubtitlePlaylist(t,s,n,r,l),p=(c=i?.serverIndex)!==null&&c!==void 0?c:0,v=(d=(h=be["SubtitleApi.getSubtitlePlaylist"])===null||h===void 0?void 0:h[p])===null||d===void 0?void 0:d.url;return(x,S)=>_e(f,ue,Se,i)(x,v||S)},async getSubtitleWithTicks(t,s,n,r,l,c,h,d,f,p,v,x,S,T){var E,A,_;const R=await e.getSubtitleWithTicks(t,s,n,r,l,c,h,d,f,p,v,x,S,T),w=(E=i?.serverIndex)!==null&&E!==void 0?E:0,N=(_=(A=be["SubtitleApi.getSubtitleWithTicks"])===null||A===void 0?void 0:A[w])===null||_===void 0?void 0:_.url;return(U,D)=>_e(R,ue,Se,i)(U,N||D)},async searchRemoteSubtitles(t,s,n,r){var l,c,h;const d=await e.searchRemoteSubtitles(t,s,n,r),f=(l=i?.serverIndex)!==null&&l!==void 0?l:0,p=(h=(c=be["SubtitleApi.searchRemoteSubtitles"])===null||c===void 0?void 0:c[f])===null||h===void 0?void 0:h.url;return(v,x)=>_e(d,ue,Se,i)(v,p||x)},async uploadSubtitle(t,s,n){var r,l,c;const h=await e.uploadSubtitle(t,s,n),d=(r=i?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=be["SubtitleApi.uploadSubtitle"])===null||l===void 0?void 0:l[d])===null||c===void 0?void 0:c.url;return(p,v)=>_e(h,ue,Se,i)(p,f||v)}}};class yL extends Tn{deleteSubtitle(e,t){return ji(this.configuration).deleteSubtitle(e.itemId,e.index,t).then(s=>s(this.axios,this.basePath))}downloadRemoteSubtitles(e,t){return ji(this.configuration).downloadRemoteSubtitles(e.itemId,e.subtitleId,t).then(s=>s(this.axios,this.basePath))}getFallbackFont(e,t){return ji(this.configuration).getFallbackFont(e.name,t).then(s=>s(this.axios,this.basePath))}getFallbackFontList(e){return ji(this.configuration).getFallbackFontList(e).then(t=>t(this.axios,this.basePath))}getRemoteSubtitles(e,t){return ji(this.configuration).getRemoteSubtitles(e.subtitleId,t).then(s=>s(this.axios,this.basePath))}getSubtitle(e,t){return ji(this.configuration).getSubtitle(e.routeItemId,e.routeMediaSourceId,e.routeIndex,e.routeFormat,e.itemId,e.mediaSourceId,e.index,e.format,e.endPositionTicks,e.copyTimestamps,e.addVttTimeMap,e.startPositionTicks,t).then(s=>s(this.axios,this.basePath))}getSubtitlePlaylist(e,t){return ji(this.configuration).getSubtitlePlaylist(e.itemId,e.index,e.mediaSourceId,e.segmentLength,t).then(s=>s(this.axios,this.basePath))}getSubtitleWithTicks(e,t){return ji(this.configuration).getSubtitleWithTicks(e.routeItemId,e.routeMediaSourceId,e.routeIndex,e.routeStartPositionTicks,e.routeFormat,e.itemId,e.mediaSourceId,e.index,e.startPositionTicks,e.format,e.endPositionTicks,e.copyTimestamps,e.addVttTimeMap,t).then(s=>s(this.axios,this.basePath))}searchRemoteSubtitles(e,t){return ji(this.configuration).searchRemoteSubtitles(e.itemId,e.language,e.isPerfectMatch,t).then(s=>s(this.axios,this.basePath))}uploadSubtitle(e,t){return ji(this.configuration).uploadSubtitle(e.itemId,e.uploadSubtitleDto,t).then(s=>s(this.axios,this.basePath))}}class xL{constructor(){this.jellyfin=new rL({clientInfo:{name:"LegitFlix Client",version:"1.0.0.18"},deviceInfo:{name:"LegitFlix Web",id:"legitflix-web"}}),this.api=null}initialize(e=null,t=null){const s=t!==null?t:this.api?.basePath||window.location.origin;this.api=this.jellyfin.createApi(s,e),this.api.user=new dS(this.api.configuration),this.api.userLibrary=new oL(this.api.configuration),this.api.userViews=new uL(this.api.configuration),this.api.items=new hL(this.api.configuration),this.api.tvShows=new mL(this.api.configuration),this.api.library=new gL(this.api.configuration),this.api.subtitle=new yL(this.api.configuration),console.log("[LegitFlix] API Initialized. Access Token present:",!!e)}async getCurrentUser(){if(window.ApiClient)try{return await window.ApiClient.getCurrentUser()}catch(t){console.warn("Failed to get current user from window.ApiClient",t)}const e=localStorage.getItem("jellyfin_credentials");if(e)try{const t=JSON.parse(e);if(t.Servers&&t.Servers.length>0){const s=t.Servers.find(n=>n.AccessToken&&n.UserId);if(s){(!this.api||this.api.accessToken!==s.AccessToken)&&(console.log("[LegitFlix] Initializing API with stored token"),this.initialize(s.AccessToken));try{return(await this.api.user.getUserById({userId:s.UserId})).data}catch(n){return console.error("[LegitFlix] Token invalid or user not found. Clearing credentials.",n),this.logout(),null}}}}catch(t){console.error("[LegitFlix] Failed to parse jellyfin_credentials",t)}return null}async validateServer(e){const t=e.replace(/\/$/,""),s=new AbortController,n=setTimeout(()=>s.abort(),5e3);try{const r=await fetch(`${t}/System/Info/Public`,{signal:s.signal});if(clearTimeout(n),r.ok)return{valid:!0,data:await r.json(),baseUrl:t}}catch(r){clearTimeout(n),console.error("Server validation failed",r)}return{valid:!1}}async getPublicUsers(){return this.api||this.initialize(),(await this.api.user.getPublicUsers()).data}async authenticateUser(e,t){this.api||this.initialize();try{const n=(await this.api.user.authenticateUserByName({authenticateUserByName:{Username:e,Pw:t}})).data;if(n.AccessToken&&n.User){this.initialize(n.AccessToken);const r={Servers:[{DateLastAccessed:new Date().toISOString(),AccessToken:n.AccessToken,UserId:n.User.Id,Name:n.User.Name,ManualAddress:this.api.basePath}]};return localStorage.setItem("jellyfin_credentials",JSON.stringify(r)),n.User}}catch(s){throw console.error("Authentication failed",s),s}return null}async getItem(e,t){return this.api||this.initialize(),(await this.api.userLibrary.getItem({userId:e,itemId:t})).data}async getSimilarItems(e,t){return this.api||this.initialize(),(await this.api.library.getSimilarItems({userId:e,itemId:t,limit:12})).data}async getItems(e,t){return this.api||this.initialize(),(await this.api.items.getItems({userId:e,...t})).data}async markPlayed(e,t,s){this.api||this.initialize();const n=s?"POST":"DELETE",l=`${this.api.basePath||""}/Users/${e}/PlayedItems/${t}`;try{const c=this.api.accessToken,h={"Content-Type":"application/json"};c&&(h["X-Emby-Authorization"]=`MediaBrowser Client="${this.jellyfin.clientInfo.name}", Device="${this.jellyfin.deviceInfo.name}", DeviceId="${this.jellyfin.deviceInfo.id}", Version="${this.jellyfin.clientInfo.version}", Token="${c}"`);const d=await fetch(l,{method:n,headers:h});if(!d.ok)throw new Error(`Failed to mark played/unplayed: ${d.status} ${d.statusText}`);return await d.json()}catch(c){throw console.error("markPlayed failed",c),c}}async markFavorite(e,t,s){return this.api||this.initialize(),s?await this.api.userLibrary.markFavoriteItem({userId:e,itemId:t}):await this.api.userLibrary.unmarkFavoriteItem({userId:e,itemId:t})}async getSeasons(e,t){return this.api||this.initialize(),(await this.api.tvShows.getSeasons({userId:e,seriesId:t})).data}async getEpisodes(e,t,s){return this.api||this.initialize(),(await this.api.tvShows.getEpisodes({userId:e,seriesId:t,seasonId:s,fields:["MediaSources","RunTimeTicks","UserData","Overview","Path"]})).data}async getNextUp(e,t){return this.api||this.initialize(),(await this.api.tvShows.getNextUp({userId:e,seriesId:t,limit:1})).data}async getUserViews(e){return this.api||this.initialize(),(await this.api.userViews.getUserViews({userId:e})).data}async getSeries(e,t){this.api||this.initialize();const s=["Overview","Genres","Studios","OfficialRating","CommunityRating","ImageTags","BackdropImageTags","People","RemoteTrailers","LocalTrailers","ChildCount","MediaSources"];return(await this.api.userLibrary.getItem({userId:e,itemId:t,fields:s})).data}async getResumeItems(e,t=12){return this.api||this.initialize(),await this.getItems(e,{filters:["IsResumable"],sortBy:["DatePlayed"],sortOrder:["Descending"],limit:t,recursive:!0,includeItemTypes:["Movie","Episode"]})}async getHistoryItems(e,t=12){return this.api||this.initialize(),await this.getItems(e,{sortBy:["DatePlayed"],sortOrder:["Descending"],limit:t,recursive:!0,filters:["IsPlayed"],includeItemTypes:["Movie","Episode"],fields:["PrimaryImageAspectRatio","Overview","ImageTags","ProductionYear","RunTimeTicks"]})}async getItemDetails(e,t){this.api||this.initialize();try{const s=["RemoteTrailers","LocalTrailers","People","Studios","Genres","Overview","ProductionYear","OfficialRating","RunTimeTicks","Tags","ImageTags","MediaStreams","UserData","MediaSources","Trickplay"];return(await this.api.userLibrary.getItem({userId:e,itemId:t,fields:s})).data}catch(s){return console.error("getItemDetails failed",s),null}}async getLatestItems(e,t){this.api||this.initialize();try{return(await this.api.items.getItems({userId:e,parentId:t,sortBy:["DateCreated"],sortOrder:["Descending"],includeItemTypes:["Movie","Series"],recursive:!0,fields:["PrimaryImageAspectRatio","Overview","ImageTags","ProductionYear","RunTimeTicks"]})).data}catch(s){return console.error("getLatestItems failed",s),{Items:[]}}}getImageUrl(e,t="Primary",s={}){if(!e||!e.Id)return"";const{maxWidth:n=800,quality:r=90}=s;this.api||this.initialize();const l=this.api.configuration.basePath||"",c=e.ImageTags&&e.ImageTags[t]?`&tag=${e.ImageTags[t]}`:"";return`${l}/Items/${e.Id}/Images/${t}?maxWidth=${n}&quality=${r}${c}`}getPlaybackUrl(e){return`#/play/${e}`}getTrickplayTileUrl(e,t,s){return this.api||this.initialize(),`${this.api.configuration.basePath||""}/Videos/${e}/Trickplay/${t}/${s}.jpg`}async deleteSubtitle(e,t){return this.api||this.initialize(),(await this.api.subtitle.deleteSubtitle({itemId:e,index:t})).data}async searchRemoteSubtitles(e,t){return this.api||this.initialize(),(await this.api.subtitle.searchRemoteSubtitles({itemId:e,language:t,isPerfectMatch:!1})).data}async downloadRemoteSubtitles(e,t){return this.api||this.initialize(),(await this.api.subtitle.downloadRemoteSubtitles({itemId:e,subtitleId:t})).data}async getMediaStreams(e,t){this.api||this.initialize();const s=await this.getItemDetails(e,t);return s&&s.MediaSources&&s.MediaSources[0]?s.MediaSources[0].MediaStreams||[]:[]}async updatePassword(e,t,s){this.api||this.initialize();const n=await fetch(`${this.api.basePath}/Users/${e}/Password`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`MediaBrowser Token="${this.api.accessToken}"`},body:JSON.stringify({CurrentPw:t,NewPw:s})});if(!n.ok){const r=await n.text();throw new Error(r||"Failed to update password")}return!0}async updateUserConfiguration(e,t){if(this.api||this.initialize(),!(await fetch(`${this.api.basePath}/Users/${e}/Configuration`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`MediaBrowser Token="${this.api.accessToken}"`},body:JSON.stringify(t)})).ok)throw new Error("Failed to update user configuration");return!0}async getAllBackdrops(e,t=50){return this.api||this.initialize(),(await this.api.items.getItems({userId:e,includeItemTypes:["Movie","Series"],imageTypes:["Backdrop"],sortBy:["Random"],limit:t,recursive:!0,fields:["BackdropImageTags"]})).data?.Items||[]}async getUserViews(e){return this.api||this.initialize(),(await this.api.userViews.getUserViews({userId:e})).data}async searchItems(e,t,s=[],n=null){this.api||this.initialize();const r={searchTerm:t,recursive:!0,fields:["PrimaryImageAspectRatio","ProductionYear","DateCreated"],includeItemTypes:s,limit:20};return n&&n!=="All"&&(r.parentId=n),await this.getItems(e,r)}async quickConnect(e){if(this.api||this.initialize(),!(await fetch(`${this.api.basePath}/QuickConnect/Authorize?Code=${e}`,{method:"POST",headers:{Authorization:`MediaBrowser Token="${this.api.accessToken}"`}})).ok)throw new Error("Quick Connect failed. Check the code.");return!0}async initiateQuickConnect(){this.api||this.initialize();const e={"X-Emby-Authorization":`MediaBrowser Client="${this.jellyfin.clientInfo.name}", Device="${this.jellyfin.deviceInfo.name}", DeviceId="${this.jellyfin.deviceInfo.id}", Version="${this.jellyfin.clientInfo.version}"`},t=await fetch(`${this.api.basePath||""}/QuickConnect/Initiate`,{method:"POST",headers:e});if(!t.ok)throw new Error("Failed to initiate Quick Connect");return t.json()}async checkQuickConnectStatus(e){this.api||this.initialize();const t=await fetch(`${this.api.basePath||""}/QuickConnect/Connect?Secret=${e}`,{method:"GET"});if(t.status===200){const s=await t.json();if(s.Authenticated){this.initialize(s.AccessToken);const n=await this.api.user.getUserById({userId:s.UserId}),r={Servers:[{DateLastAccessed:new Date().toISOString(),AccessToken:s.AccessToken,UserId:n.data.Id,Name:n.data.Name,ManualAddress:this.api.basePath}]};return localStorage.setItem("jellyfin_credentials",JSON.stringify(r)),n.data}}return null}async logout(){if(console.log("[LegitFlix] Logging out..."),window.ApiClient)try{await window.ApiClient.logout()}catch(e){console.warn("ApiClient logout failed",e)}localStorage.removeItem("jellyfin_credentials"),this.api=null,window.location.href="/#/login/select-user"}async uploadUserImage(e,t,s){this.api||this.initialize();const n=this.api.accessToken;if(!n)throw new Error("No access token available for upload");const r=`MediaBrowser Client="${this.jellyfin.clientInfo.name}", Device="${this.jellyfin.deviceInfo.name}", DeviceId="${this.jellyfin.deviceInfo.id}", Version="${this.jellyfin.clientInfo.version}", Token="${n}"`,l=s.type||"image/png";console.log(`[LegitFlix] Uploading ${t} image. Size: ${s.size}, Type: ${l}`);const c=await fetch(`${this.api.basePath}/Users/${e}/Images/${t}`,{method:"POST",headers:{"Content-Type":l,"X-Emby-Authorization":r},body:s});if(!c.ok){const h=await c.text();throw console.error("Upload failed response:",h),new Error(`Failed to upload image: ${c.status} ${c.statusText}`)}return!0}async deleteUserImage(e,t){this.api||this.initialize();const s=this.api.accessToken;if(!s)throw new Error("No access token available for delete");const n=`MediaBrowser Client="${this.jellyfin.clientInfo.name}", Device="${this.jellyfin.deviceInfo.name}", DeviceId="${this.jellyfin.deviceInfo.id}", Version="${this.jellyfin.clientInfo.version}", Token="${s}"`,r=await fetch(`${this.api.basePath}/Users/${e}/Images/${t}`,{method:"DELETE",headers:{"X-Emby-Authorization":n}});if(!r.ok)throw new Error(`Failed to delete image: ${r.status} ${r.statusText}`);return!0}}const ee=new xL,He=({type:i="text",width:e,height:t,style:s={}})=>g.jsx("div",{className:`skeleton skeleton-${i}`,style:{width:e,height:t,...s}});function qv(i,e){if(typeof i=="function")return i(e);i!=null&&(i.current=e)}function SL(...i){return e=>{let t=!1;const s=i.map(n=>{const r=qv(n,e);return!t&&typeof r=="function"&&(t=!0),r});if(t)return()=>{for(let n=0;n<s.length;n++){const r=s[n];typeof r=="function"?r():qv(i[n],null)}}}}var bL=Symbol.for("react.lazy"),zc=rA[" use ".trim().toString()];function EL(i){return typeof i=="object"&&i!==null&&"then"in i}function hS(i){return i!=null&&typeof i=="object"&&"$$typeof"in i&&i.$$typeof===bL&&"_payload"in i&&EL(i._payload)}function TL(i){const e=_L(i),t=C.forwardRef((s,n)=>{let{children:r,...l}=s;hS(r)&&typeof zc=="function"&&(r=zc(r._payload));const c=C.Children.toArray(r),h=c.find(RL);if(h){const d=h.props.children,f=c.map(p=>p===h?C.Children.count(d)>1?C.Children.only(null):C.isValidElement(d)?d.props.children:null:p);return g.jsx(e,{...l,ref:n,children:C.isValidElement(d)?C.cloneElement(d,void 0,f):null})}return g.jsx(e,{...l,ref:n,children:r})});return t.displayName=`${i}.Slot`,t}var AL=TL("Slot");function _L(i){const e=C.forwardRef((t,s)=>{let{children:n,...r}=t;if(hS(n)&&typeof zc=="function"&&(n=zc(n._payload)),C.isValidElement(n)){const l=wL(n),c=LL(r,n.props);return n.type!==C.Fragment&&(c.ref=s?SL(s,l):l),C.cloneElement(n,c)}return C.Children.count(n)>1?C.Children.only(null):null});return e.displayName=`${i}.SlotClone`,e}var IL=Symbol("radix.slottable");function RL(i){return C.isValidElement(i)&&typeof i.type=="function"&&"__radixId"in i.type&&i.type.__radixId===IL}function LL(i,e){const t={...e};for(const s in e){const n=i[s],r=e[s];/^on[A-Z]/.test(s)?n&&r?t[s]=(...c)=>{const h=r(...c);return n(...c),h}:n&&(t[s]=n):s==="style"?t[s]={...n,...r}:s==="className"&&(t[s]=[n,r].filter(Boolean).join(" "))}return{...i,...t}}function wL(i){let e=Object.getOwnPropertyDescriptor(i.props,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?i.ref:(e=Object.getOwnPropertyDescriptor(i,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?i.props.ref:i.props.ref||i.ref)}const Qv={default:"lf-btn--primary",primary:"lf-btn--primary",ringHover:"lf-btn--ring-hover",glass:"lf-btn--glass",outline:"lf-btn--outline",ghost:"lf-btn--ghost",destructive:"lf-btn--destructive"},CL={default:"",sm:"lf-btn--sm",lg:"lf-btn--lg",icon:"lf-btn--icon"},ii=C.forwardRef(({className:i="",variant:e="default",size:t="default",asChild:s=!1,...n},r)=>{const l=s?AL:"button",c=Qv[e]||Qv.default,h=CL[t]||"",d=["lf-btn",c,h,i].filter(Boolean).join(" ");return g.jsx(l,{className:d,ref:r,...n})});ii.displayName="Button";const OL=({onInfoClick:i})=>{const{config:e}=Yi();As();const[t,s]=C.useState([]),[n,r]=C.useState(0),[l,c]=C.useState(0),[h,d]=C.useState(!0),f=C.useRef(null),p=C.useRef(null);C.useEffect(()=>{(async()=>{try{const N=await ee.getCurrentUser();if(!N){console.error("No user found for HeroCarousel. jellyfinService.api:",ee.api),d(!1);return}console.log("[HeroCarousel] User found:",N.Name,N.Id);const U=e.contentSortMode||"latest",D={latest:{sortBy:"DateCreated",sortOrder:"Descending"},random:{sortBy:"Random",sortOrder:"Descending"},topRated:{sortBy:"CommunityRating",sortOrder:"Descending"}},{sortBy:F,sortOrder:j}=D[U]||D.latest,M={includeItemTypes:e.heroMediaTypes,recursive:!0,sortBy:F,sortOrder:j,limit:20,fields:["PrimaryImageAspectRatio","Overview","ProductionYear","OfficialRating","CommunityRating","RunTimeTicks","Genres","MediaStreams","UserData","ImageTags","BackdropImageTags"],imageTypeLimit:1,enableImageTypes:["Backdrop","Primary","Logo"]};let se=((await ee.getItems(N.Id,M)).Items||[]).filter(de=>de.BackdropImageTags&&de.BackdropImageTags.length>0);const ne=se.length>3?se.slice(3,9):se.slice(0,6);for(const de of ne)if(de.Type==="Series")try{const k=await ee.getNextUp(N.Id,de.Id);k.Items&&k.Items.length>0&&(de._nextUp=k.Items[0])}catch(k){console.warn("Failed to fetch Next Up",k)}s(ne)}catch(N){console.error("HeroCarousel fetch error",N)}finally{d(!1)}})()},[e]);const v=()=>{s(w=>(w.length===0||r(N=>(N+1)%w.length),w)),c(w=>w+1)},x=w=>{r(w),c(N=>N+1),S()},S=()=>{f.current&&clearInterval(f.current),f.current=setInterval(v,8e3),p.current&&p.current.classList.remove("carousel-paused")};C.useEffect(()=>(t.length>0&&S(),()=>clearInterval(f.current)),[t]);const T=async(w,N)=>{w.stopPropagation(),w.currentTarget;const U=N.UserData?.IsFavorite,D={...N,UserData:{...N.UserData,IsFavorite:!U}};s(F=>F.map(j=>j.Id===N.Id?D:j));try{const F=await ee.getCurrentUser();F&&await ee.markFavorite(F.Id,N.Id,!U)}catch(F){console.error("Failed to toggle fav",F),s(j=>j.map(M=>M.Id===N.Id?N:M))}};if(h)return g.jsxs("div",{className:"hero-carousel-container",style:{height:"90vh",background:"#111",position:"relative"},children:[g.jsx(He,{width:"100%",height:"100%"}),g.jsxs("div",{style:{position:"absolute",top:"42.5%",left:"4%",transform:"translateY(-50%)",width:"40%",maxWidth:"600px",display:"flex",flexDirection:"column",gap:"1.25rem"},children:[g.jsx(He,{width:"70%",height:"60px",style:{marginBottom:"0"}}),g.jsx(He,{width:"40%",height:"24px"}),g.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"8px",width:"100%"},children:[g.jsx(He,{width:"100%",height:"18px"}),g.jsx(He,{width:"95%",height:"18px"}),g.jsx(He,{width:"60%",height:"18px"})]}),g.jsxs("div",{style:{display:"flex",gap:"12px",marginTop:"0.5rem"},children:[g.jsx(He,{width:"160px",height:"46px",style:{borderRadius:"50px"}}),g.jsx(He,{width:"42px",height:"42px",style:{borderRadius:"50%"}}),g.jsx(He,{width:"42px",height:"42px",style:{borderRadius:"50%"}})]})]})]});if(t.length===0)return null;const E=w=>`${ee.api.basePath}/Items/${w}/Images/Backdrop/0?maxHeight=1080&quality=96`,A=w=>`${ee.api.basePath}/Items/${w}/Images/Logo?maxHeight=200&maxWidth=450&quality=90`,_=w=>{let N=new Set,U=new Set;w.MediaStreams&&w.MediaStreams.forEach(j=>{j.Type==="Audio"&&j.Language&&N.add(j.Language),j.Type==="Subtitle"&&j.Language&&U.add(j.Language)});const D=U.size>0,F=N.size>1;return D&&F?"Sub | Dub":D?"Sub":F?"Dub":""},R=w=>{if(w.RunTimeTicks&&w.Type!=="Series"){const N=w.RunTimeTicks/1e4,D=new Date(Date.now()+N).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1});return g.jsxs(g.Fragment,{children:[g.jsx("span",{className:"hero-meta-divider",children:""}),g.jsxs("span",{className:"hero-meta-text",children:["Ends at ",D]})]})}return null};return g.jsxs("div",{id:"legit-hero-carousel",className:"hero-carousel-container",ref:p,children:[t.map((w,N)=>{const U=N===n,D=_(w),F=R(w),j=w.ImageTags&&w.ImageTags.Logo;let M="START WATCHING",H="";if(w.Type==="Series")if(w._nextUp){const se=w._nextUp.ParentIndexNumber,ne=w._nextUp.IndexNumber;M="CONTINUE",H=`S${se} E${ne}`}else H="S1 E1";else if(w.UserData&&w.UserData.PlaybackPositionTicks>0){const se=Math.round(w.UserData.PlaybackPositionTicks/w.RunTimeTicks*100);se>2&&se<90&&(M="CONTINUE",H=` - ${se}%`)}const K=w.UserData?.IsFavorite;return g.jsxs("div",{className:`hero-slide ${U?"active":""}`,"data-index":N,children:[g.jsx("div",{className:"hero-backdrop",style:{backgroundImage:`url('${E(w.Id)}')`}}),g.jsx("div",{className:"hero-overlay"}),g.jsxs("div",{className:"hero-content",children:[j?g.jsx("img",{src:A(w.Id),className:"hero-logo",alt:w.Name}):g.jsx("h1",{className:"hero-title",children:w.Name}),g.jsxs("div",{className:"hero-meta-line",children:[g.jsx("span",{className:"hero-badge-age",children:w.OfficialRating||"13+"}),D&&g.jsxs(g.Fragment,{children:[g.jsx("span",{className:"hero-meta-divider",children:""}),g.jsx("span",{className:"hero-meta-text",children:D})]}),g.jsx("span",{className:"hero-meta-divider",children:""}),g.jsx("span",{className:"hero-meta-text",children:w.Genres?w.Genres.slice(0,3).join(", "):"Anime"}),w.CommunityRating&&g.jsxs(g.Fragment,{children:[g.jsx("span",{className:"hero-meta-divider",children:""}),g.jsxs("span",{className:"hero-meta-text",children:[" ",w.CommunityRating.toFixed(1)]})]}),F]}),g.jsx("p",{className:"hero-desc",children:w.Overview}),g.jsxs("div",{className:"hero-actions flex gap-3 items-center",children:[g.jsxs(ii,{variant:"ringHover",onClick:se=>{se.stopPropagation(),window.location.href=`/web/index.html?classic=true#!/playback?id=${w.Id}`},children:[g.jsx("i",{className:"material-icons",children:"play_arrow"}),g.jsxs("span",{children:[M," ",g.jsx("small",{className:"text-sm ml-1",children:H})]})]}),g.jsx(ii,{variant:"outline",size:"icon",className:`rounded-full w-12 h-12 border-2 border-white/20 bg-black/40 hover:bg-white/10 hover:border-white ${K?"text-primary":"text-white"}`,onClick:se=>T(se,w),children:g.jsx("span",{className:K?"material-icons":"material-icons-outlined",children:K?"bookmark":"bookmark_border"})}),g.jsx(ii,{variant:"outline",size:"icon",className:"rounded-full w-12 h-12 border-2 border-white/20 bg-black/40 hover:bg-white/10 hover:border-white text-white",onClick:se=>{se.stopPropagation(),i(w.Id)},title:"More Info",children:g.jsx("span",{className:"material-icons-outlined",children:"info"})})]})]})]},w.Id)}),g.jsx("div",{className:"hero-indicators",children:t.map((w,N)=>{const U=N===n,D=N<n;return g.jsx("div",{className:`hero-indicator ${U?"active":""} ${D?"completed":""}`,onClick:()=>x(N),children:g.jsx("div",{className:"fill"},`fill-${N}-${U?l:"inactive"}`)},N)})})]})},NL=({item:i,onClick:e})=>{const[t,s]=C.useState(!1),[n,r]=C.useState(null),[l,c]=C.useState({top:0,left:0,width:0,height:0}),h=C.useRef(null),d=C.useRef(null),[f,p]=C.useState(i.UserData||{}),v=async()=>{if(h.current&&(clearTimeout(h.current),h.current=null),d.current){const R=d.current.getBoundingClientRect();if(c({top:R.top+window.scrollY,left:R.left+window.scrollX,width:R.width,height:R.height}),s(!0),!n)try{const w=await ee.getCurrentUser();if(w){const N=await ee.getItemDetails(w.Id,i.Id);r(N),p(N.UserData||{})}}catch(w){console.error("Failed to fetch details",w)}}},x=()=>{h.current=setTimeout(()=>{s(!1)},100)},S=()=>{h.current&&(clearTimeout(h.current),h.current=null)},T=async(R,w)=>{if(R.stopPropagation(),!!n)try{const N=await ee.getCurrentUser();if(w==="played"){const U=!f.Played;p(D=>({...D,Played:U})),await ee.markPlayed(N.Id,i.Id,U)}else if(w==="favorite"){const U=!f.IsFavorite;p(D=>({...D,IsFavorite:U})),await ee.markFavorite(N.Id,i.Id,U)}}catch(N){console.error("Action failed",N)}},E=()=>{const R=[];return i.ProductionYear&&R.push(i.ProductionYear),i.Type==="Series"&&i.Status==="Continuing"&&R.push("Airing"),R.join("  ")||""},A=R=>{if(!R||!R.MediaSources||!R.MediaSources[0])return null;const w=R.MediaSources[0].MediaStreams||[];if(w.length===0)return null;const N=w.filter(M=>M.Type==="Audio"),U=w.filter(M=>M.Type==="Subtitle"),D=N.some(M=>M.Language==="eng"||M.Language==="en"||M.Language==="english"||M.DisplayTitle&&M.DisplayTitle.toLowerCase().includes("eng")),F=N.some(M=>M.Language==="jpn"||M.Language==="ja"||M.Language==="japanese"||M.DisplayTitle&&M.DisplayTitle.toLowerCase().includes("jap")),j=U.some(M=>M.Language==="eng"||M.Language==="en"||M.Language==="english"||M.DisplayTitle&&M.DisplayTitle.toLowerCase().includes("eng"));return D&&(F||j)?"Sub | Dub":D?"Dub":j?"Sub":null},_=()=>{if(!t)return null;const R=n||i,w=R.CommunityRating?R.CommunityRating.toFixed(1):"",N=R.VoteCount?`(${(R.VoteCount/1e3).toFixed(1)}K)`:"",U=R.ChildCount,D=R.RecursiveItemCount||R.ChildCount,F=A(R),j=l.width+4,M=l.height+8,H=l.left-2,K=l.top-4,se=`${ee.api.basePath}/Items/${i.Id}/Images/Primary?fillHeight=600&fillWidth=400&quality=90`;return Y_.createPortal(g.jsxs("div",{className:"media-card-hover-overlay",style:{top:K,left:H,width:j,minHeight:M,backgroundImage:`url('${se}')`},onMouseEnter:S,onMouseLeave:x,onClick:e,children:[g.jsx("div",{className:"hover-overlay-gradient"}),g.jsxs("div",{className:"hover-overlay-content",children:[g.jsxs("div",{className:"hover-info-group",children:[g.jsx("h3",{className:"hover-title",children:R.Name}),g.jsxs("div",{className:"hover-meta-row",children:[w&&g.jsxs("span",{className:"hover-rating",children:[w," ",g.jsx("span",{className:"material-icons star-icon",children:"star"}),N&&g.jsx("span",{className:"hover-rating-count",children:N})]}),g.jsx("span",{className:"hover-meta-separator",children:""}),g.jsxs("div",{className:"hover-stats",children:[R.Type==="Series"?g.jsxs(g.Fragment,{children:[U?g.jsxs("span",{children:[U," Seasons"]}):null,U&&D?g.jsx("span",{children:"  "}):null,D?g.jsxs("span",{children:[D," Episodes"]}):null]}):g.jsx("span",{children:R.ProductionYear}),F&&g.jsxs(g.Fragment,{children:[g.jsx("span",{children:"  "}),g.jsx("span",{style:{color:"#fff",fontWeight:"bold",border:"1px solid rgba(255,255,255,0.3)",padding:"0 4px",borderRadius:"3px",fontSize:"0.7rem"},children:F})]})]})]}),R.Overview&&g.jsx("p",{className:"hover-desc",children:R.Overview})]}),g.jsxs("div",{className:"hover-actions",children:[g.jsx("button",{className:"btn-action-icon play-icon",title:"Play",onClick:ne=>{ne.stopPropagation(),e&&e()},children:g.jsx("span",{className:"material-icons",children:"play_arrow"})}),g.jsx("button",{className:`btn-action-icon bookmark-icon ${f.IsFavorite?"active":""}`,onClick:ne=>T(ne,"favorite"),title:f.IsFavorite?"Unfavorite":"Favorite",children:g.jsx("span",{className:"material-icons",children:f.IsFavorite?"bookmark":"bookmark_border"})}),g.jsx("button",{className:`btn-action-icon plus-icon ${f.Played?"active":""}`,onClick:ne=>T(ne,"played"),title:f.Played?"Mark Unplayed":"Mark Played",children:g.jsx("span",{className:"material-icons",children:"add"})})]})]})]}),document.body)};return g.jsxs(g.Fragment,{children:[g.jsxs("div",{className:"media-card",ref:d,onMouseEnter:v,onMouseLeave:x,onClick:e,children:[g.jsx("div",{className:"media-card-image-container",children:g.jsx("img",{src:`${ee.api.basePath}/Items/${i.Id}/Images/Primary?fillHeight=500&fillWidth=340&quality=90`,alt:i.Name,className:"media-card-image",loading:"lazy",onError:R=>{R.target.style.display="none"}})}),g.jsxs("div",{className:"media-card-info",children:[g.jsx("div",{className:"media-card-title",children:i.Name}),E()&&g.jsx("div",{className:"media-card-subtitle",children:E()})]})]}),_()]})},DL=({title:i,libraryId:e,onCardClick:t})=>{const[s,n]=C.useState([]),[r,l]=C.useState(!0),[c,h]=C.useState(!1),[d,f]=C.useState(!1),p=C.useRef(null),v=As(),x=()=>{if(p.current){const{scrollLeft:T,scrollWidth:E,clientWidth:A}=p.current;h(T>5),f(T+A<E-5)}};C.useEffect(()=>{(async()=>{l(!0);try{const E=await ee.getCurrentUser();if(E&&e){const A=await ee.getLatestItems(E.Id,e);A&&A.Items&&n(A.Items)}}catch(E){console.error("MediaRow fetch error",E)}finally{l(!1)}})()},[e]),C.useEffect(()=>{if(!r&&s.length>0){const T=setTimeout(x,100);return window.addEventListener("resize",x),()=>{window.removeEventListener("resize",x),clearTimeout(T)}}},[r,s]);const S=T=>{if(p.current){const E=p.current,A=window.innerWidth*.8;E.scrollBy({left:T==="left"?-A:A,behavior:"smooth"}),setTimeout(x,500)}};return r?g.jsxs("div",{className:"media-row-container",children:[g.jsx("div",{style:{padding:"0 4%",marginBottom:"15px"},children:g.jsx(He,{width:"150px",height:"24px"})}),g.jsx("div",{className:"media-row-wrapper",style:{paddingLeft:"4%",display:"flex",gap:"15px",overflow:"hidden"},children:[1,2,3,4,5,6].map(T=>g.jsx("div",{style:{flex:"0 0 160px"},children:g.jsx(He,{width:"100%",height:"240px",style:{borderRadius:"8px"}})},T))})]}):s.length===0?null:g.jsxs("div",{className:"media-row-container",children:[g.jsxs("h2",{className:"media-row-title",onClick:()=>v(`/library/${e}`),style:{cursor:"pointer",display:"flex",alignItems:"center",gap:"5px"},children:[i," ",g.jsx("span",{style:{fontSize:"0.8em",opacity:.7},children:""})]}),g.jsxs("div",{className:"media-row-wrapper",children:[c&&g.jsx("button",{className:"row-arrow left",onClick:()=>S("left"),children:g.jsx("span",{className:"material-icons",children:"chevron_left"})}),g.jsx("div",{className:"media-row-scroll",ref:p,onScroll:x,children:s.map(T=>g.jsx(NL,{item:T,onClick:()=>t?t(T):v(`/item/${T.Id}`)},T.Id))}),d&&g.jsx("button",{className:"row-arrow right",onClick:()=>S("right"),children:g.jsx("span",{className:"material-icons",children:"chevron_right"})})]})]})},kL=({itemId:i,onClose:e,isOpen:t})=>{const[s,n]=C.useState(null),[r,l]=C.useState([]),[c,h]=C.useState(null),[d,f]=C.useState(!0),[p,v]=C.useState(!1),[x,S]=C.useState(!1),[T,E]=C.useState(null);if(C.useEffect(()=>!t||!i?void 0:((async()=>{S(!0);const M=await ee.getCurrentUser(),H=K=>K?K.includes("v=")?K.split("v=")[1].split("&")[0]:K.includes("youtu.be/")?K.split("youtu.be/")[1].split("?")[0]:K.includes("embed/")?K.split("embed/")[1].split("?")[0]:null:null;if(M){E(M.Id);const K=await ee.getItemDetails(M.Id,i);n(K);const se=[];if(K.RemoteTrailers&&K.RemoteTrailers.forEach(ne=>{const de=H(ne.Url);de&&se.push({title:"Main Trailer",id:de,type:"Movie"})}),K.Type==="Series"&&(await ee.getSeasons(M.Id,i)).forEach(de=>{de.RemoteTrailers&&de.RemoteTrailers.forEach(k=>{const G=H(k.Url);G&&se.push({title:de.Name,id:G})})}),K.LocalTrailers&&K.LocalTrailers.forEach(ne=>{se.push({title:ne.Name||"Local Trailer",id:ne.Id,type:"Local"})}),l(se),se.length>0)h(se[0].id);else if(K.Type==="Series"||K.Type==="Movie"){const ne=`${K.Name} ${K.ProductionYear||""} Trailer`;l([{title:"Search YouTube",id:ne,type:"Search"}]),h(ne)}}})(),document.body.style.overflow="hidden",()=>{document.body.style.overflow="",n(null),l([]),h(null),S(!1)}),[t,i]),C.useEffect(()=>{let j;const M=()=>{v(!1),clearTimeout(j),j=setTimeout(()=>v(!0),5e3)};return window.addEventListener("mousemove",M),window.addEventListener("click",M),M(),()=>{window.removeEventListener("mousemove",M),window.removeEventListener("click",M),clearTimeout(j)}},[t]),!t||!s)return null;const A=async()=>{if(!T||!s)return;const j=!s.UserData?.IsFavorite;n(M=>({...M,UserData:{...M.UserData,IsFavorite:j}}));try{await ee.markFavorite(T,s.Id,j)}catch{n(H=>({...H,UserData:{...H.UserData,IsFavorite:!j}}))}},_=()=>{window.location.href=`#!/details?id=${s.Id}`},R=()=>{f(!d)},w=`${ee.api.basePath}/Items/${s.Id}/Images/Backdrop/0?quality=90&maxWidth=1920`,N=s.ImageTags&&s.ImageTags.Logo?`${ee.api.basePath}/Items/${s.Id}/Images/Logo?maxHeight=140&maxWidth=400&quality=90`:null,U=r.find(j=>j.id===c);let D=null,F=!1;return U&&(U.type==="Local"?(F=!0,D=`${ee.api.basePath}/Videos/${U.id}/stream?Container=mp4&Static=true&api_key=${ee.api.accessToken}`):U.type==="Search"?D=`https://www.youtube.com/embed?listType=search&list=${encodeURIComponent(U.id)}&autoplay=1&mute=${d?1:0}&loop=1&modestbranding=1&rel=0&iv_load_policy=3&fs=0&color=white&controls=0&disablekb=1`:D=`https://www.youtube.com/embed/${U.id}?autoplay=1&mute=${d?1:0}&loop=1&modestbranding=1&rel=0&iv_load_policy=3&fs=0&color=white&controls=0&disablekb=1&playlist=${U.id}&enablejsapi=1`),g.jsxs("div",{className:`legitflix-info-modal ${x?"visible":""}`,children:[g.jsx("div",{className:"info-modal-backdrop",onClick:e}),g.jsxs("div",{className:"info-modal-content",children:[g.jsx(ii,{variant:"ghost",size:"icon",className:"btn-close-modal absolute top-5 right-5 z-50 rounded-full bg-black/50 text-white hover:bg-white/20",onClick:e,children:g.jsx("span",{className:"material-icons",children:"close"})}),g.jsxs("div",{className:"info-video-container",children:[g.jsx("div",{className:"iframe-wrapper",children:D?F?g.jsx("video",{className:"info-video-iframe",src:D,autoPlay:!0,muted:d,loop:!0,playsInline:!0,style:{objectFit:"cover",width:"100%",height:"100%"}}):g.jsx("iframe",{className:"info-video-iframe",src:D,title:"Trailer",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"}):g.jsx("div",{className:"info-backdrop-fallback",style:{backgroundImage:`url('${w}')`}})}),g.jsx("div",{className:"video-overlay-gradient"}),D&&g.jsx("div",{className:"video-mute-overlay",children:g.jsx(ii,{variant:"ghost",size:"icon",className:"rounded-full w-10 h-10 border border-white/30 bg-black/30 hover:bg-white/10 text-white",onClick:R,children:g.jsx("span",{className:"material-icons text-lg",children:d?"volume_off":"volume_up"})})}),g.jsxs("div",{className:`info-hero-content ${p?"idle":""}`,children:[N?g.jsx("img",{src:N,className:"info-logo",alt:s.Name}):g.jsx("h1",{className:"info-title-text",children:s.Name}),g.jsxs("div",{className:"info-actions flex gap-4 mt-6",children:[g.jsxs(ii,{variant:"ringHover",size:"lg",className:"h-12 px-8 text-lg font-bold rounded-md gap-2",onClick:_,children:[g.jsx("span",{className:"material-icons",children:"play_arrow"})," Play"]}),g.jsxs(ii,{variant:"outline",size:"lg",className:`h-12 px-6 text-lg rounded-md gap-2 border-2 bg-transparent hover:bg-white/10 ${s.UserData?.IsFavorite?"border-primary text-primary":"border-white/40 text-white"}`,onClick:A,children:[g.jsx("span",{className:"material-icons",children:s.UserData?.IsFavorite?"check":"add"})," My List"]})]})]})]}),g.jsx("div",{className:"info-details-container",children:g.jsxs("div",{className:"info-col-left",children:[g.jsxs("div",{className:"info-meta-row",children:[g.jsx("span",{className:"info-year",children:s.ProductionYear}),s.OfficialRating&&g.jsx("span",{className:"info-rating",children:s.OfficialRating}),g.jsx("span",{className:"info-duration",children:s.RunTimeTicks?Math.round(s.RunTimeTicks/6e8)+"m":""}),g.jsx("span",{className:"info-quality",children:"HD"})]}),g.jsx("p",{className:"info-desc",children:s.Overview||"No description available."})]})}),g.jsxs("div",{className:"info-trailers-section",children:[g.jsx("h3",{children:"Trailers & More"}),g.jsxs("div",{className:"trailers-grid",children:[r.map(j=>g.jsxs("div",{className:"trailer-card",onClick:()=>h(j.id),children:[g.jsxs("div",{className:"trailer-thumb",children:[j.type==="Local"?g.jsx("div",{className:"local-trailer-placeholder",children:g.jsx("span",{className:"material-icons",children:"movie"})}):g.jsx("img",{src:`https://img.youtube.com/vi/${j.id}/mqdefault.jpg`,alt:j.title,loading:"lazy"}),g.jsx("div",{className:"play-overlay",children:g.jsx("span",{className:"material-icons",children:"play_circle_outline"})})]}),g.jsx("div",{className:"trailer-title",children:j.title})]},j.id)),g.jsxs("a",{href:`https://www.youtube.com/results?search_query=${encodeURIComponent(s.Name+" "+(s.ProductionYear||"")+" trailer")}`,target:"_blank",rel:"noopener noreferrer",className:"trailer-card search-card",children:[g.jsx("div",{className:"trailer-thumb search-thumb",children:g.jsx("span",{className:"material-icons",children:"search"})}),g.jsx("div",{className:"trailer-title",children:"Search YouTube"})]})]})]}),g.jsxs("div",{className:"info-about-section",children:[g.jsxs("h3",{children:["About ",s.Name]}),s.People&&g.jsxs("div",{className:"about-row",children:[g.jsx("span",{className:"label",children:"Cast: "}),g.jsx("span",{className:"value",children:s.People.slice(0,10).map(j=>j.Name).join(", ")})]}),s.Genres&&g.jsxs("div",{className:"about-row",children:[g.jsx("span",{className:"label",children:"Genres: "}),g.jsx("span",{className:"value",children:s.Genres.join(", ")})]})]})]})]})},PL=()=>{const{config:i}=Yi();return i.enableJellyseerr?g.jsx("div",{className:"library-card jellyseerr-card-wrapper",children:g.jsx("a",{href:i.jellyseerrUrl,target:"_blank",rel:"noopener noreferrer",className:"jellyseerr-card",children:g.jsxs("div",{className:"jellyseerr-image",style:{backgroundImage:`url('${i.jellyseerrBackground||"https://raw.githubusercontent.com/gorillasuti/Legitflix-plugin/refs/heads/main/legitflix-client/public/jellyseerr.jpg"}')`},children:[g.jsx("div",{className:"jellyseerr-overlay"}),g.jsxs("div",{className:"jellyseerr-content",children:[g.jsx("span",{className:"material-icons card-icon",children:"add_circle_outline"}),g.jsx("span",{className:"card-label",children:i.jellyseerrText||"Request Feature"})]})]})})}):null},UL=({isOpen:i,onClose:e})=>{const[t,s]=C.useState(""),[n,r]=C.useState([]),[l,c]=C.useState({Name:"All",Id:"All"}),[h,d]=C.useState([{Name:"All",Id:"All"}]),[f,p]=C.useState(!1),v=C.useRef(null),x=As();if(C.useEffect(()=>{(async()=>{try{const E=await ee.getCurrentUser();if(E){const A=await ee.getUserViews(E.Id);A&&A.Items&&d([{Name:"All",Id:"All"},...A.Items])}}catch(E){console.error("Failed to fetch views",E)}})()},[]),C.useEffect(()=>{i&&setTimeout(()=>v.current?.focus(),100)},[i]),C.useEffect(()=>{const E=setTimeout(async()=>{if(p(!0),r([]),t.trim().length===0){if(l.Id!=="All")try{const A=await ee.getCurrentUser();if(A){const _=await ee.getItems(A.Id,{parentId:l.Id,limit:20,sortBy:["DateCreated"],sortOrder:["Descending"],includeItemTypes:["Movie","Series","BoxSet"],recursive:!0,fields:["PrimaryImageAspectRatio","ProductionYear"]});r(_.Items||[])}}catch(A){console.error("Category fetch failed",A),r([])}else r([]);p(!1);return}try{const A=await ee.getCurrentUser();if(!A){p(!1);return}const _=await ee.searchItems(A.Id,t,["Movie","Series","Person","BoxSet"],l.Id);r(_.Items||[])}catch(A){console.error("Search failed",A)}finally{p(!1)}},300);return()=>clearTimeout(E)},[t,l]),!i)return null;const S=T=>{e(),T.Type==="Movie"?x(`/movie/${T.Id}`):T.Type==="Series"?x(`/series/${T.Id}`):T.Type==="Person"?x(`/person/${T.Id}`):T.Type==="BoxSet"?x(`/collections/${T.Id}`):x(`/details/${T.Id}`)};return g.jsx("div",{className:`legit-search-overlay ${i?"visible":""}`,onClick:e,children:g.jsxs("div",{className:"legit-search-modal",onClick:T=>T.stopPropagation(),children:[g.jsxs("div",{className:"legit-search-header",children:[g.jsx("span",{className:"material-icons legit-search-icon",children:"search"}),g.jsx("input",{ref:v,className:"legit-search-input",placeholder:"Start typing to search...",value:t,onChange:T=>s(T.target.value),onKeyDown:T=>{T.key==="Escape"&&e()}}),g.jsxs("div",{className:"legit-search-actions",onClick:e,children:[g.jsx("span",{className:"legit-search-esc",children:"esc"}),g.jsx("span",{className:"legit-search-close",children:"Close"})]})]}),g.jsx("div",{className:"legit-search-categories",children:h.map(T=>g.jsx("div",{className:`legit-search-category-pill ${l.Id===T.Id?"active":""}`,onClick:()=>c(T),children:T.Name},T.Id))}),g.jsx("div",{className:"legit-search-results",children:f?Array.from({length:5}).map((T,E)=>g.jsxs("div",{className:"legit-search-result-item skeleton-item",style:{pointerEvents:"none"},children:[g.jsx(He,{width:"40px",height:"60px",style:{borderRadius:"4px",marginRight:"15px"}}),g.jsxs("div",{className:"legit-result-info",style:{width:"100%"},children:[g.jsx(He,{width:"60%",height:"20px",style:{marginBottom:"8px"}}),g.jsx(He,{width:"30%",height:"14px"})]})]},`skeleton-${E}`)):g.jsxs(g.Fragment,{children:[n.length===0&&t.length>0&&g.jsxs("div",{className:"legit-no-results",children:['No results found for "',t,'"']}),n.length===0&&t.length===0&&l.Id!=="All"&&g.jsxs("div",{className:"legit-no-results",children:["No items found in ",l.Name]}),t.length===0&&l.Id==="All"&&g.jsxs("div",{className:"legit-search-helper",children:[g.jsx("span",{className:"material-icons",children:"keyboard"}),g.jsx("p",{children:"Start typing to search..."})]}),n.map(T=>g.jsxs("div",{className:"legit-search-result-item",onClick:()=>S(T),children:[g.jsx("div",{className:"legit-result-thumb",style:{backgroundImage:`url(${ee.api.basePath}/Items/${T.Id}/Images/Primary?fillHeight=60&fillWidth=40&quality=90)`,backgroundColor:"#222"},children:!T.ImageTags?.Primary&&g.jsx("span",{className:"material-icons legit-result-icon-fallback",children:"movie"})}),g.jsxs("div",{className:"legit-result-info",children:[g.jsx("div",{className:"legit-result-title",children:T.Name}),g.jsxs("div",{className:"legit-result-meta",children:[g.jsx("span",{className:"legit-result-tag",children:T.Type?.toUpperCase()}),T.ProductionYear&&g.jsx("span",{children:T.ProductionYear})]})]})]},T.Id))]})})]})})},Qf=({isOpen:i,onClose:e,onSave:t,userId:s})=>{const[n,r]=C.useState([]),[l,c]=C.useState(null),[h,d]=C.useState(!1);if(C.useEffect(()=>{if(!i||!s)return;d(!0),c(null),(async()=>{try{const T=(await ee.getAllBackdrops(s,50)).filter(E=>E.BackdropImageTags&&E.BackdropImageTags.length>0);r(T)}catch(S){console.error("[BannerPicker] Failed to fetch backdrops",S)}finally{d(!1)}})()},[i,s]),!i)return null;const f=x=>{const S=x.BackdropImageTags?.[0];return`${ee.api.basePath}/Items/${x.Id}/Images/Backdrop/0?quality=80&maxWidth=600&tag=${S}`},p=x=>{const S=x.BackdropImageTags?.[0];return`${ee.api.basePath}/Items/${x.Id}/Images/Backdrop/0?quality=90&maxWidth=1920&tag=${S}`},v=()=>{l&&t(l),e()};return g.jsxs("div",{className:"banner-picker-overlay",children:[g.jsx("div",{className:"banner-picker-backdrop",onClick:e}),g.jsxs("div",{className:"banner-picker-modal",children:[g.jsx("h2",{className:"banner-picker-title",children:"Select Banner"}),h?g.jsx("div",{className:"banner-picker-grid",children:[1,2,3,4,5,6,7,8,9,10,11,12].map(x=>g.jsx("div",{className:"banner-picker-card",children:g.jsx(He,{width:"100%",height:"100%",style:{borderRadius:"6px"}})},x))}):g.jsx("div",{className:"banner-picker-grid",children:n.map(x=>{const S=f(x),T=p(x),E=l===T;return g.jsx("div",{className:`banner-picker-card ${E?"selected":""}`,onClick:()=>c(T),children:g.jsx("img",{src:S,alt:x.Name,loading:"lazy"})},x.Id)})}),g.jsxs("div",{className:"banner-picker-actions",children:[g.jsx("button",{className:"btn-picker-close",onClick:e,children:"CLOSE"}),g.jsxs("button",{className:"btn-picker-save",onClick:v,disabled:!l,children:[g.jsx("span",{className:"material-icons",children:"save"})," SAVE"]})]})]})]})},ML=["010c7b9061ece2fbf7bbb8d9bb6d2bee16f4a68c.png","1b2d497a3f909e45b0cdbc08cc6d5aa1a949a1a2.png","1def8ba1616b0966e1db6021f1055ca356d1cea9.png","27c51845bddee8f4ff1c30aeb716d8aa731b6286.png","31687dea129fb21a578977565077d44b0ca92da5.png","3394687450705634476d174e6b395f0aa41db487.png","339bc7408b3c9e38fe40f8d6689bf441bca8357a.png","35d29230db5589057d23849f6369f22e90044cd1.png","38d52512bdd7a762bbadf4ae673d80140a118957.png","3bf2c8889e738213673c1a77803587aedd4a8148.png","45aff5dc4892254211d4982c12e2bf0ac8caef90.png","5e3f3f8dd9ca520c92d2b3dd23ec9737203631d9.png","62c5f931445c1a5a1228cb24f913fa0234a577c2.png","64fd2f5c0fbb5e0c5348f3947e5fd6b762e3e8ea.png","6980956ae6150a0697586505546be9ad377250a0.png","6ef91d4e1b1377703ed9caef1072f327c5ce107f.png","71dcab8c2f39540c99eab624d2bdada0ac9cb44e.png","79b07958e72c796a12eceba7832dc8e3bae85ca9.png","7cafcf32034f4c292574ced3e745a83d0c68e11e.png","8623109ba7bc471ab63ca32e1d820c3806c2c36c.png","98b48b004a2882f1dc3e9f12167304d6417d3bd4.png","99d8a4f741a9f042c71a6d2f5017f39f6f35e350.png","ab21304ad03dc74e4267320069636ca096ec7ea2.png","ae4337ebf3305b6c66020fde433c92257b7c5616.png","aebd06a8792119a23ca1c11a285cfca7468bfa67.png","b0caf3e60209775ab9c34662b7d860ba3e07f17a.png","b20b75517fe91a777d67d434f534378c987c8f89.png","b628ef1fe21c1a97773cab1b8efe341f651a20ef.png","c9d0048f1edf7bd5c415e676ebfce0e600166481.png","cde86a64d2c491f4494c916fc81fdc3a1980654e.png","d96038f9fde13a71369fd3b42bd53832f8db4be0.png","e8b7f5f61a4905834e169f89f3835b905659a44d.png","Netflix-abaya-61.png","Netflix-abaya-69.png","Netflix-academic_gown-27.png","Netflix-academic_gown-75.png","Netflix-affenpinscher-38.png","Netflix-ashcan-38.png","Netflix-balance_beam-10.png","Netflix-balloon-17.png","Netflix-balloon-20.png","Netflix-balloon-24.png","Netflix-balloon-35.png","Netflix-balloon-58.png","Netflix-ballplayer-21.png","Netflix-Band_Aid-23.png","Netflix-Band_Aid-29.png","Netflix-Band_Aid-34.png","Netflix-Band_Aid-54.png","Netflix-Band_Aid-65.png","Netflix-Band_Aid-92.png","Netflix-Band_Aid-94.png","Netflix-barn_spider-14.png","Netflix-basenji-11.png","Netflix-bassoon-11.png","Netflix-bearskin-54.png","Netflix-bikini-14.png","Netflix-bikini-26.png","Netflix-binoculars-62.png","Netflix-book_jacket-14.png","Netflix-bow_tie-10.png","Netflix-bow_tie-13.png","Netflix-bow_tie-39.png","Netflix-bow_tie-66.png","Netflix-bow_tie-97.png","Netflix-brassiere-11.png","Netflix-brassiere-15.png","Netflix-brassiere-18.png","Netflix-brassiere-58.png","Netflix-cardigan-28.png","Netflix-cellular_telephone-73.png","Netflix-chain_saw-43.png","Netflix-chain_saw-82.png","Netflix-chime-11.png","Netflix-coffeepot-11.png","Netflix-comic_book-12.png","Netflix-comic_book-13.png","Netflix-comic_book-14.png","Netflix-comic_book-16.png","Netflix-comic_book-18.png","Netflix-comic_book-20.png","Netflix-comic_book-21.png","Netflix-comic_book-23.png","Netflix-comic_book-26.png","Netflix-comic_book-31.png","Netflix-comic_book-35.png","Netflix-comic_book-36.png","Netflix-comic_book-38.png","Netflix-comic_book-39.png","Netflix-comic_book-45.png","Netflix-comic_book-46.png","Netflix-comic_book-48.png","Netflix-comic_book-49.png","Netflix-comic_book-51.png","Netflix-comic_book-53.png","Netflix-comic_book-55.png","Netflix-comic_book-56.png","Netflix-comic_book-61.png","Netflix-comic_book-64.png","Netflix-comic_book-65.png","Netflix-comic_book-66.png","Netflix-comic_book-69.png","Netflix-comic_book-70.png","Netflix-comic_book-74.png","Netflix-comic_book-76.png","Netflix-comic_book-77.png","Netflix-comic_book-78.png","Netflix-comic_book-81.png","Netflix-comic_book-83.png","Netflix-comic_book-84.png","Netflix-comic_book-85.png","Netflix-comic_book-92.png","Netflix-comic_book-93.png","Netflix-comic_book-95.png","Netflix-comic_book-96.png","Netflix-comic_book-97.png","Netflix-corkscrew-10.png","Netflix-cornet-14.png","Netflix-crane-77.png","Netflix-crash_helmet-56.png","Netflix-Crock_Pot-42.png","Netflix-Crock_Pot-49.png","Netflix-digital_clock-37.png","Netflix-digital_clock-69.png","Netflix-drum-48.png","Netflix-dumbbell-18.png","Netflix-envelope-25.png","Netflix-feather_boa-59.png","Netflix-fountain-41.png","Netflix-fur_coat-21.png","Netflix-fur_coat-31.png","Netflix-gasmask-95.png","Netflix-gasmask-98.png","Netflix-golden_retriever-94.png","Netflix-hair_slide-32.png","Netflix-hair_spray-37.png","Netflix-hen-91.png","Netflix-hippopotamus-13.png","Netflix-hippopotamus-25.png","Netflix-hook-15.png","Netflix-hornbill-25.png","Netflix-hornbill-95.png","Netflix-ice_bear-90.png","Netflix-jaguar-90.png","Netflix-jersey-10.png","Netflix-jersey-11.png","Netflix-jersey-12.png","Netflix-jersey-13.png","Netflix-jersey-21.png","Netflix-jersey-28.png","Netflix-jersey-30.png","Netflix-jersey-31.png","Netflix-jersey-32.png","Netflix-jersey-48.png","Netflix-jersey-70.png","Netflix-jersey-73.png","Netflix-joystick-66.png","Netflix-kimono-16.png","Netflix-king_penguin-93.png","Netflix-lab_coat-29.png","Netflix-lab_coat-36.png","Netflix-loggerhead-81.png","Netflix-loudspeaker-83.png","Netflix-macaque-49.png","Netflix-magnetic_compass-54.png","Netflix-maillot-13.png","Netflix-maillot-14.png","Netflix-maillot-23.png","Netflix-maillot-37.png","Netflix-mask-11.png","Netflix-mask-12.png","Netflix-mask-13.png","Netflix-mask-14.png","Netflix-mask-21.png","Netflix-mask-24.png","Netflix-mask-25.png","Netflix-mask-26.png","Netflix-mask-27.png","Netflix-mask-31.png","Netflix-mask-41.png","Netflix-mask-44.png","Netflix-mask-48.png","Netflix-mask-55.png","Netflix-mask-56.png","Netflix-mask-65.png","Netflix-mask-77.png","Netflix-mask-85.png","Netflix-mask-99.png","Netflix-matchstick-45.png","Netflix-military_uniform-54.png","Netflix-mouse-24.png","Netflix-mushroom-51.png","Netflix-neck_brace-84.png","Netflix-nipple-36.png","Netflix-oboe-10.png","Netflix-orangutan-77.png","Netflix-pajama-16.png","Netflix-palace-23.png","Netflix-Pembroke-97.png","Netflix-pencil_box-40.png","Netflix-pencil_sharpener-34.png","Netflix-perfume-24.png","Netflix-pick-39.png","Netflix-pick-73.png","Netflix-pickelhaube-11.png","Netflix-ping-pong_ball-11.png","Netflix-ping-pong_ball-47.png","Netflix-ping-pong_ball-53.png","Netflix-pinwheel-16.png","Netflix-pinwheel-28.png","Netflix-pole-25.png","Netflix-poncho-36.png","Netflix-pool_table-19.png","Netflix-pool_table-48.png","Netflix-pool_table-58.png","Netflix-pool_table-62.png","Netflix-pool_table-68.png","Netflix-pool_table-80.png","Netflix-pool_table-92.png","Netflix-punching_bag-61.png","Netflix-racket-12.png","Netflix-rapeseed-26.png","Netflix-red_fox-80.png","Netflix-red_wine-49.png","Netflix-ski_mask-11.png","Netflix-ski_mask-41.png","Netflix-soap_dispenser-14.png","Netflix-soap_dispenser-20.png","Netflix-soap_dispenser-27.png","Netflix-soap_dispenser-62.png","Netflix-sombrero-74.png","Netflix-spotlight-39.png","Netflix-stage-43.png","Netflix-stethoscope-11.png","Netflix-stethoscope-12.png","Netflix-street_sign-69.png","Netflix-suit-18.png","Netflix-suit-22.png","Netflix-suit-25.png","Netflix-suit-31.png","Netflix-suit-36.png","Netflix-suit-40.png","Netflix-suit-44.png","Netflix-suit-74.png","Netflix-suit-76.png","Netflix-suit-79.png","Netflix-sulphur_butterfly-33.png","Netflix-sunglass-51.png","Netflix-sweatshirt-11.png","Netflix-sweatshirt-20.png","Netflix-sweatshirt-23.png","Netflix-sweatshirt-35.png","Netflix-sweatshirt-54.png","Netflix-table_lamp-17.png","Netflix-table_lamp-39.png","Netflix-teddy-10.png","Netflix-teddy-11.png","Netflix-teddy-15.png","Netflix-teddy-21.png","Netflix-teddy-27.png","Netflix-teddy-98.png","Netflix-tennis_ball-13.png","Netflix-tiger-72.png","Netflix-tiger_shark-70.png","Netflix-torch-23.png","Netflix-totem_pole-65.png","Netflix-toyshop-11.png","Netflix-tree_frog-97.png","Netflix-trench_coat-83.png","Netflix-triceratops-63.png","Netflix-tub-32.png","Netflix-umbrella-44.png","Netflix-umbrella-83.png","Netflix-violin-17.png","Netflix-violin-67.png","Netflix-water_bottle-18.png","Netflix-water_bottle-68.png","Netflix-Weimaraner-41.png","Netflix-whistle-14.png","Netflix-wig-11.png","Netflix-wig-14.png","Netflix-wig-15.png","Netflix-wig-21.png","Netflix-wig-29.png","Netflix-wig-30.png","Netflix-wig-35.png","Netflix-wig-39.png","Netflix-wig-43.png","Netflix-wig-45.png","Netflix-wig-46.png","Netflix-wig-47.png","Netflix-wig-48.png","Netflix-wig-71.png","Netflix-wig-92.png","Netflix-Windsor_tie-11.png"],jL=JSON.parse('["100001-the-rising-of-the-shield-hero-naofumi.png","100002-the-rising-of-the-shield-hero-raphtalia.png","100003-the-rising-of-the-shield-hero-filo.png","100004-the-rising-of-the-shield-hero-melty.png","100005-the-rising-of-the-shield-hero-rishia.png","100006-spy-x-family-loid.png","100007-spy-x-family-yor.png","100008-spy-x-family-anya-1.png","100009-spy-x-family-anya-2.png","100010-spy-x-family-anya-3.png","1001-the-worlds-finest-assassin-lugh.png","1002-the-worlds-finest-assassin-dia.png","1003-the-worlds-finest-assassin-tart.png","1004-the-worlds-finest-assassin-maha.png","1005-the-worlds-finest-assassin-assassin.png","1011-fena-pirate-princess-fena.png","1012-fena-pirate-princess-yukimaru.png","1013-fena-pirate-princess-shitan.png","1014-fena-pirate-princess-karin.png","1015-fena-pirate-princess-twins.png","1016-fena-pirate-princess-makaba.png","1017-fena-pirate-princess-tsubaki.png","1018-fena-pirate-princess-brule.png","1019-fena-pirate-princess-fena-young.png","1020-fena-pirate-princess-yukimaru-young.png","1021-to-your-eternity-fushi.png","1022-to-your-eternity-joann.png","1023-to-your-eternity-march.png","1024-to-your-eternity-parona.png","1025-to-your-eternity-thebeholder.png","1026-to-your-eternity-gugu.png","1027-to-your-eternity-tonari.png","1028-to-your-eternity-theboy.png","1029-to-your-eternity-fushi.png","1030-to-your-eternity-march.png","1036-tokyo-revengers-takemichi.jpg","1037-tokyo-revengers-mikey.jpg","1038-tokyo-revengers-draken.jpg","1039-tokyo-revengers-mitsuya.jpg","1040-tokyo-revengers-baji.jpg","1041-jujutsu-kaisen-yuji-itadori.png","1042-jujutsu-kaisen-megumi-fushigoro.png","1043-jujutsu-kaisen-nobara-kugisaki.png","1044-jujutsu-kaisen-satoru-gojo.png","1045-jujutsu-kaisen-ryomen-sukuna.png","1046-dr-stone-senku.png","1047-dr-stone-suika.png","1048-dr-stone-kohaku.png","1049-dr-stone-chrome.png","1050-dr-stone-gen.png","1051-so-im-a-spider-so-what-kumoko.png","1052-so-im-a-spider-so-what-shun.png","1053-so-im-a-spider-so-what-katia.png","1054-so-im-a-spider-so-what-sue.png","1055-so-im-a-spider-so-what-fei.png","1056-black-clover-asta.png","1057-black-clover-yuno.png","1058-black-clover-noelle.png","1059-black-clover-yami.png","1060-black-clover-nero.png","11-tower-of-god-bam.png","12-tower-of-god-khun.png","13-tower-of-god-rak.jpg","14-tower-of-god-yuri-jahad.jpg","15-tower-of-god-endorsi-jahad.png","16-the-god-of-high-school-jin-mori.png","17-the-god-of-high-school-han-daewi.png","18-the-god-of-high-school-yoo-mira.png","19-the-god-of-high-school-park-mujin.png","20-the-god-of-high-school-park-ilpyo.png","21-bananya-bananya.png","22-bananya-droopy-eared.png","23-bananya-pirate.png","24-bananya-night-rainbow.png","25-bananya-emo.png","26-inspectre-kotoko-iwanaga.jpg","27-inspectre-kuro-sakuragawa.jpg","28-inspectre-saki-yumihara.jpg","29-inspectre-steel-lady-nanase.jpg","2bluenagi_nagi_avatar.png","30-inspectre-komainu.jpg","31-somali-and-the-forest-spirit-golem.jpg","32-somali-and-the-forest-spirit-somali.jpg","33-somali-and-the-forest-spirit-shizuno.jpg","34-somali-and-the-forest-spirit-uzoi.jpg","35-somali-and-the-forest-spirit-kikila.jpg","36-that-time-i-got-reincarnated-as-a-slime-rimuru-human.png","37-that-time-i-got-reincarnated-as-a-slime-shuna.png","38-that-time-i-got-reincarnated-as-a-slime-shion.png","39-that-time-i-got-reincarnated-as-a-slime-rimuru-slime.png","40-that-time-i-got-reincarnated-as-a-slime-hinata.jpg","41-zombieland-saga-revenge-sakura-minamoto.jpg","42-zombieland-saga-revenge-saki-nikaido.jpg","43-zombieland-saga-revenge-ai-mizuno.jpg","44-zombieland-saga-revenge-junko-konno.jpg","45-zombieland-saga-revenge-yugiri.jpg","46-zombieland-saga-revenge-lily-hoshikawa.jpg","47-zombieland-saga-revenge-tae-yamada.jpg","afdal.png","aot_fc_annie-avatar.png","aot_fc_armin-avatar.png","aot_fc_conny-avatar.png","aot_fc_eren-avatar.png","aot_fc_hange-avatar.png","aot_fc_jean-avatar.png","aot_fc_levi-avatar.png","aot_fc_mikasa-avatar.png","aot_fc_reiner-avatar.png","aot_fc_sasha-avatar.png","apothecary_gaoshun.png","apothecary_gyokuyou.png","apothecary_jinshi-1.png","apothecary_jinshi-2.png","apothecary_lihaku.png","apothecary_maomao-1.png","apothecary_maomao-2.png","apothecary_xiaolan.png","ash.png","avatars-big_mom.png","avatars-brook.png","avatars-chopper.png","avatars-franky.png","avatars-jinbei.png","avatars-kaido.png","avatars-kid.png","avatars-law.png","avatars-luffy.png","avatars-nami.png","avatars-perona.png","avatars-robin.png","avatars-sanji.png","avatars-shanks.png","avatars-usopp.png","avatars-yamato.png","avatars-zoro.png","bachira_avatar.png","bb-ciel-avatar.png","bb-edgar-avatar.png","bb-herman-avatar.png","bb-lawrence-avatar.png","bb_gregory-avatar.png","bb_sebastian-avatar.png","bluelock_bachira_avatar.png","bluelock_bachira_teaser_avatar.png","bluelock_barou_avatar.png","bluelock_chigiri_avatar.png","bluelock_ego_avatar.png","bluelock_hiori_teaser_avatar.png","bluelock_isagi_avatar.png","bluelock_isagi_kv1_avatar.png","bluelock_isagi_teaser_avatar.png","bluelock_karasu_teaser_avatar.png","bluelock_kunigami_avatar.png","bluelock_nagi_avatar.png","bluelock_nagi_teaser_avatar.png","bluelock_nanase_teaser_avatar.png","bluelock_oliver_kv1_avatar.png","bluelock_otoya_teaser_avatar.png","bluelock_reo_avatar.png","bluelock_rin_avatar.png","bluelock_rin_kv1_avatar.png","bluelock_rin_teaser_avatar.png","bluelock_sae_kv1_avatar.png","bluelock_sae_teaser_avatar.png","bluelock_shidou_teaser_avatar.png","bluelock_yukimiya_teaser_avatar.png","bluelock_zantetsu_avatar.png","bluenagi_chigiri_avatar.png","bluenagi_isagi_avatar.png","bluenagi_kunigami_avatar.png","bluenagi_nagi_school_avatar.png","bluenagi_reo_avatar.png","bluenagi_reo_school_avatar.png","bluenagi_rin_avatar.png","bocchi-avatar.jpg","bocchi-iita-kv-avatar.jpg","bocchi-kita-avatar.jpg","bocchi-kv-avatar.jpg","bocchi-nijika-kv-avatar.jpg","bocchi-ryo-avatar.jpg","bocchi-ryo-kv-avatar.jpg","bochhi-nijika-avatar.jpg","chainsawman-aki.jpg","chainsawman-chainsawman.jpg","chainsawman-denji.jpg","chainsawman-himeno.jpg","chainsawman-kishibe.jpg","chainsawman-kobeni.jpg","chainsawman-makima.jpg","chainsawman-pochita.jpg","chainsawman-power.jpg","chris-1.png","chris-2.png","classic-hime-avatar-1.png","classic-hime-avatar-2.png","classic-hime-avatar-3.png","classic-sudachi-avatar-1.png","classic-sudachi-avatar-2.png","classic-sudachi-avatar-3.png","classic-yuzu-avatar-1.png","classic-yuzu-avatar-2.png","classic-yuzu-avatar-3.png","crbrand_avatars_logo_marks_black_orange.jpg","crbrand_avatars_logo_marks_black_taupe.jpg","crbrand_avatars_logo_marks_black_white.jpg","crbrand_avatars_logo_marks_mangaeye_taupe.jpg","crbrand_avatars_logo_marks_mangagirl_taupe.jpg","crbrand_avatars_logo_marks_manga_eye_orange.jpg","crbrand_avatars_logo_marks_manga_skull_orange.jpg","crbrand_avatars_logo_marks_manga_skull_taupe.jpg","crbrand_avatars_logo_marks_mech_orange.jpg","crbrand_avatars_logo_marks_mech_orange2.jpg","crbrand_avatars_logo_marks_mech_taupe.jpg","crbrand_avatars_logo_marks_mech_taupe2.jpg","crbrand_avatars_logo_marks_orange_black.jpg","crbrand_avatars_logo_marks_orange_expressive.jpg","crbrand_avatars_logo_marks_orange_stars.jpg","crbrand_avatars_logo_marks_orange_taupe.jpg","crbrand_avatars_logo_marks_orange_taupe_stars.jpg","crbrand_avatars_logo_marks_orange_white.jpg","crbrand_avatars_logo_marks_taupe_expressive.jpg","crbrand_avatars_logo_marks_the_rings.jpg","dbdiama_avatarbackground2025_avatar_10.jpg","dbdiama_avatarbackground2025_avatar_3.jpg","dbdiama_avatarbackground2025_avatar_4.jpg","dbdiama_avatarbackground2025_avatar_5.jpg","dbdiama_avatarbackground2025_avatar_6.jpg","dbdiama_avatarbackground2025_avatar_7.jpg","dbdiama_avatarbackground2025_avatar_8.jpg","dbdiama_avatarbackground2025_avatar_9.jpg","dotm_avatar_02.png","dr_stone_s4_avatar_2.jpg","dr_stone_s4_avatar_3.jpg","dr_stone_s4_avatar_4.jpg","eden.png","egghead-brook.png","egghead-chopper.png","egghead-franky.png","egghead-jimbei.png","egghead-luffy.png","egghead-nami.png","egghead-robin.png","egghead-sanji.png","egghead-usopp.png","egghead-zoro.png","finn-1.png","finn-2.png","freiren-avatar-1.png","freiren-avatar-2.png","freiren-avatar-3.png","frieren_eisen-avatar-1.png","frieren_eisen-avatar-2.png","frieren_fern-avatar-1.png","frieren_fern-avatar-2.png","frieren_heiter-avatar-1.png","frieren_heiter-avatar-2.png","frieren_himmel-avatar-1.png","frieren_himmel-avatar-2.png","frieren_stark-avatar-1.png","frieren_stark-avatar-2.png","gear5avatar1.png","gear5avatar2.png","gear5avatar3.png","gear5avatar4.png","gear5avatar5.png","gear5avatar6.png","gear5avatar7.png","gear5avatar8.png","gear5avatar9.png","gene-1.png","gene-2.png","giallon-1.png","giallon-2.png","im_in_love_clarie-kv1.png","im_in_love_clarie-kv2.png","im_in_love_clarie.png","im_in_love_lene.png","im_in_love_manaria.png","im_in_love_misha.png","im_in_love_rae-kv1.png","im_in_love_rae-kv2.png","im_in_love_rae.png","inbento_avatar_1.png","inbento_avatar_3.png","inbento_avatar_4.png","inbento_avatar_5.png","jill.png","leo-1.png","leo-2.png","momoka-1.png","momoka-2.png","momoka-3.png","momoka-4.png","momoka-5.png","mushokutensei_ariel.jpg","mushokutensei_cliff.jpg","mushokutensei_elinalise.jpg","mushokutensei_eris.jpg","mushokutensei_ghislaine.jpg","mushokutensei_juli.jpg","mushokutensei_linia.jpg","mushokutensei_luke.jpg","mushokutensei_pursena.jpg","mushokutensei_rudeus-school-uniform.jpg","mushokutensei_rudeus.jpg","mushokutensei_ruijerd.jpg","mushokutensei_sara.jpg","mushokutensei_soldat.jpg","mushokutensei_suzanne.jpg","mushokutensei_sylphie-fitz.jpg","mushokutensei_sylphie.jpg","mushokutensei_zanoba.jpg","my-dress-up-gojo-1-avatar.jpg","my-dress-up-gojo-2-avatar.jpg","my-dress-up-marin-1-avatar.jpg","my-dress-up-marin-2-avatar.jpg","my-dress-up-marin-cosplay-avatar.jpg","my-dress-up-marin-normal-avatar.jpg","my-dress-up-sajuna-1-avatar.jpg","my-dress-up-sajuna-2-avatar.jpg","my-dress-up-shinju-1-avatar.jpg","my-dress-up-shinju-2-avatar.jpg","naomi-1.png","naomi-2.png","nina-1.png","nina-2.png","nina-3.png","nina-4.png","nina-5.png","noid.png","one-piece-chopper-1.png","one-piece-chopper-2.png","one-piece-chopper-3.png","one-piece-franky-1.png","one-piece-franky-2.png","one-piece-franky-3.png","one-piece-jimbei-1.png","one-piece-jimbei-2.png","one-piece-jimbei-3.png","one-piece-jimbei-4.png","one-piece-luffy-1.png","one-piece-luffy-2.png","one-piece-luffy-3.png","one-piece-luffy-4.png","one-piece-luffy-5.png","one-piece-nico-robin-1.png","one-piece-nico-robin-2.png","one-piece-nico-robin-3.png","one-piece-roronoa-zoro-1.png","one-piece-roronoa-zoro-2.png","one-piece-sanji-1.png","one-piece-sanji-2.png","one-piece-sanji-3.png","one-piece-usopp-1.png","one-piece-usopp-2.png","rcg1_avatar_02.png","rcg1_avatar_04.png","rcg2_avatar_01.png","rcg2_avatar_03.png","rcg2_avatar_04.png","rent-a-gf-chizuru-s1-date-kv.jpg","rent-a-gf-chizuru-s2-date-kv.jpg","rent-a-gf-chizuru-s3-date-kv.jpg","rent-a-gf-mami-s1-date-kv.jpg","rent-a-gf-mami-s2-date-kv_1.jpg","rent-a-gf-mami-s2-date-kv_2.jpg","rent-a-gf-mami-s3-date-kv_1.jpg","rent-a-gf-mami-s3-date-kv_2.jpg","rent-a-gf-ruka-s1-date-kv.jpg","rent-a-gf-ruka-s2-date-kv.jpg","rent-a-gf-ruka-s3-date-kv.jpg","rent-a-gf-sumi-s1-date-kv.jpg","rent-a-gf-yaemori-s3-date-kv.jpg","rent-a-gf-yaemori-s3-main-kv.jpg","rent-a-gf-yaemori-s3-teaser-kv.jpg","rezero_s3_avatar_01.jpg","rezero_s3_avatar_02.jpg","rezero_s3_avatar_04.jpg","rezero_s3_avatar_05.jpg","rezero_s3_avatar_06.jpg","rezero_s3_avatar_07.jpg","rezero_s3_avatar_08.jpg","rezero_s3_avatar_09.jpg","rezero_s3_avatar_10.jpg","rezero_s3_avatar_11.jpg","rezero_s3_avatar_12.jpg","rezero_s3_avatar_13.jpg","rezero_s3_avatar_14.jpg","rezero_s3_avatar_15.jpg","rezero_s3_avatar_16.jpg","rezero_s3_avatar_17.jpg","rezero_s3_avatar_18.jpg","rezero_s3_avatar_19.jpg","rezero_s3_avatar_20.jpg","rezero_s3_avatar_21.jpg","rezero_s3_avatar_22.jpg","rezero_s3_avatar_23.jpg","rouge-1.png","rouge-2.png","rouge-3.png","rouge-4.png","rupa-1.png","rupa-2.png","rupa-3.png","rupa-4.png","rupa-5.png","rwby_avatar_01.png","rwby_avatar_03.png","rwby_avatar_04.png","sarah.png","shangrilafrontier_s2_avatar_1.jpg","shangrilafrontier_s2_avatar_10.jpg","shangrilafrontier_s2_avatar_11.jpg","shangrilafrontier_s2_avatar_12.jpg","shangrilafrontier_s2_avatar_13.jpg","shangrilafrontier_s2_avatar_14.jpg","shangrilafrontier_s2_avatar_15.jpg","shangrilafrontier_s2_avatar_2.jpg","shangrilafrontier_s2_avatar_3.jpg","shangrilafrontier_s2_avatar_4.jpg","shangrilafrontier_s2_avatar_5.jpg","shangrilafrontier_s2_avatar_6.jpg","shangrilafrontier_s2_avatar_7.jpg","shangrilafrontier_s2_avatar_8.jpg","shangrilafrontier_s2_avatar_9.jpg","sololeveling_s2_avatar_1_v2_choi_avatar.png","sololeveling_s2_avatar_2_v2_jinwoo_avatar.png","sololeveling_s2_avatar_3_v2_igris_avatar.png","sololeveling_s2_avatar_4_v2_baek_avatar.png","sololeveling_s2_avatar_5_v2_cha_avatar.png","solo_baekyoonho.png","solo_chahaein.png","solo_choijongin.png","solo_gogunhee.png","solo_sungjinwoo.png","solo_teaser_visual.png","solo_woojinchul.png","solo_yoojinho.png","spidersaurs_avatar_02.png","sss_avatar_01.png","subaru-1.png","subaru-2.png","subaru-3.png","subaru-4.png","subaru-5.png","tog_bam_avatar_1.png","tog_bam_avatar_2.png","tog_bam_avatar_3.png","tog_endorsi_avatar_1.png","tog_endorsi_avatar_2.png","tog_hayuri_avatar_1.png","tog_hwaryun_avatar_1.png","tog_ja_avatar_1.png","tog_ja_avatar_2.png","tog_jihwa_avatar_1.png","tog_jihwa_avatar_2.png","tog_khunaa_avatar_1.png","tog_khunaa_avatar_2.png","tog_khunran_avatar_1.png","tog_rak_avatar_1.png","tog_rak_avatar_2.png","tomo-1.png","tomo-2.png","tomo-3.png","tomo-4.png","tomo-5.png","vijay-1.png","vijay-2.png","wendy-1.png","wendy-2.png"]'),FL=["scale(1).png","scale(10).png","scale(100).png","scale(101).png","scale(102).png","scale(103).png","scale(104).png","scale(105).png","scale(106).png","scale(107).png","scale(108).png","scale(11).png","scale(110).png","scale(111).png","scale(112).png","scale(113).png","scale(114).png","scale(115).png","scale(116).png","scale(117).png","scale(118).png","scale(119).png","scale(12).png","scale(120).png","scale(121).png","scale(122).png","scale(123).png","scale(124).png","scale(125).png","scale(126).png","scale(127).png","scale(128).png","scale(129).png","scale(13).png","scale(130).png","scale(131).png","scale(132).png","scale(133).png","scale(134).png","scale(135).png","scale(136).png","scale(137).png","scale(138).png","scale(139).png","scale(14).png","scale(140).png","scale(141).png","scale(142).png","scale(143).png","scale(144).png","scale(145).png","scale(146).png","scale(147).png","scale(148).png","scale(149).png","scale(15).png","scale(150).png","scale(151).png","scale(152).png","scale(153).png","scale(154).png","scale(155).png","scale(156).png","scale(157).png","scale(158).png","scale(159).png","scale(16).png","scale(160).png","scale(161).png","scale(162).png","scale(163).png","scale(164).png","scale(165).png","scale(166).png","scale(167).png","scale(168).png","scale(169).png","scale(17).png","scale(170).png","scale(171).png","scale(172).png","scale(173).png","scale(174).png","scale(175).png","scale(176).png","scale(177).png","scale(178).png","scale(179).png","scale(18).png","scale(180).png","scale(181).png","scale(182).png","scale(183).png","scale(184).png","scale(185).png","scale(186).png","scale(187).png","scale(189).png","scale(19).png","scale(190).png","scale(191).png","scale(192).png","scale(193).png","scale(194).png","scale(195).png","scale(196).png","scale(197).png","scale(198).png","scale(199).png","scale(2).png","scale(20).png","scale(200).png","scale(201).png","scale(202).png","scale(203).png","scale(204).png","scale(205).png","scale(206).png","scale(207).png","scale(208).png","scale(209).png","scale(21).png","scale(210).png","scale(211).png","scale(212).png","scale(22).png","scale(23).png","scale(24).png","scale(25).png","scale(26).png","scale(27).png","scale(28).png","scale(29).png","scale(3).png","scale(30).png","scale(31).png","scale(32).png","scale(33).png","scale(34).png","scale(35).png","scale(36).png","scale(37).png","scale(38).png","scale(39).png","scale(4).png","scale(40).png","scale(41).png","scale(42).png","scale(43).png","scale(44).png","scale(45).png","scale(46).png","scale(47).png","scale(48).png","scale(49).png","scale(5).png","scale(50).png","scale(51).png","scale(52).png","scale(53).png","scale(54).png","scale(55).png","scale(56).png","scale(57).png","scale(58).png","scale(59).png","scale(6).png","scale(60).png","scale(61).png","scale(62).png","scale(63).png","scale(64).png","scale(65).png","scale(66).png","scale(67).png","scale(68).png","scale(69).png","scale(7).png","scale(70).png","scale(71).png","scale(72).png","scale(73).png","scale(74).png","scale(75).png","scale(76).png","scale(77).png","scale(78).png","scale(79).png","scale(8).png","scale(80).png","scale(81).png","scale(82).png","scale(83).png","scale(84).png","scale(85).png","scale(86).png","scale(87).png","scale(88).png","scale(89).png","scale(9).png","scale(90).png","scale(91).png","scale(92).png","scale(93).png","scale(94).png","scale(95).png","scale(96).png","scale(97).png","scale(98).png","scale(99).png"],hc={Netflix:ML,Crunchyroll:jL,DisneyPlus:FL},du=({isOpen:i,onClose:e,onSave:t,userId:s})=>{const[n,r]=C.useState(Object.keys(hc)[0]),[l,c]=C.useState(null),[h,d]=C.useState(!1);if(C.useEffect(()=>{i&&(r(Object.keys(hc)[0]),c(null))},[i]),!i)return null;const f=Object.keys(hc),p=hc[n]||[],v=async()=>{if(l){d(!0);try{const S=await(await fetch(l)).blob(),E=`avatar.${l.split(".").pop().split("?")[0]||"png"}`,A=new File([S],E,{type:S.type});await t(A)}catch(x){console.error("Failed to fetch avatar blob",x)}finally{d(!1)}}};return g.jsx("div",{className:"apm-overlay",onClick:e,children:g.jsxs("div",{className:"apm-modal",onClick:x=>x.stopPropagation(),children:[g.jsxs("div",{className:"apm-header",children:[g.jsx("h2",{children:"Choose Avatar"}),g.jsx("button",{className:"apm-close",onClick:e,children:""})]}),g.jsxs("div",{className:"apm-body",children:[g.jsx("div",{className:"apm-sidebar",children:f.map(x=>g.jsx("button",{className:`apm-cat-btn ${n===x?"active":""}`,onClick:()=>r(x),children:x},x))}),g.jsx("div",{className:"apm-content",children:g.jsx("div",{className:"apm-grid",children:p.map(x=>{const T=`/legitflix/client/avatars/${n}/${x}`;return g.jsx("div",{className:`apm-item ${l===T?"selected":""}`,onClick:()=>c(T),children:g.jsx("div",{className:"apm-img-wrapper",children:g.jsx("img",{src:T,alt:x,loading:"lazy"})})},x)})})})]}),g.jsxs("div",{className:"apm-footer",children:[g.jsx("button",{className:"apm-btn-cancel",onClick:e,disabled:h,children:"Cancel"}),g.jsx("button",{className:"apm-btn-save",onClick:v,disabled:!l||h,children:h?"Saving...":"Set Avatar"})]})]})})},Xv=[{name:"Orange",value:"#ff7e00"},{name:"Blue",value:"#00aaff"},{name:"Pink",value:"#ff00aa"},{name:"Green",value:"#00ff7e"},{name:"Red",value:"#ff3333"},{name:"Purple",value:"#aa00ff"}],fS=({isOpen:i,onClose:e,userId:t})=>{const{config:s,updateConfig:n}=Yi(),[r,l]=C.useState("appearance"),[c,h]=C.useState(""),[d,f]=C.useState(!1),[p,v]=C.useState(!1),[x,S]=C.useState("app"),[T,E]=C.useState(!1),[A,_]=C.useState(s.accentColor||"#ff7e00"),[R,w]=C.useState(s.logoUrl||""),[N,U]=C.useState(s.showNavbarCategories!==!1),[D,F]=C.useState(s.enableJellyseerr!==!1),[j,M]=C.useState(s.jellyseerrUrl||"https://request.legitflix.eu"),[H,K]=C.useState(s.showLibraryTitles!==!1),[se,ne]=C.useState(s.showNavbarRequests!==!1),[de,k]=C.useState(""),[G,Y]=C.useState(s.contentTypeFilters||{Movie:!0,Series:!0,MusicAlbum:!1,Audio:!1,MusicVideo:!1}),[le,me]=C.useState(s.contentSortMode||"latest");C.useEffect(()=>{i&&(_(s.accentColor||"#ff7e00"),w(s.logoUrl||""),U(s.showNavbarCategories!==!1),F(s.enableJellyseerr!==!1),M(s.jellyseerrUrl||"https://request.legitflix.eu"),K(s.showLibraryTitles!==!1),ne(s.showNavbarRequests!==!1),Y(s.contentTypeFilters||{Movie:!0,Series:!0,MusicAlbum:!1,Audio:!1,MusicVideo:!1}),me(s.contentSortMode||"latest"),h(""),Xv.some(pe=>pe.value===s.accentColor)||k(s.accentColor))},[i,s]);const P=pe=>{_(pe),k("")},$=pe=>{const we=pe.target.value;k(we),/^#[0-9A-F]{6}$/i.test(we)&&_(we)},ie=()=>{const pe=Object.entries(G).filter(([,ct])=>ct).map(([ct])=>ct),we=pe.length>0?pe.join(","):"Movie,Series",ot=pe.length>0?pe:["Movie","Series"];n({accentColor:A,logoUrl:R,logoType:R?"image":"text",showNavbarCategories:N,enableJellyseerr:D,jellyseerrUrl:j,showLibraryTitles:H,showNavbarRequests:se,contentTypeFilters:G,heroMediaTypes:we,promoMediaTypes:ot,contentSortMode:le}),e()},fe=()=>{_("#ff7e00"),w(""),k(""),U(!0),F(!0),M("https://request.legitflix.eu"),K(!0),ne(!0),Y({Movie:!0,Series:!0,MusicAlbum:!1,Audio:!1,MusicVideo:!1}),me("latest")},ge=async pe=>{if(!(!pe||!t)){E(!0);try{(await fetch(`${ee.api.basePath}/Users/${t}/Images/Primary`,{method:"POST",headers:{"Content-Type":pe.type,"X-Emby-Authorization":ee.api.authHeader},body:pe})).ok&&v(!1)}catch(we){console.error("Avatar upload failed",we)}finally{E(!1)}}},Ne=[{id:"accentColor",tab:"appearance",label:"Accent Color",keywords:["color","theme","style","appearance"],render:()=>g.jsxs("div",{className:"setting-section",children:[g.jsx("h3",{children:"Accent Color"}),g.jsx("div",{className:"color-presets",children:Xv.map(pe=>g.jsx("div",{className:`color-preset ${A===pe.value?"selected":""}`,style:{backgroundColor:pe.value},onClick:()=>P(pe.value),title:pe.name,children:A===pe.value&&g.jsx("span",{className:"material-icons",children:"check"})},pe.value))}),g.jsxs("div",{className:"custom-color-input",children:[g.jsx("label",{children:"Custom Hex:"}),g.jsx("input",{type:"text",placeholder:"#RRGGBB",value:de,onChange:$,maxLength:7}),g.jsx("div",{className:"color-preview",style:{backgroundColor:A}})]})]},"accentColor")},{id:"logoUrl",tab:"appearance",label:"Custom Logo URL",keywords:["logo","image","branding","appearance"],render:()=>g.jsxs("div",{className:"setting-section",children:[g.jsx("h3",{children:"Custom Logo URL"}),g.jsx("p",{className:"setting-desc",children:"Enter a direct URL to an image to replace the top-left logo."}),g.jsx("input",{type:"text",className:"legit-input",placeholder:"https://example.com/logo.png",value:R,onChange:pe=>w(pe.target.value)})]},"logoUrl")},{id:"faviconUrl",tab:"appearance",label:"Custom Favicon URL",keywords:["favicon","icon","tab","browser","branding"],render:()=>g.jsxs("div",{className:"setting-section",children:[g.jsx("h3",{children:"Custom Favicon URL"}),g.jsx("p",{className:"setting-desc",children:"Enter a direct URL to an image to use as the browser tab icon."}),g.jsx("input",{type:"text",className:"legit-input",placeholder:"https://example.com/favicon.ico",value:s.faviconUrl||"",onChange:pe=>n({faviconUrl:pe.target.value})})]},"faviconUrl")},{id:"avatar",tab:"appearance",label:"Profile Avatar",keywords:["avatar","profile","image","picture","user"],render:()=>g.jsxs("div",{className:"setting-section",children:[g.jsx("h3",{children:"Profile Avatar"}),g.jsx("p",{className:"setting-desc",children:"Change your user profile picture."}),g.jsx("div",{className:"setting-row",children:g.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[g.jsx("img",{src:`${ee.api.basePath}/Users/${t}/Images/Primary?quality=90&t=${Date.now()}`,alt:"Current Avatar",style:{width:"50px",height:"50px",borderRadius:"50%",objectFit:"cover",border:"2px solid rgba(255,255,255,0.1)"},onError:pe=>{pe.target.style.display="none"}}),g.jsxs("button",{className:"lf-btn lf-btn--secondary",onClick:()=>v(!0),children:[g.jsx("span",{className:"material-icons",style:{fontSize:"18px",marginRight:"8px"},children:"face"}),"Change Avatar"]})]})})]},"avatar")},{id:"requestFeature",tab:"home",label:"Request Feature (Jellyseerr)",keywords:["request","jellyseerr","ombi","home","card"],render:()=>g.jsxs(g.Fragment,{children:[g.jsxs("div",{className:"setting-section",children:[g.jsxs("div",{className:"setting-row",children:[g.jsxs("div",{children:[g.jsx("h3",{className:"setting-title",children:"Request Feature"}),g.jsx("p",{className:"setting-desc",children:'Enable "Request" card on Home screen'})]}),g.jsxs("label",{className:"toggle-switch",children:[g.jsx("input",{type:"checkbox",checked:D,onChange:pe=>F(pe.target.checked)}),g.jsx("span",{className:"slider"})]})]}),g.jsxs("div",{className:"fade-in",style:{marginTop:"10px"},children:[g.jsx("p",{className:"setting-desc",children:"Request URL (Required for both Home Card and Navbar):"}),g.jsx("input",{type:"text",className:"legit-input",placeholder:"https://request.legitflix.eu",value:j,onChange:pe=>M(pe.target.value)})]})]},"requestFeature"),g.jsxs("div",{className:"setting-section",children:[g.jsx("h3",{children:"Card Appearance"}),g.jsx("p",{className:"setting-desc",children:"Customize the look of the Request card on the Home screen."}),g.jsx("div",{className:"setting-row",style:{marginBottom:"15px"},children:g.jsxs("div",{style:{flex:1},children:[g.jsx("label",{className:"setting-label",style:{display:"block",marginBottom:"5px",fontSize:"0.9rem"},children:"Card Title"}),g.jsx("input",{type:"text",className:"legit-input",placeholder:"Request Feature",value:s.jellyseerrText||"",onChange:pe=>n({jellyseerrText:pe.target.value})})]})}),g.jsx("div",{className:"setting-row",style:{flexDirection:"column",alignItems:"stretch",gap:"10px"},children:g.jsxs("div",{children:[g.jsx("label",{className:"setting-label",style:{display:"block",marginBottom:"5px",fontSize:"0.9rem"},children:"Card Background URL"}),g.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[g.jsx("div",{style:{width:"120px",height:"68px",borderRadius:"6px",backgroundColor:"#2a2a2a",backgroundImage:`url('${s.jellyseerrBackground||"https://raw.githubusercontent.com/gorillasuti/Legitflix-plugin/refs/heads/main/legitflix-client/public/jellyseerr.jpg"}')`,backgroundSize:"cover",backgroundPosition:"center",border:"1px solid rgba(255,255,255,0.1)",flexShrink:0}}),g.jsx("input",{type:"text",className:"legit-input",style:{marginTop:0},placeholder:"https://example.com/background.jpg",value:s.jellyseerrBackground||"",onChange:pe=>n({jellyseerrBackground:pe.target.value||null})})]})]})})]},"requestFeatureCustomization")]})},{id:"libraryTitles",tab:"home",label:"Show Library Titles",keywords:["library","names","titles","overlay","home"],render:()=>g.jsx("div",{className:"setting-section",children:g.jsxs("div",{className:"setting-row",children:[g.jsxs("div",{children:[g.jsx("h3",{className:"setting-title",children:"Show Library Titles"}),g.jsx("p",{className:"setting-desc",children:"Display text overlay on library cards"})]}),g.jsxs("label",{className:"toggle-switch",children:[g.jsx("input",{type:"checkbox",checked:H,onChange:pe=>K(pe.target.checked)}),g.jsx("span",{className:"slider"})]})]})},"libraryTitles")},{id:"contentFilters",tab:"home",label:"Content Filters",keywords:["content","media","type","movie","series","music","filter","carousel","promo","hero"],render:()=>{const pe=[{key:"Movie",label:"Movies",icon:"movie"},{key:"Series",label:"Series",icon:"tv"},{key:"MusicAlbum",label:"Music Albums",icon:"album"},{key:"Audio",label:"Audio",icon:"audiotrack"},{key:"MusicVideo",label:"Music Videos",icon:"music_video"}];return g.jsxs("div",{className:"setting-section",children:[g.jsx("h3",{children:"Content Filters"}),g.jsx("p",{className:"setting-desc",children:"Choose which media types appear in the Hero Carousel and Promo Banner."}),g.jsx("div",{className:"content-type-grid",children:pe.map(we=>g.jsxs("label",{className:`content-type-chip ${G[we.key]?"active":""}`,children:[g.jsx("input",{type:"checkbox",checked:!!G[we.key],onChange:ot=>Y(ct=>({...ct,[we.key]:ot.target.checked}))}),g.jsx("span",{className:"material-icons",children:we.icon}),g.jsx("span",{children:we.label})]},we.key))})]},"contentFilters")}},{id:"displayOrder",tab:"home",label:"Display Order",keywords:["sort","order","random","latest","rated","carousel","promo","display"],render:()=>{const pe=[{key:"latest",label:"Latest",icon:"schedule",desc:"Newest additions first"},{key:"random",label:"Random",icon:"shuffle",desc:"Shuffled each visit"},{key:"topRated",label:"Top Rated",icon:"star",desc:"Highest community rating"}];return g.jsxs("div",{className:"setting-section",children:[g.jsx("h3",{children:"Display Order"}),g.jsx("p",{className:"setting-desc",children:"How content is sorted in the Hero Carousel and Promo Banner."}),g.jsx("div",{className:"content-type-grid",children:pe.map(we=>g.jsxs("label",{className:`content-type-chip ${le===we.key?"active":""}`,title:we.desc,children:[g.jsx("input",{type:"radio",name:"sortMode",checked:le===we.key,onChange:()=>me(we.key)}),g.jsx("span",{className:"material-icons",children:we.icon}),g.jsx("span",{children:we.label})]},we.key))})]},"displayOrder")}},{id:"navbarCategories",tab:"navigation",label:"Show Categories in Navbar",keywords:["navigation","menu","navbar","categories","links"],render:()=>g.jsx("div",{className:"setting-section",children:g.jsxs("div",{className:"setting-row",children:[g.jsxs("div",{children:[g.jsx("h3",{className:"setting-title",children:"Show Categories in Navbar"}),g.jsx("p",{className:"setting-desc",children:"Display library links in the top navigation bar"})]}),g.jsxs("label",{className:"toggle-switch",children:[g.jsx("input",{type:"checkbox",checked:N,onChange:pe=>U(pe.target.checked)}),g.jsx("span",{className:"slider"})]})]})},"navbarCategories")},{id:"navbarRequests",tab:"navigation",label:"Show Requests in Navbar",keywords:["navigation","navbar","requests","jellyseerr"],render:()=>g.jsx("div",{className:"setting-section",children:g.jsxs("div",{className:"setting-row",children:[g.jsxs("div",{children:[g.jsx("h3",{className:"setting-title",children:"Show Requests in Navbar"}),g.jsx("p",{className:"setting-desc",children:'Display the "Requests" link next to categories in the navbar'})]}),g.jsxs("label",{className:"toggle-switch",children:[g.jsx("input",{type:"checkbox",checked:se,onChange:pe=>ne(pe.target.checked)}),g.jsx("span",{className:"slider"})]})]})},"navbarRequests")}].filter(pe=>{if(!c)return pe.tab===r;const we=c.toLowerCase();return pe.label.toLowerCase().includes(we)||pe.keywords.some(ot=>ot.includes(we))});return i?g.jsxs(g.Fragment,{children:[g.jsx("div",{className:"legit-settings-overlay",onClick:e,children:g.jsxs("div",{className:"legit-settings-modal expanded",onClick:pe=>pe.stopPropagation(),children:[g.jsxs("div",{className:"legit-settings-sidebar",children:[g.jsx("div",{className:"sidebar-header",children:g.jsx("h2",{children:"Settings"})}),g.jsxs("div",{className:"sidebar-tabs",children:[g.jsxs("button",{className:`sidebar-tab ${r==="appearance"&&!c?"active":""}`,onClick:()=>{l("appearance"),h("")},children:[g.jsx("span",{className:"material-icons",children:"palette"})," Appearance"]}),g.jsxs("button",{className:`sidebar-tab ${r==="home"&&!c?"active":""}`,onClick:()=>{l("home"),h("")},children:[g.jsx("span",{className:"material-icons",children:"home"})," Home Screen"]}),g.jsxs("button",{className:`sidebar-tab ${r==="navigation"&&!c?"active":""}`,onClick:()=>{l("navigation"),h("")},children:[g.jsx("span",{className:"material-icons",children:"menu"})," Navigation"]})]})]}),g.jsxs("div",{className:"legit-settings-content",children:[g.jsxs("div",{className:"content-header",children:[g.jsxs("div",{className:"search-container",children:[g.jsx("span",{className:"material-icons search-icon",children:"search"}),g.jsx("input",{type:"text",placeholder:"Search settings...",value:c,onChange:pe=>h(pe.target.value)}),c&&g.jsx("button",{className:"clear-search",onClick:()=>h(""),children:g.jsx("span",{className:"material-icons",children:"close"})})]}),g.jsx("button",{className:"close-btn-icon",onClick:e,children:""})]}),g.jsx("div",{className:"content-body",children:Ne.length>0?Ne.map(pe=>pe.render()):g.jsxs("div",{className:"no-results",children:[g.jsx("span",{className:"material-icons",children:"search_off"}),g.jsxs("p",{children:['No settings found for "',c,'"']})]})}),g.jsxs("div",{className:"content-footer",children:[g.jsx("button",{className:"btn-reset",onClick:fe,children:"Reset Defaults"}),g.jsx("button",{className:"btn-save lf-btn--ring-hover",onClick:ie,children:"Save Changes"})]})]})]})}),g.jsx(Qf,{isOpen:d,onClose:()=>f(!1),onSave:pe=>{x==="app"?n({appBackground:pe}):x==="jellyseerr"&&n({jellyseerrBackground:pe}),f(!1)},userId:t}),g.jsx(du,{isOpen:p,onClose:()=>v(!1),onSave:ge,userId:t})]}):null},BL=({isOpen:i,onClose:e})=>{const[t,s]=C.useState(""),[n,r]=C.useState(""),[l,c]=C.useState(""),h=async()=>{if(t.trim()){r("loading"),c("");try{const d=await fetch(`${ee.api.basePath}/QuickConnect/Authorize`,{method:"POST",headers:{"Content-Type":"application/json","X-Emby-Authorization":ee.api.authHeader},body:JSON.stringify({Code:t.trim()})});if(d.ok)r("success"),setTimeout(()=>{s(""),r(""),e()},1500);else{const f=await d.json().catch(()=>({}));r("error"),c(f.Message||"Invalid code. Please try again.")}}catch{r("error"),c("Connection failed. Please try again.")}}};return i?g.jsx("div",{className:"qc-overlay",onClick:e,children:g.jsxs("div",{className:"qc-modal",onClick:d=>d.stopPropagation(),children:[g.jsxs("div",{className:"qc-header",children:[g.jsx("span",{className:"material-icons qc-icon",children:"qr_code"}),g.jsx("h2",{children:"Quick Connect"}),g.jsx("button",{className:"qc-close",onClick:e,children:""})]}),g.jsx("p",{className:"qc-desc",children:"Enter the code displayed on your other device to link it to your account."}),g.jsx("input",{className:"qc-input",type:"text",placeholder:"Enter Quick Connect code",value:t,onChange:d=>s(d.target.value),onKeyDown:d=>{d.key==="Enter"&&h()},autoFocus:!0}),n==="error"&&g.jsx("p",{className:"qc-error",children:l}),n==="success"&&g.jsx("p",{className:"qc-success",children:"Connected successfully!"}),g.jsx("button",{className:"qc-submit",onClick:h,disabled:n==="loading"||!t.trim(),children:n==="loading"?"Connecting...":"Authorize"})]})}):null},$L=({isOpen:i,onClose:e,user:t})=>{const[s,n]=C.useState(!1),[r,l]=C.useState(""),[c,h]=C.useState(!1),[d,f]=C.useState(!1),p=C.useRef(null),v=t?t.ImageTags?.Banner?`${ee.api.basePath}/Users/${t.Id}/Images/Banner?tag=${t.ImageTags.Banner}&quality=90`:t.BackdropImageTags?.[0]?`${ee.api.basePath}/Users/${t.Id}/Images/Backdrop/0?tag=${t.BackdropImageTags[0]}&quality=90`:"":"",x=async A=>{if(!(!t||!A)){l("Updating banner..."),n(!0);try{const R=await(await fetch(A)).blob();await ee.uploadUserImage(t.Id,"Banner",R),l("Banner updated! Refresh to see changes.")}catch(_){console.error(_),l("Banner upload failed.")}finally{n(!1)}}};if(!i||!t)return null;const S=async A=>{if(A){n(!0),l("");try{await ee.uploadUserImage(t.Id,"Primary",A),l("Profile image updated! Refresh to see changes."),f(!1)}catch(_){console.error(_),l("Upload failed. Check your connection.")}finally{n(!1)}}},T=A=>{const _=A.target.files?.[0];S(_)},E=async()=>{n(!0),l("");try{await ee.deleteUserImage(t.Id,"Primary"),l("Profile image removed.")}catch(A){console.error(A),l("Failed to remove image.")}finally{n(!1)}};return g.jsxs(g.Fragment,{children:[g.jsx("div",{className:"pm-overlay",onClick:e,children:g.jsxs("div",{className:"pm-modal",onClick:A=>A.stopPropagation(),children:[g.jsx("button",{className:"pm-close-floating",onClick:e,children:g.jsx("span",{className:"material-icons",children:"close"})}),g.jsxs("div",{className:"pm-cover",children:[v?g.jsx("img",{src:v,alt:"Banner",className:"pm-cover-img"}):g.jsx("div",{style:{width:"100%",height:"100%",background:"#333",display:"flex",alignItems:"center",justifyContent:"center"},children:g.jsx("span",{className:"material-icons",style:{fontSize:"48px",opacity:.1},children:"wallpaper"})}),g.jsx("div",{className:"pm-cover-overlay",children:g.jsxs("button",{className:"pm-edit-cover-btn",onClick:()=>h(!0),disabled:s,children:[g.jsx("span",{className:"material-icons",children:"edit"}),"Change Cover"]})})]}),g.jsxs("div",{className:"pm-profile-header",children:[g.jsxs("div",{className:"pm-avatar-container",children:[g.jsx("img",{src:`${ee.api.basePath}/Users/${t.Id}/Images/Primary?quality=90&t=${Date.now()}`,alt:t.Name,className:"pm-avatar-img",onError:A=>{A.target.style.display="none"}}),g.jsx("div",{className:"pm-avatar-edit-overlay",onClick:()=>f(!0),children:g.jsx("span",{className:"material-icons",children:"photo_camera"})})]}),g.jsxs("div",{className:"pm-user-details",children:[g.jsx("h2",{children:t.Name}),g.jsxs("p",{children:[g.jsx("span",{className:"material-icons",style:{fontSize:"16px"},children:t?.Policy?.IsAdministrator?"shield":"person"}),t?.Policy?.IsAdministrator?"Administrator":"User"]})]})]}),g.jsx("div",{className:"pm-divider"}),g.jsxs("div",{className:"pm-actions",children:[g.jsxs("button",{className:"pm-action-row",onClick:()=>p.current?.click(),disabled:s,children:[g.jsx("span",{className:"material-icons",children:"upload"}),g.jsx("span",{children:"Upload Custom Avatar"})]}),g.jsxs("button",{className:"pm-action-row danger",onClick:E,disabled:s,children:[g.jsx("span",{className:"material-icons",children:"delete"}),g.jsx("span",{children:"Remove Avatar"})]})]}),r&&g.jsx("div",{className:"pm-status",children:r}),g.jsx("input",{ref:p,type:"file",accept:"image/*",style:{display:"none"},onChange:T})]})}),g.jsx(Qf,{isOpen:c,onClose:()=>h(!1),onSave:A=>{x(A),h(!1)},userId:t?.Id}),g.jsx(du,{isOpen:d,onClose:()=>f(!1),onSave:S,userId:t?.Id})]})},Ra=({alwaysFilled:i=!1})=>{const{config:e}=Yi(),[t,s]=C.useState(null),[n,r]=C.useState([]),[l,c]=C.useState(!1),[h,d]=C.useState(!1),[f,p]=C.useState(!1),[v,x]=C.useState(!1),[S,T]=C.useState(!1),[E,A]=C.useState(!1),[_,R]=C.useState(!1),[w,N]=C.useState(!1),[U,D]=C.useState(!1),F=As(),j=Sx.useRef(null);C.useEffect(()=>{(async()=>{try{const se=await ee.getCurrentUser();if(s(se),se&&e.showNavbarCategories){const ne=await ee.getUserViews(se.Id);ne&&ne.Items&&r(ne.Items)}}catch(se){console.error("Navbar fetch error",se)}})()},[e.showNavbarCategories]),C.useEffect(()=>{const K=()=>{c(window.scrollY>50)};return window.addEventListener("scroll",K),()=>window.removeEventListener("scroll",K)},[]),C.useEffect(()=>{const K=se=>{se.target.closest(".nav-avatar-container")||p(!1)};return document.addEventListener("click",K),()=>document.removeEventListener("click",K)},[]),C.useEffect(()=>{(async()=>{try{const se=await fetch(`${ee.api.basePath}/Plugins`,{headers:{"X-Emby-Authorization":ee.api.authHeader}});if(se.ok){const de=(await se.json()).some(k=>k.Name?.toLowerCase().includes("enhanced")||k.Name?.toLowerCase().includes("random button"));D(de)}}catch{}})()},[]);const M=t?.Policy?.IsAdministrator,H=async K=>{if(!(!K||!t?.Id)){N(!0);try{await ee.uploadUserImage(t.Id,"Primary",K),R(!1),window.dispatchEvent(new CustomEvent("userUpdated",{detail:t})),window.location.reload()}catch(se){console.error("Avatar upload failed",se),alert("Failed to upload avatar. Please try again.")}finally{N(!1)}}};return g.jsxs(g.Fragment,{children:[g.jsx("nav",{className:`navbar ${l||i?"scrolled":""}`,children:g.jsxs("div",{className:"nav-content",children:[g.jsxs("div",{className:"nav-start",children:[g.jsx(_r,{to:"/",className:"nav-logo",children:e.logoUrl?g.jsx("img",{src:e.logoUrl,alt:e.appName}):g.jsx("img",{src:Vl(e.accentColor),alt:e.appName})}),g.jsxs("div",{className:"nav-links primary-links",children:[g.jsx(_r,{to:"/",className:"nav-link",children:"Home"}),e.showNavbarCategories&&n.map(K=>g.jsx("span",{className:"nav-link",onClick:()=>F(`/library/${K.Id}`),children:K.Name},K.Id)),e.jellyseerrUrl&&e.showNavbarRequests!==!1&&g.jsxs(g.Fragment,{children:[g.jsx("span",{className:"nav-divider"}),g.jsx("a",{href:e.jellyseerrUrl,target:"_blank",rel:"noopener noreferrer",className:"nav-link",children:"Requests"})]})]})]}),g.jsx("div",{className:"nav-end",children:g.jsxs("div",{className:"nav-actions",children:[g.jsx("button",{className:"nav-icon-btn",onClick:()=>d(!0),title:"Search",children:g.jsx("span",{className:"material-icons",children:"search"})}),g.jsx("button",{className:"nav-icon-btn",onClick:()=>F("/favorites"),title:"Watchlist",children:g.jsx("span",{className:"material-icons",children:"bookmark_border"})}),U&&g.jsx("button",{className:"nav-icon-btn",onClick:()=>{window.location.href="/web/index.html?classic#!/randomitems"},title:"Random",children:g.jsx("span",{className:"material-icons",children:"shuffle"})}),g.jsxs("div",{className:`nav-avatar-container ${f?"active":""}`,onClick:K=>{K.stopPropagation(),p(!f)},ref:j,children:[t?g.jsxs("div",{className:"nav-avatar-wrapper",children:[g.jsx("img",{src:`${ee.api.basePath}/Users/${t.Id}/Images/Primary?quality=90&${new Date().getTime()}`,alt:t.Name,className:"nav-avatar",onError:K=>{K.target.style.display="none"}}),g.jsx("span",{className:"material-icons avatar-arrow",children:"expand_more"})]}):g.jsxs("div",{className:"nav-avatar-wrapper",children:[g.jsx("span",{className:"material-icons nav-avatar-placeholder",children:"account_circle"}),g.jsx("span",{className:"material-icons avatar-arrow",children:"expand_more"})]}),f&&g.jsxs("div",{className:"nav-dropdown-menu usermenu",children:[t&&g.jsxs("div",{className:"user-menu-header",onClick:()=>{p(!1),A(!0)},children:[g.jsx("div",{className:"header-avatar-container",children:g.jsx("img",{src:`${ee.api.basePath}/Users/${t.Id}/Images/Primary?quality=90&${new Date().getTime()}`,alt:t.Name,className:"menu-avatar",onError:K=>{K.target.style.display="none"}})}),g.jsxs("div",{className:"user-menu-info",children:[g.jsx("span",{className:"user-name",children:t.Name}),g.jsxs("span",{className:"user-status",children:[g.jsx("span",{className:"material-icons",children:M?"shield":"person"}),M?"Administrator":"User"]})]}),g.jsx("span",{className:"material-icons edit-icon",children:"edit"})]}),g.jsx("div",{className:"menu-section-label",children:"General"}),g.jsxs("button",{onClick:()=>{p(!1),d(!0)},children:[g.jsx("span",{className:"material-icons",children:"search"})," Search"]}),g.jsxs("button",{onClick:()=>{p(!1),window.location.href="/web/index.html?classic#!/remotecontrol"},children:[g.jsx("span",{className:"material-icons",children:"cast"})," Cast to Device"]}),g.jsxs("button",{onClick:()=>{p(!1),window.location.href="/web/index.html?classic#!/syncplay"},children:[g.jsx("span",{className:"material-icons",children:"sync"})," SyncPlay"]}),g.jsxs("button",{onClick:()=>{p(!1),window.location.href="/web/index.html?classic#!/playback"},children:[g.jsx("span",{className:"material-icons",children:"play_circle"})," Player"]}),U&&g.jsxs("button",{onClick:()=>{p(!1),window.location.href="/web/index.html?classic#!/randomitems"},children:[g.jsx("span",{className:"material-icons",children:"shuffle"})," Random"]}),M&&g.jsxs(g.Fragment,{children:[g.jsx("div",{className:"dropdown-divider"}),g.jsx("div",{className:"menu-section-label",children:"Administration"}),g.jsxs("button",{onClick:()=>{p(!1),window.location.href="/web/index.html?classic#!/dashboard"},children:[g.jsx("span",{className:"material-icons",children:"dashboard"})," Dashboard"]})]}),g.jsx("div",{className:"dropdown-divider"}),g.jsx("div",{className:"menu-section-label",children:"Preferences"}),g.jsxs("button",{onClick:()=>{p(!1),window.location.href="/web/index.html?#/profile"},children:[g.jsx("span",{className:"material-icons",children:"settings"})," User Settings"]}),g.jsxs("button",{onClick:()=>{p(!1),x(!0)},children:[g.jsx("span",{className:"material-icons",children:"palette"})," Theme Settings"]}),U&&g.jsxs("button",{onClick:()=>{p(!1),window.location.href="/web/index.html#!/configurationpage?name=JellyfinEnhanced"},children:[g.jsx("span",{className:"material-icons",children:"auto_awesome"})," Jellyfin Enhanced"]}),g.jsx("div",{className:"dropdown-divider"}),g.jsx("div",{className:"menu-section-label",children:"Account"}),g.jsxs("button",{onClick:()=>{p(!1),R(!0)},children:[g.jsx("span",{className:"material-icons",children:"face"})," Change Avatar"]}),g.jsxs("button",{onClick:()=>{p(!1),T(!0)},children:[g.jsx("span",{className:"material-icons",children:"qr_code"})," Quick Connect"]}),g.jsxs("button",{onClick:()=>{p(!1),F("/login/select-server")},children:[g.jsx("span",{className:"material-icons",children:"dns"})," Change Server"]}),g.jsxs("button",{onClick:()=>{p(!1),localStorage.removeItem("jellyfin_credentials"),window.location.reload()},children:[g.jsx("span",{className:"material-icons",children:"logout"})," Log Out"]})]})]})]})})]})}),g.jsx(UL,{isOpen:h,onClose:()=>d(!1)}),g.jsx(fS,{isOpen:v,onClose:()=>x(!1),userId:t?.Id}),g.jsx(BL,{isOpen:S,onClose:()=>T(!1)}),g.jsx($L,{isOpen:E,onClose:()=>A(!1),user:t}),g.jsx(du,{isOpen:_,onClose:()=>R(!1),onSave:H,userId:t?.Id,uploading:w})]})},VL=()=>{const{config:i}=Yi();return g.jsx("div",{className:"legitflix-footer",children:g.jsxs("div",{className:"footer-content",children:[g.jsx("div",{className:"footer-logo",children:g.jsx("a",{href:"https://github.com/gorillasuti/Legitflix-plugin",target:"_blank",rel:"noopener noreferrer",className:"footer-link",children:g.jsx("img",{className:"footer-logo-img",src:Vl(i.accentColor),alt:i.appName})})}),g.jsx("div",{className:"footer-divider"}),g.jsxs("div",{className:"footer-author",children:["Created by ",g.jsx("a",{href:"https://github.com/gorillasuti",target:"_blank",rel:"noopener noreferrer",className:"footer-link",children:g.jsx("strong",{children:"gorillasuti"})})]})]})})},Wv=()=>{const[i,e]=C.useState([]),[t,s]=C.useState([]),[n,r]=C.useState([]),[l,c]=C.useState([]),[h,d]=C.useState(!0),[f,p]=C.useState(null),{config:v}=Yi(),x=As();C.useEffect(()=>{(async()=>{d(!0);try{const A=await ee.getCurrentUser();if(A){const _=await ee.getUserViews(A.Id);e(_.Items||[]);const w=(await ee.getResumeItems(A.Id)).Items||[];s(w);const U=((await ee.getHistoryItems(A.Id,12)).Items||[]).filter(M=>!w.some(H=>H.Id===M.Id));r(U);const j=(await(async()=>{const M=v.contentSortMode||"latest",H={latest:{sortBy:"DateCreated",sortOrder:"Descending"},random:{sortBy:"Random",sortOrder:"Descending"},topRated:{sortBy:"CommunityRating",sortOrder:"Descending"}},{sortBy:K,sortOrder:se}=H[M]||H.latest;return ee.getItems(A.Id,{limit:20,recursive:!0,includeItemTypes:v.promoMediaTypes||["Movie","Series"],sortBy:K,sortOrder:se,imageTypeLimit:1,enableImageTypes:["Primary","Backdrop","Thumb","Logo"],fields:["Overview","ProductionYear","ImageTags","OfficialRating","CommunityRating","Genres"]})})()).Items||[];c(j.slice(0,3))}}catch(A){console.error("Failed to fetch data",A)}finally{d(!1)}})()},[v]);const S=E=>{p(E)},T=()=>{p(null)};return g.jsxs("div",{className:"home-page",children:[g.jsx(Ra,{}),g.jsx(OL,{onInfoClick:S}),g.jsx("div",{className:"home-content-container",style:{position:"relative",zIndex:10},children:h?g.jsxs("div",{style:{padding:"0 4.2%",marginTop:"40px"},children:[g.jsx(He,{width:"180px",height:"24px",style:{marginBottom:"20px"}}),g.jsx("div",{style:{display:"flex",gap:"15px",overflow:"hidden",marginBottom:"50px"},children:[1,2,3,4,5,6].map(E=>g.jsx("div",{style:{flex:"0 0 160px"},children:g.jsx(He,{width:"100%",height:"240px",style:{borderRadius:"8px"}})},E))}),g.jsx(He,{width:"220px",height:"24px",style:{marginBottom:"20px"}}),g.jsx("div",{style:{display:"flex",gap:"15px",overflow:"hidden",marginBottom:"50px"},children:[1,2,3,4,5].map(E=>g.jsxs("div",{style:{flex:"0 0 280px"},children:[g.jsx(He,{width:"100%",height:"157px",style:{borderRadius:"4px",marginBottom:"8px"}}),g.jsx(He,{width:"70%",height:"14px",style:{marginBottom:"4px"}}),g.jsx(He,{width:"40%",height:"12px"})]},E))}),g.jsxs("div",{style:{marginBottom:"50px"},children:[g.jsx(He,{width:"100%",height:"300px",style:{borderRadius:"12px",marginBottom:"15px"}}),g.jsxs("div",{style:{display:"flex",gap:"15px"},children:[g.jsx(He,{width:"50%",height:"180px",style:{borderRadius:"12px"}}),g.jsx(He,{width:"50%",height:"180px",style:{borderRadius:"12px"}})]})]}),g.jsx(He,{width:"180px",height:"24px",style:{marginBottom:"20px"}}),g.jsx("div",{style:{display:"flex",gap:"15px",overflow:"hidden"},children:[1,2,3,4,5].map(E=>g.jsx("div",{style:{flex:"0 0 220px"},children:g.jsx(He,{width:"100%",height:"330px",style:{borderRadius:"4px"}})},E))})]}):g.jsxs(g.Fragment,{children:[g.jsxs("section",{className:"home-section",style:{paddingLeft:"4%",paddingRight:"4%",marginBottom:"40px"},children:[g.jsx("h2",{className:"section-title",style:{fontSize:"1.4rem",fontWeight:"bold",marginBottom:"15px",color:"#cacaca"},children:"Browse Libraries"}),g.jsxs("div",{className:"libraries-grid",children:[i.map(E=>g.jsxs("div",{className:"library-card",onClick:()=>x(`/library/${E.Id}`),children:[g.jsx("img",{src:`${ee.api.basePath}/Items/${E.Id}/Images/Primary?fillHeight=480&fillWidth=320&quality=90`,alt:E.Name,className:"library-card-image",onError:A=>{A.target.style.display="none",A.target.nextSibling.style.display="flex"}}),g.jsx("div",{className:"library-card-content fallback",style:{display:"none"},children:g.jsx("span",{className:"material-icons library-icon",children:E.CollectionType==="movies"?"movie":E.CollectionType==="tvshows"?"tv":"folder"})}),v.showLibraryTitles&&g.jsx("div",{className:"library-card-overlay",children:g.jsx("span",{className:"library-name",children:E.Name})})]},E.Id)),g.jsx(PL,{})]})]}),t.length>0&&g.jsxs("section",{className:"home-section",style:{paddingLeft:"4%",paddingRight:"4%",marginBottom:"40px"},children:[g.jsx("h2",{className:"section-title",style:{fontSize:"1.4rem",fontWeight:"bold",marginBottom:"15px",color:"#cacaca"},children:"Continue Watching"}),g.jsx("div",{className:"backdrop-scroll-container",children:t.map(E=>{const A=E.UserData?.PlayedPercentage>=100||E.UserData?.Played,_=E.RunTimeTicks&&E.UserData?.PlaybackPositionTicks?E.RunTimeTicks-E.UserData.PlaybackPositionTicks:0,R=_>0?Math.round(_/6e8):0;return g.jsxs("div",{className:"backdrop-card",onClick:()=>window.location.href=`/web/index.html?classic=true#!/playback?id=${E.Id}`,title:`Resume: ${E.Name}`,children:[g.jsxs("div",{className:"backdrop-card-image",children:[g.jsx("img",{src:`${ee.api.basePath}/Items/${E.Id}/Images/Backdrop/0?maxWidth=500&quality=90`,alt:E.Name,onError:w=>{w.target.src=`${ee.api.basePath}/Items/${E.Id}/Images/Primary?maxWidth=500`}}),g.jsx("div",{className:"backdrop-play-overlay",children:g.jsx("span",{className:"material-icons",children:"play_arrow"})}),A?g.jsx("div",{className:"backdrop-badge watched",children:"Watched"}):R>0?g.jsxs("div",{className:"backdrop-badge time-left",children:[R,"m left"]}):null]}),E.UserData&&E.RunTimeTicks>0&&!A&&g.jsx("div",{className:"backdrop-progress-track",children:g.jsx("div",{className:"backdrop-progress-fill",style:{width:`${Math.min(100,E.UserData.PlaybackPositionTicks/E.RunTimeTicks*100)}%`}})}),g.jsxs("div",{className:"backdrop-card-info",children:[g.jsx("span",{className:"backdrop-card-series",children:E.SeriesName||""}),g.jsx("span",{className:"backdrop-card-title",children:E.SeriesName&&E.ParentIndexNumber!=null&&E.IndexNumber!=null?`S${E.ParentIndexNumber} E${E.IndexNumber}  ${E.Name}`:E.Name})]})]},E.Id)})})]}),n.length>0&&g.jsxs("section",{className:"home-section",style:{paddingLeft:"4%",paddingRight:"4%",marginBottom:"40px"},children:[g.jsx("h2",{className:"section-title",style:{fontSize:"1.4rem",fontWeight:"bold",marginBottom:"15px",color:"#cacaca"},children:"History"}),g.jsx("div",{className:"backdrop-scroll-container",children:n.map(E=>g.jsxs("div",{className:"backdrop-card",onClick:()=>x(`/item/${E.Id}`),title:E.Name,children:[g.jsxs("div",{className:"backdrop-card-image",children:[g.jsx("img",{src:`${ee.api.basePath}/Items/${E.Id}/Images/Backdrop/0?maxWidth=500&quality=90`,alt:E.Name,onError:A=>{A.target.src=`${ee.api.basePath}/Items/${E.Id}/Images/Primary?maxWidth=500`}}),g.jsx("div",{className:"backdrop-play-overlay",children:g.jsx("span",{className:"material-icons",children:"info"})})]}),g.jsxs("div",{className:"backdrop-card-info",children:[g.jsx("span",{className:"backdrop-card-series",children:E.SeriesName||""}),g.jsx("span",{className:"backdrop-card-title",children:E.SeriesName&&E.ParentIndexNumber!=null&&E.IndexNumber!=null?`S${E.ParentIndexNumber} E${E.IndexNumber}  ${E.Name}`:E.Name})]})]},E.Id))})]}),l.length>0&&g.jsx("section",{className:"home-section",style:{paddingLeft:"4%",paddingRight:"4%",marginBottom:"50px"},children:g.jsxs("div",{className:"promo2-wrapper",children:[g.jsxs("div",{className:"promo2-hero",onClick:()=>x(`/item/${l[0].Id}`),children:[g.jsx("img",{src:`${ee.api.basePath}/Items/${l[0].Id}/Images/Backdrop/0?maxWidth=1400&quality=90`,className:"promo2-hero-img",alt:l[0].Name}),g.jsx("div",{className:"promo2-hero-gradient"}),g.jsxs("div",{className:"promo2-hero-content",children:[l[0].ImageTags?.Logo?g.jsx("img",{src:`${ee.api.basePath}/Items/${l[0].Id}/Images/Logo/0?maxWidth=350&quality=90`,className:"promo2-hero-logo",alt:l[0].Name}):g.jsx("h2",{className:"promo2-hero-title",children:l[0].Name}),g.jsxs("div",{className:"promo2-meta-line",children:[g.jsx("span",{className:"promo2-badge",children:l[0].OfficialRating||"13+"}),l[0].ProductionYear&&g.jsxs(g.Fragment,{children:[g.jsx("span",{className:"promo2-meta-dot",children:""}),g.jsx("span",{className:"promo2-meta-text",children:l[0].ProductionYear})]}),l[0].Genres&&l[0].Genres.length>0&&g.jsxs(g.Fragment,{children:[g.jsx("span",{className:"promo2-meta-dot",children:""}),g.jsx("span",{className:"promo2-meta-text",children:l[0].Genres.slice(0,3).join(", ")})]}),l[0].CommunityRating&&g.jsxs(g.Fragment,{children:[g.jsx("span",{className:"promo2-meta-dot",children:""}),g.jsxs("span",{className:"promo2-meta-text",children:[" ",l[0].CommunityRating.toFixed(1)]})]})]}),l[0].Overview&&g.jsx("p",{className:"promo2-hero-desc",children:l[0].Overview}),g.jsx(ii,{variant:"ringHover",size:"lg",className:"promo2-btn",onClick:E=>{E.stopPropagation(),x(`/item/${l[0].Id}`)},children:"WATCH NOW"})]})]}),(l[1]||l[2])&&g.jsx("div",{className:"promo2-row",children:l.slice(1,3).map(E=>g.jsxs("div",{className:"promo2-card",onClick:()=>x(`/item/${E.Id}`),children:[g.jsxs("div",{className:"promo2-card-text",children:[E.ImageTags?.Logo?g.jsx("img",{src:`${ee.api.basePath}/Items/${E.Id}/Images/Logo/0?maxWidth=220&quality=90`,className:"promo2-card-logo",alt:E.Name}):g.jsx("h3",{className:"promo2-card-title",children:E.Name}),g.jsxs("div",{className:"promo2-meta-line promo2-meta-line--card",children:[g.jsx("span",{className:"promo2-badge",children:E.OfficialRating||"13+"}),E.ProductionYear&&g.jsxs(g.Fragment,{children:[g.jsx("span",{className:"promo2-meta-dot",children:""}),g.jsx("span",{className:"promo2-meta-text",children:E.ProductionYear})]}),E.Genres&&E.Genres.length>0&&g.jsxs(g.Fragment,{children:[g.jsx("span",{className:"promo2-meta-dot",children:""}),g.jsx("span",{className:"promo2-meta-text",children:E.Genres.slice(0,2).join(", ")})]}),E.CommunityRating&&g.jsxs(g.Fragment,{children:[g.jsx("span",{className:"promo2-meta-dot",children:""}),g.jsxs("span",{className:"promo2-meta-text",children:[" ",E.CommunityRating.toFixed(1)]})]})]}),g.jsx("p",{className:"promo2-card-desc",children:E.Overview}),g.jsx(ii,{variant:"ringHover",className:"promo2-btn",onClick:A=>{A.stopPropagation(),x(`/item/${E.Id}`)},children:"START WATCHING"})]}),g.jsx("div",{className:"promo2-card-img",children:g.jsx("img",{src:`${ee.api.basePath}/Items/${E.Id}/Images/Backdrop/0?maxWidth=500&quality=90`,alt:E.Name,onError:A=>{A.target.src=`${ee.api.basePath}/Items/${E.Id}/Images/Primary?maxWidth=400`}})})]},E.Id))})]})}),i.map(E=>g.jsx(DL,{title:`Latest ${E.Name}`,libraryId:E.Id,onCardClick:A=>x(`/item/${A.Id}`)},E.Id)),g.jsx(VL,{})]})}),g.jsx(kL,{itemId:f,isOpen:!!f,onClose:T})]})};var Ph={exports:{}},Uh,Zv;function GL(){if(Zv)return Uh;Zv=1;var i="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return Uh=i,Uh}var Mh,Jv;function HL(){if(Jv)return Mh;Jv=1;var i=GL();function e(){}function t(){}return t.resetWarningCache=e,Mh=function(){function s(l,c,h,d,f,p){if(p!==i){var v=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw v.name="Invariant Violation",v}}s.isRequired=s;function n(){return s}var r={array:s,bigint:s,bool:s,func:s,number:s,object:s,string:s,symbol:s,any:s,arrayOf:n,element:s,elementType:s,instanceOf:n,node:s,objectOf:n,oneOf:n,oneOfType:n,shape:n,exact:n,checkPropTypes:t,resetWarningCache:e};return r.PropTypes=r,r},Mh}var ey;function zL(){return ey||(ey=1,Ph.exports=HL()()),Ph.exports}var KL=zL();const fr=xx(KL),ty={popular:[{code:"eng",name:"English"},{code:"spa",name:"Spanish"},{code:"jpn",name:"Japanese"},{code:"hun",name:"Hungarian"}],more:[{code:"ara",name:"Arabic"},{code:"bul",name:"Bulgarian"},{code:"chi",name:"Chinese"},{code:"hrv",name:"Croatian"},{code:"cze",name:"Czech"},{code:"dan",name:"Danish"},{code:"dut",name:"Dutch"},{code:"fin",name:"Finnish"},{code:"fre",name:"French"},{code:"ger",name:"German"},{code:"gre",name:"Greek"},{code:"heb",name:"Hebrew"},{code:"hin",name:"Hindi"},{code:"ind",name:"Indonesian"},{code:"ita",name:"Italian"},{code:"kor",name:"Korean"},{code:"may",name:"Malay"},{code:"nor",name:"Norwegian"},{code:"per",name:"Persian"},{code:"pol",name:"Polish"},{code:"por",name:"Portuguese"},{code:"rum",name:"Romanian"},{code:"rus",name:"Russian"},{code:"srp",name:"Serbian"},{code:"slo",name:"Slovak"},{code:"slv",name:"Slovenian"},{code:"swe",name:"Swedish"},{code:"tha",name:"Thai"},{code:"tur",name:"Turkish"},{code:"ukr",name:"Ukrainian"},{code:"vie",name:"Vietnamese"}]},Xf=({isOpen:i,onClose:e,seriesId:t,initialSeasonId:s,initialEpisodeId:n,isMovie:r=!1})=>{const[l,c]=C.useState([]),[h,d]=C.useState([]),[f,p]=C.useState(s||""),[v,x]=C.useState(n||""),[S,T]=C.useState([]),[E,A]=C.useState([]),[_,R]=C.useState("eng"),[w,N]=C.useState(!1),[U,D]=C.useState(!1),[F,j]=C.useState(null);C.useEffect(()=>{i&&t&&(r?x(n||t):M())},[i,t,r]),C.useEffect(()=>{f&&H(f)},[f]),C.useEffect(()=>{v&&K()},[v]);const M=async()=>{try{const k=await ee.getCurrentUser(),G=await ee.getSeasons(k.Id,t);c(G.Items||[]),!f&&G.Items.length>0&&p(G.Items[0].Id)}catch(k){console.error("Failed to load seasons",k)}},H=async k=>{try{const G=await ee.getCurrentUser(),Y=await ee.getEpisodes(G.Id,t,k);d(Y.Items||[]),!v&&Y.Items.length>0?x(Y.Items[0].Id):v&&(Y.Items.find(le=>le.Id===v)||x(Y.Items[0]?Y.Items[0].Id:""))}catch(G){console.error("Failed to load episodes",G)}},K=async()=>{if(v){N(!0),j(null);try{const k=await ee.getCurrentUser(),G=await ee.getMediaStreams(k.Id,v);T(G.filter(Y=>Y.Type==="Subtitle"))}catch(k){j("Failed to load subtitles."),console.error(k)}finally{N(!1)}}},se=async k=>{if(window.confirm("Are you sure you want to delete this subtitle?"))try{await ee.deleteSubtitle(v,k),K()}catch{alert("Failed to delete subtitle")}},ne=async k=>{if(k.preventDefault(),!!v){D(!0),A([]);try{const G=await ee.searchRemoteSubtitles(v,_);A(G||[])}catch{alert("Search failed")}finally{D(!1)}}},de=async k=>{try{await ee.downloadRemoteSubtitles(v,k),alert("Subtitle downloaded!"),K()}catch{alert("Download failed")}};return i?g.jsx("div",{className:"lf-sub-overlay",onClick:e,children:g.jsxs("div",{className:"lf-sub-modal",onClick:k=>k.stopPropagation(),children:[g.jsxs("div",{className:"lf-sub-header",children:[g.jsx("h3",{children:"Subtitles Manager"}),g.jsx("button",{className:"lf-sub-header__close",onClick:e,children:g.jsx("span",{className:"material-icons",children:"close"})})]}),g.jsxs("div",{className:"lf-sub-content",children:[!r&&g.jsxs("div",{className:"lf-sub-selectors",children:[g.jsxs("div",{children:[g.jsx("label",{className:"lf-sub-label",children:"Season"}),g.jsx("select",{className:"lf-sub-select",value:f,onChange:k=>{p(k.target.value),x("")},children:l.map(k=>g.jsx("option",{value:k.Id,children:k.Name},k.Id))})]}),g.jsxs("div",{children:[g.jsx("label",{className:"lf-sub-label",children:"Episode"}),g.jsx("select",{className:"lf-sub-select",value:v,onChange:k=>x(k.target.value),children:h.map(k=>g.jsxs("option",{value:k.Id,children:[k.IndexNumber,". ",k.Name]},k.Id))})]})]}),g.jsxs("div",{className:"lf-sub-section",children:[g.jsx("h4",{className:"lf-sub-section-title",children:"Current Subtitles"}),w?g.jsxs("div",{className:"lf-sub-loading",children:[g.jsx("span",{className:"material-icons",children:"sync"}),"Loading"]}):g.jsx("div",{className:"lf-sub-list",children:S.length===0?g.jsx("div",{className:"lf-sub-list__empty",children:"No subtitles found."}):S.map((k,G)=>g.jsxs("div",{className:"lf-sub-list__item",children:[g.jsxs("div",{children:[g.jsx("div",{className:"lf-sub-list__name",children:k.DisplayTitle||k.Language||"Unknown"}),g.jsxs("div",{className:"lf-sub-list__meta",children:[k.IsExternal?"External":"Embedded","  ",k.Codec]})]}),k.IsExternal&&g.jsxs("button",{className:"lf-sub-action-btn lf-sub-action-btn--delete",onClick:()=>se(k.Index),children:[g.jsx("span",{className:"material-icons",children:"delete_outline"}),"Delete"]})]},G))})]}),g.jsxs("div",{className:"lf-sub-section",children:[g.jsx("h4",{className:"lf-sub-section-title",children:"Search Subtitles"}),g.jsxs("form",{onSubmit:ne,className:"lf-sub-search-row",children:[g.jsxs("select",{className:"lf-sub-select",value:_,onChange:k=>R(k.target.value),style:{flex:1},children:[g.jsx("optgroup",{label:"Popular",children:ty.popular.map(k=>g.jsx("option",{value:k.code,children:k.name},k.code))}),g.jsx("optgroup",{label:"More Languages",children:ty.more.map(k=>g.jsx("option",{value:k.code,children:k.name},k.code))})]}),g.jsxs("button",{type:"submit",disabled:U||!v,className:"lf-sub-action-btn lf-sub-action-btn--search",children:[g.jsx("span",{className:"material-icons",children:"search"}),U?"Searching":"Search"]})]}),E.length>0&&g.jsx("div",{className:"lf-sub-list",children:E.map(k=>g.jsxs("div",{className:"lf-sub-list__item",children:[g.jsxs("div",{className:"lf-sub-list__info",children:[g.jsx("div",{className:"lf-sub-list__name",children:k.Name}),g.jsxs("div",{className:"lf-sub-list__meta",children:[k.Format,"  ",k.ProviderName,"  ",k.DownloadCount," DLs"]})]}),g.jsxs("button",{className:"lf-sub-action-btn lf-sub-action-btn--download",onClick:()=>de(k.Id),children:[g.jsx("span",{className:"material-icons",children:"download"}),"Download"]})]},k.Id))})]})]})]})}):null};Xf.propTypes={isOpen:fr.bool.isRequired,onClose:fr.func.isRequired,seriesId:fr.string,initialSeasonId:fr.string,initialEpisodeId:fr.string,isMovie:fr.bool};const YL=()=>{const{id:i}=nu(),e=As(),[t,s]=C.useState(null),[n,r]=C.useState([]),[l,c]=C.useState([]),[h,d]=C.useState(null),[f,p]=C.useState([]),[v,x]=C.useState(!0),[S,T]=C.useState(!1),[E,A]=C.useState(!1),[_,R]=C.useState(null),[w,N]=C.useState(!1),[U,D]=C.useState(!1),[F,j]=C.useState(!1),[M,H]=C.useState([]),[K,se]=C.useState(localStorage.getItem("legitflix-audio-pref")||"en"),[ne,de]=C.useState(localStorage.getItem("legitflix-sub-pref")||"en"),[k,G]=C.useState(!1),[Y,le]=C.useState("all"),[me,P]=C.useState("default"),[$,ie]=C.useState(!1),[fe,ge]=C.useState(!1),[ve,Ne]=C.useState(!1),[pe,we]=C.useState(!1),[ot,ct]=C.useState(!1),[zt,_t]=C.useState(!1),[xt,os]=C.useState(null),[Ve,Le]=C.useState(!1),[Fe,Ze]=C.useState(!1),ut=C.useRef(null),Oe=C.useRef(null),Ye=C.useRef(null),mt=C.useRef(null),st=C.useRef(null),Kt=C.useRef(null),Xt=C.useRef(null),_s=C.useRef(null);C.useEffect(()=>{(async()=>{x(!0);try{const Pe=await ee.getCurrentUser();if(!Pe)return;const Je=await ee.getSeries(Pe.Id,i);if(s(Je),Ze(Je.UserData?.IsFavorite||!1),Je.RemoteTrailers&&Je.RemoteTrailers.length>0){const Dt=Je.RemoteTrailers[0].Url.match(/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/);Dt&&Dt[1]&&os(Dt[1])}const Rs=await ee.getSeasons(Pe.Id,i);let xe=null;Rs.Items&&Rs.Items.length>0&&(r(Rs.Items),xe=Rs.Items[0].Id);try{const Lt=await ee.getNextUp(Pe.Id,i);if(Lt&&Lt.Items&&Lt.Items.length>0){const Dt=Lt.Items[0];R(Dt),Dt.SeasonId&&Rs.Items.find(Dr=>Dr.Id===Dt.SeasonId)&&(xe=Dt.SeasonId)}}catch(Lt){console.warn("Failed to fetch Next Up for smart season selection",Lt)}xe&&d(xe);const Os=await ee.getSimilarItems(Pe.Id,i);p(Os.Items||[])}catch(Pe){console.error("Failed to load series data",Pe)}finally{x(!1)}})()},[i]);const ye=async()=>{if(!(!t||!h))try{const ce=await ee.getCurrentUser(),Pe=await ee.getEpisodes(ce.Id,t.Id,h);c(Pe.Items||[])}catch(ce){console.error("Failed to load episodes",ce)}};C.useEffect(()=>{ye()},[h,t]),C.useEffect(()=>{const ce=Pe=>{ut.current&&!ut.current.contains(Pe.target)&&D(!1),Oe.current&&!Oe.current.contains(Pe.target)&&G(!1),Ye.current&&!Ye.current.contains(Pe.target)&&ie(!1),mt.current&&!mt.current.contains(Pe.target)&&ge(!1)};return document.addEventListener("mousedown",ce),()=>document.removeEventListener("mousedown",ce)},[]);const $e=()=>{j(!F),H([])},De=ce=>{e(`/play/${ce}`)},St=ce=>{F?M.includes(ce)?H(M.filter(Pe=>Pe!==ce)):H([...M,ce]):De(ce)},xs=async ce=>{if(!(M.length===0||E)){A(!0),c(Pe=>Pe.map(Je=>M.includes(Je.Id)?{...Je,UserData:{...Je.UserData||{},Played:ce}}:Je));try{const Pe=await ee.getCurrentUser();if(!Pe)throw new Error("No user");await Promise.all(M.map(Je=>ee.markPlayed(Pe.Id,Je,ce))),await ye()}catch(Pe){console.error("Failed to mark episodes",Pe),await ye()}finally{A(!1),H([])}}},ss=()=>{const ce=l.map(Je=>Je.Id),Pe=ce.every(Je=>M.includes(Je));H(Pe?[]:ce)},It=(ce,Pe)=>{ce==="audio"?(se(Pe),localStorage.setItem("legitflix-audio-pref",Pe)):(de(Pe),localStorage.setItem("legitflix-sub-pref",Pe)),G(!1)},Wt=async()=>{try{const ce=await ee.getCurrentUser(),Pe=!Fe;await ee.markFavorite(ce.Id,t.Id,Pe),Ze(Pe)}catch(ce){console.error("Favorite toggle failed",ce)}},Nt=()=>{const ce=!Ve;Le(ce);const Pe=ce?"mute":"unMute";_s.current?.contentWindow?.postMessage(JSON.stringify({event:"command",func:Pe,args:[]}),"*")},Is=()=>{Kt.current&&clearTimeout(Kt.current),Kt.current=setTimeout(()=>{ve&&we(!0)},5e3)},Rt=()=>{we(!1),ve&&Is()},Mt=()=>{if(ve){is();return}Ne(!0),we(!1),Is();let ce=!1;const Pe=Je=>{typeof Je.data=="string"&&(Je.data.includes('"event"')||Je.data.includes('"id"'))&&(ce=!0,st.current&&clearTimeout(st.current))};window.addEventListener("message",Pe),window.lfMessageHandler=Pe,st.current=setTimeout(()=>{!ce&&ve&&(console.log("Possible block detected: No YT API message received."),ct(!0))},4e3)},is=()=>{Ne(!1),we(!1),ct(!1),_t(!1),Le(!1),Kt.current&&(clearTimeout(Kt.current),Kt.current=null),st.current&&(clearTimeout(st.current),st.current=null),window.lfMessageHandler&&(window.removeEventListener("message",window.lfMessageHandler),delete window.lfMessageHandler)},ns=ce=>{F||(Xt.current=setTimeout(()=>{j(!0),H([ce]),navigator.vibrate&&navigator.vibrate(50)},600))},ri=()=>{Xt.current&&clearTimeout(Xt.current)},zs=M.length===0?{label:"Mark Watched",icon:"visibility"}:M.every(Pe=>l.find(Rs=>Rs.Id===Pe)?.UserData?.Played)?{label:"Mark Unwatched",icon:"visibility_off",isPlayed:!1}:{label:"Mark Watched",icon:"visibility",isPlayed:!0},li=C.useMemo(()=>{let ce=[...l];return Y==="unwatched"?ce=ce.filter(Pe=>!Pe.UserData?.Played):Y==="watched"&&(ce=ce.filter(Pe=>Pe.UserData?.Played)),me==="newest"?ce.sort((Pe,Je)=>(Je.IndexNumber||0)-(Pe.IndexNumber||0)):me==="oldest"&&ce.sort((Pe,Je)=>(Pe.IndexNumber||0)-(Je.IndexNumber||0)),ce},[l,Y,me]);if(C.useEffect(()=>()=>{Kt.current&&clearTimeout(Kt.current),st.current&&clearTimeout(st.current),window.lfMessageHandler&&window.removeEventListener("message",window.lfMessageHandler)},[]),v)return g.jsxs("div",{className:"lf-series-container",children:[g.jsx(Ra,{alwaysFilled:!0}),g.jsxs("section",{className:"lf-series-hero",children:[g.jsx("div",{className:"lf-series-hero__backdrop",style:{background:"#141414"}}),g.jsxs("div",{className:"lf-series-hero__content",children:[g.jsx("div",{className:"lf-series-hero__poster",children:g.jsx(He,{type:"rect",width:"100%",height:"100%",style:{aspectRatio:"2/3",borderRadius:"8px"}})}),g.jsxs("div",{className:"lf-series-hero__info",children:[g.jsx("h1",{className:"lf-series-hero__title",style:{marginBottom:"1rem"},children:g.jsx(He,{type:"text",width:"60%",height:"3rem"})}),g.jsxs("div",{className:"lf-series-hero__meta",style:{display:"flex",gap:"1rem",marginBottom:"1.5rem"},children:[g.jsx(He,{type:"text",width:"60px"}),g.jsx(He,{type:"text",width:"40px"}),g.jsx(He,{type:"text",width:"80px"})]}),g.jsxs("div",{className:"lf-series-hero__details",children:[g.jsxs("div",{className:"lf-series-hero__description",children:[g.jsx(He,{type:"text",width:"100%"}),g.jsx(He,{type:"text",width:"95%"}),g.jsx(He,{type:"text",width:"90%"})]}),g.jsxs("div",{className:"lf-series-hero__cast-info",style:{marginTop:"1rem"},children:[g.jsx(He,{type:"text",width:"80%"}),g.jsx(He,{type:"text",width:"70%"})]})]}),g.jsxs("div",{className:"lf-series-hero__actions",style:{marginTop:"2rem",display:"flex",gap:"1rem"},children:[g.jsx(He,{type:"rect",width:"180px",height:"48px",style:{borderRadius:"24px"}}),g.jsx(He,{type:"rect",width:"160px",height:"48px",style:{borderRadius:"24px"}})]})]})]})]})]});if(!t)return g.jsx("div",{className:"lf-series-container",style:{color:"white"},children:"Series not found"});const An=ee.getImageUrl(t,"Backdrop"),qi=ee.getImageUrl(t,"Primary"),Ai=ee.getImageUrl(t,"Logo"),Ss=t.People?t.People.slice(0,10):[],Qi=n.find(ce=>ce.Id===h),Xi=[{code:"en",name:"English"},{code:"ja",name:"Japanese"}],_n=[{code:"en",name:"English"},{code:"es",name:"Spanish"},{code:"hu",name:"Hungarian"}];return g.jsxs("div",{className:"lf-series-container",children:[g.jsx(Ra,{alwaysFilled:!0}),g.jsxs("section",{className:`lf-series-hero ${pe?"is-clean-view":""}`,onMouseMove:Rt,onClick:Rt,children:[g.jsx("div",{className:`lf-series-hero__backdrop ${ve?"is-hidden":""}`,style:{backgroundImage:`url('${An}')`}}),g.jsx("div",{className:`lf-series-hero__trailer ${ve?"is-playing":""}`,children:ve&&xt&&g.jsx("iframe",{ref:_s,src:`https://www.youtube.com/embed/${xt}?autoplay=1&mute=0&loop=1&modestbranding=1&rel=0&iv_load_policy=3&fs=0&color=white&controls=0&disablekb=1&playlist=${xt}&enablejsapi=1&origin=${window.location.origin}&widget_referrer=${window.location.origin}`,frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",referrerPolicy:"strict-origin-when-cross-origin",allowFullScreen:!0,title:"Trailer"})}),ve&&g.jsxs("button",{className:"lf-trailer-help-btn",onClick:ce=>{ce.stopPropagation(),_t(!0)},children:[g.jsx("span",{className:"material-icons",children:"help_outline"}),g.jsx("span",{children:"Trouble playing?"})]}),Ai&&g.jsx("img",{className:"lf-series-hero__logo",src:Ai,alt:t.Name}),g.jsxs("div",{className:"lf-series-hero__content",children:[g.jsx("img",{className:"lf-series-hero__poster",src:qi,alt:t.Name}),g.jsxs("div",{className:"lf-series-hero__info",children:[g.jsx("h1",{className:"lf-series-hero__title",children:t.Name}),g.jsxs("div",{className:"lf-series-hero__meta",children:[g.jsx("span",{children:t.ProductionYear}),g.jsx("span",{children:""}),g.jsx("span",{children:t.OfficialRating}),g.jsx("span",{children:""}),g.jsxs("div",{className:"lf-series-hero__rating",children:[g.jsx("span",{className:"material-icons",children:"star"}),g.jsx("span",{children:t.CommunityRating?t.CommunityRating.toFixed(1):""})]})]}),g.jsxs("div",{className:"lf-series-hero__details",children:[g.jsxs("div",{className:"lf-series-hero__description",children:[g.jsx("p",{className:`lf-series-hero__description-text ${w?"is-expanded":""}`,children:t.Overview}),t.Overview&&t.Overview.length>200&&g.jsxs("button",{className:`lf-series-hero__load-more ${w?"is-expanded":""}`,onClick:()=>N(!w),children:[w?"Show Less":"Read More",g.jsx("span",{className:"material-icons",children:"expand_more"})]})]}),Ss.length>0&&g.jsxs("div",{className:"lf-series-hero__cast-info",children:[g.jsxs("div",{style:{marginBottom:8},children:[g.jsx("strong",{children:"Starring: "}),Ss.slice(0,3).map(ce=>ce.Name).join(", "),Ss.length>3&&g.jsx("span",{children:"..."})]}),g.jsxs("div",{children:[g.jsx("strong",{children:"Genres: "}),t.Genres?t.Genres.join(", "):""]})]})]}),g.jsxs("div",{className:"lf-series-hero__actions",children:[g.jsxs("button",{className:"lf-btn lf-btn--primary lf-btn--ring-hover",onClick:()=>{_?De(_.Id):l.length>0&&De(l[0].Id)},children:[g.jsx("span",{className:"material-icons",children:"play_arrow"}),_?_.UserData?.PlaybackPositionTicks>0?`Resume S${_.ParentIndexNumber} E${_.IndexNumber}`:`Continue S${_.ParentIndexNumber} E${_.IndexNumber}`:"Start Watching"]}),g.jsxs("button",{className:"lf-btn lf-btn--glass lf-btn--ring-hover-secondary",onClick:Mt,style:xt?{}:{opacity:.5,pointerEvents:"none"},children:[g.jsx("span",{className:"material-icons",children:ve?"stop_circle":"theaters"}),ve?"Stop Trailer":"Watch Trailer"]}),ve&&g.jsx("button",{className:`lf-btn lf-btn--glass lf-btn--icon-only ${Ve?"is-muted":""}`,onClick:Nt,title:Ve?"Unmute":"Mute",children:g.jsx("span",{className:"material-icons",children:Ve?"volume_off":"volume_up"})}),g.jsx("button",{className:`lf-btn lf-btn--glass lf-btn--icon-only ${Fe?"is-active":""}`,onClick:Wt,title:"Add to List",children:g.jsx("span",{className:"material-icons",children:Fe?"bookmark":"bookmark_border"})}),g.jsx("button",{className:"lf-btn lf-btn--glass lf-btn--icon-only",onClick:()=>T(!0),title:"Edit Subtitles",children:g.jsx("span",{className:"material-icons",children:"subtitles"})})]})]})]})]}),g.jsx("hr",{className:"lf-section-divider"}),g.jsxs("div",{className:"lf-content-section",children:[g.jsxs("div",{className:"lf-episodes-header",children:[g.jsxs("div",{className:`lf-season-selector ${U?"is-open":""}`,ref:ut,children:[g.jsxs("div",{className:"lf-season-selector__button",onClick:()=>D(!U),children:[g.jsx("span",{children:Qi?Qi.Name:"Select Season"}),g.jsx("span",{className:"material-icons",children:"expand_more"})]}),g.jsx("div",{className:"lf-season-selector__dropdown",children:n.map(ce=>g.jsx("div",{className:`lf-season-selector__option ${h===ce.Id?"is-selected":""}`,onClick:()=>{d(ce.Id),D(!1)},children:g.jsx("span",{children:ce.Name})},ce.Id))})]}),g.jsxs("div",{className:"lf-filter-controls",children:[g.jsxs("div",{className:`lf-filter-dropdown ${k?"is-open":""}`,ref:Oe,children:[g.jsxs("button",{className:"lf-filter-btn",onClick:()=>G(!k),title:"Audio & Subtitles",children:[g.jsx("span",{className:"material-icons",children:"subtitles"}),g.jsx("span",{children:"Audio & Subs"}),g.jsx("span",{className:"material-icons",children:"expand_more"})]}),g.jsxs("div",{className:"lf-filter-dropdown__menu lf-lang-menu",children:[g.jsxs("div",{className:"lf-lang-section",children:[g.jsx("div",{className:"lf-dropdown-section-title",children:"Audio"}),Xi.map(ce=>g.jsxs("div",{className:`lf-filter-dropdown__option ${K===ce.code?"is-selected":""}`,onClick:()=>It("audio",ce.code),children:[g.jsx("span",{children:ce.name}),K===ce.code&&g.jsx("span",{className:"material-icons",children:"check"})]},ce.code))]}),g.jsx("div",{className:"lf-lang-separator"}),g.jsxs("div",{className:"lf-lang-section",children:[g.jsx("div",{className:"lf-dropdown-section-title",children:"Subtitles"}),_n.map(ce=>g.jsxs("div",{className:`lf-filter-dropdown__option ${ne===ce.code?"is-selected":""}`,onClick:()=>It("sub",ce.code),children:[g.jsx("span",{children:ce.name}),ne===ce.code&&g.jsx("span",{className:"material-icons",children:"check"})]},ce.code))]}),g.jsx("div",{className:"lf-lang-footer",children:g.jsxs("button",{className:"lf-edit-subs-btn",onClick:()=>{G(!1),T(!0)},children:[g.jsx("span",{className:"material-icons",children:"edit"}),g.jsx("span",{children:"Edit Subtitles"})]})})]})]}),F?g.jsxs(g.Fragment,{children:[g.jsxs("button",{className:"lf-edit-subs-btn",style:{width:"auto",padding:"8px 16px",opacity:E?.6:1},onClick:()=>xs(zs.isPlayed),disabled:E||M.length===0,children:[g.jsx("span",{className:"material-icons",style:E?{animation:"lf-spin 1s linear infinite"}:{},children:E?"sync":zs.icon}),g.jsx("span",{children:E?"Updating":zs.label})]}),g.jsxs("button",{className:"lf-filter-btn",onClick:ss,children:[g.jsx("span",{className:"material-icons",children:"select_all"}),g.jsx("span",{children:l.length>0&&l.every(ce=>M.includes(ce.Id))?"Deselect All":"Select All"})]}),g.jsxs("button",{className:"lf-filter-btn is-active",onClick:$e,title:"Cancel",children:[g.jsx("span",{className:"material-icons",children:"close"}),g.jsx("span",{children:"Cancel"})]})]}):g.jsxs(g.Fragment,{children:[g.jsxs("div",{className:`lf-filter-dropdown ${$?"is-open":""}`,ref:Ye,children:[g.jsxs("button",{className:`lf-filter-btn ${Y!=="all"?"is-active":""}`,onClick:()=>ie(!$),title:"Filter episodes",children:[g.jsx("span",{className:"material-icons",children:"filter_list"}),g.jsx("span",{children:Y==="all"?"Filter":Y==="unwatched"?"Unwatched":"Watched"}),g.jsx("span",{className:"material-icons",children:"expand_more"})]}),g.jsx("div",{className:"lf-filter-dropdown__menu",children:[{key:"all",label:"All"},{key:"unwatched",label:"Unwatched"},{key:"watched",label:"Watched"}].map(ce=>g.jsxs("div",{className:`lf-filter-dropdown__option ${Y===ce.key?"is-selected":""}`,onClick:()=>{le(ce.key),ie(!1)},children:[g.jsx("span",{children:ce.label}),Y===ce.key&&g.jsx("span",{className:"material-icons",children:"check"})]},ce.key))})]}),g.jsxs("div",{className:`lf-filter-dropdown ${fe?"is-open":""}`,ref:mt,children:[g.jsxs("button",{className:`lf-filter-btn ${me!=="default"?"is-active":""}`,onClick:()=>ge(!fe),title:"Sort episodes",children:[g.jsx("span",{className:"material-icons",children:"sort"}),g.jsx("span",{children:me==="default"?"Sort":me==="newest"?"Newest":"Oldest"}),g.jsx("span",{className:"material-icons",children:"expand_more"})]}),g.jsx("div",{className:"lf-filter-dropdown__menu",children:[{key:"default",label:"Default"},{key:"newest",label:"Newest First"},{key:"oldest",label:"Oldest First"}].map(ce=>g.jsxs("div",{className:`lf-filter-dropdown__option ${me===ce.key?"is-selected":""}`,onClick:()=>{P(ce.key),ge(!1)},children:[g.jsx("span",{children:ce.label}),me===ce.key&&g.jsx("span",{className:"material-icons",children:"check"})]},ce.key))})]}),g.jsxs("button",{className:"lf-filter-btn",onClick:$e,title:"Bulk Edit",children:[g.jsx("span",{className:"material-icons",children:"done_all"}),g.jsx("span",{children:"Select Item"})]})]})]})]}),g.jsx("div",{className:"lf-episode-grid",children:li.map(ce=>{const Pe=M.includes(ce.Id),Je=ce.UserData?.Played;return g.jsxs("div",{className:`lf-episode-card ${F?"is-selecting-mode":""} ${Pe?"is-selected":""} ${Je?"is-watched":""}`,onClick:()=>St(ce.Id),onPointerDown:()=>ns(ce.Id),onPointerUp:ri,onPointerLeave:ri,children:[g.jsxs("div",{className:"lf-episode-card__thumbnail",children:[g.jsx("img",{src:ee.getImageUrl(ce,"Primary"),alt:ce.Name,loading:"lazy"}),ce.IndexNumber&&g.jsx("span",{className:"lf-episode-card__badge",children:ce.IndexNumber}),g.jsx("div",{className:"lf-episode-card__play-icon",children:g.jsx("span",{className:"material-icons",children:"play_arrow"})}),g.jsx("div",{className:"lf-episode-checkbox",children:g.jsx("span",{className:"material-icons",children:"check"})}),Je&&!F&&g.jsx("div",{className:"lf-episode-checkbox",style:{opacity:1,background:"#4caf50",borderColor:"#4caf50"},children:g.jsx("span",{className:"material-icons",style:{opacity:1,transform:"scale(1)"},children:"check"})})]}),g.jsxs("div",{className:"lf-episode-card__info",children:[g.jsx("h3",{className:"lf-episode-card__title",children:ce.Name}),g.jsx("p",{className:"lf-episode-card__subtitle",children:ce.Overview})]})]},ce.Id)})})]}),g.jsx("hr",{className:"lf-section-divider"}),Ss.length>0&&g.jsxs("div",{className:"lf-content-section",children:[g.jsx("h2",{className:"lf-section-title",children:"Cast & Crew"}),g.jsx("div",{className:"lf-cast-grid",children:Ss.map(ce=>g.jsxs("div",{className:"lf-cast-card",children:[g.jsx("img",{src:ee.getImageUrl(ce,"Primary")||"https://via.placeholder.com/80x80?text=?",alt:ce.Name,className:"lf-cast-card__image",onError:Pe=>{Pe.target.src="https://via.placeholder.com/80x80?text=?"}}),g.jsx("div",{className:"lf-cast-card__name",children:ce.Name}),g.jsx("div",{className:"lf-cast-card__role",children:ce.Role})]},ce.Id||ce.Name))})]}),g.jsx("hr",{className:"lf-section-divider"}),f.length>0&&g.jsxs("div",{className:"lf-content-section",style:{marginBottom:40},children:[g.jsx("h2",{className:"lf-section-title",children:"More Like This"}),g.jsx("div",{className:"lf-similar-grid",children:f.map(ce=>g.jsxs(_r,{to:`/series/${ce.Id}`,className:"lf-similar-card",children:[g.jsx("img",{className:"lf-similar-card__poster",src:ee.getImageUrl(ce,"Primary"),alt:ce.Name,loading:"lazy"}),g.jsx("div",{className:"lf-similar-card__title",children:ce.Name})]},ce.Id))})]}),g.jsx(Xf,{isOpen:S,onClose:()=>T(!1),seriesId:t?t.Id:"",initialSeasonId:h,initialEpisodeId:l.length>0?l[0].Id:""}),zt&&g.jsx("div",{className:"lf-blocked-modal-overlay",onClick:()=>{_t(!1),is()},children:g.jsxs("div",{className:"lf-blocked-modal",onClick:ce=>ce.stopPropagation(),children:[g.jsx("button",{className:"lf-blocked-modal__close",onClick:()=>{_t(!1),is()},children:g.jsx("span",{className:"material-icons",children:"close"})}),g.jsx("span",{className:"material-icons lf-blocked-icon",children:"error_outline"}),g.jsx("h3",{children:"Playback issue"}),g.jsx("p",{children:"The trailer can't play  your browser's tracking protection or ad blocker is likely blocking the YouTube embed."}),g.jsx("button",{className:"lf-btn lf-btn--glass",onClick:()=>{_t(!1),is()},children:"Got it"})]})})]})},qL=()=>{const{id:i}=nu(),e=As(),[t,s]=C.useState(null),[n,r]=C.useState([]),[l,c]=C.useState(!0),[h,d]=C.useState(!1),[f,p]=C.useState(!1),[v,x]=C.useState(localStorage.getItem("legitflix-audio-pref")||"en"),[S,T]=C.useState(localStorage.getItem("legitflix-sub-pref")||"en"),[E,A]=C.useState(!1),[_,R]=C.useState(!1),[w,N]=C.useState(!1),[U,D]=C.useState(!1),[F,j]=C.useState(!1),[M,H]=C.useState(!1),[K,se]=C.useState(null),[ne,de]=C.useState(!1),[k,G]=C.useState(!1);C.useRef(null);const Y=C.useRef(null),le=C.useRef(null),me=C.useRef(null),P=C.useRef(null);C.useEffect(()=>{(async()=>{c(!0);try{const Fe=await ee.getCurrentUser();if(!Fe)return;const Ze=await ee.getItemDetails(Fe.Id,i);if(s(Ze),de(Ze.UserData?.IsFavorite||!1),G(Ze.UserData?.Played||!1),Ze.RemoteTrailers&&Ze.RemoteTrailers.length>0){const Ye=Ze.RemoteTrailers[0].Url.match(/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/);Ye&&Ye[1]&&se(Ye[1])}const ut=await ee.getSimilarItems(Fe.Id,i);r(ut.Items||[])}catch(Fe){console.error("Failed to load movie data",Fe)}finally{c(!1)}})()},[i]),C.useEffect(()=>{const Le=Fe=>{Y.current&&!Y.current.contains(Fe.target)&&A(!1)};return document.addEventListener("mousedown",Le),()=>document.removeEventListener("mousedown",Le)},[]);const $=(Le,Fe)=>{Le==="audio"?(x(Fe),localStorage.setItem("legitflix-audio-pref",Fe)):(T(Fe),localStorage.setItem("legitflix-sub-pref",Fe)),A(!1)},ie=async()=>{try{const Le=await ee.getCurrentUser(),Fe=!ne;await ee.markFavorite(Le.Id,t.Id,Fe),de(Fe)}catch(Le){console.error("Favorite toggle failed",Le)}},fe=async()=>{try{const Le=await ee.getCurrentUser(),Fe=!k;await ee.markPlayed(Le.Id,t.Id,Fe),G(Fe),s(Ze=>({...Ze,UserData:{...Ze.UserData,Played:Fe}}))}catch(Le){console.error("Played toggle failed",Le)}},ge=()=>{const Le=!w;N(Le);const Fe=Le?"mute":"unMute";P.current?.contentWindow?.postMessage(JSON.stringify({event:"command",func:Fe,args:[]}),"*")},ve=()=>{me.current&&clearTimeout(me.current),me.current=setTimeout(()=>{_&&D(!0)},5e3)},Ne=()=>{D(!1),_&&ve()},pe=()=>{if(_){we();return}R(!0),D(!1),ve();let Le=!1;const Fe=Ze=>{typeof Ze.data=="string"&&(Ze.data.includes('"event"')||Ze.data.includes('"id"'))&&(Le=!0,le.current&&clearTimeout(le.current))};window.addEventListener("message",Fe),window.lfMessageHandler=Fe,le.current=setTimeout(()=>{!Le&&_&&(console.log("Possible block detected: No YT API message received."),j(!0))},4e3)},we=()=>{R(!1),D(!1),j(!1),H(!1),N(!1),me.current&&clearTimeout(me.current),le.current&&clearTimeout(le.current),window.lfMessageHandler&&(window.removeEventListener("message",window.lfMessageHandler),delete window.lfMessageHandler)};if(C.useEffect(()=>()=>{me.current&&clearTimeout(me.current),le.current&&clearTimeout(le.current),window.lfMessageHandler&&window.removeEventListener("message",window.lfMessageHandler)},[]),l)return g.jsx("div",{className:"lf-movie-container",style:{color:"white"},children:"Loading..."});if(!t)return g.jsx("div",{className:"lf-movie-container",style:{color:"white"},children:"Movie not found"});const ot=ee.getImageUrl(t,"Backdrop"),ct=ee.getImageUrl(t,"Primary"),zt=ee.getImageUrl(t,"Logo"),_t=t.People?t.People.slice(0,10):[],xt=[{code:"en",name:"English"},{code:"ja",name:"Japanese"}],os=[{code:"en",name:"English"},{code:"es",name:"Spanish"},{code:"hu",name:"Hungarian"}],Ve=Le=>{if(!Le)return"";const Fe=Math.floor(Le/6e8),Ze=Math.floor(Fe/60),ut=Fe%60;return Ze>0?`${Ze}h ${ut}m`:`${Fe}m`};return g.jsxs("div",{className:"lf-movie-container",children:[g.jsx(Ra,{alwaysFilled:!0}),g.jsxs("section",{className:`lf-movie-hero ${U?"is-clean-view":""}`,onMouseMove:Ne,onClick:Ne,children:[g.jsx("div",{className:`lf-movie-hero__backdrop ${_?"is-hidden":""}`,style:{backgroundImage:`url('${ot}')`}}),g.jsxs("div",{className:`lf-movie-hero__trailer ${_?"is-playing":""}`,children:[_&&K&&g.jsx("iframe",{ref:P,src:`https://www.youtube.com/embed/${K}?autoplay=1&mute=0&loop=1&modestbranding=1&rel=0&iv_load_policy=3&fs=0&color=white&controls=0&disablekb=1&playlist=${K}&enablejsapi=1&origin=${window.location.origin}&widget_referrer=${window.location.origin}`,frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",referrerPolicy:"strict-origin-when-cross-origin",allowFullScreen:!0,title:"Trailer"}),_&&g.jsxs("button",{className:"lf-trailer-help-btn",onClick:Le=>{Le.stopPropagation(),H(!0)},children:[g.jsx("span",{className:"material-icons",children:"help_outline"}),g.jsx("span",{children:"Trouble playing?"})]})]}),zt&&g.jsx("img",{className:"lf-movie-hero__logo",src:zt,alt:t.Name}),g.jsxs("div",{className:"lf-movie-hero__content",children:[g.jsx("img",{className:"lf-movie-hero__poster",src:ct,alt:t.Name}),g.jsxs("div",{className:"lf-movie-hero__info",children:[g.jsx("h1",{className:"lf-movie-hero__title",children:t.Name}),g.jsxs("div",{className:"lf-movie-hero__meta",children:[g.jsx("span",{children:t.ProductionYear}),g.jsx("span",{children:""}),g.jsx("span",{children:t.OfficialRating}),g.jsx("span",{children:""}),g.jsx("span",{children:Ve(t.RunTimeTicks)}),g.jsx("span",{children:""}),g.jsxs("div",{className:"lf-movie-hero__rating",children:[g.jsx("span",{className:"material-icons",children:"star"}),g.jsx("span",{children:t.CommunityRating?t.CommunityRating.toFixed(1):""})]})]}),g.jsxs("div",{className:"lf-movie-hero__details",children:[g.jsxs("div",{className:"lf-movie-hero__description",children:[g.jsx("p",{className:`lf-movie-hero__description-text ${f?"is-expanded":""}`,children:t.Overview}),t.Overview&&t.Overview.length>200&&g.jsxs("button",{className:`lf-movie-hero__load-more ${f?"is-expanded":""}`,onClick:()=>p(!f),children:[f?"Show Less":"Read More",g.jsx("span",{className:"material-icons",children:"expand_more"})]})]}),_t.length>0&&g.jsxs("div",{className:"lf-movie-hero__cast-info",children:[g.jsxs("div",{style:{marginBottom:8},children:[g.jsx("strong",{children:"Starring: "}),_t.slice(0,3).map(Le=>Le.Name).join(", "),_t.length>3&&g.jsx("span",{children:"..."})]}),g.jsxs("div",{children:[g.jsx("strong",{children:"Genres: "}),t.Genres?t.Genres.join(", "):""]})]})]}),g.jsxs("div",{className:"lf-movie-hero__actions",children:[g.jsxs("button",{className:"lf-btn lf-btn--primary lf-btn--ring-hover",onClick:()=>e(`/play/${t.Id}`),children:[g.jsx("span",{className:"material-icons",children:"play_arrow"}),"Start Watching"]}),g.jsxs("button",{className:"lf-btn lf-btn--glass lf-btn--ring-hover-secondary",onClick:pe,style:K?{}:{opacity:.5,pointerEvents:"none"},children:[g.jsx("span",{className:"material-icons",children:_?"stop_circle":"theaters"}),_?"Stop Trailer":"Watch Trailer"]}),_&&g.jsx("button",{className:`lf-btn lf-btn--glass lf-btn--icon-only ${w?"is-muted":""}`,onClick:ge,title:w?"Unmute":"Mute",children:g.jsx("span",{className:"material-icons",children:w?"volume_off":"volume_up"})}),g.jsx("button",{className:`lf-btn lf-btn--glass lf-btn--icon-only ${ne?"is-active":""}`,onClick:ie,title:"Add to List",children:g.jsx("span",{className:"material-icons",children:ne?"bookmark":"bookmark_border"})}),g.jsx("button",{className:"lf-btn lf-btn--glass lf-btn--icon-only",onClick:()=>d(!0),title:"Edit Subtitles",children:g.jsx("span",{className:"material-icons",children:"subtitles"})})]})]})]})]}),g.jsx("hr",{className:"lf-section-divider"}),g.jsxs("div",{className:"lf-content-section",id:"lfDirectPlayer",children:[g.jsxs("div",{className:"lf-section-header",children:[g.jsx("h2",{className:"lf-section-title",children:t.Name}),g.jsxs("div",{className:"lf-filter-controls",children:[g.jsxs("div",{className:`lf-filter-dropdown ${E?"is-open":""}`,ref:Y,children:[g.jsxs("button",{className:"lf-filter-btn",onClick:()=>A(!E),title:"Audio & Subtitles",children:[g.jsx("span",{className:"material-icons",children:"subtitles"}),g.jsx("span",{children:"Audio & Subs"}),g.jsx("span",{className:"material-icons",children:"expand_more"})]}),g.jsxs("div",{className:"lf-filter-dropdown__menu lf-lang-menu",children:[g.jsxs("div",{className:"lf-lang-section",children:[g.jsx("div",{className:"lf-dropdown-section-title",children:"Audio"}),xt.map(Le=>g.jsxs("div",{className:`lf-filter-dropdown__option ${v===Le.code?"is-selected":""}`,onClick:()=>$("audio",Le.code),children:[g.jsx("span",{children:Le.name}),v===Le.code&&g.jsx("span",{className:"material-icons",children:"check"})]},Le.code))]}),g.jsx("div",{className:"lf-lang-separator"}),g.jsxs("div",{className:"lf-lang-section",children:[g.jsx("div",{className:"lf-dropdown-section-title",children:"Subtitles"}),os.map(Le=>g.jsxs("div",{className:`lf-filter-dropdown__option ${S===Le.code?"is-selected":""}`,onClick:()=>$("sub",Le.code),children:[g.jsx("span",{children:Le.name}),S===Le.code&&g.jsx("span",{className:"material-icons",children:"check"})]},Le.code))]}),g.jsx("div",{className:"lf-lang-footer",children:g.jsxs("button",{className:"lf-edit-subs-btn",onClick:()=>{A(!1),d(!0)},children:[g.jsx("span",{className:"material-icons",children:"edit"}),g.jsx("span",{children:"Edit Subtitles"})]})})]})]}),g.jsxs("button",{className:"lf-filter-btn",onClick:fe,title:k?"Mark as Unwatched":"Mark as Watched",children:[g.jsx("span",{className:"material-icons",children:k?"visibility_off":"visibility"}),g.jsx("span",{children:k?"Mark Unwatched":"Mark Watched"})]})]})]}),g.jsx("div",{className:"lf-movie-player-main",children:g.jsxs("div",{className:"lf-movie-player-placeholder",children:[g.jsx("span",{className:"material-icons",style:{fontSize:"64px",opacity:.5},children:"play_circle_outline"}),g.jsx("p",{style:{marginTop:"10px",fontWeight:500},children:"Click 'Start Watching' to play movie"})]})})]}),g.jsx("hr",{className:"lf-section-divider"}),_t.length>0&&g.jsxs("div",{className:"lf-content-section",children:[g.jsx("h2",{className:"lf-section-title",children:"Cast & Crew"}),g.jsx("div",{className:"lf-cast-grid",children:_t.map(Le=>g.jsxs("div",{className:"lf-cast-card",children:[g.jsx("img",{src:ee.getImageUrl(Le,"Primary")||"https://via.placeholder.com/80x80?text=?",alt:Le.Name,className:"lf-cast-card__image",onError:Fe=>{Fe.target.src="https://via.placeholder.com/80x80?text=?"}}),g.jsx("div",{className:"lf-cast-card__name",children:Le.Name}),g.jsx("div",{className:"lf-cast-card__role",children:Le.Role})]},Le.Id||Le.Name))})]}),g.jsx("hr",{className:"lf-section-divider"}),n.length>0&&g.jsxs("div",{className:"lf-content-section",style:{marginBottom:40},children:[g.jsx("h2",{className:"lf-section-title",children:"More Like This"}),g.jsx("div",{className:"lf-similar-grid",children:n.map(Le=>g.jsxs(_r,{to:`/movie/${Le.Id}`,className:"lf-similar-card",children:[g.jsx("img",{className:"lf-similar-card__poster",src:ee.getImageUrl(Le,"Primary"),alt:Le.Name,loading:"lazy"}),g.jsx("div",{className:"lf-similar-card__title",children:Le.Name})]},Le.Id))})]}),g.jsx(Xf,{isOpen:h,onClose:()=>d(!1),seriesId:t?t.Id:"",initialSeasonId:null,initialEpisodeId:t?t.Id:"",isMovie:!0}),M&&g.jsx("div",{className:"lf-blocked-modal-overlay",children:g.jsxs("div",{className:"lf-blocked-modal",children:[g.jsx("span",{className:"material-icons lf-blocked-icon",children:"block"}),g.jsx("h3",{children:"Content blocked by browser"}),g.jsx("p",{children:"The trailer cannot be played because your browser blocked it. This usually happens due to tracking protection or ad blockers affecting the YouTube player."}),g.jsx("button",{className:"lf-btn lf-btn--primary",onClick:()=>{H(!1),we()},children:"Close"})]})})]})},QL=[{id:"details",label:"My details"},{id:"display",label:"Display"},{id:"home",label:"Home Screen"},{id:"playback",label:"Playback"},{id:"subtitles",label:"Subtitles"},{id:"quickconnect",label:"Quick Connect"},{id:"advanced",label:"Advanced"}],XL=()=>{As();const[i,e]=C.useState(null),[t,s]=C.useState("details"),[n,r]=C.useState(""),[l,c]=C.useState(!1),[h,d]=C.useState(!1),[f,p]=C.useState(!1),[v,x]=C.useState(""),[S,T]=C.useState(""),[E,A]=C.useState(""),[_,R]=C.useState(null),[w,N]=C.useState(!1),[U,D]=C.useState("en-US"),[F,j]=C.useState("default"),[M,H]=C.useState(""),[K,se]=C.useState(""),[ne,de]=C.useState("Default"),[k,G]=C.useState(""),[Y,le]=C.useState("Default"),[me,P]=C.useState(""),[$,ie]=C.useState(null),[fe,ge]=C.useState([{id:"resume",label:"Continue Watching",enabled:!0},{id:"latestMedia",label:"Latest Media",enabled:!0},{id:"nextUp",label:"Next Up",enabled:!0},{id:"favorites",label:"My Favorites",enabled:!0}]);C.useEffect(()=>{(async()=>{const Ye=await ee.getCurrentUser();if(Ye){e(Ye);const mt=Ye.Configuration||{};mt.AudioLanguagePreference&&H(mt.AudioLanguagePreference),mt.SubtitleLanguagePreference&&G(mt.SubtitleLanguagePreference),mt.SubtitleMode&&le(mt.SubtitleMode);const st=localStorage.getItem(`LegitFlix_Banner_${Ye.Id}`);st?r(st):Ye.ImageTags&&Ye.ImageTags.Banner?r(`${ee.api.basePath}/Users/${Ye.Id}/Images/Banner?tag=${Ye.ImageTags.Banner}&quality=90`):Ye.BackdropImageTags&&Ye.BackdropImageTags.length>0&&r(`${ee.api.basePath}/Users/${Ye.Id}/Images/Backdrop/0?tag=${Ye.BackdropImageTags[0]}&quality=90`)}})()},[]);const ve=Oe=>{i&&(localStorage.setItem(`LegitFlix_Banner_${i.Id}`,Oe),r(Oe))},Ne=async Oe=>{if(!(!Oe||!i))try{await ee.uploadUserImage(i.Id,"Primary",Oe),e(mt=>({...mt,PrimaryImageTag:Date.now().toString()}));const Ye=await ee.getCurrentUser();Ye&&e(Ye),d(!1)}catch(Ye){console.error("Failed to upload avatar",Ye)}},pe=async Oe=>{if(Oe.preventDefault(),R(null),S!==E){R({type:"error",text:"New passwords do not match."});return}if(!S){R({type:"error",text:"New password cannot be empty."});return}N(!0);try{await ee.updatePassword(i.Id,v,S),R({type:"success",text:"Password updated successfully!"}),x(""),T(""),A("")}catch(Ye){R({type:"error",text:Ye.message||"Failed to update password."})}finally{N(!1)}},we=async()=>{if(ie(null),!me.trim()){ie({type:"error",text:"Please enter a code."});return}try{await ee.quickConnect(me.trim()),ie({type:"success",text:"Device authorized successfully!"}),P("")}catch(Oe){ie({type:"error",text:Oe.message||"Authorization failed."})}},ot=Oe=>{ge(Ye=>Ye.map(mt=>mt.id===Oe?{...mt,enabled:!mt.enabled}:mt))},ct=async()=>{await ee.logout()};if(!i)return g.jsxs("div",{className:"profile-page",children:[g.jsx(Ra,{}),g.jsxs("div",{className:"settings-container",children:[g.jsx(He,{type:"text",width:"200px",height:"32px",style:{marginBottom:"20px"}}),g.jsx("div",{className:"settings-tabs",children:[1,2,3,4,5,6].map(Oe=>g.jsx(He,{width:"100px",height:"40px",style:{display:"inline-block",marginRight:"8px",borderRadius:"20px"}},Oe))}),g.jsx(He,{width:"100%",height:"250px",style:{margin:"20px 0",borderRadius:"12px"}}),g.jsx("div",{style:{display:"flex",gap:"20px",marginTop:"-55px",paddingLeft:"30px",position:"relative",marginBottom:"28px"},children:g.jsx(He,{type:"circle",width:"110px",height:"110px",style:{border:"4px solid #0e0e0e"}})}),g.jsxs("div",{className:"settings-card",style:{padding:"28px",border:"1px solid rgba(255,255,255,0.05)",borderRadius:"14px"},children:[g.jsx(He,{width:"180px",height:"24px",style:{marginBottom:"24px"}}),g.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(180px, 1fr))",gap:"18px"},children:[1,2,3,4].map(Oe=>g.jsxs("div",{children:[g.jsx(He,{width:"80px",height:"14px",style:{marginBottom:"8px"}}),g.jsx(He,{width:"140px",height:"20px"})]},Oe))})]})]})]});const zt=i.PrimaryImageTag?`${ee.api.basePath}/Users/${i.Id}/Images/Primary?tag=${i.PrimaryImageTag}&quality=90`:null,_t=()=>g.jsxs(g.Fragment,{children:[g.jsxs("div",{className:"settings-card",children:[g.jsx("h3",{className:"settings-card-title",children:"User Information"}),g.jsxs("div",{className:"info-grid",children:[g.jsxs("div",{className:"info-item",children:[g.jsx("label",{children:"Username"}),g.jsx("div",{className:"info-value",children:i.Name})]}),g.jsxs("div",{className:"info-item",children:[g.jsx("label",{children:"Last Login"}),g.jsx("div",{className:"info-value",children:i.LastLoginDate?new Date(i.LastLoginDate).toLocaleDateString():""})]}),g.jsxs("div",{className:"info-item",children:[g.jsx("label",{children:"Administrator"}),g.jsx("div",{className:"info-value",children:i.Policy?.IsAdministrator?"Yes":"No"})]}),g.jsxs("div",{className:"info-item",children:[g.jsx("label",{children:"User ID"}),g.jsx("div",{className:"info-value info-value-small",children:i.Id})]})]})]}),g.jsxs("div",{className:"settings-card",children:[g.jsx("h3",{className:"settings-card-title",children:"Change Password"}),g.jsxs("form",{className:"password-form",onSubmit:pe,children:[g.jsxs("div",{className:"form-group",children:[g.jsx("label",{children:"Current Password"}),g.jsx("input",{type:"password",value:v,onChange:Oe=>x(Oe.target.value),className:"settings-input",autoComplete:"current-password"})]}),g.jsxs("div",{className:"form-group",children:[g.jsx("label",{children:"New Password"}),g.jsx("input",{type:"password",value:S,onChange:Oe=>T(Oe.target.value),className:"settings-input",autoComplete:"new-password"})]}),g.jsxs("div",{className:"form-group",children:[g.jsx("label",{children:"Confirm New Password"}),g.jsx("input",{type:"password",value:E,onChange:Oe=>A(Oe.target.value),className:"settings-input",autoComplete:"new-password"})]}),_&&g.jsxs("div",{className:`form-message ${_.type}`,children:[g.jsx("span",{className:"material-icons",children:_.type==="success"?"check_circle":"error"}),_.text]}),g.jsx("button",{type:"submit",className:"btn-accent",disabled:w,children:w?"SAVING...":"SAVE PASSWORD"})]})]})]}),xt=()=>g.jsxs("div",{className:"settings-card",children:[g.jsx("h3",{className:"settings-card-title",children:"Display Preferences"}),g.jsxs("div",{className:"form-group",children:[g.jsx("label",{children:"Display Language"}),g.jsxs("select",{className:"settings-select",value:U,onChange:Oe=>D(Oe.target.value),children:[g.jsx("option",{value:"en-US",children:"English (United States)"}),g.jsx("option",{value:"hu",children:"Magyar (Hungarian)"}),g.jsx("option",{value:"de",children:"Deutsch (German)"}),g.jsx("option",{value:"fr",children:"Franais (French)"}),g.jsx("option",{value:"es",children:"Espaol (Spanish)"}),g.jsx("option",{value:"ja",children:" (Japanese)"})]})]}),g.jsxs("div",{className:"form-group",children:[g.jsx("label",{children:"Date Format"}),g.jsxs("select",{className:"settings-select",value:F,onChange:Oe=>j(Oe.target.value),children:[g.jsx("option",{value:"default",children:"Use browser default"}),g.jsx("option",{value:"yyyy-MM-dd",children:"YYYY-MM-DD"}),g.jsx("option",{value:"dd/MM/yyyy",children:"DD/MM/YYYY"}),g.jsx("option",{value:"MM/dd/yyyy",children:"MM/DD/YYYY"})]})]}),g.jsxs("div",{className:"setting-row",children:[g.jsxs("div",{className:"setting-row-label",children:[g.jsx("span",{children:"Enable LegitFlix Theme"}),g.jsx("span",{className:"setting-hint",children:"Use the custom gaming profile theme"})]}),g.jsxs("label",{className:"toggle-switch",children:[g.jsx("input",{type:"checkbox",defaultChecked:!0}),g.jsx("span",{className:"slider"})]})]})]}),os=()=>g.jsxs("div",{className:"settings-card",children:[g.jsx("h3",{className:"settings-card-title",children:"Home Screen Sections"}),g.jsx("p",{className:"settings-description",children:"Choose which sections to display on your home screen."}),fe.map(Oe=>g.jsxs("div",{className:"setting-row",children:[g.jsx("div",{className:"setting-row-label",children:g.jsx("span",{children:Oe.label})}),g.jsxs("label",{className:"toggle-switch",children:[g.jsx("input",{type:"checkbox",checked:Oe.enabled,onChange:()=>ot(Oe.id)}),g.jsx("span",{className:"slider"})]})]},Oe.id))]}),Ve=()=>g.jsxs("div",{className:"settings-card",children:[g.jsx("h3",{className:"settings-card-title",children:"Playback Settings"}),g.jsxs("div",{className:"form-group",children:[g.jsx("label",{children:"Preferred Audio Language"}),g.jsxs("select",{className:"settings-select",value:M,onChange:Oe=>H(Oe.target.value),children:[g.jsx("option",{value:"",children:"Auto / Server Default"}),g.jsx("option",{value:"eng",children:"English"}),g.jsx("option",{value:"hun",children:"Hungarian"}),g.jsx("option",{value:"jpn",children:"Japanese"}),g.jsx("option",{value:"ger",children:"German"}),g.jsx("option",{value:"fre",children:"French"}),g.jsx("option",{value:"spa",children:"Spanish"})]})]}),g.jsxs("div",{className:"form-group",children:[g.jsx("label",{children:"Max Streaming Bitrate"}),g.jsxs("select",{className:"settings-select",value:K,onChange:Oe=>se(Oe.target.value),children:[g.jsx("option",{value:"",children:"Auto"}),g.jsx("option",{value:"120000000",children:"120 Mbps (4K)"}),g.jsx("option",{value:"80000000",children:"80 Mbps"}),g.jsx("option",{value:"60000000",children:"60 Mbps"}),g.jsx("option",{value:"40000000",children:"40 Mbps"}),g.jsx("option",{value:"20000000",children:"20 Mbps (1080p)"}),g.jsx("option",{value:"8000000",children:"8 Mbps (720p)"}),g.jsx("option",{value:"4000000",children:"4 Mbps"}),g.jsx("option",{value:"2000000",children:"2 Mbps"})]})]}),g.jsxs("div",{className:"setting-row",children:[g.jsxs("div",{className:"setting-row-label",children:[g.jsx("span",{children:"Prefer fMP4-HLS Container"}),g.jsx("span",{className:"setting-hint",children:"Uses fMP4 container for HLS playback when available"})]}),g.jsxs("label",{className:"toggle-switch",children:[g.jsx("input",{type:"checkbox",defaultChecked:!1}),g.jsx("span",{className:"slider"})]})]}),g.jsxs("div",{className:"setting-row",children:[g.jsxs("div",{className:"setting-row-label",children:[g.jsx("span",{children:"Enable Cinema Mode"}),g.jsx("span",{className:"setting-hint",children:"Play trailers and custom intros before the main feature"})]}),g.jsxs("label",{className:"toggle-switch",children:[g.jsx("input",{type:"checkbox",defaultChecked:!0}),g.jsx("span",{className:"slider"})]})]})]}),Le=()=>g.jsxs("div",{className:"settings-card",children:[g.jsx("h3",{className:"settings-card-title",children:"Subtitle Preferences"}),g.jsxs("div",{className:"form-group",children:[g.jsx("label",{children:"Preferred Subtitle Language"}),g.jsxs("select",{className:"settings-select",value:k,onChange:Oe=>G(Oe.target.value),children:[g.jsx("option",{value:"",children:"None"}),g.jsx("option",{value:"eng",children:"English"}),g.jsx("option",{value:"hun",children:"Hungarian"}),g.jsx("option",{value:"jpn",children:"Japanese"}),g.jsx("option",{value:"ger",children:"German"}),g.jsx("option",{value:"fre",children:"French"}),g.jsx("option",{value:"spa",children:"Spanish"})]})]}),g.jsxs("div",{className:"form-group",children:[g.jsx("label",{children:"Subtitle Mode"}),g.jsxs("select",{className:"settings-select",value:Y,onChange:Oe=>le(Oe.target.value),children:[g.jsx("option",{value:"Default",children:"Default"}),g.jsx("option",{value:"Always",children:"Always Show"}),g.jsx("option",{value:"OnlyForced",children:"Only Forced"}),g.jsx("option",{value:"None",children:"None"}),g.jsx("option",{value:"Smart",children:"Smart (match audio)"})]})]}),g.jsxs("div",{className:"setting-row",children:[g.jsxs("div",{className:"setting-row-label",children:[g.jsx("span",{children:"Burn in Subtitles"}),g.jsx("span",{className:"setting-hint",children:"Permanently render subtitles into the video stream"})]}),g.jsxs("label",{className:"toggle-switch",children:[g.jsx("input",{type:"checkbox",defaultChecked:!1}),g.jsx("span",{className:"slider"})]})]})]}),Fe=()=>g.jsxs("div",{className:"settings-card",children:[g.jsx("h3",{className:"settings-card-title",children:"Quick Connect"}),g.jsx("p",{className:"settings-description",children:"Enter the code displayed on your device to authorize it with your account."}),g.jsxs("div",{className:"qc-row",children:[g.jsx("input",{type:"text",className:"settings-input qc-input",placeholder:"Enter code",value:me,onChange:Oe=>P(Oe.target.value),maxLength:10}),g.jsx("button",{className:"btn-accent",onClick:we,children:"AUTHORIZE"})]}),$&&g.jsxs("div",{className:`form-message ${$.type}`,style:{marginTop:"12px"},children:[g.jsx("span",{className:"material-icons",children:$.type==="success"?"check_circle":"error"}),$.text]})]}),Ze=()=>g.jsxs("div",{className:"settings-card",children:[g.jsx("h3",{className:"settings-card-title",children:"Advanced"}),i.Policy?.IsAdministrator&&g.jsxs("button",{className:"btn-link-row",onClick:()=>window.location.href="/web/index.html#!/dashboard",children:[g.jsx("span",{className:"material-icons",children:"dashboard"}),g.jsxs("div",{children:[g.jsx("span",{children:"Server Dashboard"}),g.jsx("span",{className:"setting-hint",children:"Manage server settings, users, and libraries"})]}),g.jsx("span",{className:"material-icons link-arrow",children:"chevron_right"})]}),g.jsxs("button",{className:"btn-link-row",onClick:()=>window.location.href="/web/index.html#!/playback/profile",children:[g.jsx("span",{className:"material-icons",children:"tune"}),g.jsxs("div",{children:[g.jsx("span",{children:"Playback Profiles"}),g.jsx("span",{className:"setting-hint",children:"Configure device playback profiles"})]}),g.jsx("span",{className:"material-icons link-arrow",children:"chevron_right"})]}),g.jsxs("button",{className:"btn-link-row",onClick:()=>window.location.href="/web/index.html#!/networking",children:[g.jsx("span",{className:"material-icons",children:"lan"}),g.jsxs("div",{children:[g.jsx("span",{children:"Networking"}),g.jsx("span",{className:"setting-hint",children:"Server networking and remote access settings"})]}),g.jsx("span",{className:"material-icons link-arrow",children:"chevron_right"})]}),g.jsxs("button",{className:"btn-link-row",onClick:()=>window.location.href="/web/index.html#!/mypreferencesmenu",children:[g.jsx("span",{className:"material-icons",children:"settings_applications"}),g.jsxs("div",{children:[g.jsx("span",{children:"Classic User Settings"}),g.jsx("span",{className:"setting-hint",children:"Open the default Jellyfin user preferences"})]}),g.jsx("span",{className:"material-icons link-arrow",children:"chevron_right"})]}),i.Policy?.IsAdministrator&&g.jsxs("button",{className:"btn-link-row",onClick:()=>window.location.href="/web/index.html#!/plugins",children:[g.jsx("span",{className:"material-icons",children:"extension"}),g.jsxs("div",{children:[g.jsx("span",{children:"Plugins"}),g.jsx("span",{className:"setting-hint",children:"Manage installed plugins"})]}),g.jsx("span",{className:"material-icons link-arrow",children:"chevron_right"})]}),g.jsx("div",{className:"dropdown-divider",style:{margin:"16px 0",borderColor:"rgba(255,255,255,0.05)"}}),g.jsxs("button",{className:"btn-link-row",onClick:()=>p(!0),children:[g.jsx("span",{className:"material-icons",children:"palette"}),g.jsxs("div",{children:[g.jsx("span",{children:"LegitFlix Settings"}),g.jsx("span",{className:"setting-hint",children:"Customize theme colors and logo"})]}),g.jsx("span",{className:"material-icons link-arrow",children:"chevron_right"})]})]}),ut=()=>{switch(t){case"details":return _t();case"display":return xt();case"home":return os();case"playback":return Ve();case"subtitles":return Le();case"quickconnect":return Fe();case"advanced":return Ze();default:return null}};return g.jsxs("div",{className:"profile-page",children:[g.jsx(Ra,{}),g.jsxs("div",{className:"settings-container",children:[g.jsx("h1",{className:"settings-page-title",children:"Account Settings"}),g.jsxs("div",{className:"settings-tabs",children:[QL.map(Oe=>g.jsx("button",{className:`settings-tab ${t===Oe.id?"active":""}`,onClick:()=>s(Oe.id),children:Oe.label},Oe.id)),g.jsx("button",{className:"settings-tab settings-tab-logout",onClick:ct,title:"Sign Out",children:g.jsx("span",{className:"material-icons",children:"exit_to_app"})})]}),g.jsxs("div",{className:`settings-banner ${n?"has-banner":""}`,style:n?{backgroundImage:`url('${n}')`}:{},children:[g.jsx("div",{className:"banner-overlay"}),g.jsxs("div",{className:"banner-edit-btn",onClick:()=>c(!0),children:[g.jsx("span",{className:"material-icons-outlined",children:n?"edit":"add_photo_alternate"}),g.jsx("span",{children:n?"Change profile banner":"Add profile banner"})]})]}),g.jsxs("div",{className:"settings-avatar-wrap",children:[g.jsx("div",{className:"settings-avatar",style:zt?{backgroundImage:`url('${zt}')`}:{},children:!zt&&g.jsx("span",{className:"material-icons avatar-placeholder",children:"person"})}),g.jsx("div",{className:"avatar-edit-badge",title:"Change avatar",onClick:()=>d(!0),children:g.jsx("span",{className:"material-icons",children:"edit"})})]}),g.jsx("div",{className:"settings-content",children:ut()})]}),g.jsx(Qf,{isOpen:l,onClose:()=>c(!1),onSave:ve,userId:i?.Id}),g.jsx(fS,{isOpen:f,onClose:()=>p(!1),userId:i?.Id}),g.jsx(du,{isOpen:h,onClose:()=>d(!1),onSave:Ne,userId:i?.Id})]})},WL=()=>{const i=As(),{config:e}=Yi(),[t,s]=C.useState(window.location.origin),[n,r]=C.useState(!1),[l,c]=C.useState(""),h=async d=>{d.preventDefault(),r(!0),c("");try{const f=await ee.validateServer(t);f&&f.valid?(ee.initialize(null,f.baseUrl),i("/login/select-user")):c("Could not connect to server. Please check the URL.")}catch(f){console.error("Validation error",f),c("An error occurred while connecting.")}finally{r(!1)}};return g.jsx("div",{className:"auth-page",children:g.jsxs("div",{className:"auth-container",children:[g.jsxs("div",{className:"auth-logo",children:[e.logoUrl?g.jsx("img",{src:e.logoUrl,alt:"LegitFlix",className:"auth-logo-img"}):g.jsx("img",{src:Vl(e.accentColor),alt:"LegitFlix",className:"auth-logo-img"}),g.jsx("p",{children:"Connect to Server"})]}),g.jsxs("form",{onSubmit:h,className:"auth-form",children:[g.jsxs("div",{className:"form-group",children:[g.jsx("label",{children:"Server URL"}),g.jsx("input",{type:"text",className:"auth-input",value:t,onChange:d=>s(d.target.value),placeholder:"http://myserver:8096"})]}),l&&g.jsx("div",{className:"auth-error",children:l}),g.jsx(ii,{type:"submit",variant:"ringHover",size:"lg",disabled:n,className:"w-full",children:n?"Connecting...":"Connect"})]})]})})},ZL=()=>{const i=As(),{config:e}=Yi(),[t,s]=C.useState([]),[n,r]=C.useState(!0);C.useEffect(()=>{(async()=>{try{const f=await ee.getPublicUsers();f&&s(f)}catch(f){console.error("Failed to load users",f)}finally{r(!1)}})()},[]);const l=d=>{i("/login",{state:{username:d.Name,userId:d.Id}})},c=()=>{i("/login")},h=()=>{i("/login/select-server")};return g.jsx("div",{className:"auth-page",children:g.jsxs("div",{className:"auth-container",children:[g.jsxs("div",{className:"auth-logo",children:[e.logoUrl?g.jsx("img",{src:e.logoUrl,alt:"LegitFlix",className:"auth-logo-img"}):g.jsx("img",{src:Vl(e.accentColor),alt:"LegitFlix",className:"auth-logo-img"}),g.jsx("p",{children:"Who's watching?"})]}),n?g.jsx("div",{className:"user-grid",children:[1,2,3].map(d=>g.jsxs("div",{className:"user-card",style:{cursor:"default"},children:[g.jsx("div",{className:"user-avatar-container",style:{border:"none",padding:0},children:g.jsx(He,{type:"circle",width:"100px",height:"100px"})}),g.jsx(He,{type:"text",width:"80px",height:"20px",style:{marginTop:"10px"}})]},d))}):g.jsxs(g.Fragment,{children:[g.jsx("div",{className:"user-grid",children:t.map(d=>g.jsxs("button",{className:"user-card",onClick:()=>l(d),children:[g.jsxs("div",{className:"user-avatar-container",children:[g.jsx("div",{className:"auth-avatar-wrapper",children:g.jsx("img",{src:`${ee.api.basePath||""}/Users/${d.Id}/Images/Primary?quality=90`,alt:d.Name,className:"auth-avatar",onError:f=>{f.target.style.display="none",f.target.parentElement.nextSibling.style.display="flex"}})}),g.jsx("div",{className:"user-avatar-placeholder",style:{display:"none"},children:g.jsx("span",{className:"material-icons",children:"person"})})]}),g.jsx("span",{className:"user-card-name",children:d.Name})]},d.Id))}),g.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"10px",alignItems:"center"},children:[g.jsx("button",{className:"text-link",onClick:c,children:"Manual Login"}),g.jsx("button",{className:"text-link",style:{fontSize:"0.8rem",opacity:.7},onClick:h,children:"Switch Server"})]})]})]})})},JL=()=>{const i=As(),e=En(),{config:t}=Yi(),s=e.state?.username||"",[n,r]=C.useState(s),[l,c]=C.useState(""),[h,d]=C.useState(!1),[f,p]=C.useState(""),[v,x]=C.useState(!1),[S,T]=C.useState(""),[E,A]=C.useState("");C.useEffect(()=>{let R;return v?(async()=>{try{d(!0);const N=await ee.initiateQuickConnect();T(N.Code),A(N.Secret),d(!1),R=setInterval(async()=>{if(N.Secret)try{await ee.checkQuickConnectStatus(N.Secret)&&(clearInterval(R),i("/"))}catch(U){console.warn("Polling error",U)}},2e3)}catch(N){console.error("Quick Connect Init Failed",N),p("Failed to initialize Quick Connect."),d(!1)}})():(T(""),A(""),R&&clearInterval(R)),()=>{R&&clearInterval(R)}},[v,i]);const _=async R=>{R.preventDefault(),d(!0),p("");try{await ee.authenticateUser(n,l),await ee.getCurrentUser()?i("/"):p("Login succeeded but failed to retrieve user session.")}catch(w){console.error("Login error",w),p("Invalid username or password.")}finally{d(!1)}};return g.jsx("div",{className:"auth-page",children:g.jsxs("div",{className:"auth-container",children:[g.jsxs("div",{className:"auth-logo",children:[t.logoUrl?g.jsx("img",{src:t.logoUrl,alt:"LegitFlix",className:"auth-logo-img"}):g.jsx("img",{src:Vl(t.accentColor),alt:"LegitFlix",className:"auth-logo-img"}),g.jsx("p",{children:v?"Quick Connect":"Sign In"})]}),v?g.jsxs("div",{className:"qc-container",children:[h?g.jsx("div",{className:"qc-spinner"}):g.jsxs(g.Fragment,{children:[g.jsx("div",{className:"qc-instructions",children:"Use your mobile device to scan the code or enter it manually."}),g.jsx("div",{className:"qc-code-display",children:S}),g.jsx("div",{className:"qc-instructions",children:"Waiting for authorization..."}),g.jsx("div",{className:"qc-spinner"})]}),g.jsx("button",{type:"button",className:"text-link",onClick:()=>x(!1),children:"Cancel"})]}):g.jsxs("form",{onSubmit:_,className:"auth-form",children:[g.jsxs("div",{className:"form-group",children:[g.jsx("label",{children:"Username"}),g.jsx("input",{type:"text",className:"auth-input",value:n,onChange:R=>r(R.target.value),placeholder:"Enter username"})]}),g.jsxs("div",{className:"form-group",children:[g.jsx("label",{children:"Password"}),g.jsx("input",{type:"password",className:"auth-input",value:l,onChange:R=>c(R.target.value),placeholder:"Enter password"})]}),f&&g.jsx("div",{className:"auth-error",children:f}),g.jsxs("div",{className:"auth-btn-group",children:[g.jsx(ii,{type:"submit",variant:"ringHover",size:"lg",disabled:h,className:"w-full",children:h?"Signing in...":"Sign In"}),g.jsx(ii,{type:"button",variant:"outline",size:"lg",onClick:()=>x(!0),className:"w-full",children:"Quick Connect"})]}),g.jsx("button",{type:"button",className:"text-link",onClick:()=>i("/login/select-user"),children:"Back to Users"})]})]})})},e1=()=>{const[i,e]=C.useState(null);return C.useEffect(()=>{(async()=>{try{const s=await ee.getCurrentUser();e(!!s)}catch(s){console.error("Auth check failed",s),e(!1)}})()},[]),i===null?g.jsx("div",{style:{padding:"20px"},children:g.jsx(He,{width:"100%",height:"100vh"})}):i?g.jsx(d_,{}):g.jsx(u_,{to:"/login/select-user",replace:!0})},t1=()=>{const i=As();return C.useEffect(()=>{const e=window.location.hash;if(e.startsWith("#!/")){if(e==="#!/"||e==="#!/home"||e==="#!/home.html")return;if(console.log("[LegitFlix] Intercepted legacy hash:",e),e.includes("details?id=")){const r=new URLSearchParams(e.split("?")[1]).get("id");if(r){i(`/item/${r}`);return}}if(["mypreferencesmenu","user","settings"].some(n=>e.includes(n))){console.log("[LegitFlix] Redirecting settings hash to /profile:",e),i("/profile");return}if(e.includes("selectserver.html")||e.includes("login.html")){console.log("[LegitFlix] Redirecting auth hash to /login/select-user:",e),i("/login/select-user");return}if(["dashboard","plugins","wizard","scheduledtasks","server","networking","devices","api","logs","notifications","librarydisplay","playback","transcoding","live-tv","dlna","intro-s","activity","itemdetails","edititem"].some(n=>e.includes(n))){console.log("[LegitFlix] Redirecting to Classic Mode for:",e),window.location.replace(`/web/index.html?classic=true${e}`);return}}},[i]),null},s1=()=>{const{id:i}=nu(),e=As(),[t,s]=C.useState(null);return C.useEffect(()=>{i&&(async()=>{try{const r=await ee.getCurrentUser();if(!r)return;const l=await ee.getItem(r.Id,i);if(!l){s("Item not found");return}switch(console.log("[LegitFlix] Resolved item type:",l.Type),l.Type){case"Series":e(`/series/${l.Id}`,{replace:!0});break;case"Movie":e(`/movie/${l.Id}`,{replace:!0});break;case"Season":case"Episode":l.SeriesId?e(`/series/${l.SeriesId}`,{replace:!0}):window.location.href=`/web/index.html?classic=true#!/details?id=${l.Id}`;break;default:console.log("[LegitFlix] Unsupported item type, falling back to classic:",l.Type),window.location.href=`/web/index.html?classic=true#!/details?id=${l.Id}`;break}}catch(r){console.error("Failed to resolve item:",r),s("Failed to resolve item link."),setTimeout(()=>{window.location.href=`/web/index.html?classic=true#!/details?id=${i}`},2e3)}})()},[i,e]),g.jsxs("div",{style:{minHeight:"100vh",background:"#000",color:"#fff",display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column"},children:[g.jsx(Ra,{}),t&&g.jsxs("div",{style:{marginTop:100},children:[g.jsx("h2",{children:t}),g.jsx("p",{children:"Redirecting to classic view..."})]})]})},Ce=Number.isFinite||function(i){return typeof i=="number"&&isFinite(i)},i1=Number.isSafeInteger||function(i){return typeof i=="number"&&Math.abs(i)<=n1},n1=Number.MAX_SAFE_INTEGER||9007199254740991;let je=(function(i){return i.NETWORK_ERROR="networkError",i.MEDIA_ERROR="mediaError",i.KEY_SYSTEM_ERROR="keySystemError",i.MUX_ERROR="muxError",i.OTHER_ERROR="otherError",i})({}),Q=(function(i){return i.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",i.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",i.KEY_SYSTEM_NO_SESSION="keySystemNoSession",i.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",i.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",i.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",i.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",i.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",i.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",i.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",i.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",i.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",i.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",i.MANIFEST_LOAD_ERROR="manifestLoadError",i.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",i.MANIFEST_PARSING_ERROR="manifestParsingError",i.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",i.LEVEL_EMPTY_ERROR="levelEmptyError",i.LEVEL_LOAD_ERROR="levelLoadError",i.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",i.LEVEL_PARSING_ERROR="levelParsingError",i.LEVEL_SWITCH_ERROR="levelSwitchError",i.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",i.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",i.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",i.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",i.FRAG_LOAD_ERROR="fragLoadError",i.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",i.FRAG_DECRYPT_ERROR="fragDecryptError",i.FRAG_PARSING_ERROR="fragParsingError",i.FRAG_GAP="fragGap",i.REMUX_ALLOC_ERROR="remuxAllocError",i.KEY_LOAD_ERROR="keyLoadError",i.KEY_LOAD_TIMEOUT="keyLoadTimeOut",i.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",i.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",i.BUFFER_APPEND_ERROR="bufferAppendError",i.BUFFER_APPENDING_ERROR="bufferAppendingError",i.BUFFER_STALLED_ERROR="bufferStalledError",i.BUFFER_FULL_ERROR="bufferFullError",i.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",i.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",i.ASSET_LIST_LOAD_ERROR="assetListLoadError",i.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",i.ASSET_LIST_PARSING_ERROR="assetListParsingError",i.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",i.INTERNAL_EXCEPTION="internalException",i.INTERNAL_ABORTED="aborted",i.ATTACH_MEDIA_ERROR="attachMediaError",i.UNKNOWN="unknown",i})({}),L=(function(i){return i.MEDIA_ATTACHING="hlsMediaAttaching",i.MEDIA_ATTACHED="hlsMediaAttached",i.MEDIA_DETACHING="hlsMediaDetaching",i.MEDIA_DETACHED="hlsMediaDetached",i.MEDIA_ENDED="hlsMediaEnded",i.STALL_RESOLVED="hlsStallResolved",i.BUFFER_RESET="hlsBufferReset",i.BUFFER_CODECS="hlsBufferCodecs",i.BUFFER_CREATED="hlsBufferCreated",i.BUFFER_APPENDING="hlsBufferAppending",i.BUFFER_APPENDED="hlsBufferAppended",i.BUFFER_EOS="hlsBufferEos",i.BUFFERED_TO_END="hlsBufferedToEnd",i.BUFFER_FLUSHING="hlsBufferFlushing",i.BUFFER_FLUSHED="hlsBufferFlushed",i.MANIFEST_LOADING="hlsManifestLoading",i.MANIFEST_LOADED="hlsManifestLoaded",i.MANIFEST_PARSED="hlsManifestParsed",i.LEVEL_SWITCHING="hlsLevelSwitching",i.LEVEL_SWITCHED="hlsLevelSwitched",i.LEVEL_LOADING="hlsLevelLoading",i.LEVEL_LOADED="hlsLevelLoaded",i.LEVEL_UPDATED="hlsLevelUpdated",i.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",i.LEVELS_UPDATED="hlsLevelsUpdated",i.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",i.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",i.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",i.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",i.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",i.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",i.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",i.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",i.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",i.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",i.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",i.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",i.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",i.CUES_PARSED="hlsCuesParsed",i.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",i.INIT_PTS_FOUND="hlsInitPtsFound",i.FRAG_LOADING="hlsFragLoading",i.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",i.FRAG_LOADED="hlsFragLoaded",i.FRAG_DECRYPTED="hlsFragDecrypted",i.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",i.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",i.FRAG_PARSING_METADATA="hlsFragParsingMetadata",i.FRAG_PARSED="hlsFragParsed",i.FRAG_BUFFERED="hlsFragBuffered",i.FRAG_CHANGED="hlsFragChanged",i.FPS_DROP="hlsFpsDrop",i.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",i.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",i.ERROR="hlsError",i.DESTROYING="hlsDestroying",i.KEY_LOADING="hlsKeyLoading",i.KEY_LOADED="hlsKeyLoaded",i.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",i.BACK_BUFFER_REACHED="hlsBackBufferReached",i.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",i.ASSET_LIST_LOADING="hlsAssetListLoading",i.ASSET_LIST_LOADED="hlsAssetListLoaded",i.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",i.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",i.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",i.INTERSTITIAL_STARTED="hlsInterstitialStarted",i.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",i.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",i.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",i.INTERSTITIAL_ENDED="hlsInterstitialEnded",i.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",i.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",i.EVENT_CUE_ENTER="hlsEventCueEnter",i})({});var tt={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},ke={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};class mr{constructor(e,t=0,s=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=s}sample(e,t){const s=Math.pow(this.alpha_,e);this.estimate_=t*(1-s)+s*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class a1{constructor(e,t,s,n=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=s,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new mr(e),this.fast_=new mr(t),this.defaultTTFB_=n,this.ttfb_=new mr(e)}update(e,t){const{slow_:s,fast_:n,ttfb_:r}=this;s.halfLife!==e&&(this.slow_=new mr(e,s.getEstimate(),s.getTotalWeight())),n.halfLife!==t&&(this.fast_=new mr(t,n.getEstimate(),n.getTotalWeight())),r.halfLife!==e&&(this.ttfb_=new mr(e,r.getEstimate(),r.getTotalWeight()))}sample(e,t){e=Math.max(e,this.minDelayMs_);const s=8*t,n=e/1e3,r=s/n;this.fast_.sample(n,r),this.slow_.sample(n,r)}sampleTTFB(e){const t=e/1e3,s=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(s,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}get defaultEstimate(){return this.defaultEstimate_}destroy(){}}function r1(i,e,t){return(e=o1(e))in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function At(){return At=Object.assign?Object.assign.bind():function(i){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var s in t)({}).hasOwnProperty.call(t,s)&&(i[s]=t[s])}return i},At.apply(null,arguments)}function sy(i,e){var t=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);e&&(s=s.filter(function(n){return Object.getOwnPropertyDescriptor(i,n).enumerable})),t.push.apply(t,s)}return t}function vt(i){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?sy(Object(t),!0).forEach(function(s){r1(i,s,t[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(t)):sy(Object(t)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(t,s))})}return i}function l1(i,e){if(typeof i!="object"||!i)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}function o1(i){var e=l1(i,"string");return typeof e=="symbol"?e:e+""}class Ti{constructor(e,t){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;const s=`[${e}]:`;this.trace=Wn,this.debug=t.debug.bind(null,s),this.log=t.log.bind(null,s),this.warn=t.warn.bind(null,s),this.info=t.info.bind(null,s),this.error=t.error.bind(null,s)}}const Wn=function(){},c1={trace:Wn,debug:Wn,log:Wn,warn:Wn,info:Wn,error:Wn};function vf(){return At({},c1)}function u1(i,e){const t=self.console[i];return t?t.bind(self.console,`${e?"["+e+"] ":""}[${i}] >`):Wn}function iy(i,e,t){return e[i]?e[i].bind(e):u1(i,t)}const yf=vf();function d1(i,e,t){const s=vf();if(typeof console=="object"&&i===!0||typeof i=="object"){const n=["debug","log","info","warn","error"];n.forEach(r=>{s[r]=iy(r,i,t)});try{s.log(`Debug logs enabled for "${e}" in hls.js version 1.6.15`)}catch{return vf()}n.forEach(r=>{yf[r]=iy(r,i)})}else At(yf,s);return s}const yt=yf;function ea(i=!0){return typeof self>"u"?void 0:(i||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function h1(i){return typeof self<"u"&&i===self.ManagedMediaSource}function mS(i,e){const t=Object.keys(i),s=Object.keys(e),n=t.length,r=s.length;return!n||!r||n===r&&!t.some(l=>s.indexOf(l)===-1)}function ni(i,e=!1){if(typeof TextDecoder<"u"){const d=new TextDecoder("utf-8").decode(i);if(e){const f=d.indexOf("\0");return f!==-1?d.substring(0,f):d}return d.replace(/\0/g,"")}const t=i.length;let s,n,r,l="",c=0;for(;c<t;){if(s=i[c++],s===0&&e)return l;if(s===0||s===3)continue;switch(s>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:l+=String.fromCharCode(s);break;case 12:case 13:n=i[c++],l+=String.fromCharCode((s&31)<<6|n&63);break;case 14:n=i[c++],r=i[c++],l+=String.fromCharCode((s&15)<<12|(n&63)<<6|(r&63)<<0);break}}return l}function vs(i){let e="";for(let t=0;t<i.length;t++){let s=i[t].toString(16);s.length<2&&(s="0"+s),e+=s}return e}function pS(i){return Uint8Array.from(i.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}function f1(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var jh={exports:{}},ny;function m1(){return ny||(ny=1,(function(i,e){(function(t){var s=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,n=/^(?=([^\/?#]*))\1([^]*)$/,r=/(?:\/|^)\.(?=\/)/g,l=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,c={buildAbsoluteURL:function(h,d,f){if(f=f||{},h=h.trim(),d=d.trim(),!d){if(!f.alwaysNormalize)return h;var p=c.parseURL(h);if(!p)throw new Error("Error trying to parse base URL.");return p.path=c.normalizePath(p.path),c.buildURLFromParts(p)}var v=c.parseURL(d);if(!v)throw new Error("Error trying to parse relative URL.");if(v.scheme)return f.alwaysNormalize?(v.path=c.normalizePath(v.path),c.buildURLFromParts(v)):d;var x=c.parseURL(h);if(!x)throw new Error("Error trying to parse base URL.");if(!x.netLoc&&x.path&&x.path[0]!=="/"){var S=n.exec(x.path);x.netLoc=S[1],x.path=S[2]}x.netLoc&&!x.path&&(x.path="/");var T={scheme:x.scheme,netLoc:v.netLoc,path:null,params:v.params,query:v.query,fragment:v.fragment};if(!v.netLoc&&(T.netLoc=x.netLoc,v.path[0]!=="/"))if(!v.path)T.path=x.path,v.params||(T.params=x.params,v.query||(T.query=x.query));else{var E=x.path,A=E.substring(0,E.lastIndexOf("/")+1)+v.path;T.path=c.normalizePath(A)}return T.path===null&&(T.path=f.alwaysNormalize?c.normalizePath(v.path):v.path),c.buildURLFromParts(T)},parseURL:function(h){var d=s.exec(h);return d?{scheme:d[1]||"",netLoc:d[2]||"",path:d[3]||"",params:d[4]||"",query:d[5]||"",fragment:d[6]||""}:null},normalizePath:function(h){for(h=h.split("").reverse().join("").replace(r,"");h.length!==(h=h.replace(l,"")).length;);return h.split("").reverse().join("")},buildURLFromParts:function(h){return h.scheme+h.netLoc+h.path+h.params+h.query+h.fragment}};i.exports=c})()})(jh)),jh.exports}var Wf=m1();class Zf{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var Ct={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class gS{constructor(e){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,typeof e=="string"&&(e={url:e}),this.base=e,g1(this,"stats")}setByteRange(e,t){const s=e.split("@",2);let n;s.length===1?n=t?.byteRangeEndOffset||0:n=parseInt(s[1]),this._byteRange=[n,parseInt(s[0])+n]}get baseurl(){return this.base.url}get byteRange(){return this._byteRange===null?[]:this._byteRange}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get elementaryStreams(){return this._streams===null&&(this._streams={[Ct.AUDIO]:null,[Ct.VIDEO]:null,[Ct.AUDIOVIDEO]:null}),this._streams}set elementaryStreams(e){this._streams=e}get hasStats(){return this._stats!==null}get hasStreams(){return this._streams!==null}get stats(){return this._stats===null&&(this._stats=new Zf),this._stats}set stats(e){this._stats=e}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Wf.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[Ct.AUDIO]=null,e[Ct.VIDEO]=null,e[Ct.AUDIOVIDEO]=null}}function Qt(i){return i.sn!=="initSegment"}class Fh extends gS{constructor(e,t){super(t),this._decryptdata=null,this._programDateTime=null,this._ref=null,this._bitrate=void 0,this.rawProgramDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.playlistOffset=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get byteLength(){if(this.hasStats){const e=this.stats.total;if(e)return e}if(this.byteRange.length){const e=this.byteRange[0],t=this.byteRange[1];if(Ce(e)&&Ce(t))return t-e}return null}get bitrate(){return this.byteLength?this.byteLength*8/this.duration:this._bitrate?this._bitrate:null}set bitrate(e){this._bitrate=e}get decryptdata(){var e;const{levelkeys:t}=this;if(!t||t.NONE)return null;if(t.identity)this._decryptdata||(this._decryptdata=t.identity.getDecryptData(this.sn));else if(!((e=this._decryptdata)!=null&&e.keyId)){const s=Object.keys(t);if(s.length===1){const n=this._decryptdata=t[s[0]]||null;n&&(this._decryptdata=n.getDecryptData(this.sn,t))}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null)return null;const e=Ce(this.duration)?this.duration:0;return this.programDateTime+e*1e3}get encrypted(){var e;if((e=this._decryptdata)!=null&&e.encrypted)return!0;if(this.levelkeys){var t;const s=Object.keys(this.levelkeys),n=s.length;if(n>1||n===1&&(t=this.levelkeys[s[0]])!=null&&t.encrypted)return!0}return!1}get programDateTime(){return this._programDateTime===null&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime}set programDateTime(e){if(!Ce(e)){this._programDateTime=this.rawProgramDateTime=null;return}this._programDateTime=e}get ref(){return Qt(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}addStart(e){this.setStart(this.start+e)}setStart(e){this.start=e,this._ref&&(this._ref.start=e)}setDuration(e){this.duration=e,this._ref&&(this._ref.duration=e)}setKeyFormat(e){const t=this.levelkeys;if(t){var s;const n=t[e];n&&!((s=this._decryptdata)!=null&&s.keyId)&&(this._decryptdata=n.getDecryptData(this.sn,t))}}abortRequests(){var e,t;(e=this.loader)==null||e.abort(),(t=this.keyLoader)==null||t.abort()}setElementaryStreamInfo(e,t,s,n,r,l=!1){const{elementaryStreams:c}=this,h=c[e];if(!h){c[e]={startPTS:t,endPTS:s,startDTS:n,endDTS:r,partial:l};return}h.startPTS=Math.min(h.startPTS,t),h.endPTS=Math.max(h.endPTS,s),h.startDTS=Math.min(h.startDTS,n),h.endDTS=Math.max(h.endDTS,r)}}class p1 extends gS{constructor(e,t,s,n,r){super(s),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=n;const l=e.enumeratedString("BYTERANGE");l&&this.setByteRange(l,r),r&&(this.fragOffset=r.fragOffset+r.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}function vS(i,e){const t=Object.getPrototypeOf(i);if(t){const s=Object.getOwnPropertyDescriptor(t,e);return s||vS(t,e)}}function g1(i,e){const t=vS(i,e);t&&(t.enumerable=!0,Object.defineProperty(i,e,t))}const ay=Math.pow(2,32)-1,v1=[].push,yS={video:1,audio:2,id3:3,text:4};function rs(i){return String.fromCharCode.apply(null,i)}function xS(i,e){const t=i[e]<<8|i[e+1];return t<0?65536+t:t}function Ke(i,e){const t=SS(i,e);return t<0?4294967296+t:t}function ry(i,e){let t=Ke(i,e);return t*=Math.pow(2,32),t+=Ke(i,e+4),t}function SS(i,e){return i[e]<<24|i[e+1]<<16|i[e+2]<<8|i[e+3]}function y1(i){const e=i.byteLength;for(let t=0;t<e;){const s=Ke(i,t);if(s>8&&i[t+4]===109&&i[t+5]===111&&i[t+6]===111&&i[t+7]===102)return!0;t=s>1?t+s:e}return!1}function et(i,e){const t=[];if(!e.length)return t;const s=i.byteLength;for(let n=0;n<s;){const r=Ke(i,n),l=rs(i.subarray(n+4,n+8)),c=r>1?n+r:s;if(l===e[0])if(e.length===1)t.push(i.subarray(n+8,c));else{const h=et(i.subarray(n+8,c),e.slice(1));h.length&&v1.apply(t,h)}n=c}return t}function x1(i){const e=[],t=i[0];let s=8;const n=Ke(i,s);s+=4;let r=0,l=0;t===0?(r=Ke(i,s),l=Ke(i,s+4),s+=8):(r=ry(i,s),l=ry(i,s+8),s+=16),s+=2;let c=i.length+l;const h=xS(i,s);s+=2;for(let d=0;d<h;d++){let f=s;const p=Ke(i,f);f+=4;const v=p&2147483647;if((p&2147483648)>>>31===1)return yt.warn("SIDX has hierarchical references (not supported)"),null;const S=Ke(i,f);f+=4,e.push({referenceSize:v,subsegmentDuration:S,info:{duration:S/n,start:c,end:c+v-1}}),c+=v,f+=4,s=f}return{earliestPresentationTime:r,timescale:n,version:t,referencesCount:h,references:e}}function bS(i){const e=[],t=et(i,["moov","trak"]);for(let n=0;n<t.length;n++){const r=t[n],l=et(r,["tkhd"])[0];if(l){let c=l[0];const h=Ke(l,c===0?12:20),d=et(r,["mdia","mdhd"])[0];if(d){c=d[0];const f=Ke(d,c===0?12:20),p=et(r,["mdia","hdlr"])[0];if(p){const v=rs(p.subarray(8,12)),x={soun:Ct.AUDIO,vide:Ct.VIDEO}[v],S=et(r,["mdia","minf","stbl","stsd"])[0],T=S1(S);x?(e[h]={timescale:f,type:x,stsd:T},e[x]=vt({timescale:f,id:h},T)):e[h]={timescale:f,type:v,stsd:T}}}}}return et(i,["moov","mvex","trex"]).forEach(n=>{const r=Ke(n,4),l=e[r];l&&(l.default={duration:Ke(n,12),flags:Ke(n,20)})}),e}function S1(i){const e=i.subarray(8),t=e.subarray(86),s=rs(e.subarray(4,8));let n=s,r;const l=s==="enca"||s==="encv";if(l){const d=et(e,[s])[0].subarray(s==="enca"?28:78);et(d,["sinf"]).forEach(p=>{const v=et(p,["schm"])[0];if(v){const x=rs(v.subarray(4,8));if(x==="cbcs"||x==="cenc"){const S=et(p,["frma"])[0];S&&(n=rs(S))}}})}const c=n;switch(n){case"avc1":case"avc2":case"avc3":case"avc4":{const h=et(t,["avcC"])[0];h&&h.length>3&&(n+="."+mc(h[1])+mc(h[2])+mc(h[3]),r=fc(c==="avc1"?"dva1":"dvav",t));break}case"mp4a":{const h=et(e,[s])[0],d=et(h.subarray(28),["esds"])[0];if(d&&d.length>7){let f=4;if(d[f++]!==3)break;f=Bh(d,f),f+=2;const p=d[f++];if(p&128&&(f+=2),p&64&&(f+=d[f++]),d[f++]!==4)break;f=Bh(d,f);const v=d[f++];if(v===64)n+="."+mc(v);else break;if(f+=12,d[f++]!==5)break;f=Bh(d,f);const x=d[f++];let S=(x&248)>>3;S===31&&(S+=1+((x&7)<<3)+((d[f]&224)>>5)),n+="."+S}break}case"hvc1":case"hev1":{const h=et(t,["hvcC"])[0];if(h&&h.length>12){const d=h[1],f=["","A","B","C"][d>>6],p=d&31,v=Ke(h,2),x=(d&32)>>5?"H":"L",S=h[12],T=h.subarray(6,12);n+="."+f+p,n+="."+b1(v).toString(16).toUpperCase(),n+="."+x+S;let E="";for(let A=T.length;A--;){const _=T[A];(_||E)&&(E="."+_.toString(16).toUpperCase()+E)}n+=E}r=fc(c=="hev1"?"dvhe":"dvh1",t);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":{n=fc(n,t)||n;break}case"vp09":{const h=et(t,["vpcC"])[0];if(h&&h.length>6){const d=h[4],f=h[5],p=h[6]>>4&15;n+="."+$i(d)+"."+$i(f)+"."+$i(p)}break}case"av01":{const h=et(t,["av1C"])[0];if(h&&h.length>2){const d=h[1]>>>5,f=h[1]&31,p=h[2]>>>7?"H":"M",v=(h[2]&64)>>6,x=(h[2]&32)>>5,S=d===2&&v?x?12:10:v?10:8,T=(h[2]&16)>>4,E=(h[2]&8)>>3,A=(h[2]&4)>>2,_=h[2]&3;n+="."+d+"."+$i(f)+p+"."+$i(S)+"."+T+"."+E+A+_+"."+$i(1)+"."+$i(1)+"."+$i(1)+"."+0,r=fc("dav1",t)}break}}return{codec:n,encrypted:l,supplemental:r}}function fc(i,e){const t=et(e,["dvvC"]),s=t.length?t[0]:et(e,["dvcC"])[0];if(s){const n=s[2]>>1&127,r=s[2]<<5&32|s[3]>>3&31;return i+"."+$i(n)+"."+$i(r)}}function b1(i){let e=0;for(let t=0;t<32;t++)e|=(i>>t&1)<<31-t;return e>>>0}function Bh(i,e){const t=e+5;for(;i[e++]&128&&e<t;);return e}function mc(i){return("0"+i.toString(16).toUpperCase()).slice(-2)}function $i(i){return(i<10?"0":"")+i}function E1(i,e){if(!i||!e)return;const t=e.keyId;t&&e.isCommonEncryption&&ES(i,(s,n)=>{const r=s.subarray(8,24);r.some(l=>l!==0)||(yt.log(`[eme] Patching keyId in 'enc${n?"a":"v"}>sinf>>tenc' box: ${vs(r)} -> ${vs(t)}`),s.set(t,8))})}function T1(i){const e=[];return ES(i,t=>e.push(t.subarray(8,24))),e}function ES(i,e){et(i,["moov","trak"]).forEach(s=>{const n=et(s,["mdia","minf","stbl","stsd"])[0];if(!n)return;const r=n.subarray(8);let l=et(r,["enca"]);const c=l.length>0;c||(l=et(r,["encv"])),l.forEach(h=>{const d=c?h.subarray(28):h.subarray(78);et(d,["sinf"]).forEach(p=>{const v=TS(p);v&&e(v,c)})})})}function TS(i){const e=et(i,["schm"])[0];if(e){const t=rs(e.subarray(4,8));if(t==="cbcs"||t==="cenc"){const s=et(i,["schi","tenc"])[0];if(s)return s}}}function A1(i,e,t){const s={},n=et(i,["moof","traf"]);for(let r=0;r<n.length;r++){const l=n[r],c=et(l,["tfhd"])[0],h=Ke(c,4),d=e[h];if(!d)continue;s[h]||(s[h]={start:NaN,duration:0,sampleCount:0,timescale:d.timescale,type:d.type});const f=s[h],p=et(l,["tfdt"])[0];if(p){const R=p[0];let w=Ke(p,4);R===1&&(w===ay?t.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"):(w*=ay+1,w+=Ke(p,8))),Ce(w)&&(!Ce(f.start)||w<f.start)&&(f.start=w)}const v=d.default,x=Ke(c,0)|v?.flags;let S=v?.duration||0;x&8&&(x&2?S=Ke(c,12):S=Ke(c,8));const T=et(l,["trun"]);let E=f.start||0,A=0,_=S;for(let R=0;R<T.length;R++){const w=T[R],N=Ke(w,4),U=f.sampleCount;f.sampleCount+=N;const D=w[3]&1,F=w[3]&4,j=w[2]&1,M=w[2]&2,H=w[2]&4,K=w[2]&8;let se=8,ne=N;for(D&&(se+=4),F&&N&&(!(w[se+1]&1)&&f.keyFrameIndex===void 0&&(f.keyFrameIndex=U),se+=4,j?(_=Ke(w,se),se+=4):_=S,M&&(se+=4),K&&(se+=4),E+=_,A+=_,ne--);ne--;)j?(_=Ke(w,se),se+=4):_=S,M&&(se+=4),H&&(w[se+1]&1||f.keyFrameIndex===void 0&&(f.keyFrameIndex=f.sampleCount-(ne+1),f.keyFrameStart=E),se+=4),K&&(se+=4),E+=_,A+=_;!A&&S&&(A+=S*N)}f.duration+=A}if(!Object.keys(s).some(r=>s[r].duration)){let r=1/0,l=0;const c=et(i,["sidx"]);for(let h=0;h<c.length;h++){const d=x1(c[h]);if(d!=null&&d.references){r=Math.min(r,d.earliestPresentationTime/d.timescale);const f=d.references.reduce((p,v)=>p+v.info.duration||0,0);l=Math.max(l,f+d.earliestPresentationTime/d.timescale)}}l&&Ce(l)&&Object.keys(s).forEach(h=>{s[h].duration||(s[h].duration=l*s[h].timescale-s[h].start)})}return s}function _1(i){const e={valid:null,remainder:null},t=et(i,["moof"]);if(t.length<2)return e.remainder=i,e;const s=t[t.length-1];return e.valid=i.slice(0,s.byteOffset-8),e.remainder=i.slice(s.byteOffset-8),e}function bi(i,e){const t=new Uint8Array(i.length+e.length);return t.set(i),t.set(e,i.length),t}function ly(i,e){const t=[],s=e.samples,n=e.timescale,r=e.id;let l=!1;return et(s,["moof"]).map(h=>{const d=h.byteOffset-8;et(h,["traf"]).map(p=>{const v=et(p,["tfdt"]).map(x=>{const S=x[0];let T=Ke(x,4);return S===1&&(T*=Math.pow(2,32),T+=Ke(x,8)),T/n})[0];return v!==void 0&&(i=v),et(p,["tfhd"]).map(x=>{const S=Ke(x,4),T=Ke(x,0)&16777215,E=(T&1)!==0,A=(T&2)!==0,_=(T&8)!==0;let R=0;const w=(T&16)!==0;let N=0;const U=(T&32)!==0;let D=8;S===r&&(E&&(D+=8),A&&(D+=4),_&&(R=Ke(x,D),D+=4),w&&(N=Ke(x,D),D+=4),U&&(D+=4),e.type==="video"&&(l=hu(e.codec)),et(p,["trun"]).map(F=>{const j=F[0],M=Ke(F,0)&16777215,H=(M&1)!==0;let K=0;const se=(M&4)!==0,ne=(M&256)!==0;let de=0;const k=(M&512)!==0;let G=0;const Y=(M&1024)!==0,le=(M&2048)!==0;let me=0;const P=Ke(F,4);let $=8;H&&(K=Ke(F,$),$+=4),se&&($+=4);let ie=K+d;for(let fe=0;fe<P;fe++){if(ne?(de=Ke(F,$),$+=4):de=R,k?(G=Ke(F,$),$+=4):G=N,Y&&($+=4),le&&(j===0?me=Ke(F,$):me=SS(F,$),$+=4),e.type===Ct.VIDEO){let ge=0;for(;ge<G;){const ve=Ke(s,ie);if(ie+=4,I1(l,s[ie])){const Ne=s.subarray(ie,ie+ve);Jf(Ne,l?2:1,i+me/n,t)}ie+=ve,ge+=ve+4}}i+=de/n}}))})})}),t}function hu(i){if(!i)return!1;const e=i.substring(0,4);return e==="hvc1"||e==="hev1"||e==="dvh1"||e==="dvhe"}function I1(i,e){if(i){const t=e>>1&63;return t===39||t===40}else return(e&31)===6}function Jf(i,e,t,s){const n=AS(i);let r=0;r+=e;let l=0,c=0,h=0;for(;r<n.length;){l=0;do{if(r>=n.length)break;h=n[r++],l+=h}while(h===255);c=0;do{if(r>=n.length)break;h=n[r++],c+=h}while(h===255);const d=n.length-r;let f=r;if(c<d)r+=c;else if(c>d){yt.error(`Malformed SEI payload. ${c} is too small, only ${d} bytes left to parse.`);break}if(l===4){if(n[f++]===181){const v=xS(n,f);if(f+=2,v===49){const x=Ke(n,f);if(f+=4,x===1195456820){const S=n[f++];if(S===3){const T=n[f++],E=31&T,A=64&T,_=A?2+E*3:0,R=new Uint8Array(_);if(A){R[0]=T;for(let w=1;w<_;w++)R[w]=n[f++]}s.push({type:S,payloadType:l,pts:t,bytes:R})}}}}}else if(l===5&&c>16){const p=[];for(let S=0;S<16;S++){const T=n[f++].toString(16);p.push(T.length==1?"0"+T:T),(S===3||S===5||S===7||S===9)&&p.push("-")}const v=c-16,x=new Uint8Array(v);for(let S=0;S<v;S++)x[S]=n[f++];s.push({payloadType:l,pts:t,uuid:p.join(""),userData:ni(x),userDataBytes:x})}}}function AS(i){const e=i.byteLength,t=[];let s=1;for(;s<e-2;)i[s]===0&&i[s+1]===0&&i[s+2]===3?(t.push(s+2),s+=2):s++;if(t.length===0)return i;const n=e-t.length,r=new Uint8Array(n);let l=0;for(s=0;s<n;l++,s++)l===t[0]&&(l++,t.shift()),r[s]=i[l];return r}function R1(i){const e=i[0];let t="",s="",n=0,r=0,l=0,c=0,h=0,d=0;if(e===0){for(;rs(i.subarray(d,d+1))!=="\0";)t+=rs(i.subarray(d,d+1)),d+=1;for(t+=rs(i.subarray(d,d+1)),d+=1;rs(i.subarray(d,d+1))!=="\0";)s+=rs(i.subarray(d,d+1)),d+=1;s+=rs(i.subarray(d,d+1)),d+=1,n=Ke(i,12),r=Ke(i,16),c=Ke(i,20),h=Ke(i,24),d=28}else if(e===1){d+=4,n=Ke(i,d),d+=4;const p=Ke(i,d);d+=4;const v=Ke(i,d);for(d+=4,l=2**32*p+v,i1(l)||(l=Number.MAX_SAFE_INTEGER,yt.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),c=Ke(i,d),d+=4,h=Ke(i,d),d+=4;rs(i.subarray(d,d+1))!=="\0";)t+=rs(i.subarray(d,d+1)),d+=1;for(t+=rs(i.subarray(d,d+1)),d+=1;rs(i.subarray(d,d+1))!=="\0";)s+=rs(i.subarray(d,d+1)),d+=1;s+=rs(i.subarray(d,d+1)),d+=1}const f=i.subarray(d,i.byteLength);return{schemeIdUri:t,value:s,timeScale:n,presentationTime:l,presentationTimeDelta:r,eventDuration:c,id:h,payload:f}}function L1(i,...e){const t=e.length;let s=8,n=t;for(;n--;)s+=e[n].byteLength;const r=new Uint8Array(s);for(r[0]=s>>24&255,r[1]=s>>16&255,r[2]=s>>8&255,r[3]=s&255,r.set(i,4),n=0,s=8;n<t;n++)r.set(e[n],s),s+=e[n].byteLength;return r}function w1(i,e,t){if(i.byteLength!==16)throw new RangeError("Invalid system id");let s,n;s=0,n=new Uint8Array;let r;s>0?(r=new Uint8Array(4),e.length>0&&new DataView(r.buffer).setUint32(0,e.length,!1)):r=new Uint8Array;const l=new Uint8Array(4);return t.byteLength>0&&new DataView(l.buffer).setUint32(0,t.byteLength,!1),L1([112,115,115,104],new Uint8Array([s,0,0,0]),i,r,n,l,t)}function C1(i){const e=[];if(i instanceof ArrayBuffer){const t=i.byteLength;let s=0;for(;s+32<t;){const n=new DataView(i,s),r=O1(n);e.push(r),s+=r.size}}return e}function O1(i){const e=i.getUint32(0),t=i.byteOffset,s=i.byteLength;if(s<e)return{offset:t,size:s};if(i.getUint32(4)!==1886614376)return{offset:t,size:e};const r=i.getUint32(8)>>>24;if(r!==0&&r!==1)return{offset:t,size:e};const l=i.buffer,c=vs(new Uint8Array(l,t+12,16));let h=null,d=null,f=0;if(r===0)f=28;else{const v=i.getUint32(28);if(!v||s<32+v*16)return{offset:t,size:e};h=[];for(let x=0;x<v;x++)h.push(new Uint8Array(l,t+32+x*16,16));f=32+v*16}if(!f)return{offset:t,size:e};const p=i.getUint32(f);return e-32<p?{offset:t,size:e}:(d=new Uint8Array(l,t+f+4,p),{version:r,systemId:c,kids:h,data:d,offset:t,size:e})}const _S=()=>/\(Windows.+Firefox\//i.test(navigator.userAgent),Rr={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function em(i,e){const t=Rr[e];return!!t&&!!t[i.slice(0,4)]}function Dl(i,e,t=!0){return!i.split(",").some(s=>!tm(s,e,t))}function tm(i,e,t=!0){var s;const n=ea(t);return(s=n?.isTypeSupported(kl(i,e)))!=null?s:!1}function kl(i,e){return`${e}/mp4;codecs=${i}`}function oy(i){if(i){const e=i.substring(0,4);return Rr.video[e]}return 2}function Kc(i){const e=_S();return i.split(",").reduce((t,s)=>{const r=e&&hu(s)?9:Rr.video[s];return r?(r*2+t)/(t?3:2):(Rr.audio[s]+t)/(t?2:1)},0)}const $h={};function N1(i,e=!0){if($h[i])return $h[i];const t={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[i];for(let n=0;n<t.length;n++){var s;if(tm(t[n],"audio",e))return $h[i]=t[n],t[n];if(t[n]==="mp3"&&(s=ea(e))!=null&&s.isTypeSupported("audio/mpeg"))return""}return i}const D1=/flac|opus|mp4a\.40\.34/i;function Yc(i,e=!0){return i.replace(D1,t=>N1(t.toLowerCase(),e))}function k1(i,e){const t=[];if(i){const s=i.split(",");for(let n=0;n<s.length;n++)em(s[n],"video")||t.push(s[n])}return e&&t.push(e),t.join(",")}function Dc(i,e){if(i&&(i.length>4||["ac-3","ec-3","alac","fLaC","Opus"].indexOf(i)!==-1)&&(cy(i,"audio")||cy(i,"video")))return i;if(e){const t=e.split(",");if(t.length>1){if(i){for(let s=t.length;s--;)if(t[s].substring(0,4)===i.substring(0,4))return t[s]}return t[0]}}return e||i}function cy(i,e){return em(i,e)&&tm(i,e)}function P1(i){const e=i.split(",");for(let t=0;t<e.length;t++){const s=e[t].split(".");s.length>2&&s[0]==="avc1"&&(e[t]=`avc1.${parseInt(s[1]).toString(16)}${("000"+parseInt(s[2]).toString(16)).slice(-4)}`)}return e.join(",")}function U1(i){if(i.startsWith("av01.")){const e=i.split("."),t=["0","111","01","01","01","0"];for(let s=e.length;s>4&&s<10;s++)e[s]=t[s-4];return e.join(".")}return i}function uy(i){const e=ea(i)||{isTypeSupported:()=>!1};return{mpeg:e.isTypeSupported("audio/mpeg"),mp3:e.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:e.isTypeSupported('audio/mp4; codecs="ac-3"')}}function xf(i){return i.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}const M1={supported:!0,powerEfficient:!0,smooth:!0},j1={supported:!1,smooth:!1,powerEfficient:!1},IS={supported:!0,configurations:[],decodingInfoResults:[M1]};function RS(i,e){return{supported:!1,configurations:e,decodingInfoResults:[j1],error:i}}function F1(i,e,t,s,n,r){const l=i.videoCodec,c=i.audioCodec?i.audioGroups:null,h=r?.audioCodec,d=r?.channels,f=d?parseInt(d):h?1/0:2;let p=null;if(c!=null&&c.length)try{c.length===1&&c[0]?p=e.groups[c[0]].channels:p=c.reduce((v,x)=>{if(x){const S=e.groups[x];if(!S)throw new Error(`Audio track group ${x} not found`);Object.keys(S.channels).forEach(T=>{v[T]=(v[T]||0)+S.channels[T]})}return v},{2:0})}catch{return!0}return l!==void 0&&(l.split(",").some(v=>hu(v))||i.width>1920&&i.height>1088||i.height>1920&&i.width>1088||i.frameRate>Math.max(s,30)||i.videoRange!=="SDR"&&i.videoRange!==t||i.bitrate>Math.max(n,8e6))||!!p&&Ce(f)&&Object.keys(p).some(v=>parseInt(v)>f)}function LS(i,e,t,s={}){const n=i.videoCodec;if(!n&&!i.audioCodec||!t)return Promise.resolve(IS);const r=[],l=B1(i),c=l.length,h=$1(i,e,c>0),d=h.length;for(let f=c||1*d||1;f--;){const p={type:"media-source"};if(c&&(p.video=l[f%c]),d){p.audio=h[f%d];const v=p.audio.bitrate;p.video&&v&&(p.video.bitrate-=v)}r.push(p)}if(n){const f=navigator.userAgent;if(n.split(",").some(p=>hu(p))&&_S())return Promise.resolve(RS(new Error(`Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent string: (${f})`),r))}return Promise.all(r.map(f=>{const p=G1(f);return s[p]||(s[p]=t.decodingInfo(f))})).then(f=>({supported:!f.some(p=>!p.supported),configurations:r,decodingInfoResults:f})).catch(f=>({supported:!1,configurations:r,decodingInfoResults:[],error:f}))}function B1(i){var e;const t=(e=i.videoCodec)==null?void 0:e.split(","),s=wS(i),n=i.width||640,r=i.height||480,l=i.frameRate||30,c=i.videoRange.toLowerCase();return t?t.map(h=>{const d={contentType:kl(U1(h),"video"),width:n,height:r,bitrate:s,framerate:l};return c!=="sdr"&&(d.transferFunction=c),d}):[]}function $1(i,e,t){var s;const n=(s=i.audioCodec)==null?void 0:s.split(","),r=wS(i);return n&&i.audioGroups?i.audioGroups.reduce((l,c)=>{var h;const d=c?(h=e.groups[c])==null?void 0:h.tracks:null;return d?d.reduce((f,p)=>{if(p.groupId===c){const v=parseFloat(p.channels||"");n.forEach(x=>{const S={contentType:kl(x,"audio"),bitrate:t?V1(x,r):r};v&&(S.channels=""+v),f.push(S)})}return f},l):l},[]):[]}function V1(i,e){if(e<=1)return 1;let t=128e3;return i==="ec-3"?t=768e3:i==="ac-3"&&(t=64e4),Math.min(e/2,t)}function wS(i){return Math.ceil(Math.max(i.bitrate*.9,i.averageBitrate)/1e3)*1e3||1}function G1(i){let e="";const{audio:t,video:s}=i;if(s){const n=xf(s.contentType);e+=`${n}_r${s.height}x${s.width}f${Math.ceil(s.framerate)}${s.transferFunction||"sd"}_${Math.ceil(s.bitrate/1e5)}`}if(t){const n=xf(t.contentType);e+=`${s?"_":""}${n}_c${t.channels}`}return e}const Sf=["NONE","TYPE-0","TYPE-1",null];function H1(i){return Sf.indexOf(i)>-1}const qc=["SDR","PQ","HLG"];function z1(i){return!!i&&qc.indexOf(i)>-1}var kc={No:"",Yes:"YES",v2:"v2"};function dy(i){const{canSkipUntil:e,canSkipDateRanges:t,age:s}=i,n=s<e/2;return e&&n?t?kc.v2:kc.Yes:kc.No}class hy{constructor(e,t,s){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=s}addDirectives(e){const t=new self.URL(e);return this.msn!==void 0&&t.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class Pl{constructor(e){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter(s=>!!s).map(s=>s.substring(0,4)).join(","),"supplemental"in e){var t;this.supplemental=e.supplemental;const s=(t=e.supplemental)==null?void 0:t.videoCodec;s&&s!==e.videoCodec&&(this.codecSet+=`,${s.substring(0,4)}`)}this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return fy(this._audioGroups,e)}hasSubtitleGroup(e){return fy(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,t){if(t){if(e==="audio"){let s=this._audioGroups;s||(s=this._audioGroups=[]),s.indexOf(t)===-1&&s.push(t)}else if(e==="text"){let s=this._subtitleGroups;s||(s=this._subtitleGroups=[]),s.indexOf(t)===-1&&s.push(t)}}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return(e=this.audioGroups)==null?void 0:e[0]}get textGroupId(){var e;return(e=this.subtitleGroups)==null?void 0:e[0]}addFallback(){}}function fy(i,e){return!e||!i?!1:i.indexOf(e)!==-1}function K1(){if(typeof matchMedia=="function"){const i=matchMedia("(dynamic-range: high)"),e=matchMedia("bad query");if(i.media!==e.media)return i.matches===!0}return!1}function Y1(i,e){let t=!1,s=[];if(i&&(t=i!=="SDR",s=[i]),e){s=e.allowedVideoRanges||qc.slice(0);const n=s.join("")!=="SDR"&&!e.videoCodec;t=e.preferHDR!==void 0?e.preferHDR:n&&K1(),t||(s=["SDR"])}return{preferHDR:t,allowedVideoRanges:s}}const q1=i=>{const e=new WeakSet;return(t,s)=>{if(i&&(s=i(t,s)),typeof s=="object"&&s!==null){if(e.has(s))return;e.add(s)}return s}},Ot=(i,e)=>JSON.stringify(i,q1(e));function Q1(i,e,t,s,n){const r=Object.keys(i),l=s?.channels,c=s?.audioCodec,h=n?.videoCodec,d=l&&parseInt(l)===2;let f=!1,p=!1,v=1/0,x=1/0,S=1/0,T=1/0,E=0,A=[];const{preferHDR:_,allowedVideoRanges:R}=Y1(e,n);for(let F=r.length;F--;){const j=i[r[F]];f||(f=j.channels[2]>0),v=Math.min(v,j.minHeight),x=Math.min(x,j.minFramerate),S=Math.min(S,j.minBitrate),R.filter(H=>j.videoRanges[H]>0).length>0&&(p=!0)}v=Ce(v)?v:0,x=Ce(x)?x:0;const w=Math.max(1080,v),N=Math.max(30,x);S=Ce(S)?S:t,t=Math.max(S,t),p||(e=void 0);const U=r.length>1;return{codecSet:r.reduce((F,j)=>{const M=i[j];if(j===F)return F;if(A=p?R.filter(H=>M.videoRanges[H]>0):[],U){if(M.minBitrate>t)return Fi(j,`min bitrate of ${M.minBitrate} > current estimate of ${t}`),F;if(!M.hasDefaultAudio)return Fi(j,"no renditions with default or auto-select sound found"),F;if(c&&j.indexOf(c.substring(0,4))%5!==0)return Fi(j,`audio codec preference "${c}" not found`),F;if(l&&!d){if(!M.channels[l])return Fi(j,`no renditions with ${l} channel sound found (channels options: ${Object.keys(M.channels)})`),F}else if((!c||d)&&f&&M.channels[2]===0)return Fi(j,"no renditions with stereo sound found"),F;if(M.minHeight>w)return Fi(j,`min resolution of ${M.minHeight} > maximum of ${w}`),F;if(M.minFramerate>N)return Fi(j,`min framerate of ${M.minFramerate} > maximum of ${N}`),F;if(!A.some(H=>M.videoRanges[H]>0))return Fi(j,`no variants with VIDEO-RANGE of ${Ot(A)} found`),F;if(h&&j.indexOf(h.substring(0,4))%5!==0)return Fi(j,`video codec preference "${h}" not found`),F;if(M.maxScore<E)return Fi(j,`max score of ${M.maxScore} < selected max of ${E}`),F}return F&&(Kc(j)>=Kc(F)||M.fragmentError>i[F].fragmentError)?F:(T=M.minIndex,E=M.maxScore,j)},void 0),videoRanges:A,preferHDR:_,minFramerate:x,minBitrate:S,minIndex:T}}function Fi(i,e){yt.log(`[abr] start candidates with "${i}" ignored because ${e}`)}function CS(i){return i.reduce((e,t)=>{let s=e.groups[t.groupId];s||(s=e.groups[t.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),s.tracks.push(t);const n=t.channels||"2";return s.channels[n]=(s.channels[n]||0)+1,s.hasDefault=s.hasDefault||t.default,s.hasAutoSelect=s.hasAutoSelect||t.autoselect,s.hasDefault&&(e.hasDefaultAudio=!0),s.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function X1(i,e,t,s){return i.slice(t,s+1).reduce((n,r,l)=>{if(!r.codecSet)return n;const c=r.audioGroups;let h=n[r.codecSet];h||(n[r.codecSet]=h={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:l,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!c,fragmentError:0}),h.minBitrate=Math.min(h.minBitrate,r.bitrate);const d=Math.min(r.height,r.width);return h.minHeight=Math.min(h.minHeight,d),h.minFramerate=Math.min(h.minFramerate,r.frameRate),h.minIndex=Math.min(h.minIndex,l),h.maxScore=Math.max(h.maxScore,r.score),h.fragmentError+=r.fragmentError,h.videoRanges[r.videoRange]=(h.videoRanges[r.videoRange]||0)+1,c&&c.forEach(f=>{if(!f)return;const p=e.groups[f];p&&(h.hasDefaultAudio=h.hasDefaultAudio||e.hasDefaultAudio?p.hasDefault:p.hasAutoSelect||!e.hasDefaultAudio&&!e.hasAutoSelectAudio,Object.keys(p.channels).forEach(v=>{h.channels[v]=(h.channels[v]||0)+p.channels[v]}))}),n},{})}function my(i){if(!i)return i;const{lang:e,assocLang:t,characteristics:s,channels:n,audioCodec:r}=i;return{lang:e,assocLang:t,characteristics:s,channels:n,audioCodec:r}}function Gi(i,e,t){if("attrs"in i){const s=e.indexOf(i);if(s!==-1)return s}for(let s=0;s<e.length;s++){const n=e[s];if(_a(i,n,t))return s}return-1}function _a(i,e,t){const{groupId:s,name:n,lang:r,assocLang:l,default:c}=i,h=i.forced;return(s===void 0||e.groupId===s)&&(n===void 0||e.name===n)&&(r===void 0||W1(r,e.lang))&&(r===void 0||e.assocLang===l)&&(c===void 0||e.default===c)&&(h===void 0||e.forced===h)&&(!("characteristics"in i)||Z1(i.characteristics||"",e.characteristics))&&(t===void 0||t(i,e))}function W1(i,e="--"){return i.length===e.length?i===e:i.startsWith(e)||e.startsWith(i)}function Z1(i,e=""){const t=i.split(","),s=e.split(",");return t.length===s.length&&!t.some(n=>s.indexOf(n)===-1)}function Ea(i,e){const{audioCodec:t,channels:s}=i;return(t===void 0||(e.audioCodec||"").substring(0,4)===t.substring(0,4))&&(s===void 0||s===(e.channels||"2"))}function J1(i,e,t,s,n){const r=e[s],c=e.reduce((v,x,S)=>{const T=x.uri;return(v[T]||(v[T]=[])).push(S),v},{})[r.uri];c.length>1&&(s=Math.max.apply(Math,c));const h=r.videoRange,d=r.frameRate,f=r.codecSet.substring(0,4),p=py(e,s,v=>{if(v.videoRange!==h||v.frameRate!==d||v.codecSet.substring(0,4)!==f)return!1;const x=v.audioGroups,S=t.filter(T=>!x||x.indexOf(T.groupId)!==-1);return Gi(i,S,n)>-1});return p>-1?p:py(e,s,v=>{const x=v.audioGroups,S=t.filter(T=>!x||x.indexOf(T.groupId)!==-1);return Gi(i,S,n)>-1})}function py(i,e,t){for(let s=e;s>-1;s--)if(t(i[s]))return s;for(let s=e+1;s<i.length;s++)if(t(i[s]))return s;return-1}function Qc(i,e){var t;return!!i&&i!==((t=e.loadLevelObj)==null?void 0:t.uri)}class ew extends Ti{constructor(e){super("abr",e.logger),this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.rebufferNotice=-1,this.supportedCache={},this.bwEstimator=void 0,this._abandonRulesCheck=t=>{var s;const{fragCurrent:n,partCurrent:r,hls:l}=this,{autoLevelEnabled:c,media:h}=l;if(!n||!h)return;const d=performance.now(),f=r?r.stats:n.stats,p=r?r.duration:n.duration,v=d-f.loading.start,x=l.minAutoLevel,S=n.level,T=this._nextAutoLevel;if(f.aborted||f.loaded&&f.loaded===f.total||S<=x){this.clearTimer(),this._nextAutoLevel=-1;return}if(!c)return;const E=T>-1&&T!==S,A=!!t||E;if(!A&&(h.paused||!h.playbackRate||!h.readyState))return;const _=l.mainForwardBufferInfo;if(!A&&_===null)return;const R=this.bwEstimator.getEstimateTTFB(),w=Math.abs(h.playbackRate);if(v<=Math.max(R,1e3*(p/(w*2))))return;const N=_?_.len/w:0,U=f.loading.first?f.loading.first-f.loading.start:-1,D=f.loaded&&U>-1,F=this.getBwEstimate(),j=l.levels,M=j[S],H=Math.max(f.loaded,Math.round(p*(n.bitrate||M.averageBitrate)/8));let K=D?v-U:v;K<1&&D&&(K=Math.min(v,f.loaded*8/F));const se=D?f.loaded*1e3/K:0,ne=R/1e3,de=se?(H-f.loaded)/se:H*8/F+ne;if(de<=N)return;const k=se?se*8:F,G=((s=t?.details||this.hls.latestLevelDetails)==null?void 0:s.live)===!0,Y=this.hls.config.abrBandWidthUpFactor;let le=Number.POSITIVE_INFINITY,me;for(me=S-1;me>x;me--){const fe=j[me].maxBitrate,ge=!j[me].details||G;if(le=this.getTimeToLoadFrag(ne,k,p*fe,ge),le<Math.min(N,p+ne))break}if(le>=de||le>p*10)return;D?this.bwEstimator.sample(v-Math.min(R,U),f.loaded):this.bwEstimator.sampleTTFB(v);const P=j[me].maxBitrate;this.getBwEstimate()*Y>P&&this.resetEstimator(P);const $=this.findBestLevel(P,x,me,0,N,1,1);$>-1&&(me=$),this.warn(`Fragment ${n.sn}${r?" part "+r.index:""} of level ${S} is loading too slowly;
      Fragment duration: ${n.duration.toFixed(3)}
      Time to underbuffer: ${N.toFixed(3)} s
      Estimated load time for current fragment: ${de.toFixed(3)} s
      Estimated load time for down switch fragment: ${le.toFixed(3)} s
      TTFB estimate: ${U|0} ms
      Current BW estimate: ${Ce(F)?F|0:"Unknown"} bps
      New BW estimate: ${this.getBwEstimate()|0} bps
      Switching to level ${me} @ ${P|0} bps`),l.nextLoadLevel=l.nextAutoLevel=me,this.clearTimer();const ie=()=>{if(this.clearTimer(),this.fragCurrent===n&&this.hls.loadLevel===me&&me>0){const fe=this.getStarvationDelay();if(this.warn(`Aborting inflight request ${me>0?"and switching down":""}
      Fragment duration: ${n.duration.toFixed(3)} s
      Time to underbuffer: ${fe.toFixed(3)} s`),n.abortRequests(),this.fragCurrent=this.partCurrent=null,me>x){let ge=this.findBestLevel(this.hls.levels[x].bitrate,x,me,0,fe,1,1);ge===-1&&(ge=x),this.hls.nextLoadLevel=this.hls.nextAutoLevel=ge,this.resetEstimator(this.hls.levels[ge].bitrate)}}};E||de>le*2?ie():this.timer=self.setInterval(ie,le*1e3),l.trigger(L.FRAG_LOAD_EMERGENCY_ABORTED,{frag:n,part:r,stats:f})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(this.log(`setting initial bwe to ${e}`),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const e=this.hls.config;return new a1(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){const{hls:e}=this;e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.FRAG_LOADING,this.onFragLoading,this),e.on(L.FRAG_LOADED,this.onFragLoaded,this),e.on(L.FRAG_BUFFERED,this.onFragBuffered,this),e.on(L.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(L.LEVEL_LOADED,this.onLevelLoaded,this),e.on(L.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(L.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(L.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e&&(e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.FRAG_LOADING,this.onFragLoading,this),e.off(L.FRAG_LOADED,this.onFragLoaded,this),e.off(L.FRAG_BUFFERED,this.onFragBuffered,this),e.off(L.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(L.LEVEL_LOADED,this.onLevelLoaded,this),e.off(L.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(L.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(L.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=this.supportedCache=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.supportedCache={},this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,t){const s=t.frag;if(!this.ignoreFragment(s)){if(!s.bitrateTest){var n;this.fragCurrent=s,this.partCurrent=(n=t.part)!=null?n:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,t){this.clearTimer()}onError(e,t){if(!t.fatal)switch(t.details){case Q.BUFFER_ADD_CODEC_ERROR:case Q.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case Q.FRAG_LOAD_TIMEOUT:{const s=t.frag,{fragCurrent:n,partCurrent:r}=this;if(s&&n&&s.sn===n.sn&&s.level===n.level){const l=performance.now(),c=r?r.stats:s.stats,h=l-c.loading.start,d=c.loading.first?c.loading.first-c.loading.start:-1;if(c.loaded&&d>-1){const p=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(h-Math.min(p,d),c.loaded)}else this.bwEstimator.sampleTTFB(h)}break}}}getTimeToLoadFrag(e,t,s,n){const r=e+s/t,l=n?e+this.lastLevelLoadSec:0;return r+l}onLevelLoaded(e,t){const s=this.hls.config,{loading:n}=t.stats,r=n.end-n.first;Ce(r)&&(this.lastLevelLoadSec=r/1e3),t.details.live?this.bwEstimator.update(s.abrEwmaSlowLive,s.abrEwmaFastLive):this.bwEstimator.update(s.abrEwmaSlowVoD,s.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(t.levelInfo)}onFragLoaded(e,{frag:t,part:s}){const n=s?s.stats:t.stats;if(t.type===ke.MAIN&&this.bwEstimator.sampleTTFB(n.loading.first-n.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),t.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const r=s?s.duration:t.duration,l=this.hls.levels[t.level],c=(l.loaded?l.loaded.bytes:0)+n.loaded,h=(l.loaded?l.loaded.duration:0)+r;l.loaded={bytes:c,duration:h},l.realBitrate=Math.round(8*c/h)}if(t.bitrateTest){const r={stats:n,frag:t,part:s,id:t.type};this.onFragBuffered(L.FRAG_BUFFERED,r),t.bitrateTest=!1}else this.lastLoadedFragLevel=t.level}}onFragBuffered(e,t){const{frag:s,part:n}=t,r=n!=null&&n.stats.loaded?n.stats:s.stats;if(r.aborted||this.ignoreFragment(s))return;const l=r.parsing.end-r.loading.start-Math.min(r.loading.first-r.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(l,r.loaded),r.bwEstimate=this.getBwEstimate(),s.bitrateTest?this.bitrateTestDelay=l/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==ke.MAIN||e.sn==="initSegment"}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:e,minAutoLevel:t}=this.hls,s=this.getBwEstimate(),n=this.hls.config.maxStarvationDelay,r=this.findBestLevel(s,t,e,0,n,1,1);if(r>-1)return r;const l=this.hls.firstLevel,c=Math.min(Math.max(l,t),e);return this.warn(`Could not find best starting auto level. Defaulting to first in playlist ${l} clamped to ${c}`),c}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const e=this.forcedAutoLevel,s=this.bwEstimator.canEstimate(),n=this.lastLoadedFragLevel>-1;if(e!==-1&&(!s||!n||this.nextAutoLevelKey===this.getAutoLevelKey()))return e;const r=s&&n?this.getNextABRAutoLevel():this.firstAutoLevel;if(e!==-1){const l=this.hls.levels;if(l.length>Math.max(e,r)&&l[e].loadError<=l[r].loadError)return e}return this._nextAutoLevel=r,this.nextAutoLevelKey=this.getAutoLevelKey(),r}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:t,hls:s}=this;if(s.levels.length<=1)return s.loadLevel;const{maxAutoLevel:n,config:r,minAutoLevel:l}=s,c=t?t.duration:e?e.duration:0,h=this.getBwEstimate(),d=this.getStarvationDelay();let f=r.abrBandWidthFactor,p=r.abrBandWidthUpFactor;if(d){const E=this.findBestLevel(h,l,n,d,0,f,p);if(E>=0)return this.rebufferNotice=-1,E}let v=c?Math.min(c,r.maxStarvationDelay):r.maxStarvationDelay;if(!d){const E=this.bitrateTestDelay;E&&(v=(c?Math.min(c,r.maxLoadingDelay):r.maxLoadingDelay)-E,this.info(`bitrate test took ${Math.round(1e3*E)}ms, set first fragment max fetchDuration to ${Math.round(1e3*v)} ms`),f=p=1)}const x=this.findBestLevel(h,l,n,d,v,f,p);if(this.rebufferNotice!==x&&(this.rebufferNotice=x,this.info(`${d?"rebuffering expected":"buffer is empty"}, optimal quality level ${x}`)),x>-1)return x;const S=s.levels[l],T=s.loadLevelObj;return T&&S?.bitrate<T.bitrate?l:s.loadLevel}getStarvationDelay(){const e=this.hls,t=e.media;if(!t)return 1/0;const s=t&&t.playbackRate!==0?Math.abs(t.playbackRate):1,n=e.mainForwardBufferInfo;return(n?n.len:0)/s}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,t,s,n,r,l,c){var h;const d=n+r,f=this.lastLoadedFragLevel,p=f===-1?this.hls.firstLevel:f,{fragCurrent:v,partCurrent:x}=this,{levels:S,allAudioTracks:T,loadLevel:E,config:A}=this.hls;if(S.length===1)return 0;const _=S[p],R=!!((h=this.hls.latestLevelDetails)!=null&&h.live),w=E===-1||f===-1;let N,U="SDR",D=_?.frameRate||0;const{audioPreference:F,videoPreference:j}=A,M=this.audioTracksByGroup||(this.audioTracksByGroup=CS(T));let H=-1;if(w){if(this.firstSelection!==-1)return this.firstSelection;const k=this.codecTiers||(this.codecTiers=X1(S,M,t,s)),G=Q1(k,U,e,F,j),{codecSet:Y,videoRanges:le,minFramerate:me,minBitrate:P,minIndex:$,preferHDR:ie}=G;H=$,N=Y,U=ie?le[le.length-1]:le[0],D=me,e=Math.max(e,P),this.log(`picked start tier ${Ot(G)}`)}else N=_?.codecSet,U=_?.videoRange;const K=x?x.duration:v?v.duration:0,se=this.bwEstimator.getEstimateTTFB()/1e3,ne=[];for(let k=s;k>=t;k--){var de;const G=S[k],Y=k>p;if(!G)continue;if(A.useMediaCapabilities&&!G.supportedResult&&!G.supportedPromise){const ge=navigator.mediaCapabilities;typeof ge?.decodingInfo=="function"&&F1(G,M,U,D,e,F)?(G.supportedPromise=LS(G,M,ge,this.supportedCache),G.supportedPromise.then(ve=>{if(!this.hls)return;G.supportedResult=ve;const Ne=this.hls.levels,pe=Ne.indexOf(G);ve.error?this.warn(`MediaCapabilities decodingInfo error: "${ve.error}" for level ${pe} ${Ot(ve)}`):ve.supported?ve.decodingInfoResults.some(we=>we.smooth===!1||we.powerEfficient===!1)&&this.log(`MediaCapabilities decodingInfo for level ${pe} not smooth or powerEfficient: ${Ot(ve)}`):(this.warn(`Unsupported MediaCapabilities decodingInfo result for level ${pe} ${Ot(ve)}`),pe>-1&&Ne.length>1&&(this.log(`Removing unsupported level ${pe}`),this.hls.removeLevel(pe),this.hls.loadLevel===-1&&(this.hls.nextLoadLevel=0)))}).catch(ve=>{this.warn(`Error handling MediaCapabilities decodingInfo: ${ve}`)})):G.supportedResult=IS}if((N&&G.codecSet!==N||U&&G.videoRange!==U||Y&&D>G.frameRate||!Y&&D>0&&D<G.frameRate||(de=G.supportedResult)!=null&&(de=de.decodingInfoResults)!=null&&de.some(ge=>ge.smooth===!1))&&(!w||k!==H)){ne.push(k);continue}const le=G.details,me=(x?le?.partTarget:le?.averagetargetduration)||K;let P;Y?P=c*e:P=l*e;const $=K&&n>=K*2&&r===0?G.averageBitrate:G.maxBitrate,ie=this.getTimeToLoadFrag(se,P,$*me,le===void 0);if(P>=$&&(k===f||G.loadError===0&&G.fragmentError===0)&&(ie<=se||!Ce(ie)||R&&!this.bitrateTestDelay||ie<d)){const ge=this.forcedAutoLevel;return k!==E&&(ge===-1||ge!==E)&&(ne.length&&this.trace(`Skipped level(s) ${ne.join(",")} of ${s} max with CODECS and VIDEO-RANGE:"${S[ne[0]].codecs}" ${S[ne[0]].videoRange}; not compatible with "${N}" ${U}`),this.info(`switch candidate:${p}->${k} adjustedbw(${Math.round(P)})-bitrate=${Math.round(P-$)} ttfb:${se.toFixed(1)} avgDuration:${me.toFixed(1)} maxFetchDuration:${d.toFixed(1)} fetchDuration:${ie.toFixed(1)} firstSelection:${w} codecSet:${G.codecSet} videoRange:${G.videoRange} hls.loadLevel:${E}`)),w&&(this.firstSelection=k),k}}return-1}set nextAutoLevel(e){const t=this.deriveNextAutoLevel(e);this._nextAutoLevel!==t&&(this.nextAutoLevelKey="",this._nextAutoLevel=t)}deriveNextAutoLevel(e){const{maxAutoLevel:t,minAutoLevel:s}=this.hls;return Math.min(Math.max(e,s),t)}}const OS={search:function(i,e){let t=0,s=i.length-1,n=null,r=null;for(;t<=s;){n=(t+s)/2|0,r=i[n];const l=e(r);if(l>0)t=n+1;else if(l<0)s=n-1;else return r}return null}};function tw(i,e,t){if(e===null||!Array.isArray(i)||!i.length||!Ce(e))return null;const s=i[0].programDateTime;if(e<(s||0))return null;const n=i[i.length-1].endProgramDateTime;if(e>=(n||0))return null;for(let r=0;r<i.length;++r){const l=i[r];if(iw(e,t,l))return l}return null}function La(i,e,t=0,s=0,n=.005){let r=null;if(i){r=e[1+i.sn-e[0].sn]||null;const c=i.endDTS-t;c>0&&c<15e-7&&(t+=15e-7),r&&i.level!==r.level&&r.end<=i.end&&(r=e[2+i.sn-e[0].sn]||null)}else t===0&&e[0].start===0&&(r=e[0]);if(r&&((!i||i.level===r.level)&&gy(t,s,r)===0||sw(r,i,Math.min(n,s))))return r;const l=OS.search(e,gy.bind(null,t,s));return l&&(l!==i||!r)?l:r}function sw(i,e,t){if(e&&e.start===0&&e.level<i.level&&(e.endPTS||0)>0){const s=e.tagList.reduce((n,r)=>(r[0]==="INF"&&(n+=parseFloat(r[1])),n),t);return i.start<=s}return!1}function gy(i=0,e=0,t){if(t.start<=i&&t.start+t.duration>i)return 0;const s=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0));return t.start+t.duration-s<=i?1:t.start-s>i&&t.start?-1:0}function iw(i,e,t){const s=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0))*1e3;return(t.endProgramDateTime||0)-s>i}function NS(i,e,t){if(i&&i.startCC<=e&&i.endCC>=e){let s=i.fragments;const{fragmentHint:n}=i;n&&(s=s.concat(n));let r;return OS.search(s,l=>l.cc<e?1:l.cc>e?-1:(r=l,l.end<=t?1:l.start>t?-1:0)),r||null}return null}function Xc(i){switch(i.details){case Q.FRAG_LOAD_TIMEOUT:case Q.KEY_LOAD_TIMEOUT:case Q.LEVEL_LOAD_TIMEOUT:case Q.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function DS(i){return i.details.startsWith("key")}function kS(i){return DS(i)&&!!i.frag&&!i.frag.decryptdata}function vy(i,e){const t=Xc(e);return i.default[`${t?"timeout":"error"}Retry`]}function sm(i,e){const t=i.backoff==="linear"?1:Math.pow(2,e);return Math.min(t*i.retryDelayMs,i.maxRetryDelayMs)}function yy(i){return vt(vt({},i),{errorRetry:null,timeoutRetry:null})}function Wc(i,e,t,s){if(!i)return!1;const n=s?.code,r=e<i.maxNumRetry&&(nw(n)||!!t);return i.shouldRetry?i.shouldRetry(i,e,t,s,r):r}function nw(i){return bf(i)||!!i&&(i<400||i>499)}function bf(i){return i===0&&navigator.onLine===!1}var gs={DoNothing:0,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,RetryRequest:5},ei={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,MoveAllAlternatesMatchingKey:4};class aw extends Ti{constructor(e){super("error-controller",e.logger),this.hls=void 0,this.playlistError=0,this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(L.ERROR,this.onError,this),e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off(L.ERROR,this.onError,this),e.off(L.ERROR,this.onErrorOut,this),e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return e?.type===ke.MAIN?e.level:this.getVariantIndex()}getVariantIndex(){var e;const t=this.hls,s=t.currentLevel;return(e=t.loadLevelObj)!=null&&e.details||s===-1?t.loadLevel:s}variantHasKey(e,t){if(e){var s;if((s=e.details)!=null&&s.hasKey(t))return!0;const n=e.audioGroups;if(n)return this.hls.allAudioTracks.filter(l=>n.indexOf(l.groupId)>=0).some(l=>{var c;return(c=l.details)==null?void 0:c.hasKey(t)})}return!1}onManifestLoading(){this.playlistError=0}onLevelUpdated(){this.playlistError=0}onError(e,t){var s;if(t.fatal)return;const n=this.hls,r=t.context;switch(t.details){case Q.FRAG_LOAD_ERROR:case Q.FRAG_LOAD_TIMEOUT:case Q.KEY_LOAD_ERROR:case Q.KEY_LOAD_TIMEOUT:t.errorAction=this.getFragRetryOrSwitchAction(t);return;case Q.FRAG_PARSING_ERROR:if((s=t.frag)!=null&&s.gap){t.errorAction=br();return}case Q.FRAG_GAP:case Q.FRAG_DECRYPT_ERROR:{t.errorAction=this.getFragRetryOrSwitchAction(t),t.errorAction.action=gs.SendAlternateToPenaltyBox;return}case Q.LEVEL_EMPTY_ERROR:case Q.LEVEL_PARSING_ERROR:{var l;const h=t.parent===ke.MAIN?t.level:n.loadLevel;t.details===Q.LEVEL_EMPTY_ERROR&&((l=t.context)!=null&&(l=l.levelDetails)!=null&&l.live)?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,h):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,h))}return;case Q.LEVEL_LOAD_ERROR:case Q.LEVEL_LOAD_TIMEOUT:typeof r?.level=="number"&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,r.level));return;case Q.AUDIO_TRACK_LOAD_ERROR:case Q.AUDIO_TRACK_LOAD_TIMEOUT:case Q.SUBTITLE_LOAD_ERROR:case Q.SUBTITLE_TRACK_LOAD_TIMEOUT:if(r){const h=n.loadLevelObj;if(h&&(r.type===tt.AUDIO_TRACK&&h.hasAudioGroup(r.groupId)||r.type===tt.SUBTITLE_TRACK&&h.hasSubtitleGroup(r.groupId))){t.errorAction=this.getPlaylistRetryOrSwitchAction(t,n.loadLevel),t.errorAction.action=gs.SendAlternateToPenaltyBox,t.errorAction.flags=ei.MoveAllAlternatesMatchingHost;return}}return;case Q.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:t.errorAction={action:gs.SendAlternateToPenaltyBox,flags:ei.MoveAllAlternatesMatchingHDCP};return;case Q.KEY_SYSTEM_SESSION_UPDATE_FAILED:case Q.KEY_SYSTEM_STATUS_INTERNAL_ERROR:case Q.KEY_SYSTEM_NO_SESSION:t.errorAction={action:gs.SendAlternateToPenaltyBox,flags:ei.MoveAllAlternatesMatchingKey};return;case Q.BUFFER_ADD_CODEC_ERROR:case Q.REMUX_ALLOC_ERROR:case Q.BUFFER_APPEND_ERROR:if(!t.errorAction){var c;t.errorAction=this.getLevelSwitchAction(t,(c=t.level)!=null?c:n.loadLevel)}return;case Q.INTERNAL_EXCEPTION:case Q.BUFFER_APPENDING_ERROR:case Q.BUFFER_FULL_ERROR:case Q.LEVEL_SWITCH_ERROR:case Q.BUFFER_STALLED_ERROR:case Q.BUFFER_SEEK_OVER_HOLE:case Q.BUFFER_NUDGE_ON_STALL:t.errorAction=br();return}t.type===je.KEY_SYSTEM_ERROR&&(t.levelRetry=!1,t.errorAction=br())}getPlaylistRetryOrSwitchAction(e,t){const s=this.hls,n=vy(s.config.playlistLoadPolicy,e),r=this.playlistError++;if(Wc(n,r,Xc(e),e.response))return{action:gs.RetryRequest,flags:ei.None,retryConfig:n,retryCount:r};const c=this.getLevelSwitchAction(e,t);return n&&(c.retryConfig=n,c.retryCount=r),c}getFragRetryOrSwitchAction(e){const t=this.hls,s=this.getVariantLevelIndex(e.frag),n=t.levels[s],{fragLoadPolicy:r,keyLoadPolicy:l}=t.config,c=vy(DS(e)?l:r,e),h=t.levels.reduce((f,p)=>f+p.fragmentError,0);if(n&&(e.details!==Q.FRAG_GAP&&n.fragmentError++,!kS(e)&&Wc(c,h,Xc(e),e.response)))return{action:gs.RetryRequest,flags:ei.None,retryConfig:c,retryCount:h};const d=this.getLevelSwitchAction(e,s);return c&&(d.retryConfig=c,d.retryCount=h),d}getLevelSwitchAction(e,t){const s=this.hls;t==null&&(t=s.loadLevel);const n=this.hls.levels[t];if(n){var r,l;const d=e.details;n.loadError++,d===Q.BUFFER_APPEND_ERROR&&n.fragmentError++;let f=-1;const{levels:p,loadLevel:v,minAutoLevel:x,maxAutoLevel:S}=s;!s.autoLevelEnabled&&!s.config.preserveManualLevelOnError&&(s.loadLevel=-1);const T=(r=e.frag)==null?void 0:r.type,A=(T===ke.AUDIO&&d===Q.FRAG_PARSING_ERROR||e.sourceBufferName==="audio"&&(d===Q.BUFFER_ADD_CODEC_ERROR||d===Q.BUFFER_APPEND_ERROR))&&p.some(({audioCodec:U})=>n.audioCodec!==U),R=e.sourceBufferName==="video"&&(d===Q.BUFFER_ADD_CODEC_ERROR||d===Q.BUFFER_APPEND_ERROR)&&p.some(({codecSet:U,audioCodec:D})=>n.codecSet!==U&&n.audioCodec===D),{type:w,groupId:N}=(l=e.context)!=null?l:{};for(let U=p.length;U--;){const D=(U+v)%p.length;if(D!==v&&D>=x&&D<=S&&p[D].loadError===0){var c,h;const F=p[D];if(d===Q.FRAG_GAP&&T===ke.MAIN&&e.frag){const j=p[D].details;if(j){const M=La(e.frag,j.fragments,e.frag.start);if(M!=null&&M.gap)continue}}else{if(w===tt.AUDIO_TRACK&&F.hasAudioGroup(N)||w===tt.SUBTITLE_TRACK&&F.hasSubtitleGroup(N))continue;if(T===ke.AUDIO&&(c=n.audioGroups)!=null&&c.some(j=>F.hasAudioGroup(j))||T===ke.SUBTITLE&&(h=n.subtitleGroups)!=null&&h.some(j=>F.hasSubtitleGroup(j))||A&&n.audioCodec===F.audioCodec||R&&n.codecSet===F.codecSet||!A&&n.codecSet!==F.codecSet)continue}f=D;break}}if(f>-1&&s.loadLevel!==f)return e.levelRetry=!0,this.playlistError=0,{action:gs.SendAlternateToPenaltyBox,flags:ei.None,nextAutoLevel:f}}return{action:gs.SendAlternateToPenaltyBox,flags:ei.MoveAllAlternatesMatchingHost}}onErrorOut(e,t){var s;switch((s=t.errorAction)==null?void 0:s.action){case gs.DoNothing:break;case gs.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(t),!t.errorAction.resolved&&t.details!==Q.FRAG_GAP?t.fatal=!0:/MediaSource readyState: ended/.test(t.error.message)&&(this.warn(`MediaSource ended after "${t.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError());break}if(t.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(e){const t=this.hls,s=e.errorAction;if(!s)return;const{flags:n}=s,r=s.nextAutoLevel;switch(n){case ei.None:this.switchLevel(e,r);break;case ei.MoveAllAlternatesMatchingHDCP:{const h=this.getVariantLevelIndex(e.frag),d=t.levels[h],f=d?.attrs["HDCP-LEVEL"];if(s.hdcpLevel=f,f==="NONE")this.warn("HDCP policy resticted output with HDCP-LEVEL=NONE");else if(f){t.maxHdcpLevel=Sf[Sf.indexOf(f)-1],s.resolved=!0,this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`);break}}case ei.MoveAllAlternatesMatchingKey:{const h=e.decryptdata;if(h){const d=this.hls.levels,f=d.length;for(let v=f;v--;)if(this.variantHasKey(d[v],h)){var l,c;this.log(`Banned key found in level ${v} (${d[v].bitrate}bps) or audio group "${(l=d[v].audioGroups)==null?void 0:l.join(",")}" (${(c=e.frag)==null?void 0:c.type} fragment) ${vs(h.keyId||[])}`),d[v].fragmentError++,d[v].loadError++,this.log(`Removing level ${v} with key error (${e.error})`),this.hls.removeLevel(v)}const p=e.frag;if(this.hls.levels.length<f)s.resolved=!0;else if(p&&p.type!==ke.MAIN){const v=p.decryptdata;v&&!h.matches(v)&&(s.resolved=!0)}}break}}s.resolved||this.switchLevel(e,r)}switchLevel(e,t){if(t!==void 0&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,e.details===Q.BUFFER_ADD_CODEC_ERROR&&e.mimeType&&e.sourceBufferName!=="audiovideo")){const s=xf(e.mimeType),n=this.hls.levels;for(let r=n.length;r--;)n[r][`${e.sourceBufferName}Codec`]===s&&(this.log(`Removing level ${r} for ${e.details} ("${s}" not supported)`),this.hls.removeLevel(r))}}}function br(i){const e={action:gs.DoNothing,flags:ei.None};return i&&(e.resolved=!0),e}var ls={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class rw{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e&&(e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.BUFFER_APPENDED,this.onBufferAppended,this),e.on(L.FRAG_BUFFERED,this.onFragBuffered,this),e.on(L.FRAG_LOADED,this.onFragLoaded,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.BUFFER_APPENDED,this.onBufferAppended,this),e.off(L.FRAG_BUFFERED,this.onFragBuffered,this),e.off(L.FRAG_LOADED,this.onFragLoaded,this))}destroy(){this._unregisterListeners(),this.hls=this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){const s=this.activePartLists[t];if(s)for(let n=s.length;n--;){const r=s[n];if(!r)break;if(r.start<=e&&e<=r.end&&r.loaded)return r}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){return this.getFragAtPos(e,t,!0)}getFragAtPos(e,t,s){const{fragments:n}=this,r=Object.keys(n);for(let l=r.length;l--;){const c=n[r[l]];if(c?.body.type===t&&(!s||c.buffered)){const h=c.body;if(h.start<=e&&e<=h.end)return h}}return null}detectEvictedFragments(e,t,s,n,r){this.timeRanges&&(this.timeRanges[e]=t);const l=n?.fragment.sn||-1;Object.keys(this.fragments).forEach(c=>{const h=this.fragments[c];if(!h||l>=h.body.sn)return;if(!h.buffered&&(!h.loaded||r)){h.body.type===s&&this.removeFragment(h.body);return}const d=h.range[e];if(d){if(d.time.length===0){this.removeFragment(h.body);return}d.time.some(f=>{const p=!this.isTimeBuffered(f.startPTS,f.endPTS,t);return p&&this.removeFragment(h.body),p})}})}detectPartialFragments(e){const t=this.timeRanges;if(!t||e.frag.sn==="initSegment")return;const s=e.frag,n=pr(s),r=this.fragments[n];if(!r||r.buffered&&s.gap)return;const l=!s.relurl;Object.keys(t).forEach(c=>{const h=s.elementaryStreams[c];if(!h)return;const d=t[c],f=l||h.partial===!0;r.range[c]=this.getBufferedTimes(s,e.part,f,d)}),r.loaded=null,Object.keys(r.range).length?(this.bufferedEnd(r,s),pc(r)||this.removeParts(s.sn-1,s.type)):this.removeFragment(r.body)}bufferedEnd(e,t){e.buffered=!0,(e.body.endList=t.endList||e.body.endList)&&(this.endListFragments[e.body.type]=e)}removeParts(e,t){const s=this.activePartLists[t];s&&(this.activePartLists[t]=xy(s,n=>n.fragment.sn>=e))}fragBuffered(e,t){const s=pr(e);let n=this.fragments[s];!n&&t&&(n=this.fragments[s]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),n&&(n.loaded=null,this.bufferedEnd(n,e))}getBufferedTimes(e,t,s,n){const r={time:[],partial:s},l=e.start,c=e.end,h=e.minEndPTS||c,d=e.maxStartPTS||l;for(let f=0;f<n.length;f++){const p=n.start(f)-this.bufferPadding,v=n.end(f)+this.bufferPadding;if(d>=p&&h<=v){r.time.push({startPTS:Math.max(l,n.start(f)),endPTS:Math.min(c,n.end(f))});break}else if(l<v&&c>p){const x=Math.max(l,n.start(f)),S=Math.min(c,n.end(f));S>x&&(r.partial=!0,r.time.push({startPTS:x,endPTS:S}))}else if(c<=p)break}return r}getPartialFragment(e){let t=null,s,n,r,l=0;const{bufferPadding:c,fragments:h}=this;return Object.keys(h).forEach(d=>{const f=h[d];f&&pc(f)&&(n=f.body.start-c,r=f.body.end+c,e>=n&&e<=r&&(s=Math.min(e-n,r-e),l<=s&&(t=f.body,l=s)))}),t}isEndListAppended(e){const t=this.endListFragments[e];return t!==void 0&&(t.buffered||pc(t))}getState(e){const t=pr(e),s=this.fragments[t];return s?s.buffered?pc(s)?ls.PARTIAL:ls.OK:ls.APPENDING:ls.NOT_LOADED}isTimeBuffered(e,t,s){let n,r;for(let l=0;l<s.length;l++){if(n=s.start(l)-this.bufferPadding,r=s.end(l)+this.bufferPadding,e>=n&&t<=r)return!0;if(t<=n)return!1}return!1}onManifestLoading(){this.removeAllFragments()}onFragLoaded(e,t){if(t.frag.sn==="initSegment"||t.frag.bitrateTest)return;const s=t.frag,n=t.part?null:t,r=pr(s);this.fragments[r]={body:s,appendedPTS:null,loaded:n,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){const{frag:s,part:n,timeRanges:r,type:l}=t;if(s.sn==="initSegment")return;const c=s.type;if(n){let d=this.activePartLists[c];d||(this.activePartLists[c]=d=[]),d.push(n)}this.timeRanges=r;const h=r[l];this.detectEvictedFragments(l,h,c,n)}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){const t=pr(e);return!!this.fragments[t]}hasFragments(e){const{fragments:t}=this,s=Object.keys(t);if(!e)return s.length>0;for(let n=s.length;n--;){const r=t[s[n]];if(r?.body.type===e)return!0}return!1}hasParts(e){var t;return!!((t=this.activePartLists[e])!=null&&t.length)}removeFragmentsInRange(e,t,s,n,r){n&&!this.hasGaps||Object.keys(this.fragments).forEach(l=>{const c=this.fragments[l];if(!c)return;const h=c.body;h.type!==s||n&&!h.gap||h.start<t&&h.end>e&&(c.buffered||r)&&this.removeFragment(h)})}removeFragment(e){const t=pr(e);e.clearElementaryStreamInfo();const s=this.activePartLists[e.type];if(s){const n=e.sn;this.activePartLists[e.type]=xy(s,r=>r.fragment.sn!==n)}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){var e;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;const t=(e=this.hls)==null||(e=e.latestLevelDetails)==null?void 0:e.partList;t&&t.forEach(s=>s.clearElementaryStreamInfo())}}function pc(i){var e,t,s;return i.buffered&&!!(i.body.gap||(e=i.range.video)!=null&&e.partial||(t=i.range.audio)!=null&&t.partial||(s=i.range.audiovideo)!=null&&s.partial)}function pr(i){return`${i.type}_${i.level}_${i.sn}`}function xy(i,e){return i.filter(t=>{const s=e(t);return s||t.clearElementaryStreamInfo(),s})}var ta={cbc:0,ctr:1};class lw{constructor(e,t,s){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=e,this.aesIV=t,this.aesMode=s}decrypt(e,t){switch(this.aesMode){case ta.cbc:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e);case ta.ctr:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},t,e);default:throw new Error(`[AESCrypto] invalid aes mode ${this.aesMode}`)}}}function ow(i){const e=i.byteLength,t=e&&new DataView(i.buffer).getUint8(e-1);return t?i.slice(0,e-t):i}class cw{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),s=new Uint32Array(4);for(let n=0;n<4;n++)s[n]=t.getUint32(n*4);return s}initTable(){const e=this.sBox,t=this.invSBox,s=this.subMix,n=s[0],r=s[1],l=s[2],c=s[3],h=this.invSubMix,d=h[0],f=h[1],p=h[2],v=h[3],x=new Uint32Array(256);let S=0,T=0,E=0;for(E=0;E<256;E++)E<128?x[E]=E<<1:x[E]=E<<1^283;for(E=0;E<256;E++){let A=T^T<<1^T<<2^T<<3^T<<4;A=A>>>8^A&255^99,e[S]=A,t[A]=S;const _=x[S],R=x[_],w=x[R];let N=x[A]*257^A*16843008;n[S]=N<<24|N>>>8,r[S]=N<<16|N>>>16,l[S]=N<<8|N>>>24,c[S]=N,N=w*16843009^R*65537^_*257^S*16843008,d[A]=N<<24|N>>>8,f[A]=N<<16|N>>>16,p[A]=N<<8|N>>>24,v[A]=N,S?(S=_^x[x[x[w^_]]],T^=x[x[T]]):S=T=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let s=!0,n=0;for(;n<t.length&&s;)s=t[n]===this.key[n],n++;if(s)return;this.key=t;const r=this.keySize=t.length;if(r!==4&&r!==6&&r!==8)throw new Error("Invalid aes key size="+r);const l=this.ksRows=(r+6+1)*4;let c,h;const d=this.keySchedule=new Uint32Array(l),f=this.invKeySchedule=new Uint32Array(l),p=this.sBox,v=this.rcon,x=this.invSubMix,S=x[0],T=x[1],E=x[2],A=x[3];let _,R;for(c=0;c<l;c++){if(c<r){_=d[c]=t[c];continue}R=_,c%r===0?(R=R<<8|R>>>24,R=p[R>>>24]<<24|p[R>>>16&255]<<16|p[R>>>8&255]<<8|p[R&255],R^=v[c/r|0]<<24):r>6&&c%r===4&&(R=p[R>>>24]<<24|p[R>>>16&255]<<16|p[R>>>8&255]<<8|p[R&255]),d[c]=_=(d[c-r]^R)>>>0}for(h=0;h<l;h++)c=l-h,h&3?R=d[c]:R=d[c-4],h<4||c<=4?f[h]=R:f[h]=S[p[R>>>24]]^T[p[R>>>16&255]]^E[p[R>>>8&255]]^A[p[R&255]],f[h]=f[h]>>>0}networkToHostOrderSwap(e){return e<<24|(e&65280)<<8|(e&16711680)>>8|e>>>24}decrypt(e,t,s){const n=this.keySize+6,r=this.invKeySchedule,l=this.invSBox,c=this.invSubMix,h=c[0],d=c[1],f=c[2],p=c[3],v=this.uint8ArrayToUint32Array_(s);let x=v[0],S=v[1],T=v[2],E=v[3];const A=new Int32Array(e),_=new Int32Array(A.length);let R,w,N,U,D,F,j,M,H,K,se,ne,de,k;const G=this.networkToHostOrderSwap;for(;t<A.length;){for(H=G(A[t]),K=G(A[t+1]),se=G(A[t+2]),ne=G(A[t+3]),D=H^r[0],F=ne^r[1],j=se^r[2],M=K^r[3],de=4,k=1;k<n;k++)R=h[D>>>24]^d[F>>16&255]^f[j>>8&255]^p[M&255]^r[de],w=h[F>>>24]^d[j>>16&255]^f[M>>8&255]^p[D&255]^r[de+1],N=h[j>>>24]^d[M>>16&255]^f[D>>8&255]^p[F&255]^r[de+2],U=h[M>>>24]^d[D>>16&255]^f[F>>8&255]^p[j&255]^r[de+3],D=R,F=w,j=N,M=U,de=de+4;R=l[D>>>24]<<24^l[F>>16&255]<<16^l[j>>8&255]<<8^l[M&255]^r[de],w=l[F>>>24]<<24^l[j>>16&255]<<16^l[M>>8&255]<<8^l[D&255]^r[de+1],N=l[j>>>24]<<24^l[M>>16&255]<<16^l[D>>8&255]<<8^l[F&255]^r[de+2],U=l[M>>>24]<<24^l[D>>16&255]<<16^l[F>>8&255]<<8^l[j&255]^r[de+3],_[t]=G(R^x),_[t+1]=G(U^S),_[t+2]=G(N^T),_[t+3]=G(w^E),x=H,S=K,T=se,E=ne,t=t+4}return _.buffer}}class uw{constructor(e,t,s){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=e,this.key=t,this.aesMode=s}expandKey(){const e=dw(this.aesMode);return this.subtle.importKey("raw",this.key,{name:e},!1,["encrypt","decrypt"])}}function dw(i){switch(i){case ta.cbc:return"AES-CBC";case ta.ctr:return"AES-CTR";default:throw new Error(`[FastAESKey] invalid aes mode ${i}`)}}const hw=16;class im{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const s=self.crypto;s&&(this.subtle=s.subtle||s.webkitSubtle)}catch{}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;const s=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?ow(s):s}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,s,n){return this.useSoftware?new Promise((r,l)=>{const c=ArrayBuffer.isView(e)?e:new Uint8Array(e);this.softwareDecrypt(c,t,s,n);const h=this.flush();h?r(h.buffer):l(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,s,n)}softwareDecrypt(e,t,s,n){const{currentIV:r,currentResult:l,remainderData:c}=this;if(n!==ta.cbc||t.byteLength!==16)return yt.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),c&&(e=bi(c,e),this.remainderData=null);const h=this.getValidChunk(e);if(!h.length)return null;r&&(s=r);let d=this.softwareDecrypter;d||(d=this.softwareDecrypter=new cw),d.expandKey(t);const f=l;return this.currentResult=d.decrypt(h.buffer,0,s),this.currentIV=h.slice(-16).buffer,f||null}webCryptoDecrypt(e,t,s,n){if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,t,s,n));this.key=t,this.fastAesKey=new uw(this.subtle,t,n)}return this.fastAesKey.expandKey().then(r=>this.subtle?(this.logOnce("WebCrypto AES decrypt"),new lw(this.subtle,new Uint8Array(s),n).decrypt(e.buffer,r)):Promise.reject(new Error("web crypto not initialized"))).catch(r=>(yt.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${r.name}: ${r.message}`),this.onWebCryptoError(e,t,s,n)))}onWebCryptoError(e,t,s,n){const r=this.enableSoftwareAES;if(r){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,s,n);const l=this.flush();if(l)return l.buffer}throw new Error("WebCrypto"+(r?" and softwareDecrypt":"")+": failed to decrypt data")}getValidChunk(e){let t=e;const s=e.length-e.length%hw;return s!==e.length&&(t=e.slice(0,s),this.remainderData=e.slice(s)),t}logOnce(e){this.logEnabled&&(yt.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}const Sy=Math.pow(2,17);class fw{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){const s=e.url;if(!s)return Promise.reject(new yn({type:je.NETWORK_ERROR,details:Q.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error(`Fragment does not have a ${s?"part list":"url"}`),networkDetails:null}));this.abort();const n=this.config,r=n.fLoader,l=n.loader;return new Promise((c,h)=>{if(this.loader&&this.loader.destroy(),e.gap)if(e.tagList.some(S=>S[0]==="GAP")){h(Ey(e));return}else e.gap=!1;const d=this.loader=r?new r(n):new l(n),f=by(e);e.loader=d;const p=yy(n.fragLoadPolicy.default),v={loadPolicy:p,timeout:p.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:e.sn==="initSegment"?1/0:Sy};e.stats=d.stats;const x={onSuccess:(S,T,E,A)=>{this.resetLoader(e,d);let _=S.data;E.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(_.slice(0,16)),_=_.slice(16)),c({frag:e,part:null,payload:_,networkDetails:A})},onError:(S,T,E,A)=>{this.resetLoader(e,d),h(new yn({type:je.NETWORK_ERROR,details:Q.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:vt({url:s,data:void 0},S),error:new Error(`HTTP Error ${S.code} ${S.text}`),networkDetails:E,stats:A}))},onAbort:(S,T,E)=>{this.resetLoader(e,d),h(new yn({type:je.NETWORK_ERROR,details:Q.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:E,stats:S}))},onTimeout:(S,T,E)=>{this.resetLoader(e,d),h(new yn({type:je.NETWORK_ERROR,details:Q.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${v.timeout}ms`),networkDetails:E,stats:S}))}};t&&(x.onProgress=(S,T,E,A)=>t({frag:e,part:null,payload:E,networkDetails:A})),d.load(f,v,x)})}loadPart(e,t,s){this.abort();const n=this.config,r=n.fLoader,l=n.loader;return new Promise((c,h)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap){h(Ey(e,t));return}const d=this.loader=r?new r(n):new l(n),f=by(e,t);e.loader=d;const p=yy(n.fragLoadPolicy.default),v={loadPolicy:p,timeout:p.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:Sy};t.stats=d.stats,d.load(f,v,{onSuccess:(x,S,T,E)=>{this.resetLoader(e,d),this.updateStatsFromPart(e,t);const A={frag:e,part:t,payload:x.data,networkDetails:E};s(A),c(A)},onError:(x,S,T,E)=>{this.resetLoader(e,d),h(new yn({type:je.NETWORK_ERROR,details:Q.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:vt({url:f.url,data:void 0},x),error:new Error(`HTTP Error ${x.code} ${x.text}`),networkDetails:T,stats:E}))},onAbort:(x,S,T)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,d),h(new yn({type:je.NETWORK_ERROR,details:Q.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:T,stats:x}))},onTimeout:(x,S,T)=>{this.resetLoader(e,d),h(new yn({type:je.NETWORK_ERROR,details:Q.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error(`Timeout after ${v.timeout}ms`),networkDetails:T,stats:x}))}})})}updateStatsFromPart(e,t){const s=e.stats,n=t.stats,r=n.total;if(s.loaded+=n.loaded,r){const h=Math.round(e.duration/t.duration),d=Math.min(Math.round(s.loaded/r),h),p=(h-d)*Math.round(s.loaded/d);s.total=s.loaded+p}else s.total=Math.max(s.loaded,s.total);const l=s.loading,c=n.loading;l.start?l.first+=c.first-c.start:(l.start=c.start,l.first=c.first),l.end=c.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function by(i,e=null){const t=e||i,s={frag:i,part:e,responseType:"arraybuffer",url:t.url,headers:{},rangeStart:0,rangeEnd:0},n=t.byteRangeStartOffset,r=t.byteRangeEndOffset;if(Ce(n)&&Ce(r)){var l;let c=n,h=r;if(i.sn==="initSegment"&&mw((l=i.decryptdata)==null?void 0:l.method)){const d=r-n;d%16&&(h=r+(16-d%16)),n!==0&&(s.resetIV=!0,c=n-16)}s.rangeStart=c,s.rangeEnd=h}return s}function Ey(i,e){const t=new Error(`GAP ${i.gap?"tag":"attribute"} found`),s={type:je.MEDIA_ERROR,details:Q.FRAG_GAP,fatal:!1,frag:i,error:t,networkDetails:null};return e&&(s.part=e),(e||i).stats.aborted=!0,new yn(s)}function mw(i){return i==="AES-128"||i==="AES-256"}class yn extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class PS extends Ti{constructor(e,t){super(e,t),this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}class nm{constructor(e,t,s,n=0,r=-1,l=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=gc(),this.buffering={audio:gc(),video:gc(),audiovideo:gc()},this.level=e,this.sn=t,this.id=s,this.size=n,this.part=r,this.partial=l}}function gc(){return{start:0,executeStart:0,executeEnd:0,end:0}}const Ty={length:0,start:()=>0,end:()=>0};class qe{static isBuffered(e,t){if(e){const s=qe.getBuffered(e);for(let n=s.length;n--;)if(t>=s.start(n)&&t<=s.end(n))return!0}return!1}static bufferedRanges(e){if(e){const t=qe.getBuffered(e);return qe.timeRangesToArray(t)}return[]}static timeRangesToArray(e){const t=[];for(let s=0;s<e.length;s++)t.push({start:e.start(s),end:e.end(s)});return t}static bufferInfo(e,t,s){if(e){const n=qe.bufferedRanges(e);if(n.length)return qe.bufferedInfo(n,t,s)}return{len:0,start:t,end:t,bufferedIndex:-1}}static bufferedInfo(e,t,s){t=Math.max(0,t),e.length>1&&e.sort((f,p)=>f.start-p.start||p.end-f.end);let n=-1,r=[];if(s)for(let f=0;f<e.length;f++){t>=e[f].start&&t<=e[f].end&&(n=f);const p=r.length;if(p){const v=r[p-1].end;e[f].start-v<s?e[f].end>v&&(r[p-1].end=e[f].end):r.push(e[f])}else r.push(e[f])}else r=e;let l=0,c,h=t,d=t;for(let f=0;f<r.length;f++){const p=r[f].start,v=r[f].end;if(n===-1&&t>=p&&t<=v&&(n=f),t+s>=p&&t<v)h=p,d=v,l=d-t;else if(t+s<p){c=p;break}}return{len:l,start:h||0,end:d||0,nextStart:c,buffered:e,bufferedIndex:n}}static getBuffered(e){try{return e.buffered||Ty}catch(t){return yt.log("failed to get media.buffered",t),Ty}}}const US=/\{\$([a-zA-Z0-9-_]+)\}/g;function Ay(i){return US.test(i)}function Ef(i,e){if(i.variableList!==null||i.hasVariableRefs){const t=i.variableList;return e.replace(US,s=>{const n=s.substring(2,s.length-1),r=t?.[n];return r===void 0?(i.playlistParsingError||(i.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${n}"`)),s):r})}return e}function _y(i,e,t){let s=i.variableList;s||(i.variableList=s={});let n,r;if("QUERYPARAM"in e){n=e.QUERYPARAM;try{const l=new self.URL(t).searchParams;if(l.has(n))r=l.get(n);else throw new Error(`"${n}" does not match any query parameter in URI: "${t}"`)}catch(l){i.playlistParsingError||(i.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${l.message}`))}}else n=e.NAME,r=e.VALUE;n in s?i.playlistParsingError||(i.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${n}"`)):s[n]=r||""}function pw(i,e,t){const s=e.IMPORT;if(t&&s in t){let n=i.variableList;n||(i.variableList=n={}),n[s]=t[s]}else i.playlistParsingError||(i.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${s}"`))}const gw=/^(\d+)x(\d+)$/,Iy=/(.+?)=(".*?"|.*?)(?:,|$)/g;class Bt{constructor(e,t){typeof e=="string"&&(e=Bt.parseAttrList(e,t)),At(this,e)}get clientAttrs(){return Object.keys(this).filter(e=>e.substring(0,2)==="X-")}decimalInteger(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(t.length&1?"0":"")+t;const s=new Uint8Array(t.length/2);for(let n=0;n<t.length/2;n++)s[n]=parseInt(t.slice(n*2,n*2+2),16);return s}return null}hexadecimalIntegerAsNumber(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){const s=this[e];return s?parseFloat(s):t}enumeratedString(e){return this[e]}enumeratedStringList(e,t){const s=this[e];return(s?s.split(/[ ,]+/):[]).reduce((n,r)=>(n[r.toLowerCase()]=!0,n),t)}bool(e){return this[e]==="YES"}decimalResolution(e){const t=gw.exec(this[e]);if(t!==null)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e,t){let s;const n={};for(Iy.lastIndex=0;(s=Iy.exec(e))!==null;){const l=s[1].trim();let c=s[2];const h=c.indexOf('"')===0&&c.lastIndexOf('"')===c.length-1;let d=!1;if(h)c=c.slice(1,-1);else switch(l){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":d=!0}if(t&&(h||d))c=Ef(t,c);else if(!d&&!h)switch(l){case"CLOSED-CAPTIONS":if(c==="NONE")break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":yt.warn(`${e}: attribute ${l} is missing quotes`)}n[l]=c}return n}}const vw="com.apple.hls.interstitial";function yw(i){return i!=="ID"&&i!=="CLASS"&&i!=="CUE"&&i!=="START-DATE"&&i!=="DURATION"&&i!=="END-DATE"&&i!=="END-ON-NEXT"}function xw(i){return i==="SCTE35-OUT"||i==="SCTE35-IN"||i==="SCTE35-CMD"}class MS{constructor(e,t,s=0){var n;if(this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=t?.tagAnchor||null,this.tagOrder=(n=t?.tagOrder)!=null?n:s,t){const r=t.attr;for(const l in r)if(Object.prototype.hasOwnProperty.call(e,l)&&e[l]!==r[l]){yt.warn(`DATERANGE tag attribute: "${l}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=l;break}e=At(new Bt({}),r,e)}if(this.attr=e,t?(this._startDate=t._startDate,this._cue=t._cue,this._endDate=t._endDate,this._dateAtEnd=t._dateAtEnd):this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const r=t?.endDate||new Date(this.attr["END-DATE"]);Ce(r.getTime())&&(this._endDate=r)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get cue(){const e=this._cue;return e===void 0?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):e}get startTime(){const{tagAnchor:e}=this;return e===null||e.programDateTime===null?(yt.warn(`Expected tagAnchor Fragment with PDT set for DateRange "${this.id}": ${e}`),NaN):e.start+(this.startDate.getTime()-e.programDateTime)/1e3}get startDate(){return this._startDate}get endDate(){const e=this._endDate||this._dateAtEnd;if(e)return e;const t=this.duration;return t!==null?this._dateAtEnd=new Date(this._startDate.getTime()+t*1e3):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(Ce(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isInterstitial(){return this.class===vw}get isValid(){return!!this.id&&!this._badValueForSameId&&Ce(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}const Sw=10;class bw{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e){this.advanced=!0,this.updated=!0;return}const t=this.lastPartSn-e.lastPartSn,s=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!s||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||t===0&&s>0,this.updated||this.advanced?this.misses=Math.floor(e.misses*.6):this.misses=e.misses+1}hasKey(e){return this.encryptedFragments.some(t=>{let s=t.decryptdata;return s||(t.setKeyFormat(e.keyFormat),s=t.decryptdata),!!s&&e.matches(s)})}get hasProgramDateTime(){return this.fragments.length?Ce(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||Sw}get drift(){const e=this.driftEndTime-this.driftStartTime;return e>0?(this.driftEnd-this.driftStart)*1e3/e:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){return this.fragments.length?this.fragments[this.fragments.length-1].end:0}get fragmentStart(){return this.fragments.length?this.fragments[0].start:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].index:-1}get maxPartIndex(){const e=this.partList;if(e){const t=this.lastPartIndex;if(t!==-1){for(let s=e.length;s--;)if(e[s].index>t)return e[s].index;return t}}return 0}get lastPartSn(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}get expired(){if(this.live&&this.age&&this.misses<3){const e=this.partEnd-this.fragmentStart;return this.age>Math.max(e,this.totalduration)+this.levelTargetDuration}return!1}}function Zc(i,e){return i.length===e.length?!i.some((t,s)=>t!==e[s]):!1}function Ry(i,e){return!i&&!e?!0:!i||!e?!1:Zc(i,e)}function Er(i){return i==="AES-128"||i==="AES-256"||i==="AES-256-CTR"}function am(i){switch(i){case"AES-128":case"AES-256":return ta.cbc;case"AES-256-CTR":return ta.ctr;default:throw new Error(`invalid full segment method ${i}`)}}function rm(i){return Uint8Array.from(atob(i),e=>e.charCodeAt(0))}function Tf(i){return Uint8Array.from(unescape(encodeURIComponent(i)),e=>e.charCodeAt(0))}function Ew(i){const e=Tf(i).subarray(0,16),t=new Uint8Array(16);return t.set(e,16-e.length),t}function jS(i){const e=function(s,n,r){const l=s[n];s[n]=s[r],s[r]=l};e(i,0,3),e(i,1,2),e(i,4,5),e(i,6,7)}function FS(i){const e=i.split(":");let t=null;if(e[0]==="data"&&e.length===2){const s=e[1].split(";"),n=s[s.length-1].split(",");if(n.length===2){const r=n[0]==="base64",l=n[1];r?(s.splice(-1,1),t=rm(l)):t=Ew(l)}}return t}const Jc=typeof self<"u"?self:void 0;var $t={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},ys={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function Pc(i){switch(i){case ys.FAIRPLAY:return $t.FAIRPLAY;case ys.PLAYREADY:return $t.PLAYREADY;case ys.WIDEVINE:return $t.WIDEVINE;case ys.CLEARKEY:return $t.CLEARKEY}}function Vh(i){switch(i){case $t.FAIRPLAY:return ys.FAIRPLAY;case $t.PLAYREADY:return ys.PLAYREADY;case $t.WIDEVINE:return ys.WIDEVINE;case $t.CLEARKEY:return ys.CLEARKEY}}function Ll(i){const{drmSystems:e,widevineLicenseUrl:t}=i,s=e?[$t.FAIRPLAY,$t.WIDEVINE,$t.PLAYREADY,$t.CLEARKEY].filter(n=>!!e[n]):[];return!s[$t.WIDEVINE]&&t&&s.push($t.WIDEVINE),s}const BS=(function(i){return Jc!=null&&(i=Jc.navigator)!=null&&i.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null})();function Tw(i,e,t,s){let n;switch(i){case $t.FAIRPLAY:n=["cenc","sinf"];break;case $t.WIDEVINE:case $t.PLAYREADY:n=["cenc"];break;case $t.CLEARKEY:n=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${i}`)}return Aw(n,e,t,s)}function Aw(i,e,t,s){return[{initDataTypes:i,persistentState:s.persistentState||"optional",distinctiveIdentifier:s.distinctiveIdentifier||"optional",sessionTypes:s.sessionTypes||[s.sessionType||"temporary"],audioCapabilities:e.map(r=>({contentType:`audio/mp4; codecs=${r}`,robustness:s.audioRobustness||"",encryptionScheme:s.audioEncryptionScheme||null})),videoCapabilities:t.map(r=>({contentType:`video/mp4; codecs=${r}`,robustness:s.videoRobustness||"",encryptionScheme:s.videoEncryptionScheme||null}))}]}function _w(i){var e;return!!i&&(i.sessionType==="persistent-license"||!!((e=i.sessionTypes)!=null&&e.some(t=>t==="persistent-license")))}function $S(i){const e=new Uint16Array(i.buffer,i.byteOffset,i.byteLength/2),t=String.fromCharCode.apply(null,Array.from(e)),s=t.substring(t.indexOf("<"),t.length),l=new DOMParser().parseFromString(s,"text/xml").getElementsByTagName("KID")[0];if(l){const c=l.childNodes[0]?l.childNodes[0].nodeValue:l.getAttribute("VALUE");if(c){const h=rm(c).subarray(0,16);return jS(h),h}}return null}let gr={};class Jn{static clearKeyUriToKeyIdMap(){gr={}}static setKeyIdForUri(e,t){gr[e]=t}static addKeyIdForUri(e){const t=Object.keys(gr).length%Number.MAX_SAFE_INTEGER,s=new Uint8Array(16);return new DataView(s.buffer,12,4).setUint32(0,t),gr[e]=s,s}constructor(e,t,s,n=[1],r=null,l){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=s,this.keyFormatVersions=n,this.iv=r,this.encrypted=e?e!=="NONE":!1,this.isCommonEncryption=this.encrypted&&!Er(e),l!=null&&l.startsWith("0x")&&(this.keyId=new Uint8Array(pS(l)))}matches(e){return e.uri===this.uri&&e.method===this.method&&e.encrypted===this.encrypted&&e.keyFormat===this.keyFormat&&Zc(e.keyFormatVersions,this.keyFormatVersions)&&Ry(e.iv,this.iv)&&Ry(e.keyId,this.keyId)}isSupported(){if(this.method){if(Er(this.method)||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case ys.FAIRPLAY:case ys.WIDEVINE:case ys.PLAYREADY:case ys.CLEARKEY:return["SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(e,t){if(!this.encrypted||!this.uri)return null;if(Er(this.method)){let r=this.iv;return r||(typeof e!="number"&&(yt.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0),r=Rw(e)),new Jn(this.method,this.uri,"identity",this.keyFormatVersions,r)}if(this.keyId){const r=gr[this.uri];if(r&&!Zc(this.keyId,r)&&Jn.setKeyIdForUri(this.uri,this.keyId),this.pssh)return this}const s=FS(this.uri);if(s)switch(this.keyFormat){case ys.WIDEVINE:if(this.pssh=s,!this.keyId){const r=C1(s.buffer);if(r.length){var n;const l=r[0];this.keyId=(n=l.kids)!=null&&n.length?l.kids[0]:null}}this.keyId||(this.keyId=Ly(t));break;case ys.PLAYREADY:{const r=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=w1(r,null,s),this.keyId=$S(s);break}default:{let r=s.subarray(0,16);if(r.length!==16){const l=new Uint8Array(16);l.set(r,16-r.length),r=l}this.keyId=r;break}}if(!this.keyId||this.keyId.byteLength!==16){let r;r=Iw(t),r||(r=Ly(t),r||(r=gr[this.uri])),r&&(this.keyId=r,Jn.setKeyIdForUri(this.uri,r))}return this}}function Iw(i){const e=i?.[ys.WIDEVINE];return e?e.keyId:null}function Ly(i){const e=i?.[ys.PLAYREADY];if(e){const t=FS(e.uri);if(t)return $S(t)}return null}function Rw(i){const e=new Uint8Array(16);for(let t=12;t<16;t++)e[t]=i>>8*(15-t)&255;return e}const wy=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,Cy=/#EXT-X-MEDIA:(.*)/g,Lw=/^#EXT(?:INF|-X-TARGETDURATION):/m,Gh=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),ww=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class Hi{static findGroup(e,t){for(let s=0;s<e.length;s++){const n=e[s];if(n.id===t)return n}}static resolve(e,t){return Wf.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return Lw.test(e)}static parseMasterPlaylist(e,t){const s=Ay(e),n={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:s},r=[];if(wy.lastIndex=0,!e.startsWith("#EXTM3U"))return n.playlistParsingError=new Error("no EXTM3U delimiter"),n;let l;for(;(l=wy.exec(e))!=null;)if(l[1]){var c;const d=new Bt(l[1],n),f=Ef(n,l[2]),p={attrs:d,bitrate:d.decimalInteger("BANDWIDTH")||d.decimalInteger("AVERAGE-BANDWIDTH"),name:d.NAME,url:Hi.resolve(f,t)},v=d.decimalResolution("RESOLUTION");v&&(p.width=v.width,p.height=v.height),Dy(d.CODECS,p);const x=d["SUPPLEMENTAL-CODECS"];x&&(p.supplemental={},Dy(x,p.supplemental)),(c=p.unknownCodecs)!=null&&c.length||r.push(p),n.levels.push(p)}else if(l[3]){const d=l[3],f=l[4];switch(d){case"SESSION-DATA":{const p=new Bt(f,n),v=p["DATA-ID"];v&&(n.sessionData===null&&(n.sessionData={}),n.sessionData[v]=p);break}case"SESSION-KEY":{const p=Oy(f,t,n);p.encrypted&&p.isSupported()?(n.sessionKeys===null&&(n.sessionKeys=[]),n.sessionKeys.push(p)):yt.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${f}"`);break}case"DEFINE":{{const p=new Bt(f,n);_y(n,p,t)}break}case"CONTENT-STEERING":{const p=new Bt(f,n);n.contentSteering={uri:Hi.resolve(p["SERVER-URI"],t),pathwayId:p["PATHWAY-ID"]||"."};break}case"START":{n.startTimeOffset=Ny(f);break}}}const h=r.length>0&&r.length<n.levels.length;return n.levels=h?r:n.levels,n.levels.length===0&&(n.playlistParsingError=new Error("no levels found in manifest")),n}static parseMasterPlaylistMedia(e,t,s){let n;const r={},l=s.levels,c={AUDIO:l.map(d=>({id:d.attrs.AUDIO,audioCodec:d.audioCodec})),SUBTITLES:l.map(d=>({id:d.attrs.SUBTITLES,textCodec:d.textCodec})),"CLOSED-CAPTIONS":[]};let h=0;for(Cy.lastIndex=0;(n=Cy.exec(e))!==null;){const d=new Bt(n[1],s),f=d.TYPE;if(f){const p=c[f],v=r[f]||[];r[f]=v;const x=d.LANGUAGE,S=d["ASSOC-LANGUAGE"],T=d.CHANNELS,E=d.CHARACTERISTICS,A=d["INSTREAM-ID"],_={attrs:d,bitrate:0,id:h++,groupId:d["GROUP-ID"]||"",name:d.NAME||x||"",type:f,default:d.bool("DEFAULT"),autoselect:d.bool("AUTOSELECT"),forced:d.bool("FORCED"),lang:x,url:d.URI?Hi.resolve(d.URI,t):""};if(S&&(_.assocLang=S),T&&(_.channels=T),E&&(_.characteristics=E),A&&(_.instreamId=A),p!=null&&p.length){const R=Hi.findGroup(p,_.groupId)||p[0];ky(_,R,"audioCodec"),ky(_,R,"textCodec")}v.push(_)}}return r}static parseLevelPlaylist(e,t,s,n,r,l){var c;const h={url:t},d=new bw(t),f=d.fragments,p=[];let v=null,x=0,S=0,T=0,E=0,A=0,_=null,R=new Fh(n,h),w,N,U,D=-1,F=!1,j=null,M;if(Gh.lastIndex=0,d.m3u8=e,d.hasVariableRefs=Ay(e),((c=Gh.exec(e))==null?void 0:c[0])!=="#EXTM3U")return d.playlistParsingError=new Error("Missing format identifier #EXTM3U"),d;for(;(w=Gh.exec(e))!==null;){F&&(F=!1,R=new Fh(n,h),R.playlistOffset=T,R.setStart(T),R.sn=x,R.cc=E,A&&(R.bitrate=A),R.level=s,v&&(R.initSegment=v,v.rawProgramDateTime&&(R.rawProgramDateTime=v.rawProgramDateTime,v.rawProgramDateTime=null),j&&(R.setByteRange(j),j=null)));const ne=w[1];if(ne){R.duration=parseFloat(ne);const de=(" "+w[2]).slice(1);R.title=de||null,R.tagList.push(de?["INF",ne,de]:["INF",ne])}else if(w[3]){if(Ce(R.duration)){R.playlistOffset=T,R.setStart(T),U&&Uy(R,U,d),R.sn=x,R.level=s,R.cc=E,f.push(R);const de=(" "+w[3]).slice(1);R.relurl=Ef(d,de),Af(R,_,p),_=R,T+=R.duration,x++,S=0,F=!0}}else{if(w=w[0].match(ww),!w){yt.warn("No matches on slow regex match for level playlist!");continue}for(N=1;N<w.length&&w[N]===void 0;N++);const de=(" "+w[N]).slice(1),k=(" "+w[N+1]).slice(1),G=w[N+2]?(" "+w[N+2]).slice(1):null;switch(de){case"BYTERANGE":_?R.setByteRange(k,_):R.setByteRange(k);break;case"PROGRAM-DATE-TIME":R.rawProgramDateTime=k,R.tagList.push(["PROGRAM-DATE-TIME",k]),D===-1&&(D=f.length);break;case"PLAYLIST-TYPE":d.type&&gn(d,de,w),d.type=k.toUpperCase();break;case"MEDIA-SEQUENCE":d.startSN!==0?gn(d,de,w):f.length>0&&My(d,de,w),x=d.startSN=parseInt(k);break;case"SKIP":{d.skippedSegments&&gn(d,de,w);const Y=new Bt(k,d),le=Y.decimalInteger("SKIPPED-SEGMENTS");if(Ce(le)){d.skippedSegments+=le;for(let P=le;P--;)f.push(null);x+=le}const me=Y.enumeratedString("RECENTLY-REMOVED-DATERANGES");me&&(d.recentlyRemovedDateranges=(d.recentlyRemovedDateranges||[]).concat(me.split("	")));break}case"TARGETDURATION":d.targetduration!==0&&gn(d,de,w),d.targetduration=Math.max(parseInt(k),1);break;case"VERSION":d.version!==null&&gn(d,de,w),d.version=parseInt(k);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":d.live||gn(d,de,w),d.live=!1;break;case"#":(k||G)&&R.tagList.push(G?[k,G]:[k]);break;case"DISCONTINUITY":E++,R.tagList.push(["DIS"]);break;case"GAP":R.gap=!0,R.tagList.push([de]);break;case"BITRATE":R.tagList.push([de,k]),A=parseInt(k)*1e3,Ce(A)?R.bitrate=A:A=0;break;case"DATERANGE":{const Y=new Bt(k,d),le=new MS(Y,d.dateRanges[Y.ID],d.dateRangeTagCount);d.dateRangeTagCount++,le.isValid||d.skippedSegments?d.dateRanges[le.id]=le:yt.warn(`Ignoring invalid DATERANGE tag: "${k}"`),R.tagList.push(["EXT-X-DATERANGE",k]);break}case"DEFINE":{{const Y=new Bt(k,d);"IMPORT"in Y?pw(d,Y,l):_y(d,Y,t)}break}case"DISCONTINUITY-SEQUENCE":d.startCC!==0?gn(d,de,w):f.length>0&&My(d,de,w),d.startCC=E=parseInt(k);break;case"KEY":{const Y=Oy(k,t,d);if(Y.isSupported()){if(Y.method==="NONE"){U=void 0;break}U||(U={});const le=U[Y.keyFormat];le!=null&&le.matches(Y)||(le&&(U=At({},U)),U[Y.keyFormat]=Y)}else yt.warn(`[Keys] Ignoring unsupported EXT-X-KEY tag: "${k}"`);break}case"START":d.startTimeOffset=Ny(k);break;case"MAP":{const Y=new Bt(k,d);if(R.duration){const le=new Fh(n,h);Py(le,Y,s,U),v=le,R.initSegment=v,v.rawProgramDateTime&&!R.rawProgramDateTime&&(R.rawProgramDateTime=v.rawProgramDateTime)}else{const le=R.byteRangeEndOffset;if(le){const me=R.byteRangeStartOffset;j=`${le-me}@${me}`}else j=null;Py(R,Y,s,U),v=R,F=!0}v.cc=E;break}case"SERVER-CONTROL":{M&&gn(d,de,w),M=new Bt(k),d.canBlockReload=M.bool("CAN-BLOCK-RELOAD"),d.canSkipUntil=M.optionalFloat("CAN-SKIP-UNTIL",0),d.canSkipDateRanges=d.canSkipUntil>0&&M.bool("CAN-SKIP-DATERANGES"),d.partHoldBack=M.optionalFloat("PART-HOLD-BACK",0),d.holdBack=M.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{d.partTarget&&gn(d,de,w);const Y=new Bt(k);d.partTarget=Y.decimalFloatingPoint("PART-TARGET");break}case"PART":{let Y=d.partList;Y||(Y=d.partList=[]);const le=S>0?Y[Y.length-1]:void 0,me=S++,P=new Bt(k,d),$=new p1(P,R,h,me,le);Y.push($),R.duration+=$.duration;break}case"PRELOAD-HINT":{const Y=new Bt(k,d);d.preloadHint=Y;break}case"RENDITION-REPORT":{const Y=new Bt(k,d);d.renditionReports=d.renditionReports||[],d.renditionReports.push(Y);break}default:yt.warn(`line parsed but not handled: ${w}`);break}}}_&&!_.relurl?(f.pop(),T-=_.duration,d.partList&&(d.fragmentHint=_)):d.partList&&(Af(R,_,p),R.cc=E,d.fragmentHint=R,U&&Uy(R,U,d)),d.targetduration||(d.playlistParsingError=new Error("Missing Target Duration"));const H=f.length,K=f[0],se=f[H-1];if(T+=d.skippedSegments*d.targetduration,T>0&&H&&se){d.averagetargetduration=T/H;const ne=se.sn;d.endSN=ne!=="initSegment"?ne:0,d.live||(se.endList=!0),D>0&&(Ow(f,D),K&&p.unshift(K))}return d.fragmentHint&&(T+=d.fragmentHint.duration),d.totalduration=T,p.length&&d.dateRangeTagCount&&K&&VS(p,d),d.endCC=E,d}}function VS(i,e){let t=i.length;if(!t)if(e.hasProgramDateTime){const c=e.fragments[e.fragments.length-1];i.push(c),t++}else return;const s=i[t-1],n=e.live?1/0:e.totalduration,r=Object.keys(e.dateRanges);for(let c=r.length;c--;){const h=e.dateRanges[r[c]],d=h.startDate.getTime();h.tagAnchor=s.ref;for(let f=t;f--;){var l;if(((l=i[f])==null?void 0:l.sn)<e.startSN)break;const p=Cw(e,d,i,f,n);if(p!==-1){h.tagAnchor=e.fragments[p].ref;break}}}}function Cw(i,e,t,s,n){const r=t[s];if(r){const c=r.programDateTime;if(e>=c||s===0){var l;const h=(((l=t[s+1])==null?void 0:l.start)||n)-r.start;if(e<=c+h*1e3){const d=t[s].sn-i.startSN;if(d<0)return-1;const f=i.fragments;if(f.length>t.length){const v=(t[s+1]||f[f.length-1]).sn-i.startSN;for(let x=v;x>d;x--){const S=f[x].programDateTime;if(e>=S&&e<S+f[x].duration*1e3)return x}}return d}}}return-1}function Oy(i,e,t){var s,n;const r=new Bt(i,t),l=(s=r.METHOD)!=null?s:"",c=r.URI,h=r.hexadecimalInteger("IV"),d=r.KEYFORMATVERSIONS,f=(n=r.KEYFORMAT)!=null?n:"identity";c&&r.IV&&!h&&yt.error(`Invalid IV: ${r.IV}`);const p=c?Hi.resolve(c,e):"",v=(d||"1").split("/").map(Number).filter(Number.isFinite);return new Jn(l,p,f,v,h,r.KEYID)}function Ny(i){const t=new Bt(i).decimalFloatingPoint("TIME-OFFSET");return Ce(t)?t:null}function Dy(i,e){let t=(i||"").split(/[ ,]+/).filter(s=>s);["video","audio","text"].forEach(s=>{const n=t.filter(r=>em(r,s));n.length&&(e[`${s}Codec`]=n.map(r=>r.split("/")[0]).join(","),t=t.filter(r=>n.indexOf(r)===-1))}),e.unknownCodecs=t}function ky(i,e,t){const s=e[t];s&&(i[t]=s)}function Ow(i,e){let t=i[e];for(let s=e;s--;){const n=i[s];if(!n)return;n.programDateTime=t.programDateTime-n.duration*1e3,t=n}}function Af(i,e,t){i.rawProgramDateTime?t.push(i):e!=null&&e.programDateTime&&(i.programDateTime=e.endProgramDateTime)}function Py(i,e,t,s){i.relurl=e.URI,e.BYTERANGE&&i.setByteRange(e.BYTERANGE),i.level=t,i.sn="initSegment",s&&(i.levelkeys=s),i.initSegment=null}function Uy(i,e,t){i.levelkeys=e;const{encryptedFragments:s}=t;(!s.length||s[s.length-1].levelkeys!==e)&&Object.keys(e).some(n=>e[n].isCommonEncryption)&&s.push(i)}function gn(i,e,t){i.playlistParsingError=new Error(`#EXT-X-${e} must not appear more than once (${t[0]})`)}function My(i,e,t){i.playlistParsingError=new Error(`#EXT-X-${e} must appear before the first Media Segment (${t[0]})`)}function Hh(i,e){const t=e.startPTS;if(Ce(t)){let s=0,n;e.sn>i.sn?(s=t-i.start,n=i):(s=i.start-t,n=e),n.duration!==s&&n.setDuration(s)}else e.sn>i.sn?i.cc===e.cc&&i.minEndPTS?e.setStart(i.start+(i.minEndPTS-i.start)):e.setStart(i.start+i.duration):e.setStart(Math.max(i.start-e.duration,0))}function GS(i,e,t,s,n,r,l){s-t<=0&&(l.warn("Fragment should have a positive duration",e),s=t+e.duration,r=n+e.duration);let h=t,d=s;const f=e.startPTS,p=e.endPTS;if(Ce(f)){const A=Math.abs(f-t);i&&A>i.totalduration?l.warn(`media timestamps and playlist times differ by ${A}s for level ${e.level} ${i.url}`):Ce(e.deltaPTS)?e.deltaPTS=Math.max(A,e.deltaPTS):e.deltaPTS=A,h=Math.max(t,f),t=Math.min(t,f),n=e.startDTS!==void 0?Math.min(n,e.startDTS):n,d=Math.min(s,p),s=Math.max(s,p),r=e.endDTS!==void 0?Math.max(r,e.endDTS):r}const v=t-e.start;e.start!==0&&e.setStart(t),e.setDuration(s-e.start),e.startPTS=t,e.maxStartPTS=h,e.startDTS=n,e.endPTS=s,e.minEndPTS=d,e.endDTS=r;const x=e.sn;if(!i||x<i.startSN||x>i.endSN)return 0;let S;const T=x-i.startSN,E=i.fragments;for(E[T]=e,S=T;S>0;S--)Hh(E[S],E[S-1]);for(S=T;S<E.length-1;S++)Hh(E[S],E[S+1]);return i.fragmentHint&&Hh(E[E.length-1],i.fragmentHint),i.PTSKnown=i.alignedSliding=!0,v}function Nw(i,e,t){if(i===e)return;let s=null;const n=i.fragments;for(let f=n.length-1;f>=0;f--){const p=n[f].initSegment;if(p){s=p;break}}i.fragmentHint&&delete i.fragmentHint.endPTS;let r;Pw(i,e,(f,p,v,x)=>{if((!e.startCC||e.skippedSegments)&&p.cc!==f.cc){const S=f.cc-p.cc;for(let T=v;T<x.length;T++)x[T].cc+=S;e.endCC=x[x.length-1].cc}Ce(f.startPTS)&&Ce(f.endPTS)&&(p.setStart(p.startPTS=f.startPTS),p.startDTS=f.startDTS,p.maxStartPTS=f.maxStartPTS,p.endPTS=f.endPTS,p.endDTS=f.endDTS,p.minEndPTS=f.minEndPTS,p.setDuration(f.endPTS-f.startPTS),p.duration&&(r=p),e.PTSKnown=e.alignedSliding=!0),f.hasStreams&&(p.elementaryStreams=f.elementaryStreams),p.loader=f.loader,f.hasStats&&(p.stats=f.stats),f.initSegment&&(p.initSegment=f.initSegment,s=f.initSegment)});const l=e.fragments,c=e.fragmentHint?l.concat(e.fragmentHint):l;if(s&&c.forEach(f=>{var p;f&&(!f.initSegment||f.initSegment.relurl===((p=s)==null?void 0:p.relurl))&&(f.initSegment=s)}),e.skippedSegments){if(e.deltaUpdateFailed=l.some(f=>!f),e.deltaUpdateFailed){t.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let f=e.skippedSegments;f--;)l.shift();e.startSN=l[0].sn}else{e.canSkipDateRanges&&(e.dateRanges=Dw(i.dateRanges,e,t));const f=i.fragments.filter(p=>p.rawProgramDateTime);if(i.hasProgramDateTime&&!e.hasProgramDateTime)for(let p=1;p<c.length;p++)c[p].programDateTime===null&&Af(c[p],c[p-1],f);VS(f,e)}e.endCC=l[l.length-1].cc}if(!e.startCC){var h;const f=KS(i,e.startSN-1);e.startCC=(h=f?.cc)!=null?h:l[0].cc}kw(i.partList,e.partList,(f,p)=>{p.elementaryStreams=f.elementaryStreams,p.stats=f.stats}),r?GS(e,r,r.startPTS,r.endPTS,r.startDTS,r.endDTS,t):HS(i,e),l.length&&(e.totalduration=e.edge-l[0].start),e.driftStartTime=i.driftStartTime,e.driftStart=i.driftStart;const d=e.advancedDateTime;if(e.advanced&&d){const f=e.edge;e.driftStart||(e.driftStartTime=d,e.driftStart=f),e.driftEndTime=d,e.driftEnd=f}else e.driftEndTime=i.driftEndTime,e.driftEnd=i.driftEnd,e.advancedDateTime=i.advancedDateTime;e.requestScheduled===-1&&(e.requestScheduled=i.requestScheduled)}function Dw(i,e,t){const{dateRanges:s,recentlyRemovedDateranges:n}=e,r=At({},i);n&&n.forEach(h=>{delete r[h]});const c=Object.keys(r).length;return c?(Object.keys(s).forEach(h=>{const d=r[h],f=new MS(s[h].attr,d);f.isValid?(r[h]=f,d||(f.tagOrder+=c)):t.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${Ot(s[h].attr)}"`)}),r):s}function kw(i,e,t){if(i&&e){let s=0;for(let n=0,r=i.length;n<=r;n++){const l=i[n],c=e[n+s];l&&c&&l.index===c.index&&l.fragment.sn===c.fragment.sn?t(l,c):s--}}}function Pw(i,e,t){const s=e.skippedSegments,n=Math.max(i.startSN,e.startSN)-e.startSN,r=(i.fragmentHint?1:0)+(s?e.endSN:Math.min(i.endSN,e.endSN))-e.startSN,l=e.startSN-i.startSN,c=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,h=i.fragmentHint?i.fragments.concat(i.fragmentHint):i.fragments;for(let d=n;d<=r;d++){const f=h[l+d];let p=c[d];if(s&&!p&&f&&(p=e.fragments[d]=f),f&&p){t(f,p,d,c);const v=f.relurl,x=p.relurl;if(v&&Uw(v,x)){e.playlistParsingError=jy(`media sequence mismatch ${p.sn}:`,i,e,f,p);return}else if(f.cc!==p.cc){e.playlistParsingError=jy(`discontinuity sequence mismatch (${f.cc}!=${p.cc})`,i,e,f,p);return}}}}function jy(i,e,t,s,n){return new Error(`${i} ${n.url}
Playlist starting @${e.startSN}
${e.m3u8}

Playlist starting @${t.startSN}
${t.m3u8}`)}function HS(i,e,t=!0){const s=e.startSN+e.skippedSegments-i.startSN,n=i.fragments,r=s>=0;let l=0;if(r&&s<n.length)l=n[s].start;else if(r&&e.startSN===i.endSN+1)l=i.fragmentEnd;else if(r&&t)l=i.fragmentStart+s*e.levelTargetDuration;else if(!e.skippedSegments&&e.fragmentStart===0)l=i.fragmentStart;else return;_f(e,l)}function _f(i,e){if(e){const t=i.fragments;for(let s=i.skippedSegments;s<t.length;s++)t[s].addStart(e);i.fragmentHint&&i.fragmentHint.addStart(e)}}function zS(i,e=1/0){let t=1e3*i.targetduration;if(i.updated){const s=i.fragments;if(s.length&&t*4>e){const r=s[s.length-1].duration*1e3;r<t&&(t=r)}}else t/=2;return Math.round(t)}function KS(i,e,t){if(!i)return null;let s=i.fragments[e-i.startSN];return s||(s=i.fragmentHint,s&&s.sn===e)?s:e<i.startSN&&t&&t.sn===e?t:null}function Fy(i,e,t){return i?YS(i.partList,e,t):null}function YS(i,e,t){if(i)for(let s=i.length;s--;){const n=i[s];if(n.index===t&&n.fragment.sn===e)return n}return null}function qS(i){i.forEach((e,t)=>{var s;(s=e.details)==null||s.fragments.forEach(n=>{n.level=t,n.initSegment&&(n.initSegment.level=t)})})}function Uw(i,e){return i!==e&&e?By(i)!==By(e):!1}function By(i){return i.replace(/\?[^?]*$/,"")}function wl(i,e){for(let s=0,n=i.length;s<n;s++){var t;if(((t=i[s])==null?void 0:t.cc)===e)return i[s]}return null}function Mw(i,e){return!!(i&&e.startCC<i.endCC&&e.endCC>i.startCC)}function $y(i,e){const t=i.start+e;i.startPTS=t,i.setStart(t),i.endPTS=t+i.duration}function QS(i,e){const t=e.fragments;for(let s=0,n=t.length;s<n;s++)$y(t[s],i);e.fragmentHint&&$y(e.fragmentHint,i),e.alignedSliding=!0}function jw(i,e){i&&(XS(e,i),e.alignedSliding||eu(e,i),!e.alignedSliding&&!e.skippedSegments&&HS(i,e,!1))}function XS(i,e){if(!Mw(e,i))return;const t=Math.min(e.endCC,i.endCC),s=wl(e.fragments,t),n=wl(i.fragments,t);if(!s||!n)return;yt.log(`Aligning playlist at start of dicontinuity sequence ${t}`);const r=s.start-n.start;QS(r,i)}function eu(i,e){if(!i.hasProgramDateTime||!e.hasProgramDateTime)return;const t=i.fragments,s=e.fragments;if(!t.length||!s.length)return;let n,r;const l=Math.min(e.endCC,i.endCC);e.startCC<l&&i.startCC<l&&(n=wl(s,l),r=wl(t,l)),(!n||!r)&&(n=s[Math.floor(s.length/2)],r=wl(t,n.cc)||t[Math.floor(t.length/2)]);const c=n.programDateTime,h=r.programDateTime;if(!c||!h)return;const d=(h-c)/1e3-(r.start-n.start);QS(d,i)}function Cs(i,e,t){$s(i,e,t),i.addEventListener(e,t)}function $s(i,e,t){i.removeEventListener(e,t)}const Fw={toString:function(i){let e="";const t=i.length;for(let s=0;s<t;s++)e+=`[${i.start(s).toFixed(3)}-${i.end(s).toFixed(3)}]`;return e}},re={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class lm extends PS{constructor(e,t,s,n,r){super(n,e.logger),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=re.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.loadingParts=!1,this.loopSn=void 0,this.onMediaSeeking=()=>{const{config:l,fragCurrent:c,media:h,mediaBuffer:d,state:f}=this,p=h?h.currentTime:0,v=qe.bufferInfo(d||h,p,l.maxBufferHole),x=!v.len;if(this.log(`Media seeking to ${Ce(p)?p.toFixed(3):p}, state: ${f}, ${x?"out of":"in"} buffer`),this.state===re.ENDED)this.resetLoadingState();else if(c){const S=l.maxFragLookUpTolerance,T=c.start-S,E=c.start+c.duration+S;if(x||E<v.start||T>v.end){const A=p>E;(p<T||A)&&(A&&c.loader&&(this.log(`Cancelling fragment load for seek (sn: ${c.sn})`),c.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}if(h){this.fragmentTracker.removeFragmentsInRange(p,1/0,this.playlistType,!0);const S=this.lastCurrentTime;if(p>S&&(this.lastCurrentTime=p),!this.loadingParts){const T=Math.max(v.end,p),E=this.shouldLoadParts(this.getLevelDetails(),T);E&&(this.log(`LL-Part loading ON after seeking to ${p.toFixed(2)} with buffer @${T.toFixed(2)}`),this.loadingParts=E)}}this.hls.hasEnoughToStart||(this.log(`Setting ${x?"startPosition":"nextLoadPosition"} to ${p} for seek without enough to start`),this.nextLoadPosition=p,x&&(this.startPosition=p)),x&&this.state===re.IDLE&&this.tickImmediate()},this.onMediaEnded=()=>{this.log("setting startPosition to 0 because media ended"),this.startPosition=this.lastCurrentTime=0},this.playlistType=r,this.hls=e,this.fragmentLoader=new fw(e.config),this.keyLoader=s,this.fragmentTracker=t,this.config=e.config,this.decrypter=new im(e.config)}registerListeners(){const{hls:e}=this;e.on(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(L.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(L.ERROR,this.onError,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){if(this.state===re.STOPPED)return;this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;e!=null&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=re.STOPPED}get startPositionValue(){const{nextLoadPosition:e,startPosition:t}=this;return t===-1&&e?e:t}get bufferingEnabled(){return this.buffering}pauseBuffering(){this.buffering=!1}resumeBuffering(){this.buffering=!0}get inFlightFrag(){return{frag:this.fragCurrent,state:this.state}}_streamEnded(e,t){if(t.live||!this.media)return!1;const s=e.end||0,n=this.config.timelineOffset||0;if(s<=n)return!1;const r=e.buffered;this.config.maxBufferHole&&r&&r.length>1&&(e=qe.bufferedInfo(r,e.start,0));const l=e.nextStart;if(l&&l>n&&l<t.edge||this.media.currentTime<e.start)return!1;const h=t.partList;if(h!=null&&h.length){const f=h[h.length-1];return qe.isBuffered(this.media,f.start+f.duration/2)}const d=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(d)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null)return this.levelLastLoaded.details}get timelineOffset(){const e=this.config.timelineOffset;if(e){var t;return((t=this.getLevelDetails())==null?void 0:t.appliedTimelineOffset)||e}return 0}onMediaAttached(e,t){const s=this.media=this.mediaBuffer=t.media;Cs(s,"seeking",this.onMediaSeeking),Cs(s,"ended",this.onMediaEnded);const n=this.config;this.levels&&n.autoStartLoad&&this.state===re.STOPPED&&this.startLoad(n.startPosition)}onMediaDetaching(e,t){const s=!!t.transferMedia,n=this.media;if(n!==null){if(n.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),$s(n,"seeking",this.onMediaSeeking),$s(n,"ended",this.onMediaEnded),this.keyLoader&&!s&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,s){this.resetLoadingState(),this.resetTransmuxer();return}this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}}onManifestLoading(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1}onError(e,t){}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset}onHandlerDestroying(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),super.onHandlerDestroying(),this.hls=this.onMediaSeeking=this.onMediaEnded=null}onHandlerDestroyed(){this.state=re.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,s){this.startFragRequested=!0,this._loadFragForPlayback(e,t,s)}_loadFragForPlayback(e,t,s){const n=r=>{const l=r.frag;if(this.fragContextChanged(l)){this.warn(`${l.type} sn: ${l.sn}${r.part?" part: "+r.part.index:""} of ${this.fragInfo(l,!1,r.part)}) was dropped during download.`),this.fragmentTracker.removeFragment(l);return}l.stats.chunkCount++,this._handleFragmentLoadProgress(r)};this._doFragLoad(e,t,s,n).then(r=>{if(!r)return;const l=this.state,c=r.frag;if(this.fragContextChanged(c)){(l===re.FRAG_LOADING||!this.fragCurrent&&l===re.PARSING)&&(this.fragmentTracker.removeFragment(c),this.state=re.IDLE);return}"payload"in r&&(this.log(`Loaded ${c.type} sn: ${c.sn} of ${this.playlistLabel()} ${c.level}`),this.hls.trigger(L.FRAG_LOADED,r)),this._handleFragmentLoadComplete(r)}).catch(r=>{this.state===re.STOPPED||this.state===re.ERROR||(this.warn(`Frag error: ${r?.message||r}`),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var t;const{fragmentTracker:s}=this;if(s.getState(e)===ls.APPENDING){const r=e.type,l=this.getFwdBufferInfo(this.mediaBuffer,r),c=Math.max(e.duration,l?l.len:this.config.maxBufferLength),h=this.backtrackFragment;((h?e.sn-h.sn:0)===1||this.reduceMaxBufferLength(c,e.duration))&&s.removeFragment(e)}else((t=this.mediaBuffer)==null?void 0:t.buffered.length)===0?s.removeAllFragments():s.hasParts(e.type)&&(s.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),s.getState(e)===ls.PARTIAL&&s.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}waitForLive(e){const t=e.details;return t?.live&&t.type!=="EVENT"&&(this.levelLastLoaded!==e||t.expired)}flushMainBuffer(e,t,s=null){if(!(e-t))return;const n={startOffset:e,endOffset:t,type:s};this.hls.trigger(L.BUFFER_FLUSHING,n)}_loadInitSegment(e,t){this._doFragLoad(e,t).then(s=>{const n=s?.frag;if(!n||this.fragContextChanged(n)||!this.levels)throw new Error("init load aborted");return s}).then(s=>{const{hls:n}=this,{frag:r,payload:l}=s,c=r.decryptdata;if(l&&l.byteLength>0&&c!=null&&c.key&&c.iv&&Er(c.method)){const h=self.performance.now();return this.decrypter.decrypt(new Uint8Array(l),c.key.buffer,c.iv.buffer,am(c.method)).catch(d=>{throw n.trigger(L.ERROR,{type:je.MEDIA_ERROR,details:Q.FRAG_DECRYPT_ERROR,fatal:!1,error:d,reason:d.message,frag:r}),d}).then(d=>{const f=self.performance.now();return n.trigger(L.FRAG_DECRYPTED,{frag:r,payload:d,stats:{tstart:h,tdecrypt:f}}),s.payload=d,this.completeInitSegmentLoad(s)})}return this.completeInitSegmentLoad(s)}).catch(s=>{this.state===re.STOPPED||this.state===re.ERROR||(this.warn(s),this.resetFragmentLoading(e))})}completeInitSegmentLoad(e){const{levels:t}=this;if(!t)throw new Error("init load aborted, missing levels");const s=e.frag.stats;this.state!==re.STOPPED&&(this.state=re.IDLE),e.frag.data=new Uint8Array(e.payload),s.parsing.start=s.buffering.start=self.performance.now(),s.parsing.end=s.buffering.end=self.performance.now(),this.tick()}unhandledEncryptionError(e,t){var s,n;const r=e.tracks;if(r&&!t.encrypted&&((s=r.audio)!=null&&s.encrypted||(n=r.video)!=null&&n.encrypted)&&(!this.config.emeEnabled||!this.keyLoader.emeController)){const l=this.media,c=new Error(`Encrypted track with no key in ${this.fragInfo(t)} (media ${l?"attached mediaKeys: "+l.mediaKeys:"detached"})`);return this.warn(c.message),!l||l.mediaKeys?!1:(this.hls.trigger(L.ERROR,{type:je.KEY_SYSTEM_ERROR,details:Q.KEY_SYSTEM_NO_KEYS,fatal:!1,error:c,frag:t}),this.resetTransmuxer(),!0)}return!1}fragContextChanged(e){const{fragCurrent:t}=this;return!e||!t||e.sn!==t.sn||e.level!==t.level}fragBufferedComplete(e,t){const s=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)} > buffer:${s?Fw.toString(qe.getBuffered(s)):"(detached)"})`),Qt(e)){var n;if(e.type!==ke.SUBTITLE){const l=e.elementaryStreams;if(!Object.keys(l).some(c=>!!l[c])){this.state=re.IDLE;return}}const r=(n=this.levels)==null?void 0:n[e.level];r!=null&&r.fragmentError&&(this.log(`Resetting level fragment error count of ${r.fragmentError} on frag buffered`),r.fragmentError=0)}this.state=re.IDLE}_handleFragmentLoadComplete(e){const{transmuxer:t}=this;if(!t)return;const{frag:s,part:n,partsLoaded:r}=e,l=!r||r.length===0||r.some(h=>!h),c=new nm(s.level,s.sn,s.stats.chunkCount+1,0,n?n.index:-1,!l);t.flush(c)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,s=null,n){var r;this.fragCurrent=e;const l=t.details;if(!this.levels||!l)throw new Error(`frag load aborted, missing level${l?"":" detail"}s`);let c=null;if(e.encrypted&&!((r=e.decryptdata)!=null&&r.key)){if(this.log(`Loading key for ${e.sn} of [${l.startSN}-${l.endSN}], ${this.playlistLabel()} ${e.level}`),this.state=re.KEY_LOADING,this.fragCurrent=e,c=this.keyLoader.load(e).then(v=>{if(!this.fragContextChanged(v.frag))return this.hls.trigger(L.KEY_LOADED,v),this.state===re.KEY_LOADING&&(this.state=re.IDLE),v}),this.hls.trigger(L.KEY_LOADING,{frag:e}),this.fragCurrent===null)return this.log("context changed in KEY_LOADING"),Promise.resolve(null)}else e.encrypted||(c=this.keyLoader.loadClear(e,l.encryptedFragments,this.startFragRequested),c&&this.log("[eme] blocking frag load until media-keys acquired"));const h=this.fragPrevious;if(Qt(e)&&(!h||e.sn!==h.sn)){const v=this.shouldLoadParts(t.details,e.end);v!==this.loadingParts&&(this.log(`LL-Part loading ${v?"ON":"OFF"} loading sn ${h?.sn}->${e.sn}`),this.loadingParts=v)}if(s=Math.max(e.start,s||0),this.loadingParts&&Qt(e)){const v=l.partList;if(v&&n){s>l.fragmentEnd&&l.fragmentHint&&(e=l.fragmentHint);const x=this.getNextPart(v,e,s);if(x>-1){const S=v[x];e=this.fragCurrent=S.fragment,this.log(`Loading ${e.type} sn: ${e.sn} part: ${S.index} (${x}/${v.length-1}) of ${this.fragInfo(e,!1,S)}) cc: ${e.cc} [${l.startSN}-${l.endSN}], target: ${parseFloat(s.toFixed(3))}`),this.nextLoadPosition=S.start+S.duration,this.state=re.FRAG_LOADING;let T;return c?T=c.then(E=>!E||this.fragContextChanged(E.frag)?null:this.doFragPartsLoad(e,S,t,n)).catch(E=>this.handleFragLoadError(E)):T=this.doFragPartsLoad(e,S,t,n).catch(E=>this.handleFragLoadError(E)),this.hls.trigger(L.FRAG_LOADING,{frag:e,part:S,targetBufferTime:s}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):T}else if(!e.url||this.loadedEndOfParts(v,s))return Promise.resolve(null)}}if(Qt(e)&&this.loadingParts){var d;this.log(`LL-Part loading OFF after next part miss @${s.toFixed(2)} Check buffer at sn: ${e.sn} loaded parts: ${(d=l.partList)==null?void 0:d.filter(v=>v.loaded).map(v=>`[${v.start}-${v.end}]`)}`),this.loadingParts=!1}else if(!e.url)return Promise.resolve(null);this.log(`Loading ${e.type} sn: ${e.sn} of ${this.fragInfo(e,!1)}) cc: ${e.cc} ${"["+l.startSN+"-"+l.endSN+"]"}, target: ${parseFloat(s.toFixed(3))}`),Ce(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=re.FRAG_LOADING;const f=this.config.progressive&&e.type!==ke.SUBTITLE;let p;return f&&c?p=c.then(v=>!v||this.fragContextChanged(v.frag)?null:this.fragmentLoader.load(e,n)).catch(v=>this.handleFragLoadError(v)):p=Promise.all([this.fragmentLoader.load(e,f?n:void 0),c]).then(([v])=>(!f&&n&&n(v),v)).catch(v=>this.handleFragLoadError(v)),this.hls.trigger(L.FRAG_LOADING,{frag:e,targetBufferTime:s}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):p}doFragPartsLoad(e,t,s,n){return new Promise((r,l)=>{var c;const h=[],d=(c=s.details)==null?void 0:c.partList,f=p=>{this.fragmentLoader.loadPart(e,p,n).then(v=>{h[p.index]=v;const x=v.part;this.hls.trigger(L.FRAG_LOADED,v);const S=Fy(s.details,e.sn,p.index+1)||YS(d,e.sn,p.index+1);if(S)f(S);else return r({frag:e,part:x,partsLoaded:h})}).catch(l)};f(t)})}handleFragLoadError(e){if("data"in e){const t=e.data;t.frag&&t.details===Q.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):t.frag&&t.type===je.KEY_SYSTEM_ERROR?(t.frag.abortRequests(),this.resetStartWhenNotLoaded(),this.resetFragmentLoading(t.frag)):this.hls.trigger(L.ERROR,t)}else this.hls.trigger(L.ERROR,{type:je.OTHER_ERROR,details:Q.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const t=this.getCurrentContext(e);if(!t||this.state!==re.PARSING){!this.fragCurrent&&this.state!==re.STOPPED&&this.state!==re.ERROR&&(this.state=re.IDLE);return}const{frag:s,part:n,level:r}=t,l=self.performance.now();s.stats.parsing.end=l,n&&(n.stats.parsing.end=l);const c=this.getLevelDetails(),d=c&&s.sn>c.endSN||this.shouldLoadParts(c,s.end);d!==this.loadingParts&&(this.log(`LL-Part loading ${d?"ON":"OFF"} after parsing segment ending @${s.end.toFixed(2)}`),this.loadingParts=d),this.updateLevelTiming(s,n,r,e.partial)}shouldLoadParts(e,t){if(this.config.lowLatencyMode){if(!e)return this.loadingParts;if(e.partList){var s;const r=e.partList[0];if(r.fragment.type===ke.SUBTITLE)return!1;const l=r.end+(((s=e.fragmentHint)==null?void 0:s.duration)||0);if(t>=l){var n;if((this.hls.hasEnoughToStart?((n=this.media)==null?void 0:n.currentTime)||this.lastCurrentTime:this.getLoadPosition())>r.start-r.fragment.duration)return!0}}}return!1}getCurrentContext(e){const{levels:t,fragCurrent:s}=this,{level:n,sn:r,part:l}=e;if(!(t!=null&&t[n]))return this.warn(`Levels object was unset while buffering fragment ${r} of ${this.playlistLabel()} ${n}. The current chunk will not be buffered.`),null;const c=t[n],h=c.details,d=l>-1?Fy(h,r,l):null,f=d?d.fragment:KS(h,r,s);return f?(s&&s!==f&&(f.stats=s.stats),{frag:f,part:d,level:c}):null}bufferFragmentData(e,t,s,n,r){if(this.state!==re.PARSING)return;const{data1:l,data2:c}=e;let h=l;if(c&&(h=bi(l,c)),!h.length)return;const d=this.initPTS[t.cc],f=d?-d.baseTime/d.timescale:void 0,p={type:e.type,frag:t,part:s,chunkMeta:n,offset:f,parent:t.type,data:h};if(this.hls.trigger(L.BUFFER_APPENDING,p),e.dropped&&e.independent&&!s){if(r)return;this.flushBufferGap(t)}}flushBufferGap(e){const t=this.media;if(!t)return;if(!qe.isBuffered(t,t.currentTime)){this.flushMainBuffer(0,e.start);return}const s=t.currentTime,n=qe.bufferInfo(t,s,0),r=e.duration,l=Math.min(this.config.maxFragLookUpTolerance*2,r*.25),c=Math.max(Math.min(e.start-l,n.end-l),s+l);e.start-c>l&&this.flushMainBuffer(c,e.start)}getFwdBufferInfo(e,t){var s;const n=this.getLoadPosition();if(!Ce(n))return null;const l=this.lastCurrentTime>n||(s=this.media)!=null&&s.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(e,n,t,l)}getFwdBufferInfoAtPos(e,t,s,n){const r=qe.bufferInfo(e,t,n);if(r.len===0&&r.nextStart!==void 0){const l=this.fragmentTracker.getBufferedFrag(t,s);if(l&&(r.nextStart<=l.end||l.gap)){const c=Math.max(Math.min(r.nextStart,l.end)-t,n);return qe.bufferInfo(e,t,c)}}return r}getMaxBufferLength(e){const{config:t}=this;let s;return e?s=Math.max(8*t.maxBufferSize/e,t.maxBufferLength):s=t.maxBufferLength,Math.min(s,t.maxMaxBufferLength)}reduceMaxBufferLength(e,t){const s=this.config,n=Math.max(Math.min(e-t,s.maxBufferLength),t),r=Math.max(e-t*3,s.maxMaxBufferLength/2,n);return r>=n?(s.maxMaxBufferLength=r,this.warn(`Reduce max buffer length to ${r}s`),!0):!1}getAppendedFrag(e,t=ke.MAIN){const s=this.fragmentTracker?this.fragmentTracker.getAppendedFrag(e,t):null;return s&&"fragment"in s?s.fragment:s}getNextFragment(e,t){const s=t.fragments,n=s.length;if(!n)return null;const{config:r}=this,l=s[0].start,c=r.lowLatencyMode&&!!t.partList;let h=null;if(t.live){const p=r.initialLiveManifestSize;if(n<p)return this.warn(`Not enough fragments to start playback (have: ${n}, need: ${p})`),null;if(!t.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||e<l){var d;c&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),h=this.getInitialLiveFragment(t);const v=this.hls.startPosition,x=this.hls.liveSyncPosition,S=h?(v!==-1&&v>=l?v:x)||h.start:e;this.log(`Setting startPosition to ${S} to match start frag at live edge. mainStart: ${v} liveSyncPosition: ${x} frag.start: ${(d=h)==null?void 0:d.start}`),this.startPosition=this.nextLoadPosition=S}}else e<=l&&(h=s[0]);if(!h){const p=this.loadingParts?t.partEnd:t.fragmentEnd;h=this.getFragmentAtPosition(e,p,t)}let f=this.filterReplacedPrimary(h,t);if(!f&&h){const p=h.sn-t.startSN;f=this.filterReplacedPrimary(s[p+1]||null,t)}return this.mapToInitFragWhenRequired(f)}isLoopLoading(e,t){const s=this.fragmentTracker.getState(e);return(s===ls.OK||s===ls.PARTIAL&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,s,n,r){let l=null;if(e.gap&&(l=this.getNextFragment(this.nextLoadPosition,t),l&&!l.gap&&s.nextStart)){const c=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,s.nextStart,n,0);if(c!==null&&s.len+c.len>=r){const h=l.sn;return this.loopSn!==h&&(this.log(`buffer full after gaps in "${n}" playlist starting at sn: ${h}`),this.loopSn=h),null}}return this.loopSn=void 0,l}get primaryPrefetch(){if(Vy(this.config)){var e;if((e=this.hls.interstitialsManager)==null||(e=e.playingItem)==null?void 0:e.event)return!0}return!1}filterReplacedPrimary(e,t){if(!e)return e;if(Vy(this.config)&&e.type!==ke.SUBTITLE){const s=this.hls.interstitialsManager,n=s?.bufferingItem;if(n){const l=n.event;if(l){if(l.appendInPlace||Math.abs(e.start-n.start)>1||n.start===0)return null}else if(e.end<=n.start&&t?.live===!1||e.start>n.end&&n.nextEvent&&(n.nextEvent.appendInPlace||e.start-n.end>1))return null}const r=s?.playerQueue;if(r)for(let l=r.length;l--;){const c=r[l].interstitial;if(c.appendInPlace&&e.start>=c.startTime&&e.end<=c.resumeTime)return null}}return e}mapToInitFragWhenRequired(e){return e!=null&&e.initSegment&&!e.initSegment.data&&!this.bitrateTest?e.initSegment:e}getNextPart(e,t,s){let n=-1,r=!1,l=!0;for(let c=0,h=e.length;c<h;c++){const d=e[c];if(l=l&&!d.independent,n>-1&&s<d.start)break;const f=d.loaded;f?n=-1:(r||(d.independent||l)&&d.fragment===t)&&(d.fragment!==t&&this.warn(`Need buffer at ${s} but next unloaded part starts at ${d.start}`),n=c),r=f}return n}loadedEndOfParts(e,t){let s;for(let n=e.length;n--;){if(s=e[n],!s.loaded)return!1;if(t>s.start)return!0}return!1}getInitialLiveFragment(e){const t=e.fragments,s=this.fragPrevious;let n=null;if(s){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${s.programDateTime}`),n=tw(t,s.endProgramDateTime,this.config.maxFragLookUpTolerance)),!n){const r=s.sn+1;if(r>=e.startSN&&r<=e.endSN){const l=t[r-e.startSN];s.cc===l.cc&&(n=l,this.log(`Live playlist, switching playlist, load frag with next SN: ${n.sn}`))}n||(n=NS(e,s.cc,s.end),n&&this.log(`Live playlist, switching playlist, load frag with same CC: ${n.sn}`))}}else{const r=this.hls.liveSyncPosition;r!==null&&(n=this.getFragmentAtPosition(r,this.bitrateTest?e.fragmentEnd:e.edge,e))}return n}getFragmentAtPosition(e,t,s){const{config:n}=this;let{fragPrevious:r}=this,{fragments:l,endSN:c}=s;const{fragmentHint:h}=s,{maxFragLookUpTolerance:d}=n,f=s.partList,p=!!(this.loadingParts&&f!=null&&f.length&&h);p&&!this.bitrateTest&&f[f.length-1].fragment.sn===h.sn&&(l=l.concat(h),c=h.sn);let v;if(e<t){var x;const T=e<this.lastCurrentTime||e>t-d||(x=this.media)!=null&&x.paused||!this.startFragRequested?0:d;v=La(r,l,e,T)}else v=l[l.length-1];if(v){const S=v.sn-s.startSN,T=this.fragmentTracker.getState(v);if((T===ls.OK||T===ls.PARTIAL&&v.gap)&&(r=v),r&&v.sn===r.sn&&(!p||f[0].fragment.sn>v.sn||!s.live)&&v.level===r.level){const A=l[S+1];v.sn<c&&this.fragmentTracker.getState(A)!==ls.OK?v=A:v=null}}return v}alignPlaylists(e,t,s){const n=e.fragments.length;if(!n)return this.warn("No fragments in live playlist"),0;const r=e.fragmentStart,l=!t,c=e.alignedSliding&&Ce(r);if(l||!c&&!r){jw(s,e);const h=e.fragmentStart;return this.log(`Live playlist sliding: ${h.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} fragments: ${n}`),h}return r}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,e.partTarget*3)}setStartPosition(e,t){let s=this.startPosition;s<t&&(s=-1);const n=this.timelineOffset;if(s===-1){const r=this.startTimeOffset!==null,l=r?this.startTimeOffset:e.startTimeOffset;l!==null&&Ce(l)?(s=t+l,l<0&&(s+=e.edge),s=Math.min(Math.max(t,s),t+e.totalduration),this.log(`Setting startPosition to ${s} for start time offset ${l} found in ${r?"multivariant":"media"} playlist`),this.startPosition=s):e.live?(s=this.hls.liveSyncPosition||t,this.log(`Setting startPosition to -1 to start at live edge ${s}`),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=s=0),this.lastCurrentTime=s+n}this.nextLoadPosition=s+n}getLoadPosition(){var e;const{media:t}=this;let s=0;return(e=this.hls)!=null&&e.hasEnoughToStart&&t?s=t.currentTime:this.nextLoadPosition>=0&&(s=this.nextLoadPosition),s}handleFragLoadAborted(e,t){this.transmuxer&&e.type===this.playlistType&&Qt(e)&&e.stats.aborted&&(this.log(`Fragment ${e.sn}${t?" part "+t.index:""} of ${this.playlistLabel()} ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){(!this.fragCurrent||!this.fragContextChanged(e)&&this.state!==re.FRAG_LOADING_WAITING_RETRY)&&(this.state=re.IDLE)}onFragmentOrKeyLoadError(e,t){var s;if(t.chunkMeta&&!t.frag){const A=this.getCurrentContext(t.chunkMeta);A&&(t.frag=A.frag)}const n=t.frag;if(!n||n.type!==e||!this.levels)return;if(this.fragContextChanged(n)){var r;this.warn(`Frag load error must match current frag to retry ${n.url} > ${(r=this.fragCurrent)==null?void 0:r.url}`);return}const l=t.details===Q.FRAG_GAP;l&&this.fragmentTracker.fragBuffered(n,!0);const c=t.errorAction;if(!c){this.state=re.ERROR;return}const{action:h,flags:d,retryCount:f=0,retryConfig:p}=c,v=!!p,x=v&&h===gs.RetryRequest,S=v&&!c.resolved&&d===ei.MoveAllAlternatesMatchingHost,T=(s=this.hls.latestLevelDetails)==null?void 0:s.live;if(!x&&S&&Qt(n)&&!n.endList&&T&&!kS(t))this.resetFragmentErrors(e),this.treatAsGap(n),c.resolved=!0;else if((x||S)&&f<p.maxNumRetry){var E;const A=bf((E=t.response)==null?void 0:E.code),_=sm(p,f);if(this.resetStartWhenNotLoaded(),this.retryDate=self.performance.now()+_,this.state=re.FRAG_LOADING_WAITING_RETRY,c.resolved=!0,A){this.log("Waiting for connection (offline)"),this.retryDate=1/0,t.reason="offline";return}this.warn(`Fragment ${n.sn} of ${e} ${n.level} errored with ${t.details}, retrying loading ${f+1}/${p.maxNumRetry} in ${_}ms`)}else if(p)if(this.resetFragmentErrors(e),f<p.maxNumRetry)!l&&h!==gs.RemoveAlternatePermanently&&(c.resolved=!0);else{this.warn(`${t.details} reached or exceeded max retry (${f})`);return}else h===gs.SendAlternateToPenaltyBox?this.state=re.WAITING_LEVEL:this.state=re.ERROR;this.tickImmediate()}checkRetryDate(){const e=self.performance.now(),t=this.retryDate,s=t===1/0;(!t||e>=t||s&&!bf(0))&&(s&&this.log("Connection restored (online)"),this.resetStartWhenNotLoaded(),this.state=re.IDLE)}reduceLengthAndFlushBuffer(e){if(this.state===re.PARSING||this.state===re.PARSED){const t=e.frag,s=e.parent,n=this.getFwdBufferInfo(this.mediaBuffer,s),r=n&&n.len>.5;r&&this.reduceMaxBufferLength(n.len,t?.duration||10);const l=!r;return l&&this.warn(`Buffer full error while media.currentTime (${this.getLoadPosition()}) is not buffered, flush ${s} buffer`),t&&(this.fragmentTracker.removeFragment(t),this.nextLoadPosition=t.start),this.resetLoadingState(),l}return!1}resetFragmentErrors(e){e===ke.AUDIO&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==re.STOPPED&&(this.state=re.IDLE)}afterBufferFlushed(e,t,s){if(!e)return;const n=qe.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,n,s),this.state===re.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==re.STOPPED&&(this.state=re.IDLE)}resetStartWhenNotLoaded(){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;const e=this.levelLastLoaded,t=e?e.details:null;t!=null&&t.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(t,t.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.log(`Loading context changed while buffering sn ${e.sn} of ${this.playlistLabel()} ${e.level===-1?"<removed>":e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,s,n){const r=s.details;if(!r){this.warn("level.details undefined");return}if(!Object.keys(e.elementaryStreams).reduce((h,d)=>{const f=e.elementaryStreams[d];if(f){const p=f.endPTS-f.startPTS;if(p<=0)return this.warn(`Could not parse fragment ${e.sn} ${d} duration reliably (${p})`),h||!1;const v=n?0:GS(r,e,f.startPTS,f.endPTS,f.startDTS,f.endDTS,this);return this.hls.trigger(L.LEVEL_PTS_UPDATED,{details:r,level:s,drift:v,type:d,frag:e,start:f.startPTS,end:f.endPTS}),!0}return h},!1)){var c;const h=((c=this.transmuxer)==null?void 0:c.error)===null;if((s.fragmentError===0||h&&(s.fragmentError<2||e.endList))&&this.treatAsGap(e,s),h){const d=new Error(`Found no media in fragment ${e.sn} of ${this.playlistLabel()} ${e.level} resetting transmuxer to fallback to playlist timing`);if(this.warn(d.message),this.hls.trigger(L.ERROR,{type:je.MEDIA_ERROR,details:Q.FRAG_PARSING_ERROR,fatal:!1,error:d,frag:e,reason:`Found no media in msn ${e.sn} of ${this.playlistLabel()} "${s.url}"`}),!this.hls)return;this.resetTransmuxer()}}this.state=re.PARSED,this.log(`Parsed ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)})`),this.hls.trigger(L.FRAG_PARSED,{frag:e,part:t})}playlistLabel(){return this.playlistType===ke.MAIN?"level":"track"}fragInfo(e,t=!0,s){var n,r;return`${this.playlistLabel()} ${e.level} (${s?"part":"frag"}:[${((n=t&&!s?e.startPTS:(s||e).start)!=null?n:NaN).toFixed(3)}-${((r=t&&!s?e.endPTS:(s||e).end)!=null?r:NaN).toFixed(3)}]${s&&e.type==="main"?"INDEPENDENT="+(s.independent?"YES":"NO"):""}`}treatAsGap(e,t){t&&t.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)}resetTransmuxer(){var e;(e=this.transmuxer)==null||e.reset()}recoverWorkerError(e){e.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(),this.resetLoadingState())}set state(e){const t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}}function Vy(i){return!!i.interstitialsController&&i.enableInterstitialPlayback!==!1}class WS{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:t}=this;let s;if(e.length)e.length===1?s=e[0]:s=Bw(e,t);else return new Uint8Array(0);return this.reset(),s}reset(){this.chunks.length=0,this.dataLength=0}}function Bw(i,e){const t=new Uint8Array(e);let s=0;for(let n=0;n<i.length;n++){const r=i[n];t.set(r,s),s+=r.length}return t}var zh={exports:{}},Gy;function $w(){return Gy||(Gy=1,(function(i){var e=Object.prototype.hasOwnProperty,t="~";function s(){}Object.create&&(s.prototype=Object.create(null),new s().__proto__||(t=!1));function n(h,d,f){this.fn=h,this.context=d,this.once=f||!1}function r(h,d,f,p,v){if(typeof f!="function")throw new TypeError("The listener must be a function");var x=new n(f,p||h,v),S=t?t+d:d;return h._events[S]?h._events[S].fn?h._events[S]=[h._events[S],x]:h._events[S].push(x):(h._events[S]=x,h._eventsCount++),h}function l(h,d){--h._eventsCount===0?h._events=new s:delete h._events[d]}function c(){this._events=new s,this._eventsCount=0}c.prototype.eventNames=function(){var d=[],f,p;if(this._eventsCount===0)return d;for(p in f=this._events)e.call(f,p)&&d.push(t?p.slice(1):p);return Object.getOwnPropertySymbols?d.concat(Object.getOwnPropertySymbols(f)):d},c.prototype.listeners=function(d){var f=t?t+d:d,p=this._events[f];if(!p)return[];if(p.fn)return[p.fn];for(var v=0,x=p.length,S=new Array(x);v<x;v++)S[v]=p[v].fn;return S},c.prototype.listenerCount=function(d){var f=t?t+d:d,p=this._events[f];return p?p.fn?1:p.length:0},c.prototype.emit=function(d,f,p,v,x,S){var T=t?t+d:d;if(!this._events[T])return!1;var E=this._events[T],A=arguments.length,_,R;if(E.fn){switch(E.once&&this.removeListener(d,E.fn,void 0,!0),A){case 1:return E.fn.call(E.context),!0;case 2:return E.fn.call(E.context,f),!0;case 3:return E.fn.call(E.context,f,p),!0;case 4:return E.fn.call(E.context,f,p,v),!0;case 5:return E.fn.call(E.context,f,p,v,x),!0;case 6:return E.fn.call(E.context,f,p,v,x,S),!0}for(R=1,_=new Array(A-1);R<A;R++)_[R-1]=arguments[R];E.fn.apply(E.context,_)}else{var w=E.length,N;for(R=0;R<w;R++)switch(E[R].once&&this.removeListener(d,E[R].fn,void 0,!0),A){case 1:E[R].fn.call(E[R].context);break;case 2:E[R].fn.call(E[R].context,f);break;case 3:E[R].fn.call(E[R].context,f,p);break;case 4:E[R].fn.call(E[R].context,f,p,v);break;default:if(!_)for(N=1,_=new Array(A-1);N<A;N++)_[N-1]=arguments[N];E[R].fn.apply(E[R].context,_)}}return!0},c.prototype.on=function(d,f,p){return r(this,d,f,p,!1)},c.prototype.once=function(d,f,p){return r(this,d,f,p,!0)},c.prototype.removeListener=function(d,f,p,v){var x=t?t+d:d;if(!this._events[x])return this;if(!f)return l(this,x),this;var S=this._events[x];if(S.fn)S.fn===f&&(!v||S.once)&&(!p||S.context===p)&&l(this,x);else{for(var T=0,E=[],A=S.length;T<A;T++)(S[T].fn!==f||v&&!S[T].once||p&&S[T].context!==p)&&E.push(S[T]);E.length?this._events[x]=E.length===1?E[0]:E:l(this,x)}return this},c.prototype.removeAllListeners=function(d){var f;return d?(f=t?t+d:d,this._events[f]&&l(this,f)):(this._events=new s,this._eventsCount=0),this},c.prototype.off=c.prototype.removeListener,c.prototype.addListener=c.prototype.on,c.prefixed=t,c.EventEmitter=c,i.exports=c})(zh)),zh.exports}var Vw=$w(),om=f1(Vw);const Ul="1.6.15",Lr={};function Gw(){return typeof __HLS_WORKER_BUNDLE__=="function"}function Hw(){const i=Lr[Ul];if(i)return i.clientCount++,i;const e=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),t=self.URL.createObjectURL(e),n={worker:new self.Worker(t),objectURL:t,clientCount:1};return Lr[Ul]=n,n}function zw(i){const e=Lr[i];if(e)return e.clientCount++,e;const t=new self.URL(i,self.location.href).href,n={worker:new self.Worker(t),scriptURL:t,clientCount:1};return Lr[i]=n,n}function Kw(i){const e=Lr[i||Ul];if(e&&e.clientCount--===1){const{worker:s,objectURL:n}=e;delete Lr[i||Ul],n&&self.URL.revokeObjectURL(n),s.terminate()}}function ZS(i,e){return e+10<=i.length&&i[e]===51&&i[e+1]===68&&i[e+2]===73&&i[e+3]<255&&i[e+4]<255&&i[e+6]<128&&i[e+7]<128&&i[e+8]<128&&i[e+9]<128}function cm(i,e){return e+10<=i.length&&i[e]===73&&i[e+1]===68&&i[e+2]===51&&i[e+3]<255&&i[e+4]<255&&i[e+6]<128&&i[e+7]<128&&i[e+8]<128&&i[e+9]<128}function fu(i,e){let t=0;return t=(i[e]&127)<<21,t|=(i[e+1]&127)<<14,t|=(i[e+2]&127)<<7,t|=i[e+3]&127,t}function Ml(i,e){const t=e;let s=0;for(;cm(i,e);){s+=10;const n=fu(i,e+6);s+=n,ZS(i,e+10)&&(s+=10),e+=s}if(s>0)return i.subarray(t,t+s)}function Yw(i,e,t,s){const n=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],r=e[t+2],l=r>>2&15;if(l>12){const x=new Error(`invalid ADTS sampling index:${l}`);i.emit(L.ERROR,L.ERROR,{type:je.MEDIA_ERROR,details:Q.FRAG_PARSING_ERROR,fatal:!0,error:x,reason:x.message});return}const c=(r>>6&3)+1,h=e[t+3]>>6&3|(r&1)<<2,d="mp4a.40."+c,f=n[l];let p=l;(c===5||c===29)&&(p-=3);const v=[c<<3|(p&14)>>1,(p&1)<<7|h<<3];return yt.log(`manifest codec:${s}, parsed codec:${d}, channels:${h}, rate:${f} (ADTS object type:${c} sampling index:${l})`),{config:v,samplerate:f,channelCount:h,codec:d,parsedCodec:d,manifestCodec:s}}function JS(i,e){return i[e]===255&&(i[e+1]&246)===240}function eb(i,e){return i[e+1]&1?7:9}function um(i,e){return(i[e+3]&3)<<11|i[e+4]<<3|(i[e+5]&224)>>>5}function qw(i,e){return e+5<i.length}function tu(i,e){return e+1<i.length&&JS(i,e)}function Qw(i,e){return qw(i,e)&&JS(i,e)&&um(i,e)<=i.length-e}function Xw(i,e){if(tu(i,e)){const t=eb(i,e);if(e+t>=i.length)return!1;const s=um(i,e);if(s<=t)return!1;const n=e+s;return n===i.length||tu(i,n)}return!1}function tb(i,e,t,s,n){if(!i.samplerate){const r=Yw(e,t,s,n);if(!r)return;At(i,r)}}function sb(i){return 1024*9e4/i}function Ww(i,e){const t=eb(i,e);if(e+t<=i.length){const s=um(i,e)-t;if(s>0)return{headerLength:t,frameLength:s}}}function ib(i,e,t,s,n){const r=sb(i.samplerate),l=s+n*r,c=Ww(e,t);let h;if(c){const{frameLength:p,headerLength:v}=c,x=v+p,S=Math.max(0,t+x-e.length);S?(h=new Uint8Array(x-v),h.set(e.subarray(t+v,e.length),0)):h=e.subarray(t+v,t+x);const T={unit:h,pts:l};return S||i.samples.push(T),{sample:T,length:x,missing:S}}const d=e.length-t;return h=new Uint8Array(d),h.set(e.subarray(t,e.length),0),{sample:{unit:h,pts:l},length:d,missing:-1}}function Zw(i,e){return cm(i,e)&&fu(i,e+6)+10<=i.length-e}function Jw(i){return i instanceof ArrayBuffer?i:i.byteOffset==0&&i.byteLength==i.buffer.byteLength?i.buffer:new Uint8Array(i).buffer}function Kh(i,e=0,t=1/0){return eC(i,e,t,Uint8Array)}function eC(i,e,t,s){const n=tC(i);let r=1;"BYTES_PER_ELEMENT"in s&&(r=s.BYTES_PER_ELEMENT);const l=sC(i)?i.byteOffset:0,c=(l+i.byteLength)/r,h=(l+e)/r,d=Math.floor(Math.max(0,Math.min(h,c))),f=Math.floor(Math.min(d+Math.max(t,0),c));return new s(n,d,f-d)}function tC(i){return i instanceof ArrayBuffer?i:i.buffer}function sC(i){return i&&i.buffer instanceof ArrayBuffer&&i.byteLength!==void 0&&i.byteOffset!==void 0}function iC(i){const e={key:i.type,description:"",data:"",mimeType:null,pictureType:null},t=3;if(i.size<2)return;if(i.data[0]!==t){console.log("Ignore frame with unrecognized character encoding");return}const s=i.data.subarray(1).indexOf(0);if(s===-1)return;const n=ni(Kh(i.data,1,s)),r=i.data[2+s],l=i.data.subarray(3+s).indexOf(0);if(l===-1)return;const c=ni(Kh(i.data,3+s,l));let h;return n==="-->"?h=ni(Kh(i.data,4+s+l)):h=Jw(i.data.subarray(4+s+l)),e.mimeType=n,e.pictureType=r,e.description=c,e.data=h,e}function nC(i){if(i.size<2)return;const e=ni(i.data,!0),t=new Uint8Array(i.data.subarray(e.length+1));return{key:i.type,info:e,data:t.buffer}}function aC(i){if(i.size<2)return;if(i.type==="TXXX"){let t=1;const s=ni(i.data.subarray(t),!0);t+=s.length+1;const n=ni(i.data.subarray(t));return{key:i.type,info:s,data:n}}const e=ni(i.data.subarray(1));return{key:i.type,info:"",data:e}}function rC(i){if(i.type==="WXXX"){if(i.size<2)return;let t=1;const s=ni(i.data.subarray(t),!0);t+=s.length+1;const n=ni(i.data.subarray(t));return{key:i.type,info:s,data:n}}const e=ni(i.data);return{key:i.type,info:"",data:e}}function lC(i){return i.type==="PRIV"?nC(i):i.type[0]==="W"?rC(i):i.type==="APIC"?iC(i):aC(i)}function oC(i){const e=String.fromCharCode(i[0],i[1],i[2],i[3]),t=fu(i,4),s=10;return{type:e,size:t,data:i.subarray(s,s+t)}}const vc=10,cC=10;function nb(i){let e=0;const t=[];for(;cm(i,e);){const s=fu(i,e+6);i[e+5]>>6&1&&(e+=vc),e+=vc;const n=e+s;for(;e+cC<n;){const r=oC(i.subarray(e)),l=lC(r);l&&t.push(l),e+=r.size+vc}ZS(i,e)&&(e+=vc)}return t}function ab(i){return i&&i.key==="PRIV"&&i.info==="com.apple.streaming.transportStreamTimestamp"}function uC(i){if(i.data.byteLength===8){const e=new Uint8Array(i.data),t=e[3]&1;let s=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return s/=45,t&&(s+=4772185884e-2),Math.round(s)}}function dm(i){const e=nb(i);for(let t=0;t<e.length;t++){const s=e[t];if(ab(s))return uC(s)}}let si=(function(i){return i.audioId3="org.id3",i.dateRange="com.apple.quicktime.HLS",i.emsg="https://aomedia.org/emsg/ID3",i.misbklv="urn:misb:KLV:bin:1910.1",i})({});function Vi(i="",e=9e4){return{type:i,id:-1,pid:-1,inputTimeScale:e,sequenceNumber:-1,samples:[],dropped:0}}class hm{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,s,n){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,s){}demux(e,t){this.cachedData&&(e=bi(this.cachedData,e),this.cachedData=null);let s=Ml(e,0),n=s?s.length:0,r;const l=this._audioTrack,c=this._id3Track,h=s?dm(s):void 0,d=e.length;for((this.basePTS===null||this.frameIndex===0&&Ce(h))&&(this.basePTS=dC(h,t,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),s&&s.length>0&&c.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:s,type:si.audioId3,duration:Number.POSITIVE_INFINITY});n<d;){if(this.canParse(e,n)){const f=this.appendFrame(l,e,n);f?(this.frameIndex++,this.lastPTS=f.sample.pts,n+=f.length,r=n):n=d}else Zw(e,n)?(s=Ml(e,n),c.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:s,type:si.audioId3,duration:Number.POSITIVE_INFINITY}),n+=s.length,r=n):n++;if(n===d&&r!==d){const f=e.slice(r);this.cachedData?this.cachedData=bi(this.cachedData,f):this.cachedData=f}}return{audioTrack:l,videoTrack:Vi(),id3Track:c,textTrack:Vi()}}demuxSampleAes(e,t,s){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:Vi(),id3Track:this._id3Track,textTrack:Vi()}}destroy(){this.cachedData=null,this._audioTrack=this._id3Track=void 0}}const dC=(i,e,t)=>{if(Ce(i))return i*90;const s=t?t.baseTime*9e4/t.timescale:0;return e*9e4+s};let yc=null;const hC=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],fC=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],mC=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],pC=[0,1,1,4];function rb(i,e,t,s,n){if(t+24>e.length)return;const r=lb(e,t);if(r&&t+r.frameLength<=e.length){const l=r.samplesPerFrame*9e4/r.sampleRate,c=s+n*l,h={unit:e.subarray(t,t+r.frameLength),pts:c,dts:c};return i.config=[],i.channelCount=r.channelCount,i.samplerate=r.sampleRate,i.samples.push(h),{sample:h,length:r.frameLength,missing:0}}}function lb(i,e){const t=i[e+1]>>3&3,s=i[e+1]>>1&3,n=i[e+2]>>4&15,r=i[e+2]>>2&3;if(t!==1&&n!==0&&n!==15&&r!==3){const l=i[e+2]>>1&1,c=i[e+3]>>6,h=t===3?3-s:s===3?3:4,d=hC[h*14+n-1]*1e3,p=fC[(t===3?0:t===2?1:2)*3+r],v=c===3?1:2,x=mC[t][s],S=pC[s],T=x*8*S,E=Math.floor(x*d/p+l)*S;if(yc===null){const R=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);yc=R?parseInt(R[1]):0}return yc&&yc<=87&&s===2&&d>=224e3&&c===0&&(i[e+3]=i[e+3]|128),{sampleRate:p,channelCount:v,frameLength:E,samplesPerFrame:T}}}function fm(i,e){return i[e]===255&&(i[e+1]&224)===224&&(i[e+1]&6)!==0}function ob(i,e){return e+1<i.length&&fm(i,e)}function gC(i,e){return fm(i,e)&&4<=i.length-e}function cb(i,e){if(e+1<i.length&&fm(i,e)){const s=lb(i,e);let n=4;s!=null&&s.frameLength&&(n=s.frameLength);const r=e+n;return r===i.length||ob(i,r)}return!1}class vC extends hm{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,s,n){super.resetInitSegment(e,t,s,n),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:n,inputTimeScale:9e4,dropped:0}}static probe(e,t){if(!e)return!1;const s=Ml(e,0);let n=s?.length||0;if(cb(e,n))return!1;for(let r=e.length;n<r;n++)if(Xw(e,n))return t.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return Qw(e,t)}appendFrame(e,t,s){tb(e,this.observer,t,s,e.manifestCodec);const n=ib(e,t,s,this.basePTS,this.frameIndex);if(n&&n.missing===0)return n}}const ub=(i,e)=>{let t=0,s=5;e+=s;const n=new Uint32Array(1),r=new Uint32Array(1),l=new Uint8Array(1);for(;s>0;){l[0]=i[e];const c=Math.min(s,8),h=8-c;r[0]=4278190080>>>24+h<<h,n[0]=(l[0]&r[0])>>h,t=t?t<<c|n[0]:n[0],e+=1,s-=c}return t};class yC extends hm{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,t,s,n){super.resetInitSegment(e,t,s,n),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:t,duration:n,inputTimeScale:9e4,dropped:0}}canParse(e,t){return t+64<e.length}appendFrame(e,t,s){const n=db(e,t,s,this.basePTS,this.frameIndex);if(n!==-1)return{sample:e.samples[e.samples.length-1],length:n,missing:0}}static probe(e){if(!e)return!1;const t=Ml(e,0);if(!t)return!1;const s=t.length;return e[s]===11&&e[s+1]===119&&dm(t)!==void 0&&ub(e,s)<16}}function db(i,e,t,s,n){if(t+8>e.length||e[t]!==11||e[t+1]!==119)return-1;const r=e[t+4]>>6;if(r>=3)return-1;const c=[48e3,44100,32e3][r],h=e[t+4]&63,f=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][h*3+r]*2;if(t+f>e.length)return-1;const p=e[t+6]>>5;let v=0;p===2?v+=2:(p&1&&p!==1&&(v+=2),p&4&&(v+=2));const x=(e[t+6]<<8|e[t+7])>>12-v&1,T=[2,1,2,3,3,4,4,5][p]+x,E=e[t+5]>>3,A=e[t+5]&7,_=new Uint8Array([r<<6|E<<1|A>>2,(A&3)<<6|p<<3|x<<2|h>>4,h<<4&224]),R=1536/c*9e4,w=s+n*R,N=e.subarray(t,t+f);return i.config=_,i.channelCount=T,i.samplerate=c,i.samples.push({unit:N,pts:w}),f}class xC extends hm{resetInitSegment(e,t,s,n){super.resetInitSegment(e,t,s,n),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:n,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=Ml(e,0);let s=t?.length||0;if(t&&e[s]===11&&e[s+1]===119&&dm(t)!==void 0&&ub(e,s)<=16)return!1;for(let n=e.length;s<n;s++)if(cb(e,s))return yt.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return gC(e,t)}appendFrame(e,t,s){if(this.basePTS!==null)return rb(e,t,s,this.basePTS,this.frameIndex)}}const SC=/\/emsg[-/]ID3/i;class bC{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,s,n){const r=this.videoTrack=Vi("video",1),l=this.audioTrack=Vi("audio",1),c=this.txtTrack=Vi("text",1);if(this.id3Track=Vi("id3",1),this.timeOffset=0,!(e!=null&&e.byteLength))return;const h=bS(e);if(h.video){const{id:d,timescale:f,codec:p,supplemental:v}=h.video;r.id=d,r.timescale=c.timescale=f,r.codec=p,r.supplemental=v}if(h.audio){const{id:d,timescale:f,codec:p}=h.audio;l.id=d,l.timescale=f,l.codec=p}c.id=yS.text,r.sampleDuration=0,r.duration=l.duration=n}resetContiguity(){this.remainderData=null}static probe(e){return y1(e)}demux(e,t){this.timeOffset=t;let s=e;const n=this.videoTrack,r=this.txtTrack;if(this.config.progressive){this.remainderData&&(s=bi(this.remainderData,e));const c=_1(s);this.remainderData=c.remainder,n.samples=c.valid||new Uint8Array}else n.samples=s;const l=this.extractID3Track(n,t);return r.samples=ly(t,n),{videoTrack:n,audioTrack:this.audioTrack,id3Track:l,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,t=this.videoTrack,s=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const n=this.extractID3Track(t,this.timeOffset);return s.samples=ly(e,t),{videoTrack:t,audioTrack:Vi(),id3Track:n,textTrack:Vi()}}extractID3Track(e,t){const s=this.id3Track;if(e.samples.length){const n=et(e.samples,["emsg"]);n&&n.forEach(r=>{const l=R1(r);if(SC.test(l.schemeIdUri)){const c=Hy(l,t);let h=l.eventDuration===4294967295?Number.POSITIVE_INFINITY:l.eventDuration/l.timeScale;h<=.001&&(h=Number.POSITIVE_INFINITY);const d=l.payload;s.samples.push({data:d,len:d.byteLength,dts:c,pts:c,type:si.emsg,duration:h})}else if(this.config.enableEmsgKLVMetadata&&l.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){const c=Hy(l,t);s.samples.push({data:l.payload,len:l.payload.byteLength,dts:c,pts:c,type:si.misbklv,duration:Number.POSITIVE_INFINITY})}})}return s}demuxSampleAes(e,t,s){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0}}function Hy(i,e){return Ce(i.presentationTime)?i.presentationTime/i.timeScale:e+i.presentationTimeDelta/i.timeScale}class EC{constructor(e,t,s){this.keyData=void 0,this.decrypter=void 0,this.keyData=s,this.decrypter=new im(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer,ta.cbc)}decryptAacSample(e,t,s){const n=e[t].unit;if(n.length<=16)return;const r=n.subarray(16,n.length-n.length%16),l=r.buffer.slice(r.byteOffset,r.byteOffset+r.length);this.decryptBuffer(l).then(c=>{const h=new Uint8Array(c);n.set(h,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,s)}).catch(s)}decryptAacSamples(e,t,s){for(;;t++){if(t>=e.length){s();return}if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,s),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){const t=Math.floor((e.length-48)/160)*16+16,s=new Int8Array(t);let n=0;for(let r=32;r<e.length-16;r+=160,n+=16)s.set(e.subarray(r,r+16),n);return s}getAvcDecryptedUnit(e,t){const s=new Uint8Array(t);let n=0;for(let r=32;r<e.length-16;r+=160,n+=16)e.set(s.subarray(n,n+16),r);return e}decryptAvcSample(e,t,s,n,r){const l=AS(r.data),c=this.getAvcEncryptedData(l);this.decryptBuffer(c.buffer).then(h=>{r.data=this.getAvcDecryptedUnit(l,h),this.decrypter.isSync()||this.decryptAvcSamples(e,t,s+1,n)}).catch(n)}decryptAvcSamples(e,t,s,n){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,s=0){if(t>=e.length){n();return}const r=e[t].units;for(;!(s>=r.length);s++){const l=r[s];if(!(l.data.length<=48||l.type!==1&&l.type!==5)&&(this.decryptAvcSample(e,t,s,n,l),!this.decrypter.isSync()))return}}}}class hb{constructor(){this.VideoSample=null}createVideoSample(e,t,s){return{key:e,frame:!1,pts:t,dts:s,units:[],length:0}}getLastNalUnit(e){var t;let s=this.VideoSample,n;if((!s||s.units.length===0)&&(s=e[e.length-1]),(t=s)!=null&&t.units){const r=s.units;n=r[r.length-1]}return n}pushAccessUnit(e,t){if(e.units.length&&e.frame){if(e.pts===void 0){const s=t.samples,n=s.length;if(n){const r=s[n-1];e.pts=r.pts,e.dts=r.dts}else{t.dropped++;return}}t.samples.push(e)}}parseNALu(e,t,s){const n=t.byteLength;let r=e.naluState||0;const l=r,c=[];let h=0,d,f,p,v=-1,x=0;for(r===-1&&(v=0,x=this.getNALuType(t,0),r=0,h=1);h<n;){if(d=t[h++],!r){r=d?0:1;continue}if(r===1){r=d?0:2;continue}if(!d)r=3;else if(d===1){if(f=h-r-1,v>=0){const S={data:t.subarray(v,f),type:x};c.push(S)}else{const S=this.getLastNalUnit(e.samples);S&&(l&&h<=4-l&&S.state&&(S.data=S.data.subarray(0,S.data.byteLength-l)),f>0&&(S.data=bi(S.data,t.subarray(0,f)),S.state=0))}h<n?(p=this.getNALuType(t,h),v=h,x=p,r=0):r=-1}else r=0}if(v>=0&&r>=0){const S={data:t.subarray(v,n),type:x,state:r};c.push(S)}if(c.length===0){const S=this.getLastNalUnit(e.samples);S&&(S.data=bi(S.data,t))}return e.naluState=r,c}}class Cl{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,s=e.byteLength-t,n=new Uint8Array(4),r=Math.min(4,t);if(r===0)throw new Error("no bytes available");n.set(e.subarray(s,s+r)),this.word=new DataView(n.buffer).getUint32(0),this.bitsAvailable=r*8,this.bytesAvailable-=r}skipBits(e){let t;e=Math.min(e,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const s=this.word>>>32-t;if(e>32&&yt.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return t=e-t,t>0&&this.bitsAvailable?s<<t|this.readBits(t):s}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if((this.word&2147483648>>>e)!==0)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}}class TC extends hb{parsePES(e,t,s,n){const r=this.parseNALu(e,s.data,n);let l=this.VideoSample,c,h=!1;s.data=null,l&&r.length&&!e.audFound&&(this.pushAccessUnit(l,e),l=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts)),r.forEach(d=>{var f,p;switch(d.type){case 1:{let T=!1;c=!0;const E=d.data;if(h&&E.length>4){const A=this.readSliceType(E);(A===2||A===4||A===7||A===9)&&(T=!0)}if(T){var v;(v=l)!=null&&v.frame&&!l.key&&(this.pushAccessUnit(l,e),l=this.VideoSample=null)}l||(l=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),l.frame=!0,l.key=T;break}case 5:c=!0,(f=l)!=null&&f.frame&&!l.key&&(this.pushAccessUnit(l,e),l=this.VideoSample=null),l||(l=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),l.key=!0,l.frame=!0;break;case 6:{c=!0,Jf(d.data,1,s.pts,t.samples);break}case 7:{var x,S;c=!0,h=!0;const T=d.data,E=this.readSPS(T);if(!e.sps||e.width!==E.width||e.height!==E.height||((x=e.pixelRatio)==null?void 0:x[0])!==E.pixelRatio[0]||((S=e.pixelRatio)==null?void 0:S[1])!==E.pixelRatio[1]){e.width=E.width,e.height=E.height,e.pixelRatio=E.pixelRatio,e.sps=[T];const A=T.subarray(1,4);let _="avc1.";for(let R=0;R<3;R++){let w=A[R].toString(16);w.length<2&&(w="0"+w),_+=w}e.codec=_}break}case 8:c=!0,e.pps=[d.data];break;case 9:c=!0,e.audFound=!0,(p=l)!=null&&p.frame&&(this.pushAccessUnit(l,e),l=null),l||(l=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts));break;case 12:c=!0;break;default:c=!1;break}l&&c&&l.units.push(d)}),n&&l&&(this.pushAccessUnit(l,e),this.VideoSample=null)}getNALuType(e,t){return e[t]&31}readSliceType(e){const t=new Cl(e);return t.readUByte(),t.readUEG(),t.readUEG()}skipScalingList(e,t){let s=8,n=8,r;for(let l=0;l<e;l++)n!==0&&(r=t.readEG(),n=(s+r+256)%256),s=n===0?s:n}readSPS(e){const t=new Cl(e);let s=0,n=0,r=0,l=0,c,h,d;const f=t.readUByte.bind(t),p=t.readBits.bind(t),v=t.readUEG.bind(t),x=t.readBoolean.bind(t),S=t.skipBits.bind(t),T=t.skipEG.bind(t),E=t.skipUEG.bind(t),A=this.skipScalingList.bind(this);f();const _=f();if(p(5),S(3),f(),E(),_===100||_===110||_===122||_===244||_===44||_===83||_===86||_===118||_===128){const F=v();if(F===3&&S(1),E(),E(),S(1),x())for(h=F!==3?8:12,d=0;d<h;d++)x()&&(d<6?A(16,t):A(64,t))}E();const R=v();if(R===0)v();else if(R===1)for(S(1),T(),T(),c=v(),d=0;d<c;d++)T();E(),S(1);const w=v(),N=v(),U=p(1);U===0&&S(1),S(1),x()&&(s=v(),n=v(),r=v(),l=v());let D=[1,1];if(x()&&x())switch(f()){case 1:D=[1,1];break;case 2:D=[12,11];break;case 3:D=[10,11];break;case 4:D=[16,11];break;case 5:D=[40,33];break;case 6:D=[24,11];break;case 7:D=[20,11];break;case 8:D=[32,11];break;case 9:D=[80,33];break;case 10:D=[18,11];break;case 11:D=[15,11];break;case 12:D=[64,33];break;case 13:D=[160,99];break;case 14:D=[4,3];break;case 15:D=[3,2];break;case 16:D=[2,1];break;case 255:{D=[f()<<8|f(),f()<<8|f()];break}}return{width:Math.ceil((w+1)*16-s*2-n*2),height:(2-U)*(N+1)*16-(U?2:4)*(r+l),pixelRatio:D}}}class AC extends hb{constructor(...e){super(...e),this.initVPS=null}parsePES(e,t,s,n){const r=this.parseNALu(e,s.data,n);let l=this.VideoSample,c,h=!1;s.data=null,l&&r.length&&!e.audFound&&(this.pushAccessUnit(l,e),l=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts)),r.forEach(d=>{var f,p;switch(d.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:l||(l=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts)),l.frame=!0,c=!0;break;case 16:case 17:case 18:case 21:if(c=!0,h){var v;(v=l)!=null&&v.frame&&!l.key&&(this.pushAccessUnit(l,e),l=this.VideoSample=null)}l||(l=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),l.key=!0,l.frame=!0;break;case 19:case 20:c=!0,(f=l)!=null&&f.frame&&!l.key&&(this.pushAccessUnit(l,e),l=this.VideoSample=null),l||(l=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),l.key=!0,l.frame=!0;break;case 39:c=!0,Jf(d.data,2,s.pts,t.samples);break;case 32:c=!0,e.vps||(typeof e.params!="object"&&(e.params={}),e.params=At(e.params,this.readVPS(d.data)),this.initVPS=d.data),e.vps=[d.data];break;case 33:if(c=!0,h=!0,e.vps!==void 0&&e.vps[0]!==this.initVPS&&e.sps!==void 0&&!this.matchSPS(e.sps[0],d.data)&&(this.initVPS=e.vps[0],e.sps=e.pps=void 0),!e.sps){const x=this.readSPS(d.data);e.width=x.width,e.height=x.height,e.pixelRatio=x.pixelRatio,e.codec=x.codecString,e.sps=[],typeof e.params!="object"&&(e.params={});for(const S in x.params)e.params[S]=x.params[S]}this.pushParameterSet(e.sps,d.data,e.vps),l||(l=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),l.key=!0;break;case 34:if(c=!0,typeof e.params=="object"){if(!e.pps){e.pps=[];const x=this.readPPS(d.data);for(const S in x)e.params[S]=x[S]}this.pushParameterSet(e.pps,d.data,e.vps)}break;case 35:c=!0,e.audFound=!0,(p=l)!=null&&p.frame&&(this.pushAccessUnit(l,e),l=null),l||(l=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts));break;default:c=!1;break}l&&c&&l.units.push(d)}),n&&l&&(this.pushAccessUnit(l,e),this.VideoSample=null)}pushParameterSet(e,t,s){(s&&s[0]===this.initVPS||!s&&!e.length)&&e.push(t)}getNALuType(e,t){return(e[t]&126)>>>1}ebsp2rbsp(e){const t=new Uint8Array(e.byteLength);let s=0;for(let n=0;n<e.byteLength;n++)n>=2&&e[n]===3&&e[n-1]===0&&e[n-2]===0||(t[s]=e[n],s++);return new Uint8Array(t.buffer,0,s)}pushAccessUnit(e,t){super.pushAccessUnit(e,t),this.initVPS&&(this.initVPS=null)}readVPS(e){const t=new Cl(e);t.readUByte(),t.readUByte(),t.readBits(4),t.skipBits(2),t.readBits(6);const s=t.readBits(3),n=t.readBoolean();return{numTemporalLayers:s+1,temporalIdNested:n}}readSPS(e){const t=new Cl(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.readBits(4);const s=t.readBits(3);t.readBoolean();const n=t.readBits(2),r=t.readBoolean(),l=t.readBits(5),c=t.readUByte(),h=t.readUByte(),d=t.readUByte(),f=t.readUByte(),p=t.readUByte(),v=t.readUByte(),x=t.readUByte(),S=t.readUByte(),T=t.readUByte(),E=t.readUByte(),A=t.readUByte(),_=[],R=[];for(let Ve=0;Ve<s;Ve++)_.push(t.readBoolean()),R.push(t.readBoolean());if(s>0)for(let Ve=s;Ve<8;Ve++)t.readBits(2);for(let Ve=0;Ve<s;Ve++)_[Ve]&&(t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte()),R[Ve]&&t.readUByte();t.readUEG();const w=t.readUEG();w==3&&t.skipBits(1);const N=t.readUEG(),U=t.readUEG(),D=t.readBoolean();let F=0,j=0,M=0,H=0;D&&(F+=t.readUEG(),j+=t.readUEG(),M+=t.readUEG(),H+=t.readUEG());const K=t.readUEG(),se=t.readUEG(),ne=t.readUEG(),de=t.readBoolean();for(let Ve=de?0:s;Ve<=s;Ve++)t.skipUEG(),t.skipUEG(),t.skipUEG();if(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.readBoolean()&&t.readBoolean())for(let Le=0;Le<4;Le++)for(let Fe=0;Fe<(Le===3?2:6);Fe++)if(!t.readBoolean())t.readUEG();else{const ut=Math.min(64,1<<4+(Le<<1));Le>1&&t.readEG();for(let Oe=0;Oe<ut;Oe++)t.readEG()}t.readBoolean(),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.skipUEG(),t.skipUEG(),t.readBoolean());const Y=t.readUEG();let le=0;for(let Ve=0;Ve<Y;Ve++){let Le=!1;if(Ve!==0&&(Le=t.readBoolean()),Le){Ve===Y&&t.readUEG(),t.readBoolean(),t.readUEG();let Fe=0;for(let Ze=0;Ze<=le;Ze++){const ut=t.readBoolean();let Oe=!1;ut||(Oe=t.readBoolean()),(ut||Oe)&&Fe++}le=Fe}else{const Fe=t.readUEG(),Ze=t.readUEG();le=Fe+Ze;for(let ut=0;ut<Fe;ut++)t.readUEG(),t.readBoolean();for(let ut=0;ut<Ze;ut++)t.readUEG(),t.readBoolean()}}if(t.readBoolean()){const Ve=t.readUEG();for(let Le=0;Le<Ve;Le++){for(let Fe=0;Fe<ne+4;Fe++)t.readBits(1);t.readBits(1)}}let P=0,$=1,ie=1,fe=!0,ge=1,ve=0;t.readBoolean(),t.readBoolean();let Ne=!1;if(t.readBoolean()){if(t.readBoolean()){const Ye=t.readUByte(),mt=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],st=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];Ye>0&&Ye<16?($=mt[Ye-1],ie=st[Ye-1]):Ye===255&&($=t.readBits(16),ie=t.readBits(16))}if(t.readBoolean()&&t.readBoolean(),t.readBoolean()&&(t.readBits(3),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.readUByte(),t.readUByte())),t.readBoolean()&&(t.readUEG(),t.readUEG()),t.readBoolean(),t.readBoolean(),t.readBoolean(),Ne=t.readBoolean(),Ne&&(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG()),t.readBoolean()&&(ge=t.readBits(32),ve=t.readBits(32),t.readBoolean()&&t.readUEG(),t.readBoolean())){const st=t.readBoolean(),Kt=t.readBoolean();let Xt=!1;(st||Kt)&&(Xt=t.readBoolean(),Xt&&(t.readUByte(),t.readBits(5),t.readBoolean(),t.readBits(5)),t.readBits(4),t.readBits(4),Xt&&t.readBits(4),t.readBits(5),t.readBits(5),t.readBits(5));for(let _s=0;_s<=s;_s++){fe=t.readBoolean();const ye=fe||t.readBoolean();let $e=!1;ye?t.readEG():$e=t.readBoolean();const De=$e?1:t.readUEG()+1;if(st)for(let St=0;St<De;St++)t.readUEG(),t.readUEG(),Xt&&(t.readUEG(),t.readUEG()),t.skipBits(1);if(Kt)for(let St=0;St<De;St++)t.readUEG(),t.readUEG(),Xt&&(t.readUEG(),t.readUEG()),t.skipBits(1)}}t.readBoolean()&&(t.readBoolean(),t.readBoolean(),t.readBoolean(),P=t.readUEG())}let we=N,ot=U;if(D){let Ve=1,Le=1;w===1?Ve=Le=2:w==2&&(Ve=2),we=N-Ve*j-Ve*F,ot=U-Le*H-Le*M}const ct=n?["A","B","C"][n]:"",zt=c<<24|h<<16|d<<8|f;let _t=0;for(let Ve=0;Ve<32;Ve++)_t=(_t|(zt>>Ve&1)<<31-Ve)>>>0;let xt=_t.toString(16);return l===1&&xt==="2"&&(xt="6"),{codecString:`hvc1.${ct}${l}.${xt}.${r?"H":"L"}${A}.B0`,params:{general_tier_flag:r,general_profile_idc:l,general_profile_space:n,general_profile_compatibility_flags:[c,h,d,f],general_constraint_indicator_flags:[p,v,x,S,T,E],general_level_idc:A,bit_depth:K+8,bit_depth_luma_minus8:K,bit_depth_chroma_minus8:se,min_spatial_segmentation_idc:P,chroma_format_idc:w,frame_rate:{fixed:fe,fps:ve/ge}},width:we,height:ot,pixelRatio:[$,ie]}}readPPS(e){const t=new Cl(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.skipUEG(),t.skipUEG(),t.skipBits(2),t.skipBits(3),t.skipBits(2),t.skipUEG(),t.skipUEG(),t.skipEG(),t.skipBits(2),t.readBoolean()&&t.skipUEG(),t.skipEG(),t.skipEG(),t.skipBits(4);const n=t.readBoolean(),r=t.readBoolean();let l=1;return r&&n?l=0:r?l=3:n&&(l=2),{parallelismType:l}}matchSPS(e,t){return String.fromCharCode.apply(null,e).substr(3)===String.fromCharCode.apply(null,t).substr(3)}}const ds=188;class Zn{constructor(e,t,s,n){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=t,this.typeSupported=s,this.logger=n,this.videoParser=null}static probe(e,t){const s=Zn.syncOffset(e);return s>0&&t.warn(`MPEG2-TS detected but first sync word found @ offset ${s}`),s!==-1}static syncOffset(e){const t=e.length;let s=Math.min(ds*5,t-ds)+1,n=0;for(;n<s;){let r=!1,l=-1,c=0;for(let h=n;h<t;h+=ds)if(e[h]===71&&(t-h===ds||e[h+ds]===71)){if(c++,l===-1&&(l=h,l!==0&&(s=Math.min(l+ds*99,e.length-ds)+1)),r||(r=If(e,h)===0),r&&c>1&&(l===0&&c>2||h+ds>s))return l}else{if(c)return-1;break}n++}return-1}static createTrack(e,t){return{container:e==="video"||e==="audio"?"video/mp2t":void 0,type:e,id:yS[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:e==="audio"?t:void 0}}resetInitSegment(e,t,s,n){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=Zn.createTrack("video"),this._videoTrack.duration=n,this._audioTrack=Zn.createTrack("audio",n),this._id3Track=Zn.createTrack("id3"),this._txtTrack=Zn.createTrack("text"),this._audioTrack.segmentCodec="aac",this.videoParser=null,this.aacOverFlow=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=s}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_videoTrack:t,_id3Track:s}=this;e&&(e.pesData=null),t&&(t.pesData=null),s&&(s.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,t,s=!1,n=!1){s||(this.sampleAes=null);let r;const l=this._videoTrack,c=this._audioTrack,h=this._id3Track,d=this._txtTrack;let f=l.pid,p=l.pesData,v=c.pid,x=h.pid,S=c.pesData,T=h.pesData,E=null,A=this.pmtParsed,_=this._pmtId,R=e.length;if(this.remainderData&&(e=bi(this.remainderData,e),R=e.length,this.remainderData=null),R<ds&&!n)return this.remainderData=e,{audioTrack:c,videoTrack:l,id3Track:h,textTrack:d};const w=Math.max(0,Zn.syncOffset(e));R-=(R-w)%ds,R<e.byteLength&&!n&&(this.remainderData=new Uint8Array(e.buffer,R,e.buffer.byteLength-R));let N=0;for(let D=w;D<R;D+=ds)if(e[D]===71){const F=!!(e[D+1]&64),j=If(e,D),M=(e[D+3]&48)>>4;let H;if(M>1){if(H=D+5+e[D+4],H===D+ds)continue}else H=D+4;switch(j){case f:F&&(p&&(r=vr(p,this.logger))&&(this.readyVideoParser(l.segmentCodec),this.videoParser!==null&&this.videoParser.parsePES(l,d,r,!1)),p={data:[],size:0}),p&&(p.data.push(e.subarray(H,D+ds)),p.size+=D+ds-H);break;case v:if(F){if(S&&(r=vr(S,this.logger)))switch(c.segmentCodec){case"aac":this.parseAACPES(c,r);break;case"mp3":this.parseMPEGPES(c,r);break;case"ac3":this.parseAC3PES(c,r);break}S={data:[],size:0}}S&&(S.data.push(e.subarray(H,D+ds)),S.size+=D+ds-H);break;case x:F&&(T&&(r=vr(T,this.logger))&&this.parseID3PES(h,r),T={data:[],size:0}),T&&(T.data.push(e.subarray(H,D+ds)),T.size+=D+ds-H);break;case 0:F&&(H+=e[H]+1),_=this._pmtId=_C(e,H);break;case _:{F&&(H+=e[H]+1);const K=IC(e,H,this.typeSupported,s,this.observer,this.logger);f=K.videoPid,f>0&&(l.pid=f,l.segmentCodec=K.segmentVideoCodec),v=K.audioPid,v>0&&(c.pid=v,c.segmentCodec=K.segmentAudioCodec),x=K.id3Pid,x>0&&(h.pid=x),E!==null&&!A&&(this.logger.warn(`MPEG-TS PMT found at ${D} after unknown PID '${E}'. Backtracking to sync byte @${w} to parse all TS packets.`),E=null,D=w-188),A=this.pmtParsed=!0;break}case 17:case 8191:break;default:E=j;break}}else N++;N>0&&Rf(this.observer,new Error(`Found ${N} TS packet/s that do not start with 0x47`),void 0,this.logger),l.pesData=p,c.pesData=S,h.pesData=T;const U={audioTrack:c,videoTrack:l,id3Track:h,textTrack:d};return n&&this.extractRemainingSamples(U),U}flush(){const{remainderData:e}=this;this.remainderData=null;let t;return e?t=this.demux(e,-1,!1,!0):t={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){const{audioTrack:t,videoTrack:s,id3Track:n,textTrack:r}=e,l=s.pesData,c=t.pesData,h=n.pesData;let d;if(l&&(d=vr(l,this.logger))?(this.readyVideoParser(s.segmentCodec),this.videoParser!==null&&(this.videoParser.parsePES(s,r,d,!0),s.pesData=null)):s.pesData=l,c&&(d=vr(c,this.logger))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,d);break;case"mp3":this.parseMPEGPES(t,d);break;case"ac3":this.parseAC3PES(t,d);break}t.pesData=null}else c!=null&&c.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=c;h&&(d=vr(h,this.logger))?(this.parseID3PES(n,d),n.pesData=null):n.pesData=h}demuxSampleAes(e,t,s){const n=this.demux(e,s,!0,!this.config.progressive),r=this.sampleAes=new EC(this.observer,this.config,t);return this.decrypt(n,r)}readyVideoParser(e){this.videoParser===null&&(e==="avc"?this.videoParser=new TC:e==="hevc"&&(this.videoParser=new AC))}decrypt(e,t){return new Promise(s=>{const{audioTrack:n,videoTrack:r}=e;n.samples&&n.segmentCodec==="aac"?t.decryptAacSamples(n.samples,0,()=>{r.samples?t.decryptAvcSamples(r.samples,0,0,()=>{s(e)}):s(e)}):r.samples&&t.decryptAvcSamples(r.samples,0,0,()=>{s(e)})})}destroy(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0}parseAACPES(e,t){let s=0;const n=this.aacOverFlow;let r=t.data;if(n){this.aacOverFlow=null;const p=n.missing,v=n.sample.unit.byteLength;if(p===-1)r=bi(n.sample.unit,r);else{const x=v-p;n.sample.unit.set(r.subarray(0,p),x),e.samples.push(n.sample),s=n.missing}}let l,c;for(l=s,c=r.length;l<c-1&&!tu(r,l);l++);if(l!==s){let p;const v=l<c-1;if(v?p=`AAC PES did not start with ADTS header,offset:${l}`:p="No ADTS header found in AAC PES",Rf(this.observer,new Error(p),v,this.logger),!v)return}tb(e,this.observer,r,l,this.audioCodec);let h;if(t.pts!==void 0)h=t.pts;else if(n){const p=sb(e.samplerate);h=n.sample.pts+p}else{this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}let d=0,f;for(;l<c;)if(f=ib(e,r,l,h,d),l+=f.length,f.missing){this.aacOverFlow=f;break}else for(d++;l<c-1&&!tu(r,l);l++);}parseMPEGPES(e,t){const s=t.data,n=s.length;let r=0,l=0;const c=t.pts;if(c===void 0){this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;l<n;)if(ob(s,l)){const h=rb(e,s,l,c,r);if(h)l+=h.length,r++;else break}else l++}parseAC3PES(e,t){{const s=t.data,n=t.pts;if(n===void 0){this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");return}const r=s.length;let l=0,c=0,h;for(;c<r&&(h=db(e,s,c,n,l++))>0;)c+=h}}parseID3PES(e,t){if(t.pts===void 0){this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}const s=At({},t,{type:this._videoTrack?si.emsg:si.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(s)}}function If(i,e){return((i[e+1]&31)<<8)+i[e+2]}function _C(i,e){return(i[e+10]&31)<<8|i[e+11]}function IC(i,e,t,s,n,r){const l={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},c=(i[e+1]&15)<<8|i[e+2],h=e+3+c-4,d=(i[e+10]&15)<<8|i[e+11];for(e+=12+d;e<h;){const f=If(i,e),p=(i[e+3]&15)<<8|i[e+4];switch(i[e]){case 207:if(!s){Yh("ADTS AAC",r);break}case 15:l.audioPid===-1&&(l.audioPid=f);break;case 21:l.id3Pid===-1&&(l.id3Pid=f);break;case 219:if(!s){Yh("H.264",r);break}case 27:l.videoPid===-1&&(l.videoPid=f);break;case 3:case 4:!t.mpeg&&!t.mp3?r.log("MPEG audio found, not supported in this browser"):l.audioPid===-1&&(l.audioPid=f,l.segmentAudioCodec="mp3");break;case 193:if(!s){Yh("AC-3",r);break}case 129:t.ac3?l.audioPid===-1&&(l.audioPid=f,l.segmentAudioCodec="ac3"):r.log("AC-3 audio found, not supported in this browser");break;case 6:if(l.audioPid===-1&&p>0){let v=e+5,x=p;for(;x>2;){i[v]===106&&(t.ac3!==!0?r.log("AC-3 audio found, not supported in this browser for now"):(l.audioPid=f,l.segmentAudioCodec="ac3"));const T=i[v+1]+2;v+=T,x-=T}}break;case 194:case 135:return Rf(n,new Error("Unsupported EC-3 in M2TS found"),void 0,r),l;case 36:l.videoPid===-1&&(l.videoPid=f,l.segmentVideoCodec="hevc",r.log("HEVC in M2TS found"));break}e+=p+5}return l}function Rf(i,e,t,s){s.warn(`parsing error: ${e.message}`),i.emit(L.ERROR,L.ERROR,{type:je.MEDIA_ERROR,details:Q.FRAG_PARSING_ERROR,fatal:!1,levelRetry:t,error:e,reason:e.message})}function Yh(i,e){e.log(`${i} with AES-128-CBC encryption found in unencrypted stream`)}function vr(i,e){let t=0,s,n,r,l,c;const h=i.data;if(!i||i.size===0)return null;for(;h[0].length<19&&h.length>1;)h[0]=bi(h[0],h[1]),h.splice(1,1);if(s=h[0],(s[0]<<16)+(s[1]<<8)+s[2]===1){if(n=(s[4]<<8)+s[5],n&&n>i.size-6)return null;const f=s[7];f&192&&(l=(s[9]&14)*536870912+(s[10]&255)*4194304+(s[11]&254)*16384+(s[12]&255)*128+(s[13]&254)/2,f&64?(c=(s[14]&14)*536870912+(s[15]&255)*4194304+(s[16]&254)*16384+(s[17]&255)*128+(s[18]&254)/2,l-c>60*9e4&&(e.warn(`${Math.round((l-c)/9e4)}s delta between PTS and DTS, align them`),l=c)):c=l),r=s[8];let p=r+9;if(i.size<=p)return null;i.size-=p;const v=new Uint8Array(i.size);for(let x=0,S=h.length;x<S;x++){s=h[x];let T=s.byteLength;if(p)if(p>T){p-=T;continue}else s=s.subarray(p),T-=p,p=0;v.set(s,t),t+=T}return n&&(n-=r+3),{data:v,pts:l,dts:c,len:n}}return null}class RC{static getSilentFrame(e,t){switch(e){case"mp4a.40.2":if(t===1)return new Uint8Array([0,200,0,128,35,128]);if(t===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(t===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(t===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(t===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(t===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(t===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const Qn=Math.pow(2,32)-1;class q{static init(){q.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let e;for(e in q.types)q.types.hasOwnProperty(e)&&(q.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),s=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);q.HDLR_TYPES={video:t,audio:s};const n=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),r=new Uint8Array([0,0,0,0,0,0,0,0]);q.STTS=q.STSC=q.STCO=r,q.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),q.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),q.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),q.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const l=new Uint8Array([105,115,111,109]),c=new Uint8Array([97,118,99,49]),h=new Uint8Array([0,0,0,1]);q.FTYP=q.box(q.types.ftyp,l,h,l,c),q.DINF=q.box(q.types.dinf,q.box(q.types.dref,n))}static box(e,...t){let s=8,n=t.length;const r=n;for(;n--;)s+=t[n].byteLength;const l=new Uint8Array(s);for(l[0]=s>>24&255,l[1]=s>>16&255,l[2]=s>>8&255,l[3]=s&255,l.set(e,4),n=0,s=8;n<r;n++)l.set(t[n],s),s+=t[n].byteLength;return l}static hdlr(e){return q.box(q.types.hdlr,q.HDLR_TYPES[e])}static mdat(e){return q.box(q.types.mdat,e)}static mdhd(e,t){t*=e;const s=Math.floor(t/(Qn+1)),n=Math.floor(t%(Qn+1));return q.box(q.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,s>>24,s>>16&255,s>>8&255,s&255,n>>24,n>>16&255,n>>8&255,n&255,85,196,0,0]))}static mdia(e){return q.box(q.types.mdia,q.mdhd(e.timescale||0,e.duration||0),q.hdlr(e.type),q.minf(e))}static mfhd(e){return q.box(q.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255]))}static minf(e){return e.type==="audio"?q.box(q.types.minf,q.box(q.types.smhd,q.SMHD),q.DINF,q.stbl(e)):q.box(q.types.minf,q.box(q.types.vmhd,q.VMHD),q.DINF,q.stbl(e))}static moof(e,t,s){return q.box(q.types.moof,q.mfhd(e),q.traf(s,t))}static moov(e){let t=e.length;const s=[];for(;t--;)s[t]=q.trak(e[t]);return q.box.apply(null,[q.types.moov,q.mvhd(e[0].timescale||0,e[0].duration||0)].concat(s).concat(q.mvex(e)))}static mvex(e){let t=e.length;const s=[];for(;t--;)s[t]=q.trex(e[t]);return q.box.apply(null,[q.types.mvex,...s])}static mvhd(e,t){t*=e;const s=Math.floor(t/(Qn+1)),n=Math.floor(t%(Qn+1)),r=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,s>>24,s>>16&255,s>>8&255,s&255,n>>24,n>>16&255,n>>8&255,n&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return q.box(q.types.mvhd,r)}static sdtp(e){const t=e.samples||[],s=new Uint8Array(4+t.length);let n,r;for(n=0;n<t.length;n++)r=t[n].flags,s[n+4]=r.dependsOn<<4|r.isDependedOn<<2|r.hasRedundancy;return q.box(q.types.sdtp,s)}static stbl(e){return q.box(q.types.stbl,q.stsd(e),q.box(q.types.stts,q.STTS),q.box(q.types.stsc,q.STSC),q.box(q.types.stsz,q.STSZ),q.box(q.types.stco,q.STCO))}static avc1(e){let t=[],s=[],n,r,l;for(n=0;n<e.sps.length;n++)r=e.sps[n],l=r.byteLength,t.push(l>>>8&255),t.push(l&255),t=t.concat(Array.prototype.slice.call(r));for(n=0;n<e.pps.length;n++)r=e.pps[n],l=r.byteLength,s.push(l>>>8&255),s.push(l&255),s=s.concat(Array.prototype.slice.call(r));const c=q.box(q.types.avcC,new Uint8Array([1,t[3],t[4],t[5],255,224|e.sps.length].concat(t).concat([e.pps.length]).concat(s))),h=e.width,d=e.height,f=e.pixelRatio[0],p=e.pixelRatio[1];return q.box(q.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,h>>8&255,h&255,d>>8&255,d&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),c,q.box(q.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),q.box(q.types.pasp,new Uint8Array([f>>24,f>>16&255,f>>8&255,f&255,p>>24,p>>16&255,p>>8&255,p&255])))}static esds(e){const t=e.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2,...t,6,1,2])}static audioStsd(e){const t=e.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount||0,0,16,0,0,0,0,t>>8&255,t&255,0,0])}static mp4a(e){return q.box(q.types.mp4a,q.audioStsd(e),q.box(q.types.esds,q.esds(e)))}static mp3(e){return q.box(q.types[".mp3"],q.audioStsd(e))}static ac3(e){return q.box(q.types["ac-3"],q.audioStsd(e),q.box(q.types.dac3,e.config))}static stsd(e){const{segmentCodec:t}=e;if(e.type==="audio"){if(t==="aac")return q.box(q.types.stsd,q.STSD,q.mp4a(e));if(t==="ac3"&&e.config)return q.box(q.types.stsd,q.STSD,q.ac3(e));if(t==="mp3"&&e.codec==="mp3")return q.box(q.types.stsd,q.STSD,q.mp3(e))}else if(e.pps&&e.sps){if(t==="avc")return q.box(q.types.stsd,q.STSD,q.avc1(e));if(t==="hevc"&&e.vps)return q.box(q.types.stsd,q.STSD,q.hvc1(e))}else throw new Error("video track missing pps or sps");throw new Error(`unsupported ${e.type} segment codec (${t}/${e.codec})`)}static tkhd(e){const t=e.id,s=(e.duration||0)*(e.timescale||0),n=e.width||0,r=e.height||0,l=Math.floor(s/(Qn+1)),c=Math.floor(s%(Qn+1));return q.box(q.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,0,0,0,0,l>>24,l>>16&255,l>>8&255,l&255,c>>24,c>>16&255,c>>8&255,c&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,n>>8&255,n&255,0,0,r>>8&255,r&255,0,0]))}static traf(e,t){const s=q.sdtp(e),n=e.id,r=Math.floor(t/(Qn+1)),l=Math.floor(t%(Qn+1));return q.box(q.types.traf,q.box(q.types.tfhd,new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,n&255])),q.box(q.types.tfdt,new Uint8Array([1,0,0,0,r>>24,r>>16&255,r>>8&255,r&255,l>>24,l>>16&255,l>>8&255,l&255])),q.trun(e,s.length+16+20+8+16+8+8),s)}static trak(e){return e.duration=e.duration||4294967295,q.box(q.types.trak,q.tkhd(e),q.mdia(e))}static trex(e){const t=e.id;return q.box(q.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){const s=e.samples||[],n=s.length,r=12+16*n,l=new Uint8Array(r);let c,h,d,f,p,v;for(t+=8+r,l.set([e.type==="video"?1:0,0,15,1,n>>>24&255,n>>>16&255,n>>>8&255,n&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255],0),c=0;c<n;c++)h=s[c],d=h.duration,f=h.size,p=h.flags,v=h.cts,l.set([d>>>24&255,d>>>16&255,d>>>8&255,d&255,f>>>24&255,f>>>16&255,f>>>8&255,f&255,p.isLeading<<2|p.dependsOn,p.isDependedOn<<6|p.hasRedundancy<<4|p.paddingValue<<1|p.isNonSync,p.degradPrio&61440,p.degradPrio&15,v>>>24&255,v>>>16&255,v>>>8&255,v&255],12+16*c);return q.box(q.types.trun,l)}static initSegment(e){q.types||q.init();const t=q.moov(e);return bi(q.FTYP,t)}static hvc1(e){const t=e.params,s=[e.vps,e.sps,e.pps],n=4,r=new Uint8Array([1,t.general_profile_space<<6|(t.general_tier_flag?32:0)|t.general_profile_idc,t.general_profile_compatibility_flags[0],t.general_profile_compatibility_flags[1],t.general_profile_compatibility_flags[2],t.general_profile_compatibility_flags[3],t.general_constraint_indicator_flags[0],t.general_constraint_indicator_flags[1],t.general_constraint_indicator_flags[2],t.general_constraint_indicator_flags[3],t.general_constraint_indicator_flags[4],t.general_constraint_indicator_flags[5],t.general_level_idc,240|t.min_spatial_segmentation_idc>>8,255&t.min_spatial_segmentation_idc,252|t.parallelismType,252|t.chroma_format_idc,248|t.bit_depth_luma_minus8,248|t.bit_depth_chroma_minus8,0,parseInt(t.frame_rate.fps),n-1|t.temporal_id_nested<<2|t.num_temporal_layers<<3|(t.frame_rate.fixed?64:0),s.length]);let l=r.length;for(let S=0;S<s.length;S+=1){l+=3;for(let T=0;T<s[S].length;T+=1)l+=2+s[S][T].length}const c=new Uint8Array(l);c.set(r,0),l=r.length;const h=s.length-1;for(let S=0;S<s.length;S+=1){c.set(new Uint8Array([32+S|(S===h?128:0),0,s[S].length]),l),l+=3;for(let T=0;T<s[S].length;T+=1)c.set(new Uint8Array([s[S][T].length>>8,s[S][T].length&255]),l),l+=2,c.set(s[S][T],l),l+=s[S][T].length}const d=q.box(q.types.hvcC,c),f=e.width,p=e.height,v=e.pixelRatio[0],x=e.pixelRatio[1];return q.box(q.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,f>>8&255,f&255,p>>8&255,p&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),d,q.box(q.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),q.box(q.types.pasp,new Uint8Array([v>>24,v>>16&255,v>>8&255,v&255,x>>24,x>>16&255,x>>8&255,x&255])))}}q.types=void 0;q.HDLR_TYPES=void 0;q.STTS=void 0;q.STSC=void 0;q.STCO=void 0;q.STSZ=void 0;q.VMHD=void 0;q.SMHD=void 0;q.STSD=void 0;q.FTYP=void 0;q.DINF=void 0;const fb=9e4;function mm(i,e,t=1,s=!1){const n=i*e*t;return s?Math.round(n):n}function LC(i,e,t=1,s=!1){return mm(i,e,1/t,s)}function Rl(i,e=!1){return mm(i,1e3,1/fb,e)}function wC(i,e=1){return mm(i,fb,1/e)}function zy(i){const{baseTime:e,timescale:t,trackId:s}=i;return`${e/t} (${e}/${t}) trackId: ${s}`}const CC=10*1e3,OC=1024,NC=1152,DC=1536;let yr=null,qh=null;function Ky(i,e,t,s){return{duration:e,size:t,cts:s,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:i?2:1,isNonSync:i?0:1}}}class Uc extends Ti{constructor(e,t,s,n){if(super("mp4-remuxer",n),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextVideoTs=null,this.nextAudioTs=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=t,this.typeSupported=s,this.ISGenerated=!1,yr===null){const l=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);yr=l?parseInt(l[1]):0}if(qh===null){const r=navigator.userAgent.match(/Safari\/(\d+)/i);qh=r?parseInt(r[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){const t=this._initPTS;(!t||!e||e.trackId!==t.trackId||e.baseTime!==t.baseTime||e.timescale!==t.timescale)&&this.log(`Reset initPTS: ${t&&zy(t)} > ${e&&zy(e)}`),this._initPTS=this._initDTS=e}resetNextTimestamp(){this.log("reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){this.log("ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let t=!1;const s=e[0].pts,n=e.reduce((r,l)=>{let c=l.pts,h=c-r;return h<-4294967296&&(t=!0,c=ti(c,s),h=c-r),h>0?r:c},s);return t&&this.debug("PTS rollover detected"),n}remux(e,t,s,n,r,l,c,h){let d,f,p,v,x,S,T=r,E=r;const A=e.pid>-1,_=t.pid>-1,R=t.samples.length,w=e.samples.length>0,N=c&&R>0||R>1;if((!A||w)&&(!_||N)||this.ISGenerated||c){if(this.ISGenerated){var D,F,j,M;const ne=this.videoTrackConfig;(ne&&(t.width!==ne.width||t.height!==ne.height||((D=t.pixelRatio)==null?void 0:D[0])!==((F=ne.pixelRatio)==null?void 0:F[0])||((j=t.pixelRatio)==null?void 0:j[1])!==((M=ne.pixelRatio)==null?void 0:M[1]))||!ne&&N||this.nextAudioTs===null&&w)&&this.resetInitSegment()}this.ISGenerated||(p=this.generateIS(e,t,r,l));const H=this.isVideoContiguous;let K=-1,se;if(N&&(K=kC(t.samples),!H&&this.config.forceKeyFrameOnDiscontinuity))if(S=!0,K>0){this.warn(`Dropped ${K} out of ${R} video samples due to a missing keyframe`);const ne=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(K),t.dropped+=K,E+=(t.samples[0].pts-ne)/t.inputTimeScale,se=E}else K===-1&&(this.warn(`No keyframe found out of ${R} video samples`),S=!1);if(this.ISGenerated){if(w&&N){const ne=this.getVideoStartPts(t.samples),k=(ti(e.samples[0].pts,ne)-ne)/t.inputTimeScale;T+=Math.max(0,k),E+=Math.max(0,-k)}if(w){if(e.samplerate||(this.warn("regenerate InitSegment as audio detected"),p=this.generateIS(e,t,r,l)),f=this.remuxAudio(e,T,this.isAudioContiguous,l,_||N||h===ke.AUDIO?E:void 0),N){const ne=f?f.endPTS-f.startPTS:0;t.inputTimeScale||(this.warn("regenerate InitSegment as video detected"),p=this.generateIS(e,t,r,l)),d=this.remuxVideo(t,E,H,ne)}}else N&&(d=this.remuxVideo(t,E,H,0));d&&(d.firstKeyFrame=K,d.independent=K!==-1,d.firstKeyFramePTS=se)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(s.samples.length&&(x=mb(s,r,this._initPTS,this._initDTS)),n.samples.length&&(v=pb(n,r,this._initPTS))),{audio:f,video:d,initSegment:p,independent:S,text:v,id3:x}}computeInitPts(e,t,s,n){const r=Math.round(s*t);let l=ti(e,r);if(l<r+t)for(this.log(`Adjusting PTS for rollover in timeline near ${(r-l)/t} ${n}`);l<r+t;)l+=8589934592;return l-r}generateIS(e,t,s,n){const r=e.samples,l=t.samples,c=this.typeSupported,h={},d=this._initPTS;let f=!d||n,p="audio/mp4",v,x,S,T=-1;if(f&&(v=x=1/0),e.config&&r.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":c.mpeg?(p="audio/mpeg",e.codec=""):c.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3";break}h.audio={id:"audio",container:p,codec:e.codec,initSegment:e.segmentCodec==="mp3"&&c.mpeg?new Uint8Array(0):q.initSegment([e]),metadata:{channelCount:e.channelCount}},f&&(T=e.id,S=e.inputTimeScale,!d||S!==d.timescale?v=x=this.computeInitPts(r[0].pts,S,s,"audio"):f=!1)}if(t.sps&&t.pps&&l.length){if(t.timescale=t.inputTimeScale,h.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:q.initSegment([t]),metadata:{width:t.width,height:t.height}},f)if(T=t.id,S=t.inputTimeScale,!d||S!==d.timescale){const E=this.getVideoStartPts(l),A=ti(l[0].dts,E),_=this.computeInitPts(A,S,s,"video"),R=this.computeInitPts(E,S,s,"video");x=Math.min(x,_),v=Math.min(v,R)}else f=!1;this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(h).length)return this.ISGenerated=!0,f?(d&&this.warn(`Timestamps at playlist time: ${n?"":"~"}${s} ${v/S} != initPTS: ${d.baseTime/d.timescale} (${d.baseTime}/${d.timescale}) trackId: ${d.trackId}`),this.log(`Found initPTS at playlist time: ${s} offset: ${v/S} (${v}/${S}) trackId: ${T}`),this._initPTS={baseTime:v,timescale:S,trackId:T},this._initDTS={baseTime:x,timescale:S,trackId:T}):v=S=void 0,{tracks:h,initPTS:v,timescale:S,trackId:T}}remuxVideo(e,t,s,n){const r=e.inputTimeScale,l=e.samples,c=[],h=l.length,d=this._initPTS,f=d.baseTime*r/d.timescale;let p=this.nextVideoTs,v=8,x=this.videoSampleDuration,S,T,E=Number.POSITIVE_INFINITY,A=Number.NEGATIVE_INFINITY,_=!1;if(!s||p===null){const P=f+t*r,$=l[0].pts-ti(l[0].dts,l[0].pts);yr&&p!==null&&Math.abs(P-$-(p+f))<15e3?s=!0:p=P-$-f}const R=p+f;for(let P=0;P<h;P++){const $=l[P];$.pts=ti($.pts,R),$.dts=ti($.dts,R),$.dts<l[P>0?P-1:P].dts&&(_=!0)}_&&l.sort(function(P,$){const ie=P.dts-$.dts,fe=P.pts-$.pts;return ie||fe}),S=l[0].dts,T=l[l.length-1].dts;const w=T-S,N=w?Math.round(w/(h-1)):x||e.inputTimeScale/30;if(s){const P=S-R,$=P>N,ie=P<-1;if(($||ie)&&($?this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${Rl(P,!0)} ms (${P}dts) hole between fragments detected at ${t.toFixed(3)}`):this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${Rl(-P,!0)} ms (${P}dts) overlapping between fragments detected at ${t.toFixed(3)}`),!ie||R>=l[0].pts||yr)){S=R;const fe=l[0].pts-P;if($)l[0].dts=S,l[0].pts=fe;else{let ge=!0;for(let ve=0;ve<l.length&&!(l[ve].dts>fe&&ge);ve++){const Ne=l[ve].pts;if(l[ve].dts-=P,l[ve].pts-=P,ve<l.length-1){const pe=l[ve+1].pts,we=l[ve].pts,ot=pe<=we,ct=pe<=Ne;ge=ot==ct}}}this.log(`Video: Initial PTS/DTS adjusted: ${Rl(fe,!0)}/${Rl(S,!0)}, delta: ${Rl(P,!0)} ms`)}}S=Math.max(0,S);let U=0,D=0,F=S;for(let P=0;P<h;P++){const $=l[P],ie=$.units,fe=ie.length;let ge=0;for(let ve=0;ve<fe;ve++)ge+=ie[ve].data.length;D+=ge,U+=fe,$.length=ge,$.dts<F?($.dts=F,F+=N/4|0||1):F=$.dts,E=Math.min($.pts,E),A=Math.max($.pts,A)}T=l[h-1].dts;const j=D+4*U+8;let M;try{M=new Uint8Array(j)}catch(P){this.observer.emit(L.ERROR,L.ERROR,{type:je.MUX_ERROR,details:Q.REMUX_ALLOC_ERROR,fatal:!1,error:P,bytes:j,reason:`fail allocating video mdat ${j}`});return}const H=new DataView(M.buffer);H.setUint32(0,j),M.set(q.types.mdat,4);let K=!1,se=Number.POSITIVE_INFINITY,ne=Number.POSITIVE_INFINITY,de=Number.NEGATIVE_INFINITY,k=Number.NEGATIVE_INFINITY;for(let P=0;P<h;P++){const $=l[P],ie=$.units;let fe=0;for(let Ne=0,pe=ie.length;Ne<pe;Ne++){const we=ie[Ne],ot=we.data,ct=we.data.byteLength;H.setUint32(v,ct),v+=4,M.set(ot,v),v+=ct,fe+=4+ct}let ge;if(P<h-1)x=l[P+1].dts-$.dts,ge=l[P+1].pts-$.pts;else{const Ne=this.config,pe=P>0?$.dts-l[P-1].dts:N;if(ge=P>0?$.pts-l[P-1].pts:N,Ne.stretchShortVideoTrack&&this.nextAudioTs!==null){const we=Math.floor(Ne.maxBufferHole*r),ot=(n?E+n*r:this.nextAudioTs+f)-$.pts;ot>we?(x=ot-pe,x<0?x=pe:K=!0,this.log(`It is approximately ${ot/90} ms to the next segment; using duration ${x/90} ms for the last video frame.`)):x=pe}else x=pe}const ve=Math.round($.pts-$.dts);se=Math.min(se,x),de=Math.max(de,x),ne=Math.min(ne,ge),k=Math.max(k,ge),c.push(Ky($.key,x,fe,ve))}if(c.length){if(yr){if(yr<70){const P=c[0].flags;P.dependsOn=2,P.isNonSync=0}}else if(qh&&k-ne<de-se&&N/de<.025&&c[0].cts===0){this.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let P=S;for(let $=0,ie=c.length;$<ie;$++){const fe=P+c[$].duration,ge=P+c[$].cts;if($<ie-1){const ve=fe+c[$+1].cts;c[$].duration=ve-ge}else c[$].duration=$?c[$-1].duration:N;c[$].cts=0,P=fe}}}x=K||!x?N:x;const G=T+x;this.nextVideoTs=p=G-f,this.videoSampleDuration=x,this.isVideoContiguous=!0;const me={data1:q.moof(e.sequenceNumber++,S,At(e,{samples:c})),data2:M,startPTS:(E-f)/r,endPTS:(A+x-f)/r,startDTS:(S-f)/r,endDTS:p/r,type:"video",hasAudio:!1,hasVideo:!0,nb:c.length,dropped:e.dropped};return e.samples=[],e.dropped=0,me}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return NC;case"ac3":return DC;default:return OC}}remuxAudio(e,t,s,n,r){const l=e.inputTimeScale,c=e.samplerate?e.samplerate:l,h=l/c,d=this.getSamplesPerFrame(e),f=d*h,p=this._initPTS,v=e.segmentCodec==="mp3"&&this.typeSupported.mpeg,x=[],S=r!==void 0;let T=e.samples,E=v?0:8,A=this.nextAudioTs||-1;const _=p.baseTime*l/p.timescale,R=_+t*l;if(this.isAudioContiguous=s=s||T.length&&A>0&&(n&&Math.abs(R-(A+_))<9e3||Math.abs(ti(T[0].pts,R)-(A+_))<20*f),T.forEach(function(k){k.pts=ti(k.pts,R)}),!s||A<0){const k=T.length;if(T=T.filter(G=>G.pts>=0),k!==T.length&&this.warn(`Removed ${T.length-k} of ${k} samples (initPTS ${_} / ${l})`),!T.length)return;r===0?A=0:n&&!S?A=Math.max(0,R-_):A=T[0].pts-_}if(e.segmentCodec==="aac"){const k=this.config.maxAudioFramesDrift;for(let G=0,Y=A+_;G<T.length;G++){const le=T[G],me=le.pts,P=me-Y,$=Math.abs(1e3*P/l);if(P<=-k*f&&S)G===0&&(this.warn(`Audio frame @ ${(me/l).toFixed(3)}s overlaps marker by ${Math.round(1e3*P/l)} ms.`),this.nextAudioTs=A=me-_,Y=me);else if(P>=k*f&&$<CC&&S){let ie=Math.round(P/f);for(Y=me-ie*f;Y<0&&ie&&f;)ie--,Y+=f;G===0&&(this.nextAudioTs=A=Y-_),this.warn(`Injecting ${ie} audio frames @ ${((Y-_)/l).toFixed(3)}s due to ${Math.round(1e3*P/l)} ms gap.`);for(let fe=0;fe<ie;fe++){let ge=RC.getSilentFrame(e.parsedCodec||e.manifestCodec||e.codec,e.channelCount);ge||(this.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),ge=le.unit.subarray()),T.splice(G,0,{unit:ge,pts:Y}),Y+=f,G++}}le.pts=Y,Y+=f}}let w=null,N=null,U,D=0,F=T.length;for(;F--;)D+=T[F].unit.byteLength;for(let k=0,G=T.length;k<G;k++){const Y=T[k],le=Y.unit;let me=Y.pts;if(N!==null){const $=x[k-1];$.duration=Math.round((me-N)/h)}else if(s&&e.segmentCodec==="aac"&&(me=A+_),w=me,D>0){D+=E;try{U=new Uint8Array(D)}catch($){this.observer.emit(L.ERROR,L.ERROR,{type:je.MUX_ERROR,details:Q.REMUX_ALLOC_ERROR,fatal:!1,error:$,bytes:D,reason:`fail allocating audio mdat ${D}`});return}v||(new DataView(U.buffer).setUint32(0,D),U.set(q.types.mdat,4))}else return;U.set(le,E);const P=le.byteLength;E+=P,x.push(Ky(!0,d,P,0)),N=me}const j=x.length;if(!j)return;const M=x[x.length-1];A=N-_,this.nextAudioTs=A+h*M.duration;const H=v?new Uint8Array(0):q.moof(e.sequenceNumber++,w/h,At({},e,{samples:x}));e.samples=[];const K=(w-_)/l,se=this.nextAudioTs/l,de={data1:H,data2:U,startPTS:K,endPTS:se,startDTS:K,endDTS:se,type:"audio",hasAudio:!0,hasVideo:!1,nb:j};return this.isAudioContiguous=!0,de}}function ti(i,e){let t;if(e===null)return i;for(e<i?t=-8589934592:t=8589934592;Math.abs(i-e)>4294967296;)i+=t;return i}function kC(i){for(let e=0;e<i.length;e++)if(i[e].key)return e;return-1}function mb(i,e,t,s){const n=i.samples.length;if(!n)return;const r=i.inputTimeScale;for(let c=0;c<n;c++){const h=i.samples[c];h.pts=ti(h.pts-t.baseTime*r/t.timescale,e*r)/r,h.dts=ti(h.dts-s.baseTime*r/s.timescale,e*r)/r}const l=i.samples;return i.samples=[],{samples:l}}function pb(i,e,t){const s=i.samples.length;if(!s)return;const n=i.inputTimeScale;for(let l=0;l<s;l++){const c=i.samples[l];c.pts=ti(c.pts-t.baseTime*n/t.timescale,e*n)/n}i.samples.sort((l,c)=>l.pts-c.pts);const r=i.samples;return i.samples=[],{samples:r}}class PC extends Ti{constructor(e,t,s,n){super("passthrough-remuxer",n),this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null,this.isVideoContiguous=!1}destroy(){}resetTimeStamp(e){this.lastEndTime=null;const t=this.initPTS;t&&e&&t.baseTime===e.baseTime&&t.timescale===e.timescale||(this.initPTS=e)}resetNextTimestamp(){this.isVideoContiguous=!1,this.lastEndTime=null}resetInitSegment(e,t,s,n){this.audioCodec=t,this.videoCodec=s,this.generateInitSegment(e,n),this.emitInitSegment=!0}generateInitSegment(e,t){let{audioCodec:s,videoCodec:n}=this;if(!(e!=null&&e.byteLength)){this.initTracks=void 0,this.initData=void 0;return}const{audio:r,video:l}=this.initData=bS(e);if(t)E1(e,t);else{const h=r||l;h!=null&&h.encrypted&&this.warn(`Init segment with encrypted track with has no key ("${h.codec}")!`)}r&&(s=Yy(r,Ct.AUDIO,this)),l&&(n=Yy(l,Ct.VIDEO,this));const c={};r&&l?c.audiovideo={container:"video/mp4",codec:s+","+n,supplemental:l.supplemental,encrypted:l.encrypted,initSegment:e,id:"main"}:r?c.audio={container:"audio/mp4",codec:s,encrypted:r.encrypted,initSegment:e,id:"audio"}:l?c.video={container:"video/mp4",codec:n,supplemental:l.supplemental,encrypted:l.encrypted,initSegment:e,id:"main"}:this.warn("initSegment does not contain moov or trak boxes."),this.initTracks=c}remux(e,t,s,n,r,l){var c,h;let{initPTS:d,lastEndTime:f}=this;const p={audio:void 0,video:void 0,text:n,id3:s,initSegment:void 0};Ce(f)||(f=this.lastEndTime=r||0);const v=t.samples;if(!v.length)return p;const x={initPTS:void 0,timescale:void 0,trackId:void 0};let S=this.initData;if((c=S)!=null&&c.length||(this.generateInitSegment(v),S=this.initData),!((h=S)!=null&&h.length))return this.warn("Failed to generate initSegment."),p;this.emitInitSegment&&(x.tracks=this.initTracks,this.emitInitSegment=!1);const T=A1(v,S,this),E=S.audio?T[S.audio.id]:null,A=S.video?T[S.video.id]:null,_=xc(A,1/0),R=xc(E,1/0),w=xc(A,0,!0),N=xc(E,0,!0);let U=r,D=0;const F=E&&(!A||!d&&R<_||d&&d.trackId===S.audio.id),j=F?E:A;if(j){const Y=j.timescale,le=j.start-r*Y,me=F?S.audio.id:S.video.id;U=j.start/Y,D=F?N-R:w-_,(l||!d)&&(UC(d,U,r,D)||Y!==d.timescale)&&(d&&this.warn(`Timestamps at playlist time: ${l?"":"~"}${r} ${le/Y} != initPTS: ${d.baseTime/d.timescale} (${d.baseTime}/${d.timescale}) trackId: ${d.trackId}`),this.log(`Found initPTS at playlist time: ${r} offset: ${U-r} (${le}/${Y}) trackId: ${me}`),d=null,x.initPTS=le,x.timescale=Y,x.trackId=me)}else this.warn(`No audio or video samples found for initPTS at playlist time: ${r}`);d?(x.initPTS=d.baseTime,x.timescale=d.timescale,x.trackId=d.trackId):((!x.timescale||x.trackId===void 0||x.initPTS===void 0)&&(this.warn("Could not set initPTS"),x.initPTS=U,x.timescale=1,x.trackId=-1),this.initPTS=d={baseTime:x.initPTS,timescale:x.timescale,trackId:x.trackId});const M=U-d.baseTime/d.timescale,H=M+D;D>0?this.lastEndTime=H:(this.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const K=!!S.audio,se=!!S.video;let ne="";K&&(ne+="audio"),se&&(ne+="video");const de=(S.audio?S.audio.encrypted:!1)||(S.video?S.video.encrypted:!1),k={data1:v,startPTS:M,startDTS:M,endPTS:H,endDTS:H,type:ne,hasAudio:K,hasVideo:se,nb:1,dropped:0,encrypted:de};p.audio=K&&!se?k:void 0,p.video=se?k:void 0;const G=A?.sampleCount;if(G){const Y=A.keyFrameIndex,le=Y!==-1;k.nb=G,k.dropped=Y===0||this.isVideoContiguous?0:le?Y:G,k.independent=le,k.firstKeyFrame=Y,le&&A.keyFrameStart&&(k.firstKeyFramePTS=(A.keyFrameStart-d.baseTime)/d.timescale),this.isVideoContiguous||(p.independent=le),this.isVideoContiguous||(this.isVideoContiguous=le),k.dropped&&this.warn(`fmp4 does not start with IDR: firstIDR ${Y}/${G} dropped: ${k.dropped} start: ${k.firstKeyFramePTS||"NA"}`)}return p.initSegment=x,p.id3=mb(s,r,d,d),n.samples.length&&(p.text=pb(n,r,d)),p}}function xc(i,e,t=!1){return i?.start!==void 0?(i.start+(t?i.duration:0))/i.timescale:e}function UC(i,e,t,s){if(i===null)return!0;const n=Math.max(s,1),r=e-i.baseTime/i.timescale;return Math.abs(r-t)>n}function Yy(i,e,t){const s=i.codec;return s&&s.length>4?s:e===Ct.AUDIO?s==="ec-3"||s==="ac-3"||s==="alac"?s:s==="fLaC"||s==="Opus"?Yc(s,!1):(t.warn(`Unhandled audio codec "${s}" in mp4 MAP`),s||"mp4a"):(t.warn(`Unhandled video codec "${s}" in mp4 MAP`),s||"avc1")}let xn;try{xn=self.performance.now.bind(self.performance)}catch{xn=Date.now}const Mc=[{demux:bC,remux:PC},{demux:Zn,remux:Uc},{demux:vC,remux:Uc},{demux:xC,remux:Uc}];Mc.splice(2,0,{demux:yC,remux:Uc});class qy{constructor(e,t,s,n,r,l){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=s,this.id=r,this.logger=l}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,s,n){const r=s.transmuxing;r.executeStart=xn();let l=new Uint8Array(e);const{currentTransmuxState:c,transmuxConfig:h}=this;n&&(this.currentTransmuxState=n);const{contiguous:d,discontinuity:f,trackSwitch:p,accurateTimeOffset:v,timeOffset:x,initSegmentChange:S}=n||c,{audioCodec:T,videoCodec:E,defaultInitPts:A,duration:_,initSegmentData:R}=h,w=MC(l,t);if(w&&Er(w.method)){const F=this.getDecrypter(),j=am(w.method);if(F.isSync()){let M=F.softwareDecrypt(l,w.key.buffer,w.iv.buffer,j);if(s.part>-1){const K=F.flush();M=K&&K.buffer}if(!M)return r.executeEnd=xn(),Qh(s);l=new Uint8Array(M)}else return this.asyncResult=!0,this.decryptionPromise=F.webCryptoDecrypt(l,w.key.buffer,w.iv.buffer,j).then(M=>{const H=this.push(M,null,s);return this.decryptionPromise=null,H}),this.decryptionPromise}const N=this.needsProbing(f,p);if(N){const F=this.configureTransmuxer(l);if(F)return this.logger.warn(`[transmuxer] ${F.message}`),this.observer.emit(L.ERROR,L.ERROR,{type:je.MEDIA_ERROR,details:Q.FRAG_PARSING_ERROR,fatal:!1,error:F,reason:F.message}),r.executeEnd=xn(),Qh(s)}(f||p||S||N)&&this.resetInitSegment(R,T,E,_,t),(f||S||N)&&this.resetInitialTimestamp(A),d||this.resetContiguity();const U=this.transmux(l,w,x,v,s);this.asyncResult=jl(U);const D=this.currentTransmuxState;return D.contiguous=!0,D.discontinuity=!1,D.trackSwitch=!1,r.executeEnd=xn(),U}flush(e){const t=e.transmuxing;t.executeStart=xn();const{decrypter:s,currentTransmuxState:n,decryptionPromise:r}=this;if(r)return this.asyncResult=!0,r.then(()=>this.flush(e));const l=[],{timeOffset:c}=n;if(s){const p=s.flush();p&&l.push(this.push(p.buffer,null,e))}const{demuxer:h,remuxer:d}=this;if(!h||!d){t.executeEnd=xn();const p=[Qh(e)];return this.asyncResult?Promise.resolve(p):p}const f=h.flush(c);return jl(f)?(this.asyncResult=!0,f.then(p=>(this.flushRemux(l,p,e),l))):(this.flushRemux(l,f,e),this.asyncResult?Promise.resolve(l):l)}flushRemux(e,t,s){const{audioTrack:n,videoTrack:r,id3Track:l,textTrack:c}=t,{accurateTimeOffset:h,timeOffset:d}=this.currentTransmuxState;this.logger.log(`[transmuxer.ts]: Flushed ${this.id} sn: ${s.sn}${s.part>-1?" part: "+s.part:""} of ${this.id===ke.MAIN?"level":"track"} ${s.level}`);const f=this.remuxer.remux(n,r,l,c,d,h,!0,this.id);e.push({remuxResult:f,chunkMeta:s}),s.transmuxing.executeEnd=xn()}resetInitialTimestamp(e){const{demuxer:t,remuxer:s}=this;!t||!s||(t.resetTimeStamp(e),s.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:t}=this;!e||!t||(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,s,n,r){const{demuxer:l,remuxer:c}=this;!l||!c||(l.resetInitSegment(e,t,s,n),c.resetInitSegment(e,t,s,r))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,s,n,r){let l;return t&&t.method==="SAMPLE-AES"?l=this.transmuxSampleAes(e,t,s,n,r):l=this.transmuxUnencrypted(e,s,n,r),l}transmuxUnencrypted(e,t,s,n){const{audioTrack:r,videoTrack:l,id3Track:c,textTrack:h}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(r,l,c,h,t,s,!1,this.id),chunkMeta:n}}transmuxSampleAes(e,t,s,n,r){return this.demuxer.demuxSampleAes(e,t,s).then(l=>({remuxResult:this.remuxer.remux(l.audioTrack,l.videoTrack,l.id3Track,l.textTrack,s,n,!1,this.id),chunkMeta:r}))}configureTransmuxer(e){const{config:t,observer:s,typeSupported:n}=this;let r;for(let p=0,v=Mc.length;p<v;p++){var l;if((l=Mc[p].demux)!=null&&l.probe(e,this.logger)){r=Mc[p];break}}if(!r)return new Error("Failed to find demuxer by probing fragment data");const c=this.demuxer,h=this.remuxer,d=r.remux,f=r.demux;(!h||!(h instanceof d))&&(this.remuxer=new d(s,t,n,this.logger)),(!c||!(c instanceof f))&&(this.demuxer=new f(s,t,n,this.logger),this.probe=f.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new im(this.config)),e}}function MC(i,e){let t=null;return i.byteLength>0&&e?.key!=null&&e.iv!==null&&e.method!=null&&(t=e),t}const Qh=i=>({remuxResult:{},chunkMeta:i});function jl(i){return"then"in i&&i.then instanceof Function}class jC{constructor(e,t,s,n,r){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=s,this.duration=n,this.defaultInitPts=r||null}}class FC{constructor(e,t,s,n,r,l){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=s,this.trackSwitch=n,this.timeOffset=r,this.initSegmentChange=l}}let Qy=0;class gb{constructor(e,t,s,n){this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=Qy++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=h=>{const d=h.data,f=this.hls;if(!(!f||!(d!=null&&d.event)||d.instanceNo!==this.instanceNo))switch(d.event){case"init":{var p;const v=(p=this.workerContext)==null?void 0:p.objectURL;v&&self.URL.revokeObjectURL(v);break}case"transmuxComplete":{this.handleTransmuxComplete(d.data);break}case"flush":{this.onFlush(d.data);break}case"workerLog":{f.logger[d.data.logType]&&f.logger[d.data.logType](d.data.message);break}default:{d.data=d.data||{},d.data.frag=this.frag,d.data.part=this.part,d.data.id=this.id,f.trigger(d.event,d.data);break}}},this.onWorkerError=h=>{if(!this.hls)return;const d=new Error(`${h.message}  (${h.filename}:${h.lineno})`);this.hls.config.enableWorker=!1,this.hls.logger.warn(`Error in "${this.id}" Web Worker, fallback to inline`),this.hls.trigger(L.ERROR,{type:je.OTHER_ERROR,details:Q.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:d})};const r=e.config;this.hls=e,this.id=t,this.useWorker=!!r.enableWorker,this.onTransmuxComplete=s,this.onFlush=n;const l=(h,d)=>{d=d||{},d.frag=this.frag||void 0,h===L.ERROR&&(d=d,d.parent=this.id,d.part=this.part,this.error=d.error),this.hls.trigger(h,d)};this.observer=new om,this.observer.on(L.FRAG_DECRYPTED,l),this.observer.on(L.ERROR,l);const c=uy(r.preferManagedMediaSource);if(this.useWorker&&typeof Worker<"u"){const h=this.hls.logger;if(r.workerPath||Gw()){try{r.workerPath?(h.log(`loading Web Worker ${r.workerPath} for "${t}"`),this.workerContext=zw(r.workerPath)):(h.log(`injecting Web Worker for "${t}"`),this.workerContext=Hw());const{worker:f}=this.workerContext;f.addEventListener("message",this.onWorkerMessage),f.addEventListener("error",this.onWorkerError),f.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:c,id:t,config:Ot(r)})}catch(f){h.warn(`Error setting up "${t}" Web Worker, fallback to inline`,f),this.terminateWorker(),this.error=null,this.transmuxer=new qy(this.observer,c,r,"",t,e.logger)}return}}this.transmuxer=new qy(this.observer,c,r,"",t,e.logger)}reset(){if(this.frag=null,this.part=null,this.workerContext){const e=this.instanceNo;this.instanceNo=Qy++;const t=this.hls.config,s=uy(t.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:e,typeSupported:s,id:this.id,config:Ot(t)})}}terminateWorker(){if(this.workerContext){const{worker:e}=this.workerContext;this.workerContext=null,e.removeEventListener("message",this.onWorkerMessage),e.removeEventListener("error",this.onWorkerError),Kw(this.hls.config.workerPath)}}destroy(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{const t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null}push(e,t,s,n,r,l,c,h,d,f){var p,v;d.transmuxing.start=self.performance.now();const{instanceNo:x,transmuxer:S}=this,T=l?l.start:r.start,E=r.decryptdata,A=this.frag,_=!(A&&r.cc===A.cc),R=!(A&&d.level===A.level),w=A?d.sn-A.sn:-1,N=this.part?d.part-this.part.index:-1,U=w===0&&d.id>1&&d.id===A?.stats.chunkCount,D=!R&&(w===1||w===0&&(N===1||U&&N<=0)),F=self.performance.now();(R||w||r.stats.parsing.start===0)&&(r.stats.parsing.start=F),l&&(N||!D)&&(l.stats.parsing.start=F);const j=!(A&&((p=r.initSegment)==null?void 0:p.url)===((v=A.initSegment)==null?void 0:v.url)),M=new FC(_,D,h,R,T,j);if(!D||_||j){this.hls.logger.log(`[transmuxer-interface]: Starting new transmux session for ${r.type} sn: ${d.sn}${d.part>-1?" part: "+d.part:""} ${this.id===ke.MAIN?"level":"track"}: ${d.level} id: ${d.id}
        discontinuity: ${_}
        trackSwitch: ${R}
        contiguous: ${D}
        accurateTimeOffset: ${h}
        timeOffset: ${T}
        initSegmentChange: ${j}`);const H=new jC(s,n,t,c,f);this.configureTransmuxer(H)}if(this.frag=r,this.part=l,this.workerContext)this.workerContext.worker.postMessage({instanceNo:x,cmd:"demux",data:e,decryptdata:E,chunkMeta:d,state:M},e instanceof ArrayBuffer?[e]:[]);else if(S){const H=S.push(e,E,d,M);jl(H)?H.then(K=>{this.handleTransmuxComplete(K)}).catch(K=>{this.transmuxerError(K,d,"transmuxer-interface push error")}):this.handleTransmuxComplete(H)}}flush(e){e.transmuxing.start=self.performance.now();const{instanceNo:t,transmuxer:s}=this;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:t,cmd:"flush",chunkMeta:e});else if(s){const n=s.flush(e);jl(n)?n.then(r=>{this.handleFlushResult(r,e)}).catch(r=>{this.transmuxerError(r,e,"transmuxer-interface flush error")}):this.handleFlushResult(n,e)}}transmuxerError(e,t,s){this.hls&&(this.error=e,this.hls.trigger(L.ERROR,{type:je.MEDIA_ERROR,details:Q.FRAG_PARSING_ERROR,chunkMeta:t,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:e,err:e,reason:s}))}handleFlushResult(e,t){e.forEach(s=>{this.handleTransmuxComplete(s)}),this.onFlush(t)}configureTransmuxer(e){const{instanceNo:t,transmuxer:s}=this;this.workerContext?this.workerContext.worker.postMessage({instanceNo:t,cmd:"configure",config:e}):s&&s.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}const Xy=100;class BC extends lm{constructor(e,t,s){super(e,t,s,"audio-stream-controller",ke.AUDIO),this.mainAnchor=null,this.mainFragLoading=null,this.audioOnly=!1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.resetItem()}resetItem(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(L.LEVEL_LOADED,this.onLevelLoaded,this),e.on(L.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(L.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(L.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(L.BUFFER_RESET,this.onBufferReset,this),e.on(L.BUFFER_CREATED,this.onBufferCreated,this),e.on(L.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(L.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(L.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(L.FRAG_LOADING,this.onFragLoading,this),e.on(L.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){const{hls:e}=this;e&&(super.unregisterListeners(),e.off(L.LEVEL_LOADED,this.onLevelLoaded,this),e.off(L.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(L.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(L.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(L.BUFFER_RESET,this.onBufferReset,this),e.off(L.BUFFER_CREATED,this.onBufferCreated,this),e.off(L.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(L.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(L.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(L.FRAG_LOADING,this.onFragLoading,this),e.off(L.FRAG_BUFFERED,this.onFragBuffered,this))}onInitPtsFound(e,{frag:t,id:s,initPTS:n,timescale:r,trackId:l}){if(s===ke.MAIN){const c=t.cc,h=this.fragCurrent;if(this.initPTS[c]={baseTime:n,timescale:r,trackId:l},this.log(`InitPTS for cc: ${c} found from main: ${n/r} (${n}/${r}) trackId: ${l}`),this.mainAnchor=t,this.state===re.WAITING_INIT_PTS){const d=this.waitingData;(!d&&!this.loadingParts||d&&d.frag.cc!==c)&&this.syncWithAnchor(t,d?.frag)}else!this.hls.hasEnoughToStart&&h&&h.cc!==c?(h.abortRequests(),this.syncWithAnchor(t,h)):this.state===re.IDLE&&this.tick()}}getLoadPosition(){return!this.startFragRequested&&this.nextLoadPosition>=0?this.nextLoadPosition:super.getLoadPosition()}syncWithAnchor(e,t){var s;const n=((s=this.mainFragLoading)==null?void 0:s.frag)||null;if(t&&n?.cc===t.cc)return;const r=(n||e).cc,l=this.getLevelDetails(),c=this.getLoadPosition(),h=NS(l,r,c);h&&(this.log(`Syncing with main frag at ${h.start} cc ${h.cc}`),this.startFragRequested=!1,this.nextLoadPosition=h.start,this.resetLoadingState(),this.state===re.IDLE&&this.doTickIdle())}startLoad(e,t){if(!this.levels){this.startPosition=e,this.state=re.STOPPED;return}const s=this.lastCurrentTime;this.stopLoad(),this.setInterval(Xy),s>0&&e===-1?(this.log(`Override startPosition with lastCurrentTime @${s.toFixed(3)}`),e=s,this.state=re.IDLE):this.state=re.WAITING_TRACK,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}doTick(){switch(this.state){case re.IDLE:this.doTickIdle();break;case re.WAITING_TRACK:{const{levels:e,trackId:t}=this,s=e?.[t],n=s?.details;if(n&&!this.waitForLive(s)){if(this.waitForCdnTuneIn(n))break;this.state=re.WAITING_INIT_PTS}break}case re.FRAG_LOADING_WAITING_RETRY:{this.checkRetryDate();break}case re.WAITING_INIT_PTS:{const e=this.waitingData;if(e){const{frag:t,part:s,cache:n,complete:r}=e,l=this.mainAnchor;if(this.initPTS[t.cc]!==void 0){this.waitingData=null,this.state=re.FRAG_LOADING;const c=n.flush().buffer,h={frag:t,part:s,payload:c,networkDetails:null};this._handleFragmentLoadProgress(h),r&&super._handleFragmentLoadComplete(h)}else l&&l.cc!==e.frag.cc&&this.syncWithAnchor(l,e.frag)}else this.state=re.IDLE}}this.onTickEnd()}resetLoadingState(){const e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null),super.resetLoadingState()}onTickEnd(){const{media:e}=this;e!=null&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){var e;const{hls:t,levels:s,media:n,trackId:r}=this,l=t.config;if(!this.buffering||!n&&!this.primaryPrefetch&&(this.startFragRequested||!l.startFragPrefetch)||!(s!=null&&s[r]))return;const c=s[r],h=c.details;if(!h||this.waitForLive(c)||this.waitForCdnTuneIn(h)){this.state=re.WAITING_TRACK,this.startFragRequested=!1;return}const d=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&d&&(this.bufferFlushed=!1,this.afterBufferFlushed(d,Ct.AUDIO,ke.AUDIO));const f=this.getFwdBufferInfo(d,ke.AUDIO);if(f===null)return;if(!this.switchingTrack&&this._streamEnded(f,h)){t.trigger(L.BUFFER_EOS,{type:"audio"}),this.state=re.ENDED;return}const p=f.len,v=t.maxBufferLength,x=h.fragments,S=x[0].start,T=this.getLoadPosition(),E=this.flushing?T:f.end;if(this.switchingTrack&&n){const R=T;h.PTSKnown&&R<S&&(f.end>S||f.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),n.currentTime=S+.05)}if(p>=v&&!this.switchingTrack&&E<x[x.length-1].start)return;let A=this.getNextFragment(E,h);if(A&&this.isLoopLoading(A,E)&&(A=this.getNextFragmentLoopLoading(A,h,f,ke.MAIN,v)),!A){this.bufferFlushed=!0;return}let _=((e=this.mainFragLoading)==null?void 0:e.frag)||null;if(!this.audioOnly&&this.startFragRequested&&_&&Qt(A)&&!A.endList&&(!h.live||!this.loadingParts&&E<this.hls.liveSyncPosition)&&(this.fragmentTracker.getState(_)===ls.OK&&(this.mainFragLoading=_=null),_&&Qt(_))){if(A.start>_.end){const w=this.fragmentTracker.getFragAtPos(E,ke.MAIN);w&&w.end>_.end&&(_=w,this.mainFragLoading={frag:w,targetBufferTime:null})}if(A.start>_.end)return}this.loadFragment(A,c,E)}onMediaDetaching(e,t){this.bufferFlushed=this.flushing=!1,super.onMediaDetaching(e,t)}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map(s=>new Pl(s))}onAudioTrackSwitching(e,t){const s=!!t.url;this.trackId=t.id;const{fragCurrent:n}=this;n&&(n.abortRequests(),this.removeUnbufferedFrags(n.start)),this.resetLoadingState(),s?(this.switchingTrack=t,this.flushAudioIfNeeded(t),this.state!==re.STOPPED&&(this.setInterval(Xy),this.state=re.IDLE,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=t,this.clearInterval())}onManifestLoading(){super.onManifestLoading(),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1}onLevelLoaded(e,t){this.mainDetails=t.details;const s=this.cachedTrackLoadedData;s&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded(L.AUDIO_TRACK_LOADED,s))}onAudioTrackLoaded(e,t){var s;const{levels:n}=this,{details:r,id:l,groupId:c,track:h}=t;if(!n){this.warn(`Audio tracks reset while loading track ${l} "${h.name}" of "${c}"`);return}const d=this.mainDetails;if(!d||r.endCC>d.endCC||d.expired){this.cachedTrackLoadedData=t,this.state!==re.STOPPED&&(this.state=re.WAITING_TRACK);return}this.cachedTrackLoadedData=null,this.log(`Audio track ${l} "${h.name}" of "${c}" loaded [${r.startSN},${r.endSN}]${r.lastPartSn?`[part-${r.lastPartSn}-${r.lastPartIndex}]`:""},duration:${r.totalduration}`);const f=n[l];let p=0;if(r.live||(s=f.details)!=null&&s.live){if(this.checkLiveUpdate(r),r.deltaUpdateFailed)return;if(f.details){var v;p=this.alignPlaylists(r,f.details,(v=this.levelLastLoaded)==null?void 0:v.details)}r.alignedSliding||(XS(r,d),r.alignedSliding||eu(r,d),p=r.fragmentStart)}f.details=r,this.levelLastLoaded=f,this.startFragRequested||this.setStartPosition(d,p),this.hls.trigger(L.AUDIO_TRACK_UPDATED,{details:r,id:l,groupId:t.groupId}),this.state===re.WAITING_TRACK&&!this.waitForCdnTuneIn(r)&&(this.state=re.IDLE),this.tick()}_handleFragmentLoadProgress(e){var t;const s=e.frag,{part:n,payload:r}=e,{config:l,trackId:c,levels:h}=this;if(!h){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${s.sn} of level ${s.level} will not be buffered`);return}const d=h[c];if(!d){this.warn("Audio track is undefined on fragment load progress");return}const f=d.details;if(!f){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(s.start);return}const p=l.defaultAudioCodec||d.audioCodec||"mp4a.40.2";let v=this.transmuxer;v||(v=this.transmuxer=new gb(this.hls,ke.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const x=this.initPTS[s.cc],S=(t=s.initSegment)==null?void 0:t.data;if(x!==void 0){const E=n?n.index:-1,A=E!==-1,_=new nm(s.level,s.sn,s.stats.chunkCount,r.byteLength,E,A);v.push(r,S,p,"",s,n,f.totalduration,!1,_,x)}else{this.log(`Unknown video PTS for cc ${s.cc}, waiting for video PTS before demuxing audio frag ${s.sn} of [${f.startSN} ,${f.endSN}],track ${c}`);const{cache:T}=this.waitingData=this.waitingData||{frag:s,part:n,cache:new WS,complete:!1};T.push(new Uint8Array(r)),this.state!==re.STOPPED&&(this.state=re.WAITING_INIT_PTS)}}_handleFragmentLoadComplete(e){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=null}onBufferCreated(e,t){this.bufferFlushed=this.flushing=!1;const s=t.tracks.audio;s&&(this.mediaBuffer=s.buffer||null)}onFragLoading(e,t){!this.audioOnly&&t.frag.type===ke.MAIN&&Qt(t.frag)&&(this.mainFragLoading=t,this.state===re.IDLE&&this.tick())}onFragBuffered(e,t){const{frag:s,part:n}=t;if(s.type!==ke.AUDIO){!this.audioOnly&&s.type===ke.MAIN&&!s.elementaryStreams.video&&!s.elementaryStreams.audiovideo&&(this.audioOnly=!0,this.mainFragLoading=null);return}if(this.fragContextChanged(s)){this.warn(`Fragment ${s.sn}${n?" p: "+n.index:""} of level ${s.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(Qt(s)){this.fragPrevious=s;const r=this.switchingTrack;r&&(this.bufferedTrack=r,this.switchingTrack=null,this.hls.trigger(L.AUDIO_TRACK_SWITCHED,vt({},r)))}this.fragBufferedComplete(s,n),this.media&&this.tick()}onError(e,t){var s;if(t.fatal){this.state=re.ERROR;return}switch(t.details){case Q.FRAG_GAP:case Q.FRAG_PARSING_ERROR:case Q.FRAG_DECRYPT_ERROR:case Q.FRAG_LOAD_ERROR:case Q.FRAG_LOAD_TIMEOUT:case Q.KEY_LOAD_ERROR:case Q.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(ke.AUDIO,t);break;case Q.AUDIO_TRACK_LOAD_ERROR:case Q.AUDIO_TRACK_LOAD_TIMEOUT:case Q.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===re.WAITING_TRACK&&((s=t.context)==null?void 0:s.type)===tt.AUDIO_TRACK&&(this.state=re.IDLE);break;case Q.BUFFER_ADD_CODEC_ERROR:case Q.BUFFER_APPEND_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)||this.resetLoadingState();break;case Q.BUFFER_FULL_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case Q.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onBufferFlushing(e,{type:t}){t!==Ct.VIDEO&&(this.flushing=!0)}onBufferFlushed(e,{type:t}){if(t!==Ct.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===re.ENDED&&(this.state=re.IDLE);const s=this.mediaBuffer||this.media;s&&(this.afterBufferFlushed(s,t,ke.AUDIO),this.tick())}}_handleTransmuxComplete(e){var t;const s="audio",{hls:n}=this,{remuxResult:r,chunkMeta:l}=e,c=this.getCurrentContext(l);if(!c){this.resetWhenMissingContext(l);return}const{frag:h,part:d,level:f}=c,{details:p}=f,{audio:v,text:x,id3:S,initSegment:T}=r;if(this.fragContextChanged(h)||!p){this.fragmentTracker.removeFragment(h);return}if(this.state=re.PARSING,this.switchingTrack&&v&&this.completeAudioSwitch(this.switchingTrack),T!=null&&T.tracks){const E=h.initSegment||h;if(this.unhandledEncryptionError(T,h))return;this._bufferInitSegment(f,T.tracks,E,l),n.trigger(L.FRAG_PARSING_INIT_SEGMENT,{frag:E,id:s,tracks:T.tracks})}if(v){const{startPTS:E,endPTS:A,startDTS:_,endDTS:R}=v;d&&(d.elementaryStreams[Ct.AUDIO]={startPTS:E,endPTS:A,startDTS:_,endDTS:R}),h.setElementaryStreamInfo(Ct.AUDIO,E,A,_,R),this.bufferFragmentData(v,h,d,l)}if(S!=null&&(t=S.samples)!=null&&t.length){const E=At({id:s,frag:h,details:p},S);n.trigger(L.FRAG_PARSING_METADATA,E)}if(x){const E=At({id:s,frag:h,details:p},x);n.trigger(L.FRAG_PARSING_USERDATA,E)}}_bufferInitSegment(e,t,s,n){if(this.state!==re.PARSING||(t.video&&delete t.video,t.audiovideo&&delete t.audiovideo,!t.audio))return;const r=t.audio;r.id=ke.AUDIO;const l=e.audioCodec;this.log(`Init audio buffer, container:${r.container}, codecs[level/parsed]=[${l}/${r.codec}]`),l&&l.split(",").length===1&&(r.levelCodec=l),this.hls.trigger(L.BUFFER_CODECS,t);const c=r.initSegment;if(c!=null&&c.byteLength){const h={type:"audio",frag:s,part:null,chunkMeta:n,parent:s.type,data:c};this.hls.trigger(L.BUFFER_APPENDING,h)}this.tickImmediate()}loadFragment(e,t,s){const n=this.fragmentTracker.getState(e);if(this.switchingTrack||n===ls.NOT_LOADED||n===ls.PARTIAL){var r;if(!Qt(e))this._loadInitSegment(e,t);else if((r=t.details)!=null&&r.live&&!this.initPTS[e.cc]){this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=re.WAITING_INIT_PTS;const l=this.mainDetails;l&&l.fragmentStart!==t.details.fragmentStart&&eu(t.details,l)}else super.loadFragment(e,t,s)}else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){if(this.media&&this.bufferedTrack){const{name:t,lang:s,assocLang:n,characteristics:r,audioCodec:l,channels:c}=this.bufferedTrack;_a({name:t,lang:s,assocLang:n,characteristics:r,audioCodec:l,channels:c},e,Ea)||(Qc(e.url,this.hls)?(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null):this.bufferedTrack=e)}}completeAudioSwitch(e){const{hls:t}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(L.AUDIO_TRACK_SWITCHED,vt({},e))}}class pm extends Ti{constructor(e,t){super(t,e.logger),this.hls=void 0,this.canLoad=!1,this.timer=-1,this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t,s){const n=t?.renditionReports;if(n){let r=-1;for(let l=0;l<n.length;l++){const c=n[l];let h;try{h=new self.URL(c.URI,t.url).href}catch(d){this.warn(`Could not construct new URL for Rendition Report: ${d}`),h=c.URI||""}if(h===e){r=l;break}else h===e.substring(0,h.length)&&(r=l)}if(r!==-1){const l=n[r],c=parseInt(l["LAST-MSN"])||t.lastPartSn;let h=parseInt(l["LAST-PART"])||t.lastPartIndex;if(this.hls.config.lowLatencyMode){const f=Math.min(t.age-t.partTarget,t.targetduration);h>=0&&f>t.partTarget&&(h+=1)}const d=s&&dy(s);return new hy(c,h>=0?h:void 0,d)}}}loadPlaylist(e){this.clearTimer()}loadingPlaylist(e,t){this.clearTimer()}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}getUrlWithDirectives(e,t){if(t)try{return t.addDirectives(e)}catch(s){this.warn(`Could not construct new URL with HLS Delivery Directives: ${s}`)}return e}playlistLoaded(e,t,s){const{details:n,stats:r}=t,l=self.performance.now(),c=r.loading.first?Math.max(0,l-r.loading.first):0;n.advancedDateTime=Date.now()-c;const h=this.hls.config.timelineOffset;if(h!==n.appliedTimelineOffset){const f=Math.max(h||0,0);n.appliedTimelineOffset=f,n.fragments.forEach(p=>{p.setStart(p.playlistOffset+f)})}if(n.live||s!=null&&s.live){const f="levelInfo"in t?t.levelInfo:t.track;if(n.reloaded(s),s&&n.fragments.length>0){Nw(s,n,this);const _=n.playlistParsingError;if(_){this.warn(_);const R=this.hls;if(!R.config.ignorePlaylistParsingErrors){var d;const{networkDetails:w}=t;R.trigger(L.ERROR,{type:je.NETWORK_ERROR,details:Q.LEVEL_PARSING_ERROR,fatal:!1,url:n.url,error:_,reason:_.message,level:t.level||void 0,parent:(d=n.fragments[0])==null?void 0:d.type,networkDetails:w,stats:r});return}n.playlistParsingError=null}}n.requestScheduled===-1&&(n.requestScheduled=r.loading.start);const p=this.hls.mainForwardBufferInfo,v=p?p.end-p.len:0,x=(n.edge-v)*1e3,S=zS(n,x);if(n.requestScheduled+S<l?n.requestScheduled=l:n.requestScheduled+=S,this.log(`live playlist ${e} ${n.advanced?"REFRESHED "+n.lastPartSn+"-"+n.lastPartIndex:n.updated?"UPDATED":"MISSED"}`),!this.canLoad||!n.live)return;let T,E,A;if(n.canBlockReload&&n.endSN&&n.advanced){const _=this.hls.config.lowLatencyMode,R=n.lastPartSn,w=n.endSN,N=n.lastPartIndex,U=N!==-1,D=R===w;U?D?(E=w+1,A=_?0:N):(E=R,A=_?N+1:n.maxPartIndex):E=w+1;const F=n.age,j=F+n.ageHeader;let M=Math.min(j-n.partTarget,n.targetduration*1.5);if(M>0){if(j>n.targetduration*3)this.log(`Playlist last advanced ${F.toFixed(2)}s ago. Omitting segment and part directives.`),E=void 0,A=void 0;else if(s!=null&&s.tuneInGoal&&j-n.partTarget>s.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${s.tuneInGoal} to: ${M} with playlist age: ${n.age}`),M=0;else{const H=Math.floor(M/n.targetduration);if(E+=H,A!==void 0){const K=Math.round(M%n.targetduration/n.partTarget);A+=K}this.log(`CDN Tune-in age: ${n.ageHeader}s last advanced ${F.toFixed(2)}s goal: ${M} skip sn ${H} to part ${A}`)}n.tuneInGoal=M}if(T=this.getDeliveryDirectives(n,t.deliveryDirectives,E,A),_||!D){n.requestScheduled=l,this.loadingPlaylist(f,T);return}}else(n.canBlockReload||n.canSkipUntil)&&(T=this.getDeliveryDirectives(n,t.deliveryDirectives,E,A));T&&E!==void 0&&n.canBlockReload&&(n.requestScheduled=r.loading.first+Math.max(S-c*2,S/2)),this.scheduleLoading(f,T,n)}else this.clearTimer()}scheduleLoading(e,t,s){const n=s||e.details;if(!n){this.loadingPlaylist(e,t);return}const r=self.performance.now(),l=n.requestScheduled;if(r>=l){this.loadingPlaylist(e,t);return}const c=l-r;this.log(`reload live playlist ${e.name||e.bitrate+"bps"} in ${Math.round(c)} ms`),this.clearTimer(),this.timer=self.setTimeout(()=>this.loadingPlaylist(e,t),c)}getDeliveryDirectives(e,t,s,n){let r=dy(e);return t!=null&&t.skip&&e.deltaUpdateFailed&&(s=t.msn,n=t.part,r=kc.No),new hy(s,n,r)}checkRetry(e){const t=e.details,s=Xc(e),n=e.errorAction,{action:r,retryCount:l=0,retryConfig:c}=n||{},h=!!n&&!!c&&(r===gs.RetryRequest||!n.resolved&&r===gs.SendAlternateToPenaltyBox);if(h){var d;if(l>=c.maxNumRetry)return!1;if(s&&(d=e.context)!=null&&d.deliveryDirectives)this.warn(`Retrying playlist loading ${l+1}/${c.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{const f=sm(c,l);this.clearTimer(),this.timer=self.setTimeout(()=>this.loadPlaylist(),f),this.warn(`Retrying playlist loading ${l+1}/${c.maxNumRetry} after "${t}" in ${f}ms`)}e.levelRetry=!0,n.resolved=!0}return h}}function vb(i,e){if(i.length!==e.length)return!1;for(let t=0;t<i.length;t++)if(!Fl(i[t].attrs,e[t].attrs))return!1;return!0}function Fl(i,e,t){const s=i["STABLE-RENDITION-ID"];return s&&!t?s===e["STABLE-RENDITION-ID"]:!(t||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(n=>i[n]!==e[n])}function Lf(i,e){return e.label.toLowerCase()===i.name.toLowerCase()&&(!e.language||e.language.toLowerCase()===(i.lang||"").toLowerCase())}class $C extends pm{constructor(e){super(e,"audio-track-controller"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.MANIFEST_PARSED,this.onManifestParsed,this),e.on(L.LEVEL_LOADING,this.onLevelLoading,this),e.on(L.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(L.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(L.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.MANIFEST_PARSED,this.onManifestParsed,this),e.off(L.LEVEL_LOADING,this.onLevelLoading,this),e.off(L.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(L.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(L.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){const{id:s,groupId:n,details:r}=t,l=this.tracksInGroup[s];if(!l||l.groupId!==n){this.warn(`Audio track with id:${s} and group:${n} not found in active group ${l?.groupId}`);return}const c=l.details;l.details=t.details,this.log(`Audio track ${s} "${l.name}" lang:${l.lang} group:${n} loaded [${r.startSN}-${r.endSN}]`),s===this.trackId&&this.playlistLoaded(s,t,c)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const s=t.audioGroups||null,n=this.groupIds;let r=this.currentTrack;if(!s||n?.length!==s?.length||s!=null&&s.some(c=>n?.indexOf(c)===-1)){this.groupIds=s,this.trackId=-1,this.currentTrack=null;const c=this.tracks.filter(v=>!s||s.indexOf(v.groupId)!==-1);if(c.length)this.selectDefaultTrack&&!c.some(v=>v.default)&&(this.selectDefaultTrack=!1),c.forEach((v,x)=>{v.id=x});else if(!r&&!this.tracksInGroup.length)return;this.tracksInGroup=c;const h=this.hls.config.audioPreference;if(!r&&h){const v=Gi(h,c,Ea);if(v>-1)r=c[v];else{const x=Gi(h,this.tracks);r=this.tracks[x]}}let d=this.findTrackId(r);d===-1&&r&&(d=this.findTrackId(null));const f={audioTracks:c};this.log(`Updating audio tracks, ${c.length} track(s) found in group(s): ${s?.join(",")}`),this.hls.trigger(L.AUDIO_TRACKS_UPDATED,f);const p=this.trackId;if(d!==-1&&p===-1)this.setAudioTrack(d);else if(c.length&&p===-1){var l;const v=new Error(`No audio track selected for current audio group-ID(s): ${(l=this.groupIds)==null?void 0:l.join(",")} track count: ${c.length}`);this.warn(v.message),this.hls.trigger(L.ERROR,{type:je.MEDIA_ERROR,details:Q.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:v})}}}onError(e,t){t.fatal||!t.context||t.context.type===tt.AUDIO_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){const t=this.hls;if(t.config.audioPreference=e,e){const s=this.allAudioTracks;if(this.selectDefaultTrack=!1,s.length){const n=this.currentTrack;if(n&&_a(e,n,Ea))return n;const r=Gi(e,this.tracksInGroup,Ea);if(r>-1){const l=this.tracksInGroup[r];return this.setAudioTrack(r),l}else if(n){let l=t.loadLevel;l===-1&&(l=t.firstAutoLevel);const c=J1(e,t.levels,s,l,Ea);if(c===-1)return null;t.nextLoadLevel=c}if(e.channels||e.audioCodec){const l=Gi(e,s);if(l>-1)return s[l]}}}return null}setAudioTrack(e){const t=this.tracksInGroup;if(e<0||e>=t.length){this.warn(`Invalid audio track id: ${e}`);return}this.selectDefaultTrack=!1;const s=this.currentTrack,n=t[e],r=n.details&&!n.details.live;if(e===this.trackId&&n===s&&r||(this.log(`Switching to audio-track ${e} "${n.name}" lang:${n.lang} group:${n.groupId} channels:${n.channels}`),this.trackId=e,this.currentTrack=n,this.hls.trigger(L.AUDIO_TRACK_SWITCHING,vt({},n)),r))return;const l=this.switchParams(n.url,s?.details,n.details);this.loadPlaylist(l)}findTrackId(e){const t=this.tracksInGroup;for(let s=0;s<t.length;s++){const n=t[s];if(!(this.selectDefaultTrack&&!n.default)&&(!e||_a(e,n,Ea)))return s}if(e){const{name:s,lang:n,assocLang:r,characteristics:l,audioCodec:c,channels:h}=e;for(let d=0;d<t.length;d++){const f=t[d];if(_a({name:s,lang:n,assocLang:r,characteristics:l,audioCodec:c,channels:h},f,Ea))return d}for(let d=0;d<t.length;d++){const f=t[d];if(Fl(e.attrs,f.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return d}for(let d=0;d<t.length;d++){const f=t[d];if(Fl(e.attrs,f.attrs,["LANGUAGE"]))return d}}return-1}loadPlaylist(e){super.loadPlaylist();const t=this.currentTrack;this.shouldLoadPlaylist(t)&&Qc(t.url,this.hls)&&this.scheduleLoading(t,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const s=e.id,n=e.groupId,r=this.getUrlWithDirectives(e.url,t),l=e.details,c=l?.age;this.log(`Loading audio-track ${s} "${e.name}" lang:${e.lang} group:${n}${t?.msn!==void 0?" at sn "+t.msn+" part "+t.part:""}${c&&l.live?" age "+c.toFixed(1)+(l.type&&" "+l.type||""):""} ${r}`),this.hls.trigger(L.AUDIO_TRACK_LOADING,{url:r,id:s,groupId:n,deliveryDirectives:t||null,track:e})}}class VC{constructor(e){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=e}destroy(){this.tracks=this.queues=null}append(e,t,s){if(this.queues===null||this.tracks===null)return;const n=this.queues[t];n.push(e),n.length===1&&!s&&this.executeNext(t)}appendBlocker(e){return new Promise(t=>{const s={label:"async-blocker",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.append(s,e)})}prependBlocker(e){return new Promise(t=>{if(this.queues){const s={label:"async-blocker-prepend",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.queues[e].unshift(s)}})}removeBlockers(){this.queues!==null&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach(e=>{var t;const s=(t=e[0])==null?void 0:t.label;(s==="async-blocker"||s==="async-blocker-prepend")&&(e[0].execute(),e.splice(0,1))})}unblockAudio(e){if(this.queues===null)return;this.queues.audio[0]===e&&this.shiftAndExecuteNext("audio")}executeNext(e){if(this.queues===null||this.tracks===null)return;const t=this.queues[e];if(t.length){const n=t[0];try{n.execute()}catch(r){var s;if(n.onError(r),this.queues===null||this.tracks===null)return;const l=(s=this.tracks[e])==null?void 0:s.buffer;l!=null&&l.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){this.queues!==null&&(this.queues[e].shift(),this.executeNext(e))}current(e){var t;return((t=this.queues)==null?void 0:t[e][0])||null}toString(){const{queues:e,tracks:t}=this;return e===null||t===null?"<destroyed>":`
${this.list("video")}
${this.list("audio")}
${this.list("audiovideo")}}`}list(e){var t,s;return(t=this.queues)!=null&&t[e]||(s=this.tracks)!=null&&s[e]?`${e}: (${this.listSbInfo(e)}) ${this.listOps(e)}`:""}listSbInfo(e){var t;const s=(t=this.tracks)==null?void 0:t[e],n=s?.buffer;return n?`SourceBuffer${n.updating?" updating":""}${s.ended?" ended":""}${s.ending?" ending":""}`:"none"}listOps(e){var t;return((t=this.queues)==null?void 0:t[e].map(s=>s.label).join(", "))||""}}const Wy=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,yb="HlsJsTrackRemovedError";class GC extends Error{constructor(e){super(e),this.name=yb}}class HC extends Ti{constructor(e,t){super("buffer-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.details=null,this._objectUrl=null,this.operationQueue=null,this.bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.blockedAudioAppend=null,this.lastVideoAppendEnd=0,this.appendSource=void 0,this.transferData=void 0,this.overrides=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.sourceBuffers=[[null,null],[null,null]],this._onEndStreaming=s=>{var n;this.hls&&((n=this.mediaSource)==null?void 0:n.readyState)==="open"&&this.hls.pauseBuffering()},this._onStartStreaming=s=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=s=>{const{media:n,mediaSource:r}=this;s&&this.log("Media source opened"),!(!n||!r)&&(r.removeEventListener("sourceopen",this._onMediaSourceOpen),n.removeEventListener("emptied",this._onMediaEmptied),this.updateDuration(),this.hls.trigger(L.MEDIA_ATTACHED,{media:n,mediaSource:r}),this.mediaSource!==null&&this.checkPendingTracks())},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:s,_objectUrl:n}=this;s!==n&&this.error(`Media element src was set while attaching MediaSource (${n} > ${s})`)},this.hls=e,this.fragmentTracker=t,this.appendSource=h1(ea(e.config.preferManagedMediaSource)),this.initTracks(),this.registerListeners()}hasSourceTypes(){return Object.keys(this.tracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null}registerListeners(){const{hls:e}=this;e.on(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.MANIFEST_PARSED,this.onManifestParsed,this),e.on(L.BUFFER_RESET,this.onBufferReset,this),e.on(L.BUFFER_APPENDING,this.onBufferAppending,this),e.on(L.BUFFER_CODECS,this.onBufferCodecs,this),e.on(L.BUFFER_EOS,this.onBufferEos,this),e.on(L.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(L.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(L.FRAG_PARSED,this.onFragParsed,this),e.on(L.FRAG_CHANGED,this.onFragChanged,this),e.on(L.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.MANIFEST_PARSED,this.onManifestParsed,this),e.off(L.BUFFER_RESET,this.onBufferReset,this),e.off(L.BUFFER_APPENDING,this.onBufferAppending,this),e.off(L.BUFFER_CODECS,this.onBufferCodecs,this),e.off(L.BUFFER_EOS,this.onBufferEos,this),e.off(L.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(L.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(L.FRAG_PARSED,this.onFragParsed,this),e.off(L.FRAG_CHANGED,this.onFragChanged,this),e.off(L.ERROR,this.onError,this)}transferMedia(){const{media:e,mediaSource:t}=this;if(!e)return null;const s={};if(this.operationQueue){const r=this.isUpdating();r||this.operationQueue.removeBlockers();const l=this.isQueued();(r||l)&&this.warn(`Transfering MediaSource with${l?" operations in queue":""}${r?" updating SourceBuffer(s)":""} ${this.operationQueue}`),this.operationQueue.destroy()}const n=this.transferData;return!this.sourceBufferCount&&n&&n.mediaSource===t?At(s,n.tracks):this.sourceBuffers.forEach(r=>{const[l]=r;l&&(s[l]=At({},this.tracks[l]),this.removeBuffer(l)),r[0]=r[1]=null}),{media:e,mediaSource:t,tracks:s}}initTracks(){const e={};this.sourceBuffers=[[null,null],[null,null]],this.tracks=e,this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0}onManifestLoading(){this.bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){var s;let n=2;(t.audio&&!t.video||!t.altAudio)&&(n=1),this.bufferCodecEventsTotal=n,this.log(`${n} bufferCodec event(s) expected.`),(s=this.transferData)!=null&&s.mediaSource&&this.sourceBufferCount&&n&&this.bufferCreated()}onMediaAttaching(e,t){const s=this.media=t.media;this.transferData=this.overrides=void 0;const n=ea(this.appendSource);if(n){const r=!!t.mediaSource;(r||t.overrides)&&(this.transferData=t,this.overrides=t.overrides);const l=this.mediaSource=t.mediaSource||new n;if(this.assignMediaSource(l),r)this._objectUrl=s.src,this.attachTransferred();else{const c=this._objectUrl=self.URL.createObjectURL(l);if(this.appendSource)try{s.removeAttribute("src");const h=self.ManagedMediaSource;s.disableRemotePlayback=s.disableRemotePlayback||h&&l instanceof h,Zy(s),zC(s,c),s.load()}catch{s.src=c}else s.src=c}s.addEventListener("emptied",this._onMediaEmptied)}}assignMediaSource(e){var t,s;this.log(`${((t=this.transferData)==null?void 0:t.mediaSource)===e?"transferred":"created"} media source: ${(s=e.constructor)==null?void 0:s.name}`),e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.addEventListener("startstreaming",this._onStartStreaming),e.addEventListener("endstreaming",this._onEndStreaming))}attachTransferred(){const e=this.media,t=this.transferData;if(!t||!e)return;const s=this.tracks,n=t.tracks,r=n?Object.keys(n):null,l=r?r.length:0,c=()=>{Promise.resolve().then(()=>{this.media&&this.mediaSourceOpenOrEnded&&this._onMediaSourceOpen()})};if(n&&r&&l){if(!this.tracksReady){this.hls.config.startFragPrefetch=!0,this.log("attachTransferred: waiting for SourceBuffer track info");return}if(this.log(`attachTransferred: (bufferCodecEventsTotal ${this.bufferCodecEventsTotal})
required tracks: ${Ot(s,(h,d)=>h==="initSegment"?void 0:d)};
transfer tracks: ${Ot(n,(h,d)=>h==="initSegment"?void 0:d)}}`),!mS(n,s)){t.mediaSource=null,t.tracks=void 0;const h=e.currentTime,d=this.details,f=Math.max(h,d?.fragments[0].start||0);if(f-h>1){this.log(`attachTransferred: waiting for playback to reach new tracks start time ${h} -> ${f}`);return}this.warn(`attachTransferred: resetting MediaSource for incompatible tracks ("${Object.keys(n)}"->"${Object.keys(s)}") start time: ${f} currentTime: ${h}`),this.onMediaDetaching(L.MEDIA_DETACHING,{}),this.onMediaAttaching(L.MEDIA_ATTACHING,t),e.currentTime=f;return}this.transferData=void 0,r.forEach(h=>{const d=h,f=n[d];if(f){const p=f.buffer;if(p){const v=this.fragmentTracker,x=f.id;if(v.hasFragments(x)||v.hasParts(x)){const E=qe.getBuffered(p);v.detectEvictedFragments(d,E,x,null,!0)}const S=Xh(d),T=[d,p];this.sourceBuffers[S]=T,p.updating&&this.operationQueue&&this.operationQueue.prependBlocker(d),this.trackSourceBuffer(d,f)}}}),c(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),c()}get mediaSourceOpenOrEnded(){var e;const t=(e=this.mediaSource)==null?void 0:e.readyState;return t==="open"||t==="ended"}onMediaDetaching(e,t){const s=!!t.transferMedia;this.transferData=this.overrides=void 0;const{media:n,mediaSource:r,_objectUrl:l}=this;if(r){if(this.log(`media source ${s?"transferring":"detaching"}`),s)this.sourceBuffers.forEach(([c])=>{c&&this.removeBuffer(c)}),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){const c=r.readyState==="open";try{const h=r.sourceBuffers;for(let d=h.length;d--;)c&&h[d].abort(),r.removeSourceBuffer(h[d]);c&&r.endOfStream()}catch(h){this.warn(`onMediaDetaching: ${h.message} while calling endOfStream`)}}this.sourceBufferCount&&this.onBufferReset()}r.removeEventListener("sourceopen",this._onMediaSourceOpen),r.removeEventListener("sourceended",this._onMediaSourceEnded),r.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(r.removeEventListener("startstreaming",this._onStartStreaming),r.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}n&&(n.removeEventListener("emptied",this._onMediaEmptied),s||(l&&self.URL.revokeObjectURL(l),this.mediaSrc===l?(n.removeAttribute("src"),this.appendSource&&Zy(n),n.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(L.MEDIA_DETACHED,t)}onBufferReset(){this.sourceBuffers.forEach(([e])=>{e&&this.resetBuffer(e)}),this.initTracks()}resetBuffer(e){var t;const s=(t=this.tracks[e])==null?void 0:t.buffer;if(this.removeBuffer(e),s)try{var n;(n=this.mediaSource)!=null&&n.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(s)}catch(r){this.warn(`onBufferReset ${e}`,r)}delete this.tracks[e]}removeBuffer(e){this.removeBufferListeners(e),this.sourceBuffers[Xh(e)]=[null,null];const t=this.tracks[e];t&&(t.buffer=void 0)}resetQueue(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new VC(this.tracks)}onBufferCodecs(e,t){var s;const n=this.tracks,r=Object.keys(t);this.log(`BUFFER_CODECS: "${r}" (current SB count ${this.sourceBufferCount})`);const l="audiovideo"in t&&(n.audio||n.video)||n.audiovideo&&("audio"in t||"video"in t),c=!l&&this.sourceBufferCount&&this.media&&r.some(h=>!n[h]);if(l||c){this.warn(`Unsupported transition between "${Object.keys(n)}" and "${r}" SourceBuffers`);return}r.forEach(h=>{var d,f;const p=t[h],{id:v,codec:x,levelCodec:S,container:T,metadata:E,supplemental:A}=p;let _=n[h];const R=(d=this.transferData)==null||(d=d.tracks)==null?void 0:d[h],w=R!=null&&R.buffer?R:_,N=w?.pendingCodec||w?.codec,U=w?.levelCodec;_||(_=n[h]={buffer:void 0,listeners:[],codec:x,supplemental:A,container:T,levelCodec:S,metadata:E,id:v});const D=Dc(N,U),F=D?.replace(Wy,"$1");let j=Dc(x,S);const M=(f=j)==null?void 0:f.replace(Wy,"$1");j&&D&&F!==M&&(h.slice(0,5)==="audio"&&(j=Yc(j,this.appendSource)),this.log(`switching codec ${N} to ${j}`),j!==(_.pendingCodec||_.codec)&&(_.pendingCodec=j),_.container=T,this.appendChangeType(h,T,j))}),(this.tracksReady||this.sourceBufferCount)&&(t.tracks=this.sourceBufferTracks),!this.sourceBufferCount&&(this.bufferCodecEventsTotal>1&&!this.tracks.video&&!t.video&&((s=t.audio)==null?void 0:s.id)==="main"&&(this.log("Main audio-only"),this.bufferCodecEventsTotal=1),this.mediaSourceOpenOrEnded&&this.checkPendingTracks())}get sourceBufferTracks(){return Object.keys(this.tracks).reduce((e,t)=>{const s=this.tracks[t];return e[t]={id:s.id,container:s.container,codec:s.codec,levelCodec:s.levelCodec},e},{})}appendChangeType(e,t,s){const n=`${t};codecs=${s}`,r={label:`change-type=${n}`,execute:()=>{const l=this.tracks[e];if(l){const c=l.buffer;c!=null&&c.changeType&&(this.log(`changing ${e} sourceBuffer type to ${n}`),c.changeType(n),l.codec=s,l.container=t)}this.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:l=>{this.warn(`Failed to change ${e} SourceBuffer type`,l)}};this.append(r,e,this.isPending(this.tracks[e]))}blockAudio(e){var t;const s=e.start,n=s+e.duration*.05;if(((t=this.fragmentTracker.getAppendedFrag(s,ke.MAIN))==null?void 0:t.gap)===!0)return;const l={label:"block-audio",execute:()=>{var c;const h=this.tracks.video;(this.lastVideoAppendEnd>n||h!=null&&h.buffer&&qe.isBuffered(h.buffer,n)||((c=this.fragmentTracker.getAppendedFrag(n,ke.MAIN))==null?void 0:c.gap)===!0)&&(this.blockedAudioAppend=null,this.shiftAndExecuteNext("audio"))},onStart:()=>{},onComplete:()=>{},onError:c=>{this.warn("Error executing block-audio operation",c)}};this.blockedAudioAppend={op:l,frag:e},this.append(l,"audio",!0)}unblockAudio(){const{blockedAudioAppend:e,operationQueue:t}=this;e&&t&&(this.blockedAudioAppend=null,t.unblockAudio(e.op))}onBufferAppending(e,t){const{tracks:s}=this,{data:n,type:r,parent:l,frag:c,part:h,chunkMeta:d,offset:f}=t,p=d.buffering[r],{sn:v,cc:x}=c,S=self.performance.now();p.start=S;const T=c.stats.buffering,E=h?h.stats.buffering:null;T.start===0&&(T.start=S),E&&E.start===0&&(E.start=S);const A=s.audio;let _=!1;r==="audio"&&A?.container==="audio/mpeg"&&(_=!this.lastMpegAudioChunk||d.id===1||this.lastMpegAudioChunk.sn!==d.sn,this.lastMpegAudioChunk=d);const R=s.video,w=R?.buffer;if(w&&v!=="initSegment"){const D=h||c,F=this.blockedAudioAppend;if(r==="audio"&&l!=="main"&&!this.blockedAudioAppend&&!(R.ending||R.ended)){const M=D.start+D.duration*.05,H=w.buffered,K=this.currentOp("video");!H.length&&!K?this.blockAudio(D):!K&&!qe.isBuffered(w,M)&&this.lastVideoAppendEnd<M&&this.blockAudio(D)}else if(r==="video"){const j=D.end;if(F){const M=F.frag.start;(j>M||j<this.lastVideoAppendEnd||qe.isBuffered(w,M))&&this.unblockAudio()}this.lastVideoAppendEnd=j}}const N=(h||c).start,U={label:`append-${r}`,execute:()=>{var D;p.executeStart=self.performance.now();const F=(D=this.tracks[r])==null?void 0:D.buffer;F&&(_?this.updateTimestampOffset(F,N,.1,r,v,x):f!==void 0&&Ce(f)&&this.updateTimestampOffset(F,f,1e-6,r,v,x)),this.appendExecutor(n,r)},onStart:()=>{},onComplete:()=>{const D=self.performance.now();p.executeEnd=p.end=D,T.first===0&&(T.first=D),E&&E.first===0&&(E.first=D);const F={};this.sourceBuffers.forEach(([j,M])=>{j&&(F[j]=qe.getBuffered(M))}),this.appendErrors[r]=0,r==="audio"||r==="video"?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(L.BUFFER_APPENDED,{type:r,frag:c,part:h,chunkMeta:d,parent:c.type,timeRanges:F})},onError:D=>{var F;const j={type:je.MEDIA_ERROR,parent:c.type,details:Q.BUFFER_APPEND_ERROR,sourceBufferName:r,frag:c,part:h,chunkMeta:d,error:D,err:D,fatal:!1},M=(F=this.media)==null?void 0:F.error;if(D.code===DOMException.QUOTA_EXCEEDED_ERR||D.name=="QuotaExceededError"||"quota"in D)j.details=Q.BUFFER_FULL_ERROR;else if(D.code===DOMException.INVALID_STATE_ERR&&this.mediaSourceOpenOrEnded&&!M)j.errorAction=br(!0);else if(D.name===yb&&this.sourceBufferCount===0)j.errorAction=br(!0);else{const H=++this.appendErrors[r];this.warn(`Failed ${H}/${this.hls.config.appendErrorMaxRetry} times to append segment in "${r}" sourceBuffer (${M||"no media error"})`),(H>=this.hls.config.appendErrorMaxRetry||M)&&(j.fatal=!0)}this.hls.trigger(L.ERROR,j)}};this.log(`queuing "${r}" append sn: ${v}${h?" p: "+h.index:""} of ${c.type===ke.MAIN?"level":"track"} ${c.level} cc: ${x}`),this.append(U,r,this.isPending(this.tracks[r]))}getFlushOp(e,t,s){return this.log(`queuing "${e}" remove ${t}-${s}`),{label:"remove",execute:()=>{this.removeExecutor(e,t,s)},onStart:()=>{},onComplete:()=>{this.hls.trigger(L.BUFFER_FLUSHED,{type:e})},onError:n=>{this.warn(`Failed to remove ${t}-${s} from "${e}" SourceBuffer`,n)}}}onBufferFlushing(e,t){const{type:s,startOffset:n,endOffset:r}=t;s?this.append(this.getFlushOp(s,n,r),s):this.sourceBuffers.forEach(([l])=>{l&&this.append(this.getFlushOp(l,n,r),l)})}onFragParsed(e,t){const{frag:s,part:n}=t,r=[],l=n?n.elementaryStreams:s.elementaryStreams;l[Ct.AUDIOVIDEO]?r.push("audiovideo"):(l[Ct.AUDIO]&&r.push("audio"),l[Ct.VIDEO]&&r.push("video"));const c=()=>{const h=self.performance.now();s.stats.buffering.end=h,n&&(n.stats.buffering.end=h);const d=n?n.stats:s.stats;this.hls.trigger(L.FRAG_BUFFERED,{frag:s,part:n,stats:d,id:s.type})};r.length===0&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${s.type} level: ${s.level} sn: ${s.sn}`),this.blockBuffers(c,r).catch(h=>{this.warn(`Fragment buffered callback ${h}`),this.stepOperationQueue(this.sourceBufferTypes)})}onFragChanged(e,t){this.trimBuffers()}get bufferedToEnd(){return this.sourceBufferCount>0&&!this.sourceBuffers.some(([e])=>{if(e){const t=this.tracks[e];if(t)return!t.ended||t.ending}return!1})}onBufferEos(e,t){var s;this.sourceBuffers.forEach(([l])=>{if(l){const c=this.tracks[l];(!t.type||t.type===l)&&(c.ending=!0,c.ended||(c.ended=!0,this.log(`${l} buffer reached EOS`)))}});const n=((s=this.overrides)==null?void 0:s.endOfStream)!==!1;this.sourceBufferCount>0&&!this.sourceBuffers.some(([l])=>{var c;return l&&!((c=this.tracks[l])!=null&&c.ended)})?n?(this.log("Queueing EOS"),this.blockUntilOpen(()=>{this.tracksEnded();const{mediaSource:l}=this;if(!l||l.readyState!=="open"){l&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${l.readyState}`);return}this.log("Calling mediaSource.endOfStream()"),l.endOfStream(),this.hls.trigger(L.BUFFERED_TO_END,void 0)})):(this.tracksEnded(),this.hls.trigger(L.BUFFERED_TO_END,void 0)):t.type==="video"&&this.unblockAudio()}tracksEnded(){this.sourceBuffers.forEach(([e])=>{if(e!==null){const t=this.tracks[e];t&&(t.ending=!1)}})}onLevelUpdated(e,{details:t}){t.fragments.length&&(this.details=t,this.updateDuration())}updateDuration(){this.blockUntilOpen(()=>{const e=this.getDurationAndRange();e&&this.updateMediaSource(e)})}onError(e,t){if(t.details===Q.BUFFER_APPEND_ERROR&&t.frag){var s;const n=(s=t.errorAction)==null?void 0:s.nextAutoLevel;Ce(n)&&n!==t.frag.level&&this.resetAppendErrors()}}resetAppendErrors(){this.appendErrors={audio:0,video:0,audiovideo:0}}trimBuffers(){const{hls:e,details:t,media:s}=this;if(!s||t===null||!this.sourceBufferCount)return;const n=e.config,r=s.currentTime,l=t.levelTargetDuration,c=t.live&&n.liveBackBufferLength!==null?n.liveBackBufferLength:n.backBufferLength;if(Ce(c)&&c>=0){const d=Math.max(c,l),f=Math.floor(r/l)*l-d;this.flushBackBuffer(r,l,f)}const h=n.frontBufferFlushThreshold;if(Ce(h)&&h>0){const d=Math.max(n.maxBufferLength,h),f=Math.max(d,l),p=Math.floor(r/l)*l+f;this.flushFrontBuffer(r,l,p)}}flushBackBuffer(e,t,s){this.sourceBuffers.forEach(([n,r])=>{if(r){const c=qe.getBuffered(r);if(c.length>0&&s>c.start(0)){var l;this.hls.trigger(L.BACK_BUFFER_REACHED,{bufferEnd:s});const h=this.tracks[n];if((l=this.details)!=null&&l.live)this.hls.trigger(L.LIVE_BACK_BUFFER_REACHED,{bufferEnd:s});else if(h!=null&&h.ended){this.log(`Cannot flush ${n} back buffer while SourceBuffer is in ended state`);return}this.hls.trigger(L.BUFFER_FLUSHING,{startOffset:0,endOffset:s,type:n})}}})}flushFrontBuffer(e,t,s){this.sourceBuffers.forEach(([n,r])=>{if(r){const l=qe.getBuffered(r),c=l.length;if(c<2)return;const h=l.start(c-1),d=l.end(c-1);if(s>h||e>=h&&e<=d)return;this.hls.trigger(L.BUFFER_FLUSHING,{startOffset:h,endOffset:1/0,type:n})}})}getDurationAndRange(){var e;const{details:t,mediaSource:s}=this;if(!t||!this.media||s?.readyState!=="open")return null;const n=t.edge;if(t.live&&this.hls.config.liveDurationInfinity){if(t.fragments.length&&s.setLiveSeekableRange){const d=Math.max(0,t.fragmentStart),f=Math.max(d,n);return{duration:1/0,start:d,end:f}}return{duration:1/0}}const r=(e=this.overrides)==null?void 0:e.duration;if(r)return Ce(r)?{duration:r}:null;const l=this.media.duration,c=Ce(s.duration)?s.duration:0;return n>c&&n>l||!Ce(l)?{duration:n}:null}updateMediaSource({duration:e,start:t,end:s}){const n=this.mediaSource;!this.media||!n||n.readyState!=="open"||(n.duration!==e&&(Ce(e)&&this.log(`Updating MediaSource duration to ${e.toFixed(3)}`),n.duration=e),t!==void 0&&s!==void 0&&(this.log(`MediaSource duration is set to ${n.duration}. Setting seekable range to ${t}-${s}.`),n.setLiveSeekableRange(t,s)))}get tracksReady(){const e=this.pendingTrackCount;return e>0&&(e>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}checkPendingTracks(){const{bufferCodecEventsTotal:e,pendingTrackCount:t,tracks:s}=this;if(this.log(`checkPendingTracks (pending: ${t} codec events expected: ${e}) ${Ot(s)}`),this.tracksReady){var n;const r=(n=this.transferData)==null?void 0:n.tracks;r&&Object.keys(r).length?this.attachTransferred():this.createSourceBuffers()}}bufferCreated(){if(this.sourceBufferCount){const e={};this.sourceBuffers.forEach(([t,s])=>{if(t){const n=this.tracks[t];e[t]={buffer:s,container:n.container,codec:n.codec,supplemental:n.supplemental,levelCodec:n.levelCodec,id:n.id,metadata:n.metadata}}}),this.hls.trigger(L.BUFFER_CREATED,{tracks:e}),this.log(`SourceBuffers created. Running queue: ${this.operationQueue}`),this.sourceBuffers.forEach(([t])=>{this.executeNext(t)})}else{const e=new Error("could not create source buffer for media codec(s)");this.hls.trigger(L.ERROR,{type:je.MEDIA_ERROR,details:Q.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:e,reason:e.message})}}createSourceBuffers(){const{tracks:e,sourceBuffers:t,mediaSource:s}=this;if(!s)throw new Error("createSourceBuffers called when mediaSource was null");for(const r in e){const l=r,c=e[l];if(this.isPending(c)){const h=this.getTrackCodec(c,l),d=`${c.container};codecs=${h}`;c.codec=h,this.log(`creating sourceBuffer(${d})${this.currentOp(l)?" Queued":""} ${Ot(c)}`);try{const f=s.addSourceBuffer(d),p=Xh(l),v=[l,f];t[p]=v,c.buffer=f}catch(f){var n;this.error(`error while trying to add sourceBuffer: ${f.message}`),this.shiftAndExecuteNext(l),(n=this.operationQueue)==null||n.removeBlockers(),delete this.tracks[l],this.hls.trigger(L.ERROR,{type:je.MEDIA_ERROR,details:Q.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:f,sourceBufferName:l,mimeType:d,parent:c.id});return}this.trackSourceBuffer(l,c)}}this.bufferCreated()}getTrackCodec(e,t){const s=e.supplemental;let n=e.codec;s&&(t==="video"||t==="audiovideo")&&Dl(s,"video")&&(n=k1(n,s));const r=Dc(n,e.levelCodec);return r?t.slice(0,5)==="audio"?Yc(r,this.appendSource):r:""}trackSourceBuffer(e,t){const s=t.buffer;if(!s)return;const n=this.getTrackCodec(t,e);this.tracks[e]={buffer:s,codec:n,container:t.container,levelCodec:t.levelCodec,supplemental:t.supplemental,metadata:t.metadata,id:t.id,listeners:[]},this.removeBufferListeners(e),this.addBufferListener(e,"updatestart",this.onSBUpdateStart),this.addBufferListener(e,"updateend",this.onSBUpdateEnd),this.addBufferListener(e,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(e,"bufferedchange",(r,l)=>{const c=l.removedRanges;c!=null&&c.length&&this.hls.trigger(L.BUFFER_FLUSHED,{type:r})})}get mediaSrc(){var e,t;const s=((e=this.media)==null||(t=e.querySelector)==null?void 0:t.call(e,"source"))||this.media;return s?.src}onSBUpdateStart(e){const t=this.currentOp(e);t&&t.onStart()}onSBUpdateEnd(e){var t;if(((t=this.mediaSource)==null?void 0:t.readyState)==="closed"){this.resetBuffer(e);return}const s=this.currentOp(e);s&&(s.onComplete(),this.shiftAndExecuteNext(e))}onSBUpdateError(e,t){var s;const n=new Error(`${e} SourceBuffer error. MediaSource readyState: ${(s=this.mediaSource)==null?void 0:s.readyState}`);this.error(`${n}`,t),this.hls.trigger(L.ERROR,{type:je.MEDIA_ERROR,details:Q.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:n,fatal:!1});const r=this.currentOp(e);r&&r.onError(n)}updateTimestampOffset(e,t,s,n,r,l){const c=t-e.timestampOffset;Math.abs(c)>=s&&(this.log(`Updating ${n} SourceBuffer timestampOffset to ${t} (sn: ${r} cc: ${l})`),e.timestampOffset=t)}removeExecutor(e,t,s){const{media:n,mediaSource:r}=this,l=this.tracks[e],c=l?.buffer;if(!n||!r||!c){this.warn(`Attempting to remove from the ${e} SourceBuffer, but it does not exist`),this.shiftAndExecuteNext(e);return}const h=Ce(n.duration)?n.duration:1/0,d=Ce(r.duration)?r.duration:1/0,f=Math.max(0,t),p=Math.min(s,h,d);p>f&&(!l.ending||l.ended)?(l.ended=!1,this.log(`Removing [${f},${p}] from the ${e} SourceBuffer`),c.remove(f,p)):this.shiftAndExecuteNext(e)}appendExecutor(e,t){const s=this.tracks[t],n=s?.buffer;if(!n)throw new GC(`Attempting to append to the ${t} SourceBuffer, but it does not exist`);s.ending=!1,s.ended=!1,n.appendBuffer(e)}blockUntilOpen(e){if(this.isUpdating()||this.isQueued())this.blockBuffers(e).catch(t=>{this.warn(`SourceBuffer blocked callback ${t}`),this.stepOperationQueue(this.sourceBufferTypes)});else try{e()}catch(t){this.warn(`Callback run without blocking ${this.operationQueue} ${t}`)}}isUpdating(){return this.sourceBuffers.some(([e,t])=>e&&t.updating)}isQueued(){return this.sourceBuffers.some(([e])=>e&&!!this.currentOp(e))}isPending(e){return!!e&&!e.buffer}blockBuffers(e,t=this.sourceBufferTypes){if(!t.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);const{operationQueue:s}=this,n=t.map(l=>this.appendBlocker(l));return t.length>1&&this.blockedAudioAppend&&this.unblockAudio(),Promise.all(n).then(l=>{s===this.operationQueue&&(e(),this.stepOperationQueue(this.sourceBufferTypes))})}stepOperationQueue(e){e.forEach(t=>{var s;const n=(s=this.tracks[t])==null?void 0:s.buffer;!n||n.updating||this.shiftAndExecuteNext(t)})}append(e,t,s){this.operationQueue&&this.operationQueue.append(e,t,s)}appendBlocker(e){if(this.operationQueue)return this.operationQueue.appendBlocker(e)}currentOp(e){return this.operationQueue?this.operationQueue.current(e):null}executeNext(e){e&&this.operationQueue&&this.operationQueue.executeNext(e)}shiftAndExecuteNext(e){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(e)}get pendingTrackCount(){return Object.keys(this.tracks).reduce((e,t)=>e+(this.isPending(this.tracks[t])?1:0),0)}get sourceBufferCount(){return this.sourceBuffers.reduce((e,[t])=>e+(t?1:0),0)}get sourceBufferTypes(){return this.sourceBuffers.map(([e])=>e).filter(e=>!!e)}addBufferListener(e,t,s){const n=this.tracks[e];if(!n)return;const r=n.buffer;if(!r)return;const l=s.bind(this,e);n.listeners.push({event:t,listener:l}),r.addEventListener(t,l)}removeBufferListeners(e){const t=this.tracks[e];if(!t)return;const s=t.buffer;s&&(t.listeners.forEach(n=>{s.removeEventListener(n.event,n.listener)}),t.listeners.length=0)}}function Zy(i){const e=i.querySelectorAll("source");[].slice.call(e).forEach(t=>{i.removeChild(t)})}function zC(i,e){const t=self.document.createElement("source");t.type="video/mp4",t.src=e,i.appendChild(t)}function Xh(i){return i==="audio"?1:0}class gm{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(L.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(L.MANIFEST_PARSED,this.onManifestParsed,this),e.on(L.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(L.BUFFER_CODECS,this.onBufferCodecs,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(L.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(L.MANIFEST_PARSED,this.onManifestParsed,this),e.off(L.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(L.BUFFER_CODECS,this.onBufferCodecs,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){const s=this.hls.levels[t.droppedLevel];this.isLevelAllowed(s)&&this.restrictedLevels.push({bitrate:s.bitrate,height:s.height,width:s.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,t){const s=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,s.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onLevelsUpdated(e,t){this.timer&&Ce(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping(),this.media=null}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}const e=this.hls.levels;if(e.length){const t=this.hls,s=this.getMaxLevel(e.length-1);s!==this.autoLevelCapping&&t.logger.log(`Setting autoLevelCapping to ${s}: ${e[s].height}p@${e[s].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),t.autoLevelCapping=s,t.autoLevelEnabled&&t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){const t=this.hls.levels;if(!t.length)return-1;const s=t.filter((n,r)=>this.isLevelAllowed(n)&&r<=e);return this.clientRect=null,gm.getMaxLevelByMediaSize(s,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,t={width:0,height:0};if(e){const s=e.getBoundingClientRect();t.width=s.width,t.height=s.height,!t.width&&!t.height&&(t.width=s.right-s.left||e.width||0,t.height=s.bottom-s.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch{}return Math.min(e,this.hls.config.maxDevicePixelRatio)}isLevelAllowed(e){return!this.restrictedLevels.some(s=>e.bitrate===s.bitrate&&e.width===s.width&&e.height===s.height)}static getMaxLevelByMediaSize(e,t,s){if(!(e!=null&&e.length))return-1;const n=(c,h)=>h?c.width!==h.width||c.height!==h.height:!0;let r=e.length-1;const l=Math.max(t,s);for(let c=0;c<e.length;c+=1){const h=e[c];if((h.width>=l||h.height>=l)&&n(h,e[c+1])){r=c;break}}return r}}const KC={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"},Fs=KC,YC={HLS:"h"},qC=YC;class zi{constructor(e,t){Array.isArray(e)&&(e=e.map(s=>s instanceof zi?s:new zi(s))),this.value=e,this.params=t}}const QC="Dict";function XC(i){return Array.isArray(i)?JSON.stringify(i):i instanceof Map?"Map{}":i instanceof Set?"Set{}":typeof i=="object"?JSON.stringify(i):String(i)}function WC(i,e,t,s){return new Error(`failed to ${i} "${XC(e)}" as ${t}`,{cause:s})}function Ki(i,e,t){return WC("serialize",i,e,t)}class xb{constructor(e){this.description=e}}const Jy="Bare Item",ZC="Boolean";function JC(i){if(typeof i!="boolean")throw Ki(i,ZC);return i?"?1":"?0"}function eO(i){return btoa(String.fromCharCode(...i))}const tO="Byte Sequence";function sO(i){if(ArrayBuffer.isView(i)===!1)throw Ki(i,tO);return`:${eO(i)}:`}const iO="Integer";function nO(i){return i<-999999999999999||999999999999999<i}function Sb(i){if(nO(i))throw Ki(i,iO);return i.toString()}function aO(i){return`@${Sb(i.getTime()/1e3)}`}function bb(i,e){if(i<0)return-bb(-i,e);const t=Math.pow(10,e);if(Math.abs(i*t%1-.5)<Number.EPSILON){const n=Math.floor(i*t);return(n%2===0?n:n+1)/t}else return Math.round(i*t)/t}const rO="Decimal";function lO(i){const e=bb(i,3);if(Math.floor(Math.abs(e)).toString().length>12)throw Ki(i,rO);const t=e.toString();return t.includes(".")?t:`${t}.0`}const oO="String",cO=/[\x00-\x1f\x7f]+/;function uO(i){if(cO.test(i))throw Ki(i,oO);return`"${i.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}function dO(i){return i.description||i.toString().slice(7,-1)}const hO="Token";function ex(i){const e=dO(i);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(e)===!1)throw Ki(e,hO);return e}function wf(i){switch(typeof i){case"number":if(!Ce(i))throw Ki(i,Jy);return Number.isInteger(i)?Sb(i):lO(i);case"string":return uO(i);case"symbol":return ex(i);case"boolean":return JC(i);case"object":if(i instanceof Date)return aO(i);if(i instanceof Uint8Array)return sO(i);if(i instanceof xb)return ex(i);default:throw Ki(i,Jy)}}const fO="Key";function Cf(i){if(/^[a-z*][a-z0-9\-_.*]*$/.test(i)===!1)throw Ki(i,fO);return i}function vm(i){return i==null?"":Object.entries(i).map(([e,t])=>t===!0?`;${Cf(e)}`:`;${Cf(e)}=${wf(t)}`).join("")}function Eb(i){return i instanceof zi?`${wf(i.value)}${vm(i.params)}`:wf(i)}function mO(i){return`(${i.value.map(Eb).join(" ")})${vm(i.params)}`}function pO(i,e={whitespace:!0}){if(typeof i!="object"||i==null)throw Ki(i,QC);const t=i instanceof Map?i.entries():Object.entries(i),s=e?.whitespace?" ":"";return Array.from(t).map(([n,r])=>{r instanceof zi||(r=new zi(r));let l=Cf(n);return r.value===!0?l+=vm(r.params):(l+="=",Array.isArray(r.value)?l+=mO(r):l+=Eb(r)),l}).join(`,${s}`)}function Tb(i,e){return pO(i,e)}const Bi="CMCD-Object",Ht="CMCD-Request",Sa="CMCD-Session",Xn="CMCD-Status",gO={br:Bi,ab:Bi,d:Bi,ot:Bi,tb:Bi,tpb:Bi,lb:Bi,tab:Bi,lab:Bi,url:Bi,pb:Ht,bl:Ht,tbl:Ht,dl:Ht,ltc:Ht,mtp:Ht,nor:Ht,nrr:Ht,rc:Ht,sn:Ht,sta:Ht,su:Ht,ttfb:Ht,ttfbb:Ht,ttlb:Ht,cmsdd:Ht,cmsds:Ht,smrt:Ht,df:Ht,cs:Ht,ts:Ht,cid:Sa,pr:Sa,sf:Sa,sid:Sa,st:Sa,v:Sa,msd:Sa,bs:Xn,bsd:Xn,cdn:Xn,rtp:Xn,bg:Xn,pt:Xn,ec:Xn,e:Xn},vO={REQUEST:Ht};function yO(i){return Object.keys(i).reduce((e,t)=>{var s;return(s=i[t])===null||s===void 0||s.forEach(n=>e[n]=t),e},{})}function xO(i,e){const t={};if(!i)return t;const s=Object.keys(i),n=e?yO(e):{};return s.reduce((r,l)=>{var c;const h=gO[l]||n[l]||vO.REQUEST,d=(c=r[h])!==null&&c!==void 0?c:r[h]={};return d[l]=i[l],r},t)}function SO(i){return["ot","sf","st","e","sta"].includes(i)}function bO(i){return typeof i=="number"?Ce(i):i!=null&&i!==""&&i!==!1}const Ab="event";function EO(i,e){const t=new URL(i),s=new URL(e);if(t.origin!==s.origin)return i;const n=t.pathname.split("/").slice(1),r=s.pathname.split("/").slice(1,-1);for(;n[0]===r[0];)n.shift(),r.shift();for(;r.length;)r.shift(),n.unshift("..");return n.join("/")+t.search+t.hash}const jc=i=>Math.round(i),Of=(i,e)=>Array.isArray(i)?i.map(t=>Of(t,e)):i instanceof zi&&typeof i.value=="string"?new zi(Of(i.value,e),i.params):(e.baseUrl&&(i=EO(i,e.baseUrl)),e.version===1?encodeURIComponent(i):i),Sc=i=>jc(i/100)*100,TO=(i,e)=>{let t=i;return e.version>=2&&(i instanceof zi&&typeof i.value=="string"?t=new zi([i]):typeof i=="string"&&(t=[i])),Of(t,e)},AO={br:jc,d:jc,bl:Sc,dl:Sc,mtp:Sc,nor:TO,rtp:Sc,tb:jc},_b="request",Ib="response",ym=["ab","bg","bl","br","bs","bsd","cdn","cid","cs","df","ec","lab","lb","ltc","msd","mtp","pb","pr","pt","sf","sid","sn","st","sta","tab","tb","tbl","tpb","ts","v"],_O=["e"],IO=/^[a-zA-Z0-9-.]+-[a-zA-Z0-9-.]+$/;function mu(i){return IO.test(i)}function RO(i){return ym.includes(i)||_O.includes(i)||mu(i)}const Rb=["d","dl","nor","ot","rtp","su"];function LO(i){return ym.includes(i)||Rb.includes(i)||mu(i)}const wO=["cmsdd","cmsds","rc","smrt","ttfb","ttfbb","ttlb","url"];function CO(i){return ym.includes(i)||Rb.includes(i)||wO.includes(i)||mu(i)}const OO=["bl","br","bs","cid","d","dl","mtp","nor","nrr","ot","pr","rtp","sf","sid","st","su","tb","v"];function NO(i){return OO.includes(i)||mu(i)}const DO={[Ib]:CO,[Ab]:RO,[_b]:LO};function Lb(i,e={}){const t={};if(i==null||typeof i!="object")return t;const s=e.version||i.v||1,n=e.reportingMode||_b,r=s===1?NO:DO[n];let l=Object.keys(i).filter(r);const c=e.filter;typeof c=="function"&&(l=l.filter(c));const h=n===Ib||n===Ab;h&&!l.includes("ts")&&l.push("ts"),s>1&&!l.includes("v")&&l.push("v");const d=At({},AO,e.formatters),f={version:s,reportingMode:n,baseUrl:e.baseUrl};return l.sort().forEach(p=>{let v=i[p];const x=d[p];if(typeof x=="function"&&(v=x(v,f)),p==="v"){if(s===1)return;v=s}p=="pr"&&v===1||(h&&p==="ts"&&!Ce(v)&&(v=Date.now()),bO(v)&&(SO(p)&&typeof v=="string"&&(v=new xb(v)),t[p]=v))}),t}function kO(i,e={}){const t={};if(!i)return t;const s=Lb(i,e),n=xO(s,e?.customHeaderMap);return Object.entries(n).reduce((r,[l,c])=>{const h=Tb(c,{whitespace:!1});return h&&(r[l]=h),r},t)}function PO(i,e,t){return At(i,kO(e,t))}const UO="CMCD";function MO(i,e={}){return i?Tb(Lb(i,e),{whitespace:!1}):""}function jO(i,e={}){if(!i)return"";const t=MO(i,e);return encodeURIComponent(t)}function FO(i,e={}){if(!i)return"";const t=jO(i,e);return`${UO}=${t}`}const tx=/CMCD=[^&#]+/;function BO(i,e,t){const s=FO(e,t);if(!s)return i;if(tx.test(i))return i.replace(tx,s);const n=i.includes("?")?"&":"?";return`${i}${n}${s}`}class $O{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=n=>{try{this.apply(n,{ot:Fs.MANIFEST,su:!this.initialized})}catch(r){this.hls.logger.warn("Could not generate manifest CMCD data.",r)}},this.applyFragmentData=n=>{try{const{frag:r,part:l}=n,c=this.hls.levels[r.level],h=this.getObjectType(r),d={d:(l||r).duration*1e3,ot:h};(h===Fs.VIDEO||h===Fs.AUDIO||h==Fs.MUXED)&&(d.br=c.bitrate/1e3,d.tb=this.getTopBandwidth(h)/1e3,d.bl=this.getBufferLength(h));const f=l?this.getNextPart(l):this.getNextFrag(r);f!=null&&f.url&&f.url!==r.url&&(d.nor=f.url),this.apply(n,d)}catch(r){this.hls.logger.warn("Could not generate segment CMCD data.",r)}},this.hls=e;const t=this.config=e.config,{cmcd:s}=t;s!=null&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=s.sessionId||e.sessionId,this.cid=s.contentId,this.useHeaders=s.useHeaders===!0,this.includeKeys=s.includeKeys,this.registerListeners())}registerListeners(){const e=this.hls;e.on(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(L.MEDIA_DETACHED,this.onMediaDetached,this),e.on(L.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(L.MEDIA_DETACHED,this.onMediaDetached,this),e.off(L.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var s,n;this.audioBuffer=(s=t.tracks.audio)==null?void 0:s.buffer,this.videoBuffer=(n=t.tracks.video)==null?void 0:n.buffer}createData(){var e;return{v:1,sf:qC.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)==null?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){At(t,this.createData());const s=t.ot===Fs.INIT||t.ot===Fs.VIDEO||t.ot===Fs.MUXED;this.starved&&s&&(t.bs=!0,t.su=!0,this.starved=!1),t.su==null&&(t.su=this.buffering);const{includeKeys:n}=this;n&&(t=Object.keys(t).reduce((l,c)=>(n.includes(c)&&(l[c]=t[c]),l),{}));const r={baseUrl:e.url};this.useHeaders?(e.headers||(e.headers={}),PO(e.headers,t,r)):e.url=BO(e.url,t,r)}getNextFrag(e){var t;const s=(t=this.hls.levels[e.level])==null?void 0:t.details;if(s){const n=e.sn-s.startSN;return s.fragments[n+1]}}getNextPart(e){var t;const{index:s,fragment:n}=e,r=(t=this.hls.levels[n.level])==null||(t=t.details)==null?void 0:t.partList;if(r){const{sn:l}=n;for(let c=r.length-1;c>=0;c--){const h=r[c];if(h.index===s&&h.fragment.sn===l)return r[c+1]}}}getObjectType(e){const{type:t}=e;if(t==="subtitle")return Fs.TIMED_TEXT;if(e.sn==="initSegment")return Fs.INIT;if(t==="audio")return Fs.AUDIO;if(t==="main")return this.hls.audioTracks.length?Fs.VIDEO:Fs.MUXED}getTopBandwidth(e){let t=0,s;const n=this.hls;if(e===Fs.AUDIO)s=n.audioTracks;else{const r=n.maxAutoLevel,l=r>-1?r+1:n.levels.length;s=n.levels.slice(0,l)}return s.forEach(r=>{r.bitrate>t&&(t=r.bitrate)}),t>0?t:NaN}getBufferLength(e){const t=this.media,s=e===Fs.AUDIO?this.audioBuffer:this.videoBuffer;return!s||!t?NaN:qe.bufferInfo(s,t.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){const{pLoader:e}=this.config,t=this.applyPlaylistData,s=e||this.config.loader;return class{constructor(r){this.loader=void 0,this.loader=new s(r)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(r,l,c){t(r),this.loader.load(r,l,c)}}}createFragmentLoader(){const{fLoader:e}=this.config,t=this.applyFragmentData,s=e||this.config.loader;return class{constructor(r){this.loader=void 0,this.loader=new s(r)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(r,l,c){t(r),this.loader.load(r,l,c)}}}}const VO=3e5;class GO extends Ti{constructor(e){super("content-steering",e.logger),this.hls=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this._pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(L.MANIFEST_PARSED,this.onManifestParsed,this),e.on(L.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(L.MANIFEST_PARSED,this.onManifestParsed,this),e.off(L.ERROR,this.onError,this))}pathways(){return(this.levels||[]).reduce((e,t)=>(e.indexOf(t.pathwayId)===-1&&e.push(t.pathwayId),e),[])}get pathwayPriority(){return this._pathwayPriority}set pathwayPriority(e){this.updatePathwayPriority(e)}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const e=this.timeToLoad*1e3-(performance.now()-this.updated);if(e>0){this.scheduleRefresh(this.uri,e);return}}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const t=this.levels;t&&(this.levels=t.filter(s=>s!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){const{contentSteering:s}=t;s!==null&&(this.pathwayId=s.pathwayId,this.uri=s.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){const{errorAction:s}=t;if(s?.action===gs.SendAlternateToPenaltyBox&&s.flags===ei.MoveAllAlternatesMatchingHost){const n=this.levels;let r=this._pathwayPriority,l=this.pathwayId;if(t.context){const{groupId:c,pathwayId:h,type:d}=t.context;c&&n?l=this.getPathwayForGroupId(c,d,l):h&&(l=h)}l in this.penalizedPathways||(this.penalizedPathways[l]=performance.now()),!r&&n&&(r=this.pathways()),r&&r.length>1&&(this.updatePathwayPriority(r),s.resolved=this.pathwayId!==l),t.details===Q.BUFFER_APPEND_ERROR&&!t.fatal?s.resolved=!0:s.resolved||this.warn(`Could not resolve ${t.details} ("${t.error.message}") with content-steering for Pathway: ${l} levels: ${n&&n.length} priorities: ${Ot(r)} penalized: ${Ot(this.penalizedPathways)}`)}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(t.length===0){const s=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${s}"`),t=this.getLevelsForPathway(s),this.pathwayId=s}return t.length!==e.length&&this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t}getLevelsForPathway(e){return this.levels===null?[]:this.levels.filter(t=>e===t.pathwayId)}updatePathwayPriority(e){this._pathwayPriority=e;let t;const s=this.penalizedPathways,n=performance.now();Object.keys(s).forEach(r=>{n-s[r]>VO&&delete s[r]});for(let r=0;r<e.length;r++){const l=e[r];if(l in s)continue;if(l===this.pathwayId)return;const c=this.hls.nextLoadLevel,h=this.hls.levels[c];if(t=this.getLevelsForPathway(l),t.length>0){this.log(`Setting Pathway to "${l}"`),this.pathwayId=l,qS(t),this.hls.trigger(L.LEVELS_UPDATED,{levels:t});const d=this.hls.levels[c];h&&d&&this.levels&&(d.attrs["STABLE-VARIANT-ID"]!==h.attrs["STABLE-VARIANT-ID"]&&d.bitrate!==h.bitrate&&this.log(`Unstable Pathways change from bitrate ${h.bitrate} to ${d.bitrate}`),this.hls.nextLoadLevel=c);break}}}getPathwayForGroupId(e,t,s){const n=this.getLevelsForPathway(s).concat(this.levels||[]);for(let r=0;r<n.length;r++)if(t===tt.AUDIO_TRACK&&n[r].hasAudioGroup(e)||t===tt.SUBTITLE_TRACK&&n[r].hasSubtitleGroup(e))return n[r].pathwayId;return s}clonePathways(e){const t=this.levels;if(!t)return;const s={},n={};e.forEach(r=>{const{ID:l,"BASE-ID":c,"URI-REPLACEMENT":h}=r;if(t.some(f=>f.pathwayId===l))return;const d=this.getLevelsForPathway(c).map(f=>{const p=new Bt(f.attrs);p["PATHWAY-ID"]=l;const v=p.AUDIO&&`${p.AUDIO}_clone_${l}`,x=p.SUBTITLES&&`${p.SUBTITLES}_clone_${l}`;v&&(s[p.AUDIO]=v,p.AUDIO=v),x&&(n[p.SUBTITLES]=x,p.SUBTITLES=x);const S=wb(f.uri,p["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",h),T=new Pl({attrs:p,audioCodec:f.audioCodec,bitrate:f.bitrate,height:f.height,name:f.name,url:S,videoCodec:f.videoCodec,width:f.width});if(f.audioGroups)for(let E=1;E<f.audioGroups.length;E++)T.addGroupId("audio",`${f.audioGroups[E]}_clone_${l}`);if(f.subtitleGroups)for(let E=1;E<f.subtitleGroups.length;E++)T.addGroupId("text",`${f.subtitleGroups[E]}_clone_${l}`);return T});t.push(...d),sx(this.audioTracks,s,h,l),sx(this.subtitleTracks,n,h,l)})}loadSteeringManifest(e){const t=this.hls.config,s=t.loader;this.loader&&this.loader.destroy(),this.loader=new s(t);let n;try{n=new self.URL(e)}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${e}`);return}if(n.protocol!=="data:"){const f=(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate)|0;n.searchParams.set("_HLS_pathway",this.pathwayId),n.searchParams.set("_HLS_throughput",""+f)}const r={responseType:"json",url:n.href},l=t.steeringManifestLoadPolicy.default,c=l.errorRetry||l.timeoutRetry||{},h={loadPolicy:l,timeout:l.maxLoadTimeMs,maxRetry:c.maxNumRetry||0,retryDelay:c.retryDelayMs||0,maxRetryDelay:c.maxRetryDelayMs||0},d={onSuccess:(f,p,v,x)=>{this.log(`Loaded steering manifest: "${n}"`);const S=f.data;if(S?.VERSION!==1){this.log(`Steering VERSION ${S.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=S.TTL;const{"RELOAD-URI":T,"PATHWAY-CLONES":E,"PATHWAY-PRIORITY":A}=S;if(T)try{this.uri=new self.URL(T,n).href}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${T}`);return}this.scheduleRefresh(this.uri||v.url),E&&this.clonePathways(E);const _={steeringManifest:S,url:n.toString()};this.hls.trigger(L.STEERING_MANIFEST_LOADED,_),A&&this.updatePathwayPriority(A)},onError:(f,p,v,x)=>{if(this.log(`Error loading steering manifest: ${f.code} ${f.text} (${p.url})`),this.stopLoad(),f.code===410){this.enabled=!1,this.log(`Steering manifest ${p.url} no longer available`);return}let S=this.timeToLoad*1e3;if(f.code===429){const T=this.loader;if(typeof T?.getResponseHeader=="function"){const E=T.getResponseHeader("Retry-After");E&&(S=parseFloat(E)*1e3)}this.log(`Steering manifest ${p.url} rate limited`);return}this.scheduleRefresh(this.uri||p.url,S)},onTimeout:(f,p,v)=>{this.log(`Timeout loading steering manifest (${p.url})`),this.scheduleRefresh(this.uri||p.url)}};this.log(`Requesting steering manifest: ${n}`),this.loader.load(r,h,d)}scheduleRefresh(e,t=this.timeToLoad*1e3){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var s;const n=(s=this.hls)==null?void 0:s.media;if(n&&!n.ended){this.loadSteeringManifest(e);return}this.scheduleRefresh(e,this.timeToLoad*1e3)},t)}}function sx(i,e,t,s){i&&Object.keys(e).forEach(n=>{const r=i.filter(l=>l.groupId===n).map(l=>{const c=At({},l);return c.details=void 0,c.attrs=new Bt(c.attrs),c.url=c.attrs.URI=wb(l.url,l.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",t),c.groupId=c.attrs["GROUP-ID"]=e[n],c.attrs["PATHWAY-ID"]=s,c});i.push(...r)})}function wb(i,e,t,s){const{HOST:n,PARAMS:r,[t]:l}=s;let c;e&&(c=l?.[e],c&&(i=c));const h=new self.URL(i);return n&&!c&&(h.host=n),r&&Object.keys(r).sort().forEach(d=>{d&&h.searchParams.set(d,r[d])}),h.href}class Tr extends Ti{constructor(e){super("eme",e.logger),this.hls=void 0,this.config=void 0,this.media=null,this.mediaResolved=void 0,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.mediaKeys=null,this.setMediaKeysQueue=Tr.CDMCleanupPromise?[Tr.CDMCleanupPromise]:[],this.bannedKeyIds={},this.onMediaEncrypted=t=>{const{initDataType:s,initData:n}=t,r=`"${t.type}" event: init data type: "${s}"`;if(this.debug(r),n!==null){if(!this.keyFormatPromise){let l=Object.keys(this.keySystemAccessPromises);l.length||(l=Ll(this.config));const c=l.map(Vh).filter(h=>!!h);this.keyFormatPromise=this.getKeyFormatPromise(c)}this.keyFormatPromise.then(l=>{const c=Pc(l);if(s!=="sinf"||c!==$t.FAIRPLAY){this.log(`Ignoring "${t.type}" event with init data type: "${s}" for selected key-system ${c}`);return}let h;try{const x=rs(new Uint8Array(n)),S=rm(JSON.parse(x).sinf),T=TS(S);if(!T)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");h=new Uint8Array(T.subarray(8,24))}catch(x){this.warn(`${r} Failed to parse sinf: ${x}`);return}const d=vs(h),{keyIdToKeySessionPromise:f,mediaKeySessions:p}=this;let v=f[d];for(let x=0;x<p.length;x++){const S=p[x],T=S.decryptdata;if(!T.keyId)continue;const E=vs(T.keyId);if(Zc(h,T.keyId)||T.uri.replace(/-/g,"").indexOf(d)!==-1){if(v=f[E],!v)continue;if(T.pssh)break;delete f[E],T.pssh=new Uint8Array(n),T.keyId=h,v=f[d]=v.then(()=>this.generateRequestWithPreferredKeySession(S,s,n,"encrypted-event-key-match")),v.catch(A=>this.handleError(A));break}}v||this.handleError(new Error(`Key ID ${d} not encountered in playlist. Key-system sessions ${p.length}.`))}).catch(l=>this.handleError(l))}},this.onWaitingForKey=t=>{this.log(`"${t.type}" event`)},this.hls=e,this.config=e.config,this.registerListeners()}destroy(){this.onDestroying(),this.onMediaDetached();const e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onMediaEncrypted=this.onWaitingForKey=null}registerListeners(){this.hls.on(L.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(L.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(L.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(L.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.on(L.DESTROYING,this.onDestroying,this)}unregisterListeners(){this.hls.off(L.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(L.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(L.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(L.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.off(L.DESTROYING,this.onDestroying,this)}getLicenseServerUrl(e){const{drmSystems:t,widevineLicenseUrl:s}=this.config,n=t?.[e];if(n)return n.licenseUrl;if(e===$t.WIDEVINE&&s)return s}getLicenseServerUrlOrThrow(e){const t=this.getLicenseServerUrl(e);if(t===void 0)throw new Error(`no license server URL configured for key-system "${e}"`);return t}getServerCertificateUrl(e){const{drmSystems:t}=this.config,s=t?.[e];if(s)return s.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){const t=this.hls.levels,s=(l,c,h)=>!!l&&h.indexOf(l)===c,n=t.map(l=>l.audioCodec).filter(s),r=t.map(l=>l.videoCodec).filter(s);return n.length+r.length===0&&r.push("avc1.42e01e"),new Promise((l,c)=>{const h=d=>{const f=d.shift();this.getMediaKeysPromise(f,n,r).then(p=>l({keySystem:f,mediaKeys:p})).catch(p=>{d.length?h(d):p instanceof Js?c(p):c(new Js({type:je.KEY_SYSTEM_ERROR,details:Q.KEY_SYSTEM_NO_ACCESS,error:p,fatal:!0},p.message))})};h(e)})}requestMediaKeySystemAccess(e,t){const{requestMediaKeySystemAccessFunc:s}=this.config;if(typeof s!="function"){let n=`Configured requestMediaKeySystemAccess is not a function ${s}`;return BS===null&&self.location.protocol==="http:"&&(n=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(n))}return s(e,t)}getMediaKeysPromise(e,t,s){var n;const r=Tw(e,t,s,this.config.drmSystemOptions||{});let l=this.keySystemAccessPromises[e],c=(n=l)==null?void 0:n.keySystemAccess;if(!c){this.log(`Requesting encrypted media "${e}" key-system access with config: ${Ot(r)}`),c=this.requestMediaKeySystemAccess(e,r);const h=l=this.keySystemAccessPromises[e]={keySystemAccess:c};return c.catch(d=>{this.log(`Failed to obtain access to key-system "${e}": ${d}`)}),c.then(d=>{this.log(`Access for key-system "${d.keySystem}" obtained`);const f=this.fetchServerCertificate(e);this.log(`Create media-keys for "${e}"`);const p=h.mediaKeys=d.createMediaKeys().then(v=>(this.log(`Media-keys created for "${e}"`),h.hasMediaKeys=!0,f.then(x=>x?this.setMediaKeysServerCertificate(v,e,x):v)));return p.catch(v=>{this.error(`Failed to create media-keys for "${e}"}: ${v}`)}),p})}return c.then(()=>l.mediaKeys)}createMediaKeySessionContext({decryptdata:e,keySystem:t,mediaKeys:s}){this.log(`Creating key-system session "${t}" keyId: ${vs(e.keyId||[])} keyUri: ${e.uri}`);const n=s.createSession(),r={decryptdata:e,keySystem:t,mediaKeys:s,mediaKeysSession:n,keyStatus:"status-pending"};return this.mediaKeySessions.push(r),r}renewKeySession(e){const t=e.decryptdata;if(t.pssh){const s=this.createMediaKeySessionContext(e),n=bc(t),r="cenc";this.keyIdToKeySessionPromise[n]=this.generateRequestWithPreferredKeySession(s,r,t.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}updateKeySession(e,t){const s=e.mediaKeysSession;return this.log(`Updating key-session "${s.sessionId}" for keyId ${vs(e.decryptdata.keyId||[])}
      } (data length: ${t.byteLength})`),s.update(t)}getSelectedKeySystemFormats(){return Object.keys(this.keySystemAccessPromises).map(e=>({keySystem:e,hasMediaKeys:this.keySystemAccessPromises[e].hasMediaKeys})).filter(({hasMediaKeys:e})=>!!e).map(({keySystem:e})=>Vh(e)).filter(e=>!!e)}getKeySystemAccess(e){return this.getKeySystemSelectionPromise(e).then(({keySystem:t,mediaKeys:s})=>this.attemptSetMediaKeys(t,s))}selectKeySystem(e){return new Promise((t,s)=>{this.getKeySystemSelectionPromise(e).then(({keySystem:n})=>{const r=Vh(n);r?t(r):s(new Error(`Unable to find format for key-system "${n}"`))}).catch(s)})}selectKeySystemFormat(e){const t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${t.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){const t=Ll(this.config),s=e.map(Pc).filter(n=>!!n&&t.indexOf(n)!==-1);return this.selectKeySystem(s)}getKeyStatus(e){const{mediaKeySessions:t}=this;for(let s=0;s<t.length;s++){const n=HO(e,t[s]);if(n)return n}}loadKey(e){const t=e.keyInfo.decryptdata,s=bc(t),n=this.bannedKeyIds[s];if(n||this.getKeyStatus(t)==="internal-error"){const c=ix(n||"internal-error",t);return this.handleError(c,e.frag),Promise.reject(c)}const r=`(keyId: ${s} format: "${t.keyFormat}" method: ${t.method} uri: ${t.uri})`;this.log(`Starting session for key ${r}`);const l=this.keyIdToKeySessionPromise[s];if(!l){const c=this.getKeySystemForKeyPromise(t).then(({keySystem:h,mediaKeys:d})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${r}`),this.attemptSetMediaKeys(h,d).then(()=>(this.throwIfDestroyed(),this.createMediaKeySessionContext({keySystem:h,mediaKeys:d,decryptdata:t}))))).then(h=>{const d="cenc",f=t.pssh?t.pssh.buffer:null;return this.generateRequestWithPreferredKeySession(h,d,f,"playlist-key")});return c.catch(h=>this.handleError(h,e.frag)),this.keyIdToKeySessionPromise[s]=c,c}return l.catch(c=>{if(c instanceof Js){const h=vt({},c.data);this.getKeyStatus(t)==="internal-error"&&(h.decryptdata=t);const d=new Js(h,c.message);this.handleError(d,e.frag)}}),l}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(e,t){if(this.hls)if(e instanceof Js){t&&(e.data.frag=t);const s=e.data.decryptdata;this.error(`${e.message}${s?` (${vs(s.keyId||[])})`:""}`),this.hls.trigger(L.ERROR,e.data)}else this.error(e.message),this.hls.trigger(L.ERROR,{type:je.KEY_SYSTEM_ERROR,details:Q.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0})}getKeySystemForKeyPromise(e){const t=bc(e),s=this.keyIdToKeySessionPromise[t];if(!s){const n=Pc(e.keyFormat),r=n?[n]:Ll(this.config);return this.attemptKeySystemAccess(r)}return s}getKeySystemSelectionPromise(e){if(e.length||(e=Ll(this.config)),e.length===0)throw new Js({type:je.KEY_SYSTEM_ERROR,details:Q.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${Ot({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}attemptSetMediaKeys(e,t){if(this.mediaResolved=void 0,this.mediaKeys===t)return Promise.resolve();const s=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);const n=Promise.all(s).then(()=>this.media?this.media.setMediaKeys(t):new Promise((r,l)=>{this.mediaResolved=()=>{if(this.mediaResolved=void 0,!this.media)return l(new Error("Attempted to set mediaKeys without media element attached"));this.mediaKeys=t,this.media.setMediaKeys(t).then(r).catch(l)}}));return this.mediaKeys=t,this.setMediaKeysQueue.push(n),n.then(()=>{this.log(`Media-keys set for "${e}"`),s.push(n),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(r=>s.indexOf(r)===-1)})}generateRequestWithPreferredKeySession(e,t,s,n){var r;const l=(r=this.config.drmSystems)==null||(r=r[e.keySystem])==null?void 0:r.generateRequest;if(l)try{const S=l.call(this.hls,t,s,e);if(!S)throw new Error("Invalid response from configured generateRequest filter");t=S.initDataType,s=S.initData?S.initData:null,e.decryptdata.pssh=s?new Uint8Array(s):null}catch(S){if(this.warn(S.message),this.hls&&this.hls.config.debug)throw S}if(s===null)return this.log(`Skipping key-session request for "${n}" (no initData)`),Promise.resolve(e);const c=bc(e.decryptdata),h=e.decryptdata.uri;this.log(`Generating key-session request for "${n}" keyId: ${c} URI: ${h} (init data type: ${t} length: ${s.byteLength})`);const d=new om,f=e._onmessage=S=>{const T=e.mediaKeysSession;if(!T){d.emit("error",new Error("invalid state"));return}const{messageType:E,message:A}=S;this.log(`"${E}" message event for session "${T.sessionId}" message size: ${A.byteLength}`),E==="license-request"||E==="license-renewal"?this.renewLicense(e,A).catch(_=>{d.eventNames().length?d.emit("error",_):this.handleError(_)}):E==="license-release"?e.keySystem===$t.FAIRPLAY&&this.updateKeySession(e,Tf("acknowledged")).then(()=>this.removeSession(e)).catch(_=>this.handleError(_)):this.warn(`unhandled media key message type "${E}"`)},p=(S,T)=>{T.keyStatus=S;let E;S.startsWith("usable")?d.emit("resolved"):S==="internal-error"||S==="output-restricted"||S==="output-downscaled"?E=ix(S,T.decryptdata):S==="expired"?E=new Error(`key expired (keyId: ${c})`):S==="released"?E=new Error("key released"):S==="status-pending"||this.warn(`unhandled key status change "${S}" (keyId: ${c})`),E&&(d.eventNames().length?d.emit("error",E):this.handleError(E))},v=e._onkeystatuseschange=S=>{if(!e.mediaKeysSession){d.emit("error",new Error("invalid state"));return}const E=this.getKeyStatuses(e);if(!Object.keys(E).some(w=>E[w]!=="status-pending"))return;if(E[c]==="expired"){this.log(`Expired key ${Ot(E)} in key-session "${e.mediaKeysSession.sessionId}"`),this.renewKeySession(e);return}let _=E[c];if(_)p(_,e);else{var R;e.keyStatusTimeouts||(e.keyStatusTimeouts={}),(R=e.keyStatusTimeouts)[c]||(R[c]=self.setTimeout(()=>{if(!e.mediaKeysSession||!this.mediaKeys)return;const N=this.getKeyStatus(e.decryptdata);if(N&&N!=="status-pending")return this.log(`No status for keyId ${c} in key-session "${e.mediaKeysSession.sessionId}". Using session key-status ${N} from other session.`),p(N,e);this.log(`key status for ${c} in key-session "${e.mediaKeysSession.sessionId}" timed out after 1000ms`),_="internal-error",p(_,e)},1e3)),this.log(`No status for keyId ${c} (${Ot(E)}).`)}};Cs(e.mediaKeysSession,"message",f),Cs(e.mediaKeysSession,"keystatuseschange",v);const x=new Promise((S,T)=>{d.on("error",T),d.on("resolved",S)});return e.mediaKeysSession.generateRequest(t,s).then(()=>{this.log(`Request generated for key-session "${e.mediaKeysSession.sessionId}" keyId: ${c} URI: ${h}`)}).catch(S=>{throw new Js({type:je.KEY_SYSTEM_ERROR,details:Q.KEY_SYSTEM_NO_SESSION,error:S,decryptdata:e.decryptdata,fatal:!1},`Error generating key-session request: ${S}`)}).then(()=>x).catch(S=>(d.removeAllListeners(),this.removeSession(e).then(()=>{throw S}))).then(()=>(d.removeAllListeners(),e))}getKeyStatuses(e){const t={};return e.mediaKeysSession.keyStatuses.forEach((s,n)=>{if(typeof n=="string"&&typeof s=="object"){const c=n;n=s,s=c}const r="buffer"in n?new Uint8Array(n.buffer,n.byteOffset,n.byteLength):new Uint8Array(n);if(e.keySystem===$t.PLAYREADY&&r.length===16){const c=vs(r);t[c]=s,jS(r)}const l=vs(r);s==="internal-error"&&(this.bannedKeyIds[l]=s),this.log(`key status change "${s}" for keyStatuses keyId: ${l} key-session "${e.mediaKeysSession.sessionId}"`),t[l]=s}),t}fetchServerCertificate(e){const t=this.config,s=t.loader,n=new s(t),r=this.getServerCertificateUrl(e);return r?(this.log(`Fetching server certificate for "${e}"`),new Promise((l,c)=>{const h={responseType:"arraybuffer",url:r},d=t.certLoadPolicy.default,f={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},p={onSuccess:(v,x,S,T)=>{l(v.data)},onError:(v,x,S,T)=>{c(new Js({type:je.KEY_SYSTEM_ERROR,details:Q.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:S,response:vt({url:h.url,data:void 0},v)},`"${e}" certificate request failed (${r}). Status: ${v.code} (${v.text})`))},onTimeout:(v,x,S)=>{c(new Js({type:je.KEY_SYSTEM_ERROR,details:Q.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:S,response:{url:h.url,data:void 0}},`"${e}" certificate request timed out (${r})`))},onAbort:(v,x,S)=>{c(new Error("aborted"))}};n.load(h,f,p)})):Promise.resolve()}setMediaKeysServerCertificate(e,t,s){return new Promise((n,r)=>{e.setServerCertificate(s).then(l=>{this.log(`setServerCertificate ${l?"success":"not supported by CDM"} (${s.byteLength}) on "${t}"`),n(e)}).catch(l=>{r(new Js({type:je.KEY_SYSTEM_ERROR,details:Q.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:l,fatal:!0},l.message))})})}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then(s=>this.updateKeySession(e,new Uint8Array(s)).catch(n=>{throw new Js({type:je.KEY_SYSTEM_ERROR,details:Q.KEY_SYSTEM_SESSION_UPDATE_FAILED,decryptdata:e.decryptdata,error:n,fatal:!1},n.message)}))}unpackPlayReadyKeyMessage(e,t){const s=String.fromCharCode.apply(null,new Uint16Array(t.buffer));if(!s.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),t;const n=new DOMParser().parseFromString(s,"application/xml"),r=n.querySelectorAll("HttpHeader");if(r.length>0){let f;for(let p=0,v=r.length;p<v;p++){var l,c;f=r[p];const x=(l=f.querySelector("name"))==null?void 0:l.textContent,S=(c=f.querySelector("value"))==null?void 0:c.textContent;x&&S&&e.setRequestHeader(x,S)}}const h=n.querySelector("Challenge"),d=h?.textContent;if(!d)throw new Error("Cannot find <Challenge> in key message");return Tf(atob(d))}setupLicenseXHR(e,t,s,n){const r=this.config.licenseXhrSetup;return r?Promise.resolve().then(()=>{if(!s.decryptdata)throw new Error("Key removed");return r.call(this.hls,e,t,s,n)}).catch(l=>{if(!s.decryptdata)throw l;return e.open("POST",t,!0),r.call(this.hls,e,t,s,n)}).then(l=>(e.readyState||e.open("POST",t,!0),{xhr:e,licenseChallenge:l||n})):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:n}))}requestLicense(e,t){const s=this.config.keyLoadPolicy.default;return new Promise((n,r)=>{const l=this.getLicenseServerUrlOrThrow(e.keySystem);this.log(`Sending license request to URL: ${l}`);const c=new XMLHttpRequest;c.responseType="arraybuffer",c.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return r(new Error("invalid state"));if(c.readyState===4)if(c.status===200){this._requestLicenseFailureCount=0;let h=c.response;this.log(`License received ${h instanceof ArrayBuffer?h.byteLength:h}`);const d=this.config.licenseResponseCallback;if(d)try{h=d.call(this.hls,c,l,e)}catch(f){this.error(f)}n(h)}else{const h=s.errorRetry,d=h?h.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>d||c.status>=400&&c.status<500)r(new Js({type:je.KEY_SYSTEM_ERROR,details:Q.KEY_SYSTEM_LICENSE_REQUEST_FAILED,decryptdata:e.decryptdata,fatal:!0,networkDetails:c,response:{url:l,data:void 0,code:c.status,text:c.statusText}},`License Request XHR failed (${l}). Status: ${c.status} (${c.statusText})`));else{const f=d-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${f} attempts left`),this.requestLicense(e,t).then(n,r)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=c,this.setupLicenseXHR(c,l,e,t).then(({xhr:h,licenseChallenge:d})=>{e.keySystem==$t.PLAYREADY&&(d=this.unpackPlayReadyKeyMessage(h,d)),h.send(d)}).catch(r)})}onDestroying(){this.unregisterListeners(),this._clear()}onMediaAttached(e,t){if(!this.config.emeEnabled)return;const s=t.media;this.media=s,Cs(s,"encrypted",this.onMediaEncrypted),Cs(s,"waitingforkey",this.onWaitingForKey);const n=this.mediaResolved;n?n():this.mediaKeys=s.mediaKeys}onMediaDetached(){const e=this.media;e&&($s(e,"encrypted",this.onMediaEncrypted),$s(e,"waitingforkey",this.onWaitingForKey),this.media=null,this.mediaKeys=null)}_clear(){var e;this._requestLicenseFailureCount=0,this.keyIdToKeySessionPromise={},this.bannedKeyIds={};const t=this.mediaResolved;if(t&&t(),!this.mediaKeys&&!this.mediaKeySessions.length)return;const s=this.media,n=this.mediaKeySessions.slice();this.mediaKeySessions=[],this.mediaKeys=null,Jn.clearKeyUriToKeyIdMap();const r=n.length;Tr.CDMCleanupPromise=Promise.all(n.map(l=>this.removeSession(l)).concat((s==null||(e=s.setMediaKeys(null))==null?void 0:e.catch(l=>{this.log(`Could not clear media keys: ${l}`),this.hls&&this.hls.trigger(L.ERROR,{type:je.OTHER_ERROR,details:Q.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:new Error(`Could not clear media keys: ${l}`)})}))||Promise.resolve())).catch(l=>{this.log(`Could not close sessions and clear media keys: ${l}`),this.hls&&this.hls.trigger(L.ERROR,{type:je.OTHER_ERROR,details:Q.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close sessions and clear media keys: ${l}`)})}).then(()=>{r&&this.log("finished closing key sessions and clearing media keys")})}onManifestLoading(){this._clear()}onManifestLoaded(e,{sessionKeys:t}){if(!(!t||!this.config.emeEnabled)&&!this.keyFormatPromise){const s=t.reduce((n,r)=>(n.indexOf(r.keyFormat)===-1&&n.push(r.keyFormat),n),[]);this.log(`Selecting key-system from session-keys ${s.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(s)}}removeSession(e){const{mediaKeysSession:t,licenseXhr:s,decryptdata:n}=e;if(t){this.log(`Remove licenses and keys and close session "${t.sessionId}" keyId: ${vs(n?.keyId||[])}`),e._onmessage&&(t.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(t.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),s&&s.readyState!==XMLHttpRequest.DONE&&s.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const r=this.mediaKeySessions.indexOf(e);r>-1&&this.mediaKeySessions.splice(r,1);const{keyStatusTimeouts:l}=e;l&&Object.keys(l).forEach(d=>self.clearTimeout(l[d]));const{drmSystemOptions:c}=this.config;return(_w(c)?new Promise((d,f)=>{self.setTimeout(()=>f(new Error("MediaKeySession.remove() timeout")),8e3),t.remove().then(d).catch(f)}):Promise.resolve()).catch(d=>{this.log(`Could not remove session: ${d}`),this.hls&&this.hls.trigger(L.ERROR,{type:je.OTHER_ERROR,details:Q.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:new Error(`Could not remove session: ${d}`)})}).then(()=>t.close()).catch(d=>{this.log(`Could not close session: ${d}`),this.hls&&this.hls.trigger(L.ERROR,{type:je.OTHER_ERROR,details:Q.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close session: ${d}`)})})}return Promise.resolve()}}Tr.CDMCleanupPromise=void 0;function bc(i){if(!i)throw new Error("Could not read keyId of undefined decryptdata");if(i.keyId===null)throw new Error("keyId is null");return vs(i.keyId)}function HO(i,e){if(i.keyId&&e.mediaKeysSession.keyStatuses.has(i.keyId))return e.mediaKeysSession.keyStatuses.get(i.keyId);if(i.matches(e.decryptdata))return e.keyStatus}class Js extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}function ix(i,e){const t=i==="output-restricted",s=t?Q.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:Q.KEY_SYSTEM_STATUS_INTERNAL_ERROR;return new Js({type:je.KEY_SYSTEM_ERROR,details:s,fatal:!1,decryptdata:e},t?"HDCP level output restricted":`key status changed to "${i}"`)}class zO{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(L.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(L.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListeners(){this.hls.off(L.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(L.MEDIA_DETACHING,this.onMediaDetaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){const s=this.hls.config;if(s.capLevelOnFPSDrop){const n=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=n,n&&typeof n.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),s.fpsDroppedMonitoringPeriod)}}onMediaDetaching(){this.media=null}checkFPS(e,t,s){const n=performance.now();if(t){if(this.lastTime){const r=n-this.lastTime,l=s-this.lastDroppedFrames,c=t-this.lastDecodedFrames,h=1e3*l/r,d=this.hls;if(d.trigger(L.FPS_DROP,{currentDropped:l,currentDecoded:c,totalDroppedFrames:s}),h>0&&l>d.config.fpsDroppedMonitoringThreshold*c){let f=d.currentLevel;d.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+f),f>0&&(d.autoLevelCapping===-1||d.autoLevelCapping>=f)&&(f=f-1,d.trigger(L.FPS_DROP_LEVEL_CAPPING,{level:f,droppedLevel:d.currentLevel}),d.autoLevelCapping=f,this.streamController.nextLevelSwitch())}}this.lastTime=n,this.lastDroppedFrames=s,this.lastDecodedFrames=t}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}function Cb(i,e){let t;try{t=new Event("addtrack")}catch{t=document.createEvent("Event"),t.initEvent("addtrack",!1,!1)}t.track=i,e.dispatchEvent(t)}function Ob(i,e){const t=i.mode;if(t==="disabled"&&(i.mode="hidden"),i.cues&&!i.cues.getCueById(e.id))try{if(i.addCue(e),!i.cues.getCueById(e.id))throw new Error(`addCue is failed for: ${e}`)}catch(s){yt.debug(`[texttrack-utils]: ${s}`);try{const n=new self.TextTrackCue(e.startTime,e.endTime,e.text);n.id=e.id,i.addCue(n)}catch(n){yt.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${n}`)}}t==="disabled"&&(i.mode=t)}function Sr(i,e){const t=i.mode;if(t==="disabled"&&(i.mode="hidden"),i.cues)for(let s=i.cues.length;s--;)e&&i.cues[s].removeEventListener("enter",e),i.removeCue(i.cues[s]);t==="disabled"&&(i.mode=t)}function Nf(i,e,t,s){const n=i.mode;if(n==="disabled"&&(i.mode="hidden"),i.cues&&i.cues.length>0){const r=YO(i.cues,e,t);for(let l=0;l<r.length;l++)(!s||s(r[l]))&&i.removeCue(r[l])}n==="disabled"&&(i.mode=n)}function KO(i,e){if(e<=i[0].startTime)return 0;const t=i.length-1;if(e>i[t].endTime)return-1;let s=0,n=t,r;for(;s<=n;)if(r=Math.floor((n+s)/2),e<i[r].startTime)n=r-1;else if(e>i[r].startTime&&s<t)s=r+1;else return r;return i[s].startTime-e<e-i[n].startTime?s:n}function YO(i,e,t){const s=[],n=KO(i,e);if(n>-1)for(let r=n,l=i.length;r<l;r++){const c=i[r];if(c.startTime>=e&&c.endTime<=t)s.push(c);else if(c.startTime>t)return s}return s}function Fc(i){const e=[];for(let t=0;t<i.length;t++){const s=i[t];(s.kind==="subtitles"||s.kind==="captions")&&s.label&&e.push(i[t])}return e}class qO extends pm{constructor(e){super(e,"subtitle-track-controller"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let t=null;const s=Fc(this.media.textTracks);for(let r=0;r<s.length;r++)if(s[r].mode==="hidden")t=s[r];else if(s[r].mode==="showing"){t=s[r];break}const n=this.findTrackForTextTrack(t);this.subtitleTrack!==n&&this.setSubtitleTrack(n)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:e}=this;e.on(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.MANIFEST_PARSED,this.onManifestParsed,this),e.on(L.LEVEL_LOADING,this.onLevelLoading,this),e.on(L.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(L.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(L.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.MANIFEST_PARSED,this.onManifestParsed,this),e.off(L.LEVEL_LOADING,this.onLevelLoading,this),e.off(L.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(L.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(L.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(e,t){const s=this.media;if(!s)return;const n=!!t.transferMedia;if(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||s.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,n)return;Fc(s.textTracks).forEach(l=>{Sr(l)})}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){const{id:s,groupId:n,details:r}=t,l=this.tracksInGroup[s];if(!l||l.groupId!==n){this.warn(`Subtitle track with id:${s} and group:${n} not found in active group ${l?.groupId}`);return}const c=l.details;l.details=t.details,this.log(`Subtitle track ${s} "${l.name}" lang:${l.lang} group:${n} loaded [${r.startSN}-${r.endSN}]`),s===this.trackId&&this.playlistLoaded(s,t,c)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const s=t.subtitleGroups||null,n=this.groupIds;let r=this.currentTrack;if(!s||n?.length!==s?.length||s!=null&&s.some(l=>n?.indexOf(l)===-1)){this.groupIds=s,this.trackId=-1,this.currentTrack=null;const l=this.tracks.filter(f=>!s||s.indexOf(f.groupId)!==-1);if(l.length)this.selectDefaultTrack&&!l.some(f=>f.default)&&(this.selectDefaultTrack=!1),l.forEach((f,p)=>{f.id=p});else if(!r&&!this.tracksInGroup.length)return;this.tracksInGroup=l;const c=this.hls.config.subtitlePreference;if(!r&&c){this.selectDefaultTrack=!1;const f=Gi(c,l);if(f>-1)r=l[f];else{const p=Gi(c,this.tracks);r=this.tracks[p]}}let h=this.findTrackId(r);h===-1&&r&&(h=this.findTrackId(null));const d={subtitleTracks:l};this.log(`Updating subtitle tracks, ${l.length} track(s) found in "${s?.join(",")}" group-id`),this.hls.trigger(L.SUBTITLE_TRACKS_UPDATED,d),h!==-1&&this.trackId===-1&&this.setSubtitleTrack(h)}}findTrackId(e){const t=this.tracksInGroup,s=this.selectDefaultTrack;for(let n=0;n<t.length;n++){const r=t[n];if(!(s&&!r.default||!s&&!e)&&(!e||_a(r,e)))return n}if(e){for(let n=0;n<t.length;n++){const r=t[n];if(Fl(e.attrs,r.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return n}for(let n=0;n<t.length;n++){const r=t[n];if(Fl(e.attrs,r.attrs,["LANGUAGE"]))return n}}return-1}findTrackForTextTrack(e){if(e){const t=this.tracksInGroup;for(let s=0;s<t.length;s++){const n=t[s];if(Lf(n,e))return s}}return-1}onError(e,t){t.fatal||!t.context||t.context.type===tt.SUBTITLE_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){if(e.id===-1)return this.setSubtitleTrack(-1),null;const t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){const s=this.currentTrack;if(s&&_a(e,s))return s;const n=Gi(e,this.tracksInGroup);if(n>-1){const r=this.tracksInGroup[n];return this.setSubtitleTrack(n),r}else{if(s)return null;{const r=Gi(e,t);if(r>-1)return t[r]}}}}return null}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const s=e.id,n=e.groupId,r=this.getUrlWithDirectives(e.url,t),l=e.details,c=l?.age;this.log(`Loading subtitle ${s} "${e.name}" lang:${e.lang} group:${n}${t?.msn!==void 0?" at sn "+t.msn+" part "+t.part:""}${c&&l.live?" age "+c.toFixed(1)+(l.type&&" "+l.type||""):""} ${r}`),this.hls.trigger(L.SUBTITLE_TRACK_LOADING,{url:r,id:s,groupId:n,deliveryDirectives:t||null,track:e})}toggleTrackModes(){const{media:e}=this;if(!e)return;const t=Fc(e.textTracks),s=this.currentTrack;let n;if(s&&(n=t.filter(r=>Lf(s,r))[0],n||this.warn(`Unable to find subtitle TextTrack with name "${s.name}" and language "${s.lang}"`)),[].slice.call(t).forEach(r=>{r.mode!=="disabled"&&r!==n&&(r.mode="disabled")}),n){const r=this.subtitleDisplay?"showing":"hidden";n.mode!==r&&(n.mode=r)}}setSubtitleTrack(e){const t=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(e<-1||e>=t.length||!Ce(e)){this.warn(`Invalid subtitle track id: ${e}`);return}this.selectDefaultTrack=!1;const s=this.currentTrack,n=t[e]||null;if(this.trackId=e,this.currentTrack=n,this.toggleTrackModes(),!n){this.hls.trigger(L.SUBTITLE_TRACK_SWITCH,{id:e});return}const r=!!n.details&&!n.details.live;if(e===this.trackId&&n===s&&r)return;this.log(`Switching to subtitle-track ${e}`+(n?` "${n.name}" lang:${n.lang} group:${n.groupId}`:""));const{id:l,groupId:c="",name:h,type:d,url:f}=n;this.hls.trigger(L.SUBTITLE_TRACK_SWITCH,{id:l,groupId:c,name:h,type:d,url:f});const p=this.switchParams(n.url,s?.details,n.details);this.loadPlaylist(p)}}function QO(){try{return crypto.randomUUID()}catch{try{const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}catch{let t=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,n=>{const r=(t+Math.random()*16)%16|0;return t=Math.floor(t/16),(n=="x"?r:r&3|8).toString(16)})}}}function Ol(i){let e=5381,t=i.length;for(;t;)e=e*33^i.charCodeAt(--t);return(e>>>0).toString()}const Ar=.025;let su=(function(i){return i[i.Point=0]="Point",i[i.Range=1]="Range",i})({});function XO(i,e,t){return`${i.identifier}-${t+1}-${Ol(e)}`}class WO{constructor(e,t){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=t,this.dateRange=e,this.setDateRange(e)}setDateRange(e){this.dateRange=e,this.resumeOffset=e.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=e.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=e.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=e.attr.enumeratedStringList("X-SNAP",this.snapOptions)}reset(){var e;this.appendInPlaceStarted=!1,(e=this.assetListLoader)==null||e.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)}isAssetPastPlayoutLimit(e){var t;if(e>0&&e>=this.assetList.length)return!0;const s=this.playoutLimit;return e<=0||isNaN(s)?!1:s===0?!0:(((t=this.assetList[e])==null?void 0:t.startOffset)||0)>s}findAssetIndex(e){return this.assetList.indexOf(e)}get identifier(){return this.dateRange.id}get startDate(){return this.dateRange.startDate}get startTime(){const e=this.dateRange.startTime;if(this.snapOptions.out){const t=this.dateRange.tagAnchor;if(t)return Wh(e,t)}return e}get startOffset(){return this.cue.pre?0:this.startTime}get startIsAligned(){if(this.startTime===0||this.snapOptions.out)return!0;const e=this.dateRange.tagAnchor;if(e){const t=this.dateRange.startTime,s=Wh(t,e);return t-s<.1}return!1}get resumptionOffset(){const e=this.resumeOffset,t=Ce(e)?e:this.duration;return this.cumulativeDuration+t}get resumeTime(){const e=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){const t=this.resumeAnchor;if(t)return Wh(e,t)}return e}get appendInPlace(){return this.appendInPlaceStarted?!0:this.appendInPlaceDisabled?!1:!!(!this.cue.once&&!this.cue.pre&&this.startIsAligned&&(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&Math.abs(this.resumeOffset-this.duration)<Ar))}set appendInPlace(e){if(this.appendInPlaceStarted){this.resetOnResume=!e;return}this.appendInPlaceDisabled=!e}get timelineStart(){return this._timelineStart!==null?this._timelineStart:this.startTime}set timelineStart(e){this._timelineStart=e}get duration(){const e=this.playoutLimit;let t;return this._duration!==null?t=this._duration:this.dateRange.duration?t=this.dateRange.duration:t=this.dateRange.plannedDuration||0,!isNaN(e)&&e<t&&(t=e),t}set duration(e){this._duration=e}get cue(){return this.dateRange.cue}get timelineOccupancy(){return this.dateRange.attr["X-TIMELINE-OCCUPIES"]==="RANGE"?su.Range:su.Point}get supplementsPrimary(){return this.dateRange.attr["X-TIMELINE-STYLE"]==="PRIMARY"}get contentMayVary(){return this.dateRange.attr["X-CONTENT-MAY-VARY"]!=="NO"}get assetUrl(){return this.dateRange.attr["X-ASSET-URI"]}get assetListUrl(){return this.dateRange.attr["X-ASSET-LIST"]}get baseUrl(){return this.base.url}get assetListLoaded(){return this.assetList.length>0||this.assetListResponse!==null}toString(){return ZO(this)}}function Wh(i,e){return i-e.start<e.duration/2&&!(Math.abs(i-(e.start+e.duration))<Ar)?e.start:e.start+e.duration}function Nb(i,e,t){const s=new self.URL(i,t);return s.protocol!=="data:"&&s.searchParams.set("_HLS_primary_id",e),s}function Zh(i,e){for(;(t=i.assetList[++e])!=null&&t.error;)var t;return e}function ZO(i){return`["${i.identifier}" ${i.cue.pre?"<pre>":i.cue.post?"<post>":""}${i.timelineStart.toFixed(2)}-${i.resumeTime.toFixed(2)}]`}function xr(i){const e=i.timelineStart,t=i.duration||0;return`["${i.identifier}" ${e.toFixed(2)}-${(e+t).toFixed(2)}]`}class JO{constructor(e,t,s,n){this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=()=>{this.reachedPlayout(this.currentTime)&&this.hls&&this.hls.trigger(L.PLAYOUT_LIMIT_REACHED,{})};const r=this.hls=new e(t);this.interstitial=s,this.assetItem=n;const l=()=>{this.hasDetails=!0};r.once(L.LEVEL_LOADED,l),r.once(L.AUDIO_TRACK_LOADED,l),r.once(L.SUBTITLE_TRACK_LOADED,l),r.on(L.MEDIA_ATTACHING,(c,{media:h})=>{this.removeMediaListeners(),this.mediaAttached=h,this.interstitial.playoutLimit&&(h.addEventListener("timeupdate",this.checkPlayout),this.appendInPlace&&r.on(L.BUFFER_APPENDED,()=>{const f=this.bufferedEnd;this.reachedPlayout(f)&&(this._bufferedEosTime=f,r.trigger(L.BUFFERED_TO_END,void 0))}))})}get appendInPlace(){return this.interstitial.appendInPlace}loadSource(){const e=this.hls;if(e)if(e.url)e.levels.length&&!e.started&&e.startLoad(-1,!0);else{let t=this.assetItem.uri;try{t=Nb(t,e.config.primarySessionId||"").href}catch{}e.loadSource(t)}}bufferedInPlaceToEnd(e){var t;if(!this.appendInPlace)return!1;if((t=this.hls)!=null&&t.bufferedToEnd)return!0;if(!e)return!1;const s=Math.min(this._bufferedEosTime||1/0,this.duration),n=this.timelineOffset,r=qe.bufferInfo(e,n,0);return this.getAssetTime(r.end)>=s-.02}reachedPlayout(e){const s=this.interstitial.playoutLimit;return this.startOffset+e>=s}get destroyed(){var e;return!((e=this.hls)!=null&&e.userConfig)}get assetId(){return this.assetItem.identifier}get interstitialId(){return this.assetItem.parentIdentifier}get media(){var e;return((e=this.hls)==null?void 0:e.media)||null}get bufferedEnd(){const e=this.media||this.mediaAttached;if(!e)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;const t=qe.bufferInfo(e,e.currentTime,.001);return this.getAssetTime(t.end)}get currentTime(){const e=this.media||this.mediaAttached;return e?this.getAssetTime(e.currentTime):this._currentTime||0}get duration(){const e=this.assetItem.duration;if(!e)return 0;const t=this.interstitial.playoutLimit;if(t){const s=t-this.startOffset;if(s>0&&s<e)return s}return e}get remaining(){const e=this.duration;return e?Math.max(0,e-this.currentTime):0}get startOffset(){return this.assetItem.startOffset}get timelineOffset(){var e;return((e=this.hls)==null?void 0:e.config.timelineOffset)||0}set timelineOffset(e){const t=this.timelineOffset;if(e!==t){const s=e-t;if(Math.abs(s)>1/9e4&&this.hls){if(this.hasDetails)throw new Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=e}}}getAssetTime(e){const t=this.timelineOffset,s=this.duration;return Math.min(Math.max(0,e-t),s)}removeMediaListeners(){const e=this.mediaAttached;e&&(this._currentTime=e.currentTime,this.bufferSnapShot(),e.removeEventListener("timeupdate",this.checkPlayout))}bufferSnapShot(){if(this.mediaAttached){var e;(e=this.hls)!=null&&e.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd)}}destroy(){this.removeMediaListeners(),this.hls&&this.hls.destroy(),this.hls=null,this.tracks=this.mediaAttached=this.checkPlayout=null}attachMedia(e){var t;this.loadSource(),(t=this.hls)==null||t.attachMedia(e)}detachMedia(){var e;this.removeMediaListeners(),this.mediaAttached=null,(e=this.hls)==null||e.detachMedia()}resumeBuffering(){var e;(e=this.hls)==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.hls)==null||e.pauseBuffering()}transferMedia(){var e;return this.bufferSnapShot(),((e=this.hls)==null?void 0:e.transferMedia())||null}resetDetails(){const e=this.hls;if(e&&this.hasDetails){e.stopLoad();const t=s=>delete s.details;e.levels.forEach(t),e.allAudioTracks.forEach(t),e.allSubtitleTracks.forEach(t),this.hasDetails=!1}}on(e,t,s){var n;(n=this.hls)==null||n.on(e,t)}once(e,t,s){var n;(n=this.hls)==null||n.once(e,t)}off(e,t,s){var n;(n=this.hls)==null||n.off(e,t)}toString(){var e;return`HlsAssetPlayer: ${xr(this.assetItem)} ${(e=this.hls)==null?void 0:e.sessionId} ${this.appendInPlace?"append-in-place":""}`}}const nx=.033;class eN extends Ti{constructor(e,t){super("interstitials-sched",t),this.onScheduleUpdate=void 0,this.eventMap={},this.events=null,this.items=null,this.durations={primary:0,playout:0,integrated:0},this.onScheduleUpdate=e}destroy(){this.reset(),this.onScheduleUpdate=null}reset(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach(e=>e.reset()),this.events=this.items=null}resetErrorsInRange(e,t){return this.events?this.events.reduce((s,n)=>e<=n.startOffset&&t>n.startOffset?(delete n.error,s+1):s,0):0}get duration(){const e=this.items;return e?e[e.length-1].end:0}get length(){return this.items?this.items.length:0}getEvent(e){return e&&this.eventMap[e]||null}hasEvent(e){return e in this.eventMap}findItemIndex(e,t){if(e.event)return this.findEventIndex(e.event.identifier);let s=-1;e.nextEvent?s=this.findEventIndex(e.nextEvent.identifier)-1:e.previousEvent&&(s=this.findEventIndex(e.previousEvent.identifier)+1);const n=this.items;if(n)for(n[s]||(t===void 0&&(t=e.start),s=this.findItemIndexAtTime(t));s>=0&&(r=n[s])!=null&&r.event;){var r;s--}return s}findItemIndexAtTime(e,t){const s=this.items;if(s)for(let n=0;n<s.length;n++){let r=s[n];if(t&&t!=="primary"&&(r=r[t]),e===r.start||e>r.start&&e<r.end)return n}return-1}findJumpRestrictedIndex(e,t){const s=this.items;if(s)for(let n=e;n<=t&&s[n];n++){const r=s[n].event;if(r!=null&&r.restrictions.jump&&!r.appendInPlace)return n}return-1}findEventIndex(e){const t=this.items;if(t)for(let n=t.length;n--;){var s;if(((s=t[n].event)==null?void 0:s.identifier)===e)return n}return-1}findAssetIndex(e,t){const s=e.assetList,n=s.length;if(n>1)for(let r=0;r<n;r++){const l=s[r];if(!l.error){const c=l.timelineStart;if(t===c||t>c&&(t<c+(l.duration||0)||r===n-1))return r}}return 0}get assetIdAtEnd(){var e;const t=(e=this.items)==null||(e=e[this.length-1])==null?void 0:e.event;if(t){const s=t.assetList,n=s[s.length-1];if(n)return n.identifier}return null}parseInterstitialDateRanges(e,t){const s=e.main.details,{dateRanges:n}=s,r=this.events,l=this.parseDateRanges(n,{url:s.url},t),c=Object.keys(n),h=r?r.filter(d=>!c.includes(d.identifier)):[];l.length&&l.sort((d,f)=>{const p=d.cue.pre,v=d.cue.post,x=f.cue.pre,S=f.cue.post;if(p&&!x)return-1;if(x&&!p||v&&!S)return 1;if(S&&!v)return-1;if(!p&&!x&&!v&&!S){const T=d.startTime,E=f.startTime;if(T!==E)return T-E}return d.dateRange.tagOrder-f.dateRange.tagOrder}),this.events=l,h.forEach(d=>{this.removeEvent(d)}),this.updateSchedule(e,h)}updateSchedule(e,t=[],s=!1){const n=this.events||[];if(n.length||t.length||this.length<2){const r=this.items,l=this.parseSchedule(n,e);(s||t.length||r?.length!==l.length||l.some((h,d)=>Math.abs(h.playout.start-r[d].playout.start)>.005||Math.abs(h.playout.end-r[d].playout.end)>.005))&&(this.items=l,this.onScheduleUpdate(t,r))}}parseDateRanges(e,t,s){const n=[],r=Object.keys(e);for(let l=0;l<r.length;l++){const c=r[l],h=e[c];if(h.isInterstitial){let d=this.eventMap[c];d?d.setDateRange(h):(d=new WO(h,t),this.eventMap[c]=d,s===!1&&(d.appendInPlace=s)),n.push(d)}}return n}parseSchedule(e,t){const s=[],n=t.main.details,r=n.live?1/0:n.edge;let l=0;if(e=e.filter(h=>!h.error&&!(h.cue.once&&h.hasPlayed)),e.length){this.resolveOffsets(e,t);let h=0,d=0;if(e.forEach((f,p)=>{const v=f.cue.pre,x=f.cue.post,S=e[p-1]||null,T=f.appendInPlace,E=x?r:f.startOffset,A=f.duration,_=f.timelineOccupancy===su.Range?A:0,R=f.resumptionOffset,w=S?.startTime===E,N=E+f.cumulativeDuration;let U=T?N+A:E+R;if(v||!x&&E<=0){const F=d;d+=_,f.timelineStart=N;const j=l;l+=A,s.push({event:f,start:N,end:U,playout:{start:j,end:l},integrated:{start:F,end:d}})}else if(E<=r){if(!w){const M=E-h;if(M>nx){const H=h,K=d;d+=M;const se=l;l+=M;const ne={previousEvent:e[p-1]||null,nextEvent:f,start:H,end:H+M,playout:{start:se,end:l},integrated:{start:K,end:d}};s.push(ne)}else M>0&&S&&(S.cumulativeDuration+=M,s[s.length-1].end=E)}x&&(U=N),f.timelineStart=N;const F=d;d+=_;const j=l;l+=A,s.push({event:f,start:N,end:U,playout:{start:j,end:l},integrated:{start:F,end:d}})}else return;const D=f.resumeTime;x||D>r?h=r:h=D}),h<r){var c;const f=h,p=d,v=r-h;d+=v;const x=l;l+=v,s.push({previousEvent:((c=s[s.length-1])==null?void 0:c.event)||null,nextEvent:null,start:h,end:f+v,playout:{start:x,end:l},integrated:{start:p,end:d}})}this.setDurations(r,l,d)}else s.push({previousEvent:null,nextEvent:null,start:0,end:r,playout:{start:0,end:r},integrated:{start:0,end:r}}),this.setDurations(r,r,r);return s}setDurations(e,t,s){this.durations={primary:e,playout:t,integrated:s}}resolveOffsets(e,t){const s=t.main.details,n=s.live?1/0:s.edge;let r=0,l=-1;e.forEach((c,h)=>{const d=c.cue.pre,f=c.cue.post,p=d?0:f?n:c.startTime;this.updateAssetDurations(c),l===p?c.cumulativeDuration=r:(r=0,l=p),!f&&c.snapOptions.in&&(c.resumeAnchor=La(null,s.fragments,c.startOffset+c.resumptionOffset,0,0)||void 0),c.appendInPlace&&!c.appendInPlaceStarted&&(this.primaryCanResumeInPlaceAt(c,t)||(c.appendInPlace=!1)),!c.appendInPlace&&h+1<e.length&&e[h+1].startTime-e[h].resumeTime<nx&&(e[h+1].appendInPlace=!1,e[h+1].appendInPlace&&this.warn(`Could not change append strategy for abutting event ${c}`));const x=Ce(c.resumeOffset)?c.resumeOffset:c.duration;r+=x})}primaryCanResumeInPlaceAt(e,t){const s=e.resumeTime,n=e.startTime+e.resumptionOffset;return Math.abs(s-n)>Ar?(this.log(`"${e.identifier}" resumption ${s} not aligned with estimated timeline end ${n}`),!1):!Object.keys(t).some(l=>{const c=t[l].details,h=c.edge;if(s>=h)return this.log(`"${e.identifier}" resumption ${s} past ${l} playlist end ${h}`),!1;const d=La(null,c.fragments,s);if(!d)return this.log(`"${e.identifier}" resumption ${s} does not align with any fragments in ${l} playlist (${c.fragStart}-${c.fragmentEnd})`),!0;const f=l==="audio"?.175:0;return Math.abs(d.start-s)<Ar+f||Math.abs(d.end-s)<Ar+f?!1:(this.log(`"${e.identifier}" resumption ${s} not aligned with ${l} fragment bounds (${d.start}-${d.end} sn: ${d.sn} cc: ${d.cc})`),!0)})}updateAssetDurations(e){if(!e.assetListLoaded)return;const t=e.timelineStart;let s=0,n=!1,r=!1;for(let l=0;l<e.assetList.length;l++){const c=e.assetList[l],h=t+s;c.startOffset=s,c.timelineStart=h,n||(n=c.duration===null),r||(r=!!c.error);const d=c.error?0:c.duration||0;s+=d}n&&!r?e.duration=Math.max(s,e.duration):e.duration=s}removeEvent(e){e.reset(),delete this.eventMap[e.identifier]}}function Li(i){return`[${i.event?'"'+i.event.identifier+'"':"primary"}: ${i.start.toFixed(2)}-${i.end.toFixed(2)}]`}class tN{constructor(e){this.hls=void 0,this.hls=e}destroy(){this.hls=null}loadAssetList(e,t){const s=e.assetListUrl;let n;try{n=Nb(s,this.hls.sessionId,e.baseUrl)}catch(v){const x=this.assignAssetListError(e,Q.ASSET_LIST_LOAD_ERROR,v,s);this.hls.trigger(L.ERROR,x);return}t&&n.protocol!=="data:"&&n.searchParams.set("_HLS_start_offset",""+t);const r=this.hls.config,l=r.loader,c=new l(r),h={responseType:"json",url:n.href},d=r.interstitialAssetListLoadPolicy.default,f={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},p={onSuccess:(v,x,S,T)=>{const E=v.data,A=E?.ASSETS;if(!Array.isArray(A)){const _=this.assignAssetListError(e,Q.ASSET_LIST_PARSING_ERROR,new Error("Invalid interstitial asset list"),S.url,x,T);this.hls.trigger(L.ERROR,_);return}e.assetListResponse=E,this.hls.trigger(L.ASSET_LIST_LOADED,{event:e,assetListResponse:E,networkDetails:T})},onError:(v,x,S,T)=>{const E=this.assignAssetListError(e,Q.ASSET_LIST_LOAD_ERROR,new Error(`Error loading X-ASSET-LIST: HTTP status ${v.code} ${v.text} (${x.url})`),x.url,T,S);this.hls.trigger(L.ERROR,E)},onTimeout:(v,x,S)=>{const T=this.assignAssetListError(e,Q.ASSET_LIST_LOAD_TIMEOUT,new Error(`Timeout loading X-ASSET-LIST (${x.url})`),x.url,v,S);this.hls.trigger(L.ERROR,T)}};return c.load(h,f,p),this.hls.trigger(L.ASSET_LIST_LOADING,{event:e}),c}assignAssetListError(e,t,s,n,r,l){return e.error=s,{type:je.NETWORK_ERROR,details:t,fatal:!1,interstitial:e,url:n,error:s,networkDetails:l,stats:r}}}function ax(i){var e;i==null||(e=i.play())==null||e.catch(()=>{})}function Ec(i,e){return`[${i}] Advancing timeline position to ${e}`}class sN extends Ti{constructor(e,t){super("interstitials",e.logger),this.HlsPlayerClass=void 0,this.hls=void 0,this.assetListLoader=void 0,this.mediaSelection=null,this.altSelection=null,this.media=null,this.detachedData=null,this.requiredTracks=null,this.manager=null,this.playerQueue=[],this.bufferedPos=-1,this.timelinePos=-1,this.schedule=void 0,this.playingItem=null,this.bufferingItem=null,this.waitingItem=null,this.endedItem=null,this.playingAsset=null,this.endedAsset=null,this.bufferingAsset=null,this.shouldPlay=!1,this.onPlay=()=>{this.shouldPlay=!0},this.onPause=()=>{this.shouldPlay=!1},this.onSeeking=()=>{const s=this.currentTime;if(s===void 0||this.playbackDisabled||!this.schedule)return;const n=s-this.timelinePos;if(Math.abs(n)<1/7056e5)return;const l=n<=-.01;this.timelinePos=s,this.bufferedPos=s;const c=this.playingItem;if(!c){this.checkBuffer();return}if(l&&this.schedule.resetErrorsInRange(s,s-n)&&this.updateSchedule(!0),this.checkBuffer(),l&&s<c.start||s>=c.end){var h;const x=this.findItemIndex(c);let S=this.schedule.findItemIndexAtTime(s);if(S===-1&&(S=x+(l?-1:1),this.log(`seeked ${l?"back ":""}to position not covered by schedule ${s} (resolving from ${x} to ${S})`)),!this.isInterstitial(c)&&(h=this.media)!=null&&h.paused&&(this.shouldPlay=!1),!l&&S>x){const T=this.schedule.findJumpRestrictedIndex(x+1,S);if(T>x){this.setSchedulePosition(T);return}}this.setSchedulePosition(S);return}const d=this.playingAsset;if(!d){if(this.playingLastItem&&this.isInterstitial(c)){const x=c.event.assetList[0];x&&(this.endedItem=this.playingItem,this.playingItem=null,this.setScheduleToAssetAtTime(s,x))}return}const f=d.timelineStart,p=d.duration||0;if(l&&s<f||s>=f+p){var v;(v=c.event)!=null&&v.appendInPlace&&(this.clearAssetPlayers(c.event,c),this.flushFrontBuffer(s)),this.setScheduleToAssetAtTime(s,d)}},this.onTimeupdate=()=>{const s=this.currentTime;if(s===void 0||this.playbackDisabled)return;if(s>this.timelinePos)this.timelinePos=s,s>this.bufferedPos&&this.checkBuffer();else return;const n=this.playingItem;if(!n||this.playingLastItem)return;if(s>=n.end){this.timelinePos=n.end;const c=this.findItemIndex(n);this.setSchedulePosition(c+1)}const r=this.playingAsset;if(!r)return;const l=r.timelineStart+(r.duration||0);s>=l&&this.setScheduleToAssetAtTime(s,r)},this.onScheduleUpdate=(s,n)=>{const r=this.schedule;if(!r)return;const l=this.playingItem,c=r.events||[],h=r.items||[],d=r.durations,f=s.map(T=>T.identifier),p=!!(c.length||f.length);(p||n)&&this.log(`INTERSTITIALS_UPDATED (${c.length}): ${c}
Schedule: ${h.map(T=>Li(T))} pos: ${this.timelinePos}`),f.length&&this.log(`Removed events ${f}`);let v=null,x=null;l&&(v=this.updateItem(l,this.timelinePos),this.itemsMatch(l,v)?this.playingItem=v:this.waitingItem=this.endedItem=null),this.waitingItem=this.updateItem(this.waitingItem),this.endedItem=this.updateItem(this.endedItem);const S=this.bufferingItem;if(S&&(x=this.updateItem(S,this.bufferedPos),this.itemsMatch(S,x)?this.bufferingItem=x:S.event&&(this.bufferingItem=this.playingItem,this.clearInterstitial(S.event,null))),s.forEach(T=>{T.assetList.forEach(E=>{this.clearAssetPlayer(E.identifier,null)})}),this.playerQueue.forEach(T=>{if(T.interstitial.appendInPlace){const E=T.assetItem.timelineStart,A=T.timelineOffset-E;if(A)try{T.timelineOffset=E}catch(_){Math.abs(A)>Ar&&this.warn(`${_} ("${T.assetId}" ${T.timelineOffset}->${E})`)}}}),p||n){if(this.hls.trigger(L.INTERSTITIALS_UPDATED,{events:c.slice(0),schedule:h.slice(0),durations:d,removedIds:f}),this.isInterstitial(l)&&f.includes(l.event.identifier)){this.warn(`Interstitial "${l.event.identifier}" removed while playing`),this.primaryFallback(l.event);return}l&&this.trimInPlace(v,l),S&&x!==v&&this.trimInPlace(x,S),this.checkBuffer()}},this.hls=e,this.HlsPlayerClass=t,this.assetListLoader=new tN(e),this.schedule=new eN(this.onScheduleUpdate,e.logger),this.registerListeners()}registerListeners(){const e=this.hls;e&&(e.on(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(L.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(L.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.on(L.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(L.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.on(L.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.on(L.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.on(L.BUFFER_APPENDED,this.onBufferAppended,this),e.on(L.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(L.BUFFERED_TO_END,this.onBufferedToEnd,this),e.on(L.MEDIA_ENDED,this.onMediaEnded,this),e.on(L.ERROR,this.onError,this),e.on(L.DESTROYING,this.onDestroying,this))}unregisterListeners(){const e=this.hls;e&&(e.off(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(L.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(L.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.off(L.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(L.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.off(L.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.off(L.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.off(L.BUFFER_CODECS,this.onBufferCodecs,this),e.off(L.BUFFER_APPENDED,this.onBufferAppended,this),e.off(L.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(L.BUFFERED_TO_END,this.onBufferedToEnd,this),e.off(L.MEDIA_ENDED,this.onMediaEnded,this),e.off(L.ERROR,this.onError,this),e.off(L.DESTROYING,this.onDestroying,this))}startLoad(){this.resumeBuffering()}stopLoad(){this.pauseBuffering()}resumeBuffering(){var e;(e=this.getBufferingPlayer())==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.getBufferingPlayer())==null||e.pauseBuffering()}destroy(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.schedule=this.manager=null,this.hls=this.HlsPlayerClass=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null}onDestroying(){const e=this.primaryMedia||this.media;e&&this.removeMediaListeners(e)}removeMediaListeners(e){$s(e,"play",this.onPlay),$s(e,"pause",this.onPause),$s(e,"seeking",this.onSeeking),$s(e,"timeupdate",this.onTimeupdate)}onMediaAttaching(e,t){const s=this.media=t.media;Cs(s,"seeking",this.onSeeking),Cs(s,"timeupdate",this.onTimeupdate),Cs(s,"play",this.onPlay),Cs(s,"pause",this.onPause)}onMediaAttached(e,t){const s=this.effectivePlayingItem,n=this.detachedData;if(this.detachedData=null,s===null)this.checkStart();else if(!n){this.clearScheduleState();const r=this.findItemIndex(s);this.setSchedulePosition(r)}}clearScheduleState(){this.log("clear schedule state"),this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null}onMediaDetaching(e,t){const s=!!t.transferMedia,n=this.media;if(this.media=null,!s&&(n&&this.removeMediaListeners(n),this.detachedData)){const r=this.getBufferingPlayer();r&&(this.log(`Removing schedule state for detachedData and ${r}`),this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,r.detachMedia()),this.shouldPlay=!1}}get interstitialsManager(){if(!this.hls)return null;if(this.manager)return this.manager;const e=this,t=()=>e.bufferingItem||e.waitingItem,s=p=>p&&e.getAssetPlayer(p.identifier),n=(p,v,x,S,T)=>{if(p){let E=p[v].start;const A=p.event;if(A){if(v==="playout"||A.timelineOccupancy!==su.Point){const _=s(x);_?.interstitial===A&&(E+=_.assetItem.startOffset+_[T])}}else{const _=S==="bufferedPos"?l():e[S];E+=_-p.start}return E}return 0},r=(p,v)=>{var x;if(p!==0&&v!=="primary"&&(x=e.schedule)!=null&&x.length){var S;const T=e.schedule.findItemIndexAtTime(p),E=(S=e.schedule.items)==null?void 0:S[T];if(E){const A=E[v].start-E.start;return p+A}}return p},l=()=>{const p=e.bufferedPos;return p===Number.MAX_VALUE?c("primary"):Math.max(p,0)},c=p=>{var v,x;return(v=e.primaryDetails)!=null&&v.live?e.primaryDetails.edge:((x=e.schedule)==null?void 0:x.durations[p])||0},h=(p,v)=>{var x,S;const T=e.effectivePlayingItem;if(T!=null&&(x=T.event)!=null&&x.restrictions.skip||!e.schedule)return;e.log(`seek to ${p} "${v}"`);const E=e.effectivePlayingItem,A=e.schedule.findItemIndexAtTime(p,v),_=(S=e.schedule.items)==null?void 0:S[A],R=e.getBufferingPlayer(),w=R?.interstitial,N=w?.appendInPlace,U=E&&e.itemsMatch(E,_);if(E&&(N||U)){const D=s(e.playingAsset),F=D?.media||e.primaryMedia;if(F){const j=v==="primary"?F.currentTime:n(E,v,e.playingAsset,"timelinePos","currentTime"),M=p-j,H=(N?j:F.currentTime)+M;if(H>=0&&(!D||N||H<=D.duration)){F.currentTime=H;return}}}if(_){let D=p;if(v!=="primary"){const j=_[v].start,M=p-j;D=_.start+M}const F=!e.isInterstitial(_);if((!e.isInterstitial(E)||E.event.appendInPlace)&&(F||_.event.appendInPlace)){const j=e.media||(N?R?.media:null);j&&(j.currentTime=D)}else if(E){const j=e.findItemIndex(E);if(A>j){const H=e.schedule.findJumpRestrictedIndex(j+1,A);if(H>j){e.setSchedulePosition(H);return}}let M=0;if(F)e.timelinePos=D,e.checkBuffer();else{const H=_.event.assetList,K=p-(_[v]||_).start;for(let se=H.length;se--;){const ne=H[se];if(ne.duration&&K>=ne.startOffset&&K<ne.startOffset+ne.duration){M=se;break}}}e.setSchedulePosition(A,M)}}},d=()=>{const p=e.effectivePlayingItem;if(e.isInterstitial(p))return p;const v=t();return e.isInterstitial(v)?v:null},f={get bufferedEnd(){const p=t(),v=e.bufferingItem;if(v&&v===p){var x;return n(v,"playout",e.bufferingAsset,"bufferedPos","bufferedEnd")-v.playout.start||((x=e.bufferingAsset)==null?void 0:x.startOffset)||0}return 0},get currentTime(){const p=d(),v=e.effectivePlayingItem;return v&&v===p?n(v,"playout",e.effectivePlayingAsset,"timelinePos","currentTime")-v.playout.start:0},set currentTime(p){const v=d(),x=e.effectivePlayingItem;x&&x===v&&h(p+x.playout.start,"playout")},get duration(){const p=d();return p?p.playout.end-p.playout.start:0},get assetPlayers(){var p;const v=(p=d())==null?void 0:p.event.assetList;return v?v.map(x=>e.getAssetPlayer(x.identifier)):[]},get playingIndex(){var p;const v=(p=d())==null?void 0:p.event;return v&&e.effectivePlayingAsset?v.findAssetIndex(e.effectivePlayingAsset):-1},get scheduleItem(){return d()}};return this.manager={get events(){var p;return((p=e.schedule)==null||(p=p.events)==null?void 0:p.slice(0))||[]},get schedule(){var p;return((p=e.schedule)==null||(p=p.items)==null?void 0:p.slice(0))||[]},get interstitialPlayer(){return d()?f:null},get playerQueue(){return e.playerQueue.slice(0)},get bufferingAsset(){return e.bufferingAsset},get bufferingItem(){return t()},get bufferingIndex(){const p=t();return e.findItemIndex(p)},get playingAsset(){return e.effectivePlayingAsset},get playingItem(){return e.effectivePlayingItem},get playingIndex(){const p=e.effectivePlayingItem;return e.findItemIndex(p)},primary:{get bufferedEnd(){return l()},get currentTime(){const p=e.timelinePos;return p>0?p:0},set currentTime(p){h(p,"primary")},get duration(){return c("primary")},get seekableStart(){var p;return((p=e.primaryDetails)==null?void 0:p.fragmentStart)||0}},integrated:{get bufferedEnd(){return n(t(),"integrated",e.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return n(e.effectivePlayingItem,"integrated",e.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(p){h(p,"integrated")},get duration(){return c("integrated")},get seekableStart(){var p;return r(((p=e.primaryDetails)==null?void 0:p.fragmentStart)||0,"integrated")}},skip:()=>{const p=e.effectivePlayingItem,v=p?.event;if(v&&!v.restrictions.skip){const x=e.findItemIndex(p);if(v.appendInPlace){const S=p.playout.start+p.event.duration;h(S+.001,"playout")}else e.advanceAfterAssetEnded(v,x,1/0)}}}}get effectivePlayingItem(){return this.waitingItem||this.playingItem||this.endedItem}get effectivePlayingAsset(){return this.playingAsset||this.endedAsset}get playingLastItem(){var e;const t=this.playingItem,s=(e=this.schedule)==null?void 0:e.items;return!this.playbackStarted||!t||!s?!1:this.findItemIndex(t)===s.length-1}get playbackStarted(){return this.effectivePlayingItem!==null}get currentTime(){var e,t;if(this.mediaSelection===null)return;const s=this.waitingItem||this.playingItem;if(this.isInterstitial(s)&&!s.event.appendInPlace)return;let n=this.media;!n&&(e=this.bufferingItem)!=null&&(e=e.event)!=null&&e.appendInPlace&&(n=this.primaryMedia);const r=(t=n)==null?void 0:t.currentTime;if(!(r===void 0||!Ce(r)))return r}get primaryMedia(){var e;return this.media||((e=this.detachedData)==null?void 0:e.media)||null}isInterstitial(e){return!!(e!=null&&e.event)}retreiveMediaSource(e,t){const s=this.getAssetPlayer(e);s&&this.transferMediaFromPlayer(s,t)}transferMediaFromPlayer(e,t){const s=e.interstitial.appendInPlace,n=e.media;if(s&&n===this.primaryMedia){if(this.bufferingAsset=null,(!t||this.isInterstitial(t)&&!t.event.appendInPlace)&&t&&n){this.detachedData={media:n};return}const r=e.transferMedia();this.log(`transfer MediaSource from ${e} ${Ot(r)}`),this.detachedData=r}else t&&n&&(this.shouldPlay||(this.shouldPlay=!n.paused))}transferMediaTo(e,t){var s,n;if(e.media===t)return;let r=null;const l=this.hls,c=e!==l,h=c&&e.interstitial.appendInPlace,d=(s=this.detachedData)==null?void 0:s.mediaSource;let f;if(l.media)h&&(r=l.transferMedia(),this.detachedData=r),f="Primary";else if(d){const S=this.getBufferingPlayer();S?(r=S.transferMedia(),f=`${S}`):f="detached MediaSource"}else f="detached media";if(!r){if(d)r=this.detachedData,this.log(`using detachedData: MediaSource ${Ot(r)}`);else if(!this.detachedData||l.media===t){const S=this.playerQueue;S.length>1&&S.forEach(T=>{if(c&&T.interstitial.appendInPlace!==h){const E=T.interstitial;this.clearInterstitial(T.interstitial,null),E.appendInPlace=!1,E.appendInPlace&&this.warn(`Could not change append strategy for queued assets ${E}`)}}),this.hls.detachMedia(),this.detachedData={media:t}}}const p=r&&"mediaSource"in r&&((n=r.mediaSource)==null?void 0:n.readyState)!=="closed",v=p&&r?r:t;this.log(`${p?"transfering MediaSource":"attaching media"} to ${c?e:"Primary"} from ${f} (media.currentTime: ${t.currentTime})`);const x=this.schedule;if(v===r&&x){const S=c&&e.assetId===x.assetIdAtEnd;v.overrides={duration:x.duration,endOfStream:!c||S,cueRemoval:!c}}e.attachMedia(v)}onInterstitialCueEnter(){this.onTimeupdate()}checkStart(){const e=this.schedule,t=e?.events;if(!t||this.playbackDisabled||!this.media)return;this.bufferedPos===-1&&(this.bufferedPos=0);const s=this.timelinePos,n=this.effectivePlayingItem;if(s===-1){const r=this.hls.startPosition;if(this.log(Ec("checkStart",r)),this.timelinePos=r,t.length&&t[0].cue.pre){const l=e.findEventIndex(t[0].identifier);this.setSchedulePosition(l)}else if(r>=0||!this.primaryLive){const l=this.timelinePos=r>0?r:0,c=e.findItemIndexAtTime(l);this.setSchedulePosition(c)}}else if(n&&!this.playingItem){const r=e.findItemIndex(n);this.setSchedulePosition(r)}}advanceAssetBuffering(e,t){const s=e.event,n=s.findAssetIndex(t),r=Zh(s,n);if(!s.isAssetPastPlayoutLimit(r))this.bufferedToEvent(e,r);else if(this.schedule){var l;const c=(l=this.schedule.items)==null?void 0:l[this.findItemIndex(e)+1];c&&this.bufferedToItem(c)}}advanceAfterAssetEnded(e,t,s){const n=Zh(e,s);if(e.isAssetPastPlayoutLimit(n)){if(this.schedule){const r=this.schedule.items;if(r){const l=t+1,c=r.length;if(l>=c){this.setSchedulePosition(-1);return}const h=e.resumeTime;this.timelinePos<h&&(this.log(Ec("advanceAfterAssetEnded",h)),this.timelinePos=h,e.appendInPlace&&this.advanceInPlace(h),this.checkBuffer(this.bufferedPos<h)),this.setSchedulePosition(l)}}}else{if(e.appendInPlace){const r=e.assetList[n];r&&this.advanceInPlace(r.timelineStart)}this.setSchedulePosition(t,n)}}setScheduleToAssetAtTime(e,t){const s=this.schedule;if(!s)return;const n=t.parentIdentifier,r=s.getEvent(n);if(r){const l=s.findEventIndex(n),c=s.findAssetIndex(r,e);this.advanceAfterAssetEnded(r,l,c-1)}}setSchedulePosition(e,t){var s;const n=(s=this.schedule)==null?void 0:s.items;if(!n||this.playbackDisabled)return;const r=e>=0?n[e]:null;this.log(`setSchedulePosition ${e}, ${t} (${r&&Li(r)}) pos: ${this.timelinePos}`);const l=this.waitingItem||this.playingItem,c=this.playingLastItem;if(this.isInterstitial(l)){const f=l.event,p=this.playingAsset,v=p?.identifier,x=v?this.getAssetPlayer(v):null;if(x&&v&&(!this.eventItemsMatch(l,r)||t!==void 0&&v!==f.assetList[t].identifier)){var h;const S=f.findAssetIndex(p);if(this.log(`INTERSTITIAL_ASSET_ENDED ${S+1}/${f.assetList.length} ${xr(p)}`),this.endedAsset=p,this.playingAsset=null,this.hls.trigger(L.INTERSTITIAL_ASSET_ENDED,{asset:p,assetListIndex:S,event:f,schedule:n.slice(0),scheduleIndex:e,player:x}),l!==this.playingItem){this.itemsMatch(l,this.playingItem)&&!this.playingAsset&&this.advanceAfterAssetEnded(f,this.findItemIndex(this.playingItem),S);return}this.retreiveMediaSource(v,r),x.media&&!((h=this.detachedData)!=null&&h.mediaSource)&&x.detachMedia()}if(!this.eventItemsMatch(l,r)&&(this.endedItem=l,this.playingItem=null,this.log(`INTERSTITIAL_ENDED ${f} ${Li(l)}`),f.hasPlayed=!0,this.hls.trigger(L.INTERSTITIAL_ENDED,{event:f,schedule:n.slice(0),scheduleIndex:e}),f.cue.once)){var d;this.updateSchedule();const S=(d=this.schedule)==null?void 0:d.items;if(r&&S){const T=this.findItemIndex(r);this.advanceSchedule(T,S,t,l,c)}return}}this.advanceSchedule(e,n,t,l,c)}advanceSchedule(e,t,s,n,r){const l=this.schedule;if(!l)return;const c=t[e]||null,h=this.primaryMedia,d=this.playerQueue;if(d.length&&d.forEach(f=>{const p=f.interstitial,v=l.findEventIndex(p.identifier);(v<e||v>e+1)&&this.clearInterstitial(p,c)}),this.isInterstitial(c)){this.timelinePos=Math.min(Math.max(this.timelinePos,c.start),c.end);const f=c.event;if(s===void 0){s=l.findAssetIndex(f,this.timelinePos);const S=Zh(f,s-1);if(f.isAssetPastPlayoutLimit(S)||f.appendInPlace&&this.timelinePos===c.end){this.advanceAfterAssetEnded(f,e,s);return}s=S}const p=this.waitingItem;this.assetsBuffered(c,h)||this.setBufferingItem(c);let v=this.preloadAssets(f,s);if(this.eventItemsMatch(c,p||n)||(this.waitingItem=c,this.log(`INTERSTITIAL_STARTED ${Li(c)} ${f.appendInPlace?"append in place":""}`),this.hls.trigger(L.INTERSTITIAL_STARTED,{event:f,schedule:t.slice(0),scheduleIndex:e})),!f.assetListLoaded){this.log(`Waiting for ASSET-LIST to complete loading ${f}`);return}if(f.assetListLoader&&(f.assetListLoader.destroy(),f.assetListLoader=void 0),!h){this.log(`Waiting for attachMedia to start Interstitial ${f}`);return}this.waitingItem=this.endedItem=null,this.playingItem=c;const x=f.assetList[s];if(!x){this.advanceAfterAssetEnded(f,e,s||0);return}if(v||(v=this.getAssetPlayer(x.identifier)),v===null||v.destroyed){const S=f.assetList.length;this.warn(`asset ${s+1}/${S} player destroyed ${f}`),v=this.createAssetPlayer(f,x,s),v.loadSource()}if(!this.eventItemsMatch(c,this.bufferingItem)&&f.appendInPlace&&this.isAssetBuffered(x))return;this.startAssetPlayer(v,s,t,e,h),this.shouldPlay&&ax(v.media)}else c?(this.resumePrimary(c,e,n),this.shouldPlay&&ax(this.hls.media)):r&&this.isInterstitial(n)&&(this.endedItem=null,this.playingItem=n,n.event.appendInPlace||this.attachPrimary(l.durations.primary,null))}get playbackDisabled(){return this.hls.config.enableInterstitialPlayback===!1}get primaryDetails(){var e;return(e=this.mediaSelection)==null?void 0:e.main.details}get primaryLive(){var e;return!!((e=this.primaryDetails)!=null&&e.live)}resumePrimary(e,t,s){var n,r;if(this.playingItem=e,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(e),this.log(`resuming ${Li(e)}`),!((n=this.detachedData)!=null&&n.mediaSource)){let c=this.timelinePos;(c<e.start||c>=e.end)&&(c=this.getPrimaryResumption(e,t),this.log(Ec("resumePrimary",c)),this.timelinePos=c),this.attachPrimary(c,e)}if(!s)return;const l=(r=this.schedule)==null?void 0:r.items;l&&(this.log(`INTERSTITIALS_PRIMARY_RESUMED ${Li(e)}`),this.hls.trigger(L.INTERSTITIALS_PRIMARY_RESUMED,{schedule:l.slice(0),scheduleIndex:t}),this.checkBuffer())}getPrimaryResumption(e,t){const s=e.start;if(this.primaryLive){const n=this.primaryDetails;if(t===0)return this.hls.startPosition;if(n&&(s<n.fragmentStart||s>n.edge))return this.hls.liveSyncPosition||-1}return s}isAssetBuffered(e){const t=this.getAssetPlayer(e.identifier);return t!=null&&t.hls?t.hls.bufferedToEnd:qe.bufferInfo(this.primaryMedia,this.timelinePos,0).end+1>=e.timelineStart+(e.duration||0)}attachPrimary(e,t,s){t?this.setBufferingItem(t):this.bufferingItem=this.playingItem,this.bufferingAsset=null;const n=this.primaryMedia;if(!n)return;const r=this.hls;r.media?this.checkBuffer():(this.transferMediaTo(r,n),s&&this.startLoadingPrimaryAt(e,s)),s||(this.log(Ec("attachPrimary",e)),this.timelinePos=e,this.startLoadingPrimaryAt(e,s))}startLoadingPrimaryAt(e,t){var s;const n=this.hls;!n.loadingEnabled||!n.media||Math.abs((((s=n.mainForwardBufferInfo)==null?void 0:s.start)||n.media.currentTime)-e)>.5?n.startLoad(e,t):n.bufferingEnabled||n.resumeBuffering()}onManifestLoading(){var e;this.stopLoad(),(e=this.schedule)==null||e.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off(L.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on(L.BUFFER_CODECS,this.onBufferCodecs,this)}onLevelUpdated(e,t){if(t.level===-1||!this.schedule)return;const s=this.hls.levels[t.level];if(!s.details)return;const n=vt(vt({},this.mediaSelection||this.altSelection),{},{main:s});this.mediaSelection=n,this.schedule.parseInterstitialDateRanges(n,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}onAudioTrackUpdated(e,t){const s=this.hls.audioTracks[t.id],n=this.mediaSelection;if(!n){this.altSelection=vt(vt({},this.altSelection),{},{audio:s});return}const r=vt(vt({},n),{},{audio:s});this.mediaSelection=r}onSubtitleTrackUpdated(e,t){const s=this.hls.subtitleTracks[t.id],n=this.mediaSelection;if(!n){this.altSelection=vt(vt({},this.altSelection),{},{subtitles:s});return}const r=vt(vt({},n),{},{subtitles:s});this.mediaSelection=r}onAudioTrackSwitching(e,t){const s=my(t);this.playerQueue.forEach(({hls:n})=>n&&(n.setAudioOption(t)||n.setAudioOption(s)))}onSubtitleTrackSwitch(e,t){const s=my(t);this.playerQueue.forEach(({hls:n})=>n&&(n.setSubtitleOption(t)||t.id!==-1&&n.setSubtitleOption(s)))}onBufferCodecs(e,t){const s=t.tracks;s&&(this.requiredTracks=s)}onBufferAppended(e,t){this.checkBuffer()}onBufferFlushed(e,t){const s=this.playingItem;if(s&&!this.itemsMatch(s,this.bufferingItem)&&!this.isInterstitial(s)){const n=this.timelinePos;this.bufferedPos=n,this.checkBuffer()}}onBufferedToEnd(e){if(!this.schedule)return;const t=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&t){for(let n=0;n<t.length;n++){const r=t[n];if(r.cue.post){var s;const l=this.schedule.findEventIndex(r.identifier),c=(s=this.schedule.items)==null?void 0:s[l];this.isInterstitial(c)&&this.eventItemsMatch(c,this.bufferingItem)&&this.bufferedToItem(c,0);break}}this.bufferedPos=Number.MAX_VALUE}}onMediaEnded(e){const t=this.playingItem;if(!this.playingLastItem&&t){const s=this.findItemIndex(t);this.setSchedulePosition(s+1)}else this.shouldPlay=!1}updateItem(e,t){var s;const n=(s=this.schedule)==null?void 0:s.items;if(e&&n){const r=this.findItemIndex(e,t);return n[r]||null}return null}trimInPlace(e,t){if(this.isInterstitial(e)&&e.event.appendInPlace&&t.end-e.end>.25){e.event.assetList.forEach((r,l)=>{e.event.isAssetPastPlayoutLimit(l)&&this.clearAssetPlayer(r.identifier,null)});const s=e.end+.25,n=qe.bufferInfo(this.primaryMedia,s,0);(n.end>s||(n.nextStart||0)>s)&&(this.log(`trim buffered interstitial ${Li(e)} (was ${Li(t)})`),this.attachPrimary(s,null,!0),this.flushFrontBuffer(s))}}itemsMatch(e,t){return!!t&&(e===t||e.event&&t.event&&this.eventItemsMatch(e,t)||!e.event&&!t.event&&this.findItemIndex(e)===this.findItemIndex(t))}eventItemsMatch(e,t){var s;return!!t&&(e===t||e.event.identifier===((s=t.event)==null?void 0:s.identifier))}findItemIndex(e,t){return e&&this.schedule?this.schedule.findItemIndex(e,t):-1}updateSchedule(e=!1){var t;const s=this.mediaSelection;s&&((t=this.schedule)==null||t.updateSchedule(s,[],e))}checkBuffer(e){var t;const s=(t=this.schedule)==null?void 0:t.items;if(!s)return;const n=qe.bufferInfo(this.primaryMedia,this.timelinePos,0);e&&(this.bufferedPos=this.timelinePos),e||(e=n.len<1),this.updateBufferedPos(n.end,s,e)}updateBufferedPos(e,t,s){const n=this.schedule,r=this.bufferingItem;if(this.bufferedPos>e||!n)return;if(t.length===1&&this.itemsMatch(t[0],r)){this.bufferedPos=e;return}const l=this.playingItem,c=this.findItemIndex(l);let h=n.findItemIndexAtTime(e);if(this.bufferedPos<e){var d;const f=this.findItemIndex(r),p=Math.min(f+1,t.length-1),v=t[p];if((h===-1&&r&&e>=r.end||(d=v.event)!=null&&d.appendInPlace&&e+.01>=v.start)&&(h=p),this.isInterstitial(r)){const x=r.event;if(p-c>1&&x.appendInPlace===!1||x.assetList.length===0&&x.assetListLoader)return}if(this.bufferedPos=e,h>f&&h>c)this.bufferedToItem(v);else{const x=this.primaryDetails;this.primaryLive&&x&&e>x.edge-x.targetduration&&v.start<x.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(v)&&this.preloadAssets(v.event,0)}}else s&&l&&!this.itemsMatch(l,r)&&(h===c?this.bufferedToItem(l):h===c+1&&this.bufferedToItem(t[h]))}assetsBuffered(e,t){return e.event.assetList.length===0?!1:!e.event.assetList.some(n=>{const r=this.getAssetPlayer(n.identifier);return!(r!=null&&r.bufferedInPlaceToEnd(t))})}setBufferingItem(e){const t=this.bufferingItem,s=this.schedule;if(!this.itemsMatch(e,t)&&s){const{items:n,events:r}=s;if(!n||!r)return t;const l=this.isInterstitial(e),c=this.getBufferingPlayer();this.bufferingItem=e,this.bufferedPos=Math.max(e.start,Math.min(e.end,this.timelinePos));const h=c?c.remaining:t?t.end-this.timelinePos:0;if(this.log(`INTERSTITIALS_BUFFERED_TO_BOUNDARY ${Li(e)}`+(t?` (${h.toFixed(2)} remaining)`:"")),!this.playbackDisabled)if(l){const d=s.findAssetIndex(e.event,this.bufferedPos);e.event.assetList.forEach((f,p)=>{const v=this.getAssetPlayer(f.identifier);v&&(p===d&&v.loadSource(),v.resumeBuffering())})}else this.hls.resumeBuffering(),this.playerQueue.forEach(d=>d.pauseBuffering());this.hls.trigger(L.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:r.slice(0),schedule:n.slice(0),bufferingIndex:this.findItemIndex(e),playingIndex:this.findItemIndex(this.playingItem)})}else this.bufferingItem!==e&&(this.bufferingItem=e);return t}bufferedToItem(e,t=0){const s=this.setBufferingItem(e);if(!this.playbackDisabled){if(this.isInterstitial(e))this.bufferedToEvent(e,t);else if(s!==null){this.bufferingAsset=null;const n=this.detachedData;n?n.mediaSource?this.attachPrimary(e.start,e,!0):this.preloadPrimary(e):this.preloadPrimary(e)}}}preloadPrimary(e){const t=this.findItemIndex(e),s=this.getPrimaryResumption(e,t);this.startLoadingPrimaryAt(s)}bufferedToEvent(e,t){const s=e.event,n=s.assetList.length===0&&!s.assetListLoader,r=s.cue.once;if(n||!r){const l=this.preloadAssets(s,t);if(l!=null&&l.interstitial.appendInPlace){const c=this.primaryMedia;c&&this.bufferAssetPlayer(l,c)}}}preloadAssets(e,t){const s=e.assetUrl,n=e.assetList.length,r=n===0&&!e.assetListLoader,l=e.cue.once;if(r){const h=e.timelineStart;if(e.appendInPlace){var c;const v=this.playingItem;!this.isInterstitial(v)&&(v==null||(c=v.nextEvent)==null?void 0:c.identifier)===e.identifier&&this.flushFrontBuffer(h+.25)}let d,f=0;if(!this.playingItem&&this.primaryLive&&(f=this.hls.startPosition,f===-1&&(f=this.hls.liveSyncPosition||0)),f&&!(e.cue.pre||e.cue.post)){const v=f-h;v>0&&(d=Math.round(v*1e3)/1e3)}if(this.log(`Load interstitial asset ${t+1}/${s?1:n} ${e}${d?` live-start: ${f} start-offset: ${d}`:""}`),s)return this.createAsset(e,0,0,h,e.duration,s);const p=this.assetListLoader.loadAssetList(e,d);p&&(e.assetListLoader=p)}else if(!l&&n){for(let d=t;d<n;d++){const f=e.assetList[d],p=this.getAssetPlayerQueueIndex(f.identifier);(p===-1||this.playerQueue[p].destroyed)&&!f.error&&this.createAssetPlayer(e,f,d)}const h=e.assetList[t];if(h){const d=this.getAssetPlayer(h.identifier);return d&&d.loadSource(),d}}return null}flushFrontBuffer(e){const t=this.requiredTracks;if(!t)return;this.log(`Removing front buffer starting at ${e}`),Object.keys(t).forEach(n=>{this.hls.trigger(L.BUFFER_FLUSHING,{startOffset:e,endOffset:1/0,type:n})})}getAssetPlayerQueueIndex(e){const t=this.playerQueue;for(let s=0;s<t.length;s++)if(e===t[s].assetId)return s;return-1}getAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);return this.playerQueue[t]||null}getBufferingPlayer(){const{playerQueue:e,primaryMedia:t}=this;if(t){for(let s=0;s<e.length;s++)if(e[s].media===t)return e[s]}return null}createAsset(e,t,s,n,r,l){const c={parentIdentifier:e.identifier,identifier:XO(e,l,t),duration:r,startOffset:s,timelineStart:n,uri:l};return this.createAssetPlayer(e,c,t)}createAssetPlayer(e,t,s){const n=this.hls,r=n.userConfig;let l=r.videoPreference;const c=n.loadLevelObj||n.levels[n.currentLevel];(l||c)&&(l=At({},l),c.videoCodec&&(l.videoCodec=c.videoCodec),c.videoRange&&(l.allowedVideoRanges=[c.videoRange]));const h=n.audioTracks[n.audioTrack],d=n.subtitleTracks[n.subtitleTrack];let f=0;if(this.primaryLive||e.appendInPlace){const w=this.timelinePos-t.timelineStart;if(w>1){const N=t.duration;N&&w<N&&(f=w)}}const p=t.identifier,v=vt(vt({},r),{},{maxMaxBufferLength:Math.min(180,n.config.maxMaxBufferLength),autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:n.sessionId,assetPlayerId:p,abrEwmaDefaultEstimate:n.bandwidthEstimate,interstitialsController:void 0,startPosition:f,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:l,audioPreference:h||r.audioPreference,subtitlePreference:d||r.subtitlePreference});e.appendInPlace&&(e.appendInPlaceStarted=!0,t.timelineStart&&(v.timelineOffset=t.timelineStart));const x=v.cmcd;x!=null&&x.sessionId&&x.contentId&&(v.cmcd=At({},x,{contentId:Ol(t.uri)})),this.getAssetPlayer(p)&&this.warn(`Duplicate date range identifier ${e} and asset ${p}`);const S=new JO(this.HlsPlayerClass,v,e,t);this.playerQueue.push(S),e.assetList[s]=t;let T=!0;const E=w=>{if(w.live){var N;const F=new Error(`Interstitials MUST be VOD assets ${e}`),j={fatal:!0,type:je.OTHER_ERROR,details:Q.INTERSTITIAL_ASSET_ITEM_ERROR,error:F},M=((N=this.schedule)==null?void 0:N.findEventIndex(e.identifier))||-1;this.handleAssetItemError(j,e,M,s,F.message);return}const U=w.edge-w.fragmentStart,D=t.duration;(T||D===null||U>D)&&(T=!1,this.log(`Interstitial asset "${p}" duration change ${D} > ${U}`),t.duration=U,this.updateSchedule())};S.on(L.LEVEL_UPDATED,(w,{details:N})=>E(N)),S.on(L.LEVEL_PTS_UPDATED,(w,{details:N})=>E(N)),S.on(L.EVENT_CUE_ENTER,()=>this.onInterstitialCueEnter());const A=(w,N)=>{const U=this.getAssetPlayer(p);if(U&&N.tracks){U.off(L.BUFFER_CODECS,A),U.tracks=N.tracks;const D=this.primaryMedia;this.bufferingAsset===U.assetItem&&D&&!U.media&&this.bufferAssetPlayer(U,D)}};S.on(L.BUFFER_CODECS,A);const _=()=>{var w;const N=this.getAssetPlayer(p);if(this.log(`buffered to end of asset ${N}`),!N||!this.schedule)return;const U=this.schedule.findEventIndex(e.identifier),D=(w=this.schedule.items)==null?void 0:w[U];this.isInterstitial(D)&&this.advanceAssetBuffering(D,t)};S.on(L.BUFFERED_TO_END,_);const R=w=>()=>{if(!this.getAssetPlayer(p)||!this.schedule)return;this.shouldPlay=!0;const U=this.schedule.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,U,w)};return S.once(L.MEDIA_ENDED,R(s)),S.once(L.PLAYOUT_LIMIT_REACHED,R(1/0)),S.on(L.ERROR,(w,N)=>{if(!this.schedule)return;const U=this.getAssetPlayer(p);if(N.details===Q.BUFFER_STALLED_ERROR){if(U!=null&&U.appendInPlace){this.handleInPlaceStall(e);return}this.onTimeupdate(),this.checkBuffer(!0);return}this.handleAssetItemError(N,e,this.schedule.findEventIndex(e.identifier),s,`Asset player error ${N.error} ${e}`)}),S.on(L.DESTROYING,()=>{if(!this.getAssetPlayer(p)||!this.schedule)return;const N=new Error(`Asset player destroyed unexpectedly ${p}`),U={fatal:!0,type:je.OTHER_ERROR,details:Q.INTERSTITIAL_ASSET_ITEM_ERROR,error:N};this.handleAssetItemError(U,e,this.schedule.findEventIndex(e.identifier),s,N.message)}),this.log(`INTERSTITIAL_ASSET_PLAYER_CREATED ${xr(t)}`),this.hls.trigger(L.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:t,assetListIndex:s,event:e,player:S}),S}clearInterstitial(e,t){this.clearAssetPlayers(e,t),e.reset()}clearAssetPlayers(e,t){e.assetList.forEach(s=>{this.clearAssetPlayer(s.identifier,t)})}resetAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);if(t!==-1){this.log(`reset asset player "${e}" after error`);const s=this.playerQueue[t];this.transferMediaFromPlayer(s,null),s.resetDetails()}}clearAssetPlayer(e,t){const s=this.getAssetPlayerQueueIndex(e);if(s!==-1){const n=this.playerQueue[s];this.log(`clear ${n} toSegment: ${t&&Li(t)}`),this.transferMediaFromPlayer(n,t),this.playerQueue.splice(s,1),n.destroy()}}emptyPlayerQueue(){let e;for(;e=this.playerQueue.pop();)e.destroy();this.playerQueue=[]}startAssetPlayer(e,t,s,n,r){const{interstitial:l,assetItem:c,assetId:h}=e,d=l.assetList.length,f=this.playingAsset;this.endedAsset=null,this.playingAsset=c,(!f||f.identifier!==h)&&(f&&(this.clearAssetPlayer(f.identifier,s[n]),delete f.error),this.log(`INTERSTITIAL_ASSET_STARTED ${t+1}/${d} ${xr(c)}`),this.hls.trigger(L.INTERSTITIAL_ASSET_STARTED,{asset:c,assetListIndex:t,event:l,schedule:s.slice(0),scheduleIndex:n,player:e})),this.bufferAssetPlayer(e,r)}bufferAssetPlayer(e,t){var s,n;if(!this.schedule)return;const{interstitial:r,assetItem:l}=e,c=this.schedule.findEventIndex(r.identifier),h=(s=this.schedule.items)==null?void 0:s[c];if(!h)return;e.loadSource(),this.setBufferingItem(h),this.bufferingAsset=l;const d=this.getBufferingPlayer();if(d===e)return;const f=r.appendInPlace;if(f&&d?.interstitial.appendInPlace===!1)return;const p=d?.tracks||((n=this.detachedData)==null?void 0:n.tracks)||this.requiredTracks;if(f&&l!==this.playingAsset){if(!e.tracks){this.log(`Waiting for track info before buffering ${e}`);return}if(p&&!mS(p,e.tracks)){const v=new Error(`Asset ${xr(l)} SourceBuffer tracks ('${Object.keys(e.tracks)}') are not compatible with primary content tracks ('${Object.keys(p)}')`),x={fatal:!0,type:je.OTHER_ERROR,details:Q.INTERSTITIAL_ASSET_ITEM_ERROR,error:v},S=r.findAssetIndex(l);this.handleAssetItemError(x,r,c,S,v.message);return}}this.transferMediaTo(e,t)}handleInPlaceStall(e){const t=this.schedule,s=this.primaryMedia;if(!t||!s)return;const n=s.currentTime,r=t.findAssetIndex(e,n),l=e.assetList[r];if(l){const c=this.getAssetPlayer(l.identifier);if(c){const h=c.currentTime||n-l.timelineStart,d=c.duration-h;if(this.warn(`Stalled at ${h} of ${h+d} in ${c} ${e} (media.currentTime: ${n})`),h&&(d/s.playbackRate<.5||c.bufferedInPlaceToEnd(s))&&c.hls){const f=t.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,f,r)}}}}advanceInPlace(e){const t=this.primaryMedia;t&&t.currentTime<e&&(t.currentTime=e)}handleAssetItemError(e,t,s,n,r){if(e.details===Q.BUFFER_STALLED_ERROR)return;const l=t.assetList[n]||null;if(this.warn(`INTERSTITIAL_ASSET_ERROR ${l&&xr(l)} ${e.error}`),!this.schedule)return;const c=l?.identifier||"",h=this.getAssetPlayerQueueIndex(c),d=this.playerQueue[h]||null,f=this.schedule.items,p=At({},e,{fatal:!1,errorAction:br(!0),asset:l,assetListIndex:n,event:t,schedule:f,scheduleIndex:s,player:d});if(this.hls.trigger(L.INTERSTITIAL_ASSET_ERROR,p),!e.fatal)return;const v=this.playingAsset,x=this.bufferingAsset,S=new Error(r);if(l&&(this.clearAssetPlayer(c,null),l.error=S),!t.assetList.some(T=>!T.error))t.error=S;else for(let T=n;T<t.assetList.length;T++)this.resetAssetPlayer(t.assetList[T].identifier);this.updateSchedule(!0),t.error?this.primaryFallback(t):v&&v.identifier===c?this.advanceAfterAssetEnded(t,s,n):x&&x.identifier===c&&this.isInterstitial(this.bufferingItem)&&this.advanceAssetBuffering(this.bufferingItem,x)}primaryFallback(e){const t=e.timelineStart,s=this.effectivePlayingItem;let n=this.timelinePos;if(s){this.log(`Fallback to primary from event "${e.identifier}" start: ${t} pos: ${n} playing: ${Li(s)} error: ${e.error}`),n===-1&&(n=this.hls.startPosition);const l=this.updateItem(s,n);this.itemsMatch(s,l)&&this.clearInterstitial(e,null),e.appendInPlace&&(this.attachPrimary(t,null),this.flushFrontBuffer(t))}else if(n===-1){this.checkStart();return}if(!this.schedule)return;const r=this.schedule.findItemIndexAtTime(n);this.setSchedulePosition(r)}onAssetListLoaded(e,t){var s,n;const r=t.event,l=r.identifier,c=t.assetListResponse.ASSETS;if(!((s=this.schedule)!=null&&s.hasEvent(l)))return;const h=r.timelineStart,d=r.duration;let f=0;c.forEach((T,E)=>{const A=parseFloat(T.DURATION);this.createAsset(r,E,f,h+f,A,T.URI),f+=A}),r.duration=f,this.log(`Loaded asset-list with duration: ${f} (was: ${d}) ${r}`);const p=this.waitingItem,v=p?.event.identifier===l;this.updateSchedule();const x=(n=this.bufferingItem)==null?void 0:n.event;if(v){var S;const T=this.schedule.findEventIndex(l),E=(S=this.schedule.items)==null?void 0:S[T];if(E){if(!this.playingItem&&this.timelinePos>E.end&&this.schedule.findItemIndexAtTime(this.timelinePos)!==T){r.error=new Error(`Interstitial ${c.length?"no longer within playback range":"asset-list is empty"} ${this.timelinePos} ${r}`),this.log(r.error.message),this.updateSchedule(!0),this.primaryFallback(r);return}this.setBufferingItem(E)}this.setSchedulePosition(T)}else if(x?.identifier===l){const T=r.assetList[0];if(T){const E=this.getAssetPlayer(T.identifier);if(x.appendInPlace){const A=this.primaryMedia;E&&A&&this.bufferAssetPlayer(E,A)}else E&&E.loadSource()}}}onError(e,t){if(this.schedule)switch(t.details){case Q.ASSET_LIST_PARSING_ERROR:case Q.ASSET_LIST_LOAD_ERROR:case Q.ASSET_LIST_LOAD_TIMEOUT:{const s=t.interstitial;s&&(this.updateSchedule(!0),this.primaryFallback(s));break}case Q.BUFFER_STALLED_ERROR:{const s=this.endedItem||this.waitingItem||this.playingItem;if(this.isInterstitial(s)&&s.event.appendInPlace){this.handleInPlaceStall(s.event);return}this.log(`Primary player stall @${this.timelinePos} bufferedPos: ${this.bufferedPos}`),this.onTimeupdate(),this.checkBuffer(!0);break}}}}const rx=500;class iN extends lm{constructor(e,t,s){super(e,t,s,"subtitle-stream-controller",ke.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(L.LEVEL_LOADED,this.onLevelLoaded,this),e.on(L.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(L.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(L.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(L.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(L.BUFFER_FLUSHING,this.onBufferFlushing,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(L.LEVEL_LOADED,this.onLevelLoaded,this),e.off(L.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(L.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(L.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(L.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(L.BUFFER_FLUSHING,this.onBufferFlushing,this)}startLoad(e,t){this.stopLoad(),this.state=re.IDLE,this.setInterval(rx),this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}onManifestLoading(){super.onManifestLoading(),this.mainDetails=null}onMediaDetaching(e,t){this.tracksBuffered=[],super.onMediaDetaching(e,t)}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){const{frag:s,success:n}=t;if(this.fragContextChanged(s)||(Qt(s)&&(this.fragPrevious=s),this.state=re.IDLE),!n)return;const r=this.tracksBuffered[this.currentTrackId];if(!r)return;let l;const c=s.start;for(let d=0;d<r.length;d++)if(c>=r[d].start&&c<=r[d].end){l=r[d];break}const h=s.start+s.duration;l?l.end=h:(l={start:c,end:h},r.push(l)),this.fragmentTracker.fragBuffered(s),this.fragBufferedComplete(s,null),this.media&&this.tick()}onBufferFlushing(e,t){const{startOffset:s,endOffset:n}=t;if(s===0&&n!==Number.POSITIVE_INFINITY){const r=n-1;if(r<=0)return;t.endOffsetSubtitles=Math.max(0,r),this.tracksBuffered.forEach(l=>{for(let c=0;c<l.length;){if(l[c].end<=r){l.shift();continue}else if(l[c].start<r)l[c].start=r;else break;c++}}),this.fragmentTracker.removeFragmentsInRange(s,r,ke.SUBTITLE)}}onError(e,t){const s=t.frag;s?.type===ke.SUBTITLE&&(t.details===Q.FRAG_GAP&&this.fragmentTracker.fragBuffered(s,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==re.STOPPED&&(this.state=re.IDLE))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){if(this.levels&&vb(this.levels,t)){this.levels=t.map(s=>new Pl(s));return}this.tracksBuffered=[],this.levels=t.map(s=>{const n=new Pl(s);return this.tracksBuffered[n.id]=[],n}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,ke.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(e,t){var s;if(this.currentTrackId=t.id,!((s=this.levels)!=null&&s.length)||this.currentTrackId===-1){this.clearInterval();return}const n=this.levels[this.currentTrackId];n!=null&&n.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,n&&this.state!==re.STOPPED&&this.setInterval(rx)}onSubtitleTrackLoaded(e,t){var s;const{currentTrackId:n,levels:r}=this,{details:l,id:c}=t;if(!r){this.warn(`Subtitle tracks were reset while loading level ${c}`);return}const h=r[c];if(c>=r.length||!h)return;this.log(`Subtitle track ${c} loaded [${l.startSN},${l.endSN}]${l.lastPartSn?`[part-${l.lastPartSn}-${l.lastPartIndex}]`:""},duration:${l.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let d=0;if(l.live||(s=h.details)!=null&&s.live){if(l.deltaUpdateFailed)return;const p=this.mainDetails;if(!p){this.startFragRequested=!1;return}const v=p.fragments[0];if(!h.details)l.hasProgramDateTime&&p.hasProgramDateTime?(eu(l,p),d=l.fragmentStart):v&&(d=v.start,_f(l,d));else{var f;d=this.alignPlaylists(l,h.details,(f=this.levelLastLoaded)==null?void 0:f.details),d===0&&v&&(d=v.start,_f(l,d))}p&&!this.startFragRequested&&this.setStartPosition(p,d)}h.details=l,this.levelLastLoaded=h,c===n&&(this.hls.trigger(L.SUBTITLE_TRACK_UPDATED,{details:l,id:c,groupId:t.groupId}),this.tick(),l.live&&!this.fragCurrent&&this.media&&this.state===re.IDLE&&(La(null,l.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),h.details=void 0)))}_handleFragmentLoadComplete(e){const{frag:t,payload:s}=e,n=t.decryptdata,r=this.hls;if(!this.fragContextChanged(t)&&s&&s.byteLength>0&&n!=null&&n.key&&n.iv&&Er(n.method)){const l=performance.now();this.decrypter.decrypt(new Uint8Array(s),n.key.buffer,n.iv.buffer,am(n.method)).catch(c=>{throw r.trigger(L.ERROR,{type:je.MEDIA_ERROR,details:Q.FRAG_DECRYPT_ERROR,fatal:!1,error:c,reason:c.message,frag:t}),c}).then(c=>{const h=performance.now();r.trigger(L.FRAG_DECRYPTED,{frag:t,payload:c,stats:{tstart:l,tdecrypt:h}})}).catch(c=>{this.warn(`${c.name}: ${c.message}`),this.state=re.IDLE})}}doTick(){if(!this.media){this.state=re.IDLE;return}if(this.state===re.IDLE){const{currentTrackId:e,levels:t}=this,s=t?.[e];if(!s||!t.length||!s.details||this.waitForLive(s))return;const{config:n}=this,r=this.getLoadPosition(),l=qe.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],r,n.maxBufferHole),{end:c,len:h}=l,d=s.details,f=this.hls.maxBufferLength+d.levelTargetDuration;if(h>f)return;const p=d.fragments,v=p.length,x=d.edge;let S=null;const T=this.fragPrevious;if(c<x){const _=n.maxFragLookUpTolerance,R=c>x-_?0:_;S=La(T,p,Math.max(p[0].start,c),R),!S&&T&&T.start<p[0].start&&(S=p[0])}else S=p[v-1];if(S=this.filterReplacedPrimary(S,s.details),!S)return;const E=S.sn-d.startSN,A=p[E-1];if(A&&A.cc===S.cc&&this.fragmentTracker.getState(A)===ls.NOT_LOADED&&(S=A),this.fragmentTracker.getState(S)===ls.NOT_LOADED){const _=this.mapToInitFragWhenRequired(S);_&&this.loadFragment(_,s,c)}}}loadFragment(e,t,s){Qt(e)?super.loadFragment(e,t,s):this._loadInitSegment(e,t)}get mediaBufferTimeRanges(){return new nN(this.tracksBuffered[this.currentTrackId]||[])}}class nN{constructor(e){this.buffered=void 0;const t=(s,n,r)=>{if(n=n>>>0,n>r-1)throw new DOMException(`Failed to execute '${s}' on 'TimeRanges': The index provided (${n}) is greater than the maximum bound (${r})`);return e[n][s]};this.buffered={get length(){return e.length},end(s){return t("end",s,e.length)},start(s){return t("start",s,e.length)}}}}const aN={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},Db=i=>String.fromCharCode(aN[i]||i),wi=15,vn=100,rN={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},lN={17:2,18:4,21:6,22:8,23:10,19:13,20:15},oN={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},cN={25:2,26:4,29:6,30:8,31:10,27:13,28:15},uN=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class dN{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){const s=typeof t=="function"?t():t;yt.log(`${this.time} [${e}] ${s}`)}}}const ba=function(e){const t=[];for(let s=0;s<e.length;s++)t.push(e[s].toString(16));return t};class kb{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const t=["foreground","underline","italics","background","flash"];for(let s=0;s<t.length;s++){const n=t[s];e.hasOwnProperty(n)&&(this[n]=e[n])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class hN{constructor(){this.uchar=" ",this.penState=new kb}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}}class fN{constructor(e){this.chars=[],this.pos=0,this.currPenState=new kb,this.cueStartTime=null,this.logger=void 0;for(let t=0;t<vn;t++)this.chars.push(new hN);this.logger=e}equals(e){for(let t=0;t<vn;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0}copy(e){for(let t=0;t<vn;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<vn;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>vn&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=vn)}moveCursor(e){const t=this.pos+e;if(e>1)for(let s=this.pos+1;s<t+1;s++)this.chars[s].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const t=Db(e);if(this.pos>=vn){this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1)}clearFromPos(e){let t;for(t=e;t<vn;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let t=!0;for(let s=0;s<vn;s++){const n=this.chars[s].uchar;n!==" "&&(t=!1),e.push(n)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}class Jh{constructor(e){this.rows=[],this.currRow=wi-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let t=0;t<wi;t++)this.rows.push(new fN(e));this.logger=e}reset(){for(let e=0;e<wi;e++)this.rows[e].clear();this.currRow=wi-1}equals(e){let t=!0;for(let s=0;s<wi;s++)if(!this.rows[s].equals(e.rows[s])){t=!1;break}return t}copy(e){for(let t=0;t<wi;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<wi;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+Ot(e));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let c=0;c<wi;c++)this.rows[c].clear();const r=this.currRow+1-this.nrRollUpRows,l=this.lastOutputScreen;if(l){const c=l.rows[r].cueStartTime,h=this.logger.time;if(c!==null&&h!==null&&c<h)for(let d=0;d<this.nrRollUpRows;d++)this.rows[t-this.nrRollUpRows+d+1].copy(l.rows[r+d])}}this.currRow=t;const s=this.rows[this.currRow];if(e.indent!==null){const r=e.indent,l=Math.max(r-1,0);s.setCursor(e.indent),e.color=s.chars[l].penState.foreground}const n={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(n)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+Ot(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());const e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const t=[];let s="",n=-1;for(let r=0;r<wi;r++){const l=this.rows[r].getTextString();l&&(n=r+1,e?t.push("Row "+n+": '"+l+"'"):t.push(l.trim()))}return t.length>0&&(e?s="["+t.join(" | ")+"]":s=t.join(`
`)),s}getTextAndFormat(){return this.rows}}class lx{constructor(e,t,s){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new Jh(s),this.nonDisplayedMemory=new Jh(s),this.lastOutputScreen=new Jh(s),this.currRollUpRow=this.displayedMemory.rows[wi-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=s}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[wi-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let s=0;s<e.length;s++)this.writeScreen.insertChar(e[s]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>t+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const t={flash:!1};if(t.underline=e%2===1,t.italics=e>=46,t.italics)t.foreground="white";else{const s=Math.floor(e/2)-16,n=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=n[s]}this.logger.log(2,"MIDROW: "+Ot(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){const t=this.logger.time;t!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=t:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class ox{constructor(e,t,s){this.channels=void 0,this.currentChannel=0,this.cmdHistory=pN(),this.logger=void 0;const n=this.logger=new dN;this.channels=[null,new lx(e,t,n),new lx(e+1,s,n)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){this.logger.time=e;for(let s=0;s<t.length;s+=2){const n=t[s]&127,r=t[s+1]&127;let l=!1,c=null;if(n===0&&r===0)continue;this.logger.log(3,()=>"["+ba([t[s],t[s+1]])+"] -> ("+ba([n,r])+")");const h=this.cmdHistory;if(n>=16&&n<=31){if(mN(n,r,h)){Tc(null,null,h),this.logger.log(3,()=>"Repeated command ("+ba([n,r])+") is dropped");continue}Tc(n,r,this.cmdHistory),l=this.parseCmd(n,r),l||(l=this.parseMidrow(n,r)),l||(l=this.parsePAC(n,r)),l||(l=this.parseBackgroundAttributes(n,r))}else Tc(null,null,h);if(!l&&(c=this.parseChars(n,r),c)){const f=this.currentChannel;f&&f>0?this.channels[f].insertChars(c):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!l&&!c&&this.logger.log(2,()=>"Couldn't parse cleaned data "+ba([n,r])+" orig: "+ba([t[s],t[s+1]]))}}parseCmd(e,t){const s=(e===20||e===28||e===21||e===29)&&t>=32&&t<=47,n=(e===23||e===31)&&t>=33&&t<=35;if(!(s||n))return!1;const r=e===20||e===21||e===23?1:2,l=this.channels[r];return e===20||e===21||e===28||e===29?t===32?l.ccRCL():t===33?l.ccBS():t===34?l.ccAOF():t===35?l.ccAON():t===36?l.ccDER():t===37?l.ccRU(2):t===38?l.ccRU(3):t===39?l.ccRU(4):t===40?l.ccFON():t===41?l.ccRDC():t===42?l.ccTR():t===43?l.ccRTD():t===44?l.ccEDM():t===45?l.ccCR():t===46?l.ccENM():t===47&&l.ccEOC():l.ccTO(t-32),this.currentChannel=r,!0}parseMidrow(e,t){let s=0;if((e===17||e===25)&&t>=32&&t<=47){if(e===17?s=1:s=2,s!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const n=this.channels[s];return n?(n.ccMIDROW(t),this.logger.log(3,()=>"MIDROW ("+ba([e,t])+")"),!0):!1}return!1}parsePAC(e,t){let s;const n=(e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127,r=(e===16||e===24)&&t>=64&&t<=95;if(!(n||r))return!1;const l=e<=23?1:2;t>=64&&t<=95?s=l===1?rN[e]:oN[e]:s=l===1?lN[e]:cN[e];const c=this.channels[l];return c?(c.setPAC(this.interpretPAC(s,t)),this.currentChannel=l,!0):!1}interpretPAC(e,t){let s;const n={color:null,italics:!1,indent:null,underline:!1,row:e};return t>95?s=t-96:s=t-64,n.underline=(s&1)===1,s<=13?n.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(s/2)]:s<=15?(n.italics=!0,n.color="white"):n.indent=Math.floor((s-16)/2)*4,n}parseChars(e,t){let s,n=null,r=null;if(e>=25?(s=2,r=e-8):(s=1,r=e),r>=17&&r<=19){let l;r===17?l=t+80:r===18?l=t+112:l=t+144,this.logger.log(2,()=>"Special char '"+Db(l)+"' in channel "+s),n=[l]}else e>=32&&e<=127&&(n=t===0?[e]:[e,t]);return n&&this.logger.log(3,()=>"Char codes =  "+ba(n).join(",")),n}parseBackgroundAttributes(e,t){const s=(e===16||e===24)&&t>=32&&t<=47,n=(e===23||e===31)&&t>=45&&t<=47;if(!(s||n))return!1;let r;const l={};e===16||e===24?(r=Math.floor((t-32)/2),l.background=uN[r],t%2===1&&(l.background=l.background+"_semi")):t===45?l.background="transparent":(l.foreground="black",t===47&&(l.underline=!0));const c=e<=23?1:2;return this.channels[c].setBkgData(l),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}Tc(null,null,this.cmdHistory)}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){const s=this.channels[t];s&&s.cueSplitAtTime(e)}}}function Tc(i,e,t){t.a=i,t.b=e}function mN(i,e,t){return t.a===i&&t.b===e}function pN(){return{a:null,b:null}}var xm=(function(){if(Jc!=null&&Jc.VTTCue)return self.VTTCue;const i=["","lr","rl"],e=["start","middle","end","left","right"];function t(c,h){if(typeof h!="string"||!Array.isArray(c))return!1;const d=h.toLowerCase();return~c.indexOf(d)?d:!1}function s(c){return t(i,c)}function n(c){return t(e,c)}function r(c,...h){let d=1;for(;d<arguments.length;d++){const f=arguments[d];for(const p in f)c[p]=f[p]}return c}function l(c,h,d){const f=this,p={enumerable:!0};f.hasBeenReset=!1;let v="",x=!1,S=c,T=h,E=d,A=null,_="",R=!0,w="auto",N="start",U=50,D="middle",F=50,j="middle";Object.defineProperty(f,"id",r({},p,{get:function(){return v},set:function(M){v=""+M}})),Object.defineProperty(f,"pauseOnExit",r({},p,{get:function(){return x},set:function(M){x=!!M}})),Object.defineProperty(f,"startTime",r({},p,{get:function(){return S},set:function(M){if(typeof M!="number")throw new TypeError("Start time must be set to a number.");S=M,this.hasBeenReset=!0}})),Object.defineProperty(f,"endTime",r({},p,{get:function(){return T},set:function(M){if(typeof M!="number")throw new TypeError("End time must be set to a number.");T=M,this.hasBeenReset=!0}})),Object.defineProperty(f,"text",r({},p,{get:function(){return E},set:function(M){E=""+M,this.hasBeenReset=!0}})),Object.defineProperty(f,"region",r({},p,{get:function(){return A},set:function(M){A=M,this.hasBeenReset=!0}})),Object.defineProperty(f,"vertical",r({},p,{get:function(){return _},set:function(M){const H=s(M);if(H===!1)throw new SyntaxError("An invalid or illegal string was specified.");_=H,this.hasBeenReset=!0}})),Object.defineProperty(f,"snapToLines",r({},p,{get:function(){return R},set:function(M){R=!!M,this.hasBeenReset=!0}})),Object.defineProperty(f,"line",r({},p,{get:function(){return w},set:function(M){if(typeof M!="number"&&M!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");w=M,this.hasBeenReset=!0}})),Object.defineProperty(f,"lineAlign",r({},p,{get:function(){return N},set:function(M){const H=n(M);if(!H)throw new SyntaxError("An invalid or illegal string was specified.");N=H,this.hasBeenReset=!0}})),Object.defineProperty(f,"position",r({},p,{get:function(){return U},set:function(M){if(M<0||M>100)throw new Error("Position must be between 0 and 100.");U=M,this.hasBeenReset=!0}})),Object.defineProperty(f,"positionAlign",r({},p,{get:function(){return D},set:function(M){const H=n(M);if(!H)throw new SyntaxError("An invalid or illegal string was specified.");D=H,this.hasBeenReset=!0}})),Object.defineProperty(f,"size",r({},p,{get:function(){return F},set:function(M){if(M<0||M>100)throw new Error("Size must be between 0 and 100.");F=M,this.hasBeenReset=!0}})),Object.defineProperty(f,"align",r({},p,{get:function(){return j},set:function(M){const H=n(M);if(!H)throw new SyntaxError("An invalid or illegal string was specified.");j=H,this.hasBeenReset=!0}})),f.displayState=void 0}return l.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},l})();class gN{decode(e,t){if(!e)return"";if(typeof e!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function Pb(i){function e(s,n,r,l){return(s|0)*3600+(n|0)*60+(r|0)+parseFloat(l||0)}const t=i.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return t?parseFloat(t[2])>59?e(t[2],t[3],0,t[4]):e(t[1],t[2],t[3],t[4]):null}class vN{constructor(){this.values=Object.create(null)}set(e,t){!this.get(e)&&t!==""&&(this.values[e]=t)}get(e,t,s){return s?this.has(e)?this.values[e]:t[s]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,s){for(let n=0;n<s.length;++n)if(t===s[n]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const s=parseFloat(t);if(s>=0&&s<=100)return this.set(e,s),!0}return!1}}function Ub(i,e,t,s){const n=s?i.split(s):[i];for(const r in n){if(typeof n[r]!="string")continue;const l=n[r].split(t);if(l.length!==2)continue;const c=l[0],h=l[1];e(c,h)}}const Df=new xm(0,0,""),Ac=Df.align==="middle"?"middle":"center";function yN(i,e,t){const s=i;function n(){const c=Pb(i);if(c===null)throw new Error("Malformed timestamp: "+s);return i=i.replace(/^[^\sa-zA-Z-]+/,""),c}function r(c,h){const d=new vN;Ub(c,function(v,x){let S;switch(v){case"region":for(let T=t.length-1;T>=0;T--)if(t[T].id===x){d.set(v,t[T].region);break}break;case"vertical":d.alt(v,x,["rl","lr"]);break;case"line":S=x.split(","),d.integer(v,S[0]),d.percent(v,S[0])&&d.set("snapToLines",!1),d.alt(v,S[0],["auto"]),S.length===2&&d.alt("lineAlign",S[1],["start",Ac,"end"]);break;case"position":S=x.split(","),d.percent(v,S[0]),S.length===2&&d.alt("positionAlign",S[1],["start",Ac,"end","line-left","line-right","auto"]);break;case"size":d.percent(v,x);break;case"align":d.alt(v,x,["start",Ac,"end","left","right"]);break}},/:/,/\s/),h.region=d.get("region",null),h.vertical=d.get("vertical","");let f=d.get("line","auto");f==="auto"&&Df.line===-1&&(f=-1),h.line=f,h.lineAlign=d.get("lineAlign","start"),h.snapToLines=d.get("snapToLines",!0),h.size=d.get("size",100),h.align=d.get("align",Ac);let p=d.get("position","auto");p==="auto"&&Df.position===50&&(p=h.align==="start"||h.align==="left"?0:h.align==="end"||h.align==="right"?100:50),h.position=p}function l(){i=i.replace(/^\s+/,"")}if(l(),e.startTime=n(),l(),i.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+s);i=i.slice(3),l(),e.endTime=n(),l(),r(i,e)}function Mb(i){return i.replace(/<br(?: \/)?>/gi,`
`)}class xN{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new gN,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const t=this;e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));function s(){let r=t.buffer,l=0;for(r=Mb(r);l<r.length&&r[l]!=="\r"&&r[l]!==`
`;)++l;const c=r.slice(0,l);return r[l]==="\r"&&++l,r[l]===`
`&&++l,t.buffer=r.slice(l),c}function n(r){Ub(r,function(l,c){},/:/)}try{let r="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;r=s();const c=r.match(/^()?WEBVTT([ \t].*)?$/);if(!(c!=null&&c[0]))throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let l=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(l?l=!1:r=s(),t.state){case"HEADER":/:/.test(r)?n(r):r||(t.state="ID");continue;case"NOTE":r||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(r)){t.state="NOTE";break}if(!r)continue;if(t.cue=new xm(0,0,""),t.state="CUE",r.indexOf("-->")===-1){t.cue.id=r;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{yN(r,t.cue,t.regionList)}catch{t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const c=r.indexOf("-->")!==-1;if(!r||c&&(l=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=r}continue;case"BADCUE":r||(t.state="ID")}}}catch{t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||e.state==="HEADER")&&(e.buffer+=`

`,e.parse()),e.state==="INITIAL"||e.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}}const SN=/\r\n|\n\r|\n|\r/g,ef=function(e,t,s=0){return e.slice(s,s+t.length)===t},bN=function(e){let t=parseInt(e.slice(-3));const s=parseInt(e.slice(-6,-4)),n=parseInt(e.slice(-9,-7)),r=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!Ce(t)||!Ce(s)||!Ce(n)||!Ce(r))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*s,t+=60*1e3*n,t+=3600*1e3*r,t};function Sm(i,e,t){return Ol(i.toString())+Ol(e.toString())+Ol(t)}const EN=function(e,t,s){let n=e[t],r=e[n.prevCC];if(!r||!r.new&&n.new){e.ccOffset=e.presentationOffset=n.start,n.new=!1;return}for(;(l=r)!=null&&l.new;){var l;e.ccOffset+=n.start-r.start,n.new=!1,n=r,r=e[n.prevCC]}e.presentationOffset=s};function TN(i,e,t,s,n,r,l){const c=new xN,h=ni(new Uint8Array(i)).trim().replace(SN,`
`).split(`
`),d=[],f=e?wC(e.baseTime,e.timescale):0;let p="00:00.000",v=0,x=0,S,T=!0;c.oncue=function(E){const A=t[s];let _=t.ccOffset;const R=(v-f)/9e4;if(A!=null&&A.new&&(x!==void 0?_=t.ccOffset=A.start:EN(t,s,R)),R){if(!e){S=new Error("Missing initPTS for VTT MPEGTS");return}_=R-t.presentationOffset}const w=E.endTime-E.startTime,N=ti((E.startTime+_-x)*9e4,n*9e4)/9e4;E.startTime=Math.max(N,0),E.endTime=Math.max(N+w,0);const U=E.text.trim();E.text=decodeURIComponent(encodeURIComponent(U)),E.id||(E.id=Sm(E.startTime,E.endTime,U)),E.endTime>0&&d.push(E)},c.onparsingerror=function(E){S=E},c.onflush=function(){if(S){l(S);return}r(d)},h.forEach(E=>{if(T)if(ef(E,"X-TIMESTAMP-MAP=")){T=!1,E.slice(16).split(",").forEach(A=>{ef(A,"LOCAL:")?p=A.slice(6):ef(A,"MPEGTS:")&&(v=parseInt(A.slice(7)))});try{x=bN(p)/1e3}catch(A){S=A}return}else E===""&&(T=!1);c.parse(E+`
`)}),c.flush()}const tf="stpp.ttml.im1t",jb=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,Fb=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,AN={left:"start",center:"center",right:"end",start:"start",end:"end"};function cx(i,e,t,s){const n=et(new Uint8Array(i),["mdat"]);if(n.length===0){s(new Error("Could not parse IMSC1 mdat"));return}const r=n.map(c=>ni(c)),l=LC(e.baseTime,1,e.timescale);try{r.forEach(c=>t(_N(c,l)))}catch(c){s(c)}}function _N(i,e){const n=new DOMParser().parseFromString(i,"text/xml").getElementsByTagName("tt")[0];if(!n)throw new Error("Invalid ttml");const r={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},l=Object.keys(r).reduce((p,v)=>(p[v]=n.getAttribute(`ttp:${v}`)||r[v],p),{}),c=n.getAttribute("xml:space")!=="preserve",h=ux(sf(n,"styling","style")),d=ux(sf(n,"layout","region")),f=sf(n,"body","[begin]");return[].map.call(f,p=>{const v=Bb(p,c);if(!v||!p.hasAttribute("begin"))return null;const x=af(p.getAttribute("begin"),l),S=af(p.getAttribute("dur"),l);let T=af(p.getAttribute("end"),l);if(x===null)throw dx(p);if(T===null){if(S===null)throw dx(p);T=x+S}const E=new xm(x-e,T-e,v);E.id=Sm(E.startTime,E.endTime,E.text);const A=d[p.getAttribute("region")],_=h[p.getAttribute("style")],R=IN(A,_,h),{textAlign:w}=R;if(w){const N=AN[w];N&&(E.lineAlign=N),E.align=w}return At(E,R),E}).filter(p=>p!==null)}function sf(i,e,t){const s=i.getElementsByTagName(e)[0];return s?[].slice.call(s.querySelectorAll(t)):[]}function ux(i){return i.reduce((e,t)=>{const s=t.getAttribute("xml:id");return s&&(e[s]=t),e},{})}function Bb(i,e){return[].slice.call(i.childNodes).reduce((t,s,n)=>{var r;return s.nodeName==="br"&&n?t+`
`:(r=s.childNodes)!=null&&r.length?Bb(s,e):e?t+s.textContent.trim().replace(/\s+/g," "):t+s.textContent},"")}function IN(i,e,t){const s="http://www.w3.org/ns/ttml#styling";let n=null;const r=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],l=i!=null&&i.hasAttribute("style")?i.getAttribute("style"):null;return l&&t.hasOwnProperty(l)&&(n=t[l]),r.reduce((c,h)=>{const d=nf(e,s,h)||nf(i,s,h)||nf(n,s,h);return d&&(c[h]=d),c},{})}function nf(i,e,t){return i&&i.hasAttributeNS(e,t)?i.getAttributeNS(e,t):null}function dx(i){return new Error(`Could not parse ttml timestamp ${i}`)}function af(i,e){if(!i)return null;let t=Pb(i);return t===null&&(jb.test(i)?t=RN(i,e):Fb.test(i)&&(t=LN(i,e))),t}function RN(i,e){const t=jb.exec(i),s=(t[4]|0)+(t[5]|0)/e.subFrameRate;return(t[1]|0)*3600+(t[2]|0)*60+(t[3]|0)+s/e.frameRate}function LN(i,e){const t=Fb.exec(i),s=Number(t[1]);switch(t[2]){case"h":return s*3600;case"m":return s*60;case"ms":return s*1e3;case"f":return s/e.frameRate;case"t":return s/e.tickRate}return s}class _c{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,s){(this.startTime===null||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=s,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}class wN{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=fx(),this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(L.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(L.FRAG_LOADING,this.onFragLoading,this),e.on(L.FRAG_LOADED,this.onFragLoaded,this),e.on(L.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(L.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(L.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(L.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(L.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(L.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(L.FRAG_LOADING,this.onFragLoading,this),e.off(L.FRAG_LOADED,this.onFragLoaded,this),e.off(L.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(L.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(L.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(L.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(L.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){const e=new _c(this,"textTrack1"),t=new _c(this,"textTrack2"),s=new _c(this,"textTrack3"),n=new _c(this,"textTrack4");this.cea608Parser1=new ox(1,e,t),this.cea608Parser2=new ox(3,s,n)}addCues(e,t,s,n,r){let l=!1;for(let c=r.length;c--;){const h=r[c],d=CN(h[0],h[1],t,s);if(d>=0&&(h[0]=Math.min(h[0],t),h[1]=Math.max(h[1],s),l=!0,d/(s-t)>.5))return}if(l||r.push([t,s]),this.config.renderTextTracksNatively){const c=this.captionsTracks[e];this.Cues.newCue(c,t,s,n)}else{const c=this.Cues.newCue(null,t,s,n);this.hls.trigger(L.CUES_PARSED,{type:"captions",cues:c,track:e})}}onInitPtsFound(e,{frag:t,id:s,initPTS:n,timescale:r,trackId:l}){const{unparsedVttFrags:c}=this;s===ke.MAIN&&(this.initPTS[t.cc]={baseTime:n,timescale:r,trackId:l}),c.length&&(this.unparsedVttFrags=[],c.forEach(h=>{this.initPTS[h.frag.cc]?this.onFragLoaded(L.FRAG_LOADED,h):this.hls.trigger(L.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:h.frag,error:new Error("Subtitle discontinuity domain does not match main")})}))}getExistingTrack(e,t){const{media:s}=this;if(s)for(let n=0;n<s.textTracks.length;n++){const r=s.textTracks[n];if(hx(r,{name:e,lang:t,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return r}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:t,captionsTracks:s,media:n}=this,{label:r,languageCode:l}=t[e],c=this.getExistingTrack(r,l);if(c)s[e]=c,Sr(s[e]),Cb(s[e],n);else{const h=this.createTextTrack("captions",r,l);h&&(h[e]=!0,s[e]=h)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const s=t.label,n={_id:e,label:s,kind:"captions",default:t.media?!!t.media.default:!1,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=n,this.hls.trigger(L.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[n]})}createTextTrack(e,t,s){const n=this.media;if(n)return n.addTextTrack(e,t,s)}onMediaAttaching(e,t){this.media=t.media,t.mediaSource||this._cleanTracks()}onMediaDetaching(e,t){const s=!!t.transferMedia;if(this.media=null,s)return;const{captionsTracks:n}=this;Object.keys(n).forEach(r=>{Sr(n[r]),delete n[r]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=fx(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const t=e.textTracks;if(t)for(let s=0;s<t.length;s++)Sr(t[s])}onSubtitleTracksUpdated(e,t){const s=t.subtitleTracks||[],n=s.some(r=>r.textCodec===tf);if(this.config.enableWebVTT||n&&this.config.enableIMSC1){if(vb(this.tracks,s)){this.tracks=s;return}if(this.textTracks=[],this.tracks=s,this.config.renderTextTracksNatively){const l=this.media,c=l?Fc(l.textTracks):null;if(this.tracks.forEach((h,d)=>{let f;if(c){let p=null;for(let v=0;v<c.length;v++)if(c[v]&&hx(c[v],h)){p=c[v],c[v]=null;break}p&&(f=p)}if(f)Sr(f);else{const p=$b(h);f=this.createTextTrack(p,h.name,h.lang),f&&(f.mode="disabled")}f&&this.textTracks.push(f)}),c!=null&&c.length){const h=c.filter(d=>d!==null).map(d=>d.label);h.length&&this.hls.logger.warn(`Media element contains unused subtitle tracks: ${h.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const l=this.tracks.map(c=>({label:c.name,kind:c.type.toLowerCase(),default:c.default,subtitleTrack:c}));this.hls.trigger(L.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:l})}}}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(s=>{const n=/(?:CC|SERVICE)([1-4])/.exec(s.instreamId);if(!n)return;const r=`textTrack${n[1]}`,l=this.captionsProperties[r];l&&(l.label=s.name,s.lang&&(l.languageCode=s.lang),l.media=s)})}closedCaptionsForLevel(e){const t=this.hls.levels[e.level];return t?.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){if(this.enabled&&t.frag.type===ke.MAIN){var s,n;const{cea608Parser1:r,cea608Parser2:l,lastSn:c}=this,{cc:h,sn:d}=t.frag,f=(s=(n=t.part)==null?void 0:n.index)!=null?s:-1;r&&l&&(d!==c+1||d===c&&f!==this.lastPartIndex+1||h!==this.lastCc)&&(r.reset(),l.reset()),this.lastCc=h,this.lastSn=d,this.lastPartIndex=f}}onFragLoaded(e,t){const{frag:s,payload:n}=t;if(s.type===ke.SUBTITLE)if(n.byteLength){const r=s.decryptdata,l="stats"in t;if(r==null||!r.encrypted||l){const c=this.tracks[s.level],h=this.vttCCs;h[s.cc]||(h[s.cc]={start:s.start,prevCC:this.prevCC,new:!0},this.prevCC=s.cc),c&&c.textCodec===tf?this._parseIMSC1(s,n):this._parseVTTs(t)}}else this.hls.trigger(L.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:s,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){const s=this.hls;cx(t,this.initPTS[e.cc],n=>{this._appendCues(n,e.level),s.trigger(L.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},n=>{s.logger.log(`Failed to parse IMSC1: ${n}`),s.trigger(L.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:n})})}_parseVTTs(e){var t;const{frag:s,payload:n}=e,{initPTS:r,unparsedVttFrags:l}=this,c=r.length-1;if(!r[s.cc]&&c===-1){l.push(e);return}const h=this.hls,d=(t=s.initSegment)!=null&&t.data?bi(s.initSegment.data,new Uint8Array(n)).buffer:n;TN(d,this.initPTS[s.cc],this.vttCCs,s.cc,s.start,f=>{this._appendCues(f,s.level),h.trigger(L.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:s})},f=>{const p=f.message==="Missing initPTS for VTT MPEGTS";p?l.push(e):this._fallbackToIMSC1(s,n),h.logger.log(`Failed to parse VTT cue: ${f}`),!(p&&c>s.cc)&&h.trigger(L.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:s,error:f})})}_fallbackToIMSC1(e,t){const s=this.tracks[e.level];s.textCodec||cx(t,this.initPTS[e.cc],()=>{s.textCodec=tf,this._parseIMSC1(e,t)},()=>{s.textCodec="wvtt"})}_appendCues(e,t){const s=this.hls;if(this.config.renderTextTracksNatively){const n=this.textTracks[t];if(!n||n.mode==="disabled")return;e.forEach(r=>Ob(n,r))}else{const n=this.tracks[t];if(!n)return;const r=n.default?"default":"subtitles"+t;s.trigger(L.CUES_PARSED,{type:"subtitles",cues:e,track:r})}}onFragDecrypted(e,t){const{frag:s}=t;s.type===ke.SUBTITLE&&this.onFragLoaded(L.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){if(!this.enabled||!this.config.enableCEA708Captions)return;const{frag:s,samples:n}=t;if(!(s.type===ke.MAIN&&this.closedCaptionsForLevel(s)==="NONE"))for(let r=0;r<n.length;r++){const l=n[r].bytes;if(l){this.cea608Parser1||this.initCea608Parsers();const c=this.extractCea608Data(l);this.cea608Parser1.addData(n[r].pts,c[0]),this.cea608Parser2.addData(n[r].pts,c[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:s,endOffsetSubtitles:n,type:r}){const{media:l}=this;if(!(!l||l.currentTime<s)){if(!r||r==="video"){const{captionsTracks:c}=this;Object.keys(c).forEach(h=>Nf(c[h],t,s))}if(this.config.renderTextTracksNatively&&t===0&&n!==void 0){const{textTracks:c}=this;Object.keys(c).forEach(h=>Nf(c[h],t,n))}}}extractCea608Data(e){const t=[[],[]],s=e[0]&31;let n=2;for(let r=0;r<s;r++){const l=e[n++],c=127&e[n++],h=127&e[n++];if(c===0&&h===0)continue;if((4&l)!==0){const f=3&l;(f===0||f===1)&&(t[f].push(c),t[f].push(h))}}return t}}function $b(i){return i.characteristics&&/transcribes-spoken-dialog/gi.test(i.characteristics)&&/describes-music-and-sound/gi.test(i.characteristics)?"captions":"subtitles"}function hx(i,e){return!!i&&i.kind===$b(e)&&Lf(e,i)}function CN(i,e,t,s){return Math.min(e,s)-Math.max(i,t)}function fx(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}const ON=/\s/,NN={newCue(i,e,t,s){const n=[];let r,l,c,h,d;const f=self.VTTCue||self.TextTrackCue;for(let v=0;v<s.rows.length;v++)if(r=s.rows[v],c=!0,h=0,d="",!r.isEmpty()){var p;for(let T=0;T<r.chars.length;T++)ON.test(r.chars[T].uchar)&&c?h++:(d+=r.chars[T].uchar,c=!1);r.cueStartTime=e,e===t&&(t+=1e-4),h>=16?h--:h++;const x=Mb(d.trim()),S=Sm(e,t,x);i!=null&&(p=i.cues)!=null&&p.getCueById(S)||(l=new f(e,t,x),l.id=S,l.line=v+1,l.align="left",l.position=10+Math.min(80,Math.floor(h*8/32)*10),n.push(l))}return i&&n.length&&(n.sort((v,x)=>v.line==="auto"||x.line==="auto"?0:v.line>8&&x.line>8?x.line-v.line:v.line-x.line),n.forEach(v=>Ob(i,v))),n}};function DN(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}const kN=/(\d+)-(\d+)\/(\d+)/;class mx{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||jN,this.controller=new self.AbortController,this.stats=new Zf}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,s){const n=this.stats;if(n.loading.start)throw new Error("Loader can only be used once.");n.loading.start=self.performance.now();const r=PN(e,this.controller.signal),l=e.responseType==="arraybuffer",c=l?"byteLength":"length",{maxTimeToFirstByteMs:h,maxLoadTimeMs:d}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=s,this.request=this.fetchSetup(e,r),self.clearTimeout(this.requestTimeout),t.timeout=h&&Ce(h)?h:d,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(n,e,this.response))},t.timeout),(jl(this.request)?this.request.then(self.fetch):self.fetch(this.request)).then(p=>{var v;this.response=this.loader=p;const x=Math.max(self.performance.now(),n.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=d,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(n,e,this.response))},d-(x-n.loading.start)),!p.ok){const{status:T,statusText:E}=p;throw new FN(E||"fetch, bad network response",T,p)}n.loading.first=x,n.total=MN(p.headers)||n.total;const S=(v=this.callbacks)==null?void 0:v.onProgress;return S&&Ce(t.highWaterMark)?this.loadProgressively(p,n,e,t.highWaterMark,S):l?p.arrayBuffer():e.responseType==="json"?p.json():p.text()}).then(p=>{var v,x;const S=this.response;if(!S)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),n.loading.end=Math.max(self.performance.now(),n.loading.first);const T=p[c];T&&(n.loaded=n.total=T);const E={url:S.url,data:p,code:S.status},A=(v=this.callbacks)==null?void 0:v.onProgress;A&&!Ce(t.highWaterMark)&&A(n,e,p,S),(x=this.callbacks)==null||x.onSuccess(E,n,e,S)}).catch(p=>{var v;if(self.clearTimeout(this.requestTimeout),n.aborted)return;const x=p&&p.code||0,S=p?p.message:null;(v=this.callbacks)==null||v.onError({code:x,text:S},e,p?p.details:null,n)})}getCacheAge(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,s,n=0,r){const l=new WS,c=e.body.getReader(),h=()=>c.read().then(d=>{if(d.done)return l.dataLength&&r(t,s,l.flush().buffer,e),Promise.resolve(new ArrayBuffer(0));const f=d.value,p=f.length;return t.loaded+=p,p<n||l.dataLength?(l.push(f),l.dataLength>=n&&r(t,s,l.flush().buffer,e)):r(t,s,f.buffer,e),h()}).catch(()=>Promise.reject());return h()}}function PN(i,e){const t={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers(At({},i.headers))};return i.rangeEnd&&t.headers.set("Range","bytes="+i.rangeStart+"-"+String(i.rangeEnd-1)),t}function UN(i){const e=kN.exec(i);if(e)return parseInt(e[2])-parseInt(e[1])+1}function MN(i){const e=i.get("Content-Range");if(e){const s=UN(e);if(Ce(s))return s}const t=i.get("Content-Length");if(t)return parseInt(t)}function jN(i,e){return new self.Request(i.url,e)}class FN extends Error{constructor(e,t,s){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=s}}const BN=/^age:\s*[\d.]+\s*$/im;class Vb{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new Zf,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,e.readyState!==4&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,s){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=s,this.loadInternal()}loadInternal(){const{config:e,context:t}=this;if(!e||!t)return;const s=this.loader=new self.XMLHttpRequest,n=this.stats;n.loading.first=0,n.loaded=0,n.aborted=!1;const r=this.xhrSetup;r?Promise.resolve().then(()=>{if(!(this.loader!==s||this.stats.aborted))return r(s,t.url)}).catch(l=>{if(!(this.loader!==s||this.stats.aborted))return s.open("GET",t.url,!0),r(s,t.url)}).then(()=>{this.loader!==s||this.stats.aborted||this.openAndSendXhr(s,t,e)}).catch(l=>{var c;(c=this.callbacks)==null||c.onError({code:s.status,text:l.message},t,s,n)}):this.openAndSendXhr(s,t,e)}openAndSendXhr(e,t,s){e.readyState||e.open("GET",t.url,!0);const n=t.headers,{maxTimeToFirstByteMs:r,maxLoadTimeMs:l}=s.loadPolicy;if(n)for(const c in n)e.setRequestHeader(c,n[c]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),s.timeout=r&&Ce(r)?r:l,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),s.timeout),e.send()}readystatechange(){const{context:e,loader:t,stats:s}=this;if(!e||!t)return;const n=t.readyState,r=this.config;if(!s.aborted&&n>=2&&(s.loading.first===0&&(s.loading.first=Math.max(self.performance.now(),s.loading.start),r.timeout!==r.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),r.timeout=r.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),r.loadPolicy.maxLoadTimeMs-(s.loading.first-s.loading.start)))),n===4)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const d=t.status,f=t.responseType==="text"?t.responseText:null;if(d>=200&&d<300){const S=f??t.response;if(S!=null){var l,c;s.loading.end=Math.max(self.performance.now(),s.loading.first);const T=t.responseType==="arraybuffer"?S.byteLength:S.length;s.loaded=s.total=T,s.bwEstimate=s.total*8e3/(s.loading.end-s.loading.first);const E=(l=this.callbacks)==null?void 0:l.onProgress;E&&E(s,e,S,t);const A={url:t.responseURL,data:S,code:d};(c=this.callbacks)==null||c.onSuccess(A,s,e,t);return}}const p=r.loadPolicy.errorRetry,v=s.retry,x={url:e.url,data:void 0,code:d};if(Wc(p,v,!1,x))this.retry(p);else{var h;yt.error(`${d} while loading ${e.url}`),(h=this.callbacks)==null||h.onError({code:d,text:t.statusText},e,t,s)}}}loadtimeout(){if(!this.config)return;const e=this.config.loadPolicy.timeoutRetry,t=this.stats.retry;if(Wc(e,t,!0))this.retry(e);else{var s;yt.warn(`timeout while loading ${(s=this.context)==null?void 0:s.url}`);const n=this.callbacks;n&&(this.abortInternal(),n.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:t,stats:s}=this;this.retryDelay=sm(e,s.retry),s.retry++,yt.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${t?.url}, retrying ${s.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&BN.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}const $N={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},VN=vt(vt({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,startOnSegmentBoundary:!1,maxBufferSize:60*1e3*1e3,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncMode:"edge",liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:Vb,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:ew,bufferController:HC,capLevelController:gm,errorController:aw,fpsController:zO,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:BS,requireKeySystemAccessOnStart:!1,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,preserveManualLevelOnError:!1,certLoadPolicy:{default:$N},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},GN()),{},{subtitleStreamController:iN,subtitleTrackController:qO,timelineController:wN,audioStreamController:BC,audioTrackController:$C,emeController:Tr,cmcdController:$O,contentSteeringController:GO,interstitialsController:sN});function GN(){return{cueHandler:NN,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function HN(i,e,t){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(e.liveMaxLatencyDurationCount!==void 0&&(e.liveSyncDurationCount===void 0||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(e.liveMaxLatencyDuration!==void 0&&(e.liveSyncDuration===void 0||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const s=kf(i),n=["manifest","level","frag"],r=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return n.forEach(l=>{const c=`${l==="level"?"playlist":l}LoadPolicy`,h=e[c]===void 0,d=[];r.forEach(f=>{const p=`${l}Loading${f}`,v=e[p];if(v!==void 0&&h){d.push(p);const x=s[c].default;switch(e[c]={default:x},f){case"TimeOut":x.maxLoadTimeMs=v,x.maxTimeToFirstByteMs=v;break;case"MaxRetry":x.errorRetry.maxNumRetry=v,x.timeoutRetry.maxNumRetry=v;break;case"RetryDelay":x.errorRetry.retryDelayMs=v,x.timeoutRetry.retryDelayMs=v;break;case"MaxRetryTimeout":x.errorRetry.maxRetryDelayMs=v,x.timeoutRetry.maxRetryDelayMs=v;break}}}),d.length&&t.warn(`hls.js config: "${d.join('", "')}" setting(s) are deprecated, use "${c}": ${Ot(e[c])}`)}),vt(vt({},s),e)}function kf(i){return i&&typeof i=="object"?Array.isArray(i)?i.map(kf):Object.keys(i).reduce((e,t)=>(e[t]=kf(i[t]),e),{}):i}function zN(i,e){const t=i.loader;t!==mx&&t!==Vb?(e.log("[config]: Custom loader detected, cannot enable progressive streaming"),i.progressive=!1):DN()&&(i.loader=mx,i.progressive=!0,i.enableSoftwareAES=!0,e.log("[config]: Progressive streaming enabled, using FetchLoader"))}const Bc=2,KN=.1,YN=.05,qN=100;class QN extends PS{constructor(e,t){super("gap-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.media=null,this.mediaSource=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.buffered={},this.lastCurrentTime=0,this.ended=0,this.waiting=0,this.onMediaPlaying=()=>{this.ended=0,this.waiting=0},this.onMediaWaiting=()=>{var s;(s=this.media)!=null&&s.seeking||(this.waiting=self.performance.now(),this.tick())},this.onMediaEnded=()=>{if(this.hls){var s;this.ended=((s=this.media)==null?void 0:s.currentTime)||1,this.hls.trigger(L.MEDIA_ENDED,{stalled:!1})}},this.hls=e,this.fragmentTracker=t,this.registerListeners()}registerListeners(){const{hls:e}=this;e&&(e.on(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(L.BUFFER_APPENDED,this.onBufferAppended,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(L.BUFFER_APPENDED,this.onBufferAppended,this))}destroy(){super.destroy(),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0}onMediaAttached(e,t){this.setInterval(qN),this.mediaSource=t.mediaSource;const s=this.media=t.media;Cs(s,"playing",this.onMediaPlaying),Cs(s,"waiting",this.onMediaWaiting),Cs(s,"ended",this.onMediaEnded)}onMediaDetaching(e,t){this.clearInterval();const{media:s}=this;s&&($s(s,"playing",this.onMediaPlaying),$s(s,"waiting",this.onMediaWaiting),$s(s,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0}onBufferAppended(e,t){this.buffered=t.timeRanges}get hasBuffered(){return Object.keys(this.buffered).length>0}tick(){var e;if(!((e=this.media)!=null&&e.readyState)||!this.hasBuffered)return;const t=this.media.currentTime;this.poll(t,this.lastCurrentTime),this.lastCurrentTime=t}poll(e,t){var s,n;const r=(s=this.hls)==null?void 0:s.config;if(!r)return;const l=this.media;if(!l)return;const{seeking:c}=l,h=this.seeking&&!c,d=!this.seeking&&c,f=l.paused&&!c||l.ended||l.playbackRate===0;if(this.seeking=c,e!==t){t&&(this.ended=0),this.moved=!0,c||(this.nudgeRetry=0,r.nudgeOnVideoHole&&!f&&e>t&&this.nudgeOnVideoHole(e,t)),this.waiting===0&&this.stallResolved(e);return}if(d||h){h&&this.stallResolved(e);return}if(f){this.nudgeRetry=0,this.stallResolved(e),!this.ended&&l.ended&&this.hls&&(this.ended=e||1,this.hls.trigger(L.MEDIA_ENDED,{stalled:!1}));return}if(!qe.getBuffered(l).length){this.nudgeRetry=0;return}const p=qe.bufferInfo(l,e,0),v=p.nextStart||0,x=this.fragmentTracker;if(c&&x&&this.hls){const U=px(this.hls.inFlightFragments,e),D=p.len>Bc,F=!v||U||v-e>Bc&&!x.getPartialFragment(e);if(D||F)return;this.moved=!1}const S=(n=this.hls)==null?void 0:n.latestLevelDetails;if(!this.moved&&this.stalled!==null&&x){if(!(p.len>0)&&!v)return;const D=Math.max(v,p.start||0)-e,j=!!(S!=null&&S.live)?S.targetduration*2:Bc,M=Ic(e,x);if(D>0&&(D<=j||M)){l.paused||this._trySkipBufferHole(M);return}}const T=r.detectStallWithCurrentTimeMs,E=self.performance.now(),A=this.waiting;let _=this.stalled;if(_===null)if(A>0&&E-A<T)_=this.stalled=A;else{this.stalled=E;return}const R=E-_;if(!c&&(R>=T||A)&&this.hls){var w;if(((w=this.mediaSource)==null?void 0:w.readyState)==="ended"&&!(S!=null&&S.live)&&Math.abs(e-(S?.edge||0))<1){if(this.ended)return;this.ended=e||1,this.hls.trigger(L.MEDIA_ENDED,{stalled:!0});return}if(this._reportStall(p),!this.media||!this.hls)return}const N=qe.bufferInfo(l,e,r.maxBufferHole);this._tryFixBufferStall(N,R,e)}stallResolved(e){const t=this.stalled;if(t&&this.hls&&(this.stalled=null,this.stallReported)){const s=self.performance.now()-t;this.log(`playback not stuck anymore @${e}, after ${Math.round(s)}ms`),this.stallReported=!1,this.waiting=0,this.hls.trigger(L.STALL_RESOLVED,{})}}nudgeOnVideoHole(e,t){var s;const n=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&(s=this.buffered.audio)!=null&&s.length&&n&&n.length>1&&e>n.end(0)){const r=qe.bufferedInfo(qe.timeRangesToArray(this.buffered.audio),e,0);if(r.len>1&&t>=r.start){const l=qe.timeRangesToArray(n),c=qe.bufferedInfo(l,t,0).bufferedIndex;if(c>-1&&c<l.length-1){const h=qe.bufferedInfo(l,e,0).bufferedIndex,d=l[c].end,f=l[c+1].start;if((h===-1||h>c)&&f-d<1&&e-d<2){const p=new Error(`nudging playhead to flush pipeline after video hole. currentTime: ${e} hole: ${d} -> ${f} buffered index: ${h}`);this.warn(p.message),this.media.currentTime+=1e-6;let v=Ic(e,this.fragmentTracker);v&&"fragment"in v?v=v.fragment:v||(v=void 0);const x=qe.bufferInfo(this.media,e,0);this.hls.trigger(L.ERROR,{type:je.MEDIA_ERROR,details:Q.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:p,reason:p.message,frag:v,buffer:x.len,bufferInfo:x})}}}}}_tryFixBufferStall(e,t,s){var n,r;const{fragmentTracker:l,media:c}=this,h=(n=this.hls)==null?void 0:n.config;if(!c||!l||!h)return;const d=(r=this.hls)==null?void 0:r.latestLevelDetails,f=Ic(s,l);if((f||d!=null&&d.live&&s<d.fragmentStart)&&(this._trySkipBufferHole(f)||!this.media))return;const p=e.buffered,v=this.adjacentTraversal(e,s);(p&&p.length>1&&e.len>h.maxBufferHole||e.nextStart&&(e.nextStart-s<h.maxBufferHole||v))&&(t>h.highBufferWatchdogPeriod*1e3||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(e))}adjacentTraversal(e,t){const s=this.fragmentTracker,n=e.nextStart;if(s&&n){const r=s.getFragAtPos(t,ke.MAIN),l=s.getFragAtPos(n,ke.MAIN);if(r&&l)return l.sn-r.sn<2}return!1}_reportStall(e){const{hls:t,media:s,stallReported:n,stalled:r}=this;if(!n&&r!==null&&s&&t){this.stallReported=!0;const l=new Error(`Playback stalling at @${s.currentTime} due to low buffer (${Ot(e)})`);this.warn(l.message),t.trigger(L.ERROR,{type:je.MEDIA_ERROR,details:Q.BUFFER_STALLED_ERROR,fatal:!1,error:l,buffer:e.len,bufferInfo:e,stalled:{start:r}})}}_trySkipBufferHole(e){var t;const{fragmentTracker:s,media:n}=this,r=(t=this.hls)==null?void 0:t.config;if(!n||!s||!r)return 0;const l=n.currentTime,c=qe.bufferInfo(n,l,0),h=l<c.start?c.start:c.nextStart;if(h&&this.hls){const f=c.len<=r.maxBufferHole,p=c.len>0&&c.len<1&&n.readyState<3,v=h-l;if(v>0&&(f||p)){if(v>r.maxBufferHole){let S=!1;if(l===0){const T=s.getAppendedFrag(0,ke.MAIN);T&&h<T.end&&(S=!0)}if(!S&&e){var d;if(!((d=this.hls.loadLevelObj)!=null&&d.details)||px(this.hls.inFlightFragments,h))return 0;let E=!1,A=e.end;for(;A<h;){const _=Ic(A,s);if(_)A+=_.duration;else{E=!0;break}}if(E)return 0}}const x=Math.max(h+YN,l+KN);if(this.warn(`skipping hole, adjusting currentTime from ${l} to ${x}`),this.moved=!0,n.currentTime=x,!(e!=null&&e.gap)){const S=new Error(`fragment loaded with buffer holes, seeking from ${l} to ${x}`),T={type:je.MEDIA_ERROR,details:Q.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:S,reason:S.message,buffer:c.len,bufferInfo:c};e&&("fragment"in e?T.part=e:T.frag=e),this.hls.trigger(L.ERROR,T)}return x}}return 0}_tryNudgeBuffer(e){const{hls:t,media:s,nudgeRetry:n}=this,r=t?.config;if(!s||!r)return 0;const l=s.currentTime;if(this.nudgeRetry++,n<r.nudgeMaxRetry){const c=l+(n+1)*r.nudgeOffset,h=new Error(`Nudging 'currentTime' from ${l} to ${c}`);this.warn(h.message),s.currentTime=c,t.trigger(L.ERROR,{type:je.MEDIA_ERROR,details:Q.BUFFER_NUDGE_ON_STALL,error:h,fatal:!1,buffer:e.len,bufferInfo:e})}else{const c=new Error(`Playhead still not moving while enough data buffered @${l} after ${r.nudgeMaxRetry} nudges`);this.error(c.message),t.trigger(L.ERROR,{type:je.MEDIA_ERROR,details:Q.BUFFER_STALLED_ERROR,error:c,fatal:!0,buffer:e.len,bufferInfo:e})}}}function px(i,e){const t=gx(i.main);if(t&&t.start<=e)return t;const s=gx(i.audio);return s&&s.start<=e?s:null}function gx(i){if(!i)return null;switch(i.state){case re.IDLE:case re.STOPPED:case re.ENDED:case re.ERROR:return null}return i.frag}function Ic(i,e){return e.getAppendedFrag(i,ke.MAIN)||e.getPartialFragment(i)}const XN=.25;function Pf(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function rf(i,e,t,s,n){let r=new i(e,t,"");try{r.value=s,n&&(r.type=n)}catch{r=new i(e,t,Ot(n?vt({type:n},s):s))}return r}const Rc=(()=>{const i=Pf();try{i&&new i(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();class WN{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.assetCue=void 0,this.onEventCueEnter=()=>{this.hls&&this.hls.trigger(L.EVENT_CUE_ENTER,{})},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null}_registerListeners(){const{hls:e}=this;e&&(e.on(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(L.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(L.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(L.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(L.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(L.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(L.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}onMediaAttaching(e,t){var s;this.media=t.media,((s=t.overrides)==null?void 0:s.cueRemoval)===!1&&(this.removeCues=!1)}onMediaAttached(){var e;const t=(e=this.hls)==null?void 0:e.latestLevelDetails;t&&this.updateDateRangeCues(t)}onMediaDetaching(e,t){this.media=null,!t.transferMedia&&(this.id3Track&&(this.removeCues&&Sr(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){const s=e[t];if(s.kind==="metadata"&&s.label==="id3")return Cb(s,this.media),s}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media||!this.hls)return;const{enableEmsgMetadataCues:s,enableID3MetadataCues:n}=this.hls.config;if(!s&&!n)return;const{samples:r}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const l=Pf();if(l)for(let c=0;c<r.length;c++){const h=r[c].type;if(h===si.emsg&&!s||!n)continue;const d=nb(r[c].data),f=r[c].pts;let p=f+r[c].duration;p>Rc&&(p=Rc),p-f<=0&&(p=f+XN);for(let x=0;x<d.length;x++){const S=d[x];if(!ab(S)){this.updateId3CueEnds(f,h);const T=rf(l,f,p,S,h);T&&this.id3Track.addCue(T)}}}}updateId3CueEnds(e,t){var s;const n=(s=this.id3Track)==null?void 0:s.cues;if(n)for(let r=n.length;r--;){const l=n[r];l.type===t&&l.startTime<e&&l.endTime===Rc&&(l.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:s,type:n}){const{id3Track:r,hls:l}=this;if(!l)return;const{config:{enableEmsgMetadataCues:c,enableID3MetadataCues:h}}=l;if(r&&(c||h)){let d;n==="audio"?d=f=>f.type===si.audioId3&&h:n==="video"?d=f=>f.type===si.emsg&&c:d=f=>f.type===si.audioId3&&h||f.type===si.emsg&&c,Nf(r,t,s,d)}}onLevelUpdated(e,{details:t}){this.updateDateRangeCues(t,!0)}onLevelPtsUpdated(e,t){Math.abs(t.drift)>.01&&this.updateDateRangeCues(t.details)}updateDateRangeCues(e,t){if(!this.hls||!this.media)return;const{assetPlayerId:s,timelineOffset:n,enableDateRangeMetadataCues:r,interstitialsController:l}=this.hls.config;if(!r)return;const c=Pf();if(s&&n&&!l){const{fragmentStart:T,fragmentEnd:E}=e;let A=this.assetCue;A?(A.startTime=T,A.endTime=E):c&&(A=this.assetCue=rf(c,T,E,{assetPlayerId:this.hls.config.assetPlayerId},"hlsjs.interstitial.asset"),A&&(A.id=s,this.id3Track||(this.id3Track=this.createTrack(this.media)),this.id3Track.addCue(A),A.addEventListener("enter",this.onEventCueEnter)))}if(!e.hasProgramDateTime)return;const{id3Track:h}=this,{dateRanges:d}=e,f=Object.keys(d);let p=this.dateRangeCuesAppended;if(h&&t){var v;if((v=h.cues)!=null&&v.length){const T=Object.keys(p).filter(E=>!f.includes(E));for(let E=T.length;E--;){var x;const A=T[E],_=(x=p[A])==null?void 0:x.cues;delete p[A],_&&Object.keys(_).forEach(R=>{const w=_[R];if(w){w.removeEventListener("enter",this.onEventCueEnter);try{h.removeCue(w)}catch{}}})}}else p=this.dateRangeCuesAppended={}}const S=e.fragments[e.fragments.length-1];if(!(f.length===0||!Ce(S?.programDateTime))){this.id3Track||(this.id3Track=this.createTrack(this.media));for(let T=0;T<f.length;T++){const E=f[T],A=d[E],_=A.startTime,R=p[E],w=R?.cues||{};let N=R?.durationKnown||!1,U=Rc;const{duration:D,endDate:F}=A;if(F&&D!==null)U=_+D,N=!0;else if(A.endOnNext&&!N){const M=f.reduce((H,K)=>{if(K!==A.id){const se=d[K];if(se.class===A.class&&se.startDate>A.startDate&&(!H||A.startDate<H.startDate))return se}return H},null);M&&(U=M.startTime,N=!0)}const j=Object.keys(A.attr);for(let M=0;M<j.length;M++){const H=j[M];if(!yw(H))continue;const K=w[H];if(K)N&&!(R!=null&&R.durationKnown)?K.endTime=U:Math.abs(K.startTime-_)>.01&&(K.startTime=_,K.endTime=U);else if(c){let se=A.attr[H];xw(H)&&(se=pS(se));const de=rf(c,_,U,{key:H,data:se},si.dateRange);de&&(de.id=E,this.id3Track.addCue(de),w[H]=de,l&&(H==="X-ASSET-LIST"||H==="X-ASSET-URL")&&de.addEventListener("enter",this.onEventCueEnter))}}p[E]={cues:w,dateRange:A,durationKnown:N}}}}}class ZN{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=()=>{const{media:t}=this,s=this.levelDetails;if(!t||!s)return;this.currentTime=t.currentTime;const n=this.computeLatency();if(n===null)return;this._latency=n;const{lowLatencyMode:r,maxLiveSyncPlaybackRate:l}=this.config;if(!r||l===1||!s.live)return;const c=this.targetLatency;if(c===null)return;const h=n-c,d=Math.min(this.maxLatency,c+s.targetduration);if(h<d&&h>.05&&this.forwardBufferLength>1){const p=Math.min(2,Math.max(1,l)),v=Math.round(2/(1+Math.exp(-.75*h-this.edgeStalled))*20)/20,x=Math.min(p,Math.max(1,v));this.changeMediaPlaybackRate(t,x)}else t.playbackRate!==1&&t.playbackRate!==0&&this.changeMediaPlaybackRate(t,1)},this.hls=e,this.config=e.config,this.registerListeners()}get levelDetails(){var e;return((e=this.hls)==null?void 0:e.latestLevelDetails)||null}get latency(){return this._latency||0}get maxLatency(){const{config:e}=this;if(e.liveMaxLatencyDuration!==void 0)return e.liveMaxLatencyDuration;const t=this.levelDetails;return t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){const e=this.levelDetails;if(e===null||this.hls===null)return null;const{holdBack:t,partHoldBack:s,targetduration:n}=e,{liveSyncDuration:r,liveSyncDurationCount:l,lowLatencyMode:c}=this.config,h=this.hls.userConfig;let d=c&&s||t;(this._targetLatencyUpdated||h.liveSyncDuration||h.liveSyncDurationCount||d===0)&&(d=r!==void 0?r:l*n);const f=n;return d+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,f)}set targetLatency(e){this.stallCount=0,this.config.liveSyncDuration=e,this._targetLatencyUpdated=!0}get liveSyncPosition(){const e=this.estimateLiveEdge(),t=this.targetLatency;if(e===null||t===null)return null;const s=this.levelDetails;if(s===null)return null;const n=s.edge,r=e-t-this.edgeStalled,l=n-s.totalduration,c=n-(this.config.lowLatencyMode&&s.partTarget||s.targetduration);return Math.min(Math.max(l,r),c)}get drift(){const e=this.levelDetails;return e===null?1:e.drift}get edgeStalled(){const e=this.levelDetails;if(e===null)return 0;const t=(this.config.lowLatencyMode&&e.partTarget||e.targetduration)*3;return Math.max(e.age-t,0)}get forwardBufferLength(){const{media:e}=this,t=this.levelDetails;if(!e||!t)return 0;const s=e.buffered.length;return(s?e.buffered.end(s-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null}registerListeners(){const{hls:e}=this;e&&(e.on(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(L.ERROR,this.onError,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(L.ERROR,this.onError,this))}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.onTimeupdate)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)}onManifestLoading(){this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){t.advanced&&this.onTimeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)}onError(e,t){var s;t.details===Q.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&(s=this.levelDetails)!=null&&s.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))}changeMediaPlaybackRate(e,t){var s,n;e.playbackRate!==t&&((s=this.hls)==null||s.logger.debug(`[latency-controller]: latency=${this.latency.toFixed(3)}, targetLatency=${(n=this.targetLatency)==null?void 0:n.toFixed(3)}, forwardBufferLength=${this.forwardBufferLength.toFixed(3)}: adjusting playback rate from ${e.playbackRate} to ${t}`),e.playbackRate=t)}estimateLiveEdge(){const e=this.levelDetails;return e===null?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return e===null?null:e-this.currentTime}}class JN extends pm{constructor(e,t){super(e,"level-controller"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(L.LEVEL_LOADED,this.onLevelLoaded,this),e.on(L.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(L.FRAG_BUFFERED,this.onFragBuffered,this),e.on(L.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(L.LEVEL_LOADED,this.onLevelLoaded,this),e.off(L.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(L.FRAG_BUFFERED,this.onFragBuffered,this),e.off(L.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(t=>{t.loadError=0,t.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){const s=this.hls.config.preferManagedMediaSource,n=[],r={},l={};let c=!1,h=!1,d=!1;t.levels.forEach(f=>{const p=f.attrs;let{audioCodec:v,videoCodec:x}=f;v&&(f.audioCodec=v=Yc(v,s)||void 0),x&&(x=f.videoCodec=P1(x));const{width:S,height:T,unknownCodecs:E}=f,A=E?.length||0;if(c||(c=!!(S&&T)),h||(h=!!x),d||(d=!!v),A||v&&!this.isAudioSupported(v)||x&&!this.isVideoSupported(x)){this.log(`Some or all CODECS not supported "${p.CODECS}"`);return}const{CODECS:_,"FRAME-RATE":R,"HDCP-LEVEL":w,"PATHWAY-ID":N,RESOLUTION:U,"VIDEO-RANGE":D}=p,j=`${`${N||"."}-`}${f.bitrate}-${U}-${R}-${_}-${D}-${w}`;if(r[j])if(r[j].uri!==f.url&&!f.attrs["PATHWAY-ID"]){const M=l[j]+=1;f.attrs["PATHWAY-ID"]=new Array(M+1).join(".");const H=this.createLevel(f);r[j]=H,n.push(H)}else r[j].addGroupId("audio",p.AUDIO),r[j].addGroupId("text",p.SUBTITLES);else{const M=this.createLevel(f);r[j]=M,l[j]=1,n.push(M)}}),this.filterAndSortMediaOptions(n,t,c,h,d)}createLevel(e){const t=new Pl(e),s=e.supplemental;if(s!=null&&s.videoCodec&&!this.isVideoSupported(s.videoCodec)){const n=new Error(`SUPPLEMENTAL-CODECS not supported "${s.videoCodec}"`);this.log(n.message),t.supportedResult=RS(n,[])}return t}isAudioSupported(e){return Dl(e,"audio",this.hls.config.preferManagedMediaSource)}isVideoSupported(e){return Dl(e,"video",this.hls.config.preferManagedMediaSource)}filterAndSortMediaOptions(e,t,s,n,r){var l;let c=[],h=[],d=e;const f=((l=t.stats)==null?void 0:l.parsing)||{};if((s||n)&&r&&(d=d.filter(({videoCodec:_,videoRange:R,width:w,height:N})=>(!!_||!!(w&&N))&&z1(R))),d.length===0){Promise.resolve().then(()=>{if(this.hls){let _="no level with compatible codecs found in manifest",R=_;t.levels.length&&(R=`one or more CODECS in variant not supported: ${Ot(t.levels.map(N=>N.attrs.CODECS).filter((N,U,D)=>D.indexOf(N)===U))}`,this.warn(R),_+=` (${R})`);const w=new Error(_);this.hls.trigger(L.ERROR,{type:je.MEDIA_ERROR,details:Q.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:w,reason:R})}}),f.end=performance.now();return}t.audioTracks&&(c=t.audioTracks.filter(_=>!_.audioCodec||this.isAudioSupported(_.audioCodec)),vx(c)),t.subtitles&&(h=t.subtitles,vx(h));const p=d.slice(0);d.sort((_,R)=>{if(_.attrs["HDCP-LEVEL"]!==R.attrs["HDCP-LEVEL"])return(_.attrs["HDCP-LEVEL"]||"")>(R.attrs["HDCP-LEVEL"]||"")?1:-1;if(s&&_.height!==R.height)return _.height-R.height;if(_.frameRate!==R.frameRate)return _.frameRate-R.frameRate;if(_.videoRange!==R.videoRange)return qc.indexOf(_.videoRange)-qc.indexOf(R.videoRange);if(_.videoCodec!==R.videoCodec){const w=oy(_.videoCodec),N=oy(R.videoCodec);if(w!==N)return N-w}if(_.uri===R.uri&&_.codecSet!==R.codecSet){const w=Kc(_.codecSet),N=Kc(R.codecSet);if(w!==N)return N-w}return _.averageBitrate!==R.averageBitrate?_.averageBitrate-R.averageBitrate:0});let v=p[0];if(this.steering&&(d=this.steering.filterParsedLevels(d),d.length!==p.length)){for(let _=0;_<p.length;_++)if(p[_].pathwayId===d[0].pathwayId){v=p[_];break}}this._levels=d;for(let _=0;_<d.length;_++)if(d[_]===v){var x;this._firstLevel=_;const R=v.bitrate,w=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${d.length} level(s) found, first bitrate: ${R}`),((x=this.hls.userConfig)==null?void 0:x.abrEwmaDefaultEstimate)===void 0){const N=Math.min(R,this.hls.config.abrEwmaDefaultEstimateMax);N>w&&w===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=N)}break}const S=r&&!n,T=this.hls.config,E=!!(T.audioStreamController&&T.audioTrackController),A={levels:d,audioTracks:c,subtitleTracks:h,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:r,video:n,altAudio:E&&!S&&c.some(_=>!!_.url)};f.end=performance.now(),this.hls.trigger(L.MANIFEST_PARSED,A)}get levels(){return this._levels.length===0?null:this._levels}get loadLevelObj(){return this.currentLevel}get level(){return this.currentLevelIndex}set level(e){const t=this._levels;if(t.length===0)return;if(e<0||e>=t.length){const f=new Error("invalid level idx"),p=e<0;if(this.hls.trigger(L.ERROR,{type:je.OTHER_ERROR,details:Q.LEVEL_SWITCH_ERROR,level:e,fatal:p,error:f,reason:f.message}),p)return;e=Math.min(e,t.length-1)}const s=this.currentLevelIndex,n=this.currentLevel,r=n?n.attrs["PATHWAY-ID"]:void 0,l=t[e],c=l.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=l,s===e&&n&&r===c)return;this.log(`Switching to level ${e} (${l.height?l.height+"p ":""}${l.videoRange?l.videoRange+" ":""}${l.codecSet?l.codecSet+" ":""}@${l.bitrate})${c?" with Pathway "+c:""} from level ${s}${r?" with Pathway "+r:""}`);const h={level:e,attrs:l.attrs,details:l.details,bitrate:l.bitrate,averageBitrate:l.averageBitrate,maxBitrate:l.maxBitrate,realBitrate:l.realBitrate,width:l.width,height:l.height,codecSet:l.codecSet,audioCodec:l.audioCodec,videoCodec:l.videoCodec,audioGroups:l.audioGroups,subtitleGroups:l.subtitleGroups,loaded:l.loaded,loadError:l.loadError,fragmentError:l.fragmentError,name:l.name,id:l.id,uri:l.uri,url:l.url,urlId:0,audioGroupIds:l.audioGroupIds,textGroupIds:l.textGroupIds};this.hls.trigger(L.LEVEL_SWITCHING,h);const d=l.details;if(!d||d.live){const f=this.switchParams(l.uri,n?.details,d);this.loadPlaylist(f)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,this._startLevel===void 0&&(this._startLevel=e),e!==-1&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(this._startLevel===void 0){const e=this.hls.config.startLevel;return e!==void 0?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}get pathways(){return this.steering?this.steering.pathways():[]}get pathwayPriority(){return this.steering?this.steering.pathwayPriority:null}set pathwayPriority(e){if(this.steering){const t=this.steering.pathways(),s=e.filter(n=>t.indexOf(n)!==-1);if(e.length<1){this.warn(`pathwayPriority ${e} should contain at least one pathway from list: ${t}`);return}this.steering.pathwayPriority=s}}onError(e,t){t.fatal||!t.context||t.context.type===tt.LEVEL&&t.context.level===this.level&&this.checkRetry(t)}onFragBuffered(e,{frag:t}){if(t!==void 0&&t.type===ke.MAIN){const s=t.elementaryStreams;if(!Object.keys(s).some(r=>!!s[r]))return;const n=this._levels[t.level];n!=null&&n.loadError&&(this.log(`Resetting level error count of ${n.loadError} on frag buffered`),n.loadError=0)}}onLevelLoaded(e,t){var s;const{level:n,details:r}=t,l=t.levelInfo;if(!l){var c;this.warn(`Invalid level index ${n}`),(c=t.deliveryDirectives)!=null&&c.skip&&(r.deltaUpdateFailed=!0);return}if(l===this.currentLevel||t.withoutMultiVariant){l.fragmentError===0&&(l.loadError=0);let h=l.details;h===t.details&&h.advanced&&(h=void 0),this.playlistLoaded(n,t,h)}else(s=t.deliveryDirectives)!=null&&s.skip&&(r.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const s=this.getUrlWithDirectives(e.uri,t),n=this.currentLevelIndex,r=e.attrs["PATHWAY-ID"],l=e.details,c=l?.age;this.log(`Loading level index ${n}${t?.msn!==void 0?" at sn "+t.msn+" part "+t.part:""}${r?" Pathway "+r:""}${c&&l.live?" age "+c.toFixed(1)+(l.type&&" "+l.type||""):""} ${s}`),this.hls.trigger(L.LEVEL_LOADING,{url:s,level:n,levelInfo:e,pathwayId:e.attrs["PATHWAY-ID"],id:0,deliveryDirectives:t||null})}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=e)}removeLevel(e){var t;if(this._levels.length===1)return;const s=this._levels.filter((r,l)=>l!==e?!0:(this.steering&&this.steering.removeLevel(r),r===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,r.details&&r.details.fragments.forEach(c=>c.level=-1)),!1));qS(s),this._levels=s,this.currentLevelIndex>-1&&(t=this.currentLevel)!=null&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);const n=s.length-1;this._firstLevel=Math.min(this._firstLevel,n),this._startLevel&&(this._startLevel=Math.min(this._startLevel,n)),this.hls.trigger(L.LEVELS_UPDATED,{levels:s})}onLevelsUpdated(e,{levels:t}){this._levels=t}checkMaxAutoUpdated(){const{autoLevelCapping:e,maxAutoLevel:t,maxHdcpLevel:s}=this.hls;this._maxAutoLevel!==t&&(this._maxAutoLevel=t,this.hls.trigger(L.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:t,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:s}))}}function vx(i){const e={};i.forEach(t=>{const s=t.groupId||"";t.id=e[s]=e[s]||0,e[s]++})}function Gb(){return self.SourceBuffer||self.WebKitSourceBuffer}function Hb(){if(!ea())return!1;const e=Gb();return!e||e.prototype&&typeof e.prototype.appendBuffer=="function"&&typeof e.prototype.remove=="function"}function eD(){if(!Hb())return!1;const i=ea();return typeof i?.isTypeSupported=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(e=>i.isTypeSupported(kl(e,"video")))||["mp4a.40.2","fLaC"].some(e=>i.isTypeSupported(kl(e,"audio"))))}function tD(){var i;const e=Gb();return typeof(e==null||(i=e.prototype)==null?void 0:i.changeType)=="function"}const sD=100;class iD extends lm{constructor(e,t,s){super(e,t,s,"stream-controller",ke.MAIN),this.audioCodecSwap=!1,this.level=-1,this._forceStartLoad=!1,this._hasEnoughToStart=!1,this.altAudio=0,this.audioOnly=!1,this.fragPlaying=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this.onMediaPlaying=()=>{this.tick()},this.onMediaSeeked=()=>{const n=this.media,r=n?n.currentTime:null;if(r===null||!Ce(r)||(this.log(`Media seeked to ${r.toFixed(3)}`),!this.getBufferedFrag(r)))return;const l=this.getFwdBufferInfoAtPos(n,r,ke.MAIN,0);if(l===null||l.len===0){this.warn(`Main forward buffer length at ${r} on "seeked" event ${l?l.len:"empty"})`);return}this.tick()},this.registerListeners()}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(L.MANIFEST_PARSED,this.onManifestParsed,this),e.on(L.LEVEL_LOADING,this.onLevelLoading,this),e.on(L.LEVEL_LOADED,this.onLevelLoaded,this),e.on(L.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(L.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(L.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(L.BUFFER_CREATED,this.onBufferCreated,this),e.on(L.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(L.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(L.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(L.MANIFEST_PARSED,this.onManifestParsed,this),e.off(L.LEVEL_LOADED,this.onLevelLoaded,this),e.off(L.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(L.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(L.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(L.BUFFER_CREATED,this.onBufferCreated,this),e.off(L.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(L.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(L.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),super.onHandlerDestroying()}startLoad(e,t){if(this.levels){const{lastCurrentTime:s,hls:n}=this;if(this.stopLoad(),this.setInterval(sD),this.level=-1,!this.startFragRequested){let r=n.startLevel;r===-1&&(n.config.testBandwidth&&this.levels.length>1?(r=0,this.bitrateTest=!0):r=n.firstAutoLevel),n.nextLoadLevel=r,this.level=n.loadLevel,this._hasEnoughToStart=!!t}s>0&&e===-1&&!t&&(this.log(`Override startPosition with lastCurrentTime @${s.toFixed(3)}`),e=s),this.state=re.IDLE,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}else this._forceStartLoad=!0,this.state=re.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case re.WAITING_LEVEL:{const{levels:e,level:t}=this,s=e?.[t],n=s?.details;if(n&&(!n.live||this.levelLastLoaded===s&&!this.waitForLive(s))){if(this.waitForCdnTuneIn(n))break;this.state=re.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=re.IDLE;break}break}case re.FRAG_LOADING_WAITING_RETRY:this.checkRetryDate();break}this.state===re.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){var e;super.onTickEnd(),(e=this.media)!=null&&e.readyState&&this.media.seeking===!1&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:t,levels:s,media:n}=this;if(t===null||!n&&!this.primaryPrefetch&&(this.startFragRequested||!e.config.startFragPrefetch)||this.altAudio&&this.audioOnly)return;const r=this.buffering?e.nextLoadLevel:e.loadLevel;if(!(s!=null&&s[r]))return;const l=s[r],c=this.getMainFwdBufferInfo();if(c===null)return;const h=this.getLevelDetails();if(h&&this._streamEnded(c,h)){const T={};this.altAudio===2&&(T.type="video"),this.hls.trigger(L.BUFFER_EOS,T),this.state=re.ENDED;return}if(!this.buffering)return;e.loadLevel!==r&&e.manualLevel===-1&&this.log(`Adapting to level ${r} from level ${this.level}`),this.level=e.nextLoadLevel=r;const d=l.details;if(!d||this.state===re.WAITING_LEVEL||this.waitForLive(l)){this.level=r,this.state=re.WAITING_LEVEL,this.startFragRequested=!1;return}const f=c.len,p=this.getMaxBufferLength(l.maxBitrate);if(f>=p)return;this.backtrackFragment&&this.backtrackFragment.start>c.end&&(this.backtrackFragment=null);const v=this.backtrackFragment?this.backtrackFragment.start:c.end;let x=this.getNextFragment(v,d);if(this.couldBacktrack&&!this.fragPrevious&&x&&Qt(x)&&this.fragmentTracker.getState(x)!==ls.OK){var S;const E=((S=this.backtrackFragment)!=null?S:x).sn-d.startSN,A=d.fragments[E-1];A&&x.cc===A.cc&&(x=A,this.fragmentTracker.removeFragment(A))}else this.backtrackFragment&&c.len&&(this.backtrackFragment=null);if(x&&this.isLoopLoading(x,v)){if(!x.gap){const E=this.audioOnly&&!this.altAudio?Ct.AUDIO:Ct.VIDEO,A=(E===Ct.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;A&&this.afterBufferFlushed(A,E,ke.MAIN)}x=this.getNextFragmentLoopLoading(x,d,c,ke.MAIN,p)}x&&(x.initSegment&&!x.initSegment.data&&!this.bitrateTest&&(x=x.initSegment),this.loadFragment(x,l,v))}loadFragment(e,t,s){const n=this.fragmentTracker.getState(e);n===ls.NOT_LOADED||n===ls.PARTIAL?Qt(e)?this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):super.loadFragment(e,t,s):this._loadInitSegment(e,t):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,ke.MAIN)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:t}=this;if(t!=null&&t.readyState){let s;const n=this.getAppendedFrag(t.currentTime);n&&n.start>1&&this.flushMainBuffer(0,n.start-1);const r=this.getLevelDetails();if(r!=null&&r.live){const c=this.getMainFwdBufferInfo();if(!c||c.len<r.targetduration*2)return}if(!t.paused&&e){const c=this.hls.nextLoadLevel,h=e[c],d=this.fragLastKbps;d&&this.fragCurrent?s=this.fragCurrent.duration*h.maxBitrate/(1e3*d)+1:s=0}else s=0;const l=this.getBufferedFrag(t.currentTime+s);if(l){const c=this.followingBufferedFrag(l);if(c){this.abortCurrentFrag();const h=c.maxStartPTS?c.maxStartPTS:c.start,d=c.duration,f=Math.max(l.end,h+Math.min(Math.max(d-this.config.maxFragLookUpTolerance,d*(this.couldBacktrack?.5:.125)),d*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(f,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case re.KEY_LOADING:case re.FRAG_LOADING:case re.FRAG_LOADING_WAITING_RETRY:case re.PARSING:case re.PARSED:this.state=re.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,this.altAudio===2?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);const s=t.media;Cs(s,"playing",this.onMediaPlaying),Cs(s,"seeked",this.onMediaSeeked)}onMediaDetaching(e,t){const{media:s}=this;s&&($s(s,"playing",this.onMediaPlaying),$s(s,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,super.onMediaDetaching(e,t),!t.transferMedia&&(this._hasEnoughToStart=!1)}onManifestLoading(){super.onManifestLoading(),this.log("Trigger BUFFER_RESET"),this.hls.trigger(L.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1}onManifestParsed(e,t){let s=!1,n=!1;for(let r=0;r<t.levels.length;r++){const l=t.levels[r].audioCodec;l&&(s=s||l.indexOf("mp4a.40.2")!==-1,n=n||l.indexOf("mp4a.40.5")!==-1)}this.audioCodecSwitch=s&&n&&!tD(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){const{levels:s}=this;if(!s||this.state!==re.IDLE)return;const n=t.levelInfo;(!n.details||n.details.live&&(this.levelLastLoaded!==n||n.details.expired)||this.waitForCdnTuneIn(n.details))&&(this.state=re.WAITING_LEVEL)}onLevelLoaded(e,t){var s;const{levels:n,startFragRequested:r}=this,l=t.level,c=t.details,h=c.totalduration;if(!n){this.warn(`Levels were reset while loading level ${l}`);return}this.log(`Level ${l} loaded [${c.startSN},${c.endSN}]${c.lastPartSn?`[part-${c.lastPartSn}-${c.lastPartIndex}]`:""}, cc [${c.startCC}, ${c.endCC}] duration:${h}`);const d=t.levelInfo,f=this.fragCurrent;f&&(this.state===re.FRAG_LOADING||this.state===re.FRAG_LOADING_WAITING_RETRY)&&f.level!==t.level&&f.loader&&this.abortCurrentFrag();let p=0;if(c.live||(s=d.details)!=null&&s.live){var v;if(this.checkLiveUpdate(c),c.deltaUpdateFailed)return;p=this.alignPlaylists(c,d.details,(v=this.levelLastLoaded)==null?void 0:v.details)}if(d.details=c,this.levelLastLoaded=d,r||this.setStartPosition(c,p),this.hls.trigger(L.LEVEL_UPDATED,{details:c,level:l}),this.state===re.WAITING_LEVEL){if(this.waitForCdnTuneIn(c))return;this.state=re.IDLE}r&&c.live&&this.synchronizeToLiveEdge(c),this.tick()}synchronizeToLiveEdge(e){const{config:t,media:s}=this;if(!s)return;const n=this.hls.liveSyncPosition,r=this.getLoadPosition(),l=e.fragmentStart,c=e.edge,h=r>=l-t.maxFragLookUpTolerance&&r<=c;if(n!==null&&s.duration>n&&(r<n||!h)){const f=t.liveMaxLatencyDuration!==void 0?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;if((!h&&s.readyState<4||r<c-f)&&(this._hasEnoughToStart||(this.nextLoadPosition=n),s.readyState))if(this.warn(`Playback: ${r.toFixed(3)} is located too far from the end of live sliding playlist: ${c}, reset currentTime to : ${n.toFixed(3)}`),this.config.liveSyncMode==="buffered"){var d;const p=qe.bufferInfo(s,n,0);if(!((d=p.buffered)!=null&&d.length)){s.currentTime=n;return}if(p.start<=r){s.currentTime=n;return}const{nextStart:x}=qe.bufferedInfo(p.buffered,r,0);x&&(s.currentTime=x)}else s.currentTime=n}}_handleFragmentLoadProgress(e){var t;const s=e.frag,{part:n,payload:r}=e,{levels:l}=this;if(!l){this.warn(`Levels were reset while fragment load was in progress. Fragment ${s.sn} of level ${s.level} will not be buffered`);return}const c=l[s.level];if(!c){this.warn(`Level ${s.level} not found on progress`);return}const h=c.details;if(!h){this.warn(`Dropping fragment ${s.sn} of level ${s.level} after level details were reset`),this.fragmentTracker.removeFragment(s);return}const d=c.videoCodec,f=h.PTSKnown||!h.live,p=(t=s.initSegment)==null?void 0:t.data,v=this._getAudioCodec(c),x=this.transmuxer=this.transmuxer||new gb(this.hls,ke.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),S=n?n.index:-1,T=S!==-1,E=new nm(s.level,s.sn,s.stats.chunkCount,r.byteLength,S,T),A=this.initPTS[s.cc];x.push(r,p,v,d,s,n,h.totalduration,f,E,A)}onAudioTrackSwitching(e,t){const s=this.hls,n=this.altAudio!==0;if(Qc(t.url,s))this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const l=this.fragCurrent;l&&(this.log("Switching to main audio track, cancel main fragment load"),l.abortRequests(),this.fragmentTracker.removeFragment(l)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(n){this.altAudio=0,this.fragmentTracker.removeAllFragments(),s.once(L.BUFFER_FLUSHED,()=>{this.hls&&this.hls.trigger(L.AUDIO_TRACK_SWITCHED,t)}),s.trigger(L.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});return}s.trigger(L.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){const s=Qc(t.url,this.hls);if(s){const n=this.videoBuffer;n&&this.mediaBuffer!==n&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=n)}this.altAudio=s?2:0,this.tick()}onBufferCreated(e,t){const s=t.tracks;let n,r,l=!1;for(const c in s){const h=s[c];if(h.id==="main"){if(r=c,n=h,c==="video"){const d=s[c];d&&(this.videoBuffer=d.buffer)}}else l=!0}l&&n?(this.log(`Alternate track found, use ${r}.buffered to schedule main fragment loading`),this.mediaBuffer=n.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){const{frag:s,part:n}=t,r=s.type===ke.MAIN;if(r){if(this.fragContextChanged(s)){this.warn(`Fragment ${s.sn}${n?" p: "+n.index:""} of level ${s.level} finished buffering, but was aborted. state: ${this.state}`),this.state===re.PARSED&&(this.state=re.IDLE);return}const c=n?n.stats:s.stats;this.fragLastKbps=Math.round(8*c.total/(c.buffering.end-c.loading.first)),Qt(s)&&(this.fragPrevious=s),this.fragBufferedComplete(s,n)}const l=this.media;l&&(!this._hasEnoughToStart&&qe.getBuffered(l).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),r&&this.tick())}get hasEnoughToStart(){return this._hasEnoughToStart}onError(e,t){var s;if(t.fatal){this.state=re.ERROR;return}switch(t.details){case Q.FRAG_GAP:case Q.FRAG_PARSING_ERROR:case Q.FRAG_DECRYPT_ERROR:case Q.FRAG_LOAD_ERROR:case Q.FRAG_LOAD_TIMEOUT:case Q.KEY_LOAD_ERROR:case Q.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(ke.MAIN,t);break;case Q.LEVEL_LOAD_ERROR:case Q.LEVEL_LOAD_TIMEOUT:case Q.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===re.WAITING_LEVEL&&((s=t.context)==null?void 0:s.type)===tt.LEVEL&&(this.state=re.IDLE);break;case Q.BUFFER_ADD_CODEC_ERROR:case Q.BUFFER_APPEND_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&this.resetLoadingState();break;case Q.BUFFER_FULL_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&(!this.config.interstitialsController&&this.config.assetPlayerId?this._hasEnoughToStart=!0:this.flushMainBuffer(0,Number.POSITIVE_INFINITY));break;case Q.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onFragLoadEmergencyAborted(){this.state=re.IDLE,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()}onBufferFlushed(e,{type:t}){if(t!==Ct.AUDIO||!this.altAudio){const s=(t===Ct.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;s&&(this.afterBufferFlushed(s,t,ke.MAIN),this.tick())}}onLevelsUpdated(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,this.level===-1&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const t=e.currentTime;let s=this.startPosition;if(s>=0&&t<s){if(e.seeking){this.log(`could not seek to ${s}, already seeking at ${t}`);return}const n=this.timelineOffset;n&&s&&(s+=n);const r=this.getLevelDetails(),l=qe.getBuffered(e),c=l.length?l.start(0):0,h=c-s,d=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);(this.config.startOnSegmentBoundary||h>0&&(h<d||this.loadingParts&&h<2*(r?.partTarget||0)))&&(this.log(`adjusting start position by ${h} to match buffer start`),s+=h,this.startPosition=s),t<s&&(this.log(`seek to target start position ${s} from current time ${t} buffer start ${c}`),e.currentTime=s)}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t.indexOf("mp4a.40.5")!==-1?t="mp4a.40.2":t="mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then(s=>{const{hls:n}=this,r=s?.frag;if(!r||this.fragContextChanged(r))return;t.fragmentError=0,this.state=re.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const l=r.stats;l.parsing.start=l.parsing.end=l.buffering.start=l.buffering.end=self.performance.now(),n.trigger(L.FRAG_LOADED,s),r.bitrateTest=!1}).catch(s=>{this.state===re.STOPPED||this.state===re.ERROR||(this.warn(s),this.resetFragmentLoading(e))})}_handleTransmuxComplete(e){const t=this.playlistType,{hls:s}=this,{remuxResult:n,chunkMeta:r}=e,l=this.getCurrentContext(r);if(!l){this.resetWhenMissingContext(r);return}const{frag:c,part:h,level:d}=l,{video:f,text:p,id3:v,initSegment:x}=n,{details:S}=d,T=this.altAudio?void 0:n.audio;if(this.fragContextChanged(c)){this.fragmentTracker.removeFragment(c);return}if(this.state=re.PARSING,x){const E=x.tracks;if(E){const w=c.initSegment||c;if(this.unhandledEncryptionError(x,c))return;this._bufferInitSegment(d,E,w,r),s.trigger(L.FRAG_PARSING_INIT_SEGMENT,{frag:w,id:t,tracks:E})}const A=x.initPTS,_=x.timescale,R=this.initPTS[c.cc];if(Ce(A)&&(!R||R.baseTime!==A||R.timescale!==_)){const w=x.trackId;this.initPTS[c.cc]={baseTime:A,timescale:_,trackId:w},s.trigger(L.INIT_PTS_FOUND,{frag:c,id:t,initPTS:A,timescale:_,trackId:w})}}if(f&&S){T&&f.type==="audiovideo"&&this.logMuxedErr(c);const E=S.fragments[c.sn-1-S.startSN],A=c.sn===S.startSN,_=!E||c.cc>E.cc;if(n.independent!==!1){const{startPTS:R,endPTS:w,startDTS:N,endDTS:U}=f;if(h)h.elementaryStreams[f.type]={startPTS:R,endPTS:w,startDTS:N,endDTS:U};else if(f.firstKeyFrame&&f.independent&&r.id===1&&!_&&(this.couldBacktrack=!0),f.dropped&&f.independent){const D=this.getMainFwdBufferInfo(),F=(D?D.end:this.getLoadPosition())+this.config.maxBufferHole,j=f.firstKeyFramePTS?f.firstKeyFramePTS:R;if(!A&&F<j-this.config.maxBufferHole&&!_){this.backtrack(c);return}else _&&(c.gap=!0);c.setElementaryStreamInfo(f.type,c.start,w,c.start,U,!0)}else A&&R-(S.appliedTimelineOffset||0)>Bc&&(c.gap=!0);c.setElementaryStreamInfo(f.type,R,w,N,U),this.backtrackFragment&&(this.backtrackFragment=c),this.bufferFragmentData(f,c,h,r,A||_)}else if(A||_)c.gap=!0;else{this.backtrack(c);return}}if(T){const{startPTS:E,endPTS:A,startDTS:_,endDTS:R}=T;h&&(h.elementaryStreams[Ct.AUDIO]={startPTS:E,endPTS:A,startDTS:_,endDTS:R}),c.setElementaryStreamInfo(Ct.AUDIO,E,A,_,R),this.bufferFragmentData(T,c,h,r)}if(S&&v!=null&&v.samples.length){const E={id:t,frag:c,details:S,samples:v.samples};s.trigger(L.FRAG_PARSING_METADATA,E)}if(S&&p){const E={id:t,frag:c,details:S,samples:p.samples};s.trigger(L.FRAG_PARSING_USERDATA,E)}}logMuxedErr(e){this.warn(`${Qt(e)?"Media":"Init"} segment with muxed audiovideo where only video expected: ${e.url}`)}_bufferInitSegment(e,t,s,n){if(this.state!==re.PARSING)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&(delete t.audio,t.audiovideo&&this.logMuxedErr(s));const{audio:r,video:l,audiovideo:c}=t;if(r){const d=e.audioCodec;let f=Dc(r.codec,d);f==="mp4a"&&(f="mp4a.40.5");const p=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){f&&(f.indexOf("mp4a.40.5")!==-1?f="mp4a.40.2":f="mp4a.40.5");const v=r.metadata;v&&"channelCount"in v&&(v.channelCount||1)!==1&&p.indexOf("firefox")===-1&&(f="mp4a.40.5")}f&&f.indexOf("mp4a.40.5")!==-1&&p.indexOf("android")!==-1&&r.container!=="audio/mpeg"&&(f="mp4a.40.2",this.log(`Android: force audio codec to ${f}`)),d&&d!==f&&this.log(`Swapping manifest audio codec "${d}" for "${f}"`),r.levelCodec=f,r.id=ke.MAIN,this.log(`Init audio buffer, container:${r.container}, codecs[selected/level/parsed]=[${f||""}/${d||""}/${r.codec}]`),delete t.audiovideo}if(l){l.levelCodec=e.videoCodec,l.id=ke.MAIN;const d=l.codec;if(d?.length===4)switch(d){case"hvc1":case"hev1":l.codec="hvc1.1.6.L120.90";break;case"av01":l.codec="av01.0.04M.08";break;case"avc1":l.codec="avc1.42e01e";break}this.log(`Init video buffer, container:${l.container}, codecs[level/parsed]=[${e.videoCodec||""}/${d}]${l.codec!==d?" parsed-corrected="+l.codec:""}${l.supplemental?" supplemental="+l.supplemental:""}`),delete t.audiovideo}c&&(this.log(`Init audiovideo buffer, container:${c.container}, codecs[level/parsed]=[${e.codecs}/${c.codec}]`),delete t.video,delete t.audio);const h=Object.keys(t);if(h.length){if(this.hls.trigger(L.BUFFER_CODECS,t),!this.hls)return;h.forEach(d=>{const p=t[d].initSegment;p!=null&&p.byteLength&&this.hls.trigger(L.BUFFER_APPENDING,{type:d,data:p,frag:s,part:null,chunkMeta:n,parent:s.type})})}this.tickImmediate()}getMainFwdBufferInfo(){const e=this.mediaBuffer&&this.altAudio===2?this.mediaBuffer:this.media;return this.getFwdBufferInfo(e,ke.MAIN)}get maxBufferLength(){const{levels:e,level:t}=this,s=e?.[t];return s?this.getMaxBufferLength(s.maxBitrate):this.config.maxBufferLength}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=re.IDLE}checkFragmentChanged(){const e=this.media;let t=null;if(e&&e.readyState>1&&e.seeking===!1){const s=e.currentTime;if(qe.isBuffered(e,s)?t=this.getAppendedFrag(s):qe.isBuffered(e,s+.1)&&(t=this.getAppendedFrag(s+.1)),t){this.backtrackFragment=null;const n=this.fragPlaying,r=t.level;(!n||t.sn!==n.sn||n.level!==r)&&(this.fragPlaying=t,this.hls.trigger(L.FRAG_CHANGED,{frag:t}),(!n||n.level!==r)&&this.hls.trigger(L.LEVEL_SWITCHED,{level:r}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){var e;if(this.fragPlaying)return this.fragPlaying;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;return Ce(t)?this.getAppendedFrag(t):null}get currentProgramDateTime(){var e;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;if(Ce(t)){const s=this.getLevelDetails(),n=this.currentFrag||(s?La(null,s.fragments,t):null);if(n){const r=n.programDateTime;if(r!==null){const l=r+(t-n.start)*1e3;return new Date(l)}}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class nD extends Ti{constructor(e,t){super("key-loader",t),this.config=void 0,this.keyIdToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const s in this.keyIdToKeyInfo){const n=this.keyIdToKeyInfo[s].loader;if(n){var t;if(e&&e!==((t=n.context)==null?void 0:t.frag.type))return;n.abort()}}}detach(){for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyIdToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e].loader;t&&t.destroy()}this.keyIdToKeyInfo={}}createKeyLoadError(e,t=Q.KEY_LOAD_ERROR,s,n,r){return new yn({type:je.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:r,error:s,networkDetails:n})}loadClear(e,t,s){if(this.emeController&&this.config.emeEnabled&&!this.emeController.getSelectedKeySystemFormats().length){if(t.length)for(let n=0,r=t.length;n<r;n++){const l=t[n];if(e.cc<=l.cc&&(!Qt(e)||!Qt(l)||e.sn<l.sn)||!s&&n==r-1)return this.emeController.selectKeySystemFormat(l).then(c=>{if(!this.emeController)return;l.setKeyFormat(c);const h=Pc(c);if(h)return this.emeController.getKeySystemAccess([h])})}if(this.config.requireKeySystemAccessOnStart){const n=Ll(this.config);if(n.length)return this.emeController.getKeySystemAccess(n)}}return null}load(e){return!e.decryptdata&&e.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(e).then(t=>this.loadInternal(e,t)):this.loadInternal(e)}loadInternal(e,t){var s,n;t&&e.setKeyFormat(t);const r=e.decryptdata;if(!r){const d=new Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:`Missing decryption data on fragment in onKeyLoading (emeEnabled with controller: ${this.emeController&&this.config.emeEnabled})`);return Promise.reject(this.createKeyLoadError(e,Q.KEY_LOAD_ERROR,d))}const l=r.uri;if(!l)return Promise.reject(this.createKeyLoadError(e,Q.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${l}"`)));const c=lf(r);let h=this.keyIdToKeyInfo[c];if((s=h)!=null&&s.decryptdata.key)return r.key=h.decryptdata.key,Promise.resolve({frag:e,keyInfo:h});if(this.emeController&&(n=h)!=null&&n.keyLoadPromise)switch(this.emeController.getKeyStatus(h.decryptdata)){case"usable":case"usable-in-future":return h.keyLoadPromise.then(f=>{const{keyInfo:p}=f;return r.key=p.decryptdata.key,{frag:e,keyInfo:p}})}switch(this.log(`${this.keyIdToKeyInfo[c]?"Rel":"L"}oading${r.keyId?" keyId: "+vs(r.keyId):""} URI: ${r.uri} from ${e.type} ${e.level}`),h=this.keyIdToKeyInfo[c]={decryptdata:r,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},r.method){case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return r.keyFormat==="identity"?this.loadKeyHTTP(h,e):this.loadKeyEME(h,e);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(h,e);default:return Promise.reject(this.createKeyLoadError(e,Q.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${r.method}"`)))}}loadKeyEME(e,t){const s={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){var n;if(!e.decryptdata.keyId&&(n=t.initSegment)!=null&&n.data){const l=T1(t.initSegment.data);if(l.length){let c=l[0];c.some(h=>h!==0)?(this.log(`Using keyId found in init segment ${vs(c)}`),Jn.setKeyIdForUri(e.decryptdata.uri,c)):(c=Jn.addKeyIdForUri(e.decryptdata.uri),this.log(`Generating keyId to patch media ${vs(c)}`)),e.decryptdata.keyId=c}}if(!e.decryptdata.keyId&&!Qt(t))return Promise.resolve(s);const r=this.emeController.loadKey(s);return(e.keyLoadPromise=r.then(l=>(e.mediaKeySessionContext=l,s))).catch(l=>{throw e.keyLoadPromise=null,"data"in l&&(l.data.frag=t),l})}return Promise.resolve(s)}loadKeyHTTP(e,t){const s=this.config,n=s.loader,r=new n(s);return t.keyLoader=e.loader=r,e.keyLoadPromise=new Promise((l,c)=>{const h={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},d=s.keyLoadPolicy.default,f={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},p={onSuccess:(v,x,S,T)=>{const{frag:E,keyInfo:A}=S,_=lf(A.decryptdata);if(!E.decryptdata||A!==this.keyIdToKeyInfo[_])return c(this.createKeyLoadError(E,Q.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),T));A.decryptdata.key=E.decryptdata.key=new Uint8Array(v.data),E.keyLoader=null,A.loader=null,l({frag:E,keyInfo:A})},onError:(v,x,S,T)=>{this.resetLoader(x),c(this.createKeyLoadError(t,Q.KEY_LOAD_ERROR,new Error(`HTTP Error ${v.code} loading key ${v.text}`),S,vt({url:h.url,data:void 0},v)))},onTimeout:(v,x,S)=>{this.resetLoader(x),c(this.createKeyLoadError(t,Q.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),S))},onAbort:(v,x,S)=>{this.resetLoader(x),c(this.createKeyLoadError(t,Q.INTERNAL_ABORTED,new Error("key loading aborted"),S))}};r.load(h,f,p)})}resetLoader(e){const{frag:t,keyInfo:s,url:n}=e,r=s.loader;t.keyLoader===r&&(t.keyLoader=null,s.loader=null);const l=lf(s.decryptdata)||n;delete this.keyIdToKeyInfo[l],r&&r.destroy()}}function lf(i){if(i.keyFormat!==ys.FAIRPLAY){const e=i.keyId;if(e)return vs(e)}return i.uri}function yx(i){const{type:e}=i;switch(e){case tt.AUDIO_TRACK:return ke.AUDIO;case tt.SUBTITLE_TRACK:return ke.SUBTITLE;default:return ke.MAIN}}function of(i,e){let t=i.url;return(t===void 0||t.indexOf("data:")===0)&&(t=e.url),t}class aD{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.LEVEL_LOADING,this.onLevelLoading,this),e.on(L.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(L.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.on(L.LEVELS_UPDATED,this.onLevelsUpdated,this)}unregisterListeners(){const{hls:e}=this;e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.LEVEL_LOADING,this.onLevelLoading,this),e.off(L.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(L.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.off(L.LEVELS_UPDATED,this.onLevelsUpdated,this)}createInternalLoader(e){const t=this.hls.config,s=t.pLoader,n=t.loader,r=s||n,l=new r(t);return this.loaders[e.type]=l,l}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){const{url:s}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:tt.MANIFEST,url:s,deliveryDirectives:null,levelOrTrack:null})}onLevelLoading(e,t){const{id:s,level:n,pathwayId:r,url:l,deliveryDirectives:c,levelInfo:h}=t;this.load({id:s,level:n,pathwayId:r,responseType:"text",type:tt.LEVEL,url:l,deliveryDirectives:c,levelOrTrack:h})}onAudioTrackLoading(e,t){const{id:s,groupId:n,url:r,deliveryDirectives:l,track:c}=t;this.load({id:s,groupId:n,level:null,responseType:"text",type:tt.AUDIO_TRACK,url:r,deliveryDirectives:l,levelOrTrack:c})}onSubtitleTrackLoading(e,t){const{id:s,groupId:n,url:r,deliveryDirectives:l,track:c}=t;this.load({id:s,groupId:n,level:null,responseType:"text",type:tt.SUBTITLE_TRACK,url:r,deliveryDirectives:l,levelOrTrack:c})}onLevelsUpdated(e,t){const s=this.loaders[tt.LEVEL];if(s){const n=s.context;n&&!t.levels.some(r=>r===n.levelOrTrack)&&(s.abort(),delete this.loaders[tt.LEVEL])}}load(e){var t;const s=this.hls.config;let n=this.getInternalLoader(e);if(n){const d=this.hls.logger,f=n.context;if(f&&f.levelOrTrack===e.levelOrTrack&&(f.url===e.url||f.deliveryDirectives&&!e.deliveryDirectives)){f.url===e.url?d.log(`[playlist-loader]: ignore ${e.url} ongoing request`):d.log(`[playlist-loader]: ignore ${e.url} in favor of ${f.url}`);return}d.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),n.abort()}let r;if(e.type===tt.MANIFEST?r=s.manifestLoadPolicy.default:r=At({},s.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),n=this.createInternalLoader(e),Ce((t=e.deliveryDirectives)==null?void 0:t.part)){let d;if(e.type===tt.LEVEL&&e.level!==null?d=this.hls.levels[e.level].details:e.type===tt.AUDIO_TRACK&&e.id!==null?d=this.hls.audioTracks[e.id].details:e.type===tt.SUBTITLE_TRACK&&e.id!==null&&(d=this.hls.subtitleTracks[e.id].details),d){const f=d.partTarget,p=d.targetduration;if(f&&p){const v=Math.max(f*3,p*.8)*1e3;r=At({},r,{maxTimeToFirstByteMs:Math.min(v,r.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(v,r.maxTimeToFirstByteMs)})}}}const l=r.errorRetry||r.timeoutRetry||{},c={loadPolicy:r,timeout:r.maxLoadTimeMs,maxRetry:l.maxNumRetry||0,retryDelay:l.retryDelayMs||0,maxRetryDelay:l.maxRetryDelayMs||0},h={onSuccess:(d,f,p,v)=>{const x=this.getInternalLoader(p);this.resetInternalLoader(p.type);const S=d.data;f.parsing.start=performance.now(),Hi.isMediaPlaylist(S)||p.type!==tt.MANIFEST?this.handleTrackOrLevelPlaylist(d,f,p,v||null,x):this.handleMasterPlaylist(d,f,p,v)},onError:(d,f,p,v)=>{this.handleNetworkError(f,p,!1,d,v)},onTimeout:(d,f,p)=>{this.handleNetworkError(f,p,!0,void 0,d)}};n.load(e,c,h)}checkAutostartLoad(){if(!this.hls)return;const{config:{autoStartLoad:e,startPosition:t},forceStartLoad:s}=this.hls;(e||s)&&(this.hls.logger.log(`${e?"auto":"force"} startLoad with configured startPosition ${t}`),this.hls.startLoad(t))}handleMasterPlaylist(e,t,s,n){const r=this.hls,l=e.data,c=of(e,s),h=Hi.parseMasterPlaylist(l,c);if(h.playlistParsingError){t.parsing.end=performance.now(),this.handleManifestParsingError(e,s,h.playlistParsingError,n,t);return}const{contentSteering:d,levels:f,sessionData:p,sessionKeys:v,startTimeOffset:x,variableList:S}=h;this.variableList=S,f.forEach(_=>{const{unknownCodecs:R}=_;if(R){const{preferManagedMediaSource:w}=this.hls.config;let{audioCodec:N,videoCodec:U}=_;for(let D=R.length;D--;){const F=R[D];Dl(F,"audio",w)?(_.audioCodec=N=N?`${N},${F}`:F,Rr.audio[N.substring(0,4)]=2,R.splice(D,1)):Dl(F,"video",w)&&(_.videoCodec=U=U?`${U},${F}`:F,Rr.video[U.substring(0,4)]=2,R.splice(D,1))}}});const{AUDIO:T=[],SUBTITLES:E,"CLOSED-CAPTIONS":A}=Hi.parseMasterPlaylistMedia(l,c,h);T.length&&!T.some(R=>!R.url)&&f[0].audioCodec&&!f[0].attrs.AUDIO&&(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),T.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new Bt({}),bitrate:0,url:""})),r.trigger(L.MANIFEST_LOADED,{levels:f,audioTracks:T,subtitles:E,captions:A,contentSteering:d,url:c,stats:t,networkDetails:n,sessionData:p,sessionKeys:v,startTimeOffset:x,variableList:S})}handleTrackOrLevelPlaylist(e,t,s,n,r){const l=this.hls,{id:c,level:h,type:d}=s,f=of(e,s),p=Ce(h)?h:Ce(c)?c:0,v=yx(s),x=Hi.parseLevelPlaylist(e.data,f,p,v,0,this.variableList);if(d===tt.MANIFEST){const S={attrs:new Bt({}),bitrate:0,details:x,name:"",url:f};x.requestScheduled=t.loading.start+zS(x,0),l.trigger(L.MANIFEST_LOADED,{levels:[S],audioTracks:[],url:f,stats:t,networkDetails:n,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),s.levelDetails=x,this.handlePlaylistLoaded(x,e,t,s,n,r)}handleManifestParsingError(e,t,s,n,r){this.hls.trigger(L.ERROR,{type:je.NETWORK_ERROR,details:Q.MANIFEST_PARSING_ERROR,fatal:t.type===tt.MANIFEST,url:e.url,err:s,error:s,reason:s.message,response:e,context:t,networkDetails:n,stats:r})}handleNetworkError(e,t,s=!1,n,r){let l=`A network ${s?"timeout":"error"+(n?" (status "+n.code+")":"")} occurred while loading ${e.type}`;e.type===tt.LEVEL?l+=`: ${e.level} id: ${e.id}`:(e.type===tt.AUDIO_TRACK||e.type===tt.SUBTITLE_TRACK)&&(l+=` id: ${e.id} group-id: "${e.groupId}"`);const c=new Error(l);this.hls.logger.warn(`[playlist-loader]: ${l}`);let h=Q.UNKNOWN,d=!1;const f=this.getInternalLoader(e);switch(e.type){case tt.MANIFEST:h=s?Q.MANIFEST_LOAD_TIMEOUT:Q.MANIFEST_LOAD_ERROR,d=!0;break;case tt.LEVEL:h=s?Q.LEVEL_LOAD_TIMEOUT:Q.LEVEL_LOAD_ERROR,d=!1;break;case tt.AUDIO_TRACK:h=s?Q.AUDIO_TRACK_LOAD_TIMEOUT:Q.AUDIO_TRACK_LOAD_ERROR,d=!1;break;case tt.SUBTITLE_TRACK:h=s?Q.SUBTITLE_TRACK_LOAD_TIMEOUT:Q.SUBTITLE_LOAD_ERROR,d=!1;break}f&&this.resetInternalLoader(e.type);const p={type:je.NETWORK_ERROR,details:h,fatal:d,url:e.url,loader:f,context:e,error:c,networkDetails:t,stats:r};if(n){const v=t?.url||e.url;p.response=vt({url:v,data:void 0},n)}this.hls.trigger(L.ERROR,p)}handlePlaylistLoaded(e,t,s,n,r,l){const c=this.hls,{type:h,level:d,levelOrTrack:f,id:p,groupId:v,deliveryDirectives:x}=n,S=of(t,n),T=yx(n);let E=typeof n.level=="number"&&T===ke.MAIN?d:void 0;const A=e.playlistParsingError;if(A){if(this.hls.logger.warn(`${A} ${e.url}`),!c.config.ignorePlaylistParsingErrors){c.trigger(L.ERROR,{type:je.NETWORK_ERROR,details:Q.LEVEL_PARSING_ERROR,fatal:!1,url:S,error:A,reason:A.message,response:t,context:n,level:E,parent:T,networkDetails:r,stats:s});return}e.playlistParsingError=null}if(!e.fragments.length){const _=e.playlistParsingError=new Error("No Segments found in Playlist");c.trigger(L.ERROR,{type:je.NETWORK_ERROR,details:Q.LEVEL_EMPTY_ERROR,fatal:!1,url:S,error:_,reason:_.message,response:t,context:n,level:E,parent:T,networkDetails:r,stats:s});return}switch(e.live&&l&&(l.getCacheAge&&(e.ageHeader=l.getCacheAge()||0),(!l.getCacheAge||isNaN(e.ageHeader))&&(e.ageHeader=0)),h){case tt.MANIFEST:case tt.LEVEL:if(E){if(!f)E=0;else if(f!==c.levels[E]){const _=c.levels.indexOf(f);_>-1&&(E=_)}}c.trigger(L.LEVEL_LOADED,{details:e,levelInfo:f||c.levels[0],level:E||0,id:p||0,stats:s,networkDetails:r,deliveryDirectives:x,withoutMultiVariant:h===tt.MANIFEST});break;case tt.AUDIO_TRACK:c.trigger(L.AUDIO_TRACK_LOADED,{details:e,track:f,id:p||0,groupId:v||"",stats:s,networkDetails:r,deliveryDirectives:x});break;case tt.SUBTITLE_TRACK:c.trigger(L.SUBTITLE_TRACK_LOADED,{details:e,track:f,id:p||0,groupId:v||"",stats:s,networkDetails:r,deliveryDirectives:x});break}}}class Ci{static get version(){return Ul}static isMSESupported(){return Hb()}static isSupported(){return eD()}static getMediaSource(){return ea()}static get Events(){return L}static get MetadataSchema(){return si}static get ErrorTypes(){return je}static get ErrorDetails(){return Q}static get DefaultConfig(){return Ci.defaultConfig?Ci.defaultConfig:VN}static set DefaultConfig(e){Ci.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new om,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;const t=this.logger=d1(e.debug||!1,"Hls instance",e.assetPlayerId),s=this.config=HN(Ci.DefaultConfig,e,t);this.userConfig=e,s.progressive&&zN(s,t);const{abrController:n,bufferController:r,capLevelController:l,errorController:c,fpsController:h}=s,d=new c(this),f=this.abrController=new n(this),p=new rw(this),v=s.interstitialsController,x=v?this.interstitialsController=new v(this,Ci):null,S=this.bufferController=new r(this,p),T=this.capLevelController=new l(this),E=new h(this),A=new aD(this),_=s.contentSteeringController,R=_?new _(this):null,w=this.levelController=new JN(this,R),N=new WN(this),U=new nD(this.config,this.logger),D=this.streamController=new iD(this,p,U),F=this.gapController=new QN(this,p);T.setStreamController(D),E.setStreamController(D);const j=[A,w,D];x&&j.splice(1,0,x),R&&j.splice(1,0,R),this.networkControllers=j;const M=[f,S,F,T,E,N,p];this.audioTrackController=this.createController(s.audioTrackController,j);const H=s.audioStreamController;H&&j.push(this.audioStreamController=new H(this,p,U)),this.subtitleTrackController=this.createController(s.subtitleTrackController,j);const K=s.subtitleStreamController;K&&j.push(this.subtititleStreamController=new K(this,p,U)),this.createController(s.timelineController,M),U.emeController=this.emeController=this.createController(s.emeController,M),this.cmcdController=this.createController(s.cmcdController,M),this.latencyController=this.createController(ZN,M),this.coreComponents=M,j.push(d);const se=d.onErrorOut;typeof se=="function"&&this.on(L.ERROR,se,d),this.on(L.MANIFEST_LOADED,A.onManifestLoaded,A)}createController(e,t){if(e){const s=new e(this);return t&&t.push(s),s}return null}on(e,t,s=this){this._emitter.on(e,t,s)}once(e,t,s=this){this._emitter.once(e,t,s)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t,s=this,n){this._emitter.off(e,t,s,n)}listeners(e){return this._emitter.listeners(e)}emit(e,t,s){return this._emitter.emit(e,t,s)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(s){if(this.logger.error("An internal error happened while handling event "+e+'. Error message: "'+s.message+'". Here is a stacktrace:',s),!this.triggeringException){this.triggeringException=!0;const n=e===L.ERROR;this.trigger(L.ERROR,{type:je.OTHER_ERROR,details:Q.INTERNAL_EXCEPTION,fatal:n,event:e,error:s}),this.triggeringException=!1}}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){this.logger.log("destroy"),this.trigger(L.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach(t=>t.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(t=>t.destroy()),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){if(!e||"media"in e&&!e.media){const r=new Error(`attachMedia failed: invalid argument (${e})`);this.trigger(L.ERROR,{type:je.OTHER_ERROR,details:Q.ATTACH_MEDIA_ERROR,fatal:!0,error:r});return}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());const t="media"in e,s=t?e.media:e,n=t?e:{media:s};this._media=s,this.trigger(L.MEDIA_ATTACHING,n)}detachMedia(){this.logger.log("detachMedia"),this.trigger(L.MEDIA_DETACHING,{}),this._media=null}transferMedia(){this._media=null;const e=this.bufferController.transferMedia();return this.trigger(L.MEDIA_DETACHING,{transferMedia:e}),e}loadSource(e){this.stopLoad();const t=this.media,s=this._url,n=this._url=Wf.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log(`loadSource:${n}`),t&&s&&(s!==n||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(L.MANIFEST_LOADING,{url:e})}get url(){return this._url}get hasEnoughToStart(){return this.streamController.hasEnoughToStart}get startPosition(){return this.streamController.startPositionValue}startLoad(e=-1,t){this.logger.log(`startLoad(${e+(t?", <skip seek to start>":"")})`),this.started=!0,this.resumeBuffering();for(let s=0;s<this.networkControllers.length&&(this.networkControllers[s].startLoad(e,t),!(!this.started||!this.networkControllers));s++);}stopLoad(){this.logger.log("stopLoad"),this.started=!1;for(let e=0;e<this.networkControllers.length&&(this.networkControllers[e].stopLoad(),!(this.started||!this.networkControllers));e++);}get loadingEnabled(){return this.started}get bufferingEnabled(){return this.streamController.bufferingEnabled}resumeBuffering(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach(e=>{e.resumeBuffering&&e.resumeBuffering()}))}pauseBuffering(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach(e=>{e.pauseBuffering&&e.pauseBuffering()}))}get inFlightFragments(){const e={[ke.MAIN]:this.streamController.inFlightFrag};return this.audioStreamController&&(e[ke.AUDIO]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(e[ke.SUBTITLE]=this.subtititleStreamController.inFlightFrag),e}swapAudioCodec(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){this.logger.log("recoverMediaError");const e=this._media,t=e?.currentTime;this.detachMedia(),e&&(this.attachMedia(e),t&&this.startLoad(t))}removeLevel(e){this.levelController.removeLevel(e)}get sessionId(){let e=this._sessionId;return e||(e=this._sessionId=QO()),e}get levels(){const e=this.levelController.levels;return e||[]}get latestLevelDetails(){return this.streamController.getLevelDetails()||null}get loadLevelObj(){return this.levelController.loadLevelObj}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){this.logger.log(`set currentLevel:${e}`),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){this.logger.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){this.logger.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){this.logger.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){const e=this.levelController.startLevel;return e===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e}set startLevel(e){this.logger.log(`set startLevel:${e}`),e!==-1&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}set bandwidthEstimate(e){this.abrController.resetEstimator(e)}get abrEwmaDefaultEstimate(){const{bwEstimator:e}=this.abrController;return e?e.defaultEstimate:NaN}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(this.logger.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){H1(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;const s=e.length;for(let n=0;n<s;n++)if(e[n].maxBitrate>=t)return n;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:t,maxHdcpLevel:s}=this;let n;if(t===-1&&e!=null&&e.length?n=e.length-1:n=t,s)for(let r=n;r--;){const l=e[r].attrs["HDCP-LEVEL"];if(l&&l<=s)return r}return n}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(e){this.abrController.nextAutoLevel=e}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get maxBufferLength(){return this.streamController.maxBufferLength}setAudioOption(e){var t;return((t=this.audioTrackController)==null?void 0:t.setAudioOption(e))||null}setSubtitleOption(e){var t;return((t=this.subtitleTrackController)==null?void 0:t.setSubtitleOption(e))||null}get allAudioTracks(){const e=this.audioTrackController;return e?e.allAudioTracks:[]}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const t=this.audioTrackController;t&&(t.audioTrack=e)}get allSubtitleTracks(){const e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return e?e.subtitleDisplay:!1}set subtitleDisplay(e){const t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}set targetLatency(e){this.latencyController.targetLatency=e}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}get pathways(){return this.levelController.pathways}get pathwayPriority(){return this.levelController.pathwayPriority}set pathwayPriority(e){this.levelController.pathwayPriority=e}get bufferedToEnd(){var e;return!!((e=this.bufferController)!=null&&e.bufferedToEnd)}get interstitialsManager(){var e;return((e=this.interstitialsController)==null?void 0:e.interstitialsManager)||null}getMediaDecodingInfo(e,t=this.allAudioTracks){const s=CS(t);return LS(e,s,navigator.mediaCapabilities)}}Ci.defaultConfig=void 0;const rD=()=>{const{id:i}=nu(),e=As(),t=C.useRef(null),s=C.useRef(null),n=C.useRef(null),r=C.useRef(null),[l,c]=C.useState(null),[h,d]=C.useState(!0),[f,p]=C.useState(null),[v,x]=C.useState(!1),[S,T]=C.useState(0),[E,A]=C.useState(0),[_,R]=C.useState(0),[w,N]=C.useState(1),[U,D]=C.useState(!1),[F,j]=C.useState(!0),[M,H]=C.useState(null),[K,se]=C.useState(null),[ne,de]=C.useState(null),[k,G]=C.useState(0),[Y,le]=C.useState(!0),[me,P]=C.useState([]),[$,ie]=C.useState(null),[fe,ge]=C.useState([]),[ve,Ne]=C.useState(!1),pe=ye=>{if(isNaN(ye)||ye<0)return"0:00";const $e=Math.floor(ye/3600),De=Math.floor(ye%3600/60),St=Math.floor(ye%60);return $e>0?`${$e}:${String(De).padStart(2,"0")}:${String(St).padStart(2,"0")}`:`${De}:${String(St).padStart(2,"0")}`},we=C.useCallback(()=>{j(!0),n.current&&clearTimeout(n.current),n.current=setTimeout(()=>{v&&j(!1)},3e3)},[v]);C.useEffect(()=>((async()=>{try{d(!0),p(null);const $e=await ee.getCurrentUser();if(!$e){p("Not logged in."),d(!1);return}const De=await ee.getItemDetails($e.Id,i);if(!De){p("Item not found."),d(!1);return}c(De),De.Trickplay&&De.Trickplay.Width&&De.Trickplay.Interval?(se({width:De.Trickplay.Width,height:De.Trickplay.Height,interval:De.Trickplay.Interval,thumbnailWidth:320}),console.log("[LegitFlix Player] Trickplay data found:",De.Trickplay)):console.log("[LegitFlix Player] No detailed Trickplay data found.");const St=ee.api?.configuration?.basePath||ee.api?.basePath||"",xs=ee.api?.accessToken||"",ss=De.MediaSources?.[0];if(!ss){p("No media source available for this item."),d(!1);return}const It=ss.Id,Wt=ss.Container||"mp4",Nt=`${St}/Videos/${i}/master.m3u8?MediaSourceId=${It}&api_key=${xs}&VideoCodec=h264&AudioCodec=aac&TranscodingMaxAudioChannels=2`,Is=`${St}/Videos/${i}/stream.${Wt}?Static=true&MediaSourceId=${It}&api_key=${xs}`,Rt=t.current;if(!Rt)return;if(Ci.isSupported()){const Mt=new Ci({startLevel:-1,maxBufferLength:30,maxMaxBufferLength:60});s.current=Mt,Mt.on(Ci.Events.ERROR,(is,ns)=>{console.warn("[LegitFlix Player] HLS error:",ns.type,ns.details),ns.fatal&&(console.log("[LegitFlix Player] HLS fatal error, falling back to direct stream"),Mt.destroy(),s.current=null,Rt.src=Is,Rt.load())}),Mt.loadSource(Nt),Mt.attachMedia(Rt),Mt.on(Ci.Events.MANIFEST_PARSED,()=>{d(!1),Rt.play().catch(()=>x(!1))})}else Rt.canPlayType("application/vnd.apple.mpegurl")?(Rt.src=Nt,Rt.addEventListener("loadedmetadata",()=>{d(!1),Rt.play().catch(()=>x(!1))},{once:!0})):(Rt.src=Is,Rt.addEventListener("loadedmetadata",()=>{d(!1),Rt.play().catch(()=>x(!1))},{once:!0}));if(De.UserData?.PlaybackPositionTicks){const Mt=De.UserData.PlaybackPositionTicks/1e7;Rt.addEventListener("canplay",()=>{Rt.currentTime<1&&(Rt.currentTime=Mt)},{once:!0})}if(De.Type==="Episode"&&De.SeriesId)try{const Mt=await ee.getSeasons($e.Id,De.SeriesId);if(Mt&&Mt.Items){P(Mt.Items);const is=De.SeasonId||Mt.Items[0]?.Id;if(ie(is),is){Ne(!0);const ns=await ee.getEpisodes($e.Id,De.SeriesId,is);ns&&ns.Items&&ge(ns.Items),Ne(!1)}}}catch(Mt){console.warn("[LegitFlix Player] Failed to load seasons/episodes:",Mt)}}catch($e){console.error("[LegitFlix Player] Failed to load:",$e),p("Failed to load video. Please try again."),d(!1)}})(),()=>{s.current&&(s.current.destroy(),s.current=null),n.current&&clearTimeout(n.current),ot()}),[i]);const ot=async()=>{try{if(!await ee.getCurrentUser()||!t.current)return;const $e=Math.floor(t.current.currentTime*1e7),De=ee.api?.configuration?.basePath||ee.api?.basePath||"",St=ee.api?.accessToken||"";await fetch(`${De}/Sessions/Playing/Stopped`,{method:"POST",headers:{"Content-Type":"application/json","X-Emby-Authorization":`MediaBrowser Client="LegitFlix", Device="Web", DeviceId="legitflix-web", Version="1.0.0", Token="${St}"`},body:JSON.stringify({ItemId:i,PositionTicks:$e})})}catch(ye){console.warn("[LegitFlix Player] Failed to report playback stop",ye)}};C.useEffect(()=>{const ye=t.current;if(!ye)return;const $e=()=>x(!0),De=()=>x(!1),St=()=>{T(ye.currentTime),ye.buffered.length>0&&R(ye.buffered.end(ye.buffered.length-1))},xs=()=>A(ye.duration||0),ss=()=>{N(ye.volume),D(ye.muted)},It=()=>{x(!1),j(!0)},Wt=Rt=>{console.error("[LegitFlix Player] Video error:",Rt),h||p("Playback error occurred.")},Nt=()=>d(!0),Is=()=>d(!1);return ye.addEventListener("play",$e),ye.addEventListener("pause",De),ye.addEventListener("timeupdate",St),ye.addEventListener("durationchange",xs),ye.addEventListener("volumechange",ss),ye.addEventListener("ended",It),ye.addEventListener("error",Wt),ye.addEventListener("waiting",Nt),ye.addEventListener("canplay",Is),()=>{ye.removeEventListener("play",$e),ye.removeEventListener("pause",De),ye.removeEventListener("timeupdate",St),ye.removeEventListener("durationchange",xs),ye.removeEventListener("volumechange",ss),ye.removeEventListener("ended",It),ye.removeEventListener("error",Wt),ye.removeEventListener("waiting",Nt),ye.removeEventListener("canplay",Is)}},[h]),C.useEffect(()=>{const ye=$e=>{const De=t.current;if(De)switch(we(),$e.key){case" ":case"k":$e.preventDefault(),De.paused?De.play():De.pause();break;case"ArrowLeft":$e.preventDefault(),De.currentTime=Math.max(0,De.currentTime-10);break;case"ArrowRight":$e.preventDefault(),De.currentTime=Math.min(De.duration,De.currentTime+10);break;case"ArrowUp":$e.preventDefault(),De.volume=Math.min(1,De.volume+.1);break;case"ArrowDown":$e.preventDefault(),De.volume=Math.max(0,De.volume-.1);break;case"f":$e.preventDefault(),ut();break;case"m":$e.preventDefault(),De.muted=!De.muted;break;case"Escape":$e.preventDefault(),Oe();break}};return document.addEventListener("keydown",ye),()=>document.removeEventListener("keydown",ye)},[we]),C.useEffect(()=>{},[]);const ct=async ye=>{if(ie(ye),!(!l||!l.SeriesId))try{Ne(!0);const $e=await ee.getCurrentUser(),De=await ee.getEpisodes($e.Id,l.SeriesId,ye);De&&De.Items&&ge(De.Items),Ne(!1)}catch($e){console.warn("Failed to fetch episodes:",$e),Ne(!1)}},zt=()=>{Y?le(!1):(document.fullscreenElement&&document.exitFullscreen().catch(ye=>console.warn(ye)),le(!0))},_t=ye=>{e(`/play/${ye}`)},xt=()=>{const ye=t.current;ye&&(ye.paused?(ye.play(),os("play_arrow")):(ye.pause(),os("pause")))},os=ye=>{H(ye),setTimeout(()=>H(null),600)},Ve=ye=>{const $e=t.current;if(!$e||!E)return;const De=ye.currentTarget.getBoundingClientRect(),xs=(ye.clientX-De.left)/De.width;$e.currentTime=xs*E},Le=ye=>{if(!E)return;const $e=ye.currentTarget.getBoundingClientRect(),De=ye.clientX-$e.left,St=Math.max(0,Math.min(1,De/$e.width));de(St*E),G(De)},Fe=()=>{de(null)},Ze=ye=>{const $e=t.current;if(!$e)return;const De=parseFloat(ye.target.value);$e.volume=De,$e.muted=De===0},ut=()=>{const ye=r.current;ye&&(document.fullscreenElement?document.exitFullscreen():ye.requestFullscreen())},Oe=()=>{e(-1)},Ye=()=>{we()},mt=()=>l?l.Type==="Episode"?{title:l.SeriesName||"",subtitle:`S${l.ParentIndexNumber} E${l.IndexNumber}  ${l.Name}`}:{title:l.Name||"",subtitle:l.ProductionYear?String(l.ProductionYear):""}:{title:"",subtitle:""},{title:st,subtitle:Kt}=mt(),Xt=E>0?S/E*100:0,_s=E>0?_/E*100:0;return g.jsxs("div",{ref:r,className:`lf-player ${F?"show-controls":""} ${Y?"lf-player--windowed":""}`,onMouseMove:Ye,onClick:ye=>{(ye.target===t.current||ye.target.classList.contains("lf-player__content"))&&xt()},children:[g.jsxs("div",{className:"lf-player__content",children:[g.jsx("video",{ref:t,className:"lf-player__video"}),g.jsx("div",{className:`lf-player__center-play ${M?"visible":""}`,children:g.jsx("span",{className:"material-icons",children:M})}),h&&!f&&g.jsxs("div",{className:"lf-player__loading",children:[g.jsx("div",{className:"lf-player__spinner"}),g.jsx("span",{className:"lf-player__loading-text",children:"Loading..."})]}),f&&g.jsxs("div",{className:"lf-player__error",children:[g.jsx("span",{className:"material-icons",children:"error_outline"}),g.jsx("p",{className:"lf-player__error-message",children:f}),g.jsx("button",{className:"lf-player__error-btn",onClick:Oe,children:"Go Back"})]}),g.jsxs("div",{className:"lf-player__top-bar",children:[g.jsx("button",{className:"lf-player__back-btn",onClick:Oe,children:g.jsx("span",{className:"material-icons",children:"arrow_back"})}),g.jsxs("div",{className:"lf-player__title-area",children:[g.jsx("div",{className:"lf-player__title",children:st}),Kt&&g.jsx("div",{className:"lf-player__subtitle",children:Kt})]})]}),!f&&g.jsxs("div",{className:"lf-player__controls",children:[g.jsxs("div",{className:"lf-player__progress",onClick:Ve,onMouseMove:Le,onMouseLeave:Fe,children:[K&&ne!==null&&g.jsxs("div",{className:"lf-player-scrub-preview is-visible",style:{left:k},children:[g.jsx("img",{src:ee.getTrickplayTileUrl(i,K.width,Math.floor(ne*1e3/K.interval)),alt:"Preview"}),g.jsx("div",{style:{position:"absolute",bottom:0,left:0,right:0,background:"rgba(0,0,0,0.7)",color:"#fff",fontSize:"12px",textAlign:"center",padding:"2px 0"},children:pe(ne)})]}),g.jsx("div",{className:"lf-player__progress-buffered",style:{width:`${_s}%`}}),g.jsx("div",{className:"lf-player__progress-filled",style:{width:`${Xt}%`}}),g.jsx("div",{className:"lf-player__progress-thumb",style:{left:`${Xt}%`}})]}),g.jsxs("div",{className:"lf-player__controls-row",children:[g.jsxs("div",{className:"lf-player__controls-left",children:[g.jsx("button",{className:"lf-player__ctrl-btn lf-player__ctrl-btn--play",onClick:xt,children:g.jsx("span",{className:"material-icons",children:v?"pause":"play_arrow"})}),g.jsx("button",{className:"lf-player__ctrl-btn",onClick:()=>{t.current&&(t.current.currentTime-=10)},children:g.jsx("span",{className:"material-icons",children:"replay_10"})}),g.jsx("button",{className:"lf-player__ctrl-btn",onClick:()=>{t.current&&(t.current.currentTime+=30)},children:g.jsx("span",{className:"material-icons",children:"forward_30"})}),g.jsxs("div",{className:"lf-player__volume-group",children:[g.jsx("button",{className:"lf-player__ctrl-btn",onClick:()=>{t.current&&(t.current.muted=!t.current.muted)},children:g.jsx("span",{className:"material-icons",children:U||w===0?"volume_off":w<.5?"volume_down":"volume_up"})}),g.jsx("input",{type:"range",className:"lf-player__volume-slider",min:"0",max:"1",step:"0.05",value:U?0:w,onChange:Ze})]}),g.jsxs("span",{className:"lf-player__time",children:[pe(S)," / ",pe(E)]})]}),g.jsx("div",{className:"lf-player__controls-right",children:g.jsx("button",{className:"lf-player__ctrl-btn",onClick:zt,title:Y?"Enter Fullscreen":"Exit Fullscreen",children:g.jsx("span",{className:"material-icons",children:Y?"fullscreen":"fullscreen_exit"})})})]})]})]}),Y&&l&&l.Type==="Episode"&&g.jsxs("div",{className:"lf-player__sidebar",children:[g.jsxs("div",{className:"lf-player__metadata",children:[g.jsx("h2",{className:"lf-player__meta-title",children:l.SeriesName}),g.jsx("h3",{className:"lf-player__meta-episode-title",children:l.Name}),g.jsxs("div",{className:"lf-player__meta-info",children:[g.jsxs("span",{children:["S",l.ParentIndexNumber," E",l.IndexNumber]}),l.OfficialRating&&g.jsx("span",{className:"lf-player__meta-rating",children:l.OfficialRating})]}),g.jsx("p",{className:"lf-player__meta-desc",children:l.Overview})]}),g.jsxs("div",{className:"lf-player__episodes-container",children:[g.jsx("div",{className:"lf-player__season-select-wrapper",children:g.jsx("select",{className:"lf-player__season-select",value:$||"",onChange:ye=>ct(ye.target.value),children:me.map(ye=>g.jsx("option",{value:ye.Id,children:ye.Name},ye.Id))})}),g.jsx("div",{className:"lf-player__episodes-list",children:ve?g.jsx("div",{className:"lf-player__episodes-loading",children:"Loading episodes..."}):fe.map(ye=>g.jsxs("div",{className:`lf-player__episode-item ${ye.Id===l.Id?"active":""}`,onClick:()=>_t(ye.Id),children:[g.jsxs("div",{className:"lf-player__episode-thumb",children:[g.jsx("img",{src:ee.getImageUrl(ye,"Primary",{maxWidth:200}),alt:ye.Name,onError:$e=>$e.target.style.display="none"}),ye.UserData?.Played&&g.jsx("span",{className:"lf-player__episode-played",children:""})]}),g.jsxs("div",{className:"lf-player__episode-details",children:[g.jsxs("span",{className:"lf-player__episode-num",children:["E",ye.IndexNumber]}),g.jsx("span",{className:"lf-player__episode-name",children:ye.Name})]})]},ye.Id))})]})]})]})};function lD(){const{config:i}=Yi();return g.jsxs(g.Fragment,{children:[i.appBackground&&g.jsx("div",{style:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",backgroundImage:`url('${i.appBackground}')`,backgroundSize:"cover",backgroundPosition:"center",zIndex:-1,opacity:.3,filter:"grayscale(0.5) brightness(0.5)"}}),g.jsxs(M_,{children:[g.jsx(t1,{}),g.jsxs(f_,{children:[g.jsx(xi,{path:"/login",element:g.jsx(JL,{})}),g.jsx(xi,{path:"/login/select-server",element:g.jsx(WL,{})}),g.jsx(xi,{path:"/login/select-user",element:g.jsx(ZL,{})}),g.jsxs(xi,{element:g.jsx(e1,{}),children:[g.jsx(xi,{path:"/",element:g.jsx(Wv,{})}),g.jsx(xi,{path:"/series/:id",element:g.jsx(YL,{})}),g.jsx(xi,{path:"/movie/:id",element:g.jsx(qL,{})}),g.jsx(xi,{path:"/item/:id",element:g.jsx(s1,{})}),g.jsx(xi,{path:"/profile",element:g.jsx(XL,{})}),g.jsx(xi,{path:"/play/:id",element:g.jsx(rD,{})}),g.jsx(xi,{path:"*",element:g.jsx(Wv,{})})]})]})]})]})}function oD(){return g.jsx(Q_,{children:g.jsx(lD,{})})}hA.createRoot(document.getElementById("root")).render(g.jsx(C.StrictMode,{children:g.jsx(oD,{})}));
