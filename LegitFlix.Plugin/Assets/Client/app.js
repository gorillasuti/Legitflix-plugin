function nA(n,e){for(var t=0;t<e.length;t++){const s=e[t];if(typeof s!="string"&&!Array.isArray(s)){for(const i in s)if(i!=="default"&&!(i in n)){const r=Object.getOwnPropertyDescriptor(s,i);r&&Object.defineProperty(n,i,r.get?r:{enumerable:!0,get:()=>s[i]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&s(l)}).observe(document,{childList:!0,subtree:!0});function t(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(i){if(i.ep)return;i.ep=!0;const r=t(i);fetch(i.href,r)}})();function Rx(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Hh={exports:{}},Bl={};var xy;function aA(){if(xy)return Bl;xy=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(s,i,r){var l=null;if(r!==void 0&&(l=""+r),i.key!==void 0&&(l=""+i.key),"key"in i){r={};for(var c in i)c!=="key"&&(r[c]=i[c])}else r=i;return i=r.ref,{$$typeof:n,type:s,key:l,ref:i!==void 0?i:null,props:r}}return Bl.Fragment=e,Bl.jsx=t,Bl.jsxs=t,Bl}var Sy;function rA(){return Sy||(Sy=1,Hh.exports=aA()),Hh.exports}var p=rA(),zh={exports:{}},We={};var by;function lA(){if(by)return We;by=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),r=Symbol.for("react.consumer"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),h=Symbol.for("react.suspense"),u=Symbol.for("react.memo"),f=Symbol.for("react.lazy"),g=Symbol.for("react.activity"),y=Symbol.iterator;function x(P){return P===null||typeof P!="object"?null:(P=y&&P[y]||P["@@iterator"],typeof P=="function"?P:null)}var S={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},E=Object.assign,T={};function A(P,G,te){this.props=P,this.context=G,this.refs=T,this.updater=te||S}A.prototype.isReactComponent={},A.prototype.setState=function(P,G){if(typeof P!="object"&&typeof P!="function"&&P!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,P,G,"setState")},A.prototype.forceUpdate=function(P){this.updater.enqueueForceUpdate(this,P,"forceUpdate")};function _(){}_.prototype=A.prototype;function I(P,G,te){this.props=P,this.context=G,this.refs=T,this.updater=te||S}var C=I.prototype=new _;C.constructor=I,E(C,A.prototype),C.isPureReactComponent=!0;var N=Array.isArray;function D(){}var k={H:null,A:null,T:null,S:null},B=Object.prototype.hasOwnProperty;function j(P,G,te){var fe=te.ref;return{$$typeof:n,type:P,key:G,ref:fe!==void 0?fe:null,props:te}}function U(P,G){return j(P.type,G,P.props)}function K(P){return typeof P=="object"&&P!==null&&P.$$typeof===n}function H(P){var G={"=":"=0",":":"=2"};return"$"+P.replace(/[=:]/g,function(te){return G[te]})}var J=/\/+/g;function re(P,G){return typeof P=="object"&&P!==null&&P.key!=null?H(""+P.key):G.toString(36)}function me(P){switch(P.status){case"fulfilled":return P.value;case"rejected":throw P.reason;default:switch(typeof P.status=="string"?P.then(D,D):(P.status="pending",P.then(function(G){P.status==="pending"&&(P.status="fulfilled",P.value=G)},function(G){P.status==="pending"&&(P.status="rejected",P.reason=G)})),P.status){case"fulfilled":return P.value;case"rejected":throw P.reason}}throw P}function M(P,G,te,fe,ve){var Ae=typeof P;(Ae==="undefined"||Ae==="boolean")&&(P=null);var De=!1;if(P===null)De=!0;else switch(Ae){case"bigint":case"string":case"number":De=!0;break;case"object":switch(P.$$typeof){case n:case e:De=!0;break;case f:return De=P._init,M(De(P._payload),G,te,fe,ve)}}if(De)return ve=ve(P),De=fe===""?"."+re(P,0):fe,N(ve)?(te="",De!=null&&(te=De.replace(J,"$&/")+"/"),M(ve,G,te,"",function(mt){return mt})):ve!=null&&(K(ve)&&(ve=U(ve,te+(ve.key==null||P&&P.key===ve.key?"":(""+ve.key).replace(J,"$&/")+"/")+De)),G.push(ve)),1;De=0;var Ge=fe===""?".":fe+":";if(N(P))for(var Fe=0;Fe<P.length;Fe++)fe=P[Fe],Ae=Ge+re(fe,Fe),De+=M(fe,G,te,Ae,ve);else if(Fe=x(P),typeof Fe=="function")for(P=Fe.call(P),Fe=0;!(fe=P.next()).done;)fe=fe.value,Ae=Ge+re(fe,Fe++),De+=M(fe,G,te,Ae,ve);else if(Ae==="object"){if(typeof P.then=="function")return M(me(P),G,te,fe,ve);throw G=String(P),Error("Objects are not valid as a React child (found: "+(G==="[object Object]"?"object with keys {"+Object.keys(P).join(", ")+"}":G)+"). If you meant to render a collection of children, use an array instead.")}return De}function $(P,G,te){if(P==null)return P;var fe=[],ve=0;return M(P,fe,"","",function(Ae){return G.call(te,Ae,ve++)}),fe}function F(P){if(P._status===-1){var G=P._result;G=G(),G.then(function(te){(P._status===0||P._status===-1)&&(P._status=1,P._result=te)},function(te){(P._status===0||P._status===-1)&&(P._status=2,P._result=te)}),P._status===-1&&(P._status=0,P._result=G)}if(P._status===1)return P._result.default;throw P._result}var ae=typeof reportError=="function"?reportError:function(P){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var G=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof P=="object"&&P!==null&&typeof P.message=="string"?String(P.message):String(P),error:P});if(!window.dispatchEvent(G))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",P);return}console.error(P)},de={map:$,forEach:function(P,G,te){$(P,function(){G.apply(this,arguments)},te)},count:function(P){var G=0;return $(P,function(){G++}),G},toArray:function(P){return $(P,function(G){return G})||[]},only:function(P){if(!K(P))throw Error("React.Children.only expected to receive a single React element child.");return P}};return We.Activity=g,We.Children=de,We.Component=A,We.Fragment=t,We.Profiler=i,We.PureComponent=I,We.StrictMode=s,We.Suspense=h,We.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=k,We.__COMPILER_RUNTIME={__proto__:null,c:function(P){return k.H.useMemoCache(P)}},We.cache=function(P){return function(){return P.apply(null,arguments)}},We.cacheSignal=function(){return null},We.cloneElement=function(P,G,te){if(P==null)throw Error("The argument must be a React element, but you passed "+P+".");var fe=E({},P.props),ve=P.key;if(G!=null)for(Ae in G.key!==void 0&&(ve=""+G.key),G)!B.call(G,Ae)||Ae==="key"||Ae==="__self"||Ae==="__source"||Ae==="ref"&&G.ref===void 0||(fe[Ae]=G[Ae]);var Ae=arguments.length-2;if(Ae===1)fe.children=te;else if(1<Ae){for(var De=Array(Ae),Ge=0;Ge<Ae;Ge++)De[Ge]=arguments[Ge+2];fe.children=De}return j(P.type,ve,fe)},We.createContext=function(P){return P={$$typeof:l,_currentValue:P,_currentValue2:P,_threadCount:0,Provider:null,Consumer:null},P.Provider=P,P.Consumer={$$typeof:r,_context:P},P},We.createElement=function(P,G,te){var fe,ve={},Ae=null;if(G!=null)for(fe in G.key!==void 0&&(Ae=""+G.key),G)B.call(G,fe)&&fe!=="key"&&fe!=="__self"&&fe!=="__source"&&(ve[fe]=G[fe]);var De=arguments.length-2;if(De===1)ve.children=te;else if(1<De){for(var Ge=Array(De),Fe=0;Fe<De;Fe++)Ge[Fe]=arguments[Fe+2];ve.children=Ge}if(P&&P.defaultProps)for(fe in De=P.defaultProps,De)ve[fe]===void 0&&(ve[fe]=De[fe]);return j(P,Ae,ve)},We.createRef=function(){return{current:null}},We.forwardRef=function(P){return{$$typeof:c,render:P}},We.isValidElement=K,We.lazy=function(P){return{$$typeof:f,_payload:{_status:-1,_result:P},_init:F}},We.memo=function(P,G){return{$$typeof:u,type:P,compare:G===void 0?null:G}},We.startTransition=function(P){var G=k.T,te={};k.T=te;try{var fe=P(),ve=k.S;ve!==null&&ve(te,fe),typeof fe=="object"&&fe!==null&&typeof fe.then=="function"&&fe.then(D,ae)}catch(Ae){ae(Ae)}finally{G!==null&&te.types!==null&&(G.types=te.types),k.T=G}},We.unstable_useCacheRefresh=function(){return k.H.useCacheRefresh()},We.use=function(P){return k.H.use(P)},We.useActionState=function(P,G,te){return k.H.useActionState(P,G,te)},We.useCallback=function(P,G){return k.H.useCallback(P,G)},We.useContext=function(P){return k.H.useContext(P)},We.useDebugValue=function(){},We.useDeferredValue=function(P,G){return k.H.useDeferredValue(P,G)},We.useEffect=function(P,G){return k.H.useEffect(P,G)},We.useEffectEvent=function(P){return k.H.useEffectEvent(P)},We.useId=function(){return k.H.useId()},We.useImperativeHandle=function(P,G,te){return k.H.useImperativeHandle(P,G,te)},We.useInsertionEffect=function(P,G){return k.H.useInsertionEffect(P,G)},We.useLayoutEffect=function(P,G){return k.H.useLayoutEffect(P,G)},We.useMemo=function(P,G){return k.H.useMemo(P,G)},We.useOptimistic=function(P,G){return k.H.useOptimistic(P,G)},We.useReducer=function(P,G,te){return k.H.useReducer(P,G,te)},We.useRef=function(P){return k.H.useRef(P)},We.useState=function(P){return k.H.useState(P)},We.useSyncExternalStore=function(P,G,te){return k.H.useSyncExternalStore(P,G,te)},We.useTransition=function(){return k.H.useTransition()},We.version="19.2.4",We}var Ty;function im(){return Ty||(Ty=1,zh.exports=lA()),zh.exports}var w=im();const Lx=Rx(w),oA=nA({__proto__:null,default:Lx},[w]);var Kh={exports:{}},Fl={},Yh={exports:{}},qh={};var Ey;function cA(){return Ey||(Ey=1,(function(n){function e(M,$){var F=M.length;M.push($);e:for(;0<F;){var ae=F-1>>>1,de=M[ae];if(0<i(de,$))M[ae]=$,M[F]=de,F=ae;else break e}}function t(M){return M.length===0?null:M[0]}function s(M){if(M.length===0)return null;var $=M[0],F=M.pop();if(F!==$){M[0]=F;e:for(var ae=0,de=M.length,P=de>>>1;ae<P;){var G=2*(ae+1)-1,te=M[G],fe=G+1,ve=M[fe];if(0>i(te,F))fe<de&&0>i(ve,te)?(M[ae]=ve,M[fe]=F,ae=fe):(M[ae]=te,M[G]=F,ae=G);else if(fe<de&&0>i(ve,F))M[ae]=ve,M[fe]=F,ae=fe;else break e}}return $}function i(M,$){var F=M.sortIndex-$.sortIndex;return F!==0?F:M.id-$.id}if(n.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var r=performance;n.unstable_now=function(){return r.now()}}else{var l=Date,c=l.now();n.unstable_now=function(){return l.now()-c}}var h=[],u=[],f=1,g=null,y=3,x=!1,S=!1,E=!1,T=!1,A=typeof setTimeout=="function"?setTimeout:null,_=typeof clearTimeout=="function"?clearTimeout:null,I=typeof setImmediate<"u"?setImmediate:null;function C(M){for(var $=t(u);$!==null;){if($.callback===null)s(u);else if($.startTime<=M)s(u),$.sortIndex=$.expirationTime,e(h,$);else break;$=t(u)}}function N(M){if(E=!1,C(M),!S)if(t(h)!==null)S=!0,D||(D=!0,H());else{var $=t(u);$!==null&&me(N,$.startTime-M)}}var D=!1,k=-1,B=5,j=-1;function U(){return T?!0:!(n.unstable_now()-j<B)}function K(){if(T=!1,D){var M=n.unstable_now();j=M;var $=!0;try{e:{S=!1,E&&(E=!1,_(k),k=-1),x=!0;var F=y;try{t:{for(C(M),g=t(h);g!==null&&!(g.expirationTime>M&&U());){var ae=g.callback;if(typeof ae=="function"){g.callback=null,y=g.priorityLevel;var de=ae(g.expirationTime<=M);if(M=n.unstable_now(),typeof de=="function"){g.callback=de,C(M),$=!0;break t}g===t(h)&&s(h),C(M)}else s(h);g=t(h)}if(g!==null)$=!0;else{var P=t(u);P!==null&&me(N,P.startTime-M),$=!1}}break e}finally{g=null,y=F,x=!1}$=void 0}}finally{$?H():D=!1}}}var H;if(typeof I=="function")H=function(){I(K)};else if(typeof MessageChannel<"u"){var J=new MessageChannel,re=J.port2;J.port1.onmessage=K,H=function(){re.postMessage(null)}}else H=function(){A(K,0)};function me(M,$){k=A(function(){M(n.unstable_now())},$)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(M){M.callback=null},n.unstable_forceFrameRate=function(M){0>M||125<M?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):B=0<M?Math.floor(1e3/M):5},n.unstable_getCurrentPriorityLevel=function(){return y},n.unstable_next=function(M){switch(y){case 1:case 2:case 3:var $=3;break;default:$=y}var F=y;y=$;try{return M()}finally{y=F}},n.unstable_requestPaint=function(){T=!0},n.unstable_runWithPriority=function(M,$){switch(M){case 1:case 2:case 3:case 4:case 5:break;default:M=3}var F=y;y=M;try{return $()}finally{y=F}},n.unstable_scheduleCallback=function(M,$,F){var ae=n.unstable_now();switch(typeof F=="object"&&F!==null?(F=F.delay,F=typeof F=="number"&&0<F?ae+F:ae):F=ae,M){case 1:var de=-1;break;case 2:de=250;break;case 5:de=1073741823;break;case 4:de=1e4;break;default:de=5e3}return de=F+de,M={id:f++,callback:$,priorityLevel:M,startTime:F,expirationTime:de,sortIndex:-1},F>ae?(M.sortIndex=F,e(u,M),t(h)===null&&M===t(u)&&(E?(_(k),k=-1):E=!0,me(N,F-ae))):(M.sortIndex=de,e(h,M),S||x||(S=!0,D||(D=!0,H()))),M},n.unstable_shouldYield=U,n.unstable_wrapCallback=function(M){var $=y;return function(){var F=y;y=$;try{return M.apply(this,arguments)}finally{y=F}}}})(qh)),qh}var Ay;function uA(){return Ay||(Ay=1,Yh.exports=cA()),Yh.exports}var Qh={exports:{}},Ds={};var Iy;function dA(){if(Iy)return Ds;Iy=1;var n=im();function e(h){var u="https://react.dev/errors/"+h;if(1<arguments.length){u+="?args[]="+encodeURIComponent(arguments[1]);for(var f=2;f<arguments.length;f++)u+="&args[]="+encodeURIComponent(arguments[f])}return"Minified React error #"+h+"; visit "+u+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function t(){}var s={d:{f:t,r:function(){throw Error(e(522))},D:t,C:t,L:t,m:t,X:t,S:t,M:t},p:0,findDOMNode:null},i=Symbol.for("react.portal");function r(h,u,f){var g=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:i,key:g==null?null:""+g,children:h,containerInfo:u,implementation:f}}var l=n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function c(h,u){if(h==="font")return"";if(typeof u=="string")return u==="use-credentials"?u:""}return Ds.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=s,Ds.createPortal=function(h,u){var f=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!u||u.nodeType!==1&&u.nodeType!==9&&u.nodeType!==11)throw Error(e(299));return r(h,u,null,f)},Ds.flushSync=function(h){var u=l.T,f=s.p;try{if(l.T=null,s.p=2,h)return h()}finally{l.T=u,s.p=f,s.d.f()}},Ds.preconnect=function(h,u){typeof h=="string"&&(u?(u=u.crossOrigin,u=typeof u=="string"?u==="use-credentials"?u:"":void 0):u=null,s.d.C(h,u))},Ds.prefetchDNS=function(h){typeof h=="string"&&s.d.D(h)},Ds.preinit=function(h,u){if(typeof h=="string"&&u&&typeof u.as=="string"){var f=u.as,g=c(f,u.crossOrigin),y=typeof u.integrity=="string"?u.integrity:void 0,x=typeof u.fetchPriority=="string"?u.fetchPriority:void 0;f==="style"?s.d.S(h,typeof u.precedence=="string"?u.precedence:void 0,{crossOrigin:g,integrity:y,fetchPriority:x}):f==="script"&&s.d.X(h,{crossOrigin:g,integrity:y,fetchPriority:x,nonce:typeof u.nonce=="string"?u.nonce:void 0})}},Ds.preinitModule=function(h,u){if(typeof h=="string")if(typeof u=="object"&&u!==null){if(u.as==null||u.as==="script"){var f=c(u.as,u.crossOrigin);s.d.M(h,{crossOrigin:f,integrity:typeof u.integrity=="string"?u.integrity:void 0,nonce:typeof u.nonce=="string"?u.nonce:void 0})}}else u==null&&s.d.M(h)},Ds.preload=function(h,u){if(typeof h=="string"&&typeof u=="object"&&u!==null&&typeof u.as=="string"){var f=u.as,g=c(f,u.crossOrigin);s.d.L(h,f,{crossOrigin:g,integrity:typeof u.integrity=="string"?u.integrity:void 0,nonce:typeof u.nonce=="string"?u.nonce:void 0,type:typeof u.type=="string"?u.type:void 0,fetchPriority:typeof u.fetchPriority=="string"?u.fetchPriority:void 0,referrerPolicy:typeof u.referrerPolicy=="string"?u.referrerPolicy:void 0,imageSrcSet:typeof u.imageSrcSet=="string"?u.imageSrcSet:void 0,imageSizes:typeof u.imageSizes=="string"?u.imageSizes:void 0,media:typeof u.media=="string"?u.media:void 0})}},Ds.preloadModule=function(h,u){if(typeof h=="string")if(u){var f=c(u.as,u.crossOrigin);s.d.m(h,{as:typeof u.as=="string"&&u.as!=="script"?u.as:void 0,crossOrigin:f,integrity:typeof u.integrity=="string"?u.integrity:void 0})}else s.d.m(h)},Ds.requestFormReset=function(h){s.d.r(h)},Ds.unstable_batchedUpdates=function(h,u){return h(u)},Ds.useFormState=function(h,u,f){return l.H.useFormState(h,u,f)},Ds.useFormStatus=function(){return l.H.useHostTransitionStatus()},Ds.version="19.2.4",Ds}var _y;function wx(){if(_y)return Qh.exports;_y=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),Qh.exports=dA(),Qh.exports}var Ry;function hA(){if(Ry)return Fl;Ry=1;var n=uA(),e=im(),t=wx();function s(a){var o="https://react.dev/errors/"+a;if(1<arguments.length){o+="?args[]="+encodeURIComponent(arguments[1]);for(var d=2;d<arguments.length;d++)o+="&args[]="+encodeURIComponent(arguments[d])}return"Minified React error #"+a+"; visit "+o+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function i(a){return!(!a||a.nodeType!==1&&a.nodeType!==9&&a.nodeType!==11)}function r(a){var o=a,d=a;if(a.alternate)for(;o.return;)o=o.return;else{a=o;do o=a,(o.flags&4098)!==0&&(d=o.return),a=o.return;while(a)}return o.tag===3?d:null}function l(a){if(a.tag===13){var o=a.memoizedState;if(o===null&&(a=a.alternate,a!==null&&(o=a.memoizedState)),o!==null)return o.dehydrated}return null}function c(a){if(a.tag===31){var o=a.memoizedState;if(o===null&&(a=a.alternate,a!==null&&(o=a.memoizedState)),o!==null)return o.dehydrated}return null}function h(a){if(r(a)!==a)throw Error(s(188))}function u(a){var o=a.alternate;if(!o){if(o=r(a),o===null)throw Error(s(188));return o!==a?null:a}for(var d=a,m=o;;){var v=d.return;if(v===null)break;var b=v.alternate;if(b===null){if(m=v.return,m!==null){d=m;continue}break}if(v.child===b.child){for(b=v.child;b;){if(b===d)return h(v),a;if(b===m)return h(v),o;b=b.sibling}throw Error(s(188))}if(d.return!==m.return)d=v,m=b;else{for(var R=!1,O=v.child;O;){if(O===d){R=!0,d=v,m=b;break}if(O===m){R=!0,m=v,d=b;break}O=O.sibling}if(!R){for(O=b.child;O;){if(O===d){R=!0,d=b,m=v;break}if(O===m){R=!0,m=b,d=v;break}O=O.sibling}if(!R)throw Error(s(189))}}if(d.alternate!==m)throw Error(s(190))}if(d.tag!==3)throw Error(s(188));return d.stateNode.current===d?a:o}function f(a){var o=a.tag;if(o===5||o===26||o===27||o===6)return a;for(a=a.child;a!==null;){if(o=f(a),o!==null)return o;a=a.sibling}return null}var g=Object.assign,y=Symbol.for("react.element"),x=Symbol.for("react.transitional.element"),S=Symbol.for("react.portal"),E=Symbol.for("react.fragment"),T=Symbol.for("react.strict_mode"),A=Symbol.for("react.profiler"),_=Symbol.for("react.consumer"),I=Symbol.for("react.context"),C=Symbol.for("react.forward_ref"),N=Symbol.for("react.suspense"),D=Symbol.for("react.suspense_list"),k=Symbol.for("react.memo"),B=Symbol.for("react.lazy"),j=Symbol.for("react.activity"),U=Symbol.for("react.memo_cache_sentinel"),K=Symbol.iterator;function H(a){return a===null||typeof a!="object"?null:(a=K&&a[K]||a["@@iterator"],typeof a=="function"?a:null)}var J=Symbol.for("react.client.reference");function re(a){if(a==null)return null;if(typeof a=="function")return a.$$typeof===J?null:a.displayName||a.name||null;if(typeof a=="string")return a;switch(a){case E:return"Fragment";case A:return"Profiler";case T:return"StrictMode";case N:return"Suspense";case D:return"SuspenseList";case j:return"Activity"}if(typeof a=="object")switch(a.$$typeof){case S:return"Portal";case I:return a.displayName||"Context";case _:return(a._context.displayName||"Context")+".Consumer";case C:var o=a.render;return a=a.displayName,a||(a=o.displayName||o.name||"",a=a!==""?"ForwardRef("+a+")":"ForwardRef"),a;case k:return o=a.displayName||null,o!==null?o:re(a.type)||"Memo";case B:o=a._payload,a=a._init;try{return re(a(o))}catch{}}return null}var me=Array.isArray,M=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,$=t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,F={pending:!1,data:null,method:null,action:null},ae=[],de=-1;function P(a){return{current:a}}function G(a){0>de||(a.current=ae[de],ae[de]=null,de--)}function te(a,o){de++,ae[de]=a.current,a.current=o}var fe=P(null),ve=P(null),Ae=P(null),De=P(null);function Ge(a,o){switch(te(Ae,o),te(ve,a),te(fe,null),o.nodeType){case 9:case 11:a=(a=o.documentElement)&&(a=a.namespaceURI)?$0(a):0;break;default:if(a=o.tagName,o=o.namespaceURI)o=$0(o),a=G0(o,a);else switch(a){case"svg":a=1;break;case"math":a=2;break;default:a=0}}G(fe),te(fe,a)}function Fe(){G(fe),G(ve),G(Ae)}function mt(a){a.memoizedState!==null&&te(De,a);var o=fe.current,d=G0(o,a.type);o!==d&&(te(ve,a),te(fe,d))}function St(a){ve.current===a&&(G(fe),G(ve)),De.current===a&&(G(De),Pl._currentValue=F)}var jt,bt;function ut(a){if(jt===void 0)try{throw Error()}catch(d){var o=d.stack.trim().match(/\n( *(at )?)/);jt=o&&o[1]||"",bt=-1<d.stack.indexOf(`
    at`)?" (<anonymous>)":-1<d.stack.indexOf("@")?"@unknown:0:0":""}return`
`+jt+a+bt}var zt=!1;function Me(a,o){if(!a||zt)return"";zt=!0;var d=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var m={DetermineComponentFrameRoot:function(){try{if(o){var pe=function(){throw Error()};if(Object.defineProperty(pe.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(pe,[])}catch(ie){var Z=ie}Reflect.construct(a,[],pe)}else{try{pe.call()}catch(ie){Z=ie}a.call(pe.prototype)}}else{try{throw Error()}catch(ie){Z=ie}(pe=a())&&typeof pe.catch=="function"&&pe.catch(function(){})}}catch(ie){if(ie&&Z&&typeof ie.stack=="string")return[ie.stack,Z.stack]}return[null,null]}};m.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var v=Object.getOwnPropertyDescriptor(m.DetermineComponentFrameRoot,"name");v&&v.configurable&&Object.defineProperty(m.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var b=m.DetermineComponentFrameRoot(),R=b[0],O=b[1];if(R&&O){var V=R.split(`
`),X=O.split(`
`);for(v=m=0;m<V.length&&!V[m].includes("DetermineComponentFrameRoot");)m++;for(;v<X.length&&!X[v].includes("DetermineComponentFrameRoot");)v++;if(m===V.length||v===X.length)for(m=V.length-1,v=X.length-1;1<=m&&0<=v&&V[m]!==X[v];)v--;for(;1<=m&&0<=v;m--,v--)if(V[m]!==X[v]){if(m!==1||v!==1)do if(m--,v--,0>v||V[m]!==X[v]){var le=`
`+V[m].replace(" at new "," at ");return a.displayName&&le.includes("<anonymous>")&&(le=le.replace("<anonymous>",a.displayName)),le}while(1<=m&&0<=v);break}}}finally{zt=!1,Error.prepareStackTrace=d}return(d=a?a.displayName||a.name:"")?ut(d):""}function Le(a,o){switch(a.tag){case 26:case 27:case 5:return ut(a.type);case 16:return ut("Lazy");case 13:return a.child!==o&&o!==null?ut("Suspense Fallback"):ut("Suspense");case 19:return ut("SuspenseList");case 0:case 15:return Me(a.type,!1);case 11:return Me(a.type.render,!1);case 1:return Me(a.type,!0);case 31:return ut("Activity");default:return""}}function Ue(a){try{var o="",d=null;do o+=Le(a,d),d=a,a=a.return;while(a);return o}catch(m){return`
Error generating stack: `+m.message+`
`+m.stack}}var Ze=Object.prototype.hasOwnProperty,ht=n.unstable_scheduleCallback,Oe=n.unstable_cancelCallback,He=n.unstable_shouldYield,pt=n.unstable_requestPaint,nt=n.unstable_now,Kt=n.unstable_getCurrentPriorityLevel,ge=n.unstable_ImmediatePriority,Qe=n.unstable_UserBlockingPriority,st=n.unstable_NormalPriority,Zt=n.unstable_LowPriority,Rs=n.unstable_IdlePriority,vs=n.log,bi=n.unstable_setDisableYieldValue,js=null,Bt=null;function cs(a){if(typeof vs=="function"&&bi(a),Bt&&typeof Bt.setStrictMode=="function")try{Bt.setStrictMode(js,a)}catch{}}var wt=Math.clz32?Math.clz32:Ls,ii=Math.log,Ti=Math.LN2;function Ls(a){return a>>>=0,a===0?32:31-(ii(a)/Ti|0)|0}var ws=256,Cs=262144,ni=4194304;function Bs(a){var o=a&42;if(o!==0)return o;switch(a&-a){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return a&261888;case 262144:case 524288:case 1048576:case 2097152:return a&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return a&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return a}}function Ns(a,o,d){var m=a.pendingLanes;if(m===0)return 0;var v=0,b=a.suspendedLanes,R=a.pingedLanes;a=a.warmLanes;var O=m&134217727;return O!==0?(m=O&~b,m!==0?v=Bs(m):(R&=O,R!==0?v=Bs(R):d||(d=O&~a,d!==0&&(v=Bs(d))))):(O=m&~b,O!==0?v=Bs(O):R!==0?v=Bs(R):d||(d=m&~a,d!==0&&(v=Bs(d)))),v===0?0:o!==0&&o!==v&&(o&b)===0&&(b=v&-v,d=o&-o,b>=d||b===32&&(d&4194048)!==0)?o:v}function Gs(a,o){return(a.pendingLanes&~(a.suspendedLanes&~a.pingedLanes)&o)===0}function ai(a,o){switch(a){case 1:case 2:case 4:case 8:case 64:return o+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Qi(){var a=ni;return ni<<=1,(ni&62914560)===0&&(ni=4194304),a}function Jt(a){for(var o=[],d=0;31>d;d++)o.push(a);return o}function us(a,o){a.pendingLanes|=o,o!==268435456&&(a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0)}function Os(a,o,d,m,v,b){var R=a.pendingLanes;a.pendingLanes=d,a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0,a.expiredLanes&=d,a.entangledLanes&=d,a.errorRecoveryDisabledLanes&=d,a.shellSuspendCounter=0;var O=a.entanglements,V=a.expirationTimes,X=a.hiddenUpdates;for(d=R&~d;0<d;){var le=31-wt(d),pe=1<<le;O[le]=0,V[le]=-1;var Z=X[le];if(Z!==null)for(X[le]=null,le=0;le<Z.length;le++){var ie=Z[le];ie!==null&&(ie.lane&=-536870913)}d&=~pe}m!==0&&Fs(a,m,0),b!==0&&v===0&&a.tag!==0&&(a.suspendedLanes|=b&~(R&~o))}function Fs(a,o,d){a.pendingLanes|=o,a.suspendedLanes&=~o;var m=31-wt(o);a.entangledLanes|=o,a.entanglements[m]=a.entanglements[m]|1073741824|d&261930}function Bi(a,o){var d=a.entangledLanes|=o;for(a=a.entanglements;d;){var m=31-wt(d),v=1<<m;v&o|a[m]&o&&(a[m]|=o),d&=~v}}function ce(a,o){var d=o&-o;return d=(d&42)!==0?1:Ce(d),(d&(a.suspendedLanes|o))!==0?0:d}function Ce(a){switch(a){case 2:a=1;break;case 8:a=4;break;case 32:a=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:a=128;break;case 268435456:a=134217728;break;default:a=0}return a}function Je(a){return a&=-a,2<a?8<a?(a&134217727)!==0?32:268435456:8:2}function is(){var a=$.p;return a!==0?a:(a=window.event,a===void 0?32:hy(a.type))}function Ie(a,o){var d=$.p;try{return $.p=a,o()}finally{$.p=d}}var ks=Math.random().toString(36).slice(2),At="__reactFiber$"+ks,gt="__reactProps$"+ks,Fi="__reactContainer$"+ks,Ei="__reactEvents$"+ks,uo="__reactListeners$"+ks,ho="__reactHandles$"+ks,Xa="__reactResources$"+ks,Gn="__reactMarker$"+ks;function Ai(a){delete a[At],delete a[gt],delete a[Ei],delete a[uo],delete a[ho]}function Hn(a){var o=a[At];if(o)return o;for(var d=a.parentNode;d;){if(o=d[Fi]||d[At]){if(d=o.alternate,o.child!==null||d!==null&&d.child!==null)for(a=W0(a);a!==null;){if(d=a[At])return d;a=W0(a)}return o}a=d,d=a.parentNode}return null}function zn(a){if(a=a[At]||a[Fi]){var o=a.tag;if(o===5||o===6||o===13||o===31||o===26||o===27||o===3)return a}return null}function Ia(a){var o=a.tag;if(o===5||o===26||o===27||o===6)return a.stateNode;throw Error(s(33))}function mn(a){var o=a[Xa];return o||(o=a[Xa]={hoistableStyles:new Map,hoistableScripts:new Map}),o}function ns(a){a[Gn]=!0}var fo=new Set,mo={};function pn(a,o){Kn(a,o),Kn(a+"Capture",o)}function Kn(a,o){for(mo[a]=o,a=0;a<o.length;a++)fo.add(o[a])}var Wr=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),po={},go={};function ju(a){return Ze.call(go,a)?!0:Ze.call(po,a)?!1:Wr.test(a)?go[a]=!0:(po[a]=!0,!1)}function Za(a,o,d){if(ju(o))if(d===null)a.removeAttribute(o);else{switch(typeof d){case"undefined":case"function":case"symbol":a.removeAttribute(o);return;case"boolean":var m=o.toLowerCase().slice(0,5);if(m!=="data-"&&m!=="aria-"){a.removeAttribute(o);return}}a.setAttribute(o,""+d)}}function Yn(a,o,d){if(d===null)a.removeAttribute(o);else{switch(typeof d){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(o);return}a.setAttribute(o,""+d)}}function Vi(a,o,d,m){if(m===null)a.removeAttribute(d);else{switch(typeof m){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(d);return}a.setAttributeNS(o,d,""+m)}}function Hs(a){switch(typeof a){case"bigint":case"boolean":case"number":case"string":case"undefined":return a;case"object":return a;default:return""}}function ne(a){var o=a.type;return(a=a.nodeName)&&a.toLowerCase()==="input"&&(o==="checkbox"||o==="radio")}function we(a,o,d){var m=Object.getOwnPropertyDescriptor(a.constructor.prototype,o);if(!a.hasOwnProperty(o)&&typeof m<"u"&&typeof m.get=="function"&&typeof m.set=="function"){var v=m.get,b=m.set;return Object.defineProperty(a,o,{configurable:!0,get:function(){return v.call(this)},set:function(R){d=""+R,b.call(this,R)}}),Object.defineProperty(a,o,{enumerable:m.enumerable}),{getValue:function(){return d},setValue:function(R){d=""+R},stopTracking:function(){a._valueTracker=null,delete a[o]}}}}function et(a){if(!a._valueTracker){var o=ne(a)?"checked":"value";a._valueTracker=we(a,o,""+a[o])}}function ft(a){if(!a)return!1;var o=a._valueTracker;if(!o)return!0;var d=o.getValue(),m="";return a&&(m=ne(a)?a.checked?"true":"false":a.value),a=m,a!==d?(o.setValue(a),!0):!1}function Tt(a){if(a=a||(typeof document<"u"?document:void 0),typeof a>"u")return null;try{return a.activeElement||a.body}catch{return a.body}}var ms=/[\n"\\]/g;function Ct(a){return a.replace(ms,function(o){return"\\"+o.charCodeAt(0).toString(16)+" "})}function Wi(a,o,d,m,v,b,R,O){a.name="",R!=null&&typeof R!="function"&&typeof R!="symbol"&&typeof R!="boolean"?a.type=R:a.removeAttribute("type"),o!=null?R==="number"?(o===0&&a.value===""||a.value!=o)&&(a.value=""+Hs(o)):a.value!==""+Hs(o)&&(a.value=""+Hs(o)):R!=="submit"&&R!=="reset"||a.removeAttribute("value"),o!=null?Ja(a,R,Hs(o)):d!=null?Ja(a,R,Hs(d)):m!=null&&a.removeAttribute("value"),v==null&&b!=null&&(a.defaultChecked=!!b),v!=null&&(a.checked=v&&typeof v!="function"&&typeof v!="symbol"),O!=null&&typeof O!="function"&&typeof O!="symbol"&&typeof O!="boolean"?a.name=""+Hs(O):a.removeAttribute("name")}function xs(a,o,d,m,v,b,R,O){if(b!=null&&typeof b!="function"&&typeof b!="symbol"&&typeof b!="boolean"&&(a.type=b),o!=null||d!=null){if(!(b!=="submit"&&b!=="reset"||o!=null)){et(a);return}d=d!=null?""+Hs(d):"",o=o!=null?""+Hs(o):d,O||o===a.value||(a.value=o),a.defaultValue=o}m=m??v,m=typeof m!="function"&&typeof m!="symbol"&&!!m,a.checked=O?a.checked:!!m,a.defaultChecked=!!m,R!=null&&typeof R!="function"&&typeof R!="symbol"&&typeof R!="boolean"&&(a.name=R),et(a)}function Ja(a,o,d){o==="number"&&Tt(a.ownerDocument)===a||a.defaultValue===""+d||(a.defaultValue=""+d)}function gn(a,o,d,m){if(a=a.options,o){o={};for(var v=0;v<d.length;v++)o["$"+d[v]]=!0;for(d=0;d<a.length;d++)v=o.hasOwnProperty("$"+a[d].value),a[d].selected!==v&&(a[d].selected=v),v&&m&&(a[d].defaultSelected=!0)}else{for(d=""+Hs(d),o=null,v=0;v<a.length;v++){if(a[v].value===d){a[v].selected=!0,m&&(a[v].defaultSelected=!0);return}o!==null||a[v].disabled||(o=a[v])}o!==null&&(o.selected=!0)}}function Xr(a,o,d){if(o!=null&&(o=""+Hs(o),o!==a.value&&(a.value=o),d==null)){a.defaultValue!==o&&(a.defaultValue=o);return}a.defaultValue=d!=null?""+Hs(d):""}function yo(a,o,d,m){if(o==null){if(m!=null){if(d!=null)throw Error(s(92));if(me(m)){if(1<m.length)throw Error(s(93));m=m[0]}d=m}d==null&&(d=""),o=d}d=Hs(o),a.defaultValue=d,m=a.textContent,m===d&&m!==""&&m!==null&&(a.value=m),et(a)}function yn(a,o){if(o){var d=a.firstChild;if(d&&d===a.lastChild&&d.nodeType===3){d.nodeValue=o;return}}a.textContent=o}var Bu=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function vo(a,o,d){var m=o.indexOf("--")===0;d==null||typeof d=="boolean"||d===""?m?a.setProperty(o,""):o==="float"?a.cssFloat="":a[o]="":m?a.setProperty(o,d):typeof d!="number"||d===0||Bu.has(o)?o==="float"?a.cssFloat=d:a[o]=(""+d).trim():a[o]=d+"px"}function xo(a,o,d){if(o!=null&&typeof o!="object")throw Error(s(62));if(a=a.style,d!=null){for(var m in d)!d.hasOwnProperty(m)||o!=null&&o.hasOwnProperty(m)||(m.indexOf("--")===0?a.setProperty(m,""):m==="float"?a.cssFloat="":a[m]="");for(var v in o)m=o[v],o.hasOwnProperty(v)&&d[v]!==m&&vo(a,v,m)}else for(var b in o)o.hasOwnProperty(b)&&vo(a,b,o[b])}function Fu(a){if(a.indexOf("-")===-1)return!1;switch(a){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var eT=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),tT=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function So(a){return tT.test(""+a)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":a}function vn(){}var Vu=null;function $u(a){return a=a.target||a.srcElement||window,a.correspondingUseElement&&(a=a.correspondingUseElement),a.nodeType===3?a.parentNode:a}var er=null,tr=null;function Vm(a){var o=zn(a);if(o&&(a=o.stateNode)){var d=a[gt]||null;e:switch(a=o.stateNode,o.type){case"input":if(Wi(a,d.value,d.defaultValue,d.defaultValue,d.checked,d.defaultChecked,d.type,d.name),o=d.name,d.type==="radio"&&o!=null){for(d=a;d.parentNode;)d=d.parentNode;for(d=d.querySelectorAll('input[name="'+Ct(""+o)+'"][type="radio"]'),o=0;o<d.length;o++){var m=d[o];if(m!==a&&m.form===a.form){var v=m[gt]||null;if(!v)throw Error(s(90));Wi(m,v.value,v.defaultValue,v.defaultValue,v.checked,v.defaultChecked,v.type,v.name)}}for(o=0;o<d.length;o++)m=d[o],m.form===a.form&&ft(m)}break e;case"textarea":Xr(a,d.value,d.defaultValue);break e;case"select":o=d.value,o!=null&&gn(a,!!d.multiple,o,!1)}}}var Gu=!1;function $m(a,o,d){if(Gu)return a(o,d);Gu=!0;try{var m=a(o);return m}finally{if(Gu=!1,(er!==null||tr!==null)&&(lc(),er&&(o=er,a=tr,tr=er=null,Vm(o),a)))for(o=0;o<a.length;o++)Vm(a[o])}}function Zr(a,o){var d=a.stateNode;if(d===null)return null;var m=d[gt]||null;if(m===null)return null;d=m[o];e:switch(o){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(m=!m.disabled)||(a=a.type,m=!(a==="button"||a==="input"||a==="select"||a==="textarea")),a=!m;break e;default:a=!1}if(a)return null;if(d&&typeof d!="function")throw Error(s(231,o,typeof d));return d}var xn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Hu=!1;if(xn)try{var Jr={};Object.defineProperty(Jr,"passive",{get:function(){Hu=!0}}),window.addEventListener("test",Jr,Jr),window.removeEventListener("test",Jr,Jr)}catch{Hu=!1}var qn=null,zu=null,bo=null;function Gm(){if(bo)return bo;var a,o=zu,d=o.length,m,v="value"in qn?qn.value:qn.textContent,b=v.length;for(a=0;a<d&&o[a]===v[a];a++);var R=d-a;for(m=1;m<=R&&o[d-m]===v[b-m];m++);return bo=v.slice(a,1<m?1-m:void 0)}function To(a){var o=a.keyCode;return"charCode"in a?(a=a.charCode,a===0&&o===13&&(a=13)):a=o,a===10&&(a=13),32<=a||a===13?a:0}function Eo(){return!0}function Hm(){return!1}function zs(a){function o(d,m,v,b,R){this._reactName=d,this._targetInst=v,this.type=m,this.nativeEvent=b,this.target=R,this.currentTarget=null;for(var O in a)a.hasOwnProperty(O)&&(d=a[O],this[O]=d?d(b):b[O]);return this.isDefaultPrevented=(b.defaultPrevented!=null?b.defaultPrevented:b.returnValue===!1)?Eo:Hm,this.isPropagationStopped=Hm,this}return g(o.prototype,{preventDefault:function(){this.defaultPrevented=!0;var d=this.nativeEvent;d&&(d.preventDefault?d.preventDefault():typeof d.returnValue!="unknown"&&(d.returnValue=!1),this.isDefaultPrevented=Eo)},stopPropagation:function(){var d=this.nativeEvent;d&&(d.stopPropagation?d.stopPropagation():typeof d.cancelBubble!="unknown"&&(d.cancelBubble=!0),this.isPropagationStopped=Eo)},persist:function(){},isPersistent:Eo}),o}var _a={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(a){return a.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Ao=zs(_a),el=g({},_a,{view:0,detail:0}),sT=zs(el),Ku,Yu,tl,Io=g({},el,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Qu,button:0,buttons:0,relatedTarget:function(a){return a.relatedTarget===void 0?a.fromElement===a.srcElement?a.toElement:a.fromElement:a.relatedTarget},movementX:function(a){return"movementX"in a?a.movementX:(a!==tl&&(tl&&a.type==="mousemove"?(Ku=a.screenX-tl.screenX,Yu=a.screenY-tl.screenY):Yu=Ku=0,tl=a),Ku)},movementY:function(a){return"movementY"in a?a.movementY:Yu}}),zm=zs(Io),iT=g({},Io,{dataTransfer:0}),nT=zs(iT),aT=g({},el,{relatedTarget:0}),qu=zs(aT),rT=g({},_a,{animationName:0,elapsedTime:0,pseudoElement:0}),lT=zs(rT),oT=g({},_a,{clipboardData:function(a){return"clipboardData"in a?a.clipboardData:window.clipboardData}}),cT=zs(oT),uT=g({},_a,{data:0}),Km=zs(uT),dT={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},hT={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},fT={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function mT(a){var o=this.nativeEvent;return o.getModifierState?o.getModifierState(a):(a=fT[a])?!!o[a]:!1}function Qu(){return mT}var pT=g({},el,{key:function(a){if(a.key){var o=dT[a.key]||a.key;if(o!=="Unidentified")return o}return a.type==="keypress"?(a=To(a),a===13?"Enter":String.fromCharCode(a)):a.type==="keydown"||a.type==="keyup"?hT[a.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Qu,charCode:function(a){return a.type==="keypress"?To(a):0},keyCode:function(a){return a.type==="keydown"||a.type==="keyup"?a.keyCode:0},which:function(a){return a.type==="keypress"?To(a):a.type==="keydown"||a.type==="keyup"?a.keyCode:0}}),gT=zs(pT),yT=g({},Io,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Ym=zs(yT),vT=g({},el,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Qu}),xT=zs(vT),ST=g({},_a,{propertyName:0,elapsedTime:0,pseudoElement:0}),bT=zs(ST),TT=g({},Io,{deltaX:function(a){return"deltaX"in a?a.deltaX:"wheelDeltaX"in a?-a.wheelDeltaX:0},deltaY:function(a){return"deltaY"in a?a.deltaY:"wheelDeltaY"in a?-a.wheelDeltaY:"wheelDelta"in a?-a.wheelDelta:0},deltaZ:0,deltaMode:0}),ET=zs(TT),AT=g({},_a,{newState:0,oldState:0}),IT=zs(AT),_T=[9,13,27,32],Wu=xn&&"CompositionEvent"in window,sl=null;xn&&"documentMode"in document&&(sl=document.documentMode);var RT=xn&&"TextEvent"in window&&!sl,qm=xn&&(!Wu||sl&&8<sl&&11>=sl),Qm=" ",Wm=!1;function Xm(a,o){switch(a){case"keyup":return _T.indexOf(o.keyCode)!==-1;case"keydown":return o.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Zm(a){return a=a.detail,typeof a=="object"&&"data"in a?a.data:null}var sr=!1;function LT(a,o){switch(a){case"compositionend":return Zm(o);case"keypress":return o.which!==32?null:(Wm=!0,Qm);case"textInput":return a=o.data,a===Qm&&Wm?null:a;default:return null}}function wT(a,o){if(sr)return a==="compositionend"||!Wu&&Xm(a,o)?(a=Gm(),bo=zu=qn=null,sr=!1,a):null;switch(a){case"paste":return null;case"keypress":if(!(o.ctrlKey||o.altKey||o.metaKey)||o.ctrlKey&&o.altKey){if(o.char&&1<o.char.length)return o.char;if(o.which)return String.fromCharCode(o.which)}return null;case"compositionend":return qm&&o.locale!=="ko"?null:o.data;default:return null}}var CT={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Jm(a){var o=a&&a.nodeName&&a.nodeName.toLowerCase();return o==="input"?!!CT[a.type]:o==="textarea"}function ep(a,o,d,m){er?tr?tr.push(m):tr=[m]:er=m,o=mc(o,"onChange"),0<o.length&&(d=new Ao("onChange","change",null,d,m),a.push({event:d,listeners:o}))}var il=null,nl=null;function NT(a){U0(a,0)}function _o(a){var o=Ia(a);if(ft(o))return a}function tp(a,o){if(a==="change")return o}var sp=!1;if(xn){var Xu;if(xn){var Zu="oninput"in document;if(!Zu){var ip=document.createElement("div");ip.setAttribute("oninput","return;"),Zu=typeof ip.oninput=="function"}Xu=Zu}else Xu=!1;sp=Xu&&(!document.documentMode||9<document.documentMode)}function np(){il&&(il.detachEvent("onpropertychange",ap),nl=il=null)}function ap(a){if(a.propertyName==="value"&&_o(nl)){var o=[];ep(o,nl,a,$u(a)),$m(NT,o)}}function OT(a,o,d){a==="focusin"?(np(),il=o,nl=d,il.attachEvent("onpropertychange",ap)):a==="focusout"&&np()}function kT(a){if(a==="selectionchange"||a==="keyup"||a==="keydown")return _o(nl)}function DT(a,o){if(a==="click")return _o(o)}function PT(a,o){if(a==="input"||a==="change")return _o(o)}function UT(a,o){return a===o&&(a!==0||1/a===1/o)||a!==a&&o!==o}var ri=typeof Object.is=="function"?Object.is:UT;function al(a,o){if(ri(a,o))return!0;if(typeof a!="object"||a===null||typeof o!="object"||o===null)return!1;var d=Object.keys(a),m=Object.keys(o);if(d.length!==m.length)return!1;for(m=0;m<d.length;m++){var v=d[m];if(!Ze.call(o,v)||!ri(a[v],o[v]))return!1}return!0}function rp(a){for(;a&&a.firstChild;)a=a.firstChild;return a}function lp(a,o){var d=rp(a);a=0;for(var m;d;){if(d.nodeType===3){if(m=a+d.textContent.length,a<=o&&m>=o)return{node:d,offset:o-a};a=m}e:{for(;d;){if(d.nextSibling){d=d.nextSibling;break e}d=d.parentNode}d=void 0}d=rp(d)}}function op(a,o){return a&&o?a===o?!0:a&&a.nodeType===3?!1:o&&o.nodeType===3?op(a,o.parentNode):"contains"in a?a.contains(o):a.compareDocumentPosition?!!(a.compareDocumentPosition(o)&16):!1:!1}function cp(a){a=a!=null&&a.ownerDocument!=null&&a.ownerDocument.defaultView!=null?a.ownerDocument.defaultView:window;for(var o=Tt(a.document);o instanceof a.HTMLIFrameElement;){try{var d=typeof o.contentWindow.location.href=="string"}catch{d=!1}if(d)a=o.contentWindow;else break;o=Tt(a.document)}return o}function Ju(a){var o=a&&a.nodeName&&a.nodeName.toLowerCase();return o&&(o==="input"&&(a.type==="text"||a.type==="search"||a.type==="tel"||a.type==="url"||a.type==="password")||o==="textarea"||a.contentEditable==="true")}var MT=xn&&"documentMode"in document&&11>=document.documentMode,ir=null,ed=null,rl=null,td=!1;function up(a,o,d){var m=d.window===d?d.document:d.nodeType===9?d:d.ownerDocument;td||ir==null||ir!==Tt(m)||(m=ir,"selectionStart"in m&&Ju(m)?m={start:m.selectionStart,end:m.selectionEnd}:(m=(m.ownerDocument&&m.ownerDocument.defaultView||window).getSelection(),m={anchorNode:m.anchorNode,anchorOffset:m.anchorOffset,focusNode:m.focusNode,focusOffset:m.focusOffset}),rl&&al(rl,m)||(rl=m,m=mc(ed,"onSelect"),0<m.length&&(o=new Ao("onSelect","select",null,o,d),a.push({event:o,listeners:m}),o.target=ir)))}function Ra(a,o){var d={};return d[a.toLowerCase()]=o.toLowerCase(),d["Webkit"+a]="webkit"+o,d["Moz"+a]="moz"+o,d}var nr={animationend:Ra("Animation","AnimationEnd"),animationiteration:Ra("Animation","AnimationIteration"),animationstart:Ra("Animation","AnimationStart"),transitionrun:Ra("Transition","TransitionRun"),transitionstart:Ra("Transition","TransitionStart"),transitioncancel:Ra("Transition","TransitionCancel"),transitionend:Ra("Transition","TransitionEnd")},sd={},dp={};xn&&(dp=document.createElement("div").style,"AnimationEvent"in window||(delete nr.animationend.animation,delete nr.animationiteration.animation,delete nr.animationstart.animation),"TransitionEvent"in window||delete nr.transitionend.transition);function La(a){if(sd[a])return sd[a];if(!nr[a])return a;var o=nr[a],d;for(d in o)if(o.hasOwnProperty(d)&&d in dp)return sd[a]=o[d];return a}var hp=La("animationend"),fp=La("animationiteration"),mp=La("animationstart"),jT=La("transitionrun"),BT=La("transitionstart"),FT=La("transitioncancel"),pp=La("transitionend"),gp=new Map,id="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");id.push("scrollEnd");function $i(a,o){gp.set(a,o),pn(o,[a])}var Ro=typeof reportError=="function"?reportError:function(a){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var o=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof a=="object"&&a!==null&&typeof a.message=="string"?String(a.message):String(a),error:a});if(!window.dispatchEvent(o))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",a);return}console.error(a)},Ii=[],ar=0,nd=0;function Lo(){for(var a=ar,o=nd=ar=0;o<a;){var d=Ii[o];Ii[o++]=null;var m=Ii[o];Ii[o++]=null;var v=Ii[o];Ii[o++]=null;var b=Ii[o];if(Ii[o++]=null,m!==null&&v!==null){var R=m.pending;R===null?v.next=v:(v.next=R.next,R.next=v),m.pending=v}b!==0&&yp(d,v,b)}}function wo(a,o,d,m){Ii[ar++]=a,Ii[ar++]=o,Ii[ar++]=d,Ii[ar++]=m,nd|=m,a.lanes|=m,a=a.alternate,a!==null&&(a.lanes|=m)}function ad(a,o,d,m){return wo(a,o,d,m),Co(a)}function wa(a,o){return wo(a,null,null,o),Co(a)}function yp(a,o,d){a.lanes|=d;var m=a.alternate;m!==null&&(m.lanes|=d);for(var v=!1,b=a.return;b!==null;)b.childLanes|=d,m=b.alternate,m!==null&&(m.childLanes|=d),b.tag===22&&(a=b.stateNode,a===null||a._visibility&1||(v=!0)),a=b,b=b.return;return a.tag===3?(b=a.stateNode,v&&o!==null&&(v=31-wt(d),a=b.hiddenUpdates,m=a[v],m===null?a[v]=[o]:m.push(o),o.lane=d|536870912),b):null}function Co(a){if(50<Ll)throw Ll=0,mh=null,Error(s(185));for(var o=a.return;o!==null;)a=o,o=a.return;return a.tag===3?a.stateNode:null}var rr={};function VT(a,o,d,m){this.tag=a,this.key=d,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=o,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=m,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function li(a,o,d,m){return new VT(a,o,d,m)}function rd(a){return a=a.prototype,!(!a||!a.isReactComponent)}function Sn(a,o){var d=a.alternate;return d===null?(d=li(a.tag,o,a.key,a.mode),d.elementType=a.elementType,d.type=a.type,d.stateNode=a.stateNode,d.alternate=a,a.alternate=d):(d.pendingProps=o,d.type=a.type,d.flags=0,d.subtreeFlags=0,d.deletions=null),d.flags=a.flags&65011712,d.childLanes=a.childLanes,d.lanes=a.lanes,d.child=a.child,d.memoizedProps=a.memoizedProps,d.memoizedState=a.memoizedState,d.updateQueue=a.updateQueue,o=a.dependencies,d.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext},d.sibling=a.sibling,d.index=a.index,d.ref=a.ref,d.refCleanup=a.refCleanup,d}function vp(a,o){a.flags&=65011714;var d=a.alternate;return d===null?(a.childLanes=0,a.lanes=o,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=d.childLanes,a.lanes=d.lanes,a.child=d.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=d.memoizedProps,a.memoizedState=d.memoizedState,a.updateQueue=d.updateQueue,a.type=d.type,o=d.dependencies,a.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext}),a}function No(a,o,d,m,v,b){var R=0;if(m=a,typeof a=="function")rd(a)&&(R=1);else if(typeof a=="string")R=KE(a,d,fe.current)?26:a==="html"||a==="head"||a==="body"?27:5;else e:switch(a){case j:return a=li(31,d,o,v),a.elementType=j,a.lanes=b,a;case E:return Ca(d.children,v,b,o);case T:R=8,v|=24;break;case A:return a=li(12,d,o,v|2),a.elementType=A,a.lanes=b,a;case N:return a=li(13,d,o,v),a.elementType=N,a.lanes=b,a;case D:return a=li(19,d,o,v),a.elementType=D,a.lanes=b,a;default:if(typeof a=="object"&&a!==null)switch(a.$$typeof){case I:R=10;break e;case _:R=9;break e;case C:R=11;break e;case k:R=14;break e;case B:R=16,m=null;break e}R=29,d=Error(s(130,a===null?"null":typeof a,"")),m=null}return o=li(R,d,o,v),o.elementType=a,o.type=m,o.lanes=b,o}function Ca(a,o,d,m){return a=li(7,a,m,o),a.lanes=d,a}function ld(a,o,d){return a=li(6,a,null,o),a.lanes=d,a}function xp(a){var o=li(18,null,null,0);return o.stateNode=a,o}function od(a,o,d){return o=li(4,a.children!==null?a.children:[],a.key,o),o.lanes=d,o.stateNode={containerInfo:a.containerInfo,pendingChildren:null,implementation:a.implementation},o}var Sp=new WeakMap;function _i(a,o){if(typeof a=="object"&&a!==null){var d=Sp.get(a);return d!==void 0?d:(o={value:a,source:o,stack:Ue(o)},Sp.set(a,o),o)}return{value:a,source:o,stack:Ue(o)}}var lr=[],or=0,Oo=null,ll=0,Ri=[],Li=0,Qn=null,Xi=1,Zi="";function bn(a,o){lr[or++]=ll,lr[or++]=Oo,Oo=a,ll=o}function bp(a,o,d){Ri[Li++]=Xi,Ri[Li++]=Zi,Ri[Li++]=Qn,Qn=a;var m=Xi;a=Zi;var v=32-wt(m)-1;m&=~(1<<v),d+=1;var b=32-wt(o)+v;if(30<b){var R=v-v%5;b=(m&(1<<R)-1).toString(32),m>>=R,v-=R,Xi=1<<32-wt(o)+v|d<<v|m,Zi=b+a}else Xi=1<<b|d<<v|m,Zi=a}function cd(a){a.return!==null&&(bn(a,1),bp(a,1,0))}function ud(a){for(;a===Oo;)Oo=lr[--or],lr[or]=null,ll=lr[--or],lr[or]=null;for(;a===Qn;)Qn=Ri[--Li],Ri[Li]=null,Zi=Ri[--Li],Ri[Li]=null,Xi=Ri[--Li],Ri[Li]=null}function Tp(a,o){Ri[Li++]=Xi,Ri[Li++]=Zi,Ri[Li++]=Qn,Xi=o.id,Zi=o.overflow,Qn=a}var Ss=null,Ft=null,dt=!1,Wn=null,wi=!1,dd=Error(s(519));function Xn(a){var o=Error(s(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw ol(_i(o,a)),dd}function Ep(a){var o=a.stateNode,d=a.type,m=a.memoizedProps;switch(o[At]=a,o[gt]=m,d){case"dialog":lt("cancel",o),lt("close",o);break;case"iframe":case"object":case"embed":lt("load",o);break;case"video":case"audio":for(d=0;d<Cl.length;d++)lt(Cl[d],o);break;case"source":lt("error",o);break;case"img":case"image":case"link":lt("error",o),lt("load",o);break;case"details":lt("toggle",o);break;case"input":lt("invalid",o),xs(o,m.value,m.defaultValue,m.checked,m.defaultChecked,m.type,m.name,!0);break;case"select":lt("invalid",o);break;case"textarea":lt("invalid",o),yo(o,m.value,m.defaultValue,m.children)}d=m.children,typeof d!="string"&&typeof d!="number"&&typeof d!="bigint"||o.textContent===""+d||m.suppressHydrationWarning===!0||F0(o.textContent,d)?(m.popover!=null&&(lt("beforetoggle",o),lt("toggle",o)),m.onScroll!=null&&lt("scroll",o),m.onScrollEnd!=null&&lt("scrollend",o),m.onClick!=null&&(o.onclick=vn),o=!0):o=!1,o||Xn(a,!0)}function Ap(a){for(Ss=a.return;Ss;)switch(Ss.tag){case 5:case 31:case 13:wi=!1;return;case 27:case 3:wi=!0;return;default:Ss=Ss.return}}function cr(a){if(a!==Ss)return!1;if(!dt)return Ap(a),dt=!0,!1;var o=a.tag,d;if((d=o!==3&&o!==27)&&((d=o===5)&&(d=a.type,d=!(d!=="form"&&d!=="button")||wh(a.type,a.memoizedProps)),d=!d),d&&Ft&&Xn(a),Ap(a),o===13){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(s(317));Ft=Q0(a)}else if(o===31){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(s(317));Ft=Q0(a)}else o===27?(o=Ft,da(a.type)?(a=Dh,Dh=null,Ft=a):Ft=o):Ft=Ss?Ni(a.stateNode.nextSibling):null;return!0}function Na(){Ft=Ss=null,dt=!1}function hd(){var a=Wn;return a!==null&&(Qs===null?Qs=a:Qs.push.apply(Qs,a),Wn=null),a}function ol(a){Wn===null?Wn=[a]:Wn.push(a)}var fd=P(null),Oa=null,Tn=null;function Zn(a,o,d){te(fd,o._currentValue),o._currentValue=d}function En(a){a._currentValue=fd.current,G(fd)}function md(a,o,d){for(;a!==null;){var m=a.alternate;if((a.childLanes&o)!==o?(a.childLanes|=o,m!==null&&(m.childLanes|=o)):m!==null&&(m.childLanes&o)!==o&&(m.childLanes|=o),a===d)break;a=a.return}}function pd(a,o,d,m){var v=a.child;for(v!==null&&(v.return=a);v!==null;){var b=v.dependencies;if(b!==null){var R=v.child;b=b.firstContext;e:for(;b!==null;){var O=b;b=v;for(var V=0;V<o.length;V++)if(O.context===o[V]){b.lanes|=d,O=b.alternate,O!==null&&(O.lanes|=d),md(b.return,d,a),m||(R=null);break e}b=O.next}}else if(v.tag===18){if(R=v.return,R===null)throw Error(s(341));R.lanes|=d,b=R.alternate,b!==null&&(b.lanes|=d),md(R,d,a),R=null}else R=v.child;if(R!==null)R.return=v;else for(R=v;R!==null;){if(R===a){R=null;break}if(v=R.sibling,v!==null){v.return=R.return,R=v;break}R=R.return}v=R}}function ur(a,o,d,m){a=null;for(var v=o,b=!1;v!==null;){if(!b){if((v.flags&524288)!==0)b=!0;else if((v.flags&262144)!==0)break}if(v.tag===10){var R=v.alternate;if(R===null)throw Error(s(387));if(R=R.memoizedProps,R!==null){var O=v.type;ri(v.pendingProps.value,R.value)||(a!==null?a.push(O):a=[O])}}else if(v===De.current){if(R=v.alternate,R===null)throw Error(s(387));R.memoizedState.memoizedState!==v.memoizedState.memoizedState&&(a!==null?a.push(Pl):a=[Pl])}v=v.return}a!==null&&pd(o,a,d,m),o.flags|=262144}function ko(a){for(a=a.firstContext;a!==null;){if(!ri(a.context._currentValue,a.memoizedValue))return!0;a=a.next}return!1}function ka(a){Oa=a,Tn=null,a=a.dependencies,a!==null&&(a.firstContext=null)}function bs(a){return Ip(Oa,a)}function Do(a,o){return Oa===null&&ka(a),Ip(a,o)}function Ip(a,o){var d=o._currentValue;if(o={context:o,memoizedValue:d,next:null},Tn===null){if(a===null)throw Error(s(308));Tn=o,a.dependencies={lanes:0,firstContext:o},a.flags|=524288}else Tn=Tn.next=o;return d}var $T=typeof AbortController<"u"?AbortController:function(){var a=[],o=this.signal={aborted:!1,addEventListener:function(d,m){a.push(m)}};this.abort=function(){o.aborted=!0,a.forEach(function(d){return d()})}},GT=n.unstable_scheduleCallback,HT=n.unstable_NormalPriority,as={$$typeof:I,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function gd(){return{controller:new $T,data:new Map,refCount:0}}function cl(a){a.refCount--,a.refCount===0&&GT(HT,function(){a.controller.abort()})}var ul=null,yd=0,dr=0,hr=null;function zT(a,o){if(ul===null){var d=ul=[];yd=0,dr=Sh(),hr={status:"pending",value:void 0,then:function(m){d.push(m)}}}return yd++,o.then(_p,_p),o}function _p(){if(--yd===0&&ul!==null){hr!==null&&(hr.status="fulfilled");var a=ul;ul=null,dr=0,hr=null;for(var o=0;o<a.length;o++)(0,a[o])()}}function KT(a,o){var d=[],m={status:"pending",value:null,reason:null,then:function(v){d.push(v)}};return a.then(function(){m.status="fulfilled",m.value=o;for(var v=0;v<d.length;v++)(0,d[v])(o)},function(v){for(m.status="rejected",m.reason=v,v=0;v<d.length;v++)(0,d[v])(void 0)}),m}var Rp=M.S;M.S=function(a,o){u0=nt(),typeof o=="object"&&o!==null&&typeof o.then=="function"&&zT(a,o),Rp!==null&&Rp(a,o)};var Da=P(null);function vd(){var a=Da.current;return a!==null?a:Pt.pooledCache}function Po(a,o){o===null?te(Da,Da.current):te(Da,o.pool)}function Lp(){var a=vd();return a===null?null:{parent:as._currentValue,pool:a}}var fr=Error(s(460)),xd=Error(s(474)),Uo=Error(s(542)),Mo={then:function(){}};function wp(a){return a=a.status,a==="fulfilled"||a==="rejected"}function Cp(a,o,d){switch(d=a[d],d===void 0?a.push(o):d!==o&&(o.then(vn,vn),o=d),o.status){case"fulfilled":return o.value;case"rejected":throw a=o.reason,Op(a),a;default:if(typeof o.status=="string")o.then(vn,vn);else{if(a=Pt,a!==null&&100<a.shellSuspendCounter)throw Error(s(482));a=o,a.status="pending",a.then(function(m){if(o.status==="pending"){var v=o;v.status="fulfilled",v.value=m}},function(m){if(o.status==="pending"){var v=o;v.status="rejected",v.reason=m}})}switch(o.status){case"fulfilled":return o.value;case"rejected":throw a=o.reason,Op(a),a}throw Ua=o,fr}}function Pa(a){try{var o=a._init;return o(a._payload)}catch(d){throw d!==null&&typeof d=="object"&&typeof d.then=="function"?(Ua=d,fr):d}}var Ua=null;function Np(){if(Ua===null)throw Error(s(459));var a=Ua;return Ua=null,a}function Op(a){if(a===fr||a===Uo)throw Error(s(483))}var mr=null,dl=0;function jo(a){var o=dl;return dl+=1,mr===null&&(mr=[]),Cp(mr,a,o)}function hl(a,o){o=o.props.ref,a.ref=o!==void 0?o:null}function Bo(a,o){throw o.$$typeof===y?Error(s(525)):(a=Object.prototype.toString.call(o),Error(s(31,a==="[object Object]"?"object with keys {"+Object.keys(o).join(", ")+"}":a)))}function kp(a){function o(Y,z){if(a){var W=Y.deletions;W===null?(Y.deletions=[z],Y.flags|=16):W.push(z)}}function d(Y,z){if(!a)return null;for(;z!==null;)o(Y,z),z=z.sibling;return null}function m(Y){for(var z=new Map;Y!==null;)Y.key!==null?z.set(Y.key,Y):z.set(Y.index,Y),Y=Y.sibling;return z}function v(Y,z){return Y=Sn(Y,z),Y.index=0,Y.sibling=null,Y}function b(Y,z,W){return Y.index=W,a?(W=Y.alternate,W!==null?(W=W.index,W<z?(Y.flags|=67108866,z):W):(Y.flags|=67108866,z)):(Y.flags|=1048576,z)}function R(Y){return a&&Y.alternate===null&&(Y.flags|=67108866),Y}function O(Y,z,W,he){return z===null||z.tag!==6?(z=ld(W,Y.mode,he),z.return=Y,z):(z=v(z,W),z.return=Y,z)}function V(Y,z,W,he){var Ve=W.type;return Ve===E?le(Y,z,W.props.children,he,W.key):z!==null&&(z.elementType===Ve||typeof Ve=="object"&&Ve!==null&&Ve.$$typeof===B&&Pa(Ve)===z.type)?(z=v(z,W.props),hl(z,W),z.return=Y,z):(z=No(W.type,W.key,W.props,null,Y.mode,he),hl(z,W),z.return=Y,z)}function X(Y,z,W,he){return z===null||z.tag!==4||z.stateNode.containerInfo!==W.containerInfo||z.stateNode.implementation!==W.implementation?(z=od(W,Y.mode,he),z.return=Y,z):(z=v(z,W.children||[]),z.return=Y,z)}function le(Y,z,W,he,Ve){return z===null||z.tag!==7?(z=Ca(W,Y.mode,he,Ve),z.return=Y,z):(z=v(z,W),z.return=Y,z)}function pe(Y,z,W){if(typeof z=="string"&&z!==""||typeof z=="number"||typeof z=="bigint")return z=ld(""+z,Y.mode,W),z.return=Y,z;if(typeof z=="object"&&z!==null){switch(z.$$typeof){case x:return W=No(z.type,z.key,z.props,null,Y.mode,W),hl(W,z),W.return=Y,W;case S:return z=od(z,Y.mode,W),z.return=Y,z;case B:return z=Pa(z),pe(Y,z,W)}if(me(z)||H(z))return z=Ca(z,Y.mode,W,null),z.return=Y,z;if(typeof z.then=="function")return pe(Y,jo(z),W);if(z.$$typeof===I)return pe(Y,Do(Y,z),W);Bo(Y,z)}return null}function Z(Y,z,W,he){var Ve=z!==null?z.key:null;if(typeof W=="string"&&W!==""||typeof W=="number"||typeof W=="bigint")return Ve!==null?null:O(Y,z,""+W,he);if(typeof W=="object"&&W!==null){switch(W.$$typeof){case x:return W.key===Ve?V(Y,z,W,he):null;case S:return W.key===Ve?X(Y,z,W,he):null;case B:return W=Pa(W),Z(Y,z,W,he)}if(me(W)||H(W))return Ve!==null?null:le(Y,z,W,he,null);if(typeof W.then=="function")return Z(Y,z,jo(W),he);if(W.$$typeof===I)return Z(Y,z,Do(Y,W),he);Bo(Y,W)}return null}function ie(Y,z,W,he,Ve){if(typeof he=="string"&&he!==""||typeof he=="number"||typeof he=="bigint")return Y=Y.get(W)||null,O(z,Y,""+he,Ve);if(typeof he=="object"&&he!==null){switch(he.$$typeof){case x:return Y=Y.get(he.key===null?W:he.key)||null,V(z,Y,he,Ve);case S:return Y=Y.get(he.key===null?W:he.key)||null,X(z,Y,he,Ve);case B:return he=Pa(he),ie(Y,z,W,he,Ve)}if(me(he)||H(he))return Y=Y.get(W)||null,le(z,Y,he,Ve,null);if(typeof he.then=="function")return ie(Y,z,W,jo(he),Ve);if(he.$$typeof===I)return ie(Y,z,W,Do(z,he),Ve);Bo(z,he)}return null}function Pe(Y,z,W,he){for(var Ve=null,yt=null,je=z,tt=z=0,ct=null;je!==null&&tt<W.length;tt++){je.index>tt?(ct=je,je=null):ct=je.sibling;var vt=Z(Y,je,W[tt],he);if(vt===null){je===null&&(je=ct);break}a&&je&&vt.alternate===null&&o(Y,je),z=b(vt,z,tt),yt===null?Ve=vt:yt.sibling=vt,yt=vt,je=ct}if(tt===W.length)return d(Y,je),dt&&bn(Y,tt),Ve;if(je===null){for(;tt<W.length;tt++)je=pe(Y,W[tt],he),je!==null&&(z=b(je,z,tt),yt===null?Ve=je:yt.sibling=je,yt=je);return dt&&bn(Y,tt),Ve}for(je=m(je);tt<W.length;tt++)ct=ie(je,Y,tt,W[tt],he),ct!==null&&(a&&ct.alternate!==null&&je.delete(ct.key===null?tt:ct.key),z=b(ct,z,tt),yt===null?Ve=ct:yt.sibling=ct,yt=ct);return a&&je.forEach(function(ga){return o(Y,ga)}),dt&&bn(Y,tt),Ve}function $e(Y,z,W,he){if(W==null)throw Error(s(151));for(var Ve=null,yt=null,je=z,tt=z=0,ct=null,vt=W.next();je!==null&&!vt.done;tt++,vt=W.next()){je.index>tt?(ct=je,je=null):ct=je.sibling;var ga=Z(Y,je,vt.value,he);if(ga===null){je===null&&(je=ct);break}a&&je&&ga.alternate===null&&o(Y,je),z=b(ga,z,tt),yt===null?Ve=ga:yt.sibling=ga,yt=ga,je=ct}if(vt.done)return d(Y,je),dt&&bn(Y,tt),Ve;if(je===null){for(;!vt.done;tt++,vt=W.next())vt=pe(Y,vt.value,he),vt!==null&&(z=b(vt,z,tt),yt===null?Ve=vt:yt.sibling=vt,yt=vt);return dt&&bn(Y,tt),Ve}for(je=m(je);!vt.done;tt++,vt=W.next())vt=ie(je,Y,tt,vt.value,he),vt!==null&&(a&&vt.alternate!==null&&je.delete(vt.key===null?tt:vt.key),z=b(vt,z,tt),yt===null?Ve=vt:yt.sibling=vt,yt=vt);return a&&je.forEach(function(iA){return o(Y,iA)}),dt&&bn(Y,tt),Ve}function kt(Y,z,W,he){if(typeof W=="object"&&W!==null&&W.type===E&&W.key===null&&(W=W.props.children),typeof W=="object"&&W!==null){switch(W.$$typeof){case x:e:{for(var Ve=W.key;z!==null;){if(z.key===Ve){if(Ve=W.type,Ve===E){if(z.tag===7){d(Y,z.sibling),he=v(z,W.props.children),he.return=Y,Y=he;break e}}else if(z.elementType===Ve||typeof Ve=="object"&&Ve!==null&&Ve.$$typeof===B&&Pa(Ve)===z.type){d(Y,z.sibling),he=v(z,W.props),hl(he,W),he.return=Y,Y=he;break e}d(Y,z);break}else o(Y,z);z=z.sibling}W.type===E?(he=Ca(W.props.children,Y.mode,he,W.key),he.return=Y,Y=he):(he=No(W.type,W.key,W.props,null,Y.mode,he),hl(he,W),he.return=Y,Y=he)}return R(Y);case S:e:{for(Ve=W.key;z!==null;){if(z.key===Ve)if(z.tag===4&&z.stateNode.containerInfo===W.containerInfo&&z.stateNode.implementation===W.implementation){d(Y,z.sibling),he=v(z,W.children||[]),he.return=Y,Y=he;break e}else{d(Y,z);break}else o(Y,z);z=z.sibling}he=od(W,Y.mode,he),he.return=Y,Y=he}return R(Y);case B:return W=Pa(W),kt(Y,z,W,he)}if(me(W))return Pe(Y,z,W,he);if(H(W)){if(Ve=H(W),typeof Ve!="function")throw Error(s(150));return W=Ve.call(W),$e(Y,z,W,he)}if(typeof W.then=="function")return kt(Y,z,jo(W),he);if(W.$$typeof===I)return kt(Y,z,Do(Y,W),he);Bo(Y,W)}return typeof W=="string"&&W!==""||typeof W=="number"||typeof W=="bigint"?(W=""+W,z!==null&&z.tag===6?(d(Y,z.sibling),he=v(z,W),he.return=Y,Y=he):(d(Y,z),he=ld(W,Y.mode,he),he.return=Y,Y=he),R(Y)):d(Y,z)}return function(Y,z,W,he){try{dl=0;var Ve=kt(Y,z,W,he);return mr=null,Ve}catch(je){if(je===fr||je===Uo)throw je;var yt=li(29,je,null,Y.mode);return yt.lanes=he,yt.return=Y,yt}}}var Ma=kp(!0),Dp=kp(!1),Jn=!1;function Sd(a){a.updateQueue={baseState:a.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function bd(a,o){a=a.updateQueue,o.updateQueue===a&&(o.updateQueue={baseState:a.baseState,firstBaseUpdate:a.firstBaseUpdate,lastBaseUpdate:a.lastBaseUpdate,shared:a.shared,callbacks:null})}function ea(a){return{lane:a,tag:0,payload:null,callback:null,next:null}}function ta(a,o,d){var m=a.updateQueue;if(m===null)return null;if(m=m.shared,(xt&2)!==0){var v=m.pending;return v===null?o.next=o:(o.next=v.next,v.next=o),m.pending=o,o=Co(a),yp(a,null,d),o}return wo(a,m,o,d),Co(a)}function fl(a,o,d){if(o=o.updateQueue,o!==null&&(o=o.shared,(d&4194048)!==0)){var m=o.lanes;m&=a.pendingLanes,d|=m,o.lanes=d,Bi(a,d)}}function Td(a,o){var d=a.updateQueue,m=a.alternate;if(m!==null&&(m=m.updateQueue,d===m)){var v=null,b=null;if(d=d.firstBaseUpdate,d!==null){do{var R={lane:d.lane,tag:d.tag,payload:d.payload,callback:null,next:null};b===null?v=b=R:b=b.next=R,d=d.next}while(d!==null);b===null?v=b=o:b=b.next=o}else v=b=o;d={baseState:m.baseState,firstBaseUpdate:v,lastBaseUpdate:b,shared:m.shared,callbacks:m.callbacks},a.updateQueue=d;return}a=d.lastBaseUpdate,a===null?d.firstBaseUpdate=o:a.next=o,d.lastBaseUpdate=o}var Ed=!1;function ml(){if(Ed){var a=hr;if(a!==null)throw a}}function pl(a,o,d,m){Ed=!1;var v=a.updateQueue;Jn=!1;var b=v.firstBaseUpdate,R=v.lastBaseUpdate,O=v.shared.pending;if(O!==null){v.shared.pending=null;var V=O,X=V.next;V.next=null,R===null?b=X:R.next=X,R=V;var le=a.alternate;le!==null&&(le=le.updateQueue,O=le.lastBaseUpdate,O!==R&&(O===null?le.firstBaseUpdate=X:O.next=X,le.lastBaseUpdate=V))}if(b!==null){var pe=v.baseState;R=0,le=X=V=null,O=b;do{var Z=O.lane&-536870913,ie=Z!==O.lane;if(ie?(ot&Z)===Z:(m&Z)===Z){Z!==0&&Z===dr&&(Ed=!0),le!==null&&(le=le.next={lane:0,tag:O.tag,payload:O.payload,callback:null,next:null});e:{var Pe=a,$e=O;Z=o;var kt=d;switch($e.tag){case 1:if(Pe=$e.payload,typeof Pe=="function"){pe=Pe.call(kt,pe,Z);break e}pe=Pe;break e;case 3:Pe.flags=Pe.flags&-65537|128;case 0:if(Pe=$e.payload,Z=typeof Pe=="function"?Pe.call(kt,pe,Z):Pe,Z==null)break e;pe=g({},pe,Z);break e;case 2:Jn=!0}}Z=O.callback,Z!==null&&(a.flags|=64,ie&&(a.flags|=8192),ie=v.callbacks,ie===null?v.callbacks=[Z]:ie.push(Z))}else ie={lane:Z,tag:O.tag,payload:O.payload,callback:O.callback,next:null},le===null?(X=le=ie,V=pe):le=le.next=ie,R|=Z;if(O=O.next,O===null){if(O=v.shared.pending,O===null)break;ie=O,O=ie.next,ie.next=null,v.lastBaseUpdate=ie,v.shared.pending=null}}while(!0);le===null&&(V=pe),v.baseState=V,v.firstBaseUpdate=X,v.lastBaseUpdate=le,b===null&&(v.shared.lanes=0),ra|=R,a.lanes=R,a.memoizedState=pe}}function Pp(a,o){if(typeof a!="function")throw Error(s(191,a));a.call(o)}function Up(a,o){var d=a.callbacks;if(d!==null)for(a.callbacks=null,a=0;a<d.length;a++)Pp(d[a],o)}var pr=P(null),Fo=P(0);function Mp(a,o){a=On,te(Fo,a),te(pr,o),On=a|o.baseLanes}function Ad(){te(Fo,On),te(pr,pr.current)}function Id(){On=Fo.current,G(pr),G(Fo)}var oi=P(null),Ci=null;function sa(a){var o=a.alternate;te(es,es.current&1),te(oi,a),Ci===null&&(o===null||pr.current!==null||o.memoizedState!==null)&&(Ci=a)}function _d(a){te(es,es.current),te(oi,a),Ci===null&&(Ci=a)}function jp(a){a.tag===22?(te(es,es.current),te(oi,a),Ci===null&&(Ci=a)):ia()}function ia(){te(es,es.current),te(oi,oi.current)}function ci(a){G(oi),Ci===a&&(Ci=null),G(es)}var es=P(0);function Vo(a){for(var o=a;o!==null;){if(o.tag===13){var d=o.memoizedState;if(d!==null&&(d=d.dehydrated,d===null||Oh(d)||kh(d)))return o}else if(o.tag===19&&(o.memoizedProps.revealOrder==="forwards"||o.memoizedProps.revealOrder==="backwards"||o.memoizedProps.revealOrder==="unstable_legacy-backwards"||o.memoizedProps.revealOrder==="together")){if((o.flags&128)!==0)return o}else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===a)break;for(;o.sibling===null;){if(o.return===null||o.return===a)return null;o=o.return}o.sibling.return=o.return,o=o.sibling}return null}var An=0,Xe=null,Nt=null,rs=null,$o=!1,gr=!1,ja=!1,Go=0,gl=0,yr=null,YT=0;function Qt(){throw Error(s(321))}function Rd(a,o){if(o===null)return!1;for(var d=0;d<o.length&&d<a.length;d++)if(!ri(a[d],o[d]))return!1;return!0}function Ld(a,o,d,m,v,b){return An=b,Xe=o,o.memoizedState=null,o.updateQueue=null,o.lanes=0,M.H=a===null||a.memoizedState===null?bg:Gd,ja=!1,b=d(m,v),ja=!1,gr&&(b=Fp(o,d,m,v)),Bp(a),b}function Bp(a){M.H=xl;var o=Nt!==null&&Nt.next!==null;if(An=0,rs=Nt=Xe=null,$o=!1,gl=0,yr=null,o)throw Error(s(300));a===null||ls||(a=a.dependencies,a!==null&&ko(a)&&(ls=!0))}function Fp(a,o,d,m){Xe=a;var v=0;do{if(gr&&(yr=null),gl=0,gr=!1,25<=v)throw Error(s(301));if(v+=1,rs=Nt=null,a.updateQueue!=null){var b=a.updateQueue;b.lastEffect=null,b.events=null,b.stores=null,b.memoCache!=null&&(b.memoCache.index=0)}M.H=Tg,b=o(d,m)}while(gr);return b}function qT(){var a=M.H,o=a.useState()[0];return o=typeof o.then=="function"?yl(o):o,a=a.useState()[0],(Nt!==null?Nt.memoizedState:null)!==a&&(Xe.flags|=1024),o}function wd(){var a=Go!==0;return Go=0,a}function Cd(a,o,d){o.updateQueue=a.updateQueue,o.flags&=-2053,a.lanes&=~d}function Nd(a){if($o){for(a=a.memoizedState;a!==null;){var o=a.queue;o!==null&&(o.pending=null),a=a.next}$o=!1}An=0,rs=Nt=Xe=null,gr=!1,gl=Go=0,yr=null}function Vs(){var a={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return rs===null?Xe.memoizedState=rs=a:rs=rs.next=a,rs}function ts(){if(Nt===null){var a=Xe.alternate;a=a!==null?a.memoizedState:null}else a=Nt.next;var o=rs===null?Xe.memoizedState:rs.next;if(o!==null)rs=o,Nt=a;else{if(a===null)throw Xe.alternate===null?Error(s(467)):Error(s(310));Nt=a,a={memoizedState:Nt.memoizedState,baseState:Nt.baseState,baseQueue:Nt.baseQueue,queue:Nt.queue,next:null},rs===null?Xe.memoizedState=rs=a:rs=rs.next=a}return rs}function Ho(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function yl(a){var o=gl;return gl+=1,yr===null&&(yr=[]),a=Cp(yr,a,o),o=Xe,(rs===null?o.memoizedState:rs.next)===null&&(o=o.alternate,M.H=o===null||o.memoizedState===null?bg:Gd),a}function zo(a){if(a!==null&&typeof a=="object"){if(typeof a.then=="function")return yl(a);if(a.$$typeof===I)return bs(a)}throw Error(s(438,String(a)))}function Od(a){var o=null,d=Xe.updateQueue;if(d!==null&&(o=d.memoCache),o==null){var m=Xe.alternate;m!==null&&(m=m.updateQueue,m!==null&&(m=m.memoCache,m!=null&&(o={data:m.data.map(function(v){return v.slice()}),index:0})))}if(o==null&&(o={data:[],index:0}),d===null&&(d=Ho(),Xe.updateQueue=d),d.memoCache=o,d=o.data[o.index],d===void 0)for(d=o.data[o.index]=Array(a),m=0;m<a;m++)d[m]=U;return o.index++,d}function In(a,o){return typeof o=="function"?o(a):o}function Ko(a){var o=ts();return kd(o,Nt,a)}function kd(a,o,d){var m=a.queue;if(m===null)throw Error(s(311));m.lastRenderedReducer=d;var v=a.baseQueue,b=m.pending;if(b!==null){if(v!==null){var R=v.next;v.next=b.next,b.next=R}o.baseQueue=v=b,m.pending=null}if(b=a.baseState,v===null)a.memoizedState=b;else{o=v.next;var O=R=null,V=null,X=o,le=!1;do{var pe=X.lane&-536870913;if(pe!==X.lane?(ot&pe)===pe:(An&pe)===pe){var Z=X.revertLane;if(Z===0)V!==null&&(V=V.next={lane:0,revertLane:0,gesture:null,action:X.action,hasEagerState:X.hasEagerState,eagerState:X.eagerState,next:null}),pe===dr&&(le=!0);else if((An&Z)===Z){X=X.next,Z===dr&&(le=!0);continue}else pe={lane:0,revertLane:X.revertLane,gesture:null,action:X.action,hasEagerState:X.hasEagerState,eagerState:X.eagerState,next:null},V===null?(O=V=pe,R=b):V=V.next=pe,Xe.lanes|=Z,ra|=Z;pe=X.action,ja&&d(b,pe),b=X.hasEagerState?X.eagerState:d(b,pe)}else Z={lane:pe,revertLane:X.revertLane,gesture:X.gesture,action:X.action,hasEagerState:X.hasEagerState,eagerState:X.eagerState,next:null},V===null?(O=V=Z,R=b):V=V.next=Z,Xe.lanes|=pe,ra|=pe;X=X.next}while(X!==null&&X!==o);if(V===null?R=b:V.next=O,!ri(b,a.memoizedState)&&(ls=!0,le&&(d=hr,d!==null)))throw d;a.memoizedState=b,a.baseState=R,a.baseQueue=V,m.lastRenderedState=b}return v===null&&(m.lanes=0),[a.memoizedState,m.dispatch]}function Dd(a){var o=ts(),d=o.queue;if(d===null)throw Error(s(311));d.lastRenderedReducer=a;var m=d.dispatch,v=d.pending,b=o.memoizedState;if(v!==null){d.pending=null;var R=v=v.next;do b=a(b,R.action),R=R.next;while(R!==v);ri(b,o.memoizedState)||(ls=!0),o.memoizedState=b,o.baseQueue===null&&(o.baseState=b),d.lastRenderedState=b}return[b,m]}function Vp(a,o,d){var m=Xe,v=ts(),b=dt;if(b){if(d===void 0)throw Error(s(407));d=d()}else d=o();var R=!ri((Nt||v).memoizedState,d);if(R&&(v.memoizedState=d,ls=!0),v=v.queue,Md(Hp.bind(null,m,v,a),[a]),v.getSnapshot!==o||R||rs!==null&&rs.memoizedState.tag&1){if(m.flags|=2048,vr(9,{destroy:void 0},Gp.bind(null,m,v,d,o),null),Pt===null)throw Error(s(349));b||(An&127)!==0||$p(m,o,d)}return d}function $p(a,o,d){a.flags|=16384,a={getSnapshot:o,value:d},o=Xe.updateQueue,o===null?(o=Ho(),Xe.updateQueue=o,o.stores=[a]):(d=o.stores,d===null?o.stores=[a]:d.push(a))}function Gp(a,o,d,m){o.value=d,o.getSnapshot=m,zp(o)&&Kp(a)}function Hp(a,o,d){return d(function(){zp(o)&&Kp(a)})}function zp(a){var o=a.getSnapshot;a=a.value;try{var d=o();return!ri(a,d)}catch{return!0}}function Kp(a){var o=wa(a,2);o!==null&&Ws(o,a,2)}function Pd(a){var o=Vs();if(typeof a=="function"){var d=a;if(a=d(),ja){cs(!0);try{d()}finally{cs(!1)}}}return o.memoizedState=o.baseState=a,o.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:In,lastRenderedState:a},o}function Yp(a,o,d,m){return a.baseState=d,kd(a,Nt,typeof m=="function"?m:In)}function QT(a,o,d,m,v){if(Qo(a))throw Error(s(485));if(a=o.action,a!==null){var b={payload:v,action:a,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(R){b.listeners.push(R)}};M.T!==null?d(!0):b.isTransition=!1,m(b),d=o.pending,d===null?(b.next=o.pending=b,qp(o,b)):(b.next=d.next,o.pending=d.next=b)}}function qp(a,o){var d=o.action,m=o.payload,v=a.state;if(o.isTransition){var b=M.T,R={};M.T=R;try{var O=d(v,m),V=M.S;V!==null&&V(R,O),Qp(a,o,O)}catch(X){Ud(a,o,X)}finally{b!==null&&R.types!==null&&(b.types=R.types),M.T=b}}else try{b=d(v,m),Qp(a,o,b)}catch(X){Ud(a,o,X)}}function Qp(a,o,d){d!==null&&typeof d=="object"&&typeof d.then=="function"?d.then(function(m){Wp(a,o,m)},function(m){return Ud(a,o,m)}):Wp(a,o,d)}function Wp(a,o,d){o.status="fulfilled",o.value=d,Xp(o),a.state=d,o=a.pending,o!==null&&(d=o.next,d===o?a.pending=null:(d=d.next,o.next=d,qp(a,d)))}function Ud(a,o,d){var m=a.pending;if(a.pending=null,m!==null){m=m.next;do o.status="rejected",o.reason=d,Xp(o),o=o.next;while(o!==m)}a.action=null}function Xp(a){a=a.listeners;for(var o=0;o<a.length;o++)(0,a[o])()}function Zp(a,o){return o}function Jp(a,o){if(dt){var d=Pt.formState;if(d!==null){e:{var m=Xe;if(dt){if(Ft){t:{for(var v=Ft,b=wi;v.nodeType!==8;){if(!b){v=null;break t}if(v=Ni(v.nextSibling),v===null){v=null;break t}}b=v.data,v=b==="F!"||b==="F"?v:null}if(v){Ft=Ni(v.nextSibling),m=v.data==="F!";break e}}Xn(m)}m=!1}m&&(o=d[0])}}return d=Vs(),d.memoizedState=d.baseState=o,m={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Zp,lastRenderedState:o},d.queue=m,d=vg.bind(null,Xe,m),m.dispatch=d,m=Pd(!1),b=$d.bind(null,Xe,!1,m.queue),m=Vs(),v={state:o,dispatch:null,action:a,pending:null},m.queue=v,d=QT.bind(null,Xe,v,b,d),v.dispatch=d,m.memoizedState=a,[o,d,!1]}function eg(a){var o=ts();return tg(o,Nt,a)}function tg(a,o,d){if(o=kd(a,o,Zp)[0],a=Ko(In)[0],typeof o=="object"&&o!==null&&typeof o.then=="function")try{var m=yl(o)}catch(R){throw R===fr?Uo:R}else m=o;o=ts();var v=o.queue,b=v.dispatch;return d!==o.memoizedState&&(Xe.flags|=2048,vr(9,{destroy:void 0},WT.bind(null,v,d),null)),[m,b,a]}function WT(a,o){a.action=o}function sg(a){var o=ts(),d=Nt;if(d!==null)return tg(o,d,a);ts(),o=o.memoizedState,d=ts();var m=d.queue.dispatch;return d.memoizedState=a,[o,m,!1]}function vr(a,o,d,m){return a={tag:a,create:d,deps:m,inst:o,next:null},o=Xe.updateQueue,o===null&&(o=Ho(),Xe.updateQueue=o),d=o.lastEffect,d===null?o.lastEffect=a.next=a:(m=d.next,d.next=a,a.next=m,o.lastEffect=a),a}function ig(){return ts().memoizedState}function Yo(a,o,d,m){var v=Vs();Xe.flags|=a,v.memoizedState=vr(1|o,{destroy:void 0},d,m===void 0?null:m)}function qo(a,o,d,m){var v=ts();m=m===void 0?null:m;var b=v.memoizedState.inst;Nt!==null&&m!==null&&Rd(m,Nt.memoizedState.deps)?v.memoizedState=vr(o,b,d,m):(Xe.flags|=a,v.memoizedState=vr(1|o,b,d,m))}function ng(a,o){Yo(8390656,8,a,o)}function Md(a,o){qo(2048,8,a,o)}function XT(a){Xe.flags|=4;var o=Xe.updateQueue;if(o===null)o=Ho(),Xe.updateQueue=o,o.events=[a];else{var d=o.events;d===null?o.events=[a]:d.push(a)}}function ag(a){var o=ts().memoizedState;return XT({ref:o,nextImpl:a}),function(){if((xt&2)!==0)throw Error(s(440));return o.impl.apply(void 0,arguments)}}function rg(a,o){return qo(4,2,a,o)}function lg(a,o){return qo(4,4,a,o)}function og(a,o){if(typeof o=="function"){a=a();var d=o(a);return function(){typeof d=="function"?d():o(null)}}if(o!=null)return a=a(),o.current=a,function(){o.current=null}}function cg(a,o,d){d=d!=null?d.concat([a]):null,qo(4,4,og.bind(null,o,a),d)}function jd(){}function ug(a,o){var d=ts();o=o===void 0?null:o;var m=d.memoizedState;return o!==null&&Rd(o,m[1])?m[0]:(d.memoizedState=[a,o],a)}function dg(a,o){var d=ts();o=o===void 0?null:o;var m=d.memoizedState;if(o!==null&&Rd(o,m[1]))return m[0];if(m=a(),ja){cs(!0);try{a()}finally{cs(!1)}}return d.memoizedState=[m,o],m}function Bd(a,o,d){return d===void 0||(An&1073741824)!==0&&(ot&261930)===0?a.memoizedState=o:(a.memoizedState=d,a=h0(),Xe.lanes|=a,ra|=a,d)}function hg(a,o,d,m){return ri(d,o)?d:pr.current!==null?(a=Bd(a,d,m),ri(a,o)||(ls=!0),a):(An&42)===0||(An&1073741824)!==0&&(ot&261930)===0?(ls=!0,a.memoizedState=d):(a=h0(),Xe.lanes|=a,ra|=a,o)}function fg(a,o,d,m,v){var b=$.p;$.p=b!==0&&8>b?b:8;var R=M.T,O={};M.T=O,$d(a,!1,o,d);try{var V=v(),X=M.S;if(X!==null&&X(O,V),V!==null&&typeof V=="object"&&typeof V.then=="function"){var le=KT(V,m);vl(a,o,le,hi(a))}else vl(a,o,m,hi(a))}catch(pe){vl(a,o,{then:function(){},status:"rejected",reason:pe},hi())}finally{$.p=b,R!==null&&O.types!==null&&(R.types=O.types),M.T=R}}function ZT(){}function Fd(a,o,d,m){if(a.tag!==5)throw Error(s(476));var v=mg(a).queue;fg(a,v,o,F,d===null?ZT:function(){return pg(a),d(m)})}function mg(a){var o=a.memoizedState;if(o!==null)return o;o={memoizedState:F,baseState:F,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:In,lastRenderedState:F},next:null};var d={};return o.next={memoizedState:d,baseState:d,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:In,lastRenderedState:d},next:null},a.memoizedState=o,a=a.alternate,a!==null&&(a.memoizedState=o),o}function pg(a){var o=mg(a);o.next===null&&(o=a.alternate.memoizedState),vl(a,o.next.queue,{},hi())}function Vd(){return bs(Pl)}function gg(){return ts().memoizedState}function yg(){return ts().memoizedState}function JT(a){for(var o=a.return;o!==null;){switch(o.tag){case 24:case 3:var d=hi();a=ea(d);var m=ta(o,a,d);m!==null&&(Ws(m,o,d),fl(m,o,d)),o={cache:gd()},a.payload=o;return}o=o.return}}function eE(a,o,d){var m=hi();d={lane:m,revertLane:0,gesture:null,action:d,hasEagerState:!1,eagerState:null,next:null},Qo(a)?xg(o,d):(d=ad(a,o,d,m),d!==null&&(Ws(d,a,m),Sg(d,o,m)))}function vg(a,o,d){var m=hi();vl(a,o,d,m)}function vl(a,o,d,m){var v={lane:m,revertLane:0,gesture:null,action:d,hasEagerState:!1,eagerState:null,next:null};if(Qo(a))xg(o,v);else{var b=a.alternate;if(a.lanes===0&&(b===null||b.lanes===0)&&(b=o.lastRenderedReducer,b!==null))try{var R=o.lastRenderedState,O=b(R,d);if(v.hasEagerState=!0,v.eagerState=O,ri(O,R))return wo(a,o,v,0),Pt===null&&Lo(),!1}catch{}if(d=ad(a,o,v,m),d!==null)return Ws(d,a,m),Sg(d,o,m),!0}return!1}function $d(a,o,d,m){if(m={lane:2,revertLane:Sh(),gesture:null,action:m,hasEagerState:!1,eagerState:null,next:null},Qo(a)){if(o)throw Error(s(479))}else o=ad(a,d,m,2),o!==null&&Ws(o,a,2)}function Qo(a){var o=a.alternate;return a===Xe||o!==null&&o===Xe}function xg(a,o){gr=$o=!0;var d=a.pending;d===null?o.next=o:(o.next=d.next,d.next=o),a.pending=o}function Sg(a,o,d){if((d&4194048)!==0){var m=o.lanes;m&=a.pendingLanes,d|=m,o.lanes=d,Bi(a,d)}}var xl={readContext:bs,use:zo,useCallback:Qt,useContext:Qt,useEffect:Qt,useImperativeHandle:Qt,useLayoutEffect:Qt,useInsertionEffect:Qt,useMemo:Qt,useReducer:Qt,useRef:Qt,useState:Qt,useDebugValue:Qt,useDeferredValue:Qt,useTransition:Qt,useSyncExternalStore:Qt,useId:Qt,useHostTransitionStatus:Qt,useFormState:Qt,useActionState:Qt,useOptimistic:Qt,useMemoCache:Qt,useCacheRefresh:Qt};xl.useEffectEvent=Qt;var bg={readContext:bs,use:zo,useCallback:function(a,o){return Vs().memoizedState=[a,o===void 0?null:o],a},useContext:bs,useEffect:ng,useImperativeHandle:function(a,o,d){d=d!=null?d.concat([a]):null,Yo(4194308,4,og.bind(null,o,a),d)},useLayoutEffect:function(a,o){return Yo(4194308,4,a,o)},useInsertionEffect:function(a,o){Yo(4,2,a,o)},useMemo:function(a,o){var d=Vs();o=o===void 0?null:o;var m=a();if(ja){cs(!0);try{a()}finally{cs(!1)}}return d.memoizedState=[m,o],m},useReducer:function(a,o,d){var m=Vs();if(d!==void 0){var v=d(o);if(ja){cs(!0);try{d(o)}finally{cs(!1)}}}else v=o;return m.memoizedState=m.baseState=v,a={pending:null,lanes:0,dispatch:null,lastRenderedReducer:a,lastRenderedState:v},m.queue=a,a=a.dispatch=eE.bind(null,Xe,a),[m.memoizedState,a]},useRef:function(a){var o=Vs();return a={current:a},o.memoizedState=a},useState:function(a){a=Pd(a);var o=a.queue,d=vg.bind(null,Xe,o);return o.dispatch=d,[a.memoizedState,d]},useDebugValue:jd,useDeferredValue:function(a,o){var d=Vs();return Bd(d,a,o)},useTransition:function(){var a=Pd(!1);return a=fg.bind(null,Xe,a.queue,!0,!1),Vs().memoizedState=a,[!1,a]},useSyncExternalStore:function(a,o,d){var m=Xe,v=Vs();if(dt){if(d===void 0)throw Error(s(407));d=d()}else{if(d=o(),Pt===null)throw Error(s(349));(ot&127)!==0||$p(m,o,d)}v.memoizedState=d;var b={value:d,getSnapshot:o};return v.queue=b,ng(Hp.bind(null,m,b,a),[a]),m.flags|=2048,vr(9,{destroy:void 0},Gp.bind(null,m,b,d,o),null),d},useId:function(){var a=Vs(),o=Pt.identifierPrefix;if(dt){var d=Zi,m=Xi;d=(m&~(1<<32-wt(m)-1)).toString(32)+d,o="_"+o+"R_"+d,d=Go++,0<d&&(o+="H"+d.toString(32)),o+="_"}else d=YT++,o="_"+o+"r_"+d.toString(32)+"_";return a.memoizedState=o},useHostTransitionStatus:Vd,useFormState:Jp,useActionState:Jp,useOptimistic:function(a){var o=Vs();o.memoizedState=o.baseState=a;var d={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return o.queue=d,o=$d.bind(null,Xe,!0,d),d.dispatch=o,[a,o]},useMemoCache:Od,useCacheRefresh:function(){return Vs().memoizedState=JT.bind(null,Xe)},useEffectEvent:function(a){var o=Vs(),d={impl:a};return o.memoizedState=d,function(){if((xt&2)!==0)throw Error(s(440));return d.impl.apply(void 0,arguments)}}},Gd={readContext:bs,use:zo,useCallback:ug,useContext:bs,useEffect:Md,useImperativeHandle:cg,useInsertionEffect:rg,useLayoutEffect:lg,useMemo:dg,useReducer:Ko,useRef:ig,useState:function(){return Ko(In)},useDebugValue:jd,useDeferredValue:function(a,o){var d=ts();return hg(d,Nt.memoizedState,a,o)},useTransition:function(){var a=Ko(In)[0],o=ts().memoizedState;return[typeof a=="boolean"?a:yl(a),o]},useSyncExternalStore:Vp,useId:gg,useHostTransitionStatus:Vd,useFormState:eg,useActionState:eg,useOptimistic:function(a,o){var d=ts();return Yp(d,Nt,a,o)},useMemoCache:Od,useCacheRefresh:yg};Gd.useEffectEvent=ag;var Tg={readContext:bs,use:zo,useCallback:ug,useContext:bs,useEffect:Md,useImperativeHandle:cg,useInsertionEffect:rg,useLayoutEffect:lg,useMemo:dg,useReducer:Dd,useRef:ig,useState:function(){return Dd(In)},useDebugValue:jd,useDeferredValue:function(a,o){var d=ts();return Nt===null?Bd(d,a,o):hg(d,Nt.memoizedState,a,o)},useTransition:function(){var a=Dd(In)[0],o=ts().memoizedState;return[typeof a=="boolean"?a:yl(a),o]},useSyncExternalStore:Vp,useId:gg,useHostTransitionStatus:Vd,useFormState:sg,useActionState:sg,useOptimistic:function(a,o){var d=ts();return Nt!==null?Yp(d,Nt,a,o):(d.baseState=a,[a,d.queue.dispatch])},useMemoCache:Od,useCacheRefresh:yg};Tg.useEffectEvent=ag;function Hd(a,o,d,m){o=a.memoizedState,d=d(m,o),d=d==null?o:g({},o,d),a.memoizedState=d,a.lanes===0&&(a.updateQueue.baseState=d)}var zd={enqueueSetState:function(a,o,d){a=a._reactInternals;var m=hi(),v=ea(m);v.payload=o,d!=null&&(v.callback=d),o=ta(a,v,m),o!==null&&(Ws(o,a,m),fl(o,a,m))},enqueueReplaceState:function(a,o,d){a=a._reactInternals;var m=hi(),v=ea(m);v.tag=1,v.payload=o,d!=null&&(v.callback=d),o=ta(a,v,m),o!==null&&(Ws(o,a,m),fl(o,a,m))},enqueueForceUpdate:function(a,o){a=a._reactInternals;var d=hi(),m=ea(d);m.tag=2,o!=null&&(m.callback=o),o=ta(a,m,d),o!==null&&(Ws(o,a,d),fl(o,a,d))}};function Eg(a,o,d,m,v,b,R){return a=a.stateNode,typeof a.shouldComponentUpdate=="function"?a.shouldComponentUpdate(m,b,R):o.prototype&&o.prototype.isPureReactComponent?!al(d,m)||!al(v,b):!0}function Ag(a,o,d,m){a=o.state,typeof o.componentWillReceiveProps=="function"&&o.componentWillReceiveProps(d,m),typeof o.UNSAFE_componentWillReceiveProps=="function"&&o.UNSAFE_componentWillReceiveProps(d,m),o.state!==a&&zd.enqueueReplaceState(o,o.state,null)}function Ba(a,o){var d=o;if("ref"in o){d={};for(var m in o)m!=="ref"&&(d[m]=o[m])}if(a=a.defaultProps){d===o&&(d=g({},d));for(var v in a)d[v]===void 0&&(d[v]=a[v])}return d}function Ig(a){Ro(a)}function _g(a){console.error(a)}function Rg(a){Ro(a)}function Wo(a,o){try{var d=a.onUncaughtError;d(o.value,{componentStack:o.stack})}catch(m){setTimeout(function(){throw m})}}function Lg(a,o,d){try{var m=a.onCaughtError;m(d.value,{componentStack:d.stack,errorBoundary:o.tag===1?o.stateNode:null})}catch(v){setTimeout(function(){throw v})}}function Kd(a,o,d){return d=ea(d),d.tag=3,d.payload={element:null},d.callback=function(){Wo(a,o)},d}function wg(a){return a=ea(a),a.tag=3,a}function Cg(a,o,d,m){var v=d.type.getDerivedStateFromError;if(typeof v=="function"){var b=m.value;a.payload=function(){return v(b)},a.callback=function(){Lg(o,d,m)}}var R=d.stateNode;R!==null&&typeof R.componentDidCatch=="function"&&(a.callback=function(){Lg(o,d,m),typeof v!="function"&&(la===null?la=new Set([this]):la.add(this));var O=m.stack;this.componentDidCatch(m.value,{componentStack:O!==null?O:""})})}function tE(a,o,d,m,v){if(d.flags|=32768,m!==null&&typeof m=="object"&&typeof m.then=="function"){if(o=d.alternate,o!==null&&ur(o,d,v,!0),d=oi.current,d!==null){switch(d.tag){case 31:case 13:return Ci===null?oc():d.alternate===null&&Wt===0&&(Wt=3),d.flags&=-257,d.flags|=65536,d.lanes=v,m===Mo?d.flags|=16384:(o=d.updateQueue,o===null?d.updateQueue=new Set([m]):o.add(m),yh(a,m,v)),!1;case 22:return d.flags|=65536,m===Mo?d.flags|=16384:(o=d.updateQueue,o===null?(o={transitions:null,markerInstances:null,retryQueue:new Set([m])},d.updateQueue=o):(d=o.retryQueue,d===null?o.retryQueue=new Set([m]):d.add(m)),yh(a,m,v)),!1}throw Error(s(435,d.tag))}return yh(a,m,v),oc(),!1}if(dt)return o=oi.current,o!==null?((o.flags&65536)===0&&(o.flags|=256),o.flags|=65536,o.lanes=v,m!==dd&&(a=Error(s(422),{cause:m}),ol(_i(a,d)))):(m!==dd&&(o=Error(s(423),{cause:m}),ol(_i(o,d))),a=a.current.alternate,a.flags|=65536,v&=-v,a.lanes|=v,m=_i(m,d),v=Kd(a.stateNode,m,v),Td(a,v),Wt!==4&&(Wt=2)),!1;var b=Error(s(520),{cause:m});if(b=_i(b,d),Rl===null?Rl=[b]:Rl.push(b),Wt!==4&&(Wt=2),o===null)return!0;m=_i(m,d),d=o;do{switch(d.tag){case 3:return d.flags|=65536,a=v&-v,d.lanes|=a,a=Kd(d.stateNode,m,a),Td(d,a),!1;case 1:if(o=d.type,b=d.stateNode,(d.flags&128)===0&&(typeof o.getDerivedStateFromError=="function"||b!==null&&typeof b.componentDidCatch=="function"&&(la===null||!la.has(b))))return d.flags|=65536,v&=-v,d.lanes|=v,v=wg(v),Cg(v,a,d,m),Td(d,v),!1}d=d.return}while(d!==null);return!1}var Yd=Error(s(461)),ls=!1;function Ts(a,o,d,m){o.child=a===null?Dp(o,null,d,m):Ma(o,a.child,d,m)}function Ng(a,o,d,m,v){d=d.render;var b=o.ref;if("ref"in m){var R={};for(var O in m)O!=="ref"&&(R[O]=m[O])}else R=m;return ka(o),m=Ld(a,o,d,R,b,v),O=wd(),a!==null&&!ls?(Cd(a,o,v),_n(a,o,v)):(dt&&O&&cd(o),o.flags|=1,Ts(a,o,m,v),o.child)}function Og(a,o,d,m,v){if(a===null){var b=d.type;return typeof b=="function"&&!rd(b)&&b.defaultProps===void 0&&d.compare===null?(o.tag=15,o.type=b,kg(a,o,b,m,v)):(a=No(d.type,null,m,o,o.mode,v),a.ref=o.ref,a.return=o,o.child=a)}if(b=a.child,!th(a,v)){var R=b.memoizedProps;if(d=d.compare,d=d!==null?d:al,d(R,m)&&a.ref===o.ref)return _n(a,o,v)}return o.flags|=1,a=Sn(b,m),a.ref=o.ref,a.return=o,o.child=a}function kg(a,o,d,m,v){if(a!==null){var b=a.memoizedProps;if(al(b,m)&&a.ref===o.ref)if(ls=!1,o.pendingProps=m=b,th(a,v))(a.flags&131072)!==0&&(ls=!0);else return o.lanes=a.lanes,_n(a,o,v)}return qd(a,o,d,m,v)}function Dg(a,o,d,m){var v=m.children,b=a!==null?a.memoizedState:null;if(a===null&&o.stateNode===null&&(o.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),m.mode==="hidden"){if((o.flags&128)!==0){if(b=b!==null?b.baseLanes|d:d,a!==null){for(m=o.child=a.child,v=0;m!==null;)v=v|m.lanes|m.childLanes,m=m.sibling;m=v&~b}else m=0,o.child=null;return Pg(a,o,b,d,m)}if((d&536870912)!==0)o.memoizedState={baseLanes:0,cachePool:null},a!==null&&Po(o,b!==null?b.cachePool:null),b!==null?Mp(o,b):Ad(),jp(o);else return m=o.lanes=536870912,Pg(a,o,b!==null?b.baseLanes|d:d,d,m)}else b!==null?(Po(o,b.cachePool),Mp(o,b),ia(),o.memoizedState=null):(a!==null&&Po(o,null),Ad(),ia());return Ts(a,o,v,d),o.child}function Sl(a,o){return a!==null&&a.tag===22||o.stateNode!==null||(o.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),o.sibling}function Pg(a,o,d,m,v){var b=vd();return b=b===null?null:{parent:as._currentValue,pool:b},o.memoizedState={baseLanes:d,cachePool:b},a!==null&&Po(o,null),Ad(),jp(o),a!==null&&ur(a,o,m,!0),o.childLanes=v,null}function Xo(a,o){return o=Jo({mode:o.mode,children:o.children},a.mode),o.ref=a.ref,a.child=o,o.return=a,o}function Ug(a,o,d){return Ma(o,a.child,null,d),a=Xo(o,o.pendingProps),a.flags|=2,ci(o),o.memoizedState=null,a}function sE(a,o,d){var m=o.pendingProps,v=(o.flags&128)!==0;if(o.flags&=-129,a===null){if(dt){if(m.mode==="hidden")return a=Xo(o,m),o.lanes=536870912,Sl(null,a);if(_d(o),(a=Ft)?(a=q0(a,wi),a=a!==null&&a.data==="&"?a:null,a!==null&&(o.memoizedState={dehydrated:a,treeContext:Qn!==null?{id:Xi,overflow:Zi}:null,retryLane:536870912,hydrationErrors:null},d=xp(a),d.return=o,o.child=d,Ss=o,Ft=null)):a=null,a===null)throw Xn(o);return o.lanes=536870912,null}return Xo(o,m)}var b=a.memoizedState;if(b!==null){var R=b.dehydrated;if(_d(o),v)if(o.flags&256)o.flags&=-257,o=Ug(a,o,d);else if(o.memoizedState!==null)o.child=a.child,o.flags|=128,o=null;else throw Error(s(558));else if(ls||ur(a,o,d,!1),v=(d&a.childLanes)!==0,ls||v){if(m=Pt,m!==null&&(R=ce(m,d),R!==0&&R!==b.retryLane))throw b.retryLane=R,wa(a,R),Ws(m,a,R),Yd;oc(),o=Ug(a,o,d)}else a=b.treeContext,Ft=Ni(R.nextSibling),Ss=o,dt=!0,Wn=null,wi=!1,a!==null&&Tp(o,a),o=Xo(o,m),o.flags|=4096;return o}return a=Sn(a.child,{mode:m.mode,children:m.children}),a.ref=o.ref,o.child=a,a.return=o,a}function Zo(a,o){var d=o.ref;if(d===null)a!==null&&a.ref!==null&&(o.flags|=4194816);else{if(typeof d!="function"&&typeof d!="object")throw Error(s(284));(a===null||a.ref!==d)&&(o.flags|=4194816)}}function qd(a,o,d,m,v){return ka(o),d=Ld(a,o,d,m,void 0,v),m=wd(),a!==null&&!ls?(Cd(a,o,v),_n(a,o,v)):(dt&&m&&cd(o),o.flags|=1,Ts(a,o,d,v),o.child)}function Mg(a,o,d,m,v,b){return ka(o),o.updateQueue=null,d=Fp(o,m,d,v),Bp(a),m=wd(),a!==null&&!ls?(Cd(a,o,b),_n(a,o,b)):(dt&&m&&cd(o),o.flags|=1,Ts(a,o,d,b),o.child)}function jg(a,o,d,m,v){if(ka(o),o.stateNode===null){var b=rr,R=d.contextType;typeof R=="object"&&R!==null&&(b=bs(R)),b=new d(m,b),o.memoizedState=b.state!==null&&b.state!==void 0?b.state:null,b.updater=zd,o.stateNode=b,b._reactInternals=o,b=o.stateNode,b.props=m,b.state=o.memoizedState,b.refs={},Sd(o),R=d.contextType,b.context=typeof R=="object"&&R!==null?bs(R):rr,b.state=o.memoizedState,R=d.getDerivedStateFromProps,typeof R=="function"&&(Hd(o,d,R,m),b.state=o.memoizedState),typeof d.getDerivedStateFromProps=="function"||typeof b.getSnapshotBeforeUpdate=="function"||typeof b.UNSAFE_componentWillMount!="function"&&typeof b.componentWillMount!="function"||(R=b.state,typeof b.componentWillMount=="function"&&b.componentWillMount(),typeof b.UNSAFE_componentWillMount=="function"&&b.UNSAFE_componentWillMount(),R!==b.state&&zd.enqueueReplaceState(b,b.state,null),pl(o,m,b,v),ml(),b.state=o.memoizedState),typeof b.componentDidMount=="function"&&(o.flags|=4194308),m=!0}else if(a===null){b=o.stateNode;var O=o.memoizedProps,V=Ba(d,O);b.props=V;var X=b.context,le=d.contextType;R=rr,typeof le=="object"&&le!==null&&(R=bs(le));var pe=d.getDerivedStateFromProps;le=typeof pe=="function"||typeof b.getSnapshotBeforeUpdate=="function",O=o.pendingProps!==O,le||typeof b.UNSAFE_componentWillReceiveProps!="function"&&typeof b.componentWillReceiveProps!="function"||(O||X!==R)&&Ag(o,b,m,R),Jn=!1;var Z=o.memoizedState;b.state=Z,pl(o,m,b,v),ml(),X=o.memoizedState,O||Z!==X||Jn?(typeof pe=="function"&&(Hd(o,d,pe,m),X=o.memoizedState),(V=Jn||Eg(o,d,V,m,Z,X,R))?(le||typeof b.UNSAFE_componentWillMount!="function"&&typeof b.componentWillMount!="function"||(typeof b.componentWillMount=="function"&&b.componentWillMount(),typeof b.UNSAFE_componentWillMount=="function"&&b.UNSAFE_componentWillMount()),typeof b.componentDidMount=="function"&&(o.flags|=4194308)):(typeof b.componentDidMount=="function"&&(o.flags|=4194308),o.memoizedProps=m,o.memoizedState=X),b.props=m,b.state=X,b.context=R,m=V):(typeof b.componentDidMount=="function"&&(o.flags|=4194308),m=!1)}else{b=o.stateNode,bd(a,o),R=o.memoizedProps,le=Ba(d,R),b.props=le,pe=o.pendingProps,Z=b.context,X=d.contextType,V=rr,typeof X=="object"&&X!==null&&(V=bs(X)),O=d.getDerivedStateFromProps,(X=typeof O=="function"||typeof b.getSnapshotBeforeUpdate=="function")||typeof b.UNSAFE_componentWillReceiveProps!="function"&&typeof b.componentWillReceiveProps!="function"||(R!==pe||Z!==V)&&Ag(o,b,m,V),Jn=!1,Z=o.memoizedState,b.state=Z,pl(o,m,b,v),ml();var ie=o.memoizedState;R!==pe||Z!==ie||Jn||a!==null&&a.dependencies!==null&&ko(a.dependencies)?(typeof O=="function"&&(Hd(o,d,O,m),ie=o.memoizedState),(le=Jn||Eg(o,d,le,m,Z,ie,V)||a!==null&&a.dependencies!==null&&ko(a.dependencies))?(X||typeof b.UNSAFE_componentWillUpdate!="function"&&typeof b.componentWillUpdate!="function"||(typeof b.componentWillUpdate=="function"&&b.componentWillUpdate(m,ie,V),typeof b.UNSAFE_componentWillUpdate=="function"&&b.UNSAFE_componentWillUpdate(m,ie,V)),typeof b.componentDidUpdate=="function"&&(o.flags|=4),typeof b.getSnapshotBeforeUpdate=="function"&&(o.flags|=1024)):(typeof b.componentDidUpdate!="function"||R===a.memoizedProps&&Z===a.memoizedState||(o.flags|=4),typeof b.getSnapshotBeforeUpdate!="function"||R===a.memoizedProps&&Z===a.memoizedState||(o.flags|=1024),o.memoizedProps=m,o.memoizedState=ie),b.props=m,b.state=ie,b.context=V,m=le):(typeof b.componentDidUpdate!="function"||R===a.memoizedProps&&Z===a.memoizedState||(o.flags|=4),typeof b.getSnapshotBeforeUpdate!="function"||R===a.memoizedProps&&Z===a.memoizedState||(o.flags|=1024),m=!1)}return b=m,Zo(a,o),m=(o.flags&128)!==0,b||m?(b=o.stateNode,d=m&&typeof d.getDerivedStateFromError!="function"?null:b.render(),o.flags|=1,a!==null&&m?(o.child=Ma(o,a.child,null,v),o.child=Ma(o,null,d,v)):Ts(a,o,d,v),o.memoizedState=b.state,a=o.child):a=_n(a,o,v),a}function Bg(a,o,d,m){return Na(),o.flags|=256,Ts(a,o,d,m),o.child}var Qd={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Wd(a){return{baseLanes:a,cachePool:Lp()}}function Xd(a,o,d){return a=a!==null?a.childLanes&~d:0,o&&(a|=di),a}function Fg(a,o,d){var m=o.pendingProps,v=!1,b=(o.flags&128)!==0,R;if((R=b)||(R=a!==null&&a.memoizedState===null?!1:(es.current&2)!==0),R&&(v=!0,o.flags&=-129),R=(o.flags&32)!==0,o.flags&=-33,a===null){if(dt){if(v?sa(o):ia(),(a=Ft)?(a=q0(a,wi),a=a!==null&&a.data!=="&"?a:null,a!==null&&(o.memoizedState={dehydrated:a,treeContext:Qn!==null?{id:Xi,overflow:Zi}:null,retryLane:536870912,hydrationErrors:null},d=xp(a),d.return=o,o.child=d,Ss=o,Ft=null)):a=null,a===null)throw Xn(o);return kh(a)?o.lanes=32:o.lanes=536870912,null}var O=m.children;return m=m.fallback,v?(ia(),v=o.mode,O=Jo({mode:"hidden",children:O},v),m=Ca(m,v,d,null),O.return=o,m.return=o,O.sibling=m,o.child=O,m=o.child,m.memoizedState=Wd(d),m.childLanes=Xd(a,R,d),o.memoizedState=Qd,Sl(null,m)):(sa(o),Zd(o,O))}var V=a.memoizedState;if(V!==null&&(O=V.dehydrated,O!==null)){if(b)o.flags&256?(sa(o),o.flags&=-257,o=Jd(a,o,d)):o.memoizedState!==null?(ia(),o.child=a.child,o.flags|=128,o=null):(ia(),O=m.fallback,v=o.mode,m=Jo({mode:"visible",children:m.children},v),O=Ca(O,v,d,null),O.flags|=2,m.return=o,O.return=o,m.sibling=O,o.child=m,Ma(o,a.child,null,d),m=o.child,m.memoizedState=Wd(d),m.childLanes=Xd(a,R,d),o.memoizedState=Qd,o=Sl(null,m));else if(sa(o),kh(O)){if(R=O.nextSibling&&O.nextSibling.dataset,R)var X=R.dgst;R=X,m=Error(s(419)),m.stack="",m.digest=R,ol({value:m,source:null,stack:null}),o=Jd(a,o,d)}else if(ls||ur(a,o,d,!1),R=(d&a.childLanes)!==0,ls||R){if(R=Pt,R!==null&&(m=ce(R,d),m!==0&&m!==V.retryLane))throw V.retryLane=m,wa(a,m),Ws(R,a,m),Yd;Oh(O)||oc(),o=Jd(a,o,d)}else Oh(O)?(o.flags|=192,o.child=a.child,o=null):(a=V.treeContext,Ft=Ni(O.nextSibling),Ss=o,dt=!0,Wn=null,wi=!1,a!==null&&Tp(o,a),o=Zd(o,m.children),o.flags|=4096);return o}return v?(ia(),O=m.fallback,v=o.mode,V=a.child,X=V.sibling,m=Sn(V,{mode:"hidden",children:m.children}),m.subtreeFlags=V.subtreeFlags&65011712,X!==null?O=Sn(X,O):(O=Ca(O,v,d,null),O.flags|=2),O.return=o,m.return=o,m.sibling=O,o.child=m,Sl(null,m),m=o.child,O=a.child.memoizedState,O===null?O=Wd(d):(v=O.cachePool,v!==null?(V=as._currentValue,v=v.parent!==V?{parent:V,pool:V}:v):v=Lp(),O={baseLanes:O.baseLanes|d,cachePool:v}),m.memoizedState=O,m.childLanes=Xd(a,R,d),o.memoizedState=Qd,Sl(a.child,m)):(sa(o),d=a.child,a=d.sibling,d=Sn(d,{mode:"visible",children:m.children}),d.return=o,d.sibling=null,a!==null&&(R=o.deletions,R===null?(o.deletions=[a],o.flags|=16):R.push(a)),o.child=d,o.memoizedState=null,d)}function Zd(a,o){return o=Jo({mode:"visible",children:o},a.mode),o.return=a,a.child=o}function Jo(a,o){return a=li(22,a,null,o),a.lanes=0,a}function Jd(a,o,d){return Ma(o,a.child,null,d),a=Zd(o,o.pendingProps.children),a.flags|=2,o.memoizedState=null,a}function Vg(a,o,d){a.lanes|=o;var m=a.alternate;m!==null&&(m.lanes|=o),md(a.return,o,d)}function eh(a,o,d,m,v,b){var R=a.memoizedState;R===null?a.memoizedState={isBackwards:o,rendering:null,renderingStartTime:0,last:m,tail:d,tailMode:v,treeForkCount:b}:(R.isBackwards=o,R.rendering=null,R.renderingStartTime=0,R.last=m,R.tail=d,R.tailMode=v,R.treeForkCount=b)}function $g(a,o,d){var m=o.pendingProps,v=m.revealOrder,b=m.tail;m=m.children;var R=es.current,O=(R&2)!==0;if(O?(R=R&1|2,o.flags|=128):R&=1,te(es,R),Ts(a,o,m,d),m=dt?ll:0,!O&&a!==null&&(a.flags&128)!==0)e:for(a=o.child;a!==null;){if(a.tag===13)a.memoizedState!==null&&Vg(a,d,o);else if(a.tag===19)Vg(a,d,o);else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===o)break e;for(;a.sibling===null;){if(a.return===null||a.return===o)break e;a=a.return}a.sibling.return=a.return,a=a.sibling}switch(v){case"forwards":for(d=o.child,v=null;d!==null;)a=d.alternate,a!==null&&Vo(a)===null&&(v=d),d=d.sibling;d=v,d===null?(v=o.child,o.child=null):(v=d.sibling,d.sibling=null),eh(o,!1,v,d,b,m);break;case"backwards":case"unstable_legacy-backwards":for(d=null,v=o.child,o.child=null;v!==null;){if(a=v.alternate,a!==null&&Vo(a)===null){o.child=v;break}a=v.sibling,v.sibling=d,d=v,v=a}eh(o,!0,d,null,b,m);break;case"together":eh(o,!1,null,null,void 0,m);break;default:o.memoizedState=null}return o.child}function _n(a,o,d){if(a!==null&&(o.dependencies=a.dependencies),ra|=o.lanes,(d&o.childLanes)===0)if(a!==null){if(ur(a,o,d,!1),(d&o.childLanes)===0)return null}else return null;if(a!==null&&o.child!==a.child)throw Error(s(153));if(o.child!==null){for(a=o.child,d=Sn(a,a.pendingProps),o.child=d,d.return=o;a.sibling!==null;)a=a.sibling,d=d.sibling=Sn(a,a.pendingProps),d.return=o;d.sibling=null}return o.child}function th(a,o){return(a.lanes&o)!==0?!0:(a=a.dependencies,!!(a!==null&&ko(a)))}function iE(a,o,d){switch(o.tag){case 3:Ge(o,o.stateNode.containerInfo),Zn(o,as,a.memoizedState.cache),Na();break;case 27:case 5:mt(o);break;case 4:Ge(o,o.stateNode.containerInfo);break;case 10:Zn(o,o.type,o.memoizedProps.value);break;case 31:if(o.memoizedState!==null)return o.flags|=128,_d(o),null;break;case 13:var m=o.memoizedState;if(m!==null)return m.dehydrated!==null?(sa(o),o.flags|=128,null):(d&o.child.childLanes)!==0?Fg(a,o,d):(sa(o),a=_n(a,o,d),a!==null?a.sibling:null);sa(o);break;case 19:var v=(a.flags&128)!==0;if(m=(d&o.childLanes)!==0,m||(ur(a,o,d,!1),m=(d&o.childLanes)!==0),v){if(m)return $g(a,o,d);o.flags|=128}if(v=o.memoizedState,v!==null&&(v.rendering=null,v.tail=null,v.lastEffect=null),te(es,es.current),m)break;return null;case 22:return o.lanes=0,Dg(a,o,d,o.pendingProps);case 24:Zn(o,as,a.memoizedState.cache)}return _n(a,o,d)}function Gg(a,o,d){if(a!==null)if(a.memoizedProps!==o.pendingProps)ls=!0;else{if(!th(a,d)&&(o.flags&128)===0)return ls=!1,iE(a,o,d);ls=(a.flags&131072)!==0}else ls=!1,dt&&(o.flags&1048576)!==0&&bp(o,ll,o.index);switch(o.lanes=0,o.tag){case 16:e:{var m=o.pendingProps;if(a=Pa(o.elementType),o.type=a,typeof a=="function")rd(a)?(m=Ba(a,m),o.tag=1,o=jg(null,o,a,m,d)):(o.tag=0,o=qd(null,o,a,m,d));else{if(a!=null){var v=a.$$typeof;if(v===C){o.tag=11,o=Ng(null,o,a,m,d);break e}else if(v===k){o.tag=14,o=Og(null,o,a,m,d);break e}}throw o=re(a)||a,Error(s(306,o,""))}}return o;case 0:return qd(a,o,o.type,o.pendingProps,d);case 1:return m=o.type,v=Ba(m,o.pendingProps),jg(a,o,m,v,d);case 3:e:{if(Ge(o,o.stateNode.containerInfo),a===null)throw Error(s(387));m=o.pendingProps;var b=o.memoizedState;v=b.element,bd(a,o),pl(o,m,null,d);var R=o.memoizedState;if(m=R.cache,Zn(o,as,m),m!==b.cache&&pd(o,[as],d,!0),ml(),m=R.element,b.isDehydrated)if(b={element:m,isDehydrated:!1,cache:R.cache},o.updateQueue.baseState=b,o.memoizedState=b,o.flags&256){o=Bg(a,o,m,d);break e}else if(m!==v){v=_i(Error(s(424)),o),ol(v),o=Bg(a,o,m,d);break e}else for(a=o.stateNode.containerInfo,a.nodeType===9?a=a.body:a=a.nodeName==="HTML"?a.ownerDocument.body:a,Ft=Ni(a.firstChild),Ss=o,dt=!0,Wn=null,wi=!0,d=Dp(o,null,m,d),o.child=d;d;)d.flags=d.flags&-3|4096,d=d.sibling;else{if(Na(),m===v){o=_n(a,o,d);break e}Ts(a,o,m,d)}o=o.child}return o;case 26:return Zo(a,o),a===null?(d=ey(o.type,null,o.pendingProps,null))?o.memoizedState=d:dt||(d=o.type,a=o.pendingProps,m=pc(Ae.current).createElement(d),m[At]=o,m[gt]=a,Es(m,d,a),ns(m),o.stateNode=m):o.memoizedState=ey(o.type,a.memoizedProps,o.pendingProps,a.memoizedState),null;case 27:return mt(o),a===null&&dt&&(m=o.stateNode=X0(o.type,o.pendingProps,Ae.current),Ss=o,wi=!0,v=Ft,da(o.type)?(Dh=v,Ft=Ni(m.firstChild)):Ft=v),Ts(a,o,o.pendingProps.children,d),Zo(a,o),a===null&&(o.flags|=4194304),o.child;case 5:return a===null&&dt&&((v=m=Ft)&&(m=kE(m,o.type,o.pendingProps,wi),m!==null?(o.stateNode=m,Ss=o,Ft=Ni(m.firstChild),wi=!1,v=!0):v=!1),v||Xn(o)),mt(o),v=o.type,b=o.pendingProps,R=a!==null?a.memoizedProps:null,m=b.children,wh(v,b)?m=null:R!==null&&wh(v,R)&&(o.flags|=32),o.memoizedState!==null&&(v=Ld(a,o,qT,null,null,d),Pl._currentValue=v),Zo(a,o),Ts(a,o,m,d),o.child;case 6:return a===null&&dt&&((a=d=Ft)&&(d=DE(d,o.pendingProps,wi),d!==null?(o.stateNode=d,Ss=o,Ft=null,a=!0):a=!1),a||Xn(o)),null;case 13:return Fg(a,o,d);case 4:return Ge(o,o.stateNode.containerInfo),m=o.pendingProps,a===null?o.child=Ma(o,null,m,d):Ts(a,o,m,d),o.child;case 11:return Ng(a,o,o.type,o.pendingProps,d);case 7:return Ts(a,o,o.pendingProps,d),o.child;case 8:return Ts(a,o,o.pendingProps.children,d),o.child;case 12:return Ts(a,o,o.pendingProps.children,d),o.child;case 10:return m=o.pendingProps,Zn(o,o.type,m.value),Ts(a,o,m.children,d),o.child;case 9:return v=o.type._context,m=o.pendingProps.children,ka(o),v=bs(v),m=m(v),o.flags|=1,Ts(a,o,m,d),o.child;case 14:return Og(a,o,o.type,o.pendingProps,d);case 15:return kg(a,o,o.type,o.pendingProps,d);case 19:return $g(a,o,d);case 31:return sE(a,o,d);case 22:return Dg(a,o,d,o.pendingProps);case 24:return ka(o),m=bs(as),a===null?(v=vd(),v===null&&(v=Pt,b=gd(),v.pooledCache=b,b.refCount++,b!==null&&(v.pooledCacheLanes|=d),v=b),o.memoizedState={parent:m,cache:v},Sd(o),Zn(o,as,v)):((a.lanes&d)!==0&&(bd(a,o),pl(o,null,null,d),ml()),v=a.memoizedState,b=o.memoizedState,v.parent!==m?(v={parent:m,cache:m},o.memoizedState=v,o.lanes===0&&(o.memoizedState=o.updateQueue.baseState=v),Zn(o,as,m)):(m=b.cache,Zn(o,as,m),m!==v.cache&&pd(o,[as],d,!0))),Ts(a,o,o.pendingProps.children,d),o.child;case 29:throw o.pendingProps}throw Error(s(156,o.tag))}function Rn(a){a.flags|=4}function sh(a,o,d,m,v){if((o=(a.mode&32)!==0)&&(o=!1),o){if(a.flags|=16777216,(v&335544128)===v)if(a.stateNode.complete)a.flags|=8192;else if(g0())a.flags|=8192;else throw Ua=Mo,xd}else a.flags&=-16777217}function Hg(a,o){if(o.type!=="stylesheet"||(o.state.loading&4)!==0)a.flags&=-16777217;else if(a.flags|=16777216,!ay(o))if(g0())a.flags|=8192;else throw Ua=Mo,xd}function ec(a,o){o!==null&&(a.flags|=4),a.flags&16384&&(o=a.tag!==22?Qi():536870912,a.lanes|=o,Tr|=o)}function bl(a,o){if(!dt)switch(a.tailMode){case"hidden":o=a.tail;for(var d=null;o!==null;)o.alternate!==null&&(d=o),o=o.sibling;d===null?a.tail=null:d.sibling=null;break;case"collapsed":d=a.tail;for(var m=null;d!==null;)d.alternate!==null&&(m=d),d=d.sibling;m===null?o||a.tail===null?a.tail=null:a.tail.sibling=null:m.sibling=null}}function Vt(a){var o=a.alternate!==null&&a.alternate.child===a.child,d=0,m=0;if(o)for(var v=a.child;v!==null;)d|=v.lanes|v.childLanes,m|=v.subtreeFlags&65011712,m|=v.flags&65011712,v.return=a,v=v.sibling;else for(v=a.child;v!==null;)d|=v.lanes|v.childLanes,m|=v.subtreeFlags,m|=v.flags,v.return=a,v=v.sibling;return a.subtreeFlags|=m,a.childLanes=d,o}function nE(a,o,d){var m=o.pendingProps;switch(ud(o),o.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Vt(o),null;case 1:return Vt(o),null;case 3:return d=o.stateNode,m=null,a!==null&&(m=a.memoizedState.cache),o.memoizedState.cache!==m&&(o.flags|=2048),En(as),Fe(),d.pendingContext&&(d.context=d.pendingContext,d.pendingContext=null),(a===null||a.child===null)&&(cr(o)?Rn(o):a===null||a.memoizedState.isDehydrated&&(o.flags&256)===0||(o.flags|=1024,hd())),Vt(o),null;case 26:var v=o.type,b=o.memoizedState;return a===null?(Rn(o),b!==null?(Vt(o),Hg(o,b)):(Vt(o),sh(o,v,null,m,d))):b?b!==a.memoizedState?(Rn(o),Vt(o),Hg(o,b)):(Vt(o),o.flags&=-16777217):(a=a.memoizedProps,a!==m&&Rn(o),Vt(o),sh(o,v,a,m,d)),null;case 27:if(St(o),d=Ae.current,v=o.type,a!==null&&o.stateNode!=null)a.memoizedProps!==m&&Rn(o);else{if(!m){if(o.stateNode===null)throw Error(s(166));return Vt(o),null}a=fe.current,cr(o)?Ep(o):(a=X0(v,m,d),o.stateNode=a,Rn(o))}return Vt(o),null;case 5:if(St(o),v=o.type,a!==null&&o.stateNode!=null)a.memoizedProps!==m&&Rn(o);else{if(!m){if(o.stateNode===null)throw Error(s(166));return Vt(o),null}if(b=fe.current,cr(o))Ep(o);else{var R=pc(Ae.current);switch(b){case 1:b=R.createElementNS("http://www.w3.org/2000/svg",v);break;case 2:b=R.createElementNS("http://www.w3.org/1998/Math/MathML",v);break;default:switch(v){case"svg":b=R.createElementNS("http://www.w3.org/2000/svg",v);break;case"math":b=R.createElementNS("http://www.w3.org/1998/Math/MathML",v);break;case"script":b=R.createElement("div"),b.innerHTML="<script><\/script>",b=b.removeChild(b.firstChild);break;case"select":b=typeof m.is=="string"?R.createElement("select",{is:m.is}):R.createElement("select"),m.multiple?b.multiple=!0:m.size&&(b.size=m.size);break;default:b=typeof m.is=="string"?R.createElement(v,{is:m.is}):R.createElement(v)}}b[At]=o,b[gt]=m;e:for(R=o.child;R!==null;){if(R.tag===5||R.tag===6)b.appendChild(R.stateNode);else if(R.tag!==4&&R.tag!==27&&R.child!==null){R.child.return=R,R=R.child;continue}if(R===o)break e;for(;R.sibling===null;){if(R.return===null||R.return===o)break e;R=R.return}R.sibling.return=R.return,R=R.sibling}o.stateNode=b;e:switch(Es(b,v,m),v){case"button":case"input":case"select":case"textarea":m=!!m.autoFocus;break e;case"img":m=!0;break e;default:m=!1}m&&Rn(o)}}return Vt(o),sh(o,o.type,a===null?null:a.memoizedProps,o.pendingProps,d),null;case 6:if(a&&o.stateNode!=null)a.memoizedProps!==m&&Rn(o);else{if(typeof m!="string"&&o.stateNode===null)throw Error(s(166));if(a=Ae.current,cr(o)){if(a=o.stateNode,d=o.memoizedProps,m=null,v=Ss,v!==null)switch(v.tag){case 27:case 5:m=v.memoizedProps}a[At]=o,a=!!(a.nodeValue===d||m!==null&&m.suppressHydrationWarning===!0||F0(a.nodeValue,d)),a||Xn(o,!0)}else a=pc(a).createTextNode(m),a[At]=o,o.stateNode=a}return Vt(o),null;case 31:if(d=o.memoizedState,a===null||a.memoizedState!==null){if(m=cr(o),d!==null){if(a===null){if(!m)throw Error(s(318));if(a=o.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(s(557));a[At]=o}else Na(),(o.flags&128)===0&&(o.memoizedState=null),o.flags|=4;Vt(o),a=!1}else d=hd(),a!==null&&a.memoizedState!==null&&(a.memoizedState.hydrationErrors=d),a=!0;if(!a)return o.flags&256?(ci(o),o):(ci(o),null);if((o.flags&128)!==0)throw Error(s(558))}return Vt(o),null;case 13:if(m=o.memoizedState,a===null||a.memoizedState!==null&&a.memoizedState.dehydrated!==null){if(v=cr(o),m!==null&&m.dehydrated!==null){if(a===null){if(!v)throw Error(s(318));if(v=o.memoizedState,v=v!==null?v.dehydrated:null,!v)throw Error(s(317));v[At]=o}else Na(),(o.flags&128)===0&&(o.memoizedState=null),o.flags|=4;Vt(o),v=!1}else v=hd(),a!==null&&a.memoizedState!==null&&(a.memoizedState.hydrationErrors=v),v=!0;if(!v)return o.flags&256?(ci(o),o):(ci(o),null)}return ci(o),(o.flags&128)!==0?(o.lanes=d,o):(d=m!==null,a=a!==null&&a.memoizedState!==null,d&&(m=o.child,v=null,m.alternate!==null&&m.alternate.memoizedState!==null&&m.alternate.memoizedState.cachePool!==null&&(v=m.alternate.memoizedState.cachePool.pool),b=null,m.memoizedState!==null&&m.memoizedState.cachePool!==null&&(b=m.memoizedState.cachePool.pool),b!==v&&(m.flags|=2048)),d!==a&&d&&(o.child.flags|=8192),ec(o,o.updateQueue),Vt(o),null);case 4:return Fe(),a===null&&Ah(o.stateNode.containerInfo),Vt(o),null;case 10:return En(o.type),Vt(o),null;case 19:if(G(es),m=o.memoizedState,m===null)return Vt(o),null;if(v=(o.flags&128)!==0,b=m.rendering,b===null)if(v)bl(m,!1);else{if(Wt!==0||a!==null&&(a.flags&128)!==0)for(a=o.child;a!==null;){if(b=Vo(a),b!==null){for(o.flags|=128,bl(m,!1),a=b.updateQueue,o.updateQueue=a,ec(o,a),o.subtreeFlags=0,a=d,d=o.child;d!==null;)vp(d,a),d=d.sibling;return te(es,es.current&1|2),dt&&bn(o,m.treeForkCount),o.child}a=a.sibling}m.tail!==null&&nt()>ac&&(o.flags|=128,v=!0,bl(m,!1),o.lanes=4194304)}else{if(!v)if(a=Vo(b),a!==null){if(o.flags|=128,v=!0,a=a.updateQueue,o.updateQueue=a,ec(o,a),bl(m,!0),m.tail===null&&m.tailMode==="hidden"&&!b.alternate&&!dt)return Vt(o),null}else 2*nt()-m.renderingStartTime>ac&&d!==536870912&&(o.flags|=128,v=!0,bl(m,!1),o.lanes=4194304);m.isBackwards?(b.sibling=o.child,o.child=b):(a=m.last,a!==null?a.sibling=b:o.child=b,m.last=b)}return m.tail!==null?(a=m.tail,m.rendering=a,m.tail=a.sibling,m.renderingStartTime=nt(),a.sibling=null,d=es.current,te(es,v?d&1|2:d&1),dt&&bn(o,m.treeForkCount),a):(Vt(o),null);case 22:case 23:return ci(o),Id(),m=o.memoizedState!==null,a!==null?a.memoizedState!==null!==m&&(o.flags|=8192):m&&(o.flags|=8192),m?(d&536870912)!==0&&(o.flags&128)===0&&(Vt(o),o.subtreeFlags&6&&(o.flags|=8192)):Vt(o),d=o.updateQueue,d!==null&&ec(o,d.retryQueue),d=null,a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(d=a.memoizedState.cachePool.pool),m=null,o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(m=o.memoizedState.cachePool.pool),m!==d&&(o.flags|=2048),a!==null&&G(Da),null;case 24:return d=null,a!==null&&(d=a.memoizedState.cache),o.memoizedState.cache!==d&&(o.flags|=2048),En(as),Vt(o),null;case 25:return null;case 30:return null}throw Error(s(156,o.tag))}function aE(a,o){switch(ud(o),o.tag){case 1:return a=o.flags,a&65536?(o.flags=a&-65537|128,o):null;case 3:return En(as),Fe(),a=o.flags,(a&65536)!==0&&(a&128)===0?(o.flags=a&-65537|128,o):null;case 26:case 27:case 5:return St(o),null;case 31:if(o.memoizedState!==null){if(ci(o),o.alternate===null)throw Error(s(340));Na()}return a=o.flags,a&65536?(o.flags=a&-65537|128,o):null;case 13:if(ci(o),a=o.memoizedState,a!==null&&a.dehydrated!==null){if(o.alternate===null)throw Error(s(340));Na()}return a=o.flags,a&65536?(o.flags=a&-65537|128,o):null;case 19:return G(es),null;case 4:return Fe(),null;case 10:return En(o.type),null;case 22:case 23:return ci(o),Id(),a!==null&&G(Da),a=o.flags,a&65536?(o.flags=a&-65537|128,o):null;case 24:return En(as),null;case 25:return null;default:return null}}function zg(a,o){switch(ud(o),o.tag){case 3:En(as),Fe();break;case 26:case 27:case 5:St(o);break;case 4:Fe();break;case 31:o.memoizedState!==null&&ci(o);break;case 13:ci(o);break;case 19:G(es);break;case 10:En(o.type);break;case 22:case 23:ci(o),Id(),a!==null&&G(Da);break;case 24:En(as)}}function Tl(a,o){try{var d=o.updateQueue,m=d!==null?d.lastEffect:null;if(m!==null){var v=m.next;d=v;do{if((d.tag&a)===a){m=void 0;var b=d.create,R=d.inst;m=b(),R.destroy=m}d=d.next}while(d!==v)}}catch(O){_t(o,o.return,O)}}function na(a,o,d){try{var m=o.updateQueue,v=m!==null?m.lastEffect:null;if(v!==null){var b=v.next;m=b;do{if((m.tag&a)===a){var R=m.inst,O=R.destroy;if(O!==void 0){R.destroy=void 0,v=o;var V=d,X=O;try{X()}catch(le){_t(v,V,le)}}}m=m.next}while(m!==b)}}catch(le){_t(o,o.return,le)}}function Kg(a){var o=a.updateQueue;if(o!==null){var d=a.stateNode;try{Up(o,d)}catch(m){_t(a,a.return,m)}}}function Yg(a,o,d){d.props=Ba(a.type,a.memoizedProps),d.state=a.memoizedState;try{d.componentWillUnmount()}catch(m){_t(a,o,m)}}function El(a,o){try{var d=a.ref;if(d!==null){switch(a.tag){case 26:case 27:case 5:var m=a.stateNode;break;case 30:m=a.stateNode;break;default:m=a.stateNode}typeof d=="function"?a.refCleanup=d(m):d.current=m}}catch(v){_t(a,o,v)}}function Ji(a,o){var d=a.ref,m=a.refCleanup;if(d!==null)if(typeof m=="function")try{m()}catch(v){_t(a,o,v)}finally{a.refCleanup=null,a=a.alternate,a!=null&&(a.refCleanup=null)}else if(typeof d=="function")try{d(null)}catch(v){_t(a,o,v)}else d.current=null}function qg(a){var o=a.type,d=a.memoizedProps,m=a.stateNode;try{e:switch(o){case"button":case"input":case"select":case"textarea":d.autoFocus&&m.focus();break e;case"img":d.src?m.src=d.src:d.srcSet&&(m.srcset=d.srcSet)}}catch(v){_t(a,a.return,v)}}function ih(a,o,d){try{var m=a.stateNode;RE(m,a.type,d,o),m[gt]=o}catch(v){_t(a,a.return,v)}}function Qg(a){return a.tag===5||a.tag===3||a.tag===26||a.tag===27&&da(a.type)||a.tag===4}function nh(a){e:for(;;){for(;a.sibling===null;){if(a.return===null||Qg(a.return))return null;a=a.return}for(a.sibling.return=a.return,a=a.sibling;a.tag!==5&&a.tag!==6&&a.tag!==18;){if(a.tag===27&&da(a.type)||a.flags&2||a.child===null||a.tag===4)continue e;a.child.return=a,a=a.child}if(!(a.flags&2))return a.stateNode}}function ah(a,o,d){var m=a.tag;if(m===5||m===6)a=a.stateNode,o?(d.nodeType===9?d.body:d.nodeName==="HTML"?d.ownerDocument.body:d).insertBefore(a,o):(o=d.nodeType===9?d.body:d.nodeName==="HTML"?d.ownerDocument.body:d,o.appendChild(a),d=d._reactRootContainer,d!=null||o.onclick!==null||(o.onclick=vn));else if(m!==4&&(m===27&&da(a.type)&&(d=a.stateNode,o=null),a=a.child,a!==null))for(ah(a,o,d),a=a.sibling;a!==null;)ah(a,o,d),a=a.sibling}function tc(a,o,d){var m=a.tag;if(m===5||m===6)a=a.stateNode,o?d.insertBefore(a,o):d.appendChild(a);else if(m!==4&&(m===27&&da(a.type)&&(d=a.stateNode),a=a.child,a!==null))for(tc(a,o,d),a=a.sibling;a!==null;)tc(a,o,d),a=a.sibling}function Wg(a){var o=a.stateNode,d=a.memoizedProps;try{for(var m=a.type,v=o.attributes;v.length;)o.removeAttributeNode(v[0]);Es(o,m,d),o[At]=a,o[gt]=d}catch(b){_t(a,a.return,b)}}var Ln=!1,os=!1,rh=!1,Xg=typeof WeakSet=="function"?WeakSet:Set,ps=null;function rE(a,o){if(a=a.containerInfo,Rh=Tc,a=cp(a),Ju(a)){if("selectionStart"in a)var d={start:a.selectionStart,end:a.selectionEnd};else e:{d=(d=a.ownerDocument)&&d.defaultView||window;var m=d.getSelection&&d.getSelection();if(m&&m.rangeCount!==0){d=m.anchorNode;var v=m.anchorOffset,b=m.focusNode;m=m.focusOffset;try{d.nodeType,b.nodeType}catch{d=null;break e}var R=0,O=-1,V=-1,X=0,le=0,pe=a,Z=null;t:for(;;){for(var ie;pe!==d||v!==0&&pe.nodeType!==3||(O=R+v),pe!==b||m!==0&&pe.nodeType!==3||(V=R+m),pe.nodeType===3&&(R+=pe.nodeValue.length),(ie=pe.firstChild)!==null;)Z=pe,pe=ie;for(;;){if(pe===a)break t;if(Z===d&&++X===v&&(O=R),Z===b&&++le===m&&(V=R),(ie=pe.nextSibling)!==null)break;pe=Z,Z=pe.parentNode}pe=ie}d=O===-1||V===-1?null:{start:O,end:V}}else d=null}d=d||{start:0,end:0}}else d=null;for(Lh={focusedElem:a,selectionRange:d},Tc=!1,ps=o;ps!==null;)if(o=ps,a=o.child,(o.subtreeFlags&1028)!==0&&a!==null)a.return=o,ps=a;else for(;ps!==null;){switch(o=ps,b=o.alternate,a=o.flags,o.tag){case 0:if((a&4)!==0&&(a=o.updateQueue,a=a!==null?a.events:null,a!==null))for(d=0;d<a.length;d++)v=a[d],v.ref.impl=v.nextImpl;break;case 11:case 15:break;case 1:if((a&1024)!==0&&b!==null){a=void 0,d=o,v=b.memoizedProps,b=b.memoizedState,m=d.stateNode;try{var Pe=Ba(d.type,v);a=m.getSnapshotBeforeUpdate(Pe,b),m.__reactInternalSnapshotBeforeUpdate=a}catch($e){_t(d,d.return,$e)}}break;case 3:if((a&1024)!==0){if(a=o.stateNode.containerInfo,d=a.nodeType,d===9)Nh(a);else if(d===1)switch(a.nodeName){case"HEAD":case"HTML":case"BODY":Nh(a);break;default:a.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((a&1024)!==0)throw Error(s(163))}if(a=o.sibling,a!==null){a.return=o.return,ps=a;break}ps=o.return}}function Zg(a,o,d){var m=d.flags;switch(d.tag){case 0:case 11:case 15:Cn(a,d),m&4&&Tl(5,d);break;case 1:if(Cn(a,d),m&4)if(a=d.stateNode,o===null)try{a.componentDidMount()}catch(R){_t(d,d.return,R)}else{var v=Ba(d.type,o.memoizedProps);o=o.memoizedState;try{a.componentDidUpdate(v,o,a.__reactInternalSnapshotBeforeUpdate)}catch(R){_t(d,d.return,R)}}m&64&&Kg(d),m&512&&El(d,d.return);break;case 3:if(Cn(a,d),m&64&&(a=d.updateQueue,a!==null)){if(o=null,d.child!==null)switch(d.child.tag){case 27:case 5:o=d.child.stateNode;break;case 1:o=d.child.stateNode}try{Up(a,o)}catch(R){_t(d,d.return,R)}}break;case 27:o===null&&m&4&&Wg(d);case 26:case 5:Cn(a,d),o===null&&m&4&&qg(d),m&512&&El(d,d.return);break;case 12:Cn(a,d);break;case 31:Cn(a,d),m&4&&t0(a,d);break;case 13:Cn(a,d),m&4&&s0(a,d),m&64&&(a=d.memoizedState,a!==null&&(a=a.dehydrated,a!==null&&(d=pE.bind(null,d),PE(a,d))));break;case 22:if(m=d.memoizedState!==null||Ln,!m){o=o!==null&&o.memoizedState!==null||os,v=Ln;var b=os;Ln=m,(os=o)&&!b?Nn(a,d,(d.subtreeFlags&8772)!==0):Cn(a,d),Ln=v,os=b}break;case 30:break;default:Cn(a,d)}}function Jg(a){var o=a.alternate;o!==null&&(a.alternate=null,Jg(o)),a.child=null,a.deletions=null,a.sibling=null,a.tag===5&&(o=a.stateNode,o!==null&&Ai(o)),a.stateNode=null,a.return=null,a.dependencies=null,a.memoizedProps=null,a.memoizedState=null,a.pendingProps=null,a.stateNode=null,a.updateQueue=null}var Gt=null,Ks=!1;function wn(a,o,d){for(d=d.child;d!==null;)e0(a,o,d),d=d.sibling}function e0(a,o,d){if(Bt&&typeof Bt.onCommitFiberUnmount=="function")try{Bt.onCommitFiberUnmount(js,d)}catch{}switch(d.tag){case 26:os||Ji(d,o),wn(a,o,d),d.memoizedState?d.memoizedState.count--:d.stateNode&&(d=d.stateNode,d.parentNode.removeChild(d));break;case 27:os||Ji(d,o);var m=Gt,v=Ks;da(d.type)&&(Gt=d.stateNode,Ks=!1),wn(a,o,d),Ol(d.stateNode),Gt=m,Ks=v;break;case 5:os||Ji(d,o);case 6:if(m=Gt,v=Ks,Gt=null,wn(a,o,d),Gt=m,Ks=v,Gt!==null)if(Ks)try{(Gt.nodeType===9?Gt.body:Gt.nodeName==="HTML"?Gt.ownerDocument.body:Gt).removeChild(d.stateNode)}catch(b){_t(d,o,b)}else try{Gt.removeChild(d.stateNode)}catch(b){_t(d,o,b)}break;case 18:Gt!==null&&(Ks?(a=Gt,K0(a.nodeType===9?a.body:a.nodeName==="HTML"?a.ownerDocument.body:a,d.stateNode),Cr(a)):K0(Gt,d.stateNode));break;case 4:m=Gt,v=Ks,Gt=d.stateNode.containerInfo,Ks=!0,wn(a,o,d),Gt=m,Ks=v;break;case 0:case 11:case 14:case 15:na(2,d,o),os||na(4,d,o),wn(a,o,d);break;case 1:os||(Ji(d,o),m=d.stateNode,typeof m.componentWillUnmount=="function"&&Yg(d,o,m)),wn(a,o,d);break;case 21:wn(a,o,d);break;case 22:os=(m=os)||d.memoizedState!==null,wn(a,o,d),os=m;break;default:wn(a,o,d)}}function t0(a,o){if(o.memoizedState===null&&(a=o.alternate,a!==null&&(a=a.memoizedState,a!==null))){a=a.dehydrated;try{Cr(a)}catch(d){_t(o,o.return,d)}}}function s0(a,o){if(o.memoizedState===null&&(a=o.alternate,a!==null&&(a=a.memoizedState,a!==null&&(a=a.dehydrated,a!==null))))try{Cr(a)}catch(d){_t(o,o.return,d)}}function lE(a){switch(a.tag){case 31:case 13:case 19:var o=a.stateNode;return o===null&&(o=a.stateNode=new Xg),o;case 22:return a=a.stateNode,o=a._retryCache,o===null&&(o=a._retryCache=new Xg),o;default:throw Error(s(435,a.tag))}}function sc(a,o){var d=lE(a);o.forEach(function(m){if(!d.has(m)){d.add(m);var v=gE.bind(null,a,m);m.then(v,v)}})}function Ys(a,o){var d=o.deletions;if(d!==null)for(var m=0;m<d.length;m++){var v=d[m],b=a,R=o,O=R;e:for(;O!==null;){switch(O.tag){case 27:if(da(O.type)){Gt=O.stateNode,Ks=!1;break e}break;case 5:Gt=O.stateNode,Ks=!1;break e;case 3:case 4:Gt=O.stateNode.containerInfo,Ks=!0;break e}O=O.return}if(Gt===null)throw Error(s(160));e0(b,R,v),Gt=null,Ks=!1,b=v.alternate,b!==null&&(b.return=null),v.return=null}if(o.subtreeFlags&13886)for(o=o.child;o!==null;)i0(o,a),o=o.sibling}var Gi=null;function i0(a,o){var d=a.alternate,m=a.flags;switch(a.tag){case 0:case 11:case 14:case 15:Ys(o,a),qs(a),m&4&&(na(3,a,a.return),Tl(3,a),na(5,a,a.return));break;case 1:Ys(o,a),qs(a),m&512&&(os||d===null||Ji(d,d.return)),m&64&&Ln&&(a=a.updateQueue,a!==null&&(m=a.callbacks,m!==null&&(d=a.shared.hiddenCallbacks,a.shared.hiddenCallbacks=d===null?m:d.concat(m))));break;case 26:var v=Gi;if(Ys(o,a),qs(a),m&512&&(os||d===null||Ji(d,d.return)),m&4){var b=d!==null?d.memoizedState:null;if(m=a.memoizedState,d===null)if(m===null)if(a.stateNode===null){e:{m=a.type,d=a.memoizedProps,v=v.ownerDocument||v;t:switch(m){case"title":b=v.getElementsByTagName("title")[0],(!b||b[Gn]||b[At]||b.namespaceURI==="http://www.w3.org/2000/svg"||b.hasAttribute("itemprop"))&&(b=v.createElement(m),v.head.insertBefore(b,v.querySelector("head > title"))),Es(b,m,d),b[At]=a,ns(b),m=b;break e;case"link":var R=iy("link","href",v).get(m+(d.href||""));if(R){for(var O=0;O<R.length;O++)if(b=R[O],b.getAttribute("href")===(d.href==null||d.href===""?null:d.href)&&b.getAttribute("rel")===(d.rel==null?null:d.rel)&&b.getAttribute("title")===(d.title==null?null:d.title)&&b.getAttribute("crossorigin")===(d.crossOrigin==null?null:d.crossOrigin)){R.splice(O,1);break t}}b=v.createElement(m),Es(b,m,d),v.head.appendChild(b);break;case"meta":if(R=iy("meta","content",v).get(m+(d.content||""))){for(O=0;O<R.length;O++)if(b=R[O],b.getAttribute("content")===(d.content==null?null:""+d.content)&&b.getAttribute("name")===(d.name==null?null:d.name)&&b.getAttribute("property")===(d.property==null?null:d.property)&&b.getAttribute("http-equiv")===(d.httpEquiv==null?null:d.httpEquiv)&&b.getAttribute("charset")===(d.charSet==null?null:d.charSet)){R.splice(O,1);break t}}b=v.createElement(m),Es(b,m,d),v.head.appendChild(b);break;default:throw Error(s(468,m))}b[At]=a,ns(b),m=b}a.stateNode=m}else ny(v,a.type,a.stateNode);else a.stateNode=sy(v,m,a.memoizedProps);else b!==m?(b===null?d.stateNode!==null&&(d=d.stateNode,d.parentNode.removeChild(d)):b.count--,m===null?ny(v,a.type,a.stateNode):sy(v,m,a.memoizedProps)):m===null&&a.stateNode!==null&&ih(a,a.memoizedProps,d.memoizedProps)}break;case 27:Ys(o,a),qs(a),m&512&&(os||d===null||Ji(d,d.return)),d!==null&&m&4&&ih(a,a.memoizedProps,d.memoizedProps);break;case 5:if(Ys(o,a),qs(a),m&512&&(os||d===null||Ji(d,d.return)),a.flags&32){v=a.stateNode;try{yn(v,"")}catch(Pe){_t(a,a.return,Pe)}}m&4&&a.stateNode!=null&&(v=a.memoizedProps,ih(a,v,d!==null?d.memoizedProps:v)),m&1024&&(rh=!0);break;case 6:if(Ys(o,a),qs(a),m&4){if(a.stateNode===null)throw Error(s(162));m=a.memoizedProps,d=a.stateNode;try{d.nodeValue=m}catch(Pe){_t(a,a.return,Pe)}}break;case 3:if(vc=null,v=Gi,Gi=gc(o.containerInfo),Ys(o,a),Gi=v,qs(a),m&4&&d!==null&&d.memoizedState.isDehydrated)try{Cr(o.containerInfo)}catch(Pe){_t(a,a.return,Pe)}rh&&(rh=!1,n0(a));break;case 4:m=Gi,Gi=gc(a.stateNode.containerInfo),Ys(o,a),qs(a),Gi=m;break;case 12:Ys(o,a),qs(a);break;case 31:Ys(o,a),qs(a),m&4&&(m=a.updateQueue,m!==null&&(a.updateQueue=null,sc(a,m)));break;case 13:Ys(o,a),qs(a),a.child.flags&8192&&a.memoizedState!==null!=(d!==null&&d.memoizedState!==null)&&(nc=nt()),m&4&&(m=a.updateQueue,m!==null&&(a.updateQueue=null,sc(a,m)));break;case 22:v=a.memoizedState!==null;var V=d!==null&&d.memoizedState!==null,X=Ln,le=os;if(Ln=X||v,os=le||V,Ys(o,a),os=le,Ln=X,qs(a),m&8192)e:for(o=a.stateNode,o._visibility=v?o._visibility&-2:o._visibility|1,v&&(d===null||V||Ln||os||Fa(a)),d=null,o=a;;){if(o.tag===5||o.tag===26){if(d===null){V=d=o;try{if(b=V.stateNode,v)R=b.style,typeof R.setProperty=="function"?R.setProperty("display","none","important"):R.display="none";else{O=V.stateNode;var pe=V.memoizedProps.style,Z=pe!=null&&pe.hasOwnProperty("display")?pe.display:null;O.style.display=Z==null||typeof Z=="boolean"?"":(""+Z).trim()}}catch(Pe){_t(V,V.return,Pe)}}}else if(o.tag===6){if(d===null){V=o;try{V.stateNode.nodeValue=v?"":V.memoizedProps}catch(Pe){_t(V,V.return,Pe)}}}else if(o.tag===18){if(d===null){V=o;try{var ie=V.stateNode;v?Y0(ie,!0):Y0(V.stateNode,!1)}catch(Pe){_t(V,V.return,Pe)}}}else if((o.tag!==22&&o.tag!==23||o.memoizedState===null||o===a)&&o.child!==null){o.child.return=o,o=o.child;continue}if(o===a)break e;for(;o.sibling===null;){if(o.return===null||o.return===a)break e;d===o&&(d=null),o=o.return}d===o&&(d=null),o.sibling.return=o.return,o=o.sibling}m&4&&(m=a.updateQueue,m!==null&&(d=m.retryQueue,d!==null&&(m.retryQueue=null,sc(a,d))));break;case 19:Ys(o,a),qs(a),m&4&&(m=a.updateQueue,m!==null&&(a.updateQueue=null,sc(a,m)));break;case 30:break;case 21:break;default:Ys(o,a),qs(a)}}function qs(a){var o=a.flags;if(o&2){try{for(var d,m=a.return;m!==null;){if(Qg(m)){d=m;break}m=m.return}if(d==null)throw Error(s(160));switch(d.tag){case 27:var v=d.stateNode,b=nh(a);tc(a,b,v);break;case 5:var R=d.stateNode;d.flags&32&&(yn(R,""),d.flags&=-33);var O=nh(a);tc(a,O,R);break;case 3:case 4:var V=d.stateNode.containerInfo,X=nh(a);ah(a,X,V);break;default:throw Error(s(161))}}catch(le){_t(a,a.return,le)}a.flags&=-3}o&4096&&(a.flags&=-4097)}function n0(a){if(a.subtreeFlags&1024)for(a=a.child;a!==null;){var o=a;n0(o),o.tag===5&&o.flags&1024&&o.stateNode.reset(),a=a.sibling}}function Cn(a,o){if(o.subtreeFlags&8772)for(o=o.child;o!==null;)Zg(a,o.alternate,o),o=o.sibling}function Fa(a){for(a=a.child;a!==null;){var o=a;switch(o.tag){case 0:case 11:case 14:case 15:na(4,o,o.return),Fa(o);break;case 1:Ji(o,o.return);var d=o.stateNode;typeof d.componentWillUnmount=="function"&&Yg(o,o.return,d),Fa(o);break;case 27:Ol(o.stateNode);case 26:case 5:Ji(o,o.return),Fa(o);break;case 22:o.memoizedState===null&&Fa(o);break;case 30:Fa(o);break;default:Fa(o)}a=a.sibling}}function Nn(a,o,d){for(d=d&&(o.subtreeFlags&8772)!==0,o=o.child;o!==null;){var m=o.alternate,v=a,b=o,R=b.flags;switch(b.tag){case 0:case 11:case 15:Nn(v,b,d),Tl(4,b);break;case 1:if(Nn(v,b,d),m=b,v=m.stateNode,typeof v.componentDidMount=="function")try{v.componentDidMount()}catch(X){_t(m,m.return,X)}if(m=b,v=m.updateQueue,v!==null){var O=m.stateNode;try{var V=v.shared.hiddenCallbacks;if(V!==null)for(v.shared.hiddenCallbacks=null,v=0;v<V.length;v++)Pp(V[v],O)}catch(X){_t(m,m.return,X)}}d&&R&64&&Kg(b),El(b,b.return);break;case 27:Wg(b);case 26:case 5:Nn(v,b,d),d&&m===null&&R&4&&qg(b),El(b,b.return);break;case 12:Nn(v,b,d);break;case 31:Nn(v,b,d),d&&R&4&&t0(v,b);break;case 13:Nn(v,b,d),d&&R&4&&s0(v,b);break;case 22:b.memoizedState===null&&Nn(v,b,d),El(b,b.return);break;case 30:break;default:Nn(v,b,d)}o=o.sibling}}function lh(a,o){var d=null;a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(d=a.memoizedState.cachePool.pool),a=null,o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(a=o.memoizedState.cachePool.pool),a!==d&&(a!=null&&a.refCount++,d!=null&&cl(d))}function oh(a,o){a=null,o.alternate!==null&&(a=o.alternate.memoizedState.cache),o=o.memoizedState.cache,o!==a&&(o.refCount++,a!=null&&cl(a))}function Hi(a,o,d,m){if(o.subtreeFlags&10256)for(o=o.child;o!==null;)a0(a,o,d,m),o=o.sibling}function a0(a,o,d,m){var v=o.flags;switch(o.tag){case 0:case 11:case 15:Hi(a,o,d,m),v&2048&&Tl(9,o);break;case 1:Hi(a,o,d,m);break;case 3:Hi(a,o,d,m),v&2048&&(a=null,o.alternate!==null&&(a=o.alternate.memoizedState.cache),o=o.memoizedState.cache,o!==a&&(o.refCount++,a!=null&&cl(a)));break;case 12:if(v&2048){Hi(a,o,d,m),a=o.stateNode;try{var b=o.memoizedProps,R=b.id,O=b.onPostCommit;typeof O=="function"&&O(R,o.alternate===null?"mount":"update",a.passiveEffectDuration,-0)}catch(V){_t(o,o.return,V)}}else Hi(a,o,d,m);break;case 31:Hi(a,o,d,m);break;case 13:Hi(a,o,d,m);break;case 23:break;case 22:b=o.stateNode,R=o.alternate,o.memoizedState!==null?b._visibility&2?Hi(a,o,d,m):Al(a,o):b._visibility&2?Hi(a,o,d,m):(b._visibility|=2,xr(a,o,d,m,(o.subtreeFlags&10256)!==0||!1)),v&2048&&lh(R,o);break;case 24:Hi(a,o,d,m),v&2048&&oh(o.alternate,o);break;default:Hi(a,o,d,m)}}function xr(a,o,d,m,v){for(v=v&&((o.subtreeFlags&10256)!==0||!1),o=o.child;o!==null;){var b=a,R=o,O=d,V=m,X=R.flags;switch(R.tag){case 0:case 11:case 15:xr(b,R,O,V,v),Tl(8,R);break;case 23:break;case 22:var le=R.stateNode;R.memoizedState!==null?le._visibility&2?xr(b,R,O,V,v):Al(b,R):(le._visibility|=2,xr(b,R,O,V,v)),v&&X&2048&&lh(R.alternate,R);break;case 24:xr(b,R,O,V,v),v&&X&2048&&oh(R.alternate,R);break;default:xr(b,R,O,V,v)}o=o.sibling}}function Al(a,o){if(o.subtreeFlags&10256)for(o=o.child;o!==null;){var d=a,m=o,v=m.flags;switch(m.tag){case 22:Al(d,m),v&2048&&lh(m.alternate,m);break;case 24:Al(d,m),v&2048&&oh(m.alternate,m);break;default:Al(d,m)}o=o.sibling}}var Il=8192;function Sr(a,o,d){if(a.subtreeFlags&Il)for(a=a.child;a!==null;)r0(a,o,d),a=a.sibling}function r0(a,o,d){switch(a.tag){case 26:Sr(a,o,d),a.flags&Il&&a.memoizedState!==null&&YE(d,Gi,a.memoizedState,a.memoizedProps);break;case 5:Sr(a,o,d);break;case 3:case 4:var m=Gi;Gi=gc(a.stateNode.containerInfo),Sr(a,o,d),Gi=m;break;case 22:a.memoizedState===null&&(m=a.alternate,m!==null&&m.memoizedState!==null?(m=Il,Il=16777216,Sr(a,o,d),Il=m):Sr(a,o,d));break;default:Sr(a,o,d)}}function l0(a){var o=a.alternate;if(o!==null&&(a=o.child,a!==null)){o.child=null;do o=a.sibling,a.sibling=null,a=o;while(a!==null)}}function _l(a){var o=a.deletions;if((a.flags&16)!==0){if(o!==null)for(var d=0;d<o.length;d++){var m=o[d];ps=m,c0(m,a)}l0(a)}if(a.subtreeFlags&10256)for(a=a.child;a!==null;)o0(a),a=a.sibling}function o0(a){switch(a.tag){case 0:case 11:case 15:_l(a),a.flags&2048&&na(9,a,a.return);break;case 3:_l(a);break;case 12:_l(a);break;case 22:var o=a.stateNode;a.memoizedState!==null&&o._visibility&2&&(a.return===null||a.return.tag!==13)?(o._visibility&=-3,ic(a)):_l(a);break;default:_l(a)}}function ic(a){var o=a.deletions;if((a.flags&16)!==0){if(o!==null)for(var d=0;d<o.length;d++){var m=o[d];ps=m,c0(m,a)}l0(a)}for(a=a.child;a!==null;){switch(o=a,o.tag){case 0:case 11:case 15:na(8,o,o.return),ic(o);break;case 22:d=o.stateNode,d._visibility&2&&(d._visibility&=-3,ic(o));break;default:ic(o)}a=a.sibling}}function c0(a,o){for(;ps!==null;){var d=ps;switch(d.tag){case 0:case 11:case 15:na(8,d,o);break;case 23:case 22:if(d.memoizedState!==null&&d.memoizedState.cachePool!==null){var m=d.memoizedState.cachePool.pool;m!=null&&m.refCount++}break;case 24:cl(d.memoizedState.cache)}if(m=d.child,m!==null)m.return=d,ps=m;else e:for(d=a;ps!==null;){m=ps;var v=m.sibling,b=m.return;if(Jg(m),m===d){ps=null;break e}if(v!==null){v.return=b,ps=v;break e}ps=b}}}var oE={getCacheForType:function(a){var o=bs(as),d=o.data.get(a);return d===void 0&&(d=a(),o.data.set(a,d)),d},cacheSignal:function(){return bs(as).controller.signal}},cE=typeof WeakMap=="function"?WeakMap:Map,xt=0,Pt=null,rt=null,ot=0,It=0,ui=null,aa=!1,br=!1,ch=!1,On=0,Wt=0,ra=0,Va=0,uh=0,di=0,Tr=0,Rl=null,Qs=null,dh=!1,nc=0,u0=0,ac=1/0,rc=null,la=null,ds=0,oa=null,Er=null,kn=0,hh=0,fh=null,d0=null,Ll=0,mh=null;function hi(){return(xt&2)!==0&&ot!==0?ot&-ot:M.T!==null?Sh():is()}function h0(){if(di===0)if((ot&536870912)===0||dt){var a=Cs;Cs<<=1,(Cs&3932160)===0&&(Cs=262144),di=a}else di=536870912;return a=oi.current,a!==null&&(a.flags|=32),di}function Ws(a,o,d){(a===Pt&&(It===2||It===9)||a.cancelPendingCommit!==null)&&(Ar(a,0),ca(a,ot,di,!1)),us(a,d),((xt&2)===0||a!==Pt)&&(a===Pt&&((xt&2)===0&&(Va|=d),Wt===4&&ca(a,ot,di,!1)),en(a))}function f0(a,o,d){if((xt&6)!==0)throw Error(s(327));var m=!d&&(o&127)===0&&(o&a.expiredLanes)===0||Gs(a,o),v=m?hE(a,o):gh(a,o,!0),b=m;do{if(v===0){br&&!m&&ca(a,o,0,!1);break}else{if(d=a.current.alternate,b&&!uE(d)){v=gh(a,o,!1),b=!1;continue}if(v===2){if(b=o,a.errorRecoveryDisabledLanes&b)var R=0;else R=a.pendingLanes&-536870913,R=R!==0?R:R&536870912?536870912:0;if(R!==0){o=R;e:{var O=a;v=Rl;var V=O.current.memoizedState.isDehydrated;if(V&&(Ar(O,R).flags|=256),R=gh(O,R,!1),R!==2){if(ch&&!V){O.errorRecoveryDisabledLanes|=b,Va|=b,v=4;break e}b=Qs,Qs=v,b!==null&&(Qs===null?Qs=b:Qs.push.apply(Qs,b))}v=R}if(b=!1,v!==2)continue}}if(v===1){Ar(a,0),ca(a,o,0,!0);break}e:{switch(m=a,b=v,b){case 0:case 1:throw Error(s(345));case 4:if((o&4194048)!==o)break;case 6:ca(m,o,di,!aa);break e;case 2:Qs=null;break;case 3:case 5:break;default:throw Error(s(329))}if((o&62914560)===o&&(v=nc+300-nt(),10<v)){if(ca(m,o,di,!aa),Ns(m,0,!0)!==0)break e;kn=o,m.timeoutHandle=H0(m0.bind(null,m,d,Qs,rc,dh,o,di,Va,Tr,aa,b,"Throttled",-0,0),v);break e}m0(m,d,Qs,rc,dh,o,di,Va,Tr,aa,b,null,-0,0)}}break}while(!0);en(a)}function m0(a,o,d,m,v,b,R,O,V,X,le,pe,Z,ie){if(a.timeoutHandle=-1,pe=o.subtreeFlags,pe&8192||(pe&16785408)===16785408){pe={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:vn},r0(o,b,pe);var Pe=(b&62914560)===b?nc-nt():(b&4194048)===b?u0-nt():0;if(Pe=qE(pe,Pe),Pe!==null){kn=b,a.cancelPendingCommit=Pe(T0.bind(null,a,o,b,d,m,v,R,O,V,le,pe,null,Z,ie)),ca(a,b,R,!X);return}}T0(a,o,b,d,m,v,R,O,V)}function uE(a){for(var o=a;;){var d=o.tag;if((d===0||d===11||d===15)&&o.flags&16384&&(d=o.updateQueue,d!==null&&(d=d.stores,d!==null)))for(var m=0;m<d.length;m++){var v=d[m],b=v.getSnapshot;v=v.value;try{if(!ri(b(),v))return!1}catch{return!1}}if(d=o.child,o.subtreeFlags&16384&&d!==null)d.return=o,o=d;else{if(o===a)break;for(;o.sibling===null;){if(o.return===null||o.return===a)return!0;o=o.return}o.sibling.return=o.return,o=o.sibling}}return!0}function ca(a,o,d,m){o&=~uh,o&=~Va,a.suspendedLanes|=o,a.pingedLanes&=~o,m&&(a.warmLanes|=o),m=a.expirationTimes;for(var v=o;0<v;){var b=31-wt(v),R=1<<b;m[b]=-1,v&=~R}d!==0&&Fs(a,d,o)}function lc(){return(xt&6)===0?(wl(0),!1):!0}function ph(){if(rt!==null){if(It===0)var a=rt.return;else a=rt,Tn=Oa=null,Nd(a),mr=null,dl=0,a=rt;for(;a!==null;)zg(a.alternate,a),a=a.return;rt=null}}function Ar(a,o){var d=a.timeoutHandle;d!==-1&&(a.timeoutHandle=-1,CE(d)),d=a.cancelPendingCommit,d!==null&&(a.cancelPendingCommit=null,d()),kn=0,ph(),Pt=a,rt=d=Sn(a.current,null),ot=o,It=0,ui=null,aa=!1,br=Gs(a,o),ch=!1,Tr=di=uh=Va=ra=Wt=0,Qs=Rl=null,dh=!1,(o&8)!==0&&(o|=o&32);var m=a.entangledLanes;if(m!==0)for(a=a.entanglements,m&=o;0<m;){var v=31-wt(m),b=1<<v;o|=a[v],m&=~b}return On=o,Lo(),d}function p0(a,o){Xe=null,M.H=xl,o===fr||o===Uo?(o=Np(),It=3):o===xd?(o=Np(),It=4):It=o===Yd?8:o!==null&&typeof o=="object"&&typeof o.then=="function"?6:1,ui=o,rt===null&&(Wt=1,Wo(a,_i(o,a.current)))}function g0(){var a=oi.current;return a===null?!0:(ot&4194048)===ot?Ci===null:(ot&62914560)===ot||(ot&536870912)!==0?a===Ci:!1}function y0(){var a=M.H;return M.H=xl,a===null?xl:a}function v0(){var a=M.A;return M.A=oE,a}function oc(){Wt=4,aa||(ot&4194048)!==ot&&oi.current!==null||(br=!0),(ra&134217727)===0&&(Va&134217727)===0||Pt===null||ca(Pt,ot,di,!1)}function gh(a,o,d){var m=xt;xt|=2;var v=y0(),b=v0();(Pt!==a||ot!==o)&&(rc=null,Ar(a,o)),o=!1;var R=Wt;e:do try{if(It!==0&&rt!==null){var O=rt,V=ui;switch(It){case 8:ph(),R=6;break e;case 3:case 2:case 9:case 6:oi.current===null&&(o=!0);var X=It;if(It=0,ui=null,Ir(a,O,V,X),d&&br){R=0;break e}break;default:X=It,It=0,ui=null,Ir(a,O,V,X)}}dE(),R=Wt;break}catch(le){p0(a,le)}while(!0);return o&&a.shellSuspendCounter++,Tn=Oa=null,xt=m,M.H=v,M.A=b,rt===null&&(Pt=null,ot=0,Lo()),R}function dE(){for(;rt!==null;)x0(rt)}function hE(a,o){var d=xt;xt|=2;var m=y0(),v=v0();Pt!==a||ot!==o?(rc=null,ac=nt()+500,Ar(a,o)):br=Gs(a,o);e:do try{if(It!==0&&rt!==null){o=rt;var b=ui;t:switch(It){case 1:It=0,ui=null,Ir(a,o,b,1);break;case 2:case 9:if(wp(b)){It=0,ui=null,S0(o);break}o=function(){It!==2&&It!==9||Pt!==a||(It=7),en(a)},b.then(o,o);break e;case 3:It=7;break e;case 4:It=5;break e;case 7:wp(b)?(It=0,ui=null,S0(o)):(It=0,ui=null,Ir(a,o,b,7));break;case 5:var R=null;switch(rt.tag){case 26:R=rt.memoizedState;case 5:case 27:var O=rt;if(R?ay(R):O.stateNode.complete){It=0,ui=null;var V=O.sibling;if(V!==null)rt=V;else{var X=O.return;X!==null?(rt=X,cc(X)):rt=null}break t}}It=0,ui=null,Ir(a,o,b,5);break;case 6:It=0,ui=null,Ir(a,o,b,6);break;case 8:ph(),Wt=6;break e;default:throw Error(s(462))}}fE();break}catch(le){p0(a,le)}while(!0);return Tn=Oa=null,M.H=m,M.A=v,xt=d,rt!==null?0:(Pt=null,ot=0,Lo(),Wt)}function fE(){for(;rt!==null&&!He();)x0(rt)}function x0(a){var o=Gg(a.alternate,a,On);a.memoizedProps=a.pendingProps,o===null?cc(a):rt=o}function S0(a){var o=a,d=o.alternate;switch(o.tag){case 15:case 0:o=Mg(d,o,o.pendingProps,o.type,void 0,ot);break;case 11:o=Mg(d,o,o.pendingProps,o.type.render,o.ref,ot);break;case 5:Nd(o);default:zg(d,o),o=rt=vp(o,On),o=Gg(d,o,On)}a.memoizedProps=a.pendingProps,o===null?cc(a):rt=o}function Ir(a,o,d,m){Tn=Oa=null,Nd(o),mr=null,dl=0;var v=o.return;try{if(tE(a,v,o,d,ot)){Wt=1,Wo(a,_i(d,a.current)),rt=null;return}}catch(b){if(v!==null)throw rt=v,b;Wt=1,Wo(a,_i(d,a.current)),rt=null;return}o.flags&32768?(dt||m===1?a=!0:br||(ot&536870912)!==0?a=!1:(aa=a=!0,(m===2||m===9||m===3||m===6)&&(m=oi.current,m!==null&&m.tag===13&&(m.flags|=16384))),b0(o,a)):cc(o)}function cc(a){var o=a;do{if((o.flags&32768)!==0){b0(o,aa);return}a=o.return;var d=nE(o.alternate,o,On);if(d!==null){rt=d;return}if(o=o.sibling,o!==null){rt=o;return}rt=o=a}while(o!==null);Wt===0&&(Wt=5)}function b0(a,o){do{var d=aE(a.alternate,a);if(d!==null){d.flags&=32767,rt=d;return}if(d=a.return,d!==null&&(d.flags|=32768,d.subtreeFlags=0,d.deletions=null),!o&&(a=a.sibling,a!==null)){rt=a;return}rt=a=d}while(a!==null);Wt=6,rt=null}function T0(a,o,d,m,v,b,R,O,V){a.cancelPendingCommit=null;do uc();while(ds!==0);if((xt&6)!==0)throw Error(s(327));if(o!==null){if(o===a.current)throw Error(s(177));if(b=o.lanes|o.childLanes,b|=nd,Os(a,d,b,R,O,V),a===Pt&&(rt=Pt=null,ot=0),Er=o,oa=a,kn=d,hh=b,fh=v,d0=m,(o.subtreeFlags&10256)!==0||(o.flags&10256)!==0?(a.callbackNode=null,a.callbackPriority=0,yE(st,function(){return R0(),null})):(a.callbackNode=null,a.callbackPriority=0),m=(o.flags&13878)!==0,(o.subtreeFlags&13878)!==0||m){m=M.T,M.T=null,v=$.p,$.p=2,R=xt,xt|=4;try{rE(a,o,d)}finally{xt=R,$.p=v,M.T=m}}ds=1,E0(),A0(),I0()}}function E0(){if(ds===1){ds=0;var a=oa,o=Er,d=(o.flags&13878)!==0;if((o.subtreeFlags&13878)!==0||d){d=M.T,M.T=null;var m=$.p;$.p=2;var v=xt;xt|=4;try{i0(o,a);var b=Lh,R=cp(a.containerInfo),O=b.focusedElem,V=b.selectionRange;if(R!==O&&O&&O.ownerDocument&&op(O.ownerDocument.documentElement,O)){if(V!==null&&Ju(O)){var X=V.start,le=V.end;if(le===void 0&&(le=X),"selectionStart"in O)O.selectionStart=X,O.selectionEnd=Math.min(le,O.value.length);else{var pe=O.ownerDocument||document,Z=pe&&pe.defaultView||window;if(Z.getSelection){var ie=Z.getSelection(),Pe=O.textContent.length,$e=Math.min(V.start,Pe),kt=V.end===void 0?$e:Math.min(V.end,Pe);!ie.extend&&$e>kt&&(R=kt,kt=$e,$e=R);var Y=lp(O,$e),z=lp(O,kt);if(Y&&z&&(ie.rangeCount!==1||ie.anchorNode!==Y.node||ie.anchorOffset!==Y.offset||ie.focusNode!==z.node||ie.focusOffset!==z.offset)){var W=pe.createRange();W.setStart(Y.node,Y.offset),ie.removeAllRanges(),$e>kt?(ie.addRange(W),ie.extend(z.node,z.offset)):(W.setEnd(z.node,z.offset),ie.addRange(W))}}}}for(pe=[],ie=O;ie=ie.parentNode;)ie.nodeType===1&&pe.push({element:ie,left:ie.scrollLeft,top:ie.scrollTop});for(typeof O.focus=="function"&&O.focus(),O=0;O<pe.length;O++){var he=pe[O];he.element.scrollLeft=he.left,he.element.scrollTop=he.top}}Tc=!!Rh,Lh=Rh=null}finally{xt=v,$.p=m,M.T=d}}a.current=o,ds=2}}function A0(){if(ds===2){ds=0;var a=oa,o=Er,d=(o.flags&8772)!==0;if((o.subtreeFlags&8772)!==0||d){d=M.T,M.T=null;var m=$.p;$.p=2;var v=xt;xt|=4;try{Zg(a,o.alternate,o)}finally{xt=v,$.p=m,M.T=d}}ds=3}}function I0(){if(ds===4||ds===3){ds=0,pt();var a=oa,o=Er,d=kn,m=d0;(o.subtreeFlags&10256)!==0||(o.flags&10256)!==0?ds=5:(ds=0,Er=oa=null,_0(a,a.pendingLanes));var v=a.pendingLanes;if(v===0&&(la=null),Je(d),o=o.stateNode,Bt&&typeof Bt.onCommitFiberRoot=="function")try{Bt.onCommitFiberRoot(js,o,void 0,(o.current.flags&128)===128)}catch{}if(m!==null){o=M.T,v=$.p,$.p=2,M.T=null;try{for(var b=a.onRecoverableError,R=0;R<m.length;R++){var O=m[R];b(O.value,{componentStack:O.stack})}}finally{M.T=o,$.p=v}}(kn&3)!==0&&uc(),en(a),v=a.pendingLanes,(d&261930)!==0&&(v&42)!==0?a===mh?Ll++:(Ll=0,mh=a):Ll=0,wl(0)}}function _0(a,o){(a.pooledCacheLanes&=o)===0&&(o=a.pooledCache,o!=null&&(a.pooledCache=null,cl(o)))}function uc(){return E0(),A0(),I0(),R0()}function R0(){if(ds!==5)return!1;var a=oa,o=hh;hh=0;var d=Je(kn),m=M.T,v=$.p;try{$.p=32>d?32:d,M.T=null,d=fh,fh=null;var b=oa,R=kn;if(ds=0,Er=oa=null,kn=0,(xt&6)!==0)throw Error(s(331));var O=xt;if(xt|=4,o0(b.current),a0(b,b.current,R,d),xt=O,wl(0,!1),Bt&&typeof Bt.onPostCommitFiberRoot=="function")try{Bt.onPostCommitFiberRoot(js,b)}catch{}return!0}finally{$.p=v,M.T=m,_0(a,o)}}function L0(a,o,d){o=_i(d,o),o=Kd(a.stateNode,o,2),a=ta(a,o,2),a!==null&&(us(a,2),en(a))}function _t(a,o,d){if(a.tag===3)L0(a,a,d);else for(;o!==null;){if(o.tag===3){L0(o,a,d);break}else if(o.tag===1){var m=o.stateNode;if(typeof o.type.getDerivedStateFromError=="function"||typeof m.componentDidCatch=="function"&&(la===null||!la.has(m))){a=_i(d,a),d=wg(2),m=ta(o,d,2),m!==null&&(Cg(d,m,o,a),us(m,2),en(m));break}}o=o.return}}function yh(a,o,d){var m=a.pingCache;if(m===null){m=a.pingCache=new cE;var v=new Set;m.set(o,v)}else v=m.get(o),v===void 0&&(v=new Set,m.set(o,v));v.has(d)||(ch=!0,v.add(d),a=mE.bind(null,a,o,d),o.then(a,a))}function mE(a,o,d){var m=a.pingCache;m!==null&&m.delete(o),a.pingedLanes|=a.suspendedLanes&d,a.warmLanes&=~d,Pt===a&&(ot&d)===d&&(Wt===4||Wt===3&&(ot&62914560)===ot&&300>nt()-nc?(xt&2)===0&&Ar(a,0):uh|=d,Tr===ot&&(Tr=0)),en(a)}function w0(a,o){o===0&&(o=Qi()),a=wa(a,o),a!==null&&(us(a,o),en(a))}function pE(a){var o=a.memoizedState,d=0;o!==null&&(d=o.retryLane),w0(a,d)}function gE(a,o){var d=0;switch(a.tag){case 31:case 13:var m=a.stateNode,v=a.memoizedState;v!==null&&(d=v.retryLane);break;case 19:m=a.stateNode;break;case 22:m=a.stateNode._retryCache;break;default:throw Error(s(314))}m!==null&&m.delete(o),w0(a,d)}function yE(a,o){return ht(a,o)}var dc=null,_r=null,vh=!1,hc=!1,xh=!1,ua=0;function en(a){a!==_r&&a.next===null&&(_r===null?dc=_r=a:_r=_r.next=a),hc=!0,vh||(vh=!0,xE())}function wl(a,o){if(!xh&&hc){xh=!0;do for(var d=!1,m=dc;m!==null;){if(a!==0){var v=m.pendingLanes;if(v===0)var b=0;else{var R=m.suspendedLanes,O=m.pingedLanes;b=(1<<31-wt(42|a)+1)-1,b&=v&~(R&~O),b=b&201326741?b&201326741|1:b?b|2:0}b!==0&&(d=!0,k0(m,b))}else b=ot,b=Ns(m,m===Pt?b:0,m.cancelPendingCommit!==null||m.timeoutHandle!==-1),(b&3)===0||Gs(m,b)||(d=!0,k0(m,b));m=m.next}while(d);xh=!1}}function vE(){C0()}function C0(){hc=vh=!1;var a=0;ua!==0&&wE()&&(a=ua);for(var o=nt(),d=null,m=dc;m!==null;){var v=m.next,b=N0(m,o);b===0?(m.next=null,d===null?dc=v:d.next=v,v===null&&(_r=d)):(d=m,(a!==0||(b&3)!==0)&&(hc=!0)),m=v}ds!==0&&ds!==5||wl(a),ua!==0&&(ua=0)}function N0(a,o){for(var d=a.suspendedLanes,m=a.pingedLanes,v=a.expirationTimes,b=a.pendingLanes&-62914561;0<b;){var R=31-wt(b),O=1<<R,V=v[R];V===-1?((O&d)===0||(O&m)!==0)&&(v[R]=ai(O,o)):V<=o&&(a.expiredLanes|=O),b&=~O}if(o=Pt,d=ot,d=Ns(a,a===o?d:0,a.cancelPendingCommit!==null||a.timeoutHandle!==-1),m=a.callbackNode,d===0||a===o&&(It===2||It===9)||a.cancelPendingCommit!==null)return m!==null&&m!==null&&Oe(m),a.callbackNode=null,a.callbackPriority=0;if((d&3)===0||Gs(a,d)){if(o=d&-d,o===a.callbackPriority)return o;switch(m!==null&&Oe(m),Je(d)){case 2:case 8:d=Qe;break;case 32:d=st;break;case 268435456:d=Rs;break;default:d=st}return m=O0.bind(null,a),d=ht(d,m),a.callbackPriority=o,a.callbackNode=d,o}return m!==null&&m!==null&&Oe(m),a.callbackPriority=2,a.callbackNode=null,2}function O0(a,o){if(ds!==0&&ds!==5)return a.callbackNode=null,a.callbackPriority=0,null;var d=a.callbackNode;if(uc()&&a.callbackNode!==d)return null;var m=ot;return m=Ns(a,a===Pt?m:0,a.cancelPendingCommit!==null||a.timeoutHandle!==-1),m===0?null:(f0(a,m,o),N0(a,nt()),a.callbackNode!=null&&a.callbackNode===d?O0.bind(null,a):null)}function k0(a,o){if(uc())return null;f0(a,o,!0)}function xE(){NE(function(){(xt&6)!==0?ht(ge,vE):C0()})}function Sh(){if(ua===0){var a=dr;a===0&&(a=ws,ws<<=1,(ws&261888)===0&&(ws=256)),ua=a}return ua}function D0(a){return a==null||typeof a=="symbol"||typeof a=="boolean"?null:typeof a=="function"?a:So(""+a)}function P0(a,o){var d=o.ownerDocument.createElement("input");return d.name=o.name,d.value=o.value,a.id&&d.setAttribute("form",a.id),o.parentNode.insertBefore(d,o),a=new FormData(a),d.parentNode.removeChild(d),a}function SE(a,o,d,m,v){if(o==="submit"&&d&&d.stateNode===v){var b=D0((v[gt]||null).action),R=m.submitter;R&&(o=(o=R[gt]||null)?D0(o.formAction):R.getAttribute("formAction"),o!==null&&(b=o,R=null));var O=new Ao("action","action",null,m,v);a.push({event:O,listeners:[{instance:null,listener:function(){if(m.defaultPrevented){if(ua!==0){var V=R?P0(v,R):new FormData(v);Fd(d,{pending:!0,data:V,method:v.method,action:b},null,V)}}else typeof b=="function"&&(O.preventDefault(),V=R?P0(v,R):new FormData(v),Fd(d,{pending:!0,data:V,method:v.method,action:b},b,V))},currentTarget:v}]})}}for(var bh=0;bh<id.length;bh++){var Th=id[bh],bE=Th.toLowerCase(),TE=Th[0].toUpperCase()+Th.slice(1);$i(bE,"on"+TE)}$i(hp,"onAnimationEnd"),$i(fp,"onAnimationIteration"),$i(mp,"onAnimationStart"),$i("dblclick","onDoubleClick"),$i("focusin","onFocus"),$i("focusout","onBlur"),$i(jT,"onTransitionRun"),$i(BT,"onTransitionStart"),$i(FT,"onTransitionCancel"),$i(pp,"onTransitionEnd"),Kn("onMouseEnter",["mouseout","mouseover"]),Kn("onMouseLeave",["mouseout","mouseover"]),Kn("onPointerEnter",["pointerout","pointerover"]),Kn("onPointerLeave",["pointerout","pointerover"]),pn("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),pn("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),pn("onBeforeInput",["compositionend","keypress","textInput","paste"]),pn("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),pn("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),pn("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Cl="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),EE=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Cl));function U0(a,o){o=(o&4)!==0;for(var d=0;d<a.length;d++){var m=a[d],v=m.event;m=m.listeners;e:{var b=void 0;if(o)for(var R=m.length-1;0<=R;R--){var O=m[R],V=O.instance,X=O.currentTarget;if(O=O.listener,V!==b&&v.isPropagationStopped())break e;b=O,v.currentTarget=X;try{b(v)}catch(le){Ro(le)}v.currentTarget=null,b=V}else for(R=0;R<m.length;R++){if(O=m[R],V=O.instance,X=O.currentTarget,O=O.listener,V!==b&&v.isPropagationStopped())break e;b=O,v.currentTarget=X;try{b(v)}catch(le){Ro(le)}v.currentTarget=null,b=V}}}}function lt(a,o){var d=o[Ei];d===void 0&&(d=o[Ei]=new Set);var m=a+"__bubble";d.has(m)||(M0(o,a,2,!1),d.add(m))}function Eh(a,o,d){var m=0;o&&(m|=4),M0(d,a,m,o)}var fc="_reactListening"+Math.random().toString(36).slice(2);function Ah(a){if(!a[fc]){a[fc]=!0,fo.forEach(function(d){d!=="selectionchange"&&(EE.has(d)||Eh(d,!1,a),Eh(d,!0,a))});var o=a.nodeType===9?a:a.ownerDocument;o===null||o[fc]||(o[fc]=!0,Eh("selectionchange",!1,o))}}function M0(a,o,d,m){switch(hy(o)){case 2:var v=XE;break;case 8:v=ZE;break;default:v=Bh}d=v.bind(null,o,d,a),v=void 0,!Hu||o!=="touchstart"&&o!=="touchmove"&&o!=="wheel"||(v=!0),m?v!==void 0?a.addEventListener(o,d,{capture:!0,passive:v}):a.addEventListener(o,d,!0):v!==void 0?a.addEventListener(o,d,{passive:v}):a.addEventListener(o,d,!1)}function Ih(a,o,d,m,v){var b=m;if((o&1)===0&&(o&2)===0&&m!==null)e:for(;;){if(m===null)return;var R=m.tag;if(R===3||R===4){var O=m.stateNode.containerInfo;if(O===v)break;if(R===4)for(R=m.return;R!==null;){var V=R.tag;if((V===3||V===4)&&R.stateNode.containerInfo===v)return;R=R.return}for(;O!==null;){if(R=Hn(O),R===null)return;if(V=R.tag,V===5||V===6||V===26||V===27){m=b=R;continue e}O=O.parentNode}}m=m.return}$m(function(){var X=b,le=$u(d),pe=[];e:{var Z=gp.get(a);if(Z!==void 0){var ie=Ao,Pe=a;switch(a){case"keypress":if(To(d)===0)break e;case"keydown":case"keyup":ie=gT;break;case"focusin":Pe="focus",ie=qu;break;case"focusout":Pe="blur",ie=qu;break;case"beforeblur":case"afterblur":ie=qu;break;case"click":if(d.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ie=zm;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ie=nT;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ie=xT;break;case hp:case fp:case mp:ie=lT;break;case pp:ie=bT;break;case"scroll":case"scrollend":ie=sT;break;case"wheel":ie=ET;break;case"copy":case"cut":case"paste":ie=cT;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ie=Ym;break;case"toggle":case"beforetoggle":ie=IT}var $e=(o&4)!==0,kt=!$e&&(a==="scroll"||a==="scrollend"),Y=$e?Z!==null?Z+"Capture":null:Z;$e=[];for(var z=X,W;z!==null;){var he=z;if(W=he.stateNode,he=he.tag,he!==5&&he!==26&&he!==27||W===null||Y===null||(he=Zr(z,Y),he!=null&&$e.push(Nl(z,he,W))),kt)break;z=z.return}0<$e.length&&(Z=new ie(Z,Pe,null,d,le),pe.push({event:Z,listeners:$e}))}}if((o&7)===0){e:{if(Z=a==="mouseover"||a==="pointerover",ie=a==="mouseout"||a==="pointerout",Z&&d!==Vu&&(Pe=d.relatedTarget||d.fromElement)&&(Hn(Pe)||Pe[Fi]))break e;if((ie||Z)&&(Z=le.window===le?le:(Z=le.ownerDocument)?Z.defaultView||Z.parentWindow:window,ie?(Pe=d.relatedTarget||d.toElement,ie=X,Pe=Pe?Hn(Pe):null,Pe!==null&&(kt=r(Pe),$e=Pe.tag,Pe!==kt||$e!==5&&$e!==27&&$e!==6)&&(Pe=null)):(ie=null,Pe=X),ie!==Pe)){if($e=zm,he="onMouseLeave",Y="onMouseEnter",z="mouse",(a==="pointerout"||a==="pointerover")&&($e=Ym,he="onPointerLeave",Y="onPointerEnter",z="pointer"),kt=ie==null?Z:Ia(ie),W=Pe==null?Z:Ia(Pe),Z=new $e(he,z+"leave",ie,d,le),Z.target=kt,Z.relatedTarget=W,he=null,Hn(le)===X&&($e=new $e(Y,z+"enter",Pe,d,le),$e.target=W,$e.relatedTarget=kt,he=$e),kt=he,ie&&Pe)t:{for($e=AE,Y=ie,z=Pe,W=0,he=Y;he;he=$e(he))W++;he=0;for(var Ve=z;Ve;Ve=$e(Ve))he++;for(;0<W-he;)Y=$e(Y),W--;for(;0<he-W;)z=$e(z),he--;for(;W--;){if(Y===z||z!==null&&Y===z.alternate){$e=Y;break t}Y=$e(Y),z=$e(z)}$e=null}else $e=null;ie!==null&&j0(pe,Z,ie,$e,!1),Pe!==null&&kt!==null&&j0(pe,kt,Pe,$e,!0)}}e:{if(Z=X?Ia(X):window,ie=Z.nodeName&&Z.nodeName.toLowerCase(),ie==="select"||ie==="input"&&Z.type==="file")var yt=tp;else if(Jm(Z))if(sp)yt=PT;else{yt=kT;var je=OT}else ie=Z.nodeName,!ie||ie.toLowerCase()!=="input"||Z.type!=="checkbox"&&Z.type!=="radio"?X&&Fu(X.elementType)&&(yt=tp):yt=DT;if(yt&&(yt=yt(a,X))){ep(pe,yt,d,le);break e}je&&je(a,Z,X),a==="focusout"&&X&&Z.type==="number"&&X.memoizedProps.value!=null&&Ja(Z,"number",Z.value)}switch(je=X?Ia(X):window,a){case"focusin":(Jm(je)||je.contentEditable==="true")&&(ir=je,ed=X,rl=null);break;case"focusout":rl=ed=ir=null;break;case"mousedown":td=!0;break;case"contextmenu":case"mouseup":case"dragend":td=!1,up(pe,d,le);break;case"selectionchange":if(MT)break;case"keydown":case"keyup":up(pe,d,le)}var tt;if(Wu)e:{switch(a){case"compositionstart":var ct="onCompositionStart";break e;case"compositionend":ct="onCompositionEnd";break e;case"compositionupdate":ct="onCompositionUpdate";break e}ct=void 0}else sr?Xm(a,d)&&(ct="onCompositionEnd"):a==="keydown"&&d.keyCode===229&&(ct="onCompositionStart");ct&&(qm&&d.locale!=="ko"&&(sr||ct!=="onCompositionStart"?ct==="onCompositionEnd"&&sr&&(tt=Gm()):(qn=le,zu="value"in qn?qn.value:qn.textContent,sr=!0)),je=mc(X,ct),0<je.length&&(ct=new Km(ct,a,null,d,le),pe.push({event:ct,listeners:je}),tt?ct.data=tt:(tt=Zm(d),tt!==null&&(ct.data=tt)))),(tt=RT?LT(a,d):wT(a,d))&&(ct=mc(X,"onBeforeInput"),0<ct.length&&(je=new Km("onBeforeInput","beforeinput",null,d,le),pe.push({event:je,listeners:ct}),je.data=tt)),SE(pe,a,X,d,le)}U0(pe,o)})}function Nl(a,o,d){return{instance:a,listener:o,currentTarget:d}}function mc(a,o){for(var d=o+"Capture",m=[];a!==null;){var v=a,b=v.stateNode;if(v=v.tag,v!==5&&v!==26&&v!==27||b===null||(v=Zr(a,d),v!=null&&m.unshift(Nl(a,v,b)),v=Zr(a,o),v!=null&&m.push(Nl(a,v,b))),a.tag===3)return m;a=a.return}return[]}function AE(a){if(a===null)return null;do a=a.return;while(a&&a.tag!==5&&a.tag!==27);return a||null}function j0(a,o,d,m,v){for(var b=o._reactName,R=[];d!==null&&d!==m;){var O=d,V=O.alternate,X=O.stateNode;if(O=O.tag,V!==null&&V===m)break;O!==5&&O!==26&&O!==27||X===null||(V=X,v?(X=Zr(d,b),X!=null&&R.unshift(Nl(d,X,V))):v||(X=Zr(d,b),X!=null&&R.push(Nl(d,X,V)))),d=d.return}R.length!==0&&a.push({event:o,listeners:R})}var IE=/\r\n?/g,_E=/\u0000|\uFFFD/g;function B0(a){return(typeof a=="string"?a:""+a).replace(IE,`
`).replace(_E,"")}function F0(a,o){return o=B0(o),B0(a)===o}function Ot(a,o,d,m,v,b){switch(d){case"children":typeof m=="string"?o==="body"||o==="textarea"&&m===""||yn(a,m):(typeof m=="number"||typeof m=="bigint")&&o!=="body"&&yn(a,""+m);break;case"className":Yn(a,"class",m);break;case"tabIndex":Yn(a,"tabindex",m);break;case"dir":case"role":case"viewBox":case"width":case"height":Yn(a,d,m);break;case"style":xo(a,m,b);break;case"data":if(o!=="object"){Yn(a,"data",m);break}case"src":case"href":if(m===""&&(o!=="a"||d!=="href")){a.removeAttribute(d);break}if(m==null||typeof m=="function"||typeof m=="symbol"||typeof m=="boolean"){a.removeAttribute(d);break}m=So(""+m),a.setAttribute(d,m);break;case"action":case"formAction":if(typeof m=="function"){a.setAttribute(d,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof b=="function"&&(d==="formAction"?(o!=="input"&&Ot(a,o,"name",v.name,v,null),Ot(a,o,"formEncType",v.formEncType,v,null),Ot(a,o,"formMethod",v.formMethod,v,null),Ot(a,o,"formTarget",v.formTarget,v,null)):(Ot(a,o,"encType",v.encType,v,null),Ot(a,o,"method",v.method,v,null),Ot(a,o,"target",v.target,v,null)));if(m==null||typeof m=="symbol"||typeof m=="boolean"){a.removeAttribute(d);break}m=So(""+m),a.setAttribute(d,m);break;case"onClick":m!=null&&(a.onclick=vn);break;case"onScroll":m!=null&&lt("scroll",a);break;case"onScrollEnd":m!=null&&lt("scrollend",a);break;case"dangerouslySetInnerHTML":if(m!=null){if(typeof m!="object"||!("__html"in m))throw Error(s(61));if(d=m.__html,d!=null){if(v.children!=null)throw Error(s(60));a.innerHTML=d}}break;case"multiple":a.multiple=m&&typeof m!="function"&&typeof m!="symbol";break;case"muted":a.muted=m&&typeof m!="function"&&typeof m!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(m==null||typeof m=="function"||typeof m=="boolean"||typeof m=="symbol"){a.removeAttribute("xlink:href");break}d=So(""+m),a.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",d);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":m!=null&&typeof m!="function"&&typeof m!="symbol"?a.setAttribute(d,""+m):a.removeAttribute(d);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":m&&typeof m!="function"&&typeof m!="symbol"?a.setAttribute(d,""):a.removeAttribute(d);break;case"capture":case"download":m===!0?a.setAttribute(d,""):m!==!1&&m!=null&&typeof m!="function"&&typeof m!="symbol"?a.setAttribute(d,m):a.removeAttribute(d);break;case"cols":case"rows":case"size":case"span":m!=null&&typeof m!="function"&&typeof m!="symbol"&&!isNaN(m)&&1<=m?a.setAttribute(d,m):a.removeAttribute(d);break;case"rowSpan":case"start":m==null||typeof m=="function"||typeof m=="symbol"||isNaN(m)?a.removeAttribute(d):a.setAttribute(d,m);break;case"popover":lt("beforetoggle",a),lt("toggle",a),Za(a,"popover",m);break;case"xlinkActuate":Vi(a,"http://www.w3.org/1999/xlink","xlink:actuate",m);break;case"xlinkArcrole":Vi(a,"http://www.w3.org/1999/xlink","xlink:arcrole",m);break;case"xlinkRole":Vi(a,"http://www.w3.org/1999/xlink","xlink:role",m);break;case"xlinkShow":Vi(a,"http://www.w3.org/1999/xlink","xlink:show",m);break;case"xlinkTitle":Vi(a,"http://www.w3.org/1999/xlink","xlink:title",m);break;case"xlinkType":Vi(a,"http://www.w3.org/1999/xlink","xlink:type",m);break;case"xmlBase":Vi(a,"http://www.w3.org/XML/1998/namespace","xml:base",m);break;case"xmlLang":Vi(a,"http://www.w3.org/XML/1998/namespace","xml:lang",m);break;case"xmlSpace":Vi(a,"http://www.w3.org/XML/1998/namespace","xml:space",m);break;case"is":Za(a,"is",m);break;case"innerText":case"textContent":break;default:(!(2<d.length)||d[0]!=="o"&&d[0]!=="O"||d[1]!=="n"&&d[1]!=="N")&&(d=eT.get(d)||d,Za(a,d,m))}}function _h(a,o,d,m,v,b){switch(d){case"style":xo(a,m,b);break;case"dangerouslySetInnerHTML":if(m!=null){if(typeof m!="object"||!("__html"in m))throw Error(s(61));if(d=m.__html,d!=null){if(v.children!=null)throw Error(s(60));a.innerHTML=d}}break;case"children":typeof m=="string"?yn(a,m):(typeof m=="number"||typeof m=="bigint")&&yn(a,""+m);break;case"onScroll":m!=null&&lt("scroll",a);break;case"onScrollEnd":m!=null&&lt("scrollend",a);break;case"onClick":m!=null&&(a.onclick=vn);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!mo.hasOwnProperty(d))e:{if(d[0]==="o"&&d[1]==="n"&&(v=d.endsWith("Capture"),o=d.slice(2,v?d.length-7:void 0),b=a[gt]||null,b=b!=null?b[d]:null,typeof b=="function"&&a.removeEventListener(o,b,v),typeof m=="function")){typeof b!="function"&&b!==null&&(d in a?a[d]=null:a.hasAttribute(d)&&a.removeAttribute(d)),a.addEventListener(o,m,v);break e}d in a?a[d]=m:m===!0?a.setAttribute(d,""):Za(a,d,m)}}}function Es(a,o,d){switch(o){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":lt("error",a),lt("load",a);var m=!1,v=!1,b;for(b in d)if(d.hasOwnProperty(b)){var R=d[b];if(R!=null)switch(b){case"src":m=!0;break;case"srcSet":v=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(s(137,o));default:Ot(a,o,b,R,d,null)}}v&&Ot(a,o,"srcSet",d.srcSet,d,null),m&&Ot(a,o,"src",d.src,d,null);return;case"input":lt("invalid",a);var O=b=R=v=null,V=null,X=null;for(m in d)if(d.hasOwnProperty(m)){var le=d[m];if(le!=null)switch(m){case"name":v=le;break;case"type":R=le;break;case"checked":V=le;break;case"defaultChecked":X=le;break;case"value":b=le;break;case"defaultValue":O=le;break;case"children":case"dangerouslySetInnerHTML":if(le!=null)throw Error(s(137,o));break;default:Ot(a,o,m,le,d,null)}}xs(a,b,O,V,X,R,v,!1);return;case"select":lt("invalid",a),m=R=b=null;for(v in d)if(d.hasOwnProperty(v)&&(O=d[v],O!=null))switch(v){case"value":b=O;break;case"defaultValue":R=O;break;case"multiple":m=O;default:Ot(a,o,v,O,d,null)}o=b,d=R,a.multiple=!!m,o!=null?gn(a,!!m,o,!1):d!=null&&gn(a,!!m,d,!0);return;case"textarea":lt("invalid",a),b=v=m=null;for(R in d)if(d.hasOwnProperty(R)&&(O=d[R],O!=null))switch(R){case"value":m=O;break;case"defaultValue":v=O;break;case"children":b=O;break;case"dangerouslySetInnerHTML":if(O!=null)throw Error(s(91));break;default:Ot(a,o,R,O,d,null)}yo(a,m,v,b);return;case"option":for(V in d)d.hasOwnProperty(V)&&(m=d[V],m!=null)&&(V==="selected"?a.selected=m&&typeof m!="function"&&typeof m!="symbol":Ot(a,o,V,m,d,null));return;case"dialog":lt("beforetoggle",a),lt("toggle",a),lt("cancel",a),lt("close",a);break;case"iframe":case"object":lt("load",a);break;case"video":case"audio":for(m=0;m<Cl.length;m++)lt(Cl[m],a);break;case"image":lt("error",a),lt("load",a);break;case"details":lt("toggle",a);break;case"embed":case"source":case"link":lt("error",a),lt("load",a);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(X in d)if(d.hasOwnProperty(X)&&(m=d[X],m!=null))switch(X){case"children":case"dangerouslySetInnerHTML":throw Error(s(137,o));default:Ot(a,o,X,m,d,null)}return;default:if(Fu(o)){for(le in d)d.hasOwnProperty(le)&&(m=d[le],m!==void 0&&_h(a,o,le,m,d,void 0));return}}for(O in d)d.hasOwnProperty(O)&&(m=d[O],m!=null&&Ot(a,o,O,m,d,null))}function RE(a,o,d,m){switch(o){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var v=null,b=null,R=null,O=null,V=null,X=null,le=null;for(ie in d){var pe=d[ie];if(d.hasOwnProperty(ie)&&pe!=null)switch(ie){case"checked":break;case"value":break;case"defaultValue":V=pe;default:m.hasOwnProperty(ie)||Ot(a,o,ie,null,m,pe)}}for(var Z in m){var ie=m[Z];if(pe=d[Z],m.hasOwnProperty(Z)&&(ie!=null||pe!=null))switch(Z){case"type":b=ie;break;case"name":v=ie;break;case"checked":X=ie;break;case"defaultChecked":le=ie;break;case"value":R=ie;break;case"defaultValue":O=ie;break;case"children":case"dangerouslySetInnerHTML":if(ie!=null)throw Error(s(137,o));break;default:ie!==pe&&Ot(a,o,Z,ie,m,pe)}}Wi(a,R,O,V,X,le,b,v);return;case"select":ie=R=O=Z=null;for(b in d)if(V=d[b],d.hasOwnProperty(b)&&V!=null)switch(b){case"value":break;case"multiple":ie=V;default:m.hasOwnProperty(b)||Ot(a,o,b,null,m,V)}for(v in m)if(b=m[v],V=d[v],m.hasOwnProperty(v)&&(b!=null||V!=null))switch(v){case"value":Z=b;break;case"defaultValue":O=b;break;case"multiple":R=b;default:b!==V&&Ot(a,o,v,b,m,V)}o=O,d=R,m=ie,Z!=null?gn(a,!!d,Z,!1):!!m!=!!d&&(o!=null?gn(a,!!d,o,!0):gn(a,!!d,d?[]:"",!1));return;case"textarea":ie=Z=null;for(O in d)if(v=d[O],d.hasOwnProperty(O)&&v!=null&&!m.hasOwnProperty(O))switch(O){case"value":break;case"children":break;default:Ot(a,o,O,null,m,v)}for(R in m)if(v=m[R],b=d[R],m.hasOwnProperty(R)&&(v!=null||b!=null))switch(R){case"value":Z=v;break;case"defaultValue":ie=v;break;case"children":break;case"dangerouslySetInnerHTML":if(v!=null)throw Error(s(91));break;default:v!==b&&Ot(a,o,R,v,m,b)}Xr(a,Z,ie);return;case"option":for(var Pe in d)Z=d[Pe],d.hasOwnProperty(Pe)&&Z!=null&&!m.hasOwnProperty(Pe)&&(Pe==="selected"?a.selected=!1:Ot(a,o,Pe,null,m,Z));for(V in m)Z=m[V],ie=d[V],m.hasOwnProperty(V)&&Z!==ie&&(Z!=null||ie!=null)&&(V==="selected"?a.selected=Z&&typeof Z!="function"&&typeof Z!="symbol":Ot(a,o,V,Z,m,ie));return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var $e in d)Z=d[$e],d.hasOwnProperty($e)&&Z!=null&&!m.hasOwnProperty($e)&&Ot(a,o,$e,null,m,Z);for(X in m)if(Z=m[X],ie=d[X],m.hasOwnProperty(X)&&Z!==ie&&(Z!=null||ie!=null))switch(X){case"children":case"dangerouslySetInnerHTML":if(Z!=null)throw Error(s(137,o));break;default:Ot(a,o,X,Z,m,ie)}return;default:if(Fu(o)){for(var kt in d)Z=d[kt],d.hasOwnProperty(kt)&&Z!==void 0&&!m.hasOwnProperty(kt)&&_h(a,o,kt,void 0,m,Z);for(le in m)Z=m[le],ie=d[le],!m.hasOwnProperty(le)||Z===ie||Z===void 0&&ie===void 0||_h(a,o,le,Z,m,ie);return}}for(var Y in d)Z=d[Y],d.hasOwnProperty(Y)&&Z!=null&&!m.hasOwnProperty(Y)&&Ot(a,o,Y,null,m,Z);for(pe in m)Z=m[pe],ie=d[pe],!m.hasOwnProperty(pe)||Z===ie||Z==null&&ie==null||Ot(a,o,pe,Z,m,ie)}function V0(a){switch(a){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function LE(){if(typeof performance.getEntriesByType=="function"){for(var a=0,o=0,d=performance.getEntriesByType("resource"),m=0;m<d.length;m++){var v=d[m],b=v.transferSize,R=v.initiatorType,O=v.duration;if(b&&O&&V0(R)){for(R=0,O=v.responseEnd,m+=1;m<d.length;m++){var V=d[m],X=V.startTime;if(X>O)break;var le=V.transferSize,pe=V.initiatorType;le&&V0(pe)&&(V=V.responseEnd,R+=le*(V<O?1:(O-X)/(V-X)))}if(--m,o+=8*(b+R)/(v.duration/1e3),a++,10<a)break}}if(0<a)return o/a/1e6}return navigator.connection&&(a=navigator.connection.downlink,typeof a=="number")?a:5}var Rh=null,Lh=null;function pc(a){return a.nodeType===9?a:a.ownerDocument}function $0(a){switch(a){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function G0(a,o){if(a===0)switch(o){case"svg":return 1;case"math":return 2;default:return 0}return a===1&&o==="foreignObject"?0:a}function wh(a,o){return a==="textarea"||a==="noscript"||typeof o.children=="string"||typeof o.children=="number"||typeof o.children=="bigint"||typeof o.dangerouslySetInnerHTML=="object"&&o.dangerouslySetInnerHTML!==null&&o.dangerouslySetInnerHTML.__html!=null}var Ch=null;function wE(){var a=window.event;return a&&a.type==="popstate"?a===Ch?!1:(Ch=a,!0):(Ch=null,!1)}var H0=typeof setTimeout=="function"?setTimeout:void 0,CE=typeof clearTimeout=="function"?clearTimeout:void 0,z0=typeof Promise=="function"?Promise:void 0,NE=typeof queueMicrotask=="function"?queueMicrotask:typeof z0<"u"?function(a){return z0.resolve(null).then(a).catch(OE)}:H0;function OE(a){setTimeout(function(){throw a})}function da(a){return a==="head"}function K0(a,o){var d=o,m=0;do{var v=d.nextSibling;if(a.removeChild(d),v&&v.nodeType===8)if(d=v.data,d==="/$"||d==="/&"){if(m===0){a.removeChild(v),Cr(o);return}m--}else if(d==="$"||d==="$?"||d==="$~"||d==="$!"||d==="&")m++;else if(d==="html")Ol(a.ownerDocument.documentElement);else if(d==="head"){d=a.ownerDocument.head,Ol(d);for(var b=d.firstChild;b;){var R=b.nextSibling,O=b.nodeName;b[Gn]||O==="SCRIPT"||O==="STYLE"||O==="LINK"&&b.rel.toLowerCase()==="stylesheet"||d.removeChild(b),b=R}}else d==="body"&&Ol(a.ownerDocument.body);d=v}while(d);Cr(o)}function Y0(a,o){var d=a;a=0;do{var m=d.nextSibling;if(d.nodeType===1?o?(d._stashedDisplay=d.style.display,d.style.display="none"):(d.style.display=d._stashedDisplay||"",d.getAttribute("style")===""&&d.removeAttribute("style")):d.nodeType===3&&(o?(d._stashedText=d.nodeValue,d.nodeValue=""):d.nodeValue=d._stashedText||""),m&&m.nodeType===8)if(d=m.data,d==="/$"){if(a===0)break;a--}else d!=="$"&&d!=="$?"&&d!=="$~"&&d!=="$!"||a++;d=m}while(d)}function Nh(a){var o=a.firstChild;for(o&&o.nodeType===10&&(o=o.nextSibling);o;){var d=o;switch(o=o.nextSibling,d.nodeName){case"HTML":case"HEAD":case"BODY":Nh(d),Ai(d);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(d.rel.toLowerCase()==="stylesheet")continue}a.removeChild(d)}}function kE(a,o,d,m){for(;a.nodeType===1;){var v=d;if(a.nodeName.toLowerCase()!==o.toLowerCase()){if(!m&&(a.nodeName!=="INPUT"||a.type!=="hidden"))break}else if(m){if(!a[Gn])switch(o){case"meta":if(!a.hasAttribute("itemprop"))break;return a;case"link":if(b=a.getAttribute("rel"),b==="stylesheet"&&a.hasAttribute("data-precedence"))break;if(b!==v.rel||a.getAttribute("href")!==(v.href==null||v.href===""?null:v.href)||a.getAttribute("crossorigin")!==(v.crossOrigin==null?null:v.crossOrigin)||a.getAttribute("title")!==(v.title==null?null:v.title))break;return a;case"style":if(a.hasAttribute("data-precedence"))break;return a;case"script":if(b=a.getAttribute("src"),(b!==(v.src==null?null:v.src)||a.getAttribute("type")!==(v.type==null?null:v.type)||a.getAttribute("crossorigin")!==(v.crossOrigin==null?null:v.crossOrigin))&&b&&a.hasAttribute("async")&&!a.hasAttribute("itemprop"))break;return a;default:return a}}else if(o==="input"&&a.type==="hidden"){var b=v.name==null?null:""+v.name;if(v.type==="hidden"&&a.getAttribute("name")===b)return a}else return a;if(a=Ni(a.nextSibling),a===null)break}return null}function DE(a,o,d){if(o==="")return null;for(;a.nodeType!==3;)if((a.nodeType!==1||a.nodeName!=="INPUT"||a.type!=="hidden")&&!d||(a=Ni(a.nextSibling),a===null))return null;return a}function q0(a,o){for(;a.nodeType!==8;)if((a.nodeType!==1||a.nodeName!=="INPUT"||a.type!=="hidden")&&!o||(a=Ni(a.nextSibling),a===null))return null;return a}function Oh(a){return a.data==="$?"||a.data==="$~"}function kh(a){return a.data==="$!"||a.data==="$?"&&a.ownerDocument.readyState!=="loading"}function PE(a,o){var d=a.ownerDocument;if(a.data==="$~")a._reactRetry=o;else if(a.data!=="$?"||d.readyState!=="loading")o();else{var m=function(){o(),d.removeEventListener("DOMContentLoaded",m)};d.addEventListener("DOMContentLoaded",m),a._reactRetry=m}}function Ni(a){for(;a!=null;a=a.nextSibling){var o=a.nodeType;if(o===1||o===3)break;if(o===8){if(o=a.data,o==="$"||o==="$!"||o==="$?"||o==="$~"||o==="&"||o==="F!"||o==="F")break;if(o==="/$"||o==="/&")return null}}return a}var Dh=null;function Q0(a){a=a.nextSibling;for(var o=0;a;){if(a.nodeType===8){var d=a.data;if(d==="/$"||d==="/&"){if(o===0)return Ni(a.nextSibling);o--}else d!=="$"&&d!=="$!"&&d!=="$?"&&d!=="$~"&&d!=="&"||o++}a=a.nextSibling}return null}function W0(a){a=a.previousSibling;for(var o=0;a;){if(a.nodeType===8){var d=a.data;if(d==="$"||d==="$!"||d==="$?"||d==="$~"||d==="&"){if(o===0)return a;o--}else d!=="/$"&&d!=="/&"||o++}a=a.previousSibling}return null}function X0(a,o,d){switch(o=pc(d),a){case"html":if(a=o.documentElement,!a)throw Error(s(452));return a;case"head":if(a=o.head,!a)throw Error(s(453));return a;case"body":if(a=o.body,!a)throw Error(s(454));return a;default:throw Error(s(451))}}function Ol(a){for(var o=a.attributes;o.length;)a.removeAttributeNode(o[0]);Ai(a)}var Oi=new Map,Z0=new Set;function gc(a){return typeof a.getRootNode=="function"?a.getRootNode():a.nodeType===9?a:a.ownerDocument}var Dn=$.d;$.d={f:UE,r:ME,D:jE,C:BE,L:FE,m:VE,X:GE,S:$E,M:HE};function UE(){var a=Dn.f(),o=lc();return a||o}function ME(a){var o=zn(a);o!==null&&o.tag===5&&o.type==="form"?pg(o):Dn.r(a)}var Rr=typeof document>"u"?null:document;function J0(a,o,d){var m=Rr;if(m&&typeof o=="string"&&o){var v=Ct(o);v='link[rel="'+a+'"][href="'+v+'"]',typeof d=="string"&&(v+='[crossorigin="'+d+'"]'),Z0.has(v)||(Z0.add(v),a={rel:a,crossOrigin:d,href:o},m.querySelector(v)===null&&(o=m.createElement("link"),Es(o,"link",a),ns(o),m.head.appendChild(o)))}}function jE(a){Dn.D(a),J0("dns-prefetch",a,null)}function BE(a,o){Dn.C(a,o),J0("preconnect",a,o)}function FE(a,o,d){Dn.L(a,o,d);var m=Rr;if(m&&a&&o){var v='link[rel="preload"][as="'+Ct(o)+'"]';o==="image"&&d&&d.imageSrcSet?(v+='[imagesrcset="'+Ct(d.imageSrcSet)+'"]',typeof d.imageSizes=="string"&&(v+='[imagesizes="'+Ct(d.imageSizes)+'"]')):v+='[href="'+Ct(a)+'"]';var b=v;switch(o){case"style":b=Lr(a);break;case"script":b=wr(a)}Oi.has(b)||(a=g({rel:"preload",href:o==="image"&&d&&d.imageSrcSet?void 0:a,as:o},d),Oi.set(b,a),m.querySelector(v)!==null||o==="style"&&m.querySelector(kl(b))||o==="script"&&m.querySelector(Dl(b))||(o=m.createElement("link"),Es(o,"link",a),ns(o),m.head.appendChild(o)))}}function VE(a,o){Dn.m(a,o);var d=Rr;if(d&&a){var m=o&&typeof o.as=="string"?o.as:"script",v='link[rel="modulepreload"][as="'+Ct(m)+'"][href="'+Ct(a)+'"]',b=v;switch(m){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":b=wr(a)}if(!Oi.has(b)&&(a=g({rel:"modulepreload",href:a},o),Oi.set(b,a),d.querySelector(v)===null)){switch(m){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(d.querySelector(Dl(b)))return}m=d.createElement("link"),Es(m,"link",a),ns(m),d.head.appendChild(m)}}}function $E(a,o,d){Dn.S(a,o,d);var m=Rr;if(m&&a){var v=mn(m).hoistableStyles,b=Lr(a);o=o||"default";var R=v.get(b);if(!R){var O={loading:0,preload:null};if(R=m.querySelector(kl(b)))O.loading=5;else{a=g({rel:"stylesheet",href:a,"data-precedence":o},d),(d=Oi.get(b))&&Ph(a,d);var V=R=m.createElement("link");ns(V),Es(V,"link",a),V._p=new Promise(function(X,le){V.onload=X,V.onerror=le}),V.addEventListener("load",function(){O.loading|=1}),V.addEventListener("error",function(){O.loading|=2}),O.loading|=4,yc(R,o,m)}R={type:"stylesheet",instance:R,count:1,state:O},v.set(b,R)}}}function GE(a,o){Dn.X(a,o);var d=Rr;if(d&&a){var m=mn(d).hoistableScripts,v=wr(a),b=m.get(v);b||(b=d.querySelector(Dl(v)),b||(a=g({src:a,async:!0},o),(o=Oi.get(v))&&Uh(a,o),b=d.createElement("script"),ns(b),Es(b,"link",a),d.head.appendChild(b)),b={type:"script",instance:b,count:1,state:null},m.set(v,b))}}function HE(a,o){Dn.M(a,o);var d=Rr;if(d&&a){var m=mn(d).hoistableScripts,v=wr(a),b=m.get(v);b||(b=d.querySelector(Dl(v)),b||(a=g({src:a,async:!0,type:"module"},o),(o=Oi.get(v))&&Uh(a,o),b=d.createElement("script"),ns(b),Es(b,"link",a),d.head.appendChild(b)),b={type:"script",instance:b,count:1,state:null},m.set(v,b))}}function ey(a,o,d,m){var v=(v=Ae.current)?gc(v):null;if(!v)throw Error(s(446));switch(a){case"meta":case"title":return null;case"style":return typeof d.precedence=="string"&&typeof d.href=="string"?(o=Lr(d.href),d=mn(v).hoistableStyles,m=d.get(o),m||(m={type:"style",instance:null,count:0,state:null},d.set(o,m)),m):{type:"void",instance:null,count:0,state:null};case"link":if(d.rel==="stylesheet"&&typeof d.href=="string"&&typeof d.precedence=="string"){a=Lr(d.href);var b=mn(v).hoistableStyles,R=b.get(a);if(R||(v=v.ownerDocument||v,R={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},b.set(a,R),(b=v.querySelector(kl(a)))&&!b._p&&(R.instance=b,R.state.loading=5),Oi.has(a)||(d={rel:"preload",as:"style",href:d.href,crossOrigin:d.crossOrigin,integrity:d.integrity,media:d.media,hrefLang:d.hrefLang,referrerPolicy:d.referrerPolicy},Oi.set(a,d),b||zE(v,a,d,R.state))),o&&m===null)throw Error(s(528,""));return R}if(o&&m!==null)throw Error(s(529,""));return null;case"script":return o=d.async,d=d.src,typeof d=="string"&&o&&typeof o!="function"&&typeof o!="symbol"?(o=wr(d),d=mn(v).hoistableScripts,m=d.get(o),m||(m={type:"script",instance:null,count:0,state:null},d.set(o,m)),m):{type:"void",instance:null,count:0,state:null};default:throw Error(s(444,a))}}function Lr(a){return'href="'+Ct(a)+'"'}function kl(a){return'link[rel="stylesheet"]['+a+"]"}function ty(a){return g({},a,{"data-precedence":a.precedence,precedence:null})}function zE(a,o,d,m){a.querySelector('link[rel="preload"][as="style"]['+o+"]")?m.loading=1:(o=a.createElement("link"),m.preload=o,o.addEventListener("load",function(){return m.loading|=1}),o.addEventListener("error",function(){return m.loading|=2}),Es(o,"link",d),ns(o),a.head.appendChild(o))}function wr(a){return'[src="'+Ct(a)+'"]'}function Dl(a){return"script[async]"+a}function sy(a,o,d){if(o.count++,o.instance===null)switch(o.type){case"style":var m=a.querySelector('style[data-href~="'+Ct(d.href)+'"]');if(m)return o.instance=m,ns(m),m;var v=g({},d,{"data-href":d.href,"data-precedence":d.precedence,href:null,precedence:null});return m=(a.ownerDocument||a).createElement("style"),ns(m),Es(m,"style",v),yc(m,d.precedence,a),o.instance=m;case"stylesheet":v=Lr(d.href);var b=a.querySelector(kl(v));if(b)return o.state.loading|=4,o.instance=b,ns(b),b;m=ty(d),(v=Oi.get(v))&&Ph(m,v),b=(a.ownerDocument||a).createElement("link"),ns(b);var R=b;return R._p=new Promise(function(O,V){R.onload=O,R.onerror=V}),Es(b,"link",m),o.state.loading|=4,yc(b,d.precedence,a),o.instance=b;case"script":return b=wr(d.src),(v=a.querySelector(Dl(b)))?(o.instance=v,ns(v),v):(m=d,(v=Oi.get(b))&&(m=g({},d),Uh(m,v)),a=a.ownerDocument||a,v=a.createElement("script"),ns(v),Es(v,"link",m),a.head.appendChild(v),o.instance=v);case"void":return null;default:throw Error(s(443,o.type))}else o.type==="stylesheet"&&(o.state.loading&4)===0&&(m=o.instance,o.state.loading|=4,yc(m,d.precedence,a));return o.instance}function yc(a,o,d){for(var m=d.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),v=m.length?m[m.length-1]:null,b=v,R=0;R<m.length;R++){var O=m[R];if(O.dataset.precedence===o)b=O;else if(b!==v)break}b?b.parentNode.insertBefore(a,b.nextSibling):(o=d.nodeType===9?d.head:d,o.insertBefore(a,o.firstChild))}function Ph(a,o){a.crossOrigin==null&&(a.crossOrigin=o.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=o.referrerPolicy),a.title==null&&(a.title=o.title)}function Uh(a,o){a.crossOrigin==null&&(a.crossOrigin=o.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=o.referrerPolicy),a.integrity==null&&(a.integrity=o.integrity)}var vc=null;function iy(a,o,d){if(vc===null){var m=new Map,v=vc=new Map;v.set(d,m)}else v=vc,m=v.get(d),m||(m=new Map,v.set(d,m));if(m.has(a))return m;for(m.set(a,null),d=d.getElementsByTagName(a),v=0;v<d.length;v++){var b=d[v];if(!(b[Gn]||b[At]||a==="link"&&b.getAttribute("rel")==="stylesheet")&&b.namespaceURI!=="http://www.w3.org/2000/svg"){var R=b.getAttribute(o)||"";R=a+R;var O=m.get(R);O?O.push(b):m.set(R,[b])}}return m}function ny(a,o,d){a=a.ownerDocument||a,a.head.insertBefore(d,o==="title"?a.querySelector("head > title"):null)}function KE(a,o,d){if(d===1||o.itemProp!=null)return!1;switch(a){case"meta":case"title":return!0;case"style":if(typeof o.precedence!="string"||typeof o.href!="string"||o.href==="")break;return!0;case"link":if(typeof o.rel!="string"||typeof o.href!="string"||o.href===""||o.onLoad||o.onError)break;return o.rel==="stylesheet"?(a=o.disabled,typeof o.precedence=="string"&&a==null):!0;case"script":if(o.async&&typeof o.async!="function"&&typeof o.async!="symbol"&&!o.onLoad&&!o.onError&&o.src&&typeof o.src=="string")return!0}return!1}function ay(a){return!(a.type==="stylesheet"&&(a.state.loading&3)===0)}function YE(a,o,d,m){if(d.type==="stylesheet"&&(typeof m.media!="string"||matchMedia(m.media).matches!==!1)&&(d.state.loading&4)===0){if(d.instance===null){var v=Lr(m.href),b=o.querySelector(kl(v));if(b){o=b._p,o!==null&&typeof o=="object"&&typeof o.then=="function"&&(a.count++,a=xc.bind(a),o.then(a,a)),d.state.loading|=4,d.instance=b,ns(b);return}b=o.ownerDocument||o,m=ty(m),(v=Oi.get(v))&&Ph(m,v),b=b.createElement("link"),ns(b);var R=b;R._p=new Promise(function(O,V){R.onload=O,R.onerror=V}),Es(b,"link",m),d.instance=b}a.stylesheets===null&&(a.stylesheets=new Map),a.stylesheets.set(d,o),(o=d.state.preload)&&(d.state.loading&3)===0&&(a.count++,d=xc.bind(a),o.addEventListener("load",d),o.addEventListener("error",d))}}var Mh=0;function qE(a,o){return a.stylesheets&&a.count===0&&bc(a,a.stylesheets),0<a.count||0<a.imgCount?function(d){var m=setTimeout(function(){if(a.stylesheets&&bc(a,a.stylesheets),a.unsuspend){var b=a.unsuspend;a.unsuspend=null,b()}},6e4+o);0<a.imgBytes&&Mh===0&&(Mh=62500*LE());var v=setTimeout(function(){if(a.waitingForImages=!1,a.count===0&&(a.stylesheets&&bc(a,a.stylesheets),a.unsuspend)){var b=a.unsuspend;a.unsuspend=null,b()}},(a.imgBytes>Mh?50:800)+o);return a.unsuspend=d,function(){a.unsuspend=null,clearTimeout(m),clearTimeout(v)}}:null}function xc(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)bc(this,this.stylesheets);else if(this.unsuspend){var a=this.unsuspend;this.unsuspend=null,a()}}}var Sc=null;function bc(a,o){a.stylesheets=null,a.unsuspend!==null&&(a.count++,Sc=new Map,o.forEach(QE,a),Sc=null,xc.call(a))}function QE(a,o){if(!(o.state.loading&4)){var d=Sc.get(a);if(d)var m=d.get(null);else{d=new Map,Sc.set(a,d);for(var v=a.querySelectorAll("link[data-precedence],style[data-precedence]"),b=0;b<v.length;b++){var R=v[b];(R.nodeName==="LINK"||R.getAttribute("media")!=="not all")&&(d.set(R.dataset.precedence,R),m=R)}m&&d.set(null,m)}v=o.instance,R=v.getAttribute("data-precedence"),b=d.get(R)||m,b===m&&d.set(null,v),d.set(R,v),this.count++,m=xc.bind(this),v.addEventListener("load",m),v.addEventListener("error",m),b?b.parentNode.insertBefore(v,b.nextSibling):(a=a.nodeType===9?a.head:a,a.insertBefore(v,a.firstChild)),o.state.loading|=4}}var Pl={$$typeof:I,Provider:null,Consumer:null,_currentValue:F,_currentValue2:F,_threadCount:0};function WE(a,o,d,m,v,b,R,O,V){this.tag=1,this.containerInfo=a,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Jt(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Jt(0),this.hiddenUpdates=Jt(null),this.identifierPrefix=m,this.onUncaughtError=v,this.onCaughtError=b,this.onRecoverableError=R,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=V,this.incompleteTransitions=new Map}function ry(a,o,d,m,v,b,R,O,V,X,le,pe){return a=new WE(a,o,d,R,V,X,le,pe,O),o=1,b===!0&&(o|=24),b=li(3,null,null,o),a.current=b,b.stateNode=a,o=gd(),o.refCount++,a.pooledCache=o,o.refCount++,b.memoizedState={element:m,isDehydrated:d,cache:o},Sd(b),a}function ly(a){return a?(a=rr,a):rr}function oy(a,o,d,m,v,b){v=ly(v),m.context===null?m.context=v:m.pendingContext=v,m=ea(o),m.payload={element:d},b=b===void 0?null:b,b!==null&&(m.callback=b),d=ta(a,m,o),d!==null&&(Ws(d,a,o),fl(d,a,o))}function cy(a,o){if(a=a.memoizedState,a!==null&&a.dehydrated!==null){var d=a.retryLane;a.retryLane=d!==0&&d<o?d:o}}function jh(a,o){cy(a,o),(a=a.alternate)&&cy(a,o)}function uy(a){if(a.tag===13||a.tag===31){var o=wa(a,67108864);o!==null&&Ws(o,a,67108864),jh(a,67108864)}}function dy(a){if(a.tag===13||a.tag===31){var o=hi();o=Ce(o);var d=wa(a,o);d!==null&&Ws(d,a,o),jh(a,o)}}var Tc=!0;function XE(a,o,d,m){var v=M.T;M.T=null;var b=$.p;try{$.p=2,Bh(a,o,d,m)}finally{$.p=b,M.T=v}}function ZE(a,o,d,m){var v=M.T;M.T=null;var b=$.p;try{$.p=8,Bh(a,o,d,m)}finally{$.p=b,M.T=v}}function Bh(a,o,d,m){if(Tc){var v=Fh(m);if(v===null)Ih(a,o,m,Ec,d),fy(a,m);else if(eA(v,a,o,d,m))m.stopPropagation();else if(fy(a,m),o&4&&-1<JE.indexOf(a)){for(;v!==null;){var b=zn(v);if(b!==null)switch(b.tag){case 3:if(b=b.stateNode,b.current.memoizedState.isDehydrated){var R=Bs(b.pendingLanes);if(R!==0){var O=b;for(O.pendingLanes|=2,O.entangledLanes|=2;R;){var V=1<<31-wt(R);O.entanglements[1]|=V,R&=~V}en(b),(xt&6)===0&&(ac=nt()+500,wl(0))}}break;case 31:case 13:O=wa(b,2),O!==null&&Ws(O,b,2),lc(),jh(b,2)}if(b=Fh(m),b===null&&Ih(a,o,m,Ec,d),b===v)break;v=b}v!==null&&m.stopPropagation()}else Ih(a,o,m,null,d)}}function Fh(a){return a=$u(a),Vh(a)}var Ec=null;function Vh(a){if(Ec=null,a=Hn(a),a!==null){var o=r(a);if(o===null)a=null;else{var d=o.tag;if(d===13){if(a=l(o),a!==null)return a;a=null}else if(d===31){if(a=c(o),a!==null)return a;a=null}else if(d===3){if(o.stateNode.current.memoizedState.isDehydrated)return o.tag===3?o.stateNode.containerInfo:null;a=null}else o!==a&&(a=null)}}return Ec=a,null}function hy(a){switch(a){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Kt()){case ge:return 2;case Qe:return 8;case st:case Zt:return 32;case Rs:return 268435456;default:return 32}default:return 32}}var $h=!1,ha=null,fa=null,ma=null,Ul=new Map,Ml=new Map,pa=[],JE="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function fy(a,o){switch(a){case"focusin":case"focusout":ha=null;break;case"dragenter":case"dragleave":fa=null;break;case"mouseover":case"mouseout":ma=null;break;case"pointerover":case"pointerout":Ul.delete(o.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ml.delete(o.pointerId)}}function jl(a,o,d,m,v,b){return a===null||a.nativeEvent!==b?(a={blockedOn:o,domEventName:d,eventSystemFlags:m,nativeEvent:b,targetContainers:[v]},o!==null&&(o=zn(o),o!==null&&uy(o)),a):(a.eventSystemFlags|=m,o=a.targetContainers,v!==null&&o.indexOf(v)===-1&&o.push(v),a)}function eA(a,o,d,m,v){switch(o){case"focusin":return ha=jl(ha,a,o,d,m,v),!0;case"dragenter":return fa=jl(fa,a,o,d,m,v),!0;case"mouseover":return ma=jl(ma,a,o,d,m,v),!0;case"pointerover":var b=v.pointerId;return Ul.set(b,jl(Ul.get(b)||null,a,o,d,m,v)),!0;case"gotpointercapture":return b=v.pointerId,Ml.set(b,jl(Ml.get(b)||null,a,o,d,m,v)),!0}return!1}function my(a){var o=Hn(a.target);if(o!==null){var d=r(o);if(d!==null){if(o=d.tag,o===13){if(o=l(d),o!==null){a.blockedOn=o,Ie(a.priority,function(){dy(d)});return}}else if(o===31){if(o=c(d),o!==null){a.blockedOn=o,Ie(a.priority,function(){dy(d)});return}}else if(o===3&&d.stateNode.current.memoizedState.isDehydrated){a.blockedOn=d.tag===3?d.stateNode.containerInfo:null;return}}}a.blockedOn=null}function Ac(a){if(a.blockedOn!==null)return!1;for(var o=a.targetContainers;0<o.length;){var d=Fh(a.nativeEvent);if(d===null){d=a.nativeEvent;var m=new d.constructor(d.type,d);Vu=m,d.target.dispatchEvent(m),Vu=null}else return o=zn(d),o!==null&&uy(o),a.blockedOn=d,!1;o.shift()}return!0}function py(a,o,d){Ac(a)&&d.delete(o)}function tA(){$h=!1,ha!==null&&Ac(ha)&&(ha=null),fa!==null&&Ac(fa)&&(fa=null),ma!==null&&Ac(ma)&&(ma=null),Ul.forEach(py),Ml.forEach(py)}function Ic(a,o){a.blockedOn===o&&(a.blockedOn=null,$h||($h=!0,n.unstable_scheduleCallback(n.unstable_NormalPriority,tA)))}var _c=null;function gy(a){_c!==a&&(_c=a,n.unstable_scheduleCallback(n.unstable_NormalPriority,function(){_c===a&&(_c=null);for(var o=0;o<a.length;o+=3){var d=a[o],m=a[o+1],v=a[o+2];if(typeof m!="function"){if(Vh(m||d)===null)continue;break}var b=zn(d);b!==null&&(a.splice(o,3),o-=3,Fd(b,{pending:!0,data:v,method:d.method,action:m},m,v))}}))}function Cr(a){function o(V){return Ic(V,a)}ha!==null&&Ic(ha,a),fa!==null&&Ic(fa,a),ma!==null&&Ic(ma,a),Ul.forEach(o),Ml.forEach(o);for(var d=0;d<pa.length;d++){var m=pa[d];m.blockedOn===a&&(m.blockedOn=null)}for(;0<pa.length&&(d=pa[0],d.blockedOn===null);)my(d),d.blockedOn===null&&pa.shift();if(d=(a.ownerDocument||a).$$reactFormReplay,d!=null)for(m=0;m<d.length;m+=3){var v=d[m],b=d[m+1],R=v[gt]||null;if(typeof b=="function")R||gy(d);else if(R){var O=null;if(b&&b.hasAttribute("formAction")){if(v=b,R=b[gt]||null)O=R.formAction;else if(Vh(v)!==null)continue}else O=R.action;typeof O=="function"?d[m+1]=O:(d.splice(m,3),m-=3),gy(d)}}}function yy(){function a(b){b.canIntercept&&b.info==="react-transition"&&b.intercept({handler:function(){return new Promise(function(R){return v=R})},focusReset:"manual",scroll:"manual"})}function o(){v!==null&&(v(),v=null),m||setTimeout(d,20)}function d(){if(!m&&!navigation.transition){var b=navigation.currentEntry;b&&b.url!=null&&navigation.navigate(b.url,{state:b.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var m=!1,v=null;return navigation.addEventListener("navigate",a),navigation.addEventListener("navigatesuccess",o),navigation.addEventListener("navigateerror",o),setTimeout(d,100),function(){m=!0,navigation.removeEventListener("navigate",a),navigation.removeEventListener("navigatesuccess",o),navigation.removeEventListener("navigateerror",o),v!==null&&(v(),v=null)}}}function Gh(a){this._internalRoot=a}Rc.prototype.render=Gh.prototype.render=function(a){var o=this._internalRoot;if(o===null)throw Error(s(409));var d=o.current,m=hi();oy(d,m,a,o,null,null)},Rc.prototype.unmount=Gh.prototype.unmount=function(){var a=this._internalRoot;if(a!==null){this._internalRoot=null;var o=a.containerInfo;oy(a.current,2,null,a,null,null),lc(),o[Fi]=null}};function Rc(a){this._internalRoot=a}Rc.prototype.unstable_scheduleHydration=function(a){if(a){var o=is();a={blockedOn:null,target:a,priority:o};for(var d=0;d<pa.length&&o!==0&&o<pa[d].priority;d++);pa.splice(d,0,a),d===0&&my(a)}};var vy=e.version;if(vy!=="19.2.4")throw Error(s(527,vy,"19.2.4"));$.findDOMNode=function(a){var o=a._reactInternals;if(o===void 0)throw typeof a.render=="function"?Error(s(188)):(a=Object.keys(a).join(","),Error(s(268,a)));return a=u(o),a=a!==null?f(a):null,a=a===null?null:a.stateNode,a};var sA={bundleType:0,version:"19.2.4",rendererPackageName:"react-dom",currentDispatcherRef:M,reconcilerVersion:"19.2.4"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Lc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Lc.isDisabled&&Lc.supportsFiber)try{js=Lc.inject(sA),Bt=Lc}catch{}}return Fl.createRoot=function(a,o){if(!i(a))throw Error(s(299));var d=!1,m="",v=Ig,b=_g,R=Rg;return o!=null&&(o.unstable_strictMode===!0&&(d=!0),o.identifierPrefix!==void 0&&(m=o.identifierPrefix),o.onUncaughtError!==void 0&&(v=o.onUncaughtError),o.onCaughtError!==void 0&&(b=o.onCaughtError),o.onRecoverableError!==void 0&&(R=o.onRecoverableError)),o=ry(a,1,!1,null,null,d,m,null,v,b,R,yy),a[Fi]=o.current,Ah(a),new Gh(o)},Fl.hydrateRoot=function(a,o,d){if(!i(a))throw Error(s(299));var m=!1,v="",b=Ig,R=_g,O=Rg,V=null;return d!=null&&(d.unstable_strictMode===!0&&(m=!0),d.identifierPrefix!==void 0&&(v=d.identifierPrefix),d.onUncaughtError!==void 0&&(b=d.onUncaughtError),d.onCaughtError!==void 0&&(R=d.onCaughtError),d.onRecoverableError!==void 0&&(O=d.onRecoverableError),d.formState!==void 0&&(V=d.formState)),o=ry(a,1,!0,o,d??null,m,v,V,b,R,O,yy),o.context=ly(null),d=o.current,m=hi(),m=Ce(m),v=ea(m),v.callback=null,ta(d,v,m),d=m,o.current.lanes=d,us(o,d),en(o),a[Fi]=o.current,Ah(a),new Rc(o)},Fl.version="19.2.4",Fl}var Ly;function fA(){if(Ly)return Kh.exports;Ly=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),Kh.exports=hA(),Kh.exports}var mA=fA();var wy="popstate";function pA(n={}){function e(i,r){let{pathname:l="/",search:c="",hash:h=""}=Wa(i.location.hash.substring(1));return!l.startsWith("/")&&!l.startsWith(".")&&(l="/"+l),Cf("",{pathname:l,search:c,hash:h},r.state&&r.state.usr||null,r.state&&r.state.key||"default")}function t(i,r){let l=i.document.querySelector("base"),c="";if(l&&l.getAttribute("href")){let h=i.location.href,u=h.indexOf("#");c=u===-1?h:h.slice(0,u)}return c+"#"+(typeof r=="string"?r:ql(r))}function s(i,r){Pi(i.pathname.charAt(0)==="/",`relative pathnames are not supported in hash history.push(${JSON.stringify(r)})`)}return yA(e,t,s,n)}function Ht(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}function Pi(n,e){if(!n){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function gA(){return Math.random().toString(36).substring(2,10)}function Cy(n,e){return{usr:n.state,key:n.key,idx:e}}function Cf(n,e,t=null,s){return{pathname:typeof n=="string"?n:n.pathname,search:"",hash:"",...typeof e=="string"?Wa(e):e,state:t,key:e&&e.key||s||gA()}}function ql({pathname:n="/",search:e="",hash:t=""}){return e&&e!=="?"&&(n+=e.charAt(0)==="?"?e:"?"+e),t&&t!=="#"&&(n+=t.charAt(0)==="#"?t:"#"+t),n}function Wa(n){let e={};if(n){let t=n.indexOf("#");t>=0&&(e.hash=n.substring(t),n=n.substring(0,t));let s=n.indexOf("?");s>=0&&(e.search=n.substring(s),n=n.substring(0,s)),n&&(e.pathname=n)}return e}function yA(n,e,t,s={}){let{window:i=document.defaultView,v5Compat:r=!1}=s,l=i.history,c="POP",h=null,u=f();u==null&&(u=0,l.replaceState({...l.state,idx:u},""));function f(){return(l.state||{idx:null}).idx}function g(){c="POP";let T=f(),A=T==null?null:T-u;u=T,h&&h({action:c,location:E.location,delta:A})}function y(T,A){c="PUSH";let _=Cf(E.location,T,A);t&&t(_,T),u=f()+1;let I=Cy(_,u),C=E.createHref(_);try{l.pushState(I,"",C)}catch(N){if(N instanceof DOMException&&N.name==="DataCloneError")throw N;i.location.assign(C)}r&&h&&h({action:c,location:E.location,delta:1})}function x(T,A){c="REPLACE";let _=Cf(E.location,T,A);t&&t(_,T),u=f();let I=Cy(_,u),C=E.createHref(_);l.replaceState(I,"",C),r&&h&&h({action:c,location:E.location,delta:0})}function S(T){return vA(T)}let E={get action(){return c},get location(){return n(i,l)},listen(T){if(h)throw new Error("A history only accepts one active listener");return i.addEventListener(wy,g),h=T,()=>{i.removeEventListener(wy,g),h=null}},createHref(T){return e(i,T)},createURL:S,encodeLocation(T){let A=S(T);return{pathname:A.pathname,search:A.search,hash:A.hash}},push:y,replace:x,go(T){return l.go(T)}};return E}function vA(n,e=!1){let t="http://localhost";typeof window<"u"&&(t=window.location.origin!=="null"?window.location.origin:window.location.href),Ht(t,"No window.location.(origin|href) available to create URL");let s=typeof n=="string"?n:ql(n);return s=s.replace(/ $/,"%20"),!e&&s.startsWith("//")&&(s=t+s),new URL(s,t)}function Cx(n,e,t="/"){return xA(n,e,t,!1)}function xA(n,e,t,s){let i=typeof e=="string"?Wa(e):e,r=Vn(i.pathname||"/",t);if(r==null)return null;let l=Nx(n);SA(l);let c=null;for(let h=0;c==null&&h<l.length;++h){let u=NA(r);c=wA(l[h],u,s)}return c}function Nx(n,e=[],t=[],s="",i=!1){let r=(l,c,h=i,u)=>{let f={relativePath:u===void 0?l.path||"":u,caseSensitive:l.caseSensitive===!0,childrenIndex:c,route:l};if(f.relativePath.startsWith("/")){if(!f.relativePath.startsWith(s)&&h)return;Ht(f.relativePath.startsWith(s),`Absolute route path "${f.relativePath}" nested under path "${s}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),f.relativePath=f.relativePath.slice(s.length)}let g=Fn([s,f.relativePath]),y=t.concat(f);l.children&&l.children.length>0&&(Ht(l.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${g}".`),Nx(l.children,e,y,g,h)),!(l.path==null&&!l.index)&&e.push({path:g,score:RA(g,l.index),routesMeta:y})};return n.forEach((l,c)=>{if(l.path===""||!l.path?.includes("?"))r(l,c);else for(let h of Ox(l.path))r(l,c,!0,h)}),e}function Ox(n){let e=n.split("/");if(e.length===0)return[];let[t,...s]=e,i=t.endsWith("?"),r=t.replace(/\?$/,"");if(s.length===0)return i?[r,""]:[r];let l=Ox(s.join("/")),c=[];return c.push(...l.map(h=>h===""?r:[r,h].join("/"))),i&&c.push(...l),c.map(h=>n.startsWith("/")&&h===""?"/":h)}function SA(n){n.sort((e,t)=>e.score!==t.score?t.score-e.score:LA(e.routesMeta.map(s=>s.childrenIndex),t.routesMeta.map(s=>s.childrenIndex)))}var bA=/^:[\w-]+$/,TA=3,EA=2,AA=1,IA=10,_A=-2,Ny=n=>n==="*";function RA(n,e){let t=n.split("/"),s=t.length;return t.some(Ny)&&(s+=_A),e&&(s+=EA),t.filter(i=>!Ny(i)).reduce((i,r)=>i+(bA.test(r)?TA:r===""?AA:IA),s)}function LA(n,e){return n.length===e.length&&n.slice(0,-1).every((s,i)=>s===e[i])?n[n.length-1]-e[e.length-1]:0}function wA(n,e,t=!1){let{routesMeta:s}=n,i={},r="/",l=[];for(let c=0;c<s.length;++c){let h=s[c],u=c===s.length-1,f=r==="/"?e:e.slice(r.length)||"/",g=cu({path:h.relativePath,caseSensitive:h.caseSensitive,end:u},f),y=h.route;if(!g&&u&&t&&!s[s.length-1].route.index&&(g=cu({path:h.relativePath,caseSensitive:h.caseSensitive,end:!1},f)),!g)return null;Object.assign(i,g.params),l.push({params:i,pathname:Fn([r,g.pathname]),pathnameBase:PA(Fn([r,g.pathnameBase])),route:y}),g.pathnameBase!=="/"&&(r=Fn([r,g.pathnameBase]))}return l}function cu(n,e){typeof n=="string"&&(n={path:n,caseSensitive:!1,end:!0});let[t,s]=CA(n.path,n.caseSensitive,n.end),i=e.match(t);if(!i)return null;let r=i[0],l=r.replace(/(.)\/+$/,"$1"),c=i.slice(1);return{params:s.reduce((u,{paramName:f,isOptional:g},y)=>{if(f==="*"){let S=c[y]||"";l=r.slice(0,r.length-S.length).replace(/(.)\/+$/,"$1")}const x=c[y];return g&&!x?u[f]=void 0:u[f]=(x||"").replace(/%2F/g,"/"),u},{}),pathname:r,pathnameBase:l,pattern:n}}function CA(n,e=!1,t=!0){Pi(n==="*"||!n.endsWith("*")||n.endsWith("/*"),`Route path "${n}" will be treated as if it were "${n.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${n.replace(/\*$/,"/*")}".`);let s=[],i="^"+n.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(l,c,h)=>(s.push({paramName:c,isOptional:h!=null}),h?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return n.endsWith("*")?(s.push({paramName:"*"}),i+=n==="*"||n==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?i+="\\/*$":n!==""&&n!=="/"&&(i+="(?:(?=\\/|$))"),[new RegExp(i,e?void 0:"i"),s]}function NA(n){try{return n.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return Pi(!1,`The URL path "${n}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),n}}function Vn(n,e){if(e==="/")return n;if(!n.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,s=n.charAt(t);return s&&s!=="/"?null:n.slice(t)||"/"}var OA=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i;function kA(n,e="/"){let{pathname:t,search:s="",hash:i=""}=typeof n=="string"?Wa(n):n,r;return t?(t=t.replace(/\/\/+/g,"/"),t.startsWith("/")?r=Oy(t.substring(1),"/"):r=Oy(t,e)):r=e,{pathname:r,search:UA(s),hash:MA(i)}}function Oy(n,e){let t=e.replace(/\/+$/,"").split("/");return n.split("/").forEach(i=>{i===".."?t.length>1&&t.pop():i!=="."&&t.push(i)}),t.length>1?t.join("/"):"/"}function Wh(n,e,t,s){return`Cannot include a '${n}' character in a manually specified \`to.${e}\` field [${JSON.stringify(s)}].  Please separate it out to the \`to.${t}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function DA(n){return n.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function nm(n){let e=DA(n);return e.map((t,s)=>s===e.length-1?t.pathname:t.pathnameBase)}function am(n,e,t,s=!1){let i;typeof n=="string"?i=Wa(n):(i={...n},Ht(!i.pathname||!i.pathname.includes("?"),Wh("?","pathname","search",i)),Ht(!i.pathname||!i.pathname.includes("#"),Wh("#","pathname","hash",i)),Ht(!i.search||!i.search.includes("#"),Wh("#","search","hash",i)));let r=n===""||i.pathname==="",l=r?"/":i.pathname,c;if(l==null)c=t;else{let g=e.length-1;if(!s&&l.startsWith("..")){let y=l.split("/");for(;y[0]==="..";)y.shift(),g-=1;i.pathname=y.join("/")}c=g>=0?e[g]:"/"}let h=kA(i,c),u=l&&l!=="/"&&l.endsWith("/"),f=(r||l===".")&&t.endsWith("/");return!h.pathname.endsWith("/")&&(u||f)&&(h.pathname+="/"),h}var Fn=n=>n.join("/").replace(/\/\/+/g,"/"),PA=n=>n.replace(/\/+$/,"").replace(/^\/*/,"/"),UA=n=>!n||n==="?"?"":n.startsWith("?")?n:"?"+n,MA=n=>!n||n==="#"?"":n.startsWith("#")?n:"#"+n,jA=class{constructor(n,e,t,s=!1){this.status=n,this.statusText=e||"",this.internal=s,t instanceof Error?(this.data=t.toString(),this.error=t):this.data=t}};function BA(n){return n!=null&&typeof n.status=="number"&&typeof n.statusText=="string"&&typeof n.internal=="boolean"&&"data"in n}function FA(n){return n.map(e=>e.route.path).filter(Boolean).join("/").replace(/\/\/*/g,"/")||"/"}var kx=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function Dx(n,e){let t=n;if(typeof t!="string"||!OA.test(t))return{absoluteURL:void 0,isExternal:!1,to:t};let s=t,i=!1;if(kx)try{let r=new URL(window.location.href),l=t.startsWith("//")?new URL(r.protocol+t):new URL(t),c=Vn(l.pathname,e);l.origin===r.origin&&c!=null?t=c+l.search+l.hash:i=!0}catch{Pi(!1,`<Link to="${t}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}return{absoluteURL:s,isExternal:i,to:t}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var Px=["POST","PUT","PATCH","DELETE"];new Set(Px);var VA=["GET",...Px];new Set(VA);var Kr=w.createContext(null);Kr.displayName="DataRouter";var Iu=w.createContext(null);Iu.displayName="DataRouterState";var $A=w.createContext(!1),Ux=w.createContext({isTransitioning:!1});Ux.displayName="ViewTransition";var GA=w.createContext(new Map);GA.displayName="Fetchers";var HA=w.createContext(null);HA.displayName="Await";var Si=w.createContext(null);Si.displayName="Navigation";var so=w.createContext(null);so.displayName="Location";var Mi=w.createContext({outlet:null,matches:[],isDataRoute:!1});Mi.displayName="Route";var rm=w.createContext(null);rm.displayName="RouteError";var Mx="REACT_ROUTER_ERROR",zA="REDIRECT",KA="ROUTE_ERROR_RESPONSE";function YA(n){if(n.startsWith(`${Mx}:${zA}:{`))try{let e=JSON.parse(n.slice(28));if(typeof e=="object"&&e&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.location=="string"&&typeof e.reloadDocument=="boolean"&&typeof e.replace=="boolean")return e}catch{}}function qA(n){if(n.startsWith(`${Mx}:${KA}:{`))try{let e=JSON.parse(n.slice(40));if(typeof e=="object"&&e&&typeof e.status=="number"&&typeof e.statusText=="string")return new jA(e.status,e.statusText,e.data)}catch{}}function QA(n,{relative:e}={}){Ht(Yr(),"useHref() may be used only in the context of a <Router> component.");let{basename:t,navigator:s}=w.useContext(Si),{hash:i,pathname:r,search:l}=io(n,{relative:e}),c=r;return t!=="/"&&(c=r==="/"?t:Fn([t,r])),s.createHref({pathname:c,search:l,hash:i})}function Yr(){return w.useContext(so)!=null}function $n(){return Ht(Yr(),"useLocation() may be used only in the context of a <Router> component."),w.useContext(so).location}var jx="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function Bx(n){w.useContext(Si).static||w.useLayoutEffect(n)}function Ms(){let{isDataRoute:n}=w.useContext(Mi);return n?uI():WA()}function WA(){Ht(Yr(),"useNavigate() may be used only in the context of a <Router> component.");let n=w.useContext(Kr),{basename:e,navigator:t}=w.useContext(Si),{matches:s}=w.useContext(Mi),{pathname:i}=$n(),r=JSON.stringify(nm(s)),l=w.useRef(!1);return Bx(()=>{l.current=!0}),w.useCallback((h,u={})=>{if(Pi(l.current,jx),!l.current)return;if(typeof h=="number"){t.go(h);return}let f=am(h,JSON.parse(r),i,u.relative==="path");n==null&&e!=="/"&&(f.pathname=f.pathname==="/"?e:Fn([e,f.pathname])),(u.replace?t.replace:t.push)(f,u.state,u)},[e,t,r,i,n])}var XA=w.createContext(null);function ZA(n){let e=w.useContext(Mi).outlet;return w.useMemo(()=>e&&w.createElement(XA.Provider,{value:n},e),[e,n])}function _u(){let{matches:n}=w.useContext(Mi),e=n[n.length-1];return e?e.params:{}}function io(n,{relative:e}={}){let{matches:t}=w.useContext(Mi),{pathname:s}=$n(),i=JSON.stringify(nm(t));return w.useMemo(()=>am(n,JSON.parse(i),s,e==="path"),[n,i,s,e])}function JA(n,e){return Fx(n,e)}function Fx(n,e,t,s,i){Ht(Yr(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:r}=w.useContext(Si),{matches:l}=w.useContext(Mi),c=l[l.length-1],h=c?c.params:{},u=c?c.pathname:"/",f=c?c.pathnameBase:"/",g=c&&c.route;{let _=g&&g.path||"";$x(u,!g||_.endsWith("*")||_.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${u}" (under <Route path="${_}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${_}"> to <Route path="${_==="/"?"*":`${_}/*`}">.`)}let y=$n(),x;if(e){let _=typeof e=="string"?Wa(e):e;Ht(f==="/"||_.pathname?.startsWith(f),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${f}" but pathname "${_.pathname}" was given in the \`location\` prop.`),x=_}else x=y;let S=x.pathname||"/",E=S;if(f!=="/"){let _=f.replace(/^\//,"").split("/");E="/"+S.replace(/^\//,"").split("/").slice(_.length).join("/")}let T=Cx(n,{pathname:E});Pi(g||T!=null,`No routes matched location "${x.pathname}${x.search}${x.hash}" `),Pi(T==null||T[T.length-1].route.element!==void 0||T[T.length-1].route.Component!==void 0||T[T.length-1].route.lazy!==void 0,`Matched leaf route at location "${x.pathname}${x.search}${x.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let A=nI(T&&T.map(_=>Object.assign({},_,{params:Object.assign({},h,_.params),pathname:Fn([f,r.encodeLocation?r.encodeLocation(_.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:_.pathname]),pathnameBase:_.pathnameBase==="/"?f:Fn([f,r.encodeLocation?r.encodeLocation(_.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:_.pathnameBase])})),l,t,s,i);return e&&A?w.createElement(so.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...x},navigationType:"POP"}},A):A}function eI(){let n=cI(),e=BA(n)?`${n.status} ${n.statusText}`:n instanceof Error?n.message:JSON.stringify(n),t=n instanceof Error?n.stack:null,s="rgba(200,200,200, 0.5)",i={padding:"0.5rem",backgroundColor:s},r={padding:"2px 4px",backgroundColor:s},l=null;return console.error("Error handled by React Router default ErrorBoundary:",n),l=w.createElement(w.Fragment,null,w.createElement("p",null," Hey developer "),w.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",w.createElement("code",{style:r},"ErrorBoundary")," or"," ",w.createElement("code",{style:r},"errorElement")," prop on your route.")),w.createElement(w.Fragment,null,w.createElement("h2",null,"Unexpected Application Error!"),w.createElement("h3",{style:{fontStyle:"italic"}},e),t?w.createElement("pre",{style:i},t):null,l)}var tI=w.createElement(eI,null),Vx=class extends w.Component{constructor(n){super(n),this.state={location:n.location,revalidation:n.revalidation,error:n.error}}static getDerivedStateFromError(n){return{error:n}}static getDerivedStateFromProps(n,e){return e.location!==n.location||e.revalidation!=="idle"&&n.revalidation==="idle"?{error:n.error,location:n.location,revalidation:n.revalidation}:{error:n.error!==void 0?n.error:e.error,location:e.location,revalidation:n.revalidation||e.revalidation}}componentDidCatch(n,e){this.props.onError?this.props.onError(n,e):console.error("React Router caught the following error during render",n)}render(){let n=this.state.error;if(this.context&&typeof n=="object"&&n&&"digest"in n&&typeof n.digest=="string"){const t=qA(n.digest);t&&(n=t)}let e=n!==void 0?w.createElement(Mi.Provider,{value:this.props.routeContext},w.createElement(rm.Provider,{value:n,children:this.props.component})):this.props.children;return this.context?w.createElement(sI,{error:n},e):e}};Vx.contextType=$A;var Xh=new WeakMap;function sI({children:n,error:e}){let{basename:t}=w.useContext(Si);if(typeof e=="object"&&e&&"digest"in e&&typeof e.digest=="string"){let s=YA(e.digest);if(s){let i=Xh.get(e);if(i)throw i;let r=Dx(s.location,t);if(kx&&!Xh.get(e))if(r.isExternal||s.reloadDocument)window.location.href=r.absoluteURL||r.to;else{const l=Promise.resolve().then(()=>window.__reactRouterDataRouter.navigate(r.to,{replace:s.replace}));throw Xh.set(e,l),l}return w.createElement("meta",{httpEquiv:"refresh",content:`0;url=${r.absoluteURL||r.to}`})}}return n}function iI({routeContext:n,match:e,children:t}){let s=w.useContext(Kr);return s&&s.static&&s.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(s.staticContext._deepestRenderedBoundaryId=e.route.id),w.createElement(Mi.Provider,{value:n},t)}function nI(n,e=[],t=null,s=null,i=null){if(n==null){if(!t)return null;if(t.errors)n=t.matches;else if(e.length===0&&!t.initialized&&t.matches.length>0)n=t.matches;else return null}let r=n,l=t?.errors;if(l!=null){let f=r.findIndex(g=>g.route.id&&l?.[g.route.id]!==void 0);Ht(f>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(l).join(",")}`),r=r.slice(0,Math.min(r.length,f+1))}let c=!1,h=-1;if(t)for(let f=0;f<r.length;f++){let g=r[f];if((g.route.HydrateFallback||g.route.hydrateFallbackElement)&&(h=f),g.route.id){let{loaderData:y,errors:x}=t,S=g.route.loader&&!y.hasOwnProperty(g.route.id)&&(!x||x[g.route.id]===void 0);if(g.route.lazy||S){c=!0,h>=0?r=r.slice(0,h+1):r=[r[0]];break}}}let u=t&&s?(f,g)=>{s(f,{location:t.location,params:t.matches?.[0]?.params??{},unstable_pattern:FA(t.matches),errorInfo:g})}:void 0;return r.reduceRight((f,g,y)=>{let x,S=!1,E=null,T=null;t&&(x=l&&g.route.id?l[g.route.id]:void 0,E=g.route.errorElement||tI,c&&(h<0&&y===0?($x("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),S=!0,T=null):h===y&&(S=!0,T=g.route.hydrateFallbackElement||null)));let A=e.concat(r.slice(0,y+1)),_=()=>{let I;return x?I=E:S?I=T:g.route.Component?I=w.createElement(g.route.Component,null):g.route.element?I=g.route.element:I=f,w.createElement(iI,{match:g,routeContext:{outlet:f,matches:A,isDataRoute:t!=null},children:I})};return t&&(g.route.ErrorBoundary||g.route.errorElement||y===0)?w.createElement(Vx,{location:t.location,revalidation:t.revalidation,component:E,error:x,children:_(),routeContext:{outlet:null,matches:A,isDataRoute:!0},onError:u}):_()},null)}function lm(n){return`${n} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function aI(n){let e=w.useContext(Kr);return Ht(e,lm(n)),e}function rI(n){let e=w.useContext(Iu);return Ht(e,lm(n)),e}function lI(n){let e=w.useContext(Mi);return Ht(e,lm(n)),e}function om(n){let e=lI(n),t=e.matches[e.matches.length-1];return Ht(t.route.id,`${n} can only be used on routes that contain a unique "id"`),t.route.id}function oI(){return om("useRouteId")}function cI(){let n=w.useContext(rm),e=rI("useRouteError"),t=om("useRouteError");return n!==void 0?n:e.errors?.[t]}function uI(){let{router:n}=aI("useNavigate"),e=om("useNavigate"),t=w.useRef(!1);return Bx(()=>{t.current=!0}),w.useCallback(async(i,r={})=>{Pi(t.current,jx),t.current&&(typeof i=="number"?await n.navigate(i):await n.navigate(i,{fromRouteId:e,...r}))},[n,e])}var ky={};function $x(n,e,t){!e&&!ky[n]&&(ky[n]=!0,Pi(!1,t))}w.memo(dI);function dI({routes:n,future:e,state:t,onError:s}){return Fx(n,void 0,t,s,e)}function hI({to:n,replace:e,state:t,relative:s}){Ht(Yr(),"<Navigate> may be used only in the context of a <Router> component.");let{static:i}=w.useContext(Si);Pi(!i,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:r}=w.useContext(Mi),{pathname:l}=$n(),c=Ms(),h=am(n,nm(r),l,s==="path"),u=JSON.stringify(h);return w.useEffect(()=>{c(JSON.parse(u),{replace:e,state:t,relative:s})},[c,u,s,e,t]),null}function fI(n){return ZA(n.context)}function Di(n){Ht(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function mI({basename:n="/",children:e=null,location:t,navigationType:s="POP",navigator:i,static:r=!1,unstable_useTransitions:l}){Ht(!Yr(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let c=n.replace(/^\/*/,"/"),h=w.useMemo(()=>({basename:c,navigator:i,static:r,unstable_useTransitions:l,future:{}}),[c,i,r,l]);typeof t=="string"&&(t=Wa(t));let{pathname:u="/",search:f="",hash:g="",state:y=null,key:x="default"}=t,S=w.useMemo(()=>{let E=Vn(u,c);return E==null?null:{location:{pathname:E,search:f,hash:g,state:y,key:x},navigationType:s}},[c,u,f,g,y,x,s]);return Pi(S!=null,`<Router basename="${c}"> is not able to match the URL "${u}${f}${g}" because it does not start with the basename, so the <Router> won't render anything.`),S==null?null:w.createElement(Si.Provider,{value:h},w.createElement(so.Provider,{children:e,value:S}))}function pI({children:n,location:e}){return JA(Nf(n),e)}function Nf(n,e=[]){let t=[];return w.Children.forEach(n,(s,i)=>{if(!w.isValidElement(s))return;let r=[...e,i];if(s.type===w.Fragment){t.push.apply(t,Nf(s.props.children,r));return}Ht(s.type===Di,`[${typeof s.type=="string"?s.type:s.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),Ht(!s.props.index||!s.props.children,"An index route cannot have child routes.");let l={id:s.props.id||r.join("-"),caseSensitive:s.props.caseSensitive,element:s.props.element,Component:s.props.Component,index:s.props.index,path:s.props.path,middleware:s.props.middleware,loader:s.props.loader,action:s.props.action,hydrateFallbackElement:s.props.hydrateFallbackElement,HydrateFallback:s.props.HydrateFallback,errorElement:s.props.errorElement,ErrorBoundary:s.props.ErrorBoundary,hasErrorBoundary:s.props.hasErrorBoundary===!0||s.props.ErrorBoundary!=null||s.props.errorElement!=null,shouldRevalidate:s.props.shouldRevalidate,handle:s.props.handle,lazy:s.props.lazy};s.props.children&&(l.children=Nf(s.props.children,r)),t.push(l)}),t}var Wc="get",Xc="application/x-www-form-urlencoded";function Ru(n){return typeof HTMLElement<"u"&&n instanceof HTMLElement}function gI(n){return Ru(n)&&n.tagName.toLowerCase()==="button"}function yI(n){return Ru(n)&&n.tagName.toLowerCase()==="form"}function vI(n){return Ru(n)&&n.tagName.toLowerCase()==="input"}function xI(n){return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}function SI(n,e){return n.button===0&&(!e||e==="_self")&&!xI(n)}var wc=null;function bI(){if(wc===null)try{new FormData(document.createElement("form"),0),wc=!1}catch{wc=!0}return wc}var TI=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function Zh(n){return n!=null&&!TI.has(n)?(Pi(!1,`"${n}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${Xc}"`),null):n}function EI(n,e){let t,s,i,r,l;if(yI(n)){let c=n.getAttribute("action");s=c?Vn(c,e):null,t=n.getAttribute("method")||Wc,i=Zh(n.getAttribute("enctype"))||Xc,r=new FormData(n)}else if(gI(n)||vI(n)&&(n.type==="submit"||n.type==="image")){let c=n.form;if(c==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let h=n.getAttribute("formaction")||c.getAttribute("action");if(s=h?Vn(h,e):null,t=n.getAttribute("formmethod")||c.getAttribute("method")||Wc,i=Zh(n.getAttribute("formenctype"))||Zh(c.getAttribute("enctype"))||Xc,r=new FormData(c,n),!bI()){let{name:u,type:f,value:g}=n;if(f==="image"){let y=u?`${u}.`:"";r.append(`${y}x`,"0"),r.append(`${y}y`,"0")}else u&&r.append(u,g)}}else{if(Ru(n))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');t=Wc,s=null,i=Xc,l=n}return r&&i==="text/plain"&&(l=r,r=void 0),{action:s,method:t.toLowerCase(),encType:i,formData:r,body:l}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function cm(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}function AI(n,e,t,s){let i=typeof n=="string"?new URL(n,typeof window>"u"?"server://singlefetch/":window.location.origin):n;return t?i.pathname.endsWith("/")?i.pathname=`${i.pathname}_.${s}`:i.pathname=`${i.pathname}.${s}`:i.pathname==="/"?i.pathname=`_root.${s}`:e&&Vn(i.pathname,e)==="/"?i.pathname=`${e.replace(/\/$/,"")}/_root.${s}`:i.pathname=`${i.pathname.replace(/\/$/,"")}.${s}`,i}async function II(n,e){if(n.id in e)return e[n.id];try{let t=await import(n.module);return e[n.id]=t,t}catch(t){return console.error(`Error loading route module \`${n.module}\`, reloading page...`),console.error(t),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function _I(n){return n==null?!1:n.href==null?n.rel==="preload"&&typeof n.imageSrcSet=="string"&&typeof n.imageSizes=="string":typeof n.rel=="string"&&typeof n.href=="string"}async function RI(n,e,t){let s=await Promise.all(n.map(async i=>{let r=e.routes[i.route.id];if(r){let l=await II(r,t);return l.links?l.links():[]}return[]}));return NI(s.flat(1).filter(_I).filter(i=>i.rel==="stylesheet"||i.rel==="preload").map(i=>i.rel==="stylesheet"?{...i,rel:"prefetch",as:"style"}:{...i,rel:"prefetch"}))}function Dy(n,e,t,s,i,r){let l=(h,u)=>t[u]?h.route.id!==t[u].route.id:!0,c=(h,u)=>t[u].pathname!==h.pathname||t[u].route.path?.endsWith("*")&&t[u].params["*"]!==h.params["*"];return r==="assets"?e.filter((h,u)=>l(h,u)||c(h,u)):r==="data"?e.filter((h,u)=>{let f=s.routes[h.route.id];if(!f||!f.hasLoader)return!1;if(l(h,u)||c(h,u))return!0;if(h.route.shouldRevalidate){let g=h.route.shouldRevalidate({currentUrl:new URL(i.pathname+i.search+i.hash,window.origin),currentParams:t[0]?.params||{},nextUrl:new URL(n,window.origin),nextParams:h.params,defaultShouldRevalidate:!0});if(typeof g=="boolean")return g}return!0}):[]}function LI(n,e,{includeHydrateFallback:t}={}){return wI(n.map(s=>{let i=e.routes[s.route.id];if(!i)return[];let r=[i.module];return i.clientActionModule&&(r=r.concat(i.clientActionModule)),i.clientLoaderModule&&(r=r.concat(i.clientLoaderModule)),t&&i.hydrateFallbackModule&&(r=r.concat(i.hydrateFallbackModule)),i.imports&&(r=r.concat(i.imports)),r}).flat(1))}function wI(n){return[...new Set(n)]}function CI(n){let e={},t=Object.keys(n).sort();for(let s of t)e[s]=n[s];return e}function NI(n,e){let t=new Set;return new Set(e),n.reduce((s,i)=>{let r=JSON.stringify(CI(i));return t.has(r)||(t.add(r),s.push({key:r,link:i})),s},[])}function Gx(){let n=w.useContext(Kr);return cm(n,"You must render this element inside a <DataRouterContext.Provider> element"),n}function OI(){let n=w.useContext(Iu);return cm(n,"You must render this element inside a <DataRouterStateContext.Provider> element"),n}var um=w.createContext(void 0);um.displayName="FrameworkContext";function Hx(){let n=w.useContext(um);return cm(n,"You must render this element inside a <HydratedRouter> element"),n}function kI(n,e){let t=w.useContext(um),[s,i]=w.useState(!1),[r,l]=w.useState(!1),{onFocus:c,onBlur:h,onMouseEnter:u,onMouseLeave:f,onTouchStart:g}=e,y=w.useRef(null);w.useEffect(()=>{if(n==="render"&&l(!0),n==="viewport"){let E=A=>{A.forEach(_=>{l(_.isIntersecting)})},T=new IntersectionObserver(E,{threshold:.5});return y.current&&T.observe(y.current),()=>{T.disconnect()}}},[n]),w.useEffect(()=>{if(s){let E=setTimeout(()=>{l(!0)},100);return()=>{clearTimeout(E)}}},[s]);let x=()=>{i(!0)},S=()=>{i(!1),l(!1)};return t?n!=="intent"?[r,y,{}]:[r,y,{onFocus:Vl(c,x),onBlur:Vl(h,S),onMouseEnter:Vl(u,x),onMouseLeave:Vl(f,S),onTouchStart:Vl(g,x)}]:[!1,y,{}]}function Vl(n,e){return t=>{n&&n(t),t.defaultPrevented||e(t)}}function DI({page:n,...e}){let{router:t}=Gx(),s=w.useMemo(()=>Cx(t.routes,n,t.basename),[t.routes,n,t.basename]);return s?w.createElement(UI,{page:n,matches:s,...e}):null}function PI(n){let{manifest:e,routeModules:t}=Hx(),[s,i]=w.useState([]);return w.useEffect(()=>{let r=!1;return RI(n,e,t).then(l=>{r||i(l)}),()=>{r=!0}},[n,e,t]),s}function UI({page:n,matches:e,...t}){let s=$n(),{future:i,manifest:r,routeModules:l}=Hx(),{basename:c}=Gx(),{loaderData:h,matches:u}=OI(),f=w.useMemo(()=>Dy(n,e,u,r,s,"data"),[n,e,u,r,s]),g=w.useMemo(()=>Dy(n,e,u,r,s,"assets"),[n,e,u,r,s]),y=w.useMemo(()=>{if(n===s.pathname+s.search+s.hash)return[];let E=new Set,T=!1;if(e.forEach(_=>{let I=r.routes[_.route.id];!I||!I.hasLoader||(!f.some(C=>C.route.id===_.route.id)&&_.route.id in h&&l[_.route.id]?.shouldRevalidate||I.hasClientLoader?T=!0:E.add(_.route.id))}),E.size===0)return[];let A=AI(n,c,i.unstable_trailingSlashAwareDataRequests,"data");return T&&E.size>0&&A.searchParams.set("_routes",e.filter(_=>E.has(_.route.id)).map(_=>_.route.id).join(",")),[A.pathname+A.search]},[c,i.unstable_trailingSlashAwareDataRequests,h,s,r,f,e,n,l]),x=w.useMemo(()=>LI(g,r),[g,r]),S=PI(g);return w.createElement(w.Fragment,null,y.map(E=>w.createElement("link",{key:E,rel:"prefetch",as:"fetch",href:E,...t})),x.map(E=>w.createElement("link",{key:E,rel:"modulepreload",href:E,...t})),S.map(({key:E,link:T})=>w.createElement("link",{key:E,nonce:t.nonce,...T,crossOrigin:T.crossOrigin??t.crossOrigin})))}function MI(...n){return e=>{n.forEach(t=>{typeof t=="function"?t(e):t!=null&&(t.current=e)})}}var jI=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{jI&&(window.__reactRouterVersion="7.13.0")}catch{}function BI({basename:n,children:e,unstable_useTransitions:t,window:s}){let i=w.useRef();i.current==null&&(i.current=pA({window:s,v5Compat:!0}));let r=i.current,[l,c]=w.useState({action:r.action,location:r.location}),h=w.useCallback(u=>{t===!1?c(u):w.startTransition(()=>c(u))},[t]);return w.useLayoutEffect(()=>r.listen(h),[r,h]),w.createElement(mI,{basename:n,children:e,location:l.location,navigationType:l.action,navigator:r,unstable_useTransitions:t})}var zx=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,$r=w.forwardRef(function({onClick:e,discover:t="render",prefetch:s="none",relative:i,reloadDocument:r,replace:l,state:c,target:h,to:u,preventScrollReset:f,viewTransition:g,unstable_defaultShouldRevalidate:y,...x},S){let{basename:E,unstable_useTransitions:T}=w.useContext(Si),A=typeof u=="string"&&zx.test(u),_=Dx(u,E);u=_.to;let I=QA(u,{relative:i}),[C,N,D]=kI(s,x),k=GI(u,{replace:l,state:c,target:h,preventScrollReset:f,relative:i,viewTransition:g,unstable_defaultShouldRevalidate:y,unstable_useTransitions:T});function B(U){e&&e(U),U.defaultPrevented||k(U)}let j=w.createElement("a",{...x,...D,href:_.absoluteURL||I,onClick:_.isExternal||r?e:B,ref:MI(S,N),target:h,"data-discover":!A&&t==="render"?"true":void 0});return C&&!A?w.createElement(w.Fragment,null,j,w.createElement(DI,{page:I})):j});$r.displayName="Link";var FI=w.forwardRef(function({"aria-current":e="page",caseSensitive:t=!1,className:s="",end:i=!1,style:r,to:l,viewTransition:c,children:h,...u},f){let g=io(l,{relative:u.relative}),y=$n(),x=w.useContext(Iu),{navigator:S,basename:E}=w.useContext(Si),T=x!=null&&qI(g)&&c===!0,A=S.encodeLocation?S.encodeLocation(g).pathname:g.pathname,_=y.pathname,I=x&&x.navigation&&x.navigation.location?x.navigation.location.pathname:null;t||(_=_.toLowerCase(),I=I?I.toLowerCase():null,A=A.toLowerCase()),I&&E&&(I=Vn(I,E)||I);const C=A!=="/"&&A.endsWith("/")?A.length-1:A.length;let N=_===A||!i&&_.startsWith(A)&&_.charAt(C)==="/",D=I!=null&&(I===A||!i&&I.startsWith(A)&&I.charAt(A.length)==="/"),k={isActive:N,isPending:D,isTransitioning:T},B=N?e:void 0,j;typeof s=="function"?j=s(k):j=[s,N?"active":null,D?"pending":null,T?"transitioning":null].filter(Boolean).join(" ");let U=typeof r=="function"?r(k):r;return w.createElement($r,{...u,"aria-current":B,className:j,ref:f,style:U,to:l,viewTransition:c},typeof h=="function"?h(k):h)});FI.displayName="NavLink";var VI=w.forwardRef(({discover:n="render",fetcherKey:e,navigate:t,reloadDocument:s,replace:i,state:r,method:l=Wc,action:c,onSubmit:h,relative:u,preventScrollReset:f,viewTransition:g,unstable_defaultShouldRevalidate:y,...x},S)=>{let{unstable_useTransitions:E}=w.useContext(Si),T=KI(),A=YI(c,{relative:u}),_=l.toLowerCase()==="get"?"get":"post",I=typeof c=="string"&&zx.test(c),C=N=>{if(h&&h(N),N.defaultPrevented)return;N.preventDefault();let D=N.nativeEvent.submitter,k=D?.getAttribute("formmethod")||l,B=()=>T(D||N.currentTarget,{fetcherKey:e,method:k,navigate:t,replace:i,state:r,relative:u,preventScrollReset:f,viewTransition:g,unstable_defaultShouldRevalidate:y});E&&t!==!1?w.startTransition(()=>B()):B()};return w.createElement("form",{ref:S,method:_,action:A,onSubmit:s?h:C,...x,"data-discover":!I&&n==="render"?"true":void 0})});VI.displayName="Form";function $I(n){return`${n} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function Kx(n){let e=w.useContext(Kr);return Ht(e,$I(n)),e}function GI(n,{target:e,replace:t,state:s,preventScrollReset:i,relative:r,viewTransition:l,unstable_defaultShouldRevalidate:c,unstable_useTransitions:h}={}){let u=Ms(),f=$n(),g=io(n,{relative:r});return w.useCallback(y=>{if(SI(y,e)){y.preventDefault();let x=t!==void 0?t:ql(f)===ql(g),S=()=>u(n,{replace:x,state:s,preventScrollReset:i,relative:r,viewTransition:l,unstable_defaultShouldRevalidate:c});h?w.startTransition(()=>S()):S()}},[f,u,g,t,s,e,n,i,r,l,c,h])}var HI=0,zI=()=>`__${String(++HI)}__`;function KI(){let{router:n}=Kx("useSubmit"),{basename:e}=w.useContext(Si),t=oI(),s=n.fetch,i=n.navigate;return w.useCallback(async(r,l={})=>{let{action:c,method:h,encType:u,formData:f,body:g}=EI(r,e);if(l.navigate===!1){let y=l.fetcherKey||zI();await s(y,t,l.action||c,{unstable_defaultShouldRevalidate:l.unstable_defaultShouldRevalidate,preventScrollReset:l.preventScrollReset,formData:f,body:g,formMethod:l.method||h,formEncType:l.encType||u,flushSync:l.flushSync})}else await i(l.action||c,{unstable_defaultShouldRevalidate:l.unstable_defaultShouldRevalidate,preventScrollReset:l.preventScrollReset,formData:f,body:g,formMethod:l.method||h,formEncType:l.encType||u,replace:l.replace,state:l.state,fromRouteId:t,flushSync:l.flushSync,viewTransition:l.viewTransition})},[s,i,e,t])}function YI(n,{relative:e}={}){let{basename:t}=w.useContext(Si),s=w.useContext(Mi);Ht(s,"useFormAction must be used inside a RouteContext");let[i]=s.matches.slice(-1),r={...io(n||".",{relative:e})},l=$n();if(n==null){r.search=l.search;let c=new URLSearchParams(r.search),h=c.getAll("index");if(h.some(f=>f==="")){c.delete("index"),h.filter(g=>g).forEach(g=>c.append("index",g));let f=c.toString();r.search=f?`?${f}`:""}}return(!n||n===".")&&i.route.index&&(r.search=r.search?r.search.replace(/^\?/,"?index&"):"?index"),t!=="/"&&(r.pathname=r.pathname==="/"?t:Fn([t,r.pathname])),ql(r)}function qI(n,{relative:e}={}){let t=w.useContext(Ux);Ht(t!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:s}=Kx("useViewTransitionState"),i=io(n,{relative:e});if(!t.isTransitioning)return!1;let r=Vn(t.currentLocation.pathname,s)||t.currentLocation.pathname,l=Vn(t.nextLocation.pathname,s)||t.nextLocation.pathname;return cu(i.pathname,l)!=null||cu(i.pathname,r)!=null}var QI=wx();const Yx=w.createContext(),WI={"#ff7e00":"https://raw.githubusercontent.com/gorillasuti/Legitflix-plugin/refs/heads/main/legitflix-client/public/default-logo-orange.png","#00aaff":"https://raw.githubusercontent.com/gorillasuti/Legitflix-plugin/refs/heads/main/legitflix-client/public/default-logo-blue.png","#00ff7e":"https://raw.githubusercontent.com/gorillasuti/Legitflix-plugin/refs/heads/main/legitflix-client/public/default-logo-green.png","#ff3333":"https://raw.githubusercontent.com/gorillasuti/Legitflix-plugin/refs/heads/main/legitflix-client/public/default-logo-red.png","#aa00ff":"https://raw.githubusercontent.com/gorillasuti/Legitflix-plugin/refs/heads/main/legitflix-client/public/default-logo-purple.png","#ff00aa":"https://raw.githubusercontent.com/gorillasuti/Legitflix-plugin/refs/heads/main/legitflix-client/public/default-logo-purple.png"},no=n=>WI[n?.toLowerCase()]||"https://raw.githubusercontent.com/gorillasuti/Legitflix-plugin/refs/heads/main/legitflix-client/public/default-logo-orange.png",Yi=()=>w.useContext(Yx),XI=({children:n})=>{const[e,t]=w.useState({heroMediaTypes:"Movie,Series",promoMediaTypes:["Movie","Series"],contentTypeFilters:{Movie:!0,Series:!0,MusicAlbum:!1,Audio:!1,MusicVideo:!1},contentSortMode:"latest",heroLimit:20,enableJellyseerr:!0,jellyseerrUrl:"https://request.legitflix.eu",jellyseerrBackground:null,jellyseerrText:"Request Feature",logoType:"text",logoUrl:"",appName:"LegitFlix",fastForwardTime:10,rewindTime:10,hideBackdrop:!1,disableThemeSong:!1,enableSnow:!1,accentColor:"#ff7e00",showNavbarCategories:!0,showNavbarRequests:!0,showLibraryTitles:!0,appBackground:null,playerSeekForward:30,playerSeekBackward:10,defaultAudioLanguage:"auto",defaultSubtitleLanguage:"auto",prioritizeAudioLanguage:!1});w.useEffect(()=>{const c=localStorage.getItem("LegitFlix_Config");if(c)try{const h=JSON.parse(c);t(u=>({...u,...h})),h.accentColor&&s(h.accentColor),h.faviconUrl&&i(h.faviconUrl),r(h.subtitleSize,h.subtitleColor,h.subtitleBackground)}catch(h){console.error("Failed to parse local config",h)}else s(e.accentColor),r(e.subtitleSize,e.subtitleColor,e.subtitleBackground)},[]);const s=c=>{document.documentElement.style.setProperty("--clr-accent",c);const h=parseInt(c.slice(1,3),16),u=parseInt(c.slice(3,5),16),f=parseInt(c.slice(5,7),16);document.documentElement.style.setProperty("--clr-accent-glow",`rgba(${h}, ${u}, ${f}, 0.5)`)},i=c=>{let h=document.querySelector("link[rel~='icon']");h||(h=document.createElement("link"),h.rel="icon",document.head.appendChild(h)),h.href=c||"/favicon.png"},r=(c,h,u)=>{const f=document.documentElement;f.style.setProperty("--lf-sub-size",c||"100%"),f.style.setProperty("--lf-sub-color",h||"#ffffff");let g="0px 1px 2px rgba(0,0,0,0.8)",y="transparent";u==="drop-shadow"?g="0px 2px 4px rgba(0,0,0,0.9)":u==="outline"?g="-1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000":u==="box"?(y="rgba(0,0,0,0.7)",g="none"):u==="none"&&(g="none"),f.style.setProperty("--lf-sub-shadow",g),f.style.setProperty("--lf-sub-bg",y)},l=c=>{t(h=>{const u={...h,...c};return localStorage.setItem("LegitFlix_Config",JSON.stringify(u)),c.accentColor&&s(c.accentColor),c.faviconUrl!==void 0&&i(c.faviconUrl),(c.subtitleSize!==void 0||c.subtitleColor!==void 0||c.subtitleBackground!==void 0)&&r(u.subtitleSize,u.subtitleColor,u.subtitleBackground),u})};return p.jsx(Yx.Provider,{value:{config:e,updateConfig:l},children:n})};var Js;(function(n){n[n.GREAT=2]="GREAT",n[n.GOOD=1]="GOOD",n[n.OK=0]="OK",n[n.BAD=-1]="BAD"})(Js||(Js={}));const uu="http:",du="https:",ZI=80,JI=443;function e_(n){if(n=n.trim(),/^data:/i.test(n))throw new Error("data URLs are not supported");if(/^view-source:/i.test(n))throw new Error("`view-source:` is not supported as it is a non-standard protocol");if(!n.startsWith("//")&&/^\.*\//.test(n)||(n=n.replace(/^(?!(?:\w+:)?\/\/)|^\/\//,uu)),!/^https?:/i.test(n))throw new Error("only http or https protocols are supported");const s=new URL(n);if(s.hash="",s.pathname){const i=/\b[a-z][a-z\d+\-.]{1,50}:\/\//g;let r=0,l="";for(;;){const h=i.exec(s.pathname);if(!h)break;const u=h[0],f=h.index,g=s.pathname.slice(r,f);l+=g.replace(/\/{2,}/g,"/"),l+=u,r=f+u.length}const c=s.pathname.slice(r,s.pathname.length);l+=c.replace(/\/{2,}/g,"/"),s.pathname=l}if(s.pathname)try{s.pathname=decodeURI(s.pathname)}catch{}return s.hostname&&(s.hostname=s.hostname.replace(/\.$/,"")),s.search="",s.pathname=s.pathname.replace(/\/$/,""),n=s.toString(),n}function Cc(n){return new URL(n.toString())}function qx(n){if(n===uu)return ZI;if(n===du)return JI;throw new Error("Unsupported protocol")}function t_(n,e){const t=e.port||qx(e.protocol);return n.toLowerCase().startsWith(`${e.protocol}//${e.hostname.toLowerCase()}:${t}`)}function Qx(n){return!n.port||n.port===qx(n.protocol).toString()}function s_(n){if(!n?.trim())throw new Error("Input is required");return new URL(e_(n))}const Of=8096,Wx=8920;function Py(n){let e=0;return n.protocol===du?e+=5:e-=5,n.port===Of.toString()?e+=2:n.port===Wx.toString()&&(e-=1),Qx(n)&&(e+=3),e}function i_(n){const e=[];try{const t=s_(n);if(t_(n,t))return[t.toString()];if(e.push(t),t.protocol===uu){const s=Cc(t);s.protocol=du,e.push(s)}return e.filter(Qx).forEach(s=>{if(s.protocol===uu){const i=Cc(s);i.port=Of.toString(),e.push(i)}else if(s.protocol===du){let i=Cc(s);i.port=Of.toString(),e.push(i),i=Cc(s),i.port=Wx.toString(),e.push(i)}}),e.sort((s,i)=>Py(i)-Py(s)),e.map(s=>s.toString())}catch(t){return console.warn(t),[]}}class qr{}class n_ extends qr{constructor(e){super(),this.productName=e}}class a_ extends qr{constructor(e){super(),this.responseTime=e}}class r_ extends qr{constructor(e){super(),this.error=e}}class Uy extends qr{}class l_ extends qr{constructor(e){super(),this.version=e}}class o_ extends qr{constructor(e){super(),this.version=e}}function Xx(n,e){return function(){return n.apply(e,arguments)}}const{toString:c_}=Object.prototype,{getPrototypeOf:dm}=Object,{iterator:Lu,toStringTag:Zx}=Symbol,wu=(n=>e=>{const t=c_.call(e);return n[t]||(n[t]=t.slice(8,-1).toLowerCase())})(Object.create(null)),qi=n=>(n=n.toLowerCase(),e=>wu(e)===n),Cu=n=>e=>typeof e===n,{isArray:Qr}=Array,Gr=Cu("undefined");function ao(n){return n!==null&&!Gr(n)&&n.constructor!==null&&!Gr(n.constructor)&&ti(n.constructor.isBuffer)&&n.constructor.isBuffer(n)}const Jx=qi("ArrayBuffer");function u_(n){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(n):e=n&&n.buffer&&Jx(n.buffer),e}const d_=Cu("string"),ti=Cu("function"),eS=Cu("number"),ro=n=>n!==null&&typeof n=="object",h_=n=>n===!0||n===!1,Zc=n=>{if(wu(n)!=="object")return!1;const e=dm(n);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Zx in n)&&!(Lu in n)},f_=n=>{if(!ro(n)||ao(n))return!1;try{return Object.keys(n).length===0&&Object.getPrototypeOf(n)===Object.prototype}catch{return!1}},m_=qi("Date"),p_=qi("File"),g_=qi("Blob"),y_=qi("FileList"),v_=n=>ro(n)&&ti(n.pipe),x_=n=>{let e;return n&&(typeof FormData=="function"&&n instanceof FormData||ti(n.append)&&((e=wu(n))==="formdata"||e==="object"&&ti(n.toString)&&n.toString()==="[object FormData]"))},S_=qi("URLSearchParams"),[b_,T_,E_,A_]=["ReadableStream","Request","Response","Headers"].map(qi),I_=n=>n.trim?n.trim():n.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function lo(n,e,{allOwnKeys:t=!1}={}){if(n===null||typeof n>"u")return;let s,i;if(typeof n!="object"&&(n=[n]),Qr(n))for(s=0,i=n.length;s<i;s++)e.call(null,n[s],s,n);else{if(ao(n))return;const r=t?Object.getOwnPropertyNames(n):Object.keys(n),l=r.length;let c;for(s=0;s<l;s++)c=r[s],e.call(null,n[c],c,n)}}function tS(n,e){if(ao(n))return null;e=e.toLowerCase();const t=Object.keys(n);let s=t.length,i;for(;s-- >0;)if(i=t[s],e===i.toLowerCase())return i;return null}const za=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,sS=n=>!Gr(n)&&n!==za;function kf(){const{caseless:n,skipUndefined:e}=sS(this)&&this||{},t={},s=(i,r)=>{if(r==="__proto__"||r==="constructor"||r==="prototype")return;const l=n&&tS(t,r)||r;Zc(t[l])&&Zc(i)?t[l]=kf(t[l],i):Zc(i)?t[l]=kf({},i):Qr(i)?t[l]=i.slice():(!e||!Gr(i))&&(t[l]=i)};for(let i=0,r=arguments.length;i<r;i++)arguments[i]&&lo(arguments[i],s);return t}const __=(n,e,t,{allOwnKeys:s}={})=>(lo(e,(i,r)=>{t&&ti(i)?Object.defineProperty(n,r,{value:Xx(i,t),writable:!0,enumerable:!0,configurable:!0}):Object.defineProperty(n,r,{value:i,writable:!0,enumerable:!0,configurable:!0})},{allOwnKeys:s}),n),R_=n=>(n.charCodeAt(0)===65279&&(n=n.slice(1)),n),L_=(n,e,t,s)=>{n.prototype=Object.create(e.prototype,s),Object.defineProperty(n.prototype,"constructor",{value:n,writable:!0,enumerable:!1,configurable:!0}),Object.defineProperty(n,"super",{value:e.prototype}),t&&Object.assign(n.prototype,t)},w_=(n,e,t,s)=>{let i,r,l;const c={};if(e=e||{},n==null)return e;do{for(i=Object.getOwnPropertyNames(n),r=i.length;r-- >0;)l=i[r],(!s||s(l,n,e))&&!c[l]&&(e[l]=n[l],c[l]=!0);n=t!==!1&&dm(n)}while(n&&(!t||t(n,e))&&n!==Object.prototype);return e},C_=(n,e,t)=>{n=String(n),(t===void 0||t>n.length)&&(t=n.length),t-=e.length;const s=n.indexOf(e,t);return s!==-1&&s===t},N_=n=>{if(!n)return null;if(Qr(n))return n;let e=n.length;if(!eS(e))return null;const t=new Array(e);for(;e-- >0;)t[e]=n[e];return t},O_=(n=>e=>n&&e instanceof n)(typeof Uint8Array<"u"&&dm(Uint8Array)),k_=(n,e)=>{const s=(n&&n[Lu]).call(n);let i;for(;(i=s.next())&&!i.done;){const r=i.value;e.call(n,r[0],r[1])}},D_=(n,e)=>{let t;const s=[];for(;(t=n.exec(e))!==null;)s.push(t);return s},P_=qi("HTMLFormElement"),U_=n=>n.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,s,i){return s.toUpperCase()+i}),My=(({hasOwnProperty:n})=>(e,t)=>n.call(e,t))(Object.prototype),M_=qi("RegExp"),iS=(n,e)=>{const t=Object.getOwnPropertyDescriptors(n),s={};lo(t,(i,r)=>{let l;(l=e(i,r,n))!==!1&&(s[r]=l||i)}),Object.defineProperties(n,s)},j_=n=>{iS(n,(e,t)=>{if(ti(n)&&["arguments","caller","callee"].indexOf(t)!==-1)return!1;const s=n[t];if(ti(s)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+t+"'")})}})},B_=(n,e)=>{const t={},s=i=>{i.forEach(r=>{t[r]=!0})};return Qr(n)?s(n):s(String(n).split(e)),t},F_=()=>{},V_=(n,e)=>n!=null&&Number.isFinite(n=+n)?n:e;function $_(n){return!!(n&&ti(n.append)&&n[Zx]==="FormData"&&n[Lu])}const G_=n=>{const e=new Array(10),t=(s,i)=>{if(ro(s)){if(e.indexOf(s)>=0)return;if(ao(s))return s;if(!("toJSON"in s)){e[i]=s;const r=Qr(s)?[]:{};return lo(s,(l,c)=>{const h=t(l,i+1);!Gr(h)&&(r[c]=h)}),e[i]=void 0,r}}return s};return t(n,0)},H_=qi("AsyncFunction"),z_=n=>n&&(ro(n)||ti(n))&&ti(n.then)&&ti(n.catch),nS=((n,e)=>n?setImmediate:e?((t,s)=>(za.addEventListener("message",({source:i,data:r})=>{i===za&&r===t&&s.length&&s.shift()()},!1),i=>{s.push(i),za.postMessage(t,"*")}))(`axios@${Math.random()}`,[]):t=>setTimeout(t))(typeof setImmediate=="function",ti(za.postMessage)),K_=typeof queueMicrotask<"u"?queueMicrotask.bind(za):typeof process<"u"&&process.nextTick||nS,Y_=n=>n!=null&&ti(n[Lu]),se={isArray:Qr,isArrayBuffer:Jx,isBuffer:ao,isFormData:x_,isArrayBufferView:u_,isString:d_,isNumber:eS,isBoolean:h_,isObject:ro,isPlainObject:Zc,isEmptyObject:f_,isReadableStream:b_,isRequest:T_,isResponse:E_,isHeaders:A_,isUndefined:Gr,isDate:m_,isFile:p_,isBlob:g_,isRegExp:M_,isFunction:ti,isStream:v_,isURLSearchParams:S_,isTypedArray:O_,isFileList:y_,forEach:lo,merge:kf,extend:__,trim:I_,stripBOM:R_,inherits:L_,toFlatObject:w_,kindOf:wu,kindOfTest:qi,endsWith:C_,toArray:N_,forEachEntry:k_,matchAll:D_,isHTMLForm:P_,hasOwnProperty:My,hasOwnProp:My,reduceDescriptors:iS,freezeMethods:j_,toObjectSet:B_,toCamelCase:U_,noop:F_,toFiniteNumber:V_,findKey:tS,global:za,isContextDefined:sS,isSpecCompliantForm:$_,toJSONObject:G_,isAsyncFn:H_,isThenable:z_,setImmediate:nS,asap:K_,isIterable:Y_};let Ke=class aS extends Error{static from(e,t,s,i,r,l){const c=new aS(e.message,t||e.code,s,i,r);return c.cause=e,c.name=e.name,l&&Object.assign(c,l),c}constructor(e,t,s,i,r){super(e),this.name="AxiosError",this.isAxiosError=!0,t&&(this.code=t),s&&(this.config=s),i&&(this.request=i),r&&(this.response=r,this.status=r.status)}toJSON(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:se.toJSONObject(this.config),code:this.code,status:this.status}}};Ke.ERR_BAD_OPTION_VALUE="ERR_BAD_OPTION_VALUE";Ke.ERR_BAD_OPTION="ERR_BAD_OPTION";Ke.ECONNABORTED="ECONNABORTED";Ke.ETIMEDOUT="ETIMEDOUT";Ke.ERR_NETWORK="ERR_NETWORK";Ke.ERR_FR_TOO_MANY_REDIRECTS="ERR_FR_TOO_MANY_REDIRECTS";Ke.ERR_DEPRECATED="ERR_DEPRECATED";Ke.ERR_BAD_RESPONSE="ERR_BAD_RESPONSE";Ke.ERR_BAD_REQUEST="ERR_BAD_REQUEST";Ke.ERR_CANCELED="ERR_CANCELED";Ke.ERR_NOT_SUPPORT="ERR_NOT_SUPPORT";Ke.ERR_INVALID_URL="ERR_INVALID_URL";const q_=null;function Df(n){return se.isPlainObject(n)||se.isArray(n)}function rS(n){return se.endsWith(n,"[]")?n.slice(0,-2):n}function jy(n,e,t){return n?n.concat(e).map(function(i,r){return i=rS(i),!t&&r?"["+i+"]":i}).join(t?".":""):e}function Q_(n){return se.isArray(n)&&!n.some(Df)}const W_=se.toFlatObject(se,{},null,function(e){return/^is[A-Z]/.test(e)});function Nu(n,e,t){if(!se.isObject(n))throw new TypeError("target must be an object");e=e||new FormData,t=se.toFlatObject(t,{metaTokens:!0,dots:!1,indexes:!1},!1,function(E,T){return!se.isUndefined(T[E])});const s=t.metaTokens,i=t.visitor||f,r=t.dots,l=t.indexes,h=(t.Blob||typeof Blob<"u"&&Blob)&&se.isSpecCompliantForm(e);if(!se.isFunction(i))throw new TypeError("visitor must be a function");function u(S){if(S===null)return"";if(se.isDate(S))return S.toISOString();if(se.isBoolean(S))return S.toString();if(!h&&se.isBlob(S))throw new Ke("Blob is not supported. Use a Buffer instead.");return se.isArrayBuffer(S)||se.isTypedArray(S)?h&&typeof Blob=="function"?new Blob([S]):Buffer.from(S):S}function f(S,E,T){let A=S;if(S&&!T&&typeof S=="object"){if(se.endsWith(E,"{}"))E=s?E:E.slice(0,-2),S=JSON.stringify(S);else if(se.isArray(S)&&Q_(S)||(se.isFileList(S)||se.endsWith(E,"[]"))&&(A=se.toArray(S)))return E=rS(E),A.forEach(function(I,C){!(se.isUndefined(I)||I===null)&&e.append(l===!0?jy([E],C,r):l===null?E:E+"[]",u(I))}),!1}return Df(S)?!0:(e.append(jy(T,E,r),u(S)),!1)}const g=[],y=Object.assign(W_,{defaultVisitor:f,convertValue:u,isVisitable:Df});function x(S,E){if(!se.isUndefined(S)){if(g.indexOf(S)!==-1)throw Error("Circular reference detected in "+E.join("."));g.push(S),se.forEach(S,function(A,_){(!(se.isUndefined(A)||A===null)&&i.call(e,A,se.isString(_)?_.trim():_,E,y))===!0&&x(A,E?E.concat(_):[_])}),g.pop()}}if(!se.isObject(n))throw new TypeError("data must be an object");return x(n),e}function By(n){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(n).replace(/[!'()~]|%20|%00/g,function(s){return e[s]})}function hm(n,e){this._pairs=[],n&&Nu(n,this,e)}const lS=hm.prototype;lS.append=function(e,t){this._pairs.push([e,t])};lS.toString=function(e){const t=e?function(s){return e.call(this,s,By)}:By;return this._pairs.map(function(i){return t(i[0])+"="+t(i[1])},"").join("&")};function X_(n){return encodeURIComponent(n).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function oS(n,e,t){if(!e)return n;const s=t&&t.encode||X_,i=se.isFunction(t)?{serialize:t}:t,r=i&&i.serialize;let l;if(r?l=r(e,i):l=se.isURLSearchParams(e)?e.toString():new hm(e,i).toString(s),l){const c=n.indexOf("#");c!==-1&&(n=n.slice(0,c)),n+=(n.indexOf("?")===-1?"?":"&")+l}return n}class Fy{constructor(){this.handlers=[]}use(e,t,s){return this.handlers.push({fulfilled:e,rejected:t,synchronous:s?s.synchronous:!1,runWhen:s?s.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){se.forEach(this.handlers,function(s){s!==null&&e(s)})}}const fm={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1,legacyInterceptorReqResOrdering:!0},Z_=typeof URLSearchParams<"u"?URLSearchParams:hm,J_=typeof FormData<"u"?FormData:null,eR=typeof Blob<"u"?Blob:null,tR={isBrowser:!0,classes:{URLSearchParams:Z_,FormData:J_,Blob:eR},protocols:["http","https","file","blob","url","data"]},mm=typeof window<"u"&&typeof document<"u",Pf=typeof navigator=="object"&&navigator||void 0,sR=mm&&(!Pf||["ReactNative","NativeScript","NS"].indexOf(Pf.product)<0),iR=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",nR=mm&&window.location.href||"http://localhost",aR=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:mm,hasStandardBrowserEnv:sR,hasStandardBrowserWebWorkerEnv:iR,navigator:Pf,origin:nR},Symbol.toStringTag,{value:"Module"})),Us={...aR,...tR};function rR(n,e){return Nu(n,new Us.classes.URLSearchParams,{visitor:function(t,s,i,r){return Us.isNode&&se.isBuffer(t)?(this.append(s,t.toString("base64")),!1):r.defaultVisitor.apply(this,arguments)},...e})}function lR(n){return se.matchAll(/\w+|\[(\w*)]/g,n).map(e=>e[0]==="[]"?"":e[1]||e[0])}function oR(n){const e={},t=Object.keys(n);let s;const i=t.length;let r;for(s=0;s<i;s++)r=t[s],e[r]=n[r];return e}function cS(n){function e(t,s,i,r){let l=t[r++];if(l==="__proto__")return!0;const c=Number.isFinite(+l),h=r>=t.length;return l=!l&&se.isArray(i)?i.length:l,h?(se.hasOwnProp(i,l)?i[l]=[i[l],s]:i[l]=s,!c):((!i[l]||!se.isObject(i[l]))&&(i[l]=[]),e(t,s,i[l],r)&&se.isArray(i[l])&&(i[l]=oR(i[l])),!c)}if(se.isFormData(n)&&se.isFunction(n.entries)){const t={};return se.forEachEntry(n,(s,i)=>{e(lR(s),i,t,0)}),t}return null}function cR(n,e,t){if(se.isString(n))try{return(e||JSON.parse)(n),se.trim(n)}catch(s){if(s.name!=="SyntaxError")throw s}return(t||JSON.stringify)(n)}const oo={transitional:fm,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const s=t.getContentType()||"",i=s.indexOf("application/json")>-1,r=se.isObject(e);if(r&&se.isHTMLForm(e)&&(e=new FormData(e)),se.isFormData(e))return i?JSON.stringify(cS(e)):e;if(se.isArrayBuffer(e)||se.isBuffer(e)||se.isStream(e)||se.isFile(e)||se.isBlob(e)||se.isReadableStream(e))return e;if(se.isArrayBufferView(e))return e.buffer;if(se.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let c;if(r){if(s.indexOf("application/x-www-form-urlencoded")>-1)return rR(e,this.formSerializer).toString();if((c=se.isFileList(e))||s.indexOf("multipart/form-data")>-1){const h=this.env&&this.env.FormData;return Nu(c?{"files[]":e}:e,h&&new h,this.formSerializer)}}return r||i?(t.setContentType("application/json",!1),cR(e)):e}],transformResponse:[function(e){const t=this.transitional||oo.transitional,s=t&&t.forcedJSONParsing,i=this.responseType==="json";if(se.isResponse(e)||se.isReadableStream(e))return e;if(e&&se.isString(e)&&(s&&!this.responseType||i)){const l=!(t&&t.silentJSONParsing)&&i;try{return JSON.parse(e,this.parseReviver)}catch(c){if(l)throw c.name==="SyntaxError"?Ke.from(c,Ke.ERR_BAD_RESPONSE,this,null,this.response):c}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Us.classes.FormData,Blob:Us.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};se.forEach(["delete","get","head","post","put","patch"],n=>{oo.headers[n]={}});const uR=se.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),dR=n=>{const e={};let t,s,i;return n&&n.split(`
`).forEach(function(l){i=l.indexOf(":"),t=l.substring(0,i).trim().toLowerCase(),s=l.substring(i+1).trim(),!(!t||e[t]&&uR[t])&&(t==="set-cookie"?e[t]?e[t].push(s):e[t]=[s]:e[t]=e[t]?e[t]+", "+s:s)}),e},Vy=Symbol("internals");function $l(n){return n&&String(n).trim().toLowerCase()}function Jc(n){return n===!1||n==null?n:se.isArray(n)?n.map(Jc):String(n)}function hR(n){const e=Object.create(null),t=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let s;for(;s=t.exec(n);)e[s[1]]=s[2];return e}const fR=n=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(n.trim());function Jh(n,e,t,s,i){if(se.isFunction(s))return s.call(this,e,t);if(i&&(e=t),!!se.isString(e)){if(se.isString(s))return e.indexOf(s)!==-1;if(se.isRegExp(s))return s.test(e)}}function mR(n){return n.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,s)=>t.toUpperCase()+s)}function pR(n,e){const t=se.toCamelCase(" "+e);["get","set","has"].forEach(s=>{Object.defineProperty(n,s+t,{value:function(i,r,l){return this[s].call(this,e,i,r,l)},configurable:!0})})}let si=class{constructor(e){e&&this.set(e)}set(e,t,s){const i=this;function r(c,h,u){const f=$l(h);if(!f)throw new Error("header name must be a non-empty string");const g=se.findKey(i,f);(!g||i[g]===void 0||u===!0||u===void 0&&i[g]!==!1)&&(i[g||h]=Jc(c))}const l=(c,h)=>se.forEach(c,(u,f)=>r(u,f,h));if(se.isPlainObject(e)||e instanceof this.constructor)l(e,t);else if(se.isString(e)&&(e=e.trim())&&!fR(e))l(dR(e),t);else if(se.isObject(e)&&se.isIterable(e)){let c={},h,u;for(const f of e){if(!se.isArray(f))throw TypeError("Object iterator must return a key-value pair");c[u=f[0]]=(h=c[u])?se.isArray(h)?[...h,f[1]]:[h,f[1]]:f[1]}l(c,t)}else e!=null&&r(t,e,s);return this}get(e,t){if(e=$l(e),e){const s=se.findKey(this,e);if(s){const i=this[s];if(!t)return i;if(t===!0)return hR(i);if(se.isFunction(t))return t.call(this,i,s);if(se.isRegExp(t))return t.exec(i);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=$l(e),e){const s=se.findKey(this,e);return!!(s&&this[s]!==void 0&&(!t||Jh(this,this[s],s,t)))}return!1}delete(e,t){const s=this;let i=!1;function r(l){if(l=$l(l),l){const c=se.findKey(s,l);c&&(!t||Jh(s,s[c],c,t))&&(delete s[c],i=!0)}}return se.isArray(e)?e.forEach(r):r(e),i}clear(e){const t=Object.keys(this);let s=t.length,i=!1;for(;s--;){const r=t[s];(!e||Jh(this,this[r],r,e,!0))&&(delete this[r],i=!0)}return i}normalize(e){const t=this,s={};return se.forEach(this,(i,r)=>{const l=se.findKey(s,r);if(l){t[l]=Jc(i),delete t[r];return}const c=e?mR(r):String(r).trim();c!==r&&delete t[r],t[c]=Jc(i),s[c]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return se.forEach(this,(s,i)=>{s!=null&&s!==!1&&(t[i]=e&&se.isArray(s)?s.join(", "):s)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const s=new this(e);return t.forEach(i=>s.set(i)),s}static accessor(e){const s=(this[Vy]=this[Vy]={accessors:{}}).accessors,i=this.prototype;function r(l){const c=$l(l);s[c]||(pR(i,l),s[c]=!0)}return se.isArray(e)?e.forEach(r):r(e),this}};si.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);se.reduceDescriptors(si.prototype,({value:n},e)=>{let t=e[0].toUpperCase()+e.slice(1);return{get:()=>n,set(s){this[t]=s}}});se.freezeMethods(si);function ef(n,e){const t=this||oo,s=e||t,i=si.from(s.headers);let r=s.data;return se.forEach(n,function(c){r=c.call(t,r,i.normalize(),e?e.status:void 0)}),i.normalize(),r}function uS(n){return!!(n&&n.__CANCEL__)}let co=class extends Ke{constructor(e,t,s){super(e??"canceled",Ke.ERR_CANCELED,t,s),this.name="CanceledError",this.__CANCEL__=!0}};function dS(n,e,t){const s=t.config.validateStatus;!t.status||!s||s(t.status)?n(t):e(new Ke("Request failed with status code "+t.status,[Ke.ERR_BAD_REQUEST,Ke.ERR_BAD_RESPONSE][Math.floor(t.status/100)-4],t.config,t.request,t))}function gR(n){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(n);return e&&e[1]||""}function yR(n,e){n=n||10;const t=new Array(n),s=new Array(n);let i=0,r=0,l;return e=e!==void 0?e:1e3,function(h){const u=Date.now(),f=s[r];l||(l=u),t[i]=h,s[i]=u;let g=r,y=0;for(;g!==i;)y+=t[g++],g=g%n;if(i=(i+1)%n,i===r&&(r=(r+1)%n),u-l<e)return;const x=f&&u-f;return x?Math.round(y*1e3/x):void 0}}function vR(n,e){let t=0,s=1e3/e,i,r;const l=(u,f=Date.now())=>{t=f,i=null,r&&(clearTimeout(r),r=null),n(...u)};return[(...u)=>{const f=Date.now(),g=f-t;g>=s?l(u,f):(i=u,r||(r=setTimeout(()=>{r=null,l(i)},s-g)))},()=>i&&l(i)]}const hu=(n,e,t=3)=>{let s=0;const i=yR(50,250);return vR(r=>{const l=r.loaded,c=r.lengthComputable?r.total:void 0,h=l-s,u=i(h),f=l<=c;s=l;const g={loaded:l,total:c,progress:c?l/c:void 0,bytes:h,rate:u||void 0,estimated:u&&c&&f?(c-l)/u:void 0,event:r,lengthComputable:c!=null,[e?"download":"upload"]:!0};n(g)},t)},$y=(n,e)=>{const t=n!=null;return[s=>e[0]({lengthComputable:t,total:n,loaded:s}),e[1]]},Gy=n=>(...e)=>se.asap(()=>n(...e)),xR=Us.hasStandardBrowserEnv?((n,e)=>t=>(t=new URL(t,Us.origin),n.protocol===t.protocol&&n.host===t.host&&(e||n.port===t.port)))(new URL(Us.origin),Us.navigator&&/(msie|trident)/i.test(Us.navigator.userAgent)):()=>!0,SR=Us.hasStandardBrowserEnv?{write(n,e,t,s,i,r,l){if(typeof document>"u")return;const c=[`${n}=${encodeURIComponent(e)}`];se.isNumber(t)&&c.push(`expires=${new Date(t).toUTCString()}`),se.isString(s)&&c.push(`path=${s}`),se.isString(i)&&c.push(`domain=${i}`),r===!0&&c.push("secure"),se.isString(l)&&c.push(`SameSite=${l}`),document.cookie=c.join("; ")},read(n){if(typeof document>"u")return null;const e=document.cookie.match(new RegExp("(?:^|; )"+n+"=([^;]*)"));return e?decodeURIComponent(e[1]):null},remove(n){this.write(n,"",Date.now()-864e5,"/")}}:{write(){},read(){return null},remove(){}};function bR(n){return typeof n!="string"?!1:/^([a-z][a-z\d+\-.]*:)?\/\//i.test(n)}function TR(n,e){return e?n.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):n}function hS(n,e,t){let s=!bR(e);return n&&(s||t==!1)?TR(n,e):e}const Hy=n=>n instanceof si?{...n}:n;function qa(n,e){e=e||{};const t={};function s(u,f,g,y){return se.isPlainObject(u)&&se.isPlainObject(f)?se.merge.call({caseless:y},u,f):se.isPlainObject(f)?se.merge({},f):se.isArray(f)?f.slice():f}function i(u,f,g,y){if(se.isUndefined(f)){if(!se.isUndefined(u))return s(void 0,u,g,y)}else return s(u,f,g,y)}function r(u,f){if(!se.isUndefined(f))return s(void 0,f)}function l(u,f){if(se.isUndefined(f)){if(!se.isUndefined(u))return s(void 0,u)}else return s(void 0,f)}function c(u,f,g){if(g in e)return s(u,f);if(g in n)return s(void 0,u)}const h={url:r,method:r,data:r,baseURL:l,transformRequest:l,transformResponse:l,paramsSerializer:l,timeout:l,timeoutMessage:l,withCredentials:l,withXSRFToken:l,adapter:l,responseType:l,xsrfCookieName:l,xsrfHeaderName:l,onUploadProgress:l,onDownloadProgress:l,decompress:l,maxContentLength:l,maxBodyLength:l,beforeRedirect:l,transport:l,httpAgent:l,httpsAgent:l,cancelToken:l,socketPath:l,responseEncoding:l,validateStatus:c,headers:(u,f,g)=>i(Hy(u),Hy(f),g,!0)};return se.forEach(Object.keys({...n,...e}),function(f){if(f==="__proto__"||f==="constructor"||f==="prototype")return;const g=se.hasOwnProp(h,f)?h[f]:i,y=g(n[f],e[f],f);se.isUndefined(y)&&g!==c||(t[f]=y)}),t}const fS=n=>{const e=qa({},n);let{data:t,withXSRFToken:s,xsrfHeaderName:i,xsrfCookieName:r,headers:l,auth:c}=e;if(e.headers=l=si.from(l),e.url=oS(hS(e.baseURL,e.url,e.allowAbsoluteUrls),n.params,n.paramsSerializer),c&&l.set("Authorization","Basic "+btoa((c.username||"")+":"+(c.password?unescape(encodeURIComponent(c.password)):""))),se.isFormData(t)){if(Us.hasStandardBrowserEnv||Us.hasStandardBrowserWebWorkerEnv)l.setContentType(void 0);else if(se.isFunction(t.getHeaders)){const h=t.getHeaders(),u=["content-type","content-length"];Object.entries(h).forEach(([f,g])=>{u.includes(f.toLowerCase())&&l.set(f,g)})}}if(Us.hasStandardBrowserEnv&&(s&&se.isFunction(s)&&(s=s(e)),s||s!==!1&&xR(e.url))){const h=i&&r&&SR.read(r);h&&l.set(i,h)}return e},ER=typeof XMLHttpRequest<"u",AR=ER&&function(n){return new Promise(function(t,s){const i=fS(n);let r=i.data;const l=si.from(i.headers).normalize();let{responseType:c,onUploadProgress:h,onDownloadProgress:u}=i,f,g,y,x,S;function E(){x&&x(),S&&S(),i.cancelToken&&i.cancelToken.unsubscribe(f),i.signal&&i.signal.removeEventListener("abort",f)}let T=new XMLHttpRequest;T.open(i.method.toUpperCase(),i.url,!0),T.timeout=i.timeout;function A(){if(!T)return;const I=si.from("getAllResponseHeaders"in T&&T.getAllResponseHeaders()),N={data:!c||c==="text"||c==="json"?T.responseText:T.response,status:T.status,statusText:T.statusText,headers:I,config:n,request:T};dS(function(k){t(k),E()},function(k){s(k),E()},N),T=null}"onloadend"in T?T.onloadend=A:T.onreadystatechange=function(){!T||T.readyState!==4||T.status===0&&!(T.responseURL&&T.responseURL.indexOf("file:")===0)||setTimeout(A)},T.onabort=function(){T&&(s(new Ke("Request aborted",Ke.ECONNABORTED,n,T)),T=null)},T.onerror=function(C){const N=C&&C.message?C.message:"Network Error",D=new Ke(N,Ke.ERR_NETWORK,n,T);D.event=C||null,s(D),T=null},T.ontimeout=function(){let C=i.timeout?"timeout of "+i.timeout+"ms exceeded":"timeout exceeded";const N=i.transitional||fm;i.timeoutErrorMessage&&(C=i.timeoutErrorMessage),s(new Ke(C,N.clarifyTimeoutError?Ke.ETIMEDOUT:Ke.ECONNABORTED,n,T)),T=null},r===void 0&&l.setContentType(null),"setRequestHeader"in T&&se.forEach(l.toJSON(),function(C,N){T.setRequestHeader(N,C)}),se.isUndefined(i.withCredentials)||(T.withCredentials=!!i.withCredentials),c&&c!=="json"&&(T.responseType=i.responseType),u&&([y,S]=hu(u,!0),T.addEventListener("progress",y)),h&&T.upload&&([g,x]=hu(h),T.upload.addEventListener("progress",g),T.upload.addEventListener("loadend",x)),(i.cancelToken||i.signal)&&(f=I=>{T&&(s(!I||I.type?new co(null,n,T):I),T.abort(),T=null)},i.cancelToken&&i.cancelToken.subscribe(f),i.signal&&(i.signal.aborted?f():i.signal.addEventListener("abort",f)));const _=gR(i.url);if(_&&Us.protocols.indexOf(_)===-1){s(new Ke("Unsupported protocol "+_+":",Ke.ERR_BAD_REQUEST,n));return}T.send(r||null)})},IR=(n,e)=>{const{length:t}=n=n?n.filter(Boolean):[];if(e||t){let s=new AbortController,i;const r=function(u){if(!i){i=!0,c();const f=u instanceof Error?u:this.reason;s.abort(f instanceof Ke?f:new co(f instanceof Error?f.message:f))}};let l=e&&setTimeout(()=>{l=null,r(new Ke(`timeout of ${e}ms exceeded`,Ke.ETIMEDOUT))},e);const c=()=>{n&&(l&&clearTimeout(l),l=null,n.forEach(u=>{u.unsubscribe?u.unsubscribe(r):u.removeEventListener("abort",r)}),n=null)};n.forEach(u=>u.addEventListener("abort",r));const{signal:h}=s;return h.unsubscribe=()=>se.asap(c),h}},_R=function*(n,e){let t=n.byteLength;if(t<e){yield n;return}let s=0,i;for(;s<t;)i=s+e,yield n.slice(s,i),s=i},RR=async function*(n,e){for await(const t of LR(n))yield*_R(t,e)},LR=async function*(n){if(n[Symbol.asyncIterator]){yield*n;return}const e=n.getReader();try{for(;;){const{done:t,value:s}=await e.read();if(t)break;yield s}}finally{await e.cancel()}},zy=(n,e,t,s)=>{const i=RR(n,e);let r=0,l,c=h=>{l||(l=!0,s&&s(h))};return new ReadableStream({async pull(h){try{const{done:u,value:f}=await i.next();if(u){c(),h.close();return}let g=f.byteLength;if(t){let y=r+=g;t(y)}h.enqueue(new Uint8Array(f))}catch(u){throw c(u),u}},cancel(h){return c(h),i.return()}},{highWaterMark:2})},Ky=64*1024,{isFunction:Nc}=se,wR=(({Request:n,Response:e})=>({Request:n,Response:e}))(se.global),{ReadableStream:Yy,TextEncoder:qy}=se.global,Qy=(n,...e)=>{try{return!!n(...e)}catch{return!1}},CR=n=>{n=se.merge.call({skipUndefined:!0},wR,n);const{fetch:e,Request:t,Response:s}=n,i=e?Nc(e):typeof fetch=="function",r=Nc(t),l=Nc(s);if(!i)return!1;const c=i&&Nc(Yy),h=i&&(typeof qy=="function"?(S=>E=>S.encode(E))(new qy):async S=>new Uint8Array(await new t(S).arrayBuffer())),u=r&&c&&Qy(()=>{let S=!1;const E=new t(Us.origin,{body:new Yy,method:"POST",get duplex(){return S=!0,"half"}}).headers.has("Content-Type");return S&&!E}),f=l&&c&&Qy(()=>se.isReadableStream(new s("").body)),g={stream:f&&(S=>S.body)};i&&["text","arrayBuffer","blob","formData","stream"].forEach(S=>{!g[S]&&(g[S]=(E,T)=>{let A=E&&E[S];if(A)return A.call(E);throw new Ke(`Response type '${S}' is not supported`,Ke.ERR_NOT_SUPPORT,T)})});const y=async S=>{if(S==null)return 0;if(se.isBlob(S))return S.size;if(se.isSpecCompliantForm(S))return(await new t(Us.origin,{method:"POST",body:S}).arrayBuffer()).byteLength;if(se.isArrayBufferView(S)||se.isArrayBuffer(S))return S.byteLength;if(se.isURLSearchParams(S)&&(S=S+""),se.isString(S))return(await h(S)).byteLength},x=async(S,E)=>{const T=se.toFiniteNumber(S.getContentLength());return T??y(E)};return async S=>{let{url:E,method:T,data:A,signal:_,cancelToken:I,timeout:C,onDownloadProgress:N,onUploadProgress:D,responseType:k,headers:B,withCredentials:j="same-origin",fetchOptions:U}=fS(S),K=e||fetch;k=k?(k+"").toLowerCase():"text";let H=IR([_,I&&I.toAbortSignal()],C),J=null;const re=H&&H.unsubscribe&&(()=>{H.unsubscribe()});let me;try{if(D&&u&&T!=="get"&&T!=="head"&&(me=await x(B,A))!==0){let P=new t(E,{method:"POST",body:A,duplex:"half"}),G;if(se.isFormData(A)&&(G=P.headers.get("content-type"))&&B.setContentType(G),P.body){const[te,fe]=$y(me,hu(Gy(D)));A=zy(P.body,Ky,te,fe)}}se.isString(j)||(j=j?"include":"omit");const M=r&&"credentials"in t.prototype,$={...U,signal:H,method:T.toUpperCase(),headers:B.normalize().toJSON(),body:A,duplex:"half",credentials:M?j:void 0};J=r&&new t(E,$);let F=await(r?K(J,U):K(E,$));const ae=f&&(k==="stream"||k==="response");if(f&&(N||ae&&re)){const P={};["status","statusText","headers"].forEach(ve=>{P[ve]=F[ve]});const G=se.toFiniteNumber(F.headers.get("content-length")),[te,fe]=N&&$y(G,hu(Gy(N),!0))||[];F=new s(zy(F.body,Ky,te,()=>{fe&&fe(),re&&re()}),P)}k=k||"text";let de=await g[se.findKey(g,k)||"text"](F,S);return!ae&&re&&re(),await new Promise((P,G)=>{dS(P,G,{data:de,headers:si.from(F.headers),status:F.status,statusText:F.statusText,config:S,request:J})})}catch(M){throw re&&re(),M&&M.name==="TypeError"&&/Load failed|fetch/i.test(M.message)?Object.assign(new Ke("Network Error",Ke.ERR_NETWORK,S,J,M&&M.response),{cause:M.cause||M}):Ke.from(M,M&&M.code,S,J,M&&M.response)}}},NR=new Map,mS=n=>{let e=n&&n.env||{};const{fetch:t,Request:s,Response:i}=e,r=[s,i,t];let l=r.length,c=l,h,u,f=NR;for(;c--;)h=r[c],u=f.get(h),u===void 0&&f.set(h,u=c?new Map:CR(e)),f=u;return u};mS();const pm={http:q_,xhr:AR,fetch:{get:mS}};se.forEach(pm,(n,e)=>{if(n){try{Object.defineProperty(n,"name",{value:e})}catch{}Object.defineProperty(n,"adapterName",{value:e})}});const Wy=n=>`- ${n}`,OR=n=>se.isFunction(n)||n===null||n===!1;function kR(n,e){n=se.isArray(n)?n:[n];const{length:t}=n;let s,i;const r={};for(let l=0;l<t;l++){s=n[l];let c;if(i=s,!OR(s)&&(i=pm[(c=String(s)).toLowerCase()],i===void 0))throw new Ke(`Unknown adapter '${c}'`);if(i&&(se.isFunction(i)||(i=i.get(e))))break;r[c||"#"+l]=i}if(!i){const l=Object.entries(r).map(([h,u])=>`adapter ${h} `+(u===!1?"is not supported by the environment":"is not available in the build"));let c=t?l.length>1?`since :
`+l.map(Wy).join(`
`):" "+Wy(l[0]):"as no adapter specified";throw new Ke("There is no suitable adapter to dispatch the request "+c,"ERR_NOT_SUPPORT")}return i}const pS={getAdapter:kR,adapters:pm};function tf(n){if(n.cancelToken&&n.cancelToken.throwIfRequested(),n.signal&&n.signal.aborted)throw new co(null,n)}function Xy(n){return tf(n),n.headers=si.from(n.headers),n.data=ef.call(n,n.transformRequest),["post","put","patch"].indexOf(n.method)!==-1&&n.headers.setContentType("application/x-www-form-urlencoded",!1),pS.getAdapter(n.adapter||oo.adapter,n)(n).then(function(s){return tf(n),s.data=ef.call(n,n.transformResponse,s),s.headers=si.from(s.headers),s},function(s){return uS(s)||(tf(n),s&&s.response&&(s.response.data=ef.call(n,n.transformResponse,s.response),s.response.headers=si.from(s.response.headers))),Promise.reject(s)})}const gS="1.13.5",Ou={};["object","boolean","number","function","string","symbol"].forEach((n,e)=>{Ou[n]=function(s){return typeof s===n||"a"+(e<1?"n ":" ")+n}});const Zy={};Ou.transitional=function(e,t,s){function i(r,l){return"[Axios v"+gS+"] Transitional option '"+r+"'"+l+(s?". "+s:"")}return(r,l,c)=>{if(e===!1)throw new Ke(i(l," has been removed"+(t?" in "+t:"")),Ke.ERR_DEPRECATED);return t&&!Zy[l]&&(Zy[l]=!0,console.warn(i(l," has been deprecated since v"+t+" and will be removed in the near future"))),e?e(r,l,c):!0}};Ou.spelling=function(e){return(t,s)=>(console.warn(`${s} is likely a misspelling of ${e}`),!0)};function DR(n,e,t){if(typeof n!="object")throw new Ke("options must be an object",Ke.ERR_BAD_OPTION_VALUE);const s=Object.keys(n);let i=s.length;for(;i-- >0;){const r=s[i],l=e[r];if(l){const c=n[r],h=c===void 0||l(c,r,n);if(h!==!0)throw new Ke("option "+r+" must be "+h,Ke.ERR_BAD_OPTION_VALUE);continue}if(t!==!0)throw new Ke("Unknown option "+r,Ke.ERR_BAD_OPTION)}}const eu={assertOptions:DR,validators:Ou},ki=eu.validators;let Ka=class{constructor(e){this.defaults=e||{},this.interceptors={request:new Fy,response:new Fy}}async request(e,t){try{return await this._request(e,t)}catch(s){if(s instanceof Error){let i={};Error.captureStackTrace?Error.captureStackTrace(i):i=new Error;const r=i.stack?i.stack.replace(/^.+\n/,""):"";try{s.stack?r&&!String(s.stack).endsWith(r.replace(/^.+\n.+\n/,""))&&(s.stack+=`
`+r):s.stack=r}catch{}}throw s}}_request(e,t){typeof e=="string"?(t=t||{},t.url=e):t=e||{},t=qa(this.defaults,t);const{transitional:s,paramsSerializer:i,headers:r}=t;s!==void 0&&eu.assertOptions(s,{silentJSONParsing:ki.transitional(ki.boolean),forcedJSONParsing:ki.transitional(ki.boolean),clarifyTimeoutError:ki.transitional(ki.boolean),legacyInterceptorReqResOrdering:ki.transitional(ki.boolean)},!1),i!=null&&(se.isFunction(i)?t.paramsSerializer={serialize:i}:eu.assertOptions(i,{encode:ki.function,serialize:ki.function},!0)),t.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),eu.assertOptions(t,{baseUrl:ki.spelling("baseURL"),withXsrfToken:ki.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let l=r&&se.merge(r.common,r[t.method]);r&&se.forEach(["delete","get","head","post","put","patch","common"],S=>{delete r[S]}),t.headers=si.concat(l,r);const c=[];let h=!0;this.interceptors.request.forEach(function(E){if(typeof E.runWhen=="function"&&E.runWhen(t)===!1)return;h=h&&E.synchronous;const T=t.transitional||fm;T&&T.legacyInterceptorReqResOrdering?c.unshift(E.fulfilled,E.rejected):c.push(E.fulfilled,E.rejected)});const u=[];this.interceptors.response.forEach(function(E){u.push(E.fulfilled,E.rejected)});let f,g=0,y;if(!h){const S=[Xy.bind(this),void 0];for(S.unshift(...c),S.push(...u),y=S.length,f=Promise.resolve(t);g<y;)f=f.then(S[g++],S[g++]);return f}y=c.length;let x=t;for(;g<y;){const S=c[g++],E=c[g++];try{x=S(x)}catch(T){E.call(this,T);break}}try{f=Xy.call(this,x)}catch(S){return Promise.reject(S)}for(g=0,y=u.length;g<y;)f=f.then(u[g++],u[g++]);return f}getUri(e){e=qa(this.defaults,e);const t=hS(e.baseURL,e.url,e.allowAbsoluteUrls);return oS(t,e.params,e.paramsSerializer)}};se.forEach(["delete","get","head","options"],function(e){Ka.prototype[e]=function(t,s){return this.request(qa(s||{},{method:e,url:t,data:(s||{}).data}))}});se.forEach(["post","put","patch"],function(e){function t(s){return function(r,l,c){return this.request(qa(c||{},{method:e,headers:s?{"Content-Type":"multipart/form-data"}:{},url:r,data:l}))}}Ka.prototype[e]=t(),Ka.prototype[e+"Form"]=t(!0)});let PR=class yS{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(r){t=r});const s=this;this.promise.then(i=>{if(!s._listeners)return;let r=s._listeners.length;for(;r-- >0;)s._listeners[r](i);s._listeners=null}),this.promise.then=i=>{let r;const l=new Promise(c=>{s.subscribe(c),r=c}).then(i);return l.cancel=function(){s.unsubscribe(r)},l},e(function(r,l,c){s.reason||(s.reason=new co(r,l,c),t(s.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);t!==-1&&this._listeners.splice(t,1)}toAbortSignal(){const e=new AbortController,t=s=>{e.abort(s)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let e;return{token:new yS(function(i){e=i}),cancel:e}}};function UR(n){return function(t){return n.apply(null,t)}}function MR(n){return se.isObject(n)&&n.isAxiosError===!0}const Uf={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(Uf).forEach(([n,e])=>{Uf[e]=n});function vS(n){const e=new Ka(n),t=Xx(Ka.prototype.request,e);return se.extend(t,Ka.prototype,e,{allOwnKeys:!0}),se.extend(t,e,null,{allOwnKeys:!0}),t.create=function(i){return vS(qa(n,i))},t}const oe=vS(oo);oe.Axios=Ka;oe.CanceledError=co;oe.CancelToken=PR;oe.isCancel=uS;oe.VERSION=gS;oe.toFormData=Nu;oe.AxiosError=Ke;oe.Cancel=oe.CanceledError;oe.all=function(e){return Promise.all(e)};oe.spread=UR;oe.isAxiosError=MR;oe.mergeConfig=qa;oe.AxiosHeaders=si;oe.formToJSON=n=>cS(se.isHTMLForm(n)?new FormData(n):n);oe.getAdapter=pS.getAdapter;oe.HttpStatusCode=Uf;oe.default=oe;const{Axios:gk,AxiosError:yk,CanceledError:vk,isCancel:xk,CancelToken:Sk,VERSION:bk,all:Tk,Cancel:Ek,isAxiosError:Ak,spread:Ik,toFormData:_k,AxiosHeaders:Rk,HttpStatusCode:Lk,formToJSON:wk,getAdapter:Ck,mergeConfig:Nk}=oe,ye="http://localhost".replace(/\/+$/,"");class fn{constructor(e,t=ye,s=oe){var i;this.basePath=t,this.axios=s,e&&(this.configuration=e,this.basePath=(i=e.basePath)!==null&&i!==void 0?i:t)}}class jR extends Error{constructor(e,t){super(t),this.field=e,this.name="RequiredError"}}const xe={},Se="https://example.com",Re=function(n,e,t){if(t==null)throw new jR(e,`Required parameter ${e} was null or undefined when calling ${n}.`)},_e=async function(n,e,t){if(t&&t.apiKey){const s=typeof t.apiKey=="function"?await t.apiKey(e):await t.apiKey;n[e]=s}};function Mf(n,e,t=""){e!=null&&(typeof e=="object"?Array.isArray(e)?e.forEach(s=>Mf(n,s,t)):Object.keys(e).forEach(s=>Mf(n,e[s],`${t}${t!==""?".":""}${s}`)):n.has(t)?n.append(t,e):n.set(t,e))}const be=function(n,...e){const t=new URLSearchParams(n.search);Mf(t,e),n.search=t.toString()},ys=function(n,e,t){const s=typeof n!="string";return(s&&t&&t.isJsonMime?t.isJsonMime(e.headers["Content-Type"]):s)?JSON.stringify(n!==void 0?n:{}):n||""},Te=function(n){return n.pathname+n.search+n.hash},Ee=function(n,e,t,s){return(i=e,r=t)=>{var l;const c={...n.options,url:(i.defaults.baseURL?"":(l=s?.basePath)!==null&&l!==void 0?l:r)+n.url};return i.request(c)}},BR=function(n){return{getEndpointInfo:async(e={})=>{const t="/System/Endpoint",s=new URL(t,Se);let i;n&&(i=n.baseOptions);const r={method:"GET",...i,...e},l={},c={};await _e(l,"Authorization",n),be(s,c);let h=i&&i.headers?i.headers:{};return r.headers={...l,...h,...e.headers},{url:Te(s),options:r}},getLogFile:async(e,t={})=>{Re("getLogFile","name",e);const s="/System/Logs/Log",i=new URL(s,Se);let r;n&&(r=n.baseOptions);const l={method:"GET",...r,...t},c={},h={};await _e(c,"Authorization",n),e!==void 0&&(h.name=e),be(i,h);let u=r&&r.headers?r.headers:{};return l.headers={...c,...u,...t.headers},{url:Te(i),options:l}},getPingSystem:async(e={})=>{const t="/System/Ping",s=new URL(t,Se);let i;n&&(i=n.baseOptions);const r={method:"GET",...i,...e},l={};be(s,{});let h=i&&i.headers?i.headers:{};return r.headers={...l,...h,...e.headers},{url:Te(s),options:r}},getPublicSystemInfo:async(e={})=>{const t="/System/Info/Public",s=new URL(t,Se);let i;n&&(i=n.baseOptions);const r={method:"GET",...i,...e},l={};be(s,{});let h=i&&i.headers?i.headers:{};return r.headers={...l,...h,...e.headers},{url:Te(s),options:r}},getServerLogs:async(e={})=>{const t="/System/Logs",s=new URL(t,Se);let i;n&&(i=n.baseOptions);const r={method:"GET",...i,...e},l={},c={};await _e(l,"Authorization",n),be(s,c);let h=i&&i.headers?i.headers:{};return r.headers={...l,...h,...e.headers},{url:Te(s),options:r}},getSystemInfo:async(e={})=>{const t="/System/Info",s=new URL(t,Se);let i;n&&(i=n.baseOptions);const r={method:"GET",...i,...e},l={},c={};await _e(l,"Authorization",n),be(s,c);let h=i&&i.headers?i.headers:{};return r.headers={...l,...h,...e.headers},{url:Te(s),options:r}},getSystemStorage:async(e={})=>{const t="/System/Info/Storage",s=new URL(t,Se);let i;n&&(i=n.baseOptions);const r={method:"GET",...i,...e},l={},c={};await _e(l,"Authorization",n),be(s,c);let h=i&&i.headers?i.headers:{};return r.headers={...l,...h,...e.headers},{url:Te(s),options:r}},postPingSystem:async(e={})=>{const t="/System/Ping",s=new URL(t,Se);let i;n&&(i=n.baseOptions);const r={method:"POST",...i,...e},l={};be(s,{});let h=i&&i.headers?i.headers:{};return r.headers={...l,...h,...e.headers},{url:Te(s),options:r}},restartApplication:async(e={})=>{const t="/System/Restart",s=new URL(t,Se);let i;n&&(i=n.baseOptions);const r={method:"POST",...i,...e},l={},c={};await _e(l,"Authorization",n),be(s,c);let h=i&&i.headers?i.headers:{};return r.headers={...l,...h,...e.headers},{url:Te(s),options:r}},shutdownApplication:async(e={})=>{const t="/System/Shutdown",s=new URL(t,Se);let i;n&&(i=n.baseOptions);const r={method:"POST",...i,...e},l={},c={};await _e(l,"Authorization",n),be(s,c);let h=i&&i.headers?i.headers:{};return r.headers={...l,...h,...e.headers},{url:Te(s),options:r}}}},tn=function(n){const e=BR(n);return{async getEndpointInfo(t){var s,i,r;const l=await e.getEndpointInfo(t),c=(s=n?.serverIndex)!==null&&s!==void 0?s:0,h=(r=(i=xe["SystemApi.getEndpointInfo"])===null||i===void 0?void 0:i[c])===null||r===void 0?void 0:r.url;return(u,f)=>Ee(l,oe,ye,n)(u,h||f)},async getLogFile(t,s){var i,r,l;const c=await e.getLogFile(t,s),h=(i=n?.serverIndex)!==null&&i!==void 0?i:0,u=(l=(r=xe["SystemApi.getLogFile"])===null||r===void 0?void 0:r[h])===null||l===void 0?void 0:l.url;return(f,g)=>Ee(c,oe,ye,n)(f,u||g)},async getPingSystem(t){var s,i,r;const l=await e.getPingSystem(t),c=(s=n?.serverIndex)!==null&&s!==void 0?s:0,h=(r=(i=xe["SystemApi.getPingSystem"])===null||i===void 0?void 0:i[c])===null||r===void 0?void 0:r.url;return(u,f)=>Ee(l,oe,ye,n)(u,h||f)},async getPublicSystemInfo(t){var s,i,r;const l=await e.getPublicSystemInfo(t),c=(s=n?.serverIndex)!==null&&s!==void 0?s:0,h=(r=(i=xe["SystemApi.getPublicSystemInfo"])===null||i===void 0?void 0:i[c])===null||r===void 0?void 0:r.url;return(u,f)=>Ee(l,oe,ye,n)(u,h||f)},async getServerLogs(t){var s,i,r;const l=await e.getServerLogs(t),c=(s=n?.serverIndex)!==null&&s!==void 0?s:0,h=(r=(i=xe["SystemApi.getServerLogs"])===null||i===void 0?void 0:i[c])===null||r===void 0?void 0:r.url;return(u,f)=>Ee(l,oe,ye,n)(u,h||f)},async getSystemInfo(t){var s,i,r;const l=await e.getSystemInfo(t),c=(s=n?.serverIndex)!==null&&s!==void 0?s:0,h=(r=(i=xe["SystemApi.getSystemInfo"])===null||i===void 0?void 0:i[c])===null||r===void 0?void 0:r.url;return(u,f)=>Ee(l,oe,ye,n)(u,h||f)},async getSystemStorage(t){var s,i,r;const l=await e.getSystemStorage(t),c=(s=n?.serverIndex)!==null&&s!==void 0?s:0,h=(r=(i=xe["SystemApi.getSystemStorage"])===null||i===void 0?void 0:i[c])===null||r===void 0?void 0:r.url;return(u,f)=>Ee(l,oe,ye,n)(u,h||f)},async postPingSystem(t){var s,i,r;const l=await e.postPingSystem(t),c=(s=n?.serverIndex)!==null&&s!==void 0?s:0,h=(r=(i=xe["SystemApi.postPingSystem"])===null||i===void 0?void 0:i[c])===null||r===void 0?void 0:r.url;return(u,f)=>Ee(l,oe,ye,n)(u,h||f)},async restartApplication(t){var s,i,r;const l=await e.restartApplication(t),c=(s=n?.serverIndex)!==null&&s!==void 0?s:0,h=(r=(i=xe["SystemApi.restartApplication"])===null||i===void 0?void 0:i[c])===null||r===void 0?void 0:r.url;return(u,f)=>Ee(l,oe,ye,n)(u,h||f)},async shutdownApplication(t){var s,i,r;const l=await e.shutdownApplication(t),c=(s=n?.serverIndex)!==null&&s!==void 0?s:0,h=(r=(i=xe["SystemApi.shutdownApplication"])===null||i===void 0?void 0:i[c])===null||r===void 0?void 0:r.url;return(u,f)=>Ee(l,oe,ye,n)(u,h||f)}}};class FR extends fn{getEndpointInfo(e){return tn(this.configuration).getEndpointInfo(e).then(t=>t(this.axios,this.basePath))}getLogFile(e,t){return tn(this.configuration).getLogFile(e.name,t).then(s=>s(this.axios,this.basePath))}getPingSystem(e){return tn(this.configuration).getPingSystem(e).then(t=>t(this.axios,this.basePath))}getPublicSystemInfo(e){return tn(this.configuration).getPublicSystemInfo(e).then(t=>t(this.axios,this.basePath))}getServerLogs(e){return tn(this.configuration).getServerLogs(e).then(t=>t(this.axios,this.basePath))}getSystemInfo(e){return tn(this.configuration).getSystemInfo(e).then(t=>t(this.axios,this.basePath))}getSystemStorage(e){return tn(this.configuration).getSystemStorage(e).then(t=>t(this.axios,this.basePath))}postPingSystem(e){return tn(this.configuration).postPingSystem(e).then(t=>t(this.axios,this.basePath))}restartApplication(e){return tn(this.configuration).restartApplication(e).then(t=>t(this.axios,this.basePath))}shutdownApplication(e){return tn(this.configuration).shutdownApplication(e).then(t=>t(this.axios,this.basePath))}}function VR(n){return new FR(n.configuration,void 0,n.axiosInstance)}function Jy(n){const e=n.split(".").map(Number);if(e.length===3&&e.every(t=>t>=0))return e}function ev(n,e){const t=Jy(n),s=Jy(e);if(!t||!s)throw new TypeError("Version doesn't match a numeric-only semver format");const[i,r,l]=t,[c,h,u]=s;return i<c||i===c&&r<h||i===c&&r===h&&l<u}const $R="10.11.1",GR="10.10.0",HR="Jellyfin Server",zR=3e3,KR=5e3;function YR(n,e=Js.GREAT){return n.length>0?Math.min(...n):e}function qR(n){var e,t,s;const i=[],r=[];!(!((e=n.response)===null||e===void 0)&&e.data)||n.error?(i.push(new r_(n.error)),r.push(Js.BAD)):n.response.data.ProductName!==HR&&(i.push(new n_(n.response.data.ProductName)),r.push(Js.BAD));const l=(t=n.response)===null||t===void 0?void 0:t.data.Version;try{l?ev(l,GR)?(i.push(new o_(l)),r.push(Js.OK)):ev(l,$R)&&(i.push(new l_(l)),r.push(Js.GOOD)):(i.push(new Uy),r.push(Js.BAD))}catch(c){c instanceof TypeError&&(i.push(new Uy),r.push(Js.BAD))}return n.responseTime>zR&&(i.push(new a_(n.responseTime)),r.push(Js.GOOD)),{address:n.address,responseTime:n.responseTime,score:YR(r),issues:i,systemInfo:(s=n.response)===null||s===void 0?void 0:s.data}}class QR{constructor(e){this.jellyfin=e}async fetchRecommendedServerInfo(e){const t=this.jellyfin.createApi(e),s=Date.now();return VR(t).getPublicSystemInfo({timeout:KR}).then(i=>({address:e,response:i,responseTime:Date.now()-s})).catch(i=>({address:e,error:i,responseTime:Date.now()-s})).then(i=>qR(i))}async discover(e,t=Js.BAD){return(await Promise.all(e.map(s=>this.fetchRecommendedServerInfo(s)))).filter(s=>s.score>=t)}}class WR{constructor(e){this.jellyfin=e,this.recommendedServerDiscovery=new QR(this.jellyfin)}findBestServer(e){let t=e.find(s=>s.score===Js.GREAT);return t||(t=e.find(s=>s.score===Js.GOOD)),t||(t=e.find(s=>s.score===Js.OK)),t}getAddressCandidates(e){return i_(e)}async getRecommendedServers(e,t){return this.recommendedServerDiscovery.discover(e,t)}async getRecommendedServerCandidates(e,t){return this.getRecommendedServers(this.getAddressCandidates(e),t)}}function XR(n,e,t=""){return[`MediaBrowser Client="${encodeURIComponent(n.name)}"`,`Device="${encodeURIComponent(e.name)}"`,`DeviceId="${encodeURIComponent(e.id)}"`,`Version="${encodeURIComponent(n.version)}"`,`Token="${encodeURIComponent(t)}"`].join(", ")}class ZR{constructor(e={}){this.apiKey=e.apiKey,this.username=e.username,this.password=e.password,this.accessToken=e.accessToken,this.basePath=e.basePath,this.serverIndex=e.serverIndex,this.baseOptions=e.baseOptions,this.formDataCtor=e.formDataCtor}isJsonMime(e){const t=new RegExp("^(application/json|[^;/ 	]+/[^;/ 	]+[+]json)[ 	]*(;.*)?$","i");return e!==null&&(t.test(e)||e.toLowerCase()==="application/json-patch+json")}}const JR=function(n){return{addUserToSession:async(e,t,s={})=>{Re("addUserToSession","sessionId",e),Re("addUserToSession","userId",t);const i="/Sessions/{sessionId}/User/{userId}".replace("{sessionId}",encodeURIComponent(String(e))).replace("{userId}",encodeURIComponent(String(t))),r=new URL(i,Se);let l;n&&(l=n.baseOptions);const c={method:"POST",...l,...s},h={},u={};await _e(h,"Authorization",n),be(r,u);let f=l&&l.headers?l.headers:{};return c.headers={...h,...f,...s.headers},{url:Te(r),options:c}},displayContent:async(e,t,s,i,r={})=>{Re("displayContent","sessionId",e),Re("displayContent","itemType",t),Re("displayContent","itemId",s),Re("displayContent","itemName",i);const l="/Sessions/{sessionId}/Viewing".replace("{sessionId}",encodeURIComponent(String(e))),c=new URL(l,Se);let h;n&&(h=n.baseOptions);const u={method:"POST",...h,...r},f={},g={};await _e(f,"Authorization",n),t!==void 0&&(g.itemType=t),s!==void 0&&(g.itemId=s),i!==void 0&&(g.itemName=i),be(c,g);let y=h&&h.headers?h.headers:{};return u.headers={...f,...y,...r.headers},{url:Te(c),options:u}},getAuthProviders:async(e={})=>{const t="/Auth/Providers",s=new URL(t,Se);let i;n&&(i=n.baseOptions);const r={method:"GET",...i,...e},l={},c={};await _e(l,"Authorization",n),be(s,c);let h=i&&i.headers?i.headers:{};return r.headers={...l,...h,...e.headers},{url:Te(s),options:r}},getPasswordResetProviders:async(e={})=>{const t="/Auth/PasswordResetProviders",s=new URL(t,Se);let i;n&&(i=n.baseOptions);const r={method:"GET",...i,...e},l={},c={};await _e(l,"Authorization",n),be(s,c);let h=i&&i.headers?i.headers:{};return r.headers={...l,...h,...e.headers},{url:Te(s),options:r}},getSessions:async(e,t,s,i={})=>{const r="/Sessions",l=new URL(r,Se);let c;n&&(c=n.baseOptions);const h={method:"GET",...c,...i},u={},f={};await _e(u,"Authorization",n),e!==void 0&&(f.controllableByUserId=e),t!==void 0&&(f.deviceId=t),s!==void 0&&(f.activeWithinSeconds=s),be(l,f);let g=c&&c.headers?c.headers:{};return h.headers={...u,...g,...i.headers},{url:Te(l),options:h}},play:async(e,t,s,i,r,l,c,h,u={})=>{Re("play","sessionId",e),Re("play","playCommand",t),Re("play","itemIds",s);const f="/Sessions/{sessionId}/Playing".replace("{sessionId}",encodeURIComponent(String(e))),g=new URL(f,Se);let y;n&&(y=n.baseOptions);const x={method:"POST",...y,...u},S={},E={};await _e(S,"Authorization",n),t!==void 0&&(E.playCommand=t),s&&(E.itemIds=s),i!==void 0&&(E.startPositionTicks=i),r!==void 0&&(E.mediaSourceId=r),l!==void 0&&(E.audioStreamIndex=l),c!==void 0&&(E.subtitleStreamIndex=c),h!==void 0&&(E.startIndex=h),be(g,E);let T=y&&y.headers?y.headers:{};return x.headers={...S,...T,...u.headers},{url:Te(g),options:x}},postCapabilities:async(e,t,s,i,r,l={})=>{const c="/Sessions/Capabilities",h=new URL(c,Se);let u;n&&(u=n.baseOptions);const f={method:"POST",...u,...l},g={},y={};await _e(g,"Authorization",n),e!==void 0&&(y.id=e),t&&(y.playableMediaTypes=t),s&&(y.supportedCommands=s),i!==void 0&&(y.supportsMediaControl=i),r!==void 0&&(y.supportsPersistentIdentifier=r),be(h,y);let x=u&&u.headers?u.headers:{};return f.headers={...g,...x,...l.headers},{url:Te(h),options:f}},postFullCapabilities:async(e,t,s={})=>{Re("postFullCapabilities","clientCapabilitiesDto",e);const i="/Sessions/Capabilities/Full",r=new URL(i,Se);let l;n&&(l=n.baseOptions);const c={method:"POST",...l,...s},h={},u={};await _e(h,"Authorization",n),t!==void 0&&(u.id=t),h["Content-Type"]="application/json",be(r,u);let f=l&&l.headers?l.headers:{};return c.headers={...h,...f,...s.headers},c.data=ys(e,c,n),{url:Te(r),options:c}},removeUserFromSession:async(e,t,s={})=>{Re("removeUserFromSession","sessionId",e),Re("removeUserFromSession","userId",t);const i="/Sessions/{sessionId}/User/{userId}".replace("{sessionId}",encodeURIComponent(String(e))).replace("{userId}",encodeURIComponent(String(t))),r=new URL(i,Se);let l;n&&(l=n.baseOptions);const c={method:"DELETE",...l,...s},h={},u={};await _e(h,"Authorization",n),be(r,u);let f=l&&l.headers?l.headers:{};return c.headers={...h,...f,...s.headers},{url:Te(r),options:c}},reportSessionEnded:async(e={})=>{const t="/Sessions/Logout",s=new URL(t,Se);let i;n&&(i=n.baseOptions);const r={method:"POST",...i,...e},l={},c={};await _e(l,"Authorization",n),be(s,c);let h=i&&i.headers?i.headers:{};return r.headers={...l,...h,...e.headers},{url:Te(s),options:r}},reportViewing:async(e,t,s={})=>{Re("reportViewing","itemId",e);const i="/Sessions/Viewing",r=new URL(i,Se);let l;n&&(l=n.baseOptions);const c={method:"POST",...l,...s},h={},u={};await _e(h,"Authorization",n),t!==void 0&&(u.sessionId=t),e!==void 0&&(u.itemId=e),be(r,u);let f=l&&l.headers?l.headers:{};return c.headers={...h,...f,...s.headers},{url:Te(r),options:c}},sendFullGeneralCommand:async(e,t,s={})=>{Re("sendFullGeneralCommand","sessionId",e),Re("sendFullGeneralCommand","generalCommand",t);const i="/Sessions/{sessionId}/Command".replace("{sessionId}",encodeURIComponent(String(e))),r=new URL(i,Se);let l;n&&(l=n.baseOptions);const c={method:"POST",...l,...s},h={},u={};await _e(h,"Authorization",n),h["Content-Type"]="application/json",be(r,u);let f=l&&l.headers?l.headers:{};return c.headers={...h,...f,...s.headers},c.data=ys(t,c,n),{url:Te(r),options:c}},sendGeneralCommand:async(e,t,s={})=>{Re("sendGeneralCommand","sessionId",e),Re("sendGeneralCommand","command",t);const i="/Sessions/{sessionId}/Command/{command}".replace("{sessionId}",encodeURIComponent(String(e))).replace("{command}",encodeURIComponent(String(t))),r=new URL(i,Se);let l;n&&(l=n.baseOptions);const c={method:"POST",...l,...s},h={},u={};await _e(h,"Authorization",n),be(r,u);let f=l&&l.headers?l.headers:{};return c.headers={...h,...f,...s.headers},{url:Te(r),options:c}},sendMessageCommand:async(e,t,s={})=>{Re("sendMessageCommand","sessionId",e),Re("sendMessageCommand","messageCommand",t);const i="/Sessions/{sessionId}/Message".replace("{sessionId}",encodeURIComponent(String(e))),r=new URL(i,Se);let l;n&&(l=n.baseOptions);const c={method:"POST",...l,...s},h={},u={};await _e(h,"Authorization",n),h["Content-Type"]="application/json",be(r,u);let f=l&&l.headers?l.headers:{};return c.headers={...h,...f,...s.headers},c.data=ys(t,c,n),{url:Te(r),options:c}},sendPlaystateCommand:async(e,t,s,i,r={})=>{Re("sendPlaystateCommand","sessionId",e),Re("sendPlaystateCommand","command",t);const l="/Sessions/{sessionId}/Playing/{command}".replace("{sessionId}",encodeURIComponent(String(e))).replace("{command}",encodeURIComponent(String(t))),c=new URL(l,Se);let h;n&&(h=n.baseOptions);const u={method:"POST",...h,...r},f={},g={};await _e(f,"Authorization",n),s!==void 0&&(g.seekPositionTicks=s),i!==void 0&&(g.controllingUserId=i),be(c,g);let y=h&&h.headers?h.headers:{};return u.headers={...f,...y,...r.headers},{url:Te(c),options:u}},sendSystemCommand:async(e,t,s={})=>{Re("sendSystemCommand","sessionId",e),Re("sendSystemCommand","command",t);const i="/Sessions/{sessionId}/System/{command}".replace("{sessionId}",encodeURIComponent(String(e))).replace("{command}",encodeURIComponent(String(t))),r=new URL(i,Se);let l;n&&(l=n.baseOptions);const c={method:"POST",...l,...s},h={},u={};await _e(h,"Authorization",n),be(r,u);let f=l&&l.headers?l.headers:{};return c.headers={...h,...f,...s.headers},{url:Te(r),options:c}}}},Ps=function(n){const e=JR(n);return{async addUserToSession(t,s,i){var r,l,c;const h=await e.addUserToSession(t,s,i),u=(r=n?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=xe["SessionApi.addUserToSession"])===null||l===void 0?void 0:l[u])===null||c===void 0?void 0:c.url;return(g,y)=>Ee(h,oe,ye,n)(g,f||y)},async displayContent(t,s,i,r,l){var c,h,u;const f=await e.displayContent(t,s,i,r,l),g=(c=n?.serverIndex)!==null&&c!==void 0?c:0,y=(u=(h=xe["SessionApi.displayContent"])===null||h===void 0?void 0:h[g])===null||u===void 0?void 0:u.url;return(x,S)=>Ee(f,oe,ye,n)(x,y||S)},async getAuthProviders(t){var s,i,r;const l=await e.getAuthProviders(t),c=(s=n?.serverIndex)!==null&&s!==void 0?s:0,h=(r=(i=xe["SessionApi.getAuthProviders"])===null||i===void 0?void 0:i[c])===null||r===void 0?void 0:r.url;return(u,f)=>Ee(l,oe,ye,n)(u,h||f)},async getPasswordResetProviders(t){var s,i,r;const l=await e.getPasswordResetProviders(t),c=(s=n?.serverIndex)!==null&&s!==void 0?s:0,h=(r=(i=xe["SessionApi.getPasswordResetProviders"])===null||i===void 0?void 0:i[c])===null||r===void 0?void 0:r.url;return(u,f)=>Ee(l,oe,ye,n)(u,h||f)},async getSessions(t,s,i,r){var l,c,h;const u=await e.getSessions(t,s,i,r),f=(l=n?.serverIndex)!==null&&l!==void 0?l:0,g=(h=(c=xe["SessionApi.getSessions"])===null||c===void 0?void 0:c[f])===null||h===void 0?void 0:h.url;return(y,x)=>Ee(u,oe,ye,n)(y,g||x)},async play(t,s,i,r,l,c,h,u,f){var g,y,x;const S=await e.play(t,s,i,r,l,c,h,u,f),E=(g=n?.serverIndex)!==null&&g!==void 0?g:0,T=(x=(y=xe["SessionApi.play"])===null||y===void 0?void 0:y[E])===null||x===void 0?void 0:x.url;return(A,_)=>Ee(S,oe,ye,n)(A,T||_)},async postCapabilities(t,s,i,r,l,c){var h,u,f;const g=await e.postCapabilities(t,s,i,r,l,c),y=(h=n?.serverIndex)!==null&&h!==void 0?h:0,x=(f=(u=xe["SessionApi.postCapabilities"])===null||u===void 0?void 0:u[y])===null||f===void 0?void 0:f.url;return(S,E)=>Ee(g,oe,ye,n)(S,x||E)},async postFullCapabilities(t,s,i){var r,l,c;const h=await e.postFullCapabilities(t,s,i),u=(r=n?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=xe["SessionApi.postFullCapabilities"])===null||l===void 0?void 0:l[u])===null||c===void 0?void 0:c.url;return(g,y)=>Ee(h,oe,ye,n)(g,f||y)},async removeUserFromSession(t,s,i){var r,l,c;const h=await e.removeUserFromSession(t,s,i),u=(r=n?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=xe["SessionApi.removeUserFromSession"])===null||l===void 0?void 0:l[u])===null||c===void 0?void 0:c.url;return(g,y)=>Ee(h,oe,ye,n)(g,f||y)},async reportSessionEnded(t){var s,i,r;const l=await e.reportSessionEnded(t),c=(s=n?.serverIndex)!==null&&s!==void 0?s:0,h=(r=(i=xe["SessionApi.reportSessionEnded"])===null||i===void 0?void 0:i[c])===null||r===void 0?void 0:r.url;return(u,f)=>Ee(l,oe,ye,n)(u,h||f)},async reportViewing(t,s,i){var r,l,c;const h=await e.reportViewing(t,s,i),u=(r=n?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=xe["SessionApi.reportViewing"])===null||l===void 0?void 0:l[u])===null||c===void 0?void 0:c.url;return(g,y)=>Ee(h,oe,ye,n)(g,f||y)},async sendFullGeneralCommand(t,s,i){var r,l,c;const h=await e.sendFullGeneralCommand(t,s,i),u=(r=n?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=xe["SessionApi.sendFullGeneralCommand"])===null||l===void 0?void 0:l[u])===null||c===void 0?void 0:c.url;return(g,y)=>Ee(h,oe,ye,n)(g,f||y)},async sendGeneralCommand(t,s,i){var r,l,c;const h=await e.sendGeneralCommand(t,s,i),u=(r=n?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=xe["SessionApi.sendGeneralCommand"])===null||l===void 0?void 0:l[u])===null||c===void 0?void 0:c.url;return(g,y)=>Ee(h,oe,ye,n)(g,f||y)},async sendMessageCommand(t,s,i){var r,l,c;const h=await e.sendMessageCommand(t,s,i),u=(r=n?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=xe["SessionApi.sendMessageCommand"])===null||l===void 0?void 0:l[u])===null||c===void 0?void 0:c.url;return(g,y)=>Ee(h,oe,ye,n)(g,f||y)},async sendPlaystateCommand(t,s,i,r,l){var c,h,u;const f=await e.sendPlaystateCommand(t,s,i,r,l),g=(c=n?.serverIndex)!==null&&c!==void 0?c:0,y=(u=(h=xe["SessionApi.sendPlaystateCommand"])===null||h===void 0?void 0:h[g])===null||u===void 0?void 0:u.url;return(x,S)=>Ee(f,oe,ye,n)(x,y||S)},async sendSystemCommand(t,s,i){var r,l,c;const h=await e.sendSystemCommand(t,s,i),u=(r=n?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=xe["SessionApi.sendSystemCommand"])===null||l===void 0?void 0:l[u])===null||c===void 0?void 0:c.url;return(g,y)=>Ee(h,oe,ye,n)(g,f||y)}}};class eL extends fn{addUserToSession(e,t){return Ps(this.configuration).addUserToSession(e.sessionId,e.userId,t).then(s=>s(this.axios,this.basePath))}displayContent(e,t){return Ps(this.configuration).displayContent(e.sessionId,e.itemType,e.itemId,e.itemName,t).then(s=>s(this.axios,this.basePath))}getAuthProviders(e){return Ps(this.configuration).getAuthProviders(e).then(t=>t(this.axios,this.basePath))}getPasswordResetProviders(e){return Ps(this.configuration).getPasswordResetProviders(e).then(t=>t(this.axios,this.basePath))}getSessions(e={},t){return Ps(this.configuration).getSessions(e.controllableByUserId,e.deviceId,e.activeWithinSeconds,t).then(s=>s(this.axios,this.basePath))}play(e,t){return Ps(this.configuration).play(e.sessionId,e.playCommand,e.itemIds,e.startPositionTicks,e.mediaSourceId,e.audioStreamIndex,e.subtitleStreamIndex,e.startIndex,t).then(s=>s(this.axios,this.basePath))}postCapabilities(e={},t){return Ps(this.configuration).postCapabilities(e.id,e.playableMediaTypes,e.supportedCommands,e.supportsMediaControl,e.supportsPersistentIdentifier,t).then(s=>s(this.axios,this.basePath))}postFullCapabilities(e,t){return Ps(this.configuration).postFullCapabilities(e.clientCapabilitiesDto,e.id,t).then(s=>s(this.axios,this.basePath))}removeUserFromSession(e,t){return Ps(this.configuration).removeUserFromSession(e.sessionId,e.userId,t).then(s=>s(this.axios,this.basePath))}reportSessionEnded(e){return Ps(this.configuration).reportSessionEnded(e).then(t=>t(this.axios,this.basePath))}reportViewing(e,t){return Ps(this.configuration).reportViewing(e.itemId,e.sessionId,t).then(s=>s(this.axios,this.basePath))}sendFullGeneralCommand(e,t){return Ps(this.configuration).sendFullGeneralCommand(e.sessionId,e.generalCommand,t).then(s=>s(this.axios,this.basePath))}sendGeneralCommand(e,t){return Ps(this.configuration).sendGeneralCommand(e.sessionId,e.command,t).then(s=>s(this.axios,this.basePath))}sendMessageCommand(e,t){return Ps(this.configuration).sendMessageCommand(e.sessionId,e.messageCommand,t).then(s=>s(this.axios,this.basePath))}sendPlaystateCommand(e,t){return Ps(this.configuration).sendPlaystateCommand(e.sessionId,e.command,e.seekPositionTicks,e.controllingUserId,t).then(s=>s(this.axios,this.basePath))}sendSystemCommand(e,t){return Ps(this.configuration).sendSystemCommand(e.sessionId,e.command,t).then(s=>s(this.axios,this.basePath))}}class tL extends eL{constructor(e){super(e.configuration,void 0,e.axiosInstance),this.api=e}reportSessionEnded(e){return super.reportSessionEnded(e).then(t=>(this.api.accessToken="",t))}}function sL(n){return new tL(n)}const iL=function(n){return{authenticateUserByName:async(e,t={})=>{Re("authenticateUserByName","authenticateUserByName",e);const s="/Users/AuthenticateByName",i=new URL(s,Se);let r;n&&(r=n.baseOptions);const l={method:"POST",...r,...t},c={},h={};c["Content-Type"]="application/json",be(i,h);let u=r&&r.headers?r.headers:{};return l.headers={...c,...u,...t.headers},l.data=ys(e,l,n),{url:Te(i),options:l}},authenticateWithQuickConnect:async(e,t={})=>{Re("authenticateWithQuickConnect","quickConnectDto",e);const s="/Users/AuthenticateWithQuickConnect",i=new URL(s,Se);let r;n&&(r=n.baseOptions);const l={method:"POST",...r,...t},c={},h={};c["Content-Type"]="application/json",be(i,h);let u=r&&r.headers?r.headers:{};return l.headers={...c,...u,...t.headers},l.data=ys(e,l,n),{url:Te(i),options:l}},createUserByName:async(e,t={})=>{Re("createUserByName","createUserByName",e);const s="/Users/New",i=new URL(s,Se);let r;n&&(r=n.baseOptions);const l={method:"POST",...r,...t},c={},h={};await _e(c,"Authorization",n),c["Content-Type"]="application/json",be(i,h);let u=r&&r.headers?r.headers:{};return l.headers={...c,...u,...t.headers},l.data=ys(e,l,n),{url:Te(i),options:l}},deleteUser:async(e,t={})=>{Re("deleteUser","userId",e);const s="/Users/{userId}".replace("{userId}",encodeURIComponent(String(e))),i=new URL(s,Se);let r;n&&(r=n.baseOptions);const l={method:"DELETE",...r,...t},c={},h={};await _e(c,"Authorization",n),be(i,h);let u=r&&r.headers?r.headers:{};return l.headers={...c,...u,...t.headers},{url:Te(i),options:l}},forgotPassword:async(e,t={})=>{Re("forgotPassword","forgotPasswordDto",e);const s="/Users/ForgotPassword",i=new URL(s,Se);let r;n&&(r=n.baseOptions);const l={method:"POST",...r,...t},c={},h={};c["Content-Type"]="application/json",be(i,h);let u=r&&r.headers?r.headers:{};return l.headers={...c,...u,...t.headers},l.data=ys(e,l,n),{url:Te(i),options:l}},forgotPasswordPin:async(e,t={})=>{Re("forgotPasswordPin","forgotPasswordPinDto",e);const s="/Users/ForgotPassword/Pin",i=new URL(s,Se);let r;n&&(r=n.baseOptions);const l={method:"POST",...r,...t},c={},h={};c["Content-Type"]="application/json",be(i,h);let u=r&&r.headers?r.headers:{};return l.headers={...c,...u,...t.headers},l.data=ys(e,l,n),{url:Te(i),options:l}},getCurrentUser:async(e={})=>{const t="/Users/Me",s=new URL(t,Se);let i;n&&(i=n.baseOptions);const r={method:"GET",...i,...e},l={},c={};await _e(l,"Authorization",n),be(s,c);let h=i&&i.headers?i.headers:{};return r.headers={...l,...h,...e.headers},{url:Te(s),options:r}},getPublicUsers:async(e={})=>{const t="/Users/Public",s=new URL(t,Se);let i;n&&(i=n.baseOptions);const r={method:"GET",...i,...e},l={};be(s,{});let h=i&&i.headers?i.headers:{};return r.headers={...l,...h,...e.headers},{url:Te(s),options:r}},getUserById:async(e,t={})=>{Re("getUserById","userId",e);const s="/Users/{userId}".replace("{userId}",encodeURIComponent(String(e))),i=new URL(s,Se);let r;n&&(r=n.baseOptions);const l={method:"GET",...r,...t},c={},h={};await _e(c,"Authorization",n),be(i,h);let u=r&&r.headers?r.headers:{};return l.headers={...c,...u,...t.headers},{url:Te(i),options:l}},getUsers:async(e,t,s={})=>{const i="/Users",r=new URL(i,Se);let l;n&&(l=n.baseOptions);const c={method:"GET",...l,...s},h={},u={};await _e(h,"Authorization",n),e!==void 0&&(u.isHidden=e),t!==void 0&&(u.isDisabled=t),be(r,u);let f=l&&l.headers?l.headers:{};return c.headers={...h,...f,...s.headers},{url:Te(r),options:c}},updateUser:async(e,t,s={})=>{Re("updateUser","userDto",e);const i="/Users",r=new URL(i,Se);let l;n&&(l=n.baseOptions);const c={method:"POST",...l,...s},h={},u={};await _e(h,"Authorization",n),t!==void 0&&(u.userId=t),h["Content-Type"]="application/json",be(r,u);let f=l&&l.headers?l.headers:{};return c.headers={...h,...f,...s.headers},c.data=ys(e,c,n),{url:Te(r),options:c}},updateUserConfiguration:async(e,t,s={})=>{Re("updateUserConfiguration","userConfiguration",e);const i="/Users/Configuration",r=new URL(i,Se);let l;n&&(l=n.baseOptions);const c={method:"POST",...l,...s},h={},u={};await _e(h,"Authorization",n),t!==void 0&&(u.userId=t),h["Content-Type"]="application/json",be(r,u);let f=l&&l.headers?l.headers:{};return c.headers={...h,...f,...s.headers},c.data=ys(e,c,n),{url:Te(r),options:c}},updateUserPassword:async(e,t,s={})=>{Re("updateUserPassword","updateUserPassword",e);const i="/Users/Password",r=new URL(i,Se);let l;n&&(l=n.baseOptions);const c={method:"POST",...l,...s},h={},u={};await _e(h,"Authorization",n),t!==void 0&&(u.userId=t),h["Content-Type"]="application/json",be(r,u);let f=l&&l.headers?l.headers:{};return c.headers={...h,...f,...s.headers},c.data=ys(e,c,n),{url:Te(r),options:c}},updateUserPolicy:async(e,t,s={})=>{Re("updateUserPolicy","userId",e),Re("updateUserPolicy","userPolicy",t);const i="/Users/{userId}/Policy".replace("{userId}",encodeURIComponent(String(e))),r=new URL(i,Se);let l;n&&(l=n.baseOptions);const c={method:"POST",...l,...s},h={},u={};await _e(h,"Authorization",n),h["Content-Type"]="application/json",be(r,u);let f=l&&l.headers?l.headers:{};return c.headers={...h,...f,...s.headers},c.data=ys(t,c,n),{url:Te(r),options:c}}}},Xs=function(n){const e=iL(n);return{async authenticateUserByName(t,s){var i,r,l;const c=await e.authenticateUserByName(t,s),h=(i=n?.serverIndex)!==null&&i!==void 0?i:0,u=(l=(r=xe["UserApi.authenticateUserByName"])===null||r===void 0?void 0:r[h])===null||l===void 0?void 0:l.url;return(f,g)=>Ee(c,oe,ye,n)(f,u||g)},async authenticateWithQuickConnect(t,s){var i,r,l;const c=await e.authenticateWithQuickConnect(t,s),h=(i=n?.serverIndex)!==null&&i!==void 0?i:0,u=(l=(r=xe["UserApi.authenticateWithQuickConnect"])===null||r===void 0?void 0:r[h])===null||l===void 0?void 0:l.url;return(f,g)=>Ee(c,oe,ye,n)(f,u||g)},async createUserByName(t,s){var i,r,l;const c=await e.createUserByName(t,s),h=(i=n?.serverIndex)!==null&&i!==void 0?i:0,u=(l=(r=xe["UserApi.createUserByName"])===null||r===void 0?void 0:r[h])===null||l===void 0?void 0:l.url;return(f,g)=>Ee(c,oe,ye,n)(f,u||g)},async deleteUser(t,s){var i,r,l;const c=await e.deleteUser(t,s),h=(i=n?.serverIndex)!==null&&i!==void 0?i:0,u=(l=(r=xe["UserApi.deleteUser"])===null||r===void 0?void 0:r[h])===null||l===void 0?void 0:l.url;return(f,g)=>Ee(c,oe,ye,n)(f,u||g)},async forgotPassword(t,s){var i,r,l;const c=await e.forgotPassword(t,s),h=(i=n?.serverIndex)!==null&&i!==void 0?i:0,u=(l=(r=xe["UserApi.forgotPassword"])===null||r===void 0?void 0:r[h])===null||l===void 0?void 0:l.url;return(f,g)=>Ee(c,oe,ye,n)(f,u||g)},async forgotPasswordPin(t,s){var i,r,l;const c=await e.forgotPasswordPin(t,s),h=(i=n?.serverIndex)!==null&&i!==void 0?i:0,u=(l=(r=xe["UserApi.forgotPasswordPin"])===null||r===void 0?void 0:r[h])===null||l===void 0?void 0:l.url;return(f,g)=>Ee(c,oe,ye,n)(f,u||g)},async getCurrentUser(t){var s,i,r;const l=await e.getCurrentUser(t),c=(s=n?.serverIndex)!==null&&s!==void 0?s:0,h=(r=(i=xe["UserApi.getCurrentUser"])===null||i===void 0?void 0:i[c])===null||r===void 0?void 0:r.url;return(u,f)=>Ee(l,oe,ye,n)(u,h||f)},async getPublicUsers(t){var s,i,r;const l=await e.getPublicUsers(t),c=(s=n?.serverIndex)!==null&&s!==void 0?s:0,h=(r=(i=xe["UserApi.getPublicUsers"])===null||i===void 0?void 0:i[c])===null||r===void 0?void 0:r.url;return(u,f)=>Ee(l,oe,ye,n)(u,h||f)},async getUserById(t,s){var i,r,l;const c=await e.getUserById(t,s),h=(i=n?.serverIndex)!==null&&i!==void 0?i:0,u=(l=(r=xe["UserApi.getUserById"])===null||r===void 0?void 0:r[h])===null||l===void 0?void 0:l.url;return(f,g)=>Ee(c,oe,ye,n)(f,u||g)},async getUsers(t,s,i){var r,l,c;const h=await e.getUsers(t,s,i),u=(r=n?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=xe["UserApi.getUsers"])===null||l===void 0?void 0:l[u])===null||c===void 0?void 0:c.url;return(g,y)=>Ee(h,oe,ye,n)(g,f||y)},async updateUser(t,s,i){var r,l,c;const h=await e.updateUser(t,s,i),u=(r=n?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=xe["UserApi.updateUser"])===null||l===void 0?void 0:l[u])===null||c===void 0?void 0:c.url;return(g,y)=>Ee(h,oe,ye,n)(g,f||y)},async updateUserConfiguration(t,s,i){var r,l,c;const h=await e.updateUserConfiguration(t,s,i),u=(r=n?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=xe["UserApi.updateUserConfiguration"])===null||l===void 0?void 0:l[u])===null||c===void 0?void 0:c.url;return(g,y)=>Ee(h,oe,ye,n)(g,f||y)},async updateUserPassword(t,s,i){var r,l,c;const h=await e.updateUserPassword(t,s,i),u=(r=n?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=xe["UserApi.updateUserPassword"])===null||l===void 0?void 0:l[u])===null||c===void 0?void 0:c.url;return(g,y)=>Ee(h,oe,ye,n)(g,f||y)},async updateUserPolicy(t,s,i){var r,l,c;const h=await e.updateUserPolicy(t,s,i),u=(r=n?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=xe["UserApi.updateUserPolicy"])===null||l===void 0?void 0:l[u])===null||c===void 0?void 0:c.url;return(g,y)=>Ee(h,oe,ye,n)(g,f||y)}}};class xS extends fn{authenticateUserByName(e,t){return Xs(this.configuration).authenticateUserByName(e.authenticateUserByName,t).then(s=>s(this.axios,this.basePath))}authenticateWithQuickConnect(e,t){return Xs(this.configuration).authenticateWithQuickConnect(e.quickConnectDto,t).then(s=>s(this.axios,this.basePath))}createUserByName(e,t){return Xs(this.configuration).createUserByName(e.createUserByName,t).then(s=>s(this.axios,this.basePath))}deleteUser(e,t){return Xs(this.configuration).deleteUser(e.userId,t).then(s=>s(this.axios,this.basePath))}forgotPassword(e,t){return Xs(this.configuration).forgotPassword(e.forgotPasswordDto,t).then(s=>s(this.axios,this.basePath))}forgotPasswordPin(e,t){return Xs(this.configuration).forgotPasswordPin(e.forgotPasswordPinDto,t).then(s=>s(this.axios,this.basePath))}getCurrentUser(e){return Xs(this.configuration).getCurrentUser(e).then(t=>t(this.axios,this.basePath))}getPublicUsers(e){return Xs(this.configuration).getPublicUsers(e).then(t=>t(this.axios,this.basePath))}getUserById(e,t){return Xs(this.configuration).getUserById(e.userId,t).then(s=>s(this.axios,this.basePath))}getUsers(e={},t){return Xs(this.configuration).getUsers(e.isHidden,e.isDisabled,t).then(s=>s(this.axios,this.basePath))}updateUser(e,t){return Xs(this.configuration).updateUser(e.userDto,e.userId,t).then(s=>s(this.axios,this.basePath))}updateUserConfiguration(e,t){return Xs(this.configuration).updateUserConfiguration(e.userConfiguration,e.userId,t).then(s=>s(this.axios,this.basePath))}updateUserPassword(e,t){return Xs(this.configuration).updateUserPassword(e.updateUserPassword,e.userId,t).then(s=>s(this.axios,this.basePath))}updateUserPolicy(e,t){return Xs(this.configuration).updateUserPolicy(e.userId,e.userPolicy,t).then(s=>s(this.axios,this.basePath))}}class nL extends xS{constructor(e){super(e.configuration,void 0,e.axiosInstance),this.api=e}authenticateUserByName(e,t){return super.authenticateUserByName(e,t).then(s=>(this.api.accessToken=s.data.AccessToken||"",s))}authenticateWithQuickConnect(e,t){return super.authenticateWithQuickConnect(e,t).then(s=>(this.api.accessToken=s.data.AccessToken||"",s))}}function aL(n){return new nL(n)}const rL="Authorization";class lL{constructor(e,t,s,i="",r=oe){this.basePath=e.endsWith("/")?e.slice(0,-1):e,this.clientInfo=t,this.deviceInfo=s,this.accessToken=i,this.axiosInstance=r}get configuration(){return new ZR({basePath:this.basePath,baseOptions:{headers:{[rL]:this.authorizationHeader}}})}authenticateUserByName(e,t){return aL(this).authenticateUserByName({authenticateUserByName:{Username:e,Pw:t}})}getUri(e,t){return this.axiosInstance.getUri({baseURL:this.basePath,url:e,params:t})}logout(){return sL(this).reportSessionEnded()}get authorizationHeader(){return XR(this.clientInfo,this.deviceInfo,this.accessToken)}}class oL{constructor(e){this.clientInfo=e.clientInfo,this.deviceInfo=e.deviceInfo,this.discovery=new WR(this)}createApi(e,t,s){return new lL(e,this.clientInfo,this.deviceInfo,t,s)}}const cL=function(n){return{deleteUserItemRating:async(e,t,s={})=>{Re("deleteUserItemRating","itemId",e);const i="/UserItems/{itemId}/Rating".replace("{itemId}",encodeURIComponent(String(e))),r=new URL(i,Se);let l;n&&(l=n.baseOptions);const c={method:"DELETE",...l,...s},h={},u={};await _e(h,"Authorization",n),t!==void 0&&(u.userId=t),be(r,u);let f=l&&l.headers?l.headers:{};return c.headers={...h,...f,...s.headers},{url:Te(r),options:c}},getIntros:async(e,t,s={})=>{Re("getIntros","itemId",e);const i="/Items/{itemId}/Intros".replace("{itemId}",encodeURIComponent(String(e))),r=new URL(i,Se);let l;n&&(l=n.baseOptions);const c={method:"GET",...l,...s},h={},u={};await _e(h,"Authorization",n),t!==void 0&&(u.userId=t),be(r,u);let f=l&&l.headers?l.headers:{};return c.headers={...h,...f,...s.headers},{url:Te(r),options:c}},getItem:async(e,t,s={})=>{Re("getItem","itemId",e);const i="/Items/{itemId}".replace("{itemId}",encodeURIComponent(String(e))),r=new URL(i,Se);let l;n&&(l=n.baseOptions);const c={method:"GET",...l,...s},h={},u={};await _e(h,"Authorization",n),t!==void 0&&(u.userId=t),be(r,u);let f=l&&l.headers?l.headers:{};return c.headers={...h,...f,...s.headers},{url:Te(r),options:c}},getLatestMedia:async(e,t,s,i,r,l,c,h,u,f,g,y={})=>{const x="/Items/Latest",S=new URL(x,Se);let E;n&&(E=n.baseOptions);const T={method:"GET",...E,...y},A={},_={};await _e(A,"Authorization",n),e!==void 0&&(_.userId=e),t!==void 0&&(_.parentId=t),s&&(_.fields=s),i&&(_.includeItemTypes=i),r!==void 0&&(_.isPlayed=r),l!==void 0&&(_.enableImages=l),c!==void 0&&(_.imageTypeLimit=c),h&&(_.enableImageTypes=h),u!==void 0&&(_.enableUserData=u),f!==void 0&&(_.limit=f),g!==void 0&&(_.groupItems=g),be(S,_);let I=E&&E.headers?E.headers:{};return T.headers={...A,...I,...y.headers},{url:Te(S),options:T}},getLocalTrailers:async(e,t,s={})=>{Re("getLocalTrailers","itemId",e);const i="/Items/{itemId}/LocalTrailers".replace("{itemId}",encodeURIComponent(String(e))),r=new URL(i,Se);let l;n&&(l=n.baseOptions);const c={method:"GET",...l,...s},h={},u={};await _e(h,"Authorization",n),t!==void 0&&(u.userId=t),be(r,u);let f=l&&l.headers?l.headers:{};return c.headers={...h,...f,...s.headers},{url:Te(r),options:c}},getRootFolder:async(e,t={})=>{const s="/Items/Root",i=new URL(s,Se);let r;n&&(r=n.baseOptions);const l={method:"GET",...r,...t},c={},h={};await _e(c,"Authorization",n),e!==void 0&&(h.userId=e),be(i,h);let u=r&&r.headers?r.headers:{};return l.headers={...c,...u,...t.headers},{url:Te(i),options:l}},getSpecialFeatures:async(e,t,s={})=>{Re("getSpecialFeatures","itemId",e);const i="/Items/{itemId}/SpecialFeatures".replace("{itemId}",encodeURIComponent(String(e))),r=new URL(i,Se);let l;n&&(l=n.baseOptions);const c={method:"GET",...l,...s},h={},u={};await _e(h,"Authorization",n),t!==void 0&&(u.userId=t),be(r,u);let f=l&&l.headers?l.headers:{};return c.headers={...h,...f,...s.headers},{url:Te(r),options:c}},markFavoriteItem:async(e,t,s={})=>{Re("markFavoriteItem","itemId",e);const i="/UserFavoriteItems/{itemId}".replace("{itemId}",encodeURIComponent(String(e))),r=new URL(i,Se);let l;n&&(l=n.baseOptions);const c={method:"POST",...l,...s},h={},u={};await _e(h,"Authorization",n),t!==void 0&&(u.userId=t),be(r,u);let f=l&&l.headers?l.headers:{};return c.headers={...h,...f,...s.headers},{url:Te(r),options:c}},unmarkFavoriteItem:async(e,t,s={})=>{Re("unmarkFavoriteItem","itemId",e);const i="/UserFavoriteItems/{itemId}".replace("{itemId}",encodeURIComponent(String(e))),r=new URL(i,Se);let l;n&&(l=n.baseOptions);const c={method:"DELETE",...l,...s},h={},u={};await _e(h,"Authorization",n),t!==void 0&&(u.userId=t),be(r,u);let f=l&&l.headers?l.headers:{};return c.headers={...h,...f,...s.headers},{url:Te(r),options:c}},updateUserItemRating:async(e,t,s,i={})=>{Re("updateUserItemRating","itemId",e);const r="/UserItems/{itemId}/Rating".replace("{itemId}",encodeURIComponent(String(e))),l=new URL(r,Se);let c;n&&(c=n.baseOptions);const h={method:"POST",...c,...i},u={},f={};await _e(u,"Authorization",n),t!==void 0&&(f.userId=t),s!==void 0&&(f.likes=s),be(l,f);let g=c&&c.headers?c.headers:{};return h.headers={...u,...g,...i.headers},{url:Te(l),options:h}}}},sn=function(n){const e=cL(n);return{async deleteUserItemRating(t,s,i){var r,l,c;const h=await e.deleteUserItemRating(t,s,i),u=(r=n?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=xe["UserLibraryApi.deleteUserItemRating"])===null||l===void 0?void 0:l[u])===null||c===void 0?void 0:c.url;return(g,y)=>Ee(h,oe,ye,n)(g,f||y)},async getIntros(t,s,i){var r,l,c;const h=await e.getIntros(t,s,i),u=(r=n?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=xe["UserLibraryApi.getIntros"])===null||l===void 0?void 0:l[u])===null||c===void 0?void 0:c.url;return(g,y)=>Ee(h,oe,ye,n)(g,f||y)},async getItem(t,s,i){var r,l,c;const h=await e.getItem(t,s,i),u=(r=n?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=xe["UserLibraryApi.getItem"])===null||l===void 0?void 0:l[u])===null||c===void 0?void 0:c.url;return(g,y)=>Ee(h,oe,ye,n)(g,f||y)},async getLatestMedia(t,s,i,r,l,c,h,u,f,g,y,x){var S,E,T;const A=await e.getLatestMedia(t,s,i,r,l,c,h,u,f,g,y,x),_=(S=n?.serverIndex)!==null&&S!==void 0?S:0,I=(T=(E=xe["UserLibraryApi.getLatestMedia"])===null||E===void 0?void 0:E[_])===null||T===void 0?void 0:T.url;return(C,N)=>Ee(A,oe,ye,n)(C,I||N)},async getLocalTrailers(t,s,i){var r,l,c;const h=await e.getLocalTrailers(t,s,i),u=(r=n?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=xe["UserLibraryApi.getLocalTrailers"])===null||l===void 0?void 0:l[u])===null||c===void 0?void 0:c.url;return(g,y)=>Ee(h,oe,ye,n)(g,f||y)},async getRootFolder(t,s){var i,r,l;const c=await e.getRootFolder(t,s),h=(i=n?.serverIndex)!==null&&i!==void 0?i:0,u=(l=(r=xe["UserLibraryApi.getRootFolder"])===null||r===void 0?void 0:r[h])===null||l===void 0?void 0:l.url;return(f,g)=>Ee(c,oe,ye,n)(f,u||g)},async getSpecialFeatures(t,s,i){var r,l,c;const h=await e.getSpecialFeatures(t,s,i),u=(r=n?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=xe["UserLibraryApi.getSpecialFeatures"])===null||l===void 0?void 0:l[u])===null||c===void 0?void 0:c.url;return(g,y)=>Ee(h,oe,ye,n)(g,f||y)},async markFavoriteItem(t,s,i){var r,l,c;const h=await e.markFavoriteItem(t,s,i),u=(r=n?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=xe["UserLibraryApi.markFavoriteItem"])===null||l===void 0?void 0:l[u])===null||c===void 0?void 0:c.url;return(g,y)=>Ee(h,oe,ye,n)(g,f||y)},async unmarkFavoriteItem(t,s,i){var r,l,c;const h=await e.unmarkFavoriteItem(t,s,i),u=(r=n?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=xe["UserLibraryApi.unmarkFavoriteItem"])===null||l===void 0?void 0:l[u])===null||c===void 0?void 0:c.url;return(g,y)=>Ee(h,oe,ye,n)(g,f||y)},async updateUserItemRating(t,s,i,r){var l,c,h;const u=await e.updateUserItemRating(t,s,i,r),f=(l=n?.serverIndex)!==null&&l!==void 0?l:0,g=(h=(c=xe["UserLibraryApi.updateUserItemRating"])===null||c===void 0?void 0:c[f])===null||h===void 0?void 0:h.url;return(y,x)=>Ee(u,oe,ye,n)(y,g||x)}}};class uL extends fn{deleteUserItemRating(e,t){return sn(this.configuration).deleteUserItemRating(e.itemId,e.userId,t).then(s=>s(this.axios,this.basePath))}getIntros(e,t){return sn(this.configuration).getIntros(e.itemId,e.userId,t).then(s=>s(this.axios,this.basePath))}getItem(e,t){return sn(this.configuration).getItem(e.itemId,e.userId,t).then(s=>s(this.axios,this.basePath))}getLatestMedia(e={},t){return sn(this.configuration).getLatestMedia(e.userId,e.parentId,e.fields,e.includeItemTypes,e.isPlayed,e.enableImages,e.imageTypeLimit,e.enableImageTypes,e.enableUserData,e.limit,e.groupItems,t).then(s=>s(this.axios,this.basePath))}getLocalTrailers(e,t){return sn(this.configuration).getLocalTrailers(e.itemId,e.userId,t).then(s=>s(this.axios,this.basePath))}getRootFolder(e={},t){return sn(this.configuration).getRootFolder(e.userId,t).then(s=>s(this.axios,this.basePath))}getSpecialFeatures(e,t){return sn(this.configuration).getSpecialFeatures(e.itemId,e.userId,t).then(s=>s(this.axios,this.basePath))}markFavoriteItem(e,t){return sn(this.configuration).markFavoriteItem(e.itemId,e.userId,t).then(s=>s(this.axios,this.basePath))}unmarkFavoriteItem(e,t){return sn(this.configuration).unmarkFavoriteItem(e.itemId,e.userId,t).then(s=>s(this.axios,this.basePath))}updateUserItemRating(e,t){return sn(this.configuration).updateUserItemRating(e.itemId,e.userId,e.likes,t).then(s=>s(this.axios,this.basePath))}}const dL=function(n){return{getGroupingOptions:async(e,t={})=>{const s="/UserViews/GroupingOptions",i=new URL(s,Se);let r;n&&(r=n.baseOptions);const l={method:"GET",...r,...t},c={},h={};await _e(c,"Authorization",n),e!==void 0&&(h.userId=e),be(i,h);let u=r&&r.headers?r.headers:{};return l.headers={...c,...u,...t.headers},{url:Te(i),options:l}},getUserViews:async(e,t,s,i,r={})=>{const l="/UserViews",c=new URL(l,Se);let h;n&&(h=n.baseOptions);const u={method:"GET",...h,...r},f={},g={};await _e(f,"Authorization",n),e!==void 0&&(g.userId=e),t!==void 0&&(g.includeExternalContent=t),s&&(g.presetViews=s),i!==void 0&&(g.includeHidden=i),be(c,g);let y=h&&h.headers?h.headers:{};return u.headers={...f,...y,...r.headers},{url:Te(c),options:u}}}},tv=function(n){const e=dL(n);return{async getGroupingOptions(t,s){var i,r,l;const c=await e.getGroupingOptions(t,s),h=(i=n?.serverIndex)!==null&&i!==void 0?i:0,u=(l=(r=xe["UserViewsApi.getGroupingOptions"])===null||r===void 0?void 0:r[h])===null||l===void 0?void 0:l.url;return(f,g)=>Ee(c,oe,ye,n)(f,u||g)},async getUserViews(t,s,i,r,l){var c,h,u;const f=await e.getUserViews(t,s,i,r,l),g=(c=n?.serverIndex)!==null&&c!==void 0?c:0,y=(u=(h=xe["UserViewsApi.getUserViews"])===null||h===void 0?void 0:h[g])===null||u===void 0?void 0:u.url;return(x,S)=>Ee(f,oe,ye,n)(x,y||S)}}};class hL extends fn{getGroupingOptions(e={},t){return tv(this.configuration).getGroupingOptions(e.userId,t).then(s=>s(this.axios,this.basePath))}getUserViews(e={},t){return tv(this.configuration).getUserViews(e.userId,e.includeExternalContent,e.presetViews,e.includeHidden,t).then(s=>s(this.axios,this.basePath))}}const fL=function(n){return{getItemUserData:async(e,t,s={})=>{Re("getItemUserData","itemId",e);const i="/UserItems/{itemId}/UserData".replace("{itemId}",encodeURIComponent(String(e))),r=new URL(i,Se);let l;n&&(l=n.baseOptions);const c={method:"GET",...l,...s},h={},u={};await _e(h,"Authorization",n),t!==void 0&&(u.userId=t),be(r,u);let f=l&&l.headers?l.headers:{};return c.headers={...h,...f,...s.headers},{url:Te(r),options:c}},getItems:async(e,t,s,i,r,l,c,h,u,f,g,y,x,S,E,T,A,_,I,C,N,D,k,B,j,U,K,H,J,re,me,M,$,F,ae,de,P,G,te,fe,ve,Ae,De,Ge,Fe,mt,St,jt,bt,ut,zt,Me,Le,Ue,Ze,ht,Oe,He,pt,nt,Kt,ge,Qe,st,Zt,Rs,vs,bi,js,Bt,cs,wt,ii,Ti,Ls,ws,Cs,ni,Bs,Ns,Gs,ai,Qi,Jt,us,Os,Fs={})=>{const Bi="/Items",ce=new URL(Bi,Se);let Ce;n&&(Ce=n.baseOptions);const Je={method:"GET",...Ce,...Fs},is={},Ie={};await _e(is,"Authorization",n),e!==void 0&&(Ie.userId=e),t!==void 0&&(Ie.maxOfficialRating=t),s!==void 0&&(Ie.hasThemeSong=s),i!==void 0&&(Ie.hasThemeVideo=i),r!==void 0&&(Ie.hasSubtitles=r),l!==void 0&&(Ie.hasSpecialFeature=l),c!==void 0&&(Ie.hasTrailer=c),h!==void 0&&(Ie.adjacentTo=h),u!==void 0&&(Ie.indexNumber=u),f!==void 0&&(Ie.parentIndexNumber=f),g!==void 0&&(Ie.hasParentalRating=g),y!==void 0&&(Ie.isHd=y),x!==void 0&&(Ie.is4K=x),S&&(Ie.locationTypes=S),E&&(Ie.excludeLocationTypes=E),T!==void 0&&(Ie.isMissing=T),A!==void 0&&(Ie.isUnaired=A),_!==void 0&&(Ie.minCommunityRating=_),I!==void 0&&(Ie.minCriticRating=I),C!==void 0&&(Ie.minPremiereDate=C instanceof Date?C.toISOString():C),N!==void 0&&(Ie.minDateLastSaved=N instanceof Date?N.toISOString():N),D!==void 0&&(Ie.minDateLastSavedForUser=D instanceof Date?D.toISOString():D),k!==void 0&&(Ie.maxPremiereDate=k instanceof Date?k.toISOString():k),B!==void 0&&(Ie.hasOverview=B),j!==void 0&&(Ie.hasImdbId=j),U!==void 0&&(Ie.hasTmdbId=U),K!==void 0&&(Ie.hasTvdbId=K),H!==void 0&&(Ie.isMovie=H),J!==void 0&&(Ie.isSeries=J),re!==void 0&&(Ie.isNews=re),me!==void 0&&(Ie.isKids=me),M!==void 0&&(Ie.isSports=M),$&&(Ie.excludeItemIds=$),F!==void 0&&(Ie.startIndex=F),ae!==void 0&&(Ie.limit=ae),de!==void 0&&(Ie.recursive=de),P!==void 0&&(Ie.searchTerm=P),G&&(Ie.sortOrder=G),te!==void 0&&(Ie.parentId=te),fe&&(Ie.fields=fe),ve&&(Ie.excludeItemTypes=ve),Ae&&(Ie.includeItemTypes=Ae),De&&(Ie.filters=De),Ge!==void 0&&(Ie.isFavorite=Ge),Fe&&(Ie.mediaTypes=Fe),mt&&(Ie.imageTypes=mt),St&&(Ie.sortBy=St),jt!==void 0&&(Ie.isPlayed=jt),bt&&(Ie.genres=bt),ut&&(Ie.officialRatings=ut),zt&&(Ie.tags=zt),Me&&(Ie.years=Me),Le!==void 0&&(Ie.enableUserData=Le),Ue!==void 0&&(Ie.imageTypeLimit=Ue),Ze&&(Ie.enableImageTypes=Ze),ht!==void 0&&(Ie.person=ht),Oe&&(Ie.personIds=Oe),He&&(Ie.personTypes=He),pt&&(Ie.studios=pt),nt&&(Ie.artists=nt),Kt&&(Ie.excludeArtistIds=Kt),ge&&(Ie.artistIds=ge),Qe&&(Ie.albumArtistIds=Qe),st&&(Ie.contributingArtistIds=st),Zt&&(Ie.albums=Zt),Rs&&(Ie.albumIds=Rs),vs&&(Ie.ids=vs),bi&&(Ie.videoTypes=bi),js!==void 0&&(Ie.minOfficialRating=js),Bt!==void 0&&(Ie.isLocked=Bt),cs!==void 0&&(Ie.isPlaceHolder=cs),wt!==void 0&&(Ie.hasOfficialRating=wt),ii!==void 0&&(Ie.collapseBoxSetItems=ii),Ti!==void 0&&(Ie.minWidth=Ti),Ls!==void 0&&(Ie.minHeight=Ls),ws!==void 0&&(Ie.maxWidth=ws),Cs!==void 0&&(Ie.maxHeight=Cs),ni!==void 0&&(Ie.is3D=ni),Bs&&(Ie.seriesStatus=Bs),Ns!==void 0&&(Ie.nameStartsWithOrGreater=Ns),Gs!==void 0&&(Ie.nameStartsWith=Gs),ai!==void 0&&(Ie.nameLessThan=ai),Qi&&(Ie.studioIds=Qi),Jt&&(Ie.genreIds=Jt),us!==void 0&&(Ie.enableTotalRecordCount=us),Os!==void 0&&(Ie.enableImages=Os),be(ce,Ie);let ks=Ce&&Ce.headers?Ce.headers:{};return Je.headers={...is,...ks,...Fs.headers},{url:Te(ce),options:Je}},getResumeItems:async(e,t,s,i,r,l,c,h,u,f,g,y,x,S,E,T={})=>{const A="/UserItems/Resume",_=new URL(A,Se);let I;n&&(I=n.baseOptions);const C={method:"GET",...I,...T},N={},D={};await _e(N,"Authorization",n),e!==void 0&&(D.userId=e),t!==void 0&&(D.startIndex=t),s!==void 0&&(D.limit=s),i!==void 0&&(D.searchTerm=i),r!==void 0&&(D.parentId=r),l&&(D.fields=l),c&&(D.mediaTypes=c),h!==void 0&&(D.enableUserData=h),u!==void 0&&(D.imageTypeLimit=u),f&&(D.enableImageTypes=f),g&&(D.excludeItemTypes=g),y&&(D.includeItemTypes=y),x!==void 0&&(D.enableTotalRecordCount=x),S!==void 0&&(D.enableImages=S),E!==void 0&&(D.excludeActiveSessions=E),be(_,D);let k=I&&I.headers?I.headers:{};return C.headers={...N,...k,...T.headers},{url:Te(_),options:C}},updateItemUserData:async(e,t,s,i={})=>{Re("updateItemUserData","itemId",e),Re("updateItemUserData","updateUserItemDataDto",t);const r="/UserItems/{itemId}/UserData".replace("{itemId}",encodeURIComponent(String(e))),l=new URL(r,Se);let c;n&&(c=n.baseOptions);const h={method:"POST",...c,...i},u={},f={};await _e(u,"Authorization",n),s!==void 0&&(f.userId=s),u["Content-Type"]="application/json",be(l,f);let g=c&&c.headers?c.headers:{};return h.headers={...u,...g,...i.headers},h.data=ys(t,h,n),{url:Te(l),options:h}}}},Oc=function(n){const e=fL(n);return{async getItemUserData(t,s,i){var r,l,c;const h=await e.getItemUserData(t,s,i),u=(r=n?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=xe["ItemsApi.getItemUserData"])===null||l===void 0?void 0:l[u])===null||c===void 0?void 0:c.url;return(g,y)=>Ee(h,oe,ye,n)(g,f||y)},async getItems(t,s,i,r,l,c,h,u,f,g,y,x,S,E,T,A,_,I,C,N,D,k,B,j,U,K,H,J,re,me,M,$,F,ae,de,P,G,te,fe,ve,Ae,De,Ge,Fe,mt,St,jt,bt,ut,zt,Me,Le,Ue,Ze,ht,Oe,He,pt,nt,Kt,ge,Qe,st,Zt,Rs,vs,bi,js,Bt,cs,wt,ii,Ti,Ls,ws,Cs,ni,Bs,Ns,Gs,ai,Qi,Jt,us,Os,Fs,Bi){var ce,Ce,Je;const is=await e.getItems(t,s,i,r,l,c,h,u,f,g,y,x,S,E,T,A,_,I,C,N,D,k,B,j,U,K,H,J,re,me,M,$,F,ae,de,P,G,te,fe,ve,Ae,De,Ge,Fe,mt,St,jt,bt,ut,zt,Me,Le,Ue,Ze,ht,Oe,He,pt,nt,Kt,ge,Qe,st,Zt,Rs,vs,bi,js,Bt,cs,wt,ii,Ti,Ls,ws,Cs,ni,Bs,Ns,Gs,ai,Qi,Jt,us,Os,Fs,Bi),Ie=(ce=n?.serverIndex)!==null&&ce!==void 0?ce:0,ks=(Je=(Ce=xe["ItemsApi.getItems"])===null||Ce===void 0?void 0:Ce[Ie])===null||Je===void 0?void 0:Je.url;return(At,gt)=>Ee(is,oe,ye,n)(At,ks||gt)},async getResumeItems(t,s,i,r,l,c,h,u,f,g,y,x,S,E,T,A){var _,I,C;const N=await e.getResumeItems(t,s,i,r,l,c,h,u,f,g,y,x,S,E,T,A),D=(_=n?.serverIndex)!==null&&_!==void 0?_:0,k=(C=(I=xe["ItemsApi.getResumeItems"])===null||I===void 0?void 0:I[D])===null||C===void 0?void 0:C.url;return(B,j)=>Ee(N,oe,ye,n)(B,k||j)},async updateItemUserData(t,s,i,r){var l,c,h;const u=await e.updateItemUserData(t,s,i,r),f=(l=n?.serverIndex)!==null&&l!==void 0?l:0,g=(h=(c=xe["ItemsApi.updateItemUserData"])===null||c===void 0?void 0:c[f])===null||h===void 0?void 0:h.url;return(y,x)=>Ee(u,oe,ye,n)(y,g||x)}}};class mL extends fn{getItemUserData(e,t){return Oc(this.configuration).getItemUserData(e.itemId,e.userId,t).then(s=>s(this.axios,this.basePath))}getItems(e={},t){return Oc(this.configuration).getItems(e.userId,e.maxOfficialRating,e.hasThemeSong,e.hasThemeVideo,e.hasSubtitles,e.hasSpecialFeature,e.hasTrailer,e.adjacentTo,e.indexNumber,e.parentIndexNumber,e.hasParentalRating,e.isHd,e.is4K,e.locationTypes,e.excludeLocationTypes,e.isMissing,e.isUnaired,e.minCommunityRating,e.minCriticRating,e.minPremiereDate,e.minDateLastSaved,e.minDateLastSavedForUser,e.maxPremiereDate,e.hasOverview,e.hasImdbId,e.hasTmdbId,e.hasTvdbId,e.isMovie,e.isSeries,e.isNews,e.isKids,e.isSports,e.excludeItemIds,e.startIndex,e.limit,e.recursive,e.searchTerm,e.sortOrder,e.parentId,e.fields,e.excludeItemTypes,e.includeItemTypes,e.filters,e.isFavorite,e.mediaTypes,e.imageTypes,e.sortBy,e.isPlayed,e.genres,e.officialRatings,e.tags,e.years,e.enableUserData,e.imageTypeLimit,e.enableImageTypes,e.person,e.personIds,e.personTypes,e.studios,e.artists,e.excludeArtistIds,e.artistIds,e.albumArtistIds,e.contributingArtistIds,e.albums,e.albumIds,e.ids,e.videoTypes,e.minOfficialRating,e.isLocked,e.isPlaceHolder,e.hasOfficialRating,e.collapseBoxSetItems,e.minWidth,e.minHeight,e.maxWidth,e.maxHeight,e.is3D,e.seriesStatus,e.nameStartsWithOrGreater,e.nameStartsWith,e.nameLessThan,e.studioIds,e.genreIds,e.enableTotalRecordCount,e.enableImages,t).then(s=>s(this.axios,this.basePath))}getResumeItems(e={},t){return Oc(this.configuration).getResumeItems(e.userId,e.startIndex,e.limit,e.searchTerm,e.parentId,e.fields,e.mediaTypes,e.enableUserData,e.imageTypeLimit,e.enableImageTypes,e.excludeItemTypes,e.includeItemTypes,e.enableTotalRecordCount,e.enableImages,e.excludeActiveSessions,t).then(s=>s(this.axios,this.basePath))}updateItemUserData(e,t){return Oc(this.configuration).updateItemUserData(e.itemId,e.updateUserItemDataDto,e.userId,t).then(s=>s(this.axios,this.basePath))}}const pL=function(n){return{getEpisodes:async(e,t,s,i,r,l,c,h,u,f,g,y,x,S,E,T={})=>{Re("getEpisodes","seriesId",e);const A="/Shows/{seriesId}/Episodes".replace("{seriesId}",encodeURIComponent(String(e))),_=new URL(A,Se);let I;n&&(I=n.baseOptions);const C={method:"GET",...I,...T},N={},D={};await _e(N,"Authorization",n),t!==void 0&&(D.userId=t),s&&(D.fields=s),i!==void 0&&(D.season=i),r!==void 0&&(D.seasonId=r),l!==void 0&&(D.isMissing=l),c!==void 0&&(D.adjacentTo=c),h!==void 0&&(D.startItemId=h),u!==void 0&&(D.startIndex=u),f!==void 0&&(D.limit=f),g!==void 0&&(D.enableImages=g),y!==void 0&&(D.imageTypeLimit=y),x&&(D.enableImageTypes=x),S!==void 0&&(D.enableUserData=S),E!==void 0&&(D.sortBy=E),be(_,D);let k=I&&I.headers?I.headers:{};return C.headers={...N,...k,...T.headers},{url:Te(_),options:C}},getNextUp:async(e,t,s,i,r,l,c,h,u,f,g,y,x,S,E,T={})=>{const A="/Shows/NextUp",_=new URL(A,Se);let I;n&&(I=n.baseOptions);const C={method:"GET",...I,...T},N={},D={};await _e(N,"Authorization",n),e!==void 0&&(D.userId=e),t!==void 0&&(D.startIndex=t),s!==void 0&&(D.limit=s),i&&(D.fields=i),r!==void 0&&(D.seriesId=r),l!==void 0&&(D.parentId=l),c!==void 0&&(D.enableImages=c),h!==void 0&&(D.imageTypeLimit=h),u&&(D.enableImageTypes=u),f!==void 0&&(D.enableUserData=f),g!==void 0&&(D.nextUpDateCutoff=g instanceof Date?g.toISOString():g),y!==void 0&&(D.enableTotalRecordCount=y),x!==void 0&&(D.disableFirstEpisode=x),S!==void 0&&(D.enableResumable=S),E!==void 0&&(D.enableRewatching=E),be(_,D);let k=I&&I.headers?I.headers:{};return C.headers={...N,...k,...T.headers},{url:Te(_),options:C}},getSeasons:async(e,t,s,i,r,l,c,h,u,f,g={})=>{Re("getSeasons","seriesId",e);const y="/Shows/{seriesId}/Seasons".replace("{seriesId}",encodeURIComponent(String(e))),x=new URL(y,Se);let S;n&&(S=n.baseOptions);const E={method:"GET",...S,...g},T={},A={};await _e(T,"Authorization",n),t!==void 0&&(A.userId=t),s&&(A.fields=s),i!==void 0&&(A.isSpecialSeason=i),r!==void 0&&(A.isMissing=r),l!==void 0&&(A.adjacentTo=l),c!==void 0&&(A.enableImages=c),h!==void 0&&(A.imageTypeLimit=h),u&&(A.enableImageTypes=u),f!==void 0&&(A.enableUserData=f),be(x,A);let _=S&&S.headers?S.headers:{};return E.headers={...T,..._,...g.headers},{url:Te(x),options:E}},getUpcomingEpisodes:async(e,t,s,i,r,l,c,h,u,f={})=>{const g="/Shows/Upcoming",y=new URL(g,Se);let x;n&&(x=n.baseOptions);const S={method:"GET",...x,...f},E={},T={};await _e(E,"Authorization",n),e!==void 0&&(T.userId=e),t!==void 0&&(T.startIndex=t),s!==void 0&&(T.limit=s),i&&(T.fields=i),r!==void 0&&(T.parentId=r),l!==void 0&&(T.enableImages=l),c!==void 0&&(T.imageTypeLimit=c),h&&(T.enableImageTypes=h),u!==void 0&&(T.enableUserData=u),be(y,T);let A=x&&x.headers?x.headers:{};return S.headers={...E,...A,...f.headers},{url:Te(y),options:S}}}},kc=function(n){const e=pL(n);return{async getEpisodes(t,s,i,r,l,c,h,u,f,g,y,x,S,E,T,A){var _,I,C;const N=await e.getEpisodes(t,s,i,r,l,c,h,u,f,g,y,x,S,E,T,A),D=(_=n?.serverIndex)!==null&&_!==void 0?_:0,k=(C=(I=xe["TvShowsApi.getEpisodes"])===null||I===void 0?void 0:I[D])===null||C===void 0?void 0:C.url;return(B,j)=>Ee(N,oe,ye,n)(B,k||j)},async getNextUp(t,s,i,r,l,c,h,u,f,g,y,x,S,E,T,A){var _,I,C;const N=await e.getNextUp(t,s,i,r,l,c,h,u,f,g,y,x,S,E,T,A),D=(_=n?.serverIndex)!==null&&_!==void 0?_:0,k=(C=(I=xe["TvShowsApi.getNextUp"])===null||I===void 0?void 0:I[D])===null||C===void 0?void 0:C.url;return(B,j)=>Ee(N,oe,ye,n)(B,k||j)},async getSeasons(t,s,i,r,l,c,h,u,f,g,y){var x,S,E;const T=await e.getSeasons(t,s,i,r,l,c,h,u,f,g,y),A=(x=n?.serverIndex)!==null&&x!==void 0?x:0,_=(E=(S=xe["TvShowsApi.getSeasons"])===null||S===void 0?void 0:S[A])===null||E===void 0?void 0:E.url;return(I,C)=>Ee(T,oe,ye,n)(I,_||C)},async getUpcomingEpisodes(t,s,i,r,l,c,h,u,f,g){var y,x,S;const E=await e.getUpcomingEpisodes(t,s,i,r,l,c,h,u,f,g),T=(y=n?.serverIndex)!==null&&y!==void 0?y:0,A=(S=(x=xe["TvShowsApi.getUpcomingEpisodes"])===null||x===void 0?void 0:x[T])===null||S===void 0?void 0:S.url;return(_,I)=>Ee(E,oe,ye,n)(_,A||I)}}};class gL extends fn{getEpisodes(e,t){return kc(this.configuration).getEpisodes(e.seriesId,e.userId,e.fields,e.season,e.seasonId,e.isMissing,e.adjacentTo,e.startItemId,e.startIndex,e.limit,e.enableImages,e.imageTypeLimit,e.enableImageTypes,e.enableUserData,e.sortBy,t).then(s=>s(this.axios,this.basePath))}getNextUp(e={},t){return kc(this.configuration).getNextUp(e.userId,e.startIndex,e.limit,e.fields,e.seriesId,e.parentId,e.enableImages,e.imageTypeLimit,e.enableImageTypes,e.enableUserData,e.nextUpDateCutoff,e.enableTotalRecordCount,e.disableFirstEpisode,e.enableResumable,e.enableRewatching,t).then(s=>s(this.axios,this.basePath))}getSeasons(e,t){return kc(this.configuration).getSeasons(e.seriesId,e.userId,e.fields,e.isSpecialSeason,e.isMissing,e.adjacentTo,e.enableImages,e.imageTypeLimit,e.enableImageTypes,e.enableUserData,t).then(s=>s(this.axios,this.basePath))}getUpcomingEpisodes(e={},t){return kc(this.configuration).getUpcomingEpisodes(e.userId,e.startIndex,e.limit,e.fields,e.parentId,e.enableImages,e.imageTypeLimit,e.enableImageTypes,e.enableUserData,t).then(s=>s(this.axios,this.basePath))}}const yL=function(n){return{deleteItem:async(e,t={})=>{Re("deleteItem","itemId",e);const s="/Items/{itemId}".replace("{itemId}",encodeURIComponent(String(e))),i=new URL(s,Se);let r;n&&(r=n.baseOptions);const l={method:"DELETE",...r,...t},c={},h={};await _e(c,"Authorization",n),be(i,h);let u=r&&r.headers?r.headers:{};return l.headers={...c,...u,...t.headers},{url:Te(i),options:l}},deleteItems:async(e,t={})=>{const s="/Items",i=new URL(s,Se);let r;n&&(r=n.baseOptions);const l={method:"DELETE",...r,...t},c={},h={};await _e(c,"Authorization",n),e&&(h.ids=e),be(i,h);let u=r&&r.headers?r.headers:{};return l.headers={...c,...u,...t.headers},{url:Te(i),options:l}},getAncestors:async(e,t,s={})=>{Re("getAncestors","itemId",e);const i="/Items/{itemId}/Ancestors".replace("{itemId}",encodeURIComponent(String(e))),r=new URL(i,Se);let l;n&&(l=n.baseOptions);const c={method:"GET",...l,...s},h={},u={};await _e(h,"Authorization",n),t!==void 0&&(u.userId=t),be(r,u);let f=l&&l.headers?l.headers:{};return c.headers={...h,...f,...s.headers},{url:Te(r),options:c}},getCriticReviews:async(e,t={})=>{Re("getCriticReviews","itemId",e);const s="/Items/{itemId}/CriticReviews".replace("{itemId}",encodeURIComponent(String(e))),i=new URL(s,Se);let r;n&&(r=n.baseOptions);const l={method:"GET",...r,...t},c={},h={};await _e(c,"Authorization",n),be(i,h);let u=r&&r.headers?r.headers:{};return l.headers={...c,...u,...t.headers},{url:Te(i),options:l}},getDownload:async(e,t={})=>{Re("getDownload","itemId",e);const s="/Items/{itemId}/Download".replace("{itemId}",encodeURIComponent(String(e))),i=new URL(s,Se);let r;n&&(r=n.baseOptions);const l={method:"GET",...r,...t},c={},h={};await _e(c,"Authorization",n),be(i,h);let u=r&&r.headers?r.headers:{};return l.headers={...c,...u,...t.headers},{url:Te(i),options:l}},getFile:async(e,t={})=>{Re("getFile","itemId",e);const s="/Items/{itemId}/File".replace("{itemId}",encodeURIComponent(String(e))),i=new URL(s,Se);let r;n&&(r=n.baseOptions);const l={method:"GET",...r,...t},c={},h={};await _e(c,"Authorization",n),be(i,h);let u=r&&r.headers?r.headers:{};return l.headers={...c,...u,...t.headers},{url:Te(i),options:l}},getItemCounts:async(e,t,s={})=>{const i="/Items/Counts",r=new URL(i,Se);let l;n&&(l=n.baseOptions);const c={method:"GET",...l,...s},h={},u={};await _e(h,"Authorization",n),e!==void 0&&(u.userId=e),t!==void 0&&(u.isFavorite=t),be(r,u);let f=l&&l.headers?l.headers:{};return c.headers={...h,...f,...s.headers},{url:Te(r),options:c}},getLibraryOptionsInfo:async(e,t,s={})=>{const i="/Libraries/AvailableOptions",r=new URL(i,Se);let l;n&&(l=n.baseOptions);const c={method:"GET",...l,...s},h={},u={};await _e(h,"Authorization",n),e!==void 0&&(u.libraryContentType=e),t!==void 0&&(u.isNewLibrary=t),be(r,u);let f=l&&l.headers?l.headers:{};return c.headers={...h,...f,...s.headers},{url:Te(r),options:c}},getMediaFolders:async(e,t={})=>{const s="/Library/MediaFolders",i=new URL(s,Se);let r;n&&(r=n.baseOptions);const l={method:"GET",...r,...t},c={},h={};await _e(c,"Authorization",n),e!==void 0&&(h.isHidden=e),be(i,h);let u=r&&r.headers?r.headers:{};return l.headers={...c,...u,...t.headers},{url:Te(i),options:l}},getPhysicalPaths:async(e={})=>{const t="/Library/PhysicalPaths",s=new URL(t,Se);let i;n&&(i=n.baseOptions);const r={method:"GET",...i,...e},l={},c={};await _e(l,"Authorization",n),be(s,c);let h=i&&i.headers?i.headers:{};return r.headers={...l,...h,...e.headers},{url:Te(s),options:r}},getSimilarAlbums:async(e,t,s,i,r,l={})=>{Re("getSimilarAlbums","itemId",e);const c="/Albums/{itemId}/Similar".replace("{itemId}",encodeURIComponent(String(e))),h=new URL(c,Se);let u;n&&(u=n.baseOptions);const f={method:"GET",...u,...l},g={},y={};await _e(g,"Authorization",n),t&&(y.excludeArtistIds=t),s!==void 0&&(y.userId=s),i!==void 0&&(y.limit=i),r&&(y.fields=r),be(h,y);let x=u&&u.headers?u.headers:{};return f.headers={...g,...x,...l.headers},{url:Te(h),options:f}},getSimilarArtists:async(e,t,s,i,r,l={})=>{Re("getSimilarArtists","itemId",e);const c="/Artists/{itemId}/Similar".replace("{itemId}",encodeURIComponent(String(e))),h=new URL(c,Se);let u;n&&(u=n.baseOptions);const f={method:"GET",...u,...l},g={},y={};await _e(g,"Authorization",n),t&&(y.excludeArtistIds=t),s!==void 0&&(y.userId=s),i!==void 0&&(y.limit=i),r&&(y.fields=r),be(h,y);let x=u&&u.headers?u.headers:{};return f.headers={...g,...x,...l.headers},{url:Te(h),options:f}},getSimilarItems:async(e,t,s,i,r,l={})=>{Re("getSimilarItems","itemId",e);const c="/Items/{itemId}/Similar".replace("{itemId}",encodeURIComponent(String(e))),h=new URL(c,Se);let u;n&&(u=n.baseOptions);const f={method:"GET",...u,...l},g={},y={};await _e(g,"Authorization",n),t&&(y.excludeArtistIds=t),s!==void 0&&(y.userId=s),i!==void 0&&(y.limit=i),r&&(y.fields=r),be(h,y);let x=u&&u.headers?u.headers:{};return f.headers={...g,...x,...l.headers},{url:Te(h),options:f}},getSimilarMovies:async(e,t,s,i,r,l={})=>{Re("getSimilarMovies","itemId",e);const c="/Movies/{itemId}/Similar".replace("{itemId}",encodeURIComponent(String(e))),h=new URL(c,Se);let u;n&&(u=n.baseOptions);const f={method:"GET",...u,...l},g={},y={};await _e(g,"Authorization",n),t&&(y.excludeArtistIds=t),s!==void 0&&(y.userId=s),i!==void 0&&(y.limit=i),r&&(y.fields=r),be(h,y);let x=u&&u.headers?u.headers:{};return f.headers={...g,...x,...l.headers},{url:Te(h),options:f}},getSimilarShows:async(e,t,s,i,r,l={})=>{Re("getSimilarShows","itemId",e);const c="/Shows/{itemId}/Similar".replace("{itemId}",encodeURIComponent(String(e))),h=new URL(c,Se);let u;n&&(u=n.baseOptions);const f={method:"GET",...u,...l},g={},y={};await _e(g,"Authorization",n),t&&(y.excludeArtistIds=t),s!==void 0&&(y.userId=s),i!==void 0&&(y.limit=i),r&&(y.fields=r),be(h,y);let x=u&&u.headers?u.headers:{};return f.headers={...g,...x,...l.headers},{url:Te(h),options:f}},getSimilarTrailers:async(e,t,s,i,r,l={})=>{Re("getSimilarTrailers","itemId",e);const c="/Trailers/{itemId}/Similar".replace("{itemId}",encodeURIComponent(String(e))),h=new URL(c,Se);let u;n&&(u=n.baseOptions);const f={method:"GET",...u,...l},g={},y={};await _e(g,"Authorization",n),t&&(y.excludeArtistIds=t),s!==void 0&&(y.userId=s),i!==void 0&&(y.limit=i),r&&(y.fields=r),be(h,y);let x=u&&u.headers?u.headers:{};return f.headers={...g,...x,...l.headers},{url:Te(h),options:f}},getThemeMedia:async(e,t,s,i,r,l={})=>{Re("getThemeMedia","itemId",e);const c="/Items/{itemId}/ThemeMedia".replace("{itemId}",encodeURIComponent(String(e))),h=new URL(c,Se);let u;n&&(u=n.baseOptions);const f={method:"GET",...u,...l},g={},y={};await _e(g,"Authorization",n),t!==void 0&&(y.userId=t),s!==void 0&&(y.inheritFromParent=s),i&&(y.sortBy=i),r&&(y.sortOrder=r),be(h,y);let x=u&&u.headers?u.headers:{};return f.headers={...g,...x,...l.headers},{url:Te(h),options:f}},getThemeSongs:async(e,t,s,i,r,l={})=>{Re("getThemeSongs","itemId",e);const c="/Items/{itemId}/ThemeSongs".replace("{itemId}",encodeURIComponent(String(e))),h=new URL(c,Se);let u;n&&(u=n.baseOptions);const f={method:"GET",...u,...l},g={},y={};await _e(g,"Authorization",n),t!==void 0&&(y.userId=t),s!==void 0&&(y.inheritFromParent=s),i&&(y.sortBy=i),r&&(y.sortOrder=r),be(h,y);let x=u&&u.headers?u.headers:{};return f.headers={...g,...x,...l.headers},{url:Te(h),options:f}},getThemeVideos:async(e,t,s,i,r,l={})=>{Re("getThemeVideos","itemId",e);const c="/Items/{itemId}/ThemeVideos".replace("{itemId}",encodeURIComponent(String(e))),h=new URL(c,Se);let u;n&&(u=n.baseOptions);const f={method:"GET",...u,...l},g={},y={};await _e(g,"Authorization",n),t!==void 0&&(y.userId=t),s!==void 0&&(y.inheritFromParent=s),i&&(y.sortBy=i),r&&(y.sortOrder=r),be(h,y);let x=u&&u.headers?u.headers:{};return f.headers={...g,...x,...l.headers},{url:Te(h),options:f}},postAddedMovies:async(e,t,s={})=>{const i="/Library/Movies/Added",r=new URL(i,Se);let l;n&&(l=n.baseOptions);const c={method:"POST",...l,...s},h={},u={};await _e(h,"Authorization",n),e!==void 0&&(u.tmdbId=e),t!==void 0&&(u.imdbId=t),be(r,u);let f=l&&l.headers?l.headers:{};return c.headers={...h,...f,...s.headers},{url:Te(r),options:c}},postAddedSeries:async(e,t={})=>{const s="/Library/Series/Added",i=new URL(s,Se);let r;n&&(r=n.baseOptions);const l={method:"POST",...r,...t},c={},h={};await _e(c,"Authorization",n),e!==void 0&&(h.tvdbId=e),be(i,h);let u=r&&r.headers?r.headers:{};return l.headers={...c,...u,...t.headers},{url:Te(i),options:l}},postUpdatedMedia:async(e,t={})=>{Re("postUpdatedMedia","mediaUpdateInfoDto",e);const s="/Library/Media/Updated",i=new URL(s,Se);let r;n&&(r=n.baseOptions);const l={method:"POST",...r,...t},c={},h={};await _e(c,"Authorization",n),c["Content-Type"]="application/json",be(i,h);let u=r&&r.headers?r.headers:{};return l.headers={...c,...u,...t.headers},l.data=ys(e,l,n),{url:Te(i),options:l}},postUpdatedMovies:async(e,t,s={})=>{const i="/Library/Movies/Updated",r=new URL(i,Se);let l;n&&(l=n.baseOptions);const c={method:"POST",...l,...s},h={},u={};await _e(h,"Authorization",n),e!==void 0&&(u.tmdbId=e),t!==void 0&&(u.imdbId=t),be(r,u);let f=l&&l.headers?l.headers:{};return c.headers={...h,...f,...s.headers},{url:Te(r),options:c}},postUpdatedSeries:async(e,t={})=>{const s="/Library/Series/Updated",i=new URL(s,Se);let r;n&&(r=n.baseOptions);const l={method:"POST",...r,...t},c={},h={};await _e(c,"Authorization",n),e!==void 0&&(h.tvdbId=e),be(i,h);let u=r&&r.headers?r.headers:{};return l.headers={...c,...u,...t.headers},{url:Te(i),options:l}},refreshLibrary:async(e={})=>{const t="/Library/Refresh",s=new URL(t,Se);let i;n&&(i=n.baseOptions);const r={method:"POST",...i,...e},l={},c={};await _e(l,"Authorization",n),be(s,c);let h=i&&i.headers?i.headers:{};return r.headers={...l,...h,...e.headers},{url:Te(s),options:r}}}},$t=function(n){const e=yL(n);return{async deleteItem(t,s){var i,r,l;const c=await e.deleteItem(t,s),h=(i=n?.serverIndex)!==null&&i!==void 0?i:0,u=(l=(r=xe["LibraryApi.deleteItem"])===null||r===void 0?void 0:r[h])===null||l===void 0?void 0:l.url;return(f,g)=>Ee(c,oe,ye,n)(f,u||g)},async deleteItems(t,s){var i,r,l;const c=await e.deleteItems(t,s),h=(i=n?.serverIndex)!==null&&i!==void 0?i:0,u=(l=(r=xe["LibraryApi.deleteItems"])===null||r===void 0?void 0:r[h])===null||l===void 0?void 0:l.url;return(f,g)=>Ee(c,oe,ye,n)(f,u||g)},async getAncestors(t,s,i){var r,l,c;const h=await e.getAncestors(t,s,i),u=(r=n?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=xe["LibraryApi.getAncestors"])===null||l===void 0?void 0:l[u])===null||c===void 0?void 0:c.url;return(g,y)=>Ee(h,oe,ye,n)(g,f||y)},async getCriticReviews(t,s){var i,r,l;const c=await e.getCriticReviews(t,s),h=(i=n?.serverIndex)!==null&&i!==void 0?i:0,u=(l=(r=xe["LibraryApi.getCriticReviews"])===null||r===void 0?void 0:r[h])===null||l===void 0?void 0:l.url;return(f,g)=>Ee(c,oe,ye,n)(f,u||g)},async getDownload(t,s){var i,r,l;const c=await e.getDownload(t,s),h=(i=n?.serverIndex)!==null&&i!==void 0?i:0,u=(l=(r=xe["LibraryApi.getDownload"])===null||r===void 0?void 0:r[h])===null||l===void 0?void 0:l.url;return(f,g)=>Ee(c,oe,ye,n)(f,u||g)},async getFile(t,s){var i,r,l;const c=await e.getFile(t,s),h=(i=n?.serverIndex)!==null&&i!==void 0?i:0,u=(l=(r=xe["LibraryApi.getFile"])===null||r===void 0?void 0:r[h])===null||l===void 0?void 0:l.url;return(f,g)=>Ee(c,oe,ye,n)(f,u||g)},async getItemCounts(t,s,i){var r,l,c;const h=await e.getItemCounts(t,s,i),u=(r=n?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=xe["LibraryApi.getItemCounts"])===null||l===void 0?void 0:l[u])===null||c===void 0?void 0:c.url;return(g,y)=>Ee(h,oe,ye,n)(g,f||y)},async getLibraryOptionsInfo(t,s,i){var r,l,c;const h=await e.getLibraryOptionsInfo(t,s,i),u=(r=n?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=xe["LibraryApi.getLibraryOptionsInfo"])===null||l===void 0?void 0:l[u])===null||c===void 0?void 0:c.url;return(g,y)=>Ee(h,oe,ye,n)(g,f||y)},async getMediaFolders(t,s){var i,r,l;const c=await e.getMediaFolders(t,s),h=(i=n?.serverIndex)!==null&&i!==void 0?i:0,u=(l=(r=xe["LibraryApi.getMediaFolders"])===null||r===void 0?void 0:r[h])===null||l===void 0?void 0:l.url;return(f,g)=>Ee(c,oe,ye,n)(f,u||g)},async getPhysicalPaths(t){var s,i,r;const l=await e.getPhysicalPaths(t),c=(s=n?.serverIndex)!==null&&s!==void 0?s:0,h=(r=(i=xe["LibraryApi.getPhysicalPaths"])===null||i===void 0?void 0:i[c])===null||r===void 0?void 0:r.url;return(u,f)=>Ee(l,oe,ye,n)(u,h||f)},async getSimilarAlbums(t,s,i,r,l,c){var h,u,f;const g=await e.getSimilarAlbums(t,s,i,r,l,c),y=(h=n?.serverIndex)!==null&&h!==void 0?h:0,x=(f=(u=xe["LibraryApi.getSimilarAlbums"])===null||u===void 0?void 0:u[y])===null||f===void 0?void 0:f.url;return(S,E)=>Ee(g,oe,ye,n)(S,x||E)},async getSimilarArtists(t,s,i,r,l,c){var h,u,f;const g=await e.getSimilarArtists(t,s,i,r,l,c),y=(h=n?.serverIndex)!==null&&h!==void 0?h:0,x=(f=(u=xe["LibraryApi.getSimilarArtists"])===null||u===void 0?void 0:u[y])===null||f===void 0?void 0:f.url;return(S,E)=>Ee(g,oe,ye,n)(S,x||E)},async getSimilarItems(t,s,i,r,l,c){var h,u,f;const g=await e.getSimilarItems(t,s,i,r,l,c),y=(h=n?.serverIndex)!==null&&h!==void 0?h:0,x=(f=(u=xe["LibraryApi.getSimilarItems"])===null||u===void 0?void 0:u[y])===null||f===void 0?void 0:f.url;return(S,E)=>Ee(g,oe,ye,n)(S,x||E)},async getSimilarMovies(t,s,i,r,l,c){var h,u,f;const g=await e.getSimilarMovies(t,s,i,r,l,c),y=(h=n?.serverIndex)!==null&&h!==void 0?h:0,x=(f=(u=xe["LibraryApi.getSimilarMovies"])===null||u===void 0?void 0:u[y])===null||f===void 0?void 0:f.url;return(S,E)=>Ee(g,oe,ye,n)(S,x||E)},async getSimilarShows(t,s,i,r,l,c){var h,u,f;const g=await e.getSimilarShows(t,s,i,r,l,c),y=(h=n?.serverIndex)!==null&&h!==void 0?h:0,x=(f=(u=xe["LibraryApi.getSimilarShows"])===null||u===void 0?void 0:u[y])===null||f===void 0?void 0:f.url;return(S,E)=>Ee(g,oe,ye,n)(S,x||E)},async getSimilarTrailers(t,s,i,r,l,c){var h,u,f;const g=await e.getSimilarTrailers(t,s,i,r,l,c),y=(h=n?.serverIndex)!==null&&h!==void 0?h:0,x=(f=(u=xe["LibraryApi.getSimilarTrailers"])===null||u===void 0?void 0:u[y])===null||f===void 0?void 0:f.url;return(S,E)=>Ee(g,oe,ye,n)(S,x||E)},async getThemeMedia(t,s,i,r,l,c){var h,u,f;const g=await e.getThemeMedia(t,s,i,r,l,c),y=(h=n?.serverIndex)!==null&&h!==void 0?h:0,x=(f=(u=xe["LibraryApi.getThemeMedia"])===null||u===void 0?void 0:u[y])===null||f===void 0?void 0:f.url;return(S,E)=>Ee(g,oe,ye,n)(S,x||E)},async getThemeSongs(t,s,i,r,l,c){var h,u,f;const g=await e.getThemeSongs(t,s,i,r,l,c),y=(h=n?.serverIndex)!==null&&h!==void 0?h:0,x=(f=(u=xe["LibraryApi.getThemeSongs"])===null||u===void 0?void 0:u[y])===null||f===void 0?void 0:f.url;return(S,E)=>Ee(g,oe,ye,n)(S,x||E)},async getThemeVideos(t,s,i,r,l,c){var h,u,f;const g=await e.getThemeVideos(t,s,i,r,l,c),y=(h=n?.serverIndex)!==null&&h!==void 0?h:0,x=(f=(u=xe["LibraryApi.getThemeVideos"])===null||u===void 0?void 0:u[y])===null||f===void 0?void 0:f.url;return(S,E)=>Ee(g,oe,ye,n)(S,x||E)},async postAddedMovies(t,s,i){var r,l,c;const h=await e.postAddedMovies(t,s,i),u=(r=n?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=xe["LibraryApi.postAddedMovies"])===null||l===void 0?void 0:l[u])===null||c===void 0?void 0:c.url;return(g,y)=>Ee(h,oe,ye,n)(g,f||y)},async postAddedSeries(t,s){var i,r,l;const c=await e.postAddedSeries(t,s),h=(i=n?.serverIndex)!==null&&i!==void 0?i:0,u=(l=(r=xe["LibraryApi.postAddedSeries"])===null||r===void 0?void 0:r[h])===null||l===void 0?void 0:l.url;return(f,g)=>Ee(c,oe,ye,n)(f,u||g)},async postUpdatedMedia(t,s){var i,r,l;const c=await e.postUpdatedMedia(t,s),h=(i=n?.serverIndex)!==null&&i!==void 0?i:0,u=(l=(r=xe["LibraryApi.postUpdatedMedia"])===null||r===void 0?void 0:r[h])===null||l===void 0?void 0:l.url;return(f,g)=>Ee(c,oe,ye,n)(f,u||g)},async postUpdatedMovies(t,s,i){var r,l,c;const h=await e.postUpdatedMovies(t,s,i),u=(r=n?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=xe["LibraryApi.postUpdatedMovies"])===null||l===void 0?void 0:l[u])===null||c===void 0?void 0:c.url;return(g,y)=>Ee(h,oe,ye,n)(g,f||y)},async postUpdatedSeries(t,s){var i,r,l;const c=await e.postUpdatedSeries(t,s),h=(i=n?.serverIndex)!==null&&i!==void 0?i:0,u=(l=(r=xe["LibraryApi.postUpdatedSeries"])===null||r===void 0?void 0:r[h])===null||l===void 0?void 0:l.url;return(f,g)=>Ee(c,oe,ye,n)(f,u||g)},async refreshLibrary(t){var s,i,r;const l=await e.refreshLibrary(t),c=(s=n?.serverIndex)!==null&&s!==void 0?s:0,h=(r=(i=xe["LibraryApi.refreshLibrary"])===null||i===void 0?void 0:i[c])===null||r===void 0?void 0:r.url;return(u,f)=>Ee(l,oe,ye,n)(u,h||f)}}};class vL extends fn{deleteItem(e,t){return $t(this.configuration).deleteItem(e.itemId,t).then(s=>s(this.axios,this.basePath))}deleteItems(e={},t){return $t(this.configuration).deleteItems(e.ids,t).then(s=>s(this.axios,this.basePath))}getAncestors(e,t){return $t(this.configuration).getAncestors(e.itemId,e.userId,t).then(s=>s(this.axios,this.basePath))}getCriticReviews(e,t){return $t(this.configuration).getCriticReviews(e.itemId,t).then(s=>s(this.axios,this.basePath))}getDownload(e,t){return $t(this.configuration).getDownload(e.itemId,t).then(s=>s(this.axios,this.basePath))}getFile(e,t){return $t(this.configuration).getFile(e.itemId,t).then(s=>s(this.axios,this.basePath))}getItemCounts(e={},t){return $t(this.configuration).getItemCounts(e.userId,e.isFavorite,t).then(s=>s(this.axios,this.basePath))}getLibraryOptionsInfo(e={},t){return $t(this.configuration).getLibraryOptionsInfo(e.libraryContentType,e.isNewLibrary,t).then(s=>s(this.axios,this.basePath))}getMediaFolders(e={},t){return $t(this.configuration).getMediaFolders(e.isHidden,t).then(s=>s(this.axios,this.basePath))}getPhysicalPaths(e){return $t(this.configuration).getPhysicalPaths(e).then(t=>t(this.axios,this.basePath))}getSimilarAlbums(e,t){return $t(this.configuration).getSimilarAlbums(e.itemId,e.excludeArtistIds,e.userId,e.limit,e.fields,t).then(s=>s(this.axios,this.basePath))}getSimilarArtists(e,t){return $t(this.configuration).getSimilarArtists(e.itemId,e.excludeArtistIds,e.userId,e.limit,e.fields,t).then(s=>s(this.axios,this.basePath))}getSimilarItems(e,t){return $t(this.configuration).getSimilarItems(e.itemId,e.excludeArtistIds,e.userId,e.limit,e.fields,t).then(s=>s(this.axios,this.basePath))}getSimilarMovies(e,t){return $t(this.configuration).getSimilarMovies(e.itemId,e.excludeArtistIds,e.userId,e.limit,e.fields,t).then(s=>s(this.axios,this.basePath))}getSimilarShows(e,t){return $t(this.configuration).getSimilarShows(e.itemId,e.excludeArtistIds,e.userId,e.limit,e.fields,t).then(s=>s(this.axios,this.basePath))}getSimilarTrailers(e,t){return $t(this.configuration).getSimilarTrailers(e.itemId,e.excludeArtistIds,e.userId,e.limit,e.fields,t).then(s=>s(this.axios,this.basePath))}getThemeMedia(e,t){return $t(this.configuration).getThemeMedia(e.itemId,e.userId,e.inheritFromParent,e.sortBy,e.sortOrder,t).then(s=>s(this.axios,this.basePath))}getThemeSongs(e,t){return $t(this.configuration).getThemeSongs(e.itemId,e.userId,e.inheritFromParent,e.sortBy,e.sortOrder,t).then(s=>s(this.axios,this.basePath))}getThemeVideos(e,t){return $t(this.configuration).getThemeVideos(e.itemId,e.userId,e.inheritFromParent,e.sortBy,e.sortOrder,t).then(s=>s(this.axios,this.basePath))}postAddedMovies(e={},t){return $t(this.configuration).postAddedMovies(e.tmdbId,e.imdbId,t).then(s=>s(this.axios,this.basePath))}postAddedSeries(e={},t){return $t(this.configuration).postAddedSeries(e.tvdbId,t).then(s=>s(this.axios,this.basePath))}postUpdatedMedia(e,t){return $t(this.configuration).postUpdatedMedia(e.mediaUpdateInfoDto,t).then(s=>s(this.axios,this.basePath))}postUpdatedMovies(e={},t){return $t(this.configuration).postUpdatedMovies(e.tmdbId,e.imdbId,t).then(s=>s(this.axios,this.basePath))}postUpdatedSeries(e={},t){return $t(this.configuration).postUpdatedSeries(e.tvdbId,t).then(s=>s(this.axios,this.basePath))}refreshLibrary(e){return $t(this.configuration).refreshLibrary(e).then(t=>t(this.axios,this.basePath))}}const xL=function(n){return{deleteSubtitle:async(e,t,s={})=>{Re("deleteSubtitle","itemId",e),Re("deleteSubtitle","index",t);const i="/Videos/{itemId}/Subtitles/{index}".replace("{itemId}",encodeURIComponent(String(e))).replace("{index}",encodeURIComponent(String(t))),r=new URL(i,Se);let l;n&&(l=n.baseOptions);const c={method:"DELETE",...l,...s},h={},u={};await _e(h,"Authorization",n),be(r,u);let f=l&&l.headers?l.headers:{};return c.headers={...h,...f,...s.headers},{url:Te(r),options:c}},downloadRemoteSubtitles:async(e,t,s={})=>{Re("downloadRemoteSubtitles","itemId",e),Re("downloadRemoteSubtitles","subtitleId",t);const i="/Items/{itemId}/RemoteSearch/Subtitles/{subtitleId}".replace("{itemId}",encodeURIComponent(String(e))).replace("{subtitleId}",encodeURIComponent(String(t))),r=new URL(i,Se);let l;n&&(l=n.baseOptions);const c={method:"POST",...l,...s},h={},u={};await _e(h,"Authorization",n),be(r,u);let f=l&&l.headers?l.headers:{};return c.headers={...h,...f,...s.headers},{url:Te(r),options:c}},getFallbackFont:async(e,t={})=>{Re("getFallbackFont","name",e);const s="/FallbackFont/Fonts/{name}".replace("{name}",encodeURIComponent(String(e))),i=new URL(s,Se);let r;n&&(r=n.baseOptions);const l={method:"GET",...r,...t},c={},h={};await _e(c,"Authorization",n),be(i,h);let u=r&&r.headers?r.headers:{};return l.headers={...c,...u,...t.headers},{url:Te(i),options:l}},getFallbackFontList:async(e={})=>{const t="/FallbackFont/Fonts",s=new URL(t,Se);let i;n&&(i=n.baseOptions);const r={method:"GET",...i,...e},l={},c={};await _e(l,"Authorization",n),be(s,c);let h=i&&i.headers?i.headers:{};return r.headers={...l,...h,...e.headers},{url:Te(s),options:r}},getRemoteSubtitles:async(e,t={})=>{Re("getRemoteSubtitles","subtitleId",e);const s="/Providers/Subtitles/Subtitles/{subtitleId}".replace("{subtitleId}",encodeURIComponent(String(e))),i=new URL(s,Se);let r;n&&(r=n.baseOptions);const l={method:"GET",...r,...t},c={},h={};await _e(c,"Authorization",n),be(i,h);let u=r&&r.headers?r.headers:{};return l.headers={...c,...u,...t.headers},{url:Te(i),options:l}},getSubtitle:async(e,t,s,i,r,l,c,h,u,f,g,y,x={})=>{Re("getSubtitle","routeItemId",e),Re("getSubtitle","routeMediaSourceId",t),Re("getSubtitle","routeIndex",s),Re("getSubtitle","routeFormat",i);const S="/Videos/{routeItemId}/{routeMediaSourceId}/Subtitles/{routeIndex}/Stream.{routeFormat}".replace("{routeItemId}",encodeURIComponent(String(e))).replace("{routeMediaSourceId}",encodeURIComponent(String(t))).replace("{routeIndex}",encodeURIComponent(String(s))).replace("{routeFormat}",encodeURIComponent(String(i))),E=new URL(S,Se);let T;n&&(T=n.baseOptions);const A={method:"GET",...T,...x},_={},I={};r!==void 0&&(I.itemId=r),l!==void 0&&(I.mediaSourceId=l),c!==void 0&&(I.index=c),h!==void 0&&(I.format=h),u!==void 0&&(I.endPositionTicks=u),f!==void 0&&(I.copyTimestamps=f),g!==void 0&&(I.addVttTimeMap=g),y!==void 0&&(I.startPositionTicks=y),be(E,I);let C=T&&T.headers?T.headers:{};return A.headers={..._,...C,...x.headers},{url:Te(E),options:A}},getSubtitlePlaylist:async(e,t,s,i,r={})=>{Re("getSubtitlePlaylist","itemId",e),Re("getSubtitlePlaylist","index",t),Re("getSubtitlePlaylist","mediaSourceId",s),Re("getSubtitlePlaylist","segmentLength",i);const l="/Videos/{itemId}/{mediaSourceId}/Subtitles/{index}/subtitles.m3u8".replace("{itemId}",encodeURIComponent(String(e))).replace("{index}",encodeURIComponent(String(t))).replace("{mediaSourceId}",encodeURIComponent(String(s))),c=new URL(l,Se);let h;n&&(h=n.baseOptions);const u={method:"GET",...h,...r},f={},g={};await _e(f,"Authorization",n),i!==void 0&&(g.segmentLength=i),be(c,g);let y=h&&h.headers?h.headers:{};return u.headers={...f,...y,...r.headers},{url:Te(c),options:u}},getSubtitleWithTicks:async(e,t,s,i,r,l,c,h,u,f,g,y,x,S={})=>{Re("getSubtitleWithTicks","routeItemId",e),Re("getSubtitleWithTicks","routeMediaSourceId",t),Re("getSubtitleWithTicks","routeIndex",s),Re("getSubtitleWithTicks","routeStartPositionTicks",i),Re("getSubtitleWithTicks","routeFormat",r);const E="/Videos/{routeItemId}/{routeMediaSourceId}/Subtitles/{routeIndex}/{routeStartPositionTicks}/Stream.{routeFormat}".replace("{routeItemId}",encodeURIComponent(String(e))).replace("{routeMediaSourceId}",encodeURIComponent(String(t))).replace("{routeIndex}",encodeURIComponent(String(s))).replace("{routeStartPositionTicks}",encodeURIComponent(String(i))).replace("{routeFormat}",encodeURIComponent(String(r))),T=new URL(E,Se);let A;n&&(A=n.baseOptions);const _={method:"GET",...A,...S},I={},C={};l!==void 0&&(C.itemId=l),c!==void 0&&(C.mediaSourceId=c),h!==void 0&&(C.index=h),u!==void 0&&(C.startPositionTicks=u),f!==void 0&&(C.format=f),g!==void 0&&(C.endPositionTicks=g),y!==void 0&&(C.copyTimestamps=y),x!==void 0&&(C.addVttTimeMap=x),be(T,C);let N=A&&A.headers?A.headers:{};return _.headers={...I,...N,...S.headers},{url:Te(T),options:_}},searchRemoteSubtitles:async(e,t,s,i={})=>{Re("searchRemoteSubtitles","itemId",e),Re("searchRemoteSubtitles","language",t);const r="/Items/{itemId}/RemoteSearch/Subtitles/{language}".replace("{itemId}",encodeURIComponent(String(e))).replace("{language}",encodeURIComponent(String(t))),l=new URL(r,Se);let c;n&&(c=n.baseOptions);const h={method:"GET",...c,...i},u={},f={};await _e(u,"Authorization",n),s!==void 0&&(f.isPerfectMatch=s),be(l,f);let g=c&&c.headers?c.headers:{};return h.headers={...u,...g,...i.headers},{url:Te(l),options:h}},uploadSubtitle:async(e,t,s={})=>{Re("uploadSubtitle","itemId",e),Re("uploadSubtitle","uploadSubtitleDto",t);const i="/Videos/{itemId}/Subtitles".replace("{itemId}",encodeURIComponent(String(e))),r=new URL(i,Se);let l;n&&(l=n.baseOptions);const c={method:"POST",...l,...s},h={},u={};await _e(h,"Authorization",n),h["Content-Type"]="application/json",be(r,u);let f=l&&l.headers?l.headers:{};return c.headers={...h,...f,...s.headers},c.data=ys(t,c,n),{url:Te(r),options:c}}}},nn=function(n){const e=xL(n);return{async deleteSubtitle(t,s,i){var r,l,c;const h=await e.deleteSubtitle(t,s,i),u=(r=n?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=xe["SubtitleApi.deleteSubtitle"])===null||l===void 0?void 0:l[u])===null||c===void 0?void 0:c.url;return(g,y)=>Ee(h,oe,ye,n)(g,f||y)},async downloadRemoteSubtitles(t,s,i){var r,l,c;const h=await e.downloadRemoteSubtitles(t,s,i),u=(r=n?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=xe["SubtitleApi.downloadRemoteSubtitles"])===null||l===void 0?void 0:l[u])===null||c===void 0?void 0:c.url;return(g,y)=>Ee(h,oe,ye,n)(g,f||y)},async getFallbackFont(t,s){var i,r,l;const c=await e.getFallbackFont(t,s),h=(i=n?.serverIndex)!==null&&i!==void 0?i:0,u=(l=(r=xe["SubtitleApi.getFallbackFont"])===null||r===void 0?void 0:r[h])===null||l===void 0?void 0:l.url;return(f,g)=>Ee(c,oe,ye,n)(f,u||g)},async getFallbackFontList(t){var s,i,r;const l=await e.getFallbackFontList(t),c=(s=n?.serverIndex)!==null&&s!==void 0?s:0,h=(r=(i=xe["SubtitleApi.getFallbackFontList"])===null||i===void 0?void 0:i[c])===null||r===void 0?void 0:r.url;return(u,f)=>Ee(l,oe,ye,n)(u,h||f)},async getRemoteSubtitles(t,s){var i,r,l;const c=await e.getRemoteSubtitles(t,s),h=(i=n?.serverIndex)!==null&&i!==void 0?i:0,u=(l=(r=xe["SubtitleApi.getRemoteSubtitles"])===null||r===void 0?void 0:r[h])===null||l===void 0?void 0:l.url;return(f,g)=>Ee(c,oe,ye,n)(f,u||g)},async getSubtitle(t,s,i,r,l,c,h,u,f,g,y,x,S){var E,T,A;const _=await e.getSubtitle(t,s,i,r,l,c,h,u,f,g,y,x,S),I=(E=n?.serverIndex)!==null&&E!==void 0?E:0,C=(A=(T=xe["SubtitleApi.getSubtitle"])===null||T===void 0?void 0:T[I])===null||A===void 0?void 0:A.url;return(N,D)=>Ee(_,oe,ye,n)(N,C||D)},async getSubtitlePlaylist(t,s,i,r,l){var c,h,u;const f=await e.getSubtitlePlaylist(t,s,i,r,l),g=(c=n?.serverIndex)!==null&&c!==void 0?c:0,y=(u=(h=xe["SubtitleApi.getSubtitlePlaylist"])===null||h===void 0?void 0:h[g])===null||u===void 0?void 0:u.url;return(x,S)=>Ee(f,oe,ye,n)(x,y||S)},async getSubtitleWithTicks(t,s,i,r,l,c,h,u,f,g,y,x,S,E){var T,A,_;const I=await e.getSubtitleWithTicks(t,s,i,r,l,c,h,u,f,g,y,x,S,E),C=(T=n?.serverIndex)!==null&&T!==void 0?T:0,N=(_=(A=xe["SubtitleApi.getSubtitleWithTicks"])===null||A===void 0?void 0:A[C])===null||_===void 0?void 0:_.url;return(D,k)=>Ee(I,oe,ye,n)(D,N||k)},async searchRemoteSubtitles(t,s,i,r){var l,c,h;const u=await e.searchRemoteSubtitles(t,s,i,r),f=(l=n?.serverIndex)!==null&&l!==void 0?l:0,g=(h=(c=xe["SubtitleApi.searchRemoteSubtitles"])===null||c===void 0?void 0:c[f])===null||h===void 0?void 0:h.url;return(y,x)=>Ee(u,oe,ye,n)(y,g||x)},async uploadSubtitle(t,s,i){var r,l,c;const h=await e.uploadSubtitle(t,s,i),u=(r=n?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=xe["SubtitleApi.uploadSubtitle"])===null||l===void 0?void 0:l[u])===null||c===void 0?void 0:c.url;return(g,y)=>Ee(h,oe,ye,n)(g,f||y)}}};class SL extends fn{deleteSubtitle(e,t){return nn(this.configuration).deleteSubtitle(e.itemId,e.index,t).then(s=>s(this.axios,this.basePath))}downloadRemoteSubtitles(e,t){return nn(this.configuration).downloadRemoteSubtitles(e.itemId,e.subtitleId,t).then(s=>s(this.axios,this.basePath))}getFallbackFont(e,t){return nn(this.configuration).getFallbackFont(e.name,t).then(s=>s(this.axios,this.basePath))}getFallbackFontList(e){return nn(this.configuration).getFallbackFontList(e).then(t=>t(this.axios,this.basePath))}getRemoteSubtitles(e,t){return nn(this.configuration).getRemoteSubtitles(e.subtitleId,t).then(s=>s(this.axios,this.basePath))}getSubtitle(e,t){return nn(this.configuration).getSubtitle(e.routeItemId,e.routeMediaSourceId,e.routeIndex,e.routeFormat,e.itemId,e.mediaSourceId,e.index,e.format,e.endPositionTicks,e.copyTimestamps,e.addVttTimeMap,e.startPositionTicks,t).then(s=>s(this.axios,this.basePath))}getSubtitlePlaylist(e,t){return nn(this.configuration).getSubtitlePlaylist(e.itemId,e.index,e.mediaSourceId,e.segmentLength,t).then(s=>s(this.axios,this.basePath))}getSubtitleWithTicks(e,t){return nn(this.configuration).getSubtitleWithTicks(e.routeItemId,e.routeMediaSourceId,e.routeIndex,e.routeStartPositionTicks,e.routeFormat,e.itemId,e.mediaSourceId,e.index,e.startPositionTicks,e.format,e.endPositionTicks,e.copyTimestamps,e.addVttTimeMap,t).then(s=>s(this.axios,this.basePath))}searchRemoteSubtitles(e,t){return nn(this.configuration).searchRemoteSubtitles(e.itemId,e.language,e.isPerfectMatch,t).then(s=>s(this.axios,this.basePath))}uploadSubtitle(e,t){return nn(this.configuration).uploadSubtitle(e.itemId,e.uploadSubtitleDto,t).then(s=>s(this.axios,this.basePath))}}const bL=function(n){return{markPlayedItem:async(e,t,s,i={})=>{Re("markPlayedItem","itemId",e);const r="/UserPlayedItems/{itemId}".replace("{itemId}",encodeURIComponent(String(e))),l=new URL(r,Se);let c;n&&(c=n.baseOptions);const h={method:"POST",...c,...i},u={},f={};await _e(u,"Authorization",n),t!==void 0&&(f.userId=t),s!==void 0&&(f.datePlayed=s instanceof Date?s.toISOString():s),be(l,f);let g=c&&c.headers?c.headers:{};return h.headers={...u,...g,...i.headers},{url:Te(l),options:h}},markUnplayedItem:async(e,t,s={})=>{Re("markUnplayedItem","itemId",e);const i="/UserPlayedItems/{itemId}".replace("{itemId}",encodeURIComponent(String(e))),r=new URL(i,Se);let l;n&&(l=n.baseOptions);const c={method:"DELETE",...l,...s},h={},u={};await _e(h,"Authorization",n),t!==void 0&&(u.userId=t),be(r,u);let f=l&&l.headers?l.headers:{};return c.headers={...h,...f,...s.headers},{url:Te(r),options:c}},onPlaybackProgress:async(e,t,s,i,r,l,c,h,u,f,g,y,x={})=>{Re("onPlaybackProgress","itemId",e);const S="/PlayingItems/{itemId}/Progress".replace("{itemId}",encodeURIComponent(String(e))),E=new URL(S,Se);let T;n&&(T=n.baseOptions);const A={method:"POST",...T,...x},_={},I={};await _e(_,"Authorization",n),t!==void 0&&(I.mediaSourceId=t),s!==void 0&&(I.positionTicks=s),i!==void 0&&(I.audioStreamIndex=i),r!==void 0&&(I.subtitleStreamIndex=r),l!==void 0&&(I.volumeLevel=l),c!==void 0&&(I.playMethod=c),h!==void 0&&(I.liveStreamId=h),u!==void 0&&(I.playSessionId=u),f!==void 0&&(I.repeatMode=f),g!==void 0&&(I.isPaused=g),y!==void 0&&(I.isMuted=y),be(E,I);let C=T&&T.headers?T.headers:{};return A.headers={..._,...C,...x.headers},{url:Te(E),options:A}},onPlaybackStart:async(e,t,s,i,r,l,c,h,u={})=>{Re("onPlaybackStart","itemId",e);const f="/PlayingItems/{itemId}".replace("{itemId}",encodeURIComponent(String(e))),g=new URL(f,Se);let y;n&&(y=n.baseOptions);const x={method:"POST",...y,...u},S={},E={};await _e(S,"Authorization",n),t!==void 0&&(E.mediaSourceId=t),s!==void 0&&(E.audioStreamIndex=s),i!==void 0&&(E.subtitleStreamIndex=i),r!==void 0&&(E.playMethod=r),l!==void 0&&(E.liveStreamId=l),c!==void 0&&(E.playSessionId=c),h!==void 0&&(E.canSeek=h),be(g,E);let T=y&&y.headers?y.headers:{};return x.headers={...S,...T,...u.headers},{url:Te(g),options:x}},onPlaybackStopped:async(e,t,s,i,r,l,c={})=>{Re("onPlaybackStopped","itemId",e);const h="/PlayingItems/{itemId}".replace("{itemId}",encodeURIComponent(String(e))),u=new URL(h,Se);let f;n&&(f=n.baseOptions);const g={method:"DELETE",...f,...c},y={},x={};await _e(y,"Authorization",n),t!==void 0&&(x.mediaSourceId=t),s!==void 0&&(x.nextMediaType=s),i!==void 0&&(x.positionTicks=i),r!==void 0&&(x.liveStreamId=r),l!==void 0&&(x.playSessionId=l),be(u,x);let S=f&&f.headers?f.headers:{};return g.headers={...y,...S,...c.headers},{url:Te(u),options:g}},pingPlaybackSession:async(e,t={})=>{Re("pingPlaybackSession","playSessionId",e);const s="/Sessions/Playing/Ping",i=new URL(s,Se);let r;n&&(r=n.baseOptions);const l={method:"POST",...r,...t},c={},h={};await _e(c,"Authorization",n),e!==void 0&&(h.playSessionId=e),be(i,h);let u=r&&r.headers?r.headers:{};return l.headers={...c,...u,...t.headers},{url:Te(i),options:l}},reportPlaybackProgress:async(e,t={})=>{const s="/Sessions/Playing/Progress",i=new URL(s,Se);let r;n&&(r=n.baseOptions);const l={method:"POST",...r,...t},c={},h={};await _e(c,"Authorization",n),c["Content-Type"]="application/json",be(i,h);let u=r&&r.headers?r.headers:{};return l.headers={...c,...u,...t.headers},l.data=ys(e,l,n),{url:Te(i),options:l}},reportPlaybackStart:async(e,t={})=>{const s="/Sessions/Playing",i=new URL(s,Se);let r;n&&(r=n.baseOptions);const l={method:"POST",...r,...t},c={},h={};await _e(c,"Authorization",n),c["Content-Type"]="application/json",be(i,h);let u=r&&r.headers?r.headers:{};return l.headers={...c,...u,...t.headers},l.data=ys(e,l,n),{url:Te(i),options:l}},reportPlaybackStopped:async(e,t={})=>{const s="/Sessions/Playing/Stopped",i=new URL(s,Se);let r;n&&(r=n.baseOptions);const l={method:"POST",...r,...t},c={},h={};await _e(c,"Authorization",n),c["Content-Type"]="application/json",be(i,h);let u=r&&r.headers?r.headers:{};return l.headers={...c,...u,...t.headers},l.data=ys(e,l,n),{url:Te(i),options:l}}}},Pn=function(n){const e=bL(n);return{async markPlayedItem(t,s,i,r){var l,c,h;const u=await e.markPlayedItem(t,s,i,r),f=(l=n?.serverIndex)!==null&&l!==void 0?l:0,g=(h=(c=xe["PlaystateApi.markPlayedItem"])===null||c===void 0?void 0:c[f])===null||h===void 0?void 0:h.url;return(y,x)=>Ee(u,oe,ye,n)(y,g||x)},async markUnplayedItem(t,s,i){var r,l,c;const h=await e.markUnplayedItem(t,s,i),u=(r=n?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=xe["PlaystateApi.markUnplayedItem"])===null||l===void 0?void 0:l[u])===null||c===void 0?void 0:c.url;return(g,y)=>Ee(h,oe,ye,n)(g,f||y)},async onPlaybackProgress(t,s,i,r,l,c,h,u,f,g,y,x,S){var E,T,A;const _=await e.onPlaybackProgress(t,s,i,r,l,c,h,u,f,g,y,x,S),I=(E=n?.serverIndex)!==null&&E!==void 0?E:0,C=(A=(T=xe["PlaystateApi.onPlaybackProgress"])===null||T===void 0?void 0:T[I])===null||A===void 0?void 0:A.url;return(N,D)=>Ee(_,oe,ye,n)(N,C||D)},async onPlaybackStart(t,s,i,r,l,c,h,u,f){var g,y,x;const S=await e.onPlaybackStart(t,s,i,r,l,c,h,u,f),E=(g=n?.serverIndex)!==null&&g!==void 0?g:0,T=(x=(y=xe["PlaystateApi.onPlaybackStart"])===null||y===void 0?void 0:y[E])===null||x===void 0?void 0:x.url;return(A,_)=>Ee(S,oe,ye,n)(A,T||_)},async onPlaybackStopped(t,s,i,r,l,c,h){var u,f,g;const y=await e.onPlaybackStopped(t,s,i,r,l,c,h),x=(u=n?.serverIndex)!==null&&u!==void 0?u:0,S=(g=(f=xe["PlaystateApi.onPlaybackStopped"])===null||f===void 0?void 0:f[x])===null||g===void 0?void 0:g.url;return(E,T)=>Ee(y,oe,ye,n)(E,S||T)},async pingPlaybackSession(t,s){var i,r,l;const c=await e.pingPlaybackSession(t,s),h=(i=n?.serverIndex)!==null&&i!==void 0?i:0,u=(l=(r=xe["PlaystateApi.pingPlaybackSession"])===null||r===void 0?void 0:r[h])===null||l===void 0?void 0:l.url;return(f,g)=>Ee(c,oe,ye,n)(f,u||g)},async reportPlaybackProgress(t,s){var i,r,l;const c=await e.reportPlaybackProgress(t,s),h=(i=n?.serverIndex)!==null&&i!==void 0?i:0,u=(l=(r=xe["PlaystateApi.reportPlaybackProgress"])===null||r===void 0?void 0:r[h])===null||l===void 0?void 0:l.url;return(f,g)=>Ee(c,oe,ye,n)(f,u||g)},async reportPlaybackStart(t,s){var i,r,l;const c=await e.reportPlaybackStart(t,s),h=(i=n?.serverIndex)!==null&&i!==void 0?i:0,u=(l=(r=xe["PlaystateApi.reportPlaybackStart"])===null||r===void 0?void 0:r[h])===null||l===void 0?void 0:l.url;return(f,g)=>Ee(c,oe,ye,n)(f,u||g)},async reportPlaybackStopped(t,s){var i,r,l;const c=await e.reportPlaybackStopped(t,s),h=(i=n?.serverIndex)!==null&&i!==void 0?i:0,u=(l=(r=xe["PlaystateApi.reportPlaybackStopped"])===null||r===void 0?void 0:r[h])===null||l===void 0?void 0:l.url;return(f,g)=>Ee(c,oe,ye,n)(f,u||g)}}};class TL extends fn{markPlayedItem(e,t){return Pn(this.configuration).markPlayedItem(e.itemId,e.userId,e.datePlayed,t).then(s=>s(this.axios,this.basePath))}markUnplayedItem(e,t){return Pn(this.configuration).markUnplayedItem(e.itemId,e.userId,t).then(s=>s(this.axios,this.basePath))}onPlaybackProgress(e,t){return Pn(this.configuration).onPlaybackProgress(e.itemId,e.mediaSourceId,e.positionTicks,e.audioStreamIndex,e.subtitleStreamIndex,e.volumeLevel,e.playMethod,e.liveStreamId,e.playSessionId,e.repeatMode,e.isPaused,e.isMuted,t).then(s=>s(this.axios,this.basePath))}onPlaybackStart(e,t){return Pn(this.configuration).onPlaybackStart(e.itemId,e.mediaSourceId,e.audioStreamIndex,e.subtitleStreamIndex,e.playMethod,e.liveStreamId,e.playSessionId,e.canSeek,t).then(s=>s(this.axios,this.basePath))}onPlaybackStopped(e,t){return Pn(this.configuration).onPlaybackStopped(e.itemId,e.mediaSourceId,e.nextMediaType,e.positionTicks,e.liveStreamId,e.playSessionId,t).then(s=>s(this.axios,this.basePath))}pingPlaybackSession(e,t){return Pn(this.configuration).pingPlaybackSession(e.playSessionId,t).then(s=>s(this.axios,this.basePath))}reportPlaybackProgress(e={},t){return Pn(this.configuration).reportPlaybackProgress(e.playbackProgressInfo,t).then(s=>s(this.axios,this.basePath))}reportPlaybackStart(e={},t){return Pn(this.configuration).reportPlaybackStart(e.playbackStartInfo,t).then(s=>s(this.axios,this.basePath))}reportPlaybackStopped(e={},t){return Pn(this.configuration).reportPlaybackStopped(e.playbackStopInfo,t).then(s=>s(this.axios,this.basePath))}}class EL{constructor(){this.jellyfin=new oL({clientInfo:{name:"LegitFlix Client",version:"1.0.0.18"},deviceInfo:{name:"LegitFlix Web",id:"legitflix-web"}}),this.api=null}initialize(e=null,t=null){const s=t!==null?t:this.api?.basePath||window.location.origin;this.api=this.jellyfin.createApi(s,e),this.api.user=new xS(this.api.configuration),this.api.userLibrary=new uL(this.api.configuration),this.api.userViews=new hL(this.api.configuration),this.api.items=new mL(this.api.configuration),this.api.tvShows=new gL(this.api.configuration),this.api.library=new vL(this.api.configuration),this.api.subtitle=new SL(this.api.configuration),this.api.playstate=new TL(this.api.configuration),console.log("[LegitFlix] API Initialized. Access Token present:",!!e)}async getCurrentUser(){if(window.ApiClient)try{return await window.ApiClient.getCurrentUser()}catch(t){console.warn("Failed to get current user from window.ApiClient",t)}const e=localStorage.getItem("jellyfin_credentials");if(e)try{const t=JSON.parse(e);if(t.Servers&&t.Servers.length>0){const s=t.Servers.find(i=>i.AccessToken&&i.UserId);if(s){(!this.api||this.api.accessToken!==s.AccessToken)&&(console.log("[LegitFlix] Initializing API with stored token"),this.initialize(s.AccessToken));try{return(await this.api.user.getUserById({userId:s.UserId})).data}catch(i){return console.error("[LegitFlix] Token invalid or user not found. Clearing credentials.",i),this.logout(),null}}}}catch(t){console.error("[LegitFlix] Failed to parse jellyfin_credentials",t)}return null}async validateServer(e){const t=e.replace(/\/$/,""),s=new AbortController,i=setTimeout(()=>s.abort(),5e3);try{const r=await fetch(`${t}/System/Info/Public`,{signal:s.signal});if(clearTimeout(i),r.ok)return{valid:!0,data:await r.json(),baseUrl:t}}catch(r){clearTimeout(i),console.error("Server validation failed",r)}return{valid:!1}}async getPublicUsers(){return this.api||this.initialize(),(await this.api.user.getPublicUsers()).data}async authenticateUser(e,t){this.api||this.initialize();try{const i=(await this.api.user.authenticateUserByName({authenticateUserByName:{Username:e,Pw:t}})).data;if(i.AccessToken&&i.User){this.initialize(i.AccessToken);const r={Servers:[{DateLastAccessed:new Date().toISOString(),AccessToken:i.AccessToken,UserId:i.User.Id,Name:i.User.Name,ManualAddress:this.api.basePath}]};return localStorage.setItem("jellyfin_credentials",JSON.stringify(r)),i.User}}catch(s){throw console.error("Authentication failed",s),s}return null}async getItem(e,t){return this.api||this.initialize(),(await this.api.userLibrary.getItem({userId:e,itemId:t})).data}async getSimilarItems(e,t){return this.api||this.initialize(),(await this.api.library.getSimilarItems({userId:e,itemId:t,limit:12})).data}async getItems(e,t){return this.api||this.initialize(),(await this.api.items.getItems({userId:e,...t})).data}async markPlayed(e,t,s){this.api||this.initialize();const i=s?"POST":"DELETE",l=`${this.api.basePath||""}/Users/${e}/PlayedItems/${t}`;try{const c=this.api.accessToken,h={"Content-Type":"application/json"};c&&(h["X-Emby-Authorization"]=`MediaBrowser Client="${this.jellyfin.clientInfo.name}", Device="${this.jellyfin.deviceInfo.name}", DeviceId="${this.jellyfin.deviceInfo.id}", Version="${this.jellyfin.clientInfo.version}", Token="${c}"`);const u=await fetch(l,{method:i,headers:h});if(!u.ok)throw new Error(`Failed to mark played/unplayed: ${u.status} ${u.statusText}`);return await u.json()}catch(c){throw console.error("markPlayed failed",c),c}}async markFavorite(e,t,s){return this.api||this.initialize(),s?await this.api.userLibrary.markFavoriteItem({userId:e,itemId:t}):await this.api.userLibrary.unmarkFavoriteItem({userId:e,itemId:t})}async getSeasons(e,t){return this.api||this.initialize(),(await this.api.tvShows.getSeasons({userId:e,seriesId:t})).data}async getEpisodes(e,t,s){return this.api||this.initialize(),(await this.api.tvShows.getEpisodes({userId:e,seriesId:t,seasonId:s,fields:["MediaSources","RunTimeTicks","UserData","Overview","Path"]})).data}async getNextUp(e,t){return this.api||this.initialize(),(await this.api.tvShows.getNextUp({userId:e,seriesId:t,limit:1})).data}async getUserViews(e){return this.api||this.initialize(),(await this.api.userViews.getUserViews({userId:e})).data}async getSeries(e,t){this.api||this.initialize();const s=["Overview","Genres","Studios","OfficialRating","CommunityRating","ImageTags","BackdropImageTags","People","RemoteTrailers","LocalTrailers","ChildCount","MediaSources"];return(await this.api.userLibrary.getItem({userId:e,itemId:t,fields:s})).data}async getResumeItems(e,t=12){return this.api||this.initialize(),await this.getItems(e,{filters:["IsResumable"],sortBy:["DatePlayed"],sortOrder:["Descending"],limit:t,recursive:!0,includeItemTypes:["Movie","Episode"]})}async getHistoryItems(e,t=12){return this.api||this.initialize(),await this.getItems(e,{sortBy:["DatePlayed"],sortOrder:["Descending"],limit:t,recursive:!0,filters:["IsPlayed"],includeItemTypes:["Movie","Episode"],fields:["PrimaryImageAspectRatio","Overview","ImageTags","ProductionYear","RunTimeTicks"]})}async getItemDetails(e,t){this.api||this.initialize();try{const s=["RemoteTrailers","LocalTrailers","People","Studios","Genres","Overview","ProductionYear","OfficialRating","RunTimeTicks","Tags","ImageTags","MediaStreams","UserData","MediaSources","Trickplay","Chapters","Width","Height"];return(await this.api.userLibrary.getItem({userId:e,itemId:t,fields:s})).data}catch(s){return console.error("getItemDetails failed",s),null}}async getLatestItems(e,t){this.api||this.initialize();try{return(await this.api.items.getItems({userId:e,parentId:t,sortBy:["DateCreated"],sortOrder:["Descending"],includeItemTypes:["Movie","Series"],recursive:!0,fields:["PrimaryImageAspectRatio","Overview","ImageTags","ProductionYear","RunTimeTicks"]})).data}catch(s){return console.error("getLatestItems failed",s),{Items:[]}}}getImageUrl(e,t="Primary",s={}){if(!e||!e.Id)return"";const{maxWidth:i=800,quality:r=90}=s;this.api||this.initialize();const l=this.api.configuration.basePath||"",c=e.ImageTags&&e.ImageTags[t]?`&tag=${e.ImageTags[t]}`:"";return`${l}/Items/${e.Id}/Images/${t}?maxWidth=${i}&quality=${r}${c}`}getPlaybackUrl(e){return`#/play/${e}`}getStreamUrl(e,t=null,s=null,i=null,r=null){this.api||this.initialize();const l=this.api.accessToken,c=this.jellyfin.deviceInfo.id;let u=`${this.api.configuration.basePath}/Videos/${e}/master.m3u8?PlaySessionId=LegitFlix-${Date.now()}&api_key=${l}&DeviceId=${c}&VideoCodec=h264,hevc,vp9,av1&AudioCodec=aac,mp3,opus,vorbis&TranscodingContainer=ts&TranscodingProtocol=hls`;return i&&(u+=`&MediaSourceId=${i}`),t!==null&&(u+=`&AudioStreamIndex=${t}`),s!==null&&(u+=`&SubtitleStreamIndex=${s}`),r&&(u+=`&VideoBitrate=${r}`),u}async reportPlaybackProgress(e,t,s,i){this.api||this.initialize();try{await this.api.playstate.reportPlaybackProgress({playbackProgressInfo:{ItemId:e,MediaSourceId:i||e,PositionTicks:t,IsPaused:s,EventName:"TimeUpdate"}})}catch(r){console.warn("Report progress failed (silent)",r)}}async reportPlaybackStopped(e,t){this.api||this.initialize();try{await this.api.playstate.reportPlaybackStopped({playbackStopInfo:{ItemId:e,PositionTicks:t}})}catch(s){console.warn("Report stop failed (silent)",s)}}async getTrickplayManifest(e){this.api||this.initialize();const t=this.api.configuration.basePath||"",i=`MediaBrowser Client="LegitFlix Client", Device="LegitFlix Web", DeviceId="legitflix-web", Version="1.0.0.18", Token="${this.api.accessToken}"`;try{const r=`${t}/Videos/${e}/Trickplay`;console.log("[Trickplay] Fetching manifest:",r);const l=await fetch(r,{headers:{Authorization:i}});if(!l.ok)return console.warn("[Trickplay] Manifest fetch failed:",l.status,l.statusText),null;const c=await l.json();return console.log("[Trickplay] Manifest data:",JSON.stringify(c).substring(0,500)),c}catch(r){return console.warn("Failed to fetch trickplay manifest",r),null}}getSubtitleUrl(e,t,s){this.api||this.initialize();const i=this.api.configuration.basePath||"",r=this.api.accessToken;return`${i}/Videos/${e}/${t}/Subtitles/${s}/0/Stream.vtt?api_key=${r}`}getTrickplayTileUrl(e,t,s){this.api||this.initialize();const i=this.api.configuration.basePath||"",r=this.api.accessToken;return`${i}/Videos/${e}/Trickplay/${t}/${s}.jpg?api_key=${r}`}async deleteSubtitle(e,t){this.api||this.initialize();try{return(await this.api.subtitle.deleteSubtitle({itemId:e,index:t})).data}catch(s){throw console.error("Failed to delete subtitle",s),s}}async searchRemoteSubtitles(e,t){this.api||this.initialize();try{return(await this.api.subtitle.searchRemoteSubtitles({itemId:e,language:t,isPerfectMatch:!1})).data}catch(s){return console.error("Failed to search subtitles",s),[]}}async downloadRemoteSubtitles(e,t){this.api||this.initialize();try{return(await this.api.subtitle.downloadRemoteSubtitles({itemId:e,subtitleId:t})).data}catch(s){throw console.error("Failed to download subtitle",s),s}}async getMediaStreams(e,t){this.api||this.initialize();const s=await this.getItemDetails(e,t);return s&&s.MediaSources&&s.MediaSources[0]?s.MediaSources[0].MediaStreams||[]:[]}async updatePassword(e,t,s){this.api||this.initialize();const i=await fetch(`${this.api.basePath}/Users/${e}/Password`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`MediaBrowser Token="${this.api.accessToken}"`},body:JSON.stringify({CurrentPw:t,NewPw:s})});if(!i.ok){const r=await i.text();throw new Error(r||"Failed to update password")}return!0}async updateUserConfiguration(e,t){if(this.api||this.initialize(),!(await fetch(`${this.api.basePath}/Users/${e}/Configuration`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`MediaBrowser Token="${this.api.accessToken}"`},body:JSON.stringify(t)})).ok)throw new Error("Failed to update user configuration");return!0}async getAllBackdrops(e,t=50){return this.api||this.initialize(),(await this.api.items.getItems({userId:e,includeItemTypes:["Movie","Series"],imageTypes:["Backdrop"],sortBy:["Random"],limit:t,recursive:!0,fields:["BackdropImageTags"]})).data?.Items||[]}async getUserViews(e){return this.api||this.initialize(),(await this.api.userViews.getUserViews({userId:e})).data}async searchItems(e,t,s=[],i=null){this.api||this.initialize();const r={searchTerm:t,recursive:!0,fields:["PrimaryImageAspectRatio","ProductionYear","DateCreated"],includeItemTypes:s,limit:20};return i&&i!=="All"&&(r.parentId=i),await this.getItems(e,r)}async quickConnect(e){if(this.api||this.initialize(),!(await fetch(`${this.api.basePath}/QuickConnect/Authorize?Code=${e}`,{method:"POST",headers:{Authorization:`MediaBrowser Token="${this.api.accessToken}"`}})).ok)throw new Error("Quick Connect failed. Check the code.");return!0}async initiateQuickConnect(){this.api||this.initialize();const e={"X-Emby-Authorization":`MediaBrowser Client="${this.jellyfin.clientInfo.name}", Device="${this.jellyfin.deviceInfo.name}", DeviceId="${this.jellyfin.deviceInfo.id}", Version="${this.jellyfin.clientInfo.version}"`},t=await fetch(`${this.api.basePath||""}/QuickConnect/Initiate`,{method:"POST",headers:e});if(!t.ok)throw new Error("Failed to initiate Quick Connect");return t.json()}async checkQuickConnectStatus(e){this.api||this.initialize();const t=await fetch(`${this.api.basePath||""}/QuickConnect/Connect?Secret=${e}`,{method:"GET"});if(t.status===200){const s=await t.json();if(s.Authenticated){this.initialize(s.AccessToken);const i=await this.api.user.getUserById({userId:s.UserId}),r={Servers:[{DateLastAccessed:new Date().toISOString(),AccessToken:s.AccessToken,UserId:i.data.Id,Name:i.data.Name,ManualAddress:this.api.basePath}]};return localStorage.setItem("jellyfin_credentials",JSON.stringify(r)),i.data}}return null}async logout(){if(console.log("[LegitFlix] Logging out..."),window.ApiClient)try{await window.ApiClient.logout()}catch(e){console.warn("ApiClient logout failed",e)}localStorage.removeItem("jellyfin_credentials"),this.api=null,window.location.href="/#/login/select-user"}async uploadUserImage(e,t,s){this.api||this.initialize();const i=this.api.accessToken;if(!i)throw new Error("No access token available for upload");const r=`MediaBrowser Client="${this.jellyfin.clientInfo.name}", Device="${this.jellyfin.deviceInfo.name}", DeviceId="${this.jellyfin.deviceInfo.id}", Version="${this.jellyfin.clientInfo.version}", Token="${i}"`,l=s.type||"image/png";console.log(`[LegitFlix] Uploading ${t} image. Size: ${s.size}, Type: ${l}`);const c=await fetch(`${this.api.basePath}/Users/${e}/Images/${t}`,{method:"POST",headers:{"Content-Type":l,"X-Emby-Authorization":r},body:s});if(!c.ok){const h=await c.text();throw console.error("Upload failed response:",h),new Error(`Failed to upload image: ${c.status} ${c.statusText}`)}return!0}async deleteUserImage(e,t){this.api||this.initialize();const s=this.api.accessToken;if(!s)throw new Error("No access token available for delete");const i=`MediaBrowser Client="${this.jellyfin.clientInfo.name}", Device="${this.jellyfin.deviceInfo.name}", DeviceId="${this.jellyfin.deviceInfo.id}", Version="${this.jellyfin.clientInfo.version}", Token="${s}"`,r=await fetch(`${this.api.basePath}/Users/${e}/Images/${t}`,{method:"DELETE",headers:{"X-Emby-Authorization":i}});if(!r.ok)throw new Error(`Failed to delete image: ${r.status} ${r.statusText}`);return!0}}const ee=new EL,ze=({type:n="text",width:e,height:t,style:s={}})=>p.jsx("div",{className:`skeleton skeleton-${n}`,style:{width:e,height:t,...s}});function sv(n,e){if(typeof n=="function")return n(e);n!=null&&(n.current=e)}function AL(...n){return e=>{let t=!1;const s=n.map(i=>{const r=sv(i,e);return!t&&typeof r=="function"&&(t=!0),r});if(t)return()=>{for(let i=0;i<s.length;i++){const r=s[i];typeof r=="function"?r():sv(n[i],null)}}}}var IL=Symbol.for("react.lazy"),fu=oA[" use ".trim().toString()];function _L(n){return typeof n=="object"&&n!==null&&"then"in n}function SS(n){return n!=null&&typeof n=="object"&&"$$typeof"in n&&n.$$typeof===IL&&"_payload"in n&&_L(n._payload)}function RL(n){const e=wL(n),t=w.forwardRef((s,i)=>{let{children:r,...l}=s;SS(r)&&typeof fu=="function"&&(r=fu(r._payload));const c=w.Children.toArray(r),h=c.find(NL);if(h){const u=h.props.children,f=c.map(g=>g===h?w.Children.count(u)>1?w.Children.only(null):w.isValidElement(u)?u.props.children:null:g);return p.jsx(e,{...l,ref:i,children:w.isValidElement(u)?w.cloneElement(u,void 0,f):null})}return p.jsx(e,{...l,ref:i,children:r})});return t.displayName=`${n}.Slot`,t}var LL=RL("Slot");function wL(n){const e=w.forwardRef((t,s)=>{let{children:i,...r}=t;if(SS(i)&&typeof fu=="function"&&(i=fu(i._payload)),w.isValidElement(i)){const l=kL(i),c=OL(r,i.props);return i.type!==w.Fragment&&(c.ref=s?AL(s,l):l),w.cloneElement(i,c)}return w.Children.count(i)>1?w.Children.only(null):null});return e.displayName=`${n}.SlotClone`,e}var CL=Symbol("radix.slottable");function NL(n){return w.isValidElement(n)&&typeof n.type=="function"&&"__radixId"in n.type&&n.type.__radixId===CL}function OL(n,e){const t={...e};for(const s in e){const i=n[s],r=e[s];/^on[A-Z]/.test(s)?i&&r?t[s]=(...c)=>{const h=r(...c);return i(...c),h}:i&&(t[s]=i):s==="style"?t[s]={...i,...r}:s==="className"&&(t[s]=[i,r].filter(Boolean).join(" "))}return{...n,...t}}function kL(n){let e=Object.getOwnPropertyDescriptor(n.props,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?n.ref:(e=Object.getOwnPropertyDescriptor(n,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?n.props.ref:n.props.ref||n.ref)}const iv={default:"lf-btn--primary",primary:"lf-btn--primary",ringHover:"lf-btn--ring-hover",glass:"lf-btn--glass",outline:"lf-btn--outline",ghost:"lf-btn--ghost",destructive:"lf-btn--destructive"},DL={default:"",sm:"lf-btn--sm",lg:"lf-btn--lg",icon:"lf-btn--icon"},vi=w.forwardRef(({className:n="",variant:e="default",size:t="default",asChild:s=!1,...i},r)=>{const l=s?LL:"button",c=iv[e]||iv.default,h=DL[t]||"",u=["lf-btn",c,h,n].filter(Boolean).join(" ");return p.jsx(l,{className:u,ref:r,...i})});vi.displayName="Button";const PL=({onInfoClick:n})=>{const{config:e}=Yi();Ms();const[t,s]=w.useState([]),[i,r]=w.useState(0),[l,c]=w.useState(0),[h,u]=w.useState(!0),f=w.useRef(null),g=w.useRef(null);w.useEffect(()=>{(async()=>{try{const N=await ee.getCurrentUser();if(!N){console.error("No user found for HeroCarousel. jellyfinService.api:",ee.api),u(!1);return}console.log("[HeroCarousel] User found:",N.Name,N.Id);const D=e.contentSortMode||"latest",k={latest:{sortBy:"DateCreated",sortOrder:"Descending"},random:{sortBy:"Random",sortOrder:"Descending"},topRated:{sortBy:"CommunityRating",sortOrder:"Descending"}},{sortBy:B,sortOrder:j}=k[D]||k.latest,U={includeItemTypes:e.heroMediaTypes,recursive:!0,sortBy:B,sortOrder:j,limit:20,fields:["PrimaryImageAspectRatio","Overview","ProductionYear","OfficialRating","CommunityRating","RunTimeTicks","Genres","MediaStreams","UserData","ImageTags","BackdropImageTags"],imageTypeLimit:1,enableImageTypes:["Backdrop","Primary","Logo"]};let J=((await ee.getItems(N.Id,U)).Items||[]).filter(me=>me.BackdropImageTags&&me.BackdropImageTags.length>0);const re=J.length>3?J.slice(3,9):J.slice(0,6);for(const me of re)if(me.Type==="Series")try{const M=await ee.getNextUp(N.Id,me.Id);M.Items&&M.Items.length>0&&(me._nextUp=M.Items[0])}catch(M){console.warn("Failed to fetch Next Up",M)}s(re)}catch(N){console.error("HeroCarousel fetch error",N)}finally{u(!1)}})()},[e]);const y=()=>{s(C=>(C.length===0||r(N=>(N+1)%C.length),C)),c(C=>C+1)},x=C=>{r(C),c(N=>N+1),S()},S=()=>{f.current&&clearInterval(f.current),f.current=setInterval(y,8e3),g.current&&g.current.classList.remove("carousel-paused")};w.useEffect(()=>(t.length>0&&S(),()=>clearInterval(f.current)),[t]);const E=async(C,N)=>{C.stopPropagation(),C.currentTarget;const D=N.UserData?.IsFavorite,k={...N,UserData:{...N.UserData,IsFavorite:!D}};s(B=>B.map(j=>j.Id===N.Id?k:j));try{const B=await ee.getCurrentUser();B&&await ee.markFavorite(B.Id,N.Id,!D)}catch(B){console.error("Failed to toggle fav",B),s(j=>j.map(U=>U.Id===N.Id?N:U))}};if(h)return p.jsxs("div",{className:"hero-carousel-container",style:{height:"90vh",background:"#111",position:"relative"},children:[p.jsx(ze,{width:"100%",height:"100%"}),p.jsxs("div",{style:{position:"absolute",top:"42.5%",left:"4%",transform:"translateY(-50%)",width:"40%",maxWidth:"600px",display:"flex",flexDirection:"column",gap:"1.25rem"},children:[p.jsx(ze,{width:"70%",height:"60px",style:{marginBottom:"0"}}),p.jsx(ze,{width:"40%",height:"24px"}),p.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"8px",width:"100%"},children:[p.jsx(ze,{width:"100%",height:"18px"}),p.jsx(ze,{width:"95%",height:"18px"}),p.jsx(ze,{width:"60%",height:"18px"})]}),p.jsxs("div",{style:{display:"flex",gap:"12px",marginTop:"0.5rem"},children:[p.jsx(ze,{width:"160px",height:"46px",style:{borderRadius:"50px"}}),p.jsx(ze,{width:"42px",height:"42px",style:{borderRadius:"50%"}}),p.jsx(ze,{width:"42px",height:"42px",style:{borderRadius:"50%"}})]})]})]});if(t.length===0)return null;const T=C=>`${ee.api.basePath}/Items/${C}/Images/Backdrop/0?maxHeight=1080&quality=96`,A=C=>`${ee.api.basePath}/Items/${C}/Images/Logo?maxHeight=200&maxWidth=450&quality=90`,_=C=>{let N=new Set,D=new Set;C.MediaStreams&&C.MediaStreams.forEach(j=>{j.Type==="Audio"&&j.Language&&N.add(j.Language),j.Type==="Subtitle"&&j.Language&&D.add(j.Language)});const k=D.size>0,B=N.size>1;return k&&B?"Sub | Dub":k?"Sub":B?"Dub":""},I=C=>{if(C.RunTimeTicks&&C.Type!=="Series"){const N=C.RunTimeTicks/1e4,k=new Date(Date.now()+N).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1});return p.jsxs(p.Fragment,{children:[p.jsx("span",{className:"hero-meta-divider",children:""}),p.jsxs("span",{className:"hero-meta-text",children:["Ends at ",k]})]})}return null};return p.jsxs("div",{id:"legit-hero-carousel",className:"hero-carousel-container",ref:g,children:[t.map((C,N)=>{const D=N===i,k=_(C),B=I(C),j=C.ImageTags&&C.ImageTags.Logo;let U="START WATCHING",K="";if(C.Type==="Series")if(C._nextUp){const J=C._nextUp.ParentIndexNumber,re=C._nextUp.IndexNumber;U="CONTINUE",K=`S${J} E${re}`}else K="S1 E1";else if(C.UserData&&C.UserData.PlaybackPositionTicks>0){const J=Math.round(C.UserData.PlaybackPositionTicks/C.RunTimeTicks*100);J>2&&J<90&&(U="CONTINUE",K=` - ${J}%`)}const H=C.UserData?.IsFavorite;return p.jsxs("div",{className:`hero-slide ${D?"active":""}`,"data-index":N,children:[p.jsx("div",{className:"hero-backdrop",style:{backgroundImage:`url('${T(C.Id)}')`}}),p.jsx("div",{className:"hero-overlay"}),p.jsxs("div",{className:"hero-content",children:[j?p.jsx("img",{src:A(C.Id),className:"hero-logo",alt:C.Name}):p.jsx("h1",{className:"hero-title",children:C.Name}),p.jsxs("div",{className:"hero-meta-line",children:[p.jsx("span",{className:"hero-badge-age",children:C.OfficialRating||"13+"}),k&&p.jsxs(p.Fragment,{children:[p.jsx("span",{className:"hero-meta-divider",children:""}),p.jsx("span",{className:"hero-meta-text",children:k})]}),p.jsx("span",{className:"hero-meta-divider",children:""}),p.jsx("span",{className:"hero-meta-text",children:C.Genres?C.Genres.slice(0,3).join(", "):"Anime"}),C.CommunityRating&&p.jsxs(p.Fragment,{children:[p.jsx("span",{className:"hero-meta-divider",children:""}),p.jsxs("span",{className:"hero-meta-text",children:[" ",C.CommunityRating.toFixed(1)]})]}),B]}),p.jsx("p",{className:"hero-desc",children:C.Overview}),p.jsxs("div",{className:"hero-actions flex gap-3 items-center",children:[p.jsxs(vi,{variant:"ringHover",onClick:J=>{J.stopPropagation(),window.location.href=`/web/index.html?classic=true#!/playback?id=${C.Id}`},children:[p.jsx("i",{className:"material-icons",children:"play_arrow"}),p.jsxs("span",{children:[U," ",p.jsx("small",{className:"text-sm ml-1",children:K})]})]}),p.jsx(vi,{variant:"outline",size:"icon",className:`rounded-full w-12 h-12 border-2 border-white/20 bg-black/40 hover:bg-white/10 hover:border-white ${H?"text-primary":"text-white"}`,onClick:J=>E(J,C),children:p.jsx("span",{className:H?"material-icons":"material-icons-outlined",children:H?"bookmark":"bookmark_border"})}),p.jsx(vi,{variant:"outline",size:"icon",className:"rounded-full w-12 h-12 border-2 border-white/20 bg-black/40 hover:bg-white/10 hover:border-white text-white",onClick:J=>{J.stopPropagation(),n(C.Id)},title:"More Info",children:p.jsx("span",{className:"material-icons-outlined",children:"info"})})]})]})]},C.Id)}),p.jsx("div",{className:"hero-indicators",children:t.map((C,N)=>{const D=N===i,k=N<i;return p.jsx("div",{className:`hero-indicator ${D?"active":""} ${k?"completed":""}`,onClick:()=>x(N),children:p.jsx("div",{className:"fill"},`fill-${N}-${D?l:"inactive"}`)},N)})})]})},UL=({item:n,onClick:e})=>{const[t,s]=w.useState(!1),[i,r]=w.useState(null),[l,c]=w.useState({top:0,left:0,width:0,height:0}),h=w.useRef(null),u=w.useRef(null),[f,g]=w.useState(n.UserData||{}),y=async()=>{if(h.current&&(clearTimeout(h.current),h.current=null),u.current){const I=u.current.getBoundingClientRect();if(c({top:I.top+window.scrollY,left:I.left+window.scrollX,width:I.width,height:I.height}),s(!0),!i)try{const C=await ee.getCurrentUser();if(C){const N=await ee.getItemDetails(C.Id,n.Id);r(N),g(N.UserData||{})}}catch(C){console.error("Failed to fetch details",C)}}},x=()=>{h.current=setTimeout(()=>{s(!1)},100)},S=()=>{h.current&&(clearTimeout(h.current),h.current=null)},E=async(I,C)=>{if(I.stopPropagation(),!!i)try{const N=await ee.getCurrentUser();if(C==="played"){const D=!f.Played;g(k=>({...k,Played:D})),await ee.markPlayed(N.Id,n.Id,D)}else if(C==="favorite"){const D=!f.IsFavorite;g(k=>({...k,IsFavorite:D})),await ee.markFavorite(N.Id,n.Id,D)}}catch(N){console.error("Action failed",N)}},T=()=>{const I=[];return n.ProductionYear&&I.push(n.ProductionYear),n.Type==="Series"&&n.Status==="Continuing"&&I.push("Airing"),I.join("  ")||""},A=I=>{if(!I||!I.MediaSources||!I.MediaSources[0])return null;const C=I.MediaSources[0].MediaStreams||[];if(C.length===0)return null;const N=C.filter(U=>U.Type==="Audio"),D=C.filter(U=>U.Type==="Subtitle"),k=N.some(U=>U.Language==="eng"||U.Language==="en"||U.Language==="english"||U.DisplayTitle&&U.DisplayTitle.toLowerCase().includes("eng")),B=N.some(U=>U.Language==="jpn"||U.Language==="ja"||U.Language==="japanese"||U.DisplayTitle&&U.DisplayTitle.toLowerCase().includes("jap")),j=D.some(U=>U.Language==="eng"||U.Language==="en"||U.Language==="english"||U.DisplayTitle&&U.DisplayTitle.toLowerCase().includes("eng"));return k&&(B||j)?"Sub | Dub":k?"Dub":j?"Sub":null},_=()=>{if(!t)return null;const I=i||n,C=I.CommunityRating?I.CommunityRating.toFixed(1):"",N=I.VoteCount?`(${(I.VoteCount/1e3).toFixed(1)}K)`:"",D=I.ChildCount,k=I.RecursiveItemCount||I.ChildCount,B=A(I),j=l.width+4,U=l.height+8,K=l.left-2,H=l.top-4,J=`${ee.api.basePath}/Items/${n.Id}/Images/Primary?fillHeight=600&fillWidth=400&quality=90`;return QI.createPortal(p.jsxs("div",{className:"media-card-hover-overlay",style:{top:H,left:K,width:j,minHeight:U,backgroundImage:`url('${J}')`},onMouseEnter:S,onMouseLeave:x,onClick:e,children:[p.jsx("div",{className:"hover-overlay-gradient"}),p.jsxs("div",{className:"hover-overlay-content",children:[p.jsxs("div",{className:"hover-info-group",children:[p.jsx("h3",{className:"hover-title",children:I.Name}),p.jsxs("div",{className:"hover-meta-row",children:[C&&p.jsxs("span",{className:"hover-rating",children:[C," ",p.jsx("span",{className:"material-icons star-icon",children:"star"}),N&&p.jsx("span",{className:"hover-rating-count",children:N})]}),p.jsx("span",{className:"hover-meta-separator",children:""}),p.jsxs("div",{className:"hover-stats",children:[I.Type==="Series"?p.jsxs(p.Fragment,{children:[D?p.jsxs("span",{children:[D," Seasons"]}):null,D&&k?p.jsx("span",{children:"  "}):null,k?p.jsxs("span",{children:[k," Episodes"]}):null]}):p.jsx("span",{children:I.ProductionYear}),B&&p.jsxs(p.Fragment,{children:[p.jsx("span",{children:"  "}),p.jsx("span",{style:{color:"#fff",fontWeight:"bold",border:"1px solid rgba(255,255,255,0.3)",padding:"0 4px",borderRadius:"3px",fontSize:"0.7rem"},children:B})]})]})]}),I.Overview&&p.jsx("p",{className:"hover-desc",children:I.Overview})]}),p.jsxs("div",{className:"hover-actions",children:[p.jsx("button",{className:"btn-action-icon play-icon",title:"Play",onClick:re=>{re.stopPropagation(),e&&e()},children:p.jsx("span",{className:"material-icons",children:"play_arrow"})}),p.jsx("button",{className:`btn-action-icon bookmark-icon ${f.IsFavorite?"active":""}`,onClick:re=>E(re,"favorite"),title:f.IsFavorite?"Unfavorite":"Favorite",children:p.jsx("span",{className:"material-icons",children:f.IsFavorite?"bookmark":"bookmark_border"})}),p.jsx("button",{className:`btn-action-icon plus-icon ${f.Played?"active":""}`,onClick:re=>E(re,"played"),title:f.Played?"Mark Unplayed":"Mark Played",children:p.jsx("span",{className:"material-icons",children:"add"})})]})]})]}),document.body)};return p.jsxs(p.Fragment,{children:[p.jsxs("div",{className:"media-card",ref:u,onMouseEnter:y,onMouseLeave:x,onClick:e,children:[p.jsx("div",{className:"media-card-image-container",children:p.jsx("img",{src:`${ee.api.basePath}/Items/${n.Id}/Images/Primary?fillHeight=500&fillWidth=340&quality=90`,alt:n.Name,className:"media-card-image",loading:"lazy",onError:I=>{I.target.style.display="none"}})}),p.jsxs("div",{className:"media-card-info",children:[p.jsx("div",{className:"media-card-title",children:n.Name}),T()&&p.jsx("div",{className:"media-card-subtitle",children:T()})]})]}),_()]})},ML=({title:n,libraryId:e,onCardClick:t})=>{const[s,i]=w.useState([]),[r,l]=w.useState(!0),[c,h]=w.useState(!1),[u,f]=w.useState(!1),g=w.useRef(null),y=Ms(),x=()=>{if(g.current){const{scrollLeft:E,scrollWidth:T,clientWidth:A}=g.current;h(E>5),f(E+A<T-5)}};w.useEffect(()=>{(async()=>{l(!0);try{const T=await ee.getCurrentUser();if(T&&e){const A=await ee.getLatestItems(T.Id,e);A&&A.Items&&i(A.Items)}}catch(T){console.error("MediaRow fetch error",T)}finally{l(!1)}})()},[e]),w.useEffect(()=>{if(!r&&s.length>0){const E=setTimeout(x,100);return window.addEventListener("resize",x),()=>{window.removeEventListener("resize",x),clearTimeout(E)}}},[r,s]);const S=E=>{if(g.current){const T=g.current,A=window.innerWidth*.8;T.scrollBy({left:E==="left"?-A:A,behavior:"smooth"}),setTimeout(x,500)}};return r?p.jsxs("div",{className:"media-row-container",children:[p.jsx("div",{style:{padding:"0 4%",marginBottom:"15px"},children:p.jsx(ze,{width:"150px",height:"24px"})}),p.jsx("div",{className:"media-row-wrapper",style:{paddingLeft:"4%",display:"flex",gap:"15px",overflow:"hidden"},children:[1,2,3,4,5,6].map(E=>p.jsx("div",{style:{flex:"0 0 160px"},children:p.jsx(ze,{width:"100%",height:"240px",style:{borderRadius:"8px"}})},E))})]}):s.length===0?null:p.jsxs("div",{className:"media-row-container",children:[p.jsxs("h2",{className:"media-row-title",onClick:()=>y(`/library/${e}`),style:{cursor:"pointer",display:"flex",alignItems:"center",gap:"5px"},children:[n," ",p.jsx("span",{style:{fontSize:"0.8em",opacity:.7},children:""})]}),p.jsxs("div",{className:"media-row-wrapper",children:[c&&p.jsx("button",{className:"row-arrow left",onClick:()=>S("left"),children:p.jsx("span",{className:"material-icons",children:"chevron_left"})}),p.jsx("div",{className:"media-row-scroll",ref:g,onScroll:x,children:s.map(E=>p.jsx(UL,{item:E,onClick:()=>t?t(E):y(`/item/${E.Id}`)},E.Id))}),u&&p.jsx("button",{className:"row-arrow right",onClick:()=>S("right"),children:p.jsx("span",{className:"material-icons",children:"chevron_right"})})]})]})},jL=({itemId:n,onClose:e,isOpen:t})=>{const[s,i]=w.useState(null),[r,l]=w.useState([]),[c,h]=w.useState(null),[u,f]=w.useState(!0),[g,y]=w.useState(!1),[x,S]=w.useState(!1),[E,T]=w.useState(null);if(w.useEffect(()=>!t||!n?void 0:((async()=>{S(!0);const U=await ee.getCurrentUser(),K=H=>H?H.includes("v=")?H.split("v=")[1].split("&")[0]:H.includes("youtu.be/")?H.split("youtu.be/")[1].split("?")[0]:H.includes("embed/")?H.split("embed/")[1].split("?")[0]:null:null;if(U){T(U.Id);const H=await ee.getItemDetails(U.Id,n);i(H);const J=[];if(H.RemoteTrailers&&H.RemoteTrailers.forEach(re=>{const me=K(re.Url);me&&J.push({title:"Main Trailer",id:me,type:"Movie"})}),H.Type==="Series"&&(await ee.getSeasons(U.Id,n)).forEach(me=>{me.RemoteTrailers&&me.RemoteTrailers.forEach(M=>{const $=K(M.Url);$&&J.push({title:me.Name,id:$})})}),H.LocalTrailers&&H.LocalTrailers.forEach(re=>{J.push({title:re.Name||"Local Trailer",id:re.Id,type:"Local"})}),l(J),J.length>0)h(J[0].id);else if(H.Type==="Series"||H.Type==="Movie"){const re=`${H.Name} ${H.ProductionYear||""} Trailer`;l([{title:"Search YouTube",id:re,type:"Search"}]),h(re)}}})(),document.body.style.overflow="hidden",()=>{document.body.style.overflow="",i(null),l([]),h(null),S(!1)}),[t,n]),w.useEffect(()=>{let j;const U=()=>{y(!1),clearTimeout(j),j=setTimeout(()=>y(!0),5e3)};return window.addEventListener("mousemove",U),window.addEventListener("click",U),U(),()=>{window.removeEventListener("mousemove",U),window.removeEventListener("click",U),clearTimeout(j)}},[t]),!t||!s)return null;const A=async()=>{if(!E||!s)return;const j=!s.UserData?.IsFavorite;i(U=>({...U,UserData:{...U.UserData,IsFavorite:j}}));try{await ee.markFavorite(E,s.Id,j)}catch{i(K=>({...K,UserData:{...K.UserData,IsFavorite:!j}}))}},_=()=>{window.location.href=`#!/details?id=${s.Id}`},I=()=>{f(!u)},C=`${ee.api.basePath}/Items/${s.Id}/Images/Backdrop/0?quality=90&maxWidth=1920`,N=s.ImageTags&&s.ImageTags.Logo?`${ee.api.basePath}/Items/${s.Id}/Images/Logo?maxHeight=140&maxWidth=400&quality=90`:null,D=r.find(j=>j.id===c);let k=null,B=!1;return D&&(D.type==="Local"?(B=!0,k=`${ee.api.basePath}/Videos/${D.id}/stream?Container=mp4&Static=true&api_key=${ee.api.accessToken}`):D.type==="Search"?k=`https://www.youtube.com/embed?listType=search&list=${encodeURIComponent(D.id)}&autoplay=1&mute=${u?1:0}&loop=1&modestbranding=1&rel=0&iv_load_policy=3&fs=0&color=white&controls=0&disablekb=1`:k=`https://www.youtube.com/embed/${D.id}?autoplay=1&mute=${u?1:0}&loop=1&modestbranding=1&rel=0&iv_load_policy=3&fs=0&color=white&controls=0&disablekb=1&playlist=${D.id}&enablejsapi=1`),p.jsxs("div",{className:`legitflix-info-modal ${x?"visible":""}`,children:[p.jsx("div",{className:"info-modal-backdrop",onClick:e}),p.jsxs("div",{className:"info-modal-content",children:[p.jsx(vi,{variant:"ghost",size:"icon",className:"btn-close-modal absolute top-5 right-5 z-50 rounded-full bg-black/50 text-white hover:bg-white/20",onClick:e,children:p.jsx("span",{className:"material-icons",children:"close"})}),p.jsxs("div",{className:"info-video-container",children:[p.jsx("div",{className:"iframe-wrapper",children:k?B?p.jsx("video",{className:"info-video-iframe",src:k,autoPlay:!0,muted:u,loop:!0,playsInline:!0,style:{objectFit:"cover",width:"100%",height:"100%"}}):p.jsx("iframe",{className:"info-video-iframe",src:k,title:"Trailer",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"}):p.jsx("div",{className:"info-backdrop-fallback",style:{backgroundImage:`url('${C}')`}})}),p.jsx("div",{className:"video-overlay-gradient"}),k&&p.jsx("div",{className:"video-mute-overlay",children:p.jsx(vi,{variant:"ghost",size:"icon",className:"rounded-full w-10 h-10 border border-white/30 bg-black/30 hover:bg-white/10 text-white",onClick:I,children:p.jsx("span",{className:"material-icons text-lg",children:u?"volume_off":"volume_up"})})}),p.jsxs("div",{className:`info-hero-content ${g?"idle":""}`,children:[N?p.jsx("img",{src:N,className:"info-logo",alt:s.Name}):p.jsx("h1",{className:"info-title-text",children:s.Name}),p.jsxs("div",{className:"info-actions flex gap-4 mt-6",children:[p.jsxs(vi,{variant:"ringHover",size:"lg",className:"h-12 px-8 text-lg font-bold rounded-md gap-2",onClick:_,children:[p.jsx("span",{className:"material-icons",children:"play_arrow"})," Play"]}),p.jsxs(vi,{variant:"outline",size:"lg",className:`h-12 px-6 text-lg rounded-md gap-2 border-2 bg-transparent hover:bg-white/10 ${s.UserData?.IsFavorite?"border-primary text-primary":"border-white/40 text-white"}`,onClick:A,children:[p.jsx("span",{className:"material-icons",children:s.UserData?.IsFavorite?"check":"add"})," My List"]})]})]})]}),p.jsx("div",{className:"info-details-container",children:p.jsxs("div",{className:"info-col-left",children:[p.jsxs("div",{className:"info-meta-row",children:[p.jsx("span",{className:"info-year",children:s.ProductionYear}),s.OfficialRating&&p.jsx("span",{className:"info-rating",children:s.OfficialRating}),p.jsx("span",{className:"info-duration",children:s.RunTimeTicks?Math.round(s.RunTimeTicks/6e8)+"m":""}),p.jsx("span",{className:"info-quality",children:"HD"})]}),p.jsx("p",{className:"info-desc",children:s.Overview||"No description available."})]})}),p.jsxs("div",{className:"info-trailers-section",children:[p.jsx("h3",{children:"Trailers & More"}),p.jsxs("div",{className:"trailers-grid",children:[r.map(j=>p.jsxs("div",{className:"trailer-card",onClick:()=>h(j.id),children:[p.jsxs("div",{className:"trailer-thumb",children:[j.type==="Local"?p.jsx("div",{className:"local-trailer-placeholder",children:p.jsx("span",{className:"material-icons",children:"movie"})}):p.jsx("img",{src:`https://img.youtube.com/vi/${j.id}/mqdefault.jpg`,alt:j.title,loading:"lazy"}),p.jsx("div",{className:"play-overlay",children:p.jsx("span",{className:"material-icons",children:"play_circle_outline"})})]}),p.jsx("div",{className:"trailer-title",children:j.title})]},j.id)),p.jsxs("a",{href:`https://www.youtube.com/results?search_query=${encodeURIComponent(s.Name+" "+(s.ProductionYear||"")+" trailer")}`,target:"_blank",rel:"noopener noreferrer",className:"trailer-card search-card",children:[p.jsx("div",{className:"trailer-thumb search-thumb",children:p.jsx("span",{className:"material-icons",children:"search"})}),p.jsx("div",{className:"trailer-title",children:"Search YouTube"})]})]})]}),p.jsxs("div",{className:"info-about-section",children:[p.jsxs("h3",{children:["About ",s.Name]}),s.People&&p.jsxs("div",{className:"about-row",children:[p.jsx("span",{className:"label",children:"Cast: "}),p.jsx("span",{className:"value",children:s.People.slice(0,10).map(j=>j.Name).join(", ")})]}),s.Genres&&p.jsxs("div",{className:"about-row",children:[p.jsx("span",{className:"label",children:"Genres: "}),p.jsx("span",{className:"value",children:s.Genres.join(", ")})]})]})]})]})},BL=()=>{const{config:n}=Yi();return n.enableJellyseerr?p.jsx("div",{className:"library-card jellyseerr-card-wrapper",children:p.jsx("a",{href:n.jellyseerrUrl,target:"_blank",rel:"noopener noreferrer",className:"jellyseerr-card",children:p.jsxs("div",{className:"jellyseerr-image",style:{backgroundImage:`url('${n.jellyseerrBackground||"https://raw.githubusercontent.com/gorillasuti/Legitflix-plugin/refs/heads/main/legitflix-client/public/jellyseerr.jpg"}')`},children:[p.jsx("div",{className:"jellyseerr-overlay"}),p.jsxs("div",{className:"jellyseerr-content",children:[p.jsx("span",{className:"material-icons card-icon",children:"add_circle_outline"}),p.jsx("span",{className:"card-label",children:n.jellyseerrText||"Request Feature"})]})]})})}):null},FL=({isOpen:n,onClose:e})=>{const[t,s]=w.useState(""),[i,r]=w.useState([]),[l,c]=w.useState({Name:"All",Id:"All"}),[h,u]=w.useState([{Name:"All",Id:"All"}]),[f,g]=w.useState(!1),y=w.useRef(null),x=Ms();if(w.useEffect(()=>{(async()=>{try{const T=await ee.getCurrentUser();if(T){const A=await ee.getUserViews(T.Id);A&&A.Items&&u([{Name:"All",Id:"All"},...A.Items])}}catch(T){console.error("Failed to fetch views",T)}})()},[]),w.useEffect(()=>{n&&setTimeout(()=>y.current?.focus(),100)},[n]),w.useEffect(()=>{const T=setTimeout(async()=>{if(g(!0),r([]),t.trim().length===0){if(l.Id!=="All")try{const A=await ee.getCurrentUser();if(A){const _=await ee.getItems(A.Id,{parentId:l.Id,limit:20,sortBy:["DateCreated"],sortOrder:["Descending"],includeItemTypes:["Movie","Series","BoxSet"],recursive:!0,fields:["PrimaryImageAspectRatio","ProductionYear"]});r(_.Items||[])}}catch(A){console.error("Category fetch failed",A),r([])}else r([]);g(!1);return}try{const A=await ee.getCurrentUser();if(!A){g(!1);return}const _=await ee.searchItems(A.Id,t,["Movie","Series","Person","BoxSet"],l.Id);r(_.Items||[])}catch(A){console.error("Search failed",A)}finally{g(!1)}},300);return()=>clearTimeout(T)},[t,l]),!n)return null;const S=E=>{e(),E.Type==="Movie"?x(`/movie/${E.Id}`):E.Type==="Series"?x(`/series/${E.Id}`):E.Type==="Person"?x(`/person/${E.Id}`):E.Type==="BoxSet"?x(`/collections/${E.Id}`):x(`/details/${E.Id}`)};return p.jsx("div",{className:`legit-search-overlay ${n?"visible":""}`,onClick:e,children:p.jsxs("div",{className:"legit-search-modal",onClick:E=>E.stopPropagation(),children:[p.jsxs("div",{className:"legit-search-header",children:[p.jsx("span",{className:"material-icons legit-search-icon",children:"search"}),p.jsx("input",{ref:y,className:"legit-search-input",placeholder:"Start typing to search...",value:t,onChange:E=>s(E.target.value),onKeyDown:E=>{E.key==="Escape"&&e()}}),p.jsxs("div",{className:"legit-search-actions",onClick:e,children:[p.jsx("span",{className:"legit-search-esc",children:"esc"}),p.jsx("span",{className:"legit-search-close",children:"Close"})]})]}),p.jsx("div",{className:"legit-search-categories",children:h.map(E=>p.jsx("div",{className:`legit-search-category-pill ${l.Id===E.Id?"active":""}`,onClick:()=>c(E),children:E.Name},E.Id))}),p.jsx("div",{className:"legit-search-results",children:f?Array.from({length:5}).map((E,T)=>p.jsxs("div",{className:"legit-search-result-item skeleton-item",style:{pointerEvents:"none"},children:[p.jsx(ze,{width:"40px",height:"60px",style:{borderRadius:"4px",marginRight:"15px"}}),p.jsxs("div",{className:"legit-result-info",style:{width:"100%"},children:[p.jsx(ze,{width:"60%",height:"20px",style:{marginBottom:"8px"}}),p.jsx(ze,{width:"30%",height:"14px"})]})]},`skeleton-${T}`)):p.jsxs(p.Fragment,{children:[i.length===0&&t.length>0&&p.jsxs("div",{className:"legit-no-results",children:['No results found for "',t,'"']}),i.length===0&&t.length===0&&l.Id!=="All"&&p.jsxs("div",{className:"legit-no-results",children:["No items found in ",l.Name]}),t.length===0&&l.Id==="All"&&p.jsxs("div",{className:"legit-search-helper",children:[p.jsx("span",{className:"material-icons",children:"keyboard"}),p.jsx("p",{children:"Start typing to search..."})]}),i.map(E=>p.jsxs("div",{className:"legit-search-result-item",onClick:()=>S(E),children:[p.jsx("div",{className:"legit-result-thumb",style:{backgroundImage:`url(${ee.api.basePath}/Items/${E.Id}/Images/Primary?fillHeight=60&fillWidth=40&quality=90)`,backgroundColor:"#222"},children:!E.ImageTags?.Primary&&p.jsx("span",{className:"material-icons legit-result-icon-fallback",children:"movie"})}),p.jsxs("div",{className:"legit-result-info",children:[p.jsx("div",{className:"legit-result-title",children:E.Name}),p.jsxs("div",{className:"legit-result-meta",children:[p.jsx("span",{className:"legit-result-tag",children:E.Type?.toUpperCase()}),E.ProductionYear&&p.jsx("span",{children:E.ProductionYear})]})]})]},E.Id))]})})]})})},gm=({isOpen:n,onClose:e,onSave:t,userId:s})=>{const[i,r]=w.useState([]),[l,c]=w.useState(null),[h,u]=w.useState(!1);if(w.useEffect(()=>{if(!n||!s)return;u(!0),c(null),(async()=>{try{const E=(await ee.getAllBackdrops(s,50)).filter(T=>T.BackdropImageTags&&T.BackdropImageTags.length>0);r(E)}catch(S){console.error("[BannerPicker] Failed to fetch backdrops",S)}finally{u(!1)}})()},[n,s]),!n)return null;const f=x=>{const S=x.BackdropImageTags?.[0];return`${ee.api.basePath}/Items/${x.Id}/Images/Backdrop/0?quality=80&maxWidth=600&tag=${S}`},g=x=>{const S=x.BackdropImageTags?.[0];return`${ee.api.basePath}/Items/${x.Id}/Images/Backdrop/0?quality=90&maxWidth=1920&tag=${S}`},y=()=>{l&&t(l),e()};return p.jsxs("div",{className:"banner-picker-overlay",children:[p.jsx("div",{className:"banner-picker-backdrop",onClick:e}),p.jsxs("div",{className:"banner-picker-modal",children:[p.jsx("h2",{className:"banner-picker-title",children:"Select Banner"}),h?p.jsx("div",{className:"banner-picker-grid",children:[1,2,3,4,5,6,7,8,9,10,11,12].map(x=>p.jsx("div",{className:"banner-picker-card",children:p.jsx(ze,{width:"100%",height:"100%",style:{borderRadius:"6px"}})},x))}):p.jsx("div",{className:"banner-picker-grid",children:i.map(x=>{const S=f(x),E=g(x),T=l===E;return p.jsx("div",{className:`banner-picker-card ${T?"selected":""}`,onClick:()=>c(E),children:p.jsx("img",{src:S,alt:x.Name,loading:"lazy"})},x.Id)})}),p.jsxs("div",{className:"banner-picker-actions",children:[p.jsx("button",{className:"btn-picker-close",onClick:e,children:"CLOSE"}),p.jsxs("button",{className:"btn-picker-save",onClick:y,disabled:!l,children:[p.jsx("span",{className:"material-icons",children:"save"})," SAVE"]})]})]})]})},VL=["010c7b9061ece2fbf7bbb8d9bb6d2bee16f4a68c.png","1b2d497a3f909e45b0cdbc08cc6d5aa1a949a1a2.png","1def8ba1616b0966e1db6021f1055ca356d1cea9.png","27c51845bddee8f4ff1c30aeb716d8aa731b6286.png","31687dea129fb21a578977565077d44b0ca92da5.png","3394687450705634476d174e6b395f0aa41db487.png","339bc7408b3c9e38fe40f8d6689bf441bca8357a.png","35d29230db5589057d23849f6369f22e90044cd1.png","38d52512bdd7a762bbadf4ae673d80140a118957.png","3bf2c8889e738213673c1a77803587aedd4a8148.png","45aff5dc4892254211d4982c12e2bf0ac8caef90.png","5e3f3f8dd9ca520c92d2b3dd23ec9737203631d9.png","62c5f931445c1a5a1228cb24f913fa0234a577c2.png","64fd2f5c0fbb5e0c5348f3947e5fd6b762e3e8ea.png","6980956ae6150a0697586505546be9ad377250a0.png","6ef91d4e1b1377703ed9caef1072f327c5ce107f.png","71dcab8c2f39540c99eab624d2bdada0ac9cb44e.png","79b07958e72c796a12eceba7832dc8e3bae85ca9.png","7cafcf32034f4c292574ced3e745a83d0c68e11e.png","8623109ba7bc471ab63ca32e1d820c3806c2c36c.png","98b48b004a2882f1dc3e9f12167304d6417d3bd4.png","99d8a4f741a9f042c71a6d2f5017f39f6f35e350.png","ab21304ad03dc74e4267320069636ca096ec7ea2.png","ae4337ebf3305b6c66020fde433c92257b7c5616.png","aebd06a8792119a23ca1c11a285cfca7468bfa67.png","b0caf3e60209775ab9c34662b7d860ba3e07f17a.png","b20b75517fe91a777d67d434f534378c987c8f89.png","b628ef1fe21c1a97773cab1b8efe341f651a20ef.png","c9d0048f1edf7bd5c415e676ebfce0e600166481.png","cde86a64d2c491f4494c916fc81fdc3a1980654e.png","d96038f9fde13a71369fd3b42bd53832f8db4be0.png","e8b7f5f61a4905834e169f89f3835b905659a44d.png","Netflix-abaya-61.png","Netflix-abaya-69.png","Netflix-academic_gown-27.png","Netflix-academic_gown-75.png","Netflix-affenpinscher-38.png","Netflix-ashcan-38.png","Netflix-balance_beam-10.png","Netflix-balloon-17.png","Netflix-balloon-20.png","Netflix-balloon-24.png","Netflix-balloon-35.png","Netflix-balloon-58.png","Netflix-ballplayer-21.png","Netflix-Band_Aid-23.png","Netflix-Band_Aid-29.png","Netflix-Band_Aid-34.png","Netflix-Band_Aid-54.png","Netflix-Band_Aid-65.png","Netflix-Band_Aid-92.png","Netflix-Band_Aid-94.png","Netflix-barn_spider-14.png","Netflix-basenji-11.png","Netflix-bassoon-11.png","Netflix-bearskin-54.png","Netflix-bikini-14.png","Netflix-bikini-26.png","Netflix-binoculars-62.png","Netflix-book_jacket-14.png","Netflix-bow_tie-10.png","Netflix-bow_tie-13.png","Netflix-bow_tie-39.png","Netflix-bow_tie-66.png","Netflix-bow_tie-97.png","Netflix-brassiere-11.png","Netflix-brassiere-15.png","Netflix-brassiere-18.png","Netflix-brassiere-58.png","Netflix-cardigan-28.png","Netflix-cellular_telephone-73.png","Netflix-chain_saw-43.png","Netflix-chain_saw-82.png","Netflix-chime-11.png","Netflix-coffeepot-11.png","Netflix-comic_book-12.png","Netflix-comic_book-13.png","Netflix-comic_book-14.png","Netflix-comic_book-16.png","Netflix-comic_book-18.png","Netflix-comic_book-20.png","Netflix-comic_book-21.png","Netflix-comic_book-23.png","Netflix-comic_book-26.png","Netflix-comic_book-31.png","Netflix-comic_book-35.png","Netflix-comic_book-36.png","Netflix-comic_book-38.png","Netflix-comic_book-39.png","Netflix-comic_book-45.png","Netflix-comic_book-46.png","Netflix-comic_book-48.png","Netflix-comic_book-49.png","Netflix-comic_book-51.png","Netflix-comic_book-53.png","Netflix-comic_book-55.png","Netflix-comic_book-56.png","Netflix-comic_book-61.png","Netflix-comic_book-64.png","Netflix-comic_book-65.png","Netflix-comic_book-66.png","Netflix-comic_book-69.png","Netflix-comic_book-70.png","Netflix-comic_book-74.png","Netflix-comic_book-76.png","Netflix-comic_book-77.png","Netflix-comic_book-78.png","Netflix-comic_book-81.png","Netflix-comic_book-83.png","Netflix-comic_book-84.png","Netflix-comic_book-85.png","Netflix-comic_book-92.png","Netflix-comic_book-93.png","Netflix-comic_book-95.png","Netflix-comic_book-96.png","Netflix-comic_book-97.png","Netflix-corkscrew-10.png","Netflix-cornet-14.png","Netflix-crane-77.png","Netflix-crash_helmet-56.png","Netflix-Crock_Pot-42.png","Netflix-Crock_Pot-49.png","Netflix-digital_clock-37.png","Netflix-digital_clock-69.png","Netflix-drum-48.png","Netflix-dumbbell-18.png","Netflix-envelope-25.png","Netflix-feather_boa-59.png","Netflix-fountain-41.png","Netflix-fur_coat-21.png","Netflix-fur_coat-31.png","Netflix-gasmask-95.png","Netflix-gasmask-98.png","Netflix-golden_retriever-94.png","Netflix-hair_slide-32.png","Netflix-hair_spray-37.png","Netflix-hen-91.png","Netflix-hippopotamus-13.png","Netflix-hippopotamus-25.png","Netflix-hook-15.png","Netflix-hornbill-25.png","Netflix-hornbill-95.png","Netflix-ice_bear-90.png","Netflix-jaguar-90.png","Netflix-jersey-10.png","Netflix-jersey-11.png","Netflix-jersey-12.png","Netflix-jersey-13.png","Netflix-jersey-21.png","Netflix-jersey-28.png","Netflix-jersey-30.png","Netflix-jersey-31.png","Netflix-jersey-32.png","Netflix-jersey-48.png","Netflix-jersey-70.png","Netflix-jersey-73.png","Netflix-joystick-66.png","Netflix-kimono-16.png","Netflix-king_penguin-93.png","Netflix-lab_coat-29.png","Netflix-lab_coat-36.png","Netflix-loggerhead-81.png","Netflix-loudspeaker-83.png","Netflix-macaque-49.png","Netflix-magnetic_compass-54.png","Netflix-maillot-13.png","Netflix-maillot-14.png","Netflix-maillot-23.png","Netflix-maillot-37.png","Netflix-mask-11.png","Netflix-mask-12.png","Netflix-mask-13.png","Netflix-mask-14.png","Netflix-mask-21.png","Netflix-mask-24.png","Netflix-mask-25.png","Netflix-mask-26.png","Netflix-mask-27.png","Netflix-mask-31.png","Netflix-mask-41.png","Netflix-mask-44.png","Netflix-mask-48.png","Netflix-mask-55.png","Netflix-mask-56.png","Netflix-mask-65.png","Netflix-mask-77.png","Netflix-mask-85.png","Netflix-mask-99.png","Netflix-matchstick-45.png","Netflix-military_uniform-54.png","Netflix-mouse-24.png","Netflix-mushroom-51.png","Netflix-neck_brace-84.png","Netflix-nipple-36.png","Netflix-oboe-10.png","Netflix-orangutan-77.png","Netflix-pajama-16.png","Netflix-palace-23.png","Netflix-Pembroke-97.png","Netflix-pencil_box-40.png","Netflix-pencil_sharpener-34.png","Netflix-perfume-24.png","Netflix-pick-39.png","Netflix-pick-73.png","Netflix-pickelhaube-11.png","Netflix-ping-pong_ball-11.png","Netflix-ping-pong_ball-47.png","Netflix-ping-pong_ball-53.png","Netflix-pinwheel-16.png","Netflix-pinwheel-28.png","Netflix-pole-25.png","Netflix-poncho-36.png","Netflix-pool_table-19.png","Netflix-pool_table-48.png","Netflix-pool_table-58.png","Netflix-pool_table-62.png","Netflix-pool_table-68.png","Netflix-pool_table-80.png","Netflix-pool_table-92.png","Netflix-punching_bag-61.png","Netflix-racket-12.png","Netflix-rapeseed-26.png","Netflix-red_fox-80.png","Netflix-red_wine-49.png","Netflix-ski_mask-11.png","Netflix-ski_mask-41.png","Netflix-soap_dispenser-14.png","Netflix-soap_dispenser-20.png","Netflix-soap_dispenser-27.png","Netflix-soap_dispenser-62.png","Netflix-sombrero-74.png","Netflix-spotlight-39.png","Netflix-stage-43.png","Netflix-stethoscope-11.png","Netflix-stethoscope-12.png","Netflix-street_sign-69.png","Netflix-suit-18.png","Netflix-suit-22.png","Netflix-suit-25.png","Netflix-suit-31.png","Netflix-suit-36.png","Netflix-suit-40.png","Netflix-suit-44.png","Netflix-suit-74.png","Netflix-suit-76.png","Netflix-suit-79.png","Netflix-sulphur_butterfly-33.png","Netflix-sunglass-51.png","Netflix-sweatshirt-11.png","Netflix-sweatshirt-20.png","Netflix-sweatshirt-23.png","Netflix-sweatshirt-35.png","Netflix-sweatshirt-54.png","Netflix-table_lamp-17.png","Netflix-table_lamp-39.png","Netflix-teddy-10.png","Netflix-teddy-11.png","Netflix-teddy-15.png","Netflix-teddy-21.png","Netflix-teddy-27.png","Netflix-teddy-98.png","Netflix-tennis_ball-13.png","Netflix-tiger-72.png","Netflix-tiger_shark-70.png","Netflix-torch-23.png","Netflix-totem_pole-65.png","Netflix-toyshop-11.png","Netflix-tree_frog-97.png","Netflix-trench_coat-83.png","Netflix-triceratops-63.png","Netflix-tub-32.png","Netflix-umbrella-44.png","Netflix-umbrella-83.png","Netflix-violin-17.png","Netflix-violin-67.png","Netflix-water_bottle-18.png","Netflix-water_bottle-68.png","Netflix-Weimaraner-41.png","Netflix-whistle-14.png","Netflix-wig-11.png","Netflix-wig-14.png","Netflix-wig-15.png","Netflix-wig-21.png","Netflix-wig-29.png","Netflix-wig-30.png","Netflix-wig-35.png","Netflix-wig-39.png","Netflix-wig-43.png","Netflix-wig-45.png","Netflix-wig-46.png","Netflix-wig-47.png","Netflix-wig-48.png","Netflix-wig-71.png","Netflix-wig-92.png","Netflix-Windsor_tie-11.png"],$L=JSON.parse('["100001-the-rising-of-the-shield-hero-naofumi.png","100002-the-rising-of-the-shield-hero-raphtalia.png","100003-the-rising-of-the-shield-hero-filo.png","100004-the-rising-of-the-shield-hero-melty.png","100005-the-rising-of-the-shield-hero-rishia.png","100006-spy-x-family-loid.png","100007-spy-x-family-yor.png","100008-spy-x-family-anya-1.png","100009-spy-x-family-anya-2.png","100010-spy-x-family-anya-3.png","1001-the-worlds-finest-assassin-lugh.png","1002-the-worlds-finest-assassin-dia.png","1003-the-worlds-finest-assassin-tart.png","1004-the-worlds-finest-assassin-maha.png","1005-the-worlds-finest-assassin-assassin.png","1011-fena-pirate-princess-fena.png","1012-fena-pirate-princess-yukimaru.png","1013-fena-pirate-princess-shitan.png","1014-fena-pirate-princess-karin.png","1015-fena-pirate-princess-twins.png","1016-fena-pirate-princess-makaba.png","1017-fena-pirate-princess-tsubaki.png","1018-fena-pirate-princess-brule.png","1019-fena-pirate-princess-fena-young.png","1020-fena-pirate-princess-yukimaru-young.png","1021-to-your-eternity-fushi.png","1022-to-your-eternity-joann.png","1023-to-your-eternity-march.png","1024-to-your-eternity-parona.png","1025-to-your-eternity-thebeholder.png","1026-to-your-eternity-gugu.png","1027-to-your-eternity-tonari.png","1028-to-your-eternity-theboy.png","1029-to-your-eternity-fushi.png","1030-to-your-eternity-march.png","1036-tokyo-revengers-takemichi.jpg","1037-tokyo-revengers-mikey.jpg","1038-tokyo-revengers-draken.jpg","1039-tokyo-revengers-mitsuya.jpg","1040-tokyo-revengers-baji.jpg","1041-jujutsu-kaisen-yuji-itadori.png","1042-jujutsu-kaisen-megumi-fushigoro.png","1043-jujutsu-kaisen-nobara-kugisaki.png","1044-jujutsu-kaisen-satoru-gojo.png","1045-jujutsu-kaisen-ryomen-sukuna.png","1046-dr-stone-senku.png","1047-dr-stone-suika.png","1048-dr-stone-kohaku.png","1049-dr-stone-chrome.png","1050-dr-stone-gen.png","1051-so-im-a-spider-so-what-kumoko.png","1052-so-im-a-spider-so-what-shun.png","1053-so-im-a-spider-so-what-katia.png","1054-so-im-a-spider-so-what-sue.png","1055-so-im-a-spider-so-what-fei.png","1056-black-clover-asta.png","1057-black-clover-yuno.png","1058-black-clover-noelle.png","1059-black-clover-yami.png","1060-black-clover-nero.png","11-tower-of-god-bam.png","12-tower-of-god-khun.png","13-tower-of-god-rak.jpg","14-tower-of-god-yuri-jahad.jpg","15-tower-of-god-endorsi-jahad.png","16-the-god-of-high-school-jin-mori.png","17-the-god-of-high-school-han-daewi.png","18-the-god-of-high-school-yoo-mira.png","19-the-god-of-high-school-park-mujin.png","20-the-god-of-high-school-park-ilpyo.png","21-bananya-bananya.png","22-bananya-droopy-eared.png","23-bananya-pirate.png","24-bananya-night-rainbow.png","25-bananya-emo.png","26-inspectre-kotoko-iwanaga.jpg","27-inspectre-kuro-sakuragawa.jpg","28-inspectre-saki-yumihara.jpg","29-inspectre-steel-lady-nanase.jpg","2bluenagi_nagi_avatar.png","30-inspectre-komainu.jpg","31-somali-and-the-forest-spirit-golem.jpg","32-somali-and-the-forest-spirit-somali.jpg","33-somali-and-the-forest-spirit-shizuno.jpg","34-somali-and-the-forest-spirit-uzoi.jpg","35-somali-and-the-forest-spirit-kikila.jpg","36-that-time-i-got-reincarnated-as-a-slime-rimuru-human.png","37-that-time-i-got-reincarnated-as-a-slime-shuna.png","38-that-time-i-got-reincarnated-as-a-slime-shion.png","39-that-time-i-got-reincarnated-as-a-slime-rimuru-slime.png","40-that-time-i-got-reincarnated-as-a-slime-hinata.jpg","41-zombieland-saga-revenge-sakura-minamoto.jpg","42-zombieland-saga-revenge-saki-nikaido.jpg","43-zombieland-saga-revenge-ai-mizuno.jpg","44-zombieland-saga-revenge-junko-konno.jpg","45-zombieland-saga-revenge-yugiri.jpg","46-zombieland-saga-revenge-lily-hoshikawa.jpg","47-zombieland-saga-revenge-tae-yamada.jpg","afdal.png","aot_fc_annie-avatar.png","aot_fc_armin-avatar.png","aot_fc_conny-avatar.png","aot_fc_eren-avatar.png","aot_fc_hange-avatar.png","aot_fc_jean-avatar.png","aot_fc_levi-avatar.png","aot_fc_mikasa-avatar.png","aot_fc_reiner-avatar.png","aot_fc_sasha-avatar.png","apothecary_gaoshun.png","apothecary_gyokuyou.png","apothecary_jinshi-1.png","apothecary_jinshi-2.png","apothecary_lihaku.png","apothecary_maomao-1.png","apothecary_maomao-2.png","apothecary_xiaolan.png","ash.png","avatars-big_mom.png","avatars-brook.png","avatars-chopper.png","avatars-franky.png","avatars-jinbei.png","avatars-kaido.png","avatars-kid.png","avatars-law.png","avatars-luffy.png","avatars-nami.png","avatars-perona.png","avatars-robin.png","avatars-sanji.png","avatars-shanks.png","avatars-usopp.png","avatars-yamato.png","avatars-zoro.png","bachira_avatar.png","bb-ciel-avatar.png","bb-edgar-avatar.png","bb-herman-avatar.png","bb-lawrence-avatar.png","bb_gregory-avatar.png","bb_sebastian-avatar.png","bluelock_bachira_avatar.png","bluelock_bachira_teaser_avatar.png","bluelock_barou_avatar.png","bluelock_chigiri_avatar.png","bluelock_ego_avatar.png","bluelock_hiori_teaser_avatar.png","bluelock_isagi_avatar.png","bluelock_isagi_kv1_avatar.png","bluelock_isagi_teaser_avatar.png","bluelock_karasu_teaser_avatar.png","bluelock_kunigami_avatar.png","bluelock_nagi_avatar.png","bluelock_nagi_teaser_avatar.png","bluelock_nanase_teaser_avatar.png","bluelock_oliver_kv1_avatar.png","bluelock_otoya_teaser_avatar.png","bluelock_reo_avatar.png","bluelock_rin_avatar.png","bluelock_rin_kv1_avatar.png","bluelock_rin_teaser_avatar.png","bluelock_sae_kv1_avatar.png","bluelock_sae_teaser_avatar.png","bluelock_shidou_teaser_avatar.png","bluelock_yukimiya_teaser_avatar.png","bluelock_zantetsu_avatar.png","bluenagi_chigiri_avatar.png","bluenagi_isagi_avatar.png","bluenagi_kunigami_avatar.png","bluenagi_nagi_school_avatar.png","bluenagi_reo_avatar.png","bluenagi_reo_school_avatar.png","bluenagi_rin_avatar.png","bocchi-avatar.jpg","bocchi-iita-kv-avatar.jpg","bocchi-kita-avatar.jpg","bocchi-kv-avatar.jpg","bocchi-nijika-kv-avatar.jpg","bocchi-ryo-avatar.jpg","bocchi-ryo-kv-avatar.jpg","bochhi-nijika-avatar.jpg","chainsawman-aki.jpg","chainsawman-chainsawman.jpg","chainsawman-denji.jpg","chainsawman-himeno.jpg","chainsawman-kishibe.jpg","chainsawman-kobeni.jpg","chainsawman-makima.jpg","chainsawman-pochita.jpg","chainsawman-power.jpg","chris-1.png","chris-2.png","classic-hime-avatar-1.png","classic-hime-avatar-2.png","classic-hime-avatar-3.png","classic-sudachi-avatar-1.png","classic-sudachi-avatar-2.png","classic-sudachi-avatar-3.png","classic-yuzu-avatar-1.png","classic-yuzu-avatar-2.png","classic-yuzu-avatar-3.png","crbrand_avatars_logo_marks_black_orange.jpg","crbrand_avatars_logo_marks_black_taupe.jpg","crbrand_avatars_logo_marks_black_white.jpg","crbrand_avatars_logo_marks_mangaeye_taupe.jpg","crbrand_avatars_logo_marks_mangagirl_taupe.jpg","crbrand_avatars_logo_marks_manga_eye_orange.jpg","crbrand_avatars_logo_marks_manga_skull_orange.jpg","crbrand_avatars_logo_marks_manga_skull_taupe.jpg","crbrand_avatars_logo_marks_mech_orange.jpg","crbrand_avatars_logo_marks_mech_orange2.jpg","crbrand_avatars_logo_marks_mech_taupe.jpg","crbrand_avatars_logo_marks_mech_taupe2.jpg","crbrand_avatars_logo_marks_orange_black.jpg","crbrand_avatars_logo_marks_orange_expressive.jpg","crbrand_avatars_logo_marks_orange_stars.jpg","crbrand_avatars_logo_marks_orange_taupe.jpg","crbrand_avatars_logo_marks_orange_taupe_stars.jpg","crbrand_avatars_logo_marks_orange_white.jpg","crbrand_avatars_logo_marks_taupe_expressive.jpg","crbrand_avatars_logo_marks_the_rings.jpg","dbdiama_avatarbackground2025_avatar_10.jpg","dbdiama_avatarbackground2025_avatar_3.jpg","dbdiama_avatarbackground2025_avatar_4.jpg","dbdiama_avatarbackground2025_avatar_5.jpg","dbdiama_avatarbackground2025_avatar_6.jpg","dbdiama_avatarbackground2025_avatar_7.jpg","dbdiama_avatarbackground2025_avatar_8.jpg","dbdiama_avatarbackground2025_avatar_9.jpg","dotm_avatar_02.png","dr_stone_s4_avatar_2.jpg","dr_stone_s4_avatar_3.jpg","dr_stone_s4_avatar_4.jpg","eden.png","egghead-brook.png","egghead-chopper.png","egghead-franky.png","egghead-jimbei.png","egghead-luffy.png","egghead-nami.png","egghead-robin.png","egghead-sanji.png","egghead-usopp.png","egghead-zoro.png","finn-1.png","finn-2.png","freiren-avatar-1.png","freiren-avatar-2.png","freiren-avatar-3.png","frieren_eisen-avatar-1.png","frieren_eisen-avatar-2.png","frieren_fern-avatar-1.png","frieren_fern-avatar-2.png","frieren_heiter-avatar-1.png","frieren_heiter-avatar-2.png","frieren_himmel-avatar-1.png","frieren_himmel-avatar-2.png","frieren_stark-avatar-1.png","frieren_stark-avatar-2.png","gear5avatar1.png","gear5avatar2.png","gear5avatar3.png","gear5avatar4.png","gear5avatar5.png","gear5avatar6.png","gear5avatar7.png","gear5avatar8.png","gear5avatar9.png","gene-1.png","gene-2.png","giallon-1.png","giallon-2.png","im_in_love_clarie-kv1.png","im_in_love_clarie-kv2.png","im_in_love_clarie.png","im_in_love_lene.png","im_in_love_manaria.png","im_in_love_misha.png","im_in_love_rae-kv1.png","im_in_love_rae-kv2.png","im_in_love_rae.png","inbento_avatar_1.png","inbento_avatar_3.png","inbento_avatar_4.png","inbento_avatar_5.png","jill.png","leo-1.png","leo-2.png","momoka-1.png","momoka-2.png","momoka-3.png","momoka-4.png","momoka-5.png","mushokutensei_ariel.jpg","mushokutensei_cliff.jpg","mushokutensei_elinalise.jpg","mushokutensei_eris.jpg","mushokutensei_ghislaine.jpg","mushokutensei_juli.jpg","mushokutensei_linia.jpg","mushokutensei_luke.jpg","mushokutensei_pursena.jpg","mushokutensei_rudeus-school-uniform.jpg","mushokutensei_rudeus.jpg","mushokutensei_ruijerd.jpg","mushokutensei_sara.jpg","mushokutensei_soldat.jpg","mushokutensei_suzanne.jpg","mushokutensei_sylphie-fitz.jpg","mushokutensei_sylphie.jpg","mushokutensei_zanoba.jpg","my-dress-up-gojo-1-avatar.jpg","my-dress-up-gojo-2-avatar.jpg","my-dress-up-marin-1-avatar.jpg","my-dress-up-marin-2-avatar.jpg","my-dress-up-marin-cosplay-avatar.jpg","my-dress-up-marin-normal-avatar.jpg","my-dress-up-sajuna-1-avatar.jpg","my-dress-up-sajuna-2-avatar.jpg","my-dress-up-shinju-1-avatar.jpg","my-dress-up-shinju-2-avatar.jpg","naomi-1.png","naomi-2.png","nina-1.png","nina-2.png","nina-3.png","nina-4.png","nina-5.png","noid.png","one-piece-chopper-1.png","one-piece-chopper-2.png","one-piece-chopper-3.png","one-piece-franky-1.png","one-piece-franky-2.png","one-piece-franky-3.png","one-piece-jimbei-1.png","one-piece-jimbei-2.png","one-piece-jimbei-3.png","one-piece-jimbei-4.png","one-piece-luffy-1.png","one-piece-luffy-2.png","one-piece-luffy-3.png","one-piece-luffy-4.png","one-piece-luffy-5.png","one-piece-nico-robin-1.png","one-piece-nico-robin-2.png","one-piece-nico-robin-3.png","one-piece-roronoa-zoro-1.png","one-piece-roronoa-zoro-2.png","one-piece-sanji-1.png","one-piece-sanji-2.png","one-piece-sanji-3.png","one-piece-usopp-1.png","one-piece-usopp-2.png","rcg1_avatar_02.png","rcg1_avatar_04.png","rcg2_avatar_01.png","rcg2_avatar_03.png","rcg2_avatar_04.png","rent-a-gf-chizuru-s1-date-kv.jpg","rent-a-gf-chizuru-s2-date-kv.jpg","rent-a-gf-chizuru-s3-date-kv.jpg","rent-a-gf-mami-s1-date-kv.jpg","rent-a-gf-mami-s2-date-kv_1.jpg","rent-a-gf-mami-s2-date-kv_2.jpg","rent-a-gf-mami-s3-date-kv_1.jpg","rent-a-gf-mami-s3-date-kv_2.jpg","rent-a-gf-ruka-s1-date-kv.jpg","rent-a-gf-ruka-s2-date-kv.jpg","rent-a-gf-ruka-s3-date-kv.jpg","rent-a-gf-sumi-s1-date-kv.jpg","rent-a-gf-yaemori-s3-date-kv.jpg","rent-a-gf-yaemori-s3-main-kv.jpg","rent-a-gf-yaemori-s3-teaser-kv.jpg","rezero_s3_avatar_01.jpg","rezero_s3_avatar_02.jpg","rezero_s3_avatar_04.jpg","rezero_s3_avatar_05.jpg","rezero_s3_avatar_06.jpg","rezero_s3_avatar_07.jpg","rezero_s3_avatar_08.jpg","rezero_s3_avatar_09.jpg","rezero_s3_avatar_10.jpg","rezero_s3_avatar_11.jpg","rezero_s3_avatar_12.jpg","rezero_s3_avatar_13.jpg","rezero_s3_avatar_14.jpg","rezero_s3_avatar_15.jpg","rezero_s3_avatar_16.jpg","rezero_s3_avatar_17.jpg","rezero_s3_avatar_18.jpg","rezero_s3_avatar_19.jpg","rezero_s3_avatar_20.jpg","rezero_s3_avatar_21.jpg","rezero_s3_avatar_22.jpg","rezero_s3_avatar_23.jpg","rouge-1.png","rouge-2.png","rouge-3.png","rouge-4.png","rupa-1.png","rupa-2.png","rupa-3.png","rupa-4.png","rupa-5.png","rwby_avatar_01.png","rwby_avatar_03.png","rwby_avatar_04.png","sarah.png","shangrilafrontier_s2_avatar_1.jpg","shangrilafrontier_s2_avatar_10.jpg","shangrilafrontier_s2_avatar_11.jpg","shangrilafrontier_s2_avatar_12.jpg","shangrilafrontier_s2_avatar_13.jpg","shangrilafrontier_s2_avatar_14.jpg","shangrilafrontier_s2_avatar_15.jpg","shangrilafrontier_s2_avatar_2.jpg","shangrilafrontier_s2_avatar_3.jpg","shangrilafrontier_s2_avatar_4.jpg","shangrilafrontier_s2_avatar_5.jpg","shangrilafrontier_s2_avatar_6.jpg","shangrilafrontier_s2_avatar_7.jpg","shangrilafrontier_s2_avatar_8.jpg","shangrilafrontier_s2_avatar_9.jpg","sololeveling_s2_avatar_1_v2_choi_avatar.png","sololeveling_s2_avatar_2_v2_jinwoo_avatar.png","sololeveling_s2_avatar_3_v2_igris_avatar.png","sololeveling_s2_avatar_4_v2_baek_avatar.png","sololeveling_s2_avatar_5_v2_cha_avatar.png","solo_baekyoonho.png","solo_chahaein.png","solo_choijongin.png","solo_gogunhee.png","solo_sungjinwoo.png","solo_teaser_visual.png","solo_woojinchul.png","solo_yoojinho.png","spidersaurs_avatar_02.png","sss_avatar_01.png","subaru-1.png","subaru-2.png","subaru-3.png","subaru-4.png","subaru-5.png","tog_bam_avatar_1.png","tog_bam_avatar_2.png","tog_bam_avatar_3.png","tog_endorsi_avatar_1.png","tog_endorsi_avatar_2.png","tog_hayuri_avatar_1.png","tog_hwaryun_avatar_1.png","tog_ja_avatar_1.png","tog_ja_avatar_2.png","tog_jihwa_avatar_1.png","tog_jihwa_avatar_2.png","tog_khunaa_avatar_1.png","tog_khunaa_avatar_2.png","tog_khunran_avatar_1.png","tog_rak_avatar_1.png","tog_rak_avatar_2.png","tomo-1.png","tomo-2.png","tomo-3.png","tomo-4.png","tomo-5.png","vijay-1.png","vijay-2.png","wendy-1.png","wendy-2.png"]'),GL=["scale(1).png","scale(10).png","scale(100).png","scale(101).png","scale(102).png","scale(103).png","scale(104).png","scale(105).png","scale(106).png","scale(107).png","scale(108).png","scale(11).png","scale(110).png","scale(111).png","scale(112).png","scale(113).png","scale(114).png","scale(115).png","scale(116).png","scale(117).png","scale(118).png","scale(119).png","scale(12).png","scale(120).png","scale(121).png","scale(122).png","scale(123).png","scale(124).png","scale(125).png","scale(126).png","scale(127).png","scale(128).png","scale(129).png","scale(13).png","scale(130).png","scale(131).png","scale(132).png","scale(133).png","scale(134).png","scale(135).png","scale(136).png","scale(137).png","scale(138).png","scale(139).png","scale(14).png","scale(140).png","scale(141).png","scale(142).png","scale(143).png","scale(144).png","scale(145).png","scale(146).png","scale(147).png","scale(148).png","scale(149).png","scale(15).png","scale(150).png","scale(151).png","scale(152).png","scale(153).png","scale(154).png","scale(155).png","scale(156).png","scale(157).png","scale(158).png","scale(159).png","scale(16).png","scale(160).png","scale(161).png","scale(162).png","scale(163).png","scale(164).png","scale(165).png","scale(166).png","scale(167).png","scale(168).png","scale(169).png","scale(17).png","scale(170).png","scale(171).png","scale(172).png","scale(173).png","scale(174).png","scale(175).png","scale(176).png","scale(177).png","scale(178).png","scale(179).png","scale(18).png","scale(180).png","scale(181).png","scale(182).png","scale(183).png","scale(184).png","scale(185).png","scale(186).png","scale(187).png","scale(189).png","scale(19).png","scale(190).png","scale(191).png","scale(192).png","scale(193).png","scale(194).png","scale(195).png","scale(196).png","scale(197).png","scale(198).png","scale(199).png","scale(2).png","scale(20).png","scale(200).png","scale(201).png","scale(202).png","scale(203).png","scale(204).png","scale(205).png","scale(206).png","scale(207).png","scale(208).png","scale(209).png","scale(21).png","scale(210).png","scale(211).png","scale(212).png","scale(22).png","scale(23).png","scale(24).png","scale(25).png","scale(26).png","scale(27).png","scale(28).png","scale(29).png","scale(3).png","scale(30).png","scale(31).png","scale(32).png","scale(33).png","scale(34).png","scale(35).png","scale(36).png","scale(37).png","scale(38).png","scale(39).png","scale(4).png","scale(40).png","scale(41).png","scale(42).png","scale(43).png","scale(44).png","scale(45).png","scale(46).png","scale(47).png","scale(48).png","scale(49).png","scale(5).png","scale(50).png","scale(51).png","scale(52).png","scale(53).png","scale(54).png","scale(55).png","scale(56).png","scale(57).png","scale(58).png","scale(59).png","scale(6).png","scale(60).png","scale(61).png","scale(62).png","scale(63).png","scale(64).png","scale(65).png","scale(66).png","scale(67).png","scale(68).png","scale(69).png","scale(7).png","scale(70).png","scale(71).png","scale(72).png","scale(73).png","scale(74).png","scale(75).png","scale(76).png","scale(77).png","scale(78).png","scale(79).png","scale(8).png","scale(80).png","scale(81).png","scale(82).png","scale(83).png","scale(84).png","scale(85).png","scale(86).png","scale(87).png","scale(88).png","scale(89).png","scale(9).png","scale(90).png","scale(91).png","scale(92).png","scale(93).png","scale(94).png","scale(95).png","scale(96).png","scale(97).png","scale(98).png","scale(99).png"],Dc={Netflix:VL,Crunchyroll:$L,DisneyPlus:GL},ku=({isOpen:n,onClose:e,onSave:t,userId:s})=>{const[i,r]=w.useState(Object.keys(Dc)[0]),[l,c]=w.useState(null),[h,u]=w.useState(!1);if(w.useEffect(()=>{n&&(r(Object.keys(Dc)[0]),c(null))},[n]),!n)return null;const f=Object.keys(Dc),g=Dc[i]||[],y=async()=>{if(l){u(!0);try{const S=await(await fetch(l)).blob(),T=`avatar.${l.split(".").pop().split("?")[0]||"png"}`,A=new File([S],T,{type:S.type});await t(A)}catch(x){console.error("Failed to fetch avatar blob",x)}finally{u(!1)}}};return p.jsx("div",{className:"apm-overlay",onClick:e,children:p.jsxs("div",{className:"apm-modal",onClick:x=>x.stopPropagation(),children:[p.jsxs("div",{className:"apm-header",children:[p.jsx("h2",{children:"Choose Avatar"}),p.jsx("button",{className:"apm-close",onClick:e,children:""})]}),p.jsxs("div",{className:"apm-body",children:[p.jsx("div",{className:"apm-sidebar",children:f.map(x=>p.jsx("button",{className:`apm-cat-btn ${i===x?"active":""}`,onClick:()=>r(x),children:x},x))}),p.jsx("div",{className:"apm-content",children:p.jsx("div",{className:"apm-grid",children:g.map(x=>{const E=`/legitflix/client/avatars/${i}/${x}`;return p.jsx("div",{className:`apm-item ${l===E?"selected":""}`,onClick:()=>c(E),children:p.jsx("div",{className:"apm-img-wrapper",children:p.jsx("img",{src:E,alt:x,loading:"lazy"})})},x)})})})]}),p.jsxs("div",{className:"apm-footer",children:[p.jsx("button",{className:"apm-btn-cancel",onClick:e,disabled:h,children:"Cancel"}),p.jsx("button",{className:"apm-btn-save",onClick:y,disabled:!l||h,children:h?"Saving...":"Set Avatar"})]})]})})},nv=[{name:"Orange",value:"#ff7e00"},{name:"Blue",value:"#00aaff"},{name:"Pink",value:"#ff00aa"},{name:"Green",value:"#00ff7e"},{name:"Red",value:"#ff3333"},{name:"Purple",value:"#aa00ff"}],bS=({isOpen:n,onClose:e,userId:t})=>{const{config:s,updateConfig:i}=Yi(),[r,l]=w.useState("appearance"),[c,h]=w.useState(""),[u,f]=w.useState(!1),[g,y]=w.useState(!1),[x,S]=w.useState("app"),[E,T]=w.useState(!1),[A,_]=w.useState(s.accentColor||"#ff7e00"),[I,C]=w.useState(s.logoUrl||""),[N,D]=w.useState(s.showNavbarCategories!==!1),[k,B]=w.useState(s.enableJellyseerr!==!1),[j,U]=w.useState(s.jellyseerrUrl||"https://request.legitflix.eu"),[K,H]=w.useState(s.showLibraryTitles!==!1),[J,re]=w.useState(s.showNavbarRequests!==!1),[me,M]=w.useState(""),[$,F]=w.useState(s.contentTypeFilters||{Movie:!0,Series:!0,MusicAlbum:!1,Audio:!1,MusicVideo:!1}),[ae,de]=w.useState(s.contentSortMode||"latest"),[P,G]=w.useState(s.playerSeekForward||30),[te,fe]=w.useState(s.playerSeekBackward||10),[ve,Ae]=w.useState(s.defaultAudioLanguage||"auto"),[De,Ge]=w.useState(s.defaultSubtitleLanguage||"auto"),[Fe,mt]=w.useState(s.autoSkipIntro||!1),[St,jt]=w.useState(s.autoSkipOutro||!1),[bt,ut]=w.useState(s.subtitleSize||"100%"),[zt,Me]=w.useState(s.subtitleColor||"#ffffff"),[Le,Ue]=w.useState(s.subtitleBackground||"drop-shadow");w.useEffect(()=>{n&&(_(s.accentColor||"#ff7e00"),C(s.logoUrl||""),D(s.showNavbarCategories!==!1),B(s.enableJellyseerr!==!1),U(s.jellyseerrUrl||"https://request.legitflix.eu"),H(s.showLibraryTitles!==!1),re(s.showNavbarRequests!==!1),F(s.contentTypeFilters||{Movie:!0,Series:!0,MusicAlbum:!1,Audio:!1,MusicVideo:!1}),de(s.contentSortMode||"latest"),G(s.playerSeekForward||30),fe(s.playerSeekBackward||10),Ae(s.defaultAudioLanguage||"auto"),Ge(s.defaultSubtitleLanguage||"auto"),mt(s.autoSkipIntro||!1),jt(s.autoSkipOutro||!1),jt(s.autoSkipOutro||!1),ut(s.subtitleSize||"100%"),Me(s.subtitleColor||"#ffffff"),Ue(s.subtitleBackground||"drop-shadow"),h(""),nv.some(ge=>ge.value===s.accentColor)||M(s.accentColor))},[n,s]),w.useEffect(()=>(n?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[n]);const Ze=ge=>{_(ge),M("")},ht=ge=>{const Qe=ge.target.value;M(Qe),/^#[0-9A-F]{6}$/i.test(Qe)&&_(Qe)},Oe=()=>{const ge=Object.entries($).filter(([,Zt])=>Zt).map(([Zt])=>Zt),Qe=ge.length>0?ge.join(","):"Movie,Series",st=ge.length>0?ge:["Movie","Series"];i({accentColor:A,logoUrl:I,logoType:I?"image":"text",showNavbarCategories:N,enableJellyseerr:k,jellyseerrUrl:j,showLibraryTitles:K,showNavbarRequests:J,contentTypeFilters:$,heroMediaTypes:Qe,promoMediaTypes:st,contentSortMode:ae,playerSeekForward:P,playerSeekBackward:te,defaultAudioLanguage:ve,defaultSubtitleLanguage:De,autoSkipIntro:Fe,autoSkipOutro:St,subtitleSize:bt,subtitleColor:zt,subtitleBackground:Le}),e()},He=()=>{_("#ff7e00"),C(""),M(""),D(!0),B(!0),U("https://request.legitflix.eu"),H(!0),re(!0),F({Movie:!0,Series:!0,MusicAlbum:!1,Audio:!1,MusicVideo:!1}),F({Movie:!0,Series:!0,MusicAlbum:!1,Audio:!1,MusicVideo:!1}),de("latest"),G(30),fe(10),Ae("auto"),Ge("auto"),ut("100%"),Me("#ffffff"),Ue("drop-shadow")},pt=async ge=>{if(!(!ge||!t)){T(!0);try{(await fetch(`${ee.api.basePath}/Users/${t}/Images/Primary`,{method:"POST",headers:{"Content-Type":ge.type,"X-Emby-Authorization":ee.api.authHeader},body:ge})).ok&&y(!1)}catch(Qe){console.error("Avatar upload failed",Qe)}finally{T(!1)}}},Kt=[{id:"accentColor",tab:"appearance",label:"Accent Color",keywords:["color","theme","style","appearance"],render:()=>p.jsxs("div",{className:"setting-section",children:[p.jsx("h3",{children:"Accent Color"}),p.jsx("div",{className:"color-presets",children:nv.map(ge=>p.jsx("div",{className:`color-preset ${A===ge.value?"selected":""}`,style:{backgroundColor:ge.value},onClick:()=>Ze(ge.value),title:ge.name,children:A===ge.value&&p.jsx("span",{className:"material-icons",children:"check"})},ge.value))}),p.jsxs("div",{className:"custom-color-input",children:[p.jsx("label",{children:"Custom Hex:"}),p.jsx("input",{type:"text",placeholder:"#RRGGBB",value:me,onChange:ht,maxLength:7}),p.jsx("div",{className:"color-preview",style:{backgroundColor:A}})]})]},"accentColor")},{id:"logoUrl",tab:"appearance",label:"Custom Logo URL",keywords:["logo","image","branding","appearance"],render:()=>p.jsxs("div",{className:"setting-section",children:[p.jsx("h3",{children:"Custom Logo URL"}),p.jsx("p",{className:"setting-desc",children:"Enter a direct URL to an image to replace the top-left logo."}),p.jsx("input",{type:"text",className:"legit-input",placeholder:"https://example.com/logo.png",value:I,onChange:ge=>C(ge.target.value)})]},"logoUrl")},{id:"faviconUrl",tab:"appearance",label:"Custom Favicon URL",keywords:["favicon","icon","tab","browser","branding"],render:()=>p.jsxs("div",{className:"setting-section",children:[p.jsx("h3",{children:"Custom Favicon URL"}),p.jsx("p",{className:"setting-desc",children:"Enter a direct URL to an image to use as the browser tab icon."}),p.jsx("input",{type:"text",className:"legit-input",placeholder:"https://example.com/favicon.ico",value:s.faviconUrl||"",onChange:ge=>i({faviconUrl:ge.target.value})})]},"faviconUrl")},{id:"avatar",tab:"appearance",label:"Profile Avatar",keywords:["avatar","profile","image","picture","user"],render:()=>p.jsxs("div",{className:"setting-section",children:[p.jsx("h3",{children:"Profile Avatar"}),p.jsx("p",{className:"setting-desc",children:"Change your user profile picture."}),p.jsx("div",{className:"setting-row",children:p.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[p.jsx("img",{src:`${ee.api.basePath}/Users/${t}/Images/Primary?quality=90&t=${Date.now()}`,alt:"Current Avatar",style:{width:"50px",height:"50px",borderRadius:"50%",objectFit:"cover",border:"2px solid rgba(255,255,255,0.1)"},onError:ge=>{ge.target.style.display="none"}}),p.jsxs("button",{className:"lf-btn lf-btn--secondary",onClick:()=>y(!0),children:[p.jsx("span",{className:"material-icons",style:{fontSize:"18px",marginRight:"8px"},children:"face"}),"Change Avatar"]})]})})]},"avatar")},{id:"requestFeature",tab:"home",label:"Request Feature (Jellyseerr)",keywords:["request","jellyseerr","ombi","home","card"],render:()=>p.jsxs(p.Fragment,{children:[p.jsxs("div",{className:"setting-section",children:[p.jsxs("div",{className:"setting-row",children:[p.jsxs("div",{children:[p.jsx("h3",{className:"setting-title",children:"Request Feature"}),p.jsx("p",{className:"setting-desc",children:'Enable "Request" card on Home screen'})]}),p.jsxs("label",{className:"toggle-switch",children:[p.jsx("input",{type:"checkbox",checked:k,onChange:ge=>B(ge.target.checked)}),p.jsx("span",{className:"slider"})]})]}),p.jsxs("div",{className:"fade-in",style:{marginTop:"10px"},children:[p.jsx("p",{className:"setting-desc",children:"Request URL (Required for both Home Card and Navbar):"}),p.jsx("input",{type:"text",className:"legit-input",placeholder:"https://request.legitflix.eu",value:j,onChange:ge=>U(ge.target.value)})]})]},"requestFeature"),p.jsxs("div",{className:"setting-section",children:[p.jsx("h3",{children:"Card Appearance"}),p.jsx("p",{className:"setting-desc",children:"Customize the look of the Request card on the Home screen."}),p.jsx("div",{className:"setting-row",style:{marginBottom:"15px"},children:p.jsxs("div",{style:{flex:1},children:[p.jsx("label",{className:"setting-label",style:{display:"block",marginBottom:"5px",fontSize:"0.9rem"},children:"Card Title"}),p.jsx("input",{type:"text",className:"legit-input",placeholder:"Request Feature",value:s.jellyseerrText||"",onChange:ge=>i({jellyseerrText:ge.target.value})})]})}),p.jsx("div",{className:"setting-row",style:{flexDirection:"column",alignItems:"stretch",gap:"10px"},children:p.jsxs("div",{children:[p.jsx("label",{className:"setting-label",style:{display:"block",marginBottom:"5px",fontSize:"0.9rem"},children:"Card Background URL"}),p.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[p.jsx("div",{style:{width:"120px",height:"68px",borderRadius:"6px",backgroundColor:"#2a2a2a",backgroundImage:`url('${s.jellyseerrBackground||"https://raw.githubusercontent.com/gorillasuti/Legitflix-plugin/refs/heads/main/legitflix-client/public/jellyseerr.jpg"}')`,backgroundSize:"cover",backgroundPosition:"center",border:"1px solid rgba(255,255,255,0.1)",flexShrink:0}}),p.jsx("input",{type:"text",className:"legit-input",style:{marginTop:0},placeholder:"https://example.com/background.jpg",value:s.jellyseerrBackground||"",onChange:ge=>i({jellyseerrBackground:ge.target.value||null})})]})]})})]},"requestFeatureCustomization")]})},{id:"libraryTitles",tab:"home",label:"Show Library Titles",keywords:["library","names","titles","overlay","home"],render:()=>p.jsx("div",{className:"setting-section",children:p.jsxs("div",{className:"setting-row",children:[p.jsxs("div",{children:[p.jsx("h3",{className:"setting-title",children:"Show Library Titles"}),p.jsx("p",{className:"setting-desc",children:"Display text overlay on library cards"})]}),p.jsxs("label",{className:"toggle-switch",children:[p.jsx("input",{type:"checkbox",checked:K,onChange:ge=>H(ge.target.checked)}),p.jsx("span",{className:"slider"})]})]})},"libraryTitles")},{id:"contentFilters",tab:"home",label:"Content Filters",keywords:["content","media","type","movie","series","music","filter","carousel","promo","hero"],render:()=>{const ge=[{key:"Movie",label:"Movies",icon:"movie"},{key:"Series",label:"Series",icon:"tv"},{key:"MusicAlbum",label:"Music Albums",icon:"album"},{key:"Audio",label:"Audio",icon:"audiotrack"},{key:"MusicVideo",label:"Music Videos",icon:"music_video"}];return p.jsxs("div",{className:"setting-section",children:[p.jsx("h3",{children:"Content Filters"}),p.jsx("p",{className:"setting-desc",children:"Choose which media types appear in the Hero Carousel and Promo Banner."}),p.jsx("div",{className:"content-type-grid",children:ge.map(Qe=>p.jsxs("label",{className:`content-type-chip ${$[Qe.key]?"active":""}`,children:[p.jsx("input",{type:"checkbox",checked:!!$[Qe.key],onChange:st=>F(Zt=>({...Zt,[Qe.key]:st.target.checked}))}),p.jsx("span",{className:"material-icons",children:Qe.icon}),p.jsx("span",{children:Qe.label})]},Qe.key))})]},"contentFilters")}},{id:"displayOrder",tab:"home",label:"Display Order",keywords:["sort","order","random","latest","rated","carousel","promo","display"],render:()=>{const ge=[{key:"latest",label:"Latest",icon:"schedule",desc:"Newest additions first"},{key:"random",label:"Random",icon:"shuffle",desc:"Shuffled each visit"},{key:"topRated",label:"Top Rated",icon:"star",desc:"Highest community rating"}];return p.jsxs("div",{className:"setting-section",children:[p.jsx("h3",{children:"Display Order"}),p.jsx("p",{className:"setting-desc",children:"How content is sorted in the Hero Carousel and Promo Banner."}),p.jsx("div",{className:"content-type-grid",children:ge.map(Qe=>p.jsxs("label",{className:`content-type-chip ${ae===Qe.key?"active":""}`,title:Qe.desc,children:[p.jsx("input",{type:"radio",name:"sortMode",checked:ae===Qe.key,onChange:()=>de(Qe.key)}),p.jsx("span",{className:"material-icons",children:Qe.icon}),p.jsx("span",{children:Qe.label})]},Qe.key))})]},"displayOrder")}},{id:"navbarCategories",tab:"navigation",label:"Show Categories in Navbar",keywords:["navigation","menu","navbar","categories","links"],render:()=>p.jsx("div",{className:"setting-section",children:p.jsxs("div",{className:"setting-row",children:[p.jsxs("div",{children:[p.jsx("h3",{className:"setting-title",children:"Show Categories in Navbar"}),p.jsx("p",{className:"setting-desc",children:"Display library links in the top navigation bar"})]}),p.jsxs("label",{className:"toggle-switch",children:[p.jsx("input",{type:"checkbox",checked:N,onChange:ge=>D(ge.target.checked)}),p.jsx("span",{className:"slider"})]})]})},"navbarCategories")},{id:"navbarRequests",tab:"navigation",label:"Show Requests in Navbar",keywords:["navigation","navbar","requests","jellyseerr"],render:()=>p.jsx("div",{className:"setting-section",children:p.jsxs("div",{className:"setting-row",children:[p.jsxs("div",{children:[p.jsx("h3",{className:"setting-title",children:"Show Requests in Navbar"}),p.jsx("p",{className:"setting-desc",children:'Display the "Requests" link next to categories in the navbar'})]}),p.jsxs("label",{className:"toggle-switch",children:[p.jsx("input",{type:"checkbox",checked:J,onChange:ge=>re(ge.target.checked)}),p.jsx("span",{className:"slider"})]})]})},"navbarRequests")},{id:"playerSeek",tab:"player",label:"Seek Durations",keywords:["player","seek","skip","forward","backward","time"],render:()=>p.jsxs("div",{className:"setting-section",children:[p.jsx("div",{className:"setting-row",children:p.jsxs("div",{children:[p.jsx("h3",{className:"setting-title",children:"Seek Durations"}),p.jsx("p",{className:"setting-desc",children:"Customize how many seconds to skip forward or backward."})]})}),p.jsxs("div",{className:"setting-row",style:{alignItems:"flex-start",gap:"20px"},children:[p.jsxs("div",{style:{flex:1},children:[p.jsx("label",{className:"setting-label",children:"Seek Forward (Right Arrow)"}),p.jsxs("div",{className:"time-stepper",children:[p.jsx("button",{className:"stepper-btn",onClick:()=>G(ge=>Math.max(5,ge-5)),disabled:P<=5,children:p.jsx("span",{className:"material-icons",children:"remove"})}),p.jsxs("div",{className:"stepper-value",children:[p.jsx("span",{className:"stepper-number",children:P}),p.jsx("span",{className:"stepper-unit",children:"sec"})]}),p.jsx("button",{className:"stepper-btn",onClick:()=>G(ge=>Math.min(300,ge+5)),disabled:P>=300,children:p.jsx("span",{className:"material-icons",children:"add"})})]})]}),p.jsxs("div",{style:{flex:1},children:[p.jsx("label",{className:"setting-label",children:"Seek Backward (Left Arrow)"}),p.jsxs("div",{className:"time-stepper",children:[p.jsx("button",{className:"stepper-btn",onClick:()=>fe(ge=>Math.max(5,ge-5)),disabled:te<=5,children:p.jsx("span",{className:"material-icons",children:"remove"})}),p.jsxs("div",{className:"stepper-value",children:[p.jsx("span",{className:"stepper-number",children:te}),p.jsx("span",{className:"stepper-unit",children:"sec"})]}),p.jsx("button",{className:"stepper-btn",onClick:()=>fe(ge=>Math.min(300,ge+5)),disabled:te>=300,children:p.jsx("span",{className:"material-icons",children:"add"})})]})]})]})]},"playerSeek")},{id:"playerLanguages",tab:"player",label:"Default Languages",keywords:["player","audio","subtitle","language","default","dub"],render:()=>{const ge=[{code:"auto",label:"Auto (Server Default)"},{code:"eng",label:"English"},{code:"hun",label:"Hungarian (Magyar)"},{code:"ger",label:"German (Deutsch)"},{code:"jpn",label:"Japanese ()"},{code:"spa",label:"Spanish (Espaol)"},{code:"fre",label:"French (Franais)"},{code:"ita",label:"Italian (Italiano)"},{code:"por",label:"Portuguese (Portugus)"},{code:"rus",label:"Russian ()"},{code:"chi",label:"Chinese ()"},{code:"kor",label:"Korean ()"},{code:"ara",label:"Arabic ()"},{code:"hin",label:"Hindi ()"},{code:"pol",label:"Polish (Polski)"},{code:"dut",label:"Dutch (Nederlands)"},{code:"swe",label:"Swedish (Svenska)"},{code:"nor",label:"Norwegian (Norsk)"},{code:"dan",label:"Danish (Dansk)"},{code:"fin",label:"Finnish (Suomi)"},{code:"tur",label:"Turkish (Trke)"},{code:"tha",label:"Thai ()"},{code:"vie",label:"Vietnamese (Ting Vit)"},{code:"ukr",label:"Ukrainian ()"},{code:"cze",label:"Czech (etina)"},{code:"rum",label:"Romanian (Romn)"},{code:"gre",label:"Greek ()"},{code:"heb",label:"Hebrew ()"}],Qe=[{code:"auto",label:"Auto (Server Default)"},{code:"none",label:"None (Disabled)"},...ge.filter(st=>st.code!=="auto")];return p.jsxs("div",{className:"setting-section",children:[p.jsx("div",{className:"setting-row",children:p.jsxs("div",{children:[p.jsx("h3",{className:"setting-title",children:"Default Languages"}),p.jsx("p",{className:"setting-desc",children:"Preferred audio and subtitle languages for new playback."})]})}),p.jsxs("div",{className:"setting-row",style:{alignItems:"flex-start",gap:"20px"},children:[p.jsxs("div",{style:{flex:1},children:[p.jsx("label",{className:"setting-label",children:"Default Audio Language"}),p.jsx("select",{className:"legit-input",value:ve,onChange:st=>Ae(st.target.value),children:ge.map(st=>p.jsx("option",{value:st.code,children:st.label},st.code))})]}),p.jsxs("div",{style:{flex:1},children:[p.jsx("label",{className:"setting-label",children:"Default Subtitle Language"}),p.jsx("select",{className:"legit-input",value:De,onChange:st=>Ge(st.target.value),children:Qe.map(st=>p.jsx("option",{value:st.code,children:st.label},st.code))})]})]})]},"playerLanguages")}},{id:"playerAutoSkip",tab:"player",label:"Auto Skip",keywords:["player","skip","intro","outro","auto","chapter"],render:()=>p.jsxs("div",{className:"setting-section",children:[p.jsxs("div",{className:"setting-row",children:[p.jsxs("div",{children:[p.jsx("h3",{className:"setting-title",children:"Auto Skip Intro"}),p.jsx("p",{className:"setting-desc",children:"Automatically skip intro segments when detected by Jellyfin chapters."})]}),p.jsxs("label",{className:"toggle-switch",children:[p.jsx("input",{type:"checkbox",checked:Fe,onChange:ge=>mt(ge.target.checked)}),p.jsx("span",{className:"slider"})]})]}),p.jsxs("div",{className:"setting-row",children:[p.jsxs("div",{children:[p.jsx("h3",{className:"setting-title",children:"Auto Skip Outro"}),p.jsx("p",{className:"setting-desc",children:"Automatically skip outro/credits segments when detected by Jellyfin chapters."})]}),p.jsxs("label",{className:"toggle-switch",children:[p.jsx("input",{type:"checkbox",checked:St,onChange:ge=>jt(ge.target.checked)}),p.jsx("span",{className:"slider"})]})]})]},"playerAutoSkip")},{id:"subtitleAppearance",tab:"player",label:"Subtitle Appearance",keywords:["subtitle","appearance","style","color","size","background","font"],render:()=>p.jsxs("div",{className:"setting-section",children:[p.jsx("h3",{className:"setting-title",children:"Subtitle Appearance"}),p.jsx("p",{className:"setting-desc",children:"Customize how subtitles look in the player."}),p.jsxs("div",{className:"setting-row",style:{alignItems:"flex-start",gap:"20px"},children:[p.jsxs("div",{style:{flex:1},children:[p.jsx("label",{className:"setting-label",children:"Size"}),p.jsxs("select",{className:"legit-input",value:bt,onChange:ge=>ut(ge.target.value),children:[p.jsx("option",{value:"75%",children:"Small"}),p.jsx("option",{value:"100%",children:"Medium"}),p.jsx("option",{value:"125%",children:"Large"}),p.jsx("option",{value:"150%",children:"Extra Large"}),p.jsx("option",{value:"200%",children:"Huge"})]})]}),p.jsxs("div",{style:{flex:1},children:[p.jsx("label",{className:"setting-label",children:"Background Style"}),p.jsxs("select",{className:"legit-input",value:Le,onChange:ge=>Ue(ge.target.value),children:[p.jsx("option",{value:"none",children:"None"}),p.jsx("option",{value:"drop-shadow",children:"Drop Shadow"}),p.jsx("option",{value:"outline",children:"Outline"}),p.jsx("option",{value:"box",children:"Box (Semi-Transparent)"})]})]})]}),p.jsxs("div",{className:"setting-row",style:{marginTop:"16px",display:"block"},children:[p.jsx("label",{className:"setting-label",style:{marginBottom:"8px",display:"block"},children:"Text Color"}),p.jsx("div",{className:"color-presets",style:{gap:"10px"},children:[{name:"White",value:"#ffffff"},{name:"Yellow",value:"#ffff00"},{name:"Cyan",value:"#00ffff"},{name:"Green",value:"#00ff00"},{name:"Magenta",value:"#ff00ff"},{name:"Red",value:"#ff0000"},{name:"Black",value:"#000000"}].map(ge=>p.jsx("div",{className:`color-preset ${zt===ge.value?"selected":""}`,style:{backgroundColor:ge.value,width:"30px",height:"30px",borderRadius:"50%",cursor:"pointer",border:zt===ge.value?"2px solid white":"1px solid #444",position:"relative"},onClick:()=>Me(ge.value),title:ge.name,children:zt===ge.value&&p.jsx("span",{className:"material-icons",style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"18px",color:ge.value==="#ffffff"||ge.value==="#ffff00"||ge.value==="#00ff00"||ge.value==="#00ffff"?"black":"white"},children:"check"})},ge.value))})]})]},"subtitleAppearance")}].filter(ge=>{if(!c)return ge.tab===r;const Qe=c.toLowerCase();return ge.label.toLowerCase().includes(Qe)||ge.keywords.some(st=>st.includes(Qe))});return n?p.jsxs(p.Fragment,{children:[p.jsx("div",{className:"legit-settings-overlay",onClick:e,children:p.jsxs("div",{className:"legit-settings-modal expanded",onClick:ge=>ge.stopPropagation(),children:[p.jsxs("div",{className:"legit-settings-sidebar",children:[p.jsx("div",{className:"sidebar-header",children:p.jsx("h2",{children:"Settings"})}),p.jsxs("div",{className:"sidebar-tabs",children:[p.jsxs("button",{className:`sidebar-tab ${r==="appearance"&&!c?"active":""}`,onClick:()=>{l("appearance"),h("")},children:[p.jsx("span",{className:"material-icons",children:"palette"})," Appearance"]}),p.jsxs("button",{className:`sidebar-tab ${r==="home"&&!c?"active":""}`,onClick:()=>{l("home"),h("")},children:[p.jsx("span",{className:"material-icons",children:"home"})," Home Screen"]}),p.jsxs("button",{className:`sidebar-tab ${r==="navigation"&&!c?"active":""}`,onClick:()=>{l("navigation"),h("")},children:[p.jsx("span",{className:"material-icons",children:"menu"})," Navigation"]}),p.jsxs("button",{className:`sidebar-tab ${r==="player"&&!c?"active":""}`,onClick:()=>{l("player"),h("")},children:[p.jsx("span",{className:"material-icons",children:"play_circle"})," Player"]})]})]}),p.jsxs("div",{className:"legit-settings-content",children:[p.jsxs("div",{className:"content-header",children:[p.jsxs("div",{className:"search-container",children:[p.jsx("span",{className:"material-icons search-icon",children:"search"}),p.jsx("input",{type:"text",placeholder:"Search settings...",value:c,onChange:ge=>h(ge.target.value)}),c&&p.jsx("button",{className:"clear-search",onClick:()=>h(""),children:p.jsx("span",{className:"material-icons",children:"close"})})]}),p.jsx("button",{className:"close-btn-icon",onClick:e,children:""})]}),p.jsx("div",{className:"content-body",children:Kt.length>0?Kt.map(ge=>ge.render()):p.jsxs("div",{className:"no-results",children:[p.jsx("span",{className:"material-icons",children:"search_off"}),p.jsxs("p",{children:['No settings found for "',c,'"']})]})}),p.jsxs("div",{className:"content-footer",children:[p.jsx("button",{className:"btn-reset",onClick:He,children:"Reset Defaults"}),p.jsx("button",{className:"btn-save lf-btn--ring-hover",onClick:Oe,children:"Save Changes"})]})]})]})}),p.jsx(gm,{isOpen:u,onClose:()=>f(!1),onSave:ge=>{x==="app"?i({appBackground:ge}):x==="jellyseerr"&&i({jellyseerrBackground:ge}),f(!1)},userId:t}),p.jsx(ku,{isOpen:g,onClose:()=>y(!1),onSave:pt,userId:t})]}):null},HL=({isOpen:n,onClose:e})=>{const[t,s]=w.useState(""),[i,r]=w.useState(""),[l,c]=w.useState(""),h=async()=>{if(t.trim()){r("loading"),c("");try{const u=await fetch(`${ee.api.basePath}/QuickConnect/Authorize`,{method:"POST",headers:{"Content-Type":"application/json","X-Emby-Authorization":ee.api.authHeader},body:JSON.stringify({Code:t.trim()})});if(u.ok)r("success"),setTimeout(()=>{s(""),r(""),e()},1500);else{const f=await u.json().catch(()=>({}));r("error"),c(f.Message||"Invalid code. Please try again.")}}catch{r("error"),c("Connection failed. Please try again.")}}};return n?p.jsx("div",{className:"qc-overlay",onClick:e,children:p.jsxs("div",{className:"qc-modal",onClick:u=>u.stopPropagation(),children:[p.jsxs("div",{className:"qc-header",children:[p.jsx("span",{className:"material-icons qc-icon",children:"qr_code"}),p.jsx("h2",{children:"Quick Connect"}),p.jsx("button",{className:"qc-close",onClick:e,children:""})]}),p.jsx("p",{className:"qc-desc",children:"Enter the code displayed on your other device to link it to your account."}),p.jsx("input",{className:"qc-input",type:"text",placeholder:"Enter Quick Connect code",value:t,onChange:u=>s(u.target.value),onKeyDown:u=>{u.key==="Enter"&&h()},autoFocus:!0}),i==="error"&&p.jsx("p",{className:"qc-error",children:l}),i==="success"&&p.jsx("p",{className:"qc-success",children:"Connected successfully!"}),p.jsx("button",{className:"qc-submit",onClick:h,disabled:i==="loading"||!t.trim(),children:i==="loading"?"Connecting...":"Authorize"})]})}):null},zL=({isOpen:n,onClose:e,user:t})=>{const[s,i]=w.useState(!1),[r,l]=w.useState(""),[c,h]=w.useState(!1),[u,f]=w.useState(!1),g=w.useRef(null),y=t?t.ImageTags?.Banner?`${ee.api.basePath}/Users/${t.Id}/Images/Banner?tag=${t.ImageTags.Banner}&quality=90`:t.BackdropImageTags?.[0]?`${ee.api.basePath}/Users/${t.Id}/Images/Backdrop/0?tag=${t.BackdropImageTags[0]}&quality=90`:"":"",x=async A=>{if(!(!t||!A)){l("Updating banner..."),i(!0);try{const I=await(await fetch(A)).blob();await ee.uploadUserImage(t.Id,"Banner",I),l("Banner updated! Refresh to see changes.")}catch(_){console.error(_),l("Banner upload failed.")}finally{i(!1)}}};if(!n||!t)return null;const S=async A=>{if(A){i(!0),l("");try{await ee.uploadUserImage(t.Id,"Primary",A),l("Profile image updated! Refresh to see changes."),f(!1)}catch(_){console.error(_),l("Upload failed. Check your connection.")}finally{i(!1)}}},E=A=>{const _=A.target.files?.[0];S(_)},T=async()=>{i(!0),l("");try{await ee.deleteUserImage(t.Id,"Primary"),l("Profile image removed.")}catch(A){console.error(A),l("Failed to remove image.")}finally{i(!1)}};return p.jsxs(p.Fragment,{children:[p.jsx("div",{className:"pm-overlay",onClick:e,children:p.jsxs("div",{className:"pm-modal",onClick:A=>A.stopPropagation(),children:[p.jsx("button",{className:"pm-close-floating",onClick:e,children:p.jsx("span",{className:"material-icons",children:"close"})}),p.jsxs("div",{className:"pm-cover",children:[y?p.jsx("img",{src:y,alt:"Banner",className:"pm-cover-img"}):p.jsx("div",{style:{width:"100%",height:"100%",background:"#333",display:"flex",alignItems:"center",justifyContent:"center"},children:p.jsx("span",{className:"material-icons",style:{fontSize:"48px",opacity:.1},children:"wallpaper"})}),p.jsx("div",{className:"pm-cover-overlay",children:p.jsxs("button",{className:"pm-edit-cover-btn",onClick:()=>h(!0),disabled:s,children:[p.jsx("span",{className:"material-icons",children:"edit"}),"Change Cover"]})})]}),p.jsxs("div",{className:"pm-profile-header",children:[p.jsxs("div",{className:"pm-avatar-container",children:[p.jsx("img",{src:`${ee.api.basePath}/Users/${t.Id}/Images/Primary?quality=90&t=${Date.now()}`,alt:t.Name,className:"pm-avatar-img",onError:A=>{A.target.style.display="none"}}),p.jsx("div",{className:"pm-avatar-edit-overlay",onClick:()=>f(!0),children:p.jsx("span",{className:"material-icons",children:"photo_camera"})})]}),p.jsxs("div",{className:"pm-user-details",children:[p.jsx("h2",{children:t.Name}),p.jsxs("p",{children:[p.jsx("span",{className:"material-icons",style:{fontSize:"16px"},children:t?.Policy?.IsAdministrator?"shield":"person"}),t?.Policy?.IsAdministrator?"Administrator":"User"]})]})]}),p.jsx("div",{className:"pm-divider"}),p.jsxs("div",{className:"pm-actions",children:[p.jsxs("button",{className:"pm-action-row",onClick:()=>g.current?.click(),disabled:s,children:[p.jsx("span",{className:"material-icons",children:"upload"}),p.jsx("span",{children:"Upload Custom Avatar"})]}),p.jsxs("button",{className:"pm-action-row danger",onClick:T,disabled:s,children:[p.jsx("span",{className:"material-icons",children:"delete"}),p.jsx("span",{children:"Remove Avatar"})]})]}),r&&p.jsx("div",{className:"pm-status",children:r}),p.jsx("input",{ref:g,type:"file",accept:"image/*",style:{display:"none"},onChange:E})]})}),p.jsx(gm,{isOpen:c,onClose:()=>h(!1),onSave:A=>{x(A),h(!1)},userId:t?.Id}),p.jsx(ku,{isOpen:u,onClose:()=>f(!1),onSave:S,userId:t?.Id})]})},Ta=({alwaysFilled:n=!1})=>{const{config:e}=Yi(),[t,s]=w.useState(null),[i,r]=w.useState([]),[l,c]=w.useState(!1),[h,u]=w.useState(!1),[f,g]=w.useState(!1),[y,x]=w.useState(!1),[S,E]=w.useState(!1),[T,A]=w.useState(!1),[_,I]=w.useState(!1),[C,N]=w.useState(!1),[D,k]=w.useState(!1),B=Ms(),j=Lx.useRef(null);w.useEffect(()=>{(async()=>{try{const J=await ee.getCurrentUser();if(s(J),J&&e.showNavbarCategories){const re=await ee.getUserViews(J.Id);re&&re.Items&&r(re.Items)}}catch(J){console.error("Navbar fetch error",J)}})()},[e.showNavbarCategories]),w.useEffect(()=>{const H=()=>{c(window.scrollY>50)};return window.addEventListener("scroll",H),()=>window.removeEventListener("scroll",H)},[]),w.useEffect(()=>{const H=J=>{J.target.closest(".nav-avatar-container")||g(!1)};return document.addEventListener("click",H),()=>document.removeEventListener("click",H)},[]),w.useEffect(()=>{(async()=>{try{if(!ee.api)return;const J=ee.api.accessToken,re=ee.api.configuration?.basePath||ee.api.basePath;if(!J||!re)return;const me=`MediaBrowser Client="${ee.jellyfin.clientInfo.name}", Device="${ee.jellyfin.deviceInfo.name}", DeviceId="${ee.jellyfin.deviceInfo.id}", Version="${ee.jellyfin.clientInfo.version}", Token="${J}"`,M=await fetch(`${re}/Plugins`,{headers:{"X-Emby-Authorization":me}});if(M.ok){const F=(await M.json()).some(ae=>ae.Name?.toLowerCase().includes("enhanced")||ae.Name?.toLowerCase().includes("random button"));k(F)}}catch{}})()},[]);const U=t?.Policy?.IsAdministrator,K=async H=>{if(!(!H||!t?.Id)){N(!0);try{await ee.uploadUserImage(t.Id,"Primary",H),I(!1),window.dispatchEvent(new CustomEvent("userUpdated",{detail:t})),window.location.reload()}catch(J){console.error("Avatar upload failed",J),alert("Failed to upload avatar. Please try again.")}finally{N(!1)}}};return p.jsxs(p.Fragment,{children:[p.jsx("nav",{className:`navbar ${l||n?"scrolled":""}`,children:p.jsxs("div",{className:"nav-content",children:[p.jsxs("div",{className:"nav-start",children:[p.jsx($r,{to:"/",className:"nav-logo",children:e.logoUrl?p.jsx("img",{src:e.logoUrl,alt:e.appName}):p.jsx("img",{src:no(e.accentColor),alt:e.appName})}),p.jsxs("div",{className:"nav-links primary-links",children:[p.jsx($r,{to:"/",className:"nav-link",children:"Home"}),e.showNavbarCategories&&i.map(H=>p.jsx("span",{className:"nav-link",onClick:()=>B(`/library/${H.Id}`),children:H.Name},H.Id)),e.jellyseerrUrl&&e.showNavbarRequests!==!1&&p.jsxs(p.Fragment,{children:[p.jsx("span",{className:"nav-divider"}),p.jsx("a",{href:e.jellyseerrUrl,target:"_blank",rel:"noopener noreferrer",className:"nav-link",children:"Requests"})]})]})]}),p.jsx("div",{className:"nav-end",children:p.jsxs("div",{className:"nav-actions",children:[p.jsx("button",{className:"nav-icon-btn",onClick:()=>u(!0),title:"Search",children:p.jsx("span",{className:"material-icons",children:"search"})}),p.jsx("button",{className:"nav-icon-btn",onClick:()=>B("/favorites"),title:"Watchlist",children:p.jsx("span",{className:"material-icons",children:"bookmark_border"})}),D&&p.jsx("button",{className:"nav-icon-btn",onClick:()=>{window.location.href="/web/index.html?classic#!/randomitems"},title:"Random",children:p.jsx("span",{className:"material-icons",children:"shuffle"})}),p.jsxs("div",{className:`nav-avatar-container ${f?"active":""}`,onClick:H=>{H.stopPropagation(),g(!f)},ref:j,children:[t?p.jsxs("div",{className:"nav-avatar-wrapper",children:[p.jsx("img",{src:`${ee.api.basePath}/Users/${t.Id}/Images/Primary?quality=90&${new Date().getTime()}`,alt:t.Name,className:"nav-avatar",onError:H=>{H.target.style.display="none"}}),p.jsx("span",{className:"material-icons avatar-arrow",children:"expand_more"})]}):p.jsxs("div",{className:"nav-avatar-wrapper",children:[p.jsx("span",{className:"material-icons nav-avatar-placeholder",children:"account_circle"}),p.jsx("span",{className:"material-icons avatar-arrow",children:"expand_more"})]}),f&&p.jsxs("div",{className:"nav-dropdown-menu usermenu",children:[t&&p.jsxs("div",{className:"user-menu-header",onClick:()=>{g(!1),A(!0)},children:[p.jsx("div",{className:"header-avatar-container",children:p.jsx("img",{src:`${ee.api.basePath}/Users/${t.Id}/Images/Primary?quality=90&${new Date().getTime()}`,alt:t.Name,className:"menu-avatar",onError:H=>{H.target.style.display="none"}})}),p.jsxs("div",{className:"user-menu-info",children:[p.jsx("span",{className:"user-name",children:t.Name}),p.jsxs("span",{className:"user-status",children:[p.jsx("span",{className:"material-icons",children:U?"shield":"person"}),U?"Administrator":"User"]})]}),p.jsx("span",{className:"material-icons edit-icon",children:"edit"})]}),p.jsx("div",{className:"menu-section-label",children:"General"}),p.jsxs("button",{onClick:()=>{g(!1),u(!0)},children:[p.jsx("span",{className:"material-icons",children:"search"})," Search"]}),p.jsxs("button",{onClick:()=>{g(!1),window.location.href="/web/index.html?classic#!/remotecontrol"},children:[p.jsx("span",{className:"material-icons",children:"cast"})," Cast to Device"]}),p.jsxs("button",{onClick:()=>{g(!1),window.location.href="/web/index.html?classic#!/syncplay"},children:[p.jsx("span",{className:"material-icons",children:"sync"})," SyncPlay"]}),p.jsxs("button",{onClick:()=>{g(!1),window.location.href="/web/index.html?classic#!/playback"},children:[p.jsx("span",{className:"material-icons",children:"play_circle"})," Player"]}),D&&p.jsxs("button",{onClick:()=>{g(!1),window.location.href="/web/index.html?classic#!/randomitems"},children:[p.jsx("span",{className:"material-icons",children:"shuffle"})," Random"]}),U&&p.jsxs(p.Fragment,{children:[p.jsx("div",{className:"dropdown-divider"}),p.jsx("div",{className:"menu-section-label",children:"Administration"}),p.jsxs("button",{onClick:()=>{g(!1),window.location.href="/web/index.html?classic#!/dashboard"},children:[p.jsx("span",{className:"material-icons",children:"dashboard"})," Dashboard"]})]}),p.jsx("div",{className:"dropdown-divider"}),p.jsx("div",{className:"menu-section-label",children:"Preferences"}),p.jsxs("button",{onClick:()=>{g(!1),window.location.href="/web/index.html?#/profile"},children:[p.jsx("span",{className:"material-icons",children:"settings"})," User Settings"]}),p.jsxs("button",{onClick:()=>{g(!1),x(!0)},children:[p.jsx("span",{className:"material-icons",children:"palette"})," Theme Settings"]}),D&&p.jsxs("button",{onClick:()=>{g(!1),window.location.href="/web/index.html#!/configurationpage?name=JellyfinEnhanced"},children:[p.jsx("span",{className:"material-icons",children:"auto_awesome"})," Jellyfin Enhanced"]}),p.jsx("div",{className:"dropdown-divider"}),p.jsx("div",{className:"menu-section-label",children:"Account"}),p.jsxs("button",{onClick:()=>{g(!1),I(!0)},children:[p.jsx("span",{className:"material-icons",children:"face"})," Change Avatar"]}),p.jsxs("button",{onClick:()=>{g(!1),E(!0)},children:[p.jsx("span",{className:"material-icons",children:"qr_code"})," Quick Connect"]}),p.jsxs("button",{onClick:()=>{g(!1),B("/login/select-server")},children:[p.jsx("span",{className:"material-icons",children:"dns"})," Change Server"]}),p.jsxs("button",{onClick:()=>{g(!1),localStorage.removeItem("jellyfin_credentials"),window.location.reload()},children:[p.jsx("span",{className:"material-icons",children:"logout"})," Log Out"]})]})]})]})})]})}),p.jsx(FL,{isOpen:h,onClose:()=>u(!1)}),p.jsx(bS,{isOpen:y,onClose:()=>x(!1),userId:t?.Id}),p.jsx(HL,{isOpen:S,onClose:()=>E(!1)}),p.jsx(zL,{isOpen:T,onClose:()=>A(!1),user:t}),p.jsx(ku,{isOpen:_,onClose:()=>I(!1),onSave:K,userId:t?.Id,uploading:C})]})},KL=()=>{const{config:n}=Yi();return p.jsx("div",{className:"legitflix-footer",children:p.jsxs("div",{className:"footer-content",children:[p.jsx("div",{className:"footer-logo",children:p.jsx("a",{href:"https://github.com/gorillasuti/Legitflix-plugin",target:"_blank",rel:"noopener noreferrer",className:"footer-link",children:p.jsx("img",{className:"footer-logo-img",src:no(n.accentColor),alt:n.appName})})}),p.jsx("div",{className:"footer-divider"}),p.jsxs("div",{className:"footer-author",children:["Created by ",p.jsx("a",{href:"https://github.com/gorillasuti",target:"_blank",rel:"noopener noreferrer",className:"footer-link",children:p.jsx("strong",{children:"gorillasuti"})})]})]})})},av=()=>{const[n,e]=w.useState([]),[t,s]=w.useState([]),[i,r]=w.useState([]),[l,c]=w.useState([]),[h,u]=w.useState(!0),[f,g]=w.useState(null),{config:y}=Yi(),x=Ms();w.useEffect(()=>{(async()=>{u(!0);try{const A=await ee.getCurrentUser();if(A){const _=await ee.getUserViews(A.Id);e(_.Items||[]);const C=(await ee.getResumeItems(A.Id)).Items||[];s(C);const D=((await ee.getHistoryItems(A.Id,12)).Items||[]).filter(U=>!C.some(K=>K.Id===U.Id));r(D);const j=(await(async()=>{const U=y.contentSortMode||"latest",K={latest:{sortBy:"DateCreated",sortOrder:"Descending"},random:{sortBy:"Random",sortOrder:"Descending"},topRated:{sortBy:"CommunityRating",sortOrder:"Descending"}},{sortBy:H,sortOrder:J}=K[U]||K.latest;return ee.getItems(A.Id,{limit:20,recursive:!0,includeItemTypes:y.promoMediaTypes||["Movie","Series"],sortBy:H,sortOrder:J,imageTypeLimit:1,enableImageTypes:["Primary","Backdrop","Thumb","Logo"],fields:["Overview","ProductionYear","ImageTags","OfficialRating","CommunityRating","Genres"]})})()).Items||[];c(j.slice(0,3))}}catch(A){console.error("Failed to fetch data",A)}finally{u(!1)}})()},[y]);const S=T=>{g(T)},E=()=>{g(null)};return p.jsxs("div",{className:"home-page",children:[p.jsx(Ta,{}),p.jsx(PL,{onInfoClick:S}),p.jsx("div",{className:"home-content-container",style:{position:"relative",zIndex:10},children:h?p.jsxs("div",{style:{padding:"0 4.2%",marginTop:"40px"},children:[p.jsx(ze,{width:"180px",height:"24px",style:{marginBottom:"20px"}}),p.jsx("div",{style:{display:"flex",gap:"15px",overflow:"hidden",marginBottom:"50px"},children:[1,2,3,4,5,6].map(T=>p.jsx("div",{style:{flex:"0 0 160px"},children:p.jsx(ze,{width:"100%",height:"240px",style:{borderRadius:"8px"}})},T))}),p.jsx(ze,{width:"220px",height:"24px",style:{marginBottom:"20px"}}),p.jsx("div",{style:{display:"flex",gap:"15px",overflow:"hidden",marginBottom:"50px"},children:[1,2,3,4,5].map(T=>p.jsxs("div",{style:{flex:"0 0 280px"},children:[p.jsx(ze,{width:"100%",height:"157px",style:{borderRadius:"4px",marginBottom:"8px"}}),p.jsx(ze,{width:"70%",height:"14px",style:{marginBottom:"4px"}}),p.jsx(ze,{width:"40%",height:"12px"})]},T))}),p.jsxs("div",{style:{marginBottom:"50px"},children:[p.jsx(ze,{width:"100%",height:"300px",style:{borderRadius:"12px",marginBottom:"15px"}}),p.jsxs("div",{style:{display:"flex",gap:"15px"},children:[p.jsx(ze,{width:"50%",height:"180px",style:{borderRadius:"12px"}}),p.jsx(ze,{width:"50%",height:"180px",style:{borderRadius:"12px"}})]})]}),p.jsx(ze,{width:"180px",height:"24px",style:{marginBottom:"20px"}}),p.jsx("div",{style:{display:"flex",gap:"15px",overflow:"hidden"},children:[1,2,3,4,5].map(T=>p.jsx("div",{style:{flex:"0 0 220px"},children:p.jsx(ze,{width:"100%",height:"330px",style:{borderRadius:"4px"}})},T))})]}):p.jsxs(p.Fragment,{children:[p.jsxs("section",{className:"home-section",style:{paddingLeft:"4%",paddingRight:"4%",marginBottom:"40px"},children:[p.jsx("h2",{className:"section-title",style:{fontSize:"1.4rem",fontWeight:"bold",marginBottom:"15px",color:"#cacaca"},children:"Browse Libraries"}),p.jsxs("div",{className:"libraries-grid",children:[n.map(T=>p.jsxs("div",{className:"library-card",onClick:()=>x(`/library/${T.Id}`),children:[p.jsx("img",{src:`${ee.api.basePath}/Items/${T.Id}/Images/Primary?fillHeight=480&fillWidth=320&quality=90`,alt:T.Name,className:"library-card-image",onError:A=>{A.target.style.display="none",A.target.nextSibling.style.display="flex"}}),p.jsx("div",{className:"library-card-content fallback",style:{display:"none"},children:p.jsx("span",{className:"material-icons library-icon",children:T.CollectionType==="movies"?"movie":T.CollectionType==="tvshows"?"tv":"folder"})}),y.showLibraryTitles&&p.jsx("div",{className:"library-card-overlay",children:p.jsx("span",{className:"library-name",children:T.Name})})]},T.Id)),p.jsx(BL,{})]})]}),t.length>0&&p.jsxs("section",{className:"home-section",style:{paddingLeft:"4%",paddingRight:"4%",marginBottom:"40px"},children:[p.jsx("h2",{className:"section-title",style:{fontSize:"1.4rem",fontWeight:"bold",marginBottom:"15px",color:"#cacaca"},children:"Continue Watching"}),p.jsx("div",{className:"backdrop-scroll-container",children:t.map(T=>{const A=T.UserData?.PlayedPercentage>=100||T.UserData?.Played,_=T.RunTimeTicks&&T.UserData?.PlaybackPositionTicks?T.RunTimeTicks-T.UserData.PlaybackPositionTicks:0,I=_>0?Math.round(_/6e8):0;return p.jsxs("div",{className:"backdrop-card",onClick:()=>window.location.href=`/web/index.html?classic=true#!/playback?id=${T.Id}`,title:`Resume: ${T.Name}`,children:[p.jsxs("div",{className:"backdrop-card-image",children:[p.jsx("img",{src:`${ee.api.basePath}/Items/${T.Id}/Images/Backdrop/0?maxWidth=500&quality=90`,alt:T.Name,onError:C=>{C.target.src=`${ee.api.basePath}/Items/${T.Id}/Images/Primary?maxWidth=500`}}),p.jsx("div",{className:"backdrop-play-overlay",children:p.jsx("span",{className:"material-icons",children:"play_arrow"})}),A?p.jsx("div",{className:"backdrop-badge watched",children:"Watched"}):I>0?p.jsxs("div",{className:"backdrop-badge time-left",children:[I,"m left"]}):null]}),T.UserData&&T.RunTimeTicks>0&&!A&&p.jsx("div",{className:"backdrop-progress-track",children:p.jsx("div",{className:"backdrop-progress-fill",style:{width:`${Math.min(100,T.UserData.PlaybackPositionTicks/T.RunTimeTicks*100)}%`}})}),p.jsxs("div",{className:"backdrop-card-info",children:[p.jsx("span",{className:"backdrop-card-series",children:T.SeriesName||""}),p.jsx("span",{className:"backdrop-card-title",children:T.SeriesName&&T.ParentIndexNumber!=null&&T.IndexNumber!=null?`S${T.ParentIndexNumber} E${T.IndexNumber}  ${T.Name}`:T.Name})]})]},T.Id)})})]}),i.length>0&&p.jsxs("section",{className:"home-section",style:{paddingLeft:"4%",paddingRight:"4%",marginBottom:"40px"},children:[p.jsx("h2",{className:"section-title",style:{fontSize:"1.4rem",fontWeight:"bold",marginBottom:"15px",color:"#cacaca"},children:"History"}),p.jsx("div",{className:"backdrop-scroll-container",children:i.map(T=>p.jsxs("div",{className:"backdrop-card",onClick:()=>x(`/item/${T.Id}`),title:T.Name,children:[p.jsxs("div",{className:"backdrop-card-image",children:[p.jsx("img",{src:`${ee.api.basePath}/Items/${T.Id}/Images/Backdrop/0?maxWidth=500&quality=90`,alt:T.Name,onError:A=>{A.target.src=`${ee.api.basePath}/Items/${T.Id}/Images/Primary?maxWidth=500`}}),p.jsx("div",{className:"backdrop-play-overlay",children:p.jsx("span",{className:"material-icons",children:"info"})})]}),p.jsxs("div",{className:"backdrop-card-info",children:[p.jsx("span",{className:"backdrop-card-series",children:T.SeriesName||""}),p.jsx("span",{className:"backdrop-card-title",children:T.SeriesName&&T.ParentIndexNumber!=null&&T.IndexNumber!=null?`S${T.ParentIndexNumber} E${T.IndexNumber}  ${T.Name}`:T.Name})]})]},T.Id))})]}),l.length>0&&p.jsx("section",{className:"home-section",style:{paddingLeft:"4%",paddingRight:"4%",marginBottom:"50px"},children:p.jsxs("div",{className:"promo2-wrapper",children:[p.jsxs("div",{className:"promo2-hero",onClick:()=>x(`/item/${l[0].Id}`),children:[p.jsx("img",{src:`${ee.api.basePath}/Items/${l[0].Id}/Images/Backdrop/0?maxWidth=1400&quality=90`,className:"promo2-hero-img",alt:l[0].Name}),p.jsx("div",{className:"promo2-hero-gradient"}),p.jsxs("div",{className:"promo2-hero-content",children:[l[0].ImageTags?.Logo?p.jsx("img",{src:`${ee.api.basePath}/Items/${l[0].Id}/Images/Logo/0?maxWidth=350&quality=90`,className:"promo2-hero-logo",alt:l[0].Name}):p.jsx("h2",{className:"promo2-hero-title",children:l[0].Name}),p.jsxs("div",{className:"promo2-meta-line",children:[p.jsx("span",{className:"promo2-badge",children:l[0].OfficialRating||"13+"}),l[0].ProductionYear&&p.jsxs(p.Fragment,{children:[p.jsx("span",{className:"promo2-meta-dot",children:""}),p.jsx("span",{className:"promo2-meta-text",children:l[0].ProductionYear})]}),l[0].Genres&&l[0].Genres.length>0&&p.jsxs(p.Fragment,{children:[p.jsx("span",{className:"promo2-meta-dot",children:""}),p.jsx("span",{className:"promo2-meta-text",children:l[0].Genres.slice(0,3).join(", ")})]}),l[0].CommunityRating&&p.jsxs(p.Fragment,{children:[p.jsx("span",{className:"promo2-meta-dot",children:""}),p.jsxs("span",{className:"promo2-meta-text",children:[" ",l[0].CommunityRating.toFixed(1)]})]})]}),l[0].Overview&&p.jsx("p",{className:"promo2-hero-desc",children:l[0].Overview}),p.jsx(vi,{variant:"ringHover",size:"lg",className:"promo2-btn",onClick:T=>{T.stopPropagation(),x(`/item/${l[0].Id}`)},children:"WATCH NOW"})]})]}),(l[1]||l[2])&&p.jsx("div",{className:"promo2-row",children:l.slice(1,3).map(T=>p.jsxs("div",{className:"promo2-card",onClick:()=>x(`/item/${T.Id}`),children:[p.jsxs("div",{className:"promo2-card-text",children:[T.ImageTags?.Logo?p.jsx("img",{src:`${ee.api.basePath}/Items/${T.Id}/Images/Logo/0?maxWidth=220&quality=90`,className:"promo2-card-logo",alt:T.Name}):p.jsx("h3",{className:"promo2-card-title",children:T.Name}),p.jsxs("div",{className:"promo2-meta-line promo2-meta-line--card",children:[p.jsx("span",{className:"promo2-badge",children:T.OfficialRating||"13+"}),T.ProductionYear&&p.jsxs(p.Fragment,{children:[p.jsx("span",{className:"promo2-meta-dot",children:""}),p.jsx("span",{className:"promo2-meta-text",children:T.ProductionYear})]}),T.Genres&&T.Genres.length>0&&p.jsxs(p.Fragment,{children:[p.jsx("span",{className:"promo2-meta-dot",children:""}),p.jsx("span",{className:"promo2-meta-text",children:T.Genres.slice(0,2).join(", ")})]}),T.CommunityRating&&p.jsxs(p.Fragment,{children:[p.jsx("span",{className:"promo2-meta-dot",children:""}),p.jsxs("span",{className:"promo2-meta-text",children:[" ",T.CommunityRating.toFixed(1)]})]})]}),p.jsx("p",{className:"promo2-card-desc",children:T.Overview}),p.jsx(vi,{variant:"ringHover",className:"promo2-btn",onClick:A=>{A.stopPropagation(),x(`/item/${T.Id}`)},children:"START WATCHING"})]}),p.jsx("div",{className:"promo2-card-img",children:p.jsx("img",{src:`${ee.api.basePath}/Items/${T.Id}/Images/Backdrop/0?maxWidth=500&quality=90`,alt:T.Name,onError:A=>{A.target.src=`${ee.api.basePath}/Items/${T.Id}/Images/Primary?maxWidth=400`}})})]},T.Id))})]})}),n.map(T=>p.jsx(ML,{title:`Latest ${T.Name}`,libraryId:T.Id,onCardClick:A=>x(`/item/${A.Id}`)},T.Id)),p.jsx(KL,{})]})}),p.jsx(jL,{itemId:f,isOpen:!!f,onClose:E})]})};var sf={exports:{}},nf,rv;function YL(){if(rv)return nf;rv=1;var n="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return nf=n,nf}var af,lv;function qL(){if(lv)return af;lv=1;var n=YL();function e(){}function t(){}return t.resetWarningCache=e,af=function(){function s(l,c,h,u,f,g){if(g!==n){var y=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw y.name="Invariant Violation",y}}s.isRequired=s;function i(){return s}var r={array:s,bigint:s,bool:s,func:s,number:s,object:s,string:s,symbol:s,any:s,arrayOf:i,element:s,elementType:s,instanceOf:i,node:s,objectOf:i,oneOf:i,oneOfType:i,shape:i,exact:i,checkPropTypes:t,resetWarningCache:e};return r.PropTypes=r,r},af}var ov;function QL(){return ov||(ov=1,sf.exports=qL()()),sf.exports}var WL=QL();const Et=Rx(WL),cv={popular:[{code:"eng",name:"English"},{code:"spa",name:"Spanish"},{code:"jpn",name:"Japanese"},{code:"hun",name:"Hungarian"}],more:[{code:"ara",name:"Arabic"},{code:"bul",name:"Bulgarian"},{code:"chi",name:"Chinese"},{code:"hrv",name:"Croatian"},{code:"cze",name:"Czech"},{code:"dan",name:"Danish"},{code:"dut",name:"Dutch"},{code:"fin",name:"Finnish"},{code:"fre",name:"French"},{code:"ger",name:"German"},{code:"gre",name:"Greek"},{code:"heb",name:"Hebrew"},{code:"hin",name:"Hindi"},{code:"ind",name:"Indonesian"},{code:"ita",name:"Italian"},{code:"kor",name:"Korean"},{code:"may",name:"Malay"},{code:"nor",name:"Norwegian"},{code:"per",name:"Persian"},{code:"pol",name:"Polish"},{code:"por",name:"Portuguese"},{code:"rum",name:"Romanian"},{code:"rus",name:"Russian"},{code:"srp",name:"Serbian"},{code:"slo",name:"Slovak"},{code:"slv",name:"Slovenian"},{code:"swe",name:"Swedish"},{code:"tha",name:"Thai"},{code:"tur",name:"Turkish"},{code:"ukr",name:"Ukrainian"},{code:"vie",name:"Vietnamese"}]},Du=({isOpen:n,onClose:e,seriesId:t,initialSeasonId:s,initialEpisodeId:i,isMovie:r=!1,onSubtitleDownloaded:l})=>{const[c,h]=w.useState([]),[u,f]=w.useState([]),[g,y]=w.useState(s||""),[x,S]=w.useState(i||""),[E,T]=w.useState([]),[A,_]=w.useState([]),[I,C]=w.useState("eng"),[N,D]=w.useState(!1),[k,B]=w.useState(!1),[j,U]=w.useState(null);w.useEffect(()=>{n&&t&&(r?S(i||t):K())},[n,t,r]),w.useEffect(()=>{g&&H(g)},[g]),w.useEffect(()=>{x&&J()},[x]);const K=async()=>{try{const $=await ee.getCurrentUser(),F=await ee.getSeasons($.Id,t);h(F.Items||[]),!g&&F.Items.length>0&&y(F.Items[0].Id)}catch($){console.error("Failed to load seasons",$)}},H=async $=>{try{const F=await ee.getCurrentUser(),ae=await ee.getEpisodes(F.Id,t,$);f(ae.Items||[]),!x&&ae.Items.length>0?S(ae.Items[0].Id):x&&(ae.Items.find(de=>de.Id===x)||S(ae.Items[0]?ae.Items[0].Id:""))}catch(F){console.error("Failed to load episodes",F)}},J=async()=>{if(x){D(!0),U(null);try{const $=await ee.getCurrentUser(),F=await ee.getMediaStreams($.Id,x);T(F.filter(ae=>ae.Type==="Subtitle"))}catch($){U("Failed to load subtitles."),console.error($)}finally{D(!1)}}},re=async $=>{if(window.confirm("Are you sure you want to delete this subtitle?"))try{await ee.deleteSubtitle(x,$),J()}catch{alert("Failed to delete subtitle")}},me=async $=>{if($.preventDefault(),!!x){B(!0),_([]);try{const F=await ee.searchRemoteSubtitles(x,I);_(F||[])}catch{alert("Search failed")}finally{B(!1)}}},M=async $=>{try{await ee.downloadRemoteSubtitles(x||i,$),alert("Subtitle downloaded!"),J(),l&&l()}catch{alert("Download failed")}};return n?p.jsx("div",{className:"lf-sub-overlay",onClick:e,children:p.jsxs("div",{className:"lf-sub-modal",onClick:$=>$.stopPropagation(),children:[p.jsxs("div",{className:"lf-sub-header",children:[p.jsx("h3",{children:"Subtitles Manager"}),p.jsx("button",{className:"lf-sub-header__close",onClick:e,children:p.jsx("span",{className:"material-icons",children:"close"})})]}),p.jsxs("div",{className:"lf-sub-content",children:[!r&&p.jsxs("div",{className:"lf-sub-selectors",children:[p.jsxs("div",{children:[p.jsx("label",{className:"lf-sub-label",children:"Season"}),p.jsx("select",{className:"lf-sub-select",value:g,onChange:$=>{y($.target.value),S("")},children:c.map($=>p.jsx("option",{value:$.Id,children:$.Name},$.Id))})]}),p.jsxs("div",{children:[p.jsx("label",{className:"lf-sub-label",children:"Episode"}),p.jsx("select",{className:"lf-sub-select",value:x,onChange:$=>S($.target.value),children:u.map($=>p.jsxs("option",{value:$.Id,children:[$.IndexNumber,". ",$.Name]},$.Id))})]})]}),p.jsxs("div",{className:"lf-sub-section",children:[p.jsx("h4",{className:"lf-sub-section-title",children:"Current Subtitles"}),N?p.jsxs("div",{className:"lf-sub-loading",children:[p.jsx("span",{className:"material-icons",children:"sync"}),"Loading"]}):p.jsx("div",{className:"lf-sub-list",children:E.length===0?p.jsx("div",{className:"lf-sub-list__empty",children:"No subtitles found."}):E.map(($,F)=>p.jsxs("div",{className:"lf-sub-list__item",children:[p.jsxs("div",{children:[p.jsx("div",{className:"lf-sub-list__name",children:$.DisplayTitle||$.Language||"Unknown"}),p.jsxs("div",{className:"lf-sub-list__meta",children:[$.IsExternal?"External":"Embedded","  ",$.Codec]})]}),$.IsExternal&&p.jsxs("button",{className:"lf-sub-action-btn lf-sub-action-btn--delete",onClick:()=>re($.Index),children:[p.jsx("span",{className:"material-icons",children:"delete_outline"}),"Delete"]})]},F))})]}),p.jsxs("div",{className:"lf-sub-section",children:[p.jsx("h4",{className:"lf-sub-section-title",children:"Search Subtitles"}),p.jsxs("form",{onSubmit:me,className:"lf-sub-search-row",children:[p.jsxs("select",{className:"lf-sub-select",value:I,onChange:$=>C($.target.value),style:{flex:1},children:[p.jsx("optgroup",{label:"Popular",children:cv.popular.map($=>p.jsx("option",{value:$.code,children:$.name},$.code))}),p.jsx("optgroup",{label:"More Languages",children:cv.more.map($=>p.jsx("option",{value:$.code,children:$.name},$.code))})]}),p.jsxs("button",{type:"submit",disabled:k||!x,className:"lf-sub-action-btn lf-sub-action-btn--search",children:[p.jsx("span",{className:"material-icons",children:"search"}),k?"Searching":"Search"]})]}),A.length>0&&p.jsx("div",{className:"lf-sub-list",children:A.map($=>p.jsxs("div",{className:"lf-sub-list__item",children:[p.jsxs("div",{className:"lf-sub-list__info",children:[p.jsx("div",{className:"lf-sub-list__name",children:$.Name}),p.jsxs("div",{className:"lf-sub-list__meta",children:[$.Format,"  ",$.ProviderName,"  ",$.DownloadCount," DLs"]})]}),p.jsxs("button",{className:"lf-sub-action-btn lf-sub-action-btn--download",onClick:()=>M($.Id),children:[p.jsx("span",{className:"material-icons",children:"download"}),"Download"]})]},$.Id))})]})]})]})}):null};Du.propTypes={isOpen:Et.bool.isRequired,onClose:Et.func.isRequired,seriesId:Et.string,initialSeasonId:Et.string,initialEpisodeId:Et.string,isMovie:Et.bool,onSubtitleDownloaded:Et.func};const XL=()=>{const{id:n}=_u(),e=Ms(),[t,s]=w.useState(null),[i,r]=w.useState([]),[l,c]=w.useState([]),[h,u]=w.useState(null),[f,g]=w.useState([]),[y,x]=w.useState(!0),[S,E]=w.useState(!1),[T,A]=w.useState(!1),[_,I]=w.useState(null),[C,N]=w.useState(!1),[D,k]=w.useState(!1),[B,j]=w.useState(!1),[U,K]=w.useState([]),[H,J]=w.useState(localStorage.getItem("legitflix-audio-pref")||"en"),[re,me]=w.useState(localStorage.getItem("legitflix-sub-pref")||"en"),[M,$]=w.useState(!1),[F,ae]=w.useState("all"),[de,P]=w.useState("default"),[G,te]=w.useState(!1),[fe,ve]=w.useState(!1),[Ae,De]=w.useState(!1),[Ge,Fe]=w.useState(!1),[mt,St]=w.useState(!1),[jt,bt]=w.useState(!1),[ut,zt]=w.useState(null),[Me,Le]=w.useState(!1),[Ue,Ze]=w.useState(!1),ht=w.useRef(null),Oe=w.useRef(null),He=w.useRef(null),pt=w.useRef(null),nt=w.useRef(null),Kt=w.useRef(null),ge=w.useRef(null),Qe=w.useRef(null);w.useEffect(()=>{(async()=>{x(!0);try{const Ce=await ee.getCurrentUser();if(!Ce)return;const Je=await ee.getSeries(Ce.Id,n);if(s(Je),Ze(Je.UserData?.IsFavorite||!1),Je.RemoteTrailers&&Je.RemoteTrailers.length>0){const gt=Je.RemoteTrailers[0].Url.match(/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/);gt&&gt[1]&&zt(gt[1])}const is=await ee.getSeasons(Ce.Id,n);let Ie=null;is.Items&&is.Items.length>0&&(r(is.Items),Ie=is.Items[0].Id);try{const At=await ee.getNextUp(Ce.Id,n);if(At&&At.Items&&At.Items.length>0){const gt=At.Items[0];I(gt),gt.SeasonId&&is.Items.find(Ei=>Ei.Id===gt.SeasonId)&&(Ie=gt.SeasonId)}}catch(At){console.warn("Failed to fetch Next Up for smart season selection",At)}Ie&&u(Ie);const ks=await ee.getSimilarItems(Ce.Id,n);g(ks.Items||[])}catch(Ce){console.error("Failed to load series data",Ce)}finally{x(!1)}})()},[n]);const st=async()=>{if(!(!t||!h))try{const ce=await ee.getCurrentUser(),Ce=await ee.getEpisodes(ce.Id,t.Id,h);c(Ce.Items||[])}catch(ce){console.error("Failed to load episodes",ce)}};w.useEffect(()=>{st()},[h,t]),w.useEffect(()=>{const ce=Ce=>{ht.current&&!ht.current.contains(Ce.target)&&k(!1),Oe.current&&!Oe.current.contains(Ce.target)&&$(!1),He.current&&!He.current.contains(Ce.target)&&te(!1),pt.current&&!pt.current.contains(Ce.target)&&ve(!1)};return document.addEventListener("mousedown",ce),()=>document.removeEventListener("mousedown",ce)},[]);const Zt=()=>{j(!B),K([])},Rs=ce=>{e(`/play/${ce}`)},vs=ce=>{B?U.includes(ce)?K(U.filter(Ce=>Ce!==ce)):K([...U,ce]):Rs(ce)},bi=async ce=>{if(!(U.length===0||T)){A(!0),c(Ce=>Ce.map(Je=>U.includes(Je.Id)?{...Je,UserData:{...Je.UserData||{},Played:ce}}:Je));try{const Ce=await ee.getCurrentUser();if(!Ce)throw new Error("No user");await Promise.all(U.map(Je=>ee.markPlayed(Ce.Id,Je,ce))),await st()}catch(Ce){console.error("Failed to mark episodes",Ce),await st()}finally{A(!1),K([])}}},js=()=>{const ce=l.map(Je=>Je.Id),Ce=ce.every(Je=>U.includes(Je));K(Ce?[]:ce)},Bt=(ce,Ce)=>{ce==="audio"?(J(Ce),localStorage.setItem("legitflix-audio-pref",Ce)):(me(Ce),localStorage.setItem("legitflix-sub-pref",Ce)),$(!1)},cs=async()=>{try{const ce=await ee.getCurrentUser(),Ce=!Ue;await ee.markFavorite(ce.Id,t.Id,Ce),Ze(Ce)}catch(ce){console.error("Favorite toggle failed",ce)}},wt=()=>{const ce=!Me;Le(ce);const Ce=ce?"mute":"unMute";Qe.current?.contentWindow?.postMessage(JSON.stringify({event:"command",func:Ce,args:[]}),"*")},ii=()=>{Kt.current&&clearTimeout(Kt.current),Kt.current=setTimeout(()=>{Ae&&Fe(!0)},5e3)},Ti=()=>{Fe(!1),Ae&&ii()},Ls=()=>{if(Ae){ws();return}De(!0),Fe(!1),ii();let ce=!1;const Ce=Je=>{typeof Je.data=="string"&&(Je.data.includes('"event"')||Je.data.includes('"id"'))&&(ce=!0,nt.current&&clearTimeout(nt.current))};window.addEventListener("message",Ce),window.lfMessageHandler=Ce,nt.current=setTimeout(()=>{!ce&&Ae&&(console.log("Possible block detected: No YT API message received."),St(!0))},4e3)},ws=()=>{De(!1),Fe(!1),St(!1),bt(!1),Le(!1),Kt.current&&(clearTimeout(Kt.current),Kt.current=null),nt.current&&(clearTimeout(nt.current),nt.current=null),window.lfMessageHandler&&(window.removeEventListener("message",window.lfMessageHandler),delete window.lfMessageHandler)},Cs=ce=>{B||(ge.current=setTimeout(()=>{j(!0),K([ce]),navigator.vibrate&&navigator.vibrate(50)},600))},ni=()=>{ge.current&&clearTimeout(ge.current)},Ns=U.length===0?{label:"Mark Watched",icon:"visibility"}:U.every(Ce=>l.find(is=>is.Id===Ce)?.UserData?.Played)?{label:"Mark Unwatched",icon:"visibility_off",isPlayed:!1}:{label:"Mark Watched",icon:"visibility",isPlayed:!0},Gs=w.useMemo(()=>{let ce=[...l];return F==="unwatched"?ce=ce.filter(Ce=>!Ce.UserData?.Played):F==="watched"&&(ce=ce.filter(Ce=>Ce.UserData?.Played)),de==="newest"?ce.sort((Ce,Je)=>(Je.IndexNumber||0)-(Ce.IndexNumber||0)):de==="oldest"&&ce.sort((Ce,Je)=>(Ce.IndexNumber||0)-(Je.IndexNumber||0)),ce},[l,F,de]);if(w.useEffect(()=>()=>{Kt.current&&clearTimeout(Kt.current),nt.current&&clearTimeout(nt.current),window.lfMessageHandler&&window.removeEventListener("message",window.lfMessageHandler)},[]),y)return p.jsxs("div",{className:"lf-series-container",children:[p.jsx(Ta,{alwaysFilled:!0}),p.jsxs("section",{className:"lf-series-hero",children:[p.jsx("div",{className:"lf-series-hero__backdrop",style:{background:"#141414"}}),p.jsxs("div",{className:"lf-series-hero__content",children:[p.jsx("div",{className:"lf-series-hero__poster",children:p.jsx(ze,{type:"rect",width:"100%",height:"100%",style:{aspectRatio:"2/3",borderRadius:"8px"}})}),p.jsxs("div",{className:"lf-series-hero__info",children:[p.jsx("h1",{className:"lf-series-hero__title",style:{marginBottom:"1rem"},children:p.jsx(ze,{type:"text",width:"60%",height:"3rem"})}),p.jsxs("div",{className:"lf-series-hero__meta",style:{display:"flex",gap:"1rem",marginBottom:"1.5rem"},children:[p.jsx(ze,{type:"text",width:"60px"}),p.jsx(ze,{type:"text",width:"40px"}),p.jsx(ze,{type:"text",width:"80px"})]}),p.jsxs("div",{className:"lf-series-hero__details",children:[p.jsxs("div",{className:"lf-series-hero__description",children:[p.jsx(ze,{type:"text",width:"100%"}),p.jsx(ze,{type:"text",width:"95%"}),p.jsx(ze,{type:"text",width:"90%"})]}),p.jsxs("div",{className:"lf-series-hero__cast-info",style:{marginTop:"1rem"},children:[p.jsx(ze,{type:"text",width:"80%"}),p.jsx(ze,{type:"text",width:"70%"})]})]}),p.jsxs("div",{className:"lf-series-hero__actions",style:{marginTop:"2rem",display:"flex",gap:"1rem"},children:[p.jsx(ze,{type:"rect",width:"180px",height:"48px",style:{borderRadius:"24px"}}),p.jsx(ze,{type:"rect",width:"160px",height:"48px",style:{borderRadius:"24px"}})]})]})]})]})]});if(!t)return p.jsx("div",{className:"lf-series-container",style:{color:"white"},children:"Series not found"});const ai=ee.getImageUrl(t,"Backdrop"),Qi=ee.getImageUrl(t,"Primary"),Jt=ee.getImageUrl(t,"Logo"),us=t.People?t.People.slice(0,10):[],Os=i.find(ce=>ce.Id===h),Fs=[{code:"en",name:"English"},{code:"ja",name:"Japanese"}],Bi=[{code:"en",name:"English"},{code:"es",name:"Spanish"},{code:"hu",name:"Hungarian"}];return p.jsxs("div",{className:"lf-series-container",children:[p.jsx(Ta,{alwaysFilled:!0}),p.jsxs("section",{className:`lf-series-hero ${Ge?"is-clean-view":""}`,onMouseMove:Ti,onClick:Ti,children:[p.jsx("div",{className:`lf-series-hero__backdrop ${Ae?"is-hidden":""}`,style:{backgroundImage:`url('${ai}')`}}),p.jsx("div",{className:`lf-series-hero__trailer ${Ae?"is-playing":""}`,children:Ae&&ut&&p.jsx("iframe",{ref:Qe,src:`https://www.youtube.com/embed/${ut}?autoplay=1&mute=0&loop=1&modestbranding=1&rel=0&iv_load_policy=3&fs=0&color=white&controls=0&disablekb=1&playlist=${ut}&enablejsapi=1&origin=${window.location.origin}&widget_referrer=${window.location.origin}`,frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",referrerPolicy:"strict-origin-when-cross-origin",allowFullScreen:!0,title:"Trailer"})}),Ae&&p.jsxs("button",{className:"lf-trailer-help-btn",onClick:ce=>{ce.stopPropagation(),bt(!0)},children:[p.jsx("span",{className:"material-icons",children:"help_outline"}),p.jsx("span",{children:"Trouble playing?"})]}),Jt&&p.jsx("img",{className:"lf-series-hero__logo",src:Jt,alt:t.Name}),p.jsxs("div",{className:"lf-series-hero__content",children:[p.jsx("img",{className:"lf-series-hero__poster",src:Qi,alt:t.Name}),p.jsxs("div",{className:"lf-series-hero__info",children:[p.jsx("h1",{className:"lf-series-hero__title",children:t.Name}),p.jsxs("div",{className:"lf-series-hero__meta",children:[p.jsx("span",{children:t.ProductionYear}),p.jsx("span",{children:""}),p.jsx("span",{children:t.OfficialRating}),p.jsx("span",{children:""}),p.jsxs("div",{className:"lf-series-hero__rating",children:[p.jsx("span",{className:"material-icons",children:"star"}),p.jsx("span",{children:t.CommunityRating?t.CommunityRating.toFixed(1):""})]})]}),p.jsxs("div",{className:"lf-series-hero__details",children:[p.jsxs("div",{className:"lf-series-hero__description",children:[p.jsx("p",{className:`lf-series-hero__description-text ${C?"is-expanded":""}`,children:t.Overview}),t.Overview&&t.Overview.length>200&&p.jsxs("button",{className:`lf-series-hero__load-more ${C?"is-expanded":""}`,onClick:()=>N(!C),children:[C?"Show Less":"Read More",p.jsx("span",{className:"material-icons",children:"expand_more"})]})]}),us.length>0&&p.jsxs("div",{className:"lf-series-hero__cast-info",children:[p.jsxs("div",{style:{marginBottom:8},children:[p.jsx("strong",{children:"Starring: "}),us.slice(0,3).map(ce=>ce.Name).join(", "),us.length>3&&p.jsx("span",{children:"..."})]}),p.jsxs("div",{children:[p.jsx("strong",{children:"Genres: "}),t.Genres?t.Genres.join(", "):""]})]})]}),p.jsxs("div",{className:"lf-series-hero__actions",children:[p.jsxs("button",{className:"lf-btn lf-btn--primary lf-btn--ring-hover",onClick:()=>{_?Rs(_.Id):l.length>0&&Rs(l[0].Id)},children:[p.jsx("span",{className:"material-icons",children:"play_arrow"}),_?_.UserData?.PlaybackPositionTicks>0?`Resume S${_.ParentIndexNumber} E${_.IndexNumber}`:`Continue S${_.ParentIndexNumber} E${_.IndexNumber}`:"Start Watching"]}),p.jsxs("button",{className:"lf-btn lf-btn--glass lf-btn--ring-hover-secondary",onClick:Ls,style:ut?{}:{opacity:.5,pointerEvents:"none"},children:[p.jsx("span",{className:"material-icons",children:Ae?"stop_circle":"theaters"}),Ae?"Stop Trailer":"Watch Trailer"]}),Ae&&p.jsx("button",{className:`lf-btn lf-btn--glass lf-btn--icon-only ${Me?"is-muted":""}`,onClick:wt,title:Me?"Unmute":"Mute",children:p.jsx("span",{className:"material-icons",children:Me?"volume_off":"volume_up"})}),p.jsx("button",{className:`lf-btn lf-btn--glass lf-btn--icon-only ${Ue?"is-active":""}`,onClick:cs,title:"Add to List",children:p.jsx("span",{className:"material-icons",children:Ue?"bookmark":"bookmark_border"})}),p.jsx("button",{className:"lf-btn lf-btn--glass lf-btn--icon-only",onClick:()=>E(!0),title:"Edit Subtitles",children:p.jsx("span",{className:"material-icons",children:"subtitles"})})]})]})]})]}),p.jsx("hr",{className:"lf-section-divider"}),p.jsxs("div",{className:"lf-content-section",children:[p.jsxs("div",{className:"lf-episodes-header",children:[p.jsxs("div",{className:`lf-season-selector ${D?"is-open":""}`,ref:ht,children:[p.jsxs("div",{className:"lf-season-selector__button",onClick:()=>k(!D),children:[p.jsx("span",{children:Os?Os.Name:"Select Season"}),p.jsx("span",{className:"material-icons",children:"expand_more"})]}),p.jsx("div",{className:"lf-season-selector__dropdown",children:i.map(ce=>p.jsx("div",{className:`lf-season-selector__option ${h===ce.Id?"is-selected":""}`,onClick:()=>{u(ce.Id),k(!1)},children:p.jsx("span",{children:ce.Name})},ce.Id))})]}),p.jsxs("div",{className:"lf-filter-controls",children:[p.jsxs("div",{className:`lf-filter-dropdown ${M?"is-open":""}`,ref:Oe,children:[p.jsxs("button",{className:"lf-filter-btn",onClick:()=>$(!M),title:"Audio & Subtitles",children:[p.jsx("span",{className:"material-icons",children:"subtitles"}),p.jsx("span",{children:"Audio & Subs"}),p.jsx("span",{className:"material-icons",children:"expand_more"})]}),p.jsxs("div",{className:"lf-filter-dropdown__menu lf-lang-menu",children:[p.jsxs("div",{className:"lf-lang-section",children:[p.jsx("div",{className:"lf-dropdown-section-title",children:"Audio"}),Fs.map(ce=>p.jsxs("div",{className:`lf-filter-dropdown__option ${H===ce.code?"is-selected":""}`,onClick:()=>Bt("audio",ce.code),children:[p.jsx("span",{children:ce.name}),H===ce.code&&p.jsx("span",{className:"material-icons",children:"check"})]},ce.code))]}),p.jsx("div",{className:"lf-lang-separator"}),p.jsxs("div",{className:"lf-lang-section",children:[p.jsx("div",{className:"lf-dropdown-section-title",children:"Subtitles"}),Bi.map(ce=>p.jsxs("div",{className:`lf-filter-dropdown__option ${re===ce.code?"is-selected":""}`,onClick:()=>Bt("sub",ce.code),children:[p.jsx("span",{children:ce.name}),re===ce.code&&p.jsx("span",{className:"material-icons",children:"check"})]},ce.code))]}),p.jsx("div",{className:"lf-lang-footer",children:p.jsxs("button",{className:"lf-edit-subs-btn",onClick:()=>{$(!1),E(!0)},children:[p.jsx("span",{className:"material-icons",children:"edit"}),p.jsx("span",{children:"Edit Subtitles"})]})})]})]}),B?p.jsxs(p.Fragment,{children:[p.jsxs("button",{className:"lf-edit-subs-btn",style:{width:"auto",padding:"8px 16px",opacity:T?.6:1},onClick:()=>bi(Ns.isPlayed),disabled:T||U.length===0,children:[p.jsx("span",{className:"material-icons",style:T?{animation:"lf-spin 1s linear infinite"}:{},children:T?"sync":Ns.icon}),p.jsx("span",{children:T?"Updating":Ns.label})]}),p.jsxs("button",{className:"lf-filter-btn",onClick:js,children:[p.jsx("span",{className:"material-icons",children:"select_all"}),p.jsx("span",{children:l.length>0&&l.every(ce=>U.includes(ce.Id))?"Deselect All":"Select All"})]}),p.jsxs("button",{className:"lf-filter-btn is-active",onClick:Zt,title:"Cancel",children:[p.jsx("span",{className:"material-icons",children:"close"}),p.jsx("span",{children:"Cancel"})]})]}):p.jsxs(p.Fragment,{children:[p.jsxs("div",{className:`lf-filter-dropdown ${G?"is-open":""}`,ref:He,children:[p.jsxs("button",{className:`lf-filter-btn ${F!=="all"?"is-active":""}`,onClick:()=>te(!G),title:"Filter episodes",children:[p.jsx("span",{className:"material-icons",children:"filter_list"}),p.jsx("span",{children:F==="all"?"Filter":F==="unwatched"?"Unwatched":"Watched"}),p.jsx("span",{className:"material-icons",children:"expand_more"})]}),p.jsx("div",{className:"lf-filter-dropdown__menu",children:[{key:"all",label:"All"},{key:"unwatched",label:"Unwatched"},{key:"watched",label:"Watched"}].map(ce=>p.jsxs("div",{className:`lf-filter-dropdown__option ${F===ce.key?"is-selected":""}`,onClick:()=>{ae(ce.key),te(!1)},children:[p.jsx("span",{children:ce.label}),F===ce.key&&p.jsx("span",{className:"material-icons",children:"check"})]},ce.key))})]}),p.jsxs("div",{className:`lf-filter-dropdown ${fe?"is-open":""}`,ref:pt,children:[p.jsxs("button",{className:`lf-filter-btn ${de!=="default"?"is-active":""}`,onClick:()=>ve(!fe),title:"Sort episodes",children:[p.jsx("span",{className:"material-icons",children:"sort"}),p.jsx("span",{children:de==="default"?"Sort":de==="newest"?"Newest":"Oldest"}),p.jsx("span",{className:"material-icons",children:"expand_more"})]}),p.jsx("div",{className:"lf-filter-dropdown__menu",children:[{key:"default",label:"Default"},{key:"newest",label:"Newest First"},{key:"oldest",label:"Oldest First"}].map(ce=>p.jsxs("div",{className:`lf-filter-dropdown__option ${de===ce.key?"is-selected":""}`,onClick:()=>{P(ce.key),ve(!1)},children:[p.jsx("span",{children:ce.label}),de===ce.key&&p.jsx("span",{className:"material-icons",children:"check"})]},ce.key))})]}),p.jsxs("button",{className:"lf-filter-btn",onClick:Zt,title:"Bulk Edit",children:[p.jsx("span",{className:"material-icons",children:"done_all"}),p.jsx("span",{children:"Select Item"})]})]})]})]}),p.jsx("div",{className:"lf-episode-grid",children:Gs.map(ce=>{const Ce=U.includes(ce.Id),Je=ce.UserData?.Played;return p.jsxs("div",{className:`lf-episode-card ${B?"is-selecting-mode":""} ${Ce?"is-selected":""} ${Je?"is-watched":""}`,onClick:()=>vs(ce.Id),onPointerDown:()=>Cs(ce.Id),onPointerUp:ni,onPointerLeave:ni,children:[p.jsxs("div",{className:"lf-episode-card__thumbnail",children:[p.jsx("img",{src:ee.getImageUrl(ce,"Primary"),alt:ce.Name,loading:"lazy"}),ce.IndexNumber&&p.jsx("span",{className:"lf-episode-card__badge",children:ce.IndexNumber}),p.jsx("div",{className:"lf-episode-card__play-icon",children:p.jsx("span",{className:"material-icons",children:"play_arrow"})}),p.jsx("div",{className:"lf-episode-checkbox",children:p.jsx("span",{className:"material-icons",children:"check"})}),Je&&!B&&p.jsx("div",{className:"lf-episode-checkbox",style:{opacity:1,background:"#4caf50",borderColor:"#4caf50"},children:p.jsx("span",{className:"material-icons",style:{opacity:1,transform:"scale(1)"},children:"check"})})]}),p.jsxs("div",{className:"lf-episode-card__info",children:[p.jsx("h3",{className:"lf-episode-card__title",children:ce.Name}),p.jsx("p",{className:"lf-episode-card__subtitle",children:ce.Overview})]})]},ce.Id)})})]}),p.jsx("hr",{className:"lf-section-divider"}),us.length>0&&p.jsxs("div",{className:"lf-content-section",children:[p.jsx("h2",{className:"lf-section-title",children:"Cast & Crew"}),p.jsx("div",{className:"lf-cast-grid",children:us.map(ce=>p.jsxs("div",{className:"lf-cast-card",children:[p.jsx("img",{src:ee.getImageUrl(ce,"Primary")||"https://via.placeholder.com/80x80?text=?",alt:ce.Name,className:"lf-cast-card__image",onError:Ce=>{Ce.target.src="https://via.placeholder.com/80x80?text=?"}}),p.jsx("div",{className:"lf-cast-card__name",children:ce.Name}),p.jsx("div",{className:"lf-cast-card__role",children:ce.Role})]},ce.Id||ce.Name))})]}),p.jsx("hr",{className:"lf-section-divider"}),f.length>0&&p.jsxs("div",{className:"lf-content-section",style:{marginBottom:40},children:[p.jsx("h2",{className:"lf-section-title",children:"More Like This"}),p.jsx("div",{className:"lf-similar-grid",children:f.map(ce=>p.jsxs($r,{to:`/series/${ce.Id}`,className:"lf-similar-card",children:[p.jsx("img",{className:"lf-similar-card__poster",src:ee.getImageUrl(ce,"Primary"),alt:ce.Name,loading:"lazy"}),p.jsx("div",{className:"lf-similar-card__title",children:ce.Name})]},ce.Id))})]}),p.jsx(Du,{isOpen:S,onClose:()=>E(!1),seriesId:t?t.Id:"",initialSeasonId:h,initialEpisodeId:l.length>0?l[0].Id:""}),jt&&p.jsx("div",{className:"lf-blocked-modal-overlay",onClick:()=>{bt(!1),ws()},children:p.jsxs("div",{className:"lf-blocked-modal",onClick:ce=>ce.stopPropagation(),children:[p.jsx("button",{className:"lf-blocked-modal__close",onClick:()=>{bt(!1),ws()},children:p.jsx("span",{className:"material-icons",children:"close"})}),p.jsx("span",{className:"material-icons lf-blocked-icon",children:"error_outline"}),p.jsx("h3",{children:"Playback issue"}),p.jsx("p",{children:"The trailer can't play  your browser's tracking protection or ad blocker is likely blocking the YouTube embed."}),p.jsx("button",{className:"lf-btn lf-btn--glass",onClick:()=>{bt(!1),ws()},children:"Got it"})]})})]})},ZL=()=>{const{id:n}=_u(),e=Ms(),[t,s]=w.useState(null),[i,r]=w.useState([]),[l,c]=w.useState(!0),[h,u]=w.useState(!1),[f,g]=w.useState(!1),[y,x]=w.useState(localStorage.getItem("legitflix-audio-pref")||"en"),[S,E]=w.useState(localStorage.getItem("legitflix-sub-pref")||"en"),[T,A]=w.useState(!1),[_,I]=w.useState(!1),[C,N]=w.useState(!1),[D,k]=w.useState(!1),[B,j]=w.useState(!1),[U,K]=w.useState(!1),[H,J]=w.useState(null),[re,me]=w.useState(!1),[M,$]=w.useState(!1);w.useRef(null);const F=w.useRef(null),ae=w.useRef(null),de=w.useRef(null),P=w.useRef(null);w.useEffect(()=>{(async()=>{c(!0);try{const Ue=await ee.getCurrentUser();if(!Ue)return;const Ze=await ee.getItemDetails(Ue.Id,n);if(s(Ze),me(Ze.UserData?.IsFavorite||!1),$(Ze.UserData?.Played||!1),Ze.RemoteTrailers&&Ze.RemoteTrailers.length>0){const He=Ze.RemoteTrailers[0].Url.match(/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/);He&&He[1]&&J(He[1])}const ht=await ee.getSimilarItems(Ue.Id,n);r(ht.Items||[])}catch(Ue){console.error("Failed to load movie data",Ue)}finally{c(!1)}})()},[n]),w.useEffect(()=>{const Le=Ue=>{F.current&&!F.current.contains(Ue.target)&&A(!1)};return document.addEventListener("mousedown",Le),()=>document.removeEventListener("mousedown",Le)},[]);const G=(Le,Ue)=>{Le==="audio"?(x(Ue),localStorage.setItem("legitflix-audio-pref",Ue)):(E(Ue),localStorage.setItem("legitflix-sub-pref",Ue)),A(!1)},te=async()=>{try{const Le=await ee.getCurrentUser(),Ue=!re;await ee.markFavorite(Le.Id,t.Id,Ue),me(Ue)}catch(Le){console.error("Favorite toggle failed",Le)}},fe=async()=>{try{const Le=await ee.getCurrentUser(),Ue=!M;await ee.markPlayed(Le.Id,t.Id,Ue),$(Ue),s(Ze=>({...Ze,UserData:{...Ze.UserData,Played:Ue}}))}catch(Le){console.error("Played toggle failed",Le)}},ve=()=>{const Le=!C;N(Le);const Ue=Le?"mute":"unMute";P.current?.contentWindow?.postMessage(JSON.stringify({event:"command",func:Ue,args:[]}),"*")},Ae=()=>{de.current&&clearTimeout(de.current),de.current=setTimeout(()=>{_&&k(!0)},5e3)},De=()=>{k(!1),_&&Ae()},Ge=()=>{if(_){Fe();return}I(!0),k(!1),Ae();let Le=!1;const Ue=Ze=>{typeof Ze.data=="string"&&(Ze.data.includes('"event"')||Ze.data.includes('"id"'))&&(Le=!0,ae.current&&clearTimeout(ae.current))};window.addEventListener("message",Ue),window.lfMessageHandler=Ue,ae.current=setTimeout(()=>{!Le&&_&&(console.log("Possible block detected: No YT API message received."),j(!0))},4e3)},Fe=()=>{I(!1),k(!1),j(!1),K(!1),N(!1),de.current&&clearTimeout(de.current),ae.current&&clearTimeout(ae.current),window.lfMessageHandler&&(window.removeEventListener("message",window.lfMessageHandler),delete window.lfMessageHandler)};if(w.useEffect(()=>()=>{de.current&&clearTimeout(de.current),ae.current&&clearTimeout(ae.current),window.lfMessageHandler&&window.removeEventListener("message",window.lfMessageHandler)},[]),l)return p.jsx("div",{className:"lf-movie-container",style:{color:"white"},children:"Loading..."});if(!t)return p.jsx("div",{className:"lf-movie-container",style:{color:"white"},children:"Movie not found"});const mt=ee.getImageUrl(t,"Backdrop"),St=ee.getImageUrl(t,"Primary"),jt=ee.getImageUrl(t,"Logo"),bt=t.People?t.People.slice(0,10):[],ut=[{code:"en",name:"English"},{code:"ja",name:"Japanese"}],zt=[{code:"en",name:"English"},{code:"es",name:"Spanish"},{code:"hu",name:"Hungarian"}],Me=Le=>{if(!Le)return"";const Ue=Math.floor(Le/6e8),Ze=Math.floor(Ue/60),ht=Ue%60;return Ze>0?`${Ze}h ${ht}m`:`${Ue}m`};return p.jsxs("div",{className:"lf-movie-container",children:[p.jsx(Ta,{alwaysFilled:!0}),p.jsxs("section",{className:`lf-movie-hero ${D?"is-clean-view":""}`,onMouseMove:De,onClick:De,children:[p.jsx("div",{className:`lf-movie-hero__backdrop ${_?"is-hidden":""}`,style:{backgroundImage:`url('${mt}')`}}),p.jsxs("div",{className:`lf-movie-hero__trailer ${_?"is-playing":""}`,children:[_&&H&&p.jsx("iframe",{ref:P,src:`https://www.youtube.com/embed/${H}?autoplay=1&mute=0&loop=1&modestbranding=1&rel=0&iv_load_policy=3&fs=0&color=white&controls=0&disablekb=1&playlist=${H}&enablejsapi=1&origin=${window.location.origin}&widget_referrer=${window.location.origin}`,frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",referrerPolicy:"strict-origin-when-cross-origin",allowFullScreen:!0,title:"Trailer"}),_&&p.jsxs("button",{className:"lf-trailer-help-btn",onClick:Le=>{Le.stopPropagation(),K(!0)},children:[p.jsx("span",{className:"material-icons",children:"help_outline"}),p.jsx("span",{children:"Trouble playing?"})]})]}),jt&&p.jsx("img",{className:"lf-movie-hero__logo",src:jt,alt:t.Name}),p.jsxs("div",{className:"lf-movie-hero__content",children:[p.jsx("img",{className:"lf-movie-hero__poster",src:St,alt:t.Name}),p.jsxs("div",{className:"lf-movie-hero__info",children:[p.jsx("h1",{className:"lf-movie-hero__title",children:t.Name}),p.jsxs("div",{className:"lf-movie-hero__meta",children:[p.jsx("span",{children:t.ProductionYear}),p.jsx("span",{children:""}),p.jsx("span",{children:t.OfficialRating}),p.jsx("span",{children:""}),p.jsx("span",{children:Me(t.RunTimeTicks)}),p.jsx("span",{children:""}),p.jsxs("div",{className:"lf-movie-hero__rating",children:[p.jsx("span",{className:"material-icons",children:"star"}),p.jsx("span",{children:t.CommunityRating?t.CommunityRating.toFixed(1):""})]})]}),p.jsxs("div",{className:"lf-movie-hero__details",children:[p.jsxs("div",{className:"lf-movie-hero__description",children:[p.jsx("p",{className:`lf-movie-hero__description-text ${f?"is-expanded":""}`,children:t.Overview}),t.Overview&&t.Overview.length>200&&p.jsxs("button",{className:`lf-movie-hero__load-more ${f?"is-expanded":""}`,onClick:()=>g(!f),children:[f?"Show Less":"Read More",p.jsx("span",{className:"material-icons",children:"expand_more"})]})]}),bt.length>0&&p.jsxs("div",{className:"lf-movie-hero__cast-info",children:[p.jsxs("div",{style:{marginBottom:8},children:[p.jsx("strong",{children:"Starring: "}),bt.slice(0,3).map(Le=>Le.Name).join(", "),bt.length>3&&p.jsx("span",{children:"..."})]}),p.jsxs("div",{children:[p.jsx("strong",{children:"Genres: "}),t.Genres?t.Genres.join(", "):""]})]})]}),p.jsxs("div",{className:"lf-movie-hero__actions",children:[p.jsxs("button",{className:"lf-btn lf-btn--primary lf-btn--ring-hover",onClick:()=>e(`/play/${t.Id}`),children:[p.jsx("span",{className:"material-icons",children:"play_arrow"}),"Start Watching"]}),p.jsxs("button",{className:"lf-btn lf-btn--glass lf-btn--ring-hover-secondary",onClick:Ge,style:H?{}:{opacity:.5,pointerEvents:"none"},children:[p.jsx("span",{className:"material-icons",children:_?"stop_circle":"theaters"}),_?"Stop Trailer":"Watch Trailer"]}),_&&p.jsx("button",{className:`lf-btn lf-btn--glass lf-btn--icon-only ${C?"is-muted":""}`,onClick:ve,title:C?"Unmute":"Mute",children:p.jsx("span",{className:"material-icons",children:C?"volume_off":"volume_up"})}),p.jsx("button",{className:`lf-btn lf-btn--glass lf-btn--icon-only ${re?"is-active":""}`,onClick:te,title:"Add to List",children:p.jsx("span",{className:"material-icons",children:re?"bookmark":"bookmark_border"})}),p.jsx("button",{className:"lf-btn lf-btn--glass lf-btn--icon-only",onClick:()=>u(!0),title:"Edit Subtitles",children:p.jsx("span",{className:"material-icons",children:"subtitles"})})]})]})]})]}),p.jsx("hr",{className:"lf-section-divider"}),p.jsxs("div",{className:"lf-content-section",id:"lfDirectPlayer",children:[p.jsxs("div",{className:"lf-section-header",children:[p.jsx("h2",{className:"lf-section-title",children:t.Name}),p.jsxs("div",{className:"lf-filter-controls",children:[p.jsxs("div",{className:`lf-filter-dropdown ${T?"is-open":""}`,ref:F,children:[p.jsxs("button",{className:"lf-filter-btn",onClick:()=>A(!T),title:"Audio & Subtitles",children:[p.jsx("span",{className:"material-icons",children:"subtitles"}),p.jsx("span",{children:"Audio & Subs"}),p.jsx("span",{className:"material-icons",children:"expand_more"})]}),p.jsxs("div",{className:"lf-filter-dropdown__menu lf-lang-menu",children:[p.jsxs("div",{className:"lf-lang-section",children:[p.jsx("div",{className:"lf-dropdown-section-title",children:"Audio"}),ut.map(Le=>p.jsxs("div",{className:`lf-filter-dropdown__option ${y===Le.code?"is-selected":""}`,onClick:()=>G("audio",Le.code),children:[p.jsx("span",{children:Le.name}),y===Le.code&&p.jsx("span",{className:"material-icons",children:"check"})]},Le.code))]}),p.jsx("div",{className:"lf-lang-separator"}),p.jsxs("div",{className:"lf-lang-section",children:[p.jsx("div",{className:"lf-dropdown-section-title",children:"Subtitles"}),zt.map(Le=>p.jsxs("div",{className:`lf-filter-dropdown__option ${S===Le.code?"is-selected":""}`,onClick:()=>G("sub",Le.code),children:[p.jsx("span",{children:Le.name}),S===Le.code&&p.jsx("span",{className:"material-icons",children:"check"})]},Le.code))]}),p.jsx("div",{className:"lf-lang-footer",children:p.jsxs("button",{className:"lf-edit-subs-btn",onClick:()=>{A(!1),u(!0)},children:[p.jsx("span",{className:"material-icons",children:"edit"}),p.jsx("span",{children:"Edit Subtitles"})]})})]})]}),p.jsxs("button",{className:"lf-filter-btn",onClick:fe,title:M?"Mark as Unwatched":"Mark as Watched",children:[p.jsx("span",{className:"material-icons",children:M?"visibility_off":"visibility"}),p.jsx("span",{children:M?"Mark Unwatched":"Mark Watched"})]})]})]}),p.jsx("div",{className:"lf-movie-player-main",children:p.jsxs("div",{className:"lf-movie-player-placeholder",children:[p.jsx("span",{className:"material-icons",style:{fontSize:"64px",opacity:.5},children:"play_circle_outline"}),p.jsx("p",{style:{marginTop:"10px",fontWeight:500},children:"Click 'Start Watching' to play movie"})]})})]}),p.jsx("hr",{className:"lf-section-divider"}),bt.length>0&&p.jsxs("div",{className:"lf-content-section",children:[p.jsx("h2",{className:"lf-section-title",children:"Cast & Crew"}),p.jsx("div",{className:"lf-cast-grid",children:bt.map(Le=>p.jsxs("div",{className:"lf-cast-card",children:[p.jsx("img",{src:ee.getImageUrl(Le,"Primary")||"https://via.placeholder.com/80x80?text=?",alt:Le.Name,className:"lf-cast-card__image",onError:Ue=>{Ue.target.src="https://via.placeholder.com/80x80?text=?"}}),p.jsx("div",{className:"lf-cast-card__name",children:Le.Name}),p.jsx("div",{className:"lf-cast-card__role",children:Le.Role})]},Le.Id||Le.Name))})]}),p.jsx("hr",{className:"lf-section-divider"}),i.length>0&&p.jsxs("div",{className:"lf-content-section",style:{marginBottom:40},children:[p.jsx("h2",{className:"lf-section-title",children:"More Like This"}),p.jsx("div",{className:"lf-similar-grid",children:i.map(Le=>p.jsxs($r,{to:`/movie/${Le.Id}`,className:"lf-similar-card",children:[p.jsx("img",{className:"lf-similar-card__poster",src:ee.getImageUrl(Le,"Primary"),alt:Le.Name,loading:"lazy"}),p.jsx("div",{className:"lf-similar-card__title",children:Le.Name})]},Le.Id))})]}),p.jsx(Du,{isOpen:h,onClose:()=>u(!1),seriesId:t?t.Id:"",initialSeasonId:null,initialEpisodeId:t?t.Id:"",isMovie:!0}),U&&p.jsx("div",{className:"lf-blocked-modal-overlay",children:p.jsxs("div",{className:"lf-blocked-modal",children:[p.jsx("span",{className:"material-icons lf-blocked-icon",children:"block"}),p.jsx("h3",{children:"Content blocked by browser"}),p.jsx("p",{children:"The trailer cannot be played because your browser blocked it. This usually happens due to tracking protection or ad blockers affecting the YouTube player."}),p.jsx("button",{className:"lf-btn lf-btn--primary",onClick:()=>{K(!1),Fe()},children:"Close"})]})})]})},JL=[{id:"details",label:"My details"},{id:"display",label:"Display"},{id:"home",label:"Home Screen"},{id:"playback",label:"Playback"},{id:"subtitles",label:"Subtitles"},{id:"quickconnect",label:"Quick Connect"},{id:"advanced",label:"Advanced"}],e1=()=>{Ms();const[n,e]=w.useState(null),[t,s]=w.useState("details"),[i,r]=w.useState(""),[l,c]=w.useState(!1),[h,u]=w.useState(!1),[f,g]=w.useState(!1),[y,x]=w.useState(""),[S,E]=w.useState(""),[T,A]=w.useState(""),[_,I]=w.useState(null),[C,N]=w.useState(!1),[D,k]=w.useState("en-US"),[B,j]=w.useState("default"),[U,K]=w.useState(""),[H,J]=w.useState(""),[re,me]=w.useState("Default"),[M,$]=w.useState(""),[F,ae]=w.useState("Default"),[de,P]=w.useState(""),[G,te]=w.useState(null),[fe,ve]=w.useState([{id:"resume",label:"Continue Watching",enabled:!0},{id:"latestMedia",label:"Latest Media",enabled:!0},{id:"nextUp",label:"Next Up",enabled:!0},{id:"favorites",label:"My Favorites",enabled:!0}]);w.useEffect(()=>{(async()=>{const He=await ee.getCurrentUser();if(He){e(He);const pt=He.Configuration||{};pt.AudioLanguagePreference&&K(pt.AudioLanguagePreference),pt.SubtitleLanguagePreference&&$(pt.SubtitleLanguagePreference),pt.SubtitleMode&&ae(pt.SubtitleMode);const nt=localStorage.getItem(`LegitFlix_Banner_${He.Id}`);nt?r(nt):He.ImageTags&&He.ImageTags.Banner?r(`${ee.api.basePath}/Users/${He.Id}/Images/Banner?tag=${He.ImageTags.Banner}&quality=90`):He.BackdropImageTags&&He.BackdropImageTags.length>0&&r(`${ee.api.basePath}/Users/${He.Id}/Images/Backdrop/0?tag=${He.BackdropImageTags[0]}&quality=90`)}})()},[]);const Ae=Oe=>{n&&(localStorage.setItem(`LegitFlix_Banner_${n.Id}`,Oe),r(Oe))},De=async Oe=>{if(!(!Oe||!n))try{await ee.uploadUserImage(n.Id,"Primary",Oe),e(pt=>({...pt,PrimaryImageTag:Date.now().toString()}));const He=await ee.getCurrentUser();He&&e(He),u(!1)}catch(He){console.error("Failed to upload avatar",He)}},Ge=async Oe=>{if(Oe.preventDefault(),I(null),S!==T){I({type:"error",text:"New passwords do not match."});return}if(!S){I({type:"error",text:"New password cannot be empty."});return}N(!0);try{await ee.updatePassword(n.Id,y,S),I({type:"success",text:"Password updated successfully!"}),x(""),E(""),A("")}catch(He){I({type:"error",text:He.message||"Failed to update password."})}finally{N(!1)}},Fe=async()=>{if(te(null),!de.trim()){te({type:"error",text:"Please enter a code."});return}try{await ee.quickConnect(de.trim()),te({type:"success",text:"Device authorized successfully!"}),P("")}catch(Oe){te({type:"error",text:Oe.message||"Authorization failed."})}},mt=Oe=>{ve(He=>He.map(pt=>pt.id===Oe?{...pt,enabled:!pt.enabled}:pt))},St=async()=>{await ee.logout()};if(!n)return p.jsxs("div",{className:"profile-page",children:[p.jsx(Ta,{}),p.jsxs("div",{className:"settings-container",children:[p.jsx(ze,{type:"text",width:"200px",height:"32px",style:{marginBottom:"20px"}}),p.jsx("div",{className:"settings-tabs",children:[1,2,3,4,5,6].map(Oe=>p.jsx(ze,{width:"100px",height:"40px",style:{display:"inline-block",marginRight:"8px",borderRadius:"20px"}},Oe))}),p.jsx(ze,{width:"100%",height:"250px",style:{margin:"20px 0",borderRadius:"12px"}}),p.jsx("div",{style:{display:"flex",gap:"20px",marginTop:"-55px",paddingLeft:"30px",position:"relative",marginBottom:"28px"},children:p.jsx(ze,{type:"circle",width:"110px",height:"110px",style:{border:"4px solid #0e0e0e"}})}),p.jsxs("div",{className:"settings-card",style:{padding:"28px",border:"1px solid rgba(255,255,255,0.05)",borderRadius:"14px"},children:[p.jsx(ze,{width:"180px",height:"24px",style:{marginBottom:"24px"}}),p.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(180px, 1fr))",gap:"18px"},children:[1,2,3,4].map(Oe=>p.jsxs("div",{children:[p.jsx(ze,{width:"80px",height:"14px",style:{marginBottom:"8px"}}),p.jsx(ze,{width:"140px",height:"20px"})]},Oe))})]})]})]});const jt=n.PrimaryImageTag?`${ee.api.basePath}/Users/${n.Id}/Images/Primary?tag=${n.PrimaryImageTag}&quality=90`:null,bt=()=>p.jsxs(p.Fragment,{children:[p.jsxs("div",{className:"settings-card",children:[p.jsx("h3",{className:"settings-card-title",children:"User Information"}),p.jsxs("div",{className:"info-grid",children:[p.jsxs("div",{className:"info-item",children:[p.jsx("label",{children:"Username"}),p.jsx("div",{className:"info-value",children:n.Name})]}),p.jsxs("div",{className:"info-item",children:[p.jsx("label",{children:"Last Login"}),p.jsx("div",{className:"info-value",children:n.LastLoginDate?new Date(n.LastLoginDate).toLocaleDateString():""})]}),p.jsxs("div",{className:"info-item",children:[p.jsx("label",{children:"Administrator"}),p.jsx("div",{className:"info-value",children:n.Policy?.IsAdministrator?"Yes":"No"})]}),p.jsxs("div",{className:"info-item",children:[p.jsx("label",{children:"User ID"}),p.jsx("div",{className:"info-value info-value-small",children:n.Id})]})]})]}),p.jsxs("div",{className:"settings-card",children:[p.jsx("h3",{className:"settings-card-title",children:"Change Password"}),p.jsxs("form",{className:"password-form",onSubmit:Ge,children:[p.jsxs("div",{className:"form-group",children:[p.jsx("label",{children:"Current Password"}),p.jsx("input",{type:"password",value:y,onChange:Oe=>x(Oe.target.value),className:"settings-input",autoComplete:"current-password"})]}),p.jsxs("div",{className:"form-group",children:[p.jsx("label",{children:"New Password"}),p.jsx("input",{type:"password",value:S,onChange:Oe=>E(Oe.target.value),className:"settings-input",autoComplete:"new-password"})]}),p.jsxs("div",{className:"form-group",children:[p.jsx("label",{children:"Confirm New Password"}),p.jsx("input",{type:"password",value:T,onChange:Oe=>A(Oe.target.value),className:"settings-input",autoComplete:"new-password"})]}),_&&p.jsxs("div",{className:`form-message ${_.type}`,children:[p.jsx("span",{className:"material-icons",children:_.type==="success"?"check_circle":"error"}),_.text]}),p.jsx("button",{type:"submit",className:"btn-accent",disabled:C,children:C?"SAVING...":"SAVE PASSWORD"})]})]})]}),ut=()=>p.jsxs("div",{className:"settings-card",children:[p.jsx("h3",{className:"settings-card-title",children:"Display Preferences"}),p.jsxs("div",{className:"form-group",children:[p.jsx("label",{children:"Display Language"}),p.jsxs("select",{className:"settings-select",value:D,onChange:Oe=>k(Oe.target.value),children:[p.jsx("option",{value:"en-US",children:"English (United States)"}),p.jsx("option",{value:"hu",children:"Magyar (Hungarian)"}),p.jsx("option",{value:"de",children:"Deutsch (German)"}),p.jsx("option",{value:"fr",children:"Franais (French)"}),p.jsx("option",{value:"es",children:"Espaol (Spanish)"}),p.jsx("option",{value:"ja",children:" (Japanese)"})]})]}),p.jsxs("div",{className:"form-group",children:[p.jsx("label",{children:"Date Format"}),p.jsxs("select",{className:"settings-select",value:B,onChange:Oe=>j(Oe.target.value),children:[p.jsx("option",{value:"default",children:"Use browser default"}),p.jsx("option",{value:"yyyy-MM-dd",children:"YYYY-MM-DD"}),p.jsx("option",{value:"dd/MM/yyyy",children:"DD/MM/YYYY"}),p.jsx("option",{value:"MM/dd/yyyy",children:"MM/DD/YYYY"})]})]}),p.jsxs("div",{className:"setting-row",children:[p.jsxs("div",{className:"setting-row-label",children:[p.jsx("span",{children:"Enable LegitFlix Theme"}),p.jsx("span",{className:"setting-hint",children:"Use the custom gaming profile theme"})]}),p.jsxs("label",{className:"toggle-switch",children:[p.jsx("input",{type:"checkbox",defaultChecked:!0}),p.jsx("span",{className:"slider"})]})]})]}),zt=()=>p.jsxs("div",{className:"settings-card",children:[p.jsx("h3",{className:"settings-card-title",children:"Home Screen Sections"}),p.jsx("p",{className:"settings-description",children:"Choose which sections to display on your home screen."}),fe.map(Oe=>p.jsxs("div",{className:"setting-row",children:[p.jsx("div",{className:"setting-row-label",children:p.jsx("span",{children:Oe.label})}),p.jsxs("label",{className:"toggle-switch",children:[p.jsx("input",{type:"checkbox",checked:Oe.enabled,onChange:()=>mt(Oe.id)}),p.jsx("span",{className:"slider"})]})]},Oe.id))]}),Me=()=>p.jsxs("div",{className:"settings-card",children:[p.jsx("h3",{className:"settings-card-title",children:"Playback Settings"}),p.jsxs("div",{className:"form-group",children:[p.jsx("label",{children:"Preferred Audio Language"}),p.jsxs("select",{className:"settings-select",value:U,onChange:Oe=>K(Oe.target.value),children:[p.jsx("option",{value:"",children:"Auto / Server Default"}),p.jsx("option",{value:"eng",children:"English"}),p.jsx("option",{value:"hun",children:"Hungarian"}),p.jsx("option",{value:"jpn",children:"Japanese"}),p.jsx("option",{value:"ger",children:"German"}),p.jsx("option",{value:"fre",children:"French"}),p.jsx("option",{value:"spa",children:"Spanish"})]})]}),p.jsxs("div",{className:"form-group",children:[p.jsx("label",{children:"Max Streaming Bitrate"}),p.jsxs("select",{className:"settings-select",value:H,onChange:Oe=>J(Oe.target.value),children:[p.jsx("option",{value:"",children:"Auto"}),p.jsx("option",{value:"120000000",children:"120 Mbps (4K)"}),p.jsx("option",{value:"80000000",children:"80 Mbps"}),p.jsx("option",{value:"60000000",children:"60 Mbps"}),p.jsx("option",{value:"40000000",children:"40 Mbps"}),p.jsx("option",{value:"20000000",children:"20 Mbps (1080p)"}),p.jsx("option",{value:"8000000",children:"8 Mbps (720p)"}),p.jsx("option",{value:"4000000",children:"4 Mbps"}),p.jsx("option",{value:"2000000",children:"2 Mbps"})]})]}),p.jsxs("div",{className:"setting-row",children:[p.jsxs("div",{className:"setting-row-label",children:[p.jsx("span",{children:"Prefer fMP4-HLS Container"}),p.jsx("span",{className:"setting-hint",children:"Uses fMP4 container for HLS playback when available"})]}),p.jsxs("label",{className:"toggle-switch",children:[p.jsx("input",{type:"checkbox",defaultChecked:!1}),p.jsx("span",{className:"slider"})]})]}),p.jsxs("div",{className:"setting-row",children:[p.jsxs("div",{className:"setting-row-label",children:[p.jsx("span",{children:"Enable Cinema Mode"}),p.jsx("span",{className:"setting-hint",children:"Play trailers and custom intros before the main feature"})]}),p.jsxs("label",{className:"toggle-switch",children:[p.jsx("input",{type:"checkbox",defaultChecked:!0}),p.jsx("span",{className:"slider"})]})]})]}),Le=()=>p.jsxs("div",{className:"settings-card",children:[p.jsx("h3",{className:"settings-card-title",children:"Subtitle Preferences"}),p.jsxs("div",{className:"form-group",children:[p.jsx("label",{children:"Preferred Subtitle Language"}),p.jsxs("select",{className:"settings-select",value:M,onChange:Oe=>$(Oe.target.value),children:[p.jsx("option",{value:"",children:"None"}),p.jsx("option",{value:"eng",children:"English"}),p.jsx("option",{value:"hun",children:"Hungarian"}),p.jsx("option",{value:"jpn",children:"Japanese"}),p.jsx("option",{value:"ger",children:"German"}),p.jsx("option",{value:"fre",children:"French"}),p.jsx("option",{value:"spa",children:"Spanish"})]})]}),p.jsxs("div",{className:"form-group",children:[p.jsx("label",{children:"Subtitle Mode"}),p.jsxs("select",{className:"settings-select",value:F,onChange:Oe=>ae(Oe.target.value),children:[p.jsx("option",{value:"Default",children:"Default"}),p.jsx("option",{value:"Always",children:"Always Show"}),p.jsx("option",{value:"OnlyForced",children:"Only Forced"}),p.jsx("option",{value:"None",children:"None"}),p.jsx("option",{value:"Smart",children:"Smart (match audio)"})]})]}),p.jsxs("div",{className:"setting-row",children:[p.jsxs("div",{className:"setting-row-label",children:[p.jsx("span",{children:"Burn in Subtitles"}),p.jsx("span",{className:"setting-hint",children:"Permanently render subtitles into the video stream"})]}),p.jsxs("label",{className:"toggle-switch",children:[p.jsx("input",{type:"checkbox",defaultChecked:!1}),p.jsx("span",{className:"slider"})]})]})]}),Ue=()=>p.jsxs("div",{className:"settings-card",children:[p.jsx("h3",{className:"settings-card-title",children:"Quick Connect"}),p.jsx("p",{className:"settings-description",children:"Enter the code displayed on your device to authorize it with your account."}),p.jsxs("div",{className:"qc-row",children:[p.jsx("input",{type:"text",className:"settings-input qc-input",placeholder:"Enter code",value:de,onChange:Oe=>P(Oe.target.value),maxLength:10}),p.jsx("button",{className:"btn-accent",onClick:Fe,children:"AUTHORIZE"})]}),G&&p.jsxs("div",{className:`form-message ${G.type}`,style:{marginTop:"12px"},children:[p.jsx("span",{className:"material-icons",children:G.type==="success"?"check_circle":"error"}),G.text]})]}),Ze=()=>p.jsxs("div",{className:"settings-card",children:[p.jsx("h3",{className:"settings-card-title",children:"Advanced"}),n.Policy?.IsAdministrator&&p.jsxs("button",{className:"btn-link-row",onClick:()=>window.location.href="/web/index.html#!/dashboard",children:[p.jsx("span",{className:"material-icons",children:"dashboard"}),p.jsxs("div",{children:[p.jsx("span",{children:"Server Dashboard"}),p.jsx("span",{className:"setting-hint",children:"Manage server settings, users, and libraries"})]}),p.jsx("span",{className:"material-icons link-arrow",children:"chevron_right"})]}),p.jsxs("button",{className:"btn-link-row",onClick:()=>window.location.href="/web/index.html#!/playback/profile",children:[p.jsx("span",{className:"material-icons",children:"tune"}),p.jsxs("div",{children:[p.jsx("span",{children:"Playback Profiles"}),p.jsx("span",{className:"setting-hint",children:"Configure device playback profiles"})]}),p.jsx("span",{className:"material-icons link-arrow",children:"chevron_right"})]}),p.jsxs("button",{className:"btn-link-row",onClick:()=>window.location.href="/web/index.html#!/networking",children:[p.jsx("span",{className:"material-icons",children:"lan"}),p.jsxs("div",{children:[p.jsx("span",{children:"Networking"}),p.jsx("span",{className:"setting-hint",children:"Server networking and remote access settings"})]}),p.jsx("span",{className:"material-icons link-arrow",children:"chevron_right"})]}),p.jsxs("button",{className:"btn-link-row",onClick:()=>window.location.href="/web/index.html#!/mypreferencesmenu",children:[p.jsx("span",{className:"material-icons",children:"settings_applications"}),p.jsxs("div",{children:[p.jsx("span",{children:"Classic User Settings"}),p.jsx("span",{className:"setting-hint",children:"Open the default Jellyfin user preferences"})]}),p.jsx("span",{className:"material-icons link-arrow",children:"chevron_right"})]}),n.Policy?.IsAdministrator&&p.jsxs("button",{className:"btn-link-row",onClick:()=>window.location.href="/web/index.html#!/plugins",children:[p.jsx("span",{className:"material-icons",children:"extension"}),p.jsxs("div",{children:[p.jsx("span",{children:"Plugins"}),p.jsx("span",{className:"setting-hint",children:"Manage installed plugins"})]}),p.jsx("span",{className:"material-icons link-arrow",children:"chevron_right"})]}),p.jsx("div",{className:"dropdown-divider",style:{margin:"16px 0",borderColor:"rgba(255,255,255,0.05)"}}),p.jsxs("button",{className:"btn-link-row",onClick:()=>g(!0),children:[p.jsx("span",{className:"material-icons",children:"palette"}),p.jsxs("div",{children:[p.jsx("span",{children:"LegitFlix Settings"}),p.jsx("span",{className:"setting-hint",children:"Customize theme colors and logo"})]}),p.jsx("span",{className:"material-icons link-arrow",children:"chevron_right"})]})]}),ht=()=>{switch(t){case"details":return bt();case"display":return ut();case"home":return zt();case"playback":return Me();case"subtitles":return Le();case"quickconnect":return Ue();case"advanced":return Ze();default:return null}};return p.jsxs("div",{className:"profile-page",children:[p.jsx(Ta,{}),p.jsxs("div",{className:"settings-container",children:[p.jsx("h1",{className:"settings-page-title",children:"Account Settings"}),p.jsxs("div",{className:"settings-tabs",children:[JL.map(Oe=>p.jsx("button",{className:`settings-tab ${t===Oe.id?"active":""}`,onClick:()=>s(Oe.id),children:Oe.label},Oe.id)),p.jsx("button",{className:"settings-tab settings-tab-logout",onClick:St,title:"Sign Out",children:p.jsx("span",{className:"material-icons",children:"exit_to_app"})})]}),p.jsxs("div",{className:`settings-banner ${i?"has-banner":""}`,style:i?{backgroundImage:`url('${i}')`}:{},children:[p.jsx("div",{className:"banner-overlay"}),p.jsxs("div",{className:"banner-edit-btn",onClick:()=>c(!0),children:[p.jsx("span",{className:"material-icons-outlined",children:i?"edit":"add_photo_alternate"}),p.jsx("span",{children:i?"Change profile banner":"Add profile banner"})]})]}),p.jsxs("div",{className:"settings-avatar-wrap",children:[p.jsx("div",{className:"settings-avatar",style:jt?{backgroundImage:`url('${jt}')`}:{},children:!jt&&p.jsx("span",{className:"material-icons avatar-placeholder",children:"person"})}),p.jsx("div",{className:"avatar-edit-badge",title:"Change avatar",onClick:()=>u(!0),children:p.jsx("span",{className:"material-icons",children:"edit"})})]}),p.jsx("div",{className:"settings-content",children:ht()})]}),p.jsx(gm,{isOpen:l,onClose:()=>c(!1),onSave:Ae,userId:n?.Id}),p.jsx(bS,{isOpen:f,onClose:()=>g(!1),userId:n?.Id}),p.jsx(ku,{isOpen:h,onClose:()=>u(!1),onSave:De,userId:n?.Id})]})},t1=()=>{const n=Ms(),{config:e}=Yi(),[t,s]=w.useState(window.location.origin),[i,r]=w.useState(!1),[l,c]=w.useState(""),h=async u=>{u.preventDefault(),r(!0),c("");try{const f=await ee.validateServer(t);f&&f.valid?(ee.initialize(null,f.baseUrl),n("/login/select-user")):c("Could not connect to server. Please check the URL.")}catch(f){console.error("Validation error",f),c("An error occurred while connecting.")}finally{r(!1)}};return p.jsx("div",{className:"auth-page",children:p.jsxs("div",{className:"auth-container",children:[p.jsxs("div",{className:"auth-logo",children:[e.logoUrl?p.jsx("img",{src:e.logoUrl,alt:"LegitFlix",className:"auth-logo-img"}):p.jsx("img",{src:no(e.accentColor),alt:"LegitFlix",className:"auth-logo-img"}),p.jsx("p",{children:"Connect to Server"})]}),p.jsxs("form",{onSubmit:h,className:"auth-form",children:[p.jsxs("div",{className:"form-group",children:[p.jsx("label",{children:"Server URL"}),p.jsx("input",{type:"text",className:"auth-input",value:t,onChange:u=>s(u.target.value),placeholder:"http://myserver:8096"})]}),l&&p.jsx("div",{className:"auth-error",children:l}),p.jsx(vi,{type:"submit",variant:"ringHover",size:"lg",disabled:i,className:"w-full",children:i?"Connecting...":"Connect"})]})]})})},s1=()=>{const n=Ms(),{config:e}=Yi(),[t,s]=w.useState([]),[i,r]=w.useState(!0);w.useEffect(()=>{(async()=>{try{const f=await ee.getPublicUsers();f&&s(f)}catch(f){console.error("Failed to load users",f)}finally{r(!1)}})()},[]);const l=u=>{n("/login",{state:{username:u.Name,userId:u.Id}})},c=()=>{n("/login")},h=()=>{n("/login/select-server")};return p.jsx("div",{className:"auth-page",children:p.jsxs("div",{className:"auth-container",children:[p.jsxs("div",{className:"auth-logo",children:[e.logoUrl?p.jsx("img",{src:e.logoUrl,alt:"LegitFlix",className:"auth-logo-img"}):p.jsx("img",{src:no(e.accentColor),alt:"LegitFlix",className:"auth-logo-img"}),p.jsx("p",{children:"Who's watching?"})]}),i?p.jsx("div",{className:"user-grid",children:[1,2,3].map(u=>p.jsxs("div",{className:"user-card",style:{cursor:"default"},children:[p.jsx("div",{className:"user-avatar-container",style:{border:"none",padding:0},children:p.jsx(ze,{type:"circle",width:"100px",height:"100px"})}),p.jsx(ze,{type:"text",width:"80px",height:"20px",style:{marginTop:"10px"}})]},u))}):p.jsxs(p.Fragment,{children:[p.jsx("div",{className:"user-grid",children:t.map(u=>p.jsxs("button",{className:"user-card",onClick:()=>l(u),children:[p.jsxs("div",{className:"user-avatar-container",children:[p.jsx("div",{className:"auth-avatar-wrapper",children:p.jsx("img",{src:`${ee.api.basePath||""}/Users/${u.Id}/Images/Primary?quality=90`,alt:u.Name,className:"auth-avatar",onError:f=>{f.target.style.display="none",f.target.parentElement.nextSibling.style.display="flex"}})}),p.jsx("div",{className:"user-avatar-placeholder",style:{display:"none"},children:p.jsx("span",{className:"material-icons",children:"person"})})]}),p.jsx("span",{className:"user-card-name",children:u.Name})]},u.Id))}),p.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"10px",alignItems:"center"},children:[p.jsx("button",{className:"text-link",onClick:c,children:"Manual Login"}),p.jsx("button",{className:"text-link",style:{fontSize:"0.8rem",opacity:.7},onClick:h,children:"Switch Server"})]})]})]})})},i1=()=>{const n=Ms(),e=$n(),{config:t}=Yi(),s=e.state?.username||"",[i,r]=w.useState(s),[l,c]=w.useState(""),[h,u]=w.useState(!1),[f,g]=w.useState(""),[y,x]=w.useState(!1),[S,E]=w.useState(""),[T,A]=w.useState("");w.useEffect(()=>{let I;return y?(async()=>{try{u(!0);const N=await ee.initiateQuickConnect();E(N.Code),A(N.Secret),u(!1),I=setInterval(async()=>{if(N.Secret)try{await ee.checkQuickConnectStatus(N.Secret)&&(clearInterval(I),n("/"))}catch(D){console.warn("Polling error",D)}},2e3)}catch(N){console.error("Quick Connect Init Failed",N),g("Failed to initialize Quick Connect."),u(!1)}})():(E(""),A(""),I&&clearInterval(I)),()=>{I&&clearInterval(I)}},[y,n]);const _=async I=>{I.preventDefault(),u(!0),g("");try{await ee.authenticateUser(i,l),await ee.getCurrentUser()?n("/"):g("Login succeeded but failed to retrieve user session.")}catch(C){console.error("Login error",C),g("Invalid username or password.")}finally{u(!1)}};return p.jsx("div",{className:"auth-page",children:p.jsxs("div",{className:"auth-container",children:[p.jsxs("div",{className:"auth-logo",children:[t.logoUrl?p.jsx("img",{src:t.logoUrl,alt:"LegitFlix",className:"auth-logo-img"}):p.jsx("img",{src:no(t.accentColor),alt:"LegitFlix",className:"auth-logo-img"}),p.jsx("p",{children:y?"Quick Connect":"Sign In"})]}),y?p.jsxs("div",{className:"qc-container",children:[h?p.jsx("div",{className:"qc-spinner"}):p.jsxs(p.Fragment,{children:[p.jsx("div",{className:"qc-instructions",children:"Use your mobile device to scan the code or enter it manually."}),p.jsx("div",{className:"qc-code-display",children:S}),p.jsx("div",{className:"qc-instructions",children:"Waiting for authorization..."}),p.jsx("div",{className:"qc-spinner"})]}),p.jsx("button",{type:"button",className:"text-link",onClick:()=>x(!1),children:"Cancel"})]}):p.jsxs("form",{onSubmit:_,className:"auth-form",children:[p.jsxs("div",{className:"form-group",children:[p.jsx("label",{children:"Username"}),p.jsx("input",{type:"text",className:"auth-input",value:i,onChange:I=>r(I.target.value),placeholder:"Enter username"})]}),p.jsxs("div",{className:"form-group",children:[p.jsx("label",{children:"Password"}),p.jsx("input",{type:"password",className:"auth-input",value:l,onChange:I=>c(I.target.value),placeholder:"Enter password"})]}),f&&p.jsx("div",{className:"auth-error",children:f}),p.jsxs("div",{className:"auth-btn-group",children:[p.jsx(vi,{type:"submit",variant:"ringHover",size:"lg",disabled:h,className:"w-full",children:h?"Signing in...":"Sign In"}),p.jsx(vi,{type:"button",variant:"outline",size:"lg",onClick:()=>x(!0),className:"w-full",children:"Quick Connect"})]}),p.jsx("button",{type:"button",className:"text-link",onClick:()=>n("/login/select-user"),children:"Back to Users"})]})]})})},n1=()=>{const[n,e]=w.useState(null);return w.useEffect(()=>{(async()=>{try{const s=await ee.getCurrentUser();e(!!s)}catch(s){console.error("Auth check failed",s),e(!1)}})()},[]),n===null?p.jsx("div",{style:{padding:"20px"},children:p.jsx(ze,{width:"100%",height:"100vh"})}):n?p.jsx(fI,{}):p.jsx(hI,{to:"/login/select-user",replace:!0})},a1=()=>{const n=Ms();return w.useEffect(()=>{const e=window.location.hash;if(e.startsWith("#!/")){if(e==="#!/"||e==="#!/home"||e==="#!/home.html")return;if(console.log("[LegitFlix] Intercepted legacy hash:",e),e.includes("details?id=")){const r=new URLSearchParams(e.split("?")[1]).get("id");if(r){n(`/item/${r}`);return}}if(["mypreferencesmenu","user","settings"].some(i=>e.includes(i))){console.log("[LegitFlix] Redirecting settings hash to /profile:",e),n("/profile");return}if(e.includes("selectserver.html")||e.includes("login.html")){console.log("[LegitFlix] Redirecting auth hash to /login/select-user:",e),n("/login/select-user");return}if(["dashboard","plugins","wizard","scheduledtasks","server","networking","devices","api","logs","notifications","librarydisplay","playback","transcoding","live-tv","dlna","intro-s","activity","itemdetails","edititem"].some(i=>e.includes(i))){console.log("[LegitFlix] Redirecting to Classic Mode for:",e),window.location.replace(`/web/index.html?classic=true${e}`);return}}},[n]),null},r1=()=>{const{id:n}=_u(),e=Ms(),[t,s]=w.useState(null);return w.useEffect(()=>{n&&(async()=>{try{const r=await ee.getCurrentUser();if(!r)return;const l=await ee.getItem(r.Id,n);if(!l){s("Item not found");return}switch(console.log("[LegitFlix] Resolved item type:",l.Type),l.Type){case"Series":e(`/series/${l.Id}`,{replace:!0});break;case"Movie":e(`/movie/${l.Id}`,{replace:!0});break;case"Season":case"Episode":l.SeriesId?e(`/series/${l.SeriesId}`,{replace:!0}):window.location.href=`/web/index.html?classic=true#!/details?id=${l.Id}`;break;default:console.log("[LegitFlix] Unsupported item type, falling back to classic:",l.Type),window.location.href=`/web/index.html?classic=true#!/details?id=${l.Id}`;break}}catch(r){console.error("Failed to resolve item:",r),s("Failed to resolve item link."),setTimeout(()=>{window.location.href=`/web/index.html?classic=true#!/details?id=${n}`},2e3)}})()},[n,e]),p.jsxs("div",{style:{minHeight:"100vh",background:"#000",color:"#fff",display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column"},children:[p.jsx(Ta,{}),t&&p.jsxs("div",{style:{marginTop:100},children:[p.jsx("h2",{children:t}),p.jsx("p",{children:"Redirecting to classic view..."})]})]})},Ne=Number.isFinite||function(n){return typeof n=="number"&&isFinite(n)},l1=Number.isSafeInteger||function(n){return typeof n=="number"&&Math.abs(n)<=o1},o1=Number.MAX_SAFE_INTEGER||9007199254740991;let Be=(function(n){return n.NETWORK_ERROR="networkError",n.MEDIA_ERROR="mediaError",n.KEY_SYSTEM_ERROR="keySystemError",n.MUX_ERROR="muxError",n.OTHER_ERROR="otherError",n})({}),Q=(function(n){return n.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",n.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",n.KEY_SYSTEM_NO_SESSION="keySystemNoSession",n.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",n.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",n.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",n.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",n.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",n.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",n.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",n.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",n.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",n.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",n.MANIFEST_LOAD_ERROR="manifestLoadError",n.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",n.MANIFEST_PARSING_ERROR="manifestParsingError",n.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",n.LEVEL_EMPTY_ERROR="levelEmptyError",n.LEVEL_LOAD_ERROR="levelLoadError",n.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",n.LEVEL_PARSING_ERROR="levelParsingError",n.LEVEL_SWITCH_ERROR="levelSwitchError",n.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",n.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",n.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",n.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",n.FRAG_LOAD_ERROR="fragLoadError",n.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",n.FRAG_DECRYPT_ERROR="fragDecryptError",n.FRAG_PARSING_ERROR="fragParsingError",n.FRAG_GAP="fragGap",n.REMUX_ALLOC_ERROR="remuxAllocError",n.KEY_LOAD_ERROR="keyLoadError",n.KEY_LOAD_TIMEOUT="keyLoadTimeOut",n.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",n.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",n.BUFFER_APPEND_ERROR="bufferAppendError",n.BUFFER_APPENDING_ERROR="bufferAppendingError",n.BUFFER_STALLED_ERROR="bufferStalledError",n.BUFFER_FULL_ERROR="bufferFullError",n.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",n.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",n.ASSET_LIST_LOAD_ERROR="assetListLoadError",n.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",n.ASSET_LIST_PARSING_ERROR="assetListParsingError",n.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",n.INTERNAL_EXCEPTION="internalException",n.INTERNAL_ABORTED="aborted",n.ATTACH_MEDIA_ERROR="attachMediaError",n.UNKNOWN="unknown",n})({}),L=(function(n){return n.MEDIA_ATTACHING="hlsMediaAttaching",n.MEDIA_ATTACHED="hlsMediaAttached",n.MEDIA_DETACHING="hlsMediaDetaching",n.MEDIA_DETACHED="hlsMediaDetached",n.MEDIA_ENDED="hlsMediaEnded",n.STALL_RESOLVED="hlsStallResolved",n.BUFFER_RESET="hlsBufferReset",n.BUFFER_CODECS="hlsBufferCodecs",n.BUFFER_CREATED="hlsBufferCreated",n.BUFFER_APPENDING="hlsBufferAppending",n.BUFFER_APPENDED="hlsBufferAppended",n.BUFFER_EOS="hlsBufferEos",n.BUFFERED_TO_END="hlsBufferedToEnd",n.BUFFER_FLUSHING="hlsBufferFlushing",n.BUFFER_FLUSHED="hlsBufferFlushed",n.MANIFEST_LOADING="hlsManifestLoading",n.MANIFEST_LOADED="hlsManifestLoaded",n.MANIFEST_PARSED="hlsManifestParsed",n.LEVEL_SWITCHING="hlsLevelSwitching",n.LEVEL_SWITCHED="hlsLevelSwitched",n.LEVEL_LOADING="hlsLevelLoading",n.LEVEL_LOADED="hlsLevelLoaded",n.LEVEL_UPDATED="hlsLevelUpdated",n.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",n.LEVELS_UPDATED="hlsLevelsUpdated",n.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",n.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",n.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",n.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",n.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",n.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",n.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",n.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",n.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",n.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",n.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",n.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",n.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",n.CUES_PARSED="hlsCuesParsed",n.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",n.INIT_PTS_FOUND="hlsInitPtsFound",n.FRAG_LOADING="hlsFragLoading",n.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",n.FRAG_LOADED="hlsFragLoaded",n.FRAG_DECRYPTED="hlsFragDecrypted",n.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",n.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",n.FRAG_PARSING_METADATA="hlsFragParsingMetadata",n.FRAG_PARSED="hlsFragParsed",n.FRAG_BUFFERED="hlsFragBuffered",n.FRAG_CHANGED="hlsFragChanged",n.FPS_DROP="hlsFpsDrop",n.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",n.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",n.ERROR="hlsError",n.DESTROYING="hlsDestroying",n.KEY_LOADING="hlsKeyLoading",n.KEY_LOADED="hlsKeyLoaded",n.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",n.BACK_BUFFER_REACHED="hlsBackBufferReached",n.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",n.ASSET_LIST_LOADING="hlsAssetListLoading",n.ASSET_LIST_LOADED="hlsAssetListLoaded",n.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",n.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",n.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",n.INTERSTITIAL_STARTED="hlsInterstitialStarted",n.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",n.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",n.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",n.INTERSTITIAL_ENDED="hlsInterstitialEnded",n.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",n.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",n.EVENT_CUE_ENTER="hlsEventCueEnter",n})({});var at={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},ke={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};class Nr{constructor(e,t=0,s=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=s}sample(e,t){const s=Math.pow(this.alpha_,e);this.estimate_=t*(1-s)+s*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class c1{constructor(e,t,s,i=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=s,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new Nr(e),this.fast_=new Nr(t),this.defaultTTFB_=i,this.ttfb_=new Nr(e)}update(e,t){const{slow_:s,fast_:i,ttfb_:r}=this;s.halfLife!==e&&(this.slow_=new Nr(e,s.getEstimate(),s.getTotalWeight())),i.halfLife!==t&&(this.fast_=new Nr(t,i.getEstimate(),i.getTotalWeight())),r.halfLife!==e&&(this.ttfb_=new Nr(e,r.getEstimate(),r.getTotalWeight()))}sample(e,t){e=Math.max(e,this.minDelayMs_);const s=8*t,i=e/1e3,r=s/i;this.fast_.sample(i,r),this.slow_.sample(i,r)}sampleTTFB(e){const t=e/1e3,s=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(s,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}get defaultEstimate(){return this.defaultEstimate_}destroy(){}}function u1(n,e,t){return(e=h1(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function Dt(){return Dt=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var s in t)({}).hasOwnProperty.call(t,s)&&(n[s]=t[s])}return n},Dt.apply(null,arguments)}function uv(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);e&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,s)}return t}function Rt(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?uv(Object(t),!0).forEach(function(s){u1(n,s,t[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):uv(Object(t)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(t,s))})}return n}function d1(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var s=t.call(n,e);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function h1(n){var e=d1(n,"string");return typeof e=="symbol"?e:e+""}class ji{constructor(e,t){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;const s=`[${e}]:`;this.trace=xa,this.debug=t.debug.bind(null,s),this.log=t.log.bind(null,s),this.warn=t.warn.bind(null,s),this.info=t.info.bind(null,s),this.error=t.error.bind(null,s)}}const xa=function(){},f1={trace:xa,debug:xa,log:xa,warn:xa,info:xa,error:xa};function jf(){return Dt({},f1)}function m1(n,e){const t=self.console[n];return t?t.bind(self.console,`${e?"["+e+"] ":""}[${n}] >`):xa}function dv(n,e,t){return e[n]?e[n].bind(e):m1(n,t)}const Bf=jf();function p1(n,e,t){const s=jf();if(typeof console=="object"&&n===!0||typeof n=="object"){const i=["debug","log","info","warn","error"];i.forEach(r=>{s[r]=dv(r,n,t)});try{s.log(`Debug logs enabled for "${e}" in hls.js version 1.6.15`)}catch{return jf()}i.forEach(r=>{Bf[r]=dv(r,n)})}else Dt(Bf,s);return s}const Lt=Bf;function Ea(n=!0){return typeof self>"u"?void 0:(n||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function g1(n){return typeof self<"u"&&n===self.ManagedMediaSource}function TS(n,e){const t=Object.keys(n),s=Object.keys(e),i=t.length,r=s.length;return!i||!r||i===r&&!t.some(l=>s.indexOf(l)===-1)}function xi(n,e=!1){if(typeof TextDecoder<"u"){const u=new TextDecoder("utf-8").decode(n);if(e){const f=u.indexOf("\0");return f!==-1?u.substring(0,f):u}return u.replace(/\0/g,"")}const t=n.length;let s,i,r,l="",c=0;for(;c<t;){if(s=n[c++],s===0&&e)return l;if(s===0||s===3)continue;switch(s>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:l+=String.fromCharCode(s);break;case 12:case 13:i=n[c++],l+=String.fromCharCode((s&31)<<6|i&63);break;case 14:i=n[c++],r=n[c++],l+=String.fromCharCode((s&15)<<12|(i&63)<<6|(r&63)<<0);break}}return l}function Is(n){let e="";for(let t=0;t<n.length;t++){let s=n[t].toString(16);s.length<2&&(s="0"+s),e+=s}return e}function ES(n){return Uint8Array.from(n.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}function y1(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var rf={exports:{}},hv;function v1(){return hv||(hv=1,(function(n,e){(function(t){var s=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,i=/^(?=([^\/?#]*))\1([^]*)$/,r=/(?:\/|^)\.(?=\/)/g,l=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,c={buildAbsoluteURL:function(h,u,f){if(f=f||{},h=h.trim(),u=u.trim(),!u){if(!f.alwaysNormalize)return h;var g=c.parseURL(h);if(!g)throw new Error("Error trying to parse base URL.");return g.path=c.normalizePath(g.path),c.buildURLFromParts(g)}var y=c.parseURL(u);if(!y)throw new Error("Error trying to parse relative URL.");if(y.scheme)return f.alwaysNormalize?(y.path=c.normalizePath(y.path),c.buildURLFromParts(y)):u;var x=c.parseURL(h);if(!x)throw new Error("Error trying to parse base URL.");if(!x.netLoc&&x.path&&x.path[0]!=="/"){var S=i.exec(x.path);x.netLoc=S[1],x.path=S[2]}x.netLoc&&!x.path&&(x.path="/");var E={scheme:x.scheme,netLoc:y.netLoc,path:null,params:y.params,query:y.query,fragment:y.fragment};if(!y.netLoc&&(E.netLoc=x.netLoc,y.path[0]!=="/"))if(!y.path)E.path=x.path,y.params||(E.params=x.params,y.query||(E.query=x.query));else{var T=x.path,A=T.substring(0,T.lastIndexOf("/")+1)+y.path;E.path=c.normalizePath(A)}return E.path===null&&(E.path=f.alwaysNormalize?c.normalizePath(y.path):y.path),c.buildURLFromParts(E)},parseURL:function(h){var u=s.exec(h);return u?{scheme:u[1]||"",netLoc:u[2]||"",path:u[3]||"",params:u[4]||"",query:u[5]||"",fragment:u[6]||""}:null},normalizePath:function(h){for(h=h.split("").reverse().join("").replace(r,"");h.length!==(h=h.replace(l,"")).length;);return h.split("").reverse().join("")},buildURLFromParts:function(h){return h.scheme+h.netLoc+h.path+h.params+h.query+h.fragment}};n.exports=c})()})(rf)),rf.exports}var ym=v1();class vm{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var Ut={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class AS{constructor(e){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,typeof e=="string"&&(e={url:e}),this.base=e,S1(this,"stats")}setByteRange(e,t){const s=e.split("@",2);let i;s.length===1?i=t?.byteRangeEndOffset||0:i=parseInt(s[1]),this._byteRange=[i,parseInt(s[0])+i]}get baseurl(){return this.base.url}get byteRange(){return this._byteRange===null?[]:this._byteRange}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get elementaryStreams(){return this._streams===null&&(this._streams={[Ut.AUDIO]:null,[Ut.VIDEO]:null,[Ut.AUDIOVIDEO]:null}),this._streams}set elementaryStreams(e){this._streams=e}get hasStats(){return this._stats!==null}get hasStreams(){return this._streams!==null}get stats(){return this._stats===null&&(this._stats=new vm),this._stats}set stats(e){this._stats=e}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=ym.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[Ut.AUDIO]=null,e[Ut.VIDEO]=null,e[Ut.AUDIOVIDEO]=null}}function ss(n){return n.sn!=="initSegment"}class lf extends AS{constructor(e,t){super(t),this._decryptdata=null,this._programDateTime=null,this._ref=null,this._bitrate=void 0,this.rawProgramDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.playlistOffset=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get byteLength(){if(this.hasStats){const e=this.stats.total;if(e)return e}if(this.byteRange.length){const e=this.byteRange[0],t=this.byteRange[1];if(Ne(e)&&Ne(t))return t-e}return null}get bitrate(){return this.byteLength?this.byteLength*8/this.duration:this._bitrate?this._bitrate:null}set bitrate(e){this._bitrate=e}get decryptdata(){var e;const{levelkeys:t}=this;if(!t||t.NONE)return null;if(t.identity)this._decryptdata||(this._decryptdata=t.identity.getDecryptData(this.sn));else if(!((e=this._decryptdata)!=null&&e.keyId)){const s=Object.keys(t);if(s.length===1){const i=this._decryptdata=t[s[0]]||null;i&&(this._decryptdata=i.getDecryptData(this.sn,t))}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null)return null;const e=Ne(this.duration)?this.duration:0;return this.programDateTime+e*1e3}get encrypted(){var e;if((e=this._decryptdata)!=null&&e.encrypted)return!0;if(this.levelkeys){var t;const s=Object.keys(this.levelkeys),i=s.length;if(i>1||i===1&&(t=this.levelkeys[s[0]])!=null&&t.encrypted)return!0}return!1}get programDateTime(){return this._programDateTime===null&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime}set programDateTime(e){if(!Ne(e)){this._programDateTime=this.rawProgramDateTime=null;return}this._programDateTime=e}get ref(){return ss(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}addStart(e){this.setStart(this.start+e)}setStart(e){this.start=e,this._ref&&(this._ref.start=e)}setDuration(e){this.duration=e,this._ref&&(this._ref.duration=e)}setKeyFormat(e){const t=this.levelkeys;if(t){var s;const i=t[e];i&&!((s=this._decryptdata)!=null&&s.keyId)&&(this._decryptdata=i.getDecryptData(this.sn,t))}}abortRequests(){var e,t;(e=this.loader)==null||e.abort(),(t=this.keyLoader)==null||t.abort()}setElementaryStreamInfo(e,t,s,i,r,l=!1){const{elementaryStreams:c}=this,h=c[e];if(!h){c[e]={startPTS:t,endPTS:s,startDTS:i,endDTS:r,partial:l};return}h.startPTS=Math.min(h.startPTS,t),h.endPTS=Math.max(h.endPTS,s),h.startDTS=Math.min(h.startDTS,i),h.endDTS=Math.max(h.endDTS,r)}}class x1 extends AS{constructor(e,t,s,i,r){super(s),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=i;const l=e.enumeratedString("BYTERANGE");l&&this.setByteRange(l,r),r&&(this.fragOffset=r.fragOffset+r.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}function IS(n,e){const t=Object.getPrototypeOf(n);if(t){const s=Object.getOwnPropertyDescriptor(t,e);return s||IS(t,e)}}function S1(n,e){const t=IS(n,e);t&&(t.enumerable=!0,Object.defineProperty(n,e,t))}const fv=Math.pow(2,32)-1,b1=[].push,_S={video:1,audio:2,id3:3,text:4};function hs(n){return String.fromCharCode.apply(null,n)}function RS(n,e){const t=n[e]<<8|n[e+1];return t<0?65536+t:t}function Ye(n,e){const t=LS(n,e);return t<0?4294967296+t:t}function mv(n,e){let t=Ye(n,e);return t*=Math.pow(2,32),t+=Ye(n,e+4),t}function LS(n,e){return n[e]<<24|n[e+1]<<16|n[e+2]<<8|n[e+3]}function T1(n){const e=n.byteLength;for(let t=0;t<e;){const s=Ye(n,t);if(s>8&&n[t+4]===109&&n[t+5]===111&&n[t+6]===111&&n[t+7]===102)return!0;t=s>1?t+s:e}return!1}function it(n,e){const t=[];if(!e.length)return t;const s=n.byteLength;for(let i=0;i<s;){const r=Ye(n,i),l=hs(n.subarray(i+4,i+8)),c=r>1?i+r:s;if(l===e[0])if(e.length===1)t.push(n.subarray(i+8,c));else{const h=it(n.subarray(i+8,c),e.slice(1));h.length&&b1.apply(t,h)}i=c}return t}function E1(n){const e=[],t=n[0];let s=8;const i=Ye(n,s);s+=4;let r=0,l=0;t===0?(r=Ye(n,s),l=Ye(n,s+4),s+=8):(r=mv(n,s),l=mv(n,s+8),s+=16),s+=2;let c=n.length+l;const h=RS(n,s);s+=2;for(let u=0;u<h;u++){let f=s;const g=Ye(n,f);f+=4;const y=g&2147483647;if((g&2147483648)>>>31===1)return Lt.warn("SIDX has hierarchical references (not supported)"),null;const S=Ye(n,f);f+=4,e.push({referenceSize:y,subsegmentDuration:S,info:{duration:S/i,start:c,end:c+y-1}}),c+=y,f+=4,s=f}return{earliestPresentationTime:r,timescale:i,version:t,referencesCount:h,references:e}}function wS(n){const e=[],t=it(n,["moov","trak"]);for(let i=0;i<t.length;i++){const r=t[i],l=it(r,["tkhd"])[0];if(l){let c=l[0];const h=Ye(l,c===0?12:20),u=it(r,["mdia","mdhd"])[0];if(u){c=u[0];const f=Ye(u,c===0?12:20),g=it(r,["mdia","hdlr"])[0];if(g){const y=hs(g.subarray(8,12)),x={soun:Ut.AUDIO,vide:Ut.VIDEO}[y],S=it(r,["mdia","minf","stbl","stsd"])[0],E=A1(S);x?(e[h]={timescale:f,type:x,stsd:E},e[x]=Rt({timescale:f,id:h},E)):e[h]={timescale:f,type:y,stsd:E}}}}}return it(n,["moov","mvex","trex"]).forEach(i=>{const r=Ye(i,4),l=e[r];l&&(l.default={duration:Ye(i,12),flags:Ye(i,20)})}),e}function A1(n){const e=n.subarray(8),t=e.subarray(86),s=hs(e.subarray(4,8));let i=s,r;const l=s==="enca"||s==="encv";if(l){const u=it(e,[s])[0].subarray(s==="enca"?28:78);it(u,["sinf"]).forEach(g=>{const y=it(g,["schm"])[0];if(y){const x=hs(y.subarray(4,8));if(x==="cbcs"||x==="cenc"){const S=it(g,["frma"])[0];S&&(i=hs(S))}}})}const c=i;switch(i){case"avc1":case"avc2":case"avc3":case"avc4":{const h=it(t,["avcC"])[0];h&&h.length>3&&(i+="."+Uc(h[1])+Uc(h[2])+Uc(h[3]),r=Pc(c==="avc1"?"dva1":"dvav",t));break}case"mp4a":{const h=it(e,[s])[0],u=it(h.subarray(28),["esds"])[0];if(u&&u.length>7){let f=4;if(u[f++]!==3)break;f=of(u,f),f+=2;const g=u[f++];if(g&128&&(f+=2),g&64&&(f+=u[f++]),u[f++]!==4)break;f=of(u,f);const y=u[f++];if(y===64)i+="."+Uc(y);else break;if(f+=12,u[f++]!==5)break;f=of(u,f);const x=u[f++];let S=(x&248)>>3;S===31&&(S+=1+((x&7)<<3)+((u[f]&224)>>5)),i+="."+S}break}case"hvc1":case"hev1":{const h=it(t,["hvcC"])[0];if(h&&h.length>12){const u=h[1],f=["","A","B","C"][u>>6],g=u&31,y=Ye(h,2),x=(u&32)>>5?"H":"L",S=h[12],E=h.subarray(6,12);i+="."+f+g,i+="."+I1(y).toString(16).toUpperCase(),i+="."+x+S;let T="";for(let A=E.length;A--;){const _=E[A];(_||T)&&(T="."+_.toString(16).toUpperCase()+T)}i+=T}r=Pc(c=="hev1"?"dvhe":"dvh1",t);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":{i=Pc(i,t)||i;break}case"vp09":{const h=it(t,["vpcC"])[0];if(h&&h.length>6){const u=h[4],f=h[5],g=h[6]>>4&15;i+="."+ln(u)+"."+ln(f)+"."+ln(g)}break}case"av01":{const h=it(t,["av1C"])[0];if(h&&h.length>2){const u=h[1]>>>5,f=h[1]&31,g=h[2]>>>7?"H":"M",y=(h[2]&64)>>6,x=(h[2]&32)>>5,S=u===2&&y?x?12:10:y?10:8,E=(h[2]&16)>>4,T=(h[2]&8)>>3,A=(h[2]&4)>>2,_=h[2]&3;i+="."+u+"."+ln(f)+g+"."+ln(S)+"."+E+"."+T+A+_+"."+ln(1)+"."+ln(1)+"."+ln(1)+"."+0,r=Pc("dav1",t)}break}}return{codec:i,encrypted:l,supplemental:r}}function Pc(n,e){const t=it(e,["dvvC"]),s=t.length?t[0]:it(e,["dvcC"])[0];if(s){const i=s[2]>>1&127,r=s[2]<<5&32|s[3]>>3&31;return n+"."+ln(i)+"."+ln(r)}}function I1(n){let e=0;for(let t=0;t<32;t++)e|=(n>>t&1)<<31-t;return e>>>0}function of(n,e){const t=e+5;for(;n[e++]&128&&e<t;);return e}function Uc(n){return("0"+n.toString(16).toUpperCase()).slice(-2)}function ln(n){return(n<10?"0":"")+n}function _1(n,e){if(!n||!e)return;const t=e.keyId;t&&e.isCommonEncryption&&CS(n,(s,i)=>{const r=s.subarray(8,24);r.some(l=>l!==0)||(Lt.log(`[eme] Patching keyId in 'enc${i?"a":"v"}>sinf>>tenc' box: ${Is(r)} -> ${Is(t)}`),s.set(t,8))})}function R1(n){const e=[];return CS(n,t=>e.push(t.subarray(8,24))),e}function CS(n,e){it(n,["moov","trak"]).forEach(s=>{const i=it(s,["mdia","minf","stbl","stsd"])[0];if(!i)return;const r=i.subarray(8);let l=it(r,["enca"]);const c=l.length>0;c||(l=it(r,["encv"])),l.forEach(h=>{const u=c?h.subarray(28):h.subarray(78);it(u,["sinf"]).forEach(g=>{const y=NS(g);y&&e(y,c)})})})}function NS(n){const e=it(n,["schm"])[0];if(e){const t=hs(e.subarray(4,8));if(t==="cbcs"||t==="cenc"){const s=it(n,["schi","tenc"])[0];if(s)return s}}}function L1(n,e,t){const s={},i=it(n,["moof","traf"]);for(let r=0;r<i.length;r++){const l=i[r],c=it(l,["tfhd"])[0],h=Ye(c,4),u=e[h];if(!u)continue;s[h]||(s[h]={start:NaN,duration:0,sampleCount:0,timescale:u.timescale,type:u.type});const f=s[h],g=it(l,["tfdt"])[0];if(g){const I=g[0];let C=Ye(g,4);I===1&&(C===fv?t.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"):(C*=fv+1,C+=Ye(g,8))),Ne(C)&&(!Ne(f.start)||C<f.start)&&(f.start=C)}const y=u.default,x=Ye(c,0)|y?.flags;let S=y?.duration||0;x&8&&(x&2?S=Ye(c,12):S=Ye(c,8));const E=it(l,["trun"]);let T=f.start||0,A=0,_=S;for(let I=0;I<E.length;I++){const C=E[I],N=Ye(C,4),D=f.sampleCount;f.sampleCount+=N;const k=C[3]&1,B=C[3]&4,j=C[2]&1,U=C[2]&2,K=C[2]&4,H=C[2]&8;let J=8,re=N;for(k&&(J+=4),B&&N&&(!(C[J+1]&1)&&f.keyFrameIndex===void 0&&(f.keyFrameIndex=D),J+=4,j?(_=Ye(C,J),J+=4):_=S,U&&(J+=4),H&&(J+=4),T+=_,A+=_,re--);re--;)j?(_=Ye(C,J),J+=4):_=S,U&&(J+=4),K&&(C[J+1]&1||f.keyFrameIndex===void 0&&(f.keyFrameIndex=f.sampleCount-(re+1),f.keyFrameStart=T),J+=4),H&&(J+=4),T+=_,A+=_;!A&&S&&(A+=S*N)}f.duration+=A}if(!Object.keys(s).some(r=>s[r].duration)){let r=1/0,l=0;const c=it(n,["sidx"]);for(let h=0;h<c.length;h++){const u=E1(c[h]);if(u!=null&&u.references){r=Math.min(r,u.earliestPresentationTime/u.timescale);const f=u.references.reduce((g,y)=>g+y.info.duration||0,0);l=Math.max(l,f+u.earliestPresentationTime/u.timescale)}}l&&Ne(l)&&Object.keys(s).forEach(h=>{s[h].duration||(s[h].duration=l*s[h].timescale-s[h].start)})}return s}function w1(n){const e={valid:null,remainder:null},t=it(n,["moof"]);if(t.length<2)return e.remainder=n,e;const s=t[t.length-1];return e.valid=n.slice(0,s.byteOffset-8),e.remainder=n.slice(s.byteOffset-8),e}function Ui(n,e){const t=new Uint8Array(n.length+e.length);return t.set(n),t.set(e,n.length),t}function pv(n,e){const t=[],s=e.samples,i=e.timescale,r=e.id;let l=!1;return it(s,["moof"]).map(h=>{const u=h.byteOffset-8;it(h,["traf"]).map(g=>{const y=it(g,["tfdt"]).map(x=>{const S=x[0];let E=Ye(x,4);return S===1&&(E*=Math.pow(2,32),E+=Ye(x,8)),E/i})[0];return y!==void 0&&(n=y),it(g,["tfhd"]).map(x=>{const S=Ye(x,4),E=Ye(x,0)&16777215,T=(E&1)!==0,A=(E&2)!==0,_=(E&8)!==0;let I=0;const C=(E&16)!==0;let N=0;const D=(E&32)!==0;let k=8;S===r&&(T&&(k+=8),A&&(k+=4),_&&(I=Ye(x,k),k+=4),C&&(N=Ye(x,k),k+=4),D&&(k+=4),e.type==="video"&&(l=Pu(e.codec)),it(g,["trun"]).map(B=>{const j=B[0],U=Ye(B,0)&16777215,K=(U&1)!==0;let H=0;const J=(U&4)!==0,re=(U&256)!==0;let me=0;const M=(U&512)!==0;let $=0;const F=(U&1024)!==0,ae=(U&2048)!==0;let de=0;const P=Ye(B,4);let G=8;K&&(H=Ye(B,G),G+=4),J&&(G+=4);let te=H+u;for(let fe=0;fe<P;fe++){if(re?(me=Ye(B,G),G+=4):me=I,M?($=Ye(B,G),G+=4):$=N,F&&(G+=4),ae&&(j===0?de=Ye(B,G):de=LS(B,G),G+=4),e.type===Ut.VIDEO){let ve=0;for(;ve<$;){const Ae=Ye(s,te);if(te+=4,C1(l,s[te])){const De=s.subarray(te,te+Ae);xm(De,l?2:1,n+de/i,t)}te+=Ae,ve+=Ae+4}}n+=me/i}}))})})}),t}function Pu(n){if(!n)return!1;const e=n.substring(0,4);return e==="hvc1"||e==="hev1"||e==="dvh1"||e==="dvhe"}function C1(n,e){if(n){const t=e>>1&63;return t===39||t===40}else return(e&31)===6}function xm(n,e,t,s){const i=OS(n);let r=0;r+=e;let l=0,c=0,h=0;for(;r<i.length;){l=0;do{if(r>=i.length)break;h=i[r++],l+=h}while(h===255);c=0;do{if(r>=i.length)break;h=i[r++],c+=h}while(h===255);const u=i.length-r;let f=r;if(c<u)r+=c;else if(c>u){Lt.error(`Malformed SEI payload. ${c} is too small, only ${u} bytes left to parse.`);break}if(l===4){if(i[f++]===181){const y=RS(i,f);if(f+=2,y===49){const x=Ye(i,f);if(f+=4,x===1195456820){const S=i[f++];if(S===3){const E=i[f++],T=31&E,A=64&E,_=A?2+T*3:0,I=new Uint8Array(_);if(A){I[0]=E;for(let C=1;C<_;C++)I[C]=i[f++]}s.push({type:S,payloadType:l,pts:t,bytes:I})}}}}}else if(l===5&&c>16){const g=[];for(let S=0;S<16;S++){const E=i[f++].toString(16);g.push(E.length==1?"0"+E:E),(S===3||S===5||S===7||S===9)&&g.push("-")}const y=c-16,x=new Uint8Array(y);for(let S=0;S<y;S++)x[S]=i[f++];s.push({payloadType:l,pts:t,uuid:g.join(""),userData:xi(x),userDataBytes:x})}}}function OS(n){const e=n.byteLength,t=[];let s=1;for(;s<e-2;)n[s]===0&&n[s+1]===0&&n[s+2]===3?(t.push(s+2),s+=2):s++;if(t.length===0)return n;const i=e-t.length,r=new Uint8Array(i);let l=0;for(s=0;s<i;l++,s++)l===t[0]&&(l++,t.shift()),r[s]=n[l];return r}function N1(n){const e=n[0];let t="",s="",i=0,r=0,l=0,c=0,h=0,u=0;if(e===0){for(;hs(n.subarray(u,u+1))!=="\0";)t+=hs(n.subarray(u,u+1)),u+=1;for(t+=hs(n.subarray(u,u+1)),u+=1;hs(n.subarray(u,u+1))!=="\0";)s+=hs(n.subarray(u,u+1)),u+=1;s+=hs(n.subarray(u,u+1)),u+=1,i=Ye(n,12),r=Ye(n,16),c=Ye(n,20),h=Ye(n,24),u=28}else if(e===1){u+=4,i=Ye(n,u),u+=4;const g=Ye(n,u);u+=4;const y=Ye(n,u);for(u+=4,l=2**32*g+y,l1(l)||(l=Number.MAX_SAFE_INTEGER,Lt.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),c=Ye(n,u),u+=4,h=Ye(n,u),u+=4;hs(n.subarray(u,u+1))!=="\0";)t+=hs(n.subarray(u,u+1)),u+=1;for(t+=hs(n.subarray(u,u+1)),u+=1;hs(n.subarray(u,u+1))!=="\0";)s+=hs(n.subarray(u,u+1)),u+=1;s+=hs(n.subarray(u,u+1)),u+=1}const f=n.subarray(u,n.byteLength);return{schemeIdUri:t,value:s,timeScale:i,presentationTime:l,presentationTimeDelta:r,eventDuration:c,id:h,payload:f}}function O1(n,...e){const t=e.length;let s=8,i=t;for(;i--;)s+=e[i].byteLength;const r=new Uint8Array(s);for(r[0]=s>>24&255,r[1]=s>>16&255,r[2]=s>>8&255,r[3]=s&255,r.set(n,4),i=0,s=8;i<t;i++)r.set(e[i],s),s+=e[i].byteLength;return r}function k1(n,e,t){if(n.byteLength!==16)throw new RangeError("Invalid system id");let s,i;s=0,i=new Uint8Array;let r;s>0?(r=new Uint8Array(4),e.length>0&&new DataView(r.buffer).setUint32(0,e.length,!1)):r=new Uint8Array;const l=new Uint8Array(4);return t.byteLength>0&&new DataView(l.buffer).setUint32(0,t.byteLength,!1),O1([112,115,115,104],new Uint8Array([s,0,0,0]),n,r,i,l,t)}function D1(n){const e=[];if(n instanceof ArrayBuffer){const t=n.byteLength;let s=0;for(;s+32<t;){const i=new DataView(n,s),r=P1(i);e.push(r),s+=r.size}}return e}function P1(n){const e=n.getUint32(0),t=n.byteOffset,s=n.byteLength;if(s<e)return{offset:t,size:s};if(n.getUint32(4)!==1886614376)return{offset:t,size:e};const r=n.getUint32(8)>>>24;if(r!==0&&r!==1)return{offset:t,size:e};const l=n.buffer,c=Is(new Uint8Array(l,t+12,16));let h=null,u=null,f=0;if(r===0)f=28;else{const y=n.getUint32(28);if(!y||s<32+y*16)return{offset:t,size:e};h=[];for(let x=0;x<y;x++)h.push(new Uint8Array(l,t+32+x*16,16));f=32+y*16}if(!f)return{offset:t,size:e};const g=n.getUint32(f);return e-32<g?{offset:t,size:e}:(u=new Uint8Array(l,t+f+4,g),{version:r,systemId:c,kids:h,data:u,offset:t,size:e})}const kS=()=>/\(Windows.+Firefox\//i.test(navigator.userAgent),Hr={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function Sm(n,e){const t=Hr[e];return!!t&&!!t[n.slice(0,4)]}function Ql(n,e,t=!0){return!n.split(",").some(s=>!bm(s,e,t))}function bm(n,e,t=!0){var s;const i=Ea(t);return(s=i?.isTypeSupported(Wl(n,e)))!=null?s:!1}function Wl(n,e){return`${e}/mp4;codecs=${n}`}function gv(n){if(n){const e=n.substring(0,4);return Hr.video[e]}return 2}function mu(n){const e=kS();return n.split(",").reduce((t,s)=>{const r=e&&Pu(s)?9:Hr.video[s];return r?(r*2+t)/(t?3:2):(Hr.audio[s]+t)/(t?2:1)},0)}const cf={};function U1(n,e=!0){if(cf[n])return cf[n];const t={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[n];for(let i=0;i<t.length;i++){var s;if(bm(t[i],"audio",e))return cf[n]=t[i],t[i];if(t[i]==="mp3"&&(s=Ea(e))!=null&&s.isTypeSupported("audio/mpeg"))return""}return n}const M1=/flac|opus|mp4a\.40\.34/i;function pu(n,e=!0){return n.replace(M1,t=>U1(t.toLowerCase(),e))}function j1(n,e){const t=[];if(n){const s=n.split(",");for(let i=0;i<s.length;i++)Sm(s[i],"video")||t.push(s[i])}return e&&t.push(e),t.join(",")}function tu(n,e){if(n&&(n.length>4||["ac-3","ec-3","alac","fLaC","Opus"].indexOf(n)!==-1)&&(yv(n,"audio")||yv(n,"video")))return n;if(e){const t=e.split(",");if(t.length>1){if(n){for(let s=t.length;s--;)if(t[s].substring(0,4)===n.substring(0,4))return t[s]}return t[0]}}return e||n}function yv(n,e){return Sm(n,e)&&bm(n,e)}function B1(n){const e=n.split(",");for(let t=0;t<e.length;t++){const s=e[t].split(".");s.length>2&&s[0]==="avc1"&&(e[t]=`avc1.${parseInt(s[1]).toString(16)}${("000"+parseInt(s[2]).toString(16)).slice(-4)}`)}return e.join(",")}function F1(n){if(n.startsWith("av01.")){const e=n.split("."),t=["0","111","01","01","01","0"];for(let s=e.length;s>4&&s<10;s++)e[s]=t[s-4];return e.join(".")}return n}function vv(n){const e=Ea(n)||{isTypeSupported:()=>!1};return{mpeg:e.isTypeSupported("audio/mpeg"),mp3:e.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:e.isTypeSupported('audio/mp4; codecs="ac-3"')}}function Ff(n){return n.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}const V1={supported:!0,powerEfficient:!0,smooth:!0},$1={supported:!1,smooth:!1,powerEfficient:!1},DS={supported:!0,configurations:[],decodingInfoResults:[V1]};function PS(n,e){return{supported:!1,configurations:e,decodingInfoResults:[$1],error:n}}function G1(n,e,t,s,i,r){const l=n.videoCodec,c=n.audioCodec?n.audioGroups:null,h=r?.audioCodec,u=r?.channels,f=u?parseInt(u):h?1/0:2;let g=null;if(c!=null&&c.length)try{c.length===1&&c[0]?g=e.groups[c[0]].channels:g=c.reduce((y,x)=>{if(x){const S=e.groups[x];if(!S)throw new Error(`Audio track group ${x} not found`);Object.keys(S.channels).forEach(E=>{y[E]=(y[E]||0)+S.channels[E]})}return y},{2:0})}catch{return!0}return l!==void 0&&(l.split(",").some(y=>Pu(y))||n.width>1920&&n.height>1088||n.height>1920&&n.width>1088||n.frameRate>Math.max(s,30)||n.videoRange!=="SDR"&&n.videoRange!==t||n.bitrate>Math.max(i,8e6))||!!g&&Ne(f)&&Object.keys(g).some(y=>parseInt(y)>f)}function US(n,e,t,s={}){const i=n.videoCodec;if(!i&&!n.audioCodec||!t)return Promise.resolve(DS);const r=[],l=H1(n),c=l.length,h=z1(n,e,c>0),u=h.length;for(let f=c||1*u||1;f--;){const g={type:"media-source"};if(c&&(g.video=l[f%c]),u){g.audio=h[f%u];const y=g.audio.bitrate;g.video&&y&&(g.video.bitrate-=y)}r.push(g)}if(i){const f=navigator.userAgent;if(i.split(",").some(g=>Pu(g))&&kS())return Promise.resolve(PS(new Error(`Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent string: (${f})`),r))}return Promise.all(r.map(f=>{const g=Y1(f);return s[g]||(s[g]=t.decodingInfo(f))})).then(f=>({supported:!f.some(g=>!g.supported),configurations:r,decodingInfoResults:f})).catch(f=>({supported:!1,configurations:r,decodingInfoResults:[],error:f}))}function H1(n){var e;const t=(e=n.videoCodec)==null?void 0:e.split(","),s=MS(n),i=n.width||640,r=n.height||480,l=n.frameRate||30,c=n.videoRange.toLowerCase();return t?t.map(h=>{const u={contentType:Wl(F1(h),"video"),width:i,height:r,bitrate:s,framerate:l};return c!=="sdr"&&(u.transferFunction=c),u}):[]}function z1(n,e,t){var s;const i=(s=n.audioCodec)==null?void 0:s.split(","),r=MS(n);return i&&n.audioGroups?n.audioGroups.reduce((l,c)=>{var h;const u=c?(h=e.groups[c])==null?void 0:h.tracks:null;return u?u.reduce((f,g)=>{if(g.groupId===c){const y=parseFloat(g.channels||"");i.forEach(x=>{const S={contentType:Wl(x,"audio"),bitrate:t?K1(x,r):r};y&&(S.channels=""+y),f.push(S)})}return f},l):l},[]):[]}function K1(n,e){if(e<=1)return 1;let t=128e3;return n==="ec-3"?t=768e3:n==="ac-3"&&(t=64e4),Math.min(e/2,t)}function MS(n){return Math.ceil(Math.max(n.bitrate*.9,n.averageBitrate)/1e3)*1e3||1}function Y1(n){let e="";const{audio:t,video:s}=n;if(s){const i=Ff(s.contentType);e+=`${i}_r${s.height}x${s.width}f${Math.ceil(s.framerate)}${s.transferFunction||"sd"}_${Math.ceil(s.bitrate/1e5)}`}if(t){const i=Ff(t.contentType);e+=`${s?"_":""}${i}_c${t.channels}`}return e}const Vf=["NONE","TYPE-0","TYPE-1",null];function q1(n){return Vf.indexOf(n)>-1}const gu=["SDR","PQ","HLG"];function Q1(n){return!!n&&gu.indexOf(n)>-1}var su={No:"",Yes:"YES",v2:"v2"};function xv(n){const{canSkipUntil:e,canSkipDateRanges:t,age:s}=n,i=s<e/2;return e&&i?t?su.v2:su.Yes:su.No}class Sv{constructor(e,t,s){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=s}addDirectives(e){const t=new self.URL(e);return this.msn!==void 0&&t.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class Xl{constructor(e){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter(s=>!!s).map(s=>s.substring(0,4)).join(","),"supplemental"in e){var t;this.supplemental=e.supplemental;const s=(t=e.supplemental)==null?void 0:t.videoCodec;s&&s!==e.videoCodec&&(this.codecSet+=`,${s.substring(0,4)}`)}this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return bv(this._audioGroups,e)}hasSubtitleGroup(e){return bv(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,t){if(t){if(e==="audio"){let s=this._audioGroups;s||(s=this._audioGroups=[]),s.indexOf(t)===-1&&s.push(t)}else if(e==="text"){let s=this._subtitleGroups;s||(s=this._subtitleGroups=[]),s.indexOf(t)===-1&&s.push(t)}}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return(e=this.audioGroups)==null?void 0:e[0]}get textGroupId(){var e;return(e=this.subtitleGroups)==null?void 0:e[0]}addFallback(){}}function bv(n,e){return!e||!n?!1:n.indexOf(e)!==-1}function W1(){if(typeof matchMedia=="function"){const n=matchMedia("(dynamic-range: high)"),e=matchMedia("bad query");if(n.media!==e.media)return n.matches===!0}return!1}function X1(n,e){let t=!1,s=[];if(n&&(t=n!=="SDR",s=[n]),e){s=e.allowedVideoRanges||gu.slice(0);const i=s.join("")!=="SDR"&&!e.videoCodec;t=e.preferHDR!==void 0?e.preferHDR:i&&W1(),t||(s=["SDR"])}return{preferHDR:t,allowedVideoRanges:s}}const Z1=n=>{const e=new WeakSet;return(t,s)=>{if(n&&(s=n(t,s)),typeof s=="object"&&s!==null){if(e.has(s))return;e.add(s)}return s}},Mt=(n,e)=>JSON.stringify(n,Z1(e));function J1(n,e,t,s,i){const r=Object.keys(n),l=s?.channels,c=s?.audioCodec,h=i?.videoCodec,u=l&&parseInt(l)===2;let f=!1,g=!1,y=1/0,x=1/0,S=1/0,E=1/0,T=0,A=[];const{preferHDR:_,allowedVideoRanges:I}=X1(e,i);for(let B=r.length;B--;){const j=n[r[B]];f||(f=j.channels[2]>0),y=Math.min(y,j.minHeight),x=Math.min(x,j.minFramerate),S=Math.min(S,j.minBitrate),I.filter(K=>j.videoRanges[K]>0).length>0&&(g=!0)}y=Ne(y)?y:0,x=Ne(x)?x:0;const C=Math.max(1080,y),N=Math.max(30,x);S=Ne(S)?S:t,t=Math.max(S,t),g||(e=void 0);const D=r.length>1;return{codecSet:r.reduce((B,j)=>{const U=n[j];if(j===B)return B;if(A=g?I.filter(K=>U.videoRanges[K]>0):[],D){if(U.minBitrate>t)return an(j,`min bitrate of ${U.minBitrate} > current estimate of ${t}`),B;if(!U.hasDefaultAudio)return an(j,"no renditions with default or auto-select sound found"),B;if(c&&j.indexOf(c.substring(0,4))%5!==0)return an(j,`audio codec preference "${c}" not found`),B;if(l&&!u){if(!U.channels[l])return an(j,`no renditions with ${l} channel sound found (channels options: ${Object.keys(U.channels)})`),B}else if((!c||u)&&f&&U.channels[2]===0)return an(j,"no renditions with stereo sound found"),B;if(U.minHeight>C)return an(j,`min resolution of ${U.minHeight} > maximum of ${C}`),B;if(U.minFramerate>N)return an(j,`min framerate of ${U.minFramerate} > maximum of ${N}`),B;if(!A.some(K=>U.videoRanges[K]>0))return an(j,`no variants with VIDEO-RANGE of ${Mt(A)} found`),B;if(h&&j.indexOf(h.substring(0,4))%5!==0)return an(j,`video codec preference "${h}" not found`),B;if(U.maxScore<T)return an(j,`max score of ${U.maxScore} < selected max of ${T}`),B}return B&&(mu(j)>=mu(B)||U.fragmentError>n[B].fragmentError)?B:(E=U.minIndex,T=U.maxScore,j)},void 0),videoRanges:A,preferHDR:_,minFramerate:x,minBitrate:S,minIndex:E}}function an(n,e){Lt.log(`[abr] start candidates with "${n}" ignored because ${e}`)}function jS(n){return n.reduce((e,t)=>{let s=e.groups[t.groupId];s||(s=e.groups[t.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),s.tracks.push(t);const i=t.channels||"2";return s.channels[i]=(s.channels[i]||0)+1,s.hasDefault=s.hasDefault||t.default,s.hasAutoSelect=s.hasAutoSelect||t.autoselect,s.hasDefault&&(e.hasDefaultAudio=!0),s.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function ew(n,e,t,s){return n.slice(t,s+1).reduce((i,r,l)=>{if(!r.codecSet)return i;const c=r.audioGroups;let h=i[r.codecSet];h||(i[r.codecSet]=h={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:l,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!c,fragmentError:0}),h.minBitrate=Math.min(h.minBitrate,r.bitrate);const u=Math.min(r.height,r.width);return h.minHeight=Math.min(h.minHeight,u),h.minFramerate=Math.min(h.minFramerate,r.frameRate),h.minIndex=Math.min(h.minIndex,l),h.maxScore=Math.max(h.maxScore,r.score),h.fragmentError+=r.fragmentError,h.videoRanges[r.videoRange]=(h.videoRanges[r.videoRange]||0)+1,c&&c.forEach(f=>{if(!f)return;const g=e.groups[f];g&&(h.hasDefaultAudio=h.hasDefaultAudio||e.hasDefaultAudio?g.hasDefault:g.hasAutoSelect||!e.hasDefaultAudio&&!e.hasAutoSelectAudio,Object.keys(g.channels).forEach(y=>{h.channels[y]=(h.channels[y]||0)+g.channels[y]}))}),i},{})}function Tv(n){if(!n)return n;const{lang:e,assocLang:t,characteristics:s,channels:i,audioCodec:r}=n;return{lang:e,assocLang:t,characteristics:s,channels:i,audioCodec:r}}function cn(n,e,t){if("attrs"in n){const s=e.indexOf(n);if(s!==-1)return s}for(let s=0;s<e.length;s++){const i=e[s];if(Ya(n,i,t))return s}return-1}function Ya(n,e,t){const{groupId:s,name:i,lang:r,assocLang:l,default:c}=n,h=n.forced;return(s===void 0||e.groupId===s)&&(i===void 0||e.name===i)&&(r===void 0||tw(r,e.lang))&&(r===void 0||e.assocLang===l)&&(c===void 0||e.default===c)&&(h===void 0||e.forced===h)&&(!("characteristics"in n)||sw(n.characteristics||"",e.characteristics))&&(t===void 0||t(n,e))}function tw(n,e="--"){return n.length===e.length?n===e:n.startsWith(e)||e.startsWith(n)}function sw(n,e=""){const t=n.split(","),s=e.split(",");return t.length===s.length&&!t.some(i=>s.indexOf(i)===-1)}function Ha(n,e){const{audioCodec:t,channels:s}=n;return(t===void 0||(e.audioCodec||"").substring(0,4)===t.substring(0,4))&&(s===void 0||s===(e.channels||"2"))}function iw(n,e,t,s,i){const r=e[s],c=e.reduce((y,x,S)=>{const E=x.uri;return(y[E]||(y[E]=[])).push(S),y},{})[r.uri];c.length>1&&(s=Math.max.apply(Math,c));const h=r.videoRange,u=r.frameRate,f=r.codecSet.substring(0,4),g=Ev(e,s,y=>{if(y.videoRange!==h||y.frameRate!==u||y.codecSet.substring(0,4)!==f)return!1;const x=y.audioGroups,S=t.filter(E=>!x||x.indexOf(E.groupId)!==-1);return cn(n,S,i)>-1});return g>-1?g:Ev(e,s,y=>{const x=y.audioGroups,S=t.filter(E=>!x||x.indexOf(E.groupId)!==-1);return cn(n,S,i)>-1})}function Ev(n,e,t){for(let s=e;s>-1;s--)if(t(n[s]))return s;for(let s=e+1;s<n.length;s++)if(t(n[s]))return s;return-1}function yu(n,e){var t;return!!n&&n!==((t=e.loadLevelObj)==null?void 0:t.uri)}class nw extends ji{constructor(e){super("abr",e.logger),this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.rebufferNotice=-1,this.supportedCache={},this.bwEstimator=void 0,this._abandonRulesCheck=t=>{var s;const{fragCurrent:i,partCurrent:r,hls:l}=this,{autoLevelEnabled:c,media:h}=l;if(!i||!h)return;const u=performance.now(),f=r?r.stats:i.stats,g=r?r.duration:i.duration,y=u-f.loading.start,x=l.minAutoLevel,S=i.level,E=this._nextAutoLevel;if(f.aborted||f.loaded&&f.loaded===f.total||S<=x){this.clearTimer(),this._nextAutoLevel=-1;return}if(!c)return;const T=E>-1&&E!==S,A=!!t||T;if(!A&&(h.paused||!h.playbackRate||!h.readyState))return;const _=l.mainForwardBufferInfo;if(!A&&_===null)return;const I=this.bwEstimator.getEstimateTTFB(),C=Math.abs(h.playbackRate);if(y<=Math.max(I,1e3*(g/(C*2))))return;const N=_?_.len/C:0,D=f.loading.first?f.loading.first-f.loading.start:-1,k=f.loaded&&D>-1,B=this.getBwEstimate(),j=l.levels,U=j[S],K=Math.max(f.loaded,Math.round(g*(i.bitrate||U.averageBitrate)/8));let H=k?y-D:y;H<1&&k&&(H=Math.min(y,f.loaded*8/B));const J=k?f.loaded*1e3/H:0,re=I/1e3,me=J?(K-f.loaded)/J:K*8/B+re;if(me<=N)return;const M=J?J*8:B,$=((s=t?.details||this.hls.latestLevelDetails)==null?void 0:s.live)===!0,F=this.hls.config.abrBandWidthUpFactor;let ae=Number.POSITIVE_INFINITY,de;for(de=S-1;de>x;de--){const fe=j[de].maxBitrate,ve=!j[de].details||$;if(ae=this.getTimeToLoadFrag(re,M,g*fe,ve),ae<Math.min(N,g+re))break}if(ae>=me||ae>g*10)return;k?this.bwEstimator.sample(y-Math.min(I,D),f.loaded):this.bwEstimator.sampleTTFB(y);const P=j[de].maxBitrate;this.getBwEstimate()*F>P&&this.resetEstimator(P);const G=this.findBestLevel(P,x,de,0,N,1,1);G>-1&&(de=G),this.warn(`Fragment ${i.sn}${r?" part "+r.index:""} of level ${S} is loading too slowly;
      Fragment duration: ${i.duration.toFixed(3)}
      Time to underbuffer: ${N.toFixed(3)} s
      Estimated load time for current fragment: ${me.toFixed(3)} s
      Estimated load time for down switch fragment: ${ae.toFixed(3)} s
      TTFB estimate: ${D|0} ms
      Current BW estimate: ${Ne(B)?B|0:"Unknown"} bps
      New BW estimate: ${this.getBwEstimate()|0} bps
      Switching to level ${de} @ ${P|0} bps`),l.nextLoadLevel=l.nextAutoLevel=de,this.clearTimer();const te=()=>{if(this.clearTimer(),this.fragCurrent===i&&this.hls.loadLevel===de&&de>0){const fe=this.getStarvationDelay();if(this.warn(`Aborting inflight request ${de>0?"and switching down":""}
      Fragment duration: ${i.duration.toFixed(3)} s
      Time to underbuffer: ${fe.toFixed(3)} s`),i.abortRequests(),this.fragCurrent=this.partCurrent=null,de>x){let ve=this.findBestLevel(this.hls.levels[x].bitrate,x,de,0,fe,1,1);ve===-1&&(ve=x),this.hls.nextLoadLevel=this.hls.nextAutoLevel=ve,this.resetEstimator(this.hls.levels[ve].bitrate)}}};T||me>ae*2?te():this.timer=self.setInterval(te,ae*1e3),l.trigger(L.FRAG_LOAD_EMERGENCY_ABORTED,{frag:i,part:r,stats:f})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(this.log(`setting initial bwe to ${e}`),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const e=this.hls.config;return new c1(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){const{hls:e}=this;e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.FRAG_LOADING,this.onFragLoading,this),e.on(L.FRAG_LOADED,this.onFragLoaded,this),e.on(L.FRAG_BUFFERED,this.onFragBuffered,this),e.on(L.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(L.LEVEL_LOADED,this.onLevelLoaded,this),e.on(L.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(L.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(L.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e&&(e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.FRAG_LOADING,this.onFragLoading,this),e.off(L.FRAG_LOADED,this.onFragLoaded,this),e.off(L.FRAG_BUFFERED,this.onFragBuffered,this),e.off(L.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(L.LEVEL_LOADED,this.onLevelLoaded,this),e.off(L.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(L.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(L.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=this.supportedCache=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.supportedCache={},this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,t){const s=t.frag;if(!this.ignoreFragment(s)){if(!s.bitrateTest){var i;this.fragCurrent=s,this.partCurrent=(i=t.part)!=null?i:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,t){this.clearTimer()}onError(e,t){if(!t.fatal)switch(t.details){case Q.BUFFER_ADD_CODEC_ERROR:case Q.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case Q.FRAG_LOAD_TIMEOUT:{const s=t.frag,{fragCurrent:i,partCurrent:r}=this;if(s&&i&&s.sn===i.sn&&s.level===i.level){const l=performance.now(),c=r?r.stats:s.stats,h=l-c.loading.start,u=c.loading.first?c.loading.first-c.loading.start:-1;if(c.loaded&&u>-1){const g=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(h-Math.min(g,u),c.loaded)}else this.bwEstimator.sampleTTFB(h)}break}}}getTimeToLoadFrag(e,t,s,i){const r=e+s/t,l=i?e+this.lastLevelLoadSec:0;return r+l}onLevelLoaded(e,t){const s=this.hls.config,{loading:i}=t.stats,r=i.end-i.first;Ne(r)&&(this.lastLevelLoadSec=r/1e3),t.details.live?this.bwEstimator.update(s.abrEwmaSlowLive,s.abrEwmaFastLive):this.bwEstimator.update(s.abrEwmaSlowVoD,s.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(t.levelInfo)}onFragLoaded(e,{frag:t,part:s}){const i=s?s.stats:t.stats;if(t.type===ke.MAIN&&this.bwEstimator.sampleTTFB(i.loading.first-i.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),t.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const r=s?s.duration:t.duration,l=this.hls.levels[t.level],c=(l.loaded?l.loaded.bytes:0)+i.loaded,h=(l.loaded?l.loaded.duration:0)+r;l.loaded={bytes:c,duration:h},l.realBitrate=Math.round(8*c/h)}if(t.bitrateTest){const r={stats:i,frag:t,part:s,id:t.type};this.onFragBuffered(L.FRAG_BUFFERED,r),t.bitrateTest=!1}else this.lastLoadedFragLevel=t.level}}onFragBuffered(e,t){const{frag:s,part:i}=t,r=i!=null&&i.stats.loaded?i.stats:s.stats;if(r.aborted||this.ignoreFragment(s))return;const l=r.parsing.end-r.loading.start-Math.min(r.loading.first-r.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(l,r.loaded),r.bwEstimate=this.getBwEstimate(),s.bitrateTest?this.bitrateTestDelay=l/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==ke.MAIN||e.sn==="initSegment"}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:e,minAutoLevel:t}=this.hls,s=this.getBwEstimate(),i=this.hls.config.maxStarvationDelay,r=this.findBestLevel(s,t,e,0,i,1,1);if(r>-1)return r;const l=this.hls.firstLevel,c=Math.min(Math.max(l,t),e);return this.warn(`Could not find best starting auto level. Defaulting to first in playlist ${l} clamped to ${c}`),c}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const e=this.forcedAutoLevel,s=this.bwEstimator.canEstimate(),i=this.lastLoadedFragLevel>-1;if(e!==-1&&(!s||!i||this.nextAutoLevelKey===this.getAutoLevelKey()))return e;const r=s&&i?this.getNextABRAutoLevel():this.firstAutoLevel;if(e!==-1){const l=this.hls.levels;if(l.length>Math.max(e,r)&&l[e].loadError<=l[r].loadError)return e}return this._nextAutoLevel=r,this.nextAutoLevelKey=this.getAutoLevelKey(),r}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:t,hls:s}=this;if(s.levels.length<=1)return s.loadLevel;const{maxAutoLevel:i,config:r,minAutoLevel:l}=s,c=t?t.duration:e?e.duration:0,h=this.getBwEstimate(),u=this.getStarvationDelay();let f=r.abrBandWidthFactor,g=r.abrBandWidthUpFactor;if(u){const T=this.findBestLevel(h,l,i,u,0,f,g);if(T>=0)return this.rebufferNotice=-1,T}let y=c?Math.min(c,r.maxStarvationDelay):r.maxStarvationDelay;if(!u){const T=this.bitrateTestDelay;T&&(y=(c?Math.min(c,r.maxLoadingDelay):r.maxLoadingDelay)-T,this.info(`bitrate test took ${Math.round(1e3*T)}ms, set first fragment max fetchDuration to ${Math.round(1e3*y)} ms`),f=g=1)}const x=this.findBestLevel(h,l,i,u,y,f,g);if(this.rebufferNotice!==x&&(this.rebufferNotice=x,this.info(`${u?"rebuffering expected":"buffer is empty"}, optimal quality level ${x}`)),x>-1)return x;const S=s.levels[l],E=s.loadLevelObj;return E&&S?.bitrate<E.bitrate?l:s.loadLevel}getStarvationDelay(){const e=this.hls,t=e.media;if(!t)return 1/0;const s=t&&t.playbackRate!==0?Math.abs(t.playbackRate):1,i=e.mainForwardBufferInfo;return(i?i.len:0)/s}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,t,s,i,r,l,c){var h;const u=i+r,f=this.lastLoadedFragLevel,g=f===-1?this.hls.firstLevel:f,{fragCurrent:y,partCurrent:x}=this,{levels:S,allAudioTracks:E,loadLevel:T,config:A}=this.hls;if(S.length===1)return 0;const _=S[g],I=!!((h=this.hls.latestLevelDetails)!=null&&h.live),C=T===-1||f===-1;let N,D="SDR",k=_?.frameRate||0;const{audioPreference:B,videoPreference:j}=A,U=this.audioTracksByGroup||(this.audioTracksByGroup=jS(E));let K=-1;if(C){if(this.firstSelection!==-1)return this.firstSelection;const M=this.codecTiers||(this.codecTiers=ew(S,U,t,s)),$=J1(M,D,e,B,j),{codecSet:F,videoRanges:ae,minFramerate:de,minBitrate:P,minIndex:G,preferHDR:te}=$;K=G,N=F,D=te?ae[ae.length-1]:ae[0],k=de,e=Math.max(e,P),this.log(`picked start tier ${Mt($)}`)}else N=_?.codecSet,D=_?.videoRange;const H=x?x.duration:y?y.duration:0,J=this.bwEstimator.getEstimateTTFB()/1e3,re=[];for(let M=s;M>=t;M--){var me;const $=S[M],F=M>g;if(!$)continue;if(A.useMediaCapabilities&&!$.supportedResult&&!$.supportedPromise){const ve=navigator.mediaCapabilities;typeof ve?.decodingInfo=="function"&&G1($,U,D,k,e,B)?($.supportedPromise=US($,U,ve,this.supportedCache),$.supportedPromise.then(Ae=>{if(!this.hls)return;$.supportedResult=Ae;const De=this.hls.levels,Ge=De.indexOf($);Ae.error?this.warn(`MediaCapabilities decodingInfo error: "${Ae.error}" for level ${Ge} ${Mt(Ae)}`):Ae.supported?Ae.decodingInfoResults.some(Fe=>Fe.smooth===!1||Fe.powerEfficient===!1)&&this.log(`MediaCapabilities decodingInfo for level ${Ge} not smooth or powerEfficient: ${Mt(Ae)}`):(this.warn(`Unsupported MediaCapabilities decodingInfo result for level ${Ge} ${Mt(Ae)}`),Ge>-1&&De.length>1&&(this.log(`Removing unsupported level ${Ge}`),this.hls.removeLevel(Ge),this.hls.loadLevel===-1&&(this.hls.nextLoadLevel=0)))}).catch(Ae=>{this.warn(`Error handling MediaCapabilities decodingInfo: ${Ae}`)})):$.supportedResult=DS}if((N&&$.codecSet!==N||D&&$.videoRange!==D||F&&k>$.frameRate||!F&&k>0&&k<$.frameRate||(me=$.supportedResult)!=null&&(me=me.decodingInfoResults)!=null&&me.some(ve=>ve.smooth===!1))&&(!C||M!==K)){re.push(M);continue}const ae=$.details,de=(x?ae?.partTarget:ae?.averagetargetduration)||H;let P;F?P=c*e:P=l*e;const G=H&&i>=H*2&&r===0?$.averageBitrate:$.maxBitrate,te=this.getTimeToLoadFrag(J,P,G*de,ae===void 0);if(P>=G&&(M===f||$.loadError===0&&$.fragmentError===0)&&(te<=J||!Ne(te)||I&&!this.bitrateTestDelay||te<u)){const ve=this.forcedAutoLevel;return M!==T&&(ve===-1||ve!==T)&&(re.length&&this.trace(`Skipped level(s) ${re.join(",")} of ${s} max with CODECS and VIDEO-RANGE:"${S[re[0]].codecs}" ${S[re[0]].videoRange}; not compatible with "${N}" ${D}`),this.info(`switch candidate:${g}->${M} adjustedbw(${Math.round(P)})-bitrate=${Math.round(P-G)} ttfb:${J.toFixed(1)} avgDuration:${de.toFixed(1)} maxFetchDuration:${u.toFixed(1)} fetchDuration:${te.toFixed(1)} firstSelection:${C} codecSet:${$.codecSet} videoRange:${$.videoRange} hls.loadLevel:${T}`)),C&&(this.firstSelection=M),M}}return-1}set nextAutoLevel(e){const t=this.deriveNextAutoLevel(e);this._nextAutoLevel!==t&&(this.nextAutoLevelKey="",this._nextAutoLevel=t)}deriveNextAutoLevel(e){const{maxAutoLevel:t,minAutoLevel:s}=this.hls;return Math.min(Math.max(e,s),t)}}const BS={search:function(n,e){let t=0,s=n.length-1,i=null,r=null;for(;t<=s;){i=(t+s)/2|0,r=n[i];const l=e(r);if(l>0)t=i+1;else if(l<0)s=i-1;else return r}return null}};function aw(n,e,t){if(e===null||!Array.isArray(n)||!n.length||!Ne(e))return null;const s=n[0].programDateTime;if(e<(s||0))return null;const i=n[n.length-1].endProgramDateTime;if(e>=(i||0))return null;for(let r=0;r<n.length;++r){const l=n[r];if(lw(e,t,l))return l}return null}function Qa(n,e,t=0,s=0,i=.005){let r=null;if(n){r=e[1+n.sn-e[0].sn]||null;const c=n.endDTS-t;c>0&&c<15e-7&&(t+=15e-7),r&&n.level!==r.level&&r.end<=n.end&&(r=e[2+n.sn-e[0].sn]||null)}else t===0&&e[0].start===0&&(r=e[0]);if(r&&((!n||n.level===r.level)&&Av(t,s,r)===0||rw(r,n,Math.min(i,s))))return r;const l=BS.search(e,Av.bind(null,t,s));return l&&(l!==n||!r)?l:r}function rw(n,e,t){if(e&&e.start===0&&e.level<n.level&&(e.endPTS||0)>0){const s=e.tagList.reduce((i,r)=>(r[0]==="INF"&&(i+=parseFloat(r[1])),i),t);return n.start<=s}return!1}function Av(n=0,e=0,t){if(t.start<=n&&t.start+t.duration>n)return 0;const s=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0));return t.start+t.duration-s<=n?1:t.start-s>n&&t.start?-1:0}function lw(n,e,t){const s=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0))*1e3;return(t.endProgramDateTime||0)-s>n}function FS(n,e,t){if(n&&n.startCC<=e&&n.endCC>=e){let s=n.fragments;const{fragmentHint:i}=n;i&&(s=s.concat(i));let r;return BS.search(s,l=>l.cc<e?1:l.cc>e?-1:(r=l,l.end<=t?1:l.start>t?-1:0)),r||null}return null}function vu(n){switch(n.details){case Q.FRAG_LOAD_TIMEOUT:case Q.KEY_LOAD_TIMEOUT:case Q.LEVEL_LOAD_TIMEOUT:case Q.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function VS(n){return n.details.startsWith("key")}function $S(n){return VS(n)&&!!n.frag&&!n.frag.decryptdata}function Iv(n,e){const t=vu(e);return n.default[`${t?"timeout":"error"}Retry`]}function Tm(n,e){const t=n.backoff==="linear"?1:Math.pow(2,e);return Math.min(t*n.retryDelayMs,n.maxRetryDelayMs)}function _v(n){return Rt(Rt({},n),{errorRetry:null,timeoutRetry:null})}function xu(n,e,t,s){if(!n)return!1;const i=s?.code,r=e<n.maxNumRetry&&(ow(i)||!!t);return n.shouldRetry?n.shouldRetry(n,e,t,s,r):r}function ow(n){return $f(n)||!!n&&(n<400||n>499)}function $f(n){return n===0&&navigator.onLine===!1}var As={DoNothing:0,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,RetryRequest:5},mi={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,MoveAllAlternatesMatchingKey:4};class cw extends ji{constructor(e){super("error-controller",e.logger),this.hls=void 0,this.playlistError=0,this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(L.ERROR,this.onError,this),e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off(L.ERROR,this.onError,this),e.off(L.ERROR,this.onErrorOut,this),e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return e?.type===ke.MAIN?e.level:this.getVariantIndex()}getVariantIndex(){var e;const t=this.hls,s=t.currentLevel;return(e=t.loadLevelObj)!=null&&e.details||s===-1?t.loadLevel:s}variantHasKey(e,t){if(e){var s;if((s=e.details)!=null&&s.hasKey(t))return!0;const i=e.audioGroups;if(i)return this.hls.allAudioTracks.filter(l=>i.indexOf(l.groupId)>=0).some(l=>{var c;return(c=l.details)==null?void 0:c.hasKey(t)})}return!1}onManifestLoading(){this.playlistError=0}onLevelUpdated(){this.playlistError=0}onError(e,t){var s;if(t.fatal)return;const i=this.hls,r=t.context;switch(t.details){case Q.FRAG_LOAD_ERROR:case Q.FRAG_LOAD_TIMEOUT:case Q.KEY_LOAD_ERROR:case Q.KEY_LOAD_TIMEOUT:t.errorAction=this.getFragRetryOrSwitchAction(t);return;case Q.FRAG_PARSING_ERROR:if((s=t.frag)!=null&&s.gap){t.errorAction=jr();return}case Q.FRAG_GAP:case Q.FRAG_DECRYPT_ERROR:{t.errorAction=this.getFragRetryOrSwitchAction(t),t.errorAction.action=As.SendAlternateToPenaltyBox;return}case Q.LEVEL_EMPTY_ERROR:case Q.LEVEL_PARSING_ERROR:{var l;const h=t.parent===ke.MAIN?t.level:i.loadLevel;t.details===Q.LEVEL_EMPTY_ERROR&&((l=t.context)!=null&&(l=l.levelDetails)!=null&&l.live)?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,h):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,h))}return;case Q.LEVEL_LOAD_ERROR:case Q.LEVEL_LOAD_TIMEOUT:typeof r?.level=="number"&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,r.level));return;case Q.AUDIO_TRACK_LOAD_ERROR:case Q.AUDIO_TRACK_LOAD_TIMEOUT:case Q.SUBTITLE_LOAD_ERROR:case Q.SUBTITLE_TRACK_LOAD_TIMEOUT:if(r){const h=i.loadLevelObj;if(h&&(r.type===at.AUDIO_TRACK&&h.hasAudioGroup(r.groupId)||r.type===at.SUBTITLE_TRACK&&h.hasSubtitleGroup(r.groupId))){t.errorAction=this.getPlaylistRetryOrSwitchAction(t,i.loadLevel),t.errorAction.action=As.SendAlternateToPenaltyBox,t.errorAction.flags=mi.MoveAllAlternatesMatchingHost;return}}return;case Q.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:t.errorAction={action:As.SendAlternateToPenaltyBox,flags:mi.MoveAllAlternatesMatchingHDCP};return;case Q.KEY_SYSTEM_SESSION_UPDATE_FAILED:case Q.KEY_SYSTEM_STATUS_INTERNAL_ERROR:case Q.KEY_SYSTEM_NO_SESSION:t.errorAction={action:As.SendAlternateToPenaltyBox,flags:mi.MoveAllAlternatesMatchingKey};return;case Q.BUFFER_ADD_CODEC_ERROR:case Q.REMUX_ALLOC_ERROR:case Q.BUFFER_APPEND_ERROR:if(!t.errorAction){var c;t.errorAction=this.getLevelSwitchAction(t,(c=t.level)!=null?c:i.loadLevel)}return;case Q.INTERNAL_EXCEPTION:case Q.BUFFER_APPENDING_ERROR:case Q.BUFFER_FULL_ERROR:case Q.LEVEL_SWITCH_ERROR:case Q.BUFFER_STALLED_ERROR:case Q.BUFFER_SEEK_OVER_HOLE:case Q.BUFFER_NUDGE_ON_STALL:t.errorAction=jr();return}t.type===Be.KEY_SYSTEM_ERROR&&(t.levelRetry=!1,t.errorAction=jr())}getPlaylistRetryOrSwitchAction(e,t){const s=this.hls,i=Iv(s.config.playlistLoadPolicy,e),r=this.playlistError++;if(xu(i,r,vu(e),e.response))return{action:As.RetryRequest,flags:mi.None,retryConfig:i,retryCount:r};const c=this.getLevelSwitchAction(e,t);return i&&(c.retryConfig=i,c.retryCount=r),c}getFragRetryOrSwitchAction(e){const t=this.hls,s=this.getVariantLevelIndex(e.frag),i=t.levels[s],{fragLoadPolicy:r,keyLoadPolicy:l}=t.config,c=Iv(VS(e)?l:r,e),h=t.levels.reduce((f,g)=>f+g.fragmentError,0);if(i&&(e.details!==Q.FRAG_GAP&&i.fragmentError++,!$S(e)&&xu(c,h,vu(e),e.response)))return{action:As.RetryRequest,flags:mi.None,retryConfig:c,retryCount:h};const u=this.getLevelSwitchAction(e,s);return c&&(u.retryConfig=c,u.retryCount=h),u}getLevelSwitchAction(e,t){const s=this.hls;t==null&&(t=s.loadLevel);const i=this.hls.levels[t];if(i){var r,l;const u=e.details;i.loadError++,u===Q.BUFFER_APPEND_ERROR&&i.fragmentError++;let f=-1;const{levels:g,loadLevel:y,minAutoLevel:x,maxAutoLevel:S}=s;!s.autoLevelEnabled&&!s.config.preserveManualLevelOnError&&(s.loadLevel=-1);const E=(r=e.frag)==null?void 0:r.type,A=(E===ke.AUDIO&&u===Q.FRAG_PARSING_ERROR||e.sourceBufferName==="audio"&&(u===Q.BUFFER_ADD_CODEC_ERROR||u===Q.BUFFER_APPEND_ERROR))&&g.some(({audioCodec:D})=>i.audioCodec!==D),I=e.sourceBufferName==="video"&&(u===Q.BUFFER_ADD_CODEC_ERROR||u===Q.BUFFER_APPEND_ERROR)&&g.some(({codecSet:D,audioCodec:k})=>i.codecSet!==D&&i.audioCodec===k),{type:C,groupId:N}=(l=e.context)!=null?l:{};for(let D=g.length;D--;){const k=(D+y)%g.length;if(k!==y&&k>=x&&k<=S&&g[k].loadError===0){var c,h;const B=g[k];if(u===Q.FRAG_GAP&&E===ke.MAIN&&e.frag){const j=g[k].details;if(j){const U=Qa(e.frag,j.fragments,e.frag.start);if(U!=null&&U.gap)continue}}else{if(C===at.AUDIO_TRACK&&B.hasAudioGroup(N)||C===at.SUBTITLE_TRACK&&B.hasSubtitleGroup(N))continue;if(E===ke.AUDIO&&(c=i.audioGroups)!=null&&c.some(j=>B.hasAudioGroup(j))||E===ke.SUBTITLE&&(h=i.subtitleGroups)!=null&&h.some(j=>B.hasSubtitleGroup(j))||A&&i.audioCodec===B.audioCodec||I&&i.codecSet===B.codecSet||!A&&i.codecSet!==B.codecSet)continue}f=k;break}}if(f>-1&&s.loadLevel!==f)return e.levelRetry=!0,this.playlistError=0,{action:As.SendAlternateToPenaltyBox,flags:mi.None,nextAutoLevel:f}}return{action:As.SendAlternateToPenaltyBox,flags:mi.MoveAllAlternatesMatchingHost}}onErrorOut(e,t){var s;switch((s=t.errorAction)==null?void 0:s.action){case As.DoNothing:break;case As.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(t),!t.errorAction.resolved&&t.details!==Q.FRAG_GAP?t.fatal=!0:/MediaSource readyState: ended/.test(t.error.message)&&(this.warn(`MediaSource ended after "${t.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError());break}if(t.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(e){const t=this.hls,s=e.errorAction;if(!s)return;const{flags:i}=s,r=s.nextAutoLevel;switch(i){case mi.None:this.switchLevel(e,r);break;case mi.MoveAllAlternatesMatchingHDCP:{const h=this.getVariantLevelIndex(e.frag),u=t.levels[h],f=u?.attrs["HDCP-LEVEL"];if(s.hdcpLevel=f,f==="NONE")this.warn("HDCP policy resticted output with HDCP-LEVEL=NONE");else if(f){t.maxHdcpLevel=Vf[Vf.indexOf(f)-1],s.resolved=!0,this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`);break}}case mi.MoveAllAlternatesMatchingKey:{const h=e.decryptdata;if(h){const u=this.hls.levels,f=u.length;for(let y=f;y--;)if(this.variantHasKey(u[y],h)){var l,c;this.log(`Banned key found in level ${y} (${u[y].bitrate}bps) or audio group "${(l=u[y].audioGroups)==null?void 0:l.join(",")}" (${(c=e.frag)==null?void 0:c.type} fragment) ${Is(h.keyId||[])}`),u[y].fragmentError++,u[y].loadError++,this.log(`Removing level ${y} with key error (${e.error})`),this.hls.removeLevel(y)}const g=e.frag;if(this.hls.levels.length<f)s.resolved=!0;else if(g&&g.type!==ke.MAIN){const y=g.decryptdata;y&&!h.matches(y)&&(s.resolved=!0)}}break}}s.resolved||this.switchLevel(e,r)}switchLevel(e,t){if(t!==void 0&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,e.details===Q.BUFFER_ADD_CODEC_ERROR&&e.mimeType&&e.sourceBufferName!=="audiovideo")){const s=Ff(e.mimeType),i=this.hls.levels;for(let r=i.length;r--;)i[r][`${e.sourceBufferName}Codec`]===s&&(this.log(`Removing level ${r} for ${e.details} ("${s}" not supported)`),this.hls.removeLevel(r))}}}function jr(n){const e={action:As.DoNothing,flags:mi.None};return n&&(e.resolved=!0),e}var fs={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class uw{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e&&(e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.BUFFER_APPENDED,this.onBufferAppended,this),e.on(L.FRAG_BUFFERED,this.onFragBuffered,this),e.on(L.FRAG_LOADED,this.onFragLoaded,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.BUFFER_APPENDED,this.onBufferAppended,this),e.off(L.FRAG_BUFFERED,this.onFragBuffered,this),e.off(L.FRAG_LOADED,this.onFragLoaded,this))}destroy(){this._unregisterListeners(),this.hls=this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){const s=this.activePartLists[t];if(s)for(let i=s.length;i--;){const r=s[i];if(!r)break;if(r.start<=e&&e<=r.end&&r.loaded)return r}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){return this.getFragAtPos(e,t,!0)}getFragAtPos(e,t,s){const{fragments:i}=this,r=Object.keys(i);for(let l=r.length;l--;){const c=i[r[l]];if(c?.body.type===t&&(!s||c.buffered)){const h=c.body;if(h.start<=e&&e<=h.end)return h}}return null}detectEvictedFragments(e,t,s,i,r){this.timeRanges&&(this.timeRanges[e]=t);const l=i?.fragment.sn||-1;Object.keys(this.fragments).forEach(c=>{const h=this.fragments[c];if(!h||l>=h.body.sn)return;if(!h.buffered&&(!h.loaded||r)){h.body.type===s&&this.removeFragment(h.body);return}const u=h.range[e];if(u){if(u.time.length===0){this.removeFragment(h.body);return}u.time.some(f=>{const g=!this.isTimeBuffered(f.startPTS,f.endPTS,t);return g&&this.removeFragment(h.body),g})}})}detectPartialFragments(e){const t=this.timeRanges;if(!t||e.frag.sn==="initSegment")return;const s=e.frag,i=Or(s),r=this.fragments[i];if(!r||r.buffered&&s.gap)return;const l=!s.relurl;Object.keys(t).forEach(c=>{const h=s.elementaryStreams[c];if(!h)return;const u=t[c],f=l||h.partial===!0;r.range[c]=this.getBufferedTimes(s,e.part,f,u)}),r.loaded=null,Object.keys(r.range).length?(this.bufferedEnd(r,s),Mc(r)||this.removeParts(s.sn-1,s.type)):this.removeFragment(r.body)}bufferedEnd(e,t){e.buffered=!0,(e.body.endList=t.endList||e.body.endList)&&(this.endListFragments[e.body.type]=e)}removeParts(e,t){const s=this.activePartLists[t];s&&(this.activePartLists[t]=Rv(s,i=>i.fragment.sn>=e))}fragBuffered(e,t){const s=Or(e);let i=this.fragments[s];!i&&t&&(i=this.fragments[s]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),i&&(i.loaded=null,this.bufferedEnd(i,e))}getBufferedTimes(e,t,s,i){const r={time:[],partial:s},l=e.start,c=e.end,h=e.minEndPTS||c,u=e.maxStartPTS||l;for(let f=0;f<i.length;f++){const g=i.start(f)-this.bufferPadding,y=i.end(f)+this.bufferPadding;if(u>=g&&h<=y){r.time.push({startPTS:Math.max(l,i.start(f)),endPTS:Math.min(c,i.end(f))});break}else if(l<y&&c>g){const x=Math.max(l,i.start(f)),S=Math.min(c,i.end(f));S>x&&(r.partial=!0,r.time.push({startPTS:x,endPTS:S}))}else if(c<=g)break}return r}getPartialFragment(e){let t=null,s,i,r,l=0;const{bufferPadding:c,fragments:h}=this;return Object.keys(h).forEach(u=>{const f=h[u];f&&Mc(f)&&(i=f.body.start-c,r=f.body.end+c,e>=i&&e<=r&&(s=Math.min(e-i,r-e),l<=s&&(t=f.body,l=s)))}),t}isEndListAppended(e){const t=this.endListFragments[e];return t!==void 0&&(t.buffered||Mc(t))}getState(e){const t=Or(e),s=this.fragments[t];return s?s.buffered?Mc(s)?fs.PARTIAL:fs.OK:fs.APPENDING:fs.NOT_LOADED}isTimeBuffered(e,t,s){let i,r;for(let l=0;l<s.length;l++){if(i=s.start(l)-this.bufferPadding,r=s.end(l)+this.bufferPadding,e>=i&&t<=r)return!0;if(t<=i)return!1}return!1}onManifestLoading(){this.removeAllFragments()}onFragLoaded(e,t){if(t.frag.sn==="initSegment"||t.frag.bitrateTest)return;const s=t.frag,i=t.part?null:t,r=Or(s);this.fragments[r]={body:s,appendedPTS:null,loaded:i,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){const{frag:s,part:i,timeRanges:r,type:l}=t;if(s.sn==="initSegment")return;const c=s.type;if(i){let u=this.activePartLists[c];u||(this.activePartLists[c]=u=[]),u.push(i)}this.timeRanges=r;const h=r[l];this.detectEvictedFragments(l,h,c,i)}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){const t=Or(e);return!!this.fragments[t]}hasFragments(e){const{fragments:t}=this,s=Object.keys(t);if(!e)return s.length>0;for(let i=s.length;i--;){const r=t[s[i]];if(r?.body.type===e)return!0}return!1}hasParts(e){var t;return!!((t=this.activePartLists[e])!=null&&t.length)}removeFragmentsInRange(e,t,s,i,r){i&&!this.hasGaps||Object.keys(this.fragments).forEach(l=>{const c=this.fragments[l];if(!c)return;const h=c.body;h.type!==s||i&&!h.gap||h.start<t&&h.end>e&&(c.buffered||r)&&this.removeFragment(h)})}removeFragment(e){const t=Or(e);e.clearElementaryStreamInfo();const s=this.activePartLists[e.type];if(s){const i=e.sn;this.activePartLists[e.type]=Rv(s,r=>r.fragment.sn!==i)}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){var e;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;const t=(e=this.hls)==null||(e=e.latestLevelDetails)==null?void 0:e.partList;t&&t.forEach(s=>s.clearElementaryStreamInfo())}}function Mc(n){var e,t,s;return n.buffered&&!!(n.body.gap||(e=n.range.video)!=null&&e.partial||(t=n.range.audio)!=null&&t.partial||(s=n.range.audiovideo)!=null&&s.partial)}function Or(n){return`${n.type}_${n.level}_${n.sn}`}function Rv(n,e){return n.filter(t=>{const s=e(t);return s||t.clearElementaryStreamInfo(),s})}var Aa={cbc:0,ctr:1};class dw{constructor(e,t,s){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=e,this.aesIV=t,this.aesMode=s}decrypt(e,t){switch(this.aesMode){case Aa.cbc:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e);case Aa.ctr:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},t,e);default:throw new Error(`[AESCrypto] invalid aes mode ${this.aesMode}`)}}}function hw(n){const e=n.byteLength,t=e&&new DataView(n.buffer).getUint8(e-1);return t?n.slice(0,e-t):n}class fw{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),s=new Uint32Array(4);for(let i=0;i<4;i++)s[i]=t.getUint32(i*4);return s}initTable(){const e=this.sBox,t=this.invSBox,s=this.subMix,i=s[0],r=s[1],l=s[2],c=s[3],h=this.invSubMix,u=h[0],f=h[1],g=h[2],y=h[3],x=new Uint32Array(256);let S=0,E=0,T=0;for(T=0;T<256;T++)T<128?x[T]=T<<1:x[T]=T<<1^283;for(T=0;T<256;T++){let A=E^E<<1^E<<2^E<<3^E<<4;A=A>>>8^A&255^99,e[S]=A,t[A]=S;const _=x[S],I=x[_],C=x[I];let N=x[A]*257^A*16843008;i[S]=N<<24|N>>>8,r[S]=N<<16|N>>>16,l[S]=N<<8|N>>>24,c[S]=N,N=C*16843009^I*65537^_*257^S*16843008,u[A]=N<<24|N>>>8,f[A]=N<<16|N>>>16,g[A]=N<<8|N>>>24,y[A]=N,S?(S=_^x[x[x[C^_]]],E^=x[x[E]]):S=E=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let s=!0,i=0;for(;i<t.length&&s;)s=t[i]===this.key[i],i++;if(s)return;this.key=t;const r=this.keySize=t.length;if(r!==4&&r!==6&&r!==8)throw new Error("Invalid aes key size="+r);const l=this.ksRows=(r+6+1)*4;let c,h;const u=this.keySchedule=new Uint32Array(l),f=this.invKeySchedule=new Uint32Array(l),g=this.sBox,y=this.rcon,x=this.invSubMix,S=x[0],E=x[1],T=x[2],A=x[3];let _,I;for(c=0;c<l;c++){if(c<r){_=u[c]=t[c];continue}I=_,c%r===0?(I=I<<8|I>>>24,I=g[I>>>24]<<24|g[I>>>16&255]<<16|g[I>>>8&255]<<8|g[I&255],I^=y[c/r|0]<<24):r>6&&c%r===4&&(I=g[I>>>24]<<24|g[I>>>16&255]<<16|g[I>>>8&255]<<8|g[I&255]),u[c]=_=(u[c-r]^I)>>>0}for(h=0;h<l;h++)c=l-h,h&3?I=u[c]:I=u[c-4],h<4||c<=4?f[h]=I:f[h]=S[g[I>>>24]]^E[g[I>>>16&255]]^T[g[I>>>8&255]]^A[g[I&255]],f[h]=f[h]>>>0}networkToHostOrderSwap(e){return e<<24|(e&65280)<<8|(e&16711680)>>8|e>>>24}decrypt(e,t,s){const i=this.keySize+6,r=this.invKeySchedule,l=this.invSBox,c=this.invSubMix,h=c[0],u=c[1],f=c[2],g=c[3],y=this.uint8ArrayToUint32Array_(s);let x=y[0],S=y[1],E=y[2],T=y[3];const A=new Int32Array(e),_=new Int32Array(A.length);let I,C,N,D,k,B,j,U,K,H,J,re,me,M;const $=this.networkToHostOrderSwap;for(;t<A.length;){for(K=$(A[t]),H=$(A[t+1]),J=$(A[t+2]),re=$(A[t+3]),k=K^r[0],B=re^r[1],j=J^r[2],U=H^r[3],me=4,M=1;M<i;M++)I=h[k>>>24]^u[B>>16&255]^f[j>>8&255]^g[U&255]^r[me],C=h[B>>>24]^u[j>>16&255]^f[U>>8&255]^g[k&255]^r[me+1],N=h[j>>>24]^u[U>>16&255]^f[k>>8&255]^g[B&255]^r[me+2],D=h[U>>>24]^u[k>>16&255]^f[B>>8&255]^g[j&255]^r[me+3],k=I,B=C,j=N,U=D,me=me+4;I=l[k>>>24]<<24^l[B>>16&255]<<16^l[j>>8&255]<<8^l[U&255]^r[me],C=l[B>>>24]<<24^l[j>>16&255]<<16^l[U>>8&255]<<8^l[k&255]^r[me+1],N=l[j>>>24]<<24^l[U>>16&255]<<16^l[k>>8&255]<<8^l[B&255]^r[me+2],D=l[U>>>24]<<24^l[k>>16&255]<<16^l[B>>8&255]<<8^l[j&255]^r[me+3],_[t]=$(I^x),_[t+1]=$(D^S),_[t+2]=$(N^E),_[t+3]=$(C^T),x=K,S=H,E=J,T=re,t=t+4}return _.buffer}}class mw{constructor(e,t,s){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=e,this.key=t,this.aesMode=s}expandKey(){const e=pw(this.aesMode);return this.subtle.importKey("raw",this.key,{name:e},!1,["encrypt","decrypt"])}}function pw(n){switch(n){case Aa.cbc:return"AES-CBC";case Aa.ctr:return"AES-CTR";default:throw new Error(`[FastAESKey] invalid aes mode ${n}`)}}const gw=16;class Em{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const s=self.crypto;s&&(this.subtle=s.subtle||s.webkitSubtle)}catch{}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;const s=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?hw(s):s}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,s,i){return this.useSoftware?new Promise((r,l)=>{const c=ArrayBuffer.isView(e)?e:new Uint8Array(e);this.softwareDecrypt(c,t,s,i);const h=this.flush();h?r(h.buffer):l(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,s,i)}softwareDecrypt(e,t,s,i){const{currentIV:r,currentResult:l,remainderData:c}=this;if(i!==Aa.cbc||t.byteLength!==16)return Lt.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),c&&(e=Ui(c,e),this.remainderData=null);const h=this.getValidChunk(e);if(!h.length)return null;r&&(s=r);let u=this.softwareDecrypter;u||(u=this.softwareDecrypter=new fw),u.expandKey(t);const f=l;return this.currentResult=u.decrypt(h.buffer,0,s),this.currentIV=h.slice(-16).buffer,f||null}webCryptoDecrypt(e,t,s,i){if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,t,s,i));this.key=t,this.fastAesKey=new mw(this.subtle,t,i)}return this.fastAesKey.expandKey().then(r=>this.subtle?(this.logOnce("WebCrypto AES decrypt"),new dw(this.subtle,new Uint8Array(s),i).decrypt(e.buffer,r)):Promise.reject(new Error("web crypto not initialized"))).catch(r=>(Lt.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${r.name}: ${r.message}`),this.onWebCryptoError(e,t,s,i)))}onWebCryptoError(e,t,s,i){const r=this.enableSoftwareAES;if(r){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,s,i);const l=this.flush();if(l)return l.buffer}throw new Error("WebCrypto"+(r?" and softwareDecrypt":"")+": failed to decrypt data")}getValidChunk(e){let t=e;const s=e.length-e.length%gw;return s!==e.length&&(t=e.slice(0,s),this.remainderData=e.slice(s)),t}logOnce(e){this.logEnabled&&(Lt.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}const Lv=Math.pow(2,17);class yw{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){const s=e.url;if(!s)return Promise.reject(new jn({type:Be.NETWORK_ERROR,details:Q.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error(`Fragment does not have a ${s?"part list":"url"}`),networkDetails:null}));this.abort();const i=this.config,r=i.fLoader,l=i.loader;return new Promise((c,h)=>{if(this.loader&&this.loader.destroy(),e.gap)if(e.tagList.some(S=>S[0]==="GAP")){h(Cv(e));return}else e.gap=!1;const u=this.loader=r?new r(i):new l(i),f=wv(e);e.loader=u;const g=_v(i.fragLoadPolicy.default),y={loadPolicy:g,timeout:g.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:e.sn==="initSegment"?1/0:Lv};e.stats=u.stats;const x={onSuccess:(S,E,T,A)=>{this.resetLoader(e,u);let _=S.data;T.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(_.slice(0,16)),_=_.slice(16)),c({frag:e,part:null,payload:_,networkDetails:A})},onError:(S,E,T,A)=>{this.resetLoader(e,u),h(new jn({type:Be.NETWORK_ERROR,details:Q.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:Rt({url:s,data:void 0},S),error:new Error(`HTTP Error ${S.code} ${S.text}`),networkDetails:T,stats:A}))},onAbort:(S,E,T)=>{this.resetLoader(e,u),h(new jn({type:Be.NETWORK_ERROR,details:Q.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:T,stats:S}))},onTimeout:(S,E,T)=>{this.resetLoader(e,u),h(new jn({type:Be.NETWORK_ERROR,details:Q.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${y.timeout}ms`),networkDetails:T,stats:S}))}};t&&(x.onProgress=(S,E,T,A)=>t({frag:e,part:null,payload:T,networkDetails:A})),u.load(f,y,x)})}loadPart(e,t,s){this.abort();const i=this.config,r=i.fLoader,l=i.loader;return new Promise((c,h)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap){h(Cv(e,t));return}const u=this.loader=r?new r(i):new l(i),f=wv(e,t);e.loader=u;const g=_v(i.fragLoadPolicy.default),y={loadPolicy:g,timeout:g.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:Lv};t.stats=u.stats,u.load(f,y,{onSuccess:(x,S,E,T)=>{this.resetLoader(e,u),this.updateStatsFromPart(e,t);const A={frag:e,part:t,payload:x.data,networkDetails:T};s(A),c(A)},onError:(x,S,E,T)=>{this.resetLoader(e,u),h(new jn({type:Be.NETWORK_ERROR,details:Q.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:Rt({url:f.url,data:void 0},x),error:new Error(`HTTP Error ${x.code} ${x.text}`),networkDetails:E,stats:T}))},onAbort:(x,S,E)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,u),h(new jn({type:Be.NETWORK_ERROR,details:Q.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:E,stats:x}))},onTimeout:(x,S,E)=>{this.resetLoader(e,u),h(new jn({type:Be.NETWORK_ERROR,details:Q.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error(`Timeout after ${y.timeout}ms`),networkDetails:E,stats:x}))}})})}updateStatsFromPart(e,t){const s=e.stats,i=t.stats,r=i.total;if(s.loaded+=i.loaded,r){const h=Math.round(e.duration/t.duration),u=Math.min(Math.round(s.loaded/r),h),g=(h-u)*Math.round(s.loaded/u);s.total=s.loaded+g}else s.total=Math.max(s.loaded,s.total);const l=s.loading,c=i.loading;l.start?l.first+=c.first-c.start:(l.start=c.start,l.first=c.first),l.end=c.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function wv(n,e=null){const t=e||n,s={frag:n,part:e,responseType:"arraybuffer",url:t.url,headers:{},rangeStart:0,rangeEnd:0},i=t.byteRangeStartOffset,r=t.byteRangeEndOffset;if(Ne(i)&&Ne(r)){var l;let c=i,h=r;if(n.sn==="initSegment"&&vw((l=n.decryptdata)==null?void 0:l.method)){const u=r-i;u%16&&(h=r+(16-u%16)),i!==0&&(s.resetIV=!0,c=i-16)}s.rangeStart=c,s.rangeEnd=h}return s}function Cv(n,e){const t=new Error(`GAP ${n.gap?"tag":"attribute"} found`),s={type:Be.MEDIA_ERROR,details:Q.FRAG_GAP,fatal:!1,frag:n,error:t,networkDetails:null};return e&&(s.part=e),(e||n).stats.aborted=!0,new jn(s)}function vw(n){return n==="AES-128"||n==="AES-256"}class jn extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class GS extends ji{constructor(e,t){super(e,t),this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}class Am{constructor(e,t,s,i=0,r=-1,l=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=jc(),this.buffering={audio:jc(),video:jc(),audiovideo:jc()},this.level=e,this.sn=t,this.id=s,this.size=i,this.part=r,this.partial=l}}function jc(){return{start:0,executeStart:0,executeEnd:0,end:0}}const Nv={length:0,start:()=>0,end:()=>0};class qe{static isBuffered(e,t){if(e){const s=qe.getBuffered(e);for(let i=s.length;i--;)if(t>=s.start(i)&&t<=s.end(i))return!0}return!1}static bufferedRanges(e){if(e){const t=qe.getBuffered(e);return qe.timeRangesToArray(t)}return[]}static timeRangesToArray(e){const t=[];for(let s=0;s<e.length;s++)t.push({start:e.start(s),end:e.end(s)});return t}static bufferInfo(e,t,s){if(e){const i=qe.bufferedRanges(e);if(i.length)return qe.bufferedInfo(i,t,s)}return{len:0,start:t,end:t,bufferedIndex:-1}}static bufferedInfo(e,t,s){t=Math.max(0,t),e.length>1&&e.sort((f,g)=>f.start-g.start||g.end-f.end);let i=-1,r=[];if(s)for(let f=0;f<e.length;f++){t>=e[f].start&&t<=e[f].end&&(i=f);const g=r.length;if(g){const y=r[g-1].end;e[f].start-y<s?e[f].end>y&&(r[g-1].end=e[f].end):r.push(e[f])}else r.push(e[f])}else r=e;let l=0,c,h=t,u=t;for(let f=0;f<r.length;f++){const g=r[f].start,y=r[f].end;if(i===-1&&t>=g&&t<=y&&(i=f),t+s>=g&&t<y)h=g,u=y,l=u-t;else if(t+s<g){c=g;break}}return{len:l,start:h||0,end:u||0,nextStart:c,buffered:e,bufferedIndex:i}}static getBuffered(e){try{return e.buffered||Nv}catch(t){return Lt.log("failed to get media.buffered",t),Nv}}}const HS=/\{\$([a-zA-Z0-9-_]+)\}/g;function Ov(n){return HS.test(n)}function Gf(n,e){if(n.variableList!==null||n.hasVariableRefs){const t=n.variableList;return e.replace(HS,s=>{const i=s.substring(2,s.length-1),r=t?.[i];return r===void 0?(n.playlistParsingError||(n.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${i}"`)),s):r})}return e}function kv(n,e,t){let s=n.variableList;s||(n.variableList=s={});let i,r;if("QUERYPARAM"in e){i=e.QUERYPARAM;try{const l=new self.URL(t).searchParams;if(l.has(i))r=l.get(i);else throw new Error(`"${i}" does not match any query parameter in URI: "${t}"`)}catch(l){n.playlistParsingError||(n.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${l.message}`))}}else i=e.NAME,r=e.VALUE;i in s?n.playlistParsingError||(n.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${i}"`)):s[i]=r||""}function xw(n,e,t){const s=e.IMPORT;if(t&&s in t){let i=n.variableList;i||(n.variableList=i={}),i[s]=t[s]}else n.playlistParsingError||(n.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${s}"`))}const Sw=/^(\d+)x(\d+)$/,Dv=/(.+?)=(".*?"|.*?)(?:,|$)/g;class Yt{constructor(e,t){typeof e=="string"&&(e=Yt.parseAttrList(e,t)),Dt(this,e)}get clientAttrs(){return Object.keys(this).filter(e=>e.substring(0,2)==="X-")}decimalInteger(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(t.length&1?"0":"")+t;const s=new Uint8Array(t.length/2);for(let i=0;i<t.length/2;i++)s[i]=parseInt(t.slice(i*2,i*2+2),16);return s}return null}hexadecimalIntegerAsNumber(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){const s=this[e];return s?parseFloat(s):t}enumeratedString(e){return this[e]}enumeratedStringList(e,t){const s=this[e];return(s?s.split(/[ ,]+/):[]).reduce((i,r)=>(i[r.toLowerCase()]=!0,i),t)}bool(e){return this[e]==="YES"}decimalResolution(e){const t=Sw.exec(this[e]);if(t!==null)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e,t){let s;const i={};for(Dv.lastIndex=0;(s=Dv.exec(e))!==null;){const l=s[1].trim();let c=s[2];const h=c.indexOf('"')===0&&c.lastIndexOf('"')===c.length-1;let u=!1;if(h)c=c.slice(1,-1);else switch(l){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":u=!0}if(t&&(h||u))c=Gf(t,c);else if(!u&&!h)switch(l){case"CLOSED-CAPTIONS":if(c==="NONE")break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":Lt.warn(`${e}: attribute ${l} is missing quotes`)}i[l]=c}return i}}const bw="com.apple.hls.interstitial";function Tw(n){return n!=="ID"&&n!=="CLASS"&&n!=="CUE"&&n!=="START-DATE"&&n!=="DURATION"&&n!=="END-DATE"&&n!=="END-ON-NEXT"}function Ew(n){return n==="SCTE35-OUT"||n==="SCTE35-IN"||n==="SCTE35-CMD"}class zS{constructor(e,t,s=0){var i;if(this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=t?.tagAnchor||null,this.tagOrder=(i=t?.tagOrder)!=null?i:s,t){const r=t.attr;for(const l in r)if(Object.prototype.hasOwnProperty.call(e,l)&&e[l]!==r[l]){Lt.warn(`DATERANGE tag attribute: "${l}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=l;break}e=Dt(new Yt({}),r,e)}if(this.attr=e,t?(this._startDate=t._startDate,this._cue=t._cue,this._endDate=t._endDate,this._dateAtEnd=t._dateAtEnd):this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const r=t?.endDate||new Date(this.attr["END-DATE"]);Ne(r.getTime())&&(this._endDate=r)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get cue(){const e=this._cue;return e===void 0?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):e}get startTime(){const{tagAnchor:e}=this;return e===null||e.programDateTime===null?(Lt.warn(`Expected tagAnchor Fragment with PDT set for DateRange "${this.id}": ${e}`),NaN):e.start+(this.startDate.getTime()-e.programDateTime)/1e3}get startDate(){return this._startDate}get endDate(){const e=this._endDate||this._dateAtEnd;if(e)return e;const t=this.duration;return t!==null?this._dateAtEnd=new Date(this._startDate.getTime()+t*1e3):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(Ne(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isInterstitial(){return this.class===bw}get isValid(){return!!this.id&&!this._badValueForSameId&&Ne(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}const Aw=10;class Iw{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e){this.advanced=!0,this.updated=!0;return}const t=this.lastPartSn-e.lastPartSn,s=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!s||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||t===0&&s>0,this.updated||this.advanced?this.misses=Math.floor(e.misses*.6):this.misses=e.misses+1}hasKey(e){return this.encryptedFragments.some(t=>{let s=t.decryptdata;return s||(t.setKeyFormat(e.keyFormat),s=t.decryptdata),!!s&&e.matches(s)})}get hasProgramDateTime(){return this.fragments.length?Ne(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||Aw}get drift(){const e=this.driftEndTime-this.driftStartTime;return e>0?(this.driftEnd-this.driftStart)*1e3/e:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){return this.fragments.length?this.fragments[this.fragments.length-1].end:0}get fragmentStart(){return this.fragments.length?this.fragments[0].start:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].index:-1}get maxPartIndex(){const e=this.partList;if(e){const t=this.lastPartIndex;if(t!==-1){for(let s=e.length;s--;)if(e[s].index>t)return e[s].index;return t}}return 0}get lastPartSn(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}get expired(){if(this.live&&this.age&&this.misses<3){const e=this.partEnd-this.fragmentStart;return this.age>Math.max(e,this.totalduration)+this.levelTargetDuration}return!1}}function Su(n,e){return n.length===e.length?!n.some((t,s)=>t!==e[s]):!1}function Pv(n,e){return!n&&!e?!0:!n||!e?!1:Su(n,e)}function Br(n){return n==="AES-128"||n==="AES-256"||n==="AES-256-CTR"}function Im(n){switch(n){case"AES-128":case"AES-256":return Aa.cbc;case"AES-256-CTR":return Aa.ctr;default:throw new Error(`invalid full segment method ${n}`)}}function _m(n){return Uint8Array.from(atob(n),e=>e.charCodeAt(0))}function Hf(n){return Uint8Array.from(unescape(encodeURIComponent(n)),e=>e.charCodeAt(0))}function _w(n){const e=Hf(n).subarray(0,16),t=new Uint8Array(16);return t.set(e,16-e.length),t}function KS(n){const e=function(s,i,r){const l=s[i];s[i]=s[r],s[r]=l};e(n,0,3),e(n,1,2),e(n,4,5),e(n,6,7)}function YS(n){const e=n.split(":");let t=null;if(e[0]==="data"&&e.length===2){const s=e[1].split(";"),i=s[s.length-1].split(",");if(i.length===2){const r=i[0]==="base64",l=i[1];r?(s.splice(-1,1),t=_m(l)):t=_w(l)}}return t}const bu=typeof self<"u"?self:void 0;var qt={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},_s={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function iu(n){switch(n){case _s.FAIRPLAY:return qt.FAIRPLAY;case _s.PLAYREADY:return qt.PLAYREADY;case _s.WIDEVINE:return qt.WIDEVINE;case _s.CLEARKEY:return qt.CLEARKEY}}function uf(n){switch(n){case qt.FAIRPLAY:return _s.FAIRPLAY;case qt.PLAYREADY:return _s.PLAYREADY;case qt.WIDEVINE:return _s.WIDEVINE;case qt.CLEARKEY:return _s.CLEARKEY}}function Hl(n){const{drmSystems:e,widevineLicenseUrl:t}=n,s=e?[qt.FAIRPLAY,qt.WIDEVINE,qt.PLAYREADY,qt.CLEARKEY].filter(i=>!!e[i]):[];return!s[qt.WIDEVINE]&&t&&s.push(qt.WIDEVINE),s}const qS=(function(n){return bu!=null&&(n=bu.navigator)!=null&&n.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null})();function Rw(n,e,t,s){let i;switch(n){case qt.FAIRPLAY:i=["cenc","sinf"];break;case qt.WIDEVINE:case qt.PLAYREADY:i=["cenc"];break;case qt.CLEARKEY:i=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${n}`)}return Lw(i,e,t,s)}function Lw(n,e,t,s){return[{initDataTypes:n,persistentState:s.persistentState||"optional",distinctiveIdentifier:s.distinctiveIdentifier||"optional",sessionTypes:s.sessionTypes||[s.sessionType||"temporary"],audioCapabilities:e.map(r=>({contentType:`audio/mp4; codecs=${r}`,robustness:s.audioRobustness||"",encryptionScheme:s.audioEncryptionScheme||null})),videoCapabilities:t.map(r=>({contentType:`video/mp4; codecs=${r}`,robustness:s.videoRobustness||"",encryptionScheme:s.videoEncryptionScheme||null}))}]}function ww(n){var e;return!!n&&(n.sessionType==="persistent-license"||!!((e=n.sessionTypes)!=null&&e.some(t=>t==="persistent-license")))}function QS(n){const e=new Uint16Array(n.buffer,n.byteOffset,n.byteLength/2),t=String.fromCharCode.apply(null,Array.from(e)),s=t.substring(t.indexOf("<"),t.length),l=new DOMParser().parseFromString(s,"text/xml").getElementsByTagName("KID")[0];if(l){const c=l.childNodes[0]?l.childNodes[0].nodeValue:l.getAttribute("VALUE");if(c){const h=_m(c).subarray(0,16);return KS(h),h}}return null}let kr={};class ba{static clearKeyUriToKeyIdMap(){kr={}}static setKeyIdForUri(e,t){kr[e]=t}static addKeyIdForUri(e){const t=Object.keys(kr).length%Number.MAX_SAFE_INTEGER,s=new Uint8Array(16);return new DataView(s.buffer,12,4).setUint32(0,t),kr[e]=s,s}constructor(e,t,s,i=[1],r=null,l){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=s,this.keyFormatVersions=i,this.iv=r,this.encrypted=e?e!=="NONE":!1,this.isCommonEncryption=this.encrypted&&!Br(e),l!=null&&l.startsWith("0x")&&(this.keyId=new Uint8Array(ES(l)))}matches(e){return e.uri===this.uri&&e.method===this.method&&e.encrypted===this.encrypted&&e.keyFormat===this.keyFormat&&Su(e.keyFormatVersions,this.keyFormatVersions)&&Pv(e.iv,this.iv)&&Pv(e.keyId,this.keyId)}isSupported(){if(this.method){if(Br(this.method)||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case _s.FAIRPLAY:case _s.WIDEVINE:case _s.PLAYREADY:case _s.CLEARKEY:return["SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(e,t){if(!this.encrypted||!this.uri)return null;if(Br(this.method)){let r=this.iv;return r||(typeof e!="number"&&(Lt.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0),r=Nw(e)),new ba(this.method,this.uri,"identity",this.keyFormatVersions,r)}if(this.keyId){const r=kr[this.uri];if(r&&!Su(this.keyId,r)&&ba.setKeyIdForUri(this.uri,this.keyId),this.pssh)return this}const s=YS(this.uri);if(s)switch(this.keyFormat){case _s.WIDEVINE:if(this.pssh=s,!this.keyId){const r=D1(s.buffer);if(r.length){var i;const l=r[0];this.keyId=(i=l.kids)!=null&&i.length?l.kids[0]:null}}this.keyId||(this.keyId=Uv(t));break;case _s.PLAYREADY:{const r=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=k1(r,null,s),this.keyId=QS(s);break}default:{let r=s.subarray(0,16);if(r.length!==16){const l=new Uint8Array(16);l.set(r,16-r.length),r=l}this.keyId=r;break}}if(!this.keyId||this.keyId.byteLength!==16){let r;r=Cw(t),r||(r=Uv(t),r||(r=kr[this.uri])),r&&(this.keyId=r,ba.setKeyIdForUri(this.uri,r))}return this}}function Cw(n){const e=n?.[_s.WIDEVINE];return e?e.keyId:null}function Uv(n){const e=n?.[_s.PLAYREADY];if(e){const t=YS(e.uri);if(t)return QS(t)}return null}function Nw(n){const e=new Uint8Array(16);for(let t=12;t<16;t++)e[t]=n>>8*(15-t)&255;return e}const Mv=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,jv=/#EXT-X-MEDIA:(.*)/g,Ow=/^#EXT(?:INF|-X-TARGETDURATION):/m,df=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),kw=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class un{static findGroup(e,t){for(let s=0;s<e.length;s++){const i=e[s];if(i.id===t)return i}}static resolve(e,t){return ym.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return Ow.test(e)}static parseMasterPlaylist(e,t){const s=Ov(e),i={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:s},r=[];if(Mv.lastIndex=0,!e.startsWith("#EXTM3U"))return i.playlistParsingError=new Error("no EXTM3U delimiter"),i;let l;for(;(l=Mv.exec(e))!=null;)if(l[1]){var c;const u=new Yt(l[1],i),f=Gf(i,l[2]),g={attrs:u,bitrate:u.decimalInteger("BANDWIDTH")||u.decimalInteger("AVERAGE-BANDWIDTH"),name:u.NAME,url:un.resolve(f,t)},y=u.decimalResolution("RESOLUTION");y&&(g.width=y.width,g.height=y.height),Vv(u.CODECS,g);const x=u["SUPPLEMENTAL-CODECS"];x&&(g.supplemental={},Vv(x,g.supplemental)),(c=g.unknownCodecs)!=null&&c.length||r.push(g),i.levels.push(g)}else if(l[3]){const u=l[3],f=l[4];switch(u){case"SESSION-DATA":{const g=new Yt(f,i),y=g["DATA-ID"];y&&(i.sessionData===null&&(i.sessionData={}),i.sessionData[y]=g);break}case"SESSION-KEY":{const g=Bv(f,t,i);g.encrypted&&g.isSupported()?(i.sessionKeys===null&&(i.sessionKeys=[]),i.sessionKeys.push(g)):Lt.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${f}"`);break}case"DEFINE":{{const g=new Yt(f,i);kv(i,g,t)}break}case"CONTENT-STEERING":{const g=new Yt(f,i);i.contentSteering={uri:un.resolve(g["SERVER-URI"],t),pathwayId:g["PATHWAY-ID"]||"."};break}case"START":{i.startTimeOffset=Fv(f);break}}}const h=r.length>0&&r.length<i.levels.length;return i.levels=h?r:i.levels,i.levels.length===0&&(i.playlistParsingError=new Error("no levels found in manifest")),i}static parseMasterPlaylistMedia(e,t,s){let i;const r={},l=s.levels,c={AUDIO:l.map(u=>({id:u.attrs.AUDIO,audioCodec:u.audioCodec})),SUBTITLES:l.map(u=>({id:u.attrs.SUBTITLES,textCodec:u.textCodec})),"CLOSED-CAPTIONS":[]};let h=0;for(jv.lastIndex=0;(i=jv.exec(e))!==null;){const u=new Yt(i[1],s),f=u.TYPE;if(f){const g=c[f],y=r[f]||[];r[f]=y;const x=u.LANGUAGE,S=u["ASSOC-LANGUAGE"],E=u.CHANNELS,T=u.CHARACTERISTICS,A=u["INSTREAM-ID"],_={attrs:u,bitrate:0,id:h++,groupId:u["GROUP-ID"]||"",name:u.NAME||x||"",type:f,default:u.bool("DEFAULT"),autoselect:u.bool("AUTOSELECT"),forced:u.bool("FORCED"),lang:x,url:u.URI?un.resolve(u.URI,t):""};if(S&&(_.assocLang=S),E&&(_.channels=E),T&&(_.characteristics=T),A&&(_.instreamId=A),g!=null&&g.length){const I=un.findGroup(g,_.groupId)||g[0];$v(_,I,"audioCodec"),$v(_,I,"textCodec")}y.push(_)}}return r}static parseLevelPlaylist(e,t,s,i,r,l){var c;const h={url:t},u=new Iw(t),f=u.fragments,g=[];let y=null,x=0,S=0,E=0,T=0,A=0,_=null,I=new lf(i,h),C,N,D,k=-1,B=!1,j=null,U;if(df.lastIndex=0,u.m3u8=e,u.hasVariableRefs=Ov(e),((c=df.exec(e))==null?void 0:c[0])!=="#EXTM3U")return u.playlistParsingError=new Error("Missing format identifier #EXTM3U"),u;for(;(C=df.exec(e))!==null;){B&&(B=!1,I=new lf(i,h),I.playlistOffset=E,I.setStart(E),I.sn=x,I.cc=T,A&&(I.bitrate=A),I.level=s,y&&(I.initSegment=y,y.rawProgramDateTime&&(I.rawProgramDateTime=y.rawProgramDateTime,y.rawProgramDateTime=null),j&&(I.setByteRange(j),j=null)));const re=C[1];if(re){I.duration=parseFloat(re);const me=(" "+C[2]).slice(1);I.title=me||null,I.tagList.push(me?["INF",re,me]:["INF",re])}else if(C[3]){if(Ne(I.duration)){I.playlistOffset=E,I.setStart(E),D&&Hv(I,D,u),I.sn=x,I.level=s,I.cc=T,f.push(I);const me=(" "+C[3]).slice(1);I.relurl=Gf(u,me),zf(I,_,g),_=I,E+=I.duration,x++,S=0,B=!0}}else{if(C=C[0].match(kw),!C){Lt.warn("No matches on slow regex match for level playlist!");continue}for(N=1;N<C.length&&C[N]===void 0;N++);const me=(" "+C[N]).slice(1),M=(" "+C[N+1]).slice(1),$=C[N+2]?(" "+C[N+2]).slice(1):null;switch(me){case"BYTERANGE":_?I.setByteRange(M,_):I.setByteRange(M);break;case"PROGRAM-DATE-TIME":I.rawProgramDateTime=M,I.tagList.push(["PROGRAM-DATE-TIME",M]),k===-1&&(k=f.length);break;case"PLAYLIST-TYPE":u.type&&Un(u,me,C),u.type=M.toUpperCase();break;case"MEDIA-SEQUENCE":u.startSN!==0?Un(u,me,C):f.length>0&&zv(u,me,C),x=u.startSN=parseInt(M);break;case"SKIP":{u.skippedSegments&&Un(u,me,C);const F=new Yt(M,u),ae=F.decimalInteger("SKIPPED-SEGMENTS");if(Ne(ae)){u.skippedSegments+=ae;for(let P=ae;P--;)f.push(null);x+=ae}const de=F.enumeratedString("RECENTLY-REMOVED-DATERANGES");de&&(u.recentlyRemovedDateranges=(u.recentlyRemovedDateranges||[]).concat(de.split("	")));break}case"TARGETDURATION":u.targetduration!==0&&Un(u,me,C),u.targetduration=Math.max(parseInt(M),1);break;case"VERSION":u.version!==null&&Un(u,me,C),u.version=parseInt(M);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":u.live||Un(u,me,C),u.live=!1;break;case"#":(M||$)&&I.tagList.push($?[M,$]:[M]);break;case"DISCONTINUITY":T++,I.tagList.push(["DIS"]);break;case"GAP":I.gap=!0,I.tagList.push([me]);break;case"BITRATE":I.tagList.push([me,M]),A=parseInt(M)*1e3,Ne(A)?I.bitrate=A:A=0;break;case"DATERANGE":{const F=new Yt(M,u),ae=new zS(F,u.dateRanges[F.ID],u.dateRangeTagCount);u.dateRangeTagCount++,ae.isValid||u.skippedSegments?u.dateRanges[ae.id]=ae:Lt.warn(`Ignoring invalid DATERANGE tag: "${M}"`),I.tagList.push(["EXT-X-DATERANGE",M]);break}case"DEFINE":{{const F=new Yt(M,u);"IMPORT"in F?xw(u,F,l):kv(u,F,t)}break}case"DISCONTINUITY-SEQUENCE":u.startCC!==0?Un(u,me,C):f.length>0&&zv(u,me,C),u.startCC=T=parseInt(M);break;case"KEY":{const F=Bv(M,t,u);if(F.isSupported()){if(F.method==="NONE"){D=void 0;break}D||(D={});const ae=D[F.keyFormat];ae!=null&&ae.matches(F)||(ae&&(D=Dt({},D)),D[F.keyFormat]=F)}else Lt.warn(`[Keys] Ignoring unsupported EXT-X-KEY tag: "${M}"`);break}case"START":u.startTimeOffset=Fv(M);break;case"MAP":{const F=new Yt(M,u);if(I.duration){const ae=new lf(i,h);Gv(ae,F,s,D),y=ae,I.initSegment=y,y.rawProgramDateTime&&!I.rawProgramDateTime&&(I.rawProgramDateTime=y.rawProgramDateTime)}else{const ae=I.byteRangeEndOffset;if(ae){const de=I.byteRangeStartOffset;j=`${ae-de}@${de}`}else j=null;Gv(I,F,s,D),y=I,B=!0}y.cc=T;break}case"SERVER-CONTROL":{U&&Un(u,me,C),U=new Yt(M),u.canBlockReload=U.bool("CAN-BLOCK-RELOAD"),u.canSkipUntil=U.optionalFloat("CAN-SKIP-UNTIL",0),u.canSkipDateRanges=u.canSkipUntil>0&&U.bool("CAN-SKIP-DATERANGES"),u.partHoldBack=U.optionalFloat("PART-HOLD-BACK",0),u.holdBack=U.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{u.partTarget&&Un(u,me,C);const F=new Yt(M);u.partTarget=F.decimalFloatingPoint("PART-TARGET");break}case"PART":{let F=u.partList;F||(F=u.partList=[]);const ae=S>0?F[F.length-1]:void 0,de=S++,P=new Yt(M,u),G=new x1(P,I,h,de,ae);F.push(G),I.duration+=G.duration;break}case"PRELOAD-HINT":{const F=new Yt(M,u);u.preloadHint=F;break}case"RENDITION-REPORT":{const F=new Yt(M,u);u.renditionReports=u.renditionReports||[],u.renditionReports.push(F);break}default:Lt.warn(`line parsed but not handled: ${C}`);break}}}_&&!_.relurl?(f.pop(),E-=_.duration,u.partList&&(u.fragmentHint=_)):u.partList&&(zf(I,_,g),I.cc=T,u.fragmentHint=I,D&&Hv(I,D,u)),u.targetduration||(u.playlistParsingError=new Error("Missing Target Duration"));const K=f.length,H=f[0],J=f[K-1];if(E+=u.skippedSegments*u.targetduration,E>0&&K&&J){u.averagetargetduration=E/K;const re=J.sn;u.endSN=re!=="initSegment"?re:0,u.live||(J.endList=!0),k>0&&(Pw(f,k),H&&g.unshift(H))}return u.fragmentHint&&(E+=u.fragmentHint.duration),u.totalduration=E,g.length&&u.dateRangeTagCount&&H&&WS(g,u),u.endCC=T,u}}function WS(n,e){let t=n.length;if(!t)if(e.hasProgramDateTime){const c=e.fragments[e.fragments.length-1];n.push(c),t++}else return;const s=n[t-1],i=e.live?1/0:e.totalduration,r=Object.keys(e.dateRanges);for(let c=r.length;c--;){const h=e.dateRanges[r[c]],u=h.startDate.getTime();h.tagAnchor=s.ref;for(let f=t;f--;){var l;if(((l=n[f])==null?void 0:l.sn)<e.startSN)break;const g=Dw(e,u,n,f,i);if(g!==-1){h.tagAnchor=e.fragments[g].ref;break}}}}function Dw(n,e,t,s,i){const r=t[s];if(r){const c=r.programDateTime;if(e>=c||s===0){var l;const h=(((l=t[s+1])==null?void 0:l.start)||i)-r.start;if(e<=c+h*1e3){const u=t[s].sn-n.startSN;if(u<0)return-1;const f=n.fragments;if(f.length>t.length){const y=(t[s+1]||f[f.length-1]).sn-n.startSN;for(let x=y;x>u;x--){const S=f[x].programDateTime;if(e>=S&&e<S+f[x].duration*1e3)return x}}return u}}}return-1}function Bv(n,e,t){var s,i;const r=new Yt(n,t),l=(s=r.METHOD)!=null?s:"",c=r.URI,h=r.hexadecimalInteger("IV"),u=r.KEYFORMATVERSIONS,f=(i=r.KEYFORMAT)!=null?i:"identity";c&&r.IV&&!h&&Lt.error(`Invalid IV: ${r.IV}`);const g=c?un.resolve(c,e):"",y=(u||"1").split("/").map(Number).filter(Number.isFinite);return new ba(l,g,f,y,h,r.KEYID)}function Fv(n){const t=new Yt(n).decimalFloatingPoint("TIME-OFFSET");return Ne(t)?t:null}function Vv(n,e){let t=(n||"").split(/[ ,]+/).filter(s=>s);["video","audio","text"].forEach(s=>{const i=t.filter(r=>Sm(r,s));i.length&&(e[`${s}Codec`]=i.map(r=>r.split("/")[0]).join(","),t=t.filter(r=>i.indexOf(r)===-1))}),e.unknownCodecs=t}function $v(n,e,t){const s=e[t];s&&(n[t]=s)}function Pw(n,e){let t=n[e];for(let s=e;s--;){const i=n[s];if(!i)return;i.programDateTime=t.programDateTime-i.duration*1e3,t=i}}function zf(n,e,t){n.rawProgramDateTime?t.push(n):e!=null&&e.programDateTime&&(n.programDateTime=e.endProgramDateTime)}function Gv(n,e,t,s){n.relurl=e.URI,e.BYTERANGE&&n.setByteRange(e.BYTERANGE),n.level=t,n.sn="initSegment",s&&(n.levelkeys=s),n.initSegment=null}function Hv(n,e,t){n.levelkeys=e;const{encryptedFragments:s}=t;(!s.length||s[s.length-1].levelkeys!==e)&&Object.keys(e).some(i=>e[i].isCommonEncryption)&&s.push(n)}function Un(n,e,t){n.playlistParsingError=new Error(`#EXT-X-${e} must not appear more than once (${t[0]})`)}function zv(n,e,t){n.playlistParsingError=new Error(`#EXT-X-${e} must appear before the first Media Segment (${t[0]})`)}function hf(n,e){const t=e.startPTS;if(Ne(t)){let s=0,i;e.sn>n.sn?(s=t-n.start,i=n):(s=n.start-t,i=e),i.duration!==s&&i.setDuration(s)}else e.sn>n.sn?n.cc===e.cc&&n.minEndPTS?e.setStart(n.start+(n.minEndPTS-n.start)):e.setStart(n.start+n.duration):e.setStart(Math.max(n.start-e.duration,0))}function XS(n,e,t,s,i,r,l){s-t<=0&&(l.warn("Fragment should have a positive duration",e),s=t+e.duration,r=i+e.duration);let h=t,u=s;const f=e.startPTS,g=e.endPTS;if(Ne(f)){const A=Math.abs(f-t);n&&A>n.totalduration?l.warn(`media timestamps and playlist times differ by ${A}s for level ${e.level} ${n.url}`):Ne(e.deltaPTS)?e.deltaPTS=Math.max(A,e.deltaPTS):e.deltaPTS=A,h=Math.max(t,f),t=Math.min(t,f),i=e.startDTS!==void 0?Math.min(i,e.startDTS):i,u=Math.min(s,g),s=Math.max(s,g),r=e.endDTS!==void 0?Math.max(r,e.endDTS):r}const y=t-e.start;e.start!==0&&e.setStart(t),e.setDuration(s-e.start),e.startPTS=t,e.maxStartPTS=h,e.startDTS=i,e.endPTS=s,e.minEndPTS=u,e.endDTS=r;const x=e.sn;if(!n||x<n.startSN||x>n.endSN)return 0;let S;const E=x-n.startSN,T=n.fragments;for(T[E]=e,S=E;S>0;S--)hf(T[S],T[S-1]);for(S=E;S<T.length-1;S++)hf(T[S],T[S+1]);return n.fragmentHint&&hf(T[T.length-1],n.fragmentHint),n.PTSKnown=n.alignedSliding=!0,y}function Uw(n,e,t){if(n===e)return;let s=null;const i=n.fragments;for(let f=i.length-1;f>=0;f--){const g=i[f].initSegment;if(g){s=g;break}}n.fragmentHint&&delete n.fragmentHint.endPTS;let r;Bw(n,e,(f,g,y,x)=>{if((!e.startCC||e.skippedSegments)&&g.cc!==f.cc){const S=f.cc-g.cc;for(let E=y;E<x.length;E++)x[E].cc+=S;e.endCC=x[x.length-1].cc}Ne(f.startPTS)&&Ne(f.endPTS)&&(g.setStart(g.startPTS=f.startPTS),g.startDTS=f.startDTS,g.maxStartPTS=f.maxStartPTS,g.endPTS=f.endPTS,g.endDTS=f.endDTS,g.minEndPTS=f.minEndPTS,g.setDuration(f.endPTS-f.startPTS),g.duration&&(r=g),e.PTSKnown=e.alignedSliding=!0),f.hasStreams&&(g.elementaryStreams=f.elementaryStreams),g.loader=f.loader,f.hasStats&&(g.stats=f.stats),f.initSegment&&(g.initSegment=f.initSegment,s=f.initSegment)});const l=e.fragments,c=e.fragmentHint?l.concat(e.fragmentHint):l;if(s&&c.forEach(f=>{var g;f&&(!f.initSegment||f.initSegment.relurl===((g=s)==null?void 0:g.relurl))&&(f.initSegment=s)}),e.skippedSegments){if(e.deltaUpdateFailed=l.some(f=>!f),e.deltaUpdateFailed){t.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let f=e.skippedSegments;f--;)l.shift();e.startSN=l[0].sn}else{e.canSkipDateRanges&&(e.dateRanges=Mw(n.dateRanges,e,t));const f=n.fragments.filter(g=>g.rawProgramDateTime);if(n.hasProgramDateTime&&!e.hasProgramDateTime)for(let g=1;g<c.length;g++)c[g].programDateTime===null&&zf(c[g],c[g-1],f);WS(f,e)}e.endCC=l[l.length-1].cc}if(!e.startCC){var h;const f=eb(n,e.startSN-1);e.startCC=(h=f?.cc)!=null?h:l[0].cc}jw(n.partList,e.partList,(f,g)=>{g.elementaryStreams=f.elementaryStreams,g.stats=f.stats}),r?XS(e,r,r.startPTS,r.endPTS,r.startDTS,r.endDTS,t):ZS(n,e),l.length&&(e.totalduration=e.edge-l[0].start),e.driftStartTime=n.driftStartTime,e.driftStart=n.driftStart;const u=e.advancedDateTime;if(e.advanced&&u){const f=e.edge;e.driftStart||(e.driftStartTime=u,e.driftStart=f),e.driftEndTime=u,e.driftEnd=f}else e.driftEndTime=n.driftEndTime,e.driftEnd=n.driftEnd,e.advancedDateTime=n.advancedDateTime;e.requestScheduled===-1&&(e.requestScheduled=n.requestScheduled)}function Mw(n,e,t){const{dateRanges:s,recentlyRemovedDateranges:i}=e,r=Dt({},n);i&&i.forEach(h=>{delete r[h]});const c=Object.keys(r).length;return c?(Object.keys(s).forEach(h=>{const u=r[h],f=new zS(s[h].attr,u);f.isValid?(r[h]=f,u||(f.tagOrder+=c)):t.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${Mt(s[h].attr)}"`)}),r):s}function jw(n,e,t){if(n&&e){let s=0;for(let i=0,r=n.length;i<=r;i++){const l=n[i],c=e[i+s];l&&c&&l.index===c.index&&l.fragment.sn===c.fragment.sn?t(l,c):s--}}}function Bw(n,e,t){const s=e.skippedSegments,i=Math.max(n.startSN,e.startSN)-e.startSN,r=(n.fragmentHint?1:0)+(s?e.endSN:Math.min(n.endSN,e.endSN))-e.startSN,l=e.startSN-n.startSN,c=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,h=n.fragmentHint?n.fragments.concat(n.fragmentHint):n.fragments;for(let u=i;u<=r;u++){const f=h[l+u];let g=c[u];if(s&&!g&&f&&(g=e.fragments[u]=f),f&&g){t(f,g,u,c);const y=f.relurl,x=g.relurl;if(y&&Fw(y,x)){e.playlistParsingError=Kv(`media sequence mismatch ${g.sn}:`,n,e,f,g);return}else if(f.cc!==g.cc){e.playlistParsingError=Kv(`discontinuity sequence mismatch (${f.cc}!=${g.cc})`,n,e,f,g);return}}}}function Kv(n,e,t,s,i){return new Error(`${n} ${i.url}
Playlist starting @${e.startSN}
${e.m3u8}

Playlist starting @${t.startSN}
${t.m3u8}`)}function ZS(n,e,t=!0){const s=e.startSN+e.skippedSegments-n.startSN,i=n.fragments,r=s>=0;let l=0;if(r&&s<i.length)l=i[s].start;else if(r&&e.startSN===n.endSN+1)l=n.fragmentEnd;else if(r&&t)l=n.fragmentStart+s*e.levelTargetDuration;else if(!e.skippedSegments&&e.fragmentStart===0)l=n.fragmentStart;else return;Kf(e,l)}function Kf(n,e){if(e){const t=n.fragments;for(let s=n.skippedSegments;s<t.length;s++)t[s].addStart(e);n.fragmentHint&&n.fragmentHint.addStart(e)}}function JS(n,e=1/0){let t=1e3*n.targetduration;if(n.updated){const s=n.fragments;if(s.length&&t*4>e){const r=s[s.length-1].duration*1e3;r<t&&(t=r)}}else t/=2;return Math.round(t)}function eb(n,e,t){if(!n)return null;let s=n.fragments[e-n.startSN];return s||(s=n.fragmentHint,s&&s.sn===e)?s:e<n.startSN&&t&&t.sn===e?t:null}function Yv(n,e,t){return n?tb(n.partList,e,t):null}function tb(n,e,t){if(n)for(let s=n.length;s--;){const i=n[s];if(i.index===t&&i.fragment.sn===e)return i}return null}function sb(n){n.forEach((e,t)=>{var s;(s=e.details)==null||s.fragments.forEach(i=>{i.level=t,i.initSegment&&(i.initSegment.level=t)})})}function Fw(n,e){return n!==e&&e?qv(n)!==qv(e):!1}function qv(n){return n.replace(/\?[^?]*$/,"")}function zl(n,e){for(let s=0,i=n.length;s<i;s++){var t;if(((t=n[s])==null?void 0:t.cc)===e)return n[s]}return null}function Vw(n,e){return!!(n&&e.startCC<n.endCC&&e.endCC>n.startCC)}function Qv(n,e){const t=n.start+e;n.startPTS=t,n.setStart(t),n.endPTS=t+n.duration}function ib(n,e){const t=e.fragments;for(let s=0,i=t.length;s<i;s++)Qv(t[s],n);e.fragmentHint&&Qv(e.fragmentHint,n),e.alignedSliding=!0}function $w(n,e){n&&(nb(e,n),e.alignedSliding||Tu(e,n),!e.alignedSliding&&!e.skippedSegments&&ZS(n,e,!1))}function nb(n,e){if(!Vw(e,n))return;const t=Math.min(e.endCC,n.endCC),s=zl(e.fragments,t),i=zl(n.fragments,t);if(!s||!i)return;Lt.log(`Aligning playlist at start of dicontinuity sequence ${t}`);const r=s.start-i.start;ib(r,n)}function Tu(n,e){if(!n.hasProgramDateTime||!e.hasProgramDateTime)return;const t=n.fragments,s=e.fragments;if(!t.length||!s.length)return;let i,r;const l=Math.min(e.endCC,n.endCC);e.startCC<l&&n.startCC<l&&(i=zl(s,l),r=zl(t,l)),(!i||!r)&&(i=s[Math.floor(s.length/2)],r=zl(t,i.cc)||t[Math.floor(t.length/2)]);const c=i.programDateTime,h=r.programDateTime;if(!c||!h)return;const u=(h-c)/1e3-(r.start-i.start);ib(u,n)}function $s(n,e,t){ei(n,e,t),n.addEventListener(e,t)}function ei(n,e,t){n.removeEventListener(e,t)}const Gw={toString:function(n){let e="";const t=n.length;for(let s=0;s<t;s++)e+=`[${n.start(s).toFixed(3)}-${n.end(s).toFixed(3)}]`;return e}},ue={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class Rm extends GS{constructor(e,t,s,i,r){super(i,e.logger),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=ue.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.loadingParts=!1,this.loopSn=void 0,this.onMediaSeeking=()=>{const{config:l,fragCurrent:c,media:h,mediaBuffer:u,state:f}=this,g=h?h.currentTime:0,y=qe.bufferInfo(u||h,g,l.maxBufferHole),x=!y.len;if(this.log(`Media seeking to ${Ne(g)?g.toFixed(3):g}, state: ${f}, ${x?"out of":"in"} buffer`),this.state===ue.ENDED)this.resetLoadingState();else if(c){const S=l.maxFragLookUpTolerance,E=c.start-S,T=c.start+c.duration+S;if(x||T<y.start||E>y.end){const A=g>T;(g<E||A)&&(A&&c.loader&&(this.log(`Cancelling fragment load for seek (sn: ${c.sn})`),c.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}if(h){this.fragmentTracker.removeFragmentsInRange(g,1/0,this.playlistType,!0);const S=this.lastCurrentTime;if(g>S&&(this.lastCurrentTime=g),!this.loadingParts){const E=Math.max(y.end,g),T=this.shouldLoadParts(this.getLevelDetails(),E);T&&(this.log(`LL-Part loading ON after seeking to ${g.toFixed(2)} with buffer @${E.toFixed(2)}`),this.loadingParts=T)}}this.hls.hasEnoughToStart||(this.log(`Setting ${x?"startPosition":"nextLoadPosition"} to ${g} for seek without enough to start`),this.nextLoadPosition=g,x&&(this.startPosition=g)),x&&this.state===ue.IDLE&&this.tickImmediate()},this.onMediaEnded=()=>{this.log("setting startPosition to 0 because media ended"),this.startPosition=this.lastCurrentTime=0},this.playlistType=r,this.hls=e,this.fragmentLoader=new yw(e.config),this.keyLoader=s,this.fragmentTracker=t,this.config=e.config,this.decrypter=new Em(e.config)}registerListeners(){const{hls:e}=this;e.on(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(L.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(L.ERROR,this.onError,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){if(this.state===ue.STOPPED)return;this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;e!=null&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=ue.STOPPED}get startPositionValue(){const{nextLoadPosition:e,startPosition:t}=this;return t===-1&&e?e:t}get bufferingEnabled(){return this.buffering}pauseBuffering(){this.buffering=!1}resumeBuffering(){this.buffering=!0}get inFlightFrag(){return{frag:this.fragCurrent,state:this.state}}_streamEnded(e,t){if(t.live||!this.media)return!1;const s=e.end||0,i=this.config.timelineOffset||0;if(s<=i)return!1;const r=e.buffered;this.config.maxBufferHole&&r&&r.length>1&&(e=qe.bufferedInfo(r,e.start,0));const l=e.nextStart;if(l&&l>i&&l<t.edge||this.media.currentTime<e.start)return!1;const h=t.partList;if(h!=null&&h.length){const f=h[h.length-1];return qe.isBuffered(this.media,f.start+f.duration/2)}const u=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(u)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null)return this.levelLastLoaded.details}get timelineOffset(){const e=this.config.timelineOffset;if(e){var t;return((t=this.getLevelDetails())==null?void 0:t.appliedTimelineOffset)||e}return 0}onMediaAttached(e,t){const s=this.media=this.mediaBuffer=t.media;$s(s,"seeking",this.onMediaSeeking),$s(s,"ended",this.onMediaEnded);const i=this.config;this.levels&&i.autoStartLoad&&this.state===ue.STOPPED&&this.startLoad(i.startPosition)}onMediaDetaching(e,t){const s=!!t.transferMedia,i=this.media;if(i!==null){if(i.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),ei(i,"seeking",this.onMediaSeeking),ei(i,"ended",this.onMediaEnded),this.keyLoader&&!s&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,s){this.resetLoadingState(),this.resetTransmuxer();return}this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}}onManifestLoading(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1}onError(e,t){}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset}onHandlerDestroying(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),super.onHandlerDestroying(),this.hls=this.onMediaSeeking=this.onMediaEnded=null}onHandlerDestroyed(){this.state=ue.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,s){this.startFragRequested=!0,this._loadFragForPlayback(e,t,s)}_loadFragForPlayback(e,t,s){const i=r=>{const l=r.frag;if(this.fragContextChanged(l)){this.warn(`${l.type} sn: ${l.sn}${r.part?" part: "+r.part.index:""} of ${this.fragInfo(l,!1,r.part)}) was dropped during download.`),this.fragmentTracker.removeFragment(l);return}l.stats.chunkCount++,this._handleFragmentLoadProgress(r)};this._doFragLoad(e,t,s,i).then(r=>{if(!r)return;const l=this.state,c=r.frag;if(this.fragContextChanged(c)){(l===ue.FRAG_LOADING||!this.fragCurrent&&l===ue.PARSING)&&(this.fragmentTracker.removeFragment(c),this.state=ue.IDLE);return}"payload"in r&&(this.log(`Loaded ${c.type} sn: ${c.sn} of ${this.playlistLabel()} ${c.level}`),this.hls.trigger(L.FRAG_LOADED,r)),this._handleFragmentLoadComplete(r)}).catch(r=>{this.state===ue.STOPPED||this.state===ue.ERROR||(this.warn(`Frag error: ${r?.message||r}`),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var t;const{fragmentTracker:s}=this;if(s.getState(e)===fs.APPENDING){const r=e.type,l=this.getFwdBufferInfo(this.mediaBuffer,r),c=Math.max(e.duration,l?l.len:this.config.maxBufferLength),h=this.backtrackFragment;((h?e.sn-h.sn:0)===1||this.reduceMaxBufferLength(c,e.duration))&&s.removeFragment(e)}else((t=this.mediaBuffer)==null?void 0:t.buffered.length)===0?s.removeAllFragments():s.hasParts(e.type)&&(s.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),s.getState(e)===fs.PARTIAL&&s.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}waitForLive(e){const t=e.details;return t?.live&&t.type!=="EVENT"&&(this.levelLastLoaded!==e||t.expired)}flushMainBuffer(e,t,s=null){if(!(e-t))return;const i={startOffset:e,endOffset:t,type:s};this.hls.trigger(L.BUFFER_FLUSHING,i)}_loadInitSegment(e,t){this._doFragLoad(e,t).then(s=>{const i=s?.frag;if(!i||this.fragContextChanged(i)||!this.levels)throw new Error("init load aborted");return s}).then(s=>{const{hls:i}=this,{frag:r,payload:l}=s,c=r.decryptdata;if(l&&l.byteLength>0&&c!=null&&c.key&&c.iv&&Br(c.method)){const h=self.performance.now();return this.decrypter.decrypt(new Uint8Array(l),c.key.buffer,c.iv.buffer,Im(c.method)).catch(u=>{throw i.trigger(L.ERROR,{type:Be.MEDIA_ERROR,details:Q.FRAG_DECRYPT_ERROR,fatal:!1,error:u,reason:u.message,frag:r}),u}).then(u=>{const f=self.performance.now();return i.trigger(L.FRAG_DECRYPTED,{frag:r,payload:u,stats:{tstart:h,tdecrypt:f}}),s.payload=u,this.completeInitSegmentLoad(s)})}return this.completeInitSegmentLoad(s)}).catch(s=>{this.state===ue.STOPPED||this.state===ue.ERROR||(this.warn(s),this.resetFragmentLoading(e))})}completeInitSegmentLoad(e){const{levels:t}=this;if(!t)throw new Error("init load aborted, missing levels");const s=e.frag.stats;this.state!==ue.STOPPED&&(this.state=ue.IDLE),e.frag.data=new Uint8Array(e.payload),s.parsing.start=s.buffering.start=self.performance.now(),s.parsing.end=s.buffering.end=self.performance.now(),this.tick()}unhandledEncryptionError(e,t){var s,i;const r=e.tracks;if(r&&!t.encrypted&&((s=r.audio)!=null&&s.encrypted||(i=r.video)!=null&&i.encrypted)&&(!this.config.emeEnabled||!this.keyLoader.emeController)){const l=this.media,c=new Error(`Encrypted track with no key in ${this.fragInfo(t)} (media ${l?"attached mediaKeys: "+l.mediaKeys:"detached"})`);return this.warn(c.message),!l||l.mediaKeys?!1:(this.hls.trigger(L.ERROR,{type:Be.KEY_SYSTEM_ERROR,details:Q.KEY_SYSTEM_NO_KEYS,fatal:!1,error:c,frag:t}),this.resetTransmuxer(),!0)}return!1}fragContextChanged(e){const{fragCurrent:t}=this;return!e||!t||e.sn!==t.sn||e.level!==t.level}fragBufferedComplete(e,t){const s=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)} > buffer:${s?Gw.toString(qe.getBuffered(s)):"(detached)"})`),ss(e)){var i;if(e.type!==ke.SUBTITLE){const l=e.elementaryStreams;if(!Object.keys(l).some(c=>!!l[c])){this.state=ue.IDLE;return}}const r=(i=this.levels)==null?void 0:i[e.level];r!=null&&r.fragmentError&&(this.log(`Resetting level fragment error count of ${r.fragmentError} on frag buffered`),r.fragmentError=0)}this.state=ue.IDLE}_handleFragmentLoadComplete(e){const{transmuxer:t}=this;if(!t)return;const{frag:s,part:i,partsLoaded:r}=e,l=!r||r.length===0||r.some(h=>!h),c=new Am(s.level,s.sn,s.stats.chunkCount+1,0,i?i.index:-1,!l);t.flush(c)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,s=null,i){var r;this.fragCurrent=e;const l=t.details;if(!this.levels||!l)throw new Error(`frag load aborted, missing level${l?"":" detail"}s`);let c=null;if(e.encrypted&&!((r=e.decryptdata)!=null&&r.key)){if(this.log(`Loading key for ${e.sn} of [${l.startSN}-${l.endSN}], ${this.playlistLabel()} ${e.level}`),this.state=ue.KEY_LOADING,this.fragCurrent=e,c=this.keyLoader.load(e).then(y=>{if(!this.fragContextChanged(y.frag))return this.hls.trigger(L.KEY_LOADED,y),this.state===ue.KEY_LOADING&&(this.state=ue.IDLE),y}),this.hls.trigger(L.KEY_LOADING,{frag:e}),this.fragCurrent===null)return this.log("context changed in KEY_LOADING"),Promise.resolve(null)}else e.encrypted||(c=this.keyLoader.loadClear(e,l.encryptedFragments,this.startFragRequested),c&&this.log("[eme] blocking frag load until media-keys acquired"));const h=this.fragPrevious;if(ss(e)&&(!h||e.sn!==h.sn)){const y=this.shouldLoadParts(t.details,e.end);y!==this.loadingParts&&(this.log(`LL-Part loading ${y?"ON":"OFF"} loading sn ${h?.sn}->${e.sn}`),this.loadingParts=y)}if(s=Math.max(e.start,s||0),this.loadingParts&&ss(e)){const y=l.partList;if(y&&i){s>l.fragmentEnd&&l.fragmentHint&&(e=l.fragmentHint);const x=this.getNextPart(y,e,s);if(x>-1){const S=y[x];e=this.fragCurrent=S.fragment,this.log(`Loading ${e.type} sn: ${e.sn} part: ${S.index} (${x}/${y.length-1}) of ${this.fragInfo(e,!1,S)}) cc: ${e.cc} [${l.startSN}-${l.endSN}], target: ${parseFloat(s.toFixed(3))}`),this.nextLoadPosition=S.start+S.duration,this.state=ue.FRAG_LOADING;let E;return c?E=c.then(T=>!T||this.fragContextChanged(T.frag)?null:this.doFragPartsLoad(e,S,t,i)).catch(T=>this.handleFragLoadError(T)):E=this.doFragPartsLoad(e,S,t,i).catch(T=>this.handleFragLoadError(T)),this.hls.trigger(L.FRAG_LOADING,{frag:e,part:S,targetBufferTime:s}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):E}else if(!e.url||this.loadedEndOfParts(y,s))return Promise.resolve(null)}}if(ss(e)&&this.loadingParts){var u;this.log(`LL-Part loading OFF after next part miss @${s.toFixed(2)} Check buffer at sn: ${e.sn} loaded parts: ${(u=l.partList)==null?void 0:u.filter(y=>y.loaded).map(y=>`[${y.start}-${y.end}]`)}`),this.loadingParts=!1}else if(!e.url)return Promise.resolve(null);this.log(`Loading ${e.type} sn: ${e.sn} of ${this.fragInfo(e,!1)}) cc: ${e.cc} ${"["+l.startSN+"-"+l.endSN+"]"}, target: ${parseFloat(s.toFixed(3))}`),Ne(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=ue.FRAG_LOADING;const f=this.config.progressive&&e.type!==ke.SUBTITLE;let g;return f&&c?g=c.then(y=>!y||this.fragContextChanged(y.frag)?null:this.fragmentLoader.load(e,i)).catch(y=>this.handleFragLoadError(y)):g=Promise.all([this.fragmentLoader.load(e,f?i:void 0),c]).then(([y])=>(!f&&i&&i(y),y)).catch(y=>this.handleFragLoadError(y)),this.hls.trigger(L.FRAG_LOADING,{frag:e,targetBufferTime:s}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):g}doFragPartsLoad(e,t,s,i){return new Promise((r,l)=>{var c;const h=[],u=(c=s.details)==null?void 0:c.partList,f=g=>{this.fragmentLoader.loadPart(e,g,i).then(y=>{h[g.index]=y;const x=y.part;this.hls.trigger(L.FRAG_LOADED,y);const S=Yv(s.details,e.sn,g.index+1)||tb(u,e.sn,g.index+1);if(S)f(S);else return r({frag:e,part:x,partsLoaded:h})}).catch(l)};f(t)})}handleFragLoadError(e){if("data"in e){const t=e.data;t.frag&&t.details===Q.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):t.frag&&t.type===Be.KEY_SYSTEM_ERROR?(t.frag.abortRequests(),this.resetStartWhenNotLoaded(),this.resetFragmentLoading(t.frag)):this.hls.trigger(L.ERROR,t)}else this.hls.trigger(L.ERROR,{type:Be.OTHER_ERROR,details:Q.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const t=this.getCurrentContext(e);if(!t||this.state!==ue.PARSING){!this.fragCurrent&&this.state!==ue.STOPPED&&this.state!==ue.ERROR&&(this.state=ue.IDLE);return}const{frag:s,part:i,level:r}=t,l=self.performance.now();s.stats.parsing.end=l,i&&(i.stats.parsing.end=l);const c=this.getLevelDetails(),u=c&&s.sn>c.endSN||this.shouldLoadParts(c,s.end);u!==this.loadingParts&&(this.log(`LL-Part loading ${u?"ON":"OFF"} after parsing segment ending @${s.end.toFixed(2)}`),this.loadingParts=u),this.updateLevelTiming(s,i,r,e.partial)}shouldLoadParts(e,t){if(this.config.lowLatencyMode){if(!e)return this.loadingParts;if(e.partList){var s;const r=e.partList[0];if(r.fragment.type===ke.SUBTITLE)return!1;const l=r.end+(((s=e.fragmentHint)==null?void 0:s.duration)||0);if(t>=l){var i;if((this.hls.hasEnoughToStart?((i=this.media)==null?void 0:i.currentTime)||this.lastCurrentTime:this.getLoadPosition())>r.start-r.fragment.duration)return!0}}}return!1}getCurrentContext(e){const{levels:t,fragCurrent:s}=this,{level:i,sn:r,part:l}=e;if(!(t!=null&&t[i]))return this.warn(`Levels object was unset while buffering fragment ${r} of ${this.playlistLabel()} ${i}. The current chunk will not be buffered.`),null;const c=t[i],h=c.details,u=l>-1?Yv(h,r,l):null,f=u?u.fragment:eb(h,r,s);return f?(s&&s!==f&&(f.stats=s.stats),{frag:f,part:u,level:c}):null}bufferFragmentData(e,t,s,i,r){if(this.state!==ue.PARSING)return;const{data1:l,data2:c}=e;let h=l;if(c&&(h=Ui(l,c)),!h.length)return;const u=this.initPTS[t.cc],f=u?-u.baseTime/u.timescale:void 0,g={type:e.type,frag:t,part:s,chunkMeta:i,offset:f,parent:t.type,data:h};if(this.hls.trigger(L.BUFFER_APPENDING,g),e.dropped&&e.independent&&!s){if(r)return;this.flushBufferGap(t)}}flushBufferGap(e){const t=this.media;if(!t)return;if(!qe.isBuffered(t,t.currentTime)){this.flushMainBuffer(0,e.start);return}const s=t.currentTime,i=qe.bufferInfo(t,s,0),r=e.duration,l=Math.min(this.config.maxFragLookUpTolerance*2,r*.25),c=Math.max(Math.min(e.start-l,i.end-l),s+l);e.start-c>l&&this.flushMainBuffer(c,e.start)}getFwdBufferInfo(e,t){var s;const i=this.getLoadPosition();if(!Ne(i))return null;const l=this.lastCurrentTime>i||(s=this.media)!=null&&s.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(e,i,t,l)}getFwdBufferInfoAtPos(e,t,s,i){const r=qe.bufferInfo(e,t,i);if(r.len===0&&r.nextStart!==void 0){const l=this.fragmentTracker.getBufferedFrag(t,s);if(l&&(r.nextStart<=l.end||l.gap)){const c=Math.max(Math.min(r.nextStart,l.end)-t,i);return qe.bufferInfo(e,t,c)}}return r}getMaxBufferLength(e){const{config:t}=this;let s;return e?s=Math.max(8*t.maxBufferSize/e,t.maxBufferLength):s=t.maxBufferLength,Math.min(s,t.maxMaxBufferLength)}reduceMaxBufferLength(e,t){const s=this.config,i=Math.max(Math.min(e-t,s.maxBufferLength),t),r=Math.max(e-t*3,s.maxMaxBufferLength/2,i);return r>=i?(s.maxMaxBufferLength=r,this.warn(`Reduce max buffer length to ${r}s`),!0):!1}getAppendedFrag(e,t=ke.MAIN){const s=this.fragmentTracker?this.fragmentTracker.getAppendedFrag(e,t):null;return s&&"fragment"in s?s.fragment:s}getNextFragment(e,t){const s=t.fragments,i=s.length;if(!i)return null;const{config:r}=this,l=s[0].start,c=r.lowLatencyMode&&!!t.partList;let h=null;if(t.live){const g=r.initialLiveManifestSize;if(i<g)return this.warn(`Not enough fragments to start playback (have: ${i}, need: ${g})`),null;if(!t.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||e<l){var u;c&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),h=this.getInitialLiveFragment(t);const y=this.hls.startPosition,x=this.hls.liveSyncPosition,S=h?(y!==-1&&y>=l?y:x)||h.start:e;this.log(`Setting startPosition to ${S} to match start frag at live edge. mainStart: ${y} liveSyncPosition: ${x} frag.start: ${(u=h)==null?void 0:u.start}`),this.startPosition=this.nextLoadPosition=S}}else e<=l&&(h=s[0]);if(!h){const g=this.loadingParts?t.partEnd:t.fragmentEnd;h=this.getFragmentAtPosition(e,g,t)}let f=this.filterReplacedPrimary(h,t);if(!f&&h){const g=h.sn-t.startSN;f=this.filterReplacedPrimary(s[g+1]||null,t)}return this.mapToInitFragWhenRequired(f)}isLoopLoading(e,t){const s=this.fragmentTracker.getState(e);return(s===fs.OK||s===fs.PARTIAL&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,s,i,r){let l=null;if(e.gap&&(l=this.getNextFragment(this.nextLoadPosition,t),l&&!l.gap&&s.nextStart)){const c=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,s.nextStart,i,0);if(c!==null&&s.len+c.len>=r){const h=l.sn;return this.loopSn!==h&&(this.log(`buffer full after gaps in "${i}" playlist starting at sn: ${h}`),this.loopSn=h),null}}return this.loopSn=void 0,l}get primaryPrefetch(){if(Wv(this.config)){var e;if((e=this.hls.interstitialsManager)==null||(e=e.playingItem)==null?void 0:e.event)return!0}return!1}filterReplacedPrimary(e,t){if(!e)return e;if(Wv(this.config)&&e.type!==ke.SUBTITLE){const s=this.hls.interstitialsManager,i=s?.bufferingItem;if(i){const l=i.event;if(l){if(l.appendInPlace||Math.abs(e.start-i.start)>1||i.start===0)return null}else if(e.end<=i.start&&t?.live===!1||e.start>i.end&&i.nextEvent&&(i.nextEvent.appendInPlace||e.start-i.end>1))return null}const r=s?.playerQueue;if(r)for(let l=r.length;l--;){const c=r[l].interstitial;if(c.appendInPlace&&e.start>=c.startTime&&e.end<=c.resumeTime)return null}}return e}mapToInitFragWhenRequired(e){return e!=null&&e.initSegment&&!e.initSegment.data&&!this.bitrateTest?e.initSegment:e}getNextPart(e,t,s){let i=-1,r=!1,l=!0;for(let c=0,h=e.length;c<h;c++){const u=e[c];if(l=l&&!u.independent,i>-1&&s<u.start)break;const f=u.loaded;f?i=-1:(r||(u.independent||l)&&u.fragment===t)&&(u.fragment!==t&&this.warn(`Need buffer at ${s} but next unloaded part starts at ${u.start}`),i=c),r=f}return i}loadedEndOfParts(e,t){let s;for(let i=e.length;i--;){if(s=e[i],!s.loaded)return!1;if(t>s.start)return!0}return!1}getInitialLiveFragment(e){const t=e.fragments,s=this.fragPrevious;let i=null;if(s){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${s.programDateTime}`),i=aw(t,s.endProgramDateTime,this.config.maxFragLookUpTolerance)),!i){const r=s.sn+1;if(r>=e.startSN&&r<=e.endSN){const l=t[r-e.startSN];s.cc===l.cc&&(i=l,this.log(`Live playlist, switching playlist, load frag with next SN: ${i.sn}`))}i||(i=FS(e,s.cc,s.end),i&&this.log(`Live playlist, switching playlist, load frag with same CC: ${i.sn}`))}}else{const r=this.hls.liveSyncPosition;r!==null&&(i=this.getFragmentAtPosition(r,this.bitrateTest?e.fragmentEnd:e.edge,e))}return i}getFragmentAtPosition(e,t,s){const{config:i}=this;let{fragPrevious:r}=this,{fragments:l,endSN:c}=s;const{fragmentHint:h}=s,{maxFragLookUpTolerance:u}=i,f=s.partList,g=!!(this.loadingParts&&f!=null&&f.length&&h);g&&!this.bitrateTest&&f[f.length-1].fragment.sn===h.sn&&(l=l.concat(h),c=h.sn);let y;if(e<t){var x;const E=e<this.lastCurrentTime||e>t-u||(x=this.media)!=null&&x.paused||!this.startFragRequested?0:u;y=Qa(r,l,e,E)}else y=l[l.length-1];if(y){const S=y.sn-s.startSN,E=this.fragmentTracker.getState(y);if((E===fs.OK||E===fs.PARTIAL&&y.gap)&&(r=y),r&&y.sn===r.sn&&(!g||f[0].fragment.sn>y.sn||!s.live)&&y.level===r.level){const A=l[S+1];y.sn<c&&this.fragmentTracker.getState(A)!==fs.OK?y=A:y=null}}return y}alignPlaylists(e,t,s){const i=e.fragments.length;if(!i)return this.warn("No fragments in live playlist"),0;const r=e.fragmentStart,l=!t,c=e.alignedSliding&&Ne(r);if(l||!c&&!r){$w(s,e);const h=e.fragmentStart;return this.log(`Live playlist sliding: ${h.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} fragments: ${i}`),h}return r}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,e.partTarget*3)}setStartPosition(e,t){let s=this.startPosition;s<t&&(s=-1);const i=this.timelineOffset;if(s===-1){const r=this.startTimeOffset!==null,l=r?this.startTimeOffset:e.startTimeOffset;l!==null&&Ne(l)?(s=t+l,l<0&&(s+=e.edge),s=Math.min(Math.max(t,s),t+e.totalduration),this.log(`Setting startPosition to ${s} for start time offset ${l} found in ${r?"multivariant":"media"} playlist`),this.startPosition=s):e.live?(s=this.hls.liveSyncPosition||t,this.log(`Setting startPosition to -1 to start at live edge ${s}`),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=s=0),this.lastCurrentTime=s+i}this.nextLoadPosition=s+i}getLoadPosition(){var e;const{media:t}=this;let s=0;return(e=this.hls)!=null&&e.hasEnoughToStart&&t?s=t.currentTime:this.nextLoadPosition>=0&&(s=this.nextLoadPosition),s}handleFragLoadAborted(e,t){this.transmuxer&&e.type===this.playlistType&&ss(e)&&e.stats.aborted&&(this.log(`Fragment ${e.sn}${t?" part "+t.index:""} of ${this.playlistLabel()} ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){(!this.fragCurrent||!this.fragContextChanged(e)&&this.state!==ue.FRAG_LOADING_WAITING_RETRY)&&(this.state=ue.IDLE)}onFragmentOrKeyLoadError(e,t){var s;if(t.chunkMeta&&!t.frag){const A=this.getCurrentContext(t.chunkMeta);A&&(t.frag=A.frag)}const i=t.frag;if(!i||i.type!==e||!this.levels)return;if(this.fragContextChanged(i)){var r;this.warn(`Frag load error must match current frag to retry ${i.url} > ${(r=this.fragCurrent)==null?void 0:r.url}`);return}const l=t.details===Q.FRAG_GAP;l&&this.fragmentTracker.fragBuffered(i,!0);const c=t.errorAction;if(!c){this.state=ue.ERROR;return}const{action:h,flags:u,retryCount:f=0,retryConfig:g}=c,y=!!g,x=y&&h===As.RetryRequest,S=y&&!c.resolved&&u===mi.MoveAllAlternatesMatchingHost,E=(s=this.hls.latestLevelDetails)==null?void 0:s.live;if(!x&&S&&ss(i)&&!i.endList&&E&&!$S(t))this.resetFragmentErrors(e),this.treatAsGap(i),c.resolved=!0;else if((x||S)&&f<g.maxNumRetry){var T;const A=$f((T=t.response)==null?void 0:T.code),_=Tm(g,f);if(this.resetStartWhenNotLoaded(),this.retryDate=self.performance.now()+_,this.state=ue.FRAG_LOADING_WAITING_RETRY,c.resolved=!0,A){this.log("Waiting for connection (offline)"),this.retryDate=1/0,t.reason="offline";return}this.warn(`Fragment ${i.sn} of ${e} ${i.level} errored with ${t.details}, retrying loading ${f+1}/${g.maxNumRetry} in ${_}ms`)}else if(g)if(this.resetFragmentErrors(e),f<g.maxNumRetry)!l&&h!==As.RemoveAlternatePermanently&&(c.resolved=!0);else{this.warn(`${t.details} reached or exceeded max retry (${f})`);return}else h===As.SendAlternateToPenaltyBox?this.state=ue.WAITING_LEVEL:this.state=ue.ERROR;this.tickImmediate()}checkRetryDate(){const e=self.performance.now(),t=this.retryDate,s=t===1/0;(!t||e>=t||s&&!$f(0))&&(s&&this.log("Connection restored (online)"),this.resetStartWhenNotLoaded(),this.state=ue.IDLE)}reduceLengthAndFlushBuffer(e){if(this.state===ue.PARSING||this.state===ue.PARSED){const t=e.frag,s=e.parent,i=this.getFwdBufferInfo(this.mediaBuffer,s),r=i&&i.len>.5;r&&this.reduceMaxBufferLength(i.len,t?.duration||10);const l=!r;return l&&this.warn(`Buffer full error while media.currentTime (${this.getLoadPosition()}) is not buffered, flush ${s} buffer`),t&&(this.fragmentTracker.removeFragment(t),this.nextLoadPosition=t.start),this.resetLoadingState(),l}return!1}resetFragmentErrors(e){e===ke.AUDIO&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==ue.STOPPED&&(this.state=ue.IDLE)}afterBufferFlushed(e,t,s){if(!e)return;const i=qe.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,i,s),this.state===ue.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==ue.STOPPED&&(this.state=ue.IDLE)}resetStartWhenNotLoaded(){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;const e=this.levelLastLoaded,t=e?e.details:null;t!=null&&t.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(t,t.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.log(`Loading context changed while buffering sn ${e.sn} of ${this.playlistLabel()} ${e.level===-1?"<removed>":e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,s,i){const r=s.details;if(!r){this.warn("level.details undefined");return}if(!Object.keys(e.elementaryStreams).reduce((h,u)=>{const f=e.elementaryStreams[u];if(f){const g=f.endPTS-f.startPTS;if(g<=0)return this.warn(`Could not parse fragment ${e.sn} ${u} duration reliably (${g})`),h||!1;const y=i?0:XS(r,e,f.startPTS,f.endPTS,f.startDTS,f.endDTS,this);return this.hls.trigger(L.LEVEL_PTS_UPDATED,{details:r,level:s,drift:y,type:u,frag:e,start:f.startPTS,end:f.endPTS}),!0}return h},!1)){var c;const h=((c=this.transmuxer)==null?void 0:c.error)===null;if((s.fragmentError===0||h&&(s.fragmentError<2||e.endList))&&this.treatAsGap(e,s),h){const u=new Error(`Found no media in fragment ${e.sn} of ${this.playlistLabel()} ${e.level} resetting transmuxer to fallback to playlist timing`);if(this.warn(u.message),this.hls.trigger(L.ERROR,{type:Be.MEDIA_ERROR,details:Q.FRAG_PARSING_ERROR,fatal:!1,error:u,frag:e,reason:`Found no media in msn ${e.sn} of ${this.playlistLabel()} "${s.url}"`}),!this.hls)return;this.resetTransmuxer()}}this.state=ue.PARSED,this.log(`Parsed ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)})`),this.hls.trigger(L.FRAG_PARSED,{frag:e,part:t})}playlistLabel(){return this.playlistType===ke.MAIN?"level":"track"}fragInfo(e,t=!0,s){var i,r;return`${this.playlistLabel()} ${e.level} (${s?"part":"frag"}:[${((i=t&&!s?e.startPTS:(s||e).start)!=null?i:NaN).toFixed(3)}-${((r=t&&!s?e.endPTS:(s||e).end)!=null?r:NaN).toFixed(3)}]${s&&e.type==="main"?"INDEPENDENT="+(s.independent?"YES":"NO"):""}`}treatAsGap(e,t){t&&t.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)}resetTransmuxer(){var e;(e=this.transmuxer)==null||e.reset()}recoverWorkerError(e){e.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(),this.resetLoadingState())}set state(e){const t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}}function Wv(n){return!!n.interstitialsController&&n.enableInterstitialPlayback!==!1}class ab{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:t}=this;let s;if(e.length)e.length===1?s=e[0]:s=Hw(e,t);else return new Uint8Array(0);return this.reset(),s}reset(){this.chunks.length=0,this.dataLength=0}}function Hw(n,e){const t=new Uint8Array(e);let s=0;for(let i=0;i<n.length;i++){const r=n[i];t.set(r,s),s+=r.length}return t}var ff={exports:{}},Xv;function zw(){return Xv||(Xv=1,(function(n){var e=Object.prototype.hasOwnProperty,t="~";function s(){}Object.create&&(s.prototype=Object.create(null),new s().__proto__||(t=!1));function i(h,u,f){this.fn=h,this.context=u,this.once=f||!1}function r(h,u,f,g,y){if(typeof f!="function")throw new TypeError("The listener must be a function");var x=new i(f,g||h,y),S=t?t+u:u;return h._events[S]?h._events[S].fn?h._events[S]=[h._events[S],x]:h._events[S].push(x):(h._events[S]=x,h._eventsCount++),h}function l(h,u){--h._eventsCount===0?h._events=new s:delete h._events[u]}function c(){this._events=new s,this._eventsCount=0}c.prototype.eventNames=function(){var u=[],f,g;if(this._eventsCount===0)return u;for(g in f=this._events)e.call(f,g)&&u.push(t?g.slice(1):g);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(f)):u},c.prototype.listeners=function(u){var f=t?t+u:u,g=this._events[f];if(!g)return[];if(g.fn)return[g.fn];for(var y=0,x=g.length,S=new Array(x);y<x;y++)S[y]=g[y].fn;return S},c.prototype.listenerCount=function(u){var f=t?t+u:u,g=this._events[f];return g?g.fn?1:g.length:0},c.prototype.emit=function(u,f,g,y,x,S){var E=t?t+u:u;if(!this._events[E])return!1;var T=this._events[E],A=arguments.length,_,I;if(T.fn){switch(T.once&&this.removeListener(u,T.fn,void 0,!0),A){case 1:return T.fn.call(T.context),!0;case 2:return T.fn.call(T.context,f),!0;case 3:return T.fn.call(T.context,f,g),!0;case 4:return T.fn.call(T.context,f,g,y),!0;case 5:return T.fn.call(T.context,f,g,y,x),!0;case 6:return T.fn.call(T.context,f,g,y,x,S),!0}for(I=1,_=new Array(A-1);I<A;I++)_[I-1]=arguments[I];T.fn.apply(T.context,_)}else{var C=T.length,N;for(I=0;I<C;I++)switch(T[I].once&&this.removeListener(u,T[I].fn,void 0,!0),A){case 1:T[I].fn.call(T[I].context);break;case 2:T[I].fn.call(T[I].context,f);break;case 3:T[I].fn.call(T[I].context,f,g);break;case 4:T[I].fn.call(T[I].context,f,g,y);break;default:if(!_)for(N=1,_=new Array(A-1);N<A;N++)_[N-1]=arguments[N];T[I].fn.apply(T[I].context,_)}}return!0},c.prototype.on=function(u,f,g){return r(this,u,f,g,!1)},c.prototype.once=function(u,f,g){return r(this,u,f,g,!0)},c.prototype.removeListener=function(u,f,g,y){var x=t?t+u:u;if(!this._events[x])return this;if(!f)return l(this,x),this;var S=this._events[x];if(S.fn)S.fn===f&&(!y||S.once)&&(!g||S.context===g)&&l(this,x);else{for(var E=0,T=[],A=S.length;E<A;E++)(S[E].fn!==f||y&&!S[E].once||g&&S[E].context!==g)&&T.push(S[E]);T.length?this._events[x]=T.length===1?T[0]:T:l(this,x)}return this},c.prototype.removeAllListeners=function(u){var f;return u?(f=t?t+u:u,this._events[f]&&l(this,f)):(this._events=new s,this._eventsCount=0),this},c.prototype.off=c.prototype.removeListener,c.prototype.addListener=c.prototype.on,c.prefixed=t,c.EventEmitter=c,n.exports=c})(ff)),ff.exports}var Kw=zw(),Lm=y1(Kw);const Zl="1.6.15",zr={};function Yw(){return typeof __HLS_WORKER_BUNDLE__=="function"}function qw(){const n=zr[Zl];if(n)return n.clientCount++,n;const e=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),t=self.URL.createObjectURL(e),i={worker:new self.Worker(t),objectURL:t,clientCount:1};return zr[Zl]=i,i}function Qw(n){const e=zr[n];if(e)return e.clientCount++,e;const t=new self.URL(n,self.location.href).href,i={worker:new self.Worker(t),scriptURL:t,clientCount:1};return zr[n]=i,i}function Ww(n){const e=zr[n||Zl];if(e&&e.clientCount--===1){const{worker:s,objectURL:i}=e;delete zr[n||Zl],i&&self.URL.revokeObjectURL(i),s.terminate()}}function rb(n,e){return e+10<=n.length&&n[e]===51&&n[e+1]===68&&n[e+2]===73&&n[e+3]<255&&n[e+4]<255&&n[e+6]<128&&n[e+7]<128&&n[e+8]<128&&n[e+9]<128}function wm(n,e){return e+10<=n.length&&n[e]===73&&n[e+1]===68&&n[e+2]===51&&n[e+3]<255&&n[e+4]<255&&n[e+6]<128&&n[e+7]<128&&n[e+8]<128&&n[e+9]<128}function Uu(n,e){let t=0;return t=(n[e]&127)<<21,t|=(n[e+1]&127)<<14,t|=(n[e+2]&127)<<7,t|=n[e+3]&127,t}function Jl(n,e){const t=e;let s=0;for(;wm(n,e);){s+=10;const i=Uu(n,e+6);s+=i,rb(n,e+10)&&(s+=10),e+=s}if(s>0)return n.subarray(t,t+s)}function Xw(n,e,t,s){const i=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],r=e[t+2],l=r>>2&15;if(l>12){const x=new Error(`invalid ADTS sampling index:${l}`);n.emit(L.ERROR,L.ERROR,{type:Be.MEDIA_ERROR,details:Q.FRAG_PARSING_ERROR,fatal:!0,error:x,reason:x.message});return}const c=(r>>6&3)+1,h=e[t+3]>>6&3|(r&1)<<2,u="mp4a.40."+c,f=i[l];let g=l;(c===5||c===29)&&(g-=3);const y=[c<<3|(g&14)>>1,(g&1)<<7|h<<3];return Lt.log(`manifest codec:${s}, parsed codec:${u}, channels:${h}, rate:${f} (ADTS object type:${c} sampling index:${l})`),{config:y,samplerate:f,channelCount:h,codec:u,parsedCodec:u,manifestCodec:s}}function lb(n,e){return n[e]===255&&(n[e+1]&246)===240}function ob(n,e){return n[e+1]&1?7:9}function Cm(n,e){return(n[e+3]&3)<<11|n[e+4]<<3|(n[e+5]&224)>>>5}function Zw(n,e){return e+5<n.length}function Eu(n,e){return e+1<n.length&&lb(n,e)}function Jw(n,e){return Zw(n,e)&&lb(n,e)&&Cm(n,e)<=n.length-e}function eC(n,e){if(Eu(n,e)){const t=ob(n,e);if(e+t>=n.length)return!1;const s=Cm(n,e);if(s<=t)return!1;const i=e+s;return i===n.length||Eu(n,i)}return!1}function cb(n,e,t,s,i){if(!n.samplerate){const r=Xw(e,t,s,i);if(!r)return;Dt(n,r)}}function ub(n){return 1024*9e4/n}function tC(n,e){const t=ob(n,e);if(e+t<=n.length){const s=Cm(n,e)-t;if(s>0)return{headerLength:t,frameLength:s}}}function db(n,e,t,s,i){const r=ub(n.samplerate),l=s+i*r,c=tC(e,t);let h;if(c){const{frameLength:g,headerLength:y}=c,x=y+g,S=Math.max(0,t+x-e.length);S?(h=new Uint8Array(x-y),h.set(e.subarray(t+y,e.length),0)):h=e.subarray(t+y,t+x);const E={unit:h,pts:l};return S||n.samples.push(E),{sample:E,length:x,missing:S}}const u=e.length-t;return h=new Uint8Array(u),h.set(e.subarray(t,e.length),0),{sample:{unit:h,pts:l},length:u,missing:-1}}function sC(n,e){return wm(n,e)&&Uu(n,e+6)+10<=n.length-e}function iC(n){return n instanceof ArrayBuffer?n:n.byteOffset==0&&n.byteLength==n.buffer.byteLength?n.buffer:new Uint8Array(n).buffer}function mf(n,e=0,t=1/0){return nC(n,e,t,Uint8Array)}function nC(n,e,t,s){const i=aC(n);let r=1;"BYTES_PER_ELEMENT"in s&&(r=s.BYTES_PER_ELEMENT);const l=rC(n)?n.byteOffset:0,c=(l+n.byteLength)/r,h=(l+e)/r,u=Math.floor(Math.max(0,Math.min(h,c))),f=Math.floor(Math.min(u+Math.max(t,0),c));return new s(i,u,f-u)}function aC(n){return n instanceof ArrayBuffer?n:n.buffer}function rC(n){return n&&n.buffer instanceof ArrayBuffer&&n.byteLength!==void 0&&n.byteOffset!==void 0}function lC(n){const e={key:n.type,description:"",data:"",mimeType:null,pictureType:null},t=3;if(n.size<2)return;if(n.data[0]!==t){console.log("Ignore frame with unrecognized character encoding");return}const s=n.data.subarray(1).indexOf(0);if(s===-1)return;const i=xi(mf(n.data,1,s)),r=n.data[2+s],l=n.data.subarray(3+s).indexOf(0);if(l===-1)return;const c=xi(mf(n.data,3+s,l));let h;return i==="-->"?h=xi(mf(n.data,4+s+l)):h=iC(n.data.subarray(4+s+l)),e.mimeType=i,e.pictureType=r,e.description=c,e.data=h,e}function oC(n){if(n.size<2)return;const e=xi(n.data,!0),t=new Uint8Array(n.data.subarray(e.length+1));return{key:n.type,info:e,data:t.buffer}}function cC(n){if(n.size<2)return;if(n.type==="TXXX"){let t=1;const s=xi(n.data.subarray(t),!0);t+=s.length+1;const i=xi(n.data.subarray(t));return{key:n.type,info:s,data:i}}const e=xi(n.data.subarray(1));return{key:n.type,info:"",data:e}}function uC(n){if(n.type==="WXXX"){if(n.size<2)return;let t=1;const s=xi(n.data.subarray(t),!0);t+=s.length+1;const i=xi(n.data.subarray(t));return{key:n.type,info:s,data:i}}const e=xi(n.data);return{key:n.type,info:"",data:e}}function dC(n){return n.type==="PRIV"?oC(n):n.type[0]==="W"?uC(n):n.type==="APIC"?lC(n):cC(n)}function hC(n){const e=String.fromCharCode(n[0],n[1],n[2],n[3]),t=Uu(n,4),s=10;return{type:e,size:t,data:n.subarray(s,s+t)}}const Bc=10,fC=10;function hb(n){let e=0;const t=[];for(;wm(n,e);){const s=Uu(n,e+6);n[e+5]>>6&1&&(e+=Bc),e+=Bc;const i=e+s;for(;e+fC<i;){const r=hC(n.subarray(e)),l=dC(r);l&&t.push(l),e+=r.size+Bc}rb(n,e)&&(e+=Bc)}return t}function fb(n){return n&&n.key==="PRIV"&&n.info==="com.apple.streaming.transportStreamTimestamp"}function mC(n){if(n.data.byteLength===8){const e=new Uint8Array(n.data),t=e[3]&1;let s=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return s/=45,t&&(s+=4772185884e-2),Math.round(s)}}function Nm(n){const e=hb(n);for(let t=0;t<e.length;t++){const s=e[t];if(fb(s))return mC(s)}}let gi=(function(n){return n.audioId3="org.id3",n.dateRange="com.apple.quicktime.HLS",n.emsg="https://aomedia.org/emsg/ID3",n.misbklv="urn:misb:KLV:bin:1910.1",n})({});function on(n="",e=9e4){return{type:n,id:-1,pid:-1,inputTimeScale:e,sequenceNumber:-1,samples:[],dropped:0}}class Om{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,s,i){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,s){}demux(e,t){this.cachedData&&(e=Ui(this.cachedData,e),this.cachedData=null);let s=Jl(e,0),i=s?s.length:0,r;const l=this._audioTrack,c=this._id3Track,h=s?Nm(s):void 0,u=e.length;for((this.basePTS===null||this.frameIndex===0&&Ne(h))&&(this.basePTS=pC(h,t,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),s&&s.length>0&&c.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:s,type:gi.audioId3,duration:Number.POSITIVE_INFINITY});i<u;){if(this.canParse(e,i)){const f=this.appendFrame(l,e,i);f?(this.frameIndex++,this.lastPTS=f.sample.pts,i+=f.length,r=i):i=u}else sC(e,i)?(s=Jl(e,i),c.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:s,type:gi.audioId3,duration:Number.POSITIVE_INFINITY}),i+=s.length,r=i):i++;if(i===u&&r!==u){const f=e.slice(r);this.cachedData?this.cachedData=Ui(this.cachedData,f):this.cachedData=f}}return{audioTrack:l,videoTrack:on(),id3Track:c,textTrack:on()}}demuxSampleAes(e,t,s){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:on(),id3Track:this._id3Track,textTrack:on()}}destroy(){this.cachedData=null,this._audioTrack=this._id3Track=void 0}}const pC=(n,e,t)=>{if(Ne(n))return n*90;const s=t?t.baseTime*9e4/t.timescale:0;return e*9e4+s};let Fc=null;const gC=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],yC=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],vC=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],xC=[0,1,1,4];function mb(n,e,t,s,i){if(t+24>e.length)return;const r=pb(e,t);if(r&&t+r.frameLength<=e.length){const l=r.samplesPerFrame*9e4/r.sampleRate,c=s+i*l,h={unit:e.subarray(t,t+r.frameLength),pts:c,dts:c};return n.config=[],n.channelCount=r.channelCount,n.samplerate=r.sampleRate,n.samples.push(h),{sample:h,length:r.frameLength,missing:0}}}function pb(n,e){const t=n[e+1]>>3&3,s=n[e+1]>>1&3,i=n[e+2]>>4&15,r=n[e+2]>>2&3;if(t!==1&&i!==0&&i!==15&&r!==3){const l=n[e+2]>>1&1,c=n[e+3]>>6,h=t===3?3-s:s===3?3:4,u=gC[h*14+i-1]*1e3,g=yC[(t===3?0:t===2?1:2)*3+r],y=c===3?1:2,x=vC[t][s],S=xC[s],E=x*8*S,T=Math.floor(x*u/g+l)*S;if(Fc===null){const I=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Fc=I?parseInt(I[1]):0}return Fc&&Fc<=87&&s===2&&u>=224e3&&c===0&&(n[e+3]=n[e+3]|128),{sampleRate:g,channelCount:y,frameLength:T,samplesPerFrame:E}}}function km(n,e){return n[e]===255&&(n[e+1]&224)===224&&(n[e+1]&6)!==0}function gb(n,e){return e+1<n.length&&km(n,e)}function SC(n,e){return km(n,e)&&4<=n.length-e}function yb(n,e){if(e+1<n.length&&km(n,e)){const s=pb(n,e);let i=4;s!=null&&s.frameLength&&(i=s.frameLength);const r=e+i;return r===n.length||gb(n,r)}return!1}class bC extends Om{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,s,i){super.resetInitSegment(e,t,s,i),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:i,inputTimeScale:9e4,dropped:0}}static probe(e,t){if(!e)return!1;const s=Jl(e,0);let i=s?.length||0;if(yb(e,i))return!1;for(let r=e.length;i<r;i++)if(eC(e,i))return t.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return Jw(e,t)}appendFrame(e,t,s){cb(e,this.observer,t,s,e.manifestCodec);const i=db(e,t,s,this.basePTS,this.frameIndex);if(i&&i.missing===0)return i}}const vb=(n,e)=>{let t=0,s=5;e+=s;const i=new Uint32Array(1),r=new Uint32Array(1),l=new Uint8Array(1);for(;s>0;){l[0]=n[e];const c=Math.min(s,8),h=8-c;r[0]=4278190080>>>24+h<<h,i[0]=(l[0]&r[0])>>h,t=t?t<<c|i[0]:i[0],e+=1,s-=c}return t};class TC extends Om{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,t,s,i){super.resetInitSegment(e,t,s,i),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:t,duration:i,inputTimeScale:9e4,dropped:0}}canParse(e,t){return t+64<e.length}appendFrame(e,t,s){const i=xb(e,t,s,this.basePTS,this.frameIndex);if(i!==-1)return{sample:e.samples[e.samples.length-1],length:i,missing:0}}static probe(e){if(!e)return!1;const t=Jl(e,0);if(!t)return!1;const s=t.length;return e[s]===11&&e[s+1]===119&&Nm(t)!==void 0&&vb(e,s)<16}}function xb(n,e,t,s,i){if(t+8>e.length||e[t]!==11||e[t+1]!==119)return-1;const r=e[t+4]>>6;if(r>=3)return-1;const c=[48e3,44100,32e3][r],h=e[t+4]&63,f=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][h*3+r]*2;if(t+f>e.length)return-1;const g=e[t+6]>>5;let y=0;g===2?y+=2:(g&1&&g!==1&&(y+=2),g&4&&(y+=2));const x=(e[t+6]<<8|e[t+7])>>12-y&1,E=[2,1,2,3,3,4,4,5][g]+x,T=e[t+5]>>3,A=e[t+5]&7,_=new Uint8Array([r<<6|T<<1|A>>2,(A&3)<<6|g<<3|x<<2|h>>4,h<<4&224]),I=1536/c*9e4,C=s+i*I,N=e.subarray(t,t+f);return n.config=_,n.channelCount=E,n.samplerate=c,n.samples.push({unit:N,pts:C}),f}class EC extends Om{resetInitSegment(e,t,s,i){super.resetInitSegment(e,t,s,i),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:i,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=Jl(e,0);let s=t?.length||0;if(t&&e[s]===11&&e[s+1]===119&&Nm(t)!==void 0&&vb(e,s)<=16)return!1;for(let i=e.length;s<i;s++)if(yb(e,s))return Lt.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return SC(e,t)}appendFrame(e,t,s){if(this.basePTS!==null)return mb(e,t,s,this.basePTS,this.frameIndex)}}const AC=/\/emsg[-/]ID3/i;class IC{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,s,i){const r=this.videoTrack=on("video",1),l=this.audioTrack=on("audio",1),c=this.txtTrack=on("text",1);if(this.id3Track=on("id3",1),this.timeOffset=0,!(e!=null&&e.byteLength))return;const h=wS(e);if(h.video){const{id:u,timescale:f,codec:g,supplemental:y}=h.video;r.id=u,r.timescale=c.timescale=f,r.codec=g,r.supplemental=y}if(h.audio){const{id:u,timescale:f,codec:g}=h.audio;l.id=u,l.timescale=f,l.codec=g}c.id=_S.text,r.sampleDuration=0,r.duration=l.duration=i}resetContiguity(){this.remainderData=null}static probe(e){return T1(e)}demux(e,t){this.timeOffset=t;let s=e;const i=this.videoTrack,r=this.txtTrack;if(this.config.progressive){this.remainderData&&(s=Ui(this.remainderData,e));const c=w1(s);this.remainderData=c.remainder,i.samples=c.valid||new Uint8Array}else i.samples=s;const l=this.extractID3Track(i,t);return r.samples=pv(t,i),{videoTrack:i,audioTrack:this.audioTrack,id3Track:l,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,t=this.videoTrack,s=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const i=this.extractID3Track(t,this.timeOffset);return s.samples=pv(e,t),{videoTrack:t,audioTrack:on(),id3Track:i,textTrack:on()}}extractID3Track(e,t){const s=this.id3Track;if(e.samples.length){const i=it(e.samples,["emsg"]);i&&i.forEach(r=>{const l=N1(r);if(AC.test(l.schemeIdUri)){const c=Zv(l,t);let h=l.eventDuration===4294967295?Number.POSITIVE_INFINITY:l.eventDuration/l.timeScale;h<=.001&&(h=Number.POSITIVE_INFINITY);const u=l.payload;s.samples.push({data:u,len:u.byteLength,dts:c,pts:c,type:gi.emsg,duration:h})}else if(this.config.enableEmsgKLVMetadata&&l.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){const c=Zv(l,t);s.samples.push({data:l.payload,len:l.payload.byteLength,dts:c,pts:c,type:gi.misbklv,duration:Number.POSITIVE_INFINITY})}})}return s}demuxSampleAes(e,t,s){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0}}function Zv(n,e){return Ne(n.presentationTime)?n.presentationTime/n.timeScale:e+n.presentationTimeDelta/n.timeScale}class _C{constructor(e,t,s){this.keyData=void 0,this.decrypter=void 0,this.keyData=s,this.decrypter=new Em(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer,Aa.cbc)}decryptAacSample(e,t,s){const i=e[t].unit;if(i.length<=16)return;const r=i.subarray(16,i.length-i.length%16),l=r.buffer.slice(r.byteOffset,r.byteOffset+r.length);this.decryptBuffer(l).then(c=>{const h=new Uint8Array(c);i.set(h,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,s)}).catch(s)}decryptAacSamples(e,t,s){for(;;t++){if(t>=e.length){s();return}if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,s),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){const t=Math.floor((e.length-48)/160)*16+16,s=new Int8Array(t);let i=0;for(let r=32;r<e.length-16;r+=160,i+=16)s.set(e.subarray(r,r+16),i);return s}getAvcDecryptedUnit(e,t){const s=new Uint8Array(t);let i=0;for(let r=32;r<e.length-16;r+=160,i+=16)e.set(s.subarray(i,i+16),r);return e}decryptAvcSample(e,t,s,i,r){const l=OS(r.data),c=this.getAvcEncryptedData(l);this.decryptBuffer(c.buffer).then(h=>{r.data=this.getAvcDecryptedUnit(l,h),this.decrypter.isSync()||this.decryptAvcSamples(e,t,s+1,i)}).catch(i)}decryptAvcSamples(e,t,s,i){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,s=0){if(t>=e.length){i();return}const r=e[t].units;for(;!(s>=r.length);s++){const l=r[s];if(!(l.data.length<=48||l.type!==1&&l.type!==5)&&(this.decryptAvcSample(e,t,s,i,l),!this.decrypter.isSync()))return}}}}class Sb{constructor(){this.VideoSample=null}createVideoSample(e,t,s){return{key:e,frame:!1,pts:t,dts:s,units:[],length:0}}getLastNalUnit(e){var t;let s=this.VideoSample,i;if((!s||s.units.length===0)&&(s=e[e.length-1]),(t=s)!=null&&t.units){const r=s.units;i=r[r.length-1]}return i}pushAccessUnit(e,t){if(e.units.length&&e.frame){if(e.pts===void 0){const s=t.samples,i=s.length;if(i){const r=s[i-1];e.pts=r.pts,e.dts=r.dts}else{t.dropped++;return}}t.samples.push(e)}}parseNALu(e,t,s){const i=t.byteLength;let r=e.naluState||0;const l=r,c=[];let h=0,u,f,g,y=-1,x=0;for(r===-1&&(y=0,x=this.getNALuType(t,0),r=0,h=1);h<i;){if(u=t[h++],!r){r=u?0:1;continue}if(r===1){r=u?0:2;continue}if(!u)r=3;else if(u===1){if(f=h-r-1,y>=0){const S={data:t.subarray(y,f),type:x};c.push(S)}else{const S=this.getLastNalUnit(e.samples);S&&(l&&h<=4-l&&S.state&&(S.data=S.data.subarray(0,S.data.byteLength-l)),f>0&&(S.data=Ui(S.data,t.subarray(0,f)),S.state=0))}h<i?(g=this.getNALuType(t,h),y=h,x=g,r=0):r=-1}else r=0}if(y>=0&&r>=0){const S={data:t.subarray(y,i),type:x,state:r};c.push(S)}if(c.length===0){const S=this.getLastNalUnit(e.samples);S&&(S.data=Ui(S.data,t))}return e.naluState=r,c}}class Kl{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,s=e.byteLength-t,i=new Uint8Array(4),r=Math.min(4,t);if(r===0)throw new Error("no bytes available");i.set(e.subarray(s,s+r)),this.word=new DataView(i.buffer).getUint32(0),this.bitsAvailable=r*8,this.bytesAvailable-=r}skipBits(e){let t;e=Math.min(e,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const s=this.word>>>32-t;if(e>32&&Lt.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return t=e-t,t>0&&this.bitsAvailable?s<<t|this.readBits(t):s}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if((this.word&2147483648>>>e)!==0)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}}class RC extends Sb{parsePES(e,t,s,i){const r=this.parseNALu(e,s.data,i);let l=this.VideoSample,c,h=!1;s.data=null,l&&r.length&&!e.audFound&&(this.pushAccessUnit(l,e),l=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts)),r.forEach(u=>{var f,g;switch(u.type){case 1:{let E=!1;c=!0;const T=u.data;if(h&&T.length>4){const A=this.readSliceType(T);(A===2||A===4||A===7||A===9)&&(E=!0)}if(E){var y;(y=l)!=null&&y.frame&&!l.key&&(this.pushAccessUnit(l,e),l=this.VideoSample=null)}l||(l=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),l.frame=!0,l.key=E;break}case 5:c=!0,(f=l)!=null&&f.frame&&!l.key&&(this.pushAccessUnit(l,e),l=this.VideoSample=null),l||(l=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),l.key=!0,l.frame=!0;break;case 6:{c=!0,xm(u.data,1,s.pts,t.samples);break}case 7:{var x,S;c=!0,h=!0;const E=u.data,T=this.readSPS(E);if(!e.sps||e.width!==T.width||e.height!==T.height||((x=e.pixelRatio)==null?void 0:x[0])!==T.pixelRatio[0]||((S=e.pixelRatio)==null?void 0:S[1])!==T.pixelRatio[1]){e.width=T.width,e.height=T.height,e.pixelRatio=T.pixelRatio,e.sps=[E];const A=E.subarray(1,4);let _="avc1.";for(let I=0;I<3;I++){let C=A[I].toString(16);C.length<2&&(C="0"+C),_+=C}e.codec=_}break}case 8:c=!0,e.pps=[u.data];break;case 9:c=!0,e.audFound=!0,(g=l)!=null&&g.frame&&(this.pushAccessUnit(l,e),l=null),l||(l=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts));break;case 12:c=!0;break;default:c=!1;break}l&&c&&l.units.push(u)}),i&&l&&(this.pushAccessUnit(l,e),this.VideoSample=null)}getNALuType(e,t){return e[t]&31}readSliceType(e){const t=new Kl(e);return t.readUByte(),t.readUEG(),t.readUEG()}skipScalingList(e,t){let s=8,i=8,r;for(let l=0;l<e;l++)i!==0&&(r=t.readEG(),i=(s+r+256)%256),s=i===0?s:i}readSPS(e){const t=new Kl(e);let s=0,i=0,r=0,l=0,c,h,u;const f=t.readUByte.bind(t),g=t.readBits.bind(t),y=t.readUEG.bind(t),x=t.readBoolean.bind(t),S=t.skipBits.bind(t),E=t.skipEG.bind(t),T=t.skipUEG.bind(t),A=this.skipScalingList.bind(this);f();const _=f();if(g(5),S(3),f(),T(),_===100||_===110||_===122||_===244||_===44||_===83||_===86||_===118||_===128){const B=y();if(B===3&&S(1),T(),T(),S(1),x())for(h=B!==3?8:12,u=0;u<h;u++)x()&&(u<6?A(16,t):A(64,t))}T();const I=y();if(I===0)y();else if(I===1)for(S(1),E(),E(),c=y(),u=0;u<c;u++)E();T(),S(1);const C=y(),N=y(),D=g(1);D===0&&S(1),S(1),x()&&(s=y(),i=y(),r=y(),l=y());let k=[1,1];if(x()&&x())switch(f()){case 1:k=[1,1];break;case 2:k=[12,11];break;case 3:k=[10,11];break;case 4:k=[16,11];break;case 5:k=[40,33];break;case 6:k=[24,11];break;case 7:k=[20,11];break;case 8:k=[32,11];break;case 9:k=[80,33];break;case 10:k=[18,11];break;case 11:k=[15,11];break;case 12:k=[64,33];break;case 13:k=[160,99];break;case 14:k=[4,3];break;case 15:k=[3,2];break;case 16:k=[2,1];break;case 255:{k=[f()<<8|f(),f()<<8|f()];break}}return{width:Math.ceil((C+1)*16-s*2-i*2),height:(2-D)*(N+1)*16-(D?2:4)*(r+l),pixelRatio:k}}}class LC extends Sb{constructor(...e){super(...e),this.initVPS=null}parsePES(e,t,s,i){const r=this.parseNALu(e,s.data,i);let l=this.VideoSample,c,h=!1;s.data=null,l&&r.length&&!e.audFound&&(this.pushAccessUnit(l,e),l=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts)),r.forEach(u=>{var f,g;switch(u.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:l||(l=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts)),l.frame=!0,c=!0;break;case 16:case 17:case 18:case 21:if(c=!0,h){var y;(y=l)!=null&&y.frame&&!l.key&&(this.pushAccessUnit(l,e),l=this.VideoSample=null)}l||(l=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),l.key=!0,l.frame=!0;break;case 19:case 20:c=!0,(f=l)!=null&&f.frame&&!l.key&&(this.pushAccessUnit(l,e),l=this.VideoSample=null),l||(l=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),l.key=!0,l.frame=!0;break;case 39:c=!0,xm(u.data,2,s.pts,t.samples);break;case 32:c=!0,e.vps||(typeof e.params!="object"&&(e.params={}),e.params=Dt(e.params,this.readVPS(u.data)),this.initVPS=u.data),e.vps=[u.data];break;case 33:if(c=!0,h=!0,e.vps!==void 0&&e.vps[0]!==this.initVPS&&e.sps!==void 0&&!this.matchSPS(e.sps[0],u.data)&&(this.initVPS=e.vps[0],e.sps=e.pps=void 0),!e.sps){const x=this.readSPS(u.data);e.width=x.width,e.height=x.height,e.pixelRatio=x.pixelRatio,e.codec=x.codecString,e.sps=[],typeof e.params!="object"&&(e.params={});for(const S in x.params)e.params[S]=x.params[S]}this.pushParameterSet(e.sps,u.data,e.vps),l||(l=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),l.key=!0;break;case 34:if(c=!0,typeof e.params=="object"){if(!e.pps){e.pps=[];const x=this.readPPS(u.data);for(const S in x)e.params[S]=x[S]}this.pushParameterSet(e.pps,u.data,e.vps)}break;case 35:c=!0,e.audFound=!0,(g=l)!=null&&g.frame&&(this.pushAccessUnit(l,e),l=null),l||(l=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts));break;default:c=!1;break}l&&c&&l.units.push(u)}),i&&l&&(this.pushAccessUnit(l,e),this.VideoSample=null)}pushParameterSet(e,t,s){(s&&s[0]===this.initVPS||!s&&!e.length)&&e.push(t)}getNALuType(e,t){return(e[t]&126)>>>1}ebsp2rbsp(e){const t=new Uint8Array(e.byteLength);let s=0;for(let i=0;i<e.byteLength;i++)i>=2&&e[i]===3&&e[i-1]===0&&e[i-2]===0||(t[s]=e[i],s++);return new Uint8Array(t.buffer,0,s)}pushAccessUnit(e,t){super.pushAccessUnit(e,t),this.initVPS&&(this.initVPS=null)}readVPS(e){const t=new Kl(e);t.readUByte(),t.readUByte(),t.readBits(4),t.skipBits(2),t.readBits(6);const s=t.readBits(3),i=t.readBoolean();return{numTemporalLayers:s+1,temporalIdNested:i}}readSPS(e){const t=new Kl(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.readBits(4);const s=t.readBits(3);t.readBoolean();const i=t.readBits(2),r=t.readBoolean(),l=t.readBits(5),c=t.readUByte(),h=t.readUByte(),u=t.readUByte(),f=t.readUByte(),g=t.readUByte(),y=t.readUByte(),x=t.readUByte(),S=t.readUByte(),E=t.readUByte(),T=t.readUByte(),A=t.readUByte(),_=[],I=[];for(let Me=0;Me<s;Me++)_.push(t.readBoolean()),I.push(t.readBoolean());if(s>0)for(let Me=s;Me<8;Me++)t.readBits(2);for(let Me=0;Me<s;Me++)_[Me]&&(t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte()),I[Me]&&t.readUByte();t.readUEG();const C=t.readUEG();C==3&&t.skipBits(1);const N=t.readUEG(),D=t.readUEG(),k=t.readBoolean();let B=0,j=0,U=0,K=0;k&&(B+=t.readUEG(),j+=t.readUEG(),U+=t.readUEG(),K+=t.readUEG());const H=t.readUEG(),J=t.readUEG(),re=t.readUEG(),me=t.readBoolean();for(let Me=me?0:s;Me<=s;Me++)t.skipUEG(),t.skipUEG(),t.skipUEG();if(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.readBoolean()&&t.readBoolean())for(let Le=0;Le<4;Le++)for(let Ue=0;Ue<(Le===3?2:6);Ue++)if(!t.readBoolean())t.readUEG();else{const ht=Math.min(64,1<<4+(Le<<1));Le>1&&t.readEG();for(let Oe=0;Oe<ht;Oe++)t.readEG()}t.readBoolean(),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.skipUEG(),t.skipUEG(),t.readBoolean());const F=t.readUEG();let ae=0;for(let Me=0;Me<F;Me++){let Le=!1;if(Me!==0&&(Le=t.readBoolean()),Le){Me===F&&t.readUEG(),t.readBoolean(),t.readUEG();let Ue=0;for(let Ze=0;Ze<=ae;Ze++){const ht=t.readBoolean();let Oe=!1;ht||(Oe=t.readBoolean()),(ht||Oe)&&Ue++}ae=Ue}else{const Ue=t.readUEG(),Ze=t.readUEG();ae=Ue+Ze;for(let ht=0;ht<Ue;ht++)t.readUEG(),t.readBoolean();for(let ht=0;ht<Ze;ht++)t.readUEG(),t.readBoolean()}}if(t.readBoolean()){const Me=t.readUEG();for(let Le=0;Le<Me;Le++){for(let Ue=0;Ue<re+4;Ue++)t.readBits(1);t.readBits(1)}}let P=0,G=1,te=1,fe=!0,ve=1,Ae=0;t.readBoolean(),t.readBoolean();let De=!1;if(t.readBoolean()){if(t.readBoolean()){const He=t.readUByte(),pt=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],nt=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];He>0&&He<16?(G=pt[He-1],te=nt[He-1]):He===255&&(G=t.readBits(16),te=t.readBits(16))}if(t.readBoolean()&&t.readBoolean(),t.readBoolean()&&(t.readBits(3),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.readUByte(),t.readUByte())),t.readBoolean()&&(t.readUEG(),t.readUEG()),t.readBoolean(),t.readBoolean(),t.readBoolean(),De=t.readBoolean(),De&&(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG()),t.readBoolean()&&(ve=t.readBits(32),Ae=t.readBits(32),t.readBoolean()&&t.readUEG(),t.readBoolean())){const nt=t.readBoolean(),Kt=t.readBoolean();let ge=!1;(nt||Kt)&&(ge=t.readBoolean(),ge&&(t.readUByte(),t.readBits(5),t.readBoolean(),t.readBits(5)),t.readBits(4),t.readBits(4),ge&&t.readBits(4),t.readBits(5),t.readBits(5),t.readBits(5));for(let Qe=0;Qe<=s;Qe++){fe=t.readBoolean();const st=fe||t.readBoolean();let Zt=!1;st?t.readEG():Zt=t.readBoolean();const Rs=Zt?1:t.readUEG()+1;if(nt)for(let vs=0;vs<Rs;vs++)t.readUEG(),t.readUEG(),ge&&(t.readUEG(),t.readUEG()),t.skipBits(1);if(Kt)for(let vs=0;vs<Rs;vs++)t.readUEG(),t.readUEG(),ge&&(t.readUEG(),t.readUEG()),t.skipBits(1)}}t.readBoolean()&&(t.readBoolean(),t.readBoolean(),t.readBoolean(),P=t.readUEG())}let Fe=N,mt=D;if(k){let Me=1,Le=1;C===1?Me=Le=2:C==2&&(Me=2),Fe=N-Me*j-Me*B,mt=D-Le*K-Le*U}const St=i?["A","B","C"][i]:"",jt=c<<24|h<<16|u<<8|f;let bt=0;for(let Me=0;Me<32;Me++)bt=(bt|(jt>>Me&1)<<31-Me)>>>0;let ut=bt.toString(16);return l===1&&ut==="2"&&(ut="6"),{codecString:`hvc1.${St}${l}.${ut}.${r?"H":"L"}${A}.B0`,params:{general_tier_flag:r,general_profile_idc:l,general_profile_space:i,general_profile_compatibility_flags:[c,h,u,f],general_constraint_indicator_flags:[g,y,x,S,E,T],general_level_idc:A,bit_depth:H+8,bit_depth_luma_minus8:H,bit_depth_chroma_minus8:J,min_spatial_segmentation_idc:P,chroma_format_idc:C,frame_rate:{fixed:fe,fps:Ae/ve}},width:Fe,height:mt,pixelRatio:[G,te]}}readPPS(e){const t=new Kl(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.skipUEG(),t.skipUEG(),t.skipBits(2),t.skipBits(3),t.skipBits(2),t.skipUEG(),t.skipUEG(),t.skipEG(),t.skipBits(2),t.readBoolean()&&t.skipUEG(),t.skipEG(),t.skipEG(),t.skipBits(4);const i=t.readBoolean(),r=t.readBoolean();let l=1;return r&&i?l=0:r?l=3:i&&(l=2),{parallelismType:l}}matchSPS(e,t){return String.fromCharCode.apply(null,e).substr(3)===String.fromCharCode.apply(null,t).substr(3)}}const gs=188;class Sa{constructor(e,t,s,i){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=t,this.typeSupported=s,this.logger=i,this.videoParser=null}static probe(e,t){const s=Sa.syncOffset(e);return s>0&&t.warn(`MPEG2-TS detected but first sync word found @ offset ${s}`),s!==-1}static syncOffset(e){const t=e.length;let s=Math.min(gs*5,t-gs)+1,i=0;for(;i<s;){let r=!1,l=-1,c=0;for(let h=i;h<t;h+=gs)if(e[h]===71&&(t-h===gs||e[h+gs]===71)){if(c++,l===-1&&(l=h,l!==0&&(s=Math.min(l+gs*99,e.length-gs)+1)),r||(r=Yf(e,h)===0),r&&c>1&&(l===0&&c>2||h+gs>s))return l}else{if(c)return-1;break}i++}return-1}static createTrack(e,t){return{container:e==="video"||e==="audio"?"video/mp2t":void 0,type:e,id:_S[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:e==="audio"?t:void 0}}resetInitSegment(e,t,s,i){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=Sa.createTrack("video"),this._videoTrack.duration=i,this._audioTrack=Sa.createTrack("audio",i),this._id3Track=Sa.createTrack("id3"),this._txtTrack=Sa.createTrack("text"),this._audioTrack.segmentCodec="aac",this.videoParser=null,this.aacOverFlow=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=s}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_videoTrack:t,_id3Track:s}=this;e&&(e.pesData=null),t&&(t.pesData=null),s&&(s.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,t,s=!1,i=!1){s||(this.sampleAes=null);let r;const l=this._videoTrack,c=this._audioTrack,h=this._id3Track,u=this._txtTrack;let f=l.pid,g=l.pesData,y=c.pid,x=h.pid,S=c.pesData,E=h.pesData,T=null,A=this.pmtParsed,_=this._pmtId,I=e.length;if(this.remainderData&&(e=Ui(this.remainderData,e),I=e.length,this.remainderData=null),I<gs&&!i)return this.remainderData=e,{audioTrack:c,videoTrack:l,id3Track:h,textTrack:u};const C=Math.max(0,Sa.syncOffset(e));I-=(I-C)%gs,I<e.byteLength&&!i&&(this.remainderData=new Uint8Array(e.buffer,I,e.buffer.byteLength-I));let N=0;for(let k=C;k<I;k+=gs)if(e[k]===71){const B=!!(e[k+1]&64),j=Yf(e,k),U=(e[k+3]&48)>>4;let K;if(U>1){if(K=k+5+e[k+4],K===k+gs)continue}else K=k+4;switch(j){case f:B&&(g&&(r=Dr(g,this.logger))&&(this.readyVideoParser(l.segmentCodec),this.videoParser!==null&&this.videoParser.parsePES(l,u,r,!1)),g={data:[],size:0}),g&&(g.data.push(e.subarray(K,k+gs)),g.size+=k+gs-K);break;case y:if(B){if(S&&(r=Dr(S,this.logger)))switch(c.segmentCodec){case"aac":this.parseAACPES(c,r);break;case"mp3":this.parseMPEGPES(c,r);break;case"ac3":this.parseAC3PES(c,r);break}S={data:[],size:0}}S&&(S.data.push(e.subarray(K,k+gs)),S.size+=k+gs-K);break;case x:B&&(E&&(r=Dr(E,this.logger))&&this.parseID3PES(h,r),E={data:[],size:0}),E&&(E.data.push(e.subarray(K,k+gs)),E.size+=k+gs-K);break;case 0:B&&(K+=e[K]+1),_=this._pmtId=wC(e,K);break;case _:{B&&(K+=e[K]+1);const H=CC(e,K,this.typeSupported,s,this.observer,this.logger);f=H.videoPid,f>0&&(l.pid=f,l.segmentCodec=H.segmentVideoCodec),y=H.audioPid,y>0&&(c.pid=y,c.segmentCodec=H.segmentAudioCodec),x=H.id3Pid,x>0&&(h.pid=x),T!==null&&!A&&(this.logger.warn(`MPEG-TS PMT found at ${k} after unknown PID '${T}'. Backtracking to sync byte @${C} to parse all TS packets.`),T=null,k=C-188),A=this.pmtParsed=!0;break}case 17:case 8191:break;default:T=j;break}}else N++;N>0&&qf(this.observer,new Error(`Found ${N} TS packet/s that do not start with 0x47`),void 0,this.logger),l.pesData=g,c.pesData=S,h.pesData=E;const D={audioTrack:c,videoTrack:l,id3Track:h,textTrack:u};return i&&this.extractRemainingSamples(D),D}flush(){const{remainderData:e}=this;this.remainderData=null;let t;return e?t=this.demux(e,-1,!1,!0):t={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){const{audioTrack:t,videoTrack:s,id3Track:i,textTrack:r}=e,l=s.pesData,c=t.pesData,h=i.pesData;let u;if(l&&(u=Dr(l,this.logger))?(this.readyVideoParser(s.segmentCodec),this.videoParser!==null&&(this.videoParser.parsePES(s,r,u,!0),s.pesData=null)):s.pesData=l,c&&(u=Dr(c,this.logger))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,u);break;case"mp3":this.parseMPEGPES(t,u);break;case"ac3":this.parseAC3PES(t,u);break}t.pesData=null}else c!=null&&c.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=c;h&&(u=Dr(h,this.logger))?(this.parseID3PES(i,u),i.pesData=null):i.pesData=h}demuxSampleAes(e,t,s){const i=this.demux(e,s,!0,!this.config.progressive),r=this.sampleAes=new _C(this.observer,this.config,t);return this.decrypt(i,r)}readyVideoParser(e){this.videoParser===null&&(e==="avc"?this.videoParser=new RC:e==="hevc"&&(this.videoParser=new LC))}decrypt(e,t){return new Promise(s=>{const{audioTrack:i,videoTrack:r}=e;i.samples&&i.segmentCodec==="aac"?t.decryptAacSamples(i.samples,0,()=>{r.samples?t.decryptAvcSamples(r.samples,0,0,()=>{s(e)}):s(e)}):r.samples&&t.decryptAvcSamples(r.samples,0,0,()=>{s(e)})})}destroy(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0}parseAACPES(e,t){let s=0;const i=this.aacOverFlow;let r=t.data;if(i){this.aacOverFlow=null;const g=i.missing,y=i.sample.unit.byteLength;if(g===-1)r=Ui(i.sample.unit,r);else{const x=y-g;i.sample.unit.set(r.subarray(0,g),x),e.samples.push(i.sample),s=i.missing}}let l,c;for(l=s,c=r.length;l<c-1&&!Eu(r,l);l++);if(l!==s){let g;const y=l<c-1;if(y?g=`AAC PES did not start with ADTS header,offset:${l}`:g="No ADTS header found in AAC PES",qf(this.observer,new Error(g),y,this.logger),!y)return}cb(e,this.observer,r,l,this.audioCodec);let h;if(t.pts!==void 0)h=t.pts;else if(i){const g=ub(e.samplerate);h=i.sample.pts+g}else{this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}let u=0,f;for(;l<c;)if(f=db(e,r,l,h,u),l+=f.length,f.missing){this.aacOverFlow=f;break}else for(u++;l<c-1&&!Eu(r,l);l++);}parseMPEGPES(e,t){const s=t.data,i=s.length;let r=0,l=0;const c=t.pts;if(c===void 0){this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;l<i;)if(gb(s,l)){const h=mb(e,s,l,c,r);if(h)l+=h.length,r++;else break}else l++}parseAC3PES(e,t){{const s=t.data,i=t.pts;if(i===void 0){this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");return}const r=s.length;let l=0,c=0,h;for(;c<r&&(h=xb(e,s,c,i,l++))>0;)c+=h}}parseID3PES(e,t){if(t.pts===void 0){this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}const s=Dt({},t,{type:this._videoTrack?gi.emsg:gi.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(s)}}function Yf(n,e){return((n[e+1]&31)<<8)+n[e+2]}function wC(n,e){return(n[e+10]&31)<<8|n[e+11]}function CC(n,e,t,s,i,r){const l={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},c=(n[e+1]&15)<<8|n[e+2],h=e+3+c-4,u=(n[e+10]&15)<<8|n[e+11];for(e+=12+u;e<h;){const f=Yf(n,e),g=(n[e+3]&15)<<8|n[e+4];switch(n[e]){case 207:if(!s){pf("ADTS AAC",r);break}case 15:l.audioPid===-1&&(l.audioPid=f);break;case 21:l.id3Pid===-1&&(l.id3Pid=f);break;case 219:if(!s){pf("H.264",r);break}case 27:l.videoPid===-1&&(l.videoPid=f);break;case 3:case 4:!t.mpeg&&!t.mp3?r.log("MPEG audio found, not supported in this browser"):l.audioPid===-1&&(l.audioPid=f,l.segmentAudioCodec="mp3");break;case 193:if(!s){pf("AC-3",r);break}case 129:t.ac3?l.audioPid===-1&&(l.audioPid=f,l.segmentAudioCodec="ac3"):r.log("AC-3 audio found, not supported in this browser");break;case 6:if(l.audioPid===-1&&g>0){let y=e+5,x=g;for(;x>2;){n[y]===106&&(t.ac3!==!0?r.log("AC-3 audio found, not supported in this browser for now"):(l.audioPid=f,l.segmentAudioCodec="ac3"));const E=n[y+1]+2;y+=E,x-=E}}break;case 194:case 135:return qf(i,new Error("Unsupported EC-3 in M2TS found"),void 0,r),l;case 36:l.videoPid===-1&&(l.videoPid=f,l.segmentVideoCodec="hevc",r.log("HEVC in M2TS found"));break}e+=g+5}return l}function qf(n,e,t,s){s.warn(`parsing error: ${e.message}`),n.emit(L.ERROR,L.ERROR,{type:Be.MEDIA_ERROR,details:Q.FRAG_PARSING_ERROR,fatal:!1,levelRetry:t,error:e,reason:e.message})}function pf(n,e){e.log(`${n} with AES-128-CBC encryption found in unencrypted stream`)}function Dr(n,e){let t=0,s,i,r,l,c;const h=n.data;if(!n||n.size===0)return null;for(;h[0].length<19&&h.length>1;)h[0]=Ui(h[0],h[1]),h.splice(1,1);if(s=h[0],(s[0]<<16)+(s[1]<<8)+s[2]===1){if(i=(s[4]<<8)+s[5],i&&i>n.size-6)return null;const f=s[7];f&192&&(l=(s[9]&14)*536870912+(s[10]&255)*4194304+(s[11]&254)*16384+(s[12]&255)*128+(s[13]&254)/2,f&64?(c=(s[14]&14)*536870912+(s[15]&255)*4194304+(s[16]&254)*16384+(s[17]&255)*128+(s[18]&254)/2,l-c>60*9e4&&(e.warn(`${Math.round((l-c)/9e4)}s delta between PTS and DTS, align them`),l=c)):c=l),r=s[8];let g=r+9;if(n.size<=g)return null;n.size-=g;const y=new Uint8Array(n.size);for(let x=0,S=h.length;x<S;x++){s=h[x];let E=s.byteLength;if(g)if(g>E){g-=E;continue}else s=s.subarray(g),E-=g,g=0;y.set(s,t),t+=E}return i&&(i-=r+3),{data:y,pts:l,dts:c,len:i}}return null}class NC{static getSilentFrame(e,t){switch(e){case"mp4a.40.2":if(t===1)return new Uint8Array([0,200,0,128,35,128]);if(t===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(t===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(t===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(t===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(t===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(t===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const ya=Math.pow(2,32)-1;class q{static init(){q.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let e;for(e in q.types)q.types.hasOwnProperty(e)&&(q.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),s=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);q.HDLR_TYPES={video:t,audio:s};const i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),r=new Uint8Array([0,0,0,0,0,0,0,0]);q.STTS=q.STSC=q.STCO=r,q.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),q.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),q.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),q.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const l=new Uint8Array([105,115,111,109]),c=new Uint8Array([97,118,99,49]),h=new Uint8Array([0,0,0,1]);q.FTYP=q.box(q.types.ftyp,l,h,l,c),q.DINF=q.box(q.types.dinf,q.box(q.types.dref,i))}static box(e,...t){let s=8,i=t.length;const r=i;for(;i--;)s+=t[i].byteLength;const l=new Uint8Array(s);for(l[0]=s>>24&255,l[1]=s>>16&255,l[2]=s>>8&255,l[3]=s&255,l.set(e,4),i=0,s=8;i<r;i++)l.set(t[i],s),s+=t[i].byteLength;return l}static hdlr(e){return q.box(q.types.hdlr,q.HDLR_TYPES[e])}static mdat(e){return q.box(q.types.mdat,e)}static mdhd(e,t){t*=e;const s=Math.floor(t/(ya+1)),i=Math.floor(t%(ya+1));return q.box(q.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,s>>24,s>>16&255,s>>8&255,s&255,i>>24,i>>16&255,i>>8&255,i&255,85,196,0,0]))}static mdia(e){return q.box(q.types.mdia,q.mdhd(e.timescale||0,e.duration||0),q.hdlr(e.type),q.minf(e))}static mfhd(e){return q.box(q.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255]))}static minf(e){return e.type==="audio"?q.box(q.types.minf,q.box(q.types.smhd,q.SMHD),q.DINF,q.stbl(e)):q.box(q.types.minf,q.box(q.types.vmhd,q.VMHD),q.DINF,q.stbl(e))}static moof(e,t,s){return q.box(q.types.moof,q.mfhd(e),q.traf(s,t))}static moov(e){let t=e.length;const s=[];for(;t--;)s[t]=q.trak(e[t]);return q.box.apply(null,[q.types.moov,q.mvhd(e[0].timescale||0,e[0].duration||0)].concat(s).concat(q.mvex(e)))}static mvex(e){let t=e.length;const s=[];for(;t--;)s[t]=q.trex(e[t]);return q.box.apply(null,[q.types.mvex,...s])}static mvhd(e,t){t*=e;const s=Math.floor(t/(ya+1)),i=Math.floor(t%(ya+1)),r=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,s>>24,s>>16&255,s>>8&255,s&255,i>>24,i>>16&255,i>>8&255,i&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return q.box(q.types.mvhd,r)}static sdtp(e){const t=e.samples||[],s=new Uint8Array(4+t.length);let i,r;for(i=0;i<t.length;i++)r=t[i].flags,s[i+4]=r.dependsOn<<4|r.isDependedOn<<2|r.hasRedundancy;return q.box(q.types.sdtp,s)}static stbl(e){return q.box(q.types.stbl,q.stsd(e),q.box(q.types.stts,q.STTS),q.box(q.types.stsc,q.STSC),q.box(q.types.stsz,q.STSZ),q.box(q.types.stco,q.STCO))}static avc1(e){let t=[],s=[],i,r,l;for(i=0;i<e.sps.length;i++)r=e.sps[i],l=r.byteLength,t.push(l>>>8&255),t.push(l&255),t=t.concat(Array.prototype.slice.call(r));for(i=0;i<e.pps.length;i++)r=e.pps[i],l=r.byteLength,s.push(l>>>8&255),s.push(l&255),s=s.concat(Array.prototype.slice.call(r));const c=q.box(q.types.avcC,new Uint8Array([1,t[3],t[4],t[5],255,224|e.sps.length].concat(t).concat([e.pps.length]).concat(s))),h=e.width,u=e.height,f=e.pixelRatio[0],g=e.pixelRatio[1];return q.box(q.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,h>>8&255,h&255,u>>8&255,u&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),c,q.box(q.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),q.box(q.types.pasp,new Uint8Array([f>>24,f>>16&255,f>>8&255,f&255,g>>24,g>>16&255,g>>8&255,g&255])))}static esds(e){const t=e.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2,...t,6,1,2])}static audioStsd(e){const t=e.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount||0,0,16,0,0,0,0,t>>8&255,t&255,0,0])}static mp4a(e){return q.box(q.types.mp4a,q.audioStsd(e),q.box(q.types.esds,q.esds(e)))}static mp3(e){return q.box(q.types[".mp3"],q.audioStsd(e))}static ac3(e){return q.box(q.types["ac-3"],q.audioStsd(e),q.box(q.types.dac3,e.config))}static stsd(e){const{segmentCodec:t}=e;if(e.type==="audio"){if(t==="aac")return q.box(q.types.stsd,q.STSD,q.mp4a(e));if(t==="ac3"&&e.config)return q.box(q.types.stsd,q.STSD,q.ac3(e));if(t==="mp3"&&e.codec==="mp3")return q.box(q.types.stsd,q.STSD,q.mp3(e))}else if(e.pps&&e.sps){if(t==="avc")return q.box(q.types.stsd,q.STSD,q.avc1(e));if(t==="hevc"&&e.vps)return q.box(q.types.stsd,q.STSD,q.hvc1(e))}else throw new Error("video track missing pps or sps");throw new Error(`unsupported ${e.type} segment codec (${t}/${e.codec})`)}static tkhd(e){const t=e.id,s=(e.duration||0)*(e.timescale||0),i=e.width||0,r=e.height||0,l=Math.floor(s/(ya+1)),c=Math.floor(s%(ya+1));return q.box(q.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,0,0,0,0,l>>24,l>>16&255,l>>8&255,l&255,c>>24,c>>16&255,c>>8&255,c&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,i>>8&255,i&255,0,0,r>>8&255,r&255,0,0]))}static traf(e,t){const s=q.sdtp(e),i=e.id,r=Math.floor(t/(ya+1)),l=Math.floor(t%(ya+1));return q.box(q.types.traf,q.box(q.types.tfhd,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,i&255])),q.box(q.types.tfdt,new Uint8Array([1,0,0,0,r>>24,r>>16&255,r>>8&255,r&255,l>>24,l>>16&255,l>>8&255,l&255])),q.trun(e,s.length+16+20+8+16+8+8),s)}static trak(e){return e.duration=e.duration||4294967295,q.box(q.types.trak,q.tkhd(e),q.mdia(e))}static trex(e){const t=e.id;return q.box(q.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){const s=e.samples||[],i=s.length,r=12+16*i,l=new Uint8Array(r);let c,h,u,f,g,y;for(t+=8+r,l.set([e.type==="video"?1:0,0,15,1,i>>>24&255,i>>>16&255,i>>>8&255,i&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255],0),c=0;c<i;c++)h=s[c],u=h.duration,f=h.size,g=h.flags,y=h.cts,l.set([u>>>24&255,u>>>16&255,u>>>8&255,u&255,f>>>24&255,f>>>16&255,f>>>8&255,f&255,g.isLeading<<2|g.dependsOn,g.isDependedOn<<6|g.hasRedundancy<<4|g.paddingValue<<1|g.isNonSync,g.degradPrio&61440,g.degradPrio&15,y>>>24&255,y>>>16&255,y>>>8&255,y&255],12+16*c);return q.box(q.types.trun,l)}static initSegment(e){q.types||q.init();const t=q.moov(e);return Ui(q.FTYP,t)}static hvc1(e){const t=e.params,s=[e.vps,e.sps,e.pps],i=4,r=new Uint8Array([1,t.general_profile_space<<6|(t.general_tier_flag?32:0)|t.general_profile_idc,t.general_profile_compatibility_flags[0],t.general_profile_compatibility_flags[1],t.general_profile_compatibility_flags[2],t.general_profile_compatibility_flags[3],t.general_constraint_indicator_flags[0],t.general_constraint_indicator_flags[1],t.general_constraint_indicator_flags[2],t.general_constraint_indicator_flags[3],t.general_constraint_indicator_flags[4],t.general_constraint_indicator_flags[5],t.general_level_idc,240|t.min_spatial_segmentation_idc>>8,255&t.min_spatial_segmentation_idc,252|t.parallelismType,252|t.chroma_format_idc,248|t.bit_depth_luma_minus8,248|t.bit_depth_chroma_minus8,0,parseInt(t.frame_rate.fps),i-1|t.temporal_id_nested<<2|t.num_temporal_layers<<3|(t.frame_rate.fixed?64:0),s.length]);let l=r.length;for(let S=0;S<s.length;S+=1){l+=3;for(let E=0;E<s[S].length;E+=1)l+=2+s[S][E].length}const c=new Uint8Array(l);c.set(r,0),l=r.length;const h=s.length-1;for(let S=0;S<s.length;S+=1){c.set(new Uint8Array([32+S|(S===h?128:0),0,s[S].length]),l),l+=3;for(let E=0;E<s[S].length;E+=1)c.set(new Uint8Array([s[S][E].length>>8,s[S][E].length&255]),l),l+=2,c.set(s[S][E],l),l+=s[S][E].length}const u=q.box(q.types.hvcC,c),f=e.width,g=e.height,y=e.pixelRatio[0],x=e.pixelRatio[1];return q.box(q.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,f>>8&255,f&255,g>>8&255,g&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),u,q.box(q.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),q.box(q.types.pasp,new Uint8Array([y>>24,y>>16&255,y>>8&255,y&255,x>>24,x>>16&255,x>>8&255,x&255])))}}q.types=void 0;q.HDLR_TYPES=void 0;q.STTS=void 0;q.STSC=void 0;q.STCO=void 0;q.STSZ=void 0;q.VMHD=void 0;q.SMHD=void 0;q.STSD=void 0;q.FTYP=void 0;q.DINF=void 0;const bb=9e4;function Dm(n,e,t=1,s=!1){const i=n*e*t;return s?Math.round(i):i}function OC(n,e,t=1,s=!1){return Dm(n,e,1/t,s)}function Gl(n,e=!1){return Dm(n,1e3,1/bb,e)}function kC(n,e=1){return Dm(n,bb,1/e)}function Jv(n){const{baseTime:e,timescale:t,trackId:s}=n;return`${e/t} (${e}/${t}) trackId: ${s}`}const DC=10*1e3,PC=1024,UC=1152,MC=1536;let Pr=null,gf=null;function ex(n,e,t,s){return{duration:e,size:t,cts:s,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:n?2:1,isNonSync:n?0:1}}}class nu extends ji{constructor(e,t,s,i){if(super("mp4-remuxer",i),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextVideoTs=null,this.nextAudioTs=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=t,this.typeSupported=s,this.ISGenerated=!1,Pr===null){const l=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Pr=l?parseInt(l[1]):0}if(gf===null){const r=navigator.userAgent.match(/Safari\/(\d+)/i);gf=r?parseInt(r[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){const t=this._initPTS;(!t||!e||e.trackId!==t.trackId||e.baseTime!==t.baseTime||e.timescale!==t.timescale)&&this.log(`Reset initPTS: ${t&&Jv(t)} > ${e&&Jv(e)}`),this._initPTS=this._initDTS=e}resetNextTimestamp(){this.log("reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){this.log("ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let t=!1;const s=e[0].pts,i=e.reduce((r,l)=>{let c=l.pts,h=c-r;return h<-4294967296&&(t=!0,c=pi(c,s),h=c-r),h>0?r:c},s);return t&&this.debug("PTS rollover detected"),i}remux(e,t,s,i,r,l,c,h){let u,f,g,y,x,S,E=r,T=r;const A=e.pid>-1,_=t.pid>-1,I=t.samples.length,C=e.samples.length>0,N=c&&I>0||I>1;if((!A||C)&&(!_||N)||this.ISGenerated||c){if(this.ISGenerated){var k,B,j,U;const re=this.videoTrackConfig;(re&&(t.width!==re.width||t.height!==re.height||((k=t.pixelRatio)==null?void 0:k[0])!==((B=re.pixelRatio)==null?void 0:B[0])||((j=t.pixelRatio)==null?void 0:j[1])!==((U=re.pixelRatio)==null?void 0:U[1]))||!re&&N||this.nextAudioTs===null&&C)&&this.resetInitSegment()}this.ISGenerated||(g=this.generateIS(e,t,r,l));const K=this.isVideoContiguous;let H=-1,J;if(N&&(H=jC(t.samples),!K&&this.config.forceKeyFrameOnDiscontinuity))if(S=!0,H>0){this.warn(`Dropped ${H} out of ${I} video samples due to a missing keyframe`);const re=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(H),t.dropped+=H,T+=(t.samples[0].pts-re)/t.inputTimeScale,J=T}else H===-1&&(this.warn(`No keyframe found out of ${I} video samples`),S=!1);if(this.ISGenerated){if(C&&N){const re=this.getVideoStartPts(t.samples),M=(pi(e.samples[0].pts,re)-re)/t.inputTimeScale;E+=Math.max(0,M),T+=Math.max(0,-M)}if(C){if(e.samplerate||(this.warn("regenerate InitSegment as audio detected"),g=this.generateIS(e,t,r,l)),f=this.remuxAudio(e,E,this.isAudioContiguous,l,_||N||h===ke.AUDIO?T:void 0),N){const re=f?f.endPTS-f.startPTS:0;t.inputTimeScale||(this.warn("regenerate InitSegment as video detected"),g=this.generateIS(e,t,r,l)),u=this.remuxVideo(t,T,K,re)}}else N&&(u=this.remuxVideo(t,T,K,0));u&&(u.firstKeyFrame=H,u.independent=H!==-1,u.firstKeyFramePTS=J)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(s.samples.length&&(x=Tb(s,r,this._initPTS,this._initDTS)),i.samples.length&&(y=Eb(i,r,this._initPTS))),{audio:f,video:u,initSegment:g,independent:S,text:y,id3:x}}computeInitPts(e,t,s,i){const r=Math.round(s*t);let l=pi(e,r);if(l<r+t)for(this.log(`Adjusting PTS for rollover in timeline near ${(r-l)/t} ${i}`);l<r+t;)l+=8589934592;return l-r}generateIS(e,t,s,i){const r=e.samples,l=t.samples,c=this.typeSupported,h={},u=this._initPTS;let f=!u||i,g="audio/mp4",y,x,S,E=-1;if(f&&(y=x=1/0),e.config&&r.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":c.mpeg?(g="audio/mpeg",e.codec=""):c.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3";break}h.audio={id:"audio",container:g,codec:e.codec,initSegment:e.segmentCodec==="mp3"&&c.mpeg?new Uint8Array(0):q.initSegment([e]),metadata:{channelCount:e.channelCount}},f&&(E=e.id,S=e.inputTimeScale,!u||S!==u.timescale?y=x=this.computeInitPts(r[0].pts,S,s,"audio"):f=!1)}if(t.sps&&t.pps&&l.length){if(t.timescale=t.inputTimeScale,h.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:q.initSegment([t]),metadata:{width:t.width,height:t.height}},f)if(E=t.id,S=t.inputTimeScale,!u||S!==u.timescale){const T=this.getVideoStartPts(l),A=pi(l[0].dts,T),_=this.computeInitPts(A,S,s,"video"),I=this.computeInitPts(T,S,s,"video");x=Math.min(x,_),y=Math.min(y,I)}else f=!1;this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(h).length)return this.ISGenerated=!0,f?(u&&this.warn(`Timestamps at playlist time: ${i?"":"~"}${s} ${y/S} != initPTS: ${u.baseTime/u.timescale} (${u.baseTime}/${u.timescale}) trackId: ${u.trackId}`),this.log(`Found initPTS at playlist time: ${s} offset: ${y/S} (${y}/${S}) trackId: ${E}`),this._initPTS={baseTime:y,timescale:S,trackId:E},this._initDTS={baseTime:x,timescale:S,trackId:E}):y=S=void 0,{tracks:h,initPTS:y,timescale:S,trackId:E}}remuxVideo(e,t,s,i){const r=e.inputTimeScale,l=e.samples,c=[],h=l.length,u=this._initPTS,f=u.baseTime*r/u.timescale;let g=this.nextVideoTs,y=8,x=this.videoSampleDuration,S,E,T=Number.POSITIVE_INFINITY,A=Number.NEGATIVE_INFINITY,_=!1;if(!s||g===null){const P=f+t*r,G=l[0].pts-pi(l[0].dts,l[0].pts);Pr&&g!==null&&Math.abs(P-G-(g+f))<15e3?s=!0:g=P-G-f}const I=g+f;for(let P=0;P<h;P++){const G=l[P];G.pts=pi(G.pts,I),G.dts=pi(G.dts,I),G.dts<l[P>0?P-1:P].dts&&(_=!0)}_&&l.sort(function(P,G){const te=P.dts-G.dts,fe=P.pts-G.pts;return te||fe}),S=l[0].dts,E=l[l.length-1].dts;const C=E-S,N=C?Math.round(C/(h-1)):x||e.inputTimeScale/30;if(s){const P=S-I,G=P>N,te=P<-1;if((G||te)&&(G?this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${Gl(P,!0)} ms (${P}dts) hole between fragments detected at ${t.toFixed(3)}`):this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${Gl(-P,!0)} ms (${P}dts) overlapping between fragments detected at ${t.toFixed(3)}`),!te||I>=l[0].pts||Pr)){S=I;const fe=l[0].pts-P;if(G)l[0].dts=S,l[0].pts=fe;else{let ve=!0;for(let Ae=0;Ae<l.length&&!(l[Ae].dts>fe&&ve);Ae++){const De=l[Ae].pts;if(l[Ae].dts-=P,l[Ae].pts-=P,Ae<l.length-1){const Ge=l[Ae+1].pts,Fe=l[Ae].pts,mt=Ge<=Fe,St=Ge<=De;ve=mt==St}}}this.log(`Video: Initial PTS/DTS adjusted: ${Gl(fe,!0)}/${Gl(S,!0)}, delta: ${Gl(P,!0)} ms`)}}S=Math.max(0,S);let D=0,k=0,B=S;for(let P=0;P<h;P++){const G=l[P],te=G.units,fe=te.length;let ve=0;for(let Ae=0;Ae<fe;Ae++)ve+=te[Ae].data.length;k+=ve,D+=fe,G.length=ve,G.dts<B?(G.dts=B,B+=N/4|0||1):B=G.dts,T=Math.min(G.pts,T),A=Math.max(G.pts,A)}E=l[h-1].dts;const j=k+4*D+8;let U;try{U=new Uint8Array(j)}catch(P){this.observer.emit(L.ERROR,L.ERROR,{type:Be.MUX_ERROR,details:Q.REMUX_ALLOC_ERROR,fatal:!1,error:P,bytes:j,reason:`fail allocating video mdat ${j}`});return}const K=new DataView(U.buffer);K.setUint32(0,j),U.set(q.types.mdat,4);let H=!1,J=Number.POSITIVE_INFINITY,re=Number.POSITIVE_INFINITY,me=Number.NEGATIVE_INFINITY,M=Number.NEGATIVE_INFINITY;for(let P=0;P<h;P++){const G=l[P],te=G.units;let fe=0;for(let De=0,Ge=te.length;De<Ge;De++){const Fe=te[De],mt=Fe.data,St=Fe.data.byteLength;K.setUint32(y,St),y+=4,U.set(mt,y),y+=St,fe+=4+St}let ve;if(P<h-1)x=l[P+1].dts-G.dts,ve=l[P+1].pts-G.pts;else{const De=this.config,Ge=P>0?G.dts-l[P-1].dts:N;if(ve=P>0?G.pts-l[P-1].pts:N,De.stretchShortVideoTrack&&this.nextAudioTs!==null){const Fe=Math.floor(De.maxBufferHole*r),mt=(i?T+i*r:this.nextAudioTs+f)-G.pts;mt>Fe?(x=mt-Ge,x<0?x=Ge:H=!0,this.log(`It is approximately ${mt/90} ms to the next segment; using duration ${x/90} ms for the last video frame.`)):x=Ge}else x=Ge}const Ae=Math.round(G.pts-G.dts);J=Math.min(J,x),me=Math.max(me,x),re=Math.min(re,ve),M=Math.max(M,ve),c.push(ex(G.key,x,fe,Ae))}if(c.length){if(Pr){if(Pr<70){const P=c[0].flags;P.dependsOn=2,P.isNonSync=0}}else if(gf&&M-re<me-J&&N/me<.025&&c[0].cts===0){this.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let P=S;for(let G=0,te=c.length;G<te;G++){const fe=P+c[G].duration,ve=P+c[G].cts;if(G<te-1){const Ae=fe+c[G+1].cts;c[G].duration=Ae-ve}else c[G].duration=G?c[G-1].duration:N;c[G].cts=0,P=fe}}}x=H||!x?N:x;const $=E+x;this.nextVideoTs=g=$-f,this.videoSampleDuration=x,this.isVideoContiguous=!0;const de={data1:q.moof(e.sequenceNumber++,S,Dt(e,{samples:c})),data2:U,startPTS:(T-f)/r,endPTS:(A+x-f)/r,startDTS:(S-f)/r,endDTS:g/r,type:"video",hasAudio:!1,hasVideo:!0,nb:c.length,dropped:e.dropped};return e.samples=[],e.dropped=0,de}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return UC;case"ac3":return MC;default:return PC}}remuxAudio(e,t,s,i,r){const l=e.inputTimeScale,c=e.samplerate?e.samplerate:l,h=l/c,u=this.getSamplesPerFrame(e),f=u*h,g=this._initPTS,y=e.segmentCodec==="mp3"&&this.typeSupported.mpeg,x=[],S=r!==void 0;let E=e.samples,T=y?0:8,A=this.nextAudioTs||-1;const _=g.baseTime*l/g.timescale,I=_+t*l;if(this.isAudioContiguous=s=s||E.length&&A>0&&(i&&Math.abs(I-(A+_))<9e3||Math.abs(pi(E[0].pts,I)-(A+_))<20*f),E.forEach(function(M){M.pts=pi(M.pts,I)}),!s||A<0){const M=E.length;if(E=E.filter($=>$.pts>=0),M!==E.length&&this.warn(`Removed ${E.length-M} of ${M} samples (initPTS ${_} / ${l})`),!E.length)return;r===0?A=0:i&&!S?A=Math.max(0,I-_):A=E[0].pts-_}if(e.segmentCodec==="aac"){const M=this.config.maxAudioFramesDrift;for(let $=0,F=A+_;$<E.length;$++){const ae=E[$],de=ae.pts,P=de-F,G=Math.abs(1e3*P/l);if(P<=-M*f&&S)$===0&&(this.warn(`Audio frame @ ${(de/l).toFixed(3)}s overlaps marker by ${Math.round(1e3*P/l)} ms.`),this.nextAudioTs=A=de-_,F=de);else if(P>=M*f&&G<DC&&S){let te=Math.round(P/f);for(F=de-te*f;F<0&&te&&f;)te--,F+=f;$===0&&(this.nextAudioTs=A=F-_),this.warn(`Injecting ${te} audio frames @ ${((F-_)/l).toFixed(3)}s due to ${Math.round(1e3*P/l)} ms gap.`);for(let fe=0;fe<te;fe++){let ve=NC.getSilentFrame(e.parsedCodec||e.manifestCodec||e.codec,e.channelCount);ve||(this.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),ve=ae.unit.subarray()),E.splice($,0,{unit:ve,pts:F}),F+=f,$++}}ae.pts=F,F+=f}}let C=null,N=null,D,k=0,B=E.length;for(;B--;)k+=E[B].unit.byteLength;for(let M=0,$=E.length;M<$;M++){const F=E[M],ae=F.unit;let de=F.pts;if(N!==null){const G=x[M-1];G.duration=Math.round((de-N)/h)}else if(s&&e.segmentCodec==="aac"&&(de=A+_),C=de,k>0){k+=T;try{D=new Uint8Array(k)}catch(G){this.observer.emit(L.ERROR,L.ERROR,{type:Be.MUX_ERROR,details:Q.REMUX_ALLOC_ERROR,fatal:!1,error:G,bytes:k,reason:`fail allocating audio mdat ${k}`});return}y||(new DataView(D.buffer).setUint32(0,k),D.set(q.types.mdat,4))}else return;D.set(ae,T);const P=ae.byteLength;T+=P,x.push(ex(!0,u,P,0)),N=de}const j=x.length;if(!j)return;const U=x[x.length-1];A=N-_,this.nextAudioTs=A+h*U.duration;const K=y?new Uint8Array(0):q.moof(e.sequenceNumber++,C/h,Dt({},e,{samples:x}));e.samples=[];const H=(C-_)/l,J=this.nextAudioTs/l,me={data1:K,data2:D,startPTS:H,endPTS:J,startDTS:H,endDTS:J,type:"audio",hasAudio:!0,hasVideo:!1,nb:j};return this.isAudioContiguous=!0,me}}function pi(n,e){let t;if(e===null)return n;for(e<n?t=-8589934592:t=8589934592;Math.abs(n-e)>4294967296;)n+=t;return n}function jC(n){for(let e=0;e<n.length;e++)if(n[e].key)return e;return-1}function Tb(n,e,t,s){const i=n.samples.length;if(!i)return;const r=n.inputTimeScale;for(let c=0;c<i;c++){const h=n.samples[c];h.pts=pi(h.pts-t.baseTime*r/t.timescale,e*r)/r,h.dts=pi(h.dts-s.baseTime*r/s.timescale,e*r)/r}const l=n.samples;return n.samples=[],{samples:l}}function Eb(n,e,t){const s=n.samples.length;if(!s)return;const i=n.inputTimeScale;for(let l=0;l<s;l++){const c=n.samples[l];c.pts=pi(c.pts-t.baseTime*i/t.timescale,e*i)/i}n.samples.sort((l,c)=>l.pts-c.pts);const r=n.samples;return n.samples=[],{samples:r}}class BC extends ji{constructor(e,t,s,i){super("passthrough-remuxer",i),this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null,this.isVideoContiguous=!1}destroy(){}resetTimeStamp(e){this.lastEndTime=null;const t=this.initPTS;t&&e&&t.baseTime===e.baseTime&&t.timescale===e.timescale||(this.initPTS=e)}resetNextTimestamp(){this.isVideoContiguous=!1,this.lastEndTime=null}resetInitSegment(e,t,s,i){this.audioCodec=t,this.videoCodec=s,this.generateInitSegment(e,i),this.emitInitSegment=!0}generateInitSegment(e,t){let{audioCodec:s,videoCodec:i}=this;if(!(e!=null&&e.byteLength)){this.initTracks=void 0,this.initData=void 0;return}const{audio:r,video:l}=this.initData=wS(e);if(t)_1(e,t);else{const h=r||l;h!=null&&h.encrypted&&this.warn(`Init segment with encrypted track with has no key ("${h.codec}")!`)}r&&(s=tx(r,Ut.AUDIO,this)),l&&(i=tx(l,Ut.VIDEO,this));const c={};r&&l?c.audiovideo={container:"video/mp4",codec:s+","+i,supplemental:l.supplemental,encrypted:l.encrypted,initSegment:e,id:"main"}:r?c.audio={container:"audio/mp4",codec:s,encrypted:r.encrypted,initSegment:e,id:"audio"}:l?c.video={container:"video/mp4",codec:i,supplemental:l.supplemental,encrypted:l.encrypted,initSegment:e,id:"main"}:this.warn("initSegment does not contain moov or trak boxes."),this.initTracks=c}remux(e,t,s,i,r,l){var c,h;let{initPTS:u,lastEndTime:f}=this;const g={audio:void 0,video:void 0,text:i,id3:s,initSegment:void 0};Ne(f)||(f=this.lastEndTime=r||0);const y=t.samples;if(!y.length)return g;const x={initPTS:void 0,timescale:void 0,trackId:void 0};let S=this.initData;if((c=S)!=null&&c.length||(this.generateInitSegment(y),S=this.initData),!((h=S)!=null&&h.length))return this.warn("Failed to generate initSegment."),g;this.emitInitSegment&&(x.tracks=this.initTracks,this.emitInitSegment=!1);const E=L1(y,S,this),T=S.audio?E[S.audio.id]:null,A=S.video?E[S.video.id]:null,_=Vc(A,1/0),I=Vc(T,1/0),C=Vc(A,0,!0),N=Vc(T,0,!0);let D=r,k=0;const B=T&&(!A||!u&&I<_||u&&u.trackId===S.audio.id),j=B?T:A;if(j){const F=j.timescale,ae=j.start-r*F,de=B?S.audio.id:S.video.id;D=j.start/F,k=B?N-I:C-_,(l||!u)&&(FC(u,D,r,k)||F!==u.timescale)&&(u&&this.warn(`Timestamps at playlist time: ${l?"":"~"}${r} ${ae/F} != initPTS: ${u.baseTime/u.timescale} (${u.baseTime}/${u.timescale}) trackId: ${u.trackId}`),this.log(`Found initPTS at playlist time: ${r} offset: ${D-r} (${ae}/${F}) trackId: ${de}`),u=null,x.initPTS=ae,x.timescale=F,x.trackId=de)}else this.warn(`No audio or video samples found for initPTS at playlist time: ${r}`);u?(x.initPTS=u.baseTime,x.timescale=u.timescale,x.trackId=u.trackId):((!x.timescale||x.trackId===void 0||x.initPTS===void 0)&&(this.warn("Could not set initPTS"),x.initPTS=D,x.timescale=1,x.trackId=-1),this.initPTS=u={baseTime:x.initPTS,timescale:x.timescale,trackId:x.trackId});const U=D-u.baseTime/u.timescale,K=U+k;k>0?this.lastEndTime=K:(this.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const H=!!S.audio,J=!!S.video;let re="";H&&(re+="audio"),J&&(re+="video");const me=(S.audio?S.audio.encrypted:!1)||(S.video?S.video.encrypted:!1),M={data1:y,startPTS:U,startDTS:U,endPTS:K,endDTS:K,type:re,hasAudio:H,hasVideo:J,nb:1,dropped:0,encrypted:me};g.audio=H&&!J?M:void 0,g.video=J?M:void 0;const $=A?.sampleCount;if($){const F=A.keyFrameIndex,ae=F!==-1;M.nb=$,M.dropped=F===0||this.isVideoContiguous?0:ae?F:$,M.independent=ae,M.firstKeyFrame=F,ae&&A.keyFrameStart&&(M.firstKeyFramePTS=(A.keyFrameStart-u.baseTime)/u.timescale),this.isVideoContiguous||(g.independent=ae),this.isVideoContiguous||(this.isVideoContiguous=ae),M.dropped&&this.warn(`fmp4 does not start with IDR: firstIDR ${F}/${$} dropped: ${M.dropped} start: ${M.firstKeyFramePTS||"NA"}`)}return g.initSegment=x,g.id3=Tb(s,r,u,u),i.samples.length&&(g.text=Eb(i,r,u)),g}}function Vc(n,e,t=!1){return n?.start!==void 0?(n.start+(t?n.duration:0))/n.timescale:e}function FC(n,e,t,s){if(n===null)return!0;const i=Math.max(s,1),r=e-n.baseTime/n.timescale;return Math.abs(r-t)>i}function tx(n,e,t){const s=n.codec;return s&&s.length>4?s:e===Ut.AUDIO?s==="ec-3"||s==="ac-3"||s==="alac"?s:s==="fLaC"||s==="Opus"?pu(s,!1):(t.warn(`Unhandled audio codec "${s}" in mp4 MAP`),s||"mp4a"):(t.warn(`Unhandled video codec "${s}" in mp4 MAP`),s||"avc1")}let Bn;try{Bn=self.performance.now.bind(self.performance)}catch{Bn=Date.now}const au=[{demux:IC,remux:BC},{demux:Sa,remux:nu},{demux:bC,remux:nu},{demux:EC,remux:nu}];au.splice(2,0,{demux:TC,remux:nu});class sx{constructor(e,t,s,i,r,l){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=s,this.id=r,this.logger=l}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,s,i){const r=s.transmuxing;r.executeStart=Bn();let l=new Uint8Array(e);const{currentTransmuxState:c,transmuxConfig:h}=this;i&&(this.currentTransmuxState=i);const{contiguous:u,discontinuity:f,trackSwitch:g,accurateTimeOffset:y,timeOffset:x,initSegmentChange:S}=i||c,{audioCodec:E,videoCodec:T,defaultInitPts:A,duration:_,initSegmentData:I}=h,C=VC(l,t);if(C&&Br(C.method)){const B=this.getDecrypter(),j=Im(C.method);if(B.isSync()){let U=B.softwareDecrypt(l,C.key.buffer,C.iv.buffer,j);if(s.part>-1){const H=B.flush();U=H&&H.buffer}if(!U)return r.executeEnd=Bn(),yf(s);l=new Uint8Array(U)}else return this.asyncResult=!0,this.decryptionPromise=B.webCryptoDecrypt(l,C.key.buffer,C.iv.buffer,j).then(U=>{const K=this.push(U,null,s);return this.decryptionPromise=null,K}),this.decryptionPromise}const N=this.needsProbing(f,g);if(N){const B=this.configureTransmuxer(l);if(B)return this.logger.warn(`[transmuxer] ${B.message}`),this.observer.emit(L.ERROR,L.ERROR,{type:Be.MEDIA_ERROR,details:Q.FRAG_PARSING_ERROR,fatal:!1,error:B,reason:B.message}),r.executeEnd=Bn(),yf(s)}(f||g||S||N)&&this.resetInitSegment(I,E,T,_,t),(f||S||N)&&this.resetInitialTimestamp(A),u||this.resetContiguity();const D=this.transmux(l,C,x,y,s);this.asyncResult=eo(D);const k=this.currentTransmuxState;return k.contiguous=!0,k.discontinuity=!1,k.trackSwitch=!1,r.executeEnd=Bn(),D}flush(e){const t=e.transmuxing;t.executeStart=Bn();const{decrypter:s,currentTransmuxState:i,decryptionPromise:r}=this;if(r)return this.asyncResult=!0,r.then(()=>this.flush(e));const l=[],{timeOffset:c}=i;if(s){const g=s.flush();g&&l.push(this.push(g.buffer,null,e))}const{demuxer:h,remuxer:u}=this;if(!h||!u){t.executeEnd=Bn();const g=[yf(e)];return this.asyncResult?Promise.resolve(g):g}const f=h.flush(c);return eo(f)?(this.asyncResult=!0,f.then(g=>(this.flushRemux(l,g,e),l))):(this.flushRemux(l,f,e),this.asyncResult?Promise.resolve(l):l)}flushRemux(e,t,s){const{audioTrack:i,videoTrack:r,id3Track:l,textTrack:c}=t,{accurateTimeOffset:h,timeOffset:u}=this.currentTransmuxState;this.logger.log(`[transmuxer.ts]: Flushed ${this.id} sn: ${s.sn}${s.part>-1?" part: "+s.part:""} of ${this.id===ke.MAIN?"level":"track"} ${s.level}`);const f=this.remuxer.remux(i,r,l,c,u,h,!0,this.id);e.push({remuxResult:f,chunkMeta:s}),s.transmuxing.executeEnd=Bn()}resetInitialTimestamp(e){const{demuxer:t,remuxer:s}=this;!t||!s||(t.resetTimeStamp(e),s.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:t}=this;!e||!t||(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,s,i,r){const{demuxer:l,remuxer:c}=this;!l||!c||(l.resetInitSegment(e,t,s,i),c.resetInitSegment(e,t,s,r))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,s,i,r){let l;return t&&t.method==="SAMPLE-AES"?l=this.transmuxSampleAes(e,t,s,i,r):l=this.transmuxUnencrypted(e,s,i,r),l}transmuxUnencrypted(e,t,s,i){const{audioTrack:r,videoTrack:l,id3Track:c,textTrack:h}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(r,l,c,h,t,s,!1,this.id),chunkMeta:i}}transmuxSampleAes(e,t,s,i,r){return this.demuxer.demuxSampleAes(e,t,s).then(l=>({remuxResult:this.remuxer.remux(l.audioTrack,l.videoTrack,l.id3Track,l.textTrack,s,i,!1,this.id),chunkMeta:r}))}configureTransmuxer(e){const{config:t,observer:s,typeSupported:i}=this;let r;for(let g=0,y=au.length;g<y;g++){var l;if((l=au[g].demux)!=null&&l.probe(e,this.logger)){r=au[g];break}}if(!r)return new Error("Failed to find demuxer by probing fragment data");const c=this.demuxer,h=this.remuxer,u=r.remux,f=r.demux;(!h||!(h instanceof u))&&(this.remuxer=new u(s,t,i,this.logger)),(!c||!(c instanceof f))&&(this.demuxer=new f(s,t,i,this.logger),this.probe=f.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new Em(this.config)),e}}function VC(n,e){let t=null;return n.byteLength>0&&e?.key!=null&&e.iv!==null&&e.method!=null&&(t=e),t}const yf=n=>({remuxResult:{},chunkMeta:n});function eo(n){return"then"in n&&n.then instanceof Function}class $C{constructor(e,t,s,i,r){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=s,this.duration=i,this.defaultInitPts=r||null}}class GC{constructor(e,t,s,i,r,l){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=s,this.trackSwitch=i,this.timeOffset=r,this.initSegmentChange=l}}let ix=0;class Ab{constructor(e,t,s,i){this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=ix++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=h=>{const u=h.data,f=this.hls;if(!(!f||!(u!=null&&u.event)||u.instanceNo!==this.instanceNo))switch(u.event){case"init":{var g;const y=(g=this.workerContext)==null?void 0:g.objectURL;y&&self.URL.revokeObjectURL(y);break}case"transmuxComplete":{this.handleTransmuxComplete(u.data);break}case"flush":{this.onFlush(u.data);break}case"workerLog":{f.logger[u.data.logType]&&f.logger[u.data.logType](u.data.message);break}default:{u.data=u.data||{},u.data.frag=this.frag,u.data.part=this.part,u.data.id=this.id,f.trigger(u.event,u.data);break}}},this.onWorkerError=h=>{if(!this.hls)return;const u=new Error(`${h.message}  (${h.filename}:${h.lineno})`);this.hls.config.enableWorker=!1,this.hls.logger.warn(`Error in "${this.id}" Web Worker, fallback to inline`),this.hls.trigger(L.ERROR,{type:Be.OTHER_ERROR,details:Q.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:u})};const r=e.config;this.hls=e,this.id=t,this.useWorker=!!r.enableWorker,this.onTransmuxComplete=s,this.onFlush=i;const l=(h,u)=>{u=u||{},u.frag=this.frag||void 0,h===L.ERROR&&(u=u,u.parent=this.id,u.part=this.part,this.error=u.error),this.hls.trigger(h,u)};this.observer=new Lm,this.observer.on(L.FRAG_DECRYPTED,l),this.observer.on(L.ERROR,l);const c=vv(r.preferManagedMediaSource);if(this.useWorker&&typeof Worker<"u"){const h=this.hls.logger;if(r.workerPath||Yw()){try{r.workerPath?(h.log(`loading Web Worker ${r.workerPath} for "${t}"`),this.workerContext=Qw(r.workerPath)):(h.log(`injecting Web Worker for "${t}"`),this.workerContext=qw());const{worker:f}=this.workerContext;f.addEventListener("message",this.onWorkerMessage),f.addEventListener("error",this.onWorkerError),f.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:c,id:t,config:Mt(r)})}catch(f){h.warn(`Error setting up "${t}" Web Worker, fallback to inline`,f),this.terminateWorker(),this.error=null,this.transmuxer=new sx(this.observer,c,r,"",t,e.logger)}return}}this.transmuxer=new sx(this.observer,c,r,"",t,e.logger)}reset(){if(this.frag=null,this.part=null,this.workerContext){const e=this.instanceNo;this.instanceNo=ix++;const t=this.hls.config,s=vv(t.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:e,typeSupported:s,id:this.id,config:Mt(t)})}}terminateWorker(){if(this.workerContext){const{worker:e}=this.workerContext;this.workerContext=null,e.removeEventListener("message",this.onWorkerMessage),e.removeEventListener("error",this.onWorkerError),Ww(this.hls.config.workerPath)}}destroy(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{const t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null}push(e,t,s,i,r,l,c,h,u,f){var g,y;u.transmuxing.start=self.performance.now();const{instanceNo:x,transmuxer:S}=this,E=l?l.start:r.start,T=r.decryptdata,A=this.frag,_=!(A&&r.cc===A.cc),I=!(A&&u.level===A.level),C=A?u.sn-A.sn:-1,N=this.part?u.part-this.part.index:-1,D=C===0&&u.id>1&&u.id===A?.stats.chunkCount,k=!I&&(C===1||C===0&&(N===1||D&&N<=0)),B=self.performance.now();(I||C||r.stats.parsing.start===0)&&(r.stats.parsing.start=B),l&&(N||!k)&&(l.stats.parsing.start=B);const j=!(A&&((g=r.initSegment)==null?void 0:g.url)===((y=A.initSegment)==null?void 0:y.url)),U=new GC(_,k,h,I,E,j);if(!k||_||j){this.hls.logger.log(`[transmuxer-interface]: Starting new transmux session for ${r.type} sn: ${u.sn}${u.part>-1?" part: "+u.part:""} ${this.id===ke.MAIN?"level":"track"}: ${u.level} id: ${u.id}
        discontinuity: ${_}
        trackSwitch: ${I}
        contiguous: ${k}
        accurateTimeOffset: ${h}
        timeOffset: ${E}
        initSegmentChange: ${j}`);const K=new $C(s,i,t,c,f);this.configureTransmuxer(K)}if(this.frag=r,this.part=l,this.workerContext)this.workerContext.worker.postMessage({instanceNo:x,cmd:"demux",data:e,decryptdata:T,chunkMeta:u,state:U},e instanceof ArrayBuffer?[e]:[]);else if(S){const K=S.push(e,T,u,U);eo(K)?K.then(H=>{this.handleTransmuxComplete(H)}).catch(H=>{this.transmuxerError(H,u,"transmuxer-interface push error")}):this.handleTransmuxComplete(K)}}flush(e){e.transmuxing.start=self.performance.now();const{instanceNo:t,transmuxer:s}=this;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:t,cmd:"flush",chunkMeta:e});else if(s){const i=s.flush(e);eo(i)?i.then(r=>{this.handleFlushResult(r,e)}).catch(r=>{this.transmuxerError(r,e,"transmuxer-interface flush error")}):this.handleFlushResult(i,e)}}transmuxerError(e,t,s){this.hls&&(this.error=e,this.hls.trigger(L.ERROR,{type:Be.MEDIA_ERROR,details:Q.FRAG_PARSING_ERROR,chunkMeta:t,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:e,err:e,reason:s}))}handleFlushResult(e,t){e.forEach(s=>{this.handleTransmuxComplete(s)}),this.onFlush(t)}configureTransmuxer(e){const{instanceNo:t,transmuxer:s}=this;this.workerContext?this.workerContext.worker.postMessage({instanceNo:t,cmd:"configure",config:e}):s&&s.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}const nx=100;class HC extends Rm{constructor(e,t,s){super(e,t,s,"audio-stream-controller",ke.AUDIO),this.mainAnchor=null,this.mainFragLoading=null,this.audioOnly=!1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.resetItem()}resetItem(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(L.LEVEL_LOADED,this.onLevelLoaded,this),e.on(L.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(L.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(L.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(L.BUFFER_RESET,this.onBufferReset,this),e.on(L.BUFFER_CREATED,this.onBufferCreated,this),e.on(L.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(L.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(L.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(L.FRAG_LOADING,this.onFragLoading,this),e.on(L.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){const{hls:e}=this;e&&(super.unregisterListeners(),e.off(L.LEVEL_LOADED,this.onLevelLoaded,this),e.off(L.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(L.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(L.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(L.BUFFER_RESET,this.onBufferReset,this),e.off(L.BUFFER_CREATED,this.onBufferCreated,this),e.off(L.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(L.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(L.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(L.FRAG_LOADING,this.onFragLoading,this),e.off(L.FRAG_BUFFERED,this.onFragBuffered,this))}onInitPtsFound(e,{frag:t,id:s,initPTS:i,timescale:r,trackId:l}){if(s===ke.MAIN){const c=t.cc,h=this.fragCurrent;if(this.initPTS[c]={baseTime:i,timescale:r,trackId:l},this.log(`InitPTS for cc: ${c} found from main: ${i/r} (${i}/${r}) trackId: ${l}`),this.mainAnchor=t,this.state===ue.WAITING_INIT_PTS){const u=this.waitingData;(!u&&!this.loadingParts||u&&u.frag.cc!==c)&&this.syncWithAnchor(t,u?.frag)}else!this.hls.hasEnoughToStart&&h&&h.cc!==c?(h.abortRequests(),this.syncWithAnchor(t,h)):this.state===ue.IDLE&&this.tick()}}getLoadPosition(){return!this.startFragRequested&&this.nextLoadPosition>=0?this.nextLoadPosition:super.getLoadPosition()}syncWithAnchor(e,t){var s;const i=((s=this.mainFragLoading)==null?void 0:s.frag)||null;if(t&&i?.cc===t.cc)return;const r=(i||e).cc,l=this.getLevelDetails(),c=this.getLoadPosition(),h=FS(l,r,c);h&&(this.log(`Syncing with main frag at ${h.start} cc ${h.cc}`),this.startFragRequested=!1,this.nextLoadPosition=h.start,this.resetLoadingState(),this.state===ue.IDLE&&this.doTickIdle())}startLoad(e,t){if(!this.levels){this.startPosition=e,this.state=ue.STOPPED;return}const s=this.lastCurrentTime;this.stopLoad(),this.setInterval(nx),s>0&&e===-1?(this.log(`Override startPosition with lastCurrentTime @${s.toFixed(3)}`),e=s,this.state=ue.IDLE):this.state=ue.WAITING_TRACK,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}doTick(){switch(this.state){case ue.IDLE:this.doTickIdle();break;case ue.WAITING_TRACK:{const{levels:e,trackId:t}=this,s=e?.[t],i=s?.details;if(i&&!this.waitForLive(s)){if(this.waitForCdnTuneIn(i))break;this.state=ue.WAITING_INIT_PTS}break}case ue.FRAG_LOADING_WAITING_RETRY:{this.checkRetryDate();break}case ue.WAITING_INIT_PTS:{const e=this.waitingData;if(e){const{frag:t,part:s,cache:i,complete:r}=e,l=this.mainAnchor;if(this.initPTS[t.cc]!==void 0){this.waitingData=null,this.state=ue.FRAG_LOADING;const c=i.flush().buffer,h={frag:t,part:s,payload:c,networkDetails:null};this._handleFragmentLoadProgress(h),r&&super._handleFragmentLoadComplete(h)}else l&&l.cc!==e.frag.cc&&this.syncWithAnchor(l,e.frag)}else this.state=ue.IDLE}}this.onTickEnd()}resetLoadingState(){const e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null),super.resetLoadingState()}onTickEnd(){const{media:e}=this;e!=null&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){var e;const{hls:t,levels:s,media:i,trackId:r}=this,l=t.config;if(!this.buffering||!i&&!this.primaryPrefetch&&(this.startFragRequested||!l.startFragPrefetch)||!(s!=null&&s[r]))return;const c=s[r],h=c.details;if(!h||this.waitForLive(c)||this.waitForCdnTuneIn(h)){this.state=ue.WAITING_TRACK,this.startFragRequested=!1;return}const u=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&u&&(this.bufferFlushed=!1,this.afterBufferFlushed(u,Ut.AUDIO,ke.AUDIO));const f=this.getFwdBufferInfo(u,ke.AUDIO);if(f===null)return;if(!this.switchingTrack&&this._streamEnded(f,h)){t.trigger(L.BUFFER_EOS,{type:"audio"}),this.state=ue.ENDED;return}const g=f.len,y=t.maxBufferLength,x=h.fragments,S=x[0].start,E=this.getLoadPosition(),T=this.flushing?E:f.end;if(this.switchingTrack&&i){const I=E;h.PTSKnown&&I<S&&(f.end>S||f.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),i.currentTime=S+.05)}if(g>=y&&!this.switchingTrack&&T<x[x.length-1].start)return;let A=this.getNextFragment(T,h);if(A&&this.isLoopLoading(A,T)&&(A=this.getNextFragmentLoopLoading(A,h,f,ke.MAIN,y)),!A){this.bufferFlushed=!0;return}let _=((e=this.mainFragLoading)==null?void 0:e.frag)||null;if(!this.audioOnly&&this.startFragRequested&&_&&ss(A)&&!A.endList&&(!h.live||!this.loadingParts&&T<this.hls.liveSyncPosition)&&(this.fragmentTracker.getState(_)===fs.OK&&(this.mainFragLoading=_=null),_&&ss(_))){if(A.start>_.end){const C=this.fragmentTracker.getFragAtPos(T,ke.MAIN);C&&C.end>_.end&&(_=C,this.mainFragLoading={frag:C,targetBufferTime:null})}if(A.start>_.end)return}this.loadFragment(A,c,T)}onMediaDetaching(e,t){this.bufferFlushed=this.flushing=!1,super.onMediaDetaching(e,t)}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map(s=>new Xl(s))}onAudioTrackSwitching(e,t){const s=!!t.url;this.trackId=t.id;const{fragCurrent:i}=this;i&&(i.abortRequests(),this.removeUnbufferedFrags(i.start)),this.resetLoadingState(),s?(this.switchingTrack=t,this.flushAudioIfNeeded(t),this.state!==ue.STOPPED&&(this.setInterval(nx),this.state=ue.IDLE,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=t,this.clearInterval())}onManifestLoading(){super.onManifestLoading(),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1}onLevelLoaded(e,t){this.mainDetails=t.details;const s=this.cachedTrackLoadedData;s&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded(L.AUDIO_TRACK_LOADED,s))}onAudioTrackLoaded(e,t){var s;const{levels:i}=this,{details:r,id:l,groupId:c,track:h}=t;if(!i){this.warn(`Audio tracks reset while loading track ${l} "${h.name}" of "${c}"`);return}const u=this.mainDetails;if(!u||r.endCC>u.endCC||u.expired){this.cachedTrackLoadedData=t,this.state!==ue.STOPPED&&(this.state=ue.WAITING_TRACK);return}this.cachedTrackLoadedData=null,this.log(`Audio track ${l} "${h.name}" of "${c}" loaded [${r.startSN},${r.endSN}]${r.lastPartSn?`[part-${r.lastPartSn}-${r.lastPartIndex}]`:""},duration:${r.totalduration}`);const f=i[l];let g=0;if(r.live||(s=f.details)!=null&&s.live){if(this.checkLiveUpdate(r),r.deltaUpdateFailed)return;if(f.details){var y;g=this.alignPlaylists(r,f.details,(y=this.levelLastLoaded)==null?void 0:y.details)}r.alignedSliding||(nb(r,u),r.alignedSliding||Tu(r,u),g=r.fragmentStart)}f.details=r,this.levelLastLoaded=f,this.startFragRequested||this.setStartPosition(u,g),this.hls.trigger(L.AUDIO_TRACK_UPDATED,{details:r,id:l,groupId:t.groupId}),this.state===ue.WAITING_TRACK&&!this.waitForCdnTuneIn(r)&&(this.state=ue.IDLE),this.tick()}_handleFragmentLoadProgress(e){var t;const s=e.frag,{part:i,payload:r}=e,{config:l,trackId:c,levels:h}=this;if(!h){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${s.sn} of level ${s.level} will not be buffered`);return}const u=h[c];if(!u){this.warn("Audio track is undefined on fragment load progress");return}const f=u.details;if(!f){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(s.start);return}const g=l.defaultAudioCodec||u.audioCodec||"mp4a.40.2";let y=this.transmuxer;y||(y=this.transmuxer=new Ab(this.hls,ke.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const x=this.initPTS[s.cc],S=(t=s.initSegment)==null?void 0:t.data;if(x!==void 0){const T=i?i.index:-1,A=T!==-1,_=new Am(s.level,s.sn,s.stats.chunkCount,r.byteLength,T,A);y.push(r,S,g,"",s,i,f.totalduration,!1,_,x)}else{this.log(`Unknown video PTS for cc ${s.cc}, waiting for video PTS before demuxing audio frag ${s.sn} of [${f.startSN} ,${f.endSN}],track ${c}`);const{cache:E}=this.waitingData=this.waitingData||{frag:s,part:i,cache:new ab,complete:!1};E.push(new Uint8Array(r)),this.state!==ue.STOPPED&&(this.state=ue.WAITING_INIT_PTS)}}_handleFragmentLoadComplete(e){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=null}onBufferCreated(e,t){this.bufferFlushed=this.flushing=!1;const s=t.tracks.audio;s&&(this.mediaBuffer=s.buffer||null)}onFragLoading(e,t){!this.audioOnly&&t.frag.type===ke.MAIN&&ss(t.frag)&&(this.mainFragLoading=t,this.state===ue.IDLE&&this.tick())}onFragBuffered(e,t){const{frag:s,part:i}=t;if(s.type!==ke.AUDIO){!this.audioOnly&&s.type===ke.MAIN&&!s.elementaryStreams.video&&!s.elementaryStreams.audiovideo&&(this.audioOnly=!0,this.mainFragLoading=null);return}if(this.fragContextChanged(s)){this.warn(`Fragment ${s.sn}${i?" p: "+i.index:""} of level ${s.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(ss(s)){this.fragPrevious=s;const r=this.switchingTrack;r&&(this.bufferedTrack=r,this.switchingTrack=null,this.hls.trigger(L.AUDIO_TRACK_SWITCHED,Rt({},r)))}this.fragBufferedComplete(s,i),this.media&&this.tick()}onError(e,t){var s;if(t.fatal){this.state=ue.ERROR;return}switch(t.details){case Q.FRAG_GAP:case Q.FRAG_PARSING_ERROR:case Q.FRAG_DECRYPT_ERROR:case Q.FRAG_LOAD_ERROR:case Q.FRAG_LOAD_TIMEOUT:case Q.KEY_LOAD_ERROR:case Q.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(ke.AUDIO,t);break;case Q.AUDIO_TRACK_LOAD_ERROR:case Q.AUDIO_TRACK_LOAD_TIMEOUT:case Q.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===ue.WAITING_TRACK&&((s=t.context)==null?void 0:s.type)===at.AUDIO_TRACK&&(this.state=ue.IDLE);break;case Q.BUFFER_ADD_CODEC_ERROR:case Q.BUFFER_APPEND_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)||this.resetLoadingState();break;case Q.BUFFER_FULL_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case Q.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onBufferFlushing(e,{type:t}){t!==Ut.VIDEO&&(this.flushing=!0)}onBufferFlushed(e,{type:t}){if(t!==Ut.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===ue.ENDED&&(this.state=ue.IDLE);const s=this.mediaBuffer||this.media;s&&(this.afterBufferFlushed(s,t,ke.AUDIO),this.tick())}}_handleTransmuxComplete(e){var t;const s="audio",{hls:i}=this,{remuxResult:r,chunkMeta:l}=e,c=this.getCurrentContext(l);if(!c){this.resetWhenMissingContext(l);return}const{frag:h,part:u,level:f}=c,{details:g}=f,{audio:y,text:x,id3:S,initSegment:E}=r;if(this.fragContextChanged(h)||!g){this.fragmentTracker.removeFragment(h);return}if(this.state=ue.PARSING,this.switchingTrack&&y&&this.completeAudioSwitch(this.switchingTrack),E!=null&&E.tracks){const T=h.initSegment||h;if(this.unhandledEncryptionError(E,h))return;this._bufferInitSegment(f,E.tracks,T,l),i.trigger(L.FRAG_PARSING_INIT_SEGMENT,{frag:T,id:s,tracks:E.tracks})}if(y){const{startPTS:T,endPTS:A,startDTS:_,endDTS:I}=y;u&&(u.elementaryStreams[Ut.AUDIO]={startPTS:T,endPTS:A,startDTS:_,endDTS:I}),h.setElementaryStreamInfo(Ut.AUDIO,T,A,_,I),this.bufferFragmentData(y,h,u,l)}if(S!=null&&(t=S.samples)!=null&&t.length){const T=Dt({id:s,frag:h,details:g},S);i.trigger(L.FRAG_PARSING_METADATA,T)}if(x){const T=Dt({id:s,frag:h,details:g},x);i.trigger(L.FRAG_PARSING_USERDATA,T)}}_bufferInitSegment(e,t,s,i){if(this.state!==ue.PARSING||(t.video&&delete t.video,t.audiovideo&&delete t.audiovideo,!t.audio))return;const r=t.audio;r.id=ke.AUDIO;const l=e.audioCodec;this.log(`Init audio buffer, container:${r.container}, codecs[level/parsed]=[${l}/${r.codec}]`),l&&l.split(",").length===1&&(r.levelCodec=l),this.hls.trigger(L.BUFFER_CODECS,t);const c=r.initSegment;if(c!=null&&c.byteLength){const h={type:"audio",frag:s,part:null,chunkMeta:i,parent:s.type,data:c};this.hls.trigger(L.BUFFER_APPENDING,h)}this.tickImmediate()}loadFragment(e,t,s){const i=this.fragmentTracker.getState(e);if(this.switchingTrack||i===fs.NOT_LOADED||i===fs.PARTIAL){var r;if(!ss(e))this._loadInitSegment(e,t);else if((r=t.details)!=null&&r.live&&!this.initPTS[e.cc]){this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=ue.WAITING_INIT_PTS;const l=this.mainDetails;l&&l.fragmentStart!==t.details.fragmentStart&&Tu(t.details,l)}else super.loadFragment(e,t,s)}else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){if(this.media&&this.bufferedTrack){const{name:t,lang:s,assocLang:i,characteristics:r,audioCodec:l,channels:c}=this.bufferedTrack;Ya({name:t,lang:s,assocLang:i,characteristics:r,audioCodec:l,channels:c},e,Ha)||(yu(e.url,this.hls)?(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null):this.bufferedTrack=e)}}completeAudioSwitch(e){const{hls:t}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(L.AUDIO_TRACK_SWITCHED,Rt({},e))}}class Pm extends ji{constructor(e,t){super(t,e.logger),this.hls=void 0,this.canLoad=!1,this.timer=-1,this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t,s){const i=t?.renditionReports;if(i){let r=-1;for(let l=0;l<i.length;l++){const c=i[l];let h;try{h=new self.URL(c.URI,t.url).href}catch(u){this.warn(`Could not construct new URL for Rendition Report: ${u}`),h=c.URI||""}if(h===e){r=l;break}else h===e.substring(0,h.length)&&(r=l)}if(r!==-1){const l=i[r],c=parseInt(l["LAST-MSN"])||t.lastPartSn;let h=parseInt(l["LAST-PART"])||t.lastPartIndex;if(this.hls.config.lowLatencyMode){const f=Math.min(t.age-t.partTarget,t.targetduration);h>=0&&f>t.partTarget&&(h+=1)}const u=s&&xv(s);return new Sv(c,h>=0?h:void 0,u)}}}loadPlaylist(e){this.clearTimer()}loadingPlaylist(e,t){this.clearTimer()}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}getUrlWithDirectives(e,t){if(t)try{return t.addDirectives(e)}catch(s){this.warn(`Could not construct new URL with HLS Delivery Directives: ${s}`)}return e}playlistLoaded(e,t,s){const{details:i,stats:r}=t,l=self.performance.now(),c=r.loading.first?Math.max(0,l-r.loading.first):0;i.advancedDateTime=Date.now()-c;const h=this.hls.config.timelineOffset;if(h!==i.appliedTimelineOffset){const f=Math.max(h||0,0);i.appliedTimelineOffset=f,i.fragments.forEach(g=>{g.setStart(g.playlistOffset+f)})}if(i.live||s!=null&&s.live){const f="levelInfo"in t?t.levelInfo:t.track;if(i.reloaded(s),s&&i.fragments.length>0){Uw(s,i,this);const _=i.playlistParsingError;if(_){this.warn(_);const I=this.hls;if(!I.config.ignorePlaylistParsingErrors){var u;const{networkDetails:C}=t;I.trigger(L.ERROR,{type:Be.NETWORK_ERROR,details:Q.LEVEL_PARSING_ERROR,fatal:!1,url:i.url,error:_,reason:_.message,level:t.level||void 0,parent:(u=i.fragments[0])==null?void 0:u.type,networkDetails:C,stats:r});return}i.playlistParsingError=null}}i.requestScheduled===-1&&(i.requestScheduled=r.loading.start);const g=this.hls.mainForwardBufferInfo,y=g?g.end-g.len:0,x=(i.edge-y)*1e3,S=JS(i,x);if(i.requestScheduled+S<l?i.requestScheduled=l:i.requestScheduled+=S,this.log(`live playlist ${e} ${i.advanced?"REFRESHED "+i.lastPartSn+"-"+i.lastPartIndex:i.updated?"UPDATED":"MISSED"}`),!this.canLoad||!i.live)return;let E,T,A;if(i.canBlockReload&&i.endSN&&i.advanced){const _=this.hls.config.lowLatencyMode,I=i.lastPartSn,C=i.endSN,N=i.lastPartIndex,D=N!==-1,k=I===C;D?k?(T=C+1,A=_?0:N):(T=I,A=_?N+1:i.maxPartIndex):T=C+1;const B=i.age,j=B+i.ageHeader;let U=Math.min(j-i.partTarget,i.targetduration*1.5);if(U>0){if(j>i.targetduration*3)this.log(`Playlist last advanced ${B.toFixed(2)}s ago. Omitting segment and part directives.`),T=void 0,A=void 0;else if(s!=null&&s.tuneInGoal&&j-i.partTarget>s.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${s.tuneInGoal} to: ${U} with playlist age: ${i.age}`),U=0;else{const K=Math.floor(U/i.targetduration);if(T+=K,A!==void 0){const H=Math.round(U%i.targetduration/i.partTarget);A+=H}this.log(`CDN Tune-in age: ${i.ageHeader}s last advanced ${B.toFixed(2)}s goal: ${U} skip sn ${K} to part ${A}`)}i.tuneInGoal=U}if(E=this.getDeliveryDirectives(i,t.deliveryDirectives,T,A),_||!k){i.requestScheduled=l,this.loadingPlaylist(f,E);return}}else(i.canBlockReload||i.canSkipUntil)&&(E=this.getDeliveryDirectives(i,t.deliveryDirectives,T,A));E&&T!==void 0&&i.canBlockReload&&(i.requestScheduled=r.loading.first+Math.max(S-c*2,S/2)),this.scheduleLoading(f,E,i)}else this.clearTimer()}scheduleLoading(e,t,s){const i=s||e.details;if(!i){this.loadingPlaylist(e,t);return}const r=self.performance.now(),l=i.requestScheduled;if(r>=l){this.loadingPlaylist(e,t);return}const c=l-r;this.log(`reload live playlist ${e.name||e.bitrate+"bps"} in ${Math.round(c)} ms`),this.clearTimer(),this.timer=self.setTimeout(()=>this.loadingPlaylist(e,t),c)}getDeliveryDirectives(e,t,s,i){let r=xv(e);return t!=null&&t.skip&&e.deltaUpdateFailed&&(s=t.msn,i=t.part,r=su.No),new Sv(s,i,r)}checkRetry(e){const t=e.details,s=vu(e),i=e.errorAction,{action:r,retryCount:l=0,retryConfig:c}=i||{},h=!!i&&!!c&&(r===As.RetryRequest||!i.resolved&&r===As.SendAlternateToPenaltyBox);if(h){var u;if(l>=c.maxNumRetry)return!1;if(s&&(u=e.context)!=null&&u.deliveryDirectives)this.warn(`Retrying playlist loading ${l+1}/${c.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{const f=Tm(c,l);this.clearTimer(),this.timer=self.setTimeout(()=>this.loadPlaylist(),f),this.warn(`Retrying playlist loading ${l+1}/${c.maxNumRetry} after "${t}" in ${f}ms`)}e.levelRetry=!0,i.resolved=!0}return h}}function Ib(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(!to(n[t].attrs,e[t].attrs))return!1;return!0}function to(n,e,t){const s=n["STABLE-RENDITION-ID"];return s&&!t?s===e["STABLE-RENDITION-ID"]:!(t||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(i=>n[i]!==e[i])}function Qf(n,e){return e.label.toLowerCase()===n.name.toLowerCase()&&(!e.language||e.language.toLowerCase()===(n.lang||"").toLowerCase())}class zC extends Pm{constructor(e){super(e,"audio-track-controller"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.MANIFEST_PARSED,this.onManifestParsed,this),e.on(L.LEVEL_LOADING,this.onLevelLoading,this),e.on(L.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(L.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(L.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.MANIFEST_PARSED,this.onManifestParsed,this),e.off(L.LEVEL_LOADING,this.onLevelLoading,this),e.off(L.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(L.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(L.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){const{id:s,groupId:i,details:r}=t,l=this.tracksInGroup[s];if(!l||l.groupId!==i){this.warn(`Audio track with id:${s} and group:${i} not found in active group ${l?.groupId}`);return}const c=l.details;l.details=t.details,this.log(`Audio track ${s} "${l.name}" lang:${l.lang} group:${i} loaded [${r.startSN}-${r.endSN}]`),s===this.trackId&&this.playlistLoaded(s,t,c)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const s=t.audioGroups||null,i=this.groupIds;let r=this.currentTrack;if(!s||i?.length!==s?.length||s!=null&&s.some(c=>i?.indexOf(c)===-1)){this.groupIds=s,this.trackId=-1,this.currentTrack=null;const c=this.tracks.filter(y=>!s||s.indexOf(y.groupId)!==-1);if(c.length)this.selectDefaultTrack&&!c.some(y=>y.default)&&(this.selectDefaultTrack=!1),c.forEach((y,x)=>{y.id=x});else if(!r&&!this.tracksInGroup.length)return;this.tracksInGroup=c;const h=this.hls.config.audioPreference;if(!r&&h){const y=cn(h,c,Ha);if(y>-1)r=c[y];else{const x=cn(h,this.tracks);r=this.tracks[x]}}let u=this.findTrackId(r);u===-1&&r&&(u=this.findTrackId(null));const f={audioTracks:c};this.log(`Updating audio tracks, ${c.length} track(s) found in group(s): ${s?.join(",")}`),this.hls.trigger(L.AUDIO_TRACKS_UPDATED,f);const g=this.trackId;if(u!==-1&&g===-1)this.setAudioTrack(u);else if(c.length&&g===-1){var l;const y=new Error(`No audio track selected for current audio group-ID(s): ${(l=this.groupIds)==null?void 0:l.join(",")} track count: ${c.length}`);this.warn(y.message),this.hls.trigger(L.ERROR,{type:Be.MEDIA_ERROR,details:Q.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:y})}}}onError(e,t){t.fatal||!t.context||t.context.type===at.AUDIO_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){const t=this.hls;if(t.config.audioPreference=e,e){const s=this.allAudioTracks;if(this.selectDefaultTrack=!1,s.length){const i=this.currentTrack;if(i&&Ya(e,i,Ha))return i;const r=cn(e,this.tracksInGroup,Ha);if(r>-1){const l=this.tracksInGroup[r];return this.setAudioTrack(r),l}else if(i){let l=t.loadLevel;l===-1&&(l=t.firstAutoLevel);const c=iw(e,t.levels,s,l,Ha);if(c===-1)return null;t.nextLoadLevel=c}if(e.channels||e.audioCodec){const l=cn(e,s);if(l>-1)return s[l]}}}return null}setAudioTrack(e){const t=this.tracksInGroup;if(e<0||e>=t.length){this.warn(`Invalid audio track id: ${e}`);return}this.selectDefaultTrack=!1;const s=this.currentTrack,i=t[e],r=i.details&&!i.details.live;if(e===this.trackId&&i===s&&r||(this.log(`Switching to audio-track ${e} "${i.name}" lang:${i.lang} group:${i.groupId} channels:${i.channels}`),this.trackId=e,this.currentTrack=i,this.hls.trigger(L.AUDIO_TRACK_SWITCHING,Rt({},i)),r))return;const l=this.switchParams(i.url,s?.details,i.details);this.loadPlaylist(l)}findTrackId(e){const t=this.tracksInGroup;for(let s=0;s<t.length;s++){const i=t[s];if(!(this.selectDefaultTrack&&!i.default)&&(!e||Ya(e,i,Ha)))return s}if(e){const{name:s,lang:i,assocLang:r,characteristics:l,audioCodec:c,channels:h}=e;for(let u=0;u<t.length;u++){const f=t[u];if(Ya({name:s,lang:i,assocLang:r,characteristics:l,audioCodec:c,channels:h},f,Ha))return u}for(let u=0;u<t.length;u++){const f=t[u];if(to(e.attrs,f.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return u}for(let u=0;u<t.length;u++){const f=t[u];if(to(e.attrs,f.attrs,["LANGUAGE"]))return u}}return-1}loadPlaylist(e){super.loadPlaylist();const t=this.currentTrack;this.shouldLoadPlaylist(t)&&yu(t.url,this.hls)&&this.scheduleLoading(t,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const s=e.id,i=e.groupId,r=this.getUrlWithDirectives(e.url,t),l=e.details,c=l?.age;this.log(`Loading audio-track ${s} "${e.name}" lang:${e.lang} group:${i}${t?.msn!==void 0?" at sn "+t.msn+" part "+t.part:""}${c&&l.live?" age "+c.toFixed(1)+(l.type&&" "+l.type||""):""} ${r}`),this.hls.trigger(L.AUDIO_TRACK_LOADING,{url:r,id:s,groupId:i,deliveryDirectives:t||null,track:e})}}class KC{constructor(e){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=e}destroy(){this.tracks=this.queues=null}append(e,t,s){if(this.queues===null||this.tracks===null)return;const i=this.queues[t];i.push(e),i.length===1&&!s&&this.executeNext(t)}appendBlocker(e){return new Promise(t=>{const s={label:"async-blocker",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.append(s,e)})}prependBlocker(e){return new Promise(t=>{if(this.queues){const s={label:"async-blocker-prepend",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.queues[e].unshift(s)}})}removeBlockers(){this.queues!==null&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach(e=>{var t;const s=(t=e[0])==null?void 0:t.label;(s==="async-blocker"||s==="async-blocker-prepend")&&(e[0].execute(),e.splice(0,1))})}unblockAudio(e){if(this.queues===null)return;this.queues.audio[0]===e&&this.shiftAndExecuteNext("audio")}executeNext(e){if(this.queues===null||this.tracks===null)return;const t=this.queues[e];if(t.length){const i=t[0];try{i.execute()}catch(r){var s;if(i.onError(r),this.queues===null||this.tracks===null)return;const l=(s=this.tracks[e])==null?void 0:s.buffer;l!=null&&l.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){this.queues!==null&&(this.queues[e].shift(),this.executeNext(e))}current(e){var t;return((t=this.queues)==null?void 0:t[e][0])||null}toString(){const{queues:e,tracks:t}=this;return e===null||t===null?"<destroyed>":`
${this.list("video")}
${this.list("audio")}
${this.list("audiovideo")}}`}list(e){var t,s;return(t=this.queues)!=null&&t[e]||(s=this.tracks)!=null&&s[e]?`${e}: (${this.listSbInfo(e)}) ${this.listOps(e)}`:""}listSbInfo(e){var t;const s=(t=this.tracks)==null?void 0:t[e],i=s?.buffer;return i?`SourceBuffer${i.updating?" updating":""}${s.ended?" ended":""}${s.ending?" ending":""}`:"none"}listOps(e){var t;return((t=this.queues)==null?void 0:t[e].map(s=>s.label).join(", "))||""}}const ax=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,_b="HlsJsTrackRemovedError";class YC extends Error{constructor(e){super(e),this.name=_b}}class qC extends ji{constructor(e,t){super("buffer-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.details=null,this._objectUrl=null,this.operationQueue=null,this.bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.blockedAudioAppend=null,this.lastVideoAppendEnd=0,this.appendSource=void 0,this.transferData=void 0,this.overrides=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.sourceBuffers=[[null,null],[null,null]],this._onEndStreaming=s=>{var i;this.hls&&((i=this.mediaSource)==null?void 0:i.readyState)==="open"&&this.hls.pauseBuffering()},this._onStartStreaming=s=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=s=>{const{media:i,mediaSource:r}=this;s&&this.log("Media source opened"),!(!i||!r)&&(r.removeEventListener("sourceopen",this._onMediaSourceOpen),i.removeEventListener("emptied",this._onMediaEmptied),this.updateDuration(),this.hls.trigger(L.MEDIA_ATTACHED,{media:i,mediaSource:r}),this.mediaSource!==null&&this.checkPendingTracks())},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:s,_objectUrl:i}=this;s!==i&&this.error(`Media element src was set while attaching MediaSource (${i} > ${s})`)},this.hls=e,this.fragmentTracker=t,this.appendSource=g1(Ea(e.config.preferManagedMediaSource)),this.initTracks(),this.registerListeners()}hasSourceTypes(){return Object.keys(this.tracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null}registerListeners(){const{hls:e}=this;e.on(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.MANIFEST_PARSED,this.onManifestParsed,this),e.on(L.BUFFER_RESET,this.onBufferReset,this),e.on(L.BUFFER_APPENDING,this.onBufferAppending,this),e.on(L.BUFFER_CODECS,this.onBufferCodecs,this),e.on(L.BUFFER_EOS,this.onBufferEos,this),e.on(L.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(L.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(L.FRAG_PARSED,this.onFragParsed,this),e.on(L.FRAG_CHANGED,this.onFragChanged,this),e.on(L.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.MANIFEST_PARSED,this.onManifestParsed,this),e.off(L.BUFFER_RESET,this.onBufferReset,this),e.off(L.BUFFER_APPENDING,this.onBufferAppending,this),e.off(L.BUFFER_CODECS,this.onBufferCodecs,this),e.off(L.BUFFER_EOS,this.onBufferEos,this),e.off(L.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(L.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(L.FRAG_PARSED,this.onFragParsed,this),e.off(L.FRAG_CHANGED,this.onFragChanged,this),e.off(L.ERROR,this.onError,this)}transferMedia(){const{media:e,mediaSource:t}=this;if(!e)return null;const s={};if(this.operationQueue){const r=this.isUpdating();r||this.operationQueue.removeBlockers();const l=this.isQueued();(r||l)&&this.warn(`Transfering MediaSource with${l?" operations in queue":""}${r?" updating SourceBuffer(s)":""} ${this.operationQueue}`),this.operationQueue.destroy()}const i=this.transferData;return!this.sourceBufferCount&&i&&i.mediaSource===t?Dt(s,i.tracks):this.sourceBuffers.forEach(r=>{const[l]=r;l&&(s[l]=Dt({},this.tracks[l]),this.removeBuffer(l)),r[0]=r[1]=null}),{media:e,mediaSource:t,tracks:s}}initTracks(){const e={};this.sourceBuffers=[[null,null],[null,null]],this.tracks=e,this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0}onManifestLoading(){this.bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){var s;let i=2;(t.audio&&!t.video||!t.altAudio)&&(i=1),this.bufferCodecEventsTotal=i,this.log(`${i} bufferCodec event(s) expected.`),(s=this.transferData)!=null&&s.mediaSource&&this.sourceBufferCount&&i&&this.bufferCreated()}onMediaAttaching(e,t){const s=this.media=t.media;this.transferData=this.overrides=void 0;const i=Ea(this.appendSource);if(i){const r=!!t.mediaSource;(r||t.overrides)&&(this.transferData=t,this.overrides=t.overrides);const l=this.mediaSource=t.mediaSource||new i;if(this.assignMediaSource(l),r)this._objectUrl=s.src,this.attachTransferred();else{const c=this._objectUrl=self.URL.createObjectURL(l);if(this.appendSource)try{s.removeAttribute("src");const h=self.ManagedMediaSource;s.disableRemotePlayback=s.disableRemotePlayback||h&&l instanceof h,rx(s),QC(s,c),s.load()}catch{s.src=c}else s.src=c}s.addEventListener("emptied",this._onMediaEmptied)}}assignMediaSource(e){var t,s;this.log(`${((t=this.transferData)==null?void 0:t.mediaSource)===e?"transferred":"created"} media source: ${(s=e.constructor)==null?void 0:s.name}`),e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.addEventListener("startstreaming",this._onStartStreaming),e.addEventListener("endstreaming",this._onEndStreaming))}attachTransferred(){const e=this.media,t=this.transferData;if(!t||!e)return;const s=this.tracks,i=t.tracks,r=i?Object.keys(i):null,l=r?r.length:0,c=()=>{Promise.resolve().then(()=>{this.media&&this.mediaSourceOpenOrEnded&&this._onMediaSourceOpen()})};if(i&&r&&l){if(!this.tracksReady){this.hls.config.startFragPrefetch=!0,this.log("attachTransferred: waiting for SourceBuffer track info");return}if(this.log(`attachTransferred: (bufferCodecEventsTotal ${this.bufferCodecEventsTotal})
required tracks: ${Mt(s,(h,u)=>h==="initSegment"?void 0:u)};
transfer tracks: ${Mt(i,(h,u)=>h==="initSegment"?void 0:u)}}`),!TS(i,s)){t.mediaSource=null,t.tracks=void 0;const h=e.currentTime,u=this.details,f=Math.max(h,u?.fragments[0].start||0);if(f-h>1){this.log(`attachTransferred: waiting for playback to reach new tracks start time ${h} -> ${f}`);return}this.warn(`attachTransferred: resetting MediaSource for incompatible tracks ("${Object.keys(i)}"->"${Object.keys(s)}") start time: ${f} currentTime: ${h}`),this.onMediaDetaching(L.MEDIA_DETACHING,{}),this.onMediaAttaching(L.MEDIA_ATTACHING,t),e.currentTime=f;return}this.transferData=void 0,r.forEach(h=>{const u=h,f=i[u];if(f){const g=f.buffer;if(g){const y=this.fragmentTracker,x=f.id;if(y.hasFragments(x)||y.hasParts(x)){const T=qe.getBuffered(g);y.detectEvictedFragments(u,T,x,null,!0)}const S=vf(u),E=[u,g];this.sourceBuffers[S]=E,g.updating&&this.operationQueue&&this.operationQueue.prependBlocker(u),this.trackSourceBuffer(u,f)}}}),c(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),c()}get mediaSourceOpenOrEnded(){var e;const t=(e=this.mediaSource)==null?void 0:e.readyState;return t==="open"||t==="ended"}onMediaDetaching(e,t){const s=!!t.transferMedia;this.transferData=this.overrides=void 0;const{media:i,mediaSource:r,_objectUrl:l}=this;if(r){if(this.log(`media source ${s?"transferring":"detaching"}`),s)this.sourceBuffers.forEach(([c])=>{c&&this.removeBuffer(c)}),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){const c=r.readyState==="open";try{const h=r.sourceBuffers;for(let u=h.length;u--;)c&&h[u].abort(),r.removeSourceBuffer(h[u]);c&&r.endOfStream()}catch(h){this.warn(`onMediaDetaching: ${h.message} while calling endOfStream`)}}this.sourceBufferCount&&this.onBufferReset()}r.removeEventListener("sourceopen",this._onMediaSourceOpen),r.removeEventListener("sourceended",this._onMediaSourceEnded),r.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(r.removeEventListener("startstreaming",this._onStartStreaming),r.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}i&&(i.removeEventListener("emptied",this._onMediaEmptied),s||(l&&self.URL.revokeObjectURL(l),this.mediaSrc===l?(i.removeAttribute("src"),this.appendSource&&rx(i),i.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(L.MEDIA_DETACHED,t)}onBufferReset(){this.sourceBuffers.forEach(([e])=>{e&&this.resetBuffer(e)}),this.initTracks()}resetBuffer(e){var t;const s=(t=this.tracks[e])==null?void 0:t.buffer;if(this.removeBuffer(e),s)try{var i;(i=this.mediaSource)!=null&&i.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(s)}catch(r){this.warn(`onBufferReset ${e}`,r)}delete this.tracks[e]}removeBuffer(e){this.removeBufferListeners(e),this.sourceBuffers[vf(e)]=[null,null];const t=this.tracks[e];t&&(t.buffer=void 0)}resetQueue(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new KC(this.tracks)}onBufferCodecs(e,t){var s;const i=this.tracks,r=Object.keys(t);this.log(`BUFFER_CODECS: "${r}" (current SB count ${this.sourceBufferCount})`);const l="audiovideo"in t&&(i.audio||i.video)||i.audiovideo&&("audio"in t||"video"in t),c=!l&&this.sourceBufferCount&&this.media&&r.some(h=>!i[h]);if(l||c){this.warn(`Unsupported transition between "${Object.keys(i)}" and "${r}" SourceBuffers`);return}r.forEach(h=>{var u,f;const g=t[h],{id:y,codec:x,levelCodec:S,container:E,metadata:T,supplemental:A}=g;let _=i[h];const I=(u=this.transferData)==null||(u=u.tracks)==null?void 0:u[h],C=I!=null&&I.buffer?I:_,N=C?.pendingCodec||C?.codec,D=C?.levelCodec;_||(_=i[h]={buffer:void 0,listeners:[],codec:x,supplemental:A,container:E,levelCodec:S,metadata:T,id:y});const k=tu(N,D),B=k?.replace(ax,"$1");let j=tu(x,S);const U=(f=j)==null?void 0:f.replace(ax,"$1");j&&k&&B!==U&&(h.slice(0,5)==="audio"&&(j=pu(j,this.appendSource)),this.log(`switching codec ${N} to ${j}`),j!==(_.pendingCodec||_.codec)&&(_.pendingCodec=j),_.container=E,this.appendChangeType(h,E,j))}),(this.tracksReady||this.sourceBufferCount)&&(t.tracks=this.sourceBufferTracks),!this.sourceBufferCount&&(this.bufferCodecEventsTotal>1&&!this.tracks.video&&!t.video&&((s=t.audio)==null?void 0:s.id)==="main"&&(this.log("Main audio-only"),this.bufferCodecEventsTotal=1),this.mediaSourceOpenOrEnded&&this.checkPendingTracks())}get sourceBufferTracks(){return Object.keys(this.tracks).reduce((e,t)=>{const s=this.tracks[t];return e[t]={id:s.id,container:s.container,codec:s.codec,levelCodec:s.levelCodec},e},{})}appendChangeType(e,t,s){const i=`${t};codecs=${s}`,r={label:`change-type=${i}`,execute:()=>{const l=this.tracks[e];if(l){const c=l.buffer;c!=null&&c.changeType&&(this.log(`changing ${e} sourceBuffer type to ${i}`),c.changeType(i),l.codec=s,l.container=t)}this.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:l=>{this.warn(`Failed to change ${e} SourceBuffer type`,l)}};this.append(r,e,this.isPending(this.tracks[e]))}blockAudio(e){var t;const s=e.start,i=s+e.duration*.05;if(((t=this.fragmentTracker.getAppendedFrag(s,ke.MAIN))==null?void 0:t.gap)===!0)return;const l={label:"block-audio",execute:()=>{var c;const h=this.tracks.video;(this.lastVideoAppendEnd>i||h!=null&&h.buffer&&qe.isBuffered(h.buffer,i)||((c=this.fragmentTracker.getAppendedFrag(i,ke.MAIN))==null?void 0:c.gap)===!0)&&(this.blockedAudioAppend=null,this.shiftAndExecuteNext("audio"))},onStart:()=>{},onComplete:()=>{},onError:c=>{this.warn("Error executing block-audio operation",c)}};this.blockedAudioAppend={op:l,frag:e},this.append(l,"audio",!0)}unblockAudio(){const{blockedAudioAppend:e,operationQueue:t}=this;e&&t&&(this.blockedAudioAppend=null,t.unblockAudio(e.op))}onBufferAppending(e,t){const{tracks:s}=this,{data:i,type:r,parent:l,frag:c,part:h,chunkMeta:u,offset:f}=t,g=u.buffering[r],{sn:y,cc:x}=c,S=self.performance.now();g.start=S;const E=c.stats.buffering,T=h?h.stats.buffering:null;E.start===0&&(E.start=S),T&&T.start===0&&(T.start=S);const A=s.audio;let _=!1;r==="audio"&&A?.container==="audio/mpeg"&&(_=!this.lastMpegAudioChunk||u.id===1||this.lastMpegAudioChunk.sn!==u.sn,this.lastMpegAudioChunk=u);const I=s.video,C=I?.buffer;if(C&&y!=="initSegment"){const k=h||c,B=this.blockedAudioAppend;if(r==="audio"&&l!=="main"&&!this.blockedAudioAppend&&!(I.ending||I.ended)){const U=k.start+k.duration*.05,K=C.buffered,H=this.currentOp("video");!K.length&&!H?this.blockAudio(k):!H&&!qe.isBuffered(C,U)&&this.lastVideoAppendEnd<U&&this.blockAudio(k)}else if(r==="video"){const j=k.end;if(B){const U=B.frag.start;(j>U||j<this.lastVideoAppendEnd||qe.isBuffered(C,U))&&this.unblockAudio()}this.lastVideoAppendEnd=j}}const N=(h||c).start,D={label:`append-${r}`,execute:()=>{var k;g.executeStart=self.performance.now();const B=(k=this.tracks[r])==null?void 0:k.buffer;B&&(_?this.updateTimestampOffset(B,N,.1,r,y,x):f!==void 0&&Ne(f)&&this.updateTimestampOffset(B,f,1e-6,r,y,x)),this.appendExecutor(i,r)},onStart:()=>{},onComplete:()=>{const k=self.performance.now();g.executeEnd=g.end=k,E.first===0&&(E.first=k),T&&T.first===0&&(T.first=k);const B={};this.sourceBuffers.forEach(([j,U])=>{j&&(B[j]=qe.getBuffered(U))}),this.appendErrors[r]=0,r==="audio"||r==="video"?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(L.BUFFER_APPENDED,{type:r,frag:c,part:h,chunkMeta:u,parent:c.type,timeRanges:B})},onError:k=>{var B;const j={type:Be.MEDIA_ERROR,parent:c.type,details:Q.BUFFER_APPEND_ERROR,sourceBufferName:r,frag:c,part:h,chunkMeta:u,error:k,err:k,fatal:!1},U=(B=this.media)==null?void 0:B.error;if(k.code===DOMException.QUOTA_EXCEEDED_ERR||k.name=="QuotaExceededError"||"quota"in k)j.details=Q.BUFFER_FULL_ERROR;else if(k.code===DOMException.INVALID_STATE_ERR&&this.mediaSourceOpenOrEnded&&!U)j.errorAction=jr(!0);else if(k.name===_b&&this.sourceBufferCount===0)j.errorAction=jr(!0);else{const K=++this.appendErrors[r];this.warn(`Failed ${K}/${this.hls.config.appendErrorMaxRetry} times to append segment in "${r}" sourceBuffer (${U||"no media error"})`),(K>=this.hls.config.appendErrorMaxRetry||U)&&(j.fatal=!0)}this.hls.trigger(L.ERROR,j)}};this.log(`queuing "${r}" append sn: ${y}${h?" p: "+h.index:""} of ${c.type===ke.MAIN?"level":"track"} ${c.level} cc: ${x}`),this.append(D,r,this.isPending(this.tracks[r]))}getFlushOp(e,t,s){return this.log(`queuing "${e}" remove ${t}-${s}`),{label:"remove",execute:()=>{this.removeExecutor(e,t,s)},onStart:()=>{},onComplete:()=>{this.hls.trigger(L.BUFFER_FLUSHED,{type:e})},onError:i=>{this.warn(`Failed to remove ${t}-${s} from "${e}" SourceBuffer`,i)}}}onBufferFlushing(e,t){const{type:s,startOffset:i,endOffset:r}=t;s?this.append(this.getFlushOp(s,i,r),s):this.sourceBuffers.forEach(([l])=>{l&&this.append(this.getFlushOp(l,i,r),l)})}onFragParsed(e,t){const{frag:s,part:i}=t,r=[],l=i?i.elementaryStreams:s.elementaryStreams;l[Ut.AUDIOVIDEO]?r.push("audiovideo"):(l[Ut.AUDIO]&&r.push("audio"),l[Ut.VIDEO]&&r.push("video"));const c=()=>{const h=self.performance.now();s.stats.buffering.end=h,i&&(i.stats.buffering.end=h);const u=i?i.stats:s.stats;this.hls.trigger(L.FRAG_BUFFERED,{frag:s,part:i,stats:u,id:s.type})};r.length===0&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${s.type} level: ${s.level} sn: ${s.sn}`),this.blockBuffers(c,r).catch(h=>{this.warn(`Fragment buffered callback ${h}`),this.stepOperationQueue(this.sourceBufferTypes)})}onFragChanged(e,t){this.trimBuffers()}get bufferedToEnd(){return this.sourceBufferCount>0&&!this.sourceBuffers.some(([e])=>{if(e){const t=this.tracks[e];if(t)return!t.ended||t.ending}return!1})}onBufferEos(e,t){var s;this.sourceBuffers.forEach(([l])=>{if(l){const c=this.tracks[l];(!t.type||t.type===l)&&(c.ending=!0,c.ended||(c.ended=!0,this.log(`${l} buffer reached EOS`)))}});const i=((s=this.overrides)==null?void 0:s.endOfStream)!==!1;this.sourceBufferCount>0&&!this.sourceBuffers.some(([l])=>{var c;return l&&!((c=this.tracks[l])!=null&&c.ended)})?i?(this.log("Queueing EOS"),this.blockUntilOpen(()=>{this.tracksEnded();const{mediaSource:l}=this;if(!l||l.readyState!=="open"){l&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${l.readyState}`);return}this.log("Calling mediaSource.endOfStream()"),l.endOfStream(),this.hls.trigger(L.BUFFERED_TO_END,void 0)})):(this.tracksEnded(),this.hls.trigger(L.BUFFERED_TO_END,void 0)):t.type==="video"&&this.unblockAudio()}tracksEnded(){this.sourceBuffers.forEach(([e])=>{if(e!==null){const t=this.tracks[e];t&&(t.ending=!1)}})}onLevelUpdated(e,{details:t}){t.fragments.length&&(this.details=t,this.updateDuration())}updateDuration(){this.blockUntilOpen(()=>{const e=this.getDurationAndRange();e&&this.updateMediaSource(e)})}onError(e,t){if(t.details===Q.BUFFER_APPEND_ERROR&&t.frag){var s;const i=(s=t.errorAction)==null?void 0:s.nextAutoLevel;Ne(i)&&i!==t.frag.level&&this.resetAppendErrors()}}resetAppendErrors(){this.appendErrors={audio:0,video:0,audiovideo:0}}trimBuffers(){const{hls:e,details:t,media:s}=this;if(!s||t===null||!this.sourceBufferCount)return;const i=e.config,r=s.currentTime,l=t.levelTargetDuration,c=t.live&&i.liveBackBufferLength!==null?i.liveBackBufferLength:i.backBufferLength;if(Ne(c)&&c>=0){const u=Math.max(c,l),f=Math.floor(r/l)*l-u;this.flushBackBuffer(r,l,f)}const h=i.frontBufferFlushThreshold;if(Ne(h)&&h>0){const u=Math.max(i.maxBufferLength,h),f=Math.max(u,l),g=Math.floor(r/l)*l+f;this.flushFrontBuffer(r,l,g)}}flushBackBuffer(e,t,s){this.sourceBuffers.forEach(([i,r])=>{if(r){const c=qe.getBuffered(r);if(c.length>0&&s>c.start(0)){var l;this.hls.trigger(L.BACK_BUFFER_REACHED,{bufferEnd:s});const h=this.tracks[i];if((l=this.details)!=null&&l.live)this.hls.trigger(L.LIVE_BACK_BUFFER_REACHED,{bufferEnd:s});else if(h!=null&&h.ended){this.log(`Cannot flush ${i} back buffer while SourceBuffer is in ended state`);return}this.hls.trigger(L.BUFFER_FLUSHING,{startOffset:0,endOffset:s,type:i})}}})}flushFrontBuffer(e,t,s){this.sourceBuffers.forEach(([i,r])=>{if(r){const l=qe.getBuffered(r),c=l.length;if(c<2)return;const h=l.start(c-1),u=l.end(c-1);if(s>h||e>=h&&e<=u)return;this.hls.trigger(L.BUFFER_FLUSHING,{startOffset:h,endOffset:1/0,type:i})}})}getDurationAndRange(){var e;const{details:t,mediaSource:s}=this;if(!t||!this.media||s?.readyState!=="open")return null;const i=t.edge;if(t.live&&this.hls.config.liveDurationInfinity){if(t.fragments.length&&s.setLiveSeekableRange){const u=Math.max(0,t.fragmentStart),f=Math.max(u,i);return{duration:1/0,start:u,end:f}}return{duration:1/0}}const r=(e=this.overrides)==null?void 0:e.duration;if(r)return Ne(r)?{duration:r}:null;const l=this.media.duration,c=Ne(s.duration)?s.duration:0;return i>c&&i>l||!Ne(l)?{duration:i}:null}updateMediaSource({duration:e,start:t,end:s}){const i=this.mediaSource;!this.media||!i||i.readyState!=="open"||(i.duration!==e&&(Ne(e)&&this.log(`Updating MediaSource duration to ${e.toFixed(3)}`),i.duration=e),t!==void 0&&s!==void 0&&(this.log(`MediaSource duration is set to ${i.duration}. Setting seekable range to ${t}-${s}.`),i.setLiveSeekableRange(t,s)))}get tracksReady(){const e=this.pendingTrackCount;return e>0&&(e>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}checkPendingTracks(){const{bufferCodecEventsTotal:e,pendingTrackCount:t,tracks:s}=this;if(this.log(`checkPendingTracks (pending: ${t} codec events expected: ${e}) ${Mt(s)}`),this.tracksReady){var i;const r=(i=this.transferData)==null?void 0:i.tracks;r&&Object.keys(r).length?this.attachTransferred():this.createSourceBuffers()}}bufferCreated(){if(this.sourceBufferCount){const e={};this.sourceBuffers.forEach(([t,s])=>{if(t){const i=this.tracks[t];e[t]={buffer:s,container:i.container,codec:i.codec,supplemental:i.supplemental,levelCodec:i.levelCodec,id:i.id,metadata:i.metadata}}}),this.hls.trigger(L.BUFFER_CREATED,{tracks:e}),this.log(`SourceBuffers created. Running queue: ${this.operationQueue}`),this.sourceBuffers.forEach(([t])=>{this.executeNext(t)})}else{const e=new Error("could not create source buffer for media codec(s)");this.hls.trigger(L.ERROR,{type:Be.MEDIA_ERROR,details:Q.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:e,reason:e.message})}}createSourceBuffers(){const{tracks:e,sourceBuffers:t,mediaSource:s}=this;if(!s)throw new Error("createSourceBuffers called when mediaSource was null");for(const r in e){const l=r,c=e[l];if(this.isPending(c)){const h=this.getTrackCodec(c,l),u=`${c.container};codecs=${h}`;c.codec=h,this.log(`creating sourceBuffer(${u})${this.currentOp(l)?" Queued":""} ${Mt(c)}`);try{const f=s.addSourceBuffer(u),g=vf(l),y=[l,f];t[g]=y,c.buffer=f}catch(f){var i;this.error(`error while trying to add sourceBuffer: ${f.message}`),this.shiftAndExecuteNext(l),(i=this.operationQueue)==null||i.removeBlockers(),delete this.tracks[l],this.hls.trigger(L.ERROR,{type:Be.MEDIA_ERROR,details:Q.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:f,sourceBufferName:l,mimeType:u,parent:c.id});return}this.trackSourceBuffer(l,c)}}this.bufferCreated()}getTrackCodec(e,t){const s=e.supplemental;let i=e.codec;s&&(t==="video"||t==="audiovideo")&&Ql(s,"video")&&(i=j1(i,s));const r=tu(i,e.levelCodec);return r?t.slice(0,5)==="audio"?pu(r,this.appendSource):r:""}trackSourceBuffer(e,t){const s=t.buffer;if(!s)return;const i=this.getTrackCodec(t,e);this.tracks[e]={buffer:s,codec:i,container:t.container,levelCodec:t.levelCodec,supplemental:t.supplemental,metadata:t.metadata,id:t.id,listeners:[]},this.removeBufferListeners(e),this.addBufferListener(e,"updatestart",this.onSBUpdateStart),this.addBufferListener(e,"updateend",this.onSBUpdateEnd),this.addBufferListener(e,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(e,"bufferedchange",(r,l)=>{const c=l.removedRanges;c!=null&&c.length&&this.hls.trigger(L.BUFFER_FLUSHED,{type:r})})}get mediaSrc(){var e,t;const s=((e=this.media)==null||(t=e.querySelector)==null?void 0:t.call(e,"source"))||this.media;return s?.src}onSBUpdateStart(e){const t=this.currentOp(e);t&&t.onStart()}onSBUpdateEnd(e){var t;if(((t=this.mediaSource)==null?void 0:t.readyState)==="closed"){this.resetBuffer(e);return}const s=this.currentOp(e);s&&(s.onComplete(),this.shiftAndExecuteNext(e))}onSBUpdateError(e,t){var s;const i=new Error(`${e} SourceBuffer error. MediaSource readyState: ${(s=this.mediaSource)==null?void 0:s.readyState}`);this.error(`${i}`,t),this.hls.trigger(L.ERROR,{type:Be.MEDIA_ERROR,details:Q.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:i,fatal:!1});const r=this.currentOp(e);r&&r.onError(i)}updateTimestampOffset(e,t,s,i,r,l){const c=t-e.timestampOffset;Math.abs(c)>=s&&(this.log(`Updating ${i} SourceBuffer timestampOffset to ${t} (sn: ${r} cc: ${l})`),e.timestampOffset=t)}removeExecutor(e,t,s){const{media:i,mediaSource:r}=this,l=this.tracks[e],c=l?.buffer;if(!i||!r||!c){this.warn(`Attempting to remove from the ${e} SourceBuffer, but it does not exist`),this.shiftAndExecuteNext(e);return}const h=Ne(i.duration)?i.duration:1/0,u=Ne(r.duration)?r.duration:1/0,f=Math.max(0,t),g=Math.min(s,h,u);g>f&&(!l.ending||l.ended)?(l.ended=!1,this.log(`Removing [${f},${g}] from the ${e} SourceBuffer`),c.remove(f,g)):this.shiftAndExecuteNext(e)}appendExecutor(e,t){const s=this.tracks[t],i=s?.buffer;if(!i)throw new YC(`Attempting to append to the ${t} SourceBuffer, but it does not exist`);s.ending=!1,s.ended=!1,i.appendBuffer(e)}blockUntilOpen(e){if(this.isUpdating()||this.isQueued())this.blockBuffers(e).catch(t=>{this.warn(`SourceBuffer blocked callback ${t}`),this.stepOperationQueue(this.sourceBufferTypes)});else try{e()}catch(t){this.warn(`Callback run without blocking ${this.operationQueue} ${t}`)}}isUpdating(){return this.sourceBuffers.some(([e,t])=>e&&t.updating)}isQueued(){return this.sourceBuffers.some(([e])=>e&&!!this.currentOp(e))}isPending(e){return!!e&&!e.buffer}blockBuffers(e,t=this.sourceBufferTypes){if(!t.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);const{operationQueue:s}=this,i=t.map(l=>this.appendBlocker(l));return t.length>1&&this.blockedAudioAppend&&this.unblockAudio(),Promise.all(i).then(l=>{s===this.operationQueue&&(e(),this.stepOperationQueue(this.sourceBufferTypes))})}stepOperationQueue(e){e.forEach(t=>{var s;const i=(s=this.tracks[t])==null?void 0:s.buffer;!i||i.updating||this.shiftAndExecuteNext(t)})}append(e,t,s){this.operationQueue&&this.operationQueue.append(e,t,s)}appendBlocker(e){if(this.operationQueue)return this.operationQueue.appendBlocker(e)}currentOp(e){return this.operationQueue?this.operationQueue.current(e):null}executeNext(e){e&&this.operationQueue&&this.operationQueue.executeNext(e)}shiftAndExecuteNext(e){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(e)}get pendingTrackCount(){return Object.keys(this.tracks).reduce((e,t)=>e+(this.isPending(this.tracks[t])?1:0),0)}get sourceBufferCount(){return this.sourceBuffers.reduce((e,[t])=>e+(t?1:0),0)}get sourceBufferTypes(){return this.sourceBuffers.map(([e])=>e).filter(e=>!!e)}addBufferListener(e,t,s){const i=this.tracks[e];if(!i)return;const r=i.buffer;if(!r)return;const l=s.bind(this,e);i.listeners.push({event:t,listener:l}),r.addEventListener(t,l)}removeBufferListeners(e){const t=this.tracks[e];if(!t)return;const s=t.buffer;s&&(t.listeners.forEach(i=>{s.removeEventListener(i.event,i.listener)}),t.listeners.length=0)}}function rx(n){const e=n.querySelectorAll("source");[].slice.call(e).forEach(t=>{n.removeChild(t)})}function QC(n,e){const t=self.document.createElement("source");t.type="video/mp4",t.src=e,n.appendChild(t)}function vf(n){return n==="audio"?1:0}class Um{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(L.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(L.MANIFEST_PARSED,this.onManifestParsed,this),e.on(L.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(L.BUFFER_CODECS,this.onBufferCodecs,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(L.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(L.MANIFEST_PARSED,this.onManifestParsed,this),e.off(L.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(L.BUFFER_CODECS,this.onBufferCodecs,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){const s=this.hls.levels[t.droppedLevel];this.isLevelAllowed(s)&&this.restrictedLevels.push({bitrate:s.bitrate,height:s.height,width:s.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,t){const s=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,s.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onLevelsUpdated(e,t){this.timer&&Ne(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping(),this.media=null}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}const e=this.hls.levels;if(e.length){const t=this.hls,s=this.getMaxLevel(e.length-1);s!==this.autoLevelCapping&&t.logger.log(`Setting autoLevelCapping to ${s}: ${e[s].height}p@${e[s].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),t.autoLevelCapping=s,t.autoLevelEnabled&&t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){const t=this.hls.levels;if(!t.length)return-1;const s=t.filter((i,r)=>this.isLevelAllowed(i)&&r<=e);return this.clientRect=null,Um.getMaxLevelByMediaSize(s,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,t={width:0,height:0};if(e){const s=e.getBoundingClientRect();t.width=s.width,t.height=s.height,!t.width&&!t.height&&(t.width=s.right-s.left||e.width||0,t.height=s.bottom-s.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch{}return Math.min(e,this.hls.config.maxDevicePixelRatio)}isLevelAllowed(e){return!this.restrictedLevels.some(s=>e.bitrate===s.bitrate&&e.width===s.width&&e.height===s.height)}static getMaxLevelByMediaSize(e,t,s){if(!(e!=null&&e.length))return-1;const i=(c,h)=>h?c.width!==h.width||c.height!==h.height:!0;let r=e.length-1;const l=Math.max(t,s);for(let c=0;c<e.length;c+=1){const h=e[c];if((h.width>=l||h.height>=l)&&i(h,e[c+1])){r=c;break}}return r}}const WC={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"},Zs=WC,XC={HLS:"h"},ZC=XC;class dn{constructor(e,t){Array.isArray(e)&&(e=e.map(s=>s instanceof dn?s:new dn(s))),this.value=e,this.params=t}}const JC="Dict";function eN(n){return Array.isArray(n)?JSON.stringify(n):n instanceof Map?"Map{}":n instanceof Set?"Set{}":typeof n=="object"?JSON.stringify(n):String(n)}function tN(n,e,t,s){return new Error(`failed to ${n} "${eN(e)}" as ${t}`,{cause:s})}function hn(n,e,t){return tN("serialize",n,e,t)}class Rb{constructor(e){this.description=e}}const lx="Bare Item",sN="Boolean";function iN(n){if(typeof n!="boolean")throw hn(n,sN);return n?"?1":"?0"}function nN(n){return btoa(String.fromCharCode(...n))}const aN="Byte Sequence";function rN(n){if(ArrayBuffer.isView(n)===!1)throw hn(n,aN);return`:${nN(n)}:`}const lN="Integer";function oN(n){return n<-999999999999999||999999999999999<n}function Lb(n){if(oN(n))throw hn(n,lN);return n.toString()}function cN(n){return`@${Lb(n.getTime()/1e3)}`}function wb(n,e){if(n<0)return-wb(-n,e);const t=Math.pow(10,e);if(Math.abs(n*t%1-.5)<Number.EPSILON){const i=Math.floor(n*t);return(i%2===0?i:i+1)/t}else return Math.round(n*t)/t}const uN="Decimal";function dN(n){const e=wb(n,3);if(Math.floor(Math.abs(e)).toString().length>12)throw hn(n,uN);const t=e.toString();return t.includes(".")?t:`${t}.0`}const hN="String",fN=/[\x00-\x1f\x7f]+/;function mN(n){if(fN.test(n))throw hn(n,hN);return`"${n.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}function pN(n){return n.description||n.toString().slice(7,-1)}const gN="Token";function ox(n){const e=pN(n);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(e)===!1)throw hn(e,gN);return e}function Wf(n){switch(typeof n){case"number":if(!Ne(n))throw hn(n,lx);return Number.isInteger(n)?Lb(n):dN(n);case"string":return mN(n);case"symbol":return ox(n);case"boolean":return iN(n);case"object":if(n instanceof Date)return cN(n);if(n instanceof Uint8Array)return rN(n);if(n instanceof Rb)return ox(n);default:throw hn(n,lx)}}const yN="Key";function Xf(n){if(/^[a-z*][a-z0-9\-_.*]*$/.test(n)===!1)throw hn(n,yN);return n}function Mm(n){return n==null?"":Object.entries(n).map(([e,t])=>t===!0?`;${Xf(e)}`:`;${Xf(e)}=${Wf(t)}`).join("")}function Cb(n){return n instanceof dn?`${Wf(n.value)}${Mm(n.params)}`:Wf(n)}function vN(n){return`(${n.value.map(Cb).join(" ")})${Mm(n.params)}`}function xN(n,e={whitespace:!0}){if(typeof n!="object"||n==null)throw hn(n,JC);const t=n instanceof Map?n.entries():Object.entries(n),s=e?.whitespace?" ":"";return Array.from(t).map(([i,r])=>{r instanceof dn||(r=new dn(r));let l=Xf(i);return r.value===!0?l+=Mm(r.params):(l+="=",Array.isArray(r.value)?l+=vN(r):l+=Cb(r)),l}).join(`,${s}`)}function Nb(n,e){return xN(n,e)}const rn="CMCD-Object",Xt="CMCD-Request",$a="CMCD-Session",va="CMCD-Status",SN={br:rn,ab:rn,d:rn,ot:rn,tb:rn,tpb:rn,lb:rn,tab:rn,lab:rn,url:rn,pb:Xt,bl:Xt,tbl:Xt,dl:Xt,ltc:Xt,mtp:Xt,nor:Xt,nrr:Xt,rc:Xt,sn:Xt,sta:Xt,su:Xt,ttfb:Xt,ttfbb:Xt,ttlb:Xt,cmsdd:Xt,cmsds:Xt,smrt:Xt,df:Xt,cs:Xt,ts:Xt,cid:$a,pr:$a,sf:$a,sid:$a,st:$a,v:$a,msd:$a,bs:va,bsd:va,cdn:va,rtp:va,bg:va,pt:va,ec:va,e:va},bN={REQUEST:Xt};function TN(n){return Object.keys(n).reduce((e,t)=>{var s;return(s=n[t])===null||s===void 0||s.forEach(i=>e[i]=t),e},{})}function EN(n,e){const t={};if(!n)return t;const s=Object.keys(n),i=e?TN(e):{};return s.reduce((r,l)=>{var c;const h=SN[l]||i[l]||bN.REQUEST,u=(c=r[h])!==null&&c!==void 0?c:r[h]={};return u[l]=n[l],r},t)}function AN(n){return["ot","sf","st","e","sta"].includes(n)}function IN(n){return typeof n=="number"?Ne(n):n!=null&&n!==""&&n!==!1}const Ob="event";function _N(n,e){const t=new URL(n),s=new URL(e);if(t.origin!==s.origin)return n;const i=t.pathname.split("/").slice(1),r=s.pathname.split("/").slice(1,-1);for(;i[0]===r[0];)i.shift(),r.shift();for(;r.length;)r.shift(),i.unshift("..");return i.join("/")+t.search+t.hash}const ru=n=>Math.round(n),Zf=(n,e)=>Array.isArray(n)?n.map(t=>Zf(t,e)):n instanceof dn&&typeof n.value=="string"?new dn(Zf(n.value,e),n.params):(e.baseUrl&&(n=_N(n,e.baseUrl)),e.version===1?encodeURIComponent(n):n),$c=n=>ru(n/100)*100,RN=(n,e)=>{let t=n;return e.version>=2&&(n instanceof dn&&typeof n.value=="string"?t=new dn([n]):typeof n=="string"&&(t=[n])),Zf(t,e)},LN={br:ru,d:ru,bl:$c,dl:$c,mtp:$c,nor:RN,rtp:$c,tb:ru},kb="request",Db="response",jm=["ab","bg","bl","br","bs","bsd","cdn","cid","cs","df","ec","lab","lb","ltc","msd","mtp","pb","pr","pt","sf","sid","sn","st","sta","tab","tb","tbl","tpb","ts","v"],wN=["e"],CN=/^[a-zA-Z0-9-.]+-[a-zA-Z0-9-.]+$/;function Mu(n){return CN.test(n)}function NN(n){return jm.includes(n)||wN.includes(n)||Mu(n)}const Pb=["d","dl","nor","ot","rtp","su"];function ON(n){return jm.includes(n)||Pb.includes(n)||Mu(n)}const kN=["cmsdd","cmsds","rc","smrt","ttfb","ttfbb","ttlb","url"];function DN(n){return jm.includes(n)||Pb.includes(n)||kN.includes(n)||Mu(n)}const PN=["bl","br","bs","cid","d","dl","mtp","nor","nrr","ot","pr","rtp","sf","sid","st","su","tb","v"];function UN(n){return PN.includes(n)||Mu(n)}const MN={[Db]:DN,[Ob]:NN,[kb]:ON};function Ub(n,e={}){const t={};if(n==null||typeof n!="object")return t;const s=e.version||n.v||1,i=e.reportingMode||kb,r=s===1?UN:MN[i];let l=Object.keys(n).filter(r);const c=e.filter;typeof c=="function"&&(l=l.filter(c));const h=i===Db||i===Ob;h&&!l.includes("ts")&&l.push("ts"),s>1&&!l.includes("v")&&l.push("v");const u=Dt({},LN,e.formatters),f={version:s,reportingMode:i,baseUrl:e.baseUrl};return l.sort().forEach(g=>{let y=n[g];const x=u[g];if(typeof x=="function"&&(y=x(y,f)),g==="v"){if(s===1)return;y=s}g=="pr"&&y===1||(h&&g==="ts"&&!Ne(y)&&(y=Date.now()),IN(y)&&(AN(g)&&typeof y=="string"&&(y=new Rb(y)),t[g]=y))}),t}function jN(n,e={}){const t={};if(!n)return t;const s=Ub(n,e),i=EN(s,e?.customHeaderMap);return Object.entries(i).reduce((r,[l,c])=>{const h=Nb(c,{whitespace:!1});return h&&(r[l]=h),r},t)}function BN(n,e,t){return Dt(n,jN(e,t))}const FN="CMCD";function VN(n,e={}){return n?Nb(Ub(n,e),{whitespace:!1}):""}function $N(n,e={}){if(!n)return"";const t=VN(n,e);return encodeURIComponent(t)}function GN(n,e={}){if(!n)return"";const t=$N(n,e);return`${FN}=${t}`}const cx=/CMCD=[^&#]+/;function HN(n,e,t){const s=GN(e,t);if(!s)return n;if(cx.test(n))return n.replace(cx,s);const i=n.includes("?")?"&":"?";return`${n}${i}${s}`}class zN{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=i=>{try{this.apply(i,{ot:Zs.MANIFEST,su:!this.initialized})}catch(r){this.hls.logger.warn("Could not generate manifest CMCD data.",r)}},this.applyFragmentData=i=>{try{const{frag:r,part:l}=i,c=this.hls.levels[r.level],h=this.getObjectType(r),u={d:(l||r).duration*1e3,ot:h};(h===Zs.VIDEO||h===Zs.AUDIO||h==Zs.MUXED)&&(u.br=c.bitrate/1e3,u.tb=this.getTopBandwidth(h)/1e3,u.bl=this.getBufferLength(h));const f=l?this.getNextPart(l):this.getNextFrag(r);f!=null&&f.url&&f.url!==r.url&&(u.nor=f.url),this.apply(i,u)}catch(r){this.hls.logger.warn("Could not generate segment CMCD data.",r)}},this.hls=e;const t=this.config=e.config,{cmcd:s}=t;s!=null&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=s.sessionId||e.sessionId,this.cid=s.contentId,this.useHeaders=s.useHeaders===!0,this.includeKeys=s.includeKeys,this.registerListeners())}registerListeners(){const e=this.hls;e.on(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(L.MEDIA_DETACHED,this.onMediaDetached,this),e.on(L.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(L.MEDIA_DETACHED,this.onMediaDetached,this),e.off(L.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var s,i;this.audioBuffer=(s=t.tracks.audio)==null?void 0:s.buffer,this.videoBuffer=(i=t.tracks.video)==null?void 0:i.buffer}createData(){var e;return{v:1,sf:ZC.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)==null?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){Dt(t,this.createData());const s=t.ot===Zs.INIT||t.ot===Zs.VIDEO||t.ot===Zs.MUXED;this.starved&&s&&(t.bs=!0,t.su=!0,this.starved=!1),t.su==null&&(t.su=this.buffering);const{includeKeys:i}=this;i&&(t=Object.keys(t).reduce((l,c)=>(i.includes(c)&&(l[c]=t[c]),l),{}));const r={baseUrl:e.url};this.useHeaders?(e.headers||(e.headers={}),BN(e.headers,t,r)):e.url=HN(e.url,t,r)}getNextFrag(e){var t;const s=(t=this.hls.levels[e.level])==null?void 0:t.details;if(s){const i=e.sn-s.startSN;return s.fragments[i+1]}}getNextPart(e){var t;const{index:s,fragment:i}=e,r=(t=this.hls.levels[i.level])==null||(t=t.details)==null?void 0:t.partList;if(r){const{sn:l}=i;for(let c=r.length-1;c>=0;c--){const h=r[c];if(h.index===s&&h.fragment.sn===l)return r[c+1]}}}getObjectType(e){const{type:t}=e;if(t==="subtitle")return Zs.TIMED_TEXT;if(e.sn==="initSegment")return Zs.INIT;if(t==="audio")return Zs.AUDIO;if(t==="main")return this.hls.audioTracks.length?Zs.VIDEO:Zs.MUXED}getTopBandwidth(e){let t=0,s;const i=this.hls;if(e===Zs.AUDIO)s=i.audioTracks;else{const r=i.maxAutoLevel,l=r>-1?r+1:i.levels.length;s=i.levels.slice(0,l)}return s.forEach(r=>{r.bitrate>t&&(t=r.bitrate)}),t>0?t:NaN}getBufferLength(e){const t=this.media,s=e===Zs.AUDIO?this.audioBuffer:this.videoBuffer;return!s||!t?NaN:qe.bufferInfo(s,t.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){const{pLoader:e}=this.config,t=this.applyPlaylistData,s=e||this.config.loader;return class{constructor(r){this.loader=void 0,this.loader=new s(r)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(r,l,c){t(r),this.loader.load(r,l,c)}}}createFragmentLoader(){const{fLoader:e}=this.config,t=this.applyFragmentData,s=e||this.config.loader;return class{constructor(r){this.loader=void 0,this.loader=new s(r)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(r,l,c){t(r),this.loader.load(r,l,c)}}}}const KN=3e5;class YN extends ji{constructor(e){super("content-steering",e.logger),this.hls=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this._pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(L.MANIFEST_PARSED,this.onManifestParsed,this),e.on(L.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(L.MANIFEST_PARSED,this.onManifestParsed,this),e.off(L.ERROR,this.onError,this))}pathways(){return(this.levels||[]).reduce((e,t)=>(e.indexOf(t.pathwayId)===-1&&e.push(t.pathwayId),e),[])}get pathwayPriority(){return this._pathwayPriority}set pathwayPriority(e){this.updatePathwayPriority(e)}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const e=this.timeToLoad*1e3-(performance.now()-this.updated);if(e>0){this.scheduleRefresh(this.uri,e);return}}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const t=this.levels;t&&(this.levels=t.filter(s=>s!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){const{contentSteering:s}=t;s!==null&&(this.pathwayId=s.pathwayId,this.uri=s.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){const{errorAction:s}=t;if(s?.action===As.SendAlternateToPenaltyBox&&s.flags===mi.MoveAllAlternatesMatchingHost){const i=this.levels;let r=this._pathwayPriority,l=this.pathwayId;if(t.context){const{groupId:c,pathwayId:h,type:u}=t.context;c&&i?l=this.getPathwayForGroupId(c,u,l):h&&(l=h)}l in this.penalizedPathways||(this.penalizedPathways[l]=performance.now()),!r&&i&&(r=this.pathways()),r&&r.length>1&&(this.updatePathwayPriority(r),s.resolved=this.pathwayId!==l),t.details===Q.BUFFER_APPEND_ERROR&&!t.fatal?s.resolved=!0:s.resolved||this.warn(`Could not resolve ${t.details} ("${t.error.message}") with content-steering for Pathway: ${l} levels: ${i&&i.length} priorities: ${Mt(r)} penalized: ${Mt(this.penalizedPathways)}`)}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(t.length===0){const s=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${s}"`),t=this.getLevelsForPathway(s),this.pathwayId=s}return t.length!==e.length&&this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t}getLevelsForPathway(e){return this.levels===null?[]:this.levels.filter(t=>e===t.pathwayId)}updatePathwayPriority(e){this._pathwayPriority=e;let t;const s=this.penalizedPathways,i=performance.now();Object.keys(s).forEach(r=>{i-s[r]>KN&&delete s[r]});for(let r=0;r<e.length;r++){const l=e[r];if(l in s)continue;if(l===this.pathwayId)return;const c=this.hls.nextLoadLevel,h=this.hls.levels[c];if(t=this.getLevelsForPathway(l),t.length>0){this.log(`Setting Pathway to "${l}"`),this.pathwayId=l,sb(t),this.hls.trigger(L.LEVELS_UPDATED,{levels:t});const u=this.hls.levels[c];h&&u&&this.levels&&(u.attrs["STABLE-VARIANT-ID"]!==h.attrs["STABLE-VARIANT-ID"]&&u.bitrate!==h.bitrate&&this.log(`Unstable Pathways change from bitrate ${h.bitrate} to ${u.bitrate}`),this.hls.nextLoadLevel=c);break}}}getPathwayForGroupId(e,t,s){const i=this.getLevelsForPathway(s).concat(this.levels||[]);for(let r=0;r<i.length;r++)if(t===at.AUDIO_TRACK&&i[r].hasAudioGroup(e)||t===at.SUBTITLE_TRACK&&i[r].hasSubtitleGroup(e))return i[r].pathwayId;return s}clonePathways(e){const t=this.levels;if(!t)return;const s={},i={};e.forEach(r=>{const{ID:l,"BASE-ID":c,"URI-REPLACEMENT":h}=r;if(t.some(f=>f.pathwayId===l))return;const u=this.getLevelsForPathway(c).map(f=>{const g=new Yt(f.attrs);g["PATHWAY-ID"]=l;const y=g.AUDIO&&`${g.AUDIO}_clone_${l}`,x=g.SUBTITLES&&`${g.SUBTITLES}_clone_${l}`;y&&(s[g.AUDIO]=y,g.AUDIO=y),x&&(i[g.SUBTITLES]=x,g.SUBTITLES=x);const S=Mb(f.uri,g["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",h),E=new Xl({attrs:g,audioCodec:f.audioCodec,bitrate:f.bitrate,height:f.height,name:f.name,url:S,videoCodec:f.videoCodec,width:f.width});if(f.audioGroups)for(let T=1;T<f.audioGroups.length;T++)E.addGroupId("audio",`${f.audioGroups[T]}_clone_${l}`);if(f.subtitleGroups)for(let T=1;T<f.subtitleGroups.length;T++)E.addGroupId("text",`${f.subtitleGroups[T]}_clone_${l}`);return E});t.push(...u),ux(this.audioTracks,s,h,l),ux(this.subtitleTracks,i,h,l)})}loadSteeringManifest(e){const t=this.hls.config,s=t.loader;this.loader&&this.loader.destroy(),this.loader=new s(t);let i;try{i=new self.URL(e)}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${e}`);return}if(i.protocol!=="data:"){const f=(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate)|0;i.searchParams.set("_HLS_pathway",this.pathwayId),i.searchParams.set("_HLS_throughput",""+f)}const r={responseType:"json",url:i.href},l=t.steeringManifestLoadPolicy.default,c=l.errorRetry||l.timeoutRetry||{},h={loadPolicy:l,timeout:l.maxLoadTimeMs,maxRetry:c.maxNumRetry||0,retryDelay:c.retryDelayMs||0,maxRetryDelay:c.maxRetryDelayMs||0},u={onSuccess:(f,g,y,x)=>{this.log(`Loaded steering manifest: "${i}"`);const S=f.data;if(S?.VERSION!==1){this.log(`Steering VERSION ${S.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=S.TTL;const{"RELOAD-URI":E,"PATHWAY-CLONES":T,"PATHWAY-PRIORITY":A}=S;if(E)try{this.uri=new self.URL(E,i).href}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${E}`);return}this.scheduleRefresh(this.uri||y.url),T&&this.clonePathways(T);const _={steeringManifest:S,url:i.toString()};this.hls.trigger(L.STEERING_MANIFEST_LOADED,_),A&&this.updatePathwayPriority(A)},onError:(f,g,y,x)=>{if(this.log(`Error loading steering manifest: ${f.code} ${f.text} (${g.url})`),this.stopLoad(),f.code===410){this.enabled=!1,this.log(`Steering manifest ${g.url} no longer available`);return}let S=this.timeToLoad*1e3;if(f.code===429){const E=this.loader;if(typeof E?.getResponseHeader=="function"){const T=E.getResponseHeader("Retry-After");T&&(S=parseFloat(T)*1e3)}this.log(`Steering manifest ${g.url} rate limited`);return}this.scheduleRefresh(this.uri||g.url,S)},onTimeout:(f,g,y)=>{this.log(`Timeout loading steering manifest (${g.url})`),this.scheduleRefresh(this.uri||g.url)}};this.log(`Requesting steering manifest: ${i}`),this.loader.load(r,h,u)}scheduleRefresh(e,t=this.timeToLoad*1e3){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var s;const i=(s=this.hls)==null?void 0:s.media;if(i&&!i.ended){this.loadSteeringManifest(e);return}this.scheduleRefresh(e,this.timeToLoad*1e3)},t)}}function ux(n,e,t,s){n&&Object.keys(e).forEach(i=>{const r=n.filter(l=>l.groupId===i).map(l=>{const c=Dt({},l);return c.details=void 0,c.attrs=new Yt(c.attrs),c.url=c.attrs.URI=Mb(l.url,l.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",t),c.groupId=c.attrs["GROUP-ID"]=e[i],c.attrs["PATHWAY-ID"]=s,c});n.push(...r)})}function Mb(n,e,t,s){const{HOST:i,PARAMS:r,[t]:l}=s;let c;e&&(c=l?.[e],c&&(n=c));const h=new self.URL(n);return i&&!c&&(h.host=i),r&&Object.keys(r).sort().forEach(u=>{u&&h.searchParams.set(u,r[u])}),h.href}class Fr extends ji{constructor(e){super("eme",e.logger),this.hls=void 0,this.config=void 0,this.media=null,this.mediaResolved=void 0,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.mediaKeys=null,this.setMediaKeysQueue=Fr.CDMCleanupPromise?[Fr.CDMCleanupPromise]:[],this.bannedKeyIds={},this.onMediaEncrypted=t=>{const{initDataType:s,initData:i}=t,r=`"${t.type}" event: init data type: "${s}"`;if(this.debug(r),i!==null){if(!this.keyFormatPromise){let l=Object.keys(this.keySystemAccessPromises);l.length||(l=Hl(this.config));const c=l.map(uf).filter(h=>!!h);this.keyFormatPromise=this.getKeyFormatPromise(c)}this.keyFormatPromise.then(l=>{const c=iu(l);if(s!=="sinf"||c!==qt.FAIRPLAY){this.log(`Ignoring "${t.type}" event with init data type: "${s}" for selected key-system ${c}`);return}let h;try{const x=hs(new Uint8Array(i)),S=_m(JSON.parse(x).sinf),E=NS(S);if(!E)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");h=new Uint8Array(E.subarray(8,24))}catch(x){this.warn(`${r} Failed to parse sinf: ${x}`);return}const u=Is(h),{keyIdToKeySessionPromise:f,mediaKeySessions:g}=this;let y=f[u];for(let x=0;x<g.length;x++){const S=g[x],E=S.decryptdata;if(!E.keyId)continue;const T=Is(E.keyId);if(Su(h,E.keyId)||E.uri.replace(/-/g,"").indexOf(u)!==-1){if(y=f[T],!y)continue;if(E.pssh)break;delete f[T],E.pssh=new Uint8Array(i),E.keyId=h,y=f[u]=y.then(()=>this.generateRequestWithPreferredKeySession(S,s,i,"encrypted-event-key-match")),y.catch(A=>this.handleError(A));break}}y||this.handleError(new Error(`Key ID ${u} not encountered in playlist. Key-system sessions ${g.length}.`))}).catch(l=>this.handleError(l))}},this.onWaitingForKey=t=>{this.log(`"${t.type}" event`)},this.hls=e,this.config=e.config,this.registerListeners()}destroy(){this.onDestroying(),this.onMediaDetached();const e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onMediaEncrypted=this.onWaitingForKey=null}registerListeners(){this.hls.on(L.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(L.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(L.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(L.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.on(L.DESTROYING,this.onDestroying,this)}unregisterListeners(){this.hls.off(L.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(L.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(L.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(L.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.off(L.DESTROYING,this.onDestroying,this)}getLicenseServerUrl(e){const{drmSystems:t,widevineLicenseUrl:s}=this.config,i=t?.[e];if(i)return i.licenseUrl;if(e===qt.WIDEVINE&&s)return s}getLicenseServerUrlOrThrow(e){const t=this.getLicenseServerUrl(e);if(t===void 0)throw new Error(`no license server URL configured for key-system "${e}"`);return t}getServerCertificateUrl(e){const{drmSystems:t}=this.config,s=t?.[e];if(s)return s.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){const t=this.hls.levels,s=(l,c,h)=>!!l&&h.indexOf(l)===c,i=t.map(l=>l.audioCodec).filter(s),r=t.map(l=>l.videoCodec).filter(s);return i.length+r.length===0&&r.push("avc1.42e01e"),new Promise((l,c)=>{const h=u=>{const f=u.shift();this.getMediaKeysPromise(f,i,r).then(g=>l({keySystem:f,mediaKeys:g})).catch(g=>{u.length?h(u):g instanceof fi?c(g):c(new fi({type:Be.KEY_SYSTEM_ERROR,details:Q.KEY_SYSTEM_NO_ACCESS,error:g,fatal:!0},g.message))})};h(e)})}requestMediaKeySystemAccess(e,t){const{requestMediaKeySystemAccessFunc:s}=this.config;if(typeof s!="function"){let i=`Configured requestMediaKeySystemAccess is not a function ${s}`;return qS===null&&self.location.protocol==="http:"&&(i=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(i))}return s(e,t)}getMediaKeysPromise(e,t,s){var i;const r=Rw(e,t,s,this.config.drmSystemOptions||{});let l=this.keySystemAccessPromises[e],c=(i=l)==null?void 0:i.keySystemAccess;if(!c){this.log(`Requesting encrypted media "${e}" key-system access with config: ${Mt(r)}`),c=this.requestMediaKeySystemAccess(e,r);const h=l=this.keySystemAccessPromises[e]={keySystemAccess:c};return c.catch(u=>{this.log(`Failed to obtain access to key-system "${e}": ${u}`)}),c.then(u=>{this.log(`Access for key-system "${u.keySystem}" obtained`);const f=this.fetchServerCertificate(e);this.log(`Create media-keys for "${e}"`);const g=h.mediaKeys=u.createMediaKeys().then(y=>(this.log(`Media-keys created for "${e}"`),h.hasMediaKeys=!0,f.then(x=>x?this.setMediaKeysServerCertificate(y,e,x):y)));return g.catch(y=>{this.error(`Failed to create media-keys for "${e}"}: ${y}`)}),g})}return c.then(()=>l.mediaKeys)}createMediaKeySessionContext({decryptdata:e,keySystem:t,mediaKeys:s}){this.log(`Creating key-system session "${t}" keyId: ${Is(e.keyId||[])} keyUri: ${e.uri}`);const i=s.createSession(),r={decryptdata:e,keySystem:t,mediaKeys:s,mediaKeysSession:i,keyStatus:"status-pending"};return this.mediaKeySessions.push(r),r}renewKeySession(e){const t=e.decryptdata;if(t.pssh){const s=this.createMediaKeySessionContext(e),i=Gc(t),r="cenc";this.keyIdToKeySessionPromise[i]=this.generateRequestWithPreferredKeySession(s,r,t.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}updateKeySession(e,t){const s=e.mediaKeysSession;return this.log(`Updating key-session "${s.sessionId}" for keyId ${Is(e.decryptdata.keyId||[])}
      } (data length: ${t.byteLength})`),s.update(t)}getSelectedKeySystemFormats(){return Object.keys(this.keySystemAccessPromises).map(e=>({keySystem:e,hasMediaKeys:this.keySystemAccessPromises[e].hasMediaKeys})).filter(({hasMediaKeys:e})=>!!e).map(({keySystem:e})=>uf(e)).filter(e=>!!e)}getKeySystemAccess(e){return this.getKeySystemSelectionPromise(e).then(({keySystem:t,mediaKeys:s})=>this.attemptSetMediaKeys(t,s))}selectKeySystem(e){return new Promise((t,s)=>{this.getKeySystemSelectionPromise(e).then(({keySystem:i})=>{const r=uf(i);r?t(r):s(new Error(`Unable to find format for key-system "${i}"`))}).catch(s)})}selectKeySystemFormat(e){const t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${t.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){const t=Hl(this.config),s=e.map(iu).filter(i=>!!i&&t.indexOf(i)!==-1);return this.selectKeySystem(s)}getKeyStatus(e){const{mediaKeySessions:t}=this;for(let s=0;s<t.length;s++){const i=qN(e,t[s]);if(i)return i}}loadKey(e){const t=e.keyInfo.decryptdata,s=Gc(t),i=this.bannedKeyIds[s];if(i||this.getKeyStatus(t)==="internal-error"){const c=dx(i||"internal-error",t);return this.handleError(c,e.frag),Promise.reject(c)}const r=`(keyId: ${s} format: "${t.keyFormat}" method: ${t.method} uri: ${t.uri})`;this.log(`Starting session for key ${r}`);const l=this.keyIdToKeySessionPromise[s];if(!l){const c=this.getKeySystemForKeyPromise(t).then(({keySystem:h,mediaKeys:u})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${r}`),this.attemptSetMediaKeys(h,u).then(()=>(this.throwIfDestroyed(),this.createMediaKeySessionContext({keySystem:h,mediaKeys:u,decryptdata:t}))))).then(h=>{const u="cenc",f=t.pssh?t.pssh.buffer:null;return this.generateRequestWithPreferredKeySession(h,u,f,"playlist-key")});return c.catch(h=>this.handleError(h,e.frag)),this.keyIdToKeySessionPromise[s]=c,c}return l.catch(c=>{if(c instanceof fi){const h=Rt({},c.data);this.getKeyStatus(t)==="internal-error"&&(h.decryptdata=t);const u=new fi(h,c.message);this.handleError(u,e.frag)}}),l}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(e,t){if(this.hls)if(e instanceof fi){t&&(e.data.frag=t);const s=e.data.decryptdata;this.error(`${e.message}${s?` (${Is(s.keyId||[])})`:""}`),this.hls.trigger(L.ERROR,e.data)}else this.error(e.message),this.hls.trigger(L.ERROR,{type:Be.KEY_SYSTEM_ERROR,details:Q.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0})}getKeySystemForKeyPromise(e){const t=Gc(e),s=this.keyIdToKeySessionPromise[t];if(!s){const i=iu(e.keyFormat),r=i?[i]:Hl(this.config);return this.attemptKeySystemAccess(r)}return s}getKeySystemSelectionPromise(e){if(e.length||(e=Hl(this.config)),e.length===0)throw new fi({type:Be.KEY_SYSTEM_ERROR,details:Q.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${Mt({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}attemptSetMediaKeys(e,t){if(this.mediaResolved=void 0,this.mediaKeys===t)return Promise.resolve();const s=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);const i=Promise.all(s).then(()=>this.media?this.media.setMediaKeys(t):new Promise((r,l)=>{this.mediaResolved=()=>{if(this.mediaResolved=void 0,!this.media)return l(new Error("Attempted to set mediaKeys without media element attached"));this.mediaKeys=t,this.media.setMediaKeys(t).then(r).catch(l)}}));return this.mediaKeys=t,this.setMediaKeysQueue.push(i),i.then(()=>{this.log(`Media-keys set for "${e}"`),s.push(i),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(r=>s.indexOf(r)===-1)})}generateRequestWithPreferredKeySession(e,t,s,i){var r;const l=(r=this.config.drmSystems)==null||(r=r[e.keySystem])==null?void 0:r.generateRequest;if(l)try{const S=l.call(this.hls,t,s,e);if(!S)throw new Error("Invalid response from configured generateRequest filter");t=S.initDataType,s=S.initData?S.initData:null,e.decryptdata.pssh=s?new Uint8Array(s):null}catch(S){if(this.warn(S.message),this.hls&&this.hls.config.debug)throw S}if(s===null)return this.log(`Skipping key-session request for "${i}" (no initData)`),Promise.resolve(e);const c=Gc(e.decryptdata),h=e.decryptdata.uri;this.log(`Generating key-session request for "${i}" keyId: ${c} URI: ${h} (init data type: ${t} length: ${s.byteLength})`);const u=new Lm,f=e._onmessage=S=>{const E=e.mediaKeysSession;if(!E){u.emit("error",new Error("invalid state"));return}const{messageType:T,message:A}=S;this.log(`"${T}" message event for session "${E.sessionId}" message size: ${A.byteLength}`),T==="license-request"||T==="license-renewal"?this.renewLicense(e,A).catch(_=>{u.eventNames().length?u.emit("error",_):this.handleError(_)}):T==="license-release"?e.keySystem===qt.FAIRPLAY&&this.updateKeySession(e,Hf("acknowledged")).then(()=>this.removeSession(e)).catch(_=>this.handleError(_)):this.warn(`unhandled media key message type "${T}"`)},g=(S,E)=>{E.keyStatus=S;let T;S.startsWith("usable")?u.emit("resolved"):S==="internal-error"||S==="output-restricted"||S==="output-downscaled"?T=dx(S,E.decryptdata):S==="expired"?T=new Error(`key expired (keyId: ${c})`):S==="released"?T=new Error("key released"):S==="status-pending"||this.warn(`unhandled key status change "${S}" (keyId: ${c})`),T&&(u.eventNames().length?u.emit("error",T):this.handleError(T))},y=e._onkeystatuseschange=S=>{if(!e.mediaKeysSession){u.emit("error",new Error("invalid state"));return}const T=this.getKeyStatuses(e);if(!Object.keys(T).some(C=>T[C]!=="status-pending"))return;if(T[c]==="expired"){this.log(`Expired key ${Mt(T)} in key-session "${e.mediaKeysSession.sessionId}"`),this.renewKeySession(e);return}let _=T[c];if(_)g(_,e);else{var I;e.keyStatusTimeouts||(e.keyStatusTimeouts={}),(I=e.keyStatusTimeouts)[c]||(I[c]=self.setTimeout(()=>{if(!e.mediaKeysSession||!this.mediaKeys)return;const N=this.getKeyStatus(e.decryptdata);if(N&&N!=="status-pending")return this.log(`No status for keyId ${c} in key-session "${e.mediaKeysSession.sessionId}". Using session key-status ${N} from other session.`),g(N,e);this.log(`key status for ${c} in key-session "${e.mediaKeysSession.sessionId}" timed out after 1000ms`),_="internal-error",g(_,e)},1e3)),this.log(`No status for keyId ${c} (${Mt(T)}).`)}};$s(e.mediaKeysSession,"message",f),$s(e.mediaKeysSession,"keystatuseschange",y);const x=new Promise((S,E)=>{u.on("error",E),u.on("resolved",S)});return e.mediaKeysSession.generateRequest(t,s).then(()=>{this.log(`Request generated for key-session "${e.mediaKeysSession.sessionId}" keyId: ${c} URI: ${h}`)}).catch(S=>{throw new fi({type:Be.KEY_SYSTEM_ERROR,details:Q.KEY_SYSTEM_NO_SESSION,error:S,decryptdata:e.decryptdata,fatal:!1},`Error generating key-session request: ${S}`)}).then(()=>x).catch(S=>(u.removeAllListeners(),this.removeSession(e).then(()=>{throw S}))).then(()=>(u.removeAllListeners(),e))}getKeyStatuses(e){const t={};return e.mediaKeysSession.keyStatuses.forEach((s,i)=>{if(typeof i=="string"&&typeof s=="object"){const c=i;i=s,s=c}const r="buffer"in i?new Uint8Array(i.buffer,i.byteOffset,i.byteLength):new Uint8Array(i);if(e.keySystem===qt.PLAYREADY&&r.length===16){const c=Is(r);t[c]=s,KS(r)}const l=Is(r);s==="internal-error"&&(this.bannedKeyIds[l]=s),this.log(`key status change "${s}" for keyStatuses keyId: ${l} key-session "${e.mediaKeysSession.sessionId}"`),t[l]=s}),t}fetchServerCertificate(e){const t=this.config,s=t.loader,i=new s(t),r=this.getServerCertificateUrl(e);return r?(this.log(`Fetching server certificate for "${e}"`),new Promise((l,c)=>{const h={responseType:"arraybuffer",url:r},u=t.certLoadPolicy.default,f={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},g={onSuccess:(y,x,S,E)=>{l(y.data)},onError:(y,x,S,E)=>{c(new fi({type:Be.KEY_SYSTEM_ERROR,details:Q.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:S,response:Rt({url:h.url,data:void 0},y)},`"${e}" certificate request failed (${r}). Status: ${y.code} (${y.text})`))},onTimeout:(y,x,S)=>{c(new fi({type:Be.KEY_SYSTEM_ERROR,details:Q.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:S,response:{url:h.url,data:void 0}},`"${e}" certificate request timed out (${r})`))},onAbort:(y,x,S)=>{c(new Error("aborted"))}};i.load(h,f,g)})):Promise.resolve()}setMediaKeysServerCertificate(e,t,s){return new Promise((i,r)=>{e.setServerCertificate(s).then(l=>{this.log(`setServerCertificate ${l?"success":"not supported by CDM"} (${s.byteLength}) on "${t}"`),i(e)}).catch(l=>{r(new fi({type:Be.KEY_SYSTEM_ERROR,details:Q.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:l,fatal:!0},l.message))})})}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then(s=>this.updateKeySession(e,new Uint8Array(s)).catch(i=>{throw new fi({type:Be.KEY_SYSTEM_ERROR,details:Q.KEY_SYSTEM_SESSION_UPDATE_FAILED,decryptdata:e.decryptdata,error:i,fatal:!1},i.message)}))}unpackPlayReadyKeyMessage(e,t){const s=String.fromCharCode.apply(null,new Uint16Array(t.buffer));if(!s.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),t;const i=new DOMParser().parseFromString(s,"application/xml"),r=i.querySelectorAll("HttpHeader");if(r.length>0){let f;for(let g=0,y=r.length;g<y;g++){var l,c;f=r[g];const x=(l=f.querySelector("name"))==null?void 0:l.textContent,S=(c=f.querySelector("value"))==null?void 0:c.textContent;x&&S&&e.setRequestHeader(x,S)}}const h=i.querySelector("Challenge"),u=h?.textContent;if(!u)throw new Error("Cannot find <Challenge> in key message");return Hf(atob(u))}setupLicenseXHR(e,t,s,i){const r=this.config.licenseXhrSetup;return r?Promise.resolve().then(()=>{if(!s.decryptdata)throw new Error("Key removed");return r.call(this.hls,e,t,s,i)}).catch(l=>{if(!s.decryptdata)throw l;return e.open("POST",t,!0),r.call(this.hls,e,t,s,i)}).then(l=>(e.readyState||e.open("POST",t,!0),{xhr:e,licenseChallenge:l||i})):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:i}))}requestLicense(e,t){const s=this.config.keyLoadPolicy.default;return new Promise((i,r)=>{const l=this.getLicenseServerUrlOrThrow(e.keySystem);this.log(`Sending license request to URL: ${l}`);const c=new XMLHttpRequest;c.responseType="arraybuffer",c.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return r(new Error("invalid state"));if(c.readyState===4)if(c.status===200){this._requestLicenseFailureCount=0;let h=c.response;this.log(`License received ${h instanceof ArrayBuffer?h.byteLength:h}`);const u=this.config.licenseResponseCallback;if(u)try{h=u.call(this.hls,c,l,e)}catch(f){this.error(f)}i(h)}else{const h=s.errorRetry,u=h?h.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>u||c.status>=400&&c.status<500)r(new fi({type:Be.KEY_SYSTEM_ERROR,details:Q.KEY_SYSTEM_LICENSE_REQUEST_FAILED,decryptdata:e.decryptdata,fatal:!0,networkDetails:c,response:{url:l,data:void 0,code:c.status,text:c.statusText}},`License Request XHR failed (${l}). Status: ${c.status} (${c.statusText})`));else{const f=u-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${f} attempts left`),this.requestLicense(e,t).then(i,r)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=c,this.setupLicenseXHR(c,l,e,t).then(({xhr:h,licenseChallenge:u})=>{e.keySystem==qt.PLAYREADY&&(u=this.unpackPlayReadyKeyMessage(h,u)),h.send(u)}).catch(r)})}onDestroying(){this.unregisterListeners(),this._clear()}onMediaAttached(e,t){if(!this.config.emeEnabled)return;const s=t.media;this.media=s,$s(s,"encrypted",this.onMediaEncrypted),$s(s,"waitingforkey",this.onWaitingForKey);const i=this.mediaResolved;i?i():this.mediaKeys=s.mediaKeys}onMediaDetached(){const e=this.media;e&&(ei(e,"encrypted",this.onMediaEncrypted),ei(e,"waitingforkey",this.onWaitingForKey),this.media=null,this.mediaKeys=null)}_clear(){var e;this._requestLicenseFailureCount=0,this.keyIdToKeySessionPromise={},this.bannedKeyIds={};const t=this.mediaResolved;if(t&&t(),!this.mediaKeys&&!this.mediaKeySessions.length)return;const s=this.media,i=this.mediaKeySessions.slice();this.mediaKeySessions=[],this.mediaKeys=null,ba.clearKeyUriToKeyIdMap();const r=i.length;Fr.CDMCleanupPromise=Promise.all(i.map(l=>this.removeSession(l)).concat((s==null||(e=s.setMediaKeys(null))==null?void 0:e.catch(l=>{this.log(`Could not clear media keys: ${l}`),this.hls&&this.hls.trigger(L.ERROR,{type:Be.OTHER_ERROR,details:Q.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:new Error(`Could not clear media keys: ${l}`)})}))||Promise.resolve())).catch(l=>{this.log(`Could not close sessions and clear media keys: ${l}`),this.hls&&this.hls.trigger(L.ERROR,{type:Be.OTHER_ERROR,details:Q.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close sessions and clear media keys: ${l}`)})}).then(()=>{r&&this.log("finished closing key sessions and clearing media keys")})}onManifestLoading(){this._clear()}onManifestLoaded(e,{sessionKeys:t}){if(!(!t||!this.config.emeEnabled)&&!this.keyFormatPromise){const s=t.reduce((i,r)=>(i.indexOf(r.keyFormat)===-1&&i.push(r.keyFormat),i),[]);this.log(`Selecting key-system from session-keys ${s.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(s)}}removeSession(e){const{mediaKeysSession:t,licenseXhr:s,decryptdata:i}=e;if(t){this.log(`Remove licenses and keys and close session "${t.sessionId}" keyId: ${Is(i?.keyId||[])}`),e._onmessage&&(t.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(t.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),s&&s.readyState!==XMLHttpRequest.DONE&&s.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const r=this.mediaKeySessions.indexOf(e);r>-1&&this.mediaKeySessions.splice(r,1);const{keyStatusTimeouts:l}=e;l&&Object.keys(l).forEach(u=>self.clearTimeout(l[u]));const{drmSystemOptions:c}=this.config;return(ww(c)?new Promise((u,f)=>{self.setTimeout(()=>f(new Error("MediaKeySession.remove() timeout")),8e3),t.remove().then(u).catch(f)}):Promise.resolve()).catch(u=>{this.log(`Could not remove session: ${u}`),this.hls&&this.hls.trigger(L.ERROR,{type:Be.OTHER_ERROR,details:Q.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:new Error(`Could not remove session: ${u}`)})}).then(()=>t.close()).catch(u=>{this.log(`Could not close session: ${u}`),this.hls&&this.hls.trigger(L.ERROR,{type:Be.OTHER_ERROR,details:Q.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close session: ${u}`)})})}return Promise.resolve()}}Fr.CDMCleanupPromise=void 0;function Gc(n){if(!n)throw new Error("Could not read keyId of undefined decryptdata");if(n.keyId===null)throw new Error("keyId is null");return Is(n.keyId)}function qN(n,e){if(n.keyId&&e.mediaKeysSession.keyStatuses.has(n.keyId))return e.mediaKeysSession.keyStatuses.get(n.keyId);if(n.matches(e.decryptdata))return e.keyStatus}class fi extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}function dx(n,e){const t=n==="output-restricted",s=t?Q.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:Q.KEY_SYSTEM_STATUS_INTERNAL_ERROR;return new fi({type:Be.KEY_SYSTEM_ERROR,details:s,fatal:!1,decryptdata:e},t?"HDCP level output restricted":`key status changed to "${n}"`)}class QN{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(L.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(L.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListeners(){this.hls.off(L.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(L.MEDIA_DETACHING,this.onMediaDetaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){const s=this.hls.config;if(s.capLevelOnFPSDrop){const i=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=i,i&&typeof i.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),s.fpsDroppedMonitoringPeriod)}}onMediaDetaching(){this.media=null}checkFPS(e,t,s){const i=performance.now();if(t){if(this.lastTime){const r=i-this.lastTime,l=s-this.lastDroppedFrames,c=t-this.lastDecodedFrames,h=1e3*l/r,u=this.hls;if(u.trigger(L.FPS_DROP,{currentDropped:l,currentDecoded:c,totalDroppedFrames:s}),h>0&&l>u.config.fpsDroppedMonitoringThreshold*c){let f=u.currentLevel;u.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+f),f>0&&(u.autoLevelCapping===-1||u.autoLevelCapping>=f)&&(f=f-1,u.trigger(L.FPS_DROP_LEVEL_CAPPING,{level:f,droppedLevel:u.currentLevel}),u.autoLevelCapping=f,this.streamController.nextLevelSwitch())}}this.lastTime=i,this.lastDroppedFrames=s,this.lastDecodedFrames=t}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}function jb(n,e){let t;try{t=new Event("addtrack")}catch{t=document.createEvent("Event"),t.initEvent("addtrack",!1,!1)}t.track=n,e.dispatchEvent(t)}function Bb(n,e){const t=n.mode;if(t==="disabled"&&(n.mode="hidden"),n.cues&&!n.cues.getCueById(e.id))try{if(n.addCue(e),!n.cues.getCueById(e.id))throw new Error(`addCue is failed for: ${e}`)}catch(s){Lt.debug(`[texttrack-utils]: ${s}`);try{const i=new self.TextTrackCue(e.startTime,e.endTime,e.text);i.id=e.id,n.addCue(i)}catch(i){Lt.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${i}`)}}t==="disabled"&&(n.mode=t)}function Mr(n,e){const t=n.mode;if(t==="disabled"&&(n.mode="hidden"),n.cues)for(let s=n.cues.length;s--;)e&&n.cues[s].removeEventListener("enter",e),n.removeCue(n.cues[s]);t==="disabled"&&(n.mode=t)}function Jf(n,e,t,s){const i=n.mode;if(i==="disabled"&&(n.mode="hidden"),n.cues&&n.cues.length>0){const r=XN(n.cues,e,t);for(let l=0;l<r.length;l++)(!s||s(r[l]))&&n.removeCue(r[l])}i==="disabled"&&(n.mode=i)}function WN(n,e){if(e<=n[0].startTime)return 0;const t=n.length-1;if(e>n[t].endTime)return-1;let s=0,i=t,r;for(;s<=i;)if(r=Math.floor((i+s)/2),e<n[r].startTime)i=r-1;else if(e>n[r].startTime&&s<t)s=r+1;else return r;return n[s].startTime-e<e-n[i].startTime?s:i}function XN(n,e,t){const s=[],i=WN(n,e);if(i>-1)for(let r=i,l=n.length;r<l;r++){const c=n[r];if(c.startTime>=e&&c.endTime<=t)s.push(c);else if(c.startTime>t)return s}return s}function lu(n){const e=[];for(let t=0;t<n.length;t++){const s=n[t];(s.kind==="subtitles"||s.kind==="captions")&&s.label&&e.push(n[t])}return e}class ZN extends Pm{constructor(e){super(e,"subtitle-track-controller"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let t=null;const s=lu(this.media.textTracks);for(let r=0;r<s.length;r++)if(s[r].mode==="hidden")t=s[r];else if(s[r].mode==="showing"){t=s[r];break}const i=this.findTrackForTextTrack(t);this.subtitleTrack!==i&&this.setSubtitleTrack(i)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:e}=this;e.on(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.MANIFEST_PARSED,this.onManifestParsed,this),e.on(L.LEVEL_LOADING,this.onLevelLoading,this),e.on(L.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(L.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(L.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.MANIFEST_PARSED,this.onManifestParsed,this),e.off(L.LEVEL_LOADING,this.onLevelLoading,this),e.off(L.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(L.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(L.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(e,t){const s=this.media;if(!s)return;const i=!!t.transferMedia;if(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||s.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,i)return;lu(s.textTracks).forEach(l=>{Mr(l)})}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){const{id:s,groupId:i,details:r}=t,l=this.tracksInGroup[s];if(!l||l.groupId!==i){this.warn(`Subtitle track with id:${s} and group:${i} not found in active group ${l?.groupId}`);return}const c=l.details;l.details=t.details,this.log(`Subtitle track ${s} "${l.name}" lang:${l.lang} group:${i} loaded [${r.startSN}-${r.endSN}]`),s===this.trackId&&this.playlistLoaded(s,t,c)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const s=t.subtitleGroups||null,i=this.groupIds;let r=this.currentTrack;if(!s||i?.length!==s?.length||s!=null&&s.some(l=>i?.indexOf(l)===-1)){this.groupIds=s,this.trackId=-1,this.currentTrack=null;const l=this.tracks.filter(f=>!s||s.indexOf(f.groupId)!==-1);if(l.length)this.selectDefaultTrack&&!l.some(f=>f.default)&&(this.selectDefaultTrack=!1),l.forEach((f,g)=>{f.id=g});else if(!r&&!this.tracksInGroup.length)return;this.tracksInGroup=l;const c=this.hls.config.subtitlePreference;if(!r&&c){this.selectDefaultTrack=!1;const f=cn(c,l);if(f>-1)r=l[f];else{const g=cn(c,this.tracks);r=this.tracks[g]}}let h=this.findTrackId(r);h===-1&&r&&(h=this.findTrackId(null));const u={subtitleTracks:l};this.log(`Updating subtitle tracks, ${l.length} track(s) found in "${s?.join(",")}" group-id`),this.hls.trigger(L.SUBTITLE_TRACKS_UPDATED,u),h!==-1&&this.trackId===-1&&this.setSubtitleTrack(h)}}findTrackId(e){const t=this.tracksInGroup,s=this.selectDefaultTrack;for(let i=0;i<t.length;i++){const r=t[i];if(!(s&&!r.default||!s&&!e)&&(!e||Ya(r,e)))return i}if(e){for(let i=0;i<t.length;i++){const r=t[i];if(to(e.attrs,r.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return i}for(let i=0;i<t.length;i++){const r=t[i];if(to(e.attrs,r.attrs,["LANGUAGE"]))return i}}return-1}findTrackForTextTrack(e){if(e){const t=this.tracksInGroup;for(let s=0;s<t.length;s++){const i=t[s];if(Qf(i,e))return s}}return-1}onError(e,t){t.fatal||!t.context||t.context.type===at.SUBTITLE_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){if(e.id===-1)return this.setSubtitleTrack(-1),null;const t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){const s=this.currentTrack;if(s&&Ya(e,s))return s;const i=cn(e,this.tracksInGroup);if(i>-1){const r=this.tracksInGroup[i];return this.setSubtitleTrack(i),r}else{if(s)return null;{const r=cn(e,t);if(r>-1)return t[r]}}}}return null}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const s=e.id,i=e.groupId,r=this.getUrlWithDirectives(e.url,t),l=e.details,c=l?.age;this.log(`Loading subtitle ${s} "${e.name}" lang:${e.lang} group:${i}${t?.msn!==void 0?" at sn "+t.msn+" part "+t.part:""}${c&&l.live?" age "+c.toFixed(1)+(l.type&&" "+l.type||""):""} ${r}`),this.hls.trigger(L.SUBTITLE_TRACK_LOADING,{url:r,id:s,groupId:i,deliveryDirectives:t||null,track:e})}toggleTrackModes(){const{media:e}=this;if(!e)return;const t=lu(e.textTracks),s=this.currentTrack;let i;if(s&&(i=t.filter(r=>Qf(s,r))[0],i||this.warn(`Unable to find subtitle TextTrack with name "${s.name}" and language "${s.lang}"`)),[].slice.call(t).forEach(r=>{r.mode!=="disabled"&&r!==i&&(r.mode="disabled")}),i){const r=this.subtitleDisplay?"showing":"hidden";i.mode!==r&&(i.mode=r)}}setSubtitleTrack(e){const t=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(e<-1||e>=t.length||!Ne(e)){this.warn(`Invalid subtitle track id: ${e}`);return}this.selectDefaultTrack=!1;const s=this.currentTrack,i=t[e]||null;if(this.trackId=e,this.currentTrack=i,this.toggleTrackModes(),!i){this.hls.trigger(L.SUBTITLE_TRACK_SWITCH,{id:e});return}const r=!!i.details&&!i.details.live;if(e===this.trackId&&i===s&&r)return;this.log(`Switching to subtitle-track ${e}`+(i?` "${i.name}" lang:${i.lang} group:${i.groupId}`:""));const{id:l,groupId:c="",name:h,type:u,url:f}=i;this.hls.trigger(L.SUBTITLE_TRACK_SWITCH,{id:l,groupId:c,name:h,type:u,url:f});const g=this.switchParams(i.url,s?.details,i.details);this.loadPlaylist(g)}}function JN(){try{return crypto.randomUUID()}catch{try{const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}catch{let t=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,i=>{const r=(t+Math.random()*16)%16|0;return t=Math.floor(t/16),(i=="x"?r:r&3|8).toString(16)})}}}function Yl(n){let e=5381,t=n.length;for(;t;)e=e*33^n.charCodeAt(--t);return(e>>>0).toString()}const Vr=.025;let Au=(function(n){return n[n.Point=0]="Point",n[n.Range=1]="Range",n})({});function eO(n,e,t){return`${n.identifier}-${t+1}-${Yl(e)}`}class tO{constructor(e,t){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=t,this.dateRange=e,this.setDateRange(e)}setDateRange(e){this.dateRange=e,this.resumeOffset=e.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=e.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=e.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=e.attr.enumeratedStringList("X-SNAP",this.snapOptions)}reset(){var e;this.appendInPlaceStarted=!1,(e=this.assetListLoader)==null||e.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)}isAssetPastPlayoutLimit(e){var t;if(e>0&&e>=this.assetList.length)return!0;const s=this.playoutLimit;return e<=0||isNaN(s)?!1:s===0?!0:(((t=this.assetList[e])==null?void 0:t.startOffset)||0)>s}findAssetIndex(e){return this.assetList.indexOf(e)}get identifier(){return this.dateRange.id}get startDate(){return this.dateRange.startDate}get startTime(){const e=this.dateRange.startTime;if(this.snapOptions.out){const t=this.dateRange.tagAnchor;if(t)return xf(e,t)}return e}get startOffset(){return this.cue.pre?0:this.startTime}get startIsAligned(){if(this.startTime===0||this.snapOptions.out)return!0;const e=this.dateRange.tagAnchor;if(e){const t=this.dateRange.startTime,s=xf(t,e);return t-s<.1}return!1}get resumptionOffset(){const e=this.resumeOffset,t=Ne(e)?e:this.duration;return this.cumulativeDuration+t}get resumeTime(){const e=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){const t=this.resumeAnchor;if(t)return xf(e,t)}return e}get appendInPlace(){return this.appendInPlaceStarted?!0:this.appendInPlaceDisabled?!1:!!(!this.cue.once&&!this.cue.pre&&this.startIsAligned&&(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&Math.abs(this.resumeOffset-this.duration)<Vr))}set appendInPlace(e){if(this.appendInPlaceStarted){this.resetOnResume=!e;return}this.appendInPlaceDisabled=!e}get timelineStart(){return this._timelineStart!==null?this._timelineStart:this.startTime}set timelineStart(e){this._timelineStart=e}get duration(){const e=this.playoutLimit;let t;return this._duration!==null?t=this._duration:this.dateRange.duration?t=this.dateRange.duration:t=this.dateRange.plannedDuration||0,!isNaN(e)&&e<t&&(t=e),t}set duration(e){this._duration=e}get cue(){return this.dateRange.cue}get timelineOccupancy(){return this.dateRange.attr["X-TIMELINE-OCCUPIES"]==="RANGE"?Au.Range:Au.Point}get supplementsPrimary(){return this.dateRange.attr["X-TIMELINE-STYLE"]==="PRIMARY"}get contentMayVary(){return this.dateRange.attr["X-CONTENT-MAY-VARY"]!=="NO"}get assetUrl(){return this.dateRange.attr["X-ASSET-URI"]}get assetListUrl(){return this.dateRange.attr["X-ASSET-LIST"]}get baseUrl(){return this.base.url}get assetListLoaded(){return this.assetList.length>0||this.assetListResponse!==null}toString(){return sO(this)}}function xf(n,e){return n-e.start<e.duration/2&&!(Math.abs(n-(e.start+e.duration))<Vr)?e.start:e.start+e.duration}function Fb(n,e,t){const s=new self.URL(n,t);return s.protocol!=="data:"&&s.searchParams.set("_HLS_primary_id",e),s}function Sf(n,e){for(;(t=n.assetList[++e])!=null&&t.error;)var t;return e}function sO(n){return`["${n.identifier}" ${n.cue.pre?"<pre>":n.cue.post?"<post>":""}${n.timelineStart.toFixed(2)}-${n.resumeTime.toFixed(2)}]`}function Ur(n){const e=n.timelineStart,t=n.duration||0;return`["${n.identifier}" ${e.toFixed(2)}-${(e+t).toFixed(2)}]`}class iO{constructor(e,t,s,i){this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=()=>{this.reachedPlayout(this.currentTime)&&this.hls&&this.hls.trigger(L.PLAYOUT_LIMIT_REACHED,{})};const r=this.hls=new e(t);this.interstitial=s,this.assetItem=i;const l=()=>{this.hasDetails=!0};r.once(L.LEVEL_LOADED,l),r.once(L.AUDIO_TRACK_LOADED,l),r.once(L.SUBTITLE_TRACK_LOADED,l),r.on(L.MEDIA_ATTACHING,(c,{media:h})=>{this.removeMediaListeners(),this.mediaAttached=h,this.interstitial.playoutLimit&&(h.addEventListener("timeupdate",this.checkPlayout),this.appendInPlace&&r.on(L.BUFFER_APPENDED,()=>{const f=this.bufferedEnd;this.reachedPlayout(f)&&(this._bufferedEosTime=f,r.trigger(L.BUFFERED_TO_END,void 0))}))})}get appendInPlace(){return this.interstitial.appendInPlace}loadSource(){const e=this.hls;if(e)if(e.url)e.levels.length&&!e.started&&e.startLoad(-1,!0);else{let t=this.assetItem.uri;try{t=Fb(t,e.config.primarySessionId||"").href}catch{}e.loadSource(t)}}bufferedInPlaceToEnd(e){var t;if(!this.appendInPlace)return!1;if((t=this.hls)!=null&&t.bufferedToEnd)return!0;if(!e)return!1;const s=Math.min(this._bufferedEosTime||1/0,this.duration),i=this.timelineOffset,r=qe.bufferInfo(e,i,0);return this.getAssetTime(r.end)>=s-.02}reachedPlayout(e){const s=this.interstitial.playoutLimit;return this.startOffset+e>=s}get destroyed(){var e;return!((e=this.hls)!=null&&e.userConfig)}get assetId(){return this.assetItem.identifier}get interstitialId(){return this.assetItem.parentIdentifier}get media(){var e;return((e=this.hls)==null?void 0:e.media)||null}get bufferedEnd(){const e=this.media||this.mediaAttached;if(!e)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;const t=qe.bufferInfo(e,e.currentTime,.001);return this.getAssetTime(t.end)}get currentTime(){const e=this.media||this.mediaAttached;return e?this.getAssetTime(e.currentTime):this._currentTime||0}get duration(){const e=this.assetItem.duration;if(!e)return 0;const t=this.interstitial.playoutLimit;if(t){const s=t-this.startOffset;if(s>0&&s<e)return s}return e}get remaining(){const e=this.duration;return e?Math.max(0,e-this.currentTime):0}get startOffset(){return this.assetItem.startOffset}get timelineOffset(){var e;return((e=this.hls)==null?void 0:e.config.timelineOffset)||0}set timelineOffset(e){const t=this.timelineOffset;if(e!==t){const s=e-t;if(Math.abs(s)>1/9e4&&this.hls){if(this.hasDetails)throw new Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=e}}}getAssetTime(e){const t=this.timelineOffset,s=this.duration;return Math.min(Math.max(0,e-t),s)}removeMediaListeners(){const e=this.mediaAttached;e&&(this._currentTime=e.currentTime,this.bufferSnapShot(),e.removeEventListener("timeupdate",this.checkPlayout))}bufferSnapShot(){if(this.mediaAttached){var e;(e=this.hls)!=null&&e.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd)}}destroy(){this.removeMediaListeners(),this.hls&&this.hls.destroy(),this.hls=null,this.tracks=this.mediaAttached=this.checkPlayout=null}attachMedia(e){var t;this.loadSource(),(t=this.hls)==null||t.attachMedia(e)}detachMedia(){var e;this.removeMediaListeners(),this.mediaAttached=null,(e=this.hls)==null||e.detachMedia()}resumeBuffering(){var e;(e=this.hls)==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.hls)==null||e.pauseBuffering()}transferMedia(){var e;return this.bufferSnapShot(),((e=this.hls)==null?void 0:e.transferMedia())||null}resetDetails(){const e=this.hls;if(e&&this.hasDetails){e.stopLoad();const t=s=>delete s.details;e.levels.forEach(t),e.allAudioTracks.forEach(t),e.allSubtitleTracks.forEach(t),this.hasDetails=!1}}on(e,t,s){var i;(i=this.hls)==null||i.on(e,t)}once(e,t,s){var i;(i=this.hls)==null||i.once(e,t)}off(e,t,s){var i;(i=this.hls)==null||i.off(e,t)}toString(){var e;return`HlsAssetPlayer: ${Ur(this.assetItem)} ${(e=this.hls)==null?void 0:e.sessionId} ${this.appendInPlace?"append-in-place":""}`}}const hx=.033;class nO extends ji{constructor(e,t){super("interstitials-sched",t),this.onScheduleUpdate=void 0,this.eventMap={},this.events=null,this.items=null,this.durations={primary:0,playout:0,integrated:0},this.onScheduleUpdate=e}destroy(){this.reset(),this.onScheduleUpdate=null}reset(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach(e=>e.reset()),this.events=this.items=null}resetErrorsInRange(e,t){return this.events?this.events.reduce((s,i)=>e<=i.startOffset&&t>i.startOffset?(delete i.error,s+1):s,0):0}get duration(){const e=this.items;return e?e[e.length-1].end:0}get length(){return this.items?this.items.length:0}getEvent(e){return e&&this.eventMap[e]||null}hasEvent(e){return e in this.eventMap}findItemIndex(e,t){if(e.event)return this.findEventIndex(e.event.identifier);let s=-1;e.nextEvent?s=this.findEventIndex(e.nextEvent.identifier)-1:e.previousEvent&&(s=this.findEventIndex(e.previousEvent.identifier)+1);const i=this.items;if(i)for(i[s]||(t===void 0&&(t=e.start),s=this.findItemIndexAtTime(t));s>=0&&(r=i[s])!=null&&r.event;){var r;s--}return s}findItemIndexAtTime(e,t){const s=this.items;if(s)for(let i=0;i<s.length;i++){let r=s[i];if(t&&t!=="primary"&&(r=r[t]),e===r.start||e>r.start&&e<r.end)return i}return-1}findJumpRestrictedIndex(e,t){const s=this.items;if(s)for(let i=e;i<=t&&s[i];i++){const r=s[i].event;if(r!=null&&r.restrictions.jump&&!r.appendInPlace)return i}return-1}findEventIndex(e){const t=this.items;if(t)for(let i=t.length;i--;){var s;if(((s=t[i].event)==null?void 0:s.identifier)===e)return i}return-1}findAssetIndex(e,t){const s=e.assetList,i=s.length;if(i>1)for(let r=0;r<i;r++){const l=s[r];if(!l.error){const c=l.timelineStart;if(t===c||t>c&&(t<c+(l.duration||0)||r===i-1))return r}}return 0}get assetIdAtEnd(){var e;const t=(e=this.items)==null||(e=e[this.length-1])==null?void 0:e.event;if(t){const s=t.assetList,i=s[s.length-1];if(i)return i.identifier}return null}parseInterstitialDateRanges(e,t){const s=e.main.details,{dateRanges:i}=s,r=this.events,l=this.parseDateRanges(i,{url:s.url},t),c=Object.keys(i),h=r?r.filter(u=>!c.includes(u.identifier)):[];l.length&&l.sort((u,f)=>{const g=u.cue.pre,y=u.cue.post,x=f.cue.pre,S=f.cue.post;if(g&&!x)return-1;if(x&&!g||y&&!S)return 1;if(S&&!y)return-1;if(!g&&!x&&!y&&!S){const E=u.startTime,T=f.startTime;if(E!==T)return E-T}return u.dateRange.tagOrder-f.dateRange.tagOrder}),this.events=l,h.forEach(u=>{this.removeEvent(u)}),this.updateSchedule(e,h)}updateSchedule(e,t=[],s=!1){const i=this.events||[];if(i.length||t.length||this.length<2){const r=this.items,l=this.parseSchedule(i,e);(s||t.length||r?.length!==l.length||l.some((h,u)=>Math.abs(h.playout.start-r[u].playout.start)>.005||Math.abs(h.playout.end-r[u].playout.end)>.005))&&(this.items=l,this.onScheduleUpdate(t,r))}}parseDateRanges(e,t,s){const i=[],r=Object.keys(e);for(let l=0;l<r.length;l++){const c=r[l],h=e[c];if(h.isInterstitial){let u=this.eventMap[c];u?u.setDateRange(h):(u=new tO(h,t),this.eventMap[c]=u,s===!1&&(u.appendInPlace=s)),i.push(u)}}return i}parseSchedule(e,t){const s=[],i=t.main.details,r=i.live?1/0:i.edge;let l=0;if(e=e.filter(h=>!h.error&&!(h.cue.once&&h.hasPlayed)),e.length){this.resolveOffsets(e,t);let h=0,u=0;if(e.forEach((f,g)=>{const y=f.cue.pre,x=f.cue.post,S=e[g-1]||null,E=f.appendInPlace,T=x?r:f.startOffset,A=f.duration,_=f.timelineOccupancy===Au.Range?A:0,I=f.resumptionOffset,C=S?.startTime===T,N=T+f.cumulativeDuration;let D=E?N+A:T+I;if(y||!x&&T<=0){const B=u;u+=_,f.timelineStart=N;const j=l;l+=A,s.push({event:f,start:N,end:D,playout:{start:j,end:l},integrated:{start:B,end:u}})}else if(T<=r){if(!C){const U=T-h;if(U>hx){const K=h,H=u;u+=U;const J=l;l+=U;const re={previousEvent:e[g-1]||null,nextEvent:f,start:K,end:K+U,playout:{start:J,end:l},integrated:{start:H,end:u}};s.push(re)}else U>0&&S&&(S.cumulativeDuration+=U,s[s.length-1].end=T)}x&&(D=N),f.timelineStart=N;const B=u;u+=_;const j=l;l+=A,s.push({event:f,start:N,end:D,playout:{start:j,end:l},integrated:{start:B,end:u}})}else return;const k=f.resumeTime;x||k>r?h=r:h=k}),h<r){var c;const f=h,g=u,y=r-h;u+=y;const x=l;l+=y,s.push({previousEvent:((c=s[s.length-1])==null?void 0:c.event)||null,nextEvent:null,start:h,end:f+y,playout:{start:x,end:l},integrated:{start:g,end:u}})}this.setDurations(r,l,u)}else s.push({previousEvent:null,nextEvent:null,start:0,end:r,playout:{start:0,end:r},integrated:{start:0,end:r}}),this.setDurations(r,r,r);return s}setDurations(e,t,s){this.durations={primary:e,playout:t,integrated:s}}resolveOffsets(e,t){const s=t.main.details,i=s.live?1/0:s.edge;let r=0,l=-1;e.forEach((c,h)=>{const u=c.cue.pre,f=c.cue.post,g=u?0:f?i:c.startTime;this.updateAssetDurations(c),l===g?c.cumulativeDuration=r:(r=0,l=g),!f&&c.snapOptions.in&&(c.resumeAnchor=Qa(null,s.fragments,c.startOffset+c.resumptionOffset,0,0)||void 0),c.appendInPlace&&!c.appendInPlaceStarted&&(this.primaryCanResumeInPlaceAt(c,t)||(c.appendInPlace=!1)),!c.appendInPlace&&h+1<e.length&&e[h+1].startTime-e[h].resumeTime<hx&&(e[h+1].appendInPlace=!1,e[h+1].appendInPlace&&this.warn(`Could not change append strategy for abutting event ${c}`));const x=Ne(c.resumeOffset)?c.resumeOffset:c.duration;r+=x})}primaryCanResumeInPlaceAt(e,t){const s=e.resumeTime,i=e.startTime+e.resumptionOffset;return Math.abs(s-i)>Vr?(this.log(`"${e.identifier}" resumption ${s} not aligned with estimated timeline end ${i}`),!1):!Object.keys(t).some(l=>{const c=t[l].details,h=c.edge;if(s>=h)return this.log(`"${e.identifier}" resumption ${s} past ${l} playlist end ${h}`),!1;const u=Qa(null,c.fragments,s);if(!u)return this.log(`"${e.identifier}" resumption ${s} does not align with any fragments in ${l} playlist (${c.fragStart}-${c.fragmentEnd})`),!0;const f=l==="audio"?.175:0;return Math.abs(u.start-s)<Vr+f||Math.abs(u.end-s)<Vr+f?!1:(this.log(`"${e.identifier}" resumption ${s} not aligned with ${l} fragment bounds (${u.start}-${u.end} sn: ${u.sn} cc: ${u.cc})`),!0)})}updateAssetDurations(e){if(!e.assetListLoaded)return;const t=e.timelineStart;let s=0,i=!1,r=!1;for(let l=0;l<e.assetList.length;l++){const c=e.assetList[l],h=t+s;c.startOffset=s,c.timelineStart=h,i||(i=c.duration===null),r||(r=!!c.error);const u=c.error?0:c.duration||0;s+=u}i&&!r?e.duration=Math.max(s,e.duration):e.duration=s}removeEvent(e){e.reset(),delete this.eventMap[e.identifier]}}function zi(n){return`[${n.event?'"'+n.event.identifier+'"':"primary"}: ${n.start.toFixed(2)}-${n.end.toFixed(2)}]`}class aO{constructor(e){this.hls=void 0,this.hls=e}destroy(){this.hls=null}loadAssetList(e,t){const s=e.assetListUrl;let i;try{i=Fb(s,this.hls.sessionId,e.baseUrl)}catch(y){const x=this.assignAssetListError(e,Q.ASSET_LIST_LOAD_ERROR,y,s);this.hls.trigger(L.ERROR,x);return}t&&i.protocol!=="data:"&&i.searchParams.set("_HLS_start_offset",""+t);const r=this.hls.config,l=r.loader,c=new l(r),h={responseType:"json",url:i.href},u=r.interstitialAssetListLoadPolicy.default,f={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},g={onSuccess:(y,x,S,E)=>{const T=y.data,A=T?.ASSETS;if(!Array.isArray(A)){const _=this.assignAssetListError(e,Q.ASSET_LIST_PARSING_ERROR,new Error("Invalid interstitial asset list"),S.url,x,E);this.hls.trigger(L.ERROR,_);return}e.assetListResponse=T,this.hls.trigger(L.ASSET_LIST_LOADED,{event:e,assetListResponse:T,networkDetails:E})},onError:(y,x,S,E)=>{const T=this.assignAssetListError(e,Q.ASSET_LIST_LOAD_ERROR,new Error(`Error loading X-ASSET-LIST: HTTP status ${y.code} ${y.text} (${x.url})`),x.url,E,S);this.hls.trigger(L.ERROR,T)},onTimeout:(y,x,S)=>{const E=this.assignAssetListError(e,Q.ASSET_LIST_LOAD_TIMEOUT,new Error(`Timeout loading X-ASSET-LIST (${x.url})`),x.url,y,S);this.hls.trigger(L.ERROR,E)}};return c.load(h,f,g),this.hls.trigger(L.ASSET_LIST_LOADING,{event:e}),c}assignAssetListError(e,t,s,i,r,l){return e.error=s,{type:Be.NETWORK_ERROR,details:t,fatal:!1,interstitial:e,url:i,error:s,networkDetails:l,stats:r}}}function fx(n){var e;n==null||(e=n.play())==null||e.catch(()=>{})}function Hc(n,e){return`[${n}] Advancing timeline position to ${e}`}class rO extends ji{constructor(e,t){super("interstitials",e.logger),this.HlsPlayerClass=void 0,this.hls=void 0,this.assetListLoader=void 0,this.mediaSelection=null,this.altSelection=null,this.media=null,this.detachedData=null,this.requiredTracks=null,this.manager=null,this.playerQueue=[],this.bufferedPos=-1,this.timelinePos=-1,this.schedule=void 0,this.playingItem=null,this.bufferingItem=null,this.waitingItem=null,this.endedItem=null,this.playingAsset=null,this.endedAsset=null,this.bufferingAsset=null,this.shouldPlay=!1,this.onPlay=()=>{this.shouldPlay=!0},this.onPause=()=>{this.shouldPlay=!1},this.onSeeking=()=>{const s=this.currentTime;if(s===void 0||this.playbackDisabled||!this.schedule)return;const i=s-this.timelinePos;if(Math.abs(i)<1/7056e5)return;const l=i<=-.01;this.timelinePos=s,this.bufferedPos=s;const c=this.playingItem;if(!c){this.checkBuffer();return}if(l&&this.schedule.resetErrorsInRange(s,s-i)&&this.updateSchedule(!0),this.checkBuffer(),l&&s<c.start||s>=c.end){var h;const x=this.findItemIndex(c);let S=this.schedule.findItemIndexAtTime(s);if(S===-1&&(S=x+(l?-1:1),this.log(`seeked ${l?"back ":""}to position not covered by schedule ${s} (resolving from ${x} to ${S})`)),!this.isInterstitial(c)&&(h=this.media)!=null&&h.paused&&(this.shouldPlay=!1),!l&&S>x){const E=this.schedule.findJumpRestrictedIndex(x+1,S);if(E>x){this.setSchedulePosition(E);return}}this.setSchedulePosition(S);return}const u=this.playingAsset;if(!u){if(this.playingLastItem&&this.isInterstitial(c)){const x=c.event.assetList[0];x&&(this.endedItem=this.playingItem,this.playingItem=null,this.setScheduleToAssetAtTime(s,x))}return}const f=u.timelineStart,g=u.duration||0;if(l&&s<f||s>=f+g){var y;(y=c.event)!=null&&y.appendInPlace&&(this.clearAssetPlayers(c.event,c),this.flushFrontBuffer(s)),this.setScheduleToAssetAtTime(s,u)}},this.onTimeupdate=()=>{const s=this.currentTime;if(s===void 0||this.playbackDisabled)return;if(s>this.timelinePos)this.timelinePos=s,s>this.bufferedPos&&this.checkBuffer();else return;const i=this.playingItem;if(!i||this.playingLastItem)return;if(s>=i.end){this.timelinePos=i.end;const c=this.findItemIndex(i);this.setSchedulePosition(c+1)}const r=this.playingAsset;if(!r)return;const l=r.timelineStart+(r.duration||0);s>=l&&this.setScheduleToAssetAtTime(s,r)},this.onScheduleUpdate=(s,i)=>{const r=this.schedule;if(!r)return;const l=this.playingItem,c=r.events||[],h=r.items||[],u=r.durations,f=s.map(E=>E.identifier),g=!!(c.length||f.length);(g||i)&&this.log(`INTERSTITIALS_UPDATED (${c.length}): ${c}
Schedule: ${h.map(E=>zi(E))} pos: ${this.timelinePos}`),f.length&&this.log(`Removed events ${f}`);let y=null,x=null;l&&(y=this.updateItem(l,this.timelinePos),this.itemsMatch(l,y)?this.playingItem=y:this.waitingItem=this.endedItem=null),this.waitingItem=this.updateItem(this.waitingItem),this.endedItem=this.updateItem(this.endedItem);const S=this.bufferingItem;if(S&&(x=this.updateItem(S,this.bufferedPos),this.itemsMatch(S,x)?this.bufferingItem=x:S.event&&(this.bufferingItem=this.playingItem,this.clearInterstitial(S.event,null))),s.forEach(E=>{E.assetList.forEach(T=>{this.clearAssetPlayer(T.identifier,null)})}),this.playerQueue.forEach(E=>{if(E.interstitial.appendInPlace){const T=E.assetItem.timelineStart,A=E.timelineOffset-T;if(A)try{E.timelineOffset=T}catch(_){Math.abs(A)>Vr&&this.warn(`${_} ("${E.assetId}" ${E.timelineOffset}->${T})`)}}}),g||i){if(this.hls.trigger(L.INTERSTITIALS_UPDATED,{events:c.slice(0),schedule:h.slice(0),durations:u,removedIds:f}),this.isInterstitial(l)&&f.includes(l.event.identifier)){this.warn(`Interstitial "${l.event.identifier}" removed while playing`),this.primaryFallback(l.event);return}l&&this.trimInPlace(y,l),S&&x!==y&&this.trimInPlace(x,S),this.checkBuffer()}},this.hls=e,this.HlsPlayerClass=t,this.assetListLoader=new aO(e),this.schedule=new nO(this.onScheduleUpdate,e.logger),this.registerListeners()}registerListeners(){const e=this.hls;e&&(e.on(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(L.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(L.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.on(L.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(L.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.on(L.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.on(L.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.on(L.BUFFER_APPENDED,this.onBufferAppended,this),e.on(L.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(L.BUFFERED_TO_END,this.onBufferedToEnd,this),e.on(L.MEDIA_ENDED,this.onMediaEnded,this),e.on(L.ERROR,this.onError,this),e.on(L.DESTROYING,this.onDestroying,this))}unregisterListeners(){const e=this.hls;e&&(e.off(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(L.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(L.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.off(L.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(L.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.off(L.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.off(L.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.off(L.BUFFER_CODECS,this.onBufferCodecs,this),e.off(L.BUFFER_APPENDED,this.onBufferAppended,this),e.off(L.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(L.BUFFERED_TO_END,this.onBufferedToEnd,this),e.off(L.MEDIA_ENDED,this.onMediaEnded,this),e.off(L.ERROR,this.onError,this),e.off(L.DESTROYING,this.onDestroying,this))}startLoad(){this.resumeBuffering()}stopLoad(){this.pauseBuffering()}resumeBuffering(){var e;(e=this.getBufferingPlayer())==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.getBufferingPlayer())==null||e.pauseBuffering()}destroy(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.schedule=this.manager=null,this.hls=this.HlsPlayerClass=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null}onDestroying(){const e=this.primaryMedia||this.media;e&&this.removeMediaListeners(e)}removeMediaListeners(e){ei(e,"play",this.onPlay),ei(e,"pause",this.onPause),ei(e,"seeking",this.onSeeking),ei(e,"timeupdate",this.onTimeupdate)}onMediaAttaching(e,t){const s=this.media=t.media;$s(s,"seeking",this.onSeeking),$s(s,"timeupdate",this.onTimeupdate),$s(s,"play",this.onPlay),$s(s,"pause",this.onPause)}onMediaAttached(e,t){const s=this.effectivePlayingItem,i=this.detachedData;if(this.detachedData=null,s===null)this.checkStart();else if(!i){this.clearScheduleState();const r=this.findItemIndex(s);this.setSchedulePosition(r)}}clearScheduleState(){this.log("clear schedule state"),this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null}onMediaDetaching(e,t){const s=!!t.transferMedia,i=this.media;if(this.media=null,!s&&(i&&this.removeMediaListeners(i),this.detachedData)){const r=this.getBufferingPlayer();r&&(this.log(`Removing schedule state for detachedData and ${r}`),this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,r.detachMedia()),this.shouldPlay=!1}}get interstitialsManager(){if(!this.hls)return null;if(this.manager)return this.manager;const e=this,t=()=>e.bufferingItem||e.waitingItem,s=g=>g&&e.getAssetPlayer(g.identifier),i=(g,y,x,S,E)=>{if(g){let T=g[y].start;const A=g.event;if(A){if(y==="playout"||A.timelineOccupancy!==Au.Point){const _=s(x);_?.interstitial===A&&(T+=_.assetItem.startOffset+_[E])}}else{const _=S==="bufferedPos"?l():e[S];T+=_-g.start}return T}return 0},r=(g,y)=>{var x;if(g!==0&&y!=="primary"&&(x=e.schedule)!=null&&x.length){var S;const E=e.schedule.findItemIndexAtTime(g),T=(S=e.schedule.items)==null?void 0:S[E];if(T){const A=T[y].start-T.start;return g+A}}return g},l=()=>{const g=e.bufferedPos;return g===Number.MAX_VALUE?c("primary"):Math.max(g,0)},c=g=>{var y,x;return(y=e.primaryDetails)!=null&&y.live?e.primaryDetails.edge:((x=e.schedule)==null?void 0:x.durations[g])||0},h=(g,y)=>{var x,S;const E=e.effectivePlayingItem;if(E!=null&&(x=E.event)!=null&&x.restrictions.skip||!e.schedule)return;e.log(`seek to ${g} "${y}"`);const T=e.effectivePlayingItem,A=e.schedule.findItemIndexAtTime(g,y),_=(S=e.schedule.items)==null?void 0:S[A],I=e.getBufferingPlayer(),C=I?.interstitial,N=C?.appendInPlace,D=T&&e.itemsMatch(T,_);if(T&&(N||D)){const k=s(e.playingAsset),B=k?.media||e.primaryMedia;if(B){const j=y==="primary"?B.currentTime:i(T,y,e.playingAsset,"timelinePos","currentTime"),U=g-j,K=(N?j:B.currentTime)+U;if(K>=0&&(!k||N||K<=k.duration)){B.currentTime=K;return}}}if(_){let k=g;if(y!=="primary"){const j=_[y].start,U=g-j;k=_.start+U}const B=!e.isInterstitial(_);if((!e.isInterstitial(T)||T.event.appendInPlace)&&(B||_.event.appendInPlace)){const j=e.media||(N?I?.media:null);j&&(j.currentTime=k)}else if(T){const j=e.findItemIndex(T);if(A>j){const K=e.schedule.findJumpRestrictedIndex(j+1,A);if(K>j){e.setSchedulePosition(K);return}}let U=0;if(B)e.timelinePos=k,e.checkBuffer();else{const K=_.event.assetList,H=g-(_[y]||_).start;for(let J=K.length;J--;){const re=K[J];if(re.duration&&H>=re.startOffset&&H<re.startOffset+re.duration){U=J;break}}}e.setSchedulePosition(A,U)}}},u=()=>{const g=e.effectivePlayingItem;if(e.isInterstitial(g))return g;const y=t();return e.isInterstitial(y)?y:null},f={get bufferedEnd(){const g=t(),y=e.bufferingItem;if(y&&y===g){var x;return i(y,"playout",e.bufferingAsset,"bufferedPos","bufferedEnd")-y.playout.start||((x=e.bufferingAsset)==null?void 0:x.startOffset)||0}return 0},get currentTime(){const g=u(),y=e.effectivePlayingItem;return y&&y===g?i(y,"playout",e.effectivePlayingAsset,"timelinePos","currentTime")-y.playout.start:0},set currentTime(g){const y=u(),x=e.effectivePlayingItem;x&&x===y&&h(g+x.playout.start,"playout")},get duration(){const g=u();return g?g.playout.end-g.playout.start:0},get assetPlayers(){var g;const y=(g=u())==null?void 0:g.event.assetList;return y?y.map(x=>e.getAssetPlayer(x.identifier)):[]},get playingIndex(){var g;const y=(g=u())==null?void 0:g.event;return y&&e.effectivePlayingAsset?y.findAssetIndex(e.effectivePlayingAsset):-1},get scheduleItem(){return u()}};return this.manager={get events(){var g;return((g=e.schedule)==null||(g=g.events)==null?void 0:g.slice(0))||[]},get schedule(){var g;return((g=e.schedule)==null||(g=g.items)==null?void 0:g.slice(0))||[]},get interstitialPlayer(){return u()?f:null},get playerQueue(){return e.playerQueue.slice(0)},get bufferingAsset(){return e.bufferingAsset},get bufferingItem(){return t()},get bufferingIndex(){const g=t();return e.findItemIndex(g)},get playingAsset(){return e.effectivePlayingAsset},get playingItem(){return e.effectivePlayingItem},get playingIndex(){const g=e.effectivePlayingItem;return e.findItemIndex(g)},primary:{get bufferedEnd(){return l()},get currentTime(){const g=e.timelinePos;return g>0?g:0},set currentTime(g){h(g,"primary")},get duration(){return c("primary")},get seekableStart(){var g;return((g=e.primaryDetails)==null?void 0:g.fragmentStart)||0}},integrated:{get bufferedEnd(){return i(t(),"integrated",e.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return i(e.effectivePlayingItem,"integrated",e.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(g){h(g,"integrated")},get duration(){return c("integrated")},get seekableStart(){var g;return r(((g=e.primaryDetails)==null?void 0:g.fragmentStart)||0,"integrated")}},skip:()=>{const g=e.effectivePlayingItem,y=g?.event;if(y&&!y.restrictions.skip){const x=e.findItemIndex(g);if(y.appendInPlace){const S=g.playout.start+g.event.duration;h(S+.001,"playout")}else e.advanceAfterAssetEnded(y,x,1/0)}}}}get effectivePlayingItem(){return this.waitingItem||this.playingItem||this.endedItem}get effectivePlayingAsset(){return this.playingAsset||this.endedAsset}get playingLastItem(){var e;const t=this.playingItem,s=(e=this.schedule)==null?void 0:e.items;return!this.playbackStarted||!t||!s?!1:this.findItemIndex(t)===s.length-1}get playbackStarted(){return this.effectivePlayingItem!==null}get currentTime(){var e,t;if(this.mediaSelection===null)return;const s=this.waitingItem||this.playingItem;if(this.isInterstitial(s)&&!s.event.appendInPlace)return;let i=this.media;!i&&(e=this.bufferingItem)!=null&&(e=e.event)!=null&&e.appendInPlace&&(i=this.primaryMedia);const r=(t=i)==null?void 0:t.currentTime;if(!(r===void 0||!Ne(r)))return r}get primaryMedia(){var e;return this.media||((e=this.detachedData)==null?void 0:e.media)||null}isInterstitial(e){return!!(e!=null&&e.event)}retreiveMediaSource(e,t){const s=this.getAssetPlayer(e);s&&this.transferMediaFromPlayer(s,t)}transferMediaFromPlayer(e,t){const s=e.interstitial.appendInPlace,i=e.media;if(s&&i===this.primaryMedia){if(this.bufferingAsset=null,(!t||this.isInterstitial(t)&&!t.event.appendInPlace)&&t&&i){this.detachedData={media:i};return}const r=e.transferMedia();this.log(`transfer MediaSource from ${e} ${Mt(r)}`),this.detachedData=r}else t&&i&&(this.shouldPlay||(this.shouldPlay=!i.paused))}transferMediaTo(e,t){var s,i;if(e.media===t)return;let r=null;const l=this.hls,c=e!==l,h=c&&e.interstitial.appendInPlace,u=(s=this.detachedData)==null?void 0:s.mediaSource;let f;if(l.media)h&&(r=l.transferMedia(),this.detachedData=r),f="Primary";else if(u){const S=this.getBufferingPlayer();S?(r=S.transferMedia(),f=`${S}`):f="detached MediaSource"}else f="detached media";if(!r){if(u)r=this.detachedData,this.log(`using detachedData: MediaSource ${Mt(r)}`);else if(!this.detachedData||l.media===t){const S=this.playerQueue;S.length>1&&S.forEach(E=>{if(c&&E.interstitial.appendInPlace!==h){const T=E.interstitial;this.clearInterstitial(E.interstitial,null),T.appendInPlace=!1,T.appendInPlace&&this.warn(`Could not change append strategy for queued assets ${T}`)}}),this.hls.detachMedia(),this.detachedData={media:t}}}const g=r&&"mediaSource"in r&&((i=r.mediaSource)==null?void 0:i.readyState)!=="closed",y=g&&r?r:t;this.log(`${g?"transfering MediaSource":"attaching media"} to ${c?e:"Primary"} from ${f} (media.currentTime: ${t.currentTime})`);const x=this.schedule;if(y===r&&x){const S=c&&e.assetId===x.assetIdAtEnd;y.overrides={duration:x.duration,endOfStream:!c||S,cueRemoval:!c}}e.attachMedia(y)}onInterstitialCueEnter(){this.onTimeupdate()}checkStart(){const e=this.schedule,t=e?.events;if(!t||this.playbackDisabled||!this.media)return;this.bufferedPos===-1&&(this.bufferedPos=0);const s=this.timelinePos,i=this.effectivePlayingItem;if(s===-1){const r=this.hls.startPosition;if(this.log(Hc("checkStart",r)),this.timelinePos=r,t.length&&t[0].cue.pre){const l=e.findEventIndex(t[0].identifier);this.setSchedulePosition(l)}else if(r>=0||!this.primaryLive){const l=this.timelinePos=r>0?r:0,c=e.findItemIndexAtTime(l);this.setSchedulePosition(c)}}else if(i&&!this.playingItem){const r=e.findItemIndex(i);this.setSchedulePosition(r)}}advanceAssetBuffering(e,t){const s=e.event,i=s.findAssetIndex(t),r=Sf(s,i);if(!s.isAssetPastPlayoutLimit(r))this.bufferedToEvent(e,r);else if(this.schedule){var l;const c=(l=this.schedule.items)==null?void 0:l[this.findItemIndex(e)+1];c&&this.bufferedToItem(c)}}advanceAfterAssetEnded(e,t,s){const i=Sf(e,s);if(e.isAssetPastPlayoutLimit(i)){if(this.schedule){const r=this.schedule.items;if(r){const l=t+1,c=r.length;if(l>=c){this.setSchedulePosition(-1);return}const h=e.resumeTime;this.timelinePos<h&&(this.log(Hc("advanceAfterAssetEnded",h)),this.timelinePos=h,e.appendInPlace&&this.advanceInPlace(h),this.checkBuffer(this.bufferedPos<h)),this.setSchedulePosition(l)}}}else{if(e.appendInPlace){const r=e.assetList[i];r&&this.advanceInPlace(r.timelineStart)}this.setSchedulePosition(t,i)}}setScheduleToAssetAtTime(e,t){const s=this.schedule;if(!s)return;const i=t.parentIdentifier,r=s.getEvent(i);if(r){const l=s.findEventIndex(i),c=s.findAssetIndex(r,e);this.advanceAfterAssetEnded(r,l,c-1)}}setSchedulePosition(e,t){var s;const i=(s=this.schedule)==null?void 0:s.items;if(!i||this.playbackDisabled)return;const r=e>=0?i[e]:null;this.log(`setSchedulePosition ${e}, ${t} (${r&&zi(r)}) pos: ${this.timelinePos}`);const l=this.waitingItem||this.playingItem,c=this.playingLastItem;if(this.isInterstitial(l)){const f=l.event,g=this.playingAsset,y=g?.identifier,x=y?this.getAssetPlayer(y):null;if(x&&y&&(!this.eventItemsMatch(l,r)||t!==void 0&&y!==f.assetList[t].identifier)){var h;const S=f.findAssetIndex(g);if(this.log(`INTERSTITIAL_ASSET_ENDED ${S+1}/${f.assetList.length} ${Ur(g)}`),this.endedAsset=g,this.playingAsset=null,this.hls.trigger(L.INTERSTITIAL_ASSET_ENDED,{asset:g,assetListIndex:S,event:f,schedule:i.slice(0),scheduleIndex:e,player:x}),l!==this.playingItem){this.itemsMatch(l,this.playingItem)&&!this.playingAsset&&this.advanceAfterAssetEnded(f,this.findItemIndex(this.playingItem),S);return}this.retreiveMediaSource(y,r),x.media&&!((h=this.detachedData)!=null&&h.mediaSource)&&x.detachMedia()}if(!this.eventItemsMatch(l,r)&&(this.endedItem=l,this.playingItem=null,this.log(`INTERSTITIAL_ENDED ${f} ${zi(l)}`),f.hasPlayed=!0,this.hls.trigger(L.INTERSTITIAL_ENDED,{event:f,schedule:i.slice(0),scheduleIndex:e}),f.cue.once)){var u;this.updateSchedule();const S=(u=this.schedule)==null?void 0:u.items;if(r&&S){const E=this.findItemIndex(r);this.advanceSchedule(E,S,t,l,c)}return}}this.advanceSchedule(e,i,t,l,c)}advanceSchedule(e,t,s,i,r){const l=this.schedule;if(!l)return;const c=t[e]||null,h=this.primaryMedia,u=this.playerQueue;if(u.length&&u.forEach(f=>{const g=f.interstitial,y=l.findEventIndex(g.identifier);(y<e||y>e+1)&&this.clearInterstitial(g,c)}),this.isInterstitial(c)){this.timelinePos=Math.min(Math.max(this.timelinePos,c.start),c.end);const f=c.event;if(s===void 0){s=l.findAssetIndex(f,this.timelinePos);const S=Sf(f,s-1);if(f.isAssetPastPlayoutLimit(S)||f.appendInPlace&&this.timelinePos===c.end){this.advanceAfterAssetEnded(f,e,s);return}s=S}const g=this.waitingItem;this.assetsBuffered(c,h)||this.setBufferingItem(c);let y=this.preloadAssets(f,s);if(this.eventItemsMatch(c,g||i)||(this.waitingItem=c,this.log(`INTERSTITIAL_STARTED ${zi(c)} ${f.appendInPlace?"append in place":""}`),this.hls.trigger(L.INTERSTITIAL_STARTED,{event:f,schedule:t.slice(0),scheduleIndex:e})),!f.assetListLoaded){this.log(`Waiting for ASSET-LIST to complete loading ${f}`);return}if(f.assetListLoader&&(f.assetListLoader.destroy(),f.assetListLoader=void 0),!h){this.log(`Waiting for attachMedia to start Interstitial ${f}`);return}this.waitingItem=this.endedItem=null,this.playingItem=c;const x=f.assetList[s];if(!x){this.advanceAfterAssetEnded(f,e,s||0);return}if(y||(y=this.getAssetPlayer(x.identifier)),y===null||y.destroyed){const S=f.assetList.length;this.warn(`asset ${s+1}/${S} player destroyed ${f}`),y=this.createAssetPlayer(f,x,s),y.loadSource()}if(!this.eventItemsMatch(c,this.bufferingItem)&&f.appendInPlace&&this.isAssetBuffered(x))return;this.startAssetPlayer(y,s,t,e,h),this.shouldPlay&&fx(y.media)}else c?(this.resumePrimary(c,e,i),this.shouldPlay&&fx(this.hls.media)):r&&this.isInterstitial(i)&&(this.endedItem=null,this.playingItem=i,i.event.appendInPlace||this.attachPrimary(l.durations.primary,null))}get playbackDisabled(){return this.hls.config.enableInterstitialPlayback===!1}get primaryDetails(){var e;return(e=this.mediaSelection)==null?void 0:e.main.details}get primaryLive(){var e;return!!((e=this.primaryDetails)!=null&&e.live)}resumePrimary(e,t,s){var i,r;if(this.playingItem=e,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(e),this.log(`resuming ${zi(e)}`),!((i=this.detachedData)!=null&&i.mediaSource)){let c=this.timelinePos;(c<e.start||c>=e.end)&&(c=this.getPrimaryResumption(e,t),this.log(Hc("resumePrimary",c)),this.timelinePos=c),this.attachPrimary(c,e)}if(!s)return;const l=(r=this.schedule)==null?void 0:r.items;l&&(this.log(`INTERSTITIALS_PRIMARY_RESUMED ${zi(e)}`),this.hls.trigger(L.INTERSTITIALS_PRIMARY_RESUMED,{schedule:l.slice(0),scheduleIndex:t}),this.checkBuffer())}getPrimaryResumption(e,t){const s=e.start;if(this.primaryLive){const i=this.primaryDetails;if(t===0)return this.hls.startPosition;if(i&&(s<i.fragmentStart||s>i.edge))return this.hls.liveSyncPosition||-1}return s}isAssetBuffered(e){const t=this.getAssetPlayer(e.identifier);return t!=null&&t.hls?t.hls.bufferedToEnd:qe.bufferInfo(this.primaryMedia,this.timelinePos,0).end+1>=e.timelineStart+(e.duration||0)}attachPrimary(e,t,s){t?this.setBufferingItem(t):this.bufferingItem=this.playingItem,this.bufferingAsset=null;const i=this.primaryMedia;if(!i)return;const r=this.hls;r.media?this.checkBuffer():(this.transferMediaTo(r,i),s&&this.startLoadingPrimaryAt(e,s)),s||(this.log(Hc("attachPrimary",e)),this.timelinePos=e,this.startLoadingPrimaryAt(e,s))}startLoadingPrimaryAt(e,t){var s;const i=this.hls;!i.loadingEnabled||!i.media||Math.abs((((s=i.mainForwardBufferInfo)==null?void 0:s.start)||i.media.currentTime)-e)>.5?i.startLoad(e,t):i.bufferingEnabled||i.resumeBuffering()}onManifestLoading(){var e;this.stopLoad(),(e=this.schedule)==null||e.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off(L.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on(L.BUFFER_CODECS,this.onBufferCodecs,this)}onLevelUpdated(e,t){if(t.level===-1||!this.schedule)return;const s=this.hls.levels[t.level];if(!s.details)return;const i=Rt(Rt({},this.mediaSelection||this.altSelection),{},{main:s});this.mediaSelection=i,this.schedule.parseInterstitialDateRanges(i,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}onAudioTrackUpdated(e,t){const s=this.hls.audioTracks[t.id],i=this.mediaSelection;if(!i){this.altSelection=Rt(Rt({},this.altSelection),{},{audio:s});return}const r=Rt(Rt({},i),{},{audio:s});this.mediaSelection=r}onSubtitleTrackUpdated(e,t){const s=this.hls.subtitleTracks[t.id],i=this.mediaSelection;if(!i){this.altSelection=Rt(Rt({},this.altSelection),{},{subtitles:s});return}const r=Rt(Rt({},i),{},{subtitles:s});this.mediaSelection=r}onAudioTrackSwitching(e,t){const s=Tv(t);this.playerQueue.forEach(({hls:i})=>i&&(i.setAudioOption(t)||i.setAudioOption(s)))}onSubtitleTrackSwitch(e,t){const s=Tv(t);this.playerQueue.forEach(({hls:i})=>i&&(i.setSubtitleOption(t)||t.id!==-1&&i.setSubtitleOption(s)))}onBufferCodecs(e,t){const s=t.tracks;s&&(this.requiredTracks=s)}onBufferAppended(e,t){this.checkBuffer()}onBufferFlushed(e,t){const s=this.playingItem;if(s&&!this.itemsMatch(s,this.bufferingItem)&&!this.isInterstitial(s)){const i=this.timelinePos;this.bufferedPos=i,this.checkBuffer()}}onBufferedToEnd(e){if(!this.schedule)return;const t=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&t){for(let i=0;i<t.length;i++){const r=t[i];if(r.cue.post){var s;const l=this.schedule.findEventIndex(r.identifier),c=(s=this.schedule.items)==null?void 0:s[l];this.isInterstitial(c)&&this.eventItemsMatch(c,this.bufferingItem)&&this.bufferedToItem(c,0);break}}this.bufferedPos=Number.MAX_VALUE}}onMediaEnded(e){const t=this.playingItem;if(!this.playingLastItem&&t){const s=this.findItemIndex(t);this.setSchedulePosition(s+1)}else this.shouldPlay=!1}updateItem(e,t){var s;const i=(s=this.schedule)==null?void 0:s.items;if(e&&i){const r=this.findItemIndex(e,t);return i[r]||null}return null}trimInPlace(e,t){if(this.isInterstitial(e)&&e.event.appendInPlace&&t.end-e.end>.25){e.event.assetList.forEach((r,l)=>{e.event.isAssetPastPlayoutLimit(l)&&this.clearAssetPlayer(r.identifier,null)});const s=e.end+.25,i=qe.bufferInfo(this.primaryMedia,s,0);(i.end>s||(i.nextStart||0)>s)&&(this.log(`trim buffered interstitial ${zi(e)} (was ${zi(t)})`),this.attachPrimary(s,null,!0),this.flushFrontBuffer(s))}}itemsMatch(e,t){return!!t&&(e===t||e.event&&t.event&&this.eventItemsMatch(e,t)||!e.event&&!t.event&&this.findItemIndex(e)===this.findItemIndex(t))}eventItemsMatch(e,t){var s;return!!t&&(e===t||e.event.identifier===((s=t.event)==null?void 0:s.identifier))}findItemIndex(e,t){return e&&this.schedule?this.schedule.findItemIndex(e,t):-1}updateSchedule(e=!1){var t;const s=this.mediaSelection;s&&((t=this.schedule)==null||t.updateSchedule(s,[],e))}checkBuffer(e){var t;const s=(t=this.schedule)==null?void 0:t.items;if(!s)return;const i=qe.bufferInfo(this.primaryMedia,this.timelinePos,0);e&&(this.bufferedPos=this.timelinePos),e||(e=i.len<1),this.updateBufferedPos(i.end,s,e)}updateBufferedPos(e,t,s){const i=this.schedule,r=this.bufferingItem;if(this.bufferedPos>e||!i)return;if(t.length===1&&this.itemsMatch(t[0],r)){this.bufferedPos=e;return}const l=this.playingItem,c=this.findItemIndex(l);let h=i.findItemIndexAtTime(e);if(this.bufferedPos<e){var u;const f=this.findItemIndex(r),g=Math.min(f+1,t.length-1),y=t[g];if((h===-1&&r&&e>=r.end||(u=y.event)!=null&&u.appendInPlace&&e+.01>=y.start)&&(h=g),this.isInterstitial(r)){const x=r.event;if(g-c>1&&x.appendInPlace===!1||x.assetList.length===0&&x.assetListLoader)return}if(this.bufferedPos=e,h>f&&h>c)this.bufferedToItem(y);else{const x=this.primaryDetails;this.primaryLive&&x&&e>x.edge-x.targetduration&&y.start<x.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(y)&&this.preloadAssets(y.event,0)}}else s&&l&&!this.itemsMatch(l,r)&&(h===c?this.bufferedToItem(l):h===c+1&&this.bufferedToItem(t[h]))}assetsBuffered(e,t){return e.event.assetList.length===0?!1:!e.event.assetList.some(i=>{const r=this.getAssetPlayer(i.identifier);return!(r!=null&&r.bufferedInPlaceToEnd(t))})}setBufferingItem(e){const t=this.bufferingItem,s=this.schedule;if(!this.itemsMatch(e,t)&&s){const{items:i,events:r}=s;if(!i||!r)return t;const l=this.isInterstitial(e),c=this.getBufferingPlayer();this.bufferingItem=e,this.bufferedPos=Math.max(e.start,Math.min(e.end,this.timelinePos));const h=c?c.remaining:t?t.end-this.timelinePos:0;if(this.log(`INTERSTITIALS_BUFFERED_TO_BOUNDARY ${zi(e)}`+(t?` (${h.toFixed(2)} remaining)`:"")),!this.playbackDisabled)if(l){const u=s.findAssetIndex(e.event,this.bufferedPos);e.event.assetList.forEach((f,g)=>{const y=this.getAssetPlayer(f.identifier);y&&(g===u&&y.loadSource(),y.resumeBuffering())})}else this.hls.resumeBuffering(),this.playerQueue.forEach(u=>u.pauseBuffering());this.hls.trigger(L.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:r.slice(0),schedule:i.slice(0),bufferingIndex:this.findItemIndex(e),playingIndex:this.findItemIndex(this.playingItem)})}else this.bufferingItem!==e&&(this.bufferingItem=e);return t}bufferedToItem(e,t=0){const s=this.setBufferingItem(e);if(!this.playbackDisabled){if(this.isInterstitial(e))this.bufferedToEvent(e,t);else if(s!==null){this.bufferingAsset=null;const i=this.detachedData;i?i.mediaSource?this.attachPrimary(e.start,e,!0):this.preloadPrimary(e):this.preloadPrimary(e)}}}preloadPrimary(e){const t=this.findItemIndex(e),s=this.getPrimaryResumption(e,t);this.startLoadingPrimaryAt(s)}bufferedToEvent(e,t){const s=e.event,i=s.assetList.length===0&&!s.assetListLoader,r=s.cue.once;if(i||!r){const l=this.preloadAssets(s,t);if(l!=null&&l.interstitial.appendInPlace){const c=this.primaryMedia;c&&this.bufferAssetPlayer(l,c)}}}preloadAssets(e,t){const s=e.assetUrl,i=e.assetList.length,r=i===0&&!e.assetListLoader,l=e.cue.once;if(r){const h=e.timelineStart;if(e.appendInPlace){var c;const y=this.playingItem;!this.isInterstitial(y)&&(y==null||(c=y.nextEvent)==null?void 0:c.identifier)===e.identifier&&this.flushFrontBuffer(h+.25)}let u,f=0;if(!this.playingItem&&this.primaryLive&&(f=this.hls.startPosition,f===-1&&(f=this.hls.liveSyncPosition||0)),f&&!(e.cue.pre||e.cue.post)){const y=f-h;y>0&&(u=Math.round(y*1e3)/1e3)}if(this.log(`Load interstitial asset ${t+1}/${s?1:i} ${e}${u?` live-start: ${f} start-offset: ${u}`:""}`),s)return this.createAsset(e,0,0,h,e.duration,s);const g=this.assetListLoader.loadAssetList(e,u);g&&(e.assetListLoader=g)}else if(!l&&i){for(let u=t;u<i;u++){const f=e.assetList[u],g=this.getAssetPlayerQueueIndex(f.identifier);(g===-1||this.playerQueue[g].destroyed)&&!f.error&&this.createAssetPlayer(e,f,u)}const h=e.assetList[t];if(h){const u=this.getAssetPlayer(h.identifier);return u&&u.loadSource(),u}}return null}flushFrontBuffer(e){const t=this.requiredTracks;if(!t)return;this.log(`Removing front buffer starting at ${e}`),Object.keys(t).forEach(i=>{this.hls.trigger(L.BUFFER_FLUSHING,{startOffset:e,endOffset:1/0,type:i})})}getAssetPlayerQueueIndex(e){const t=this.playerQueue;for(let s=0;s<t.length;s++)if(e===t[s].assetId)return s;return-1}getAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);return this.playerQueue[t]||null}getBufferingPlayer(){const{playerQueue:e,primaryMedia:t}=this;if(t){for(let s=0;s<e.length;s++)if(e[s].media===t)return e[s]}return null}createAsset(e,t,s,i,r,l){const c={parentIdentifier:e.identifier,identifier:eO(e,l,t),duration:r,startOffset:s,timelineStart:i,uri:l};return this.createAssetPlayer(e,c,t)}createAssetPlayer(e,t,s){const i=this.hls,r=i.userConfig;let l=r.videoPreference;const c=i.loadLevelObj||i.levels[i.currentLevel];(l||c)&&(l=Dt({},l),c.videoCodec&&(l.videoCodec=c.videoCodec),c.videoRange&&(l.allowedVideoRanges=[c.videoRange]));const h=i.audioTracks[i.audioTrack],u=i.subtitleTracks[i.subtitleTrack];let f=0;if(this.primaryLive||e.appendInPlace){const C=this.timelinePos-t.timelineStart;if(C>1){const N=t.duration;N&&C<N&&(f=C)}}const g=t.identifier,y=Rt(Rt({},r),{},{maxMaxBufferLength:Math.min(180,i.config.maxMaxBufferLength),autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:i.sessionId,assetPlayerId:g,abrEwmaDefaultEstimate:i.bandwidthEstimate,interstitialsController:void 0,startPosition:f,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:l,audioPreference:h||r.audioPreference,subtitlePreference:u||r.subtitlePreference});e.appendInPlace&&(e.appendInPlaceStarted=!0,t.timelineStart&&(y.timelineOffset=t.timelineStart));const x=y.cmcd;x!=null&&x.sessionId&&x.contentId&&(y.cmcd=Dt({},x,{contentId:Yl(t.uri)})),this.getAssetPlayer(g)&&this.warn(`Duplicate date range identifier ${e} and asset ${g}`);const S=new iO(this.HlsPlayerClass,y,e,t);this.playerQueue.push(S),e.assetList[s]=t;let E=!0;const T=C=>{if(C.live){var N;const B=new Error(`Interstitials MUST be VOD assets ${e}`),j={fatal:!0,type:Be.OTHER_ERROR,details:Q.INTERSTITIAL_ASSET_ITEM_ERROR,error:B},U=((N=this.schedule)==null?void 0:N.findEventIndex(e.identifier))||-1;this.handleAssetItemError(j,e,U,s,B.message);return}const D=C.edge-C.fragmentStart,k=t.duration;(E||k===null||D>k)&&(E=!1,this.log(`Interstitial asset "${g}" duration change ${k} > ${D}`),t.duration=D,this.updateSchedule())};S.on(L.LEVEL_UPDATED,(C,{details:N})=>T(N)),S.on(L.LEVEL_PTS_UPDATED,(C,{details:N})=>T(N)),S.on(L.EVENT_CUE_ENTER,()=>this.onInterstitialCueEnter());const A=(C,N)=>{const D=this.getAssetPlayer(g);if(D&&N.tracks){D.off(L.BUFFER_CODECS,A),D.tracks=N.tracks;const k=this.primaryMedia;this.bufferingAsset===D.assetItem&&k&&!D.media&&this.bufferAssetPlayer(D,k)}};S.on(L.BUFFER_CODECS,A);const _=()=>{var C;const N=this.getAssetPlayer(g);if(this.log(`buffered to end of asset ${N}`),!N||!this.schedule)return;const D=this.schedule.findEventIndex(e.identifier),k=(C=this.schedule.items)==null?void 0:C[D];this.isInterstitial(k)&&this.advanceAssetBuffering(k,t)};S.on(L.BUFFERED_TO_END,_);const I=C=>()=>{if(!this.getAssetPlayer(g)||!this.schedule)return;this.shouldPlay=!0;const D=this.schedule.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,D,C)};return S.once(L.MEDIA_ENDED,I(s)),S.once(L.PLAYOUT_LIMIT_REACHED,I(1/0)),S.on(L.ERROR,(C,N)=>{if(!this.schedule)return;const D=this.getAssetPlayer(g);if(N.details===Q.BUFFER_STALLED_ERROR){if(D!=null&&D.appendInPlace){this.handleInPlaceStall(e);return}this.onTimeupdate(),this.checkBuffer(!0);return}this.handleAssetItemError(N,e,this.schedule.findEventIndex(e.identifier),s,`Asset player error ${N.error} ${e}`)}),S.on(L.DESTROYING,()=>{if(!this.getAssetPlayer(g)||!this.schedule)return;const N=new Error(`Asset player destroyed unexpectedly ${g}`),D={fatal:!0,type:Be.OTHER_ERROR,details:Q.INTERSTITIAL_ASSET_ITEM_ERROR,error:N};this.handleAssetItemError(D,e,this.schedule.findEventIndex(e.identifier),s,N.message)}),this.log(`INTERSTITIAL_ASSET_PLAYER_CREATED ${Ur(t)}`),this.hls.trigger(L.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:t,assetListIndex:s,event:e,player:S}),S}clearInterstitial(e,t){this.clearAssetPlayers(e,t),e.reset()}clearAssetPlayers(e,t){e.assetList.forEach(s=>{this.clearAssetPlayer(s.identifier,t)})}resetAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);if(t!==-1){this.log(`reset asset player "${e}" after error`);const s=this.playerQueue[t];this.transferMediaFromPlayer(s,null),s.resetDetails()}}clearAssetPlayer(e,t){const s=this.getAssetPlayerQueueIndex(e);if(s!==-1){const i=this.playerQueue[s];this.log(`clear ${i} toSegment: ${t&&zi(t)}`),this.transferMediaFromPlayer(i,t),this.playerQueue.splice(s,1),i.destroy()}}emptyPlayerQueue(){let e;for(;e=this.playerQueue.pop();)e.destroy();this.playerQueue=[]}startAssetPlayer(e,t,s,i,r){const{interstitial:l,assetItem:c,assetId:h}=e,u=l.assetList.length,f=this.playingAsset;this.endedAsset=null,this.playingAsset=c,(!f||f.identifier!==h)&&(f&&(this.clearAssetPlayer(f.identifier,s[i]),delete f.error),this.log(`INTERSTITIAL_ASSET_STARTED ${t+1}/${u} ${Ur(c)}`),this.hls.trigger(L.INTERSTITIAL_ASSET_STARTED,{asset:c,assetListIndex:t,event:l,schedule:s.slice(0),scheduleIndex:i,player:e})),this.bufferAssetPlayer(e,r)}bufferAssetPlayer(e,t){var s,i;if(!this.schedule)return;const{interstitial:r,assetItem:l}=e,c=this.schedule.findEventIndex(r.identifier),h=(s=this.schedule.items)==null?void 0:s[c];if(!h)return;e.loadSource(),this.setBufferingItem(h),this.bufferingAsset=l;const u=this.getBufferingPlayer();if(u===e)return;const f=r.appendInPlace;if(f&&u?.interstitial.appendInPlace===!1)return;const g=u?.tracks||((i=this.detachedData)==null?void 0:i.tracks)||this.requiredTracks;if(f&&l!==this.playingAsset){if(!e.tracks){this.log(`Waiting for track info before buffering ${e}`);return}if(g&&!TS(g,e.tracks)){const y=new Error(`Asset ${Ur(l)} SourceBuffer tracks ('${Object.keys(e.tracks)}') are not compatible with primary content tracks ('${Object.keys(g)}')`),x={fatal:!0,type:Be.OTHER_ERROR,details:Q.INTERSTITIAL_ASSET_ITEM_ERROR,error:y},S=r.findAssetIndex(l);this.handleAssetItemError(x,r,c,S,y.message);return}}this.transferMediaTo(e,t)}handleInPlaceStall(e){const t=this.schedule,s=this.primaryMedia;if(!t||!s)return;const i=s.currentTime,r=t.findAssetIndex(e,i),l=e.assetList[r];if(l){const c=this.getAssetPlayer(l.identifier);if(c){const h=c.currentTime||i-l.timelineStart,u=c.duration-h;if(this.warn(`Stalled at ${h} of ${h+u} in ${c} ${e} (media.currentTime: ${i})`),h&&(u/s.playbackRate<.5||c.bufferedInPlaceToEnd(s))&&c.hls){const f=t.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,f,r)}}}}advanceInPlace(e){const t=this.primaryMedia;t&&t.currentTime<e&&(t.currentTime=e)}handleAssetItemError(e,t,s,i,r){if(e.details===Q.BUFFER_STALLED_ERROR)return;const l=t.assetList[i]||null;if(this.warn(`INTERSTITIAL_ASSET_ERROR ${l&&Ur(l)} ${e.error}`),!this.schedule)return;const c=l?.identifier||"",h=this.getAssetPlayerQueueIndex(c),u=this.playerQueue[h]||null,f=this.schedule.items,g=Dt({},e,{fatal:!1,errorAction:jr(!0),asset:l,assetListIndex:i,event:t,schedule:f,scheduleIndex:s,player:u});if(this.hls.trigger(L.INTERSTITIAL_ASSET_ERROR,g),!e.fatal)return;const y=this.playingAsset,x=this.bufferingAsset,S=new Error(r);if(l&&(this.clearAssetPlayer(c,null),l.error=S),!t.assetList.some(E=>!E.error))t.error=S;else for(let E=i;E<t.assetList.length;E++)this.resetAssetPlayer(t.assetList[E].identifier);this.updateSchedule(!0),t.error?this.primaryFallback(t):y&&y.identifier===c?this.advanceAfterAssetEnded(t,s,i):x&&x.identifier===c&&this.isInterstitial(this.bufferingItem)&&this.advanceAssetBuffering(this.bufferingItem,x)}primaryFallback(e){const t=e.timelineStart,s=this.effectivePlayingItem;let i=this.timelinePos;if(s){this.log(`Fallback to primary from event "${e.identifier}" start: ${t} pos: ${i} playing: ${zi(s)} error: ${e.error}`),i===-1&&(i=this.hls.startPosition);const l=this.updateItem(s,i);this.itemsMatch(s,l)&&this.clearInterstitial(e,null),e.appendInPlace&&(this.attachPrimary(t,null),this.flushFrontBuffer(t))}else if(i===-1){this.checkStart();return}if(!this.schedule)return;const r=this.schedule.findItemIndexAtTime(i);this.setSchedulePosition(r)}onAssetListLoaded(e,t){var s,i;const r=t.event,l=r.identifier,c=t.assetListResponse.ASSETS;if(!((s=this.schedule)!=null&&s.hasEvent(l)))return;const h=r.timelineStart,u=r.duration;let f=0;c.forEach((E,T)=>{const A=parseFloat(E.DURATION);this.createAsset(r,T,f,h+f,A,E.URI),f+=A}),r.duration=f,this.log(`Loaded asset-list with duration: ${f} (was: ${u}) ${r}`);const g=this.waitingItem,y=g?.event.identifier===l;this.updateSchedule();const x=(i=this.bufferingItem)==null?void 0:i.event;if(y){var S;const E=this.schedule.findEventIndex(l),T=(S=this.schedule.items)==null?void 0:S[E];if(T){if(!this.playingItem&&this.timelinePos>T.end&&this.schedule.findItemIndexAtTime(this.timelinePos)!==E){r.error=new Error(`Interstitial ${c.length?"no longer within playback range":"asset-list is empty"} ${this.timelinePos} ${r}`),this.log(r.error.message),this.updateSchedule(!0),this.primaryFallback(r);return}this.setBufferingItem(T)}this.setSchedulePosition(E)}else if(x?.identifier===l){const E=r.assetList[0];if(E){const T=this.getAssetPlayer(E.identifier);if(x.appendInPlace){const A=this.primaryMedia;T&&A&&this.bufferAssetPlayer(T,A)}else T&&T.loadSource()}}}onError(e,t){if(this.schedule)switch(t.details){case Q.ASSET_LIST_PARSING_ERROR:case Q.ASSET_LIST_LOAD_ERROR:case Q.ASSET_LIST_LOAD_TIMEOUT:{const s=t.interstitial;s&&(this.updateSchedule(!0),this.primaryFallback(s));break}case Q.BUFFER_STALLED_ERROR:{const s=this.endedItem||this.waitingItem||this.playingItem;if(this.isInterstitial(s)&&s.event.appendInPlace){this.handleInPlaceStall(s.event);return}this.log(`Primary player stall @${this.timelinePos} bufferedPos: ${this.bufferedPos}`),this.onTimeupdate(),this.checkBuffer(!0);break}}}}const mx=500;class lO extends Rm{constructor(e,t,s){super(e,t,s,"subtitle-stream-controller",ke.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(L.LEVEL_LOADED,this.onLevelLoaded,this),e.on(L.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(L.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(L.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(L.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(L.BUFFER_FLUSHING,this.onBufferFlushing,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(L.LEVEL_LOADED,this.onLevelLoaded,this),e.off(L.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(L.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(L.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(L.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(L.BUFFER_FLUSHING,this.onBufferFlushing,this)}startLoad(e,t){this.stopLoad(),this.state=ue.IDLE,this.setInterval(mx),this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}onManifestLoading(){super.onManifestLoading(),this.mainDetails=null}onMediaDetaching(e,t){this.tracksBuffered=[],super.onMediaDetaching(e,t)}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){const{frag:s,success:i}=t;if(this.fragContextChanged(s)||(ss(s)&&(this.fragPrevious=s),this.state=ue.IDLE),!i)return;const r=this.tracksBuffered[this.currentTrackId];if(!r)return;let l;const c=s.start;for(let u=0;u<r.length;u++)if(c>=r[u].start&&c<=r[u].end){l=r[u];break}const h=s.start+s.duration;l?l.end=h:(l={start:c,end:h},r.push(l)),this.fragmentTracker.fragBuffered(s),this.fragBufferedComplete(s,null),this.media&&this.tick()}onBufferFlushing(e,t){const{startOffset:s,endOffset:i}=t;if(s===0&&i!==Number.POSITIVE_INFINITY){const r=i-1;if(r<=0)return;t.endOffsetSubtitles=Math.max(0,r),this.tracksBuffered.forEach(l=>{for(let c=0;c<l.length;){if(l[c].end<=r){l.shift();continue}else if(l[c].start<r)l[c].start=r;else break;c++}}),this.fragmentTracker.removeFragmentsInRange(s,r,ke.SUBTITLE)}}onError(e,t){const s=t.frag;s?.type===ke.SUBTITLE&&(t.details===Q.FRAG_GAP&&this.fragmentTracker.fragBuffered(s,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==ue.STOPPED&&(this.state=ue.IDLE))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){if(this.levels&&Ib(this.levels,t)){this.levels=t.map(s=>new Xl(s));return}this.tracksBuffered=[],this.levels=t.map(s=>{const i=new Xl(s);return this.tracksBuffered[i.id]=[],i}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,ke.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(e,t){var s;if(this.currentTrackId=t.id,!((s=this.levels)!=null&&s.length)||this.currentTrackId===-1){this.clearInterval();return}const i=this.levels[this.currentTrackId];i!=null&&i.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,i&&this.state!==ue.STOPPED&&this.setInterval(mx)}onSubtitleTrackLoaded(e,t){var s;const{currentTrackId:i,levels:r}=this,{details:l,id:c}=t;if(!r){this.warn(`Subtitle tracks were reset while loading level ${c}`);return}const h=r[c];if(c>=r.length||!h)return;this.log(`Subtitle track ${c} loaded [${l.startSN},${l.endSN}]${l.lastPartSn?`[part-${l.lastPartSn}-${l.lastPartIndex}]`:""},duration:${l.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let u=0;if(l.live||(s=h.details)!=null&&s.live){if(l.deltaUpdateFailed)return;const g=this.mainDetails;if(!g){this.startFragRequested=!1;return}const y=g.fragments[0];if(!h.details)l.hasProgramDateTime&&g.hasProgramDateTime?(Tu(l,g),u=l.fragmentStart):y&&(u=y.start,Kf(l,u));else{var f;u=this.alignPlaylists(l,h.details,(f=this.levelLastLoaded)==null?void 0:f.details),u===0&&y&&(u=y.start,Kf(l,u))}g&&!this.startFragRequested&&this.setStartPosition(g,u)}h.details=l,this.levelLastLoaded=h,c===i&&(this.hls.trigger(L.SUBTITLE_TRACK_UPDATED,{details:l,id:c,groupId:t.groupId}),this.tick(),l.live&&!this.fragCurrent&&this.media&&this.state===ue.IDLE&&(Qa(null,l.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),h.details=void 0)))}_handleFragmentLoadComplete(e){const{frag:t,payload:s}=e,i=t.decryptdata,r=this.hls;if(!this.fragContextChanged(t)&&s&&s.byteLength>0&&i!=null&&i.key&&i.iv&&Br(i.method)){const l=performance.now();this.decrypter.decrypt(new Uint8Array(s),i.key.buffer,i.iv.buffer,Im(i.method)).catch(c=>{throw r.trigger(L.ERROR,{type:Be.MEDIA_ERROR,details:Q.FRAG_DECRYPT_ERROR,fatal:!1,error:c,reason:c.message,frag:t}),c}).then(c=>{const h=performance.now();r.trigger(L.FRAG_DECRYPTED,{frag:t,payload:c,stats:{tstart:l,tdecrypt:h}})}).catch(c=>{this.warn(`${c.name}: ${c.message}`),this.state=ue.IDLE})}}doTick(){if(!this.media){this.state=ue.IDLE;return}if(this.state===ue.IDLE){const{currentTrackId:e,levels:t}=this,s=t?.[e];if(!s||!t.length||!s.details||this.waitForLive(s))return;const{config:i}=this,r=this.getLoadPosition(),l=qe.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],r,i.maxBufferHole),{end:c,len:h}=l,u=s.details,f=this.hls.maxBufferLength+u.levelTargetDuration;if(h>f)return;const g=u.fragments,y=g.length,x=u.edge;let S=null;const E=this.fragPrevious;if(c<x){const _=i.maxFragLookUpTolerance,I=c>x-_?0:_;S=Qa(E,g,Math.max(g[0].start,c),I),!S&&E&&E.start<g[0].start&&(S=g[0])}else S=g[y-1];if(S=this.filterReplacedPrimary(S,s.details),!S)return;const T=S.sn-u.startSN,A=g[T-1];if(A&&A.cc===S.cc&&this.fragmentTracker.getState(A)===fs.NOT_LOADED&&(S=A),this.fragmentTracker.getState(S)===fs.NOT_LOADED){const _=this.mapToInitFragWhenRequired(S);_&&this.loadFragment(_,s,c)}}}loadFragment(e,t,s){ss(e)?super.loadFragment(e,t,s):this._loadInitSegment(e,t)}get mediaBufferTimeRanges(){return new oO(this.tracksBuffered[this.currentTrackId]||[])}}class oO{constructor(e){this.buffered=void 0;const t=(s,i,r)=>{if(i=i>>>0,i>r-1)throw new DOMException(`Failed to execute '${s}' on 'TimeRanges': The index provided (${i}) is greater than the maximum bound (${r})`);return e[i][s]};this.buffered={get length(){return e.length},end(s){return t("end",s,e.length)},start(s){return t("start",s,e.length)}}}}const cO={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},Vb=n=>String.fromCharCode(cO[n]||n),Ki=15,Mn=100,uO={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},dO={17:2,18:4,21:6,22:8,23:10,19:13,20:15},hO={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},fO={25:2,26:4,29:6,30:8,31:10,27:13,28:15},mO=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class pO{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){const s=typeof t=="function"?t():t;Lt.log(`${this.time} [${e}] ${s}`)}}}const Ga=function(e){const t=[];for(let s=0;s<e.length;s++)t.push(e[s].toString(16));return t};class $b{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const t=["foreground","underline","italics","background","flash"];for(let s=0;s<t.length;s++){const i=t[s];e.hasOwnProperty(i)&&(this[i]=e[i])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class gO{constructor(){this.uchar=" ",this.penState=new $b}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}}class yO{constructor(e){this.chars=[],this.pos=0,this.currPenState=new $b,this.cueStartTime=null,this.logger=void 0;for(let t=0;t<Mn;t++)this.chars.push(new gO);this.logger=e}equals(e){for(let t=0;t<Mn;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0}copy(e){for(let t=0;t<Mn;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<Mn;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>Mn&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=Mn)}moveCursor(e){const t=this.pos+e;if(e>1)for(let s=this.pos+1;s<t+1;s++)this.chars[s].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const t=Vb(e);if(this.pos>=Mn){this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1)}clearFromPos(e){let t;for(t=e;t<Mn;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let t=!0;for(let s=0;s<Mn;s++){const i=this.chars[s].uchar;i!==" "&&(t=!1),e.push(i)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}class bf{constructor(e){this.rows=[],this.currRow=Ki-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let t=0;t<Ki;t++)this.rows.push(new yO(e));this.logger=e}reset(){for(let e=0;e<Ki;e++)this.rows[e].clear();this.currRow=Ki-1}equals(e){let t=!0;for(let s=0;s<Ki;s++)if(!this.rows[s].equals(e.rows[s])){t=!1;break}return t}copy(e){for(let t=0;t<Ki;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<Ki;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+Mt(e));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let c=0;c<Ki;c++)this.rows[c].clear();const r=this.currRow+1-this.nrRollUpRows,l=this.lastOutputScreen;if(l){const c=l.rows[r].cueStartTime,h=this.logger.time;if(c!==null&&h!==null&&c<h)for(let u=0;u<this.nrRollUpRows;u++)this.rows[t-this.nrRollUpRows+u+1].copy(l.rows[r+u])}}this.currRow=t;const s=this.rows[this.currRow];if(e.indent!==null){const r=e.indent,l=Math.max(r-1,0);s.setCursor(e.indent),e.color=s.chars[l].penState.foreground}const i={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(i)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+Mt(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());const e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const t=[];let s="",i=-1;for(let r=0;r<Ki;r++){const l=this.rows[r].getTextString();l&&(i=r+1,e?t.push("Row "+i+": '"+l+"'"):t.push(l.trim()))}return t.length>0&&(e?s="["+t.join(" | ")+"]":s=t.join(`
`)),s}getTextAndFormat(){return this.rows}}class px{constructor(e,t,s){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new bf(s),this.nonDisplayedMemory=new bf(s),this.lastOutputScreen=new bf(s),this.currRollUpRow=this.displayedMemory.rows[Ki-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=s}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[Ki-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let s=0;s<e.length;s++)this.writeScreen.insertChar(e[s]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>t+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const t={flash:!1};if(t.underline=e%2===1,t.italics=e>=46,t.italics)t.foreground="white";else{const s=Math.floor(e/2)-16,i=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=i[s]}this.logger.log(2,"MIDROW: "+Mt(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){const t=this.logger.time;t!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=t:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class gx{constructor(e,t,s){this.channels=void 0,this.currentChannel=0,this.cmdHistory=xO(),this.logger=void 0;const i=this.logger=new pO;this.channels=[null,new px(e,t,i),new px(e+1,s,i)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){this.logger.time=e;for(let s=0;s<t.length;s+=2){const i=t[s]&127,r=t[s+1]&127;let l=!1,c=null;if(i===0&&r===0)continue;this.logger.log(3,()=>"["+Ga([t[s],t[s+1]])+"] -> ("+Ga([i,r])+")");const h=this.cmdHistory;if(i>=16&&i<=31){if(vO(i,r,h)){zc(null,null,h),this.logger.log(3,()=>"Repeated command ("+Ga([i,r])+") is dropped");continue}zc(i,r,this.cmdHistory),l=this.parseCmd(i,r),l||(l=this.parseMidrow(i,r)),l||(l=this.parsePAC(i,r)),l||(l=this.parseBackgroundAttributes(i,r))}else zc(null,null,h);if(!l&&(c=this.parseChars(i,r),c)){const f=this.currentChannel;f&&f>0?this.channels[f].insertChars(c):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!l&&!c&&this.logger.log(2,()=>"Couldn't parse cleaned data "+Ga([i,r])+" orig: "+Ga([t[s],t[s+1]]))}}parseCmd(e,t){const s=(e===20||e===28||e===21||e===29)&&t>=32&&t<=47,i=(e===23||e===31)&&t>=33&&t<=35;if(!(s||i))return!1;const r=e===20||e===21||e===23?1:2,l=this.channels[r];return e===20||e===21||e===28||e===29?t===32?l.ccRCL():t===33?l.ccBS():t===34?l.ccAOF():t===35?l.ccAON():t===36?l.ccDER():t===37?l.ccRU(2):t===38?l.ccRU(3):t===39?l.ccRU(4):t===40?l.ccFON():t===41?l.ccRDC():t===42?l.ccTR():t===43?l.ccRTD():t===44?l.ccEDM():t===45?l.ccCR():t===46?l.ccENM():t===47&&l.ccEOC():l.ccTO(t-32),this.currentChannel=r,!0}parseMidrow(e,t){let s=0;if((e===17||e===25)&&t>=32&&t<=47){if(e===17?s=1:s=2,s!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const i=this.channels[s];return i?(i.ccMIDROW(t),this.logger.log(3,()=>"MIDROW ("+Ga([e,t])+")"),!0):!1}return!1}parsePAC(e,t){let s;const i=(e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127,r=(e===16||e===24)&&t>=64&&t<=95;if(!(i||r))return!1;const l=e<=23?1:2;t>=64&&t<=95?s=l===1?uO[e]:hO[e]:s=l===1?dO[e]:fO[e];const c=this.channels[l];return c?(c.setPAC(this.interpretPAC(s,t)),this.currentChannel=l,!0):!1}interpretPAC(e,t){let s;const i={color:null,italics:!1,indent:null,underline:!1,row:e};return t>95?s=t-96:s=t-64,i.underline=(s&1)===1,s<=13?i.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(s/2)]:s<=15?(i.italics=!0,i.color="white"):i.indent=Math.floor((s-16)/2)*4,i}parseChars(e,t){let s,i=null,r=null;if(e>=25?(s=2,r=e-8):(s=1,r=e),r>=17&&r<=19){let l;r===17?l=t+80:r===18?l=t+112:l=t+144,this.logger.log(2,()=>"Special char '"+Vb(l)+"' in channel "+s),i=[l]}else e>=32&&e<=127&&(i=t===0?[e]:[e,t]);return i&&this.logger.log(3,()=>"Char codes =  "+Ga(i).join(",")),i}parseBackgroundAttributes(e,t){const s=(e===16||e===24)&&t>=32&&t<=47,i=(e===23||e===31)&&t>=45&&t<=47;if(!(s||i))return!1;let r;const l={};e===16||e===24?(r=Math.floor((t-32)/2),l.background=mO[r],t%2===1&&(l.background=l.background+"_semi")):t===45?l.background="transparent":(l.foreground="black",t===47&&(l.underline=!0));const c=e<=23?1:2;return this.channels[c].setBkgData(l),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}zc(null,null,this.cmdHistory)}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){const s=this.channels[t];s&&s.cueSplitAtTime(e)}}}function zc(n,e,t){t.a=n,t.b=e}function vO(n,e,t){return t.a===n&&t.b===e}function xO(){return{a:null,b:null}}var Bm=(function(){if(bu!=null&&bu.VTTCue)return self.VTTCue;const n=["","lr","rl"],e=["start","middle","end","left","right"];function t(c,h){if(typeof h!="string"||!Array.isArray(c))return!1;const u=h.toLowerCase();return~c.indexOf(u)?u:!1}function s(c){return t(n,c)}function i(c){return t(e,c)}function r(c,...h){let u=1;for(;u<arguments.length;u++){const f=arguments[u];for(const g in f)c[g]=f[g]}return c}function l(c,h,u){const f=this,g={enumerable:!0};f.hasBeenReset=!1;let y="",x=!1,S=c,E=h,T=u,A=null,_="",I=!0,C="auto",N="start",D=50,k="middle",B=50,j="middle";Object.defineProperty(f,"id",r({},g,{get:function(){return y},set:function(U){y=""+U}})),Object.defineProperty(f,"pauseOnExit",r({},g,{get:function(){return x},set:function(U){x=!!U}})),Object.defineProperty(f,"startTime",r({},g,{get:function(){return S},set:function(U){if(typeof U!="number")throw new TypeError("Start time must be set to a number.");S=U,this.hasBeenReset=!0}})),Object.defineProperty(f,"endTime",r({},g,{get:function(){return E},set:function(U){if(typeof U!="number")throw new TypeError("End time must be set to a number.");E=U,this.hasBeenReset=!0}})),Object.defineProperty(f,"text",r({},g,{get:function(){return T},set:function(U){T=""+U,this.hasBeenReset=!0}})),Object.defineProperty(f,"region",r({},g,{get:function(){return A},set:function(U){A=U,this.hasBeenReset=!0}})),Object.defineProperty(f,"vertical",r({},g,{get:function(){return _},set:function(U){const K=s(U);if(K===!1)throw new SyntaxError("An invalid or illegal string was specified.");_=K,this.hasBeenReset=!0}})),Object.defineProperty(f,"snapToLines",r({},g,{get:function(){return I},set:function(U){I=!!U,this.hasBeenReset=!0}})),Object.defineProperty(f,"line",r({},g,{get:function(){return C},set:function(U){if(typeof U!="number"&&U!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");C=U,this.hasBeenReset=!0}})),Object.defineProperty(f,"lineAlign",r({},g,{get:function(){return N},set:function(U){const K=i(U);if(!K)throw new SyntaxError("An invalid or illegal string was specified.");N=K,this.hasBeenReset=!0}})),Object.defineProperty(f,"position",r({},g,{get:function(){return D},set:function(U){if(U<0||U>100)throw new Error("Position must be between 0 and 100.");D=U,this.hasBeenReset=!0}})),Object.defineProperty(f,"positionAlign",r({},g,{get:function(){return k},set:function(U){const K=i(U);if(!K)throw new SyntaxError("An invalid or illegal string was specified.");k=K,this.hasBeenReset=!0}})),Object.defineProperty(f,"size",r({},g,{get:function(){return B},set:function(U){if(U<0||U>100)throw new Error("Size must be between 0 and 100.");B=U,this.hasBeenReset=!0}})),Object.defineProperty(f,"align",r({},g,{get:function(){return j},set:function(U){const K=i(U);if(!K)throw new SyntaxError("An invalid or illegal string was specified.");j=K,this.hasBeenReset=!0}})),f.displayState=void 0}return l.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},l})();class SO{decode(e,t){if(!e)return"";if(typeof e!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function Gb(n){function e(s,i,r,l){return(s|0)*3600+(i|0)*60+(r|0)+parseFloat(l||0)}const t=n.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return t?parseFloat(t[2])>59?e(t[2],t[3],0,t[4]):e(t[1],t[2],t[3],t[4]):null}class bO{constructor(){this.values=Object.create(null)}set(e,t){!this.get(e)&&t!==""&&(this.values[e]=t)}get(e,t,s){return s?this.has(e)?this.values[e]:t[s]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,s){for(let i=0;i<s.length;++i)if(t===s[i]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const s=parseFloat(t);if(s>=0&&s<=100)return this.set(e,s),!0}return!1}}function Hb(n,e,t,s){const i=s?n.split(s):[n];for(const r in i){if(typeof i[r]!="string")continue;const l=i[r].split(t);if(l.length!==2)continue;const c=l[0],h=l[1];e(c,h)}}const em=new Bm(0,0,""),Kc=em.align==="middle"?"middle":"center";function TO(n,e,t){const s=n;function i(){const c=Gb(n);if(c===null)throw new Error("Malformed timestamp: "+s);return n=n.replace(/^[^\sa-zA-Z-]+/,""),c}function r(c,h){const u=new bO;Hb(c,function(y,x){let S;switch(y){case"region":for(let E=t.length-1;E>=0;E--)if(t[E].id===x){u.set(y,t[E].region);break}break;case"vertical":u.alt(y,x,["rl","lr"]);break;case"line":S=x.split(","),u.integer(y,S[0]),u.percent(y,S[0])&&u.set("snapToLines",!1),u.alt(y,S[0],["auto"]),S.length===2&&u.alt("lineAlign",S[1],["start",Kc,"end"]);break;case"position":S=x.split(","),u.percent(y,S[0]),S.length===2&&u.alt("positionAlign",S[1],["start",Kc,"end","line-left","line-right","auto"]);break;case"size":u.percent(y,x);break;case"align":u.alt(y,x,["start",Kc,"end","left","right"]);break}},/:/,/\s/),h.region=u.get("region",null),h.vertical=u.get("vertical","");let f=u.get("line","auto");f==="auto"&&em.line===-1&&(f=-1),h.line=f,h.lineAlign=u.get("lineAlign","start"),h.snapToLines=u.get("snapToLines",!0),h.size=u.get("size",100),h.align=u.get("align",Kc);let g=u.get("position","auto");g==="auto"&&em.position===50&&(g=h.align==="start"||h.align==="left"?0:h.align==="end"||h.align==="right"?100:50),h.position=g}function l(){n=n.replace(/^\s+/,"")}if(l(),e.startTime=i(),l(),n.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+s);n=n.slice(3),l(),e.endTime=i(),l(),r(n,e)}function zb(n){return n.replace(/<br(?: \/)?>/gi,`
`)}class EO{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new SO,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const t=this;e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));function s(){let r=t.buffer,l=0;for(r=zb(r);l<r.length&&r[l]!=="\r"&&r[l]!==`
`;)++l;const c=r.slice(0,l);return r[l]==="\r"&&++l,r[l]===`
`&&++l,t.buffer=r.slice(l),c}function i(r){Hb(r,function(l,c){},/:/)}try{let r="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;r=s();const c=r.match(/^()?WEBVTT([ \t].*)?$/);if(!(c!=null&&c[0]))throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let l=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(l?l=!1:r=s(),t.state){case"HEADER":/:/.test(r)?i(r):r||(t.state="ID");continue;case"NOTE":r||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(r)){t.state="NOTE";break}if(!r)continue;if(t.cue=new Bm(0,0,""),t.state="CUE",r.indexOf("-->")===-1){t.cue.id=r;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{TO(r,t.cue,t.regionList)}catch{t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const c=r.indexOf("-->")!==-1;if(!r||c&&(l=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=r}continue;case"BADCUE":r||(t.state="ID")}}}catch{t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||e.state==="HEADER")&&(e.buffer+=`

`,e.parse()),e.state==="INITIAL"||e.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}}const AO=/\r\n|\n\r|\n|\r/g,Tf=function(e,t,s=0){return e.slice(s,s+t.length)===t},IO=function(e){let t=parseInt(e.slice(-3));const s=parseInt(e.slice(-6,-4)),i=parseInt(e.slice(-9,-7)),r=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!Ne(t)||!Ne(s)||!Ne(i)||!Ne(r))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*s,t+=60*1e3*i,t+=3600*1e3*r,t};function Fm(n,e,t){return Yl(n.toString())+Yl(e.toString())+Yl(t)}const _O=function(e,t,s){let i=e[t],r=e[i.prevCC];if(!r||!r.new&&i.new){e.ccOffset=e.presentationOffset=i.start,i.new=!1;return}for(;(l=r)!=null&&l.new;){var l;e.ccOffset+=i.start-r.start,i.new=!1,i=r,r=e[i.prevCC]}e.presentationOffset=s};function RO(n,e,t,s,i,r,l){const c=new EO,h=xi(new Uint8Array(n)).trim().replace(AO,`
`).split(`
`),u=[],f=e?kC(e.baseTime,e.timescale):0;let g="00:00.000",y=0,x=0,S,E=!0;c.oncue=function(T){const A=t[s];let _=t.ccOffset;const I=(y-f)/9e4;if(A!=null&&A.new&&(x!==void 0?_=t.ccOffset=A.start:_O(t,s,I)),I){if(!e){S=new Error("Missing initPTS for VTT MPEGTS");return}_=I-t.presentationOffset}const C=T.endTime-T.startTime,N=pi((T.startTime+_-x)*9e4,i*9e4)/9e4;T.startTime=Math.max(N,0),T.endTime=Math.max(N+C,0);const D=T.text.trim();T.text=decodeURIComponent(encodeURIComponent(D)),T.id||(T.id=Fm(T.startTime,T.endTime,D)),T.endTime>0&&u.push(T)},c.onparsingerror=function(T){S=T},c.onflush=function(){if(S){l(S);return}r(u)},h.forEach(T=>{if(E)if(Tf(T,"X-TIMESTAMP-MAP=")){E=!1,T.slice(16).split(",").forEach(A=>{Tf(A,"LOCAL:")?g=A.slice(6):Tf(A,"MPEGTS:")&&(y=parseInt(A.slice(7)))});try{x=IO(g)/1e3}catch(A){S=A}return}else T===""&&(E=!1);c.parse(T+`
`)}),c.flush()}const Ef="stpp.ttml.im1t",Kb=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,Yb=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,LO={left:"start",center:"center",right:"end",start:"start",end:"end"};function yx(n,e,t,s){const i=it(new Uint8Array(n),["mdat"]);if(i.length===0){s(new Error("Could not parse IMSC1 mdat"));return}const r=i.map(c=>xi(c)),l=OC(e.baseTime,1,e.timescale);try{r.forEach(c=>t(wO(c,l)))}catch(c){s(c)}}function wO(n,e){const i=new DOMParser().parseFromString(n,"text/xml").getElementsByTagName("tt")[0];if(!i)throw new Error("Invalid ttml");const r={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},l=Object.keys(r).reduce((g,y)=>(g[y]=i.getAttribute(`ttp:${y}`)||r[y],g),{}),c=i.getAttribute("xml:space")!=="preserve",h=vx(Af(i,"styling","style")),u=vx(Af(i,"layout","region")),f=Af(i,"body","[begin]");return[].map.call(f,g=>{const y=qb(g,c);if(!y||!g.hasAttribute("begin"))return null;const x=_f(g.getAttribute("begin"),l),S=_f(g.getAttribute("dur"),l);let E=_f(g.getAttribute("end"),l);if(x===null)throw xx(g);if(E===null){if(S===null)throw xx(g);E=x+S}const T=new Bm(x-e,E-e,y);T.id=Fm(T.startTime,T.endTime,T.text);const A=u[g.getAttribute("region")],_=h[g.getAttribute("style")],I=CO(A,_,h),{textAlign:C}=I;if(C){const N=LO[C];N&&(T.lineAlign=N),T.align=C}return Dt(T,I),T}).filter(g=>g!==null)}function Af(n,e,t){const s=n.getElementsByTagName(e)[0];return s?[].slice.call(s.querySelectorAll(t)):[]}function vx(n){return n.reduce((e,t)=>{const s=t.getAttribute("xml:id");return s&&(e[s]=t),e},{})}function qb(n,e){return[].slice.call(n.childNodes).reduce((t,s,i)=>{var r;return s.nodeName==="br"&&i?t+`
`:(r=s.childNodes)!=null&&r.length?qb(s,e):e?t+s.textContent.trim().replace(/\s+/g," "):t+s.textContent},"")}function CO(n,e,t){const s="http://www.w3.org/ns/ttml#styling";let i=null;const r=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],l=n!=null&&n.hasAttribute("style")?n.getAttribute("style"):null;return l&&t.hasOwnProperty(l)&&(i=t[l]),r.reduce((c,h)=>{const u=If(e,s,h)||If(n,s,h)||If(i,s,h);return u&&(c[h]=u),c},{})}function If(n,e,t){return n&&n.hasAttributeNS(e,t)?n.getAttributeNS(e,t):null}function xx(n){return new Error(`Could not parse ttml timestamp ${n}`)}function _f(n,e){if(!n)return null;let t=Gb(n);return t===null&&(Kb.test(n)?t=NO(n,e):Yb.test(n)&&(t=OO(n,e))),t}function NO(n,e){const t=Kb.exec(n),s=(t[4]|0)+(t[5]|0)/e.subFrameRate;return(t[1]|0)*3600+(t[2]|0)*60+(t[3]|0)+s/e.frameRate}function OO(n,e){const t=Yb.exec(n),s=Number(t[1]);switch(t[2]){case"h":return s*3600;case"m":return s*60;case"ms":return s*1e3;case"f":return s/e.frameRate;case"t":return s/e.tickRate}return s}class Yc{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,s){(this.startTime===null||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=s,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}class kO{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=bx(),this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(L.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(L.FRAG_LOADING,this.onFragLoading,this),e.on(L.FRAG_LOADED,this.onFragLoaded,this),e.on(L.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(L.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(L.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(L.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(L.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(L.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(L.FRAG_LOADING,this.onFragLoading,this),e.off(L.FRAG_LOADED,this.onFragLoaded,this),e.off(L.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(L.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(L.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(L.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(L.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){const e=new Yc(this,"textTrack1"),t=new Yc(this,"textTrack2"),s=new Yc(this,"textTrack3"),i=new Yc(this,"textTrack4");this.cea608Parser1=new gx(1,e,t),this.cea608Parser2=new gx(3,s,i)}addCues(e,t,s,i,r){let l=!1;for(let c=r.length;c--;){const h=r[c],u=DO(h[0],h[1],t,s);if(u>=0&&(h[0]=Math.min(h[0],t),h[1]=Math.max(h[1],s),l=!0,u/(s-t)>.5))return}if(l||r.push([t,s]),this.config.renderTextTracksNatively){const c=this.captionsTracks[e];this.Cues.newCue(c,t,s,i)}else{const c=this.Cues.newCue(null,t,s,i);this.hls.trigger(L.CUES_PARSED,{type:"captions",cues:c,track:e})}}onInitPtsFound(e,{frag:t,id:s,initPTS:i,timescale:r,trackId:l}){const{unparsedVttFrags:c}=this;s===ke.MAIN&&(this.initPTS[t.cc]={baseTime:i,timescale:r,trackId:l}),c.length&&(this.unparsedVttFrags=[],c.forEach(h=>{this.initPTS[h.frag.cc]?this.onFragLoaded(L.FRAG_LOADED,h):this.hls.trigger(L.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:h.frag,error:new Error("Subtitle discontinuity domain does not match main")})}))}getExistingTrack(e,t){const{media:s}=this;if(s)for(let i=0;i<s.textTracks.length;i++){const r=s.textTracks[i];if(Sx(r,{name:e,lang:t,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return r}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:t,captionsTracks:s,media:i}=this,{label:r,languageCode:l}=t[e],c=this.getExistingTrack(r,l);if(c)s[e]=c,Mr(s[e]),jb(s[e],i);else{const h=this.createTextTrack("captions",r,l);h&&(h[e]=!0,s[e]=h)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const s=t.label,i={_id:e,label:s,kind:"captions",default:t.media?!!t.media.default:!1,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=i,this.hls.trigger(L.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[i]})}createTextTrack(e,t,s){const i=this.media;if(i)return i.addTextTrack(e,t,s)}onMediaAttaching(e,t){this.media=t.media,t.mediaSource||this._cleanTracks()}onMediaDetaching(e,t){const s=!!t.transferMedia;if(this.media=null,s)return;const{captionsTracks:i}=this;Object.keys(i).forEach(r=>{Mr(i[r]),delete i[r]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=bx(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const t=e.textTracks;if(t)for(let s=0;s<t.length;s++)Mr(t[s])}onSubtitleTracksUpdated(e,t){const s=t.subtitleTracks||[],i=s.some(r=>r.textCodec===Ef);if(this.config.enableWebVTT||i&&this.config.enableIMSC1){if(Ib(this.tracks,s)){this.tracks=s;return}if(this.textTracks=[],this.tracks=s,this.config.renderTextTracksNatively){const l=this.media,c=l?lu(l.textTracks):null;if(this.tracks.forEach((h,u)=>{let f;if(c){let g=null;for(let y=0;y<c.length;y++)if(c[y]&&Sx(c[y],h)){g=c[y],c[y]=null;break}g&&(f=g)}if(f)Mr(f);else{const g=Qb(h);f=this.createTextTrack(g,h.name,h.lang),f&&(f.mode="disabled")}f&&this.textTracks.push(f)}),c!=null&&c.length){const h=c.filter(u=>u!==null).map(u=>u.label);h.length&&this.hls.logger.warn(`Media element contains unused subtitle tracks: ${h.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const l=this.tracks.map(c=>({label:c.name,kind:c.type.toLowerCase(),default:c.default,subtitleTrack:c}));this.hls.trigger(L.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:l})}}}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(s=>{const i=/(?:CC|SERVICE)([1-4])/.exec(s.instreamId);if(!i)return;const r=`textTrack${i[1]}`,l=this.captionsProperties[r];l&&(l.label=s.name,s.lang&&(l.languageCode=s.lang),l.media=s)})}closedCaptionsForLevel(e){const t=this.hls.levels[e.level];return t?.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){if(this.enabled&&t.frag.type===ke.MAIN){var s,i;const{cea608Parser1:r,cea608Parser2:l,lastSn:c}=this,{cc:h,sn:u}=t.frag,f=(s=(i=t.part)==null?void 0:i.index)!=null?s:-1;r&&l&&(u!==c+1||u===c&&f!==this.lastPartIndex+1||h!==this.lastCc)&&(r.reset(),l.reset()),this.lastCc=h,this.lastSn=u,this.lastPartIndex=f}}onFragLoaded(e,t){const{frag:s,payload:i}=t;if(s.type===ke.SUBTITLE)if(i.byteLength){const r=s.decryptdata,l="stats"in t;if(r==null||!r.encrypted||l){const c=this.tracks[s.level],h=this.vttCCs;h[s.cc]||(h[s.cc]={start:s.start,prevCC:this.prevCC,new:!0},this.prevCC=s.cc),c&&c.textCodec===Ef?this._parseIMSC1(s,i):this._parseVTTs(t)}}else this.hls.trigger(L.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:s,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){const s=this.hls;yx(t,this.initPTS[e.cc],i=>{this._appendCues(i,e.level),s.trigger(L.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},i=>{s.logger.log(`Failed to parse IMSC1: ${i}`),s.trigger(L.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:i})})}_parseVTTs(e){var t;const{frag:s,payload:i}=e,{initPTS:r,unparsedVttFrags:l}=this,c=r.length-1;if(!r[s.cc]&&c===-1){l.push(e);return}const h=this.hls,u=(t=s.initSegment)!=null&&t.data?Ui(s.initSegment.data,new Uint8Array(i)).buffer:i;RO(u,this.initPTS[s.cc],this.vttCCs,s.cc,s.start,f=>{this._appendCues(f,s.level),h.trigger(L.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:s})},f=>{const g=f.message==="Missing initPTS for VTT MPEGTS";g?l.push(e):this._fallbackToIMSC1(s,i),h.logger.log(`Failed to parse VTT cue: ${f}`),!(g&&c>s.cc)&&h.trigger(L.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:s,error:f})})}_fallbackToIMSC1(e,t){const s=this.tracks[e.level];s.textCodec||yx(t,this.initPTS[e.cc],()=>{s.textCodec=Ef,this._parseIMSC1(e,t)},()=>{s.textCodec="wvtt"})}_appendCues(e,t){const s=this.hls;if(this.config.renderTextTracksNatively){const i=this.textTracks[t];if(!i||i.mode==="disabled")return;e.forEach(r=>Bb(i,r))}else{const i=this.tracks[t];if(!i)return;const r=i.default?"default":"subtitles"+t;s.trigger(L.CUES_PARSED,{type:"subtitles",cues:e,track:r})}}onFragDecrypted(e,t){const{frag:s}=t;s.type===ke.SUBTITLE&&this.onFragLoaded(L.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){if(!this.enabled||!this.config.enableCEA708Captions)return;const{frag:s,samples:i}=t;if(!(s.type===ke.MAIN&&this.closedCaptionsForLevel(s)==="NONE"))for(let r=0;r<i.length;r++){const l=i[r].bytes;if(l){this.cea608Parser1||this.initCea608Parsers();const c=this.extractCea608Data(l);this.cea608Parser1.addData(i[r].pts,c[0]),this.cea608Parser2.addData(i[r].pts,c[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:s,endOffsetSubtitles:i,type:r}){const{media:l}=this;if(!(!l||l.currentTime<s)){if(!r||r==="video"){const{captionsTracks:c}=this;Object.keys(c).forEach(h=>Jf(c[h],t,s))}if(this.config.renderTextTracksNatively&&t===0&&i!==void 0){const{textTracks:c}=this;Object.keys(c).forEach(h=>Jf(c[h],t,i))}}}extractCea608Data(e){const t=[[],[]],s=e[0]&31;let i=2;for(let r=0;r<s;r++){const l=e[i++],c=127&e[i++],h=127&e[i++];if(c===0&&h===0)continue;if((4&l)!==0){const f=3&l;(f===0||f===1)&&(t[f].push(c),t[f].push(h))}}return t}}function Qb(n){return n.characteristics&&/transcribes-spoken-dialog/gi.test(n.characteristics)&&/describes-music-and-sound/gi.test(n.characteristics)?"captions":"subtitles"}function Sx(n,e){return!!n&&n.kind===Qb(e)&&Qf(e,n)}function DO(n,e,t,s){return Math.min(e,s)-Math.max(n,t)}function bx(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}const PO=/\s/,UO={newCue(n,e,t,s){const i=[];let r,l,c,h,u;const f=self.VTTCue||self.TextTrackCue;for(let y=0;y<s.rows.length;y++)if(r=s.rows[y],c=!0,h=0,u="",!r.isEmpty()){var g;for(let E=0;E<r.chars.length;E++)PO.test(r.chars[E].uchar)&&c?h++:(u+=r.chars[E].uchar,c=!1);r.cueStartTime=e,e===t&&(t+=1e-4),h>=16?h--:h++;const x=zb(u.trim()),S=Fm(e,t,x);n!=null&&(g=n.cues)!=null&&g.getCueById(S)||(l=new f(e,t,x),l.id=S,l.line=y+1,l.align="left",l.position=10+Math.min(80,Math.floor(h*8/32)*10),i.push(l))}return n&&i.length&&(i.sort((y,x)=>y.line==="auto"||x.line==="auto"?0:y.line>8&&x.line>8?x.line-y.line:y.line-x.line),i.forEach(y=>Bb(n,y))),i}};function MO(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}const jO=/(\d+)-(\d+)\/(\d+)/;class Tx{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||$O,this.controller=new self.AbortController,this.stats=new vm}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,s){const i=this.stats;if(i.loading.start)throw new Error("Loader can only be used once.");i.loading.start=self.performance.now();const r=BO(e,this.controller.signal),l=e.responseType==="arraybuffer",c=l?"byteLength":"length",{maxTimeToFirstByteMs:h,maxLoadTimeMs:u}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=s,this.request=this.fetchSetup(e,r),self.clearTimeout(this.requestTimeout),t.timeout=h&&Ne(h)?h:u,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(i,e,this.response))},t.timeout),(eo(this.request)?this.request.then(self.fetch):self.fetch(this.request)).then(g=>{var y;this.response=this.loader=g;const x=Math.max(self.performance.now(),i.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=u,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(i,e,this.response))},u-(x-i.loading.start)),!g.ok){const{status:E,statusText:T}=g;throw new GO(T||"fetch, bad network response",E,g)}i.loading.first=x,i.total=VO(g.headers)||i.total;const S=(y=this.callbacks)==null?void 0:y.onProgress;return S&&Ne(t.highWaterMark)?this.loadProgressively(g,i,e,t.highWaterMark,S):l?g.arrayBuffer():e.responseType==="json"?g.json():g.text()}).then(g=>{var y,x;const S=this.response;if(!S)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),i.loading.end=Math.max(self.performance.now(),i.loading.first);const E=g[c];E&&(i.loaded=i.total=E);const T={url:S.url,data:g,code:S.status},A=(y=this.callbacks)==null?void 0:y.onProgress;A&&!Ne(t.highWaterMark)&&A(i,e,g,S),(x=this.callbacks)==null||x.onSuccess(T,i,e,S)}).catch(g=>{var y;if(self.clearTimeout(this.requestTimeout),i.aborted)return;const x=g&&g.code||0,S=g?g.message:null;(y=this.callbacks)==null||y.onError({code:x,text:S},e,g?g.details:null,i)})}getCacheAge(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,s,i=0,r){const l=new ab,c=e.body.getReader(),h=()=>c.read().then(u=>{if(u.done)return l.dataLength&&r(t,s,l.flush().buffer,e),Promise.resolve(new ArrayBuffer(0));const f=u.value,g=f.length;return t.loaded+=g,g<i||l.dataLength?(l.push(f),l.dataLength>=i&&r(t,s,l.flush().buffer,e)):r(t,s,f.buffer,e),h()}).catch(()=>Promise.reject());return h()}}function BO(n,e){const t={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers(Dt({},n.headers))};return n.rangeEnd&&t.headers.set("Range","bytes="+n.rangeStart+"-"+String(n.rangeEnd-1)),t}function FO(n){const e=jO.exec(n);if(e)return parseInt(e[2])-parseInt(e[1])+1}function VO(n){const e=n.get("Content-Range");if(e){const s=FO(e);if(Ne(s))return s}const t=n.get("Content-Length");if(t)return parseInt(t)}function $O(n,e){return new self.Request(n.url,e)}class GO extends Error{constructor(e,t,s){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=s}}const HO=/^age:\s*[\d.]+\s*$/im;class Wb{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new vm,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,e.readyState!==4&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,s){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=s,this.loadInternal()}loadInternal(){const{config:e,context:t}=this;if(!e||!t)return;const s=this.loader=new self.XMLHttpRequest,i=this.stats;i.loading.first=0,i.loaded=0,i.aborted=!1;const r=this.xhrSetup;r?Promise.resolve().then(()=>{if(!(this.loader!==s||this.stats.aborted))return r(s,t.url)}).catch(l=>{if(!(this.loader!==s||this.stats.aborted))return s.open("GET",t.url,!0),r(s,t.url)}).then(()=>{this.loader!==s||this.stats.aborted||this.openAndSendXhr(s,t,e)}).catch(l=>{var c;(c=this.callbacks)==null||c.onError({code:s.status,text:l.message},t,s,i)}):this.openAndSendXhr(s,t,e)}openAndSendXhr(e,t,s){e.readyState||e.open("GET",t.url,!0);const i=t.headers,{maxTimeToFirstByteMs:r,maxLoadTimeMs:l}=s.loadPolicy;if(i)for(const c in i)e.setRequestHeader(c,i[c]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),s.timeout=r&&Ne(r)?r:l,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),s.timeout),e.send()}readystatechange(){const{context:e,loader:t,stats:s}=this;if(!e||!t)return;const i=t.readyState,r=this.config;if(!s.aborted&&i>=2&&(s.loading.first===0&&(s.loading.first=Math.max(self.performance.now(),s.loading.start),r.timeout!==r.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),r.timeout=r.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),r.loadPolicy.maxLoadTimeMs-(s.loading.first-s.loading.start)))),i===4)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const u=t.status,f=t.responseType==="text"?t.responseText:null;if(u>=200&&u<300){const S=f??t.response;if(S!=null){var l,c;s.loading.end=Math.max(self.performance.now(),s.loading.first);const E=t.responseType==="arraybuffer"?S.byteLength:S.length;s.loaded=s.total=E,s.bwEstimate=s.total*8e3/(s.loading.end-s.loading.first);const T=(l=this.callbacks)==null?void 0:l.onProgress;T&&T(s,e,S,t);const A={url:t.responseURL,data:S,code:u};(c=this.callbacks)==null||c.onSuccess(A,s,e,t);return}}const g=r.loadPolicy.errorRetry,y=s.retry,x={url:e.url,data:void 0,code:u};if(xu(g,y,!1,x))this.retry(g);else{var h;Lt.error(`${u} while loading ${e.url}`),(h=this.callbacks)==null||h.onError({code:u,text:t.statusText},e,t,s)}}}loadtimeout(){if(!this.config)return;const e=this.config.loadPolicy.timeoutRetry,t=this.stats.retry;if(xu(e,t,!0))this.retry(e);else{var s;Lt.warn(`timeout while loading ${(s=this.context)==null?void 0:s.url}`);const i=this.callbacks;i&&(this.abortInternal(),i.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:t,stats:s}=this;this.retryDelay=Tm(e,s.retry),s.retry++,Lt.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${t?.url}, retrying ${s.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&HO.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}const zO={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},KO=Rt(Rt({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,startOnSegmentBoundary:!1,maxBufferSize:60*1e3*1e3,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncMode:"edge",liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:Wb,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:nw,bufferController:qC,capLevelController:Um,errorController:cw,fpsController:QN,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:qS,requireKeySystemAccessOnStart:!1,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,preserveManualLevelOnError:!1,certLoadPolicy:{default:zO},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},YO()),{},{subtitleStreamController:lO,subtitleTrackController:ZN,timelineController:kO,audioStreamController:HC,audioTrackController:zC,emeController:Fr,cmcdController:zN,contentSteeringController:YN,interstitialsController:rO});function YO(){return{cueHandler:UO,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function qO(n,e,t){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(e.liveMaxLatencyDurationCount!==void 0&&(e.liveSyncDurationCount===void 0||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(e.liveMaxLatencyDuration!==void 0&&(e.liveSyncDuration===void 0||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const s=tm(n),i=["manifest","level","frag"],r=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return i.forEach(l=>{const c=`${l==="level"?"playlist":l}LoadPolicy`,h=e[c]===void 0,u=[];r.forEach(f=>{const g=`${l}Loading${f}`,y=e[g];if(y!==void 0&&h){u.push(g);const x=s[c].default;switch(e[c]={default:x},f){case"TimeOut":x.maxLoadTimeMs=y,x.maxTimeToFirstByteMs=y;break;case"MaxRetry":x.errorRetry.maxNumRetry=y,x.timeoutRetry.maxNumRetry=y;break;case"RetryDelay":x.errorRetry.retryDelayMs=y,x.timeoutRetry.retryDelayMs=y;break;case"MaxRetryTimeout":x.errorRetry.maxRetryDelayMs=y,x.timeoutRetry.maxRetryDelayMs=y;break}}}),u.length&&t.warn(`hls.js config: "${u.join('", "')}" setting(s) are deprecated, use "${c}": ${Mt(e[c])}`)}),Rt(Rt({},s),e)}function tm(n){return n&&typeof n=="object"?Array.isArray(n)?n.map(tm):Object.keys(n).reduce((e,t)=>(e[t]=tm(n[t]),e),{}):n}function QO(n,e){const t=n.loader;t!==Tx&&t!==Wb?(e.log("[config]: Custom loader detected, cannot enable progressive streaming"),n.progressive=!1):MO()&&(n.loader=Tx,n.progressive=!0,n.enableSoftwareAES=!0,e.log("[config]: Progressive streaming enabled, using FetchLoader"))}const ou=2,WO=.1,XO=.05,ZO=100;class JO extends GS{constructor(e,t){super("gap-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.media=null,this.mediaSource=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.buffered={},this.lastCurrentTime=0,this.ended=0,this.waiting=0,this.onMediaPlaying=()=>{this.ended=0,this.waiting=0},this.onMediaWaiting=()=>{var s;(s=this.media)!=null&&s.seeking||(this.waiting=self.performance.now(),this.tick())},this.onMediaEnded=()=>{if(this.hls){var s;this.ended=((s=this.media)==null?void 0:s.currentTime)||1,this.hls.trigger(L.MEDIA_ENDED,{stalled:!1})}},this.hls=e,this.fragmentTracker=t,this.registerListeners()}registerListeners(){const{hls:e}=this;e&&(e.on(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(L.BUFFER_APPENDED,this.onBufferAppended,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(L.BUFFER_APPENDED,this.onBufferAppended,this))}destroy(){super.destroy(),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0}onMediaAttached(e,t){this.setInterval(ZO),this.mediaSource=t.mediaSource;const s=this.media=t.media;$s(s,"playing",this.onMediaPlaying),$s(s,"waiting",this.onMediaWaiting),$s(s,"ended",this.onMediaEnded)}onMediaDetaching(e,t){this.clearInterval();const{media:s}=this;s&&(ei(s,"playing",this.onMediaPlaying),ei(s,"waiting",this.onMediaWaiting),ei(s,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0}onBufferAppended(e,t){this.buffered=t.timeRanges}get hasBuffered(){return Object.keys(this.buffered).length>0}tick(){var e;if(!((e=this.media)!=null&&e.readyState)||!this.hasBuffered)return;const t=this.media.currentTime;this.poll(t,this.lastCurrentTime),this.lastCurrentTime=t}poll(e,t){var s,i;const r=(s=this.hls)==null?void 0:s.config;if(!r)return;const l=this.media;if(!l)return;const{seeking:c}=l,h=this.seeking&&!c,u=!this.seeking&&c,f=l.paused&&!c||l.ended||l.playbackRate===0;if(this.seeking=c,e!==t){t&&(this.ended=0),this.moved=!0,c||(this.nudgeRetry=0,r.nudgeOnVideoHole&&!f&&e>t&&this.nudgeOnVideoHole(e,t)),this.waiting===0&&this.stallResolved(e);return}if(u||h){h&&this.stallResolved(e);return}if(f){this.nudgeRetry=0,this.stallResolved(e),!this.ended&&l.ended&&this.hls&&(this.ended=e||1,this.hls.trigger(L.MEDIA_ENDED,{stalled:!1}));return}if(!qe.getBuffered(l).length){this.nudgeRetry=0;return}const g=qe.bufferInfo(l,e,0),y=g.nextStart||0,x=this.fragmentTracker;if(c&&x&&this.hls){const D=Ex(this.hls.inFlightFragments,e),k=g.len>ou,B=!y||D||y-e>ou&&!x.getPartialFragment(e);if(k||B)return;this.moved=!1}const S=(i=this.hls)==null?void 0:i.latestLevelDetails;if(!this.moved&&this.stalled!==null&&x){if(!(g.len>0)&&!y)return;const k=Math.max(y,g.start||0)-e,j=!!(S!=null&&S.live)?S.targetduration*2:ou,U=qc(e,x);if(k>0&&(k<=j||U)){l.paused||this._trySkipBufferHole(U);return}}const E=r.detectStallWithCurrentTimeMs,T=self.performance.now(),A=this.waiting;let _=this.stalled;if(_===null)if(A>0&&T-A<E)_=this.stalled=A;else{this.stalled=T;return}const I=T-_;if(!c&&(I>=E||A)&&this.hls){var C;if(((C=this.mediaSource)==null?void 0:C.readyState)==="ended"&&!(S!=null&&S.live)&&Math.abs(e-(S?.edge||0))<1){if(this.ended)return;this.ended=e||1,this.hls.trigger(L.MEDIA_ENDED,{stalled:!0});return}if(this._reportStall(g),!this.media||!this.hls)return}const N=qe.bufferInfo(l,e,r.maxBufferHole);this._tryFixBufferStall(N,I,e)}stallResolved(e){const t=this.stalled;if(t&&this.hls&&(this.stalled=null,this.stallReported)){const s=self.performance.now()-t;this.log(`playback not stuck anymore @${e}, after ${Math.round(s)}ms`),this.stallReported=!1,this.waiting=0,this.hls.trigger(L.STALL_RESOLVED,{})}}nudgeOnVideoHole(e,t){var s;const i=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&(s=this.buffered.audio)!=null&&s.length&&i&&i.length>1&&e>i.end(0)){const r=qe.bufferedInfo(qe.timeRangesToArray(this.buffered.audio),e,0);if(r.len>1&&t>=r.start){const l=qe.timeRangesToArray(i),c=qe.bufferedInfo(l,t,0).bufferedIndex;if(c>-1&&c<l.length-1){const h=qe.bufferedInfo(l,e,0).bufferedIndex,u=l[c].end,f=l[c+1].start;if((h===-1||h>c)&&f-u<1&&e-u<2){const g=new Error(`nudging playhead to flush pipeline after video hole. currentTime: ${e} hole: ${u} -> ${f} buffered index: ${h}`);this.warn(g.message),this.media.currentTime+=1e-6;let y=qc(e,this.fragmentTracker);y&&"fragment"in y?y=y.fragment:y||(y=void 0);const x=qe.bufferInfo(this.media,e,0);this.hls.trigger(L.ERROR,{type:Be.MEDIA_ERROR,details:Q.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:g,reason:g.message,frag:y,buffer:x.len,bufferInfo:x})}}}}}_tryFixBufferStall(e,t,s){var i,r;const{fragmentTracker:l,media:c}=this,h=(i=this.hls)==null?void 0:i.config;if(!c||!l||!h)return;const u=(r=this.hls)==null?void 0:r.latestLevelDetails,f=qc(s,l);if((f||u!=null&&u.live&&s<u.fragmentStart)&&(this._trySkipBufferHole(f)||!this.media))return;const g=e.buffered,y=this.adjacentTraversal(e,s);(g&&g.length>1&&e.len>h.maxBufferHole||e.nextStart&&(e.nextStart-s<h.maxBufferHole||y))&&(t>h.highBufferWatchdogPeriod*1e3||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(e))}adjacentTraversal(e,t){const s=this.fragmentTracker,i=e.nextStart;if(s&&i){const r=s.getFragAtPos(t,ke.MAIN),l=s.getFragAtPos(i,ke.MAIN);if(r&&l)return l.sn-r.sn<2}return!1}_reportStall(e){const{hls:t,media:s,stallReported:i,stalled:r}=this;if(!i&&r!==null&&s&&t){this.stallReported=!0;const l=new Error(`Playback stalling at @${s.currentTime} due to low buffer (${Mt(e)})`);this.warn(l.message),t.trigger(L.ERROR,{type:Be.MEDIA_ERROR,details:Q.BUFFER_STALLED_ERROR,fatal:!1,error:l,buffer:e.len,bufferInfo:e,stalled:{start:r}})}}_trySkipBufferHole(e){var t;const{fragmentTracker:s,media:i}=this,r=(t=this.hls)==null?void 0:t.config;if(!i||!s||!r)return 0;const l=i.currentTime,c=qe.bufferInfo(i,l,0),h=l<c.start?c.start:c.nextStart;if(h&&this.hls){const f=c.len<=r.maxBufferHole,g=c.len>0&&c.len<1&&i.readyState<3,y=h-l;if(y>0&&(f||g)){if(y>r.maxBufferHole){let S=!1;if(l===0){const E=s.getAppendedFrag(0,ke.MAIN);E&&h<E.end&&(S=!0)}if(!S&&e){var u;if(!((u=this.hls.loadLevelObj)!=null&&u.details)||Ex(this.hls.inFlightFragments,h))return 0;let T=!1,A=e.end;for(;A<h;){const _=qc(A,s);if(_)A+=_.duration;else{T=!0;break}}if(T)return 0}}const x=Math.max(h+XO,l+WO);if(this.warn(`skipping hole, adjusting currentTime from ${l} to ${x}`),this.moved=!0,i.currentTime=x,!(e!=null&&e.gap)){const S=new Error(`fragment loaded with buffer holes, seeking from ${l} to ${x}`),E={type:Be.MEDIA_ERROR,details:Q.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:S,reason:S.message,buffer:c.len,bufferInfo:c};e&&("fragment"in e?E.part=e:E.frag=e),this.hls.trigger(L.ERROR,E)}return x}}return 0}_tryNudgeBuffer(e){const{hls:t,media:s,nudgeRetry:i}=this,r=t?.config;if(!s||!r)return 0;const l=s.currentTime;if(this.nudgeRetry++,i<r.nudgeMaxRetry){const c=l+(i+1)*r.nudgeOffset,h=new Error(`Nudging 'currentTime' from ${l} to ${c}`);this.warn(h.message),s.currentTime=c,t.trigger(L.ERROR,{type:Be.MEDIA_ERROR,details:Q.BUFFER_NUDGE_ON_STALL,error:h,fatal:!1,buffer:e.len,bufferInfo:e})}else{const c=new Error(`Playhead still not moving while enough data buffered @${l} after ${r.nudgeMaxRetry} nudges`);this.error(c.message),t.trigger(L.ERROR,{type:Be.MEDIA_ERROR,details:Q.BUFFER_STALLED_ERROR,error:c,fatal:!0,buffer:e.len,bufferInfo:e})}}}function Ex(n,e){const t=Ax(n.main);if(t&&t.start<=e)return t;const s=Ax(n.audio);return s&&s.start<=e?s:null}function Ax(n){if(!n)return null;switch(n.state){case ue.IDLE:case ue.STOPPED:case ue.ENDED:case ue.ERROR:return null}return n.frag}function qc(n,e){return e.getAppendedFrag(n,ke.MAIN)||e.getPartialFragment(n)}const ek=.25;function sm(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function Rf(n,e,t,s,i){let r=new n(e,t,"");try{r.value=s,i&&(r.type=i)}catch{r=new n(e,t,Mt(i?Rt({type:i},s):s))}return r}const Qc=(()=>{const n=sm();try{n&&new n(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();class tk{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.assetCue=void 0,this.onEventCueEnter=()=>{this.hls&&this.hls.trigger(L.EVENT_CUE_ENTER,{})},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null}_registerListeners(){const{hls:e}=this;e&&(e.on(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(L.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(L.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(L.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(L.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(L.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(L.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}onMediaAttaching(e,t){var s;this.media=t.media,((s=t.overrides)==null?void 0:s.cueRemoval)===!1&&(this.removeCues=!1)}onMediaAttached(){var e;const t=(e=this.hls)==null?void 0:e.latestLevelDetails;t&&this.updateDateRangeCues(t)}onMediaDetaching(e,t){this.media=null,!t.transferMedia&&(this.id3Track&&(this.removeCues&&Mr(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){const s=e[t];if(s.kind==="metadata"&&s.label==="id3")return jb(s,this.media),s}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media||!this.hls)return;const{enableEmsgMetadataCues:s,enableID3MetadataCues:i}=this.hls.config;if(!s&&!i)return;const{samples:r}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const l=sm();if(l)for(let c=0;c<r.length;c++){const h=r[c].type;if(h===gi.emsg&&!s||!i)continue;const u=hb(r[c].data),f=r[c].pts;let g=f+r[c].duration;g>Qc&&(g=Qc),g-f<=0&&(g=f+ek);for(let x=0;x<u.length;x++){const S=u[x];if(!fb(S)){this.updateId3CueEnds(f,h);const E=Rf(l,f,g,S,h);E&&this.id3Track.addCue(E)}}}}updateId3CueEnds(e,t){var s;const i=(s=this.id3Track)==null?void 0:s.cues;if(i)for(let r=i.length;r--;){const l=i[r];l.type===t&&l.startTime<e&&l.endTime===Qc&&(l.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:s,type:i}){const{id3Track:r,hls:l}=this;if(!l)return;const{config:{enableEmsgMetadataCues:c,enableID3MetadataCues:h}}=l;if(r&&(c||h)){let u;i==="audio"?u=f=>f.type===gi.audioId3&&h:i==="video"?u=f=>f.type===gi.emsg&&c:u=f=>f.type===gi.audioId3&&h||f.type===gi.emsg&&c,Jf(r,t,s,u)}}onLevelUpdated(e,{details:t}){this.updateDateRangeCues(t,!0)}onLevelPtsUpdated(e,t){Math.abs(t.drift)>.01&&this.updateDateRangeCues(t.details)}updateDateRangeCues(e,t){if(!this.hls||!this.media)return;const{assetPlayerId:s,timelineOffset:i,enableDateRangeMetadataCues:r,interstitialsController:l}=this.hls.config;if(!r)return;const c=sm();if(s&&i&&!l){const{fragmentStart:E,fragmentEnd:T}=e;let A=this.assetCue;A?(A.startTime=E,A.endTime=T):c&&(A=this.assetCue=Rf(c,E,T,{assetPlayerId:this.hls.config.assetPlayerId},"hlsjs.interstitial.asset"),A&&(A.id=s,this.id3Track||(this.id3Track=this.createTrack(this.media)),this.id3Track.addCue(A),A.addEventListener("enter",this.onEventCueEnter)))}if(!e.hasProgramDateTime)return;const{id3Track:h}=this,{dateRanges:u}=e,f=Object.keys(u);let g=this.dateRangeCuesAppended;if(h&&t){var y;if((y=h.cues)!=null&&y.length){const E=Object.keys(g).filter(T=>!f.includes(T));for(let T=E.length;T--;){var x;const A=E[T],_=(x=g[A])==null?void 0:x.cues;delete g[A],_&&Object.keys(_).forEach(I=>{const C=_[I];if(C){C.removeEventListener("enter",this.onEventCueEnter);try{h.removeCue(C)}catch{}}})}}else g=this.dateRangeCuesAppended={}}const S=e.fragments[e.fragments.length-1];if(!(f.length===0||!Ne(S?.programDateTime))){this.id3Track||(this.id3Track=this.createTrack(this.media));for(let E=0;E<f.length;E++){const T=f[E],A=u[T],_=A.startTime,I=g[T],C=I?.cues||{};let N=I?.durationKnown||!1,D=Qc;const{duration:k,endDate:B}=A;if(B&&k!==null)D=_+k,N=!0;else if(A.endOnNext&&!N){const U=f.reduce((K,H)=>{if(H!==A.id){const J=u[H];if(J.class===A.class&&J.startDate>A.startDate&&(!K||A.startDate<K.startDate))return J}return K},null);U&&(D=U.startTime,N=!0)}const j=Object.keys(A.attr);for(let U=0;U<j.length;U++){const K=j[U];if(!Tw(K))continue;const H=C[K];if(H)N&&!(I!=null&&I.durationKnown)?H.endTime=D:Math.abs(H.startTime-_)>.01&&(H.startTime=_,H.endTime=D);else if(c){let J=A.attr[K];Ew(K)&&(J=ES(J));const me=Rf(c,_,D,{key:K,data:J},gi.dateRange);me&&(me.id=T,this.id3Track.addCue(me),C[K]=me,l&&(K==="X-ASSET-LIST"||K==="X-ASSET-URL")&&me.addEventListener("enter",this.onEventCueEnter))}}g[T]={cues:C,dateRange:A,durationKnown:N}}}}}class sk{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=()=>{const{media:t}=this,s=this.levelDetails;if(!t||!s)return;this.currentTime=t.currentTime;const i=this.computeLatency();if(i===null)return;this._latency=i;const{lowLatencyMode:r,maxLiveSyncPlaybackRate:l}=this.config;if(!r||l===1||!s.live)return;const c=this.targetLatency;if(c===null)return;const h=i-c,u=Math.min(this.maxLatency,c+s.targetduration);if(h<u&&h>.05&&this.forwardBufferLength>1){const g=Math.min(2,Math.max(1,l)),y=Math.round(2/(1+Math.exp(-.75*h-this.edgeStalled))*20)/20,x=Math.min(g,Math.max(1,y));this.changeMediaPlaybackRate(t,x)}else t.playbackRate!==1&&t.playbackRate!==0&&this.changeMediaPlaybackRate(t,1)},this.hls=e,this.config=e.config,this.registerListeners()}get levelDetails(){var e;return((e=this.hls)==null?void 0:e.latestLevelDetails)||null}get latency(){return this._latency||0}get maxLatency(){const{config:e}=this;if(e.liveMaxLatencyDuration!==void 0)return e.liveMaxLatencyDuration;const t=this.levelDetails;return t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){const e=this.levelDetails;if(e===null||this.hls===null)return null;const{holdBack:t,partHoldBack:s,targetduration:i}=e,{liveSyncDuration:r,liveSyncDurationCount:l,lowLatencyMode:c}=this.config,h=this.hls.userConfig;let u=c&&s||t;(this._targetLatencyUpdated||h.liveSyncDuration||h.liveSyncDurationCount||u===0)&&(u=r!==void 0?r:l*i);const f=i;return u+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,f)}set targetLatency(e){this.stallCount=0,this.config.liveSyncDuration=e,this._targetLatencyUpdated=!0}get liveSyncPosition(){const e=this.estimateLiveEdge(),t=this.targetLatency;if(e===null||t===null)return null;const s=this.levelDetails;if(s===null)return null;const i=s.edge,r=e-t-this.edgeStalled,l=i-s.totalduration,c=i-(this.config.lowLatencyMode&&s.partTarget||s.targetduration);return Math.min(Math.max(l,r),c)}get drift(){const e=this.levelDetails;return e===null?1:e.drift}get edgeStalled(){const e=this.levelDetails;if(e===null)return 0;const t=(this.config.lowLatencyMode&&e.partTarget||e.targetduration)*3;return Math.max(e.age-t,0)}get forwardBufferLength(){const{media:e}=this,t=this.levelDetails;if(!e||!t)return 0;const s=e.buffered.length;return(s?e.buffered.end(s-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null}registerListeners(){const{hls:e}=this;e&&(e.on(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(L.ERROR,this.onError,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(L.ERROR,this.onError,this))}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.onTimeupdate)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)}onManifestLoading(){this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){t.advanced&&this.onTimeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)}onError(e,t){var s;t.details===Q.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&(s=this.levelDetails)!=null&&s.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))}changeMediaPlaybackRate(e,t){var s,i;e.playbackRate!==t&&((s=this.hls)==null||s.logger.debug(`[latency-controller]: latency=${this.latency.toFixed(3)}, targetLatency=${(i=this.targetLatency)==null?void 0:i.toFixed(3)}, forwardBufferLength=${this.forwardBufferLength.toFixed(3)}: adjusting playback rate from ${e.playbackRate} to ${t}`),e.playbackRate=t)}estimateLiveEdge(){const e=this.levelDetails;return e===null?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return e===null?null:e-this.currentTime}}class ik extends Pm{constructor(e,t){super(e,"level-controller"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(L.LEVEL_LOADED,this.onLevelLoaded,this),e.on(L.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(L.FRAG_BUFFERED,this.onFragBuffered,this),e.on(L.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(L.LEVEL_LOADED,this.onLevelLoaded,this),e.off(L.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(L.FRAG_BUFFERED,this.onFragBuffered,this),e.off(L.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(t=>{t.loadError=0,t.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){const s=this.hls.config.preferManagedMediaSource,i=[],r={},l={};let c=!1,h=!1,u=!1;t.levels.forEach(f=>{const g=f.attrs;let{audioCodec:y,videoCodec:x}=f;y&&(f.audioCodec=y=pu(y,s)||void 0),x&&(x=f.videoCodec=B1(x));const{width:S,height:E,unknownCodecs:T}=f,A=T?.length||0;if(c||(c=!!(S&&E)),h||(h=!!x),u||(u=!!y),A||y&&!this.isAudioSupported(y)||x&&!this.isVideoSupported(x)){this.log(`Some or all CODECS not supported "${g.CODECS}"`);return}const{CODECS:_,"FRAME-RATE":I,"HDCP-LEVEL":C,"PATHWAY-ID":N,RESOLUTION:D,"VIDEO-RANGE":k}=g,j=`${`${N||"."}-`}${f.bitrate}-${D}-${I}-${_}-${k}-${C}`;if(r[j])if(r[j].uri!==f.url&&!f.attrs["PATHWAY-ID"]){const U=l[j]+=1;f.attrs["PATHWAY-ID"]=new Array(U+1).join(".");const K=this.createLevel(f);r[j]=K,i.push(K)}else r[j].addGroupId("audio",g.AUDIO),r[j].addGroupId("text",g.SUBTITLES);else{const U=this.createLevel(f);r[j]=U,l[j]=1,i.push(U)}}),this.filterAndSortMediaOptions(i,t,c,h,u)}createLevel(e){const t=new Xl(e),s=e.supplemental;if(s!=null&&s.videoCodec&&!this.isVideoSupported(s.videoCodec)){const i=new Error(`SUPPLEMENTAL-CODECS not supported "${s.videoCodec}"`);this.log(i.message),t.supportedResult=PS(i,[])}return t}isAudioSupported(e){return Ql(e,"audio",this.hls.config.preferManagedMediaSource)}isVideoSupported(e){return Ql(e,"video",this.hls.config.preferManagedMediaSource)}filterAndSortMediaOptions(e,t,s,i,r){var l;let c=[],h=[],u=e;const f=((l=t.stats)==null?void 0:l.parsing)||{};if((s||i)&&r&&(u=u.filter(({videoCodec:_,videoRange:I,width:C,height:N})=>(!!_||!!(C&&N))&&Q1(I))),u.length===0){Promise.resolve().then(()=>{if(this.hls){let _="no level with compatible codecs found in manifest",I=_;t.levels.length&&(I=`one or more CODECS in variant not supported: ${Mt(t.levels.map(N=>N.attrs.CODECS).filter((N,D,k)=>k.indexOf(N)===D))}`,this.warn(I),_+=` (${I})`);const C=new Error(_);this.hls.trigger(L.ERROR,{type:Be.MEDIA_ERROR,details:Q.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:C,reason:I})}}),f.end=performance.now();return}t.audioTracks&&(c=t.audioTracks.filter(_=>!_.audioCodec||this.isAudioSupported(_.audioCodec)),Ix(c)),t.subtitles&&(h=t.subtitles,Ix(h));const g=u.slice(0);u.sort((_,I)=>{if(_.attrs["HDCP-LEVEL"]!==I.attrs["HDCP-LEVEL"])return(_.attrs["HDCP-LEVEL"]||"")>(I.attrs["HDCP-LEVEL"]||"")?1:-1;if(s&&_.height!==I.height)return _.height-I.height;if(_.frameRate!==I.frameRate)return _.frameRate-I.frameRate;if(_.videoRange!==I.videoRange)return gu.indexOf(_.videoRange)-gu.indexOf(I.videoRange);if(_.videoCodec!==I.videoCodec){const C=gv(_.videoCodec),N=gv(I.videoCodec);if(C!==N)return N-C}if(_.uri===I.uri&&_.codecSet!==I.codecSet){const C=mu(_.codecSet),N=mu(I.codecSet);if(C!==N)return N-C}return _.averageBitrate!==I.averageBitrate?_.averageBitrate-I.averageBitrate:0});let y=g[0];if(this.steering&&(u=this.steering.filterParsedLevels(u),u.length!==g.length)){for(let _=0;_<g.length;_++)if(g[_].pathwayId===u[0].pathwayId){y=g[_];break}}this._levels=u;for(let _=0;_<u.length;_++)if(u[_]===y){var x;this._firstLevel=_;const I=y.bitrate,C=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${u.length} level(s) found, first bitrate: ${I}`),((x=this.hls.userConfig)==null?void 0:x.abrEwmaDefaultEstimate)===void 0){const N=Math.min(I,this.hls.config.abrEwmaDefaultEstimateMax);N>C&&C===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=N)}break}const S=r&&!i,E=this.hls.config,T=!!(E.audioStreamController&&E.audioTrackController),A={levels:u,audioTracks:c,subtitleTracks:h,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:r,video:i,altAudio:T&&!S&&c.some(_=>!!_.url)};f.end=performance.now(),this.hls.trigger(L.MANIFEST_PARSED,A)}get levels(){return this._levels.length===0?null:this._levels}get loadLevelObj(){return this.currentLevel}get level(){return this.currentLevelIndex}set level(e){const t=this._levels;if(t.length===0)return;if(e<0||e>=t.length){const f=new Error("invalid level idx"),g=e<0;if(this.hls.trigger(L.ERROR,{type:Be.OTHER_ERROR,details:Q.LEVEL_SWITCH_ERROR,level:e,fatal:g,error:f,reason:f.message}),g)return;e=Math.min(e,t.length-1)}const s=this.currentLevelIndex,i=this.currentLevel,r=i?i.attrs["PATHWAY-ID"]:void 0,l=t[e],c=l.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=l,s===e&&i&&r===c)return;this.log(`Switching to level ${e} (${l.height?l.height+"p ":""}${l.videoRange?l.videoRange+" ":""}${l.codecSet?l.codecSet+" ":""}@${l.bitrate})${c?" with Pathway "+c:""} from level ${s}${r?" with Pathway "+r:""}`);const h={level:e,attrs:l.attrs,details:l.details,bitrate:l.bitrate,averageBitrate:l.averageBitrate,maxBitrate:l.maxBitrate,realBitrate:l.realBitrate,width:l.width,height:l.height,codecSet:l.codecSet,audioCodec:l.audioCodec,videoCodec:l.videoCodec,audioGroups:l.audioGroups,subtitleGroups:l.subtitleGroups,loaded:l.loaded,loadError:l.loadError,fragmentError:l.fragmentError,name:l.name,id:l.id,uri:l.uri,url:l.url,urlId:0,audioGroupIds:l.audioGroupIds,textGroupIds:l.textGroupIds};this.hls.trigger(L.LEVEL_SWITCHING,h);const u=l.details;if(!u||u.live){const f=this.switchParams(l.uri,i?.details,u);this.loadPlaylist(f)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,this._startLevel===void 0&&(this._startLevel=e),e!==-1&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(this._startLevel===void 0){const e=this.hls.config.startLevel;return e!==void 0?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}get pathways(){return this.steering?this.steering.pathways():[]}get pathwayPriority(){return this.steering?this.steering.pathwayPriority:null}set pathwayPriority(e){if(this.steering){const t=this.steering.pathways(),s=e.filter(i=>t.indexOf(i)!==-1);if(e.length<1){this.warn(`pathwayPriority ${e} should contain at least one pathway from list: ${t}`);return}this.steering.pathwayPriority=s}}onError(e,t){t.fatal||!t.context||t.context.type===at.LEVEL&&t.context.level===this.level&&this.checkRetry(t)}onFragBuffered(e,{frag:t}){if(t!==void 0&&t.type===ke.MAIN){const s=t.elementaryStreams;if(!Object.keys(s).some(r=>!!s[r]))return;const i=this._levels[t.level];i!=null&&i.loadError&&(this.log(`Resetting level error count of ${i.loadError} on frag buffered`),i.loadError=0)}}onLevelLoaded(e,t){var s;const{level:i,details:r}=t,l=t.levelInfo;if(!l){var c;this.warn(`Invalid level index ${i}`),(c=t.deliveryDirectives)!=null&&c.skip&&(r.deltaUpdateFailed=!0);return}if(l===this.currentLevel||t.withoutMultiVariant){l.fragmentError===0&&(l.loadError=0);let h=l.details;h===t.details&&h.advanced&&(h=void 0),this.playlistLoaded(i,t,h)}else(s=t.deliveryDirectives)!=null&&s.skip&&(r.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const s=this.getUrlWithDirectives(e.uri,t),i=this.currentLevelIndex,r=e.attrs["PATHWAY-ID"],l=e.details,c=l?.age;this.log(`Loading level index ${i}${t?.msn!==void 0?" at sn "+t.msn+" part "+t.part:""}${r?" Pathway "+r:""}${c&&l.live?" age "+c.toFixed(1)+(l.type&&" "+l.type||""):""} ${s}`),this.hls.trigger(L.LEVEL_LOADING,{url:s,level:i,levelInfo:e,pathwayId:e.attrs["PATHWAY-ID"],id:0,deliveryDirectives:t||null})}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=e)}removeLevel(e){var t;if(this._levels.length===1)return;const s=this._levels.filter((r,l)=>l!==e?!0:(this.steering&&this.steering.removeLevel(r),r===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,r.details&&r.details.fragments.forEach(c=>c.level=-1)),!1));sb(s),this._levels=s,this.currentLevelIndex>-1&&(t=this.currentLevel)!=null&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);const i=s.length-1;this._firstLevel=Math.min(this._firstLevel,i),this._startLevel&&(this._startLevel=Math.min(this._startLevel,i)),this.hls.trigger(L.LEVELS_UPDATED,{levels:s})}onLevelsUpdated(e,{levels:t}){this._levels=t}checkMaxAutoUpdated(){const{autoLevelCapping:e,maxAutoLevel:t,maxHdcpLevel:s}=this.hls;this._maxAutoLevel!==t&&(this._maxAutoLevel=t,this.hls.trigger(L.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:t,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:s}))}}function Ix(n){const e={};n.forEach(t=>{const s=t.groupId||"";t.id=e[s]=e[s]||0,e[s]++})}function Xb(){return self.SourceBuffer||self.WebKitSourceBuffer}function Zb(){if(!Ea())return!1;const e=Xb();return!e||e.prototype&&typeof e.prototype.appendBuffer=="function"&&typeof e.prototype.remove=="function"}function nk(){if(!Zb())return!1;const n=Ea();return typeof n?.isTypeSupported=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(e=>n.isTypeSupported(Wl(e,"video")))||["mp4a.40.2","fLaC"].some(e=>n.isTypeSupported(Wl(e,"audio"))))}function ak(){var n;const e=Xb();return typeof(e==null||(n=e.prototype)==null?void 0:n.changeType)=="function"}const rk=100;class lk extends Rm{constructor(e,t,s){super(e,t,s,"stream-controller",ke.MAIN),this.audioCodecSwap=!1,this.level=-1,this._forceStartLoad=!1,this._hasEnoughToStart=!1,this.altAudio=0,this.audioOnly=!1,this.fragPlaying=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this.onMediaPlaying=()=>{this.tick()},this.onMediaSeeked=()=>{const i=this.media,r=i?i.currentTime:null;if(r===null||!Ne(r)||(this.log(`Media seeked to ${r.toFixed(3)}`),!this.getBufferedFrag(r)))return;const l=this.getFwdBufferInfoAtPos(i,r,ke.MAIN,0);if(l===null||l.len===0){this.warn(`Main forward buffer length at ${r} on "seeked" event ${l?l.len:"empty"})`);return}this.tick()},this.registerListeners()}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(L.MANIFEST_PARSED,this.onManifestParsed,this),e.on(L.LEVEL_LOADING,this.onLevelLoading,this),e.on(L.LEVEL_LOADED,this.onLevelLoaded,this),e.on(L.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(L.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(L.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(L.BUFFER_CREATED,this.onBufferCreated,this),e.on(L.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(L.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(L.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(L.MANIFEST_PARSED,this.onManifestParsed,this),e.off(L.LEVEL_LOADED,this.onLevelLoaded,this),e.off(L.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(L.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(L.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(L.BUFFER_CREATED,this.onBufferCreated,this),e.off(L.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(L.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(L.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),super.onHandlerDestroying()}startLoad(e,t){if(this.levels){const{lastCurrentTime:s,hls:i}=this;if(this.stopLoad(),this.setInterval(rk),this.level=-1,!this.startFragRequested){let r=i.startLevel;r===-1&&(i.config.testBandwidth&&this.levels.length>1?(r=0,this.bitrateTest=!0):r=i.firstAutoLevel),i.nextLoadLevel=r,this.level=i.loadLevel,this._hasEnoughToStart=!!t}s>0&&e===-1&&!t&&(this.log(`Override startPosition with lastCurrentTime @${s.toFixed(3)}`),e=s),this.state=ue.IDLE,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}else this._forceStartLoad=!0,this.state=ue.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case ue.WAITING_LEVEL:{const{levels:e,level:t}=this,s=e?.[t],i=s?.details;if(i&&(!i.live||this.levelLastLoaded===s&&!this.waitForLive(s))){if(this.waitForCdnTuneIn(i))break;this.state=ue.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=ue.IDLE;break}break}case ue.FRAG_LOADING_WAITING_RETRY:this.checkRetryDate();break}this.state===ue.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){var e;super.onTickEnd(),(e=this.media)!=null&&e.readyState&&this.media.seeking===!1&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:t,levels:s,media:i}=this;if(t===null||!i&&!this.primaryPrefetch&&(this.startFragRequested||!e.config.startFragPrefetch)||this.altAudio&&this.audioOnly)return;const r=this.buffering?e.nextLoadLevel:e.loadLevel;if(!(s!=null&&s[r]))return;const l=s[r],c=this.getMainFwdBufferInfo();if(c===null)return;const h=this.getLevelDetails();if(h&&this._streamEnded(c,h)){const E={};this.altAudio===2&&(E.type="video"),this.hls.trigger(L.BUFFER_EOS,E),this.state=ue.ENDED;return}if(!this.buffering)return;e.loadLevel!==r&&e.manualLevel===-1&&this.log(`Adapting to level ${r} from level ${this.level}`),this.level=e.nextLoadLevel=r;const u=l.details;if(!u||this.state===ue.WAITING_LEVEL||this.waitForLive(l)){this.level=r,this.state=ue.WAITING_LEVEL,this.startFragRequested=!1;return}const f=c.len,g=this.getMaxBufferLength(l.maxBitrate);if(f>=g)return;this.backtrackFragment&&this.backtrackFragment.start>c.end&&(this.backtrackFragment=null);const y=this.backtrackFragment?this.backtrackFragment.start:c.end;let x=this.getNextFragment(y,u);if(this.couldBacktrack&&!this.fragPrevious&&x&&ss(x)&&this.fragmentTracker.getState(x)!==fs.OK){var S;const T=((S=this.backtrackFragment)!=null?S:x).sn-u.startSN,A=u.fragments[T-1];A&&x.cc===A.cc&&(x=A,this.fragmentTracker.removeFragment(A))}else this.backtrackFragment&&c.len&&(this.backtrackFragment=null);if(x&&this.isLoopLoading(x,y)){if(!x.gap){const T=this.audioOnly&&!this.altAudio?Ut.AUDIO:Ut.VIDEO,A=(T===Ut.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;A&&this.afterBufferFlushed(A,T,ke.MAIN)}x=this.getNextFragmentLoopLoading(x,u,c,ke.MAIN,g)}x&&(x.initSegment&&!x.initSegment.data&&!this.bitrateTest&&(x=x.initSegment),this.loadFragment(x,l,y))}loadFragment(e,t,s){const i=this.fragmentTracker.getState(e);i===fs.NOT_LOADED||i===fs.PARTIAL?ss(e)?this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):super.loadFragment(e,t,s):this._loadInitSegment(e,t):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,ke.MAIN)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:t}=this;if(t!=null&&t.readyState){let s;const i=this.getAppendedFrag(t.currentTime);i&&i.start>1&&this.flushMainBuffer(0,i.start-1);const r=this.getLevelDetails();if(r!=null&&r.live){const c=this.getMainFwdBufferInfo();if(!c||c.len<r.targetduration*2)return}if(!t.paused&&e){const c=this.hls.nextLoadLevel,h=e[c],u=this.fragLastKbps;u&&this.fragCurrent?s=this.fragCurrent.duration*h.maxBitrate/(1e3*u)+1:s=0}else s=0;const l=this.getBufferedFrag(t.currentTime+s);if(l){const c=this.followingBufferedFrag(l);if(c){this.abortCurrentFrag();const h=c.maxStartPTS?c.maxStartPTS:c.start,u=c.duration,f=Math.max(l.end,h+Math.min(Math.max(u-this.config.maxFragLookUpTolerance,u*(this.couldBacktrack?.5:.125)),u*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(f,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case ue.KEY_LOADING:case ue.FRAG_LOADING:case ue.FRAG_LOADING_WAITING_RETRY:case ue.PARSING:case ue.PARSED:this.state=ue.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,this.altAudio===2?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);const s=t.media;$s(s,"playing",this.onMediaPlaying),$s(s,"seeked",this.onMediaSeeked)}onMediaDetaching(e,t){const{media:s}=this;s&&(ei(s,"playing",this.onMediaPlaying),ei(s,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,super.onMediaDetaching(e,t),!t.transferMedia&&(this._hasEnoughToStart=!1)}onManifestLoading(){super.onManifestLoading(),this.log("Trigger BUFFER_RESET"),this.hls.trigger(L.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1}onManifestParsed(e,t){let s=!1,i=!1;for(let r=0;r<t.levels.length;r++){const l=t.levels[r].audioCodec;l&&(s=s||l.indexOf("mp4a.40.2")!==-1,i=i||l.indexOf("mp4a.40.5")!==-1)}this.audioCodecSwitch=s&&i&&!ak(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){const{levels:s}=this;if(!s||this.state!==ue.IDLE)return;const i=t.levelInfo;(!i.details||i.details.live&&(this.levelLastLoaded!==i||i.details.expired)||this.waitForCdnTuneIn(i.details))&&(this.state=ue.WAITING_LEVEL)}onLevelLoaded(e,t){var s;const{levels:i,startFragRequested:r}=this,l=t.level,c=t.details,h=c.totalduration;if(!i){this.warn(`Levels were reset while loading level ${l}`);return}this.log(`Level ${l} loaded [${c.startSN},${c.endSN}]${c.lastPartSn?`[part-${c.lastPartSn}-${c.lastPartIndex}]`:""}, cc [${c.startCC}, ${c.endCC}] duration:${h}`);const u=t.levelInfo,f=this.fragCurrent;f&&(this.state===ue.FRAG_LOADING||this.state===ue.FRAG_LOADING_WAITING_RETRY)&&f.level!==t.level&&f.loader&&this.abortCurrentFrag();let g=0;if(c.live||(s=u.details)!=null&&s.live){var y;if(this.checkLiveUpdate(c),c.deltaUpdateFailed)return;g=this.alignPlaylists(c,u.details,(y=this.levelLastLoaded)==null?void 0:y.details)}if(u.details=c,this.levelLastLoaded=u,r||this.setStartPosition(c,g),this.hls.trigger(L.LEVEL_UPDATED,{details:c,level:l}),this.state===ue.WAITING_LEVEL){if(this.waitForCdnTuneIn(c))return;this.state=ue.IDLE}r&&c.live&&this.synchronizeToLiveEdge(c),this.tick()}synchronizeToLiveEdge(e){const{config:t,media:s}=this;if(!s)return;const i=this.hls.liveSyncPosition,r=this.getLoadPosition(),l=e.fragmentStart,c=e.edge,h=r>=l-t.maxFragLookUpTolerance&&r<=c;if(i!==null&&s.duration>i&&(r<i||!h)){const f=t.liveMaxLatencyDuration!==void 0?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;if((!h&&s.readyState<4||r<c-f)&&(this._hasEnoughToStart||(this.nextLoadPosition=i),s.readyState))if(this.warn(`Playback: ${r.toFixed(3)} is located too far from the end of live sliding playlist: ${c}, reset currentTime to : ${i.toFixed(3)}`),this.config.liveSyncMode==="buffered"){var u;const g=qe.bufferInfo(s,i,0);if(!((u=g.buffered)!=null&&u.length)){s.currentTime=i;return}if(g.start<=r){s.currentTime=i;return}const{nextStart:x}=qe.bufferedInfo(g.buffered,r,0);x&&(s.currentTime=x)}else s.currentTime=i}}_handleFragmentLoadProgress(e){var t;const s=e.frag,{part:i,payload:r}=e,{levels:l}=this;if(!l){this.warn(`Levels were reset while fragment load was in progress. Fragment ${s.sn} of level ${s.level} will not be buffered`);return}const c=l[s.level];if(!c){this.warn(`Level ${s.level} not found on progress`);return}const h=c.details;if(!h){this.warn(`Dropping fragment ${s.sn} of level ${s.level} after level details were reset`),this.fragmentTracker.removeFragment(s);return}const u=c.videoCodec,f=h.PTSKnown||!h.live,g=(t=s.initSegment)==null?void 0:t.data,y=this._getAudioCodec(c),x=this.transmuxer=this.transmuxer||new Ab(this.hls,ke.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),S=i?i.index:-1,E=S!==-1,T=new Am(s.level,s.sn,s.stats.chunkCount,r.byteLength,S,E),A=this.initPTS[s.cc];x.push(r,g,y,u,s,i,h.totalduration,f,T,A)}onAudioTrackSwitching(e,t){const s=this.hls,i=this.altAudio!==0;if(yu(t.url,s))this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const l=this.fragCurrent;l&&(this.log("Switching to main audio track, cancel main fragment load"),l.abortRequests(),this.fragmentTracker.removeFragment(l)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(i){this.altAudio=0,this.fragmentTracker.removeAllFragments(),s.once(L.BUFFER_FLUSHED,()=>{this.hls&&this.hls.trigger(L.AUDIO_TRACK_SWITCHED,t)}),s.trigger(L.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});return}s.trigger(L.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){const s=yu(t.url,this.hls);if(s){const i=this.videoBuffer;i&&this.mediaBuffer!==i&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=i)}this.altAudio=s?2:0,this.tick()}onBufferCreated(e,t){const s=t.tracks;let i,r,l=!1;for(const c in s){const h=s[c];if(h.id==="main"){if(r=c,i=h,c==="video"){const u=s[c];u&&(this.videoBuffer=u.buffer)}}else l=!0}l&&i?(this.log(`Alternate track found, use ${r}.buffered to schedule main fragment loading`),this.mediaBuffer=i.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){const{frag:s,part:i}=t,r=s.type===ke.MAIN;if(r){if(this.fragContextChanged(s)){this.warn(`Fragment ${s.sn}${i?" p: "+i.index:""} of level ${s.level} finished buffering, but was aborted. state: ${this.state}`),this.state===ue.PARSED&&(this.state=ue.IDLE);return}const c=i?i.stats:s.stats;this.fragLastKbps=Math.round(8*c.total/(c.buffering.end-c.loading.first)),ss(s)&&(this.fragPrevious=s),this.fragBufferedComplete(s,i)}const l=this.media;l&&(!this._hasEnoughToStart&&qe.getBuffered(l).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),r&&this.tick())}get hasEnoughToStart(){return this._hasEnoughToStart}onError(e,t){var s;if(t.fatal){this.state=ue.ERROR;return}switch(t.details){case Q.FRAG_GAP:case Q.FRAG_PARSING_ERROR:case Q.FRAG_DECRYPT_ERROR:case Q.FRAG_LOAD_ERROR:case Q.FRAG_LOAD_TIMEOUT:case Q.KEY_LOAD_ERROR:case Q.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(ke.MAIN,t);break;case Q.LEVEL_LOAD_ERROR:case Q.LEVEL_LOAD_TIMEOUT:case Q.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===ue.WAITING_LEVEL&&((s=t.context)==null?void 0:s.type)===at.LEVEL&&(this.state=ue.IDLE);break;case Q.BUFFER_ADD_CODEC_ERROR:case Q.BUFFER_APPEND_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&this.resetLoadingState();break;case Q.BUFFER_FULL_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&(!this.config.interstitialsController&&this.config.assetPlayerId?this._hasEnoughToStart=!0:this.flushMainBuffer(0,Number.POSITIVE_INFINITY));break;case Q.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onFragLoadEmergencyAborted(){this.state=ue.IDLE,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()}onBufferFlushed(e,{type:t}){if(t!==Ut.AUDIO||!this.altAudio){const s=(t===Ut.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;s&&(this.afterBufferFlushed(s,t,ke.MAIN),this.tick())}}onLevelsUpdated(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,this.level===-1&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const t=e.currentTime;let s=this.startPosition;if(s>=0&&t<s){if(e.seeking){this.log(`could not seek to ${s}, already seeking at ${t}`);return}const i=this.timelineOffset;i&&s&&(s+=i);const r=this.getLevelDetails(),l=qe.getBuffered(e),c=l.length?l.start(0):0,h=c-s,u=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);(this.config.startOnSegmentBoundary||h>0&&(h<u||this.loadingParts&&h<2*(r?.partTarget||0)))&&(this.log(`adjusting start position by ${h} to match buffer start`),s+=h,this.startPosition=s),t<s&&(this.log(`seek to target start position ${s} from current time ${t} buffer start ${c}`),e.currentTime=s)}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t.indexOf("mp4a.40.5")!==-1?t="mp4a.40.2":t="mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then(s=>{const{hls:i}=this,r=s?.frag;if(!r||this.fragContextChanged(r))return;t.fragmentError=0,this.state=ue.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const l=r.stats;l.parsing.start=l.parsing.end=l.buffering.start=l.buffering.end=self.performance.now(),i.trigger(L.FRAG_LOADED,s),r.bitrateTest=!1}).catch(s=>{this.state===ue.STOPPED||this.state===ue.ERROR||(this.warn(s),this.resetFragmentLoading(e))})}_handleTransmuxComplete(e){const t=this.playlistType,{hls:s}=this,{remuxResult:i,chunkMeta:r}=e,l=this.getCurrentContext(r);if(!l){this.resetWhenMissingContext(r);return}const{frag:c,part:h,level:u}=l,{video:f,text:g,id3:y,initSegment:x}=i,{details:S}=u,E=this.altAudio?void 0:i.audio;if(this.fragContextChanged(c)){this.fragmentTracker.removeFragment(c);return}if(this.state=ue.PARSING,x){const T=x.tracks;if(T){const C=c.initSegment||c;if(this.unhandledEncryptionError(x,c))return;this._bufferInitSegment(u,T,C,r),s.trigger(L.FRAG_PARSING_INIT_SEGMENT,{frag:C,id:t,tracks:T})}const A=x.initPTS,_=x.timescale,I=this.initPTS[c.cc];if(Ne(A)&&(!I||I.baseTime!==A||I.timescale!==_)){const C=x.trackId;this.initPTS[c.cc]={baseTime:A,timescale:_,trackId:C},s.trigger(L.INIT_PTS_FOUND,{frag:c,id:t,initPTS:A,timescale:_,trackId:C})}}if(f&&S){E&&f.type==="audiovideo"&&this.logMuxedErr(c);const T=S.fragments[c.sn-1-S.startSN],A=c.sn===S.startSN,_=!T||c.cc>T.cc;if(i.independent!==!1){const{startPTS:I,endPTS:C,startDTS:N,endDTS:D}=f;if(h)h.elementaryStreams[f.type]={startPTS:I,endPTS:C,startDTS:N,endDTS:D};else if(f.firstKeyFrame&&f.independent&&r.id===1&&!_&&(this.couldBacktrack=!0),f.dropped&&f.independent){const k=this.getMainFwdBufferInfo(),B=(k?k.end:this.getLoadPosition())+this.config.maxBufferHole,j=f.firstKeyFramePTS?f.firstKeyFramePTS:I;if(!A&&B<j-this.config.maxBufferHole&&!_){this.backtrack(c);return}else _&&(c.gap=!0);c.setElementaryStreamInfo(f.type,c.start,C,c.start,D,!0)}else A&&I-(S.appliedTimelineOffset||0)>ou&&(c.gap=!0);c.setElementaryStreamInfo(f.type,I,C,N,D),this.backtrackFragment&&(this.backtrackFragment=c),this.bufferFragmentData(f,c,h,r,A||_)}else if(A||_)c.gap=!0;else{this.backtrack(c);return}}if(E){const{startPTS:T,endPTS:A,startDTS:_,endDTS:I}=E;h&&(h.elementaryStreams[Ut.AUDIO]={startPTS:T,endPTS:A,startDTS:_,endDTS:I}),c.setElementaryStreamInfo(Ut.AUDIO,T,A,_,I),this.bufferFragmentData(E,c,h,r)}if(S&&y!=null&&y.samples.length){const T={id:t,frag:c,details:S,samples:y.samples};s.trigger(L.FRAG_PARSING_METADATA,T)}if(S&&g){const T={id:t,frag:c,details:S,samples:g.samples};s.trigger(L.FRAG_PARSING_USERDATA,T)}}logMuxedErr(e){this.warn(`${ss(e)?"Media":"Init"} segment with muxed audiovideo where only video expected: ${e.url}`)}_bufferInitSegment(e,t,s,i){if(this.state!==ue.PARSING)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&(delete t.audio,t.audiovideo&&this.logMuxedErr(s));const{audio:r,video:l,audiovideo:c}=t;if(r){const u=e.audioCodec;let f=tu(r.codec,u);f==="mp4a"&&(f="mp4a.40.5");const g=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){f&&(f.indexOf("mp4a.40.5")!==-1?f="mp4a.40.2":f="mp4a.40.5");const y=r.metadata;y&&"channelCount"in y&&(y.channelCount||1)!==1&&g.indexOf("firefox")===-1&&(f="mp4a.40.5")}f&&f.indexOf("mp4a.40.5")!==-1&&g.indexOf("android")!==-1&&r.container!=="audio/mpeg"&&(f="mp4a.40.2",this.log(`Android: force audio codec to ${f}`)),u&&u!==f&&this.log(`Swapping manifest audio codec "${u}" for "${f}"`),r.levelCodec=f,r.id=ke.MAIN,this.log(`Init audio buffer, container:${r.container}, codecs[selected/level/parsed]=[${f||""}/${u||""}/${r.codec}]`),delete t.audiovideo}if(l){l.levelCodec=e.videoCodec,l.id=ke.MAIN;const u=l.codec;if(u?.length===4)switch(u){case"hvc1":case"hev1":l.codec="hvc1.1.6.L120.90";break;case"av01":l.codec="av01.0.04M.08";break;case"avc1":l.codec="avc1.42e01e";break}this.log(`Init video buffer, container:${l.container}, codecs[level/parsed]=[${e.videoCodec||""}/${u}]${l.codec!==u?" parsed-corrected="+l.codec:""}${l.supplemental?" supplemental="+l.supplemental:""}`),delete t.audiovideo}c&&(this.log(`Init audiovideo buffer, container:${c.container}, codecs[level/parsed]=[${e.codecs}/${c.codec}]`),delete t.video,delete t.audio);const h=Object.keys(t);if(h.length){if(this.hls.trigger(L.BUFFER_CODECS,t),!this.hls)return;h.forEach(u=>{const g=t[u].initSegment;g!=null&&g.byteLength&&this.hls.trigger(L.BUFFER_APPENDING,{type:u,data:g,frag:s,part:null,chunkMeta:i,parent:s.type})})}this.tickImmediate()}getMainFwdBufferInfo(){const e=this.mediaBuffer&&this.altAudio===2?this.mediaBuffer:this.media;return this.getFwdBufferInfo(e,ke.MAIN)}get maxBufferLength(){const{levels:e,level:t}=this,s=e?.[t];return s?this.getMaxBufferLength(s.maxBitrate):this.config.maxBufferLength}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=ue.IDLE}checkFragmentChanged(){const e=this.media;let t=null;if(e&&e.readyState>1&&e.seeking===!1){const s=e.currentTime;if(qe.isBuffered(e,s)?t=this.getAppendedFrag(s):qe.isBuffered(e,s+.1)&&(t=this.getAppendedFrag(s+.1)),t){this.backtrackFragment=null;const i=this.fragPlaying,r=t.level;(!i||t.sn!==i.sn||i.level!==r)&&(this.fragPlaying=t,this.hls.trigger(L.FRAG_CHANGED,{frag:t}),(!i||i.level!==r)&&this.hls.trigger(L.LEVEL_SWITCHED,{level:r}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){var e;if(this.fragPlaying)return this.fragPlaying;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;return Ne(t)?this.getAppendedFrag(t):null}get currentProgramDateTime(){var e;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;if(Ne(t)){const s=this.getLevelDetails(),i=this.currentFrag||(s?Qa(null,s.fragments,t):null);if(i){const r=i.programDateTime;if(r!==null){const l=r+(t-i.start)*1e3;return new Date(l)}}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class ok extends ji{constructor(e,t){super("key-loader",t),this.config=void 0,this.keyIdToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const s in this.keyIdToKeyInfo){const i=this.keyIdToKeyInfo[s].loader;if(i){var t;if(e&&e!==((t=i.context)==null?void 0:t.frag.type))return;i.abort()}}}detach(){for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyIdToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e].loader;t&&t.destroy()}this.keyIdToKeyInfo={}}createKeyLoadError(e,t=Q.KEY_LOAD_ERROR,s,i,r){return new jn({type:Be.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:r,error:s,networkDetails:i})}loadClear(e,t,s){if(this.emeController&&this.config.emeEnabled&&!this.emeController.getSelectedKeySystemFormats().length){if(t.length)for(let i=0,r=t.length;i<r;i++){const l=t[i];if(e.cc<=l.cc&&(!ss(e)||!ss(l)||e.sn<l.sn)||!s&&i==r-1)return this.emeController.selectKeySystemFormat(l).then(c=>{if(!this.emeController)return;l.setKeyFormat(c);const h=iu(c);if(h)return this.emeController.getKeySystemAccess([h])})}if(this.config.requireKeySystemAccessOnStart){const i=Hl(this.config);if(i.length)return this.emeController.getKeySystemAccess(i)}}return null}load(e){return!e.decryptdata&&e.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(e).then(t=>this.loadInternal(e,t)):this.loadInternal(e)}loadInternal(e,t){var s,i;t&&e.setKeyFormat(t);const r=e.decryptdata;if(!r){const u=new Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:`Missing decryption data on fragment in onKeyLoading (emeEnabled with controller: ${this.emeController&&this.config.emeEnabled})`);return Promise.reject(this.createKeyLoadError(e,Q.KEY_LOAD_ERROR,u))}const l=r.uri;if(!l)return Promise.reject(this.createKeyLoadError(e,Q.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${l}"`)));const c=Lf(r);let h=this.keyIdToKeyInfo[c];if((s=h)!=null&&s.decryptdata.key)return r.key=h.decryptdata.key,Promise.resolve({frag:e,keyInfo:h});if(this.emeController&&(i=h)!=null&&i.keyLoadPromise)switch(this.emeController.getKeyStatus(h.decryptdata)){case"usable":case"usable-in-future":return h.keyLoadPromise.then(f=>{const{keyInfo:g}=f;return r.key=g.decryptdata.key,{frag:e,keyInfo:g}})}switch(this.log(`${this.keyIdToKeyInfo[c]?"Rel":"L"}oading${r.keyId?" keyId: "+Is(r.keyId):""} URI: ${r.uri} from ${e.type} ${e.level}`),h=this.keyIdToKeyInfo[c]={decryptdata:r,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},r.method){case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return r.keyFormat==="identity"?this.loadKeyHTTP(h,e):this.loadKeyEME(h,e);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(h,e);default:return Promise.reject(this.createKeyLoadError(e,Q.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${r.method}"`)))}}loadKeyEME(e,t){const s={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){var i;if(!e.decryptdata.keyId&&(i=t.initSegment)!=null&&i.data){const l=R1(t.initSegment.data);if(l.length){let c=l[0];c.some(h=>h!==0)?(this.log(`Using keyId found in init segment ${Is(c)}`),ba.setKeyIdForUri(e.decryptdata.uri,c)):(c=ba.addKeyIdForUri(e.decryptdata.uri),this.log(`Generating keyId to patch media ${Is(c)}`)),e.decryptdata.keyId=c}}if(!e.decryptdata.keyId&&!ss(t))return Promise.resolve(s);const r=this.emeController.loadKey(s);return(e.keyLoadPromise=r.then(l=>(e.mediaKeySessionContext=l,s))).catch(l=>{throw e.keyLoadPromise=null,"data"in l&&(l.data.frag=t),l})}return Promise.resolve(s)}loadKeyHTTP(e,t){const s=this.config,i=s.loader,r=new i(s);return t.keyLoader=e.loader=r,e.keyLoadPromise=new Promise((l,c)=>{const h={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},u=s.keyLoadPolicy.default,f={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},g={onSuccess:(y,x,S,E)=>{const{frag:T,keyInfo:A}=S,_=Lf(A.decryptdata);if(!T.decryptdata||A!==this.keyIdToKeyInfo[_])return c(this.createKeyLoadError(T,Q.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),E));A.decryptdata.key=T.decryptdata.key=new Uint8Array(y.data),T.keyLoader=null,A.loader=null,l({frag:T,keyInfo:A})},onError:(y,x,S,E)=>{this.resetLoader(x),c(this.createKeyLoadError(t,Q.KEY_LOAD_ERROR,new Error(`HTTP Error ${y.code} loading key ${y.text}`),S,Rt({url:h.url,data:void 0},y)))},onTimeout:(y,x,S)=>{this.resetLoader(x),c(this.createKeyLoadError(t,Q.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),S))},onAbort:(y,x,S)=>{this.resetLoader(x),c(this.createKeyLoadError(t,Q.INTERNAL_ABORTED,new Error("key loading aborted"),S))}};r.load(h,f,g)})}resetLoader(e){const{frag:t,keyInfo:s,url:i}=e,r=s.loader;t.keyLoader===r&&(t.keyLoader=null,s.loader=null);const l=Lf(s.decryptdata)||i;delete this.keyIdToKeyInfo[l],r&&r.destroy()}}function Lf(n){if(n.keyFormat!==_s.FAIRPLAY){const e=n.keyId;if(e)return Is(e)}return n.uri}function _x(n){const{type:e}=n;switch(e){case at.AUDIO_TRACK:return ke.AUDIO;case at.SUBTITLE_TRACK:return ke.SUBTITLE;default:return ke.MAIN}}function wf(n,e){let t=n.url;return(t===void 0||t.indexOf("data:")===0)&&(t=e.url),t}class ck{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.LEVEL_LOADING,this.onLevelLoading,this),e.on(L.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(L.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.on(L.LEVELS_UPDATED,this.onLevelsUpdated,this)}unregisterListeners(){const{hls:e}=this;e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.LEVEL_LOADING,this.onLevelLoading,this),e.off(L.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(L.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.off(L.LEVELS_UPDATED,this.onLevelsUpdated,this)}createInternalLoader(e){const t=this.hls.config,s=t.pLoader,i=t.loader,r=s||i,l=new r(t);return this.loaders[e.type]=l,l}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){const{url:s}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:at.MANIFEST,url:s,deliveryDirectives:null,levelOrTrack:null})}onLevelLoading(e,t){const{id:s,level:i,pathwayId:r,url:l,deliveryDirectives:c,levelInfo:h}=t;this.load({id:s,level:i,pathwayId:r,responseType:"text",type:at.LEVEL,url:l,deliveryDirectives:c,levelOrTrack:h})}onAudioTrackLoading(e,t){const{id:s,groupId:i,url:r,deliveryDirectives:l,track:c}=t;this.load({id:s,groupId:i,level:null,responseType:"text",type:at.AUDIO_TRACK,url:r,deliveryDirectives:l,levelOrTrack:c})}onSubtitleTrackLoading(e,t){const{id:s,groupId:i,url:r,deliveryDirectives:l,track:c}=t;this.load({id:s,groupId:i,level:null,responseType:"text",type:at.SUBTITLE_TRACK,url:r,deliveryDirectives:l,levelOrTrack:c})}onLevelsUpdated(e,t){const s=this.loaders[at.LEVEL];if(s){const i=s.context;i&&!t.levels.some(r=>r===i.levelOrTrack)&&(s.abort(),delete this.loaders[at.LEVEL])}}load(e){var t;const s=this.hls.config;let i=this.getInternalLoader(e);if(i){const u=this.hls.logger,f=i.context;if(f&&f.levelOrTrack===e.levelOrTrack&&(f.url===e.url||f.deliveryDirectives&&!e.deliveryDirectives)){f.url===e.url?u.log(`[playlist-loader]: ignore ${e.url} ongoing request`):u.log(`[playlist-loader]: ignore ${e.url} in favor of ${f.url}`);return}u.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),i.abort()}let r;if(e.type===at.MANIFEST?r=s.manifestLoadPolicy.default:r=Dt({},s.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),i=this.createInternalLoader(e),Ne((t=e.deliveryDirectives)==null?void 0:t.part)){let u;if(e.type===at.LEVEL&&e.level!==null?u=this.hls.levels[e.level].details:e.type===at.AUDIO_TRACK&&e.id!==null?u=this.hls.audioTracks[e.id].details:e.type===at.SUBTITLE_TRACK&&e.id!==null&&(u=this.hls.subtitleTracks[e.id].details),u){const f=u.partTarget,g=u.targetduration;if(f&&g){const y=Math.max(f*3,g*.8)*1e3;r=Dt({},r,{maxTimeToFirstByteMs:Math.min(y,r.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(y,r.maxTimeToFirstByteMs)})}}}const l=r.errorRetry||r.timeoutRetry||{},c={loadPolicy:r,timeout:r.maxLoadTimeMs,maxRetry:l.maxNumRetry||0,retryDelay:l.retryDelayMs||0,maxRetryDelay:l.maxRetryDelayMs||0},h={onSuccess:(u,f,g,y)=>{const x=this.getInternalLoader(g);this.resetInternalLoader(g.type);const S=u.data;f.parsing.start=performance.now(),un.isMediaPlaylist(S)||g.type!==at.MANIFEST?this.handleTrackOrLevelPlaylist(u,f,g,y||null,x):this.handleMasterPlaylist(u,f,g,y)},onError:(u,f,g,y)=>{this.handleNetworkError(f,g,!1,u,y)},onTimeout:(u,f,g)=>{this.handleNetworkError(f,g,!0,void 0,u)}};i.load(e,c,h)}checkAutostartLoad(){if(!this.hls)return;const{config:{autoStartLoad:e,startPosition:t},forceStartLoad:s}=this.hls;(e||s)&&(this.hls.logger.log(`${e?"auto":"force"} startLoad with configured startPosition ${t}`),this.hls.startLoad(t))}handleMasterPlaylist(e,t,s,i){const r=this.hls,l=e.data,c=wf(e,s),h=un.parseMasterPlaylist(l,c);if(h.playlistParsingError){t.parsing.end=performance.now(),this.handleManifestParsingError(e,s,h.playlistParsingError,i,t);return}const{contentSteering:u,levels:f,sessionData:g,sessionKeys:y,startTimeOffset:x,variableList:S}=h;this.variableList=S,f.forEach(_=>{const{unknownCodecs:I}=_;if(I){const{preferManagedMediaSource:C}=this.hls.config;let{audioCodec:N,videoCodec:D}=_;for(let k=I.length;k--;){const B=I[k];Ql(B,"audio",C)?(_.audioCodec=N=N?`${N},${B}`:B,Hr.audio[N.substring(0,4)]=2,I.splice(k,1)):Ql(B,"video",C)&&(_.videoCodec=D=D?`${D},${B}`:B,Hr.video[D.substring(0,4)]=2,I.splice(k,1))}}});const{AUDIO:E=[],SUBTITLES:T,"CLOSED-CAPTIONS":A}=un.parseMasterPlaylistMedia(l,c,h);E.length&&!E.some(I=>!I.url)&&f[0].audioCodec&&!f[0].attrs.AUDIO&&(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),E.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new Yt({}),bitrate:0,url:""})),r.trigger(L.MANIFEST_LOADED,{levels:f,audioTracks:E,subtitles:T,captions:A,contentSteering:u,url:c,stats:t,networkDetails:i,sessionData:g,sessionKeys:y,startTimeOffset:x,variableList:S})}handleTrackOrLevelPlaylist(e,t,s,i,r){const l=this.hls,{id:c,level:h,type:u}=s,f=wf(e,s),g=Ne(h)?h:Ne(c)?c:0,y=_x(s),x=un.parseLevelPlaylist(e.data,f,g,y,0,this.variableList);if(u===at.MANIFEST){const S={attrs:new Yt({}),bitrate:0,details:x,name:"",url:f};x.requestScheduled=t.loading.start+JS(x,0),l.trigger(L.MANIFEST_LOADED,{levels:[S],audioTracks:[],url:f,stats:t,networkDetails:i,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),s.levelDetails=x,this.handlePlaylistLoaded(x,e,t,s,i,r)}handleManifestParsingError(e,t,s,i,r){this.hls.trigger(L.ERROR,{type:Be.NETWORK_ERROR,details:Q.MANIFEST_PARSING_ERROR,fatal:t.type===at.MANIFEST,url:e.url,err:s,error:s,reason:s.message,response:e,context:t,networkDetails:i,stats:r})}handleNetworkError(e,t,s=!1,i,r){let l=`A network ${s?"timeout":"error"+(i?" (status "+i.code+")":"")} occurred while loading ${e.type}`;e.type===at.LEVEL?l+=`: ${e.level} id: ${e.id}`:(e.type===at.AUDIO_TRACK||e.type===at.SUBTITLE_TRACK)&&(l+=` id: ${e.id} group-id: "${e.groupId}"`);const c=new Error(l);this.hls.logger.warn(`[playlist-loader]: ${l}`);let h=Q.UNKNOWN,u=!1;const f=this.getInternalLoader(e);switch(e.type){case at.MANIFEST:h=s?Q.MANIFEST_LOAD_TIMEOUT:Q.MANIFEST_LOAD_ERROR,u=!0;break;case at.LEVEL:h=s?Q.LEVEL_LOAD_TIMEOUT:Q.LEVEL_LOAD_ERROR,u=!1;break;case at.AUDIO_TRACK:h=s?Q.AUDIO_TRACK_LOAD_TIMEOUT:Q.AUDIO_TRACK_LOAD_ERROR,u=!1;break;case at.SUBTITLE_TRACK:h=s?Q.SUBTITLE_TRACK_LOAD_TIMEOUT:Q.SUBTITLE_LOAD_ERROR,u=!1;break}f&&this.resetInternalLoader(e.type);const g={type:Be.NETWORK_ERROR,details:h,fatal:u,url:e.url,loader:f,context:e,error:c,networkDetails:t,stats:r};if(i){const y=t?.url||e.url;g.response=Rt({url:y,data:void 0},i)}this.hls.trigger(L.ERROR,g)}handlePlaylistLoaded(e,t,s,i,r,l){const c=this.hls,{type:h,level:u,levelOrTrack:f,id:g,groupId:y,deliveryDirectives:x}=i,S=wf(t,i),E=_x(i);let T=typeof i.level=="number"&&E===ke.MAIN?u:void 0;const A=e.playlistParsingError;if(A){if(this.hls.logger.warn(`${A} ${e.url}`),!c.config.ignorePlaylistParsingErrors){c.trigger(L.ERROR,{type:Be.NETWORK_ERROR,details:Q.LEVEL_PARSING_ERROR,fatal:!1,url:S,error:A,reason:A.message,response:t,context:i,level:T,parent:E,networkDetails:r,stats:s});return}e.playlistParsingError=null}if(!e.fragments.length){const _=e.playlistParsingError=new Error("No Segments found in Playlist");c.trigger(L.ERROR,{type:Be.NETWORK_ERROR,details:Q.LEVEL_EMPTY_ERROR,fatal:!1,url:S,error:_,reason:_.message,response:t,context:i,level:T,parent:E,networkDetails:r,stats:s});return}switch(e.live&&l&&(l.getCacheAge&&(e.ageHeader=l.getCacheAge()||0),(!l.getCacheAge||isNaN(e.ageHeader))&&(e.ageHeader=0)),h){case at.MANIFEST:case at.LEVEL:if(T){if(!f)T=0;else if(f!==c.levels[T]){const _=c.levels.indexOf(f);_>-1&&(T=_)}}c.trigger(L.LEVEL_LOADED,{details:e,levelInfo:f||c.levels[0],level:T||0,id:g||0,stats:s,networkDetails:r,deliveryDirectives:x,withoutMultiVariant:h===at.MANIFEST});break;case at.AUDIO_TRACK:c.trigger(L.AUDIO_TRACK_LOADED,{details:e,track:f,id:g||0,groupId:y||"",stats:s,networkDetails:r,deliveryDirectives:x});break;case at.SUBTITLE_TRACK:c.trigger(L.SUBTITLE_TRACK_LOADED,{details:e,track:f,id:g||0,groupId:y||"",stats:s,networkDetails:r,deliveryDirectives:x});break}}}class yi{static get version(){return Zl}static isMSESupported(){return Zb()}static isSupported(){return nk()}static getMediaSource(){return Ea()}static get Events(){return L}static get MetadataSchema(){return gi}static get ErrorTypes(){return Be}static get ErrorDetails(){return Q}static get DefaultConfig(){return yi.defaultConfig?yi.defaultConfig:KO}static set DefaultConfig(e){yi.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new Lm,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;const t=this.logger=p1(e.debug||!1,"Hls instance",e.assetPlayerId),s=this.config=qO(yi.DefaultConfig,e,t);this.userConfig=e,s.progressive&&QO(s,t);const{abrController:i,bufferController:r,capLevelController:l,errorController:c,fpsController:h}=s,u=new c(this),f=this.abrController=new i(this),g=new uw(this),y=s.interstitialsController,x=y?this.interstitialsController=new y(this,yi):null,S=this.bufferController=new r(this,g),E=this.capLevelController=new l(this),T=new h(this),A=new ck(this),_=s.contentSteeringController,I=_?new _(this):null,C=this.levelController=new ik(this,I),N=new tk(this),D=new ok(this.config,this.logger),k=this.streamController=new lk(this,g,D),B=this.gapController=new JO(this,g);E.setStreamController(k),T.setStreamController(k);const j=[A,C,k];x&&j.splice(1,0,x),I&&j.splice(1,0,I),this.networkControllers=j;const U=[f,S,B,E,T,N,g];this.audioTrackController=this.createController(s.audioTrackController,j);const K=s.audioStreamController;K&&j.push(this.audioStreamController=new K(this,g,D)),this.subtitleTrackController=this.createController(s.subtitleTrackController,j);const H=s.subtitleStreamController;H&&j.push(this.subtititleStreamController=new H(this,g,D)),this.createController(s.timelineController,U),D.emeController=this.emeController=this.createController(s.emeController,U),this.cmcdController=this.createController(s.cmcdController,U),this.latencyController=this.createController(sk,U),this.coreComponents=U,j.push(u);const J=u.onErrorOut;typeof J=="function"&&this.on(L.ERROR,J,u),this.on(L.MANIFEST_LOADED,A.onManifestLoaded,A)}createController(e,t){if(e){const s=new e(this);return t&&t.push(s),s}return null}on(e,t,s=this){this._emitter.on(e,t,s)}once(e,t,s=this){this._emitter.once(e,t,s)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t,s=this,i){this._emitter.off(e,t,s,i)}listeners(e){return this._emitter.listeners(e)}emit(e,t,s){return this._emitter.emit(e,t,s)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(s){if(this.logger.error("An internal error happened while handling event "+e+'. Error message: "'+s.message+'". Here is a stacktrace:',s),!this.triggeringException){this.triggeringException=!0;const i=e===L.ERROR;this.trigger(L.ERROR,{type:Be.OTHER_ERROR,details:Q.INTERNAL_EXCEPTION,fatal:i,event:e,error:s}),this.triggeringException=!1}}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){this.logger.log("destroy"),this.trigger(L.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach(t=>t.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(t=>t.destroy()),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){if(!e||"media"in e&&!e.media){const r=new Error(`attachMedia failed: invalid argument (${e})`);this.trigger(L.ERROR,{type:Be.OTHER_ERROR,details:Q.ATTACH_MEDIA_ERROR,fatal:!0,error:r});return}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());const t="media"in e,s=t?e.media:e,i=t?e:{media:s};this._media=s,this.trigger(L.MEDIA_ATTACHING,i)}detachMedia(){this.logger.log("detachMedia"),this.trigger(L.MEDIA_DETACHING,{}),this._media=null}transferMedia(){this._media=null;const e=this.bufferController.transferMedia();return this.trigger(L.MEDIA_DETACHING,{transferMedia:e}),e}loadSource(e){this.stopLoad();const t=this.media,s=this._url,i=this._url=ym.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log(`loadSource:${i}`),t&&s&&(s!==i||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(L.MANIFEST_LOADING,{url:e})}get url(){return this._url}get hasEnoughToStart(){return this.streamController.hasEnoughToStart}get startPosition(){return this.streamController.startPositionValue}startLoad(e=-1,t){this.logger.log(`startLoad(${e+(t?", <skip seek to start>":"")})`),this.started=!0,this.resumeBuffering();for(let s=0;s<this.networkControllers.length&&(this.networkControllers[s].startLoad(e,t),!(!this.started||!this.networkControllers));s++);}stopLoad(){this.logger.log("stopLoad"),this.started=!1;for(let e=0;e<this.networkControllers.length&&(this.networkControllers[e].stopLoad(),!(this.started||!this.networkControllers));e++);}get loadingEnabled(){return this.started}get bufferingEnabled(){return this.streamController.bufferingEnabled}resumeBuffering(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach(e=>{e.resumeBuffering&&e.resumeBuffering()}))}pauseBuffering(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach(e=>{e.pauseBuffering&&e.pauseBuffering()}))}get inFlightFragments(){const e={[ke.MAIN]:this.streamController.inFlightFrag};return this.audioStreamController&&(e[ke.AUDIO]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(e[ke.SUBTITLE]=this.subtititleStreamController.inFlightFrag),e}swapAudioCodec(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){this.logger.log("recoverMediaError");const e=this._media,t=e?.currentTime;this.detachMedia(),e&&(this.attachMedia(e),t&&this.startLoad(t))}removeLevel(e){this.levelController.removeLevel(e)}get sessionId(){let e=this._sessionId;return e||(e=this._sessionId=JN()),e}get levels(){const e=this.levelController.levels;return e||[]}get latestLevelDetails(){return this.streamController.getLevelDetails()||null}get loadLevelObj(){return this.levelController.loadLevelObj}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){this.logger.log(`set currentLevel:${e}`),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){this.logger.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){this.logger.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){this.logger.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){const e=this.levelController.startLevel;return e===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e}set startLevel(e){this.logger.log(`set startLevel:${e}`),e!==-1&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}set bandwidthEstimate(e){this.abrController.resetEstimator(e)}get abrEwmaDefaultEstimate(){const{bwEstimator:e}=this.abrController;return e?e.defaultEstimate:NaN}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(this.logger.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){q1(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;const s=e.length;for(let i=0;i<s;i++)if(e[i].maxBitrate>=t)return i;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:t,maxHdcpLevel:s}=this;let i;if(t===-1&&e!=null&&e.length?i=e.length-1:i=t,s)for(let r=i;r--;){const l=e[r].attrs["HDCP-LEVEL"];if(l&&l<=s)return r}return i}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(e){this.abrController.nextAutoLevel=e}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get maxBufferLength(){return this.streamController.maxBufferLength}setAudioOption(e){var t;return((t=this.audioTrackController)==null?void 0:t.setAudioOption(e))||null}setSubtitleOption(e){var t;return((t=this.subtitleTrackController)==null?void 0:t.setSubtitleOption(e))||null}get allAudioTracks(){const e=this.audioTrackController;return e?e.allAudioTracks:[]}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const t=this.audioTrackController;t&&(t.audioTrack=e)}get allSubtitleTracks(){const e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return e?e.subtitleDisplay:!1}set subtitleDisplay(e){const t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}set targetLatency(e){this.latencyController.targetLatency=e}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}get pathways(){return this.levelController.pathways}get pathwayPriority(){return this.levelController.pathwayPriority}set pathwayPriority(e){this.levelController.pathwayPriority=e}get bufferedToEnd(){var e;return!!((e=this.bufferController)!=null&&e.bufferedToEnd)}get interstitialsManager(){var e;return((e=this.interstitialsController)==null?void 0:e.interstitialsManager)||null}getMediaDecodingInfo(e,t=this.allAudioTracks){const s=jS(t);return US(e,s,navigator.mediaCapabilities)}}yi.defaultConfig=void 0;const Jb=({isOpen:n,onClose:e,settingsTab:t,setSettingsTab:s,maxBitrate:i,setMaxBitrate:r,audioStreams:l,selectedAudioIndex:c,onSelectAudio:h,subtitleStreams:u,selectedSubtitleIndex:f,onSelectSubtitle:g,onOpenSubtitleSearch:y,onDeleteSubtitle:x,playbackRate:S,setPlaybackRate:E,autoPlay:T,setAutoPlay:A,autoSkipIntro:_,setAutoSkipIntro:I,autoSkipOutro:C,setAutoSkipOutro:N,updateConfig:D})=>{if(!n)return null;const k=()=>p.jsxs("div",{className:"setting-section",children:[p.jsx("h3",{className:"setting-title",children:"Quality"}),p.jsx("p",{className:"setting-desc",children:"Select maximum playback bitrate."}),p.jsxs("div",{className:"settings-list",children:[p.jsx("button",{className:`lf-btn ${i?"lf-btn--secondary":"lf-btn--primary"}`,onClick:()=>r(null),style:{width:"100%",marginBottom:"8px",justifyContent:"flex-start"},children:"Auto"}),p.jsx("button",{className:`lf-btn ${i===12e7?"lf-btn--primary":"lf-btn--secondary"}`,onClick:()=>r(12e7),style:{width:"100%",marginBottom:"8px",justifyContent:"flex-start"},children:"4K (120Mbps)"}),p.jsx("button",{className:`lf-btn ${i===6e7?"lf-btn--primary":"lf-btn--secondary"}`,onClick:()=>r(6e7),style:{width:"100%",marginBottom:"8px",justifyContent:"flex-start"},children:"1080p High (60Mbps)"}),p.jsx("button",{className:`lf-btn ${i===2e7?"lf-btn--primary":"lf-btn--secondary"}`,onClick:()=>r(2e7),style:{width:"100%",marginBottom:"8px",justifyContent:"flex-start"},children:"1080p (20Mbps)"}),p.jsx("button",{className:`lf-btn ${i===1e7?"lf-btn--primary":"lf-btn--secondary"}`,onClick:()=>r(1e7),style:{width:"100%",marginBottom:"8px",justifyContent:"flex-start"},children:"720p (10Mbps)"})]})]}),B=()=>p.jsxs("div",{className:"setting-section",children:[p.jsx("h3",{className:"setting-title",children:"Audio Streams"}),p.jsxs("div",{className:"settings-list",children:[l.length===0&&p.jsx("p",{className:"setting-desc",children:"No audio streams found."}),l.map(H=>p.jsxs("button",{className:`lf-btn ${c===H.Index?"lf-btn--primary":"lf-btn--secondary"}`,onClick:()=>h(H.Index),style:{width:"100%",marginBottom:"8px",justifyContent:"flex-start"},children:[H.Language||"Unknown"," - ",H.Codec," ",H.Title?`(${H.Title})`:""]},H.Index))]})]}),j=()=>p.jsxs("div",{className:"setting-section",children:[p.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},children:[p.jsx("h3",{className:"setting-title",style:{margin:0},children:"Subtitles"}),p.jsxs("button",{className:"lf-btn lf-btn--secondary",onClick:y,style:{padding:"6px 12px",fontSize:"0.85rem"},children:[p.jsx("span",{className:"material-icons",style:{fontSize:"16px",marginRight:"6px"},children:"search"}),"Download"]})]}),p.jsxs("div",{className:"settings-list",children:[p.jsx("button",{className:`lf-btn ${f===null?"lf-btn--primary":"lf-btn--secondary"}`,onClick:()=>g(null),style:{width:"100%",marginBottom:"8px",justifyContent:"flex-start"},children:"Off"}),u.map(H=>p.jsxs("div",{style:{display:"flex",gap:"8px",marginBottom:"8px"},children:[p.jsxs("button",{className:`lf-btn ${f===H.Index?"lf-btn--primary":"lf-btn--secondary"}`,onClick:()=>g(H.Index),style:{flex:1,justifyContent:"flex-start"},children:[H.Language||"Unknown"," ",H.Title?`(${H.Title})`:""," ",H.IsForced?"[Forced]":""," ",H.IsExternal?"(Ext)":""]}),H.IsExternal&&p.jsx("button",{className:"lf-btn lf-btn--secondary",onClick:J=>{J.stopPropagation(),x(H.Index)},title:"Delete Subtitle",style:{width:"40px",padding:0,justifyContent:"center"},children:p.jsx("span",{className:"material-icons",style:{fontSize:"18px",color:"#ff4444"},children:"delete_outline"})})]},H.Index))]})]}),U=()=>p.jsxs("div",{className:"setting-section",children:[p.jsx("h3",{className:"setting-title",children:"Playback Speed"}),p.jsx("div",{className:"settings-list",children:[.5,.75,1,1.25,1.5,2].map(H=>p.jsxs("button",{className:`lf-btn ${S===H?"lf-btn--primary":"lf-btn--secondary"}`,onClick:()=>E(H),style:{width:"100%",marginBottom:"8px",justifyContent:"flex-start"},children:[H,"x"]},H))})]}),K=()=>p.jsxs("div",{className:"setting-section",children:[p.jsx("h3",{className:"setting-title",children:"General"}),p.jsxs("div",{className:"setting-row",children:[p.jsxs("div",{children:[p.jsx("h4",{className:"setting-title",style:{fontSize:"0.95rem"},children:"Auto Play"}),p.jsx("p",{className:"setting-desc",children:"Automatically play videos on load"})]}),p.jsxs("label",{className:"toggle-switch",children:[p.jsx("input",{type:"checkbox",checked:T,onChange:H=>A(H.target.checked)}),p.jsx("span",{className:"slider"})]})]}),p.jsxs("div",{className:"setting-row",style:{marginTop:"16px"},children:[p.jsxs("div",{children:[p.jsx("h4",{className:"setting-title",style:{fontSize:"0.95rem"},children:"Auto Skip Intro"}),p.jsx("p",{className:"setting-desc",children:"Automatically skip intro sequences"})]}),p.jsxs("label",{className:"toggle-switch",children:[p.jsx("input",{type:"checkbox",checked:_,onChange:H=>{const J=H.target.checked;I(J),D&&D({autoSkipIntro:J})}}),p.jsx("span",{className:"slider"})]})]}),p.jsxs("div",{className:"setting-row",style:{marginTop:"16px"},children:[p.jsxs("div",{children:[p.jsx("h4",{className:"setting-title",style:{fontSize:"0.95rem"},children:"Auto Skip Outro"}),p.jsx("p",{className:"setting-desc",children:"Automatically skip credits/outro"})]}),p.jsxs("label",{className:"toggle-switch",children:[p.jsx("input",{type:"checkbox",checked:C,onChange:H=>{const J=H.target.checked;N(J),D&&D({autoSkipOutro:J})}}),p.jsx("span",{className:"slider"})]})]})]});return p.jsx("div",{className:"legit-settings-overlay",onClick:e,children:p.jsxs("div",{className:"legit-settings-modal",onClick:H=>H.stopPropagation(),style:{pointerEvents:"auto",flexDirection:"row",width:"800px",height:"500px",maxWidth:"95vw"},children:[p.jsxs("div",{className:"legit-settings-sidebar",children:[p.jsx("div",{className:"sidebar-header",children:p.jsx("h2",{children:"Settings"})}),p.jsxs("div",{className:"sidebar-tabs",children:[p.jsxs("button",{className:`sidebar-tab ${t==="Quality"?"active":""}`,onClick:()=>s("Quality"),children:[p.jsx("span",{className:"material-icons",children:"hd"})," Quality"]}),p.jsxs("button",{className:`sidebar-tab ${t==="Audio"?"active":""}`,onClick:()=>s("Audio"),children:[p.jsx("span",{className:"material-icons",children:"audiotrack"})," Audio"]}),p.jsxs("button",{className:`sidebar-tab ${t==="Subtitles"?"active":""}`,onClick:()=>s("Subtitles"),children:[p.jsx("span",{className:"material-icons",children:"subtitles"})," Subtitles"]}),p.jsxs("button",{className:`sidebar-tab ${t==="Speed"?"active":""}`,onClick:()=>s("Speed"),children:[p.jsx("span",{className:"material-icons",children:"speed"})," Speed"]}),p.jsxs("button",{className:`sidebar-tab ${t==="General"?"active":""}`,onClick:()=>s("General"),children:[p.jsx("span",{className:"material-icons",children:"settings"})," General"]})]})]}),p.jsxs("div",{className:"legit-settings-content",children:[p.jsxs("div",{className:"content-header",children:[p.jsx("h2",{children:t}),p.jsx("button",{className:"close-btn-icon",onClick:e,children:p.jsx("span",{className:"material-icons",children:"close"})})]}),p.jsxs("div",{className:"content-body",children:[t==="Quality"&&k(),t==="Audio"&&B(),t==="Subtitles"&&j(),t==="Speed"&&U(),t==="General"&&K()]})]})]})})};Jb.propTypes={isOpen:Et.bool.isRequired,onClose:Et.func.isRequired,settingsTab:Et.string.isRequired,setSettingsTab:Et.func.isRequired,maxBitrate:Et.number,setMaxBitrate:Et.func.isRequired,audioStreams:Et.array.isRequired,selectedAudioIndex:Et.number,onSelectAudio:Et.func.isRequired,subtitleStreams:Et.array.isRequired,selectedSubtitleIndex:Et.number,onSelectSubtitle:Et.func.isRequired,onOpenSubtitleSearch:Et.func.isRequired,onDeleteSubtitle:Et.func.isRequired,playbackRate:Et.number.isRequired,setPlaybackRate:Et.func.isRequired,autoPlay:Et.bool.isRequired,setAutoPlay:Et.func.isRequired,autoSkipIntro:Et.bool,setAutoSkipIntro:Et.func,autoSkipOutro:Et.bool,setAutoSkipOutro:Et.func,updateConfig:Et.func};const uk=()=>{const{id:n}=_u(),e=Ms(),{config:t,updateConfig:s}=Yi(),i=w.useRef(null),r=w.useRef(null),[l,c]=w.useState(!0),[h,u]=w.useState(0),[f,g]=w.useState(0),[y,x]=w.useState(1),[S,E]=w.useState(!1),[T,A]=w.useState(!0),[_,I]=w.useState(null),[C,N]=w.useState(!1),[D,k]=w.useState(1),[B,j]=w.useState(!0),[U,K]=w.useState(!1),[H,J]=w.useState("Quality"),[re,me]=w.useState(null),[M,$]=w.useState(!1),[F,ae]=w.useState(null),[de,P]=w.useState(null),[G,te]=w.useState(null),[fe,ve]=w.useState(null),[Ae,De]=w.useState(0),[Ge,Fe]=w.useState(!1),[mt,St]=w.useState(null),[jt,bt]=w.useState([]),[ut,zt]=w.useState(null),[Me,Le]=w.useState([]),[Ue,Ze]=w.useState([]),[ht,Oe]=w.useState(!1),[He,pt]=w.useState(null),[nt,Kt]=w.useState(0),[ge,Qe]=w.useState({x:0,y:0,totalWidth:0,totalHeight:0}),[st,Zt]=w.useState(!1);t?.player?.seekForward,t?.player?.seekBackward;const[Rs,vs]=w.useState([]),[bi,js]=w.useState([]),[Bt,cs]=w.useState(null),[wt,ii]=w.useState(null),[Ti,Ls]=w.useState(!1),[ws,Cs]=w.useState(!1),[ni,Bs]=w.useState(null),[Ns,Gs]=w.useState(null),[ai,Qi]=w.useState(null),[Jt,us]=w.useState(null),Os=w.useRef(null),Fs=w.useRef(null),Bi=w.useRef(null),ce=w.useRef({intro:!1,outro:!1});w.useCallback(async(ne,we,et)=>{try{const ft=await ee.getSeasons(ne,we);bt(ft.Items||[]);const Tt=et||ft.Items?.[0]?.Id;zt(Tt)}catch(ft){console.error("Failed to load seasons",ft)}},[]);const[Ce,Je]=w.useState(null);w.useCallback(async ne=>{try{const we=await ee.getTrickplayManifest(ne);if(!we)return;const et=Object.keys(we);if(et.length===0)return;const ft=we[et[0]],Tt=Object.keys(ft).map(Number).sort((Wi,xs)=>Wi-xs);if(Tt.length===0)return;const ms=Tt[0],Ct=ft[ms];Je({itemId:ne,width:ms,interval:Ct.Interval,tileWidth:Ct.TileWidth,tileHeight:Ct.TileHeight,thumbWidth:Ct.Width,thumbHeight:Ct.Height,thumbnailCount:Ct.ThumbnailCount}),console.log("[Trickplay] Loaded:",{width:ms,interval:Ct.Interval,cols:Ct.TileWidth,rows:Ct.TileHeight,thumbs:Ct.ThumbnailCount})}catch(we){console.warn("Failed to load trickplay data",we)}},[]);const is=w.useCallback(async()=>{try{A(!0),I(null);const ne=await ee.getCurrentUser();if(!ne){e("/login");return}const we=await ee.getItemDetails(ne.Id,n);if(ae(we),Zt(we.UserData?.IsFavorite||!1),ce.current&&(ce.current={intro:!1,outro:!1}),we.MediaSources&&we.MediaSources.length>0){const et=we.MediaSources[0];P(et.Id);const ft=et.MediaStreams||[],Tt=ft.filter(xs=>xs.Type==="Audio"),ms=ft.filter(xs=>xs.Type==="Subtitle");vs(Tt),js(ms);const Ct=Tt.find(xs=>xs.Index===et.DefaultAudioStreamIndex);Ct?cs(Ct.Index):Tt.length>0&&cs(Tt[0].Index);const Wi=ms.find(xs=>xs.Index===et.DefaultSubtitleStreamIndex);ii(Wi?Wi.Index:null)}A(!1)}catch(ne){console.error("Failed to load item",ne),I("Failed to load video."),A(!1)}},[n,e]);w.useEffect(()=>{is()},[is]);const Ie=async ne=>{if(window.confirm("Are you sure you want to delete this subtitle?"))try{await ee.deleteSubtitle(F.Id,ne),is()}catch(we){console.error("Failed to delete subtitle:",we),alert("Failed to delete subtitle")}};w.useEffect(()=>{if(!F)return;const ne=ee.getStreamUrl(F.Id,Bt,wt,de,re);te(ne)},[F,Bt,wt,re]),w.useEffect(()=>{ut&&F?.SeriesId&&(async()=>{Oe(!0);try{const we=await ee.getCurrentUser(),et=await ee.getEpisodes(we.Id,F.SeriesId,ut);Le(et.Items||[])}catch(we){console.error("Failed to load episodes",we)}finally{Oe(!1)}})()},[ut,F?.SeriesId]),w.useEffect(()=>{if(F&&F.Type==="Episode"&&Me.length>0){const ne=Me.findIndex(we=>we.Id===F.Id);ne!==-1&&ne<Me.length-1?us(Me[ne+1].Id):us(null)}},[F,Me]);const ks=ne=>{if(!f)return;const we=ne.currentTarget.getBoundingClientRect(),et=ne.clientX-we.left,ft=Math.max(0,Math.min(1,et/we.width)),Tt=ft*f;if(ve(Tt),De(ft),Fe(!0),Ce){const{itemId:ms,width:Ct,interval:Wi,tileWidth:xs,tileHeight:Ja}=Ce,gn=xs*Ja,Xr=Math.floor(Tt*1e3/Wi),yo=Math.floor(Xr/gn),yn=Xr%gn,Bu=yn%xs,vo=Math.floor(yn/xs),xo=ee.getTrickplayTileUrl(ms,Ct,yo);St(xo),Qe({x:-(Bu*Ce.thumbWidth),y:-(vo*Ce.thumbHeight),totalWidth:xs*Ce.thumbWidth,totalHeight:Ja*Ce.thumbHeight})}},At=()=>{Fe(!1),ve(null),St(null)};w.useEffect(()=>{if(G){if(yi.isSupported()){Fs.current&&Fs.current.destroy();const ne=new yi({capLevelToPlayerSize:!0,autoStartLoad:!0});ne.loadSource(G),ne.attachMedia(i.current),Fs.current=ne,ne.on(yi.Events.MANIFEST_PARSED,()=>{i.current&&l&&i.current.play().catch(we=>console.log("Autoplay prevented",we)),A(!1)}),ne.on(yi.Events.ERROR,(we,et)=>{if(et.fatal)switch(console.error("HLS Fatal Error",et),et.type){case yi.ErrorTypes.NETWORK_ERROR:ne.startLoad();break;case yi.ErrorTypes.MEDIA_ERROR:ne.recoverMediaError();break;default:ne.destroy();break}})}else i.current.canPlayType("application/vnd.apple.mpegurl")?(i.current.src=G,i.current.addEventListener("loadedmetadata",()=>{l&&i.current.play(),A(!1)})):(i.current.src=G,i.current.addEventListener("loadedmetadata",()=>{l&&i.current.play(),A(!1)}));return()=>{Fs.current&&Fs.current.destroy()}}},[G]),w.useEffect(()=>{i.current&&(i.current.playbackRate=D)},[D]),w.useEffect(()=>{const ne=i.current;if(!ne)return;ne.querySelectorAll("track").forEach(ms=>ms.remove());for(let ms=0;ms<ne.textTracks.length;ms++)ne.textTracks[ms].mode="disabled";if(wt===null||!F?.Id||!de){console.log("[Subtitles] Subtitles off");return}const et=bi.find(ms=>ms.Index===wt);if(!et)return;const ft=ee.getSubtitleUrl(F.Id,de,wt);console.log("[Subtitles] Loading:",ft,et.Language);const Tt=document.createElement("track");Tt.kind="subtitles",Tt.label=et.Language||et.Title||"Unknown",Tt.srclang=et.Language||"und",Tt.src=ft,Tt.default=!0,ne.appendChild(Tt),Tt.track.mode="showing"},[wt,F?.Id,de,bi]),w.useEffect(()=>{if(!(!F||!i.current)&&F.UserData&&F.UserData.PlaybackPositionTicks){const ne=F.UserData.PlaybackPositionTicks/1e7,we=()=>{ne>0&&ne<i.current.duration&&(i.current.currentTime=ne)};return i.current.addEventListener("loadedmetadata",we),i.current.readyState>=1&&we(),()=>i.current?.removeEventListener("loadedmetadata",we)}},[F]),w.useEffect(()=>{if(!(!F||!de))return Bi.current=setInterval(()=>{if(i.current&&!i.current.paused){const ne=i.current.currentTime;ee.reportPlaybackProgress(F.Id,Math.floor(ne*1e7),!1,de).catch(we=>console.warn("Report progress failed",we))}},1e4),()=>clearInterval(Bi.current)},[F,de]);const gt=w.useCallback(()=>{F&&i.current&&ee.reportPlaybackStopped(F.Id,Math.floor(i.current.currentTime*1e7))},[F]);w.useEffect(()=>()=>{gt()},[gt]);const Fi=w.useCallback(()=>{i.current&&(i.current.paused?(i.current.play().catch(ne=>console.log("Play prevented:",ne)),c(!0)):(i.current.pause(),c(!1)))},[i]),Ei=ne=>{pt(ne),setTimeout(()=>pt(null),600)},uo=w.useCallback(()=>{if(i.current){const ne=t.playerSeekForward||30;i.current.currentTime=Math.min(i.current.duration,i.current.currentTime+ne),u(i.current.currentTime),Ei("fast_forward")}},[t.playerSeekForward]),ho=w.useCallback(()=>{if(i.current){const ne=t.playerSeekBackward||10;i.current.currentTime=Math.max(0,i.current.currentTime-ne),u(i.current.currentTime),Ei("fast_rewind")}},[t.playerSeekBackward]),Xa=w.useCallback(()=>{document.fullscreenElement?document.exitFullscreen&&document.exitFullscreen():r.current&&r.current.requestFullscreen().catch(ne=>{console.error(`Error attempting to enable full - screen mode: ${ne.message} (${ne.name})`)})},[]),Gn=w.useCallback(()=>{const ne=i.current;if(ne)if(ne.muted=!S,E(!S),!S)x(0),ne.volume=0;else{const we=ne.volume>0?ne.volume:1;x(we),ne.volume=we}},[S,i]);w.useEffect(()=>{const ne=we=>{if(!U)switch([" ","ArrowLeft","ArrowRight"].includes(we.key)&&we.preventDefault(),we.key){case" ":case"k":Fi();break;case"ArrowLeft":ho();break;case"ArrowRight":uo();break;case"f":Xa();break;case"m":Gn();break}};return document.addEventListener("keydown",ne),()=>{document.removeEventListener("keydown",ne)}},[l,U]);const Ai=w.useRef(null),Hn=w.useCallback(ne=>{const we=ne.target;if(!(we.closest("button")||we.closest("input")||we.closest("select")||we.closest(".lf-skip-btn")||we.closest(".center-play-btn")||we.closest(".lf-settings-modal")||we.closest(".lf-player-back-button"))){if(Ai.current){clearTimeout(Ai.current),Ai.current=null;return}Ai.current=setTimeout(()=>{Ai.current=null,i.current&&(i.current.paused?(i.current.play().catch(et=>console.log("Play prevented:",et)),c(!0),Ei("play_arrow")):(i.current.pause(),c(!1),Ei("pause"))),N(!0),Os.current&&clearTimeout(Os.current),Os.current=setTimeout(()=>{N(!1)},3e3)},250)}},[i]),zn=w.useCallback(ne=>{const we=ne.target;we.closest("button")||we.closest("input")||we.closest("select")||we.closest(".lf-settings-modal")||(Ai.current&&(clearTimeout(Ai.current),Ai.current=null),Xa())},[]),Ia=w.useCallback(ne=>{if(!F?.Chapters)return;const we=F.Chapters.find(et=>(et.Name.toLowerCase().includes("intro")||et.Name.toLowerCase().includes("opening"))&&ne>=et.StartPositionTicks/1e7&&ne<et.StartPositionTicks/1e7+80);if(we){const et=F.Chapters.indexOf(we),ft=F.Chapters[et+1];if(ft){const Tt=ft.StartPositionTicks/1e7;Ls(!0),Bs(Tt),t.autoSkipIntro&&!ce.current.intro&&i.current&&(ce.current.intro=!0,i.current.currentTime=Tt,u(Tt),Ei("skip_next"),console.log("[AutoSkip] Skipped intro to",Tt))}else Ls(!1)}else Ls(!1),f>0&&f-ne<120&&F.Chapters.find(ft=>(ft.Name.toLowerCase().includes("outro")||ft.Name.toLowerCase().includes("ending")||ft.Name.toLowerCase().includes("credits"))&&ne>=ft.StartPositionTicks/1e7)?(Cs(!0),t.autoSkipOutro&&!ce.current.outro&&i.current&&(ce.current.outro=!0,Jt&&e(`/player/${Jt}`))):Cs(!1)},[F,f,t.autoSkipIntro,t.autoSkipOutro,Jt,e]),mn=()=>{gt(),window.history.length>2?e(-1):F&&F.SeriesId?e(`/series/${F.SeriesId}`):F&&F.ParentId?e("/ library"):e("/")},ns=ne=>{if(i.current){const we=i.current.currentTime;u(we),g(i.current.duration||0),i.current.buffered.length>0&&Kt(i.current.buffered.end(i.current.buffered.length-1)),Ns!==null&&ai!==null&&(we>=Ns&&we<ai?Ls(!0):Ls(!1)),Ia(we)}},fo=()=>{},mo=()=>{B&&Jt?setTimeout(()=>Wr(),1500):(c(!1),gt(),N(!0))},pn=()=>{i.current&&ai&&(i.current.currentTime=ai,Ei("fast_forward"),Ls(!1))},Kn=()=>{Cs(!1),Jt?Wr():i.current&&(i.current.currentTime=i.current.duration)},Wr=()=>{Jt&&(gt(),vs([]),js([]),Gs(null),Ls(!1),e(`/player/${Jt}`))},po=w.useCallback(()=>{N(!0),Os.current&&clearTimeout(Os.current),Os.current=setTimeout(()=>{i.current&&!i.current.paused&&N(!1)},3e3)},[]),go=ne=>{zt(ne)},ju=ne=>{ne!==F.Id&&(gt(),e(`/player/${ne}`))},Za=async()=>{if(!(!F||!F.SeriesId))try{const ne=await ee.getCurrentUser(),we=!st;await ee.markFavorite(ne.Id,F.SeriesId,we),Zt(we)}catch(ne){console.error("Favorite toggle failed",ne)}},Yn=ne=>{if(!ne||isNaN(ne))return"0:00";const we=Math.floor(ne/3600),et=Math.floor(ne%3600/60),ft=Math.floor(ne%60);return we>0?`${we}:${et.toString().padStart(2,"0")}:${ft.toString().padStart(2,"0")} `:`${et}:${ft.toString().padStart(2,"0")} `},Vi=f?h/f*100:0,Hs=f?nt/f*100:0;return p.jsxs("div",{className:"lf-player-page",children:[p.jsx(Ta,{alwaysFilled:!0}),p.jsx("div",{ref:r,className:`lf-player-video-container ${document.fullscreenElement?"is-fullscreen":""}`,style:{cursor:C?"default":"none"},onMouseMove:po,onMouseLeave:()=>l&&N(!1),onClick:Hn,onDoubleClick:zn,children:p.jsxs("div",{className:"lf-player-video-wrapper",children:[p.jsx("video",{ref:i,className:"lf-player-video",onTimeUpdate:ns,onLoadedMetadata:fo,onEnded:mo,onWaiting:()=>A(!0),onCanPlay:()=>A(!1),crossOrigin:"anonymous"}),Ti&&p.jsx("button",{className:"lf-skip-btn",onClick:pn,children:"Skip Intro"}),ws&&!Ti&&p.jsx("button",{className:"lf-skip-btn",onClick:Kn,children:Jt?"Next Episode":"Skip Credits"}),T&&p.jsx("div",{className:"lf-player-loader",children:p.jsx("div",{className:"spinner"})}),_&&p.jsxs("div",{className:"lf-player-error",children:[p.jsx("div",{className:"error-icon",children:"!"}),p.jsx("p",{children:_}),p.jsx("button",{onClick:mn,children:"Go Back"})]}),p.jsx("div",{className:`lf-player-center-icon ${He?"visible":""}`,children:p.jsx("span",{className:"material-icons",children:He})}),p.jsxs("div",{className:`lf-player-controls ${C?"visible":""}`,children:[p.jsxs("div",{className:"lf-player-controls-top",children:[p.jsx("button",{className:"icon-btn back-btn",onClick:mn,children:p.jsx("span",{className:"material-icons",children:"arrow_back"})}),p.jsx("div",{className:"player-title",children:F?p.jsxs(p.Fragment,{children:[p.jsx("span",{className:"series-title",children:F.SeriesName}),F.SeriesName&&F.Name&&p.jsx("span",{className:"divider",children:"|"}),p.jsx("span",{className:"episode-title",children:F.Name})]}):"Loading..."})]}),!l&&!T&&!_&&!U&&p.jsx("button",{className:"center-play-btn",onClick:ne=>{ne.stopPropagation(),Fi()},children:p.jsx("span",{className:"material-icons",children:"play_arrow"})}),U&&p.jsx(Jb,{isOpen:U,onClose:()=>K(!1),settingsTab:H,setSettingsTab:J,maxBitrate:re,setMaxBitrate:me,audioStreams:Rs,selectedAudioIndex:Bt,onSelectAudio:cs,subtitleStreams:bi,selectedSubtitleIndex:wt,onSelectSubtitle:ii,onOpenSubtitleSearch:()=>{K(!1),$(!0)},onDeleteSubtitle:Ie,playbackRate:D,setPlaybackRate:k,autoPlay:B,setAutoPlay:j,autoSkipIntro:t?.autoSkipIntro,setAutoSkipIntro:ne=>s({autoSkipIntro:ne}),autoSkipOutro:t?.autoSkipOutro,setAutoSkipOutro:ne=>s({autoSkipOutro:ne}),updateConfig:s}),M&&p.jsx(Du,{isOpen:M,onClose:()=>$(!1),seriesId:F?.SeriesId,initialSeasonId:ut||F?.SeasonId,initialEpisodeId:F?.Id,isMovie:F?.Type==="Movie",onSubtitleDownloaded:()=>{is(),$(!1)}}),p.jsxs("div",{className:"lf-player-controls-bottom",children:[p.jsxs("div",{className:"lf-player-timeline-container",onClick:ne=>{ne.stopPropagation();const we=ne.currentTarget.getBoundingClientRect(),ft=(ne.clientX-we.left)/we.width*(f||0);i.current&&(i.current.currentTime=ft,u(ft))},onMouseMove:ks,onMouseLeave:At,children:[p.jsxs("div",{className:"lf-player-timeline-track",children:[p.jsx("div",{className:"lf-player-timeline-buffered",style:{width:`${Hs}%`}}),p.jsx("div",{className:"lf-player-timeline-fill",style:{width:`${Vi}%`},children:p.jsx("div",{className:"lf-player-timeline-thumb"})})]}),Ge&&fe!==null&&p.jsxs("div",{className:"lf-timeline-tooltip",style:{left:`${Ae*100}%`},children:[mt&&ge&&p.jsx("div",{className:"lf-timeline-thumbnail",style:{backgroundImage:`url(${mt})`,backgroundPosition:`${ge.x}px ${ge.y} px`,backgroundSize:`${ge.totalWidth}px ${ge.totalHeight} px`,width:`${Ce?.thumbWidth||160} px`,height:`${Ce?.thumbHeight||90} px`}}),p.jsx("span",{className:"lf-timeline-time",children:Yn(fe)})]})]}),p.jsxs("div",{className:"lf-player-controls-row",children:[p.jsxs("div",{className:"controls-left",children:[p.jsx("button",{className:"icon-btn",onClick:ne=>{ne.stopPropagation(),Fi()},children:p.jsx("span",{className:"material-icons",children:l?"pause":"play_arrow"})}),p.jsx("button",{className:"icon-btn",onClick:ne=>{ne.stopPropagation(),ho()},children:p.jsx("span",{className:"material-icons",children:"replay_10"})}),p.jsx("button",{className:"icon-btn",onClick:ne=>{ne.stopPropagation(),uo()},children:p.jsx("span",{className:"material-icons",children:"forward_30"})}),Jt&&p.jsx("button",{className:"icon-btn",onClick:ne=>{ne.stopPropagation(),Wr()},title:"Next Episode",children:p.jsx("span",{className:"material-icons",children:"skip_next"})}),p.jsxs("div",{className:"volume-container",children:[p.jsx("button",{className:"icon-btn",onClick:ne=>{ne.stopPropagation(),Gn()},children:p.jsx("span",{className:"material-icons",children:S||y===0?"volume_off":y<.5?"volume_down":"volume_up"})}),p.jsx("div",{className:"volume-slider-wrapper",children:p.jsx("input",{type:"range",className:"volume-slider",min:"0",max:"1",step:"0.05",value:S?0:y,onChange:ne=>{const we=parseFloat(ne.target.value);x(we),i.current&&(i.current.volume=we,i.current.muted=we===0),E(we===0)},onClick:ne=>ne.stopPropagation()})})]}),p.jsxs("span",{className:"time-display",children:[Yn(h)," / ",Yn(f)]})]}),p.jsxs("div",{className:"controls-right",children:[p.jsx("button",{className:"icon-btn",onClick:ne=>{ne.stopPropagation(),K(!U)},children:p.jsx("span",{className:"material-icons",children:"settings"})}),p.jsx("button",{className:"icon-btn",onClick:ne=>{ne.stopPropagation(),Xa()},children:p.jsx("span",{className:"material-icons",children:document.fullscreenElement?"fullscreen_exit":"fullscreen"})})]})]})]})]})]})}),F&&F.Type==="Episode"&&p.jsxs("div",{className:"lf-player-content-container",children:[p.jsxs("div",{className:"lf-player-column-left",children:[p.jsxs("div",{className:"lf-player-header-row",children:[p.jsxs("div",{className:"lf-player-title-block",children:[p.jsx("h4",{className:"lf-series-link",onClick:()=>e(`/series/${F.SeriesId}`),children:F.SeriesName}),p.jsxs("h1",{className:"lf-episode-name",children:["E",F.IndexNumber," - ",F.Name]})]}),p.jsx("div",{className:"lf-player-actions",children:p.jsx("button",{className:`lf-action-btn ${st?"is-active":""}`,onClick:Za,title:st?"Remove from Watchlist":"Add to Watchlist",children:p.jsx("span",{className:"material-icons",children:st?"bookmark":"bookmark_border"})})})]}),p.jsxs("div",{className:"lf-player-tags-row",children:[F.OfficialRating&&p.jsx("span",{className:"lf-tag-rating",children:F.OfficialRating}),p.jsx("span",{className:"lf-tag-text",children:"Sub | Dub"}),F.PremiereDate&&p.jsxs("span",{className:"lf-release-date",children:["Released on ",new Date(F.PremiereDate).toLocaleDateString()]})]}),p.jsxs("div",{className:"lf-player-metadata",children:[p.jsx("h1",{children:F.Name}),p.jsx("p",{className:"lf-player-description",children:F.Overview})]})]}),p.jsx("div",{className:"lf-player-column-right",children:p.jsxs("div",{className:"lf-player-episodes-panel",children:[p.jsxs("div",{className:"lf-episodes-panel-header",children:[p.jsx("span",{className:"lf-panel-title",children:"Episodes"}),p.jsxs("div",{className:"season-select-wrapper",children:[p.jsx("select",{className:"lf-season-dropdown",value:ut||"",onChange:ne=>go(ne.target.value),children:jt.map(ne=>p.jsx("option",{value:ne.Id,children:ne.Name},ne.Id))}),p.jsx("span",{className:"material-icons dropdown-icon",children:"expand_more"})]})]}),p.jsx("div",{className:"lf-episodes-grid",children:ht?p.jsx("div",{className:"loading-txt",children:"Loading..."}):Me.map(ne=>p.jsxs("div",{className:`lf-episode-card-small ${ne.Id===F.Id?"current":""}`,onClick:()=>ju(ne.Id),children:[p.jsxs("div",{className:"ep-card-img",children:[p.jsx("img",{src:ee.getImageUrl(ne,"Primary",{maxWidth:300}),alt:ne.Name,onError:we=>we.target.style.display="none"}),ne.Id===F.Id&&p.jsx("div",{className:"ep-playing-overlay",children:p.jsx("span",{className:"material-icons",children:"play_circle"})})]}),p.jsxs("div",{className:"ep-card-info",children:[p.jsxs("div",{className:"ep-card-title",children:[p.jsxs("span",{className:"ep-prefix",children:["E",ne.IndexNumber]})," - ",ne.Name]}),p.jsx("div",{className:"ep-card-meta",children:"Sub | Dub"})]})]},ne.Id))})]})})]})]})};function dk(){const{config:n}=Yi();return p.jsxs(p.Fragment,{children:[n.appBackground&&p.jsx("div",{style:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",backgroundImage:`url('${n.appBackground}')`,backgroundSize:"cover",backgroundPosition:"center",zIndex:-1,opacity:.3,filter:"grayscale(0.5) brightness(0.5)"}}),p.jsxs(BI,{children:[p.jsx(a1,{}),p.jsxs(pI,{children:[p.jsx(Di,{path:"/login",element:p.jsx(i1,{})}),p.jsx(Di,{path:"/login/select-server",element:p.jsx(t1,{})}),p.jsx(Di,{path:"/login/select-user",element:p.jsx(s1,{})}),p.jsxs(Di,{element:p.jsx(n1,{}),children:[p.jsx(Di,{path:"/",element:p.jsx(av,{})}),p.jsx(Di,{path:"/series/:id",element:p.jsx(XL,{})}),p.jsx(Di,{path:"/movie/:id",element:p.jsx(ZL,{})}),p.jsx(Di,{path:"/item/:id",element:p.jsx(r1,{})}),p.jsx(Di,{path:"/profile",element:p.jsx(e1,{})}),p.jsx(Di,{path:"/play/:id",element:p.jsx(uk,{})}),p.jsx(Di,{path:"*",element:p.jsx(av,{})})]})]})]})]})}function hk(){return p.jsx(XI,{children:p.jsx(dk,{})})}mA.createRoot(document.getElementById("root")).render(p.jsx(w.StrictMode,{children:p.jsx(hk,{})}));
