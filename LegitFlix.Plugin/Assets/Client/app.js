function wA(i,e){for(var t=0;t<e.length;t++){const s=e[t];if(typeof s!="string"&&!Array.isArray(s)){for(const n in s)if(n!=="default"&&!(n in i)){const r=Object.getOwnPropertyDescriptor(s,n);r&&Object.defineProperty(i,n,r.get?r:{enumerable:!0,get:()=>s[n]})}}}return Object.freeze(Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&s(l)}).observe(document,{childList:!0,subtree:!0});function t(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(n){if(n.ep)return;n.ep=!0;const r=t(n);fetch(n.href,r)}})();function bm(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var af={exports:{}},Wl={};var jy;function CA(){if(jy)return Wl;jy=1;var i=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(s,n,r){var l=null;if(r!==void 0&&(l=""+r),n.key!==void 0&&(l=""+n.key),"key"in n){r={};for(var c in n)c!=="key"&&(r[c]=n[c])}else r=n;return n=r.ref,{$$typeof:i,type:s,key:l,ref:n!==void 0?n:null,props:r}}return Wl.Fragment=e,Wl.jsx=t,Wl.jsxs=t,Wl}var Fy;function kA(){return Fy||(Fy=1,af.exports=CA()),af.exports}var p=kA(),rf={exports:{}},Ze={};var By;function NA(){if(By)return Ze;By=1;var i=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),n=Symbol.for("react.profiler"),r=Symbol.for("react.consumer"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),d=Symbol.for("react.suspense"),u=Symbol.for("react.memo"),f=Symbol.for("react.lazy"),g=Symbol.for("react.activity"),y=Symbol.iterator;function x(P){return P===null||typeof P!="object"?null:(P=y&&P[y]||P["@@iterator"],typeof P=="function"?P:null)}var S={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},E=Object.assign,T={};function A(P,$,G){this.props=P,this.context=$,this.refs=T,this.updater=G||S}A.prototype.isReactComponent={},A.prototype.setState=function(P,$){if(typeof P!="object"&&typeof P!="function"&&P!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,P,$,"setState")},A.prototype.forceUpdate=function(P){this.updater.enqueueForceUpdate(this,P,"forceUpdate")};function I(){}I.prototype=A.prototype;function _(P,$,G){this.props=P,this.context=$,this.refs=T,this.updater=G||S}var C=_.prototype=new I;C.constructor=_,E(C,A.prototype),C.isPureReactComponent=!0;var k=Array.isArray;function D(){}var O={H:null,A:null,T:null,S:null},F=Object.prototype.hasOwnProperty;function j(P,$,G){var fe=G.ref;return{$$typeof:i,type:P,key:$,ref:fe!==void 0?fe:null,props:G}}function U(P,$){return j(P.type,$,P.props)}function K(P){return typeof P=="object"&&P!==null&&P.$$typeof===i}function H(P){var $={"=":"=0",":":"=2"};return"$"+P.replace(/[=:]/g,function(G){return $[G]})}var ee=/\/+/g;function re(P,$){return typeof P=="object"&&P!==null&&P.key!=null?H(""+P.key):$.toString(36)}function de(P){switch(P.status){case"fulfilled":return P.value;case"rejected":throw P.reason;default:switch(typeof P.status=="string"?P.then(D,D):(P.status="pending",P.then(function($){P.status==="pending"&&(P.status="fulfilled",P.value=$)},function($){P.status==="pending"&&(P.status="rejected",P.reason=$)})),P.status){case"fulfilled":return P.value;case"rejected":throw P.reason}}throw P}function M(P,$,G,fe,ge){var _e=typeof P;(_e==="undefined"||_e==="boolean")&&(P=null);var Ne=!1;if(P===null)Ne=!0;else switch(_e){case"bigint":case"string":case"number":Ne=!0;break;case"object":switch(P.$$typeof){case i:case e:Ne=!0;break;case f:return Ne=P._init,M(Ne(P._payload),$,G,fe,ge)}}if(Ne)return ge=ge(P),Ne=fe===""?"."+re(P,0):fe,k(ge)?(G="",Ne!=null&&(G=Ne.replace(ee,"$&/")+"/"),M(ge,$,G,"",function(pt){return pt})):ge!=null&&(K(ge)&&(ge=U(ge,G+(ge.key==null||P&&P.key===ge.key?"":(""+ge.key).replace(ee,"$&/")+"/")+Ne)),$.push(ge)),1;Ne=0;var Ge=fe===""?".":fe+":";if(k(P))for(var Be=0;Be<P.length;Be++)fe=P[Be],_e=Ge+re(fe,Be),Ne+=M(fe,$,G,_e,ge);else if(Be=x(P),typeof Be=="function")for(P=Be.call(P),Be=0;!(fe=P.next()).done;)fe=fe.value,_e=Ge+re(fe,Be++),Ne+=M(fe,$,G,_e,ge);else if(_e==="object"){if(typeof P.then=="function")return M(de(P),$,G,fe,ge);throw $=String(P),Error("Objects are not valid as a React child (found: "+($==="[object Object]"?"object with keys {"+Object.keys(P).join(", ")+"}":$)+"). If you meant to render a collection of children, use an array instead.")}return Ne}function V(P,$,G){if(P==null)return P;var fe=[],ge=0;return M(P,fe,"","",function(_e){return $.call(G,_e,ge++)}),fe}function q(P){if(P._status===-1){var $=P._result;$=$(),$.then(function(G){(P._status===0||P._status===-1)&&(P._status=1,P._result=G)},function(G){(P._status===0||P._status===-1)&&(P._status=2,P._result=G)}),P._status===-1&&(P._status=0,P._result=$)}if(P._status===1)return P._result.default;throw P._result}var ae=typeof reportError=="function"?reportError:function(P){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var $=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof P=="object"&&P!==null&&typeof P.message=="string"?String(P.message):String(P),error:P});if(!window.dispatchEvent($))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",P);return}console.error(P)},pe={map:V,forEach:function(P,$,G){V(P,function(){$.apply(this,arguments)},G)},count:function(P){var $=0;return V(P,function(){$++}),$},toArray:function(P){return V(P,function($){return $})||[]},only:function(P){if(!K(P))throw Error("React.Children.only expected to receive a single React element child.");return P}};return Ze.Activity=g,Ze.Children=pe,Ze.Component=A,Ze.Fragment=t,Ze.Profiler=n,Ze.PureComponent=_,Ze.StrictMode=s,Ze.Suspense=d,Ze.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=O,Ze.__COMPILER_RUNTIME={__proto__:null,c:function(P){return O.H.useMemoCache(P)}},Ze.cache=function(P){return function(){return P.apply(null,arguments)}},Ze.cacheSignal=function(){return null},Ze.cloneElement=function(P,$,G){if(P==null)throw Error("The argument must be a React element, but you passed "+P+".");var fe=E({},P.props),ge=P.key;if($!=null)for(_e in $.key!==void 0&&(ge=""+$.key),$)!F.call($,_e)||_e==="key"||_e==="__self"||_e==="__source"||_e==="ref"&&$.ref===void 0||(fe[_e]=$[_e]);var _e=arguments.length-2;if(_e===1)fe.children=G;else if(1<_e){for(var Ne=Array(_e),Ge=0;Ge<_e;Ge++)Ne[Ge]=arguments[Ge+2];fe.children=Ne}return j(P.type,ge,fe)},Ze.createContext=function(P){return P={$$typeof:l,_currentValue:P,_currentValue2:P,_threadCount:0,Provider:null,Consumer:null},P.Provider=P,P.Consumer={$$typeof:r,_context:P},P},Ze.createElement=function(P,$,G){var fe,ge={},_e=null;if($!=null)for(fe in $.key!==void 0&&(_e=""+$.key),$)F.call($,fe)&&fe!=="key"&&fe!=="__self"&&fe!=="__source"&&(ge[fe]=$[fe]);var Ne=arguments.length-2;if(Ne===1)ge.children=G;else if(1<Ne){for(var Ge=Array(Ne),Be=0;Be<Ne;Be++)Ge[Be]=arguments[Be+2];ge.children=Ge}if(P&&P.defaultProps)for(fe in Ne=P.defaultProps,Ne)ge[fe]===void 0&&(ge[fe]=Ne[fe]);return j(P,_e,ge)},Ze.createRef=function(){return{current:null}},Ze.forwardRef=function(P){return{$$typeof:c,render:P}},Ze.isValidElement=K,Ze.lazy=function(P){return{$$typeof:f,_payload:{_status:-1,_result:P},_init:q}},Ze.memo=function(P,$){return{$$typeof:u,type:P,compare:$===void 0?null:$}},Ze.startTransition=function(P){var $=O.T,G={};O.T=G;try{var fe=P(),ge=O.S;ge!==null&&ge(G,fe),typeof fe=="object"&&fe!==null&&typeof fe.then=="function"&&fe.then(D,ae)}catch(_e){ae(_e)}finally{$!==null&&G.types!==null&&($.types=G.types),O.T=$}},Ze.unstable_useCacheRefresh=function(){return O.H.useCacheRefresh()},Ze.use=function(P){return O.H.use(P)},Ze.useActionState=function(P,$,G){return O.H.useActionState(P,$,G)},Ze.useCallback=function(P,$){return O.H.useCallback(P,$)},Ze.useContext=function(P){return O.H.useContext(P)},Ze.useDebugValue=function(){},Ze.useDeferredValue=function(P,$){return O.H.useDeferredValue(P,$)},Ze.useEffect=function(P,$){return O.H.useEffect(P,$)},Ze.useEffectEvent=function(P){return O.H.useEffectEvent(P)},Ze.useId=function(){return O.H.useId()},Ze.useImperativeHandle=function(P,$,G){return O.H.useImperativeHandle(P,$,G)},Ze.useInsertionEffect=function(P,$){return O.H.useInsertionEffect(P,$)},Ze.useLayoutEffect=function(P,$){return O.H.useLayoutEffect(P,$)},Ze.useMemo=function(P,$){return O.H.useMemo(P,$)},Ze.useOptimistic=function(P,$){return O.H.useOptimistic(P,$)},Ze.useReducer=function(P,$,G){return O.H.useReducer(P,$,G)},Ze.useRef=function(P){return O.H.useRef(P)},Ze.useState=function(P){return O.H.useState(P)},Ze.useSyncExternalStore=function(P,$,G){return O.H.useSyncExternalStore(P,$,G)},Ze.useTransition=function(){return O.H.useTransition()},Ze.version="19.2.4",Ze}var Vy;function Tm(){return Vy||(Vy=1,rf.exports=NA()),rf.exports}var w=Tm();const Qx=bm(w),OA=wA({__proto__:null,default:Qx},[w]);var lf={exports:{}},Xl={},of={exports:{}},cf={};var $y;function DA(){return $y||($y=1,(function(i){function e(M,V){var q=M.length;M.push(V);e:for(;0<q;){var ae=q-1>>>1,pe=M[ae];if(0<n(pe,V))M[ae]=V,M[q]=pe,q=ae;else break e}}function t(M){return M.length===0?null:M[0]}function s(M){if(M.length===0)return null;var V=M[0],q=M.pop();if(q!==V){M[0]=q;e:for(var ae=0,pe=M.length,P=pe>>>1;ae<P;){var $=2*(ae+1)-1,G=M[$],fe=$+1,ge=M[fe];if(0>n(G,q))fe<pe&&0>n(ge,G)?(M[ae]=ge,M[fe]=q,ae=fe):(M[ae]=G,M[$]=q,ae=$);else if(fe<pe&&0>n(ge,q))M[ae]=ge,M[fe]=q,ae=fe;else break e}}return V}function n(M,V){var q=M.sortIndex-V.sortIndex;return q!==0?q:M.id-V.id}if(i.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var r=performance;i.unstable_now=function(){return r.now()}}else{var l=Date,c=l.now();i.unstable_now=function(){return l.now()-c}}var d=[],u=[],f=1,g=null,y=3,x=!1,S=!1,E=!1,T=!1,A=typeof setTimeout=="function"?setTimeout:null,I=typeof clearTimeout=="function"?clearTimeout:null,_=typeof setImmediate<"u"?setImmediate:null;function C(M){for(var V=t(u);V!==null;){if(V.callback===null)s(u);else if(V.startTime<=M)s(u),V.sortIndex=V.expirationTime,e(d,V);else break;V=t(u)}}function k(M){if(E=!1,C(M),!S)if(t(d)!==null)S=!0,D||(D=!0,H());else{var V=t(u);V!==null&&de(k,V.startTime-M)}}var D=!1,O=-1,F=5,j=-1;function U(){return T?!0:!(i.unstable_now()-j<F)}function K(){if(T=!1,D){var M=i.unstable_now();j=M;var V=!0;try{e:{S=!1,E&&(E=!1,I(O),O=-1),x=!0;var q=y;try{t:{for(C(M),g=t(d);g!==null&&!(g.expirationTime>M&&U());){var ae=g.callback;if(typeof ae=="function"){g.callback=null,y=g.priorityLevel;var pe=ae(g.expirationTime<=M);if(M=i.unstable_now(),typeof pe=="function"){g.callback=pe,C(M),V=!0;break t}g===t(d)&&s(d),C(M)}else s(d);g=t(d)}if(g!==null)V=!0;else{var P=t(u);P!==null&&de(k,P.startTime-M),V=!1}}break e}finally{g=null,y=q,x=!1}V=void 0}}finally{V?H():D=!1}}}var H;if(typeof _=="function")H=function(){_(K)};else if(typeof MessageChannel<"u"){var ee=new MessageChannel,re=ee.port2;ee.port1.onmessage=K,H=function(){re.postMessage(null)}}else H=function(){A(K,0)};function de(M,V){O=A(function(){M(i.unstable_now())},V)}i.unstable_IdlePriority=5,i.unstable_ImmediatePriority=1,i.unstable_LowPriority=4,i.unstable_NormalPriority=3,i.unstable_Profiling=null,i.unstable_UserBlockingPriority=2,i.unstable_cancelCallback=function(M){M.callback=null},i.unstable_forceFrameRate=function(M){0>M||125<M?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):F=0<M?Math.floor(1e3/M):5},i.unstable_getCurrentPriorityLevel=function(){return y},i.unstable_next=function(M){switch(y){case 1:case 2:case 3:var V=3;break;default:V=y}var q=y;y=V;try{return M()}finally{y=q}},i.unstable_requestPaint=function(){T=!0},i.unstable_runWithPriority=function(M,V){switch(M){case 1:case 2:case 3:case 4:case 5:break;default:M=3}var q=y;y=M;try{return V()}finally{y=q}},i.unstable_scheduleCallback=function(M,V,q){var ae=i.unstable_now();switch(typeof q=="object"&&q!==null?(q=q.delay,q=typeof q=="number"&&0<q?ae+q:ae):q=ae,M){case 1:var pe=-1;break;case 2:pe=250;break;case 5:pe=1073741823;break;case 4:pe=1e4;break;default:pe=5e3}return pe=q+pe,M={id:f++,callback:V,priorityLevel:M,startTime:q,expirationTime:pe,sortIndex:-1},q>ae?(M.sortIndex=q,e(u,M),t(d)===null&&M===t(u)&&(E?(I(O),O=-1):E=!0,de(k,q-ae))):(M.sortIndex=pe,e(d,M),S||x||(S=!0,D||(D=!0,H()))),M},i.unstable_shouldYield=U,i.unstable_wrapCallback=function(M){var V=y;return function(){var q=y;y=V;try{return M.apply(this,arguments)}finally{y=q}}}})(cf)),cf}var Gy;function PA(){return Gy||(Gy=1,of.exports=DA()),of.exports}var uf={exports:{}},Ps={};var Hy;function UA(){if(Hy)return Ps;Hy=1;var i=Tm();function e(d){var u="https://react.dev/errors/"+d;if(1<arguments.length){u+="?args[]="+encodeURIComponent(arguments[1]);for(var f=2;f<arguments.length;f++)u+="&args[]="+encodeURIComponent(arguments[f])}return"Minified React error #"+d+"; visit "+u+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function t(){}var s={d:{f:t,r:function(){throw Error(e(522))},D:t,C:t,L:t,m:t,X:t,S:t,M:t},p:0,findDOMNode:null},n=Symbol.for("react.portal");function r(d,u,f){var g=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:n,key:g==null?null:""+g,children:d,containerInfo:u,implementation:f}}var l=i.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function c(d,u){if(d==="font")return"";if(typeof u=="string")return u==="use-credentials"?u:""}return Ps.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=s,Ps.createPortal=function(d,u){var f=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!u||u.nodeType!==1&&u.nodeType!==9&&u.nodeType!==11)throw Error(e(299));return r(d,u,null,f)},Ps.flushSync=function(d){var u=l.T,f=s.p;try{if(l.T=null,s.p=2,d)return d()}finally{l.T=u,s.p=f,s.d.f()}},Ps.preconnect=function(d,u){typeof d=="string"&&(u?(u=u.crossOrigin,u=typeof u=="string"?u==="use-credentials"?u:"":void 0):u=null,s.d.C(d,u))},Ps.prefetchDNS=function(d){typeof d=="string"&&s.d.D(d)},Ps.preinit=function(d,u){if(typeof d=="string"&&u&&typeof u.as=="string"){var f=u.as,g=c(f,u.crossOrigin),y=typeof u.integrity=="string"?u.integrity:void 0,x=typeof u.fetchPriority=="string"?u.fetchPriority:void 0;f==="style"?s.d.S(d,typeof u.precedence=="string"?u.precedence:void 0,{crossOrigin:g,integrity:y,fetchPriority:x}):f==="script"&&s.d.X(d,{crossOrigin:g,integrity:y,fetchPriority:x,nonce:typeof u.nonce=="string"?u.nonce:void 0})}},Ps.preinitModule=function(d,u){if(typeof d=="string")if(typeof u=="object"&&u!==null){if(u.as==null||u.as==="script"){var f=c(u.as,u.crossOrigin);s.d.M(d,{crossOrigin:f,integrity:typeof u.integrity=="string"?u.integrity:void 0,nonce:typeof u.nonce=="string"?u.nonce:void 0})}}else u==null&&s.d.M(d)},Ps.preload=function(d,u){if(typeof d=="string"&&typeof u=="object"&&u!==null&&typeof u.as=="string"){var f=u.as,g=c(f,u.crossOrigin);s.d.L(d,f,{crossOrigin:g,integrity:typeof u.integrity=="string"?u.integrity:void 0,nonce:typeof u.nonce=="string"?u.nonce:void 0,type:typeof u.type=="string"?u.type:void 0,fetchPriority:typeof u.fetchPriority=="string"?u.fetchPriority:void 0,referrerPolicy:typeof u.referrerPolicy=="string"?u.referrerPolicy:void 0,imageSrcSet:typeof u.imageSrcSet=="string"?u.imageSrcSet:void 0,imageSizes:typeof u.imageSizes=="string"?u.imageSizes:void 0,media:typeof u.media=="string"?u.media:void 0})}},Ps.preloadModule=function(d,u){if(typeof d=="string")if(u){var f=c(u.as,u.crossOrigin);s.d.m(d,{as:typeof u.as=="string"&&u.as!=="script"?u.as:void 0,crossOrigin:f,integrity:typeof u.integrity=="string"?u.integrity:void 0})}else s.d.m(d)},Ps.requestFormReset=function(d){s.d.r(d)},Ps.unstable_batchedUpdates=function(d,u){return d(u)},Ps.useFormState=function(d,u,f){return l.H.useFormState(d,u,f)},Ps.useFormStatus=function(){return l.H.useHostTransitionStatus()},Ps.version="19.2.4",Ps}var zy;function Wx(){if(zy)return uf.exports;zy=1;function i(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(i)}catch(e){console.error(e)}}return i(),uf.exports=UA(),uf.exports}var Ky;function MA(){if(Ky)return Xl;Ky=1;var i=PA(),e=Tm(),t=Wx();function s(a){var o="https://react.dev/errors/"+a;if(1<arguments.length){o+="?args[]="+encodeURIComponent(arguments[1]);for(var h=2;h<arguments.length;h++)o+="&args[]="+encodeURIComponent(arguments[h])}return"Minified React error #"+a+"; visit "+o+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function n(a){return!(!a||a.nodeType!==1&&a.nodeType!==9&&a.nodeType!==11)}function r(a){var o=a,h=a;if(a.alternate)for(;o.return;)o=o.return;else{a=o;do o=a,(o.flags&4098)!==0&&(h=o.return),a=o.return;while(a)}return o.tag===3?h:null}function l(a){if(a.tag===13){var o=a.memoizedState;if(o===null&&(a=a.alternate,a!==null&&(o=a.memoizedState)),o!==null)return o.dehydrated}return null}function c(a){if(a.tag===31){var o=a.memoizedState;if(o===null&&(a=a.alternate,a!==null&&(o=a.memoizedState)),o!==null)return o.dehydrated}return null}function d(a){if(r(a)!==a)throw Error(s(188))}function u(a){var o=a.alternate;if(!o){if(o=r(a),o===null)throw Error(s(188));return o!==a?null:a}for(var h=a,m=o;;){var v=h.return;if(v===null)break;var b=v.alternate;if(b===null){if(m=v.return,m!==null){h=m;continue}break}if(v.child===b.child){for(b=v.child;b;){if(b===h)return d(v),a;if(b===m)return d(v),o;b=b.sibling}throw Error(s(188))}if(h.return!==m.return)h=v,m=b;else{for(var R=!1,N=v.child;N;){if(N===h){R=!0,h=v,m=b;break}if(N===m){R=!0,m=v,h=b;break}N=N.sibling}if(!R){for(N=b.child;N;){if(N===h){R=!0,h=b,m=v;break}if(N===m){R=!0,m=b,h=v;break}N=N.sibling}if(!R)throw Error(s(189))}}if(h.alternate!==m)throw Error(s(190))}if(h.tag!==3)throw Error(s(188));return h.stateNode.current===h?a:o}function f(a){var o=a.tag;if(o===5||o===26||o===27||o===6)return a;for(a=a.child;a!==null;){if(o=f(a),o!==null)return o;a=a.sibling}return null}var g=Object.assign,y=Symbol.for("react.element"),x=Symbol.for("react.transitional.element"),S=Symbol.for("react.portal"),E=Symbol.for("react.fragment"),T=Symbol.for("react.strict_mode"),A=Symbol.for("react.profiler"),I=Symbol.for("react.consumer"),_=Symbol.for("react.context"),C=Symbol.for("react.forward_ref"),k=Symbol.for("react.suspense"),D=Symbol.for("react.suspense_list"),O=Symbol.for("react.memo"),F=Symbol.for("react.lazy"),j=Symbol.for("react.activity"),U=Symbol.for("react.memo_cache_sentinel"),K=Symbol.iterator;function H(a){return a===null||typeof a!="object"?null:(a=K&&a[K]||a["@@iterator"],typeof a=="function"?a:null)}var ee=Symbol.for("react.client.reference");function re(a){if(a==null)return null;if(typeof a=="function")return a.$$typeof===ee?null:a.displayName||a.name||null;if(typeof a=="string")return a;switch(a){case E:return"Fragment";case A:return"Profiler";case T:return"StrictMode";case k:return"Suspense";case D:return"SuspenseList";case j:return"Activity"}if(typeof a=="object")switch(a.$$typeof){case S:return"Portal";case _:return a.displayName||"Context";case I:return(a._context.displayName||"Context")+".Consumer";case C:var o=a.render;return a=a.displayName,a||(a=o.displayName||o.name||"",a=a!==""?"ForwardRef("+a+")":"ForwardRef"),a;case O:return o=a.displayName||null,o!==null?o:re(a.type)||"Memo";case F:o=a._payload,a=a._init;try{return re(a(o))}catch{}}return null}var de=Array.isArray,M=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,V=t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,q={pending:!1,data:null,method:null,action:null},ae=[],pe=-1;function P(a){return{current:a}}function $(a){0>pe||(a.current=ae[pe],ae[pe]=null,pe--)}function G(a,o){pe++,ae[pe]=a.current,a.current=o}var fe=P(null),ge=P(null),_e=P(null),Ne=P(null);function Ge(a,o){switch(G(_e,o),G(ge,a),G(fe,null),o.nodeType){case 9:case 11:a=(a=o.documentElement)&&(a=a.namespaceURI)?ly(a):0;break;default:if(a=o.tagName,o=o.namespaceURI)o=ly(o),a=oy(o,a);else switch(a){case"svg":a=1;break;case"math":a=2;break;default:a=0}}$(fe),G(fe,a)}function Be(){$(fe),$(ge),$(_e)}function pt(a){a.memoizedState!==null&&G(Ne,a);var o=fe.current,h=oy(o,a.type);o!==h&&(G(ge,a),G(fe,h))}function At(a){ge.current===a&&($(fe),$(ge)),Ne.current===a&&($(Ne),Kl._currentValue=q)}var Vt,bt;function gt(a){if(Vt===void 0)try{throw Error()}catch(h){var o=h.stack.trim().match(/\n( *(at )?)/);Vt=o&&o[1]||"",bt=-1<h.stack.indexOf(`
    at`)?" (<anonymous>)":-1<h.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Vt+a+bt}var zt=!1;function Fe(a,o){if(!a||zt)return"";zt=!0;var h=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var m={DetermineComponentFrameRoot:function(){try{if(o){var me=function(){throw Error()};if(Object.defineProperty(me.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(me,[])}catch(ne){var J=ne}Reflect.construct(a,[],me)}else{try{me.call()}catch(ne){J=ne}a.call(me.prototype)}}else{try{throw Error()}catch(ne){J=ne}(me=a())&&typeof me.catch=="function"&&me.catch(function(){})}}catch(ne){if(ne&&J&&typeof ne.stack=="string")return[ne.stack,J.stack]}return[null,null]}};m.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var v=Object.getOwnPropertyDescriptor(m.DetermineComponentFrameRoot,"name");v&&v.configurable&&Object.defineProperty(m.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var b=m.DetermineComponentFrameRoot(),R=b[0],N=b[1];if(R&&N){var B=R.split(`
`),Z=N.split(`
`);for(v=m=0;m<B.length&&!B[m].includes("DetermineComponentFrameRoot");)m++;for(;v<Z.length&&!Z[v].includes("DetermineComponentFrameRoot");)v++;if(m===B.length||v===Z.length)for(m=B.length-1,v=Z.length-1;1<=m&&0<=v&&B[m]!==Z[v];)v--;for(;1<=m&&0<=v;m--,v--)if(B[m]!==Z[v]){if(m!==1||v!==1)do if(m--,v--,0>v||B[m]!==Z[v]){var oe=`
`+B[m].replace(" at new "," at ");return a.displayName&&oe.includes("<anonymous>")&&(oe=oe.replace("<anonymous>",a.displayName)),oe}while(1<=m&&0<=v);break}}}finally{zt=!1,Error.prepareStackTrace=h}return(h=a?a.displayName||a.name:"")?gt(h):""}function we(a,o){switch(a.tag){case 26:case 27:case 5:return gt(a.type);case 16:return gt("Lazy");case 13:return a.child!==o&&o!==null?gt("Suspense Fallback"):gt("Suspense");case 19:return gt("SuspenseList");case 0:case 15:return Fe(a.type,!1);case 11:return Fe(a.type.render,!1);case 1:return Fe(a.type,!0);case 31:return gt("Activity");default:return""}}function Ue(a){try{var o="",h=null;do o+=we(a,h),h=a,a=a.return;while(a);return o}catch(m){return`
Error generating stack: `+m.message+`
`+m.stack}}var qe=Object.prototype.hasOwnProperty,dt=i.unstable_scheduleCallback,Ce=i.unstable_cancelCallback,He=i.unstable_shouldYield,Tt=i.unstable_requestPaint,rt=i.unstable_now,Kt=i.unstable_getCurrentPriorityLevel,ye=i.unstable_ImmediatePriority,We=i.unstable_UserBlockingPriority,it=i.unstable_NormalPriority,ls=i.unstable_LowPriority,Ns=i.unstable_IdlePriority,os=i.log,Zi=i.unstable_setDisableYieldValue,Es=null,$t=null;function As(a){if(typeof os=="function"&&Zi(a),$t&&typeof $t.setStrictMode=="function")try{$t.setStrictMode(Es,a)}catch{}}var Yt=Math.clz32?Math.clz32:_i,ii=Math.log,Ai=Math.LN2;function _i(a){return a>>>=0,a===0?32:31-(ii(a)/Ai|0)|0}var xs=256,Wt=262144,Os=4194304;function Ds(a){var o=a&42;if(o!==0)return o;switch(a&-a){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return a&261888;case 262144:case 524288:case 1048576:case 2097152:return a&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return a&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return a}}function Xt(a,o,h){var m=a.pendingLanes;if(m===0)return 0;var v=0,b=a.suspendedLanes,R=a.pingedLanes;a=a.warmLanes;var N=m&134217727;return N!==0?(m=N&~b,m!==0?v=Ds(m):(R&=N,R!==0?v=Ds(R):h||(h=N&~a,h!==0&&(v=Ds(h))))):(N=m&~b,N!==0?v=Ds(N):R!==0?v=Ds(R):h||(h=m&~a,h!==0&&(v=Ds(h)))),v===0?0:o!==0&&o!==v&&(o&b)===0&&(b=v&-v,h=o&-o,b>=h||b===32&&(h&4194048)!==0)?o:v}function Vs(a,o){return(a.pendingLanes&~(a.suspendedLanes&~a.pingedLanes)&o)===0}function ni(a,o){switch(a){case 1:case 2:case 4:case 8:case 64:return o+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Ii(){var a=Os;return Os<<=1,(Os&62914560)===0&&(Os=4194304),a}function ai(a){for(var o=[],h=0;31>h;h++)o.push(a);return o}function cs(a,o){a.pendingLanes|=o,o!==268435456&&(a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0)}function $i(a,o,h,m,v,b){var R=a.pendingLanes;a.pendingLanes=h,a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0,a.expiredLanes&=h,a.entangledLanes&=h,a.errorRecoveryDisabledLanes&=h,a.shellSuspendCounter=0;var N=a.entanglements,B=a.expirationTimes,Z=a.hiddenUpdates;for(h=R&~h;0<h;){var oe=31-Yt(h),me=1<<oe;N[oe]=0,B[oe]=-1;var J=Z[oe];if(J!==null)for(Z[oe]=null,oe=0;oe<J.length;oe++){var ne=J[oe];ne!==null&&(ne.lane&=-536870913)}h&=~me}m!==0&&ri(a,m,0),b!==0&&v===0&&a.tag!==0&&(a.suspendedLanes|=b&~(R&~o))}function ri(a,o,h){a.pendingLanes|=o,a.suspendedLanes&=~o;var m=31-Yt(o);a.entangledLanes|=o,a.entanglements[m]=a.entanglements[m]|1073741824|h&261930}function xn(a,o){var h=a.entangledLanes|=o;for(a=a.entanglements;h;){var m=31-Yt(h),v=1<<m;v&o|a[m]&o&&(a[m]|=o),h&=~v}}function le(a,o){var h=o&-o;return h=(h&42)!==0?1:Oe(h),(h&(a.suspendedLanes|o))!==0?0:h}function Oe(a){switch(a){case 2:a=1;break;case 8:a=4;break;case 32:a=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:a=128;break;case 268435456:a=134217728;break;default:a=0}return a}function Qe(a){return a&=-a,2<a?8<a?(a&134217727)!==0?32:268435456:8:2}function ts(){var a=V.p;return a!==0?a:(a=window.event,a===void 0?32:ky(a.type))}function Ie(a,o){var h=V.p;try{return V.p=a,o()}finally{V.p=h}}var ss=Math.random().toString(36).slice(2),_t="__reactFiber$"+ss,mt="__reactProps$"+ss,Sn="__reactContainer$"+ss,Ji="__reactEvents$"+ss,Xu="__reactListeners$"+ss,Zu="__reactHandles$"+ss,Eo="__reactResources$"+ss,Ri="__reactMarker$"+ss;function La(a){delete a[_t],delete a[mt],delete a[Ji],delete a[Xu],delete a[Zu]}function li(a){var o=a[_t];if(o)return o;for(var h=a.parentNode;h;){if(o=h[Sn]||h[_t]){if(h=o.alternate,o.child!==null||h!==null&&h.child!==null)for(a=py(a);a!==null;){if(h=a[_t])return h;a=py(a)}return o}a=h,h=a.parentNode}return null}function bn(a){if(a=a[_t]||a[Sn]){var o=a.tag;if(o===5||o===6||o===13||o===31||o===26||o===27||o===3)return a}return null}function Yn(a){var o=a.tag;if(o===5||o===26||o===27||o===6)return a.stateNode;throw Error(s(33))}function en(a){var o=a[Eo];return o||(o=a[Eo]={hoistableStyles:new Map,hoistableScripts:new Map}),o}function is(a){a[Ri]=!0}var Gi=new Set,al={};function tn(a,o){qn(a,o),qn(a+"Capture",o)}function qn(a,o){for(al[a]=o,a=0;a<o.length;a++)Gi.add(o[a])}var Ao=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),_o={},Io={};function Ju(a){return qe.call(Io,a)?!0:qe.call(_o,a)?!1:Ao.test(a)?Io[a]=!0:(_o[a]=!0,!1)}function tr(a,o,h){if(Ju(o))if(h===null)a.removeAttribute(o);else{switch(typeof h){case"undefined":case"function":case"symbol":a.removeAttribute(o);return;case"boolean":var m=o.toLowerCase().slice(0,5);if(m!=="data-"&&m!=="aria-"){a.removeAttribute(o);return}}a.setAttribute(o,""+h)}}function sr(a,o,h){if(h===null)a.removeAttribute(o);else{switch(typeof h){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(o);return}a.setAttribute(o,""+h)}}function $s(a,o,h,m){if(m===null)a.removeAttribute(h);else{switch(typeof m){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(h);return}a.setAttributeNS(o,h,""+m)}}function Gs(a){switch(typeof a){case"bigint":case"boolean":case"number":case"string":case"undefined":return a;case"object":return a;default:return""}}function Ro(a){var o=a.type;return(a=a.nodeName)&&a.toLowerCase()==="input"&&(o==="checkbox"||o==="radio")}function ed(a,o,h){var m=Object.getOwnPropertyDescriptor(a.constructor.prototype,o);if(!a.hasOwnProperty(o)&&typeof m<"u"&&typeof m.get=="function"&&typeof m.set=="function"){var v=m.get,b=m.set;return Object.defineProperty(a,o,{configurable:!0,get:function(){return v.call(this)},set:function(R){h=""+R,b.call(this,R)}}),Object.defineProperty(a,o,{enumerable:m.enumerable}),{getValue:function(){return h},setValue:function(R){h=""+R},stopTracking:function(){a._valueTracker=null,delete a[o]}}}}function rl(a){if(!a._valueTracker){var o=Ro(a)?"checked":"value";a._valueTracker=ed(a,o,""+a[o])}}function ir(a){if(!a)return!1;var o=a._valueTracker;if(!o)return!0;var h=o.getValue(),m="";return a&&(m=Ro(a)?a.checked?"true":"false":a.value),a=m,a!==h?(o.setValue(a),!0):!1}function nr(a){if(a=a||(typeof document<"u"?document:void 0),typeof a>"u")return null;try{return a.activeElement||a.body}catch{return a.body}}var td=/[\n"\\]/g;function se(a){return a.replace(td,function(o){return"\\"+o.charCodeAt(0).toString(16)+" "})}function xe(a,o,h,m,v,b,R,N){a.name="",R!=null&&typeof R!="function"&&typeof R!="symbol"&&typeof R!="boolean"?a.type=R:a.removeAttribute("type"),o!=null?R==="number"?(o===0&&a.value===""||a.value!=o)&&(a.value=""+Gs(o)):a.value!==""+Gs(o)&&(a.value=""+Gs(o)):R!=="submit"&&R!=="reset"||a.removeAttribute("value"),o!=null?nt(a,R,Gs(o)):h!=null?nt(a,R,Gs(h)):m!=null&&a.removeAttribute("value"),v==null&&b!=null&&(a.defaultChecked=!!b),v!=null&&(a.checked=v&&typeof v!="function"&&typeof v!="symbol"),N!=null&&typeof N!="function"&&typeof N!="symbol"&&typeof N!="boolean"?a.name=""+Gs(N):a.removeAttribute("name")}function tt(a,o,h,m,v,b,R,N){if(b!=null&&typeof b!="function"&&typeof b!="symbol"&&typeof b!="boolean"&&(a.type=b),o!=null||h!=null){if(!(b!=="submit"&&b!=="reset"||o!=null)){rl(a);return}h=h!=null?""+Gs(h):"",o=o!=null?""+Gs(o):h,N||o===a.value||(a.value=o),a.defaultValue=o}m=m??v,m=typeof m!="function"&&typeof m!="symbol"&&!!m,a.checked=N?a.checked:!!m,a.defaultChecked=!!m,R!=null&&typeof R!="function"&&typeof R!="symbol"&&typeof R!="boolean"&&(a.name=R),rl(a)}function nt(a,o,h){o==="number"&&nr(a.ownerDocument)===a||a.defaultValue===""+h||(a.defaultValue=""+h)}function yt(a,o,h,m){if(a=a.options,o){o={};for(var v=0;v<h.length;v++)o["$"+h[v]]=!0;for(h=0;h<a.length;h++)v=o.hasOwnProperty("$"+a[h].value),a[h].selected!==v&&(a[h].selected=v),v&&m&&(a[h].defaultSelected=!0)}else{for(h=""+Gs(h),o=null,v=0;v<a.length;v++){if(a[v].value===h){a[v].selected=!0,m&&(a[v].defaultSelected=!0);return}o!==null||a[v].disabled||(o=a[v])}o!==null&&(o.selected=!0)}}function Mt(a,o,h){if(o!=null&&(o=""+Gs(o),o!==a.value&&(a.value=o),h==null)){a.defaultValue!==o&&(a.defaultValue=o);return}a.defaultValue=h!=null?""+Gs(h):""}function ht(a,o,h,m){if(o==null){if(m!=null){if(h!=null)throw Error(s(92));if(de(m)){if(1<m.length)throw Error(s(93));m=m[0]}h=m}h==null&&(h=""),o=h}h=Gs(o),a.defaultValue=h,m=a.textContent,m===h&&m!==""&&m!==null&&(a.value=m),rl(a)}function ps(a,o){if(o){var h=a.firstChild;if(h&&h===a.lastChild&&h.nodeType===3){h.nodeValue=o;return}}a.textContent=o}var us=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Qn(a,o,h){var m=o.indexOf("--")===0;h==null||typeof h=="boolean"||h===""?m?a.setProperty(o,""):o==="float"?a.cssFloat="":a[o]="":m?a.setProperty(o,h):typeof h!="number"||h===0||us.has(o)?o==="float"?a.cssFloat=h:a[o]=(""+h).trim():a[o]=h+"px"}function ar(a,o,h){if(o!=null&&typeof o!="object")throw Error(s(62));if(a=a.style,h!=null){for(var m in h)!h.hasOwnProperty(m)||o!=null&&o.hasOwnProperty(m)||(m.indexOf("--")===0?a.setProperty(m,""):m==="float"?a.cssFloat="":a[m]="");for(var v in o)m=o[v],o.hasOwnProperty(v)&&h[v]!==m&&Qn(a,v,m)}else for(var b in o)o.hasOwnProperty(b)&&Qn(a,b,o[b])}function Wn(a){if(a.indexOf("-")===-1)return!1;switch(a){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var ll=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),rr=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Hs(a){return rr.test(""+a)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":a}function Hi(){}var ol=null;function sd(a){return a=a.target||a.srcElement||window,a.correspondingUseElement&&(a=a.correspondingUseElement),a.nodeType===3?a.parentNode:a}var lr=null,or=null;function rp(a){var o=bn(a);if(o&&(a=o.stateNode)){var h=a[mt]||null;e:switch(a=o.stateNode,o.type){case"input":if(xe(a,h.value,h.defaultValue,h.defaultValue,h.checked,h.defaultChecked,h.type,h.name),o=h.name,h.type==="radio"&&o!=null){for(h=a;h.parentNode;)h=h.parentNode;for(h=h.querySelectorAll('input[name="'+se(""+o)+'"][type="radio"]'),o=0;o<h.length;o++){var m=h[o];if(m!==a&&m.form===a.form){var v=m[mt]||null;if(!v)throw Error(s(90));xe(m,v.value,v.defaultValue,v.defaultValue,v.checked,v.defaultChecked,v.type,v.name)}}for(o=0;o<h.length;o++)m=h[o],m.form===a.form&&ir(m)}break e;case"textarea":Mt(a,h.value,h.defaultValue);break e;case"select":o=h.value,o!=null&&yt(a,!!h.multiple,o,!1)}}}var id=!1;function lp(a,o,h){if(id)return a(o,h);id=!0;try{var m=a(o);return m}finally{if(id=!1,(lr!==null||or!==null)&&(mc(),lr&&(o=lr,a=or,or=lr=null,rp(o),a)))for(o=0;o<a.length;o++)rp(a[o])}}function cl(a,o){var h=a.stateNode;if(h===null)return null;var m=h[mt]||null;if(m===null)return null;h=m[o];e:switch(o){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(m=!m.disabled)||(a=a.type,m=!(a==="button"||a==="input"||a==="select"||a==="textarea")),a=!m;break e;default:a=!1}if(a)return null;if(h&&typeof h!="function")throw Error(s(231,o,typeof h));return h}var Tn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),nd=!1;if(Tn)try{var ul={};Object.defineProperty(ul,"passive",{get:function(){nd=!0}}),window.addEventListener("test",ul,ul),window.removeEventListener("test",ul,ul)}catch{nd=!1}var Xn=null,ad=null,Lo=null;function op(){if(Lo)return Lo;var a,o=ad,h=o.length,m,v="value"in Xn?Xn.value:Xn.textContent,b=v.length;for(a=0;a<h&&o[a]===v[a];a++);var R=h-a;for(m=1;m<=R&&o[h-m]===v[b-m];m++);return Lo=v.slice(a,1<m?1-m:void 0)}function wo(a){var o=a.keyCode;return"charCode"in a?(a=a.charCode,a===0&&o===13&&(a=13)):a=o,a===10&&(a=13),32<=a||a===13?a:0}function Co(){return!0}function cp(){return!1}function zs(a){function o(h,m,v,b,R){this._reactName=h,this._targetInst=v,this.type=m,this.nativeEvent=b,this.target=R,this.currentTarget=null;for(var N in a)a.hasOwnProperty(N)&&(h=a[N],this[N]=h?h(b):b[N]);return this.isDefaultPrevented=(b.defaultPrevented!=null?b.defaultPrevented:b.returnValue===!1)?Co:cp,this.isPropagationStopped=cp,this}return g(o.prototype,{preventDefault:function(){this.defaultPrevented=!0;var h=this.nativeEvent;h&&(h.preventDefault?h.preventDefault():typeof h.returnValue!="unknown"&&(h.returnValue=!1),this.isDefaultPrevented=Co)},stopPropagation:function(){var h=this.nativeEvent;h&&(h.stopPropagation?h.stopPropagation():typeof h.cancelBubble!="unknown"&&(h.cancelBubble=!0),this.isPropagationStopped=Co)},persist:function(){},isPersistent:Co}),o}var wa={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(a){return a.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ko=zs(wa),dl=g({},wa,{view:0,detail:0}),RT=zs(dl),rd,ld,hl,No=g({},dl,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:cd,button:0,buttons:0,relatedTarget:function(a){return a.relatedTarget===void 0?a.fromElement===a.srcElement?a.toElement:a.fromElement:a.relatedTarget},movementX:function(a){return"movementX"in a?a.movementX:(a!==hl&&(hl&&a.type==="mousemove"?(rd=a.screenX-hl.screenX,ld=a.screenY-hl.screenY):ld=rd=0,hl=a),rd)},movementY:function(a){return"movementY"in a?a.movementY:ld}}),up=zs(No),LT=g({},No,{dataTransfer:0}),wT=zs(LT),CT=g({},dl,{relatedTarget:0}),od=zs(CT),kT=g({},wa,{animationName:0,elapsedTime:0,pseudoElement:0}),NT=zs(kT),OT=g({},wa,{clipboardData:function(a){return"clipboardData"in a?a.clipboardData:window.clipboardData}}),DT=zs(OT),PT=g({},wa,{data:0}),dp=zs(PT),UT={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},MT={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},jT={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function FT(a){var o=this.nativeEvent;return o.getModifierState?o.getModifierState(a):(a=jT[a])?!!o[a]:!1}function cd(){return FT}var BT=g({},dl,{key:function(a){if(a.key){var o=UT[a.key]||a.key;if(o!=="Unidentified")return o}return a.type==="keypress"?(a=wo(a),a===13?"Enter":String.fromCharCode(a)):a.type==="keydown"||a.type==="keyup"?MT[a.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:cd,charCode:function(a){return a.type==="keypress"?wo(a):0},keyCode:function(a){return a.type==="keydown"||a.type==="keyup"?a.keyCode:0},which:function(a){return a.type==="keypress"?wo(a):a.type==="keydown"||a.type==="keyup"?a.keyCode:0}}),VT=zs(BT),$T=g({},No,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),hp=zs($T),GT=g({},dl,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:cd}),HT=zs(GT),zT=g({},wa,{propertyName:0,elapsedTime:0,pseudoElement:0}),KT=zs(zT),YT=g({},No,{deltaX:function(a){return"deltaX"in a?a.deltaX:"wheelDeltaX"in a?-a.wheelDeltaX:0},deltaY:function(a){return"deltaY"in a?a.deltaY:"wheelDeltaY"in a?-a.wheelDeltaY:"wheelDelta"in a?-a.wheelDelta:0},deltaZ:0,deltaMode:0}),qT=zs(YT),QT=g({},wa,{newState:0,oldState:0}),WT=zs(QT),XT=[9,13,27,32],ud=Tn&&"CompositionEvent"in window,fl=null;Tn&&"documentMode"in document&&(fl=document.documentMode);var ZT=Tn&&"TextEvent"in window&&!fl,fp=Tn&&(!ud||fl&&8<fl&&11>=fl),mp=" ",pp=!1;function gp(a,o){switch(a){case"keyup":return XT.indexOf(o.keyCode)!==-1;case"keydown":return o.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function yp(a){return a=a.detail,typeof a=="object"&&"data"in a?a.data:null}var cr=!1;function JT(a,o){switch(a){case"compositionend":return yp(o);case"keypress":return o.which!==32?null:(pp=!0,mp);case"textInput":return a=o.data,a===mp&&pp?null:a;default:return null}}function eE(a,o){if(cr)return a==="compositionend"||!ud&&gp(a,o)?(a=op(),Lo=ad=Xn=null,cr=!1,a):null;switch(a){case"paste":return null;case"keypress":if(!(o.ctrlKey||o.altKey||o.metaKey)||o.ctrlKey&&o.altKey){if(o.char&&1<o.char.length)return o.char;if(o.which)return String.fromCharCode(o.which)}return null;case"compositionend":return fp&&o.locale!=="ko"?null:o.data;default:return null}}var tE={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function vp(a){var o=a&&a.nodeName&&a.nodeName.toLowerCase();return o==="input"?!!tE[a.type]:o==="textarea"}function xp(a,o,h,m){lr?or?or.push(m):or=[m]:lr=m,o=bc(o,"onChange"),0<o.length&&(h=new ko("onChange","change",null,h,m),a.push({event:h,listeners:o}))}var ml=null,pl=null;function sE(a){ty(a,0)}function Oo(a){var o=Yn(a);if(ir(o))return a}function Sp(a,o){if(a==="change")return o}var bp=!1;if(Tn){var dd;if(Tn){var hd="oninput"in document;if(!hd){var Tp=document.createElement("div");Tp.setAttribute("oninput","return;"),hd=typeof Tp.oninput=="function"}dd=hd}else dd=!1;bp=dd&&(!document.documentMode||9<document.documentMode)}function Ep(){ml&&(ml.detachEvent("onpropertychange",Ap),pl=ml=null)}function Ap(a){if(a.propertyName==="value"&&Oo(pl)){var o=[];xp(o,pl,a,sd(a)),lp(sE,o)}}function iE(a,o,h){a==="focusin"?(Ep(),ml=o,pl=h,ml.attachEvent("onpropertychange",Ap)):a==="focusout"&&Ep()}function nE(a){if(a==="selectionchange"||a==="keyup"||a==="keydown")return Oo(pl)}function aE(a,o){if(a==="click")return Oo(o)}function rE(a,o){if(a==="input"||a==="change")return Oo(o)}function lE(a,o){return a===o&&(a!==0||1/a===1/o)||a!==a&&o!==o}var oi=typeof Object.is=="function"?Object.is:lE;function gl(a,o){if(oi(a,o))return!0;if(typeof a!="object"||a===null||typeof o!="object"||o===null)return!1;var h=Object.keys(a),m=Object.keys(o);if(h.length!==m.length)return!1;for(m=0;m<h.length;m++){var v=h[m];if(!qe.call(o,v)||!oi(a[v],o[v]))return!1}return!0}function _p(a){for(;a&&a.firstChild;)a=a.firstChild;return a}function Ip(a,o){var h=_p(a);a=0;for(var m;h;){if(h.nodeType===3){if(m=a+h.textContent.length,a<=o&&m>=o)return{node:h,offset:o-a};a=m}e:{for(;h;){if(h.nextSibling){h=h.nextSibling;break e}h=h.parentNode}h=void 0}h=_p(h)}}function Rp(a,o){return a&&o?a===o?!0:a&&a.nodeType===3?!1:o&&o.nodeType===3?Rp(a,o.parentNode):"contains"in a?a.contains(o):a.compareDocumentPosition?!!(a.compareDocumentPosition(o)&16):!1:!1}function Lp(a){a=a!=null&&a.ownerDocument!=null&&a.ownerDocument.defaultView!=null?a.ownerDocument.defaultView:window;for(var o=nr(a.document);o instanceof a.HTMLIFrameElement;){try{var h=typeof o.contentWindow.location.href=="string"}catch{h=!1}if(h)a=o.contentWindow;else break;o=nr(a.document)}return o}function fd(a){var o=a&&a.nodeName&&a.nodeName.toLowerCase();return o&&(o==="input"&&(a.type==="text"||a.type==="search"||a.type==="tel"||a.type==="url"||a.type==="password")||o==="textarea"||a.contentEditable==="true")}var oE=Tn&&"documentMode"in document&&11>=document.documentMode,ur=null,md=null,yl=null,pd=!1;function wp(a,o,h){var m=h.window===h?h.document:h.nodeType===9?h:h.ownerDocument;pd||ur==null||ur!==nr(m)||(m=ur,"selectionStart"in m&&fd(m)?m={start:m.selectionStart,end:m.selectionEnd}:(m=(m.ownerDocument&&m.ownerDocument.defaultView||window).getSelection(),m={anchorNode:m.anchorNode,anchorOffset:m.anchorOffset,focusNode:m.focusNode,focusOffset:m.focusOffset}),yl&&gl(yl,m)||(yl=m,m=bc(md,"onSelect"),0<m.length&&(o=new ko("onSelect","select",null,o,h),a.push({event:o,listeners:m}),o.target=ur)))}function Ca(a,o){var h={};return h[a.toLowerCase()]=o.toLowerCase(),h["Webkit"+a]="webkit"+o,h["Moz"+a]="moz"+o,h}var dr={animationend:Ca("Animation","AnimationEnd"),animationiteration:Ca("Animation","AnimationIteration"),animationstart:Ca("Animation","AnimationStart"),transitionrun:Ca("Transition","TransitionRun"),transitionstart:Ca("Transition","TransitionStart"),transitioncancel:Ca("Transition","TransitionCancel"),transitionend:Ca("Transition","TransitionEnd")},gd={},Cp={};Tn&&(Cp=document.createElement("div").style,"AnimationEvent"in window||(delete dr.animationend.animation,delete dr.animationiteration.animation,delete dr.animationstart.animation),"TransitionEvent"in window||delete dr.transitionend.transition);function ka(a){if(gd[a])return gd[a];if(!dr[a])return a;var o=dr[a],h;for(h in o)if(o.hasOwnProperty(h)&&h in Cp)return gd[a]=o[h];return a}var kp=ka("animationend"),Np=ka("animationiteration"),Op=ka("animationstart"),cE=ka("transitionrun"),uE=ka("transitionstart"),dE=ka("transitioncancel"),Dp=ka("transitionend"),Pp=new Map,yd="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");yd.push("scrollEnd");function zi(a,o){Pp.set(a,o),tn(o,[a])}var Do=typeof reportError=="function"?reportError:function(a){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var o=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof a=="object"&&a!==null&&typeof a.message=="string"?String(a.message):String(a),error:a});if(!window.dispatchEvent(o))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",a);return}console.error(a)},Li=[],hr=0,vd=0;function Po(){for(var a=hr,o=vd=hr=0;o<a;){var h=Li[o];Li[o++]=null;var m=Li[o];Li[o++]=null;var v=Li[o];Li[o++]=null;var b=Li[o];if(Li[o++]=null,m!==null&&v!==null){var R=m.pending;R===null?v.next=v:(v.next=R.next,R.next=v),m.pending=v}b!==0&&Up(h,v,b)}}function Uo(a,o,h,m){Li[hr++]=a,Li[hr++]=o,Li[hr++]=h,Li[hr++]=m,vd|=m,a.lanes|=m,a=a.alternate,a!==null&&(a.lanes|=m)}function xd(a,o,h,m){return Uo(a,o,h,m),Mo(a)}function Na(a,o){return Uo(a,null,null,o),Mo(a)}function Up(a,o,h){a.lanes|=h;var m=a.alternate;m!==null&&(m.lanes|=h);for(var v=!1,b=a.return;b!==null;)b.childLanes|=h,m=b.alternate,m!==null&&(m.childLanes|=h),b.tag===22&&(a=b.stateNode,a===null||a._visibility&1||(v=!0)),a=b,b=b.return;return a.tag===3?(b=a.stateNode,v&&o!==null&&(v=31-Yt(h),a=b.hiddenUpdates,m=a[v],m===null?a[v]=[o]:m.push(o),o.lane=h|536870912),b):null}function Mo(a){if(50<Fl)throw Fl=0,Lh=null,Error(s(185));for(var o=a.return;o!==null;)a=o,o=a.return;return a.tag===3?a.stateNode:null}var fr={};function hE(a,o,h,m){this.tag=a,this.key=h,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=o,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=m,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ci(a,o,h,m){return new hE(a,o,h,m)}function Sd(a){return a=a.prototype,!(!a||!a.isReactComponent)}function En(a,o){var h=a.alternate;return h===null?(h=ci(a.tag,o,a.key,a.mode),h.elementType=a.elementType,h.type=a.type,h.stateNode=a.stateNode,h.alternate=a,a.alternate=h):(h.pendingProps=o,h.type=a.type,h.flags=0,h.subtreeFlags=0,h.deletions=null),h.flags=a.flags&65011712,h.childLanes=a.childLanes,h.lanes=a.lanes,h.child=a.child,h.memoizedProps=a.memoizedProps,h.memoizedState=a.memoizedState,h.updateQueue=a.updateQueue,o=a.dependencies,h.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext},h.sibling=a.sibling,h.index=a.index,h.ref=a.ref,h.refCleanup=a.refCleanup,h}function Mp(a,o){a.flags&=65011714;var h=a.alternate;return h===null?(a.childLanes=0,a.lanes=o,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=h.childLanes,a.lanes=h.lanes,a.child=h.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=h.memoizedProps,a.memoizedState=h.memoizedState,a.updateQueue=h.updateQueue,a.type=h.type,o=h.dependencies,a.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext}),a}function jo(a,o,h,m,v,b){var R=0;if(m=a,typeof a=="function")Sd(a)&&(R=1);else if(typeof a=="string")R=yA(a,h,fe.current)?26:a==="html"||a==="head"||a==="body"?27:5;else e:switch(a){case j:return a=ci(31,h,o,v),a.elementType=j,a.lanes=b,a;case E:return Oa(h.children,v,b,o);case T:R=8,v|=24;break;case A:return a=ci(12,h,o,v|2),a.elementType=A,a.lanes=b,a;case k:return a=ci(13,h,o,v),a.elementType=k,a.lanes=b,a;case D:return a=ci(19,h,o,v),a.elementType=D,a.lanes=b,a;default:if(typeof a=="object"&&a!==null)switch(a.$$typeof){case _:R=10;break e;case I:R=9;break e;case C:R=11;break e;case O:R=14;break e;case F:R=16,m=null;break e}R=29,h=Error(s(130,a===null?"null":typeof a,"")),m=null}return o=ci(R,h,o,v),o.elementType=a,o.type=m,o.lanes=b,o}function Oa(a,o,h,m){return a=ci(7,a,m,o),a.lanes=h,a}function bd(a,o,h){return a=ci(6,a,null,o),a.lanes=h,a}function jp(a){var o=ci(18,null,null,0);return o.stateNode=a,o}function Td(a,o,h){return o=ci(4,a.children!==null?a.children:[],a.key,o),o.lanes=h,o.stateNode={containerInfo:a.containerInfo,pendingChildren:null,implementation:a.implementation},o}var Fp=new WeakMap;function wi(a,o){if(typeof a=="object"&&a!==null){var h=Fp.get(a);return h!==void 0?h:(o={value:a,source:o,stack:Ue(o)},Fp.set(a,o),o)}return{value:a,source:o,stack:Ue(o)}}var mr=[],pr=0,Fo=null,vl=0,Ci=[],ki=0,Zn=null,sn=1,nn="";function An(a,o){mr[pr++]=vl,mr[pr++]=Fo,Fo=a,vl=o}function Bp(a,o,h){Ci[ki++]=sn,Ci[ki++]=nn,Ci[ki++]=Zn,Zn=a;var m=sn;a=nn;var v=32-Yt(m)-1;m&=~(1<<v),h+=1;var b=32-Yt(o)+v;if(30<b){var R=v-v%5;b=(m&(1<<R)-1).toString(32),m>>=R,v-=R,sn=1<<32-Yt(o)+v|h<<v|m,nn=b+a}else sn=1<<b|h<<v|m,nn=a}function Ed(a){a.return!==null&&(An(a,1),Bp(a,1,0))}function Ad(a){for(;a===Fo;)Fo=mr[--pr],mr[pr]=null,vl=mr[--pr],mr[pr]=null;for(;a===Zn;)Zn=Ci[--ki],Ci[ki]=null,nn=Ci[--ki],Ci[ki]=null,sn=Ci[--ki],Ci[ki]=null}function Vp(a,o){Ci[ki++]=sn,Ci[ki++]=nn,Ci[ki++]=Zn,sn=o.id,nn=o.overflow,Zn=a}var _s=null,jt=null,ft=!1,Jn=null,Ni=!1,_d=Error(s(519));function ea(a){var o=Error(s(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw xl(wi(o,a)),_d}function $p(a){var o=a.stateNode,h=a.type,m=a.memoizedProps;switch(o[_t]=a,o[mt]=m,h){case"dialog":ot("cancel",o),ot("close",o);break;case"iframe":case"object":case"embed":ot("load",o);break;case"video":case"audio":for(h=0;h<Vl.length;h++)ot(Vl[h],o);break;case"source":ot("error",o);break;case"img":case"image":case"link":ot("error",o),ot("load",o);break;case"details":ot("toggle",o);break;case"input":ot("invalid",o),tt(o,m.value,m.defaultValue,m.checked,m.defaultChecked,m.type,m.name,!0);break;case"select":ot("invalid",o);break;case"textarea":ot("invalid",o),ht(o,m.value,m.defaultValue,m.children)}h=m.children,typeof h!="string"&&typeof h!="number"&&typeof h!="bigint"||o.textContent===""+h||m.suppressHydrationWarning===!0||ay(o.textContent,h)?(m.popover!=null&&(ot("beforetoggle",o),ot("toggle",o)),m.onScroll!=null&&ot("scroll",o),m.onScrollEnd!=null&&ot("scrollend",o),m.onClick!=null&&(o.onclick=Hi),o=!0):o=!1,o||ea(a,!0)}function Gp(a){for(_s=a.return;_s;)switch(_s.tag){case 5:case 31:case 13:Ni=!1;return;case 27:case 3:Ni=!0;return;default:_s=_s.return}}function gr(a){if(a!==_s)return!1;if(!ft)return Gp(a),ft=!0,!1;var o=a.tag,h;if((h=o!==3&&o!==27)&&((h=o===5)&&(h=a.type,h=!(h!=="form"&&h!=="button")||Gh(a.type,a.memoizedProps)),h=!h),h&&jt&&ea(a),Gp(a),o===13){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(s(317));jt=my(a)}else if(o===31){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(s(317));jt=my(a)}else o===27?(o=jt,ma(a.type)?(a=qh,qh=null,jt=a):jt=o):jt=_s?Di(a.stateNode.nextSibling):null;return!0}function Da(){jt=_s=null,ft=!1}function Id(){var a=Jn;return a!==null&&(Qs===null?Qs=a:Qs.push.apply(Qs,a),Jn=null),a}function xl(a){Jn===null?Jn=[a]:Jn.push(a)}var Rd=P(null),Pa=null,_n=null;function ta(a,o,h){G(Rd,o._currentValue),o._currentValue=h}function In(a){a._currentValue=Rd.current,$(Rd)}function Ld(a,o,h){for(;a!==null;){var m=a.alternate;if((a.childLanes&o)!==o?(a.childLanes|=o,m!==null&&(m.childLanes|=o)):m!==null&&(m.childLanes&o)!==o&&(m.childLanes|=o),a===h)break;a=a.return}}function wd(a,o,h,m){var v=a.child;for(v!==null&&(v.return=a);v!==null;){var b=v.dependencies;if(b!==null){var R=v.child;b=b.firstContext;e:for(;b!==null;){var N=b;b=v;for(var B=0;B<o.length;B++)if(N.context===o[B]){b.lanes|=h,N=b.alternate,N!==null&&(N.lanes|=h),Ld(b.return,h,a),m||(R=null);break e}b=N.next}}else if(v.tag===18){if(R=v.return,R===null)throw Error(s(341));R.lanes|=h,b=R.alternate,b!==null&&(b.lanes|=h),Ld(R,h,a),R=null}else R=v.child;if(R!==null)R.return=v;else for(R=v;R!==null;){if(R===a){R=null;break}if(v=R.sibling,v!==null){v.return=R.return,R=v;break}R=R.return}v=R}}function yr(a,o,h,m){a=null;for(var v=o,b=!1;v!==null;){if(!b){if((v.flags&524288)!==0)b=!0;else if((v.flags&262144)!==0)break}if(v.tag===10){var R=v.alternate;if(R===null)throw Error(s(387));if(R=R.memoizedProps,R!==null){var N=v.type;oi(v.pendingProps.value,R.value)||(a!==null?a.push(N):a=[N])}}else if(v===Ne.current){if(R=v.alternate,R===null)throw Error(s(387));R.memoizedState.memoizedState!==v.memoizedState.memoizedState&&(a!==null?a.push(Kl):a=[Kl])}v=v.return}a!==null&&wd(o,a,h,m),o.flags|=262144}function Bo(a){for(a=a.firstContext;a!==null;){if(!oi(a.context._currentValue,a.memoizedValue))return!0;a=a.next}return!1}function Ua(a){Pa=a,_n=null,a=a.dependencies,a!==null&&(a.firstContext=null)}function Is(a){return Hp(Pa,a)}function Vo(a,o){return Pa===null&&Ua(a),Hp(a,o)}function Hp(a,o){var h=o._currentValue;if(o={context:o,memoizedValue:h,next:null},_n===null){if(a===null)throw Error(s(308));_n=o,a.dependencies={lanes:0,firstContext:o},a.flags|=524288}else _n=_n.next=o;return h}var fE=typeof AbortController<"u"?AbortController:function(){var a=[],o=this.signal={aborted:!1,addEventListener:function(h,m){a.push(m)}};this.abort=function(){o.aborted=!0,a.forEach(function(h){return h()})}},mE=i.unstable_scheduleCallback,pE=i.unstable_NormalPriority,ds={$$typeof:_,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Cd(){return{controller:new fE,data:new Map,refCount:0}}function Sl(a){a.refCount--,a.refCount===0&&mE(pE,function(){a.controller.abort()})}var bl=null,kd=0,vr=0,xr=null;function gE(a,o){if(bl===null){var h=bl=[];kd=0,vr=Dh(),xr={status:"pending",value:void 0,then:function(m){h.push(m)}}}return kd++,o.then(zp,zp),o}function zp(){if(--kd===0&&bl!==null){xr!==null&&(xr.status="fulfilled");var a=bl;bl=null,vr=0,xr=null;for(var o=0;o<a.length;o++)(0,a[o])()}}function yE(a,o){var h=[],m={status:"pending",value:null,reason:null,then:function(v){h.push(v)}};return a.then(function(){m.status="fulfilled",m.value=o;for(var v=0;v<h.length;v++)(0,h[v])(o)},function(v){for(m.status="rejected",m.reason=v,v=0;v<h.length;v++)(0,h[v])(void 0)}),m}var Kp=M.S;M.S=function(a,o){w0=rt(),typeof o=="object"&&o!==null&&typeof o.then=="function"&&gE(a,o),Kp!==null&&Kp(a,o)};var Ma=P(null);function Nd(){var a=Ma.current;return a!==null?a:Dt.pooledCache}function $o(a,o){o===null?G(Ma,Ma.current):G(Ma,o.pool)}function Yp(){var a=Nd();return a===null?null:{parent:ds._currentValue,pool:a}}var Sr=Error(s(460)),Od=Error(s(474)),Go=Error(s(542)),Ho={then:function(){}};function qp(a){return a=a.status,a==="fulfilled"||a==="rejected"}function Qp(a,o,h){switch(h=a[h],h===void 0?a.push(o):h!==o&&(o.then(Hi,Hi),o=h),o.status){case"fulfilled":return o.value;case"rejected":throw a=o.reason,Xp(a),a;default:if(typeof o.status=="string")o.then(Hi,Hi);else{if(a=Dt,a!==null&&100<a.shellSuspendCounter)throw Error(s(482));a=o,a.status="pending",a.then(function(m){if(o.status==="pending"){var v=o;v.status="fulfilled",v.value=m}},function(m){if(o.status==="pending"){var v=o;v.status="rejected",v.reason=m}})}switch(o.status){case"fulfilled":return o.value;case"rejected":throw a=o.reason,Xp(a),a}throw Fa=o,Sr}}function ja(a){try{var o=a._init;return o(a._payload)}catch(h){throw h!==null&&typeof h=="object"&&typeof h.then=="function"?(Fa=h,Sr):h}}var Fa=null;function Wp(){if(Fa===null)throw Error(s(459));var a=Fa;return Fa=null,a}function Xp(a){if(a===Sr||a===Go)throw Error(s(483))}var br=null,Tl=0;function zo(a){var o=Tl;return Tl+=1,br===null&&(br=[]),Qp(br,a,o)}function El(a,o){o=o.props.ref,a.ref=o!==void 0?o:null}function Ko(a,o){throw o.$$typeof===y?Error(s(525)):(a=Object.prototype.toString.call(o),Error(s(31,a==="[object Object]"?"object with keys {"+Object.keys(o).join(", ")+"}":a)))}function Zp(a){function o(Y,z){if(a){var X=Y.deletions;X===null?(Y.deletions=[z],Y.flags|=16):X.push(z)}}function h(Y,z){if(!a)return null;for(;z!==null;)o(Y,z),z=z.sibling;return null}function m(Y){for(var z=new Map;Y!==null;)Y.key!==null?z.set(Y.key,Y):z.set(Y.index,Y),Y=Y.sibling;return z}function v(Y,z){return Y=En(Y,z),Y.index=0,Y.sibling=null,Y}function b(Y,z,X){return Y.index=X,a?(X=Y.alternate,X!==null?(X=X.index,X<z?(Y.flags|=67108866,z):X):(Y.flags|=67108866,z)):(Y.flags|=1048576,z)}function R(Y){return a&&Y.alternate===null&&(Y.flags|=67108866),Y}function N(Y,z,X,he){return z===null||z.tag!==6?(z=bd(X,Y.mode,he),z.return=Y,z):(z=v(z,X),z.return=Y,z)}function B(Y,z,X,he){var Ve=X.type;return Ve===E?oe(Y,z,X.props.children,he,X.key):z!==null&&(z.elementType===Ve||typeof Ve=="object"&&Ve!==null&&Ve.$$typeof===F&&ja(Ve)===z.type)?(z=v(z,X.props),El(z,X),z.return=Y,z):(z=jo(X.type,X.key,X.props,null,Y.mode,he),El(z,X),z.return=Y,z)}function Z(Y,z,X,he){return z===null||z.tag!==4||z.stateNode.containerInfo!==X.containerInfo||z.stateNode.implementation!==X.implementation?(z=Td(X,Y.mode,he),z.return=Y,z):(z=v(z,X.children||[]),z.return=Y,z)}function oe(Y,z,X,he,Ve){return z===null||z.tag!==7?(z=Oa(X,Y.mode,he,Ve),z.return=Y,z):(z=v(z,X),z.return=Y,z)}function me(Y,z,X){if(typeof z=="string"&&z!==""||typeof z=="number"||typeof z=="bigint")return z=bd(""+z,Y.mode,X),z.return=Y,z;if(typeof z=="object"&&z!==null){switch(z.$$typeof){case x:return X=jo(z.type,z.key,z.props,null,Y.mode,X),El(X,z),X.return=Y,X;case S:return z=Td(z,Y.mode,X),z.return=Y,z;case F:return z=ja(z),me(Y,z,X)}if(de(z)||H(z))return z=Oa(z,Y.mode,X,null),z.return=Y,z;if(typeof z.then=="function")return me(Y,zo(z),X);if(z.$$typeof===_)return me(Y,Vo(Y,z),X);Ko(Y,z)}return null}function J(Y,z,X,he){var Ve=z!==null?z.key:null;if(typeof X=="string"&&X!==""||typeof X=="number"||typeof X=="bigint")return Ve!==null?null:N(Y,z,""+X,he);if(typeof X=="object"&&X!==null){switch(X.$$typeof){case x:return X.key===Ve?B(Y,z,X,he):null;case S:return X.key===Ve?Z(Y,z,X,he):null;case F:return X=ja(X),J(Y,z,X,he)}if(de(X)||H(X))return Ve!==null?null:oe(Y,z,X,he,null);if(typeof X.then=="function")return J(Y,z,zo(X),he);if(X.$$typeof===_)return J(Y,z,Vo(Y,X),he);Ko(Y,X)}return null}function ne(Y,z,X,he,Ve){if(typeof he=="string"&&he!==""||typeof he=="number"||typeof he=="bigint")return Y=Y.get(X)||null,N(z,Y,""+he,Ve);if(typeof he=="object"&&he!==null){switch(he.$$typeof){case x:return Y=Y.get(he.key===null?X:he.key)||null,B(z,Y,he,Ve);case S:return Y=Y.get(he.key===null?X:he.key)||null,Z(z,Y,he,Ve);case F:return he=ja(he),ne(Y,z,X,he,Ve)}if(de(he)||H(he))return Y=Y.get(X)||null,oe(z,Y,he,Ve,null);if(typeof he.then=="function")return ne(Y,z,X,zo(he),Ve);if(he.$$typeof===_)return ne(Y,z,X,Vo(z,he),Ve);Ko(z,he)}return null}function Pe(Y,z,X,he){for(var Ve=null,vt=null,Me=z,et=z=0,ut=null;Me!==null&&et<X.length;et++){Me.index>et?(ut=Me,Me=null):ut=Me.sibling;var xt=J(Y,Me,X[et],he);if(xt===null){Me===null&&(Me=ut);break}a&&Me&&xt.alternate===null&&o(Y,Me),z=b(xt,z,et),vt===null?Ve=xt:vt.sibling=xt,vt=xt,Me=ut}if(et===X.length)return h(Y,Me),ft&&An(Y,et),Ve;if(Me===null){for(;et<X.length;et++)Me=me(Y,X[et],he),Me!==null&&(z=b(Me,z,et),vt===null?Ve=Me:vt.sibling=Me,vt=Me);return ft&&An(Y,et),Ve}for(Me=m(Me);et<X.length;et++)ut=ne(Me,Y,et,X[et],he),ut!==null&&(a&&ut.alternate!==null&&Me.delete(ut.key===null?et:ut.key),z=b(ut,z,et),vt===null?Ve=ut:vt.sibling=ut,vt=ut);return a&&Me.forEach(function(xa){return o(Y,xa)}),ft&&An(Y,et),Ve}function $e(Y,z,X,he){if(X==null)throw Error(s(151));for(var Ve=null,vt=null,Me=z,et=z=0,ut=null,xt=X.next();Me!==null&&!xt.done;et++,xt=X.next()){Me.index>et?(ut=Me,Me=null):ut=Me.sibling;var xa=J(Y,Me,xt.value,he);if(xa===null){Me===null&&(Me=ut);break}a&&Me&&xa.alternate===null&&o(Y,Me),z=b(xa,z,et),vt===null?Ve=xa:vt.sibling=xa,vt=xa,Me=ut}if(xt.done)return h(Y,Me),ft&&An(Y,et),Ve;if(Me===null){for(;!xt.done;et++,xt=X.next())xt=me(Y,xt.value,he),xt!==null&&(z=b(xt,z,et),vt===null?Ve=xt:vt.sibling=xt,vt=xt);return ft&&An(Y,et),Ve}for(Me=m(Me);!xt.done;et++,xt=X.next())xt=ne(Me,Y,et,xt.value,he),xt!==null&&(a&&xt.alternate!==null&&Me.delete(xt.key===null?et:xt.key),z=b(xt,z,et),vt===null?Ve=xt:vt.sibling=xt,vt=xt);return a&&Me.forEach(function(LA){return o(Y,LA)}),ft&&An(Y,et),Ve}function Nt(Y,z,X,he){if(typeof X=="object"&&X!==null&&X.type===E&&X.key===null&&(X=X.props.children),typeof X=="object"&&X!==null){switch(X.$$typeof){case x:e:{for(var Ve=X.key;z!==null;){if(z.key===Ve){if(Ve=X.type,Ve===E){if(z.tag===7){h(Y,z.sibling),he=v(z,X.props.children),he.return=Y,Y=he;break e}}else if(z.elementType===Ve||typeof Ve=="object"&&Ve!==null&&Ve.$$typeof===F&&ja(Ve)===z.type){h(Y,z.sibling),he=v(z,X.props),El(he,X),he.return=Y,Y=he;break e}h(Y,z);break}else o(Y,z);z=z.sibling}X.type===E?(he=Oa(X.props.children,Y.mode,he,X.key),he.return=Y,Y=he):(he=jo(X.type,X.key,X.props,null,Y.mode,he),El(he,X),he.return=Y,Y=he)}return R(Y);case S:e:{for(Ve=X.key;z!==null;){if(z.key===Ve)if(z.tag===4&&z.stateNode.containerInfo===X.containerInfo&&z.stateNode.implementation===X.implementation){h(Y,z.sibling),he=v(z,X.children||[]),he.return=Y,Y=he;break e}else{h(Y,z);break}else o(Y,z);z=z.sibling}he=Td(X,Y.mode,he),he.return=Y,Y=he}return R(Y);case F:return X=ja(X),Nt(Y,z,X,he)}if(de(X))return Pe(Y,z,X,he);if(H(X)){if(Ve=H(X),typeof Ve!="function")throw Error(s(150));return X=Ve.call(X),$e(Y,z,X,he)}if(typeof X.then=="function")return Nt(Y,z,zo(X),he);if(X.$$typeof===_)return Nt(Y,z,Vo(Y,X),he);Ko(Y,X)}return typeof X=="string"&&X!==""||typeof X=="number"||typeof X=="bigint"?(X=""+X,z!==null&&z.tag===6?(h(Y,z.sibling),he=v(z,X),he.return=Y,Y=he):(h(Y,z),he=bd(X,Y.mode,he),he.return=Y,Y=he),R(Y)):h(Y,z)}return function(Y,z,X,he){try{Tl=0;var Ve=Nt(Y,z,X,he);return br=null,Ve}catch(Me){if(Me===Sr||Me===Go)throw Me;var vt=ci(29,Me,null,Y.mode);return vt.lanes=he,vt.return=Y,vt}}}var Ba=Zp(!0),Jp=Zp(!1),sa=!1;function Dd(a){a.updateQueue={baseState:a.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Pd(a,o){a=a.updateQueue,o.updateQueue===a&&(o.updateQueue={baseState:a.baseState,firstBaseUpdate:a.firstBaseUpdate,lastBaseUpdate:a.lastBaseUpdate,shared:a.shared,callbacks:null})}function ia(a){return{lane:a,tag:0,payload:null,callback:null,next:null}}function na(a,o,h){var m=a.updateQueue;if(m===null)return null;if(m=m.shared,(St&2)!==0){var v=m.pending;return v===null?o.next=o:(o.next=v.next,v.next=o),m.pending=o,o=Mo(a),Up(a,null,h),o}return Uo(a,m,o,h),Mo(a)}function Al(a,o,h){if(o=o.updateQueue,o!==null&&(o=o.shared,(h&4194048)!==0)){var m=o.lanes;m&=a.pendingLanes,h|=m,o.lanes=h,xn(a,h)}}function Ud(a,o){var h=a.updateQueue,m=a.alternate;if(m!==null&&(m=m.updateQueue,h===m)){var v=null,b=null;if(h=h.firstBaseUpdate,h!==null){do{var R={lane:h.lane,tag:h.tag,payload:h.payload,callback:null,next:null};b===null?v=b=R:b=b.next=R,h=h.next}while(h!==null);b===null?v=b=o:b=b.next=o}else v=b=o;h={baseState:m.baseState,firstBaseUpdate:v,lastBaseUpdate:b,shared:m.shared,callbacks:m.callbacks},a.updateQueue=h;return}a=h.lastBaseUpdate,a===null?h.firstBaseUpdate=o:a.next=o,h.lastBaseUpdate=o}var Md=!1;function _l(){if(Md){var a=xr;if(a!==null)throw a}}function Il(a,o,h,m){Md=!1;var v=a.updateQueue;sa=!1;var b=v.firstBaseUpdate,R=v.lastBaseUpdate,N=v.shared.pending;if(N!==null){v.shared.pending=null;var B=N,Z=B.next;B.next=null,R===null?b=Z:R.next=Z,R=B;var oe=a.alternate;oe!==null&&(oe=oe.updateQueue,N=oe.lastBaseUpdate,N!==R&&(N===null?oe.firstBaseUpdate=Z:N.next=Z,oe.lastBaseUpdate=B))}if(b!==null){var me=v.baseState;R=0,oe=Z=B=null,N=b;do{var J=N.lane&-536870913,ne=J!==N.lane;if(ne?(ct&J)===J:(m&J)===J){J!==0&&J===vr&&(Md=!0),oe!==null&&(oe=oe.next={lane:0,tag:N.tag,payload:N.payload,callback:null,next:null});e:{var Pe=a,$e=N;J=o;var Nt=h;switch($e.tag){case 1:if(Pe=$e.payload,typeof Pe=="function"){me=Pe.call(Nt,me,J);break e}me=Pe;break e;case 3:Pe.flags=Pe.flags&-65537|128;case 0:if(Pe=$e.payload,J=typeof Pe=="function"?Pe.call(Nt,me,J):Pe,J==null)break e;me=g({},me,J);break e;case 2:sa=!0}}J=N.callback,J!==null&&(a.flags|=64,ne&&(a.flags|=8192),ne=v.callbacks,ne===null?v.callbacks=[J]:ne.push(J))}else ne={lane:J,tag:N.tag,payload:N.payload,callback:N.callback,next:null},oe===null?(Z=oe=ne,B=me):oe=oe.next=ne,R|=J;if(N=N.next,N===null){if(N=v.shared.pending,N===null)break;ne=N,N=ne.next,ne.next=null,v.lastBaseUpdate=ne,v.shared.pending=null}}while(!0);oe===null&&(B=me),v.baseState=B,v.firstBaseUpdate=Z,v.lastBaseUpdate=oe,b===null&&(v.shared.lanes=0),ca|=R,a.lanes=R,a.memoizedState=me}}function eg(a,o){if(typeof a!="function")throw Error(s(191,a));a.call(o)}function tg(a,o){var h=a.callbacks;if(h!==null)for(a.callbacks=null,a=0;a<h.length;a++)eg(h[a],o)}var Tr=P(null),Yo=P(0);function sg(a,o){a=Pn,G(Yo,a),G(Tr,o),Pn=a|o.baseLanes}function jd(){G(Yo,Pn),G(Tr,Tr.current)}function Fd(){Pn=Yo.current,$(Tr),$(Yo)}var ui=P(null),Oi=null;function aa(a){var o=a.alternate;G(ns,ns.current&1),G(ui,a),Oi===null&&(o===null||Tr.current!==null||o.memoizedState!==null)&&(Oi=a)}function Bd(a){G(ns,ns.current),G(ui,a),Oi===null&&(Oi=a)}function ig(a){a.tag===22?(G(ns,ns.current),G(ui,a),Oi===null&&(Oi=a)):ra()}function ra(){G(ns,ns.current),G(ui,ui.current)}function di(a){$(ui),Oi===a&&(Oi=null),$(ns)}var ns=P(0);function qo(a){for(var o=a;o!==null;){if(o.tag===13){var h=o.memoizedState;if(h!==null&&(h=h.dehydrated,h===null||Kh(h)||Yh(h)))return o}else if(o.tag===19&&(o.memoizedProps.revealOrder==="forwards"||o.memoizedProps.revealOrder==="backwards"||o.memoizedProps.revealOrder==="unstable_legacy-backwards"||o.memoizedProps.revealOrder==="together")){if((o.flags&128)!==0)return o}else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===a)break;for(;o.sibling===null;){if(o.return===null||o.return===a)return null;o=o.return}o.sibling.return=o.return,o=o.sibling}return null}var Rn=0,Je=null,Ct=null,hs=null,Qo=!1,Er=!1,Va=!1,Wo=0,Rl=0,Ar=null,vE=0;function Zt(){throw Error(s(321))}function Vd(a,o){if(o===null)return!1;for(var h=0;h<o.length&&h<a.length;h++)if(!oi(a[h],o[h]))return!1;return!0}function $d(a,o,h,m,v,b){return Rn=b,Je=o,o.memoizedState=null,o.updateQueue=null,o.lanes=0,M.H=a===null||a.memoizedState===null?Bg:ih,Va=!1,b=h(m,v),Va=!1,Er&&(b=ag(o,h,m,v)),ng(a),b}function ng(a){M.H=Cl;var o=Ct!==null&&Ct.next!==null;if(Rn=0,hs=Ct=Je=null,Qo=!1,Rl=0,Ar=null,o)throw Error(s(300));a===null||fs||(a=a.dependencies,a!==null&&Bo(a)&&(fs=!0))}function ag(a,o,h,m){Je=a;var v=0;do{if(Er&&(Ar=null),Rl=0,Er=!1,25<=v)throw Error(s(301));if(v+=1,hs=Ct=null,a.updateQueue!=null){var b=a.updateQueue;b.lastEffect=null,b.events=null,b.stores=null,b.memoCache!=null&&(b.memoCache.index=0)}M.H=Vg,b=o(h,m)}while(Er);return b}function xE(){var a=M.H,o=a.useState()[0];return o=typeof o.then=="function"?Ll(o):o,a=a.useState()[0],(Ct!==null?Ct.memoizedState:null)!==a&&(Je.flags|=1024),o}function Gd(){var a=Wo!==0;return Wo=0,a}function Hd(a,o,h){o.updateQueue=a.updateQueue,o.flags&=-2053,a.lanes&=~h}function zd(a){if(Qo){for(a=a.memoizedState;a!==null;){var o=a.queue;o!==null&&(o.pending=null),a=a.next}Qo=!1}Rn=0,hs=Ct=Je=null,Er=!1,Rl=Wo=0,Ar=null}function Fs(){var a={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return hs===null?Je.memoizedState=hs=a:hs=hs.next=a,hs}function as(){if(Ct===null){var a=Je.alternate;a=a!==null?a.memoizedState:null}else a=Ct.next;var o=hs===null?Je.memoizedState:hs.next;if(o!==null)hs=o,Ct=a;else{if(a===null)throw Je.alternate===null?Error(s(467)):Error(s(310));Ct=a,a={memoizedState:Ct.memoizedState,baseState:Ct.baseState,baseQueue:Ct.baseQueue,queue:Ct.queue,next:null},hs===null?Je.memoizedState=hs=a:hs=hs.next=a}return hs}function Xo(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Ll(a){var o=Rl;return Rl+=1,Ar===null&&(Ar=[]),a=Qp(Ar,a,o),o=Je,(hs===null?o.memoizedState:hs.next)===null&&(o=o.alternate,M.H=o===null||o.memoizedState===null?Bg:ih),a}function Zo(a){if(a!==null&&typeof a=="object"){if(typeof a.then=="function")return Ll(a);if(a.$$typeof===_)return Is(a)}throw Error(s(438,String(a)))}function Kd(a){var o=null,h=Je.updateQueue;if(h!==null&&(o=h.memoCache),o==null){var m=Je.alternate;m!==null&&(m=m.updateQueue,m!==null&&(m=m.memoCache,m!=null&&(o={data:m.data.map(function(v){return v.slice()}),index:0})))}if(o==null&&(o={data:[],index:0}),h===null&&(h=Xo(),Je.updateQueue=h),h.memoCache=o,h=o.data[o.index],h===void 0)for(h=o.data[o.index]=Array(a),m=0;m<a;m++)h[m]=U;return o.index++,h}function Ln(a,o){return typeof o=="function"?o(a):o}function Jo(a){var o=as();return Yd(o,Ct,a)}function Yd(a,o,h){var m=a.queue;if(m===null)throw Error(s(311));m.lastRenderedReducer=h;var v=a.baseQueue,b=m.pending;if(b!==null){if(v!==null){var R=v.next;v.next=b.next,b.next=R}o.baseQueue=v=b,m.pending=null}if(b=a.baseState,v===null)a.memoizedState=b;else{o=v.next;var N=R=null,B=null,Z=o,oe=!1;do{var me=Z.lane&-536870913;if(me!==Z.lane?(ct&me)===me:(Rn&me)===me){var J=Z.revertLane;if(J===0)B!==null&&(B=B.next={lane:0,revertLane:0,gesture:null,action:Z.action,hasEagerState:Z.hasEagerState,eagerState:Z.eagerState,next:null}),me===vr&&(oe=!0);else if((Rn&J)===J){Z=Z.next,J===vr&&(oe=!0);continue}else me={lane:0,revertLane:Z.revertLane,gesture:null,action:Z.action,hasEagerState:Z.hasEagerState,eagerState:Z.eagerState,next:null},B===null?(N=B=me,R=b):B=B.next=me,Je.lanes|=J,ca|=J;me=Z.action,Va&&h(b,me),b=Z.hasEagerState?Z.eagerState:h(b,me)}else J={lane:me,revertLane:Z.revertLane,gesture:Z.gesture,action:Z.action,hasEagerState:Z.hasEagerState,eagerState:Z.eagerState,next:null},B===null?(N=B=J,R=b):B=B.next=J,Je.lanes|=me,ca|=me;Z=Z.next}while(Z!==null&&Z!==o);if(B===null?R=b:B.next=N,!oi(b,a.memoizedState)&&(fs=!0,oe&&(h=xr,h!==null)))throw h;a.memoizedState=b,a.baseState=R,a.baseQueue=B,m.lastRenderedState=b}return v===null&&(m.lanes=0),[a.memoizedState,m.dispatch]}function qd(a){var o=as(),h=o.queue;if(h===null)throw Error(s(311));h.lastRenderedReducer=a;var m=h.dispatch,v=h.pending,b=o.memoizedState;if(v!==null){h.pending=null;var R=v=v.next;do b=a(b,R.action),R=R.next;while(R!==v);oi(b,o.memoizedState)||(fs=!0),o.memoizedState=b,o.baseQueue===null&&(o.baseState=b),h.lastRenderedState=b}return[b,m]}function rg(a,o,h){var m=Je,v=as(),b=ft;if(b){if(h===void 0)throw Error(s(407));h=h()}else h=o();var R=!oi((Ct||v).memoizedState,h);if(R&&(v.memoizedState=h,fs=!0),v=v.queue,Xd(cg.bind(null,m,v,a),[a]),v.getSnapshot!==o||R||hs!==null&&hs.memoizedState.tag&1){if(m.flags|=2048,_r(9,{destroy:void 0},og.bind(null,m,v,h,o),null),Dt===null)throw Error(s(349));b||(Rn&127)!==0||lg(m,o,h)}return h}function lg(a,o,h){a.flags|=16384,a={getSnapshot:o,value:h},o=Je.updateQueue,o===null?(o=Xo(),Je.updateQueue=o,o.stores=[a]):(h=o.stores,h===null?o.stores=[a]:h.push(a))}function og(a,o,h,m){o.value=h,o.getSnapshot=m,ug(o)&&dg(a)}function cg(a,o,h){return h(function(){ug(o)&&dg(a)})}function ug(a){var o=a.getSnapshot;a=a.value;try{var h=o();return!oi(a,h)}catch{return!0}}function dg(a){var o=Na(a,2);o!==null&&Ws(o,a,2)}function Qd(a){var o=Fs();if(typeof a=="function"){var h=a;if(a=h(),Va){As(!0);try{h()}finally{As(!1)}}}return o.memoizedState=o.baseState=a,o.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ln,lastRenderedState:a},o}function hg(a,o,h,m){return a.baseState=h,Yd(a,Ct,typeof m=="function"?m:Ln)}function SE(a,o,h,m,v){if(sc(a))throw Error(s(485));if(a=o.action,a!==null){var b={payload:v,action:a,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(R){b.listeners.push(R)}};M.T!==null?h(!0):b.isTransition=!1,m(b),h=o.pending,h===null?(b.next=o.pending=b,fg(o,b)):(b.next=h.next,o.pending=h.next=b)}}function fg(a,o){var h=o.action,m=o.payload,v=a.state;if(o.isTransition){var b=M.T,R={};M.T=R;try{var N=h(v,m),B=M.S;B!==null&&B(R,N),mg(a,o,N)}catch(Z){Wd(a,o,Z)}finally{b!==null&&R.types!==null&&(b.types=R.types),M.T=b}}else try{b=h(v,m),mg(a,o,b)}catch(Z){Wd(a,o,Z)}}function mg(a,o,h){h!==null&&typeof h=="object"&&typeof h.then=="function"?h.then(function(m){pg(a,o,m)},function(m){return Wd(a,o,m)}):pg(a,o,h)}function pg(a,o,h){o.status="fulfilled",o.value=h,gg(o),a.state=h,o=a.pending,o!==null&&(h=o.next,h===o?a.pending=null:(h=h.next,o.next=h,fg(a,h)))}function Wd(a,o,h){var m=a.pending;if(a.pending=null,m!==null){m=m.next;do o.status="rejected",o.reason=h,gg(o),o=o.next;while(o!==m)}a.action=null}function gg(a){a=a.listeners;for(var o=0;o<a.length;o++)(0,a[o])()}function yg(a,o){return o}function vg(a,o){if(ft){var h=Dt.formState;if(h!==null){e:{var m=Je;if(ft){if(jt){t:{for(var v=jt,b=Ni;v.nodeType!==8;){if(!b){v=null;break t}if(v=Di(v.nextSibling),v===null){v=null;break t}}b=v.data,v=b==="F!"||b==="F"?v:null}if(v){jt=Di(v.nextSibling),m=v.data==="F!";break e}}ea(m)}m=!1}m&&(o=h[0])}}return h=Fs(),h.memoizedState=h.baseState=o,m={pending:null,lanes:0,dispatch:null,lastRenderedReducer:yg,lastRenderedState:o},h.queue=m,h=Mg.bind(null,Je,m),m.dispatch=h,m=Qd(!1),b=sh.bind(null,Je,!1,m.queue),m=Fs(),v={state:o,dispatch:null,action:a,pending:null},m.queue=v,h=SE.bind(null,Je,v,b,h),v.dispatch=h,m.memoizedState=a,[o,h,!1]}function xg(a){var o=as();return Sg(o,Ct,a)}function Sg(a,o,h){if(o=Yd(a,o,yg)[0],a=Jo(Ln)[0],typeof o=="object"&&o!==null&&typeof o.then=="function")try{var m=Ll(o)}catch(R){throw R===Sr?Go:R}else m=o;o=as();var v=o.queue,b=v.dispatch;return h!==o.memoizedState&&(Je.flags|=2048,_r(9,{destroy:void 0},bE.bind(null,v,h),null)),[m,b,a]}function bE(a,o){a.action=o}function bg(a){var o=as(),h=Ct;if(h!==null)return Sg(o,h,a);as(),o=o.memoizedState,h=as();var m=h.queue.dispatch;return h.memoizedState=a,[o,m,!1]}function _r(a,o,h,m){return a={tag:a,create:h,deps:m,inst:o,next:null},o=Je.updateQueue,o===null&&(o=Xo(),Je.updateQueue=o),h=o.lastEffect,h===null?o.lastEffect=a.next=a:(m=h.next,h.next=a,a.next=m,o.lastEffect=a),a}function Tg(){return as().memoizedState}function ec(a,o,h,m){var v=Fs();Je.flags|=a,v.memoizedState=_r(1|o,{destroy:void 0},h,m===void 0?null:m)}function tc(a,o,h,m){var v=as();m=m===void 0?null:m;var b=v.memoizedState.inst;Ct!==null&&m!==null&&Vd(m,Ct.memoizedState.deps)?v.memoizedState=_r(o,b,h,m):(Je.flags|=a,v.memoizedState=_r(1|o,b,h,m))}function Eg(a,o){ec(8390656,8,a,o)}function Xd(a,o){tc(2048,8,a,o)}function TE(a){Je.flags|=4;var o=Je.updateQueue;if(o===null)o=Xo(),Je.updateQueue=o,o.events=[a];else{var h=o.events;h===null?o.events=[a]:h.push(a)}}function Ag(a){var o=as().memoizedState;return TE({ref:o,nextImpl:a}),function(){if((St&2)!==0)throw Error(s(440));return o.impl.apply(void 0,arguments)}}function _g(a,o){return tc(4,2,a,o)}function Ig(a,o){return tc(4,4,a,o)}function Rg(a,o){if(typeof o=="function"){a=a();var h=o(a);return function(){typeof h=="function"?h():o(null)}}if(o!=null)return a=a(),o.current=a,function(){o.current=null}}function Lg(a,o,h){h=h!=null?h.concat([a]):null,tc(4,4,Rg.bind(null,o,a),h)}function Zd(){}function wg(a,o){var h=as();o=o===void 0?null:o;var m=h.memoizedState;return o!==null&&Vd(o,m[1])?m[0]:(h.memoizedState=[a,o],a)}function Cg(a,o){var h=as();o=o===void 0?null:o;var m=h.memoizedState;if(o!==null&&Vd(o,m[1]))return m[0];if(m=a(),Va){As(!0);try{a()}finally{As(!1)}}return h.memoizedState=[m,o],m}function Jd(a,o,h){return h===void 0||(Rn&1073741824)!==0&&(ct&261930)===0?a.memoizedState=o:(a.memoizedState=h,a=k0(),Je.lanes|=a,ca|=a,h)}function kg(a,o,h,m){return oi(h,o)?h:Tr.current!==null?(a=Jd(a,h,m),oi(a,o)||(fs=!0),a):(Rn&42)===0||(Rn&1073741824)!==0&&(ct&261930)===0?(fs=!0,a.memoizedState=h):(a=k0(),Je.lanes|=a,ca|=a,o)}function Ng(a,o,h,m,v){var b=V.p;V.p=b!==0&&8>b?b:8;var R=M.T,N={};M.T=N,sh(a,!1,o,h);try{var B=v(),Z=M.S;if(Z!==null&&Z(N,B),B!==null&&typeof B=="object"&&typeof B.then=="function"){var oe=yE(B,m);wl(a,o,oe,mi(a))}else wl(a,o,m,mi(a))}catch(me){wl(a,o,{then:function(){},status:"rejected",reason:me},mi())}finally{V.p=b,R!==null&&N.types!==null&&(R.types=N.types),M.T=R}}function EE(){}function eh(a,o,h,m){if(a.tag!==5)throw Error(s(476));var v=Og(a).queue;Ng(a,v,o,q,h===null?EE:function(){return Dg(a),h(m)})}function Og(a){var o=a.memoizedState;if(o!==null)return o;o={memoizedState:q,baseState:q,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ln,lastRenderedState:q},next:null};var h={};return o.next={memoizedState:h,baseState:h,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ln,lastRenderedState:h},next:null},a.memoizedState=o,a=a.alternate,a!==null&&(a.memoizedState=o),o}function Dg(a){var o=Og(a);o.next===null&&(o=a.alternate.memoizedState),wl(a,o.next.queue,{},mi())}function th(){return Is(Kl)}function Pg(){return as().memoizedState}function Ug(){return as().memoizedState}function AE(a){for(var o=a.return;o!==null;){switch(o.tag){case 24:case 3:var h=mi();a=ia(h);var m=na(o,a,h);m!==null&&(Ws(m,o,h),Al(m,o,h)),o={cache:Cd()},a.payload=o;return}o=o.return}}function _E(a,o,h){var m=mi();h={lane:m,revertLane:0,gesture:null,action:h,hasEagerState:!1,eagerState:null,next:null},sc(a)?jg(o,h):(h=xd(a,o,h,m),h!==null&&(Ws(h,a,m),Fg(h,o,m)))}function Mg(a,o,h){var m=mi();wl(a,o,h,m)}function wl(a,o,h,m){var v={lane:m,revertLane:0,gesture:null,action:h,hasEagerState:!1,eagerState:null,next:null};if(sc(a))jg(o,v);else{var b=a.alternate;if(a.lanes===0&&(b===null||b.lanes===0)&&(b=o.lastRenderedReducer,b!==null))try{var R=o.lastRenderedState,N=b(R,h);if(v.hasEagerState=!0,v.eagerState=N,oi(N,R))return Uo(a,o,v,0),Dt===null&&Po(),!1}catch{}if(h=xd(a,o,v,m),h!==null)return Ws(h,a,m),Fg(h,o,m),!0}return!1}function sh(a,o,h,m){if(m={lane:2,revertLane:Dh(),gesture:null,action:m,hasEagerState:!1,eagerState:null,next:null},sc(a)){if(o)throw Error(s(479))}else o=xd(a,h,m,2),o!==null&&Ws(o,a,2)}function sc(a){var o=a.alternate;return a===Je||o!==null&&o===Je}function jg(a,o){Er=Qo=!0;var h=a.pending;h===null?o.next=o:(o.next=h.next,h.next=o),a.pending=o}function Fg(a,o,h){if((h&4194048)!==0){var m=o.lanes;m&=a.pendingLanes,h|=m,o.lanes=h,xn(a,h)}}var Cl={readContext:Is,use:Zo,useCallback:Zt,useContext:Zt,useEffect:Zt,useImperativeHandle:Zt,useLayoutEffect:Zt,useInsertionEffect:Zt,useMemo:Zt,useReducer:Zt,useRef:Zt,useState:Zt,useDebugValue:Zt,useDeferredValue:Zt,useTransition:Zt,useSyncExternalStore:Zt,useId:Zt,useHostTransitionStatus:Zt,useFormState:Zt,useActionState:Zt,useOptimistic:Zt,useMemoCache:Zt,useCacheRefresh:Zt};Cl.useEffectEvent=Zt;var Bg={readContext:Is,use:Zo,useCallback:function(a,o){return Fs().memoizedState=[a,o===void 0?null:o],a},useContext:Is,useEffect:Eg,useImperativeHandle:function(a,o,h){h=h!=null?h.concat([a]):null,ec(4194308,4,Rg.bind(null,o,a),h)},useLayoutEffect:function(a,o){return ec(4194308,4,a,o)},useInsertionEffect:function(a,o){ec(4,2,a,o)},useMemo:function(a,o){var h=Fs();o=o===void 0?null:o;var m=a();if(Va){As(!0);try{a()}finally{As(!1)}}return h.memoizedState=[m,o],m},useReducer:function(a,o,h){var m=Fs();if(h!==void 0){var v=h(o);if(Va){As(!0);try{h(o)}finally{As(!1)}}}else v=o;return m.memoizedState=m.baseState=v,a={pending:null,lanes:0,dispatch:null,lastRenderedReducer:a,lastRenderedState:v},m.queue=a,a=a.dispatch=_E.bind(null,Je,a),[m.memoizedState,a]},useRef:function(a){var o=Fs();return a={current:a},o.memoizedState=a},useState:function(a){a=Qd(a);var o=a.queue,h=Mg.bind(null,Je,o);return o.dispatch=h,[a.memoizedState,h]},useDebugValue:Zd,useDeferredValue:function(a,o){var h=Fs();return Jd(h,a,o)},useTransition:function(){var a=Qd(!1);return a=Ng.bind(null,Je,a.queue,!0,!1),Fs().memoizedState=a,[!1,a]},useSyncExternalStore:function(a,o,h){var m=Je,v=Fs();if(ft){if(h===void 0)throw Error(s(407));h=h()}else{if(h=o(),Dt===null)throw Error(s(349));(ct&127)!==0||lg(m,o,h)}v.memoizedState=h;var b={value:h,getSnapshot:o};return v.queue=b,Eg(cg.bind(null,m,b,a),[a]),m.flags|=2048,_r(9,{destroy:void 0},og.bind(null,m,b,h,o),null),h},useId:function(){var a=Fs(),o=Dt.identifierPrefix;if(ft){var h=nn,m=sn;h=(m&~(1<<32-Yt(m)-1)).toString(32)+h,o="_"+o+"R_"+h,h=Wo++,0<h&&(o+="H"+h.toString(32)),o+="_"}else h=vE++,o="_"+o+"r_"+h.toString(32)+"_";return a.memoizedState=o},useHostTransitionStatus:th,useFormState:vg,useActionState:vg,useOptimistic:function(a){var o=Fs();o.memoizedState=o.baseState=a;var h={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return o.queue=h,o=sh.bind(null,Je,!0,h),h.dispatch=o,[a,o]},useMemoCache:Kd,useCacheRefresh:function(){return Fs().memoizedState=AE.bind(null,Je)},useEffectEvent:function(a){var o=Fs(),h={impl:a};return o.memoizedState=h,function(){if((St&2)!==0)throw Error(s(440));return h.impl.apply(void 0,arguments)}}},ih={readContext:Is,use:Zo,useCallback:wg,useContext:Is,useEffect:Xd,useImperativeHandle:Lg,useInsertionEffect:_g,useLayoutEffect:Ig,useMemo:Cg,useReducer:Jo,useRef:Tg,useState:function(){return Jo(Ln)},useDebugValue:Zd,useDeferredValue:function(a,o){var h=as();return kg(h,Ct.memoizedState,a,o)},useTransition:function(){var a=Jo(Ln)[0],o=as().memoizedState;return[typeof a=="boolean"?a:Ll(a),o]},useSyncExternalStore:rg,useId:Pg,useHostTransitionStatus:th,useFormState:xg,useActionState:xg,useOptimistic:function(a,o){var h=as();return hg(h,Ct,a,o)},useMemoCache:Kd,useCacheRefresh:Ug};ih.useEffectEvent=Ag;var Vg={readContext:Is,use:Zo,useCallback:wg,useContext:Is,useEffect:Xd,useImperativeHandle:Lg,useInsertionEffect:_g,useLayoutEffect:Ig,useMemo:Cg,useReducer:qd,useRef:Tg,useState:function(){return qd(Ln)},useDebugValue:Zd,useDeferredValue:function(a,o){var h=as();return Ct===null?Jd(h,a,o):kg(h,Ct.memoizedState,a,o)},useTransition:function(){var a=qd(Ln)[0],o=as().memoizedState;return[typeof a=="boolean"?a:Ll(a),o]},useSyncExternalStore:rg,useId:Pg,useHostTransitionStatus:th,useFormState:bg,useActionState:bg,useOptimistic:function(a,o){var h=as();return Ct!==null?hg(h,Ct,a,o):(h.baseState=a,[a,h.queue.dispatch])},useMemoCache:Kd,useCacheRefresh:Ug};Vg.useEffectEvent=Ag;function nh(a,o,h,m){o=a.memoizedState,h=h(m,o),h=h==null?o:g({},o,h),a.memoizedState=h,a.lanes===0&&(a.updateQueue.baseState=h)}var ah={enqueueSetState:function(a,o,h){a=a._reactInternals;var m=mi(),v=ia(m);v.payload=o,h!=null&&(v.callback=h),o=na(a,v,m),o!==null&&(Ws(o,a,m),Al(o,a,m))},enqueueReplaceState:function(a,o,h){a=a._reactInternals;var m=mi(),v=ia(m);v.tag=1,v.payload=o,h!=null&&(v.callback=h),o=na(a,v,m),o!==null&&(Ws(o,a,m),Al(o,a,m))},enqueueForceUpdate:function(a,o){a=a._reactInternals;var h=mi(),m=ia(h);m.tag=2,o!=null&&(m.callback=o),o=na(a,m,h),o!==null&&(Ws(o,a,h),Al(o,a,h))}};function $g(a,o,h,m,v,b,R){return a=a.stateNode,typeof a.shouldComponentUpdate=="function"?a.shouldComponentUpdate(m,b,R):o.prototype&&o.prototype.isPureReactComponent?!gl(h,m)||!gl(v,b):!0}function Gg(a,o,h,m){a=o.state,typeof o.componentWillReceiveProps=="function"&&o.componentWillReceiveProps(h,m),typeof o.UNSAFE_componentWillReceiveProps=="function"&&o.UNSAFE_componentWillReceiveProps(h,m),o.state!==a&&ah.enqueueReplaceState(o,o.state,null)}function $a(a,o){var h=o;if("ref"in o){h={};for(var m in o)m!=="ref"&&(h[m]=o[m])}if(a=a.defaultProps){h===o&&(h=g({},h));for(var v in a)h[v]===void 0&&(h[v]=a[v])}return h}function Hg(a){Do(a)}function zg(a){console.error(a)}function Kg(a){Do(a)}function ic(a,o){try{var h=a.onUncaughtError;h(o.value,{componentStack:o.stack})}catch(m){setTimeout(function(){throw m})}}function Yg(a,o,h){try{var m=a.onCaughtError;m(h.value,{componentStack:h.stack,errorBoundary:o.tag===1?o.stateNode:null})}catch(v){setTimeout(function(){throw v})}}function rh(a,o,h){return h=ia(h),h.tag=3,h.payload={element:null},h.callback=function(){ic(a,o)},h}function qg(a){return a=ia(a),a.tag=3,a}function Qg(a,o,h,m){var v=h.type.getDerivedStateFromError;if(typeof v=="function"){var b=m.value;a.payload=function(){return v(b)},a.callback=function(){Yg(o,h,m)}}var R=h.stateNode;R!==null&&typeof R.componentDidCatch=="function"&&(a.callback=function(){Yg(o,h,m),typeof v!="function"&&(ua===null?ua=new Set([this]):ua.add(this));var N=m.stack;this.componentDidCatch(m.value,{componentStack:N!==null?N:""})})}function IE(a,o,h,m,v){if(h.flags|=32768,m!==null&&typeof m=="object"&&typeof m.then=="function"){if(o=h.alternate,o!==null&&yr(o,h,v,!0),h=ui.current,h!==null){switch(h.tag){case 31:case 13:return Oi===null?pc():h.alternate===null&&Jt===0&&(Jt=3),h.flags&=-257,h.flags|=65536,h.lanes=v,m===Ho?h.flags|=16384:(o=h.updateQueue,o===null?h.updateQueue=new Set([m]):o.add(m),kh(a,m,v)),!1;case 22:return h.flags|=65536,m===Ho?h.flags|=16384:(o=h.updateQueue,o===null?(o={transitions:null,markerInstances:null,retryQueue:new Set([m])},h.updateQueue=o):(h=o.retryQueue,h===null?o.retryQueue=new Set([m]):h.add(m)),kh(a,m,v)),!1}throw Error(s(435,h.tag))}return kh(a,m,v),pc(),!1}if(ft)return o=ui.current,o!==null?((o.flags&65536)===0&&(o.flags|=256),o.flags|=65536,o.lanes=v,m!==_d&&(a=Error(s(422),{cause:m}),xl(wi(a,h)))):(m!==_d&&(o=Error(s(423),{cause:m}),xl(wi(o,h))),a=a.current.alternate,a.flags|=65536,v&=-v,a.lanes|=v,m=wi(m,h),v=rh(a.stateNode,m,v),Ud(a,v),Jt!==4&&(Jt=2)),!1;var b=Error(s(520),{cause:m});if(b=wi(b,h),jl===null?jl=[b]:jl.push(b),Jt!==4&&(Jt=2),o===null)return!0;m=wi(m,h),h=o;do{switch(h.tag){case 3:return h.flags|=65536,a=v&-v,h.lanes|=a,a=rh(h.stateNode,m,a),Ud(h,a),!1;case 1:if(o=h.type,b=h.stateNode,(h.flags&128)===0&&(typeof o.getDerivedStateFromError=="function"||b!==null&&typeof b.componentDidCatch=="function"&&(ua===null||!ua.has(b))))return h.flags|=65536,v&=-v,h.lanes|=v,v=qg(v),Qg(v,a,h,m),Ud(h,v),!1}h=h.return}while(h!==null);return!1}var lh=Error(s(461)),fs=!1;function Rs(a,o,h,m){o.child=a===null?Jp(o,null,h,m):Ba(o,a.child,h,m)}function Wg(a,o,h,m,v){h=h.render;var b=o.ref;if("ref"in m){var R={};for(var N in m)N!=="ref"&&(R[N]=m[N])}else R=m;return Ua(o),m=$d(a,o,h,R,b,v),N=Gd(),a!==null&&!fs?(Hd(a,o,v),wn(a,o,v)):(ft&&N&&Ed(o),o.flags|=1,Rs(a,o,m,v),o.child)}function Xg(a,o,h,m,v){if(a===null){var b=h.type;return typeof b=="function"&&!Sd(b)&&b.defaultProps===void 0&&h.compare===null?(o.tag=15,o.type=b,Zg(a,o,b,m,v)):(a=jo(h.type,null,m,o,o.mode,v),a.ref=o.ref,a.return=o,o.child=a)}if(b=a.child,!ph(a,v)){var R=b.memoizedProps;if(h=h.compare,h=h!==null?h:gl,h(R,m)&&a.ref===o.ref)return wn(a,o,v)}return o.flags|=1,a=En(b,m),a.ref=o.ref,a.return=o,o.child=a}function Zg(a,o,h,m,v){if(a!==null){var b=a.memoizedProps;if(gl(b,m)&&a.ref===o.ref)if(fs=!1,o.pendingProps=m=b,ph(a,v))(a.flags&131072)!==0&&(fs=!0);else return o.lanes=a.lanes,wn(a,o,v)}return oh(a,o,h,m,v)}function Jg(a,o,h,m){var v=m.children,b=a!==null?a.memoizedState:null;if(a===null&&o.stateNode===null&&(o.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),m.mode==="hidden"){if((o.flags&128)!==0){if(b=b!==null?b.baseLanes|h:h,a!==null){for(m=o.child=a.child,v=0;m!==null;)v=v|m.lanes|m.childLanes,m=m.sibling;m=v&~b}else m=0,o.child=null;return e0(a,o,b,h,m)}if((h&536870912)!==0)o.memoizedState={baseLanes:0,cachePool:null},a!==null&&$o(o,b!==null?b.cachePool:null),b!==null?sg(o,b):jd(),ig(o);else return m=o.lanes=536870912,e0(a,o,b!==null?b.baseLanes|h:h,h,m)}else b!==null?($o(o,b.cachePool),sg(o,b),ra(),o.memoizedState=null):(a!==null&&$o(o,null),jd(),ra());return Rs(a,o,v,h),o.child}function kl(a,o){return a!==null&&a.tag===22||o.stateNode!==null||(o.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),o.sibling}function e0(a,o,h,m,v){var b=Nd();return b=b===null?null:{parent:ds._currentValue,pool:b},o.memoizedState={baseLanes:h,cachePool:b},a!==null&&$o(o,null),jd(),ig(o),a!==null&&yr(a,o,m,!0),o.childLanes=v,null}function nc(a,o){return o=rc({mode:o.mode,children:o.children},a.mode),o.ref=a.ref,a.child=o,o.return=a,o}function t0(a,o,h){return Ba(o,a.child,null,h),a=nc(o,o.pendingProps),a.flags|=2,di(o),o.memoizedState=null,a}function RE(a,o,h){var m=o.pendingProps,v=(o.flags&128)!==0;if(o.flags&=-129,a===null){if(ft){if(m.mode==="hidden")return a=nc(o,m),o.lanes=536870912,kl(null,a);if(Bd(o),(a=jt)?(a=fy(a,Ni),a=a!==null&&a.data==="&"?a:null,a!==null&&(o.memoizedState={dehydrated:a,treeContext:Zn!==null?{id:sn,overflow:nn}:null,retryLane:536870912,hydrationErrors:null},h=jp(a),h.return=o,o.child=h,_s=o,jt=null)):a=null,a===null)throw ea(o);return o.lanes=536870912,null}return nc(o,m)}var b=a.memoizedState;if(b!==null){var R=b.dehydrated;if(Bd(o),v)if(o.flags&256)o.flags&=-257,o=t0(a,o,h);else if(o.memoizedState!==null)o.child=a.child,o.flags|=128,o=null;else throw Error(s(558));else if(fs||yr(a,o,h,!1),v=(h&a.childLanes)!==0,fs||v){if(m=Dt,m!==null&&(R=le(m,h),R!==0&&R!==b.retryLane))throw b.retryLane=R,Na(a,R),Ws(m,a,R),lh;pc(),o=t0(a,o,h)}else a=b.treeContext,jt=Di(R.nextSibling),_s=o,ft=!0,Jn=null,Ni=!1,a!==null&&Vp(o,a),o=nc(o,m),o.flags|=4096;return o}return a=En(a.child,{mode:m.mode,children:m.children}),a.ref=o.ref,o.child=a,a.return=o,a}function ac(a,o){var h=o.ref;if(h===null)a!==null&&a.ref!==null&&(o.flags|=4194816);else{if(typeof h!="function"&&typeof h!="object")throw Error(s(284));(a===null||a.ref!==h)&&(o.flags|=4194816)}}function oh(a,o,h,m,v){return Ua(o),h=$d(a,o,h,m,void 0,v),m=Gd(),a!==null&&!fs?(Hd(a,o,v),wn(a,o,v)):(ft&&m&&Ed(o),o.flags|=1,Rs(a,o,h,v),o.child)}function s0(a,o,h,m,v,b){return Ua(o),o.updateQueue=null,h=ag(o,m,h,v),ng(a),m=Gd(),a!==null&&!fs?(Hd(a,o,b),wn(a,o,b)):(ft&&m&&Ed(o),o.flags|=1,Rs(a,o,h,b),o.child)}function i0(a,o,h,m,v){if(Ua(o),o.stateNode===null){var b=fr,R=h.contextType;typeof R=="object"&&R!==null&&(b=Is(R)),b=new h(m,b),o.memoizedState=b.state!==null&&b.state!==void 0?b.state:null,b.updater=ah,o.stateNode=b,b._reactInternals=o,b=o.stateNode,b.props=m,b.state=o.memoizedState,b.refs={},Dd(o),R=h.contextType,b.context=typeof R=="object"&&R!==null?Is(R):fr,b.state=o.memoizedState,R=h.getDerivedStateFromProps,typeof R=="function"&&(nh(o,h,R,m),b.state=o.memoizedState),typeof h.getDerivedStateFromProps=="function"||typeof b.getSnapshotBeforeUpdate=="function"||typeof b.UNSAFE_componentWillMount!="function"&&typeof b.componentWillMount!="function"||(R=b.state,typeof b.componentWillMount=="function"&&b.componentWillMount(),typeof b.UNSAFE_componentWillMount=="function"&&b.UNSAFE_componentWillMount(),R!==b.state&&ah.enqueueReplaceState(b,b.state,null),Il(o,m,b,v),_l(),b.state=o.memoizedState),typeof b.componentDidMount=="function"&&(o.flags|=4194308),m=!0}else if(a===null){b=o.stateNode;var N=o.memoizedProps,B=$a(h,N);b.props=B;var Z=b.context,oe=h.contextType;R=fr,typeof oe=="object"&&oe!==null&&(R=Is(oe));var me=h.getDerivedStateFromProps;oe=typeof me=="function"||typeof b.getSnapshotBeforeUpdate=="function",N=o.pendingProps!==N,oe||typeof b.UNSAFE_componentWillReceiveProps!="function"&&typeof b.componentWillReceiveProps!="function"||(N||Z!==R)&&Gg(o,b,m,R),sa=!1;var J=o.memoizedState;b.state=J,Il(o,m,b,v),_l(),Z=o.memoizedState,N||J!==Z||sa?(typeof me=="function"&&(nh(o,h,me,m),Z=o.memoizedState),(B=sa||$g(o,h,B,m,J,Z,R))?(oe||typeof b.UNSAFE_componentWillMount!="function"&&typeof b.componentWillMount!="function"||(typeof b.componentWillMount=="function"&&b.componentWillMount(),typeof b.UNSAFE_componentWillMount=="function"&&b.UNSAFE_componentWillMount()),typeof b.componentDidMount=="function"&&(o.flags|=4194308)):(typeof b.componentDidMount=="function"&&(o.flags|=4194308),o.memoizedProps=m,o.memoizedState=Z),b.props=m,b.state=Z,b.context=R,m=B):(typeof b.componentDidMount=="function"&&(o.flags|=4194308),m=!1)}else{b=o.stateNode,Pd(a,o),R=o.memoizedProps,oe=$a(h,R),b.props=oe,me=o.pendingProps,J=b.context,Z=h.contextType,B=fr,typeof Z=="object"&&Z!==null&&(B=Is(Z)),N=h.getDerivedStateFromProps,(Z=typeof N=="function"||typeof b.getSnapshotBeforeUpdate=="function")||typeof b.UNSAFE_componentWillReceiveProps!="function"&&typeof b.componentWillReceiveProps!="function"||(R!==me||J!==B)&&Gg(o,b,m,B),sa=!1,J=o.memoizedState,b.state=J,Il(o,m,b,v),_l();var ne=o.memoizedState;R!==me||J!==ne||sa||a!==null&&a.dependencies!==null&&Bo(a.dependencies)?(typeof N=="function"&&(nh(o,h,N,m),ne=o.memoizedState),(oe=sa||$g(o,h,oe,m,J,ne,B)||a!==null&&a.dependencies!==null&&Bo(a.dependencies))?(Z||typeof b.UNSAFE_componentWillUpdate!="function"&&typeof b.componentWillUpdate!="function"||(typeof b.componentWillUpdate=="function"&&b.componentWillUpdate(m,ne,B),typeof b.UNSAFE_componentWillUpdate=="function"&&b.UNSAFE_componentWillUpdate(m,ne,B)),typeof b.componentDidUpdate=="function"&&(o.flags|=4),typeof b.getSnapshotBeforeUpdate=="function"&&(o.flags|=1024)):(typeof b.componentDidUpdate!="function"||R===a.memoizedProps&&J===a.memoizedState||(o.flags|=4),typeof b.getSnapshotBeforeUpdate!="function"||R===a.memoizedProps&&J===a.memoizedState||(o.flags|=1024),o.memoizedProps=m,o.memoizedState=ne),b.props=m,b.state=ne,b.context=B,m=oe):(typeof b.componentDidUpdate!="function"||R===a.memoizedProps&&J===a.memoizedState||(o.flags|=4),typeof b.getSnapshotBeforeUpdate!="function"||R===a.memoizedProps&&J===a.memoizedState||(o.flags|=1024),m=!1)}return b=m,ac(a,o),m=(o.flags&128)!==0,b||m?(b=o.stateNode,h=m&&typeof h.getDerivedStateFromError!="function"?null:b.render(),o.flags|=1,a!==null&&m?(o.child=Ba(o,a.child,null,v),o.child=Ba(o,null,h,v)):Rs(a,o,h,v),o.memoizedState=b.state,a=o.child):a=wn(a,o,v),a}function n0(a,o,h,m){return Da(),o.flags|=256,Rs(a,o,h,m),o.child}var ch={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function uh(a){return{baseLanes:a,cachePool:Yp()}}function dh(a,o,h){return a=a!==null?a.childLanes&~h:0,o&&(a|=fi),a}function a0(a,o,h){var m=o.pendingProps,v=!1,b=(o.flags&128)!==0,R;if((R=b)||(R=a!==null&&a.memoizedState===null?!1:(ns.current&2)!==0),R&&(v=!0,o.flags&=-129),R=(o.flags&32)!==0,o.flags&=-33,a===null){if(ft){if(v?aa(o):ra(),(a=jt)?(a=fy(a,Ni),a=a!==null&&a.data!=="&"?a:null,a!==null&&(o.memoizedState={dehydrated:a,treeContext:Zn!==null?{id:sn,overflow:nn}:null,retryLane:536870912,hydrationErrors:null},h=jp(a),h.return=o,o.child=h,_s=o,jt=null)):a=null,a===null)throw ea(o);return Yh(a)?o.lanes=32:o.lanes=536870912,null}var N=m.children;return m=m.fallback,v?(ra(),v=o.mode,N=rc({mode:"hidden",children:N},v),m=Oa(m,v,h,null),N.return=o,m.return=o,N.sibling=m,o.child=N,m=o.child,m.memoizedState=uh(h),m.childLanes=dh(a,R,h),o.memoizedState=ch,kl(null,m)):(aa(o),hh(o,N))}var B=a.memoizedState;if(B!==null&&(N=B.dehydrated,N!==null)){if(b)o.flags&256?(aa(o),o.flags&=-257,o=fh(a,o,h)):o.memoizedState!==null?(ra(),o.child=a.child,o.flags|=128,o=null):(ra(),N=m.fallback,v=o.mode,m=rc({mode:"visible",children:m.children},v),N=Oa(N,v,h,null),N.flags|=2,m.return=o,N.return=o,m.sibling=N,o.child=m,Ba(o,a.child,null,h),m=o.child,m.memoizedState=uh(h),m.childLanes=dh(a,R,h),o.memoizedState=ch,o=kl(null,m));else if(aa(o),Yh(N)){if(R=N.nextSibling&&N.nextSibling.dataset,R)var Z=R.dgst;R=Z,m=Error(s(419)),m.stack="",m.digest=R,xl({value:m,source:null,stack:null}),o=fh(a,o,h)}else if(fs||yr(a,o,h,!1),R=(h&a.childLanes)!==0,fs||R){if(R=Dt,R!==null&&(m=le(R,h),m!==0&&m!==B.retryLane))throw B.retryLane=m,Na(a,m),Ws(R,a,m),lh;Kh(N)||pc(),o=fh(a,o,h)}else Kh(N)?(o.flags|=192,o.child=a.child,o=null):(a=B.treeContext,jt=Di(N.nextSibling),_s=o,ft=!0,Jn=null,Ni=!1,a!==null&&Vp(o,a),o=hh(o,m.children),o.flags|=4096);return o}return v?(ra(),N=m.fallback,v=o.mode,B=a.child,Z=B.sibling,m=En(B,{mode:"hidden",children:m.children}),m.subtreeFlags=B.subtreeFlags&65011712,Z!==null?N=En(Z,N):(N=Oa(N,v,h,null),N.flags|=2),N.return=o,m.return=o,m.sibling=N,o.child=m,kl(null,m),m=o.child,N=a.child.memoizedState,N===null?N=uh(h):(v=N.cachePool,v!==null?(B=ds._currentValue,v=v.parent!==B?{parent:B,pool:B}:v):v=Yp(),N={baseLanes:N.baseLanes|h,cachePool:v}),m.memoizedState=N,m.childLanes=dh(a,R,h),o.memoizedState=ch,kl(a.child,m)):(aa(o),h=a.child,a=h.sibling,h=En(h,{mode:"visible",children:m.children}),h.return=o,h.sibling=null,a!==null&&(R=o.deletions,R===null?(o.deletions=[a],o.flags|=16):R.push(a)),o.child=h,o.memoizedState=null,h)}function hh(a,o){return o=rc({mode:"visible",children:o},a.mode),o.return=a,a.child=o}function rc(a,o){return a=ci(22,a,null,o),a.lanes=0,a}function fh(a,o,h){return Ba(o,a.child,null,h),a=hh(o,o.pendingProps.children),a.flags|=2,o.memoizedState=null,a}function r0(a,o,h){a.lanes|=o;var m=a.alternate;m!==null&&(m.lanes|=o),Ld(a.return,o,h)}function mh(a,o,h,m,v,b){var R=a.memoizedState;R===null?a.memoizedState={isBackwards:o,rendering:null,renderingStartTime:0,last:m,tail:h,tailMode:v,treeForkCount:b}:(R.isBackwards=o,R.rendering=null,R.renderingStartTime=0,R.last=m,R.tail=h,R.tailMode=v,R.treeForkCount=b)}function l0(a,o,h){var m=o.pendingProps,v=m.revealOrder,b=m.tail;m=m.children;var R=ns.current,N=(R&2)!==0;if(N?(R=R&1|2,o.flags|=128):R&=1,G(ns,R),Rs(a,o,m,h),m=ft?vl:0,!N&&a!==null&&(a.flags&128)!==0)e:for(a=o.child;a!==null;){if(a.tag===13)a.memoizedState!==null&&r0(a,h,o);else if(a.tag===19)r0(a,h,o);else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===o)break e;for(;a.sibling===null;){if(a.return===null||a.return===o)break e;a=a.return}a.sibling.return=a.return,a=a.sibling}switch(v){case"forwards":for(h=o.child,v=null;h!==null;)a=h.alternate,a!==null&&qo(a)===null&&(v=h),h=h.sibling;h=v,h===null?(v=o.child,o.child=null):(v=h.sibling,h.sibling=null),mh(o,!1,v,h,b,m);break;case"backwards":case"unstable_legacy-backwards":for(h=null,v=o.child,o.child=null;v!==null;){if(a=v.alternate,a!==null&&qo(a)===null){o.child=v;break}a=v.sibling,v.sibling=h,h=v,v=a}mh(o,!0,h,null,b,m);break;case"together":mh(o,!1,null,null,void 0,m);break;default:o.memoizedState=null}return o.child}function wn(a,o,h){if(a!==null&&(o.dependencies=a.dependencies),ca|=o.lanes,(h&o.childLanes)===0)if(a!==null){if(yr(a,o,h,!1),(h&o.childLanes)===0)return null}else return null;if(a!==null&&o.child!==a.child)throw Error(s(153));if(o.child!==null){for(a=o.child,h=En(a,a.pendingProps),o.child=h,h.return=o;a.sibling!==null;)a=a.sibling,h=h.sibling=En(a,a.pendingProps),h.return=o;h.sibling=null}return o.child}function ph(a,o){return(a.lanes&o)!==0?!0:(a=a.dependencies,!!(a!==null&&Bo(a)))}function LE(a,o,h){switch(o.tag){case 3:Ge(o,o.stateNode.containerInfo),ta(o,ds,a.memoizedState.cache),Da();break;case 27:case 5:pt(o);break;case 4:Ge(o,o.stateNode.containerInfo);break;case 10:ta(o,o.type,o.memoizedProps.value);break;case 31:if(o.memoizedState!==null)return o.flags|=128,Bd(o),null;break;case 13:var m=o.memoizedState;if(m!==null)return m.dehydrated!==null?(aa(o),o.flags|=128,null):(h&o.child.childLanes)!==0?a0(a,o,h):(aa(o),a=wn(a,o,h),a!==null?a.sibling:null);aa(o);break;case 19:var v=(a.flags&128)!==0;if(m=(h&o.childLanes)!==0,m||(yr(a,o,h,!1),m=(h&o.childLanes)!==0),v){if(m)return l0(a,o,h);o.flags|=128}if(v=o.memoizedState,v!==null&&(v.rendering=null,v.tail=null,v.lastEffect=null),G(ns,ns.current),m)break;return null;case 22:return o.lanes=0,Jg(a,o,h,o.pendingProps);case 24:ta(o,ds,a.memoizedState.cache)}return wn(a,o,h)}function o0(a,o,h){if(a!==null)if(a.memoizedProps!==o.pendingProps)fs=!0;else{if(!ph(a,h)&&(o.flags&128)===0)return fs=!1,LE(a,o,h);fs=(a.flags&131072)!==0}else fs=!1,ft&&(o.flags&1048576)!==0&&Bp(o,vl,o.index);switch(o.lanes=0,o.tag){case 16:e:{var m=o.pendingProps;if(a=ja(o.elementType),o.type=a,typeof a=="function")Sd(a)?(m=$a(a,m),o.tag=1,o=i0(null,o,a,m,h)):(o.tag=0,o=oh(null,o,a,m,h));else{if(a!=null){var v=a.$$typeof;if(v===C){o.tag=11,o=Wg(null,o,a,m,h);break e}else if(v===O){o.tag=14,o=Xg(null,o,a,m,h);break e}}throw o=re(a)||a,Error(s(306,o,""))}}return o;case 0:return oh(a,o,o.type,o.pendingProps,h);case 1:return m=o.type,v=$a(m,o.pendingProps),i0(a,o,m,v,h);case 3:e:{if(Ge(o,o.stateNode.containerInfo),a===null)throw Error(s(387));m=o.pendingProps;var b=o.memoizedState;v=b.element,Pd(a,o),Il(o,m,null,h);var R=o.memoizedState;if(m=R.cache,ta(o,ds,m),m!==b.cache&&wd(o,[ds],h,!0),_l(),m=R.element,b.isDehydrated)if(b={element:m,isDehydrated:!1,cache:R.cache},o.updateQueue.baseState=b,o.memoizedState=b,o.flags&256){o=n0(a,o,m,h);break e}else if(m!==v){v=wi(Error(s(424)),o),xl(v),o=n0(a,o,m,h);break e}else for(a=o.stateNode.containerInfo,a.nodeType===9?a=a.body:a=a.nodeName==="HTML"?a.ownerDocument.body:a,jt=Di(a.firstChild),_s=o,ft=!0,Jn=null,Ni=!0,h=Jp(o,null,m,h),o.child=h;h;)h.flags=h.flags&-3|4096,h=h.sibling;else{if(Da(),m===v){o=wn(a,o,h);break e}Rs(a,o,m,h)}o=o.child}return o;case 26:return ac(a,o),a===null?(h=xy(o.type,null,o.pendingProps,null))?o.memoizedState=h:ft||(h=o.type,a=o.pendingProps,m=Tc(_e.current).createElement(h),m[_t]=o,m[mt]=a,Ls(m,h,a),is(m),o.stateNode=m):o.memoizedState=xy(o.type,a.memoizedProps,o.pendingProps,a.memoizedState),null;case 27:return pt(o),a===null&&ft&&(m=o.stateNode=gy(o.type,o.pendingProps,_e.current),_s=o,Ni=!0,v=jt,ma(o.type)?(qh=v,jt=Di(m.firstChild)):jt=v),Rs(a,o,o.pendingProps.children,h),ac(a,o),a===null&&(o.flags|=4194304),o.child;case 5:return a===null&&ft&&((v=m=jt)&&(m=nA(m,o.type,o.pendingProps,Ni),m!==null?(o.stateNode=m,_s=o,jt=Di(m.firstChild),Ni=!1,v=!0):v=!1),v||ea(o)),pt(o),v=o.type,b=o.pendingProps,R=a!==null?a.memoizedProps:null,m=b.children,Gh(v,b)?m=null:R!==null&&Gh(v,R)&&(o.flags|=32),o.memoizedState!==null&&(v=$d(a,o,xE,null,null,h),Kl._currentValue=v),ac(a,o),Rs(a,o,m,h),o.child;case 6:return a===null&&ft&&((a=h=jt)&&(h=aA(h,o.pendingProps,Ni),h!==null?(o.stateNode=h,_s=o,jt=null,a=!0):a=!1),a||ea(o)),null;case 13:return a0(a,o,h);case 4:return Ge(o,o.stateNode.containerInfo),m=o.pendingProps,a===null?o.child=Ba(o,null,m,h):Rs(a,o,m,h),o.child;case 11:return Wg(a,o,o.type,o.pendingProps,h);case 7:return Rs(a,o,o.pendingProps,h),o.child;case 8:return Rs(a,o,o.pendingProps.children,h),o.child;case 12:return Rs(a,o,o.pendingProps.children,h),o.child;case 10:return m=o.pendingProps,ta(o,o.type,m.value),Rs(a,o,m.children,h),o.child;case 9:return v=o.type._context,m=o.pendingProps.children,Ua(o),v=Is(v),m=m(v),o.flags|=1,Rs(a,o,m,h),o.child;case 14:return Xg(a,o,o.type,o.pendingProps,h);case 15:return Zg(a,o,o.type,o.pendingProps,h);case 19:return l0(a,o,h);case 31:return RE(a,o,h);case 22:return Jg(a,o,h,o.pendingProps);case 24:return Ua(o),m=Is(ds),a===null?(v=Nd(),v===null&&(v=Dt,b=Cd(),v.pooledCache=b,b.refCount++,b!==null&&(v.pooledCacheLanes|=h),v=b),o.memoizedState={parent:m,cache:v},Dd(o),ta(o,ds,v)):((a.lanes&h)!==0&&(Pd(a,o),Il(o,null,null,h),_l()),v=a.memoizedState,b=o.memoizedState,v.parent!==m?(v={parent:m,cache:m},o.memoizedState=v,o.lanes===0&&(o.memoizedState=o.updateQueue.baseState=v),ta(o,ds,m)):(m=b.cache,ta(o,ds,m),m!==v.cache&&wd(o,[ds],h,!0))),Rs(a,o,o.pendingProps.children,h),o.child;case 29:throw o.pendingProps}throw Error(s(156,o.tag))}function Cn(a){a.flags|=4}function gh(a,o,h,m,v){if((o=(a.mode&32)!==0)&&(o=!1),o){if(a.flags|=16777216,(v&335544128)===v)if(a.stateNode.complete)a.flags|=8192;else if(P0())a.flags|=8192;else throw Fa=Ho,Od}else a.flags&=-16777217}function c0(a,o){if(o.type!=="stylesheet"||(o.state.loading&4)!==0)a.flags&=-16777217;else if(a.flags|=16777216,!Ay(o))if(P0())a.flags|=8192;else throw Fa=Ho,Od}function lc(a,o){o!==null&&(a.flags|=4),a.flags&16384&&(o=a.tag!==22?Ii():536870912,a.lanes|=o,wr|=o)}function Nl(a,o){if(!ft)switch(a.tailMode){case"hidden":o=a.tail;for(var h=null;o!==null;)o.alternate!==null&&(h=o),o=o.sibling;h===null?a.tail=null:h.sibling=null;break;case"collapsed":h=a.tail;for(var m=null;h!==null;)h.alternate!==null&&(m=h),h=h.sibling;m===null?o||a.tail===null?a.tail=null:a.tail.sibling=null:m.sibling=null}}function Ft(a){var o=a.alternate!==null&&a.alternate.child===a.child,h=0,m=0;if(o)for(var v=a.child;v!==null;)h|=v.lanes|v.childLanes,m|=v.subtreeFlags&65011712,m|=v.flags&65011712,v.return=a,v=v.sibling;else for(v=a.child;v!==null;)h|=v.lanes|v.childLanes,m|=v.subtreeFlags,m|=v.flags,v.return=a,v=v.sibling;return a.subtreeFlags|=m,a.childLanes=h,o}function wE(a,o,h){var m=o.pendingProps;switch(Ad(o),o.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ft(o),null;case 1:return Ft(o),null;case 3:return h=o.stateNode,m=null,a!==null&&(m=a.memoizedState.cache),o.memoizedState.cache!==m&&(o.flags|=2048),In(ds),Be(),h.pendingContext&&(h.context=h.pendingContext,h.pendingContext=null),(a===null||a.child===null)&&(gr(o)?Cn(o):a===null||a.memoizedState.isDehydrated&&(o.flags&256)===0||(o.flags|=1024,Id())),Ft(o),null;case 26:var v=o.type,b=o.memoizedState;return a===null?(Cn(o),b!==null?(Ft(o),c0(o,b)):(Ft(o),gh(o,v,null,m,h))):b?b!==a.memoizedState?(Cn(o),Ft(o),c0(o,b)):(Ft(o),o.flags&=-16777217):(a=a.memoizedProps,a!==m&&Cn(o),Ft(o),gh(o,v,a,m,h)),null;case 27:if(At(o),h=_e.current,v=o.type,a!==null&&o.stateNode!=null)a.memoizedProps!==m&&Cn(o);else{if(!m){if(o.stateNode===null)throw Error(s(166));return Ft(o),null}a=fe.current,gr(o)?$p(o):(a=gy(v,m,h),o.stateNode=a,Cn(o))}return Ft(o),null;case 5:if(At(o),v=o.type,a!==null&&o.stateNode!=null)a.memoizedProps!==m&&Cn(o);else{if(!m){if(o.stateNode===null)throw Error(s(166));return Ft(o),null}if(b=fe.current,gr(o))$p(o);else{var R=Tc(_e.current);switch(b){case 1:b=R.createElementNS("http://www.w3.org/2000/svg",v);break;case 2:b=R.createElementNS("http://www.w3.org/1998/Math/MathML",v);break;default:switch(v){case"svg":b=R.createElementNS("http://www.w3.org/2000/svg",v);break;case"math":b=R.createElementNS("http://www.w3.org/1998/Math/MathML",v);break;case"script":b=R.createElement("div"),b.innerHTML="<script><\/script>",b=b.removeChild(b.firstChild);break;case"select":b=typeof m.is=="string"?R.createElement("select",{is:m.is}):R.createElement("select"),m.multiple?b.multiple=!0:m.size&&(b.size=m.size);break;default:b=typeof m.is=="string"?R.createElement(v,{is:m.is}):R.createElement(v)}}b[_t]=o,b[mt]=m;e:for(R=o.child;R!==null;){if(R.tag===5||R.tag===6)b.appendChild(R.stateNode);else if(R.tag!==4&&R.tag!==27&&R.child!==null){R.child.return=R,R=R.child;continue}if(R===o)break e;for(;R.sibling===null;){if(R.return===null||R.return===o)break e;R=R.return}R.sibling.return=R.return,R=R.sibling}o.stateNode=b;e:switch(Ls(b,v,m),v){case"button":case"input":case"select":case"textarea":m=!!m.autoFocus;break e;case"img":m=!0;break e;default:m=!1}m&&Cn(o)}}return Ft(o),gh(o,o.type,a===null?null:a.memoizedProps,o.pendingProps,h),null;case 6:if(a&&o.stateNode!=null)a.memoizedProps!==m&&Cn(o);else{if(typeof m!="string"&&o.stateNode===null)throw Error(s(166));if(a=_e.current,gr(o)){if(a=o.stateNode,h=o.memoizedProps,m=null,v=_s,v!==null)switch(v.tag){case 27:case 5:m=v.memoizedProps}a[_t]=o,a=!!(a.nodeValue===h||m!==null&&m.suppressHydrationWarning===!0||ay(a.nodeValue,h)),a||ea(o,!0)}else a=Tc(a).createTextNode(m),a[_t]=o,o.stateNode=a}return Ft(o),null;case 31:if(h=o.memoizedState,a===null||a.memoizedState!==null){if(m=gr(o),h!==null){if(a===null){if(!m)throw Error(s(318));if(a=o.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(s(557));a[_t]=o}else Da(),(o.flags&128)===0&&(o.memoizedState=null),o.flags|=4;Ft(o),a=!1}else h=Id(),a!==null&&a.memoizedState!==null&&(a.memoizedState.hydrationErrors=h),a=!0;if(!a)return o.flags&256?(di(o),o):(di(o),null);if((o.flags&128)!==0)throw Error(s(558))}return Ft(o),null;case 13:if(m=o.memoizedState,a===null||a.memoizedState!==null&&a.memoizedState.dehydrated!==null){if(v=gr(o),m!==null&&m.dehydrated!==null){if(a===null){if(!v)throw Error(s(318));if(v=o.memoizedState,v=v!==null?v.dehydrated:null,!v)throw Error(s(317));v[_t]=o}else Da(),(o.flags&128)===0&&(o.memoizedState=null),o.flags|=4;Ft(o),v=!1}else v=Id(),a!==null&&a.memoizedState!==null&&(a.memoizedState.hydrationErrors=v),v=!0;if(!v)return o.flags&256?(di(o),o):(di(o),null)}return di(o),(o.flags&128)!==0?(o.lanes=h,o):(h=m!==null,a=a!==null&&a.memoizedState!==null,h&&(m=o.child,v=null,m.alternate!==null&&m.alternate.memoizedState!==null&&m.alternate.memoizedState.cachePool!==null&&(v=m.alternate.memoizedState.cachePool.pool),b=null,m.memoizedState!==null&&m.memoizedState.cachePool!==null&&(b=m.memoizedState.cachePool.pool),b!==v&&(m.flags|=2048)),h!==a&&h&&(o.child.flags|=8192),lc(o,o.updateQueue),Ft(o),null);case 4:return Be(),a===null&&jh(o.stateNode.containerInfo),Ft(o),null;case 10:return In(o.type),Ft(o),null;case 19:if($(ns),m=o.memoizedState,m===null)return Ft(o),null;if(v=(o.flags&128)!==0,b=m.rendering,b===null)if(v)Nl(m,!1);else{if(Jt!==0||a!==null&&(a.flags&128)!==0)for(a=o.child;a!==null;){if(b=qo(a),b!==null){for(o.flags|=128,Nl(m,!1),a=b.updateQueue,o.updateQueue=a,lc(o,a),o.subtreeFlags=0,a=h,h=o.child;h!==null;)Mp(h,a),h=h.sibling;return G(ns,ns.current&1|2),ft&&An(o,m.treeForkCount),o.child}a=a.sibling}m.tail!==null&&rt()>hc&&(o.flags|=128,v=!0,Nl(m,!1),o.lanes=4194304)}else{if(!v)if(a=qo(b),a!==null){if(o.flags|=128,v=!0,a=a.updateQueue,o.updateQueue=a,lc(o,a),Nl(m,!0),m.tail===null&&m.tailMode==="hidden"&&!b.alternate&&!ft)return Ft(o),null}else 2*rt()-m.renderingStartTime>hc&&h!==536870912&&(o.flags|=128,v=!0,Nl(m,!1),o.lanes=4194304);m.isBackwards?(b.sibling=o.child,o.child=b):(a=m.last,a!==null?a.sibling=b:o.child=b,m.last=b)}return m.tail!==null?(a=m.tail,m.rendering=a,m.tail=a.sibling,m.renderingStartTime=rt(),a.sibling=null,h=ns.current,G(ns,v?h&1|2:h&1),ft&&An(o,m.treeForkCount),a):(Ft(o),null);case 22:case 23:return di(o),Fd(),m=o.memoizedState!==null,a!==null?a.memoizedState!==null!==m&&(o.flags|=8192):m&&(o.flags|=8192),m?(h&536870912)!==0&&(o.flags&128)===0&&(Ft(o),o.subtreeFlags&6&&(o.flags|=8192)):Ft(o),h=o.updateQueue,h!==null&&lc(o,h.retryQueue),h=null,a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(h=a.memoizedState.cachePool.pool),m=null,o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(m=o.memoizedState.cachePool.pool),m!==h&&(o.flags|=2048),a!==null&&$(Ma),null;case 24:return h=null,a!==null&&(h=a.memoizedState.cache),o.memoizedState.cache!==h&&(o.flags|=2048),In(ds),Ft(o),null;case 25:return null;case 30:return null}throw Error(s(156,o.tag))}function CE(a,o){switch(Ad(o),o.tag){case 1:return a=o.flags,a&65536?(o.flags=a&-65537|128,o):null;case 3:return In(ds),Be(),a=o.flags,(a&65536)!==0&&(a&128)===0?(o.flags=a&-65537|128,o):null;case 26:case 27:case 5:return At(o),null;case 31:if(o.memoizedState!==null){if(di(o),o.alternate===null)throw Error(s(340));Da()}return a=o.flags,a&65536?(o.flags=a&-65537|128,o):null;case 13:if(di(o),a=o.memoizedState,a!==null&&a.dehydrated!==null){if(o.alternate===null)throw Error(s(340));Da()}return a=o.flags,a&65536?(o.flags=a&-65537|128,o):null;case 19:return $(ns),null;case 4:return Be(),null;case 10:return In(o.type),null;case 22:case 23:return di(o),Fd(),a!==null&&$(Ma),a=o.flags,a&65536?(o.flags=a&-65537|128,o):null;case 24:return In(ds),null;case 25:return null;default:return null}}function u0(a,o){switch(Ad(o),o.tag){case 3:In(ds),Be();break;case 26:case 27:case 5:At(o);break;case 4:Be();break;case 31:o.memoizedState!==null&&di(o);break;case 13:di(o);break;case 19:$(ns);break;case 10:In(o.type);break;case 22:case 23:di(o),Fd(),a!==null&&$(Ma);break;case 24:In(ds)}}function Ol(a,o){try{var h=o.updateQueue,m=h!==null?h.lastEffect:null;if(m!==null){var v=m.next;h=v;do{if((h.tag&a)===a){m=void 0;var b=h.create,R=h.inst;m=b(),R.destroy=m}h=h.next}while(h!==v)}}catch(N){Rt(o,o.return,N)}}function la(a,o,h){try{var m=o.updateQueue,v=m!==null?m.lastEffect:null;if(v!==null){var b=v.next;m=b;do{if((m.tag&a)===a){var R=m.inst,N=R.destroy;if(N!==void 0){R.destroy=void 0,v=o;var B=h,Z=N;try{Z()}catch(oe){Rt(v,B,oe)}}}m=m.next}while(m!==b)}}catch(oe){Rt(o,o.return,oe)}}function d0(a){var o=a.updateQueue;if(o!==null){var h=a.stateNode;try{tg(o,h)}catch(m){Rt(a,a.return,m)}}}function h0(a,o,h){h.props=$a(a.type,a.memoizedProps),h.state=a.memoizedState;try{h.componentWillUnmount()}catch(m){Rt(a,o,m)}}function Dl(a,o){try{var h=a.ref;if(h!==null){switch(a.tag){case 26:case 27:case 5:var m=a.stateNode;break;case 30:m=a.stateNode;break;default:m=a.stateNode}typeof h=="function"?a.refCleanup=h(m):h.current=m}}catch(v){Rt(a,o,v)}}function an(a,o){var h=a.ref,m=a.refCleanup;if(h!==null)if(typeof m=="function")try{m()}catch(v){Rt(a,o,v)}finally{a.refCleanup=null,a=a.alternate,a!=null&&(a.refCleanup=null)}else if(typeof h=="function")try{h(null)}catch(v){Rt(a,o,v)}else h.current=null}function f0(a){var o=a.type,h=a.memoizedProps,m=a.stateNode;try{e:switch(o){case"button":case"input":case"select":case"textarea":h.autoFocus&&m.focus();break e;case"img":h.src?m.src=h.src:h.srcSet&&(m.srcset=h.srcSet)}}catch(v){Rt(a,a.return,v)}}function yh(a,o,h){try{var m=a.stateNode;ZE(m,a.type,h,o),m[mt]=o}catch(v){Rt(a,a.return,v)}}function m0(a){return a.tag===5||a.tag===3||a.tag===26||a.tag===27&&ma(a.type)||a.tag===4}function vh(a){e:for(;;){for(;a.sibling===null;){if(a.return===null||m0(a.return))return null;a=a.return}for(a.sibling.return=a.return,a=a.sibling;a.tag!==5&&a.tag!==6&&a.tag!==18;){if(a.tag===27&&ma(a.type)||a.flags&2||a.child===null||a.tag===4)continue e;a.child.return=a,a=a.child}if(!(a.flags&2))return a.stateNode}}function xh(a,o,h){var m=a.tag;if(m===5||m===6)a=a.stateNode,o?(h.nodeType===9?h.body:h.nodeName==="HTML"?h.ownerDocument.body:h).insertBefore(a,o):(o=h.nodeType===9?h.body:h.nodeName==="HTML"?h.ownerDocument.body:h,o.appendChild(a),h=h._reactRootContainer,h!=null||o.onclick!==null||(o.onclick=Hi));else if(m!==4&&(m===27&&ma(a.type)&&(h=a.stateNode,o=null),a=a.child,a!==null))for(xh(a,o,h),a=a.sibling;a!==null;)xh(a,o,h),a=a.sibling}function oc(a,o,h){var m=a.tag;if(m===5||m===6)a=a.stateNode,o?h.insertBefore(a,o):h.appendChild(a);else if(m!==4&&(m===27&&ma(a.type)&&(h=a.stateNode),a=a.child,a!==null))for(oc(a,o,h),a=a.sibling;a!==null;)oc(a,o,h),a=a.sibling}function p0(a){var o=a.stateNode,h=a.memoizedProps;try{for(var m=a.type,v=o.attributes;v.length;)o.removeAttributeNode(v[0]);Ls(o,m,h),o[_t]=a,o[mt]=h}catch(b){Rt(a,a.return,b)}}var kn=!1,ms=!1,Sh=!1,g0=typeof WeakSet=="function"?WeakSet:Set,Ss=null;function kE(a,o){if(a=a.containerInfo,Vh=wc,a=Lp(a),fd(a)){if("selectionStart"in a)var h={start:a.selectionStart,end:a.selectionEnd};else e:{h=(h=a.ownerDocument)&&h.defaultView||window;var m=h.getSelection&&h.getSelection();if(m&&m.rangeCount!==0){h=m.anchorNode;var v=m.anchorOffset,b=m.focusNode;m=m.focusOffset;try{h.nodeType,b.nodeType}catch{h=null;break e}var R=0,N=-1,B=-1,Z=0,oe=0,me=a,J=null;t:for(;;){for(var ne;me!==h||v!==0&&me.nodeType!==3||(N=R+v),me!==b||m!==0&&me.nodeType!==3||(B=R+m),me.nodeType===3&&(R+=me.nodeValue.length),(ne=me.firstChild)!==null;)J=me,me=ne;for(;;){if(me===a)break t;if(J===h&&++Z===v&&(N=R),J===b&&++oe===m&&(B=R),(ne=me.nextSibling)!==null)break;me=J,J=me.parentNode}me=ne}h=N===-1||B===-1?null:{start:N,end:B}}else h=null}h=h||{start:0,end:0}}else h=null;for($h={focusedElem:a,selectionRange:h},wc=!1,Ss=o;Ss!==null;)if(o=Ss,a=o.child,(o.subtreeFlags&1028)!==0&&a!==null)a.return=o,Ss=a;else for(;Ss!==null;){switch(o=Ss,b=o.alternate,a=o.flags,o.tag){case 0:if((a&4)!==0&&(a=o.updateQueue,a=a!==null?a.events:null,a!==null))for(h=0;h<a.length;h++)v=a[h],v.ref.impl=v.nextImpl;break;case 11:case 15:break;case 1:if((a&1024)!==0&&b!==null){a=void 0,h=o,v=b.memoizedProps,b=b.memoizedState,m=h.stateNode;try{var Pe=$a(h.type,v);a=m.getSnapshotBeforeUpdate(Pe,b),m.__reactInternalSnapshotBeforeUpdate=a}catch($e){Rt(h,h.return,$e)}}break;case 3:if((a&1024)!==0){if(a=o.stateNode.containerInfo,h=a.nodeType,h===9)zh(a);else if(h===1)switch(a.nodeName){case"HEAD":case"HTML":case"BODY":zh(a);break;default:a.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((a&1024)!==0)throw Error(s(163))}if(a=o.sibling,a!==null){a.return=o.return,Ss=a;break}Ss=o.return}}function y0(a,o,h){var m=h.flags;switch(h.tag){case 0:case 11:case 15:On(a,h),m&4&&Ol(5,h);break;case 1:if(On(a,h),m&4)if(a=h.stateNode,o===null)try{a.componentDidMount()}catch(R){Rt(h,h.return,R)}else{var v=$a(h.type,o.memoizedProps);o=o.memoizedState;try{a.componentDidUpdate(v,o,a.__reactInternalSnapshotBeforeUpdate)}catch(R){Rt(h,h.return,R)}}m&64&&d0(h),m&512&&Dl(h,h.return);break;case 3:if(On(a,h),m&64&&(a=h.updateQueue,a!==null)){if(o=null,h.child!==null)switch(h.child.tag){case 27:case 5:o=h.child.stateNode;break;case 1:o=h.child.stateNode}try{tg(a,o)}catch(R){Rt(h,h.return,R)}}break;case 27:o===null&&m&4&&p0(h);case 26:case 5:On(a,h),o===null&&m&4&&f0(h),m&512&&Dl(h,h.return);break;case 12:On(a,h);break;case 31:On(a,h),m&4&&S0(a,h);break;case 13:On(a,h),m&4&&b0(a,h),m&64&&(a=h.memoizedState,a!==null&&(a=a.dehydrated,a!==null&&(h=BE.bind(null,h),rA(a,h))));break;case 22:if(m=h.memoizedState!==null||kn,!m){o=o!==null&&o.memoizedState!==null||ms,v=kn;var b=ms;kn=m,(ms=o)&&!b?Dn(a,h,(h.subtreeFlags&8772)!==0):On(a,h),kn=v,ms=b}break;case 30:break;default:On(a,h)}}function v0(a){var o=a.alternate;o!==null&&(a.alternate=null,v0(o)),a.child=null,a.deletions=null,a.sibling=null,a.tag===5&&(o=a.stateNode,o!==null&&La(o)),a.stateNode=null,a.return=null,a.dependencies=null,a.memoizedProps=null,a.memoizedState=null,a.pendingProps=null,a.stateNode=null,a.updateQueue=null}var Gt=null,Ks=!1;function Nn(a,o,h){for(h=h.child;h!==null;)x0(a,o,h),h=h.sibling}function x0(a,o,h){if($t&&typeof $t.onCommitFiberUnmount=="function")try{$t.onCommitFiberUnmount(Es,h)}catch{}switch(h.tag){case 26:ms||an(h,o),Nn(a,o,h),h.memoizedState?h.memoizedState.count--:h.stateNode&&(h=h.stateNode,h.parentNode.removeChild(h));break;case 27:ms||an(h,o);var m=Gt,v=Ks;ma(h.type)&&(Gt=h.stateNode,Ks=!1),Nn(a,o,h),Gl(h.stateNode),Gt=m,Ks=v;break;case 5:ms||an(h,o);case 6:if(m=Gt,v=Ks,Gt=null,Nn(a,o,h),Gt=m,Ks=v,Gt!==null)if(Ks)try{(Gt.nodeType===9?Gt.body:Gt.nodeName==="HTML"?Gt.ownerDocument.body:Gt).removeChild(h.stateNode)}catch(b){Rt(h,o,b)}else try{Gt.removeChild(h.stateNode)}catch(b){Rt(h,o,b)}break;case 18:Gt!==null&&(Ks?(a=Gt,dy(a.nodeType===9?a.body:a.nodeName==="HTML"?a.ownerDocument.body:a,h.stateNode),Mr(a)):dy(Gt,h.stateNode));break;case 4:m=Gt,v=Ks,Gt=h.stateNode.containerInfo,Ks=!0,Nn(a,o,h),Gt=m,Ks=v;break;case 0:case 11:case 14:case 15:la(2,h,o),ms||la(4,h,o),Nn(a,o,h);break;case 1:ms||(an(h,o),m=h.stateNode,typeof m.componentWillUnmount=="function"&&h0(h,o,m)),Nn(a,o,h);break;case 21:Nn(a,o,h);break;case 22:ms=(m=ms)||h.memoizedState!==null,Nn(a,o,h),ms=m;break;default:Nn(a,o,h)}}function S0(a,o){if(o.memoizedState===null&&(a=o.alternate,a!==null&&(a=a.memoizedState,a!==null))){a=a.dehydrated;try{Mr(a)}catch(h){Rt(o,o.return,h)}}}function b0(a,o){if(o.memoizedState===null&&(a=o.alternate,a!==null&&(a=a.memoizedState,a!==null&&(a=a.dehydrated,a!==null))))try{Mr(a)}catch(h){Rt(o,o.return,h)}}function NE(a){switch(a.tag){case 31:case 13:case 19:var o=a.stateNode;return o===null&&(o=a.stateNode=new g0),o;case 22:return a=a.stateNode,o=a._retryCache,o===null&&(o=a._retryCache=new g0),o;default:throw Error(s(435,a.tag))}}function cc(a,o){var h=NE(a);o.forEach(function(m){if(!h.has(m)){h.add(m);var v=VE.bind(null,a,m);m.then(v,v)}})}function Ys(a,o){var h=o.deletions;if(h!==null)for(var m=0;m<h.length;m++){var v=h[m],b=a,R=o,N=R;e:for(;N!==null;){switch(N.tag){case 27:if(ma(N.type)){Gt=N.stateNode,Ks=!1;break e}break;case 5:Gt=N.stateNode,Ks=!1;break e;case 3:case 4:Gt=N.stateNode.containerInfo,Ks=!0;break e}N=N.return}if(Gt===null)throw Error(s(160));x0(b,R,v),Gt=null,Ks=!1,b=v.alternate,b!==null&&(b.return=null),v.return=null}if(o.subtreeFlags&13886)for(o=o.child;o!==null;)T0(o,a),o=o.sibling}var Ki=null;function T0(a,o){var h=a.alternate,m=a.flags;switch(a.tag){case 0:case 11:case 14:case 15:Ys(o,a),qs(a),m&4&&(la(3,a,a.return),Ol(3,a),la(5,a,a.return));break;case 1:Ys(o,a),qs(a),m&512&&(ms||h===null||an(h,h.return)),m&64&&kn&&(a=a.updateQueue,a!==null&&(m=a.callbacks,m!==null&&(h=a.shared.hiddenCallbacks,a.shared.hiddenCallbacks=h===null?m:h.concat(m))));break;case 26:var v=Ki;if(Ys(o,a),qs(a),m&512&&(ms||h===null||an(h,h.return)),m&4){var b=h!==null?h.memoizedState:null;if(m=a.memoizedState,h===null)if(m===null)if(a.stateNode===null){e:{m=a.type,h=a.memoizedProps,v=v.ownerDocument||v;t:switch(m){case"title":b=v.getElementsByTagName("title")[0],(!b||b[Ri]||b[_t]||b.namespaceURI==="http://www.w3.org/2000/svg"||b.hasAttribute("itemprop"))&&(b=v.createElement(m),v.head.insertBefore(b,v.querySelector("head > title"))),Ls(b,m,h),b[_t]=a,is(b),m=b;break e;case"link":var R=Ty("link","href",v).get(m+(h.href||""));if(R){for(var N=0;N<R.length;N++)if(b=R[N],b.getAttribute("href")===(h.href==null||h.href===""?null:h.href)&&b.getAttribute("rel")===(h.rel==null?null:h.rel)&&b.getAttribute("title")===(h.title==null?null:h.title)&&b.getAttribute("crossorigin")===(h.crossOrigin==null?null:h.crossOrigin)){R.splice(N,1);break t}}b=v.createElement(m),Ls(b,m,h),v.head.appendChild(b);break;case"meta":if(R=Ty("meta","content",v).get(m+(h.content||""))){for(N=0;N<R.length;N++)if(b=R[N],b.getAttribute("content")===(h.content==null?null:""+h.content)&&b.getAttribute("name")===(h.name==null?null:h.name)&&b.getAttribute("property")===(h.property==null?null:h.property)&&b.getAttribute("http-equiv")===(h.httpEquiv==null?null:h.httpEquiv)&&b.getAttribute("charset")===(h.charSet==null?null:h.charSet)){R.splice(N,1);break t}}b=v.createElement(m),Ls(b,m,h),v.head.appendChild(b);break;default:throw Error(s(468,m))}b[_t]=a,is(b),m=b}a.stateNode=m}else Ey(v,a.type,a.stateNode);else a.stateNode=by(v,m,a.memoizedProps);else b!==m?(b===null?h.stateNode!==null&&(h=h.stateNode,h.parentNode.removeChild(h)):b.count--,m===null?Ey(v,a.type,a.stateNode):by(v,m,a.memoizedProps)):m===null&&a.stateNode!==null&&yh(a,a.memoizedProps,h.memoizedProps)}break;case 27:Ys(o,a),qs(a),m&512&&(ms||h===null||an(h,h.return)),h!==null&&m&4&&yh(a,a.memoizedProps,h.memoizedProps);break;case 5:if(Ys(o,a),qs(a),m&512&&(ms||h===null||an(h,h.return)),a.flags&32){v=a.stateNode;try{ps(v,"")}catch(Pe){Rt(a,a.return,Pe)}}m&4&&a.stateNode!=null&&(v=a.memoizedProps,yh(a,v,h!==null?h.memoizedProps:v)),m&1024&&(Sh=!0);break;case 6:if(Ys(o,a),qs(a),m&4){if(a.stateNode===null)throw Error(s(162));m=a.memoizedProps,h=a.stateNode;try{h.nodeValue=m}catch(Pe){Rt(a,a.return,Pe)}}break;case 3:if(_c=null,v=Ki,Ki=Ec(o.containerInfo),Ys(o,a),Ki=v,qs(a),m&4&&h!==null&&h.memoizedState.isDehydrated)try{Mr(o.containerInfo)}catch(Pe){Rt(a,a.return,Pe)}Sh&&(Sh=!1,E0(a));break;case 4:m=Ki,Ki=Ec(a.stateNode.containerInfo),Ys(o,a),qs(a),Ki=m;break;case 12:Ys(o,a),qs(a);break;case 31:Ys(o,a),qs(a),m&4&&(m=a.updateQueue,m!==null&&(a.updateQueue=null,cc(a,m)));break;case 13:Ys(o,a),qs(a),a.child.flags&8192&&a.memoizedState!==null!=(h!==null&&h.memoizedState!==null)&&(dc=rt()),m&4&&(m=a.updateQueue,m!==null&&(a.updateQueue=null,cc(a,m)));break;case 22:v=a.memoizedState!==null;var B=h!==null&&h.memoizedState!==null,Z=kn,oe=ms;if(kn=Z||v,ms=oe||B,Ys(o,a),ms=oe,kn=Z,qs(a),m&8192)e:for(o=a.stateNode,o._visibility=v?o._visibility&-2:o._visibility|1,v&&(h===null||B||kn||ms||Ga(a)),h=null,o=a;;){if(o.tag===5||o.tag===26){if(h===null){B=h=o;try{if(b=B.stateNode,v)R=b.style,typeof R.setProperty=="function"?R.setProperty("display","none","important"):R.display="none";else{N=B.stateNode;var me=B.memoizedProps.style,J=me!=null&&me.hasOwnProperty("display")?me.display:null;N.style.display=J==null||typeof J=="boolean"?"":(""+J).trim()}}catch(Pe){Rt(B,B.return,Pe)}}}else if(o.tag===6){if(h===null){B=o;try{B.stateNode.nodeValue=v?"":B.memoizedProps}catch(Pe){Rt(B,B.return,Pe)}}}else if(o.tag===18){if(h===null){B=o;try{var ne=B.stateNode;v?hy(ne,!0):hy(B.stateNode,!1)}catch(Pe){Rt(B,B.return,Pe)}}}else if((o.tag!==22&&o.tag!==23||o.memoizedState===null||o===a)&&o.child!==null){o.child.return=o,o=o.child;continue}if(o===a)break e;for(;o.sibling===null;){if(o.return===null||o.return===a)break e;h===o&&(h=null),o=o.return}h===o&&(h=null),o.sibling.return=o.return,o=o.sibling}m&4&&(m=a.updateQueue,m!==null&&(h=m.retryQueue,h!==null&&(m.retryQueue=null,cc(a,h))));break;case 19:Ys(o,a),qs(a),m&4&&(m=a.updateQueue,m!==null&&(a.updateQueue=null,cc(a,m)));break;case 30:break;case 21:break;default:Ys(o,a),qs(a)}}function qs(a){var o=a.flags;if(o&2){try{for(var h,m=a.return;m!==null;){if(m0(m)){h=m;break}m=m.return}if(h==null)throw Error(s(160));switch(h.tag){case 27:var v=h.stateNode,b=vh(a);oc(a,b,v);break;case 5:var R=h.stateNode;h.flags&32&&(ps(R,""),h.flags&=-33);var N=vh(a);oc(a,N,R);break;case 3:case 4:var B=h.stateNode.containerInfo,Z=vh(a);xh(a,Z,B);break;default:throw Error(s(161))}}catch(oe){Rt(a,a.return,oe)}a.flags&=-3}o&4096&&(a.flags&=-4097)}function E0(a){if(a.subtreeFlags&1024)for(a=a.child;a!==null;){var o=a;E0(o),o.tag===5&&o.flags&1024&&o.stateNode.reset(),a=a.sibling}}function On(a,o){if(o.subtreeFlags&8772)for(o=o.child;o!==null;)y0(a,o.alternate,o),o=o.sibling}function Ga(a){for(a=a.child;a!==null;){var o=a;switch(o.tag){case 0:case 11:case 14:case 15:la(4,o,o.return),Ga(o);break;case 1:an(o,o.return);var h=o.stateNode;typeof h.componentWillUnmount=="function"&&h0(o,o.return,h),Ga(o);break;case 27:Gl(o.stateNode);case 26:case 5:an(o,o.return),Ga(o);break;case 22:o.memoizedState===null&&Ga(o);break;case 30:Ga(o);break;default:Ga(o)}a=a.sibling}}function Dn(a,o,h){for(h=h&&(o.subtreeFlags&8772)!==0,o=o.child;o!==null;){var m=o.alternate,v=a,b=o,R=b.flags;switch(b.tag){case 0:case 11:case 15:Dn(v,b,h),Ol(4,b);break;case 1:if(Dn(v,b,h),m=b,v=m.stateNode,typeof v.componentDidMount=="function")try{v.componentDidMount()}catch(Z){Rt(m,m.return,Z)}if(m=b,v=m.updateQueue,v!==null){var N=m.stateNode;try{var B=v.shared.hiddenCallbacks;if(B!==null)for(v.shared.hiddenCallbacks=null,v=0;v<B.length;v++)eg(B[v],N)}catch(Z){Rt(m,m.return,Z)}}h&&R&64&&d0(b),Dl(b,b.return);break;case 27:p0(b);case 26:case 5:Dn(v,b,h),h&&m===null&&R&4&&f0(b),Dl(b,b.return);break;case 12:Dn(v,b,h);break;case 31:Dn(v,b,h),h&&R&4&&S0(v,b);break;case 13:Dn(v,b,h),h&&R&4&&b0(v,b);break;case 22:b.memoizedState===null&&Dn(v,b,h),Dl(b,b.return);break;case 30:break;default:Dn(v,b,h)}o=o.sibling}}function bh(a,o){var h=null;a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(h=a.memoizedState.cachePool.pool),a=null,o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(a=o.memoizedState.cachePool.pool),a!==h&&(a!=null&&a.refCount++,h!=null&&Sl(h))}function Th(a,o){a=null,o.alternate!==null&&(a=o.alternate.memoizedState.cache),o=o.memoizedState.cache,o!==a&&(o.refCount++,a!=null&&Sl(a))}function Yi(a,o,h,m){if(o.subtreeFlags&10256)for(o=o.child;o!==null;)A0(a,o,h,m),o=o.sibling}function A0(a,o,h,m){var v=o.flags;switch(o.tag){case 0:case 11:case 15:Yi(a,o,h,m),v&2048&&Ol(9,o);break;case 1:Yi(a,o,h,m);break;case 3:Yi(a,o,h,m),v&2048&&(a=null,o.alternate!==null&&(a=o.alternate.memoizedState.cache),o=o.memoizedState.cache,o!==a&&(o.refCount++,a!=null&&Sl(a)));break;case 12:if(v&2048){Yi(a,o,h,m),a=o.stateNode;try{var b=o.memoizedProps,R=b.id,N=b.onPostCommit;typeof N=="function"&&N(R,o.alternate===null?"mount":"update",a.passiveEffectDuration,-0)}catch(B){Rt(o,o.return,B)}}else Yi(a,o,h,m);break;case 31:Yi(a,o,h,m);break;case 13:Yi(a,o,h,m);break;case 23:break;case 22:b=o.stateNode,R=o.alternate,o.memoizedState!==null?b._visibility&2?Yi(a,o,h,m):Pl(a,o):b._visibility&2?Yi(a,o,h,m):(b._visibility|=2,Ir(a,o,h,m,(o.subtreeFlags&10256)!==0||!1)),v&2048&&bh(R,o);break;case 24:Yi(a,o,h,m),v&2048&&Th(o.alternate,o);break;default:Yi(a,o,h,m)}}function Ir(a,o,h,m,v){for(v=v&&((o.subtreeFlags&10256)!==0||!1),o=o.child;o!==null;){var b=a,R=o,N=h,B=m,Z=R.flags;switch(R.tag){case 0:case 11:case 15:Ir(b,R,N,B,v),Ol(8,R);break;case 23:break;case 22:var oe=R.stateNode;R.memoizedState!==null?oe._visibility&2?Ir(b,R,N,B,v):Pl(b,R):(oe._visibility|=2,Ir(b,R,N,B,v)),v&&Z&2048&&bh(R.alternate,R);break;case 24:Ir(b,R,N,B,v),v&&Z&2048&&Th(R.alternate,R);break;default:Ir(b,R,N,B,v)}o=o.sibling}}function Pl(a,o){if(o.subtreeFlags&10256)for(o=o.child;o!==null;){var h=a,m=o,v=m.flags;switch(m.tag){case 22:Pl(h,m),v&2048&&bh(m.alternate,m);break;case 24:Pl(h,m),v&2048&&Th(m.alternate,m);break;default:Pl(h,m)}o=o.sibling}}var Ul=8192;function Rr(a,o,h){if(a.subtreeFlags&Ul)for(a=a.child;a!==null;)_0(a,o,h),a=a.sibling}function _0(a,o,h){switch(a.tag){case 26:Rr(a,o,h),a.flags&Ul&&a.memoizedState!==null&&vA(h,Ki,a.memoizedState,a.memoizedProps);break;case 5:Rr(a,o,h);break;case 3:case 4:var m=Ki;Ki=Ec(a.stateNode.containerInfo),Rr(a,o,h),Ki=m;break;case 22:a.memoizedState===null&&(m=a.alternate,m!==null&&m.memoizedState!==null?(m=Ul,Ul=16777216,Rr(a,o,h),Ul=m):Rr(a,o,h));break;default:Rr(a,o,h)}}function I0(a){var o=a.alternate;if(o!==null&&(a=o.child,a!==null)){o.child=null;do o=a.sibling,a.sibling=null,a=o;while(a!==null)}}function Ml(a){var o=a.deletions;if((a.flags&16)!==0){if(o!==null)for(var h=0;h<o.length;h++){var m=o[h];Ss=m,L0(m,a)}I0(a)}if(a.subtreeFlags&10256)for(a=a.child;a!==null;)R0(a),a=a.sibling}function R0(a){switch(a.tag){case 0:case 11:case 15:Ml(a),a.flags&2048&&la(9,a,a.return);break;case 3:Ml(a);break;case 12:Ml(a);break;case 22:var o=a.stateNode;a.memoizedState!==null&&o._visibility&2&&(a.return===null||a.return.tag!==13)?(o._visibility&=-3,uc(a)):Ml(a);break;default:Ml(a)}}function uc(a){var o=a.deletions;if((a.flags&16)!==0){if(o!==null)for(var h=0;h<o.length;h++){var m=o[h];Ss=m,L0(m,a)}I0(a)}for(a=a.child;a!==null;){switch(o=a,o.tag){case 0:case 11:case 15:la(8,o,o.return),uc(o);break;case 22:h=o.stateNode,h._visibility&2&&(h._visibility&=-3,uc(o));break;default:uc(o)}a=a.sibling}}function L0(a,o){for(;Ss!==null;){var h=Ss;switch(h.tag){case 0:case 11:case 15:la(8,h,o);break;case 23:case 22:if(h.memoizedState!==null&&h.memoizedState.cachePool!==null){var m=h.memoizedState.cachePool.pool;m!=null&&m.refCount++}break;case 24:Sl(h.memoizedState.cache)}if(m=h.child,m!==null)m.return=h,Ss=m;else e:for(h=a;Ss!==null;){m=Ss;var v=m.sibling,b=m.return;if(v0(m),m===h){Ss=null;break e}if(v!==null){v.return=b,Ss=v;break e}Ss=b}}}var OE={getCacheForType:function(a){var o=Is(ds),h=o.data.get(a);return h===void 0&&(h=a(),o.data.set(a,h)),h},cacheSignal:function(){return Is(ds).controller.signal}},DE=typeof WeakMap=="function"?WeakMap:Map,St=0,Dt=null,lt=null,ct=0,It=0,hi=null,oa=!1,Lr=!1,Eh=!1,Pn=0,Jt=0,ca=0,Ha=0,Ah=0,fi=0,wr=0,jl=null,Qs=null,_h=!1,dc=0,w0=0,hc=1/0,fc=null,ua=null,gs=0,da=null,Cr=null,Un=0,Ih=0,Rh=null,C0=null,Fl=0,Lh=null;function mi(){return(St&2)!==0&&ct!==0?ct&-ct:M.T!==null?Dh():ts()}function k0(){if(fi===0)if((ct&536870912)===0||ft){var a=Wt;Wt<<=1,(Wt&3932160)===0&&(Wt=262144),fi=a}else fi=536870912;return a=ui.current,a!==null&&(a.flags|=32),fi}function Ws(a,o,h){(a===Dt&&(It===2||It===9)||a.cancelPendingCommit!==null)&&(kr(a,0),ha(a,ct,fi,!1)),cs(a,h),((St&2)===0||a!==Dt)&&(a===Dt&&((St&2)===0&&(Ha|=h),Jt===4&&ha(a,ct,fi,!1)),rn(a))}function N0(a,o,h){if((St&6)!==0)throw Error(s(327));var m=!h&&(o&127)===0&&(o&a.expiredLanes)===0||Vs(a,o),v=m?ME(a,o):Ch(a,o,!0),b=m;do{if(v===0){Lr&&!m&&ha(a,o,0,!1);break}else{if(h=a.current.alternate,b&&!PE(h)){v=Ch(a,o,!1),b=!1;continue}if(v===2){if(b=o,a.errorRecoveryDisabledLanes&b)var R=0;else R=a.pendingLanes&-536870913,R=R!==0?R:R&536870912?536870912:0;if(R!==0){o=R;e:{var N=a;v=jl;var B=N.current.memoizedState.isDehydrated;if(B&&(kr(N,R).flags|=256),R=Ch(N,R,!1),R!==2){if(Eh&&!B){N.errorRecoveryDisabledLanes|=b,Ha|=b,v=4;break e}b=Qs,Qs=v,b!==null&&(Qs===null?Qs=b:Qs.push.apply(Qs,b))}v=R}if(b=!1,v!==2)continue}}if(v===1){kr(a,0),ha(a,o,0,!0);break}e:{switch(m=a,b=v,b){case 0:case 1:throw Error(s(345));case 4:if((o&4194048)!==o)break;case 6:ha(m,o,fi,!oa);break e;case 2:Qs=null;break;case 3:case 5:break;default:throw Error(s(329))}if((o&62914560)===o&&(v=dc+300-rt(),10<v)){if(ha(m,o,fi,!oa),Xt(m,0,!0)!==0)break e;Un=o,m.timeoutHandle=cy(O0.bind(null,m,h,Qs,fc,_h,o,fi,Ha,wr,oa,b,"Throttled",-0,0),v);break e}O0(m,h,Qs,fc,_h,o,fi,Ha,wr,oa,b,null,-0,0)}}break}while(!0);rn(a)}function O0(a,o,h,m,v,b,R,N,B,Z,oe,me,J,ne){if(a.timeoutHandle=-1,me=o.subtreeFlags,me&8192||(me&16785408)===16785408){me={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Hi},_0(o,b,me);var Pe=(b&62914560)===b?dc-rt():(b&4194048)===b?w0-rt():0;if(Pe=xA(me,Pe),Pe!==null){Un=b,a.cancelPendingCommit=Pe(V0.bind(null,a,o,b,h,m,v,R,N,B,oe,me,null,J,ne)),ha(a,b,R,!Z);return}}V0(a,o,b,h,m,v,R,N,B)}function PE(a){for(var o=a;;){var h=o.tag;if((h===0||h===11||h===15)&&o.flags&16384&&(h=o.updateQueue,h!==null&&(h=h.stores,h!==null)))for(var m=0;m<h.length;m++){var v=h[m],b=v.getSnapshot;v=v.value;try{if(!oi(b(),v))return!1}catch{return!1}}if(h=o.child,o.subtreeFlags&16384&&h!==null)h.return=o,o=h;else{if(o===a)break;for(;o.sibling===null;){if(o.return===null||o.return===a)return!0;o=o.return}o.sibling.return=o.return,o=o.sibling}}return!0}function ha(a,o,h,m){o&=~Ah,o&=~Ha,a.suspendedLanes|=o,a.pingedLanes&=~o,m&&(a.warmLanes|=o),m=a.expirationTimes;for(var v=o;0<v;){var b=31-Yt(v),R=1<<b;m[b]=-1,v&=~R}h!==0&&ri(a,h,o)}function mc(){return(St&6)===0?(Bl(0),!1):!0}function wh(){if(lt!==null){if(It===0)var a=lt.return;else a=lt,_n=Pa=null,zd(a),br=null,Tl=0,a=lt;for(;a!==null;)u0(a.alternate,a),a=a.return;lt=null}}function kr(a,o){var h=a.timeoutHandle;h!==-1&&(a.timeoutHandle=-1,tA(h)),h=a.cancelPendingCommit,h!==null&&(a.cancelPendingCommit=null,h()),Un=0,wh(),Dt=a,lt=h=En(a.current,null),ct=o,It=0,hi=null,oa=!1,Lr=Vs(a,o),Eh=!1,wr=fi=Ah=Ha=ca=Jt=0,Qs=jl=null,_h=!1,(o&8)!==0&&(o|=o&32);var m=a.entangledLanes;if(m!==0)for(a=a.entanglements,m&=o;0<m;){var v=31-Yt(m),b=1<<v;o|=a[v],m&=~b}return Pn=o,Po(),h}function D0(a,o){Je=null,M.H=Cl,o===Sr||o===Go?(o=Wp(),It=3):o===Od?(o=Wp(),It=4):It=o===lh?8:o!==null&&typeof o=="object"&&typeof o.then=="function"?6:1,hi=o,lt===null&&(Jt=1,ic(a,wi(o,a.current)))}function P0(){var a=ui.current;return a===null?!0:(ct&4194048)===ct?Oi===null:(ct&62914560)===ct||(ct&536870912)!==0?a===Oi:!1}function U0(){var a=M.H;return M.H=Cl,a===null?Cl:a}function M0(){var a=M.A;return M.A=OE,a}function pc(){Jt=4,oa||(ct&4194048)!==ct&&ui.current!==null||(Lr=!0),(ca&134217727)===0&&(Ha&134217727)===0||Dt===null||ha(Dt,ct,fi,!1)}function Ch(a,o,h){var m=St;St|=2;var v=U0(),b=M0();(Dt!==a||ct!==o)&&(fc=null,kr(a,o)),o=!1;var R=Jt;e:do try{if(It!==0&&lt!==null){var N=lt,B=hi;switch(It){case 8:wh(),R=6;break e;case 3:case 2:case 9:case 6:ui.current===null&&(o=!0);var Z=It;if(It=0,hi=null,Nr(a,N,B,Z),h&&Lr){R=0;break e}break;default:Z=It,It=0,hi=null,Nr(a,N,B,Z)}}UE(),R=Jt;break}catch(oe){D0(a,oe)}while(!0);return o&&a.shellSuspendCounter++,_n=Pa=null,St=m,M.H=v,M.A=b,lt===null&&(Dt=null,ct=0,Po()),R}function UE(){for(;lt!==null;)j0(lt)}function ME(a,o){var h=St;St|=2;var m=U0(),v=M0();Dt!==a||ct!==o?(fc=null,hc=rt()+500,kr(a,o)):Lr=Vs(a,o);e:do try{if(It!==0&&lt!==null){o=lt;var b=hi;t:switch(It){case 1:It=0,hi=null,Nr(a,o,b,1);break;case 2:case 9:if(qp(b)){It=0,hi=null,F0(o);break}o=function(){It!==2&&It!==9||Dt!==a||(It=7),rn(a)},b.then(o,o);break e;case 3:It=7;break e;case 4:It=5;break e;case 7:qp(b)?(It=0,hi=null,F0(o)):(It=0,hi=null,Nr(a,o,b,7));break;case 5:var R=null;switch(lt.tag){case 26:R=lt.memoizedState;case 5:case 27:var N=lt;if(R?Ay(R):N.stateNode.complete){It=0,hi=null;var B=N.sibling;if(B!==null)lt=B;else{var Z=N.return;Z!==null?(lt=Z,gc(Z)):lt=null}break t}}It=0,hi=null,Nr(a,o,b,5);break;case 6:It=0,hi=null,Nr(a,o,b,6);break;case 8:wh(),Jt=6;break e;default:throw Error(s(462))}}jE();break}catch(oe){D0(a,oe)}while(!0);return _n=Pa=null,M.H=m,M.A=v,St=h,lt!==null?0:(Dt=null,ct=0,Po(),Jt)}function jE(){for(;lt!==null&&!He();)j0(lt)}function j0(a){var o=o0(a.alternate,a,Pn);a.memoizedProps=a.pendingProps,o===null?gc(a):lt=o}function F0(a){var o=a,h=o.alternate;switch(o.tag){case 15:case 0:o=s0(h,o,o.pendingProps,o.type,void 0,ct);break;case 11:o=s0(h,o,o.pendingProps,o.type.render,o.ref,ct);break;case 5:zd(o);default:u0(h,o),o=lt=Mp(o,Pn),o=o0(h,o,Pn)}a.memoizedProps=a.pendingProps,o===null?gc(a):lt=o}function Nr(a,o,h,m){_n=Pa=null,zd(o),br=null,Tl=0;var v=o.return;try{if(IE(a,v,o,h,ct)){Jt=1,ic(a,wi(h,a.current)),lt=null;return}}catch(b){if(v!==null)throw lt=v,b;Jt=1,ic(a,wi(h,a.current)),lt=null;return}o.flags&32768?(ft||m===1?a=!0:Lr||(ct&536870912)!==0?a=!1:(oa=a=!0,(m===2||m===9||m===3||m===6)&&(m=ui.current,m!==null&&m.tag===13&&(m.flags|=16384))),B0(o,a)):gc(o)}function gc(a){var o=a;do{if((o.flags&32768)!==0){B0(o,oa);return}a=o.return;var h=wE(o.alternate,o,Pn);if(h!==null){lt=h;return}if(o=o.sibling,o!==null){lt=o;return}lt=o=a}while(o!==null);Jt===0&&(Jt=5)}function B0(a,o){do{var h=CE(a.alternate,a);if(h!==null){h.flags&=32767,lt=h;return}if(h=a.return,h!==null&&(h.flags|=32768,h.subtreeFlags=0,h.deletions=null),!o&&(a=a.sibling,a!==null)){lt=a;return}lt=a=h}while(a!==null);Jt=6,lt=null}function V0(a,o,h,m,v,b,R,N,B){a.cancelPendingCommit=null;do yc();while(gs!==0);if((St&6)!==0)throw Error(s(327));if(o!==null){if(o===a.current)throw Error(s(177));if(b=o.lanes|o.childLanes,b|=vd,$i(a,h,b,R,N,B),a===Dt&&(lt=Dt=null,ct=0),Cr=o,da=a,Un=h,Ih=b,Rh=v,C0=m,(o.subtreeFlags&10256)!==0||(o.flags&10256)!==0?(a.callbackNode=null,a.callbackPriority=0,$E(it,function(){return K0(),null})):(a.callbackNode=null,a.callbackPriority=0),m=(o.flags&13878)!==0,(o.subtreeFlags&13878)!==0||m){m=M.T,M.T=null,v=V.p,V.p=2,R=St,St|=4;try{kE(a,o,h)}finally{St=R,V.p=v,M.T=m}}gs=1,$0(),G0(),H0()}}function $0(){if(gs===1){gs=0;var a=da,o=Cr,h=(o.flags&13878)!==0;if((o.subtreeFlags&13878)!==0||h){h=M.T,M.T=null;var m=V.p;V.p=2;var v=St;St|=4;try{T0(o,a);var b=$h,R=Lp(a.containerInfo),N=b.focusedElem,B=b.selectionRange;if(R!==N&&N&&N.ownerDocument&&Rp(N.ownerDocument.documentElement,N)){if(B!==null&&fd(N)){var Z=B.start,oe=B.end;if(oe===void 0&&(oe=Z),"selectionStart"in N)N.selectionStart=Z,N.selectionEnd=Math.min(oe,N.value.length);else{var me=N.ownerDocument||document,J=me&&me.defaultView||window;if(J.getSelection){var ne=J.getSelection(),Pe=N.textContent.length,$e=Math.min(B.start,Pe),Nt=B.end===void 0?$e:Math.min(B.end,Pe);!ne.extend&&$e>Nt&&(R=Nt,Nt=$e,$e=R);var Y=Ip(N,$e),z=Ip(N,Nt);if(Y&&z&&(ne.rangeCount!==1||ne.anchorNode!==Y.node||ne.anchorOffset!==Y.offset||ne.focusNode!==z.node||ne.focusOffset!==z.offset)){var X=me.createRange();X.setStart(Y.node,Y.offset),ne.removeAllRanges(),$e>Nt?(ne.addRange(X),ne.extend(z.node,z.offset)):(X.setEnd(z.node,z.offset),ne.addRange(X))}}}}for(me=[],ne=N;ne=ne.parentNode;)ne.nodeType===1&&me.push({element:ne,left:ne.scrollLeft,top:ne.scrollTop});for(typeof N.focus=="function"&&N.focus(),N=0;N<me.length;N++){var he=me[N];he.element.scrollLeft=he.left,he.element.scrollTop=he.top}}wc=!!Vh,$h=Vh=null}finally{St=v,V.p=m,M.T=h}}a.current=o,gs=2}}function G0(){if(gs===2){gs=0;var a=da,o=Cr,h=(o.flags&8772)!==0;if((o.subtreeFlags&8772)!==0||h){h=M.T,M.T=null;var m=V.p;V.p=2;var v=St;St|=4;try{y0(a,o.alternate,o)}finally{St=v,V.p=m,M.T=h}}gs=3}}function H0(){if(gs===4||gs===3){gs=0,Tt();var a=da,o=Cr,h=Un,m=C0;(o.subtreeFlags&10256)!==0||(o.flags&10256)!==0?gs=5:(gs=0,Cr=da=null,z0(a,a.pendingLanes));var v=a.pendingLanes;if(v===0&&(ua=null),Qe(h),o=o.stateNode,$t&&typeof $t.onCommitFiberRoot=="function")try{$t.onCommitFiberRoot(Es,o,void 0,(o.current.flags&128)===128)}catch{}if(m!==null){o=M.T,v=V.p,V.p=2,M.T=null;try{for(var b=a.onRecoverableError,R=0;R<m.length;R++){var N=m[R];b(N.value,{componentStack:N.stack})}}finally{M.T=o,V.p=v}}(Un&3)!==0&&yc(),rn(a),v=a.pendingLanes,(h&261930)!==0&&(v&42)!==0?a===Lh?Fl++:(Fl=0,Lh=a):Fl=0,Bl(0)}}function z0(a,o){(a.pooledCacheLanes&=o)===0&&(o=a.pooledCache,o!=null&&(a.pooledCache=null,Sl(o)))}function yc(){return $0(),G0(),H0(),K0()}function K0(){if(gs!==5)return!1;var a=da,o=Ih;Ih=0;var h=Qe(Un),m=M.T,v=V.p;try{V.p=32>h?32:h,M.T=null,h=Rh,Rh=null;var b=da,R=Un;if(gs=0,Cr=da=null,Un=0,(St&6)!==0)throw Error(s(331));var N=St;if(St|=4,R0(b.current),A0(b,b.current,R,h),St=N,Bl(0,!1),$t&&typeof $t.onPostCommitFiberRoot=="function")try{$t.onPostCommitFiberRoot(Es,b)}catch{}return!0}finally{V.p=v,M.T=m,z0(a,o)}}function Y0(a,o,h){o=wi(h,o),o=rh(a.stateNode,o,2),a=na(a,o,2),a!==null&&(cs(a,2),rn(a))}function Rt(a,o,h){if(a.tag===3)Y0(a,a,h);else for(;o!==null;){if(o.tag===3){Y0(o,a,h);break}else if(o.tag===1){var m=o.stateNode;if(typeof o.type.getDerivedStateFromError=="function"||typeof m.componentDidCatch=="function"&&(ua===null||!ua.has(m))){a=wi(h,a),h=qg(2),m=na(o,h,2),m!==null&&(Qg(h,m,o,a),cs(m,2),rn(m));break}}o=o.return}}function kh(a,o,h){var m=a.pingCache;if(m===null){m=a.pingCache=new DE;var v=new Set;m.set(o,v)}else v=m.get(o),v===void 0&&(v=new Set,m.set(o,v));v.has(h)||(Eh=!0,v.add(h),a=FE.bind(null,a,o,h),o.then(a,a))}function FE(a,o,h){var m=a.pingCache;m!==null&&m.delete(o),a.pingedLanes|=a.suspendedLanes&h,a.warmLanes&=~h,Dt===a&&(ct&h)===h&&(Jt===4||Jt===3&&(ct&62914560)===ct&&300>rt()-dc?(St&2)===0&&kr(a,0):Ah|=h,wr===ct&&(wr=0)),rn(a)}function q0(a,o){o===0&&(o=Ii()),a=Na(a,o),a!==null&&(cs(a,o),rn(a))}function BE(a){var o=a.memoizedState,h=0;o!==null&&(h=o.retryLane),q0(a,h)}function VE(a,o){var h=0;switch(a.tag){case 31:case 13:var m=a.stateNode,v=a.memoizedState;v!==null&&(h=v.retryLane);break;case 19:m=a.stateNode;break;case 22:m=a.stateNode._retryCache;break;default:throw Error(s(314))}m!==null&&m.delete(o),q0(a,h)}function $E(a,o){return dt(a,o)}var vc=null,Or=null,Nh=!1,xc=!1,Oh=!1,fa=0;function rn(a){a!==Or&&a.next===null&&(Or===null?vc=Or=a:Or=Or.next=a),xc=!0,Nh||(Nh=!0,HE())}function Bl(a,o){if(!Oh&&xc){Oh=!0;do for(var h=!1,m=vc;m!==null;){if(a!==0){var v=m.pendingLanes;if(v===0)var b=0;else{var R=m.suspendedLanes,N=m.pingedLanes;b=(1<<31-Yt(42|a)+1)-1,b&=v&~(R&~N),b=b&201326741?b&201326741|1:b?b|2:0}b!==0&&(h=!0,Z0(m,b))}else b=ct,b=Xt(m,m===Dt?b:0,m.cancelPendingCommit!==null||m.timeoutHandle!==-1),(b&3)===0||Vs(m,b)||(h=!0,Z0(m,b));m=m.next}while(h);Oh=!1}}function GE(){Q0()}function Q0(){xc=Nh=!1;var a=0;fa!==0&&eA()&&(a=fa);for(var o=rt(),h=null,m=vc;m!==null;){var v=m.next,b=W0(m,o);b===0?(m.next=null,h===null?vc=v:h.next=v,v===null&&(Or=h)):(h=m,(a!==0||(b&3)!==0)&&(xc=!0)),m=v}gs!==0&&gs!==5||Bl(a),fa!==0&&(fa=0)}function W0(a,o){for(var h=a.suspendedLanes,m=a.pingedLanes,v=a.expirationTimes,b=a.pendingLanes&-62914561;0<b;){var R=31-Yt(b),N=1<<R,B=v[R];B===-1?((N&h)===0||(N&m)!==0)&&(v[R]=ni(N,o)):B<=o&&(a.expiredLanes|=N),b&=~N}if(o=Dt,h=ct,h=Xt(a,a===o?h:0,a.cancelPendingCommit!==null||a.timeoutHandle!==-1),m=a.callbackNode,h===0||a===o&&(It===2||It===9)||a.cancelPendingCommit!==null)return m!==null&&m!==null&&Ce(m),a.callbackNode=null,a.callbackPriority=0;if((h&3)===0||Vs(a,h)){if(o=h&-h,o===a.callbackPriority)return o;switch(m!==null&&Ce(m),Qe(h)){case 2:case 8:h=We;break;case 32:h=it;break;case 268435456:h=Ns;break;default:h=it}return m=X0.bind(null,a),h=dt(h,m),a.callbackPriority=o,a.callbackNode=h,o}return m!==null&&m!==null&&Ce(m),a.callbackPriority=2,a.callbackNode=null,2}function X0(a,o){if(gs!==0&&gs!==5)return a.callbackNode=null,a.callbackPriority=0,null;var h=a.callbackNode;if(yc()&&a.callbackNode!==h)return null;var m=ct;return m=Xt(a,a===Dt?m:0,a.cancelPendingCommit!==null||a.timeoutHandle!==-1),m===0?null:(N0(a,m,o),W0(a,rt()),a.callbackNode!=null&&a.callbackNode===h?X0.bind(null,a):null)}function Z0(a,o){if(yc())return null;N0(a,o,!0)}function HE(){sA(function(){(St&6)!==0?dt(ye,GE):Q0()})}function Dh(){if(fa===0){var a=vr;a===0&&(a=xs,xs<<=1,(xs&261888)===0&&(xs=256)),fa=a}return fa}function J0(a){return a==null||typeof a=="symbol"||typeof a=="boolean"?null:typeof a=="function"?a:Hs(""+a)}function ey(a,o){var h=o.ownerDocument.createElement("input");return h.name=o.name,h.value=o.value,a.id&&h.setAttribute("form",a.id),o.parentNode.insertBefore(h,o),a=new FormData(a),h.parentNode.removeChild(h),a}function zE(a,o,h,m,v){if(o==="submit"&&h&&h.stateNode===v){var b=J0((v[mt]||null).action),R=m.submitter;R&&(o=(o=R[mt]||null)?J0(o.formAction):R.getAttribute("formAction"),o!==null&&(b=o,R=null));var N=new ko("action","action",null,m,v);a.push({event:N,listeners:[{instance:null,listener:function(){if(m.defaultPrevented){if(fa!==0){var B=R?ey(v,R):new FormData(v);eh(h,{pending:!0,data:B,method:v.method,action:b},null,B)}}else typeof b=="function"&&(N.preventDefault(),B=R?ey(v,R):new FormData(v),eh(h,{pending:!0,data:B,method:v.method,action:b},b,B))},currentTarget:v}]})}}for(var Ph=0;Ph<yd.length;Ph++){var Uh=yd[Ph],KE=Uh.toLowerCase(),YE=Uh[0].toUpperCase()+Uh.slice(1);zi(KE,"on"+YE)}zi(kp,"onAnimationEnd"),zi(Np,"onAnimationIteration"),zi(Op,"onAnimationStart"),zi("dblclick","onDoubleClick"),zi("focusin","onFocus"),zi("focusout","onBlur"),zi(cE,"onTransitionRun"),zi(uE,"onTransitionStart"),zi(dE,"onTransitionCancel"),zi(Dp,"onTransitionEnd"),qn("onMouseEnter",["mouseout","mouseover"]),qn("onMouseLeave",["mouseout","mouseover"]),qn("onPointerEnter",["pointerout","pointerover"]),qn("onPointerLeave",["pointerout","pointerover"]),tn("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),tn("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),tn("onBeforeInput",["compositionend","keypress","textInput","paste"]),tn("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),tn("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),tn("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Vl="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),qE=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Vl));function ty(a,o){o=(o&4)!==0;for(var h=0;h<a.length;h++){var m=a[h],v=m.event;m=m.listeners;e:{var b=void 0;if(o)for(var R=m.length-1;0<=R;R--){var N=m[R],B=N.instance,Z=N.currentTarget;if(N=N.listener,B!==b&&v.isPropagationStopped())break e;b=N,v.currentTarget=Z;try{b(v)}catch(oe){Do(oe)}v.currentTarget=null,b=B}else for(R=0;R<m.length;R++){if(N=m[R],B=N.instance,Z=N.currentTarget,N=N.listener,B!==b&&v.isPropagationStopped())break e;b=N,v.currentTarget=Z;try{b(v)}catch(oe){Do(oe)}v.currentTarget=null,b=B}}}}function ot(a,o){var h=o[Ji];h===void 0&&(h=o[Ji]=new Set);var m=a+"__bubble";h.has(m)||(sy(o,a,2,!1),h.add(m))}function Mh(a,o,h){var m=0;o&&(m|=4),sy(h,a,m,o)}var Sc="_reactListening"+Math.random().toString(36).slice(2);function jh(a){if(!a[Sc]){a[Sc]=!0,Gi.forEach(function(h){h!=="selectionchange"&&(qE.has(h)||Mh(h,!1,a),Mh(h,!0,a))});var o=a.nodeType===9?a:a.ownerDocument;o===null||o[Sc]||(o[Sc]=!0,Mh("selectionchange",!1,o))}}function sy(a,o,h,m){switch(ky(o)){case 2:var v=TA;break;case 8:v=EA;break;default:v=Jh}h=v.bind(null,o,h,a),v=void 0,!nd||o!=="touchstart"&&o!=="touchmove"&&o!=="wheel"||(v=!0),m?v!==void 0?a.addEventListener(o,h,{capture:!0,passive:v}):a.addEventListener(o,h,!0):v!==void 0?a.addEventListener(o,h,{passive:v}):a.addEventListener(o,h,!1)}function Fh(a,o,h,m,v){var b=m;if((o&1)===0&&(o&2)===0&&m!==null)e:for(;;){if(m===null)return;var R=m.tag;if(R===3||R===4){var N=m.stateNode.containerInfo;if(N===v)break;if(R===4)for(R=m.return;R!==null;){var B=R.tag;if((B===3||B===4)&&R.stateNode.containerInfo===v)return;R=R.return}for(;N!==null;){if(R=li(N),R===null)return;if(B=R.tag,B===5||B===6||B===26||B===27){m=b=R;continue e}N=N.parentNode}}m=m.return}lp(function(){var Z=b,oe=sd(h),me=[];e:{var J=Pp.get(a);if(J!==void 0){var ne=ko,Pe=a;switch(a){case"keypress":if(wo(h)===0)break e;case"keydown":case"keyup":ne=VT;break;case"focusin":Pe="focus",ne=od;break;case"focusout":Pe="blur",ne=od;break;case"beforeblur":case"afterblur":ne=od;break;case"click":if(h.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ne=up;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ne=wT;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ne=HT;break;case kp:case Np:case Op:ne=NT;break;case Dp:ne=KT;break;case"scroll":case"scrollend":ne=RT;break;case"wheel":ne=qT;break;case"copy":case"cut":case"paste":ne=DT;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ne=hp;break;case"toggle":case"beforetoggle":ne=WT}var $e=(o&4)!==0,Nt=!$e&&(a==="scroll"||a==="scrollend"),Y=$e?J!==null?J+"Capture":null:J;$e=[];for(var z=Z,X;z!==null;){var he=z;if(X=he.stateNode,he=he.tag,he!==5&&he!==26&&he!==27||X===null||Y===null||(he=cl(z,Y),he!=null&&$e.push($l(z,he,X))),Nt)break;z=z.return}0<$e.length&&(J=new ne(J,Pe,null,h,oe),me.push({event:J,listeners:$e}))}}if((o&7)===0){e:{if(J=a==="mouseover"||a==="pointerover",ne=a==="mouseout"||a==="pointerout",J&&h!==ol&&(Pe=h.relatedTarget||h.fromElement)&&(li(Pe)||Pe[Sn]))break e;if((ne||J)&&(J=oe.window===oe?oe:(J=oe.ownerDocument)?J.defaultView||J.parentWindow:window,ne?(Pe=h.relatedTarget||h.toElement,ne=Z,Pe=Pe?li(Pe):null,Pe!==null&&(Nt=r(Pe),$e=Pe.tag,Pe!==Nt||$e!==5&&$e!==27&&$e!==6)&&(Pe=null)):(ne=null,Pe=Z),ne!==Pe)){if($e=up,he="onMouseLeave",Y="onMouseEnter",z="mouse",(a==="pointerout"||a==="pointerover")&&($e=hp,he="onPointerLeave",Y="onPointerEnter",z="pointer"),Nt=ne==null?J:Yn(ne),X=Pe==null?J:Yn(Pe),J=new $e(he,z+"leave",ne,h,oe),J.target=Nt,J.relatedTarget=X,he=null,li(oe)===Z&&($e=new $e(Y,z+"enter",Pe,h,oe),$e.target=X,$e.relatedTarget=Nt,he=$e),Nt=he,ne&&Pe)t:{for($e=QE,Y=ne,z=Pe,X=0,he=Y;he;he=$e(he))X++;he=0;for(var Ve=z;Ve;Ve=$e(Ve))he++;for(;0<X-he;)Y=$e(Y),X--;for(;0<he-X;)z=$e(z),he--;for(;X--;){if(Y===z||z!==null&&Y===z.alternate){$e=Y;break t}Y=$e(Y),z=$e(z)}$e=null}else $e=null;ne!==null&&iy(me,J,ne,$e,!1),Pe!==null&&Nt!==null&&iy(me,Nt,Pe,$e,!0)}}e:{if(J=Z?Yn(Z):window,ne=J.nodeName&&J.nodeName.toLowerCase(),ne==="select"||ne==="input"&&J.type==="file")var vt=Sp;else if(vp(J))if(bp)vt=rE;else{vt=nE;var Me=iE}else ne=J.nodeName,!ne||ne.toLowerCase()!=="input"||J.type!=="checkbox"&&J.type!=="radio"?Z&&Wn(Z.elementType)&&(vt=Sp):vt=aE;if(vt&&(vt=vt(a,Z))){xp(me,vt,h,oe);break e}Me&&Me(a,J,Z),a==="focusout"&&Z&&J.type==="number"&&Z.memoizedProps.value!=null&&nt(J,"number",J.value)}switch(Me=Z?Yn(Z):window,a){case"focusin":(vp(Me)||Me.contentEditable==="true")&&(ur=Me,md=Z,yl=null);break;case"focusout":yl=md=ur=null;break;case"mousedown":pd=!0;break;case"contextmenu":case"mouseup":case"dragend":pd=!1,wp(me,h,oe);break;case"selectionchange":if(oE)break;case"keydown":case"keyup":wp(me,h,oe)}var et;if(ud)e:{switch(a){case"compositionstart":var ut="onCompositionStart";break e;case"compositionend":ut="onCompositionEnd";break e;case"compositionupdate":ut="onCompositionUpdate";break e}ut=void 0}else cr?gp(a,h)&&(ut="onCompositionEnd"):a==="keydown"&&h.keyCode===229&&(ut="onCompositionStart");ut&&(fp&&h.locale!=="ko"&&(cr||ut!=="onCompositionStart"?ut==="onCompositionEnd"&&cr&&(et=op()):(Xn=oe,ad="value"in Xn?Xn.value:Xn.textContent,cr=!0)),Me=bc(Z,ut),0<Me.length&&(ut=new dp(ut,a,null,h,oe),me.push({event:ut,listeners:Me}),et?ut.data=et:(et=yp(h),et!==null&&(ut.data=et)))),(et=ZT?JT(a,h):eE(a,h))&&(ut=bc(Z,"onBeforeInput"),0<ut.length&&(Me=new dp("onBeforeInput","beforeinput",null,h,oe),me.push({event:Me,listeners:ut}),Me.data=et)),zE(me,a,Z,h,oe)}ty(me,o)})}function $l(a,o,h){return{instance:a,listener:o,currentTarget:h}}function bc(a,o){for(var h=o+"Capture",m=[];a!==null;){var v=a,b=v.stateNode;if(v=v.tag,v!==5&&v!==26&&v!==27||b===null||(v=cl(a,h),v!=null&&m.unshift($l(a,v,b)),v=cl(a,o),v!=null&&m.push($l(a,v,b))),a.tag===3)return m;a=a.return}return[]}function QE(a){if(a===null)return null;do a=a.return;while(a&&a.tag!==5&&a.tag!==27);return a||null}function iy(a,o,h,m,v){for(var b=o._reactName,R=[];h!==null&&h!==m;){var N=h,B=N.alternate,Z=N.stateNode;if(N=N.tag,B!==null&&B===m)break;N!==5&&N!==26&&N!==27||Z===null||(B=Z,v?(Z=cl(h,b),Z!=null&&R.unshift($l(h,Z,B))):v||(Z=cl(h,b),Z!=null&&R.push($l(h,Z,B)))),h=h.return}R.length!==0&&a.push({event:o,listeners:R})}var WE=/\r\n?/g,XE=/\u0000|\uFFFD/g;function ny(a){return(typeof a=="string"?a:""+a).replace(WE,`
`).replace(XE,"")}function ay(a,o){return o=ny(o),ny(a)===o}function kt(a,o,h,m,v,b){switch(h){case"children":typeof m=="string"?o==="body"||o==="textarea"&&m===""||ps(a,m):(typeof m=="number"||typeof m=="bigint")&&o!=="body"&&ps(a,""+m);break;case"className":sr(a,"class",m);break;case"tabIndex":sr(a,"tabindex",m);break;case"dir":case"role":case"viewBox":case"width":case"height":sr(a,h,m);break;case"style":ar(a,m,b);break;case"data":if(o!=="object"){sr(a,"data",m);break}case"src":case"href":if(m===""&&(o!=="a"||h!=="href")){a.removeAttribute(h);break}if(m==null||typeof m=="function"||typeof m=="symbol"||typeof m=="boolean"){a.removeAttribute(h);break}m=Hs(""+m),a.setAttribute(h,m);break;case"action":case"formAction":if(typeof m=="function"){a.setAttribute(h,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof b=="function"&&(h==="formAction"?(o!=="input"&&kt(a,o,"name",v.name,v,null),kt(a,o,"formEncType",v.formEncType,v,null),kt(a,o,"formMethod",v.formMethod,v,null),kt(a,o,"formTarget",v.formTarget,v,null)):(kt(a,o,"encType",v.encType,v,null),kt(a,o,"method",v.method,v,null),kt(a,o,"target",v.target,v,null)));if(m==null||typeof m=="symbol"||typeof m=="boolean"){a.removeAttribute(h);break}m=Hs(""+m),a.setAttribute(h,m);break;case"onClick":m!=null&&(a.onclick=Hi);break;case"onScroll":m!=null&&ot("scroll",a);break;case"onScrollEnd":m!=null&&ot("scrollend",a);break;case"dangerouslySetInnerHTML":if(m!=null){if(typeof m!="object"||!("__html"in m))throw Error(s(61));if(h=m.__html,h!=null){if(v.children!=null)throw Error(s(60));a.innerHTML=h}}break;case"multiple":a.multiple=m&&typeof m!="function"&&typeof m!="symbol";break;case"muted":a.muted=m&&typeof m!="function"&&typeof m!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(m==null||typeof m=="function"||typeof m=="boolean"||typeof m=="symbol"){a.removeAttribute("xlink:href");break}h=Hs(""+m),a.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",h);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":m!=null&&typeof m!="function"&&typeof m!="symbol"?a.setAttribute(h,""+m):a.removeAttribute(h);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":m&&typeof m!="function"&&typeof m!="symbol"?a.setAttribute(h,""):a.removeAttribute(h);break;case"capture":case"download":m===!0?a.setAttribute(h,""):m!==!1&&m!=null&&typeof m!="function"&&typeof m!="symbol"?a.setAttribute(h,m):a.removeAttribute(h);break;case"cols":case"rows":case"size":case"span":m!=null&&typeof m!="function"&&typeof m!="symbol"&&!isNaN(m)&&1<=m?a.setAttribute(h,m):a.removeAttribute(h);break;case"rowSpan":case"start":m==null||typeof m=="function"||typeof m=="symbol"||isNaN(m)?a.removeAttribute(h):a.setAttribute(h,m);break;case"popover":ot("beforetoggle",a),ot("toggle",a),tr(a,"popover",m);break;case"xlinkActuate":$s(a,"http://www.w3.org/1999/xlink","xlink:actuate",m);break;case"xlinkArcrole":$s(a,"http://www.w3.org/1999/xlink","xlink:arcrole",m);break;case"xlinkRole":$s(a,"http://www.w3.org/1999/xlink","xlink:role",m);break;case"xlinkShow":$s(a,"http://www.w3.org/1999/xlink","xlink:show",m);break;case"xlinkTitle":$s(a,"http://www.w3.org/1999/xlink","xlink:title",m);break;case"xlinkType":$s(a,"http://www.w3.org/1999/xlink","xlink:type",m);break;case"xmlBase":$s(a,"http://www.w3.org/XML/1998/namespace","xml:base",m);break;case"xmlLang":$s(a,"http://www.w3.org/XML/1998/namespace","xml:lang",m);break;case"xmlSpace":$s(a,"http://www.w3.org/XML/1998/namespace","xml:space",m);break;case"is":tr(a,"is",m);break;case"innerText":case"textContent":break;default:(!(2<h.length)||h[0]!=="o"&&h[0]!=="O"||h[1]!=="n"&&h[1]!=="N")&&(h=ll.get(h)||h,tr(a,h,m))}}function Bh(a,o,h,m,v,b){switch(h){case"style":ar(a,m,b);break;case"dangerouslySetInnerHTML":if(m!=null){if(typeof m!="object"||!("__html"in m))throw Error(s(61));if(h=m.__html,h!=null){if(v.children!=null)throw Error(s(60));a.innerHTML=h}}break;case"children":typeof m=="string"?ps(a,m):(typeof m=="number"||typeof m=="bigint")&&ps(a,""+m);break;case"onScroll":m!=null&&ot("scroll",a);break;case"onScrollEnd":m!=null&&ot("scrollend",a);break;case"onClick":m!=null&&(a.onclick=Hi);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!al.hasOwnProperty(h))e:{if(h[0]==="o"&&h[1]==="n"&&(v=h.endsWith("Capture"),o=h.slice(2,v?h.length-7:void 0),b=a[mt]||null,b=b!=null?b[h]:null,typeof b=="function"&&a.removeEventListener(o,b,v),typeof m=="function")){typeof b!="function"&&b!==null&&(h in a?a[h]=null:a.hasAttribute(h)&&a.removeAttribute(h)),a.addEventListener(o,m,v);break e}h in a?a[h]=m:m===!0?a.setAttribute(h,""):tr(a,h,m)}}}function Ls(a,o,h){switch(o){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":ot("error",a),ot("load",a);var m=!1,v=!1,b;for(b in h)if(h.hasOwnProperty(b)){var R=h[b];if(R!=null)switch(b){case"src":m=!0;break;case"srcSet":v=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(s(137,o));default:kt(a,o,b,R,h,null)}}v&&kt(a,o,"srcSet",h.srcSet,h,null),m&&kt(a,o,"src",h.src,h,null);return;case"input":ot("invalid",a);var N=b=R=v=null,B=null,Z=null;for(m in h)if(h.hasOwnProperty(m)){var oe=h[m];if(oe!=null)switch(m){case"name":v=oe;break;case"type":R=oe;break;case"checked":B=oe;break;case"defaultChecked":Z=oe;break;case"value":b=oe;break;case"defaultValue":N=oe;break;case"children":case"dangerouslySetInnerHTML":if(oe!=null)throw Error(s(137,o));break;default:kt(a,o,m,oe,h,null)}}tt(a,b,N,B,Z,R,v,!1);return;case"select":ot("invalid",a),m=R=b=null;for(v in h)if(h.hasOwnProperty(v)&&(N=h[v],N!=null))switch(v){case"value":b=N;break;case"defaultValue":R=N;break;case"multiple":m=N;default:kt(a,o,v,N,h,null)}o=b,h=R,a.multiple=!!m,o!=null?yt(a,!!m,o,!1):h!=null&&yt(a,!!m,h,!0);return;case"textarea":ot("invalid",a),b=v=m=null;for(R in h)if(h.hasOwnProperty(R)&&(N=h[R],N!=null))switch(R){case"value":m=N;break;case"defaultValue":v=N;break;case"children":b=N;break;case"dangerouslySetInnerHTML":if(N!=null)throw Error(s(91));break;default:kt(a,o,R,N,h,null)}ht(a,m,v,b);return;case"option":for(B in h)h.hasOwnProperty(B)&&(m=h[B],m!=null)&&(B==="selected"?a.selected=m&&typeof m!="function"&&typeof m!="symbol":kt(a,o,B,m,h,null));return;case"dialog":ot("beforetoggle",a),ot("toggle",a),ot("cancel",a),ot("close",a);break;case"iframe":case"object":ot("load",a);break;case"video":case"audio":for(m=0;m<Vl.length;m++)ot(Vl[m],a);break;case"image":ot("error",a),ot("load",a);break;case"details":ot("toggle",a);break;case"embed":case"source":case"link":ot("error",a),ot("load",a);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Z in h)if(h.hasOwnProperty(Z)&&(m=h[Z],m!=null))switch(Z){case"children":case"dangerouslySetInnerHTML":throw Error(s(137,o));default:kt(a,o,Z,m,h,null)}return;default:if(Wn(o)){for(oe in h)h.hasOwnProperty(oe)&&(m=h[oe],m!==void 0&&Bh(a,o,oe,m,h,void 0));return}}for(N in h)h.hasOwnProperty(N)&&(m=h[N],m!=null&&kt(a,o,N,m,h,null))}function ZE(a,o,h,m){switch(o){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var v=null,b=null,R=null,N=null,B=null,Z=null,oe=null;for(ne in h){var me=h[ne];if(h.hasOwnProperty(ne)&&me!=null)switch(ne){case"checked":break;case"value":break;case"defaultValue":B=me;default:m.hasOwnProperty(ne)||kt(a,o,ne,null,m,me)}}for(var J in m){var ne=m[J];if(me=h[J],m.hasOwnProperty(J)&&(ne!=null||me!=null))switch(J){case"type":b=ne;break;case"name":v=ne;break;case"checked":Z=ne;break;case"defaultChecked":oe=ne;break;case"value":R=ne;break;case"defaultValue":N=ne;break;case"children":case"dangerouslySetInnerHTML":if(ne!=null)throw Error(s(137,o));break;default:ne!==me&&kt(a,o,J,ne,m,me)}}xe(a,R,N,B,Z,oe,b,v);return;case"select":ne=R=N=J=null;for(b in h)if(B=h[b],h.hasOwnProperty(b)&&B!=null)switch(b){case"value":break;case"multiple":ne=B;default:m.hasOwnProperty(b)||kt(a,o,b,null,m,B)}for(v in m)if(b=m[v],B=h[v],m.hasOwnProperty(v)&&(b!=null||B!=null))switch(v){case"value":J=b;break;case"defaultValue":N=b;break;case"multiple":R=b;default:b!==B&&kt(a,o,v,b,m,B)}o=N,h=R,m=ne,J!=null?yt(a,!!h,J,!1):!!m!=!!h&&(o!=null?yt(a,!!h,o,!0):yt(a,!!h,h?[]:"",!1));return;case"textarea":ne=J=null;for(N in h)if(v=h[N],h.hasOwnProperty(N)&&v!=null&&!m.hasOwnProperty(N))switch(N){case"value":break;case"children":break;default:kt(a,o,N,null,m,v)}for(R in m)if(v=m[R],b=h[R],m.hasOwnProperty(R)&&(v!=null||b!=null))switch(R){case"value":J=v;break;case"defaultValue":ne=v;break;case"children":break;case"dangerouslySetInnerHTML":if(v!=null)throw Error(s(91));break;default:v!==b&&kt(a,o,R,v,m,b)}Mt(a,J,ne);return;case"option":for(var Pe in h)J=h[Pe],h.hasOwnProperty(Pe)&&J!=null&&!m.hasOwnProperty(Pe)&&(Pe==="selected"?a.selected=!1:kt(a,o,Pe,null,m,J));for(B in m)J=m[B],ne=h[B],m.hasOwnProperty(B)&&J!==ne&&(J!=null||ne!=null)&&(B==="selected"?a.selected=J&&typeof J!="function"&&typeof J!="symbol":kt(a,o,B,J,m,ne));return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var $e in h)J=h[$e],h.hasOwnProperty($e)&&J!=null&&!m.hasOwnProperty($e)&&kt(a,o,$e,null,m,J);for(Z in m)if(J=m[Z],ne=h[Z],m.hasOwnProperty(Z)&&J!==ne&&(J!=null||ne!=null))switch(Z){case"children":case"dangerouslySetInnerHTML":if(J!=null)throw Error(s(137,o));break;default:kt(a,o,Z,J,m,ne)}return;default:if(Wn(o)){for(var Nt in h)J=h[Nt],h.hasOwnProperty(Nt)&&J!==void 0&&!m.hasOwnProperty(Nt)&&Bh(a,o,Nt,void 0,m,J);for(oe in m)J=m[oe],ne=h[oe],!m.hasOwnProperty(oe)||J===ne||J===void 0&&ne===void 0||Bh(a,o,oe,J,m,ne);return}}for(var Y in h)J=h[Y],h.hasOwnProperty(Y)&&J!=null&&!m.hasOwnProperty(Y)&&kt(a,o,Y,null,m,J);for(me in m)J=m[me],ne=h[me],!m.hasOwnProperty(me)||J===ne||J==null&&ne==null||kt(a,o,me,J,m,ne)}function ry(a){switch(a){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function JE(){if(typeof performance.getEntriesByType=="function"){for(var a=0,o=0,h=performance.getEntriesByType("resource"),m=0;m<h.length;m++){var v=h[m],b=v.transferSize,R=v.initiatorType,N=v.duration;if(b&&N&&ry(R)){for(R=0,N=v.responseEnd,m+=1;m<h.length;m++){var B=h[m],Z=B.startTime;if(Z>N)break;var oe=B.transferSize,me=B.initiatorType;oe&&ry(me)&&(B=B.responseEnd,R+=oe*(B<N?1:(N-Z)/(B-Z)))}if(--m,o+=8*(b+R)/(v.duration/1e3),a++,10<a)break}}if(0<a)return o/a/1e6}return navigator.connection&&(a=navigator.connection.downlink,typeof a=="number")?a:5}var Vh=null,$h=null;function Tc(a){return a.nodeType===9?a:a.ownerDocument}function ly(a){switch(a){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function oy(a,o){if(a===0)switch(o){case"svg":return 1;case"math":return 2;default:return 0}return a===1&&o==="foreignObject"?0:a}function Gh(a,o){return a==="textarea"||a==="noscript"||typeof o.children=="string"||typeof o.children=="number"||typeof o.children=="bigint"||typeof o.dangerouslySetInnerHTML=="object"&&o.dangerouslySetInnerHTML!==null&&o.dangerouslySetInnerHTML.__html!=null}var Hh=null;function eA(){var a=window.event;return a&&a.type==="popstate"?a===Hh?!1:(Hh=a,!0):(Hh=null,!1)}var cy=typeof setTimeout=="function"?setTimeout:void 0,tA=typeof clearTimeout=="function"?clearTimeout:void 0,uy=typeof Promise=="function"?Promise:void 0,sA=typeof queueMicrotask=="function"?queueMicrotask:typeof uy<"u"?function(a){return uy.resolve(null).then(a).catch(iA)}:cy;function iA(a){setTimeout(function(){throw a})}function ma(a){return a==="head"}function dy(a,o){var h=o,m=0;do{var v=h.nextSibling;if(a.removeChild(h),v&&v.nodeType===8)if(h=v.data,h==="/$"||h==="/&"){if(m===0){a.removeChild(v),Mr(o);return}m--}else if(h==="$"||h==="$?"||h==="$~"||h==="$!"||h==="&")m++;else if(h==="html")Gl(a.ownerDocument.documentElement);else if(h==="head"){h=a.ownerDocument.head,Gl(h);for(var b=h.firstChild;b;){var R=b.nextSibling,N=b.nodeName;b[Ri]||N==="SCRIPT"||N==="STYLE"||N==="LINK"&&b.rel.toLowerCase()==="stylesheet"||h.removeChild(b),b=R}}else h==="body"&&Gl(a.ownerDocument.body);h=v}while(h);Mr(o)}function hy(a,o){var h=a;a=0;do{var m=h.nextSibling;if(h.nodeType===1?o?(h._stashedDisplay=h.style.display,h.style.display="none"):(h.style.display=h._stashedDisplay||"",h.getAttribute("style")===""&&h.removeAttribute("style")):h.nodeType===3&&(o?(h._stashedText=h.nodeValue,h.nodeValue=""):h.nodeValue=h._stashedText||""),m&&m.nodeType===8)if(h=m.data,h==="/$"){if(a===0)break;a--}else h!=="$"&&h!=="$?"&&h!=="$~"&&h!=="$!"||a++;h=m}while(h)}function zh(a){var o=a.firstChild;for(o&&o.nodeType===10&&(o=o.nextSibling);o;){var h=o;switch(o=o.nextSibling,h.nodeName){case"HTML":case"HEAD":case"BODY":zh(h),La(h);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(h.rel.toLowerCase()==="stylesheet")continue}a.removeChild(h)}}function nA(a,o,h,m){for(;a.nodeType===1;){var v=h;if(a.nodeName.toLowerCase()!==o.toLowerCase()){if(!m&&(a.nodeName!=="INPUT"||a.type!=="hidden"))break}else if(m){if(!a[Ri])switch(o){case"meta":if(!a.hasAttribute("itemprop"))break;return a;case"link":if(b=a.getAttribute("rel"),b==="stylesheet"&&a.hasAttribute("data-precedence"))break;if(b!==v.rel||a.getAttribute("href")!==(v.href==null||v.href===""?null:v.href)||a.getAttribute("crossorigin")!==(v.crossOrigin==null?null:v.crossOrigin)||a.getAttribute("title")!==(v.title==null?null:v.title))break;return a;case"style":if(a.hasAttribute("data-precedence"))break;return a;case"script":if(b=a.getAttribute("src"),(b!==(v.src==null?null:v.src)||a.getAttribute("type")!==(v.type==null?null:v.type)||a.getAttribute("crossorigin")!==(v.crossOrigin==null?null:v.crossOrigin))&&b&&a.hasAttribute("async")&&!a.hasAttribute("itemprop"))break;return a;default:return a}}else if(o==="input"&&a.type==="hidden"){var b=v.name==null?null:""+v.name;if(v.type==="hidden"&&a.getAttribute("name")===b)return a}else return a;if(a=Di(a.nextSibling),a===null)break}return null}function aA(a,o,h){if(o==="")return null;for(;a.nodeType!==3;)if((a.nodeType!==1||a.nodeName!=="INPUT"||a.type!=="hidden")&&!h||(a=Di(a.nextSibling),a===null))return null;return a}function fy(a,o){for(;a.nodeType!==8;)if((a.nodeType!==1||a.nodeName!=="INPUT"||a.type!=="hidden")&&!o||(a=Di(a.nextSibling),a===null))return null;return a}function Kh(a){return a.data==="$?"||a.data==="$~"}function Yh(a){return a.data==="$!"||a.data==="$?"&&a.ownerDocument.readyState!=="loading"}function rA(a,o){var h=a.ownerDocument;if(a.data==="$~")a._reactRetry=o;else if(a.data!=="$?"||h.readyState!=="loading")o();else{var m=function(){o(),h.removeEventListener("DOMContentLoaded",m)};h.addEventListener("DOMContentLoaded",m),a._reactRetry=m}}function Di(a){for(;a!=null;a=a.nextSibling){var o=a.nodeType;if(o===1||o===3)break;if(o===8){if(o=a.data,o==="$"||o==="$!"||o==="$?"||o==="$~"||o==="&"||o==="F!"||o==="F")break;if(o==="/$"||o==="/&")return null}}return a}var qh=null;function my(a){a=a.nextSibling;for(var o=0;a;){if(a.nodeType===8){var h=a.data;if(h==="/$"||h==="/&"){if(o===0)return Di(a.nextSibling);o--}else h!=="$"&&h!=="$!"&&h!=="$?"&&h!=="$~"&&h!=="&"||o++}a=a.nextSibling}return null}function py(a){a=a.previousSibling;for(var o=0;a;){if(a.nodeType===8){var h=a.data;if(h==="$"||h==="$!"||h==="$?"||h==="$~"||h==="&"){if(o===0)return a;o--}else h!=="/$"&&h!=="/&"||o++}a=a.previousSibling}return null}function gy(a,o,h){switch(o=Tc(h),a){case"html":if(a=o.documentElement,!a)throw Error(s(452));return a;case"head":if(a=o.head,!a)throw Error(s(453));return a;case"body":if(a=o.body,!a)throw Error(s(454));return a;default:throw Error(s(451))}}function Gl(a){for(var o=a.attributes;o.length;)a.removeAttributeNode(o[0]);La(a)}var Pi=new Map,yy=new Set;function Ec(a){return typeof a.getRootNode=="function"?a.getRootNode():a.nodeType===9?a:a.ownerDocument}var Mn=V.d;V.d={f:lA,r:oA,D:cA,C:uA,L:dA,m:hA,X:mA,S:fA,M:pA};function lA(){var a=Mn.f(),o=mc();return a||o}function oA(a){var o=bn(a);o!==null&&o.tag===5&&o.type==="form"?Dg(o):Mn.r(a)}var Dr=typeof document>"u"?null:document;function vy(a,o,h){var m=Dr;if(m&&typeof o=="string"&&o){var v=se(o);v='link[rel="'+a+'"][href="'+v+'"]',typeof h=="string"&&(v+='[crossorigin="'+h+'"]'),yy.has(v)||(yy.add(v),a={rel:a,crossOrigin:h,href:o},m.querySelector(v)===null&&(o=m.createElement("link"),Ls(o,"link",a),is(o),m.head.appendChild(o)))}}function cA(a){Mn.D(a),vy("dns-prefetch",a,null)}function uA(a,o){Mn.C(a,o),vy("preconnect",a,o)}function dA(a,o,h){Mn.L(a,o,h);var m=Dr;if(m&&a&&o){var v='link[rel="preload"][as="'+se(o)+'"]';o==="image"&&h&&h.imageSrcSet?(v+='[imagesrcset="'+se(h.imageSrcSet)+'"]',typeof h.imageSizes=="string"&&(v+='[imagesizes="'+se(h.imageSizes)+'"]')):v+='[href="'+se(a)+'"]';var b=v;switch(o){case"style":b=Pr(a);break;case"script":b=Ur(a)}Pi.has(b)||(a=g({rel:"preload",href:o==="image"&&h&&h.imageSrcSet?void 0:a,as:o},h),Pi.set(b,a),m.querySelector(v)!==null||o==="style"&&m.querySelector(Hl(b))||o==="script"&&m.querySelector(zl(b))||(o=m.createElement("link"),Ls(o,"link",a),is(o),m.head.appendChild(o)))}}function hA(a,o){Mn.m(a,o);var h=Dr;if(h&&a){var m=o&&typeof o.as=="string"?o.as:"script",v='link[rel="modulepreload"][as="'+se(m)+'"][href="'+se(a)+'"]',b=v;switch(m){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":b=Ur(a)}if(!Pi.has(b)&&(a=g({rel:"modulepreload",href:a},o),Pi.set(b,a),h.querySelector(v)===null)){switch(m){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(h.querySelector(zl(b)))return}m=h.createElement("link"),Ls(m,"link",a),is(m),h.head.appendChild(m)}}}function fA(a,o,h){Mn.S(a,o,h);var m=Dr;if(m&&a){var v=en(m).hoistableStyles,b=Pr(a);o=o||"default";var R=v.get(b);if(!R){var N={loading:0,preload:null};if(R=m.querySelector(Hl(b)))N.loading=5;else{a=g({rel:"stylesheet",href:a,"data-precedence":o},h),(h=Pi.get(b))&&Qh(a,h);var B=R=m.createElement("link");is(B),Ls(B,"link",a),B._p=new Promise(function(Z,oe){B.onload=Z,B.onerror=oe}),B.addEventListener("load",function(){N.loading|=1}),B.addEventListener("error",function(){N.loading|=2}),N.loading|=4,Ac(R,o,m)}R={type:"stylesheet",instance:R,count:1,state:N},v.set(b,R)}}}function mA(a,o){Mn.X(a,o);var h=Dr;if(h&&a){var m=en(h).hoistableScripts,v=Ur(a),b=m.get(v);b||(b=h.querySelector(zl(v)),b||(a=g({src:a,async:!0},o),(o=Pi.get(v))&&Wh(a,o),b=h.createElement("script"),is(b),Ls(b,"link",a),h.head.appendChild(b)),b={type:"script",instance:b,count:1,state:null},m.set(v,b))}}function pA(a,o){Mn.M(a,o);var h=Dr;if(h&&a){var m=en(h).hoistableScripts,v=Ur(a),b=m.get(v);b||(b=h.querySelector(zl(v)),b||(a=g({src:a,async:!0,type:"module"},o),(o=Pi.get(v))&&Wh(a,o),b=h.createElement("script"),is(b),Ls(b,"link",a),h.head.appendChild(b)),b={type:"script",instance:b,count:1,state:null},m.set(v,b))}}function xy(a,o,h,m){var v=(v=_e.current)?Ec(v):null;if(!v)throw Error(s(446));switch(a){case"meta":case"title":return null;case"style":return typeof h.precedence=="string"&&typeof h.href=="string"?(o=Pr(h.href),h=en(v).hoistableStyles,m=h.get(o),m||(m={type:"style",instance:null,count:0,state:null},h.set(o,m)),m):{type:"void",instance:null,count:0,state:null};case"link":if(h.rel==="stylesheet"&&typeof h.href=="string"&&typeof h.precedence=="string"){a=Pr(h.href);var b=en(v).hoistableStyles,R=b.get(a);if(R||(v=v.ownerDocument||v,R={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},b.set(a,R),(b=v.querySelector(Hl(a)))&&!b._p&&(R.instance=b,R.state.loading=5),Pi.has(a)||(h={rel:"preload",as:"style",href:h.href,crossOrigin:h.crossOrigin,integrity:h.integrity,media:h.media,hrefLang:h.hrefLang,referrerPolicy:h.referrerPolicy},Pi.set(a,h),b||gA(v,a,h,R.state))),o&&m===null)throw Error(s(528,""));return R}if(o&&m!==null)throw Error(s(529,""));return null;case"script":return o=h.async,h=h.src,typeof h=="string"&&o&&typeof o!="function"&&typeof o!="symbol"?(o=Ur(h),h=en(v).hoistableScripts,m=h.get(o),m||(m={type:"script",instance:null,count:0,state:null},h.set(o,m)),m):{type:"void",instance:null,count:0,state:null};default:throw Error(s(444,a))}}function Pr(a){return'href="'+se(a)+'"'}function Hl(a){return'link[rel="stylesheet"]['+a+"]"}function Sy(a){return g({},a,{"data-precedence":a.precedence,precedence:null})}function gA(a,o,h,m){a.querySelector('link[rel="preload"][as="style"]['+o+"]")?m.loading=1:(o=a.createElement("link"),m.preload=o,o.addEventListener("load",function(){return m.loading|=1}),o.addEventListener("error",function(){return m.loading|=2}),Ls(o,"link",h),is(o),a.head.appendChild(o))}function Ur(a){return'[src="'+se(a)+'"]'}function zl(a){return"script[async]"+a}function by(a,o,h){if(o.count++,o.instance===null)switch(o.type){case"style":var m=a.querySelector('style[data-href~="'+se(h.href)+'"]');if(m)return o.instance=m,is(m),m;var v=g({},h,{"data-href":h.href,"data-precedence":h.precedence,href:null,precedence:null});return m=(a.ownerDocument||a).createElement("style"),is(m),Ls(m,"style",v),Ac(m,h.precedence,a),o.instance=m;case"stylesheet":v=Pr(h.href);var b=a.querySelector(Hl(v));if(b)return o.state.loading|=4,o.instance=b,is(b),b;m=Sy(h),(v=Pi.get(v))&&Qh(m,v),b=(a.ownerDocument||a).createElement("link"),is(b);var R=b;return R._p=new Promise(function(N,B){R.onload=N,R.onerror=B}),Ls(b,"link",m),o.state.loading|=4,Ac(b,h.precedence,a),o.instance=b;case"script":return b=Ur(h.src),(v=a.querySelector(zl(b)))?(o.instance=v,is(v),v):(m=h,(v=Pi.get(b))&&(m=g({},h),Wh(m,v)),a=a.ownerDocument||a,v=a.createElement("script"),is(v),Ls(v,"link",m),a.head.appendChild(v),o.instance=v);case"void":return null;default:throw Error(s(443,o.type))}else o.type==="stylesheet"&&(o.state.loading&4)===0&&(m=o.instance,o.state.loading|=4,Ac(m,h.precedence,a));return o.instance}function Ac(a,o,h){for(var m=h.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),v=m.length?m[m.length-1]:null,b=v,R=0;R<m.length;R++){var N=m[R];if(N.dataset.precedence===o)b=N;else if(b!==v)break}b?b.parentNode.insertBefore(a,b.nextSibling):(o=h.nodeType===9?h.head:h,o.insertBefore(a,o.firstChild))}function Qh(a,o){a.crossOrigin==null&&(a.crossOrigin=o.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=o.referrerPolicy),a.title==null&&(a.title=o.title)}function Wh(a,o){a.crossOrigin==null&&(a.crossOrigin=o.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=o.referrerPolicy),a.integrity==null&&(a.integrity=o.integrity)}var _c=null;function Ty(a,o,h){if(_c===null){var m=new Map,v=_c=new Map;v.set(h,m)}else v=_c,m=v.get(h),m||(m=new Map,v.set(h,m));if(m.has(a))return m;for(m.set(a,null),h=h.getElementsByTagName(a),v=0;v<h.length;v++){var b=h[v];if(!(b[Ri]||b[_t]||a==="link"&&b.getAttribute("rel")==="stylesheet")&&b.namespaceURI!=="http://www.w3.org/2000/svg"){var R=b.getAttribute(o)||"";R=a+R;var N=m.get(R);N?N.push(b):m.set(R,[b])}}return m}function Ey(a,o,h){a=a.ownerDocument||a,a.head.insertBefore(h,o==="title"?a.querySelector("head > title"):null)}function yA(a,o,h){if(h===1||o.itemProp!=null)return!1;switch(a){case"meta":case"title":return!0;case"style":if(typeof o.precedence!="string"||typeof o.href!="string"||o.href==="")break;return!0;case"link":if(typeof o.rel!="string"||typeof o.href!="string"||o.href===""||o.onLoad||o.onError)break;return o.rel==="stylesheet"?(a=o.disabled,typeof o.precedence=="string"&&a==null):!0;case"script":if(o.async&&typeof o.async!="function"&&typeof o.async!="symbol"&&!o.onLoad&&!o.onError&&o.src&&typeof o.src=="string")return!0}return!1}function Ay(a){return!(a.type==="stylesheet"&&(a.state.loading&3)===0)}function vA(a,o,h,m){if(h.type==="stylesheet"&&(typeof m.media!="string"||matchMedia(m.media).matches!==!1)&&(h.state.loading&4)===0){if(h.instance===null){var v=Pr(m.href),b=o.querySelector(Hl(v));if(b){o=b._p,o!==null&&typeof o=="object"&&typeof o.then=="function"&&(a.count++,a=Ic.bind(a),o.then(a,a)),h.state.loading|=4,h.instance=b,is(b);return}b=o.ownerDocument||o,m=Sy(m),(v=Pi.get(v))&&Qh(m,v),b=b.createElement("link"),is(b);var R=b;R._p=new Promise(function(N,B){R.onload=N,R.onerror=B}),Ls(b,"link",m),h.instance=b}a.stylesheets===null&&(a.stylesheets=new Map),a.stylesheets.set(h,o),(o=h.state.preload)&&(h.state.loading&3)===0&&(a.count++,h=Ic.bind(a),o.addEventListener("load",h),o.addEventListener("error",h))}}var Xh=0;function xA(a,o){return a.stylesheets&&a.count===0&&Lc(a,a.stylesheets),0<a.count||0<a.imgCount?function(h){var m=setTimeout(function(){if(a.stylesheets&&Lc(a,a.stylesheets),a.unsuspend){var b=a.unsuspend;a.unsuspend=null,b()}},6e4+o);0<a.imgBytes&&Xh===0&&(Xh=62500*JE());var v=setTimeout(function(){if(a.waitingForImages=!1,a.count===0&&(a.stylesheets&&Lc(a,a.stylesheets),a.unsuspend)){var b=a.unsuspend;a.unsuspend=null,b()}},(a.imgBytes>Xh?50:800)+o);return a.unsuspend=h,function(){a.unsuspend=null,clearTimeout(m),clearTimeout(v)}}:null}function Ic(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)Lc(this,this.stylesheets);else if(this.unsuspend){var a=this.unsuspend;this.unsuspend=null,a()}}}var Rc=null;function Lc(a,o){a.stylesheets=null,a.unsuspend!==null&&(a.count++,Rc=new Map,o.forEach(SA,a),Rc=null,Ic.call(a))}function SA(a,o){if(!(o.state.loading&4)){var h=Rc.get(a);if(h)var m=h.get(null);else{h=new Map,Rc.set(a,h);for(var v=a.querySelectorAll("link[data-precedence],style[data-precedence]"),b=0;b<v.length;b++){var R=v[b];(R.nodeName==="LINK"||R.getAttribute("media")!=="not all")&&(h.set(R.dataset.precedence,R),m=R)}m&&h.set(null,m)}v=o.instance,R=v.getAttribute("data-precedence"),b=h.get(R)||m,b===m&&h.set(null,v),h.set(R,v),this.count++,m=Ic.bind(this),v.addEventListener("load",m),v.addEventListener("error",m),b?b.parentNode.insertBefore(v,b.nextSibling):(a=a.nodeType===9?a.head:a,a.insertBefore(v,a.firstChild)),o.state.loading|=4}}var Kl={$$typeof:_,Provider:null,Consumer:null,_currentValue:q,_currentValue2:q,_threadCount:0};function bA(a,o,h,m,v,b,R,N,B){this.tag=1,this.containerInfo=a,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=ai(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ai(0),this.hiddenUpdates=ai(null),this.identifierPrefix=m,this.onUncaughtError=v,this.onCaughtError=b,this.onRecoverableError=R,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=B,this.incompleteTransitions=new Map}function _y(a,o,h,m,v,b,R,N,B,Z,oe,me){return a=new bA(a,o,h,R,B,Z,oe,me,N),o=1,b===!0&&(o|=24),b=ci(3,null,null,o),a.current=b,b.stateNode=a,o=Cd(),o.refCount++,a.pooledCache=o,o.refCount++,b.memoizedState={element:m,isDehydrated:h,cache:o},Dd(b),a}function Iy(a){return a?(a=fr,a):fr}function Ry(a,o,h,m,v,b){v=Iy(v),m.context===null?m.context=v:m.pendingContext=v,m=ia(o),m.payload={element:h},b=b===void 0?null:b,b!==null&&(m.callback=b),h=na(a,m,o),h!==null&&(Ws(h,a,o),Al(h,a,o))}function Ly(a,o){if(a=a.memoizedState,a!==null&&a.dehydrated!==null){var h=a.retryLane;a.retryLane=h!==0&&h<o?h:o}}function Zh(a,o){Ly(a,o),(a=a.alternate)&&Ly(a,o)}function wy(a){if(a.tag===13||a.tag===31){var o=Na(a,67108864);o!==null&&Ws(o,a,67108864),Zh(a,67108864)}}function Cy(a){if(a.tag===13||a.tag===31){var o=mi();o=Oe(o);var h=Na(a,o);h!==null&&Ws(h,a,o),Zh(a,o)}}var wc=!0;function TA(a,o,h,m){var v=M.T;M.T=null;var b=V.p;try{V.p=2,Jh(a,o,h,m)}finally{V.p=b,M.T=v}}function EA(a,o,h,m){var v=M.T;M.T=null;var b=V.p;try{V.p=8,Jh(a,o,h,m)}finally{V.p=b,M.T=v}}function Jh(a,o,h,m){if(wc){var v=ef(m);if(v===null)Fh(a,o,m,Cc,h),Ny(a,m);else if(_A(v,a,o,h,m))m.stopPropagation();else if(Ny(a,m),o&4&&-1<AA.indexOf(a)){for(;v!==null;){var b=bn(v);if(b!==null)switch(b.tag){case 3:if(b=b.stateNode,b.current.memoizedState.isDehydrated){var R=Ds(b.pendingLanes);if(R!==0){var N=b;for(N.pendingLanes|=2,N.entangledLanes|=2;R;){var B=1<<31-Yt(R);N.entanglements[1]|=B,R&=~B}rn(b),(St&6)===0&&(hc=rt()+500,Bl(0))}}break;case 31:case 13:N=Na(b,2),N!==null&&Ws(N,b,2),mc(),Zh(b,2)}if(b=ef(m),b===null&&Fh(a,o,m,Cc,h),b===v)break;v=b}v!==null&&m.stopPropagation()}else Fh(a,o,m,null,h)}}function ef(a){return a=sd(a),tf(a)}var Cc=null;function tf(a){if(Cc=null,a=li(a),a!==null){var o=r(a);if(o===null)a=null;else{var h=o.tag;if(h===13){if(a=l(o),a!==null)return a;a=null}else if(h===31){if(a=c(o),a!==null)return a;a=null}else if(h===3){if(o.stateNode.current.memoizedState.isDehydrated)return o.tag===3?o.stateNode.containerInfo:null;a=null}else o!==a&&(a=null)}}return Cc=a,null}function ky(a){switch(a){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Kt()){case ye:return 2;case We:return 8;case it:case ls:return 32;case Ns:return 268435456;default:return 32}default:return 32}}var sf=!1,pa=null,ga=null,ya=null,Yl=new Map,ql=new Map,va=[],AA="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Ny(a,o){switch(a){case"focusin":case"focusout":pa=null;break;case"dragenter":case"dragleave":ga=null;break;case"mouseover":case"mouseout":ya=null;break;case"pointerover":case"pointerout":Yl.delete(o.pointerId);break;case"gotpointercapture":case"lostpointercapture":ql.delete(o.pointerId)}}function Ql(a,o,h,m,v,b){return a===null||a.nativeEvent!==b?(a={blockedOn:o,domEventName:h,eventSystemFlags:m,nativeEvent:b,targetContainers:[v]},o!==null&&(o=bn(o),o!==null&&wy(o)),a):(a.eventSystemFlags|=m,o=a.targetContainers,v!==null&&o.indexOf(v)===-1&&o.push(v),a)}function _A(a,o,h,m,v){switch(o){case"focusin":return pa=Ql(pa,a,o,h,m,v),!0;case"dragenter":return ga=Ql(ga,a,o,h,m,v),!0;case"mouseover":return ya=Ql(ya,a,o,h,m,v),!0;case"pointerover":var b=v.pointerId;return Yl.set(b,Ql(Yl.get(b)||null,a,o,h,m,v)),!0;case"gotpointercapture":return b=v.pointerId,ql.set(b,Ql(ql.get(b)||null,a,o,h,m,v)),!0}return!1}function Oy(a){var o=li(a.target);if(o!==null){var h=r(o);if(h!==null){if(o=h.tag,o===13){if(o=l(h),o!==null){a.blockedOn=o,Ie(a.priority,function(){Cy(h)});return}}else if(o===31){if(o=c(h),o!==null){a.blockedOn=o,Ie(a.priority,function(){Cy(h)});return}}else if(o===3&&h.stateNode.current.memoizedState.isDehydrated){a.blockedOn=h.tag===3?h.stateNode.containerInfo:null;return}}}a.blockedOn=null}function kc(a){if(a.blockedOn!==null)return!1;for(var o=a.targetContainers;0<o.length;){var h=ef(a.nativeEvent);if(h===null){h=a.nativeEvent;var m=new h.constructor(h.type,h);ol=m,h.target.dispatchEvent(m),ol=null}else return o=bn(h),o!==null&&wy(o),a.blockedOn=h,!1;o.shift()}return!0}function Dy(a,o,h){kc(a)&&h.delete(o)}function IA(){sf=!1,pa!==null&&kc(pa)&&(pa=null),ga!==null&&kc(ga)&&(ga=null),ya!==null&&kc(ya)&&(ya=null),Yl.forEach(Dy),ql.forEach(Dy)}function Nc(a,o){a.blockedOn===o&&(a.blockedOn=null,sf||(sf=!0,i.unstable_scheduleCallback(i.unstable_NormalPriority,IA)))}var Oc=null;function Py(a){Oc!==a&&(Oc=a,i.unstable_scheduleCallback(i.unstable_NormalPriority,function(){Oc===a&&(Oc=null);for(var o=0;o<a.length;o+=3){var h=a[o],m=a[o+1],v=a[o+2];if(typeof m!="function"){if(tf(m||h)===null)continue;break}var b=bn(h);b!==null&&(a.splice(o,3),o-=3,eh(b,{pending:!0,data:v,method:h.method,action:m},m,v))}}))}function Mr(a){function o(B){return Nc(B,a)}pa!==null&&Nc(pa,a),ga!==null&&Nc(ga,a),ya!==null&&Nc(ya,a),Yl.forEach(o),ql.forEach(o);for(var h=0;h<va.length;h++){var m=va[h];m.blockedOn===a&&(m.blockedOn=null)}for(;0<va.length&&(h=va[0],h.blockedOn===null);)Oy(h),h.blockedOn===null&&va.shift();if(h=(a.ownerDocument||a).$$reactFormReplay,h!=null)for(m=0;m<h.length;m+=3){var v=h[m],b=h[m+1],R=v[mt]||null;if(typeof b=="function")R||Py(h);else if(R){var N=null;if(b&&b.hasAttribute("formAction")){if(v=b,R=b[mt]||null)N=R.formAction;else if(tf(v)!==null)continue}else N=R.action;typeof N=="function"?h[m+1]=N:(h.splice(m,3),m-=3),Py(h)}}}function Uy(){function a(b){b.canIntercept&&b.info==="react-transition"&&b.intercept({handler:function(){return new Promise(function(R){return v=R})},focusReset:"manual",scroll:"manual"})}function o(){v!==null&&(v(),v=null),m||setTimeout(h,20)}function h(){if(!m&&!navigation.transition){var b=navigation.currentEntry;b&&b.url!=null&&navigation.navigate(b.url,{state:b.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var m=!1,v=null;return navigation.addEventListener("navigate",a),navigation.addEventListener("navigatesuccess",o),navigation.addEventListener("navigateerror",o),setTimeout(h,100),function(){m=!0,navigation.removeEventListener("navigate",a),navigation.removeEventListener("navigatesuccess",o),navigation.removeEventListener("navigateerror",o),v!==null&&(v(),v=null)}}}function nf(a){this._internalRoot=a}Dc.prototype.render=nf.prototype.render=function(a){var o=this._internalRoot;if(o===null)throw Error(s(409));var h=o.current,m=mi();Ry(h,m,a,o,null,null)},Dc.prototype.unmount=nf.prototype.unmount=function(){var a=this._internalRoot;if(a!==null){this._internalRoot=null;var o=a.containerInfo;Ry(a.current,2,null,a,null,null),mc(),o[Sn]=null}};function Dc(a){this._internalRoot=a}Dc.prototype.unstable_scheduleHydration=function(a){if(a){var o=ts();a={blockedOn:null,target:a,priority:o};for(var h=0;h<va.length&&o!==0&&o<va[h].priority;h++);va.splice(h,0,a),h===0&&Oy(a)}};var My=e.version;if(My!=="19.2.4")throw Error(s(527,My,"19.2.4"));V.findDOMNode=function(a){var o=a._reactInternals;if(o===void 0)throw typeof a.render=="function"?Error(s(188)):(a=Object.keys(a).join(","),Error(s(268,a)));return a=u(o),a=a!==null?f(a):null,a=a===null?null:a.stateNode,a};var RA={bundleType:0,version:"19.2.4",rendererPackageName:"react-dom",currentDispatcherRef:M,reconcilerVersion:"19.2.4"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Pc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Pc.isDisabled&&Pc.supportsFiber)try{Es=Pc.inject(RA),$t=Pc}catch{}}return Xl.createRoot=function(a,o){if(!n(a))throw Error(s(299));var h=!1,m="",v=Hg,b=zg,R=Kg;return o!=null&&(o.unstable_strictMode===!0&&(h=!0),o.identifierPrefix!==void 0&&(m=o.identifierPrefix),o.onUncaughtError!==void 0&&(v=o.onUncaughtError),o.onCaughtError!==void 0&&(b=o.onCaughtError),o.onRecoverableError!==void 0&&(R=o.onRecoverableError)),o=_y(a,1,!1,null,null,h,m,null,v,b,R,Uy),a[Sn]=o.current,jh(a),new nf(o)},Xl.hydrateRoot=function(a,o,h){if(!n(a))throw Error(s(299));var m=!1,v="",b=Hg,R=zg,N=Kg,B=null;return h!=null&&(h.unstable_strictMode===!0&&(m=!0),h.identifierPrefix!==void 0&&(v=h.identifierPrefix),h.onUncaughtError!==void 0&&(b=h.onUncaughtError),h.onCaughtError!==void 0&&(R=h.onCaughtError),h.onRecoverableError!==void 0&&(N=h.onRecoverableError),h.formState!==void 0&&(B=h.formState)),o=_y(a,1,!0,o,h??null,m,v,B,b,R,N,Uy),o.context=Iy(null),h=o.current,m=mi(),m=Oe(m),v=ia(m),v.callback=null,na(h,v,m),h=m,o.current.lanes=h,cs(o,h),rn(o),a[Sn]=o.current,jh(a),new Dc(o)},Xl.version="19.2.4",Xl}var Yy;function jA(){if(Yy)return lf.exports;Yy=1;function i(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(i)}catch(e){console.error(e)}}return i(),lf.exports=MA(),lf.exports}var FA=jA();var qy="popstate";function BA(i={}){function e(n,r){let{pathname:l="/",search:c="",hash:d=""}=er(n.location.hash.substring(1));return!l.startsWith("/")&&!l.startsWith(".")&&(l="/"+l),zf("",{pathname:l,search:c,hash:d},r.state&&r.state.usr||null,r.state&&r.state.key||"default")}function t(n,r){let l=n.document.querySelector("base"),c="";if(l&&l.getAttribute("href")){let d=n.location.href,u=d.indexOf("#");c=u===-1?d:d.slice(0,u)}return c+"#"+(typeof r=="string"?r:ro(r))}function s(n,r){ji(n.pathname.charAt(0)==="/",`relative pathnames are not supported in hash history.push(${JSON.stringify(r)})`)}return $A(e,t,s,i)}function Ht(i,e){if(i===!1||i===null||typeof i>"u")throw new Error(e)}function ji(i,e){if(!i){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function VA(){return Math.random().toString(36).substring(2,10)}function Qy(i,e){return{usr:i.state,key:i.key,idx:e}}function zf(i,e,t=null,s){return{pathname:typeof i=="string"?i:i.pathname,search:"",hash:"",...typeof e=="string"?er(e):e,state:t,key:e&&e.key||s||VA()}}function ro({pathname:i="/",search:e="",hash:t=""}){return e&&e!=="?"&&(i+=e.charAt(0)==="?"?e:"?"+e),t&&t!=="#"&&(i+=t.charAt(0)==="#"?t:"#"+t),i}function er(i){let e={};if(i){let t=i.indexOf("#");t>=0&&(e.hash=i.substring(t),i=i.substring(0,t));let s=i.indexOf("?");s>=0&&(e.search=i.substring(s),i=i.substring(0,s)),i&&(e.pathname=i)}return e}function $A(i,e,t,s={}){let{window:n=document.defaultView,v5Compat:r=!1}=s,l=n.history,c="POP",d=null,u=f();u==null&&(u=0,l.replaceState({...l.state,idx:u},""));function f(){return(l.state||{idx:null}).idx}function g(){c="POP";let T=f(),A=T==null?null:T-u;u=T,d&&d({action:c,location:E.location,delta:A})}function y(T,A){c="PUSH";let I=zf(E.location,T,A);t&&t(I,T),u=f()+1;let _=Qy(I,u),C=E.createHref(I);try{l.pushState(_,"",C)}catch(k){if(k instanceof DOMException&&k.name==="DataCloneError")throw k;n.location.assign(C)}r&&d&&d({action:c,location:E.location,delta:1})}function x(T,A){c="REPLACE";let I=zf(E.location,T,A);t&&t(I,T),u=f();let _=Qy(I,u),C=E.createHref(I);l.replaceState(_,"",C),r&&d&&d({action:c,location:E.location,delta:0})}function S(T){return GA(T)}let E={get action(){return c},get location(){return i(n,l)},listen(T){if(d)throw new Error("A history only accepts one active listener");return n.addEventListener(qy,g),d=T,()=>{n.removeEventListener(qy,g),d=null}},createHref(T){return e(n,T)},createURL:S,encodeLocation(T){let A=S(T);return{pathname:A.pathname,search:A.search,hash:A.hash}},push:y,replace:x,go(T){return l.go(T)}};return E}function GA(i,e=!1){let t="http://localhost";typeof window<"u"&&(t=window.location.origin!=="null"?window.location.origin:window.location.href),Ht(t,"No window.location.(origin|href) available to create URL");let s=typeof i=="string"?i:ro(i);return s=s.replace(/ $/,"%20"),!e&&s.startsWith("//")&&(s=t+s),new URL(s,t)}function Xx(i,e,t="/"){return HA(i,e,t,!1)}function HA(i,e,t,s){let n=typeof e=="string"?er(e):e,r=zn(n.pathname||"/",t);if(r==null)return null;let l=Zx(i);zA(l);let c=null;for(let d=0;c==null&&d<l.length;++d){let u=s_(r);c=e_(l[d],u,s)}return c}function Zx(i,e=[],t=[],s="",n=!1){let r=(l,c,d=n,u)=>{let f={relativePath:u===void 0?l.path||"":u,caseSensitive:l.caseSensitive===!0,childrenIndex:c,route:l};if(f.relativePath.startsWith("/")){if(!f.relativePath.startsWith(s)&&d)return;Ht(f.relativePath.startsWith(s),`Absolute route path "${f.relativePath}" nested under path "${s}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),f.relativePath=f.relativePath.slice(s.length)}let g=Hn([s,f.relativePath]),y=t.concat(f);l.children&&l.children.length>0&&(Ht(l.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${g}".`),Zx(l.children,e,y,g,d)),!(l.path==null&&!l.index)&&e.push({path:g,score:ZA(g,l.index),routesMeta:y})};return i.forEach((l,c)=>{if(l.path===""||!l.path?.includes("?"))r(l,c);else for(let d of Jx(l.path))r(l,c,!0,d)}),e}function Jx(i){let e=i.split("/");if(e.length===0)return[];let[t,...s]=e,n=t.endsWith("?"),r=t.replace(/\?$/,"");if(s.length===0)return n?[r,""]:[r];let l=Jx(s.join("/")),c=[];return c.push(...l.map(d=>d===""?r:[r,d].join("/"))),n&&c.push(...l),c.map(d=>i.startsWith("/")&&d===""?"/":d)}function zA(i){i.sort((e,t)=>e.score!==t.score?t.score-e.score:JA(e.routesMeta.map(s=>s.childrenIndex),t.routesMeta.map(s=>s.childrenIndex)))}var KA=/^:[\w-]+$/,YA=3,qA=2,QA=1,WA=10,XA=-2,Wy=i=>i==="*";function ZA(i,e){let t=i.split("/"),s=t.length;return t.some(Wy)&&(s+=XA),e&&(s+=qA),t.filter(n=>!Wy(n)).reduce((n,r)=>n+(KA.test(r)?YA:r===""?QA:WA),s)}function JA(i,e){return i.length===e.length&&i.slice(0,-1).every((s,n)=>s===e[n])?i[i.length-1]-e[e.length-1]:0}function e_(i,e,t=!1){let{routesMeta:s}=i,n={},r="/",l=[];for(let c=0;c<s.length;++c){let d=s[c],u=c===s.length-1,f=r==="/"?e:e.slice(r.length)||"/",g=xu({path:d.relativePath,caseSensitive:d.caseSensitive,end:u},f),y=d.route;if(!g&&u&&t&&!s[s.length-1].route.index&&(g=xu({path:d.relativePath,caseSensitive:d.caseSensitive,end:!1},f)),!g)return null;Object.assign(n,g.params),l.push({params:n,pathname:Hn([r,g.pathname]),pathnameBase:r_(Hn([r,g.pathnameBase])),route:y}),g.pathnameBase!=="/"&&(r=Hn([r,g.pathnameBase]))}return l}function xu(i,e){typeof i=="string"&&(i={path:i,caseSensitive:!1,end:!0});let[t,s]=t_(i.path,i.caseSensitive,i.end),n=e.match(t);if(!n)return null;let r=n[0],l=r.replace(/(.)\/+$/,"$1"),c=n.slice(1);return{params:s.reduce((u,{paramName:f,isOptional:g},y)=>{if(f==="*"){let S=c[y]||"";l=r.slice(0,r.length-S.length).replace(/(.)\/+$/,"$1")}const x=c[y];return g&&!x?u[f]=void 0:u[f]=(x||"").replace(/%2F/g,"/"),u},{}),pathname:r,pathnameBase:l,pattern:i}}function t_(i,e=!1,t=!0){ji(i==="*"||!i.endsWith("*")||i.endsWith("/*"),`Route path "${i}" will be treated as if it were "${i.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${i.replace(/\*$/,"/*")}".`);let s=[],n="^"+i.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(l,c,d)=>(s.push({paramName:c,isOptional:d!=null}),d?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return i.endsWith("*")?(s.push({paramName:"*"}),n+=i==="*"||i==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?n+="\\/*$":i!==""&&i!=="/"&&(n+="(?:(?=\\/|$))"),[new RegExp(n,e?void 0:"i"),s]}function s_(i){try{return i.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return ji(!1,`The URL path "${i}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),i}}function zn(i,e){if(e==="/")return i;if(!i.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,s=i.charAt(t);return s&&s!=="/"?null:i.slice(t)||"/"}var i_=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i;function n_(i,e="/"){let{pathname:t,search:s="",hash:n=""}=typeof i=="string"?er(i):i,r;return t?(t=t.replace(/\/\/+/g,"/"),t.startsWith("/")?r=Xy(t.substring(1),"/"):r=Xy(t,e)):r=e,{pathname:r,search:l_(s),hash:o_(n)}}function Xy(i,e){let t=e.replace(/\/+$/,"").split("/");return i.split("/").forEach(n=>{n===".."?t.length>1&&t.pop():n!=="."&&t.push(n)}),t.length>1?t.join("/"):"/"}function df(i,e,t,s){return`Cannot include a '${i}' character in a manually specified \`to.${e}\` field [${JSON.stringify(s)}].  Please separate it out to the \`to.${t}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function a_(i){return i.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function Em(i){let e=a_(i);return e.map((t,s)=>s===e.length-1?t.pathname:t.pathnameBase)}function Am(i,e,t,s=!1){let n;typeof i=="string"?n=er(i):(n={...i},Ht(!n.pathname||!n.pathname.includes("?"),df("?","pathname","search",n)),Ht(!n.pathname||!n.pathname.includes("#"),df("#","pathname","hash",n)),Ht(!n.search||!n.search.includes("#"),df("#","search","hash",n)));let r=i===""||n.pathname==="",l=r?"/":n.pathname,c;if(l==null)c=t;else{let g=e.length-1;if(!s&&l.startsWith("..")){let y=l.split("/");for(;y[0]==="..";)y.shift(),g-=1;n.pathname=y.join("/")}c=g>=0?e[g]:"/"}let d=n_(n,c),u=l&&l!=="/"&&l.endsWith("/"),f=(r||l===".")&&t.endsWith("/");return!d.pathname.endsWith("/")&&(u||f)&&(d.pathname+="/"),d}var Hn=i=>i.join("/").replace(/\/\/+/g,"/"),r_=i=>i.replace(/\/+$/,"").replace(/^\/*/,"/"),l_=i=>!i||i==="?"?"":i.startsWith("?")?i:"?"+i,o_=i=>!i||i==="#"?"":i.startsWith("#")?i:"#"+i,c_=class{constructor(i,e,t,s=!1){this.status=i,this.statusText=e||"",this.internal=s,t instanceof Error?(this.data=t.toString(),this.error=t):this.data=t}};function u_(i){return i!=null&&typeof i.status=="number"&&typeof i.statusText=="string"&&typeof i.internal=="boolean"&&"data"in i}function d_(i){return i.map(e=>e.route.path).filter(Boolean).join("/").replace(/\/\/*/g,"/")||"/"}var eS=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function tS(i,e){let t=i;if(typeof t!="string"||!i_.test(t))return{absoluteURL:void 0,isExternal:!1,to:t};let s=t,n=!1;if(eS)try{let r=new URL(window.location.href),l=t.startsWith("//")?new URL(r.protocol+t):new URL(t),c=zn(l.pathname,e);l.origin===r.origin&&c!=null?t=c+l.search+l.hash:n=!0}catch{ji(!1,`<Link to="${t}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}return{absoluteURL:s,isExternal:n,to:t}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var sS=["POST","PUT","PATCH","DELETE"];new Set(sS);var h_=["GET",...sS];new Set(h_);var tl=w.createContext(null);tl.displayName="DataRouter";var ju=w.createContext(null);ju.displayName="DataRouterState";var f_=w.createContext(!1),iS=w.createContext({isTransitioning:!1});iS.displayName="ViewTransition";var m_=w.createContext(new Map);m_.displayName="Fetchers";var p_=w.createContext(null);p_.displayName="Await";var Ei=w.createContext(null);Ei.displayName="Navigation";var po=w.createContext(null);po.displayName="Location";var Bi=w.createContext({outlet:null,matches:[],isDataRoute:!1});Bi.displayName="Route";var _m=w.createContext(null);_m.displayName="RouteError";var nS="REACT_ROUTER_ERROR",g_="REDIRECT",y_="ROUTE_ERROR_RESPONSE";function v_(i){if(i.startsWith(`${nS}:${g_}:{`))try{let e=JSON.parse(i.slice(28));if(typeof e=="object"&&e&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.location=="string"&&typeof e.reloadDocument=="boolean"&&typeof e.replace=="boolean")return e}catch{}}function x_(i){if(i.startsWith(`${nS}:${y_}:{`))try{let e=JSON.parse(i.slice(40));if(typeof e=="object"&&e&&typeof e.status=="number"&&typeof e.statusText=="string")return new c_(e.status,e.statusText,e.data)}catch{}}function S_(i,{relative:e}={}){Ht(sl(),"useHref() may be used only in the context of a <Router> component.");let{basename:t,navigator:s}=w.useContext(Ei),{hash:n,pathname:r,search:l}=go(i,{relative:e}),c=r;return t!=="/"&&(c=r==="/"?t:Hn([t,r])),s.createHref({pathname:c,search:l,hash:n})}function sl(){return w.useContext(po)!=null}function Kn(){return Ht(sl(),"useLocation() may be used only in the context of a <Router> component."),w.useContext(po).location}var aS="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function rS(i){w.useContext(Ei).static||w.useLayoutEffect(i)}function js(){let{isDataRoute:i}=w.useContext(Bi);return i?P_():b_()}function b_(){Ht(sl(),"useNavigate() may be used only in the context of a <Router> component.");let i=w.useContext(tl),{basename:e,navigator:t}=w.useContext(Ei),{matches:s}=w.useContext(Bi),{pathname:n}=Kn(),r=JSON.stringify(Em(s)),l=w.useRef(!1);return rS(()=>{l.current=!0}),w.useCallback((d,u={})=>{if(ji(l.current,aS),!l.current)return;if(typeof d=="number"){t.go(d);return}let f=Am(d,JSON.parse(r),n,u.relative==="path");i==null&&e!=="/"&&(f.pathname=f.pathname==="/"?e:Hn([e,f.pathname])),(u.replace?t.replace:t.push)(f,u.state,u)},[e,t,r,n,i])}var T_=w.createContext(null);function E_(i){let e=w.useContext(Bi).outlet;return w.useMemo(()=>e&&w.createElement(T_.Provider,{value:i},e),[e,i])}function Fu(){let{matches:i}=w.useContext(Bi),e=i[i.length-1];return e?e.params:{}}function go(i,{relative:e}={}){let{matches:t}=w.useContext(Bi),{pathname:s}=Kn(),n=JSON.stringify(Em(t));return w.useMemo(()=>Am(i,JSON.parse(n),s,e==="path"),[i,n,s,e])}function A_(i,e){return lS(i,e)}function lS(i,e,t,s,n){Ht(sl(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:r}=w.useContext(Ei),{matches:l}=w.useContext(Bi),c=l[l.length-1],d=c?c.params:{},u=c?c.pathname:"/",f=c?c.pathnameBase:"/",g=c&&c.route;{let I=g&&g.path||"";cS(u,!g||I.endsWith("*")||I.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${u}" (under <Route path="${I}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${I}"> to <Route path="${I==="/"?"*":`${I}/*`}">.`)}let y=Kn(),x;if(e){let I=typeof e=="string"?er(e):e;Ht(f==="/"||I.pathname?.startsWith(f),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${f}" but pathname "${I.pathname}" was given in the \`location\` prop.`),x=I}else x=y;let S=x.pathname||"/",E=S;if(f!=="/"){let I=f.replace(/^\//,"").split("/");E="/"+S.replace(/^\//,"").split("/").slice(I.length).join("/")}let T=Xx(i,{pathname:E});ji(g||T!=null,`No routes matched location "${x.pathname}${x.search}${x.hash}" `),ji(T==null||T[T.length-1].route.element!==void 0||T[T.length-1].route.Component!==void 0||T[T.length-1].route.lazy!==void 0,`Matched leaf route at location "${x.pathname}${x.search}${x.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let A=w_(T&&T.map(I=>Object.assign({},I,{params:Object.assign({},d,I.params),pathname:Hn([f,r.encodeLocation?r.encodeLocation(I.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:I.pathname]),pathnameBase:I.pathnameBase==="/"?f:Hn([f,r.encodeLocation?r.encodeLocation(I.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:I.pathnameBase])})),l,t,s,n);return e&&A?w.createElement(po.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...x},navigationType:"POP"}},A):A}function __(){let i=D_(),e=u_(i)?`${i.status} ${i.statusText}`:i instanceof Error?i.message:JSON.stringify(i),t=i instanceof Error?i.stack:null,s="rgba(200,200,200, 0.5)",n={padding:"0.5rem",backgroundColor:s},r={padding:"2px 4px",backgroundColor:s},l=null;return console.error("Error handled by React Router default ErrorBoundary:",i),l=w.createElement(w.Fragment,null,w.createElement("p",null," Hey developer "),w.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",w.createElement("code",{style:r},"ErrorBoundary")," or"," ",w.createElement("code",{style:r},"errorElement")," prop on your route.")),w.createElement(w.Fragment,null,w.createElement("h2",null,"Unexpected Application Error!"),w.createElement("h3",{style:{fontStyle:"italic"}},e),t?w.createElement("pre",{style:n},t):null,l)}var I_=w.createElement(__,null),oS=class extends w.Component{constructor(i){super(i),this.state={location:i.location,revalidation:i.revalidation,error:i.error}}static getDerivedStateFromError(i){return{error:i}}static getDerivedStateFromProps(i,e){return e.location!==i.location||e.revalidation!=="idle"&&i.revalidation==="idle"?{error:i.error,location:i.location,revalidation:i.revalidation}:{error:i.error!==void 0?i.error:e.error,location:e.location,revalidation:i.revalidation||e.revalidation}}componentDidCatch(i,e){this.props.onError?this.props.onError(i,e):console.error("React Router caught the following error during render",i)}render(){let i=this.state.error;if(this.context&&typeof i=="object"&&i&&"digest"in i&&typeof i.digest=="string"){const t=x_(i.digest);t&&(i=t)}let e=i!==void 0?w.createElement(Bi.Provider,{value:this.props.routeContext},w.createElement(_m.Provider,{value:i,children:this.props.component})):this.props.children;return this.context?w.createElement(R_,{error:i},e):e}};oS.contextType=f_;var hf=new WeakMap;function R_({children:i,error:e}){let{basename:t}=w.useContext(Ei);if(typeof e=="object"&&e&&"digest"in e&&typeof e.digest=="string"){let s=v_(e.digest);if(s){let n=hf.get(e);if(n)throw n;let r=tS(s.location,t);if(eS&&!hf.get(e))if(r.isExternal||s.reloadDocument)window.location.href=r.absoluteURL||r.to;else{const l=Promise.resolve().then(()=>window.__reactRouterDataRouter.navigate(r.to,{replace:s.replace}));throw hf.set(e,l),l}return w.createElement("meta",{httpEquiv:"refresh",content:`0;url=${r.absoluteURL||r.to}`})}}return i}function L_({routeContext:i,match:e,children:t}){let s=w.useContext(tl);return s&&s.static&&s.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(s.staticContext._deepestRenderedBoundaryId=e.route.id),w.createElement(Bi.Provider,{value:i},t)}function w_(i,e=[],t=null,s=null,n=null){if(i==null){if(!t)return null;if(t.errors)i=t.matches;else if(e.length===0&&!t.initialized&&t.matches.length>0)i=t.matches;else return null}let r=i,l=t?.errors;if(l!=null){let f=r.findIndex(g=>g.route.id&&l?.[g.route.id]!==void 0);Ht(f>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(l).join(",")}`),r=r.slice(0,Math.min(r.length,f+1))}let c=!1,d=-1;if(t)for(let f=0;f<r.length;f++){let g=r[f];if((g.route.HydrateFallback||g.route.hydrateFallbackElement)&&(d=f),g.route.id){let{loaderData:y,errors:x}=t,S=g.route.loader&&!y.hasOwnProperty(g.route.id)&&(!x||x[g.route.id]===void 0);if(g.route.lazy||S){c=!0,d>=0?r=r.slice(0,d+1):r=[r[0]];break}}}let u=t&&s?(f,g)=>{s(f,{location:t.location,params:t.matches?.[0]?.params??{},unstable_pattern:d_(t.matches),errorInfo:g})}:void 0;return r.reduceRight((f,g,y)=>{let x,S=!1,E=null,T=null;t&&(x=l&&g.route.id?l[g.route.id]:void 0,E=g.route.errorElement||I_,c&&(d<0&&y===0?(cS("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),S=!0,T=null):d===y&&(S=!0,T=g.route.hydrateFallbackElement||null)));let A=e.concat(r.slice(0,y+1)),I=()=>{let _;return x?_=E:S?_=T:g.route.Component?_=w.createElement(g.route.Component,null):g.route.element?_=g.route.element:_=f,w.createElement(L_,{match:g,routeContext:{outlet:f,matches:A,isDataRoute:t!=null},children:_})};return t&&(g.route.ErrorBoundary||g.route.errorElement||y===0)?w.createElement(oS,{location:t.location,revalidation:t.revalidation,component:E,error:x,children:I(),routeContext:{outlet:null,matches:A,isDataRoute:!0},onError:u}):I()},null)}function Im(i){return`${i} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function C_(i){let e=w.useContext(tl);return Ht(e,Im(i)),e}function k_(i){let e=w.useContext(ju);return Ht(e,Im(i)),e}function N_(i){let e=w.useContext(Bi);return Ht(e,Im(i)),e}function Rm(i){let e=N_(i),t=e.matches[e.matches.length-1];return Ht(t.route.id,`${i} can only be used on routes that contain a unique "id"`),t.route.id}function O_(){return Rm("useRouteId")}function D_(){let i=w.useContext(_m),e=k_("useRouteError"),t=Rm("useRouteError");return i!==void 0?i:e.errors?.[t]}function P_(){let{router:i}=C_("useNavigate"),e=Rm("useNavigate"),t=w.useRef(!1);return rS(()=>{t.current=!0}),w.useCallback(async(n,r={})=>{ji(t.current,aS),t.current&&(typeof n=="number"?await i.navigate(n):await i.navigate(n,{fromRouteId:e,...r}))},[i,e])}var Zy={};function cS(i,e,t){!e&&!Zy[i]&&(Zy[i]=!0,ji(!1,t))}w.memo(U_);function U_({routes:i,future:e,state:t,onError:s}){return lS(i,void 0,t,s,e)}function M_({to:i,replace:e,state:t,relative:s}){Ht(sl(),"<Navigate> may be used only in the context of a <Router> component.");let{static:n}=w.useContext(Ei);ji(!n,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:r}=w.useContext(Bi),{pathname:l}=Kn(),c=js(),d=Am(i,Em(r),l,s==="path"),u=JSON.stringify(d);return w.useEffect(()=>{c(JSON.parse(u),{replace:e,state:t,relative:s})},[c,u,s,e,t]),null}function j_(i){return E_(i.context)}function Mi(i){Ht(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function F_({basename:i="/",children:e=null,location:t,navigationType:s="POP",navigator:n,static:r=!1,unstable_useTransitions:l}){Ht(!sl(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let c=i.replace(/^\/*/,"/"),d=w.useMemo(()=>({basename:c,navigator:n,static:r,unstable_useTransitions:l,future:{}}),[c,n,r,l]);typeof t=="string"&&(t=er(t));let{pathname:u="/",search:f="",hash:g="",state:y=null,key:x="default"}=t,S=w.useMemo(()=>{let E=zn(u,c);return E==null?null:{location:{pathname:E,search:f,hash:g,state:y,key:x},navigationType:s}},[c,u,f,g,y,x,s]);return ji(S!=null,`<Router basename="${c}"> is not able to match the URL "${u}${f}${g}" because it does not start with the basename, so the <Router> won't render anything.`),S==null?null:w.createElement(Ei.Provider,{value:d},w.createElement(po.Provider,{children:e,value:S}))}function B_({children:i,location:e}){return A_(Kf(i),e)}function Kf(i,e=[]){let t=[];return w.Children.forEach(i,(s,n)=>{if(!w.isValidElement(s))return;let r=[...e,n];if(s.type===w.Fragment){t.push.apply(t,Kf(s.props.children,r));return}Ht(s.type===Mi,`[${typeof s.type=="string"?s.type:s.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),Ht(!s.props.index||!s.props.children,"An index route cannot have child routes.");let l={id:s.props.id||r.join("-"),caseSensitive:s.props.caseSensitive,element:s.props.element,Component:s.props.Component,index:s.props.index,path:s.props.path,middleware:s.props.middleware,loader:s.props.loader,action:s.props.action,hydrateFallbackElement:s.props.hydrateFallbackElement,HydrateFallback:s.props.HydrateFallback,errorElement:s.props.errorElement,ErrorBoundary:s.props.ErrorBoundary,hasErrorBoundary:s.props.hasErrorBoundary===!0||s.props.ErrorBoundary!=null||s.props.errorElement!=null,shouldRevalidate:s.props.shouldRevalidate,handle:s.props.handle,lazy:s.props.lazy};s.props.children&&(l.children=Kf(s.props.children,r)),t.push(l)}),t}var nu="get",au="application/x-www-form-urlencoded";function Bu(i){return typeof HTMLElement<"u"&&i instanceof HTMLElement}function V_(i){return Bu(i)&&i.tagName.toLowerCase()==="button"}function $_(i){return Bu(i)&&i.tagName.toLowerCase()==="form"}function G_(i){return Bu(i)&&i.tagName.toLowerCase()==="input"}function H_(i){return!!(i.metaKey||i.altKey||i.ctrlKey||i.shiftKey)}function z_(i,e){return i.button===0&&(!e||e==="_self")&&!H_(i)}var Uc=null;function K_(){if(Uc===null)try{new FormData(document.createElement("form"),0),Uc=!1}catch{Uc=!0}return Uc}var Y_=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function ff(i){return i!=null&&!Y_.has(i)?(ji(!1,`"${i}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${au}"`),null):i}function q_(i,e){let t,s,n,r,l;if($_(i)){let c=i.getAttribute("action");s=c?zn(c,e):null,t=i.getAttribute("method")||nu,n=ff(i.getAttribute("enctype"))||au,r=new FormData(i)}else if(V_(i)||G_(i)&&(i.type==="submit"||i.type==="image")){let c=i.form;if(c==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let d=i.getAttribute("formaction")||c.getAttribute("action");if(s=d?zn(d,e):null,t=i.getAttribute("formmethod")||c.getAttribute("method")||nu,n=ff(i.getAttribute("formenctype"))||ff(c.getAttribute("enctype"))||au,r=new FormData(c,i),!K_()){let{name:u,type:f,value:g}=i;if(f==="image"){let y=u?`${u}.`:"";r.append(`${y}x`,"0"),r.append(`${y}y`,"0")}else u&&r.append(u,g)}}else{if(Bu(i))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');t=nu,s=null,n=au,l=i}return r&&n==="text/plain"&&(l=r,r=void 0),{action:s,method:t.toLowerCase(),encType:n,formData:r,body:l}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function Lm(i,e){if(i===!1||i===null||typeof i>"u")throw new Error(e)}function Q_(i,e,t,s){let n=typeof i=="string"?new URL(i,typeof window>"u"?"server://singlefetch/":window.location.origin):i;return t?n.pathname.endsWith("/")?n.pathname=`${n.pathname}_.${s}`:n.pathname=`${n.pathname}.${s}`:n.pathname==="/"?n.pathname=`_root.${s}`:e&&zn(n.pathname,e)==="/"?n.pathname=`${e.replace(/\/$/,"")}/_root.${s}`:n.pathname=`${n.pathname.replace(/\/$/,"")}.${s}`,n}async function W_(i,e){if(i.id in e)return e[i.id];try{let t=await import(i.module);return e[i.id]=t,t}catch(t){return console.error(`Error loading route module \`${i.module}\`, reloading page...`),console.error(t),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function X_(i){return i==null?!1:i.href==null?i.rel==="preload"&&typeof i.imageSrcSet=="string"&&typeof i.imageSizes=="string":typeof i.rel=="string"&&typeof i.href=="string"}async function Z_(i,e,t){let s=await Promise.all(i.map(async n=>{let r=e.routes[n.route.id];if(r){let l=await W_(r,t);return l.links?l.links():[]}return[]}));return sI(s.flat(1).filter(X_).filter(n=>n.rel==="stylesheet"||n.rel==="preload").map(n=>n.rel==="stylesheet"?{...n,rel:"prefetch",as:"style"}:{...n,rel:"prefetch"}))}function Jy(i,e,t,s,n,r){let l=(d,u)=>t[u]?d.route.id!==t[u].route.id:!0,c=(d,u)=>t[u].pathname!==d.pathname||t[u].route.path?.endsWith("*")&&t[u].params["*"]!==d.params["*"];return r==="assets"?e.filter((d,u)=>l(d,u)||c(d,u)):r==="data"?e.filter((d,u)=>{let f=s.routes[d.route.id];if(!f||!f.hasLoader)return!1;if(l(d,u)||c(d,u))return!0;if(d.route.shouldRevalidate){let g=d.route.shouldRevalidate({currentUrl:new URL(n.pathname+n.search+n.hash,window.origin),currentParams:t[0]?.params||{},nextUrl:new URL(i,window.origin),nextParams:d.params,defaultShouldRevalidate:!0});if(typeof g=="boolean")return g}return!0}):[]}function J_(i,e,{includeHydrateFallback:t}={}){return eI(i.map(s=>{let n=e.routes[s.route.id];if(!n)return[];let r=[n.module];return n.clientActionModule&&(r=r.concat(n.clientActionModule)),n.clientLoaderModule&&(r=r.concat(n.clientLoaderModule)),t&&n.hydrateFallbackModule&&(r=r.concat(n.hydrateFallbackModule)),n.imports&&(r=r.concat(n.imports)),r}).flat(1))}function eI(i){return[...new Set(i)]}function tI(i){let e={},t=Object.keys(i).sort();for(let s of t)e[s]=i[s];return e}function sI(i,e){let t=new Set;return new Set(e),i.reduce((s,n)=>{let r=JSON.stringify(tI(n));return t.has(r)||(t.add(r),s.push({key:r,link:n})),s},[])}function uS(){let i=w.useContext(tl);return Lm(i,"You must render this element inside a <DataRouterContext.Provider> element"),i}function iI(){let i=w.useContext(ju);return Lm(i,"You must render this element inside a <DataRouterStateContext.Provider> element"),i}var wm=w.createContext(void 0);wm.displayName="FrameworkContext";function dS(){let i=w.useContext(wm);return Lm(i,"You must render this element inside a <HydratedRouter> element"),i}function nI(i,e){let t=w.useContext(wm),[s,n]=w.useState(!1),[r,l]=w.useState(!1),{onFocus:c,onBlur:d,onMouseEnter:u,onMouseLeave:f,onTouchStart:g}=e,y=w.useRef(null);w.useEffect(()=>{if(i==="render"&&l(!0),i==="viewport"){let E=A=>{A.forEach(I=>{l(I.isIntersecting)})},T=new IntersectionObserver(E,{threshold:.5});return y.current&&T.observe(y.current),()=>{T.disconnect()}}},[i]),w.useEffect(()=>{if(s){let E=setTimeout(()=>{l(!0)},100);return()=>{clearTimeout(E)}}},[s]);let x=()=>{n(!0)},S=()=>{n(!1),l(!1)};return t?i!=="intent"?[r,y,{}]:[r,y,{onFocus:Zl(c,x),onBlur:Zl(d,S),onMouseEnter:Zl(u,x),onMouseLeave:Zl(f,S),onTouchStart:Zl(g,x)}]:[!1,y,{}]}function Zl(i,e){return t=>{i&&i(t),t.defaultPrevented||e(t)}}function aI({page:i,...e}){let{router:t}=uS(),s=w.useMemo(()=>Xx(t.routes,i,t.basename),[t.routes,i,t.basename]);return s?w.createElement(lI,{page:i,matches:s,...e}):null}function rI(i){let{manifest:e,routeModules:t}=dS(),[s,n]=w.useState([]);return w.useEffect(()=>{let r=!1;return Z_(i,e,t).then(l=>{r||n(l)}),()=>{r=!0}},[i,e,t]),s}function lI({page:i,matches:e,...t}){let s=Kn(),{future:n,manifest:r,routeModules:l}=dS(),{basename:c}=uS(),{loaderData:d,matches:u}=iI(),f=w.useMemo(()=>Jy(i,e,u,r,s,"data"),[i,e,u,r,s]),g=w.useMemo(()=>Jy(i,e,u,r,s,"assets"),[i,e,u,r,s]),y=w.useMemo(()=>{if(i===s.pathname+s.search+s.hash)return[];let E=new Set,T=!1;if(e.forEach(I=>{let _=r.routes[I.route.id];!_||!_.hasLoader||(!f.some(C=>C.route.id===I.route.id)&&I.route.id in d&&l[I.route.id]?.shouldRevalidate||_.hasClientLoader?T=!0:E.add(I.route.id))}),E.size===0)return[];let A=Q_(i,c,n.unstable_trailingSlashAwareDataRequests,"data");return T&&E.size>0&&A.searchParams.set("_routes",e.filter(I=>E.has(I.route.id)).map(I=>I.route.id).join(",")),[A.pathname+A.search]},[c,n.unstable_trailingSlashAwareDataRequests,d,s,r,f,e,i,l]),x=w.useMemo(()=>J_(g,r),[g,r]),S=rI(g);return w.createElement(w.Fragment,null,y.map(E=>w.createElement("link",{key:E,rel:"prefetch",as:"fetch",href:E,...t})),x.map(E=>w.createElement("link",{key:E,rel:"modulepreload",href:E,...t})),S.map(({key:E,link:T})=>w.createElement("link",{key:E,nonce:t.nonce,...T,crossOrigin:T.crossOrigin??t.crossOrigin})))}function oI(...i){return e=>{i.forEach(t=>{typeof t=="function"?t(e):t!=null&&(t.current=e)})}}var cI=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{cI&&(window.__reactRouterVersion="7.13.0")}catch{}function uI({basename:i,children:e,unstable_useTransitions:t,window:s}){let n=w.useRef();n.current==null&&(n.current=BA({window:s,v5Compat:!0}));let r=n.current,[l,c]=w.useState({action:r.action,location:r.location}),d=w.useCallback(u=>{t===!1?c(u):w.startTransition(()=>c(u))},[t]);return w.useLayoutEffect(()=>r.listen(d),[r,d]),w.createElement(F_,{basename:i,children:e,location:l.location,navigationType:l.action,navigator:r,unstable_useTransitions:t})}var hS=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Wr=w.forwardRef(function({onClick:e,discover:t="render",prefetch:s="none",relative:n,reloadDocument:r,replace:l,state:c,target:d,to:u,preventScrollReset:f,viewTransition:g,unstable_defaultShouldRevalidate:y,...x},S){let{basename:E,unstable_useTransitions:T}=w.useContext(Ei),A=typeof u=="string"&&hS.test(u),I=tS(u,E);u=I.to;let _=S_(u,{relative:n}),[C,k,D]=nI(s,x),O=mI(u,{replace:l,state:c,target:d,preventScrollReset:f,relative:n,viewTransition:g,unstable_defaultShouldRevalidate:y,unstable_useTransitions:T});function F(U){e&&e(U),U.defaultPrevented||O(U)}let j=w.createElement("a",{...x,...D,href:I.absoluteURL||_,onClick:I.isExternal||r?e:F,ref:oI(S,k),target:d,"data-discover":!A&&t==="render"?"true":void 0});return C&&!A?w.createElement(w.Fragment,null,j,w.createElement(aI,{page:_})):j});Wr.displayName="Link";var dI=w.forwardRef(function({"aria-current":e="page",caseSensitive:t=!1,className:s="",end:n=!1,style:r,to:l,viewTransition:c,children:d,...u},f){let g=go(l,{relative:u.relative}),y=Kn(),x=w.useContext(ju),{navigator:S,basename:E}=w.useContext(Ei),T=x!=null&&xI(g)&&c===!0,A=S.encodeLocation?S.encodeLocation(g).pathname:g.pathname,I=y.pathname,_=x&&x.navigation&&x.navigation.location?x.navigation.location.pathname:null;t||(I=I.toLowerCase(),_=_?_.toLowerCase():null,A=A.toLowerCase()),_&&E&&(_=zn(_,E)||_);const C=A!=="/"&&A.endsWith("/")?A.length-1:A.length;let k=I===A||!n&&I.startsWith(A)&&I.charAt(C)==="/",D=_!=null&&(_===A||!n&&_.startsWith(A)&&_.charAt(A.length)==="/"),O={isActive:k,isPending:D,isTransitioning:T},F=k?e:void 0,j;typeof s=="function"?j=s(O):j=[s,k?"active":null,D?"pending":null,T?"transitioning":null].filter(Boolean).join(" ");let U=typeof r=="function"?r(O):r;return w.createElement(Wr,{...u,"aria-current":F,className:j,ref:f,style:U,to:l,viewTransition:c},typeof d=="function"?d(O):d)});dI.displayName="NavLink";var hI=w.forwardRef(({discover:i="render",fetcherKey:e,navigate:t,reloadDocument:s,replace:n,state:r,method:l=nu,action:c,onSubmit:d,relative:u,preventScrollReset:f,viewTransition:g,unstable_defaultShouldRevalidate:y,...x},S)=>{let{unstable_useTransitions:E}=w.useContext(Ei),T=yI(),A=vI(c,{relative:u}),I=l.toLowerCase()==="get"?"get":"post",_=typeof c=="string"&&hS.test(c),C=k=>{if(d&&d(k),k.defaultPrevented)return;k.preventDefault();let D=k.nativeEvent.submitter,O=D?.getAttribute("formmethod")||l,F=()=>T(D||k.currentTarget,{fetcherKey:e,method:O,navigate:t,replace:n,state:r,relative:u,preventScrollReset:f,viewTransition:g,unstable_defaultShouldRevalidate:y});E&&t!==!1?w.startTransition(()=>F()):F()};return w.createElement("form",{ref:S,method:I,action:A,onSubmit:s?d:C,...x,"data-discover":!_&&i==="render"?"true":void 0})});hI.displayName="Form";function fI(i){return`${i} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function fS(i){let e=w.useContext(tl);return Ht(e,fI(i)),e}function mI(i,{target:e,replace:t,state:s,preventScrollReset:n,relative:r,viewTransition:l,unstable_defaultShouldRevalidate:c,unstable_useTransitions:d}={}){let u=js(),f=Kn(),g=go(i,{relative:r});return w.useCallback(y=>{if(z_(y,e)){y.preventDefault();let x=t!==void 0?t:ro(f)===ro(g),S=()=>u(i,{replace:x,state:s,preventScrollReset:n,relative:r,viewTransition:l,unstable_defaultShouldRevalidate:c});d?w.startTransition(()=>S()):S()}},[f,u,g,t,s,e,i,n,r,l,c,d])}var pI=0,gI=()=>`__${String(++pI)}__`;function yI(){let{router:i}=fS("useSubmit"),{basename:e}=w.useContext(Ei),t=O_(),s=i.fetch,n=i.navigate;return w.useCallback(async(r,l={})=>{let{action:c,method:d,encType:u,formData:f,body:g}=q_(r,e);if(l.navigate===!1){let y=l.fetcherKey||gI();await s(y,t,l.action||c,{unstable_defaultShouldRevalidate:l.unstable_defaultShouldRevalidate,preventScrollReset:l.preventScrollReset,formData:f,body:g,formMethod:l.method||d,formEncType:l.encType||u,flushSync:l.flushSync})}else await n(l.action||c,{unstable_defaultShouldRevalidate:l.unstable_defaultShouldRevalidate,preventScrollReset:l.preventScrollReset,formData:f,body:g,formMethod:l.method||d,formEncType:l.encType||u,replace:l.replace,state:l.state,fromRouteId:t,flushSync:l.flushSync,viewTransition:l.viewTransition})},[s,n,e,t])}function vI(i,{relative:e}={}){let{basename:t}=w.useContext(Ei),s=w.useContext(Bi);Ht(s,"useFormAction must be used inside a RouteContext");let[n]=s.matches.slice(-1),r={...go(i||".",{relative:e})},l=Kn();if(i==null){r.search=l.search;let c=new URLSearchParams(r.search),d=c.getAll("index");if(d.some(f=>f==="")){c.delete("index"),d.filter(g=>g).forEach(g=>c.append("index",g));let f=c.toString();r.search=f?`?${f}`:""}}return(!i||i===".")&&n.route.index&&(r.search=r.search?r.search.replace(/^\?/,"?index&"):"?index"),t!=="/"&&(r.pathname=r.pathname==="/"?t:Hn([t,r.pathname])),ro(r)}function xI(i,{relative:e}={}){let t=w.useContext(iS);Ht(t!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:s}=fS("useViewTransitionState"),n=go(i,{relative:e});if(!t.isTransitioning)return!1;let r=zn(t.currentLocation.pathname,s)||t.currentLocation.pathname,l=zn(t.nextLocation.pathname,s)||t.nextLocation.pathname;return xu(n.pathname,l)!=null||xu(n.pathname,r)!=null}var SI=Wx();const mS=w.createContext(),bI={"#ff7e00":"https://raw.githubusercontent.com/gorillasuti/Legitflix-plugin/refs/heads/main/legitflix-client/public/default-logo-orange.png","#00aaff":"https://raw.githubusercontent.com/gorillasuti/Legitflix-plugin/refs/heads/main/legitflix-client/public/default-logo-blue.png","#00ff7e":"https://raw.githubusercontent.com/gorillasuti/Legitflix-plugin/refs/heads/main/legitflix-client/public/default-logo-green.png","#ff3333":"https://raw.githubusercontent.com/gorillasuti/Legitflix-plugin/refs/heads/main/legitflix-client/public/default-logo-red.png","#aa00ff":"https://raw.githubusercontent.com/gorillasuti/Legitflix-plugin/refs/heads/main/legitflix-client/public/default-logo-purple.png","#ff00aa":"https://raw.githubusercontent.com/gorillasuti/Legitflix-plugin/refs/heads/main/legitflix-client/public/default-logo-purple.png"},yo=i=>bI[i?.toLowerCase()]||"https://raw.githubusercontent.com/gorillasuti/Legitflix-plugin/refs/heads/main/legitflix-client/public/default-logo-orange.png",Wi=()=>w.useContext(mS),TI=({children:i})=>{const[e,t]=w.useState({heroMediaTypes:"Movie,Series",promoMediaTypes:["Movie","Series"],contentTypeFilters:{Movie:!0,Series:!0,MusicAlbum:!1,Audio:!1,MusicVideo:!1},contentSortMode:"latest",heroLimit:20,enableJellyseerr:!0,jellyseerrUrl:"https://request.legitflix.eu",jellyseerrBackground:null,jellyseerrText:"Request Feature",logoType:"text",logoUrl:"",appName:"LegitFlix",fastForwardTime:10,rewindTime:10,hideBackdrop:!1,disableThemeSong:!1,enableSnow:!1,accentColor:"#ff7e00",showNavbarCategories:!0,showNavbarRequests:!0,showLibraryTitles:!0,appBackground:null,playerSeekForward:30,playerSeekBackward:10,defaultAudioLanguage:"auto",defaultSubtitleLanguage:"auto",prioritizeAudioLanguage:!1});w.useEffect(()=>{const c=localStorage.getItem("LegitFlix_Config");if(c)try{const d=JSON.parse(c);t(u=>({...u,...d})),d.accentColor&&s(d.accentColor),d.faviconUrl&&n(d.faviconUrl),r(d.subtitleSize,d.subtitleColor,d.subtitleBackground)}catch(d){console.error("Failed to parse local config",d)}else s(e.accentColor),r(e.subtitleSize,e.subtitleColor,e.subtitleBackground)},[]);const s=c=>{document.documentElement.style.setProperty("--clr-accent",c);const d=parseInt(c.slice(1,3),16),u=parseInt(c.slice(3,5),16),f=parseInt(c.slice(5,7),16);document.documentElement.style.setProperty("--clr-accent-glow",`rgba(${d}, ${u}, ${f}, 0.5)`)},n=c=>{let d=document.querySelector("link[rel~='icon']");d||(d=document.createElement("link"),d.rel="icon",document.head.appendChild(d)),d.href=c||"/favicon.png"},r=(c,d,u)=>{const f=document.documentElement;f.style.setProperty("--lf-sub-size",c||"100%"),f.style.setProperty("--lf-sub-color",d||"#ffffff");let g="0px 1px 2px rgba(0,0,0,0.8)",y="transparent";u==="drop-shadow"?g="0px 2px 4px rgba(0,0,0,0.9)":u==="outline"?g="-1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000":u==="box"?(y="rgba(0,0,0,0.7)",g="none"):u==="none"&&(g="none"),f.style.setProperty("--lf-sub-shadow",g),f.style.setProperty("--lf-sub-bg",y)},l=c=>{t(d=>{const u={...d,...c};return localStorage.setItem("LegitFlix_Config",JSON.stringify(u)),c.accentColor&&s(c.accentColor),c.faviconUrl!==void 0&&n(c.faviconUrl),(c.subtitleSize!==void 0||c.subtitleColor!==void 0||c.subtitleBackground!==void 0)&&r(u.subtitleSize,u.subtitleColor,u.subtitleBackground),u})};return p.jsx(mS.Provider,{value:{config:e,updateConfig:l},children:i})};var Js;(function(i){i[i.GREAT=2]="GREAT",i[i.GOOD=1]="GOOD",i[i.OK=0]="OK",i[i.BAD=-1]="BAD"})(Js||(Js={}));const Su="http:",bu="https:",EI=80,AI=443;function _I(i){if(i=i.trim(),/^data:/i.test(i))throw new Error("data URLs are not supported");if(/^view-source:/i.test(i))throw new Error("`view-source:` is not supported as it is a non-standard protocol");if(!i.startsWith("//")&&/^\.*\//.test(i)||(i=i.replace(/^(?!(?:\w+:)?\/\/)|^\/\//,Su)),!/^https?:/i.test(i))throw new Error("only http or https protocols are supported");const s=new URL(i);if(s.hash="",s.pathname){const n=/\b[a-z][a-z\d+\-.]{1,50}:\/\//g;let r=0,l="";for(;;){const d=n.exec(s.pathname);if(!d)break;const u=d[0],f=d.index,g=s.pathname.slice(r,f);l+=g.replace(/\/{2,}/g,"/"),l+=u,r=f+u.length}const c=s.pathname.slice(r,s.pathname.length);l+=c.replace(/\/{2,}/g,"/"),s.pathname=l}if(s.pathname)try{s.pathname=decodeURI(s.pathname)}catch{}return s.hostname&&(s.hostname=s.hostname.replace(/\.$/,"")),s.search="",s.pathname=s.pathname.replace(/\/$/,""),i=s.toString(),i}function Mc(i){return new URL(i.toString())}function pS(i){if(i===Su)return EI;if(i===bu)return AI;throw new Error("Unsupported protocol")}function II(i,e){const t=e.port||pS(e.protocol);return i.toLowerCase().startsWith(`${e.protocol}//${e.hostname.toLowerCase()}:${t}`)}function gS(i){return!i.port||i.port===pS(i.protocol).toString()}function RI(i){if(!i?.trim())throw new Error("Input is required");return new URL(_I(i))}const Yf=8096,yS=8920;function ev(i){let e=0;return i.protocol===bu?e+=5:e-=5,i.port===Yf.toString()?e+=2:i.port===yS.toString()&&(e-=1),gS(i)&&(e+=3),e}function LI(i){const e=[];try{const t=RI(i);if(II(i,t))return[t.toString()];if(e.push(t),t.protocol===Su){const s=Mc(t);s.protocol=bu,e.push(s)}return e.filter(gS).forEach(s=>{if(s.protocol===Su){const n=Mc(s);n.port=Yf.toString(),e.push(n)}else if(s.protocol===bu){let n=Mc(s);n.port=Yf.toString(),e.push(n),n=Mc(s),n.port=yS.toString(),e.push(n)}}),e.sort((s,n)=>ev(n)-ev(s)),e.map(s=>s.toString())}catch(t){return console.warn(t),[]}}class il{}class wI extends il{constructor(e){super(),this.productName=e}}class CI extends il{constructor(e){super(),this.responseTime=e}}class kI extends il{constructor(e){super(),this.error=e}}class tv extends il{}class NI extends il{constructor(e){super(),this.version=e}}class OI extends il{constructor(e){super(),this.version=e}}function vS(i,e){return function(){return i.apply(e,arguments)}}const{toString:DI}=Object.prototype,{getPrototypeOf:Cm}=Object,{iterator:Vu,toStringTag:xS}=Symbol,$u=(i=>e=>{const t=DI.call(e);return i[t]||(i[t]=t.slice(8,-1).toLowerCase())})(Object.create(null)),Xi=i=>(i=i.toLowerCase(),e=>$u(e)===i),Gu=i=>e=>typeof e===i,{isArray:nl}=Array,Xr=Gu("undefined");function vo(i){return i!==null&&!Xr(i)&&i.constructor!==null&&!Xr(i.constructor)&&ti(i.constructor.isBuffer)&&i.constructor.isBuffer(i)}const SS=Xi("ArrayBuffer");function PI(i){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(i):e=i&&i.buffer&&SS(i.buffer),e}const UI=Gu("string"),ti=Gu("function"),bS=Gu("number"),xo=i=>i!==null&&typeof i=="object",MI=i=>i===!0||i===!1,ru=i=>{if($u(i)!=="object")return!1;const e=Cm(i);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(xS in i)&&!(Vu in i)},jI=i=>{if(!xo(i)||vo(i))return!1;try{return Object.keys(i).length===0&&Object.getPrototypeOf(i)===Object.prototype}catch{return!1}},FI=Xi("Date"),BI=Xi("File"),VI=Xi("Blob"),$I=Xi("FileList"),GI=i=>xo(i)&&ti(i.pipe),HI=i=>{let e;return i&&(typeof FormData=="function"&&i instanceof FormData||ti(i.append)&&((e=$u(i))==="formdata"||e==="object"&&ti(i.toString)&&i.toString()==="[object FormData]"))},zI=Xi("URLSearchParams"),[KI,YI,qI,QI]=["ReadableStream","Request","Response","Headers"].map(Xi),WI=i=>i.trim?i.trim():i.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function So(i,e,{allOwnKeys:t=!1}={}){if(i===null||typeof i>"u")return;let s,n;if(typeof i!="object"&&(i=[i]),nl(i))for(s=0,n=i.length;s<n;s++)e.call(null,i[s],s,i);else{if(vo(i))return;const r=t?Object.getOwnPropertyNames(i):Object.keys(i),l=r.length;let c;for(s=0;s<l;s++)c=r[s],e.call(null,i[c],c,i)}}function TS(i,e){if(vo(i))return null;e=e.toLowerCase();const t=Object.keys(i);let s=t.length,n;for(;s-- >0;)if(n=t[s],e===n.toLowerCase())return n;return null}const Qa=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,ES=i=>!Xr(i)&&i!==Qa;function qf(){const{caseless:i,skipUndefined:e}=ES(this)&&this||{},t={},s=(n,r)=>{if(r==="__proto__"||r==="constructor"||r==="prototype")return;const l=i&&TS(t,r)||r;ru(t[l])&&ru(n)?t[l]=qf(t[l],n):ru(n)?t[l]=qf({},n):nl(n)?t[l]=n.slice():(!e||!Xr(n))&&(t[l]=n)};for(let n=0,r=arguments.length;n<r;n++)arguments[n]&&So(arguments[n],s);return t}const XI=(i,e,t,{allOwnKeys:s}={})=>(So(e,(n,r)=>{t&&ti(n)?Object.defineProperty(i,r,{value:vS(n,t),writable:!0,enumerable:!0,configurable:!0}):Object.defineProperty(i,r,{value:n,writable:!0,enumerable:!0,configurable:!0})},{allOwnKeys:s}),i),ZI=i=>(i.charCodeAt(0)===65279&&(i=i.slice(1)),i),JI=(i,e,t,s)=>{i.prototype=Object.create(e.prototype,s),Object.defineProperty(i.prototype,"constructor",{value:i,writable:!0,enumerable:!1,configurable:!0}),Object.defineProperty(i,"super",{value:e.prototype}),t&&Object.assign(i.prototype,t)},eR=(i,e,t,s)=>{let n,r,l;const c={};if(e=e||{},i==null)return e;do{for(n=Object.getOwnPropertyNames(i),r=n.length;r-- >0;)l=n[r],(!s||s(l,i,e))&&!c[l]&&(e[l]=i[l],c[l]=!0);i=t!==!1&&Cm(i)}while(i&&(!t||t(i,e))&&i!==Object.prototype);return e},tR=(i,e,t)=>{i=String(i),(t===void 0||t>i.length)&&(t=i.length),t-=e.length;const s=i.indexOf(e,t);return s!==-1&&s===t},sR=i=>{if(!i)return null;if(nl(i))return i;let e=i.length;if(!bS(e))return null;const t=new Array(e);for(;e-- >0;)t[e]=i[e];return t},iR=(i=>e=>i&&e instanceof i)(typeof Uint8Array<"u"&&Cm(Uint8Array)),nR=(i,e)=>{const s=(i&&i[Vu]).call(i);let n;for(;(n=s.next())&&!n.done;){const r=n.value;e.call(i,r[0],r[1])}},aR=(i,e)=>{let t;const s=[];for(;(t=i.exec(e))!==null;)s.push(t);return s},rR=Xi("HTMLFormElement"),lR=i=>i.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,s,n){return s.toUpperCase()+n}),sv=(({hasOwnProperty:i})=>(e,t)=>i.call(e,t))(Object.prototype),oR=Xi("RegExp"),AS=(i,e)=>{const t=Object.getOwnPropertyDescriptors(i),s={};So(t,(n,r)=>{let l;(l=e(n,r,i))!==!1&&(s[r]=l||n)}),Object.defineProperties(i,s)},cR=i=>{AS(i,(e,t)=>{if(ti(i)&&["arguments","caller","callee"].indexOf(t)!==-1)return!1;const s=i[t];if(ti(s)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+t+"'")})}})},uR=(i,e)=>{const t={},s=n=>{n.forEach(r=>{t[r]=!0})};return nl(i)?s(i):s(String(i).split(e)),t},dR=()=>{},hR=(i,e)=>i!=null&&Number.isFinite(i=+i)?i:e;function fR(i){return!!(i&&ti(i.append)&&i[xS]==="FormData"&&i[Vu])}const mR=i=>{const e=new Array(10),t=(s,n)=>{if(xo(s)){if(e.indexOf(s)>=0)return;if(vo(s))return s;if(!("toJSON"in s)){e[n]=s;const r=nl(s)?[]:{};return So(s,(l,c)=>{const d=t(l,n+1);!Xr(d)&&(r[c]=d)}),e[n]=void 0,r}}return s};return t(i,0)},pR=Xi("AsyncFunction"),gR=i=>i&&(xo(i)||ti(i))&&ti(i.then)&&ti(i.catch),_S=((i,e)=>i?setImmediate:e?((t,s)=>(Qa.addEventListener("message",({source:n,data:r})=>{n===Qa&&r===t&&s.length&&s.shift()()},!1),n=>{s.push(n),Qa.postMessage(t,"*")}))(`axios@${Math.random()}`,[]):t=>setTimeout(t))(typeof setImmediate=="function",ti(Qa.postMessage)),yR=typeof queueMicrotask<"u"?queueMicrotask.bind(Qa):typeof process<"u"&&process.nextTick||_S,vR=i=>i!=null&&ti(i[Vu]),ie={isArray:nl,isArrayBuffer:SS,isBuffer:vo,isFormData:HI,isArrayBufferView:PI,isString:UI,isNumber:bS,isBoolean:MI,isObject:xo,isPlainObject:ru,isEmptyObject:jI,isReadableStream:KI,isRequest:YI,isResponse:qI,isHeaders:QI,isUndefined:Xr,isDate:FI,isFile:BI,isBlob:VI,isRegExp:oR,isFunction:ti,isStream:GI,isURLSearchParams:zI,isTypedArray:iR,isFileList:$I,forEach:So,merge:qf,extend:XI,trim:WI,stripBOM:ZI,inherits:JI,toFlatObject:eR,kindOf:$u,kindOfTest:Xi,endsWith:tR,toArray:sR,forEachEntry:nR,matchAll:aR,isHTMLForm:rR,hasOwnProperty:sv,hasOwnProp:sv,reduceDescriptors:AS,freezeMethods:cR,toObjectSet:uR,toCamelCase:lR,noop:dR,toFiniteNumber:hR,findKey:TS,global:Qa,isContextDefined:ES,isSpecCompliantForm:fR,toJSONObject:mR,isAsyncFn:pR,isThenable:gR,setImmediate:_S,asap:yR,isIterable:vR};let Ke=class IS extends Error{static from(e,t,s,n,r,l){const c=new IS(e.message,t||e.code,s,n,r);return c.cause=e,c.name=e.name,l&&Object.assign(c,l),c}constructor(e,t,s,n,r){super(e),this.name="AxiosError",this.isAxiosError=!0,t&&(this.code=t),s&&(this.config=s),n&&(this.request=n),r&&(this.response=r,this.status=r.status)}toJSON(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:ie.toJSONObject(this.config),code:this.code,status:this.status}}};Ke.ERR_BAD_OPTION_VALUE="ERR_BAD_OPTION_VALUE";Ke.ERR_BAD_OPTION="ERR_BAD_OPTION";Ke.ECONNABORTED="ECONNABORTED";Ke.ETIMEDOUT="ETIMEDOUT";Ke.ERR_NETWORK="ERR_NETWORK";Ke.ERR_FR_TOO_MANY_REDIRECTS="ERR_FR_TOO_MANY_REDIRECTS";Ke.ERR_DEPRECATED="ERR_DEPRECATED";Ke.ERR_BAD_RESPONSE="ERR_BAD_RESPONSE";Ke.ERR_BAD_REQUEST="ERR_BAD_REQUEST";Ke.ERR_CANCELED="ERR_CANCELED";Ke.ERR_NOT_SUPPORT="ERR_NOT_SUPPORT";Ke.ERR_INVALID_URL="ERR_INVALID_URL";const xR=null;function Qf(i){return ie.isPlainObject(i)||ie.isArray(i)}function RS(i){return ie.endsWith(i,"[]")?i.slice(0,-2):i}function iv(i,e,t){return i?i.concat(e).map(function(n,r){return n=RS(n),!t&&r?"["+n+"]":n}).join(t?".":""):e}function SR(i){return ie.isArray(i)&&!i.some(Qf)}const bR=ie.toFlatObject(ie,{},null,function(e){return/^is[A-Z]/.test(e)});function Hu(i,e,t){if(!ie.isObject(i))throw new TypeError("target must be an object");e=e||new FormData,t=ie.toFlatObject(t,{metaTokens:!0,dots:!1,indexes:!1},!1,function(E,T){return!ie.isUndefined(T[E])});const s=t.metaTokens,n=t.visitor||f,r=t.dots,l=t.indexes,d=(t.Blob||typeof Blob<"u"&&Blob)&&ie.isSpecCompliantForm(e);if(!ie.isFunction(n))throw new TypeError("visitor must be a function");function u(S){if(S===null)return"";if(ie.isDate(S))return S.toISOString();if(ie.isBoolean(S))return S.toString();if(!d&&ie.isBlob(S))throw new Ke("Blob is not supported. Use a Buffer instead.");return ie.isArrayBuffer(S)||ie.isTypedArray(S)?d&&typeof Blob=="function"?new Blob([S]):Buffer.from(S):S}function f(S,E,T){let A=S;if(S&&!T&&typeof S=="object"){if(ie.endsWith(E,"{}"))E=s?E:E.slice(0,-2),S=JSON.stringify(S);else if(ie.isArray(S)&&SR(S)||(ie.isFileList(S)||ie.endsWith(E,"[]"))&&(A=ie.toArray(S)))return E=RS(E),A.forEach(function(_,C){!(ie.isUndefined(_)||_===null)&&e.append(l===!0?iv([E],C,r):l===null?E:E+"[]",u(_))}),!1}return Qf(S)?!0:(e.append(iv(T,E,r),u(S)),!1)}const g=[],y=Object.assign(bR,{defaultVisitor:f,convertValue:u,isVisitable:Qf});function x(S,E){if(!ie.isUndefined(S)){if(g.indexOf(S)!==-1)throw Error("Circular reference detected in "+E.join("."));g.push(S),ie.forEach(S,function(A,I){(!(ie.isUndefined(A)||A===null)&&n.call(e,A,ie.isString(I)?I.trim():I,E,y))===!0&&x(A,E?E.concat(I):[I])}),g.pop()}}if(!ie.isObject(i))throw new TypeError("data must be an object");return x(i),e}function nv(i){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(i).replace(/[!'()~]|%20|%00/g,function(s){return e[s]})}function km(i,e){this._pairs=[],i&&Hu(i,this,e)}const LS=km.prototype;LS.append=function(e,t){this._pairs.push([e,t])};LS.toString=function(e){const t=e?function(s){return e.call(this,s,nv)}:nv;return this._pairs.map(function(n){return t(n[0])+"="+t(n[1])},"").join("&")};function TR(i){return encodeURIComponent(i).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function wS(i,e,t){if(!e)return i;const s=t&&t.encode||TR,n=ie.isFunction(t)?{serialize:t}:t,r=n&&n.serialize;let l;if(r?l=r(e,n):l=ie.isURLSearchParams(e)?e.toString():new km(e,n).toString(s),l){const c=i.indexOf("#");c!==-1&&(i=i.slice(0,c)),i+=(i.indexOf("?")===-1?"?":"&")+l}return i}class av{constructor(){this.handlers=[]}use(e,t,s){return this.handlers.push({fulfilled:e,rejected:t,synchronous:s?s.synchronous:!1,runWhen:s?s.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){ie.forEach(this.handlers,function(s){s!==null&&e(s)})}}const Nm={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1,legacyInterceptorReqResOrdering:!0},ER=typeof URLSearchParams<"u"?URLSearchParams:km,AR=typeof FormData<"u"?FormData:null,_R=typeof Blob<"u"?Blob:null,IR={isBrowser:!0,classes:{URLSearchParams:ER,FormData:AR,Blob:_R},protocols:["http","https","file","blob","url","data"]},Om=typeof window<"u"&&typeof document<"u",Wf=typeof navigator=="object"&&navigator||void 0,RR=Om&&(!Wf||["ReactNative","NativeScript","NS"].indexOf(Wf.product)<0),LR=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",wR=Om&&window.location.href||"http://localhost",CR=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Om,hasStandardBrowserEnv:RR,hasStandardBrowserWebWorkerEnv:LR,navigator:Wf,origin:wR},Symbol.toStringTag,{value:"Module"})),Ms={...CR,...IR};function kR(i,e){return Hu(i,new Ms.classes.URLSearchParams,{visitor:function(t,s,n,r){return Ms.isNode&&ie.isBuffer(t)?(this.append(s,t.toString("base64")),!1):r.defaultVisitor.apply(this,arguments)},...e})}function NR(i){return ie.matchAll(/\w+|\[(\w*)]/g,i).map(e=>e[0]==="[]"?"":e[1]||e[0])}function OR(i){const e={},t=Object.keys(i);let s;const n=t.length;let r;for(s=0;s<n;s++)r=t[s],e[r]=i[r];return e}function CS(i){function e(t,s,n,r){let l=t[r++];if(l==="__proto__")return!0;const c=Number.isFinite(+l),d=r>=t.length;return l=!l&&ie.isArray(n)?n.length:l,d?(ie.hasOwnProp(n,l)?n[l]=[n[l],s]:n[l]=s,!c):((!n[l]||!ie.isObject(n[l]))&&(n[l]=[]),e(t,s,n[l],r)&&ie.isArray(n[l])&&(n[l]=OR(n[l])),!c)}if(ie.isFormData(i)&&ie.isFunction(i.entries)){const t={};return ie.forEachEntry(i,(s,n)=>{e(NR(s),n,t,0)}),t}return null}function DR(i,e,t){if(ie.isString(i))try{return(e||JSON.parse)(i),ie.trim(i)}catch(s){if(s.name!=="SyntaxError")throw s}return(t||JSON.stringify)(i)}const bo={transitional:Nm,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const s=t.getContentType()||"",n=s.indexOf("application/json")>-1,r=ie.isObject(e);if(r&&ie.isHTMLForm(e)&&(e=new FormData(e)),ie.isFormData(e))return n?JSON.stringify(CS(e)):e;if(ie.isArrayBuffer(e)||ie.isBuffer(e)||ie.isStream(e)||ie.isFile(e)||ie.isBlob(e)||ie.isReadableStream(e))return e;if(ie.isArrayBufferView(e))return e.buffer;if(ie.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let c;if(r){if(s.indexOf("application/x-www-form-urlencoded")>-1)return kR(e,this.formSerializer).toString();if((c=ie.isFileList(e))||s.indexOf("multipart/form-data")>-1){const d=this.env&&this.env.FormData;return Hu(c?{"files[]":e}:e,d&&new d,this.formSerializer)}}return r||n?(t.setContentType("application/json",!1),DR(e)):e}],transformResponse:[function(e){const t=this.transitional||bo.transitional,s=t&&t.forcedJSONParsing,n=this.responseType==="json";if(ie.isResponse(e)||ie.isReadableStream(e))return e;if(e&&ie.isString(e)&&(s&&!this.responseType||n)){const l=!(t&&t.silentJSONParsing)&&n;try{return JSON.parse(e,this.parseReviver)}catch(c){if(l)throw c.name==="SyntaxError"?Ke.from(c,Ke.ERR_BAD_RESPONSE,this,null,this.response):c}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Ms.classes.FormData,Blob:Ms.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};ie.forEach(["delete","get","head","post","put","patch"],i=>{bo.headers[i]={}});const PR=ie.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),UR=i=>{const e={};let t,s,n;return i&&i.split(`
`).forEach(function(l){n=l.indexOf(":"),t=l.substring(0,n).trim().toLowerCase(),s=l.substring(n+1).trim(),!(!t||e[t]&&PR[t])&&(t==="set-cookie"?e[t]?e[t].push(s):e[t]=[s]:e[t]=e[t]?e[t]+", "+s:s)}),e},rv=Symbol("internals");function Jl(i){return i&&String(i).trim().toLowerCase()}function lu(i){return i===!1||i==null?i:ie.isArray(i)?i.map(lu):String(i)}function MR(i){const e=Object.create(null),t=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let s;for(;s=t.exec(i);)e[s[1]]=s[2];return e}const jR=i=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(i.trim());function mf(i,e,t,s,n){if(ie.isFunction(s))return s.call(this,e,t);if(n&&(e=t),!!ie.isString(e)){if(ie.isString(s))return e.indexOf(s)!==-1;if(ie.isRegExp(s))return s.test(e)}}function FR(i){return i.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,s)=>t.toUpperCase()+s)}function BR(i,e){const t=ie.toCamelCase(" "+e);["get","set","has"].forEach(s=>{Object.defineProperty(i,s+t,{value:function(n,r,l){return this[s].call(this,e,n,r,l)},configurable:!0})})}let si=class{constructor(e){e&&this.set(e)}set(e,t,s){const n=this;function r(c,d,u){const f=Jl(d);if(!f)throw new Error("header name must be a non-empty string");const g=ie.findKey(n,f);(!g||n[g]===void 0||u===!0||u===void 0&&n[g]!==!1)&&(n[g||d]=lu(c))}const l=(c,d)=>ie.forEach(c,(u,f)=>r(u,f,d));if(ie.isPlainObject(e)||e instanceof this.constructor)l(e,t);else if(ie.isString(e)&&(e=e.trim())&&!jR(e))l(UR(e),t);else if(ie.isObject(e)&&ie.isIterable(e)){let c={},d,u;for(const f of e){if(!ie.isArray(f))throw TypeError("Object iterator must return a key-value pair");c[u=f[0]]=(d=c[u])?ie.isArray(d)?[...d,f[1]]:[d,f[1]]:f[1]}l(c,t)}else e!=null&&r(t,e,s);return this}get(e,t){if(e=Jl(e),e){const s=ie.findKey(this,e);if(s){const n=this[s];if(!t)return n;if(t===!0)return MR(n);if(ie.isFunction(t))return t.call(this,n,s);if(ie.isRegExp(t))return t.exec(n);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=Jl(e),e){const s=ie.findKey(this,e);return!!(s&&this[s]!==void 0&&(!t||mf(this,this[s],s,t)))}return!1}delete(e,t){const s=this;let n=!1;function r(l){if(l=Jl(l),l){const c=ie.findKey(s,l);c&&(!t||mf(s,s[c],c,t))&&(delete s[c],n=!0)}}return ie.isArray(e)?e.forEach(r):r(e),n}clear(e){const t=Object.keys(this);let s=t.length,n=!1;for(;s--;){const r=t[s];(!e||mf(this,this[r],r,e,!0))&&(delete this[r],n=!0)}return n}normalize(e){const t=this,s={};return ie.forEach(this,(n,r)=>{const l=ie.findKey(s,r);if(l){t[l]=lu(n),delete t[r];return}const c=e?FR(r):String(r).trim();c!==r&&delete t[r],t[c]=lu(n),s[c]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return ie.forEach(this,(s,n)=>{s!=null&&s!==!1&&(t[n]=e&&ie.isArray(s)?s.join(", "):s)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const s=new this(e);return t.forEach(n=>s.set(n)),s}static accessor(e){const s=(this[rv]=this[rv]={accessors:{}}).accessors,n=this.prototype;function r(l){const c=Jl(l);s[c]||(BR(n,l),s[c]=!0)}return ie.isArray(e)?e.forEach(r):r(e),this}};si.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);ie.reduceDescriptors(si.prototype,({value:i},e)=>{let t=e[0].toUpperCase()+e.slice(1);return{get:()=>i,set(s){this[t]=s}}});ie.freezeMethods(si);function pf(i,e){const t=this||bo,s=e||t,n=si.from(s.headers);let r=s.data;return ie.forEach(i,function(c){r=c.call(t,r,n.normalize(),e?e.status:void 0)}),n.normalize(),r}function kS(i){return!!(i&&i.__CANCEL__)}let To=class extends Ke{constructor(e,t,s){super(e??"canceled",Ke.ERR_CANCELED,t,s),this.name="CanceledError",this.__CANCEL__=!0}};function NS(i,e,t){const s=t.config.validateStatus;!t.status||!s||s(t.status)?i(t):e(new Ke("Request failed with status code "+t.status,[Ke.ERR_BAD_REQUEST,Ke.ERR_BAD_RESPONSE][Math.floor(t.status/100)-4],t.config,t.request,t))}function VR(i){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(i);return e&&e[1]||""}function $R(i,e){i=i||10;const t=new Array(i),s=new Array(i);let n=0,r=0,l;return e=e!==void 0?e:1e3,function(d){const u=Date.now(),f=s[r];l||(l=u),t[n]=d,s[n]=u;let g=r,y=0;for(;g!==n;)y+=t[g++],g=g%i;if(n=(n+1)%i,n===r&&(r=(r+1)%i),u-l<e)return;const x=f&&u-f;return x?Math.round(y*1e3/x):void 0}}function GR(i,e){let t=0,s=1e3/e,n,r;const l=(u,f=Date.now())=>{t=f,n=null,r&&(clearTimeout(r),r=null),i(...u)};return[(...u)=>{const f=Date.now(),g=f-t;g>=s?l(u,f):(n=u,r||(r=setTimeout(()=>{r=null,l(n)},s-g)))},()=>n&&l(n)]}const Tu=(i,e,t=3)=>{let s=0;const n=$R(50,250);return GR(r=>{const l=r.loaded,c=r.lengthComputable?r.total:void 0,d=l-s,u=n(d),f=l<=c;s=l;const g={loaded:l,total:c,progress:c?l/c:void 0,bytes:d,rate:u||void 0,estimated:u&&c&&f?(c-l)/u:void 0,event:r,lengthComputable:c!=null,[e?"download":"upload"]:!0};i(g)},t)},lv=(i,e)=>{const t=i!=null;return[s=>e[0]({lengthComputable:t,total:i,loaded:s}),e[1]]},ov=i=>(...e)=>ie.asap(()=>i(...e)),HR=Ms.hasStandardBrowserEnv?((i,e)=>t=>(t=new URL(t,Ms.origin),i.protocol===t.protocol&&i.host===t.host&&(e||i.port===t.port)))(new URL(Ms.origin),Ms.navigator&&/(msie|trident)/i.test(Ms.navigator.userAgent)):()=>!0,zR=Ms.hasStandardBrowserEnv?{write(i,e,t,s,n,r,l){if(typeof document>"u")return;const c=[`${i}=${encodeURIComponent(e)}`];ie.isNumber(t)&&c.push(`expires=${new Date(t).toUTCString()}`),ie.isString(s)&&c.push(`path=${s}`),ie.isString(n)&&c.push(`domain=${n}`),r===!0&&c.push("secure"),ie.isString(l)&&c.push(`SameSite=${l}`),document.cookie=c.join("; ")},read(i){if(typeof document>"u")return null;const e=document.cookie.match(new RegExp("(?:^|; )"+i+"=([^;]*)"));return e?decodeURIComponent(e[1]):null},remove(i){this.write(i,"",Date.now()-864e5,"/")}}:{write(){},read(){return null},remove(){}};function KR(i){return typeof i!="string"?!1:/^([a-z][a-z\d+\-.]*:)?\/\//i.test(i)}function YR(i,e){return e?i.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):i}function OS(i,e,t){let s=!KR(e);return i&&(s||t==!1)?YR(i,e):e}const cv=i=>i instanceof si?{...i}:i;function Za(i,e){e=e||{};const t={};function s(u,f,g,y){return ie.isPlainObject(u)&&ie.isPlainObject(f)?ie.merge.call({caseless:y},u,f):ie.isPlainObject(f)?ie.merge({},f):ie.isArray(f)?f.slice():f}function n(u,f,g,y){if(ie.isUndefined(f)){if(!ie.isUndefined(u))return s(void 0,u,g,y)}else return s(u,f,g,y)}function r(u,f){if(!ie.isUndefined(f))return s(void 0,f)}function l(u,f){if(ie.isUndefined(f)){if(!ie.isUndefined(u))return s(void 0,u)}else return s(void 0,f)}function c(u,f,g){if(g in e)return s(u,f);if(g in i)return s(void 0,u)}const d={url:r,method:r,data:r,baseURL:l,transformRequest:l,transformResponse:l,paramsSerializer:l,timeout:l,timeoutMessage:l,withCredentials:l,withXSRFToken:l,adapter:l,responseType:l,xsrfCookieName:l,xsrfHeaderName:l,onUploadProgress:l,onDownloadProgress:l,decompress:l,maxContentLength:l,maxBodyLength:l,beforeRedirect:l,transport:l,httpAgent:l,httpsAgent:l,cancelToken:l,socketPath:l,responseEncoding:l,validateStatus:c,headers:(u,f,g)=>n(cv(u),cv(f),g,!0)};return ie.forEach(Object.keys({...i,...e}),function(f){if(f==="__proto__"||f==="constructor"||f==="prototype")return;const g=ie.hasOwnProp(d,f)?d[f]:n,y=g(i[f],e[f],f);ie.isUndefined(y)&&g!==c||(t[f]=y)}),t}const DS=i=>{const e=Za({},i);let{data:t,withXSRFToken:s,xsrfHeaderName:n,xsrfCookieName:r,headers:l,auth:c}=e;if(e.headers=l=si.from(l),e.url=wS(OS(e.baseURL,e.url,e.allowAbsoluteUrls),i.params,i.paramsSerializer),c&&l.set("Authorization","Basic "+btoa((c.username||"")+":"+(c.password?unescape(encodeURIComponent(c.password)):""))),ie.isFormData(t)){if(Ms.hasStandardBrowserEnv||Ms.hasStandardBrowserWebWorkerEnv)l.setContentType(void 0);else if(ie.isFunction(t.getHeaders)){const d=t.getHeaders(),u=["content-type","content-length"];Object.entries(d).forEach(([f,g])=>{u.includes(f.toLowerCase())&&l.set(f,g)})}}if(Ms.hasStandardBrowserEnv&&(s&&ie.isFunction(s)&&(s=s(e)),s||s!==!1&&HR(e.url))){const d=n&&r&&zR.read(r);d&&l.set(n,d)}return e},qR=typeof XMLHttpRequest<"u",QR=qR&&function(i){return new Promise(function(t,s){const n=DS(i);let r=n.data;const l=si.from(n.headers).normalize();let{responseType:c,onUploadProgress:d,onDownloadProgress:u}=n,f,g,y,x,S;function E(){x&&x(),S&&S(),n.cancelToken&&n.cancelToken.unsubscribe(f),n.signal&&n.signal.removeEventListener("abort",f)}let T=new XMLHttpRequest;T.open(n.method.toUpperCase(),n.url,!0),T.timeout=n.timeout;function A(){if(!T)return;const _=si.from("getAllResponseHeaders"in T&&T.getAllResponseHeaders()),k={data:!c||c==="text"||c==="json"?T.responseText:T.response,status:T.status,statusText:T.statusText,headers:_,config:i,request:T};NS(function(O){t(O),E()},function(O){s(O),E()},k),T=null}"onloadend"in T?T.onloadend=A:T.onreadystatechange=function(){!T||T.readyState!==4||T.status===0&&!(T.responseURL&&T.responseURL.indexOf("file:")===0)||setTimeout(A)},T.onabort=function(){T&&(s(new Ke("Request aborted",Ke.ECONNABORTED,i,T)),T=null)},T.onerror=function(C){const k=C&&C.message?C.message:"Network Error",D=new Ke(k,Ke.ERR_NETWORK,i,T);D.event=C||null,s(D),T=null},T.ontimeout=function(){let C=n.timeout?"timeout of "+n.timeout+"ms exceeded":"timeout exceeded";const k=n.transitional||Nm;n.timeoutErrorMessage&&(C=n.timeoutErrorMessage),s(new Ke(C,k.clarifyTimeoutError?Ke.ETIMEDOUT:Ke.ECONNABORTED,i,T)),T=null},r===void 0&&l.setContentType(null),"setRequestHeader"in T&&ie.forEach(l.toJSON(),function(C,k){T.setRequestHeader(k,C)}),ie.isUndefined(n.withCredentials)||(T.withCredentials=!!n.withCredentials),c&&c!=="json"&&(T.responseType=n.responseType),u&&([y,S]=Tu(u,!0),T.addEventListener("progress",y)),d&&T.upload&&([g,x]=Tu(d),T.upload.addEventListener("progress",g),T.upload.addEventListener("loadend",x)),(n.cancelToken||n.signal)&&(f=_=>{T&&(s(!_||_.type?new To(null,i,T):_),T.abort(),T=null)},n.cancelToken&&n.cancelToken.subscribe(f),n.signal&&(n.signal.aborted?f():n.signal.addEventListener("abort",f)));const I=VR(n.url);if(I&&Ms.protocols.indexOf(I)===-1){s(new Ke("Unsupported protocol "+I+":",Ke.ERR_BAD_REQUEST,i));return}T.send(r||null)})},WR=(i,e)=>{const{length:t}=i=i?i.filter(Boolean):[];if(e||t){let s=new AbortController,n;const r=function(u){if(!n){n=!0,c();const f=u instanceof Error?u:this.reason;s.abort(f instanceof Ke?f:new To(f instanceof Error?f.message:f))}};let l=e&&setTimeout(()=>{l=null,r(new Ke(`timeout of ${e}ms exceeded`,Ke.ETIMEDOUT))},e);const c=()=>{i&&(l&&clearTimeout(l),l=null,i.forEach(u=>{u.unsubscribe?u.unsubscribe(r):u.removeEventListener("abort",r)}),i=null)};i.forEach(u=>u.addEventListener("abort",r));const{signal:d}=s;return d.unsubscribe=()=>ie.asap(c),d}},XR=function*(i,e){let t=i.byteLength;if(t<e){yield i;return}let s=0,n;for(;s<t;)n=s+e,yield i.slice(s,n),s=n},ZR=async function*(i,e){for await(const t of JR(i))yield*XR(t,e)},JR=async function*(i){if(i[Symbol.asyncIterator]){yield*i;return}const e=i.getReader();try{for(;;){const{done:t,value:s}=await e.read();if(t)break;yield s}}finally{await e.cancel()}},uv=(i,e,t,s)=>{const n=ZR(i,e);let r=0,l,c=d=>{l||(l=!0,s&&s(d))};return new ReadableStream({async pull(d){try{const{done:u,value:f}=await n.next();if(u){c(),d.close();return}let g=f.byteLength;if(t){let y=r+=g;t(y)}d.enqueue(new Uint8Array(f))}catch(u){throw c(u),u}},cancel(d){return c(d),n.return()}},{highWaterMark:2})},dv=64*1024,{isFunction:jc}=ie,eL=(({Request:i,Response:e})=>({Request:i,Response:e}))(ie.global),{ReadableStream:hv,TextEncoder:fv}=ie.global,mv=(i,...e)=>{try{return!!i(...e)}catch{return!1}},tL=i=>{i=ie.merge.call({skipUndefined:!0},eL,i);const{fetch:e,Request:t,Response:s}=i,n=e?jc(e):typeof fetch=="function",r=jc(t),l=jc(s);if(!n)return!1;const c=n&&jc(hv),d=n&&(typeof fv=="function"?(S=>E=>S.encode(E))(new fv):async S=>new Uint8Array(await new t(S).arrayBuffer())),u=r&&c&&mv(()=>{let S=!1;const E=new t(Ms.origin,{body:new hv,method:"POST",get duplex(){return S=!0,"half"}}).headers.has("Content-Type");return S&&!E}),f=l&&c&&mv(()=>ie.isReadableStream(new s("").body)),g={stream:f&&(S=>S.body)};n&&["text","arrayBuffer","blob","formData","stream"].forEach(S=>{!g[S]&&(g[S]=(E,T)=>{let A=E&&E[S];if(A)return A.call(E);throw new Ke(`Response type '${S}' is not supported`,Ke.ERR_NOT_SUPPORT,T)})});const y=async S=>{if(S==null)return 0;if(ie.isBlob(S))return S.size;if(ie.isSpecCompliantForm(S))return(await new t(Ms.origin,{method:"POST",body:S}).arrayBuffer()).byteLength;if(ie.isArrayBufferView(S)||ie.isArrayBuffer(S))return S.byteLength;if(ie.isURLSearchParams(S)&&(S=S+""),ie.isString(S))return(await d(S)).byteLength},x=async(S,E)=>{const T=ie.toFiniteNumber(S.getContentLength());return T??y(E)};return async S=>{let{url:E,method:T,data:A,signal:I,cancelToken:_,timeout:C,onDownloadProgress:k,onUploadProgress:D,responseType:O,headers:F,withCredentials:j="same-origin",fetchOptions:U}=DS(S),K=e||fetch;O=O?(O+"").toLowerCase():"text";let H=WR([I,_&&_.toAbortSignal()],C),ee=null;const re=H&&H.unsubscribe&&(()=>{H.unsubscribe()});let de;try{if(D&&u&&T!=="get"&&T!=="head"&&(de=await x(F,A))!==0){let P=new t(E,{method:"POST",body:A,duplex:"half"}),$;if(ie.isFormData(A)&&($=P.headers.get("content-type"))&&F.setContentType($),P.body){const[G,fe]=lv(de,Tu(ov(D)));A=uv(P.body,dv,G,fe)}}ie.isString(j)||(j=j?"include":"omit");const M=r&&"credentials"in t.prototype,V={...U,signal:H,method:T.toUpperCase(),headers:F.normalize().toJSON(),body:A,duplex:"half",credentials:M?j:void 0};ee=r&&new t(E,V);let q=await(r?K(ee,U):K(E,V));const ae=f&&(O==="stream"||O==="response");if(f&&(k||ae&&re)){const P={};["status","statusText","headers"].forEach(ge=>{P[ge]=q[ge]});const $=ie.toFiniteNumber(q.headers.get("content-length")),[G,fe]=k&&lv($,Tu(ov(k),!0))||[];q=new s(uv(q.body,dv,G,()=>{fe&&fe(),re&&re()}),P)}O=O||"text";let pe=await g[ie.findKey(g,O)||"text"](q,S);return!ae&&re&&re(),await new Promise((P,$)=>{NS(P,$,{data:pe,headers:si.from(q.headers),status:q.status,statusText:q.statusText,config:S,request:ee})})}catch(M){throw re&&re(),M&&M.name==="TypeError"&&/Load failed|fetch/i.test(M.message)?Object.assign(new Ke("Network Error",Ke.ERR_NETWORK,S,ee,M&&M.response),{cause:M.cause||M}):Ke.from(M,M&&M.code,S,ee,M&&M.response)}}},sL=new Map,PS=i=>{let e=i&&i.env||{};const{fetch:t,Request:s,Response:n}=e,r=[s,n,t];let l=r.length,c=l,d,u,f=sL;for(;c--;)d=r[c],u=f.get(d),u===void 0&&f.set(d,u=c?new Map:tL(e)),f=u;return u};PS();const Dm={http:xR,xhr:QR,fetch:{get:PS}};ie.forEach(Dm,(i,e)=>{if(i){try{Object.defineProperty(i,"name",{value:e})}catch{}Object.defineProperty(i,"adapterName",{value:e})}});const pv=i=>`- ${i}`,iL=i=>ie.isFunction(i)||i===null||i===!1;function nL(i,e){i=ie.isArray(i)?i:[i];const{length:t}=i;let s,n;const r={};for(let l=0;l<t;l++){s=i[l];let c;if(n=s,!iL(s)&&(n=Dm[(c=String(s)).toLowerCase()],n===void 0))throw new Ke(`Unknown adapter '${c}'`);if(n&&(ie.isFunction(n)||(n=n.get(e))))break;r[c||"#"+l]=n}if(!n){const l=Object.entries(r).map(([d,u])=>`adapter ${d} `+(u===!1?"is not supported by the environment":"is not available in the build"));let c=t?l.length>1?`since :
`+l.map(pv).join(`
`):" "+pv(l[0]):"as no adapter specified";throw new Ke("There is no suitable adapter to dispatch the request "+c,"ERR_NOT_SUPPORT")}return n}const US={getAdapter:nL,adapters:Dm};function gf(i){if(i.cancelToken&&i.cancelToken.throwIfRequested(),i.signal&&i.signal.aborted)throw new To(null,i)}function gv(i){return gf(i),i.headers=si.from(i.headers),i.data=pf.call(i,i.transformRequest),["post","put","patch"].indexOf(i.method)!==-1&&i.headers.setContentType("application/x-www-form-urlencoded",!1),US.getAdapter(i.adapter||bo.adapter,i)(i).then(function(s){return gf(i),s.data=pf.call(i,i.transformResponse,s),s.headers=si.from(s.headers),s},function(s){return kS(s)||(gf(i),s&&s.response&&(s.response.data=pf.call(i,i.transformResponse,s.response),s.response.headers=si.from(s.response.headers))),Promise.reject(s)})}const MS="1.13.5",zu={};["object","boolean","number","function","string","symbol"].forEach((i,e)=>{zu[i]=function(s){return typeof s===i||"a"+(e<1?"n ":" ")+i}});const yv={};zu.transitional=function(e,t,s){function n(r,l){return"[Axios v"+MS+"] Transitional option '"+r+"'"+l+(s?". "+s:"")}return(r,l,c)=>{if(e===!1)throw new Ke(n(l," has been removed"+(t?" in "+t:"")),Ke.ERR_DEPRECATED);return t&&!yv[l]&&(yv[l]=!0,console.warn(n(l," has been deprecated since v"+t+" and will be removed in the near future"))),e?e(r,l,c):!0}};zu.spelling=function(e){return(t,s)=>(console.warn(`${s} is likely a misspelling of ${e}`),!0)};function aL(i,e,t){if(typeof i!="object")throw new Ke("options must be an object",Ke.ERR_BAD_OPTION_VALUE);const s=Object.keys(i);let n=s.length;for(;n-- >0;){const r=s[n],l=e[r];if(l){const c=i[r],d=c===void 0||l(c,r,i);if(d!==!0)throw new Ke("option "+r+" must be "+d,Ke.ERR_BAD_OPTION_VALUE);continue}if(t!==!0)throw new Ke("Unknown option "+r,Ke.ERR_BAD_OPTION)}}const ou={assertOptions:aL,validators:zu},Ui=ou.validators;let Wa=class{constructor(e){this.defaults=e||{},this.interceptors={request:new av,response:new av}}async request(e,t){try{return await this._request(e,t)}catch(s){if(s instanceof Error){let n={};Error.captureStackTrace?Error.captureStackTrace(n):n=new Error;const r=n.stack?n.stack.replace(/^.+\n/,""):"";try{s.stack?r&&!String(s.stack).endsWith(r.replace(/^.+\n.+\n/,""))&&(s.stack+=`
`+r):s.stack=r}catch{}}throw s}}_request(e,t){typeof e=="string"?(t=t||{},t.url=e):t=e||{},t=Za(this.defaults,t);const{transitional:s,paramsSerializer:n,headers:r}=t;s!==void 0&&ou.assertOptions(s,{silentJSONParsing:Ui.transitional(Ui.boolean),forcedJSONParsing:Ui.transitional(Ui.boolean),clarifyTimeoutError:Ui.transitional(Ui.boolean),legacyInterceptorReqResOrdering:Ui.transitional(Ui.boolean)},!1),n!=null&&(ie.isFunction(n)?t.paramsSerializer={serialize:n}:ou.assertOptions(n,{encode:Ui.function,serialize:Ui.function},!0)),t.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),ou.assertOptions(t,{baseUrl:Ui.spelling("baseURL"),withXsrfToken:Ui.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let l=r&&ie.merge(r.common,r[t.method]);r&&ie.forEach(["delete","get","head","post","put","patch","common"],S=>{delete r[S]}),t.headers=si.concat(l,r);const c=[];let d=!0;this.interceptors.request.forEach(function(E){if(typeof E.runWhen=="function"&&E.runWhen(t)===!1)return;d=d&&E.synchronous;const T=t.transitional||Nm;T&&T.legacyInterceptorReqResOrdering?c.unshift(E.fulfilled,E.rejected):c.push(E.fulfilled,E.rejected)});const u=[];this.interceptors.response.forEach(function(E){u.push(E.fulfilled,E.rejected)});let f,g=0,y;if(!d){const S=[gv.bind(this),void 0];for(S.unshift(...c),S.push(...u),y=S.length,f=Promise.resolve(t);g<y;)f=f.then(S[g++],S[g++]);return f}y=c.length;let x=t;for(;g<y;){const S=c[g++],E=c[g++];try{x=S(x)}catch(T){E.call(this,T);break}}try{f=gv.call(this,x)}catch(S){return Promise.reject(S)}for(g=0,y=u.length;g<y;)f=f.then(u[g++],u[g++]);return f}getUri(e){e=Za(this.defaults,e);const t=OS(e.baseURL,e.url,e.allowAbsoluteUrls);return wS(t,e.params,e.paramsSerializer)}};ie.forEach(["delete","get","head","options"],function(e){Wa.prototype[e]=function(t,s){return this.request(Za(s||{},{method:e,url:t,data:(s||{}).data}))}});ie.forEach(["post","put","patch"],function(e){function t(s){return function(r,l,c){return this.request(Za(c||{},{method:e,headers:s?{"Content-Type":"multipart/form-data"}:{},url:r,data:l}))}}Wa.prototype[e]=t(),Wa.prototype[e+"Form"]=t(!0)});let rL=class jS{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(r){t=r});const s=this;this.promise.then(n=>{if(!s._listeners)return;let r=s._listeners.length;for(;r-- >0;)s._listeners[r](n);s._listeners=null}),this.promise.then=n=>{let r;const l=new Promise(c=>{s.subscribe(c),r=c}).then(n);return l.cancel=function(){s.unsubscribe(r)},l},e(function(r,l,c){s.reason||(s.reason=new To(r,l,c),t(s.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);t!==-1&&this._listeners.splice(t,1)}toAbortSignal(){const e=new AbortController,t=s=>{e.abort(s)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let e;return{token:new jS(function(n){e=n}),cancel:e}}};function lL(i){return function(t){return i.apply(null,t)}}function oL(i){return ie.isObject(i)&&i.isAxiosError===!0}const Xf={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(Xf).forEach(([i,e])=>{Xf[e]=i});function FS(i){const e=new Wa(i),t=vS(Wa.prototype.request,e);return ie.extend(t,Wa.prototype,e,{allOwnKeys:!0}),ie.extend(t,e,null,{allOwnKeys:!0}),t.create=function(n){return FS(Za(i,n))},t}const ce=FS(bo);ce.Axios=Wa;ce.CanceledError=To;ce.CancelToken=rL;ce.isCancel=kS;ce.VERSION=MS;ce.toFormData=Hu;ce.AxiosError=Ke;ce.Cancel=ce.CanceledError;ce.all=function(e){return Promise.all(e)};ce.spread=lL;ce.isAxiosError=oL;ce.mergeConfig=Za;ce.AxiosHeaders=si;ce.formToJSON=i=>CS(ie.isHTMLForm(i)?new FormData(i):i);ce.getAdapter=US.getAdapter;ce.HttpStatusCode=Xf;ce.default=ce;const{Axios:tD,AxiosError:sD,CanceledError:iD,isCancel:nD,CancelToken:aD,VERSION:rD,all:lD,Cancel:oD,isAxiosError:cD,spread:uD,toFormData:dD,AxiosHeaders:hD,HttpStatusCode:fD,formToJSON:mD,getAdapter:pD,mergeConfig:gD}=ce,ve="http://localhost".replace(/\/+$/,"");class vn{constructor(e,t=ve,s=ce){var n;this.basePath=t,this.axios=s,e&&(this.configuration=e,this.basePath=(n=e.basePath)!==null&&n!==void 0?n:t)}}class cL extends Error{constructor(e,t){super(t),this.field=e,this.name="RequiredError"}}const Se={},be="https://example.com",Le=function(i,e,t){if(t==null)throw new cL(e,`Required parameter ${e} was null or undefined when calling ${i}.`)},Re=async function(i,e,t){if(t&&t.apiKey){const s=typeof t.apiKey=="function"?await t.apiKey(e):await t.apiKey;i[e]=s}};function Zf(i,e,t=""){e!=null&&(typeof e=="object"?Array.isArray(e)?e.forEach(s=>Zf(i,s,t)):Object.keys(e).forEach(s=>Zf(i,e[s],`${t}${t!==""?".":""}${s}`)):i.has(t)?i.append(t,e):i.set(t,e))}const Te=function(i,...e){const t=new URLSearchParams(i.search);Zf(t,e),i.search=t.toString()},Ts=function(i,e,t){const s=typeof i!="string";return(s&&t&&t.isJsonMime?t.isJsonMime(e.headers["Content-Type"]):s)?JSON.stringify(i!==void 0?i:{}):i||""},Ee=function(i){return i.pathname+i.search+i.hash},Ae=function(i,e,t,s){return(n=e,r=t)=>{var l;const c={...i.options,url:(n.defaults.baseURL?"":(l=s?.basePath)!==null&&l!==void 0?l:r)+i.url};return n.request(c)}},uL=function(i){return{getEndpointInfo:async(e={})=>{const t="/System/Endpoint",s=new URL(t,be);let n;i&&(n=i.baseOptions);const r={method:"GET",...n,...e},l={},c={};await Re(l,"Authorization",i),Te(s,c);let d=n&&n.headers?n.headers:{};return r.headers={...l,...d,...e.headers},{url:Ee(s),options:r}},getLogFile:async(e,t={})=>{Le("getLogFile","name",e);const s="/System/Logs/Log",n=new URL(s,be);let r;i&&(r=i.baseOptions);const l={method:"GET",...r,...t},c={},d={};await Re(c,"Authorization",i),e!==void 0&&(d.name=e),Te(n,d);let u=r&&r.headers?r.headers:{};return l.headers={...c,...u,...t.headers},{url:Ee(n),options:l}},getPingSystem:async(e={})=>{const t="/System/Ping",s=new URL(t,be);let n;i&&(n=i.baseOptions);const r={method:"GET",...n,...e},l={};Te(s,{});let d=n&&n.headers?n.headers:{};return r.headers={...l,...d,...e.headers},{url:Ee(s),options:r}},getPublicSystemInfo:async(e={})=>{const t="/System/Info/Public",s=new URL(t,be);let n;i&&(n=i.baseOptions);const r={method:"GET",...n,...e},l={};Te(s,{});let d=n&&n.headers?n.headers:{};return r.headers={...l,...d,...e.headers},{url:Ee(s),options:r}},getServerLogs:async(e={})=>{const t="/System/Logs",s=new URL(t,be);let n;i&&(n=i.baseOptions);const r={method:"GET",...n,...e},l={},c={};await Re(l,"Authorization",i),Te(s,c);let d=n&&n.headers?n.headers:{};return r.headers={...l,...d,...e.headers},{url:Ee(s),options:r}},getSystemInfo:async(e={})=>{const t="/System/Info",s=new URL(t,be);let n;i&&(n=i.baseOptions);const r={method:"GET",...n,...e},l={},c={};await Re(l,"Authorization",i),Te(s,c);let d=n&&n.headers?n.headers:{};return r.headers={...l,...d,...e.headers},{url:Ee(s),options:r}},getSystemStorage:async(e={})=>{const t="/System/Info/Storage",s=new URL(t,be);let n;i&&(n=i.baseOptions);const r={method:"GET",...n,...e},l={},c={};await Re(l,"Authorization",i),Te(s,c);let d=n&&n.headers?n.headers:{};return r.headers={...l,...d,...e.headers},{url:Ee(s),options:r}},postPingSystem:async(e={})=>{const t="/System/Ping",s=new URL(t,be);let n;i&&(n=i.baseOptions);const r={method:"POST",...n,...e},l={};Te(s,{});let d=n&&n.headers?n.headers:{};return r.headers={...l,...d,...e.headers},{url:Ee(s),options:r}},restartApplication:async(e={})=>{const t="/System/Restart",s=new URL(t,be);let n;i&&(n=i.baseOptions);const r={method:"POST",...n,...e},l={},c={};await Re(l,"Authorization",i),Te(s,c);let d=n&&n.headers?n.headers:{};return r.headers={...l,...d,...e.headers},{url:Ee(s),options:r}},shutdownApplication:async(e={})=>{const t="/System/Shutdown",s=new URL(t,be);let n;i&&(n=i.baseOptions);const r={method:"POST",...n,...e},l={},c={};await Re(l,"Authorization",i),Te(s,c);let d=n&&n.headers?n.headers:{};return r.headers={...l,...d,...e.headers},{url:Ee(s),options:r}}}},ln=function(i){const e=uL(i);return{async getEndpointInfo(t){var s,n,r;const l=await e.getEndpointInfo(t),c=(s=i?.serverIndex)!==null&&s!==void 0?s:0,d=(r=(n=Se["SystemApi.getEndpointInfo"])===null||n===void 0?void 0:n[c])===null||r===void 0?void 0:r.url;return(u,f)=>Ae(l,ce,ve,i)(u,d||f)},async getLogFile(t,s){var n,r,l;const c=await e.getLogFile(t,s),d=(n=i?.serverIndex)!==null&&n!==void 0?n:0,u=(l=(r=Se["SystemApi.getLogFile"])===null||r===void 0?void 0:r[d])===null||l===void 0?void 0:l.url;return(f,g)=>Ae(c,ce,ve,i)(f,u||g)},async getPingSystem(t){var s,n,r;const l=await e.getPingSystem(t),c=(s=i?.serverIndex)!==null&&s!==void 0?s:0,d=(r=(n=Se["SystemApi.getPingSystem"])===null||n===void 0?void 0:n[c])===null||r===void 0?void 0:r.url;return(u,f)=>Ae(l,ce,ve,i)(u,d||f)},async getPublicSystemInfo(t){var s,n,r;const l=await e.getPublicSystemInfo(t),c=(s=i?.serverIndex)!==null&&s!==void 0?s:0,d=(r=(n=Se["SystemApi.getPublicSystemInfo"])===null||n===void 0?void 0:n[c])===null||r===void 0?void 0:r.url;return(u,f)=>Ae(l,ce,ve,i)(u,d||f)},async getServerLogs(t){var s,n,r;const l=await e.getServerLogs(t),c=(s=i?.serverIndex)!==null&&s!==void 0?s:0,d=(r=(n=Se["SystemApi.getServerLogs"])===null||n===void 0?void 0:n[c])===null||r===void 0?void 0:r.url;return(u,f)=>Ae(l,ce,ve,i)(u,d||f)},async getSystemInfo(t){var s,n,r;const l=await e.getSystemInfo(t),c=(s=i?.serverIndex)!==null&&s!==void 0?s:0,d=(r=(n=Se["SystemApi.getSystemInfo"])===null||n===void 0?void 0:n[c])===null||r===void 0?void 0:r.url;return(u,f)=>Ae(l,ce,ve,i)(u,d||f)},async getSystemStorage(t){var s,n,r;const l=await e.getSystemStorage(t),c=(s=i?.serverIndex)!==null&&s!==void 0?s:0,d=(r=(n=Se["SystemApi.getSystemStorage"])===null||n===void 0?void 0:n[c])===null||r===void 0?void 0:r.url;return(u,f)=>Ae(l,ce,ve,i)(u,d||f)},async postPingSystem(t){var s,n,r;const l=await e.postPingSystem(t),c=(s=i?.serverIndex)!==null&&s!==void 0?s:0,d=(r=(n=Se["SystemApi.postPingSystem"])===null||n===void 0?void 0:n[c])===null||r===void 0?void 0:r.url;return(u,f)=>Ae(l,ce,ve,i)(u,d||f)},async restartApplication(t){var s,n,r;const l=await e.restartApplication(t),c=(s=i?.serverIndex)!==null&&s!==void 0?s:0,d=(r=(n=Se["SystemApi.restartApplication"])===null||n===void 0?void 0:n[c])===null||r===void 0?void 0:r.url;return(u,f)=>Ae(l,ce,ve,i)(u,d||f)},async shutdownApplication(t){var s,n,r;const l=await e.shutdownApplication(t),c=(s=i?.serverIndex)!==null&&s!==void 0?s:0,d=(r=(n=Se["SystemApi.shutdownApplication"])===null||n===void 0?void 0:n[c])===null||r===void 0?void 0:r.url;return(u,f)=>Ae(l,ce,ve,i)(u,d||f)}}};class dL extends vn{getEndpointInfo(e){return ln(this.configuration).getEndpointInfo(e).then(t=>t(this.axios,this.basePath))}getLogFile(e,t){return ln(this.configuration).getLogFile(e.name,t).then(s=>s(this.axios,this.basePath))}getPingSystem(e){return ln(this.configuration).getPingSystem(e).then(t=>t(this.axios,this.basePath))}getPublicSystemInfo(e){return ln(this.configuration).getPublicSystemInfo(e).then(t=>t(this.axios,this.basePath))}getServerLogs(e){return ln(this.configuration).getServerLogs(e).then(t=>t(this.axios,this.basePath))}getSystemInfo(e){return ln(this.configuration).getSystemInfo(e).then(t=>t(this.axios,this.basePath))}getSystemStorage(e){return ln(this.configuration).getSystemStorage(e).then(t=>t(this.axios,this.basePath))}postPingSystem(e){return ln(this.configuration).postPingSystem(e).then(t=>t(this.axios,this.basePath))}restartApplication(e){return ln(this.configuration).restartApplication(e).then(t=>t(this.axios,this.basePath))}shutdownApplication(e){return ln(this.configuration).shutdownApplication(e).then(t=>t(this.axios,this.basePath))}}function hL(i){return new dL(i.configuration,void 0,i.axiosInstance)}function vv(i){const e=i.split(".").map(Number);if(e.length===3&&e.every(t=>t>=0))return e}function xv(i,e){const t=vv(i),s=vv(e);if(!t||!s)throw new TypeError("Version doesn't match a numeric-only semver format");const[n,r,l]=t,[c,d,u]=s;return n<c||n===c&&r<d||n===c&&r===d&&l<u}const fL="10.11.1",mL="10.10.0",pL="Jellyfin Server",gL=3e3,yL=5e3;function vL(i,e=Js.GREAT){return i.length>0?Math.min(...i):e}function xL(i){var e,t,s;const n=[],r=[];!(!((e=i.response)===null||e===void 0)&&e.data)||i.error?(n.push(new kI(i.error)),r.push(Js.BAD)):i.response.data.ProductName!==pL&&(n.push(new wI(i.response.data.ProductName)),r.push(Js.BAD));const l=(t=i.response)===null||t===void 0?void 0:t.data.Version;try{l?xv(l,mL)?(n.push(new OI(l)),r.push(Js.OK)):xv(l,fL)&&(n.push(new NI(l)),r.push(Js.GOOD)):(n.push(new tv),r.push(Js.BAD))}catch(c){c instanceof TypeError&&(n.push(new tv),r.push(Js.BAD))}return i.responseTime>gL&&(n.push(new CI(i.responseTime)),r.push(Js.GOOD)),{address:i.address,responseTime:i.responseTime,score:vL(r),issues:n,systemInfo:(s=i.response)===null||s===void 0?void 0:s.data}}class SL{constructor(e){this.jellyfin=e}async fetchRecommendedServerInfo(e){const t=this.jellyfin.createApi(e),s=Date.now();return hL(t).getPublicSystemInfo({timeout:yL}).then(n=>({address:e,response:n,responseTime:Date.now()-s})).catch(n=>({address:e,error:n,responseTime:Date.now()-s})).then(n=>xL(n))}async discover(e,t=Js.BAD){return(await Promise.all(e.map(s=>this.fetchRecommendedServerInfo(s)))).filter(s=>s.score>=t)}}class bL{constructor(e){this.jellyfin=e,this.recommendedServerDiscovery=new SL(this.jellyfin)}findBestServer(e){let t=e.find(s=>s.score===Js.GREAT);return t||(t=e.find(s=>s.score===Js.GOOD)),t||(t=e.find(s=>s.score===Js.OK)),t}getAddressCandidates(e){return LI(e)}async getRecommendedServers(e,t){return this.recommendedServerDiscovery.discover(e,t)}async getRecommendedServerCandidates(e,t){return this.getRecommendedServers(this.getAddressCandidates(e),t)}}function TL(i,e,t=""){return[`MediaBrowser Client="${encodeURIComponent(i.name)}"`,`Device="${encodeURIComponent(e.name)}"`,`DeviceId="${encodeURIComponent(e.id)}"`,`Version="${encodeURIComponent(i.version)}"`,`Token="${encodeURIComponent(t)}"`].join(", ")}class EL{constructor(e={}){this.apiKey=e.apiKey,this.username=e.username,this.password=e.password,this.accessToken=e.accessToken,this.basePath=e.basePath,this.serverIndex=e.serverIndex,this.baseOptions=e.baseOptions,this.formDataCtor=e.formDataCtor}isJsonMime(e){const t=new RegExp("^(application/json|[^;/ 	]+/[^;/ 	]+[+]json)[ 	]*(;.*)?$","i");return e!==null&&(t.test(e)||e.toLowerCase()==="application/json-patch+json")}}const AL=function(i){return{addUserToSession:async(e,t,s={})=>{Le("addUserToSession","sessionId",e),Le("addUserToSession","userId",t);const n="/Sessions/{sessionId}/User/{userId}".replace("{sessionId}",encodeURIComponent(String(e))).replace("{userId}",encodeURIComponent(String(t))),r=new URL(n,be);let l;i&&(l=i.baseOptions);const c={method:"POST",...l,...s},d={},u={};await Re(d,"Authorization",i),Te(r,u);let f=l&&l.headers?l.headers:{};return c.headers={...d,...f,...s.headers},{url:Ee(r),options:c}},displayContent:async(e,t,s,n,r={})=>{Le("displayContent","sessionId",e),Le("displayContent","itemType",t),Le("displayContent","itemId",s),Le("displayContent","itemName",n);const l="/Sessions/{sessionId}/Viewing".replace("{sessionId}",encodeURIComponent(String(e))),c=new URL(l,be);let d;i&&(d=i.baseOptions);const u={method:"POST",...d,...r},f={},g={};await Re(f,"Authorization",i),t!==void 0&&(g.itemType=t),s!==void 0&&(g.itemId=s),n!==void 0&&(g.itemName=n),Te(c,g);let y=d&&d.headers?d.headers:{};return u.headers={...f,...y,...r.headers},{url:Ee(c),options:u}},getAuthProviders:async(e={})=>{const t="/Auth/Providers",s=new URL(t,be);let n;i&&(n=i.baseOptions);const r={method:"GET",...n,...e},l={},c={};await Re(l,"Authorization",i),Te(s,c);let d=n&&n.headers?n.headers:{};return r.headers={...l,...d,...e.headers},{url:Ee(s),options:r}},getPasswordResetProviders:async(e={})=>{const t="/Auth/PasswordResetProviders",s=new URL(t,be);let n;i&&(n=i.baseOptions);const r={method:"GET",...n,...e},l={},c={};await Re(l,"Authorization",i),Te(s,c);let d=n&&n.headers?n.headers:{};return r.headers={...l,...d,...e.headers},{url:Ee(s),options:r}},getSessions:async(e,t,s,n={})=>{const r="/Sessions",l=new URL(r,be);let c;i&&(c=i.baseOptions);const d={method:"GET",...c,...n},u={},f={};await Re(u,"Authorization",i),e!==void 0&&(f.controllableByUserId=e),t!==void 0&&(f.deviceId=t),s!==void 0&&(f.activeWithinSeconds=s),Te(l,f);let g=c&&c.headers?c.headers:{};return d.headers={...u,...g,...n.headers},{url:Ee(l),options:d}},play:async(e,t,s,n,r,l,c,d,u={})=>{Le("play","sessionId",e),Le("play","playCommand",t),Le("play","itemIds",s);const f="/Sessions/{sessionId}/Playing".replace("{sessionId}",encodeURIComponent(String(e))),g=new URL(f,be);let y;i&&(y=i.baseOptions);const x={method:"POST",...y,...u},S={},E={};await Re(S,"Authorization",i),t!==void 0&&(E.playCommand=t),s&&(E.itemIds=s),n!==void 0&&(E.startPositionTicks=n),r!==void 0&&(E.mediaSourceId=r),l!==void 0&&(E.audioStreamIndex=l),c!==void 0&&(E.subtitleStreamIndex=c),d!==void 0&&(E.startIndex=d),Te(g,E);let T=y&&y.headers?y.headers:{};return x.headers={...S,...T,...u.headers},{url:Ee(g),options:x}},postCapabilities:async(e,t,s,n,r,l={})=>{const c="/Sessions/Capabilities",d=new URL(c,be);let u;i&&(u=i.baseOptions);const f={method:"POST",...u,...l},g={},y={};await Re(g,"Authorization",i),e!==void 0&&(y.id=e),t&&(y.playableMediaTypes=t),s&&(y.supportedCommands=s),n!==void 0&&(y.supportsMediaControl=n),r!==void 0&&(y.supportsPersistentIdentifier=r),Te(d,y);let x=u&&u.headers?u.headers:{};return f.headers={...g,...x,...l.headers},{url:Ee(d),options:f}},postFullCapabilities:async(e,t,s={})=>{Le("postFullCapabilities","clientCapabilitiesDto",e);const n="/Sessions/Capabilities/Full",r=new URL(n,be);let l;i&&(l=i.baseOptions);const c={method:"POST",...l,...s},d={},u={};await Re(d,"Authorization",i),t!==void 0&&(u.id=t),d["Content-Type"]="application/json",Te(r,u);let f=l&&l.headers?l.headers:{};return c.headers={...d,...f,...s.headers},c.data=Ts(e,c,i),{url:Ee(r),options:c}},removeUserFromSession:async(e,t,s={})=>{Le("removeUserFromSession","sessionId",e),Le("removeUserFromSession","userId",t);const n="/Sessions/{sessionId}/User/{userId}".replace("{sessionId}",encodeURIComponent(String(e))).replace("{userId}",encodeURIComponent(String(t))),r=new URL(n,be);let l;i&&(l=i.baseOptions);const c={method:"DELETE",...l,...s},d={},u={};await Re(d,"Authorization",i),Te(r,u);let f=l&&l.headers?l.headers:{};return c.headers={...d,...f,...s.headers},{url:Ee(r),options:c}},reportSessionEnded:async(e={})=>{const t="/Sessions/Logout",s=new URL(t,be);let n;i&&(n=i.baseOptions);const r={method:"POST",...n,...e},l={},c={};await Re(l,"Authorization",i),Te(s,c);let d=n&&n.headers?n.headers:{};return r.headers={...l,...d,...e.headers},{url:Ee(s),options:r}},reportViewing:async(e,t,s={})=>{Le("reportViewing","itemId",e);const n="/Sessions/Viewing",r=new URL(n,be);let l;i&&(l=i.baseOptions);const c={method:"POST",...l,...s},d={},u={};await Re(d,"Authorization",i),t!==void 0&&(u.sessionId=t),e!==void 0&&(u.itemId=e),Te(r,u);let f=l&&l.headers?l.headers:{};return c.headers={...d,...f,...s.headers},{url:Ee(r),options:c}},sendFullGeneralCommand:async(e,t,s={})=>{Le("sendFullGeneralCommand","sessionId",e),Le("sendFullGeneralCommand","generalCommand",t);const n="/Sessions/{sessionId}/Command".replace("{sessionId}",encodeURIComponent(String(e))),r=new URL(n,be);let l;i&&(l=i.baseOptions);const c={method:"POST",...l,...s},d={},u={};await Re(d,"Authorization",i),d["Content-Type"]="application/json",Te(r,u);let f=l&&l.headers?l.headers:{};return c.headers={...d,...f,...s.headers},c.data=Ts(t,c,i),{url:Ee(r),options:c}},sendGeneralCommand:async(e,t,s={})=>{Le("sendGeneralCommand","sessionId",e),Le("sendGeneralCommand","command",t);const n="/Sessions/{sessionId}/Command/{command}".replace("{sessionId}",encodeURIComponent(String(e))).replace("{command}",encodeURIComponent(String(t))),r=new URL(n,be);let l;i&&(l=i.baseOptions);const c={method:"POST",...l,...s},d={},u={};await Re(d,"Authorization",i),Te(r,u);let f=l&&l.headers?l.headers:{};return c.headers={...d,...f,...s.headers},{url:Ee(r),options:c}},sendMessageCommand:async(e,t,s={})=>{Le("sendMessageCommand","sessionId",e),Le("sendMessageCommand","messageCommand",t);const n="/Sessions/{sessionId}/Message".replace("{sessionId}",encodeURIComponent(String(e))),r=new URL(n,be);let l;i&&(l=i.baseOptions);const c={method:"POST",...l,...s},d={},u={};await Re(d,"Authorization",i),d["Content-Type"]="application/json",Te(r,u);let f=l&&l.headers?l.headers:{};return c.headers={...d,...f,...s.headers},c.data=Ts(t,c,i),{url:Ee(r),options:c}},sendPlaystateCommand:async(e,t,s,n,r={})=>{Le("sendPlaystateCommand","sessionId",e),Le("sendPlaystateCommand","command",t);const l="/Sessions/{sessionId}/Playing/{command}".replace("{sessionId}",encodeURIComponent(String(e))).replace("{command}",encodeURIComponent(String(t))),c=new URL(l,be);let d;i&&(d=i.baseOptions);const u={method:"POST",...d,...r},f={},g={};await Re(f,"Authorization",i),s!==void 0&&(g.seekPositionTicks=s),n!==void 0&&(g.controllingUserId=n),Te(c,g);let y=d&&d.headers?d.headers:{};return u.headers={...f,...y,...r.headers},{url:Ee(c),options:u}},sendSystemCommand:async(e,t,s={})=>{Le("sendSystemCommand","sessionId",e),Le("sendSystemCommand","command",t);const n="/Sessions/{sessionId}/System/{command}".replace("{sessionId}",encodeURIComponent(String(e))).replace("{command}",encodeURIComponent(String(t))),r=new URL(n,be);let l;i&&(l=i.baseOptions);const c={method:"POST",...l,...s},d={},u={};await Re(d,"Authorization",i),Te(r,u);let f=l&&l.headers?l.headers:{};return c.headers={...d,...f,...s.headers},{url:Ee(r),options:c}}}},Us=function(i){const e=AL(i);return{async addUserToSession(t,s,n){var r,l,c;const d=await e.addUserToSession(t,s,n),u=(r=i?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=Se["SessionApi.addUserToSession"])===null||l===void 0?void 0:l[u])===null||c===void 0?void 0:c.url;return(g,y)=>Ae(d,ce,ve,i)(g,f||y)},async displayContent(t,s,n,r,l){var c,d,u;const f=await e.displayContent(t,s,n,r,l),g=(c=i?.serverIndex)!==null&&c!==void 0?c:0,y=(u=(d=Se["SessionApi.displayContent"])===null||d===void 0?void 0:d[g])===null||u===void 0?void 0:u.url;return(x,S)=>Ae(f,ce,ve,i)(x,y||S)},async getAuthProviders(t){var s,n,r;const l=await e.getAuthProviders(t),c=(s=i?.serverIndex)!==null&&s!==void 0?s:0,d=(r=(n=Se["SessionApi.getAuthProviders"])===null||n===void 0?void 0:n[c])===null||r===void 0?void 0:r.url;return(u,f)=>Ae(l,ce,ve,i)(u,d||f)},async getPasswordResetProviders(t){var s,n,r;const l=await e.getPasswordResetProviders(t),c=(s=i?.serverIndex)!==null&&s!==void 0?s:0,d=(r=(n=Se["SessionApi.getPasswordResetProviders"])===null||n===void 0?void 0:n[c])===null||r===void 0?void 0:r.url;return(u,f)=>Ae(l,ce,ve,i)(u,d||f)},async getSessions(t,s,n,r){var l,c,d;const u=await e.getSessions(t,s,n,r),f=(l=i?.serverIndex)!==null&&l!==void 0?l:0,g=(d=(c=Se["SessionApi.getSessions"])===null||c===void 0?void 0:c[f])===null||d===void 0?void 0:d.url;return(y,x)=>Ae(u,ce,ve,i)(y,g||x)},async play(t,s,n,r,l,c,d,u,f){var g,y,x;const S=await e.play(t,s,n,r,l,c,d,u,f),E=(g=i?.serverIndex)!==null&&g!==void 0?g:0,T=(x=(y=Se["SessionApi.play"])===null||y===void 0?void 0:y[E])===null||x===void 0?void 0:x.url;return(A,I)=>Ae(S,ce,ve,i)(A,T||I)},async postCapabilities(t,s,n,r,l,c){var d,u,f;const g=await e.postCapabilities(t,s,n,r,l,c),y=(d=i?.serverIndex)!==null&&d!==void 0?d:0,x=(f=(u=Se["SessionApi.postCapabilities"])===null||u===void 0?void 0:u[y])===null||f===void 0?void 0:f.url;return(S,E)=>Ae(g,ce,ve,i)(S,x||E)},async postFullCapabilities(t,s,n){var r,l,c;const d=await e.postFullCapabilities(t,s,n),u=(r=i?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=Se["SessionApi.postFullCapabilities"])===null||l===void 0?void 0:l[u])===null||c===void 0?void 0:c.url;return(g,y)=>Ae(d,ce,ve,i)(g,f||y)},async removeUserFromSession(t,s,n){var r,l,c;const d=await e.removeUserFromSession(t,s,n),u=(r=i?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=Se["SessionApi.removeUserFromSession"])===null||l===void 0?void 0:l[u])===null||c===void 0?void 0:c.url;return(g,y)=>Ae(d,ce,ve,i)(g,f||y)},async reportSessionEnded(t){var s,n,r;const l=await e.reportSessionEnded(t),c=(s=i?.serverIndex)!==null&&s!==void 0?s:0,d=(r=(n=Se["SessionApi.reportSessionEnded"])===null||n===void 0?void 0:n[c])===null||r===void 0?void 0:r.url;return(u,f)=>Ae(l,ce,ve,i)(u,d||f)},async reportViewing(t,s,n){var r,l,c;const d=await e.reportViewing(t,s,n),u=(r=i?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=Se["SessionApi.reportViewing"])===null||l===void 0?void 0:l[u])===null||c===void 0?void 0:c.url;return(g,y)=>Ae(d,ce,ve,i)(g,f||y)},async sendFullGeneralCommand(t,s,n){var r,l,c;const d=await e.sendFullGeneralCommand(t,s,n),u=(r=i?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=Se["SessionApi.sendFullGeneralCommand"])===null||l===void 0?void 0:l[u])===null||c===void 0?void 0:c.url;return(g,y)=>Ae(d,ce,ve,i)(g,f||y)},async sendGeneralCommand(t,s,n){var r,l,c;const d=await e.sendGeneralCommand(t,s,n),u=(r=i?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=Se["SessionApi.sendGeneralCommand"])===null||l===void 0?void 0:l[u])===null||c===void 0?void 0:c.url;return(g,y)=>Ae(d,ce,ve,i)(g,f||y)},async sendMessageCommand(t,s,n){var r,l,c;const d=await e.sendMessageCommand(t,s,n),u=(r=i?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=Se["SessionApi.sendMessageCommand"])===null||l===void 0?void 0:l[u])===null||c===void 0?void 0:c.url;return(g,y)=>Ae(d,ce,ve,i)(g,f||y)},async sendPlaystateCommand(t,s,n,r,l){var c,d,u;const f=await e.sendPlaystateCommand(t,s,n,r,l),g=(c=i?.serverIndex)!==null&&c!==void 0?c:0,y=(u=(d=Se["SessionApi.sendPlaystateCommand"])===null||d===void 0?void 0:d[g])===null||u===void 0?void 0:u.url;return(x,S)=>Ae(f,ce,ve,i)(x,y||S)},async sendSystemCommand(t,s,n){var r,l,c;const d=await e.sendSystemCommand(t,s,n),u=(r=i?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=Se["SessionApi.sendSystemCommand"])===null||l===void 0?void 0:l[u])===null||c===void 0?void 0:c.url;return(g,y)=>Ae(d,ce,ve,i)(g,f||y)}}};class _L extends vn{addUserToSession(e,t){return Us(this.configuration).addUserToSession(e.sessionId,e.userId,t).then(s=>s(this.axios,this.basePath))}displayContent(e,t){return Us(this.configuration).displayContent(e.sessionId,e.itemType,e.itemId,e.itemName,t).then(s=>s(this.axios,this.basePath))}getAuthProviders(e){return Us(this.configuration).getAuthProviders(e).then(t=>t(this.axios,this.basePath))}getPasswordResetProviders(e){return Us(this.configuration).getPasswordResetProviders(e).then(t=>t(this.axios,this.basePath))}getSessions(e={},t){return Us(this.configuration).getSessions(e.controllableByUserId,e.deviceId,e.activeWithinSeconds,t).then(s=>s(this.axios,this.basePath))}play(e,t){return Us(this.configuration).play(e.sessionId,e.playCommand,e.itemIds,e.startPositionTicks,e.mediaSourceId,e.audioStreamIndex,e.subtitleStreamIndex,e.startIndex,t).then(s=>s(this.axios,this.basePath))}postCapabilities(e={},t){return Us(this.configuration).postCapabilities(e.id,e.playableMediaTypes,e.supportedCommands,e.supportsMediaControl,e.supportsPersistentIdentifier,t).then(s=>s(this.axios,this.basePath))}postFullCapabilities(e,t){return Us(this.configuration).postFullCapabilities(e.clientCapabilitiesDto,e.id,t).then(s=>s(this.axios,this.basePath))}removeUserFromSession(e,t){return Us(this.configuration).removeUserFromSession(e.sessionId,e.userId,t).then(s=>s(this.axios,this.basePath))}reportSessionEnded(e){return Us(this.configuration).reportSessionEnded(e).then(t=>t(this.axios,this.basePath))}reportViewing(e,t){return Us(this.configuration).reportViewing(e.itemId,e.sessionId,t).then(s=>s(this.axios,this.basePath))}sendFullGeneralCommand(e,t){return Us(this.configuration).sendFullGeneralCommand(e.sessionId,e.generalCommand,t).then(s=>s(this.axios,this.basePath))}sendGeneralCommand(e,t){return Us(this.configuration).sendGeneralCommand(e.sessionId,e.command,t).then(s=>s(this.axios,this.basePath))}sendMessageCommand(e,t){return Us(this.configuration).sendMessageCommand(e.sessionId,e.messageCommand,t).then(s=>s(this.axios,this.basePath))}sendPlaystateCommand(e,t){return Us(this.configuration).sendPlaystateCommand(e.sessionId,e.command,e.seekPositionTicks,e.controllingUserId,t).then(s=>s(this.axios,this.basePath))}sendSystemCommand(e,t){return Us(this.configuration).sendSystemCommand(e.sessionId,e.command,t).then(s=>s(this.axios,this.basePath))}}class IL extends _L{constructor(e){super(e.configuration,void 0,e.axiosInstance),this.api=e}reportSessionEnded(e){return super.reportSessionEnded(e).then(t=>(this.api.accessToken="",t))}}function RL(i){return new IL(i)}const LL=function(i){return{authenticateUserByName:async(e,t={})=>{Le("authenticateUserByName","authenticateUserByName",e);const s="/Users/AuthenticateByName",n=new URL(s,be);let r;i&&(r=i.baseOptions);const l={method:"POST",...r,...t},c={},d={};c["Content-Type"]="application/json",Te(n,d);let u=r&&r.headers?r.headers:{};return l.headers={...c,...u,...t.headers},l.data=Ts(e,l,i),{url:Ee(n),options:l}},authenticateWithQuickConnect:async(e,t={})=>{Le("authenticateWithQuickConnect","quickConnectDto",e);const s="/Users/AuthenticateWithQuickConnect",n=new URL(s,be);let r;i&&(r=i.baseOptions);const l={method:"POST",...r,...t},c={},d={};c["Content-Type"]="application/json",Te(n,d);let u=r&&r.headers?r.headers:{};return l.headers={...c,...u,...t.headers},l.data=Ts(e,l,i),{url:Ee(n),options:l}},createUserByName:async(e,t={})=>{Le("createUserByName","createUserByName",e);const s="/Users/New",n=new URL(s,be);let r;i&&(r=i.baseOptions);const l={method:"POST",...r,...t},c={},d={};await Re(c,"Authorization",i),c["Content-Type"]="application/json",Te(n,d);let u=r&&r.headers?r.headers:{};return l.headers={...c,...u,...t.headers},l.data=Ts(e,l,i),{url:Ee(n),options:l}},deleteUser:async(e,t={})=>{Le("deleteUser","userId",e);const s="/Users/{userId}".replace("{userId}",encodeURIComponent(String(e))),n=new URL(s,be);let r;i&&(r=i.baseOptions);const l={method:"DELETE",...r,...t},c={},d={};await Re(c,"Authorization",i),Te(n,d);let u=r&&r.headers?r.headers:{};return l.headers={...c,...u,...t.headers},{url:Ee(n),options:l}},forgotPassword:async(e,t={})=>{Le("forgotPassword","forgotPasswordDto",e);const s="/Users/ForgotPassword",n=new URL(s,be);let r;i&&(r=i.baseOptions);const l={method:"POST",...r,...t},c={},d={};c["Content-Type"]="application/json",Te(n,d);let u=r&&r.headers?r.headers:{};return l.headers={...c,...u,...t.headers},l.data=Ts(e,l,i),{url:Ee(n),options:l}},forgotPasswordPin:async(e,t={})=>{Le("forgotPasswordPin","forgotPasswordPinDto",e);const s="/Users/ForgotPassword/Pin",n=new URL(s,be);let r;i&&(r=i.baseOptions);const l={method:"POST",...r,...t},c={},d={};c["Content-Type"]="application/json",Te(n,d);let u=r&&r.headers?r.headers:{};return l.headers={...c,...u,...t.headers},l.data=Ts(e,l,i),{url:Ee(n),options:l}},getCurrentUser:async(e={})=>{const t="/Users/Me",s=new URL(t,be);let n;i&&(n=i.baseOptions);const r={method:"GET",...n,...e},l={},c={};await Re(l,"Authorization",i),Te(s,c);let d=n&&n.headers?n.headers:{};return r.headers={...l,...d,...e.headers},{url:Ee(s),options:r}},getPublicUsers:async(e={})=>{const t="/Users/Public",s=new URL(t,be);let n;i&&(n=i.baseOptions);const r={method:"GET",...n,...e},l={};Te(s,{});let d=n&&n.headers?n.headers:{};return r.headers={...l,...d,...e.headers},{url:Ee(s),options:r}},getUserById:async(e,t={})=>{Le("getUserById","userId",e);const s="/Users/{userId}".replace("{userId}",encodeURIComponent(String(e))),n=new URL(s,be);let r;i&&(r=i.baseOptions);const l={method:"GET",...r,...t},c={},d={};await Re(c,"Authorization",i),Te(n,d);let u=r&&r.headers?r.headers:{};return l.headers={...c,...u,...t.headers},{url:Ee(n),options:l}},getUsers:async(e,t,s={})=>{const n="/Users",r=new URL(n,be);let l;i&&(l=i.baseOptions);const c={method:"GET",...l,...s},d={},u={};await Re(d,"Authorization",i),e!==void 0&&(u.isHidden=e),t!==void 0&&(u.isDisabled=t),Te(r,u);let f=l&&l.headers?l.headers:{};return c.headers={...d,...f,...s.headers},{url:Ee(r),options:c}},updateUser:async(e,t,s={})=>{Le("updateUser","userDto",e);const n="/Users",r=new URL(n,be);let l;i&&(l=i.baseOptions);const c={method:"POST",...l,...s},d={},u={};await Re(d,"Authorization",i),t!==void 0&&(u.userId=t),d["Content-Type"]="application/json",Te(r,u);let f=l&&l.headers?l.headers:{};return c.headers={...d,...f,...s.headers},c.data=Ts(e,c,i),{url:Ee(r),options:c}},updateUserConfiguration:async(e,t,s={})=>{Le("updateUserConfiguration","userConfiguration",e);const n="/Users/Configuration",r=new URL(n,be);let l;i&&(l=i.baseOptions);const c={method:"POST",...l,...s},d={},u={};await Re(d,"Authorization",i),t!==void 0&&(u.userId=t),d["Content-Type"]="application/json",Te(r,u);let f=l&&l.headers?l.headers:{};return c.headers={...d,...f,...s.headers},c.data=Ts(e,c,i),{url:Ee(r),options:c}},updateUserPassword:async(e,t,s={})=>{Le("updateUserPassword","updateUserPassword",e);const n="/Users/Password",r=new URL(n,be);let l;i&&(l=i.baseOptions);const c={method:"POST",...l,...s},d={},u={};await Re(d,"Authorization",i),t!==void 0&&(u.userId=t),d["Content-Type"]="application/json",Te(r,u);let f=l&&l.headers?l.headers:{};return c.headers={...d,...f,...s.headers},c.data=Ts(e,c,i),{url:Ee(r),options:c}},updateUserPolicy:async(e,t,s={})=>{Le("updateUserPolicy","userId",e),Le("updateUserPolicy","userPolicy",t);const n="/Users/{userId}/Policy".replace("{userId}",encodeURIComponent(String(e))),r=new URL(n,be);let l;i&&(l=i.baseOptions);const c={method:"POST",...l,...s},d={},u={};await Re(d,"Authorization",i),d["Content-Type"]="application/json",Te(r,u);let f=l&&l.headers?l.headers:{};return c.headers={...d,...f,...s.headers},c.data=Ts(t,c,i),{url:Ee(r),options:c}}}},Xs=function(i){const e=LL(i);return{async authenticateUserByName(t,s){var n,r,l;const c=await e.authenticateUserByName(t,s),d=(n=i?.serverIndex)!==null&&n!==void 0?n:0,u=(l=(r=Se["UserApi.authenticateUserByName"])===null||r===void 0?void 0:r[d])===null||l===void 0?void 0:l.url;return(f,g)=>Ae(c,ce,ve,i)(f,u||g)},async authenticateWithQuickConnect(t,s){var n,r,l;const c=await e.authenticateWithQuickConnect(t,s),d=(n=i?.serverIndex)!==null&&n!==void 0?n:0,u=(l=(r=Se["UserApi.authenticateWithQuickConnect"])===null||r===void 0?void 0:r[d])===null||l===void 0?void 0:l.url;return(f,g)=>Ae(c,ce,ve,i)(f,u||g)},async createUserByName(t,s){var n,r,l;const c=await e.createUserByName(t,s),d=(n=i?.serverIndex)!==null&&n!==void 0?n:0,u=(l=(r=Se["UserApi.createUserByName"])===null||r===void 0?void 0:r[d])===null||l===void 0?void 0:l.url;return(f,g)=>Ae(c,ce,ve,i)(f,u||g)},async deleteUser(t,s){var n,r,l;const c=await e.deleteUser(t,s),d=(n=i?.serverIndex)!==null&&n!==void 0?n:0,u=(l=(r=Se["UserApi.deleteUser"])===null||r===void 0?void 0:r[d])===null||l===void 0?void 0:l.url;return(f,g)=>Ae(c,ce,ve,i)(f,u||g)},async forgotPassword(t,s){var n,r,l;const c=await e.forgotPassword(t,s),d=(n=i?.serverIndex)!==null&&n!==void 0?n:0,u=(l=(r=Se["UserApi.forgotPassword"])===null||r===void 0?void 0:r[d])===null||l===void 0?void 0:l.url;return(f,g)=>Ae(c,ce,ve,i)(f,u||g)},async forgotPasswordPin(t,s){var n,r,l;const c=await e.forgotPasswordPin(t,s),d=(n=i?.serverIndex)!==null&&n!==void 0?n:0,u=(l=(r=Se["UserApi.forgotPasswordPin"])===null||r===void 0?void 0:r[d])===null||l===void 0?void 0:l.url;return(f,g)=>Ae(c,ce,ve,i)(f,u||g)},async getCurrentUser(t){var s,n,r;const l=await e.getCurrentUser(t),c=(s=i?.serverIndex)!==null&&s!==void 0?s:0,d=(r=(n=Se["UserApi.getCurrentUser"])===null||n===void 0?void 0:n[c])===null||r===void 0?void 0:r.url;return(u,f)=>Ae(l,ce,ve,i)(u,d||f)},async getPublicUsers(t){var s,n,r;const l=await e.getPublicUsers(t),c=(s=i?.serverIndex)!==null&&s!==void 0?s:0,d=(r=(n=Se["UserApi.getPublicUsers"])===null||n===void 0?void 0:n[c])===null||r===void 0?void 0:r.url;return(u,f)=>Ae(l,ce,ve,i)(u,d||f)},async getUserById(t,s){var n,r,l;const c=await e.getUserById(t,s),d=(n=i?.serverIndex)!==null&&n!==void 0?n:0,u=(l=(r=Se["UserApi.getUserById"])===null||r===void 0?void 0:r[d])===null||l===void 0?void 0:l.url;return(f,g)=>Ae(c,ce,ve,i)(f,u||g)},async getUsers(t,s,n){var r,l,c;const d=await e.getUsers(t,s,n),u=(r=i?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=Se["UserApi.getUsers"])===null||l===void 0?void 0:l[u])===null||c===void 0?void 0:c.url;return(g,y)=>Ae(d,ce,ve,i)(g,f||y)},async updateUser(t,s,n){var r,l,c;const d=await e.updateUser(t,s,n),u=(r=i?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=Se["UserApi.updateUser"])===null||l===void 0?void 0:l[u])===null||c===void 0?void 0:c.url;return(g,y)=>Ae(d,ce,ve,i)(g,f||y)},async updateUserConfiguration(t,s,n){var r,l,c;const d=await e.updateUserConfiguration(t,s,n),u=(r=i?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=Se["UserApi.updateUserConfiguration"])===null||l===void 0?void 0:l[u])===null||c===void 0?void 0:c.url;return(g,y)=>Ae(d,ce,ve,i)(g,f||y)},async updateUserPassword(t,s,n){var r,l,c;const d=await e.updateUserPassword(t,s,n),u=(r=i?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=Se["UserApi.updateUserPassword"])===null||l===void 0?void 0:l[u])===null||c===void 0?void 0:c.url;return(g,y)=>Ae(d,ce,ve,i)(g,f||y)},async updateUserPolicy(t,s,n){var r,l,c;const d=await e.updateUserPolicy(t,s,n),u=(r=i?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=Se["UserApi.updateUserPolicy"])===null||l===void 0?void 0:l[u])===null||c===void 0?void 0:c.url;return(g,y)=>Ae(d,ce,ve,i)(g,f||y)}}};class BS extends vn{authenticateUserByName(e,t){return Xs(this.configuration).authenticateUserByName(e.authenticateUserByName,t).then(s=>s(this.axios,this.basePath))}authenticateWithQuickConnect(e,t){return Xs(this.configuration).authenticateWithQuickConnect(e.quickConnectDto,t).then(s=>s(this.axios,this.basePath))}createUserByName(e,t){return Xs(this.configuration).createUserByName(e.createUserByName,t).then(s=>s(this.axios,this.basePath))}deleteUser(e,t){return Xs(this.configuration).deleteUser(e.userId,t).then(s=>s(this.axios,this.basePath))}forgotPassword(e,t){return Xs(this.configuration).forgotPassword(e.forgotPasswordDto,t).then(s=>s(this.axios,this.basePath))}forgotPasswordPin(e,t){return Xs(this.configuration).forgotPasswordPin(e.forgotPasswordPinDto,t).then(s=>s(this.axios,this.basePath))}getCurrentUser(e){return Xs(this.configuration).getCurrentUser(e).then(t=>t(this.axios,this.basePath))}getPublicUsers(e){return Xs(this.configuration).getPublicUsers(e).then(t=>t(this.axios,this.basePath))}getUserById(e,t){return Xs(this.configuration).getUserById(e.userId,t).then(s=>s(this.axios,this.basePath))}getUsers(e={},t){return Xs(this.configuration).getUsers(e.isHidden,e.isDisabled,t).then(s=>s(this.axios,this.basePath))}updateUser(e,t){return Xs(this.configuration).updateUser(e.userDto,e.userId,t).then(s=>s(this.axios,this.basePath))}updateUserConfiguration(e,t){return Xs(this.configuration).updateUserConfiguration(e.userConfiguration,e.userId,t).then(s=>s(this.axios,this.basePath))}updateUserPassword(e,t){return Xs(this.configuration).updateUserPassword(e.updateUserPassword,e.userId,t).then(s=>s(this.axios,this.basePath))}updateUserPolicy(e,t){return Xs(this.configuration).updateUserPolicy(e.userId,e.userPolicy,t).then(s=>s(this.axios,this.basePath))}}class wL extends BS{constructor(e){super(e.configuration,void 0,e.axiosInstance),this.api=e}authenticateUserByName(e,t){return super.authenticateUserByName(e,t).then(s=>(this.api.accessToken=s.data.AccessToken||"",s))}authenticateWithQuickConnect(e,t){return super.authenticateWithQuickConnect(e,t).then(s=>(this.api.accessToken=s.data.AccessToken||"",s))}}function CL(i){return new wL(i)}const kL="Authorization";class NL{constructor(e,t,s,n="",r=ce){this.basePath=e.endsWith("/")?e.slice(0,-1):e,this.clientInfo=t,this.deviceInfo=s,this.accessToken=n,this.axiosInstance=r}get configuration(){return new EL({basePath:this.basePath,baseOptions:{headers:{[kL]:this.authorizationHeader}}})}authenticateUserByName(e,t){return CL(this).authenticateUserByName({authenticateUserByName:{Username:e,Pw:t}})}getUri(e,t){return this.axiosInstance.getUri({baseURL:this.basePath,url:e,params:t})}logout(){return RL(this).reportSessionEnded()}get authorizationHeader(){return TL(this.clientInfo,this.deviceInfo,this.accessToken)}}class OL{constructor(e){this.clientInfo=e.clientInfo,this.deviceInfo=e.deviceInfo,this.discovery=new bL(this)}createApi(e,t,s){return new NL(e,this.clientInfo,this.deviceInfo,t,s)}}const DL=function(i){return{deleteUserItemRating:async(e,t,s={})=>{Le("deleteUserItemRating","itemId",e);const n="/UserItems/{itemId}/Rating".replace("{itemId}",encodeURIComponent(String(e))),r=new URL(n,be);let l;i&&(l=i.baseOptions);const c={method:"DELETE",...l,...s},d={},u={};await Re(d,"Authorization",i),t!==void 0&&(u.userId=t),Te(r,u);let f=l&&l.headers?l.headers:{};return c.headers={...d,...f,...s.headers},{url:Ee(r),options:c}},getIntros:async(e,t,s={})=>{Le("getIntros","itemId",e);const n="/Items/{itemId}/Intros".replace("{itemId}",encodeURIComponent(String(e))),r=new URL(n,be);let l;i&&(l=i.baseOptions);const c={method:"GET",...l,...s},d={},u={};await Re(d,"Authorization",i),t!==void 0&&(u.userId=t),Te(r,u);let f=l&&l.headers?l.headers:{};return c.headers={...d,...f,...s.headers},{url:Ee(r),options:c}},getItem:async(e,t,s={})=>{Le("getItem","itemId",e);const n="/Items/{itemId}".replace("{itemId}",encodeURIComponent(String(e))),r=new URL(n,be);let l;i&&(l=i.baseOptions);const c={method:"GET",...l,...s},d={},u={};await Re(d,"Authorization",i),t!==void 0&&(u.userId=t),Te(r,u);let f=l&&l.headers?l.headers:{};return c.headers={...d,...f,...s.headers},{url:Ee(r),options:c}},getLatestMedia:async(e,t,s,n,r,l,c,d,u,f,g,y={})=>{const x="/Items/Latest",S=new URL(x,be);let E;i&&(E=i.baseOptions);const T={method:"GET",...E,...y},A={},I={};await Re(A,"Authorization",i),e!==void 0&&(I.userId=e),t!==void 0&&(I.parentId=t),s&&(I.fields=s),n&&(I.includeItemTypes=n),r!==void 0&&(I.isPlayed=r),l!==void 0&&(I.enableImages=l),c!==void 0&&(I.imageTypeLimit=c),d&&(I.enableImageTypes=d),u!==void 0&&(I.enableUserData=u),f!==void 0&&(I.limit=f),g!==void 0&&(I.groupItems=g),Te(S,I);let _=E&&E.headers?E.headers:{};return T.headers={...A,..._,...y.headers},{url:Ee(S),options:T}},getLocalTrailers:async(e,t,s={})=>{Le("getLocalTrailers","itemId",e);const n="/Items/{itemId}/LocalTrailers".replace("{itemId}",encodeURIComponent(String(e))),r=new URL(n,be);let l;i&&(l=i.baseOptions);const c={method:"GET",...l,...s},d={},u={};await Re(d,"Authorization",i),t!==void 0&&(u.userId=t),Te(r,u);let f=l&&l.headers?l.headers:{};return c.headers={...d,...f,...s.headers},{url:Ee(r),options:c}},getRootFolder:async(e,t={})=>{const s="/Items/Root",n=new URL(s,be);let r;i&&(r=i.baseOptions);const l={method:"GET",...r,...t},c={},d={};await Re(c,"Authorization",i),e!==void 0&&(d.userId=e),Te(n,d);let u=r&&r.headers?r.headers:{};return l.headers={...c,...u,...t.headers},{url:Ee(n),options:l}},getSpecialFeatures:async(e,t,s={})=>{Le("getSpecialFeatures","itemId",e);const n="/Items/{itemId}/SpecialFeatures".replace("{itemId}",encodeURIComponent(String(e))),r=new URL(n,be);let l;i&&(l=i.baseOptions);const c={method:"GET",...l,...s},d={},u={};await Re(d,"Authorization",i),t!==void 0&&(u.userId=t),Te(r,u);let f=l&&l.headers?l.headers:{};return c.headers={...d,...f,...s.headers},{url:Ee(r),options:c}},markFavoriteItem:async(e,t,s={})=>{Le("markFavoriteItem","itemId",e);const n="/UserFavoriteItems/{itemId}".replace("{itemId}",encodeURIComponent(String(e))),r=new URL(n,be);let l;i&&(l=i.baseOptions);const c={method:"POST",...l,...s},d={},u={};await Re(d,"Authorization",i),t!==void 0&&(u.userId=t),Te(r,u);let f=l&&l.headers?l.headers:{};return c.headers={...d,...f,...s.headers},{url:Ee(r),options:c}},unmarkFavoriteItem:async(e,t,s={})=>{Le("unmarkFavoriteItem","itemId",e);const n="/UserFavoriteItems/{itemId}".replace("{itemId}",encodeURIComponent(String(e))),r=new URL(n,be);let l;i&&(l=i.baseOptions);const c={method:"DELETE",...l,...s},d={},u={};await Re(d,"Authorization",i),t!==void 0&&(u.userId=t),Te(r,u);let f=l&&l.headers?l.headers:{};return c.headers={...d,...f,...s.headers},{url:Ee(r),options:c}},updateUserItemRating:async(e,t,s,n={})=>{Le("updateUserItemRating","itemId",e);const r="/UserItems/{itemId}/Rating".replace("{itemId}",encodeURIComponent(String(e))),l=new URL(r,be);let c;i&&(c=i.baseOptions);const d={method:"POST",...c,...n},u={},f={};await Re(u,"Authorization",i),t!==void 0&&(f.userId=t),s!==void 0&&(f.likes=s),Te(l,f);let g=c&&c.headers?c.headers:{};return d.headers={...u,...g,...n.headers},{url:Ee(l),options:d}}}},on=function(i){const e=DL(i);return{async deleteUserItemRating(t,s,n){var r,l,c;const d=await e.deleteUserItemRating(t,s,n),u=(r=i?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=Se["UserLibraryApi.deleteUserItemRating"])===null||l===void 0?void 0:l[u])===null||c===void 0?void 0:c.url;return(g,y)=>Ae(d,ce,ve,i)(g,f||y)},async getIntros(t,s,n){var r,l,c;const d=await e.getIntros(t,s,n),u=(r=i?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=Se["UserLibraryApi.getIntros"])===null||l===void 0?void 0:l[u])===null||c===void 0?void 0:c.url;return(g,y)=>Ae(d,ce,ve,i)(g,f||y)},async getItem(t,s,n){var r,l,c;const d=await e.getItem(t,s,n),u=(r=i?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=Se["UserLibraryApi.getItem"])===null||l===void 0?void 0:l[u])===null||c===void 0?void 0:c.url;return(g,y)=>Ae(d,ce,ve,i)(g,f||y)},async getLatestMedia(t,s,n,r,l,c,d,u,f,g,y,x){var S,E,T;const A=await e.getLatestMedia(t,s,n,r,l,c,d,u,f,g,y,x),I=(S=i?.serverIndex)!==null&&S!==void 0?S:0,_=(T=(E=Se["UserLibraryApi.getLatestMedia"])===null||E===void 0?void 0:E[I])===null||T===void 0?void 0:T.url;return(C,k)=>Ae(A,ce,ve,i)(C,_||k)},async getLocalTrailers(t,s,n){var r,l,c;const d=await e.getLocalTrailers(t,s,n),u=(r=i?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=Se["UserLibraryApi.getLocalTrailers"])===null||l===void 0?void 0:l[u])===null||c===void 0?void 0:c.url;return(g,y)=>Ae(d,ce,ve,i)(g,f||y)},async getRootFolder(t,s){var n,r,l;const c=await e.getRootFolder(t,s),d=(n=i?.serverIndex)!==null&&n!==void 0?n:0,u=(l=(r=Se["UserLibraryApi.getRootFolder"])===null||r===void 0?void 0:r[d])===null||l===void 0?void 0:l.url;return(f,g)=>Ae(c,ce,ve,i)(f,u||g)},async getSpecialFeatures(t,s,n){var r,l,c;const d=await e.getSpecialFeatures(t,s,n),u=(r=i?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=Se["UserLibraryApi.getSpecialFeatures"])===null||l===void 0?void 0:l[u])===null||c===void 0?void 0:c.url;return(g,y)=>Ae(d,ce,ve,i)(g,f||y)},async markFavoriteItem(t,s,n){var r,l,c;const d=await e.markFavoriteItem(t,s,n),u=(r=i?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=Se["UserLibraryApi.markFavoriteItem"])===null||l===void 0?void 0:l[u])===null||c===void 0?void 0:c.url;return(g,y)=>Ae(d,ce,ve,i)(g,f||y)},async unmarkFavoriteItem(t,s,n){var r,l,c;const d=await e.unmarkFavoriteItem(t,s,n),u=(r=i?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=Se["UserLibraryApi.unmarkFavoriteItem"])===null||l===void 0?void 0:l[u])===null||c===void 0?void 0:c.url;return(g,y)=>Ae(d,ce,ve,i)(g,f||y)},async updateUserItemRating(t,s,n,r){var l,c,d;const u=await e.updateUserItemRating(t,s,n,r),f=(l=i?.serverIndex)!==null&&l!==void 0?l:0,g=(d=(c=Se["UserLibraryApi.updateUserItemRating"])===null||c===void 0?void 0:c[f])===null||d===void 0?void 0:d.url;return(y,x)=>Ae(u,ce,ve,i)(y,g||x)}}};class PL extends vn{deleteUserItemRating(e,t){return on(this.configuration).deleteUserItemRating(e.itemId,e.userId,t).then(s=>s(this.axios,this.basePath))}getIntros(e,t){return on(this.configuration).getIntros(e.itemId,e.userId,t).then(s=>s(this.axios,this.basePath))}getItem(e,t){return on(this.configuration).getItem(e.itemId,e.userId,t).then(s=>s(this.axios,this.basePath))}getLatestMedia(e={},t){return on(this.configuration).getLatestMedia(e.userId,e.parentId,e.fields,e.includeItemTypes,e.isPlayed,e.enableImages,e.imageTypeLimit,e.enableImageTypes,e.enableUserData,e.limit,e.groupItems,t).then(s=>s(this.axios,this.basePath))}getLocalTrailers(e,t){return on(this.configuration).getLocalTrailers(e.itemId,e.userId,t).then(s=>s(this.axios,this.basePath))}getRootFolder(e={},t){return on(this.configuration).getRootFolder(e.userId,t).then(s=>s(this.axios,this.basePath))}getSpecialFeatures(e,t){return on(this.configuration).getSpecialFeatures(e.itemId,e.userId,t).then(s=>s(this.axios,this.basePath))}markFavoriteItem(e,t){return on(this.configuration).markFavoriteItem(e.itemId,e.userId,t).then(s=>s(this.axios,this.basePath))}unmarkFavoriteItem(e,t){return on(this.configuration).unmarkFavoriteItem(e.itemId,e.userId,t).then(s=>s(this.axios,this.basePath))}updateUserItemRating(e,t){return on(this.configuration).updateUserItemRating(e.itemId,e.userId,e.likes,t).then(s=>s(this.axios,this.basePath))}}const UL=function(i){return{getGroupingOptions:async(e,t={})=>{const s="/UserViews/GroupingOptions",n=new URL(s,be);let r;i&&(r=i.baseOptions);const l={method:"GET",...r,...t},c={},d={};await Re(c,"Authorization",i),e!==void 0&&(d.userId=e),Te(n,d);let u=r&&r.headers?r.headers:{};return l.headers={...c,...u,...t.headers},{url:Ee(n),options:l}},getUserViews:async(e,t,s,n,r={})=>{const l="/UserViews",c=new URL(l,be);let d;i&&(d=i.baseOptions);const u={method:"GET",...d,...r},f={},g={};await Re(f,"Authorization",i),e!==void 0&&(g.userId=e),t!==void 0&&(g.includeExternalContent=t),s&&(g.presetViews=s),n!==void 0&&(g.includeHidden=n),Te(c,g);let y=d&&d.headers?d.headers:{};return u.headers={...f,...y,...r.headers},{url:Ee(c),options:u}}}},Sv=function(i){const e=UL(i);return{async getGroupingOptions(t,s){var n,r,l;const c=await e.getGroupingOptions(t,s),d=(n=i?.serverIndex)!==null&&n!==void 0?n:0,u=(l=(r=Se["UserViewsApi.getGroupingOptions"])===null||r===void 0?void 0:r[d])===null||l===void 0?void 0:l.url;return(f,g)=>Ae(c,ce,ve,i)(f,u||g)},async getUserViews(t,s,n,r,l){var c,d,u;const f=await e.getUserViews(t,s,n,r,l),g=(c=i?.serverIndex)!==null&&c!==void 0?c:0,y=(u=(d=Se["UserViewsApi.getUserViews"])===null||d===void 0?void 0:d[g])===null||u===void 0?void 0:u.url;return(x,S)=>Ae(f,ce,ve,i)(x,y||S)}}};class ML extends vn{getGroupingOptions(e={},t){return Sv(this.configuration).getGroupingOptions(e.userId,t).then(s=>s(this.axios,this.basePath))}getUserViews(e={},t){return Sv(this.configuration).getUserViews(e.userId,e.includeExternalContent,e.presetViews,e.includeHidden,t).then(s=>s(this.axios,this.basePath))}}const jL=function(i){return{getItemUserData:async(e,t,s={})=>{Le("getItemUserData","itemId",e);const n="/UserItems/{itemId}/UserData".replace("{itemId}",encodeURIComponent(String(e))),r=new URL(n,be);let l;i&&(l=i.baseOptions);const c={method:"GET",...l,...s},d={},u={};await Re(d,"Authorization",i),t!==void 0&&(u.userId=t),Te(r,u);let f=l&&l.headers?l.headers:{};return c.headers={...d,...f,...s.headers},{url:Ee(r),options:c}},getItems:async(e,t,s,n,r,l,c,d,u,f,g,y,x,S,E,T,A,I,_,C,k,D,O,F,j,U,K,H,ee,re,de,M,V,q,ae,pe,P,$,G,fe,ge,_e,Ne,Ge,Be,pt,At,Vt,bt,gt,zt,Fe,we,Ue,qe,dt,Ce,He,Tt,rt,Kt,ye,We,it,ls,Ns,os,Zi,Es,$t,As,Yt,ii,Ai,_i,xs,Wt,Os,Ds,Xt,Vs,ni,Ii,ai,cs,$i,ri={})=>{const xn="/Items",le=new URL(xn,be);let Oe;i&&(Oe=i.baseOptions);const Qe={method:"GET",...Oe,...ri},ts={},Ie={};await Re(ts,"Authorization",i),e!==void 0&&(Ie.userId=e),t!==void 0&&(Ie.maxOfficialRating=t),s!==void 0&&(Ie.hasThemeSong=s),n!==void 0&&(Ie.hasThemeVideo=n),r!==void 0&&(Ie.hasSubtitles=r),l!==void 0&&(Ie.hasSpecialFeature=l),c!==void 0&&(Ie.hasTrailer=c),d!==void 0&&(Ie.adjacentTo=d),u!==void 0&&(Ie.indexNumber=u),f!==void 0&&(Ie.parentIndexNumber=f),g!==void 0&&(Ie.hasParentalRating=g),y!==void 0&&(Ie.isHd=y),x!==void 0&&(Ie.is4K=x),S&&(Ie.locationTypes=S),E&&(Ie.excludeLocationTypes=E),T!==void 0&&(Ie.isMissing=T),A!==void 0&&(Ie.isUnaired=A),I!==void 0&&(Ie.minCommunityRating=I),_!==void 0&&(Ie.minCriticRating=_),C!==void 0&&(Ie.minPremiereDate=C instanceof Date?C.toISOString():C),k!==void 0&&(Ie.minDateLastSaved=k instanceof Date?k.toISOString():k),D!==void 0&&(Ie.minDateLastSavedForUser=D instanceof Date?D.toISOString():D),O!==void 0&&(Ie.maxPremiereDate=O instanceof Date?O.toISOString():O),F!==void 0&&(Ie.hasOverview=F),j!==void 0&&(Ie.hasImdbId=j),U!==void 0&&(Ie.hasTmdbId=U),K!==void 0&&(Ie.hasTvdbId=K),H!==void 0&&(Ie.isMovie=H),ee!==void 0&&(Ie.isSeries=ee),re!==void 0&&(Ie.isNews=re),de!==void 0&&(Ie.isKids=de),M!==void 0&&(Ie.isSports=M),V&&(Ie.excludeItemIds=V),q!==void 0&&(Ie.startIndex=q),ae!==void 0&&(Ie.limit=ae),pe!==void 0&&(Ie.recursive=pe),P!==void 0&&(Ie.searchTerm=P),$&&(Ie.sortOrder=$),G!==void 0&&(Ie.parentId=G),fe&&(Ie.fields=fe),ge&&(Ie.excludeItemTypes=ge),_e&&(Ie.includeItemTypes=_e),Ne&&(Ie.filters=Ne),Ge!==void 0&&(Ie.isFavorite=Ge),Be&&(Ie.mediaTypes=Be),pt&&(Ie.imageTypes=pt),At&&(Ie.sortBy=At),Vt!==void 0&&(Ie.isPlayed=Vt),bt&&(Ie.genres=bt),gt&&(Ie.officialRatings=gt),zt&&(Ie.tags=zt),Fe&&(Ie.years=Fe),we!==void 0&&(Ie.enableUserData=we),Ue!==void 0&&(Ie.imageTypeLimit=Ue),qe&&(Ie.enableImageTypes=qe),dt!==void 0&&(Ie.person=dt),Ce&&(Ie.personIds=Ce),He&&(Ie.personTypes=He),Tt&&(Ie.studios=Tt),rt&&(Ie.artists=rt),Kt&&(Ie.excludeArtistIds=Kt),ye&&(Ie.artistIds=ye),We&&(Ie.albumArtistIds=We),it&&(Ie.contributingArtistIds=it),ls&&(Ie.albums=ls),Ns&&(Ie.albumIds=Ns),os&&(Ie.ids=os),Zi&&(Ie.videoTypes=Zi),Es!==void 0&&(Ie.minOfficialRating=Es),$t!==void 0&&(Ie.isLocked=$t),As!==void 0&&(Ie.isPlaceHolder=As),Yt!==void 0&&(Ie.hasOfficialRating=Yt),ii!==void 0&&(Ie.collapseBoxSetItems=ii),Ai!==void 0&&(Ie.minWidth=Ai),_i!==void 0&&(Ie.minHeight=_i),xs!==void 0&&(Ie.maxWidth=xs),Wt!==void 0&&(Ie.maxHeight=Wt),Os!==void 0&&(Ie.is3D=Os),Ds&&(Ie.seriesStatus=Ds),Xt!==void 0&&(Ie.nameStartsWithOrGreater=Xt),Vs!==void 0&&(Ie.nameStartsWith=Vs),ni!==void 0&&(Ie.nameLessThan=ni),Ii&&(Ie.studioIds=Ii),ai&&(Ie.genreIds=ai),cs!==void 0&&(Ie.enableTotalRecordCount=cs),$i!==void 0&&(Ie.enableImages=$i),Te(le,Ie);let ss=Oe&&Oe.headers?Oe.headers:{};return Qe.headers={...ts,...ss,...ri.headers},{url:Ee(le),options:Qe}},getResumeItems:async(e,t,s,n,r,l,c,d,u,f,g,y,x,S,E,T={})=>{const A="/UserItems/Resume",I=new URL(A,be);let _;i&&(_=i.baseOptions);const C={method:"GET",..._,...T},k={},D={};await Re(k,"Authorization",i),e!==void 0&&(D.userId=e),t!==void 0&&(D.startIndex=t),s!==void 0&&(D.limit=s),n!==void 0&&(D.searchTerm=n),r!==void 0&&(D.parentId=r),l&&(D.fields=l),c&&(D.mediaTypes=c),d!==void 0&&(D.enableUserData=d),u!==void 0&&(D.imageTypeLimit=u),f&&(D.enableImageTypes=f),g&&(D.excludeItemTypes=g),y&&(D.includeItemTypes=y),x!==void 0&&(D.enableTotalRecordCount=x),S!==void 0&&(D.enableImages=S),E!==void 0&&(D.excludeActiveSessions=E),Te(I,D);let O=_&&_.headers?_.headers:{};return C.headers={...k,...O,...T.headers},{url:Ee(I),options:C}},updateItemUserData:async(e,t,s,n={})=>{Le("updateItemUserData","itemId",e),Le("updateItemUserData","updateUserItemDataDto",t);const r="/UserItems/{itemId}/UserData".replace("{itemId}",encodeURIComponent(String(e))),l=new URL(r,be);let c;i&&(c=i.baseOptions);const d={method:"POST",...c,...n},u={},f={};await Re(u,"Authorization",i),s!==void 0&&(f.userId=s),u["Content-Type"]="application/json",Te(l,f);let g=c&&c.headers?c.headers:{};return d.headers={...u,...g,...n.headers},d.data=Ts(t,d,i),{url:Ee(l),options:d}}}},Fc=function(i){const e=jL(i);return{async getItemUserData(t,s,n){var r,l,c;const d=await e.getItemUserData(t,s,n),u=(r=i?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=Se["ItemsApi.getItemUserData"])===null||l===void 0?void 0:l[u])===null||c===void 0?void 0:c.url;return(g,y)=>Ae(d,ce,ve,i)(g,f||y)},async getItems(t,s,n,r,l,c,d,u,f,g,y,x,S,E,T,A,I,_,C,k,D,O,F,j,U,K,H,ee,re,de,M,V,q,ae,pe,P,$,G,fe,ge,_e,Ne,Ge,Be,pt,At,Vt,bt,gt,zt,Fe,we,Ue,qe,dt,Ce,He,Tt,rt,Kt,ye,We,it,ls,Ns,os,Zi,Es,$t,As,Yt,ii,Ai,_i,xs,Wt,Os,Ds,Xt,Vs,ni,Ii,ai,cs,$i,ri,xn){var le,Oe,Qe;const ts=await e.getItems(t,s,n,r,l,c,d,u,f,g,y,x,S,E,T,A,I,_,C,k,D,O,F,j,U,K,H,ee,re,de,M,V,q,ae,pe,P,$,G,fe,ge,_e,Ne,Ge,Be,pt,At,Vt,bt,gt,zt,Fe,we,Ue,qe,dt,Ce,He,Tt,rt,Kt,ye,We,it,ls,Ns,os,Zi,Es,$t,As,Yt,ii,Ai,_i,xs,Wt,Os,Ds,Xt,Vs,ni,Ii,ai,cs,$i,ri,xn),Ie=(le=i?.serverIndex)!==null&&le!==void 0?le:0,ss=(Qe=(Oe=Se["ItemsApi.getItems"])===null||Oe===void 0?void 0:Oe[Ie])===null||Qe===void 0?void 0:Qe.url;return(_t,mt)=>Ae(ts,ce,ve,i)(_t,ss||mt)},async getResumeItems(t,s,n,r,l,c,d,u,f,g,y,x,S,E,T,A){var I,_,C;const k=await e.getResumeItems(t,s,n,r,l,c,d,u,f,g,y,x,S,E,T,A),D=(I=i?.serverIndex)!==null&&I!==void 0?I:0,O=(C=(_=Se["ItemsApi.getResumeItems"])===null||_===void 0?void 0:_[D])===null||C===void 0?void 0:C.url;return(F,j)=>Ae(k,ce,ve,i)(F,O||j)},async updateItemUserData(t,s,n,r){var l,c,d;const u=await e.updateItemUserData(t,s,n,r),f=(l=i?.serverIndex)!==null&&l!==void 0?l:0,g=(d=(c=Se["ItemsApi.updateItemUserData"])===null||c===void 0?void 0:c[f])===null||d===void 0?void 0:d.url;return(y,x)=>Ae(u,ce,ve,i)(y,g||x)}}};class FL extends vn{getItemUserData(e,t){return Fc(this.configuration).getItemUserData(e.itemId,e.userId,t).then(s=>s(this.axios,this.basePath))}getItems(e={},t){return Fc(this.configuration).getItems(e.userId,e.maxOfficialRating,e.hasThemeSong,e.hasThemeVideo,e.hasSubtitles,e.hasSpecialFeature,e.hasTrailer,e.adjacentTo,e.indexNumber,e.parentIndexNumber,e.hasParentalRating,e.isHd,e.is4K,e.locationTypes,e.excludeLocationTypes,e.isMissing,e.isUnaired,e.minCommunityRating,e.minCriticRating,e.minPremiereDate,e.minDateLastSaved,e.minDateLastSavedForUser,e.maxPremiereDate,e.hasOverview,e.hasImdbId,e.hasTmdbId,e.hasTvdbId,e.isMovie,e.isSeries,e.isNews,e.isKids,e.isSports,e.excludeItemIds,e.startIndex,e.limit,e.recursive,e.searchTerm,e.sortOrder,e.parentId,e.fields,e.excludeItemTypes,e.includeItemTypes,e.filters,e.isFavorite,e.mediaTypes,e.imageTypes,e.sortBy,e.isPlayed,e.genres,e.officialRatings,e.tags,e.years,e.enableUserData,e.imageTypeLimit,e.enableImageTypes,e.person,e.personIds,e.personTypes,e.studios,e.artists,e.excludeArtistIds,e.artistIds,e.albumArtistIds,e.contributingArtistIds,e.albums,e.albumIds,e.ids,e.videoTypes,e.minOfficialRating,e.isLocked,e.isPlaceHolder,e.hasOfficialRating,e.collapseBoxSetItems,e.minWidth,e.minHeight,e.maxWidth,e.maxHeight,e.is3D,e.seriesStatus,e.nameStartsWithOrGreater,e.nameStartsWith,e.nameLessThan,e.studioIds,e.genreIds,e.enableTotalRecordCount,e.enableImages,t).then(s=>s(this.axios,this.basePath))}getResumeItems(e={},t){return Fc(this.configuration).getResumeItems(e.userId,e.startIndex,e.limit,e.searchTerm,e.parentId,e.fields,e.mediaTypes,e.enableUserData,e.imageTypeLimit,e.enableImageTypes,e.excludeItemTypes,e.includeItemTypes,e.enableTotalRecordCount,e.enableImages,e.excludeActiveSessions,t).then(s=>s(this.axios,this.basePath))}updateItemUserData(e,t){return Fc(this.configuration).updateItemUserData(e.itemId,e.updateUserItemDataDto,e.userId,t).then(s=>s(this.axios,this.basePath))}}const BL=function(i){return{getEpisodes:async(e,t,s,n,r,l,c,d,u,f,g,y,x,S,E,T={})=>{Le("getEpisodes","seriesId",e);const A="/Shows/{seriesId}/Episodes".replace("{seriesId}",encodeURIComponent(String(e))),I=new URL(A,be);let _;i&&(_=i.baseOptions);const C={method:"GET",..._,...T},k={},D={};await Re(k,"Authorization",i),t!==void 0&&(D.userId=t),s&&(D.fields=s),n!==void 0&&(D.season=n),r!==void 0&&(D.seasonId=r),l!==void 0&&(D.isMissing=l),c!==void 0&&(D.adjacentTo=c),d!==void 0&&(D.startItemId=d),u!==void 0&&(D.startIndex=u),f!==void 0&&(D.limit=f),g!==void 0&&(D.enableImages=g),y!==void 0&&(D.imageTypeLimit=y),x&&(D.enableImageTypes=x),S!==void 0&&(D.enableUserData=S),E!==void 0&&(D.sortBy=E),Te(I,D);let O=_&&_.headers?_.headers:{};return C.headers={...k,...O,...T.headers},{url:Ee(I),options:C}},getNextUp:async(e,t,s,n,r,l,c,d,u,f,g,y,x,S,E,T={})=>{const A="/Shows/NextUp",I=new URL(A,be);let _;i&&(_=i.baseOptions);const C={method:"GET",..._,...T},k={},D={};await Re(k,"Authorization",i),e!==void 0&&(D.userId=e),t!==void 0&&(D.startIndex=t),s!==void 0&&(D.limit=s),n&&(D.fields=n),r!==void 0&&(D.seriesId=r),l!==void 0&&(D.parentId=l),c!==void 0&&(D.enableImages=c),d!==void 0&&(D.imageTypeLimit=d),u&&(D.enableImageTypes=u),f!==void 0&&(D.enableUserData=f),g!==void 0&&(D.nextUpDateCutoff=g instanceof Date?g.toISOString():g),y!==void 0&&(D.enableTotalRecordCount=y),x!==void 0&&(D.disableFirstEpisode=x),S!==void 0&&(D.enableResumable=S),E!==void 0&&(D.enableRewatching=E),Te(I,D);let O=_&&_.headers?_.headers:{};return C.headers={...k,...O,...T.headers},{url:Ee(I),options:C}},getSeasons:async(e,t,s,n,r,l,c,d,u,f,g={})=>{Le("getSeasons","seriesId",e);const y="/Shows/{seriesId}/Seasons".replace("{seriesId}",encodeURIComponent(String(e))),x=new URL(y,be);let S;i&&(S=i.baseOptions);const E={method:"GET",...S,...g},T={},A={};await Re(T,"Authorization",i),t!==void 0&&(A.userId=t),s&&(A.fields=s),n!==void 0&&(A.isSpecialSeason=n),r!==void 0&&(A.isMissing=r),l!==void 0&&(A.adjacentTo=l),c!==void 0&&(A.enableImages=c),d!==void 0&&(A.imageTypeLimit=d),u&&(A.enableImageTypes=u),f!==void 0&&(A.enableUserData=f),Te(x,A);let I=S&&S.headers?S.headers:{};return E.headers={...T,...I,...g.headers},{url:Ee(x),options:E}},getUpcomingEpisodes:async(e,t,s,n,r,l,c,d,u,f={})=>{const g="/Shows/Upcoming",y=new URL(g,be);let x;i&&(x=i.baseOptions);const S={method:"GET",...x,...f},E={},T={};await Re(E,"Authorization",i),e!==void 0&&(T.userId=e),t!==void 0&&(T.startIndex=t),s!==void 0&&(T.limit=s),n&&(T.fields=n),r!==void 0&&(T.parentId=r),l!==void 0&&(T.enableImages=l),c!==void 0&&(T.imageTypeLimit=c),d&&(T.enableImageTypes=d),u!==void 0&&(T.enableUserData=u),Te(y,T);let A=x&&x.headers?x.headers:{};return S.headers={...E,...A,...f.headers},{url:Ee(y),options:S}}}},Bc=function(i){const e=BL(i);return{async getEpisodes(t,s,n,r,l,c,d,u,f,g,y,x,S,E,T,A){var I,_,C;const k=await e.getEpisodes(t,s,n,r,l,c,d,u,f,g,y,x,S,E,T,A),D=(I=i?.serverIndex)!==null&&I!==void 0?I:0,O=(C=(_=Se["TvShowsApi.getEpisodes"])===null||_===void 0?void 0:_[D])===null||C===void 0?void 0:C.url;return(F,j)=>Ae(k,ce,ve,i)(F,O||j)},async getNextUp(t,s,n,r,l,c,d,u,f,g,y,x,S,E,T,A){var I,_,C;const k=await e.getNextUp(t,s,n,r,l,c,d,u,f,g,y,x,S,E,T,A),D=(I=i?.serverIndex)!==null&&I!==void 0?I:0,O=(C=(_=Se["TvShowsApi.getNextUp"])===null||_===void 0?void 0:_[D])===null||C===void 0?void 0:C.url;return(F,j)=>Ae(k,ce,ve,i)(F,O||j)},async getSeasons(t,s,n,r,l,c,d,u,f,g,y){var x,S,E;const T=await e.getSeasons(t,s,n,r,l,c,d,u,f,g,y),A=(x=i?.serverIndex)!==null&&x!==void 0?x:0,I=(E=(S=Se["TvShowsApi.getSeasons"])===null||S===void 0?void 0:S[A])===null||E===void 0?void 0:E.url;return(_,C)=>Ae(T,ce,ve,i)(_,I||C)},async getUpcomingEpisodes(t,s,n,r,l,c,d,u,f,g){var y,x,S;const E=await e.getUpcomingEpisodes(t,s,n,r,l,c,d,u,f,g),T=(y=i?.serverIndex)!==null&&y!==void 0?y:0,A=(S=(x=Se["TvShowsApi.getUpcomingEpisodes"])===null||x===void 0?void 0:x[T])===null||S===void 0?void 0:S.url;return(I,_)=>Ae(E,ce,ve,i)(I,A||_)}}};class VL extends vn{getEpisodes(e,t){return Bc(this.configuration).getEpisodes(e.seriesId,e.userId,e.fields,e.season,e.seasonId,e.isMissing,e.adjacentTo,e.startItemId,e.startIndex,e.limit,e.enableImages,e.imageTypeLimit,e.enableImageTypes,e.enableUserData,e.sortBy,t).then(s=>s(this.axios,this.basePath))}getNextUp(e={},t){return Bc(this.configuration).getNextUp(e.userId,e.startIndex,e.limit,e.fields,e.seriesId,e.parentId,e.enableImages,e.imageTypeLimit,e.enableImageTypes,e.enableUserData,e.nextUpDateCutoff,e.enableTotalRecordCount,e.disableFirstEpisode,e.enableResumable,e.enableRewatching,t).then(s=>s(this.axios,this.basePath))}getSeasons(e,t){return Bc(this.configuration).getSeasons(e.seriesId,e.userId,e.fields,e.isSpecialSeason,e.isMissing,e.adjacentTo,e.enableImages,e.imageTypeLimit,e.enableImageTypes,e.enableUserData,t).then(s=>s(this.axios,this.basePath))}getUpcomingEpisodes(e={},t){return Bc(this.configuration).getUpcomingEpisodes(e.userId,e.startIndex,e.limit,e.fields,e.parentId,e.enableImages,e.imageTypeLimit,e.enableImageTypes,e.enableUserData,t).then(s=>s(this.axios,this.basePath))}}const $L=function(i){return{deleteItem:async(e,t={})=>{Le("deleteItem","itemId",e);const s="/Items/{itemId}".replace("{itemId}",encodeURIComponent(String(e))),n=new URL(s,be);let r;i&&(r=i.baseOptions);const l={method:"DELETE",...r,...t},c={},d={};await Re(c,"Authorization",i),Te(n,d);let u=r&&r.headers?r.headers:{};return l.headers={...c,...u,...t.headers},{url:Ee(n),options:l}},deleteItems:async(e,t={})=>{const s="/Items",n=new URL(s,be);let r;i&&(r=i.baseOptions);const l={method:"DELETE",...r,...t},c={},d={};await Re(c,"Authorization",i),e&&(d.ids=e),Te(n,d);let u=r&&r.headers?r.headers:{};return l.headers={...c,...u,...t.headers},{url:Ee(n),options:l}},getAncestors:async(e,t,s={})=>{Le("getAncestors","itemId",e);const n="/Items/{itemId}/Ancestors".replace("{itemId}",encodeURIComponent(String(e))),r=new URL(n,be);let l;i&&(l=i.baseOptions);const c={method:"GET",...l,...s},d={},u={};await Re(d,"Authorization",i),t!==void 0&&(u.userId=t),Te(r,u);let f=l&&l.headers?l.headers:{};return c.headers={...d,...f,...s.headers},{url:Ee(r),options:c}},getCriticReviews:async(e,t={})=>{Le("getCriticReviews","itemId",e);const s="/Items/{itemId}/CriticReviews".replace("{itemId}",encodeURIComponent(String(e))),n=new URL(s,be);let r;i&&(r=i.baseOptions);const l={method:"GET",...r,...t},c={},d={};await Re(c,"Authorization",i),Te(n,d);let u=r&&r.headers?r.headers:{};return l.headers={...c,...u,...t.headers},{url:Ee(n),options:l}},getDownload:async(e,t={})=>{Le("getDownload","itemId",e);const s="/Items/{itemId}/Download".replace("{itemId}",encodeURIComponent(String(e))),n=new URL(s,be);let r;i&&(r=i.baseOptions);const l={method:"GET",...r,...t},c={},d={};await Re(c,"Authorization",i),Te(n,d);let u=r&&r.headers?r.headers:{};return l.headers={...c,...u,...t.headers},{url:Ee(n),options:l}},getFile:async(e,t={})=>{Le("getFile","itemId",e);const s="/Items/{itemId}/File".replace("{itemId}",encodeURIComponent(String(e))),n=new URL(s,be);let r;i&&(r=i.baseOptions);const l={method:"GET",...r,...t},c={},d={};await Re(c,"Authorization",i),Te(n,d);let u=r&&r.headers?r.headers:{};return l.headers={...c,...u,...t.headers},{url:Ee(n),options:l}},getItemCounts:async(e,t,s={})=>{const n="/Items/Counts",r=new URL(n,be);let l;i&&(l=i.baseOptions);const c={method:"GET",...l,...s},d={},u={};await Re(d,"Authorization",i),e!==void 0&&(u.userId=e),t!==void 0&&(u.isFavorite=t),Te(r,u);let f=l&&l.headers?l.headers:{};return c.headers={...d,...f,...s.headers},{url:Ee(r),options:c}},getLibraryOptionsInfo:async(e,t,s={})=>{const n="/Libraries/AvailableOptions",r=new URL(n,be);let l;i&&(l=i.baseOptions);const c={method:"GET",...l,...s},d={},u={};await Re(d,"Authorization",i),e!==void 0&&(u.libraryContentType=e),t!==void 0&&(u.isNewLibrary=t),Te(r,u);let f=l&&l.headers?l.headers:{};return c.headers={...d,...f,...s.headers},{url:Ee(r),options:c}},getMediaFolders:async(e,t={})=>{const s="/Library/MediaFolders",n=new URL(s,be);let r;i&&(r=i.baseOptions);const l={method:"GET",...r,...t},c={},d={};await Re(c,"Authorization",i),e!==void 0&&(d.isHidden=e),Te(n,d);let u=r&&r.headers?r.headers:{};return l.headers={...c,...u,...t.headers},{url:Ee(n),options:l}},getPhysicalPaths:async(e={})=>{const t="/Library/PhysicalPaths",s=new URL(t,be);let n;i&&(n=i.baseOptions);const r={method:"GET",...n,...e},l={},c={};await Re(l,"Authorization",i),Te(s,c);let d=n&&n.headers?n.headers:{};return r.headers={...l,...d,...e.headers},{url:Ee(s),options:r}},getSimilarAlbums:async(e,t,s,n,r,l={})=>{Le("getSimilarAlbums","itemId",e);const c="/Albums/{itemId}/Similar".replace("{itemId}",encodeURIComponent(String(e))),d=new URL(c,be);let u;i&&(u=i.baseOptions);const f={method:"GET",...u,...l},g={},y={};await Re(g,"Authorization",i),t&&(y.excludeArtistIds=t),s!==void 0&&(y.userId=s),n!==void 0&&(y.limit=n),r&&(y.fields=r),Te(d,y);let x=u&&u.headers?u.headers:{};return f.headers={...g,...x,...l.headers},{url:Ee(d),options:f}},getSimilarArtists:async(e,t,s,n,r,l={})=>{Le("getSimilarArtists","itemId",e);const c="/Artists/{itemId}/Similar".replace("{itemId}",encodeURIComponent(String(e))),d=new URL(c,be);let u;i&&(u=i.baseOptions);const f={method:"GET",...u,...l},g={},y={};await Re(g,"Authorization",i),t&&(y.excludeArtistIds=t),s!==void 0&&(y.userId=s),n!==void 0&&(y.limit=n),r&&(y.fields=r),Te(d,y);let x=u&&u.headers?u.headers:{};return f.headers={...g,...x,...l.headers},{url:Ee(d),options:f}},getSimilarItems:async(e,t,s,n,r,l={})=>{Le("getSimilarItems","itemId",e);const c="/Items/{itemId}/Similar".replace("{itemId}",encodeURIComponent(String(e))),d=new URL(c,be);let u;i&&(u=i.baseOptions);const f={method:"GET",...u,...l},g={},y={};await Re(g,"Authorization",i),t&&(y.excludeArtistIds=t),s!==void 0&&(y.userId=s),n!==void 0&&(y.limit=n),r&&(y.fields=r),Te(d,y);let x=u&&u.headers?u.headers:{};return f.headers={...g,...x,...l.headers},{url:Ee(d),options:f}},getSimilarMovies:async(e,t,s,n,r,l={})=>{Le("getSimilarMovies","itemId",e);const c="/Movies/{itemId}/Similar".replace("{itemId}",encodeURIComponent(String(e))),d=new URL(c,be);let u;i&&(u=i.baseOptions);const f={method:"GET",...u,...l},g={},y={};await Re(g,"Authorization",i),t&&(y.excludeArtistIds=t),s!==void 0&&(y.userId=s),n!==void 0&&(y.limit=n),r&&(y.fields=r),Te(d,y);let x=u&&u.headers?u.headers:{};return f.headers={...g,...x,...l.headers},{url:Ee(d),options:f}},getSimilarShows:async(e,t,s,n,r,l={})=>{Le("getSimilarShows","itemId",e);const c="/Shows/{itemId}/Similar".replace("{itemId}",encodeURIComponent(String(e))),d=new URL(c,be);let u;i&&(u=i.baseOptions);const f={method:"GET",...u,...l},g={},y={};await Re(g,"Authorization",i),t&&(y.excludeArtistIds=t),s!==void 0&&(y.userId=s),n!==void 0&&(y.limit=n),r&&(y.fields=r),Te(d,y);let x=u&&u.headers?u.headers:{};return f.headers={...g,...x,...l.headers},{url:Ee(d),options:f}},getSimilarTrailers:async(e,t,s,n,r,l={})=>{Le("getSimilarTrailers","itemId",e);const c="/Trailers/{itemId}/Similar".replace("{itemId}",encodeURIComponent(String(e))),d=new URL(c,be);let u;i&&(u=i.baseOptions);const f={method:"GET",...u,...l},g={},y={};await Re(g,"Authorization",i),t&&(y.excludeArtistIds=t),s!==void 0&&(y.userId=s),n!==void 0&&(y.limit=n),r&&(y.fields=r),Te(d,y);let x=u&&u.headers?u.headers:{};return f.headers={...g,...x,...l.headers},{url:Ee(d),options:f}},getThemeMedia:async(e,t,s,n,r,l={})=>{Le("getThemeMedia","itemId",e);const c="/Items/{itemId}/ThemeMedia".replace("{itemId}",encodeURIComponent(String(e))),d=new URL(c,be);let u;i&&(u=i.baseOptions);const f={method:"GET",...u,...l},g={},y={};await Re(g,"Authorization",i),t!==void 0&&(y.userId=t),s!==void 0&&(y.inheritFromParent=s),n&&(y.sortBy=n),r&&(y.sortOrder=r),Te(d,y);let x=u&&u.headers?u.headers:{};return f.headers={...g,...x,...l.headers},{url:Ee(d),options:f}},getThemeSongs:async(e,t,s,n,r,l={})=>{Le("getThemeSongs","itemId",e);const c="/Items/{itemId}/ThemeSongs".replace("{itemId}",encodeURIComponent(String(e))),d=new URL(c,be);let u;i&&(u=i.baseOptions);const f={method:"GET",...u,...l},g={},y={};await Re(g,"Authorization",i),t!==void 0&&(y.userId=t),s!==void 0&&(y.inheritFromParent=s),n&&(y.sortBy=n),r&&(y.sortOrder=r),Te(d,y);let x=u&&u.headers?u.headers:{};return f.headers={...g,...x,...l.headers},{url:Ee(d),options:f}},getThemeVideos:async(e,t,s,n,r,l={})=>{Le("getThemeVideos","itemId",e);const c="/Items/{itemId}/ThemeVideos".replace("{itemId}",encodeURIComponent(String(e))),d=new URL(c,be);let u;i&&(u=i.baseOptions);const f={method:"GET",...u,...l},g={},y={};await Re(g,"Authorization",i),t!==void 0&&(y.userId=t),s!==void 0&&(y.inheritFromParent=s),n&&(y.sortBy=n),r&&(y.sortOrder=r),Te(d,y);let x=u&&u.headers?u.headers:{};return f.headers={...g,...x,...l.headers},{url:Ee(d),options:f}},postAddedMovies:async(e,t,s={})=>{const n="/Library/Movies/Added",r=new URL(n,be);let l;i&&(l=i.baseOptions);const c={method:"POST",...l,...s},d={},u={};await Re(d,"Authorization",i),e!==void 0&&(u.tmdbId=e),t!==void 0&&(u.imdbId=t),Te(r,u);let f=l&&l.headers?l.headers:{};return c.headers={...d,...f,...s.headers},{url:Ee(r),options:c}},postAddedSeries:async(e,t={})=>{const s="/Library/Series/Added",n=new URL(s,be);let r;i&&(r=i.baseOptions);const l={method:"POST",...r,...t},c={},d={};await Re(c,"Authorization",i),e!==void 0&&(d.tvdbId=e),Te(n,d);let u=r&&r.headers?r.headers:{};return l.headers={...c,...u,...t.headers},{url:Ee(n),options:l}},postUpdatedMedia:async(e,t={})=>{Le("postUpdatedMedia","mediaUpdateInfoDto",e);const s="/Library/Media/Updated",n=new URL(s,be);let r;i&&(r=i.baseOptions);const l={method:"POST",...r,...t},c={},d={};await Re(c,"Authorization",i),c["Content-Type"]="application/json",Te(n,d);let u=r&&r.headers?r.headers:{};return l.headers={...c,...u,...t.headers},l.data=Ts(e,l,i),{url:Ee(n),options:l}},postUpdatedMovies:async(e,t,s={})=>{const n="/Library/Movies/Updated",r=new URL(n,be);let l;i&&(l=i.baseOptions);const c={method:"POST",...l,...s},d={},u={};await Re(d,"Authorization",i),e!==void 0&&(u.tmdbId=e),t!==void 0&&(u.imdbId=t),Te(r,u);let f=l&&l.headers?l.headers:{};return c.headers={...d,...f,...s.headers},{url:Ee(r),options:c}},postUpdatedSeries:async(e,t={})=>{const s="/Library/Series/Updated",n=new URL(s,be);let r;i&&(r=i.baseOptions);const l={method:"POST",...r,...t},c={},d={};await Re(c,"Authorization",i),e!==void 0&&(d.tvdbId=e),Te(n,d);let u=r&&r.headers?r.headers:{};return l.headers={...c,...u,...t.headers},{url:Ee(n),options:l}},refreshLibrary:async(e={})=>{const t="/Library/Refresh",s=new URL(t,be);let n;i&&(n=i.baseOptions);const r={method:"POST",...n,...e},l={},c={};await Re(l,"Authorization",i),Te(s,c);let d=n&&n.headers?n.headers:{};return r.headers={...l,...d,...e.headers},{url:Ee(s),options:r}}}},Bt=function(i){const e=$L(i);return{async deleteItem(t,s){var n,r,l;const c=await e.deleteItem(t,s),d=(n=i?.serverIndex)!==null&&n!==void 0?n:0,u=(l=(r=Se["LibraryApi.deleteItem"])===null||r===void 0?void 0:r[d])===null||l===void 0?void 0:l.url;return(f,g)=>Ae(c,ce,ve,i)(f,u||g)},async deleteItems(t,s){var n,r,l;const c=await e.deleteItems(t,s),d=(n=i?.serverIndex)!==null&&n!==void 0?n:0,u=(l=(r=Se["LibraryApi.deleteItems"])===null||r===void 0?void 0:r[d])===null||l===void 0?void 0:l.url;return(f,g)=>Ae(c,ce,ve,i)(f,u||g)},async getAncestors(t,s,n){var r,l,c;const d=await e.getAncestors(t,s,n),u=(r=i?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=Se["LibraryApi.getAncestors"])===null||l===void 0?void 0:l[u])===null||c===void 0?void 0:c.url;return(g,y)=>Ae(d,ce,ve,i)(g,f||y)},async getCriticReviews(t,s){var n,r,l;const c=await e.getCriticReviews(t,s),d=(n=i?.serverIndex)!==null&&n!==void 0?n:0,u=(l=(r=Se["LibraryApi.getCriticReviews"])===null||r===void 0?void 0:r[d])===null||l===void 0?void 0:l.url;return(f,g)=>Ae(c,ce,ve,i)(f,u||g)},async getDownload(t,s){var n,r,l;const c=await e.getDownload(t,s),d=(n=i?.serverIndex)!==null&&n!==void 0?n:0,u=(l=(r=Se["LibraryApi.getDownload"])===null||r===void 0?void 0:r[d])===null||l===void 0?void 0:l.url;return(f,g)=>Ae(c,ce,ve,i)(f,u||g)},async getFile(t,s){var n,r,l;const c=await e.getFile(t,s),d=(n=i?.serverIndex)!==null&&n!==void 0?n:0,u=(l=(r=Se["LibraryApi.getFile"])===null||r===void 0?void 0:r[d])===null||l===void 0?void 0:l.url;return(f,g)=>Ae(c,ce,ve,i)(f,u||g)},async getItemCounts(t,s,n){var r,l,c;const d=await e.getItemCounts(t,s,n),u=(r=i?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=Se["LibraryApi.getItemCounts"])===null||l===void 0?void 0:l[u])===null||c===void 0?void 0:c.url;return(g,y)=>Ae(d,ce,ve,i)(g,f||y)},async getLibraryOptionsInfo(t,s,n){var r,l,c;const d=await e.getLibraryOptionsInfo(t,s,n),u=(r=i?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=Se["LibraryApi.getLibraryOptionsInfo"])===null||l===void 0?void 0:l[u])===null||c===void 0?void 0:c.url;return(g,y)=>Ae(d,ce,ve,i)(g,f||y)},async getMediaFolders(t,s){var n,r,l;const c=await e.getMediaFolders(t,s),d=(n=i?.serverIndex)!==null&&n!==void 0?n:0,u=(l=(r=Se["LibraryApi.getMediaFolders"])===null||r===void 0?void 0:r[d])===null||l===void 0?void 0:l.url;return(f,g)=>Ae(c,ce,ve,i)(f,u||g)},async getPhysicalPaths(t){var s,n,r;const l=await e.getPhysicalPaths(t),c=(s=i?.serverIndex)!==null&&s!==void 0?s:0,d=(r=(n=Se["LibraryApi.getPhysicalPaths"])===null||n===void 0?void 0:n[c])===null||r===void 0?void 0:r.url;return(u,f)=>Ae(l,ce,ve,i)(u,d||f)},async getSimilarAlbums(t,s,n,r,l,c){var d,u,f;const g=await e.getSimilarAlbums(t,s,n,r,l,c),y=(d=i?.serverIndex)!==null&&d!==void 0?d:0,x=(f=(u=Se["LibraryApi.getSimilarAlbums"])===null||u===void 0?void 0:u[y])===null||f===void 0?void 0:f.url;return(S,E)=>Ae(g,ce,ve,i)(S,x||E)},async getSimilarArtists(t,s,n,r,l,c){var d,u,f;const g=await e.getSimilarArtists(t,s,n,r,l,c),y=(d=i?.serverIndex)!==null&&d!==void 0?d:0,x=(f=(u=Se["LibraryApi.getSimilarArtists"])===null||u===void 0?void 0:u[y])===null||f===void 0?void 0:f.url;return(S,E)=>Ae(g,ce,ve,i)(S,x||E)},async getSimilarItems(t,s,n,r,l,c){var d,u,f;const g=await e.getSimilarItems(t,s,n,r,l,c),y=(d=i?.serverIndex)!==null&&d!==void 0?d:0,x=(f=(u=Se["LibraryApi.getSimilarItems"])===null||u===void 0?void 0:u[y])===null||f===void 0?void 0:f.url;return(S,E)=>Ae(g,ce,ve,i)(S,x||E)},async getSimilarMovies(t,s,n,r,l,c){var d,u,f;const g=await e.getSimilarMovies(t,s,n,r,l,c),y=(d=i?.serverIndex)!==null&&d!==void 0?d:0,x=(f=(u=Se["LibraryApi.getSimilarMovies"])===null||u===void 0?void 0:u[y])===null||f===void 0?void 0:f.url;return(S,E)=>Ae(g,ce,ve,i)(S,x||E)},async getSimilarShows(t,s,n,r,l,c){var d,u,f;const g=await e.getSimilarShows(t,s,n,r,l,c),y=(d=i?.serverIndex)!==null&&d!==void 0?d:0,x=(f=(u=Se["LibraryApi.getSimilarShows"])===null||u===void 0?void 0:u[y])===null||f===void 0?void 0:f.url;return(S,E)=>Ae(g,ce,ve,i)(S,x||E)},async getSimilarTrailers(t,s,n,r,l,c){var d,u,f;const g=await e.getSimilarTrailers(t,s,n,r,l,c),y=(d=i?.serverIndex)!==null&&d!==void 0?d:0,x=(f=(u=Se["LibraryApi.getSimilarTrailers"])===null||u===void 0?void 0:u[y])===null||f===void 0?void 0:f.url;return(S,E)=>Ae(g,ce,ve,i)(S,x||E)},async getThemeMedia(t,s,n,r,l,c){var d,u,f;const g=await e.getThemeMedia(t,s,n,r,l,c),y=(d=i?.serverIndex)!==null&&d!==void 0?d:0,x=(f=(u=Se["LibraryApi.getThemeMedia"])===null||u===void 0?void 0:u[y])===null||f===void 0?void 0:f.url;return(S,E)=>Ae(g,ce,ve,i)(S,x||E)},async getThemeSongs(t,s,n,r,l,c){var d,u,f;const g=await e.getThemeSongs(t,s,n,r,l,c),y=(d=i?.serverIndex)!==null&&d!==void 0?d:0,x=(f=(u=Se["LibraryApi.getThemeSongs"])===null||u===void 0?void 0:u[y])===null||f===void 0?void 0:f.url;return(S,E)=>Ae(g,ce,ve,i)(S,x||E)},async getThemeVideos(t,s,n,r,l,c){var d,u,f;const g=await e.getThemeVideos(t,s,n,r,l,c),y=(d=i?.serverIndex)!==null&&d!==void 0?d:0,x=(f=(u=Se["LibraryApi.getThemeVideos"])===null||u===void 0?void 0:u[y])===null||f===void 0?void 0:f.url;return(S,E)=>Ae(g,ce,ve,i)(S,x||E)},async postAddedMovies(t,s,n){var r,l,c;const d=await e.postAddedMovies(t,s,n),u=(r=i?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=Se["LibraryApi.postAddedMovies"])===null||l===void 0?void 0:l[u])===null||c===void 0?void 0:c.url;return(g,y)=>Ae(d,ce,ve,i)(g,f||y)},async postAddedSeries(t,s){var n,r,l;const c=await e.postAddedSeries(t,s),d=(n=i?.serverIndex)!==null&&n!==void 0?n:0,u=(l=(r=Se["LibraryApi.postAddedSeries"])===null||r===void 0?void 0:r[d])===null||l===void 0?void 0:l.url;return(f,g)=>Ae(c,ce,ve,i)(f,u||g)},async postUpdatedMedia(t,s){var n,r,l;const c=await e.postUpdatedMedia(t,s),d=(n=i?.serverIndex)!==null&&n!==void 0?n:0,u=(l=(r=Se["LibraryApi.postUpdatedMedia"])===null||r===void 0?void 0:r[d])===null||l===void 0?void 0:l.url;return(f,g)=>Ae(c,ce,ve,i)(f,u||g)},async postUpdatedMovies(t,s,n){var r,l,c;const d=await e.postUpdatedMovies(t,s,n),u=(r=i?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=Se["LibraryApi.postUpdatedMovies"])===null||l===void 0?void 0:l[u])===null||c===void 0?void 0:c.url;return(g,y)=>Ae(d,ce,ve,i)(g,f||y)},async postUpdatedSeries(t,s){var n,r,l;const c=await e.postUpdatedSeries(t,s),d=(n=i?.serverIndex)!==null&&n!==void 0?n:0,u=(l=(r=Se["LibraryApi.postUpdatedSeries"])===null||r===void 0?void 0:r[d])===null||l===void 0?void 0:l.url;return(f,g)=>Ae(c,ce,ve,i)(f,u||g)},async refreshLibrary(t){var s,n,r;const l=await e.refreshLibrary(t),c=(s=i?.serverIndex)!==null&&s!==void 0?s:0,d=(r=(n=Se["LibraryApi.refreshLibrary"])===null||n===void 0?void 0:n[c])===null||r===void 0?void 0:r.url;return(u,f)=>Ae(l,ce,ve,i)(u,d||f)}}};class GL extends vn{deleteItem(e,t){return Bt(this.configuration).deleteItem(e.itemId,t).then(s=>s(this.axios,this.basePath))}deleteItems(e={},t){return Bt(this.configuration).deleteItems(e.ids,t).then(s=>s(this.axios,this.basePath))}getAncestors(e,t){return Bt(this.configuration).getAncestors(e.itemId,e.userId,t).then(s=>s(this.axios,this.basePath))}getCriticReviews(e,t){return Bt(this.configuration).getCriticReviews(e.itemId,t).then(s=>s(this.axios,this.basePath))}getDownload(e,t){return Bt(this.configuration).getDownload(e.itemId,t).then(s=>s(this.axios,this.basePath))}getFile(e,t){return Bt(this.configuration).getFile(e.itemId,t).then(s=>s(this.axios,this.basePath))}getItemCounts(e={},t){return Bt(this.configuration).getItemCounts(e.userId,e.isFavorite,t).then(s=>s(this.axios,this.basePath))}getLibraryOptionsInfo(e={},t){return Bt(this.configuration).getLibraryOptionsInfo(e.libraryContentType,e.isNewLibrary,t).then(s=>s(this.axios,this.basePath))}getMediaFolders(e={},t){return Bt(this.configuration).getMediaFolders(e.isHidden,t).then(s=>s(this.axios,this.basePath))}getPhysicalPaths(e){return Bt(this.configuration).getPhysicalPaths(e).then(t=>t(this.axios,this.basePath))}getSimilarAlbums(e,t){return Bt(this.configuration).getSimilarAlbums(e.itemId,e.excludeArtistIds,e.userId,e.limit,e.fields,t).then(s=>s(this.axios,this.basePath))}getSimilarArtists(e,t){return Bt(this.configuration).getSimilarArtists(e.itemId,e.excludeArtistIds,e.userId,e.limit,e.fields,t).then(s=>s(this.axios,this.basePath))}getSimilarItems(e,t){return Bt(this.configuration).getSimilarItems(e.itemId,e.excludeArtistIds,e.userId,e.limit,e.fields,t).then(s=>s(this.axios,this.basePath))}getSimilarMovies(e,t){return Bt(this.configuration).getSimilarMovies(e.itemId,e.excludeArtistIds,e.userId,e.limit,e.fields,t).then(s=>s(this.axios,this.basePath))}getSimilarShows(e,t){return Bt(this.configuration).getSimilarShows(e.itemId,e.excludeArtistIds,e.userId,e.limit,e.fields,t).then(s=>s(this.axios,this.basePath))}getSimilarTrailers(e,t){return Bt(this.configuration).getSimilarTrailers(e.itemId,e.excludeArtistIds,e.userId,e.limit,e.fields,t).then(s=>s(this.axios,this.basePath))}getThemeMedia(e,t){return Bt(this.configuration).getThemeMedia(e.itemId,e.userId,e.inheritFromParent,e.sortBy,e.sortOrder,t).then(s=>s(this.axios,this.basePath))}getThemeSongs(e,t){return Bt(this.configuration).getThemeSongs(e.itemId,e.userId,e.inheritFromParent,e.sortBy,e.sortOrder,t).then(s=>s(this.axios,this.basePath))}getThemeVideos(e,t){return Bt(this.configuration).getThemeVideos(e.itemId,e.userId,e.inheritFromParent,e.sortBy,e.sortOrder,t).then(s=>s(this.axios,this.basePath))}postAddedMovies(e={},t){return Bt(this.configuration).postAddedMovies(e.tmdbId,e.imdbId,t).then(s=>s(this.axios,this.basePath))}postAddedSeries(e={},t){return Bt(this.configuration).postAddedSeries(e.tvdbId,t).then(s=>s(this.axios,this.basePath))}postUpdatedMedia(e,t){return Bt(this.configuration).postUpdatedMedia(e.mediaUpdateInfoDto,t).then(s=>s(this.axios,this.basePath))}postUpdatedMovies(e={},t){return Bt(this.configuration).postUpdatedMovies(e.tmdbId,e.imdbId,t).then(s=>s(this.axios,this.basePath))}postUpdatedSeries(e={},t){return Bt(this.configuration).postUpdatedSeries(e.tvdbId,t).then(s=>s(this.axios,this.basePath))}refreshLibrary(e){return Bt(this.configuration).refreshLibrary(e).then(t=>t(this.axios,this.basePath))}}const HL=function(i){return{deleteSubtitle:async(e,t,s={})=>{Le("deleteSubtitle","itemId",e),Le("deleteSubtitle","index",t);const n="/Videos/{itemId}/Subtitles/{index}".replace("{itemId}",encodeURIComponent(String(e))).replace("{index}",encodeURIComponent(String(t))),r=new URL(n,be);let l;i&&(l=i.baseOptions);const c={method:"DELETE",...l,...s},d={},u={};await Re(d,"Authorization",i),Te(r,u);let f=l&&l.headers?l.headers:{};return c.headers={...d,...f,...s.headers},{url:Ee(r),options:c}},downloadRemoteSubtitles:async(e,t,s={})=>{Le("downloadRemoteSubtitles","itemId",e),Le("downloadRemoteSubtitles","subtitleId",t);const n="/Items/{itemId}/RemoteSearch/Subtitles/{subtitleId}".replace("{itemId}",encodeURIComponent(String(e))).replace("{subtitleId}",encodeURIComponent(String(t))),r=new URL(n,be);let l;i&&(l=i.baseOptions);const c={method:"POST",...l,...s},d={},u={};await Re(d,"Authorization",i),Te(r,u);let f=l&&l.headers?l.headers:{};return c.headers={...d,...f,...s.headers},{url:Ee(r),options:c}},getFallbackFont:async(e,t={})=>{Le("getFallbackFont","name",e);const s="/FallbackFont/Fonts/{name}".replace("{name}",encodeURIComponent(String(e))),n=new URL(s,be);let r;i&&(r=i.baseOptions);const l={method:"GET",...r,...t},c={},d={};await Re(c,"Authorization",i),Te(n,d);let u=r&&r.headers?r.headers:{};return l.headers={...c,...u,...t.headers},{url:Ee(n),options:l}},getFallbackFontList:async(e={})=>{const t="/FallbackFont/Fonts",s=new URL(t,be);let n;i&&(n=i.baseOptions);const r={method:"GET",...n,...e},l={},c={};await Re(l,"Authorization",i),Te(s,c);let d=n&&n.headers?n.headers:{};return r.headers={...l,...d,...e.headers},{url:Ee(s),options:r}},getRemoteSubtitles:async(e,t={})=>{Le("getRemoteSubtitles","subtitleId",e);const s="/Providers/Subtitles/Subtitles/{subtitleId}".replace("{subtitleId}",encodeURIComponent(String(e))),n=new URL(s,be);let r;i&&(r=i.baseOptions);const l={method:"GET",...r,...t},c={},d={};await Re(c,"Authorization",i),Te(n,d);let u=r&&r.headers?r.headers:{};return l.headers={...c,...u,...t.headers},{url:Ee(n),options:l}},getSubtitle:async(e,t,s,n,r,l,c,d,u,f,g,y,x={})=>{Le("getSubtitle","routeItemId",e),Le("getSubtitle","routeMediaSourceId",t),Le("getSubtitle","routeIndex",s),Le("getSubtitle","routeFormat",n);const S="/Videos/{routeItemId}/{routeMediaSourceId}/Subtitles/{routeIndex}/Stream.{routeFormat}".replace("{routeItemId}",encodeURIComponent(String(e))).replace("{routeMediaSourceId}",encodeURIComponent(String(t))).replace("{routeIndex}",encodeURIComponent(String(s))).replace("{routeFormat}",encodeURIComponent(String(n))),E=new URL(S,be);let T;i&&(T=i.baseOptions);const A={method:"GET",...T,...x},I={},_={};r!==void 0&&(_.itemId=r),l!==void 0&&(_.mediaSourceId=l),c!==void 0&&(_.index=c),d!==void 0&&(_.format=d),u!==void 0&&(_.endPositionTicks=u),f!==void 0&&(_.copyTimestamps=f),g!==void 0&&(_.addVttTimeMap=g),y!==void 0&&(_.startPositionTicks=y),Te(E,_);let C=T&&T.headers?T.headers:{};return A.headers={...I,...C,...x.headers},{url:Ee(E),options:A}},getSubtitlePlaylist:async(e,t,s,n,r={})=>{Le("getSubtitlePlaylist","itemId",e),Le("getSubtitlePlaylist","index",t),Le("getSubtitlePlaylist","mediaSourceId",s),Le("getSubtitlePlaylist","segmentLength",n);const l="/Videos/{itemId}/{mediaSourceId}/Subtitles/{index}/subtitles.m3u8".replace("{itemId}",encodeURIComponent(String(e))).replace("{index}",encodeURIComponent(String(t))).replace("{mediaSourceId}",encodeURIComponent(String(s))),c=new URL(l,be);let d;i&&(d=i.baseOptions);const u={method:"GET",...d,...r},f={},g={};await Re(f,"Authorization",i),n!==void 0&&(g.segmentLength=n),Te(c,g);let y=d&&d.headers?d.headers:{};return u.headers={...f,...y,...r.headers},{url:Ee(c),options:u}},getSubtitleWithTicks:async(e,t,s,n,r,l,c,d,u,f,g,y,x,S={})=>{Le("getSubtitleWithTicks","routeItemId",e),Le("getSubtitleWithTicks","routeMediaSourceId",t),Le("getSubtitleWithTicks","routeIndex",s),Le("getSubtitleWithTicks","routeStartPositionTicks",n),Le("getSubtitleWithTicks","routeFormat",r);const E="/Videos/{routeItemId}/{routeMediaSourceId}/Subtitles/{routeIndex}/{routeStartPositionTicks}/Stream.{routeFormat}".replace("{routeItemId}",encodeURIComponent(String(e))).replace("{routeMediaSourceId}",encodeURIComponent(String(t))).replace("{routeIndex}",encodeURIComponent(String(s))).replace("{routeStartPositionTicks}",encodeURIComponent(String(n))).replace("{routeFormat}",encodeURIComponent(String(r))),T=new URL(E,be);let A;i&&(A=i.baseOptions);const I={method:"GET",...A,...S},_={},C={};l!==void 0&&(C.itemId=l),c!==void 0&&(C.mediaSourceId=c),d!==void 0&&(C.index=d),u!==void 0&&(C.startPositionTicks=u),f!==void 0&&(C.format=f),g!==void 0&&(C.endPositionTicks=g),y!==void 0&&(C.copyTimestamps=y),x!==void 0&&(C.addVttTimeMap=x),Te(T,C);let k=A&&A.headers?A.headers:{};return I.headers={..._,...k,...S.headers},{url:Ee(T),options:I}},searchRemoteSubtitles:async(e,t,s,n={})=>{Le("searchRemoteSubtitles","itemId",e),Le("searchRemoteSubtitles","language",t);const r="/Items/{itemId}/RemoteSearch/Subtitles/{language}".replace("{itemId}",encodeURIComponent(String(e))).replace("{language}",encodeURIComponent(String(t))),l=new URL(r,be);let c;i&&(c=i.baseOptions);const d={method:"GET",...c,...n},u={},f={};await Re(u,"Authorization",i),s!==void 0&&(f.isPerfectMatch=s),Te(l,f);let g=c&&c.headers?c.headers:{};return d.headers={...u,...g,...n.headers},{url:Ee(l),options:d}},uploadSubtitle:async(e,t,s={})=>{Le("uploadSubtitle","itemId",e),Le("uploadSubtitle","uploadSubtitleDto",t);const n="/Videos/{itemId}/Subtitles".replace("{itemId}",encodeURIComponent(String(e))),r=new URL(n,be);let l;i&&(l=i.baseOptions);const c={method:"POST",...l,...s},d={},u={};await Re(d,"Authorization",i),d["Content-Type"]="application/json",Te(r,u);let f=l&&l.headers?l.headers:{};return c.headers={...d,...f,...s.headers},c.data=Ts(t,c,i),{url:Ee(r),options:c}}}},cn=function(i){const e=HL(i);return{async deleteSubtitle(t,s,n){var r,l,c;const d=await e.deleteSubtitle(t,s,n),u=(r=i?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=Se["SubtitleApi.deleteSubtitle"])===null||l===void 0?void 0:l[u])===null||c===void 0?void 0:c.url;return(g,y)=>Ae(d,ce,ve,i)(g,f||y)},async downloadRemoteSubtitles(t,s,n){var r,l,c;const d=await e.downloadRemoteSubtitles(t,s,n),u=(r=i?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=Se["SubtitleApi.downloadRemoteSubtitles"])===null||l===void 0?void 0:l[u])===null||c===void 0?void 0:c.url;return(g,y)=>Ae(d,ce,ve,i)(g,f||y)},async getFallbackFont(t,s){var n,r,l;const c=await e.getFallbackFont(t,s),d=(n=i?.serverIndex)!==null&&n!==void 0?n:0,u=(l=(r=Se["SubtitleApi.getFallbackFont"])===null||r===void 0?void 0:r[d])===null||l===void 0?void 0:l.url;return(f,g)=>Ae(c,ce,ve,i)(f,u||g)},async getFallbackFontList(t){var s,n,r;const l=await e.getFallbackFontList(t),c=(s=i?.serverIndex)!==null&&s!==void 0?s:0,d=(r=(n=Se["SubtitleApi.getFallbackFontList"])===null||n===void 0?void 0:n[c])===null||r===void 0?void 0:r.url;return(u,f)=>Ae(l,ce,ve,i)(u,d||f)},async getRemoteSubtitles(t,s){var n,r,l;const c=await e.getRemoteSubtitles(t,s),d=(n=i?.serverIndex)!==null&&n!==void 0?n:0,u=(l=(r=Se["SubtitleApi.getRemoteSubtitles"])===null||r===void 0?void 0:r[d])===null||l===void 0?void 0:l.url;return(f,g)=>Ae(c,ce,ve,i)(f,u||g)},async getSubtitle(t,s,n,r,l,c,d,u,f,g,y,x,S){var E,T,A;const I=await e.getSubtitle(t,s,n,r,l,c,d,u,f,g,y,x,S),_=(E=i?.serverIndex)!==null&&E!==void 0?E:0,C=(A=(T=Se["SubtitleApi.getSubtitle"])===null||T===void 0?void 0:T[_])===null||A===void 0?void 0:A.url;return(k,D)=>Ae(I,ce,ve,i)(k,C||D)},async getSubtitlePlaylist(t,s,n,r,l){var c,d,u;const f=await e.getSubtitlePlaylist(t,s,n,r,l),g=(c=i?.serverIndex)!==null&&c!==void 0?c:0,y=(u=(d=Se["SubtitleApi.getSubtitlePlaylist"])===null||d===void 0?void 0:d[g])===null||u===void 0?void 0:u.url;return(x,S)=>Ae(f,ce,ve,i)(x,y||S)},async getSubtitleWithTicks(t,s,n,r,l,c,d,u,f,g,y,x,S,E){var T,A,I;const _=await e.getSubtitleWithTicks(t,s,n,r,l,c,d,u,f,g,y,x,S,E),C=(T=i?.serverIndex)!==null&&T!==void 0?T:0,k=(I=(A=Se["SubtitleApi.getSubtitleWithTicks"])===null||A===void 0?void 0:A[C])===null||I===void 0?void 0:I.url;return(D,O)=>Ae(_,ce,ve,i)(D,k||O)},async searchRemoteSubtitles(t,s,n,r){var l,c,d;const u=await e.searchRemoteSubtitles(t,s,n,r),f=(l=i?.serverIndex)!==null&&l!==void 0?l:0,g=(d=(c=Se["SubtitleApi.searchRemoteSubtitles"])===null||c===void 0?void 0:c[f])===null||d===void 0?void 0:d.url;return(y,x)=>Ae(u,ce,ve,i)(y,g||x)},async uploadSubtitle(t,s,n){var r,l,c;const d=await e.uploadSubtitle(t,s,n),u=(r=i?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=Se["SubtitleApi.uploadSubtitle"])===null||l===void 0?void 0:l[u])===null||c===void 0?void 0:c.url;return(g,y)=>Ae(d,ce,ve,i)(g,f||y)}}};class zL extends vn{deleteSubtitle(e,t){return cn(this.configuration).deleteSubtitle(e.itemId,e.index,t).then(s=>s(this.axios,this.basePath))}downloadRemoteSubtitles(e,t){return cn(this.configuration).downloadRemoteSubtitles(e.itemId,e.subtitleId,t).then(s=>s(this.axios,this.basePath))}getFallbackFont(e,t){return cn(this.configuration).getFallbackFont(e.name,t).then(s=>s(this.axios,this.basePath))}getFallbackFontList(e){return cn(this.configuration).getFallbackFontList(e).then(t=>t(this.axios,this.basePath))}getRemoteSubtitles(e,t){return cn(this.configuration).getRemoteSubtitles(e.subtitleId,t).then(s=>s(this.axios,this.basePath))}getSubtitle(e,t){return cn(this.configuration).getSubtitle(e.routeItemId,e.routeMediaSourceId,e.routeIndex,e.routeFormat,e.itemId,e.mediaSourceId,e.index,e.format,e.endPositionTicks,e.copyTimestamps,e.addVttTimeMap,e.startPositionTicks,t).then(s=>s(this.axios,this.basePath))}getSubtitlePlaylist(e,t){return cn(this.configuration).getSubtitlePlaylist(e.itemId,e.index,e.mediaSourceId,e.segmentLength,t).then(s=>s(this.axios,this.basePath))}getSubtitleWithTicks(e,t){return cn(this.configuration).getSubtitleWithTicks(e.routeItemId,e.routeMediaSourceId,e.routeIndex,e.routeStartPositionTicks,e.routeFormat,e.itemId,e.mediaSourceId,e.index,e.startPositionTicks,e.format,e.endPositionTicks,e.copyTimestamps,e.addVttTimeMap,t).then(s=>s(this.axios,this.basePath))}searchRemoteSubtitles(e,t){return cn(this.configuration).searchRemoteSubtitles(e.itemId,e.language,e.isPerfectMatch,t).then(s=>s(this.axios,this.basePath))}uploadSubtitle(e,t){return cn(this.configuration).uploadSubtitle(e.itemId,e.uploadSubtitleDto,t).then(s=>s(this.axios,this.basePath))}}const KL=function(i){return{markPlayedItem:async(e,t,s,n={})=>{Le("markPlayedItem","itemId",e);const r="/UserPlayedItems/{itemId}".replace("{itemId}",encodeURIComponent(String(e))),l=new URL(r,be);let c;i&&(c=i.baseOptions);const d={method:"POST",...c,...n},u={},f={};await Re(u,"Authorization",i),t!==void 0&&(f.userId=t),s!==void 0&&(f.datePlayed=s instanceof Date?s.toISOString():s),Te(l,f);let g=c&&c.headers?c.headers:{};return d.headers={...u,...g,...n.headers},{url:Ee(l),options:d}},markUnplayedItem:async(e,t,s={})=>{Le("markUnplayedItem","itemId",e);const n="/UserPlayedItems/{itemId}".replace("{itemId}",encodeURIComponent(String(e))),r=new URL(n,be);let l;i&&(l=i.baseOptions);const c={method:"DELETE",...l,...s},d={},u={};await Re(d,"Authorization",i),t!==void 0&&(u.userId=t),Te(r,u);let f=l&&l.headers?l.headers:{};return c.headers={...d,...f,...s.headers},{url:Ee(r),options:c}},onPlaybackProgress:async(e,t,s,n,r,l,c,d,u,f,g,y,x={})=>{Le("onPlaybackProgress","itemId",e);const S="/PlayingItems/{itemId}/Progress".replace("{itemId}",encodeURIComponent(String(e))),E=new URL(S,be);let T;i&&(T=i.baseOptions);const A={method:"POST",...T,...x},I={},_={};await Re(I,"Authorization",i),t!==void 0&&(_.mediaSourceId=t),s!==void 0&&(_.positionTicks=s),n!==void 0&&(_.audioStreamIndex=n),r!==void 0&&(_.subtitleStreamIndex=r),l!==void 0&&(_.volumeLevel=l),c!==void 0&&(_.playMethod=c),d!==void 0&&(_.liveStreamId=d),u!==void 0&&(_.playSessionId=u),f!==void 0&&(_.repeatMode=f),g!==void 0&&(_.isPaused=g),y!==void 0&&(_.isMuted=y),Te(E,_);let C=T&&T.headers?T.headers:{};return A.headers={...I,...C,...x.headers},{url:Ee(E),options:A}},onPlaybackStart:async(e,t,s,n,r,l,c,d,u={})=>{Le("onPlaybackStart","itemId",e);const f="/PlayingItems/{itemId}".replace("{itemId}",encodeURIComponent(String(e))),g=new URL(f,be);let y;i&&(y=i.baseOptions);const x={method:"POST",...y,...u},S={},E={};await Re(S,"Authorization",i),t!==void 0&&(E.mediaSourceId=t),s!==void 0&&(E.audioStreamIndex=s),n!==void 0&&(E.subtitleStreamIndex=n),r!==void 0&&(E.playMethod=r),l!==void 0&&(E.liveStreamId=l),c!==void 0&&(E.playSessionId=c),d!==void 0&&(E.canSeek=d),Te(g,E);let T=y&&y.headers?y.headers:{};return x.headers={...S,...T,...u.headers},{url:Ee(g),options:x}},onPlaybackStopped:async(e,t,s,n,r,l,c={})=>{Le("onPlaybackStopped","itemId",e);const d="/PlayingItems/{itemId}".replace("{itemId}",encodeURIComponent(String(e))),u=new URL(d,be);let f;i&&(f=i.baseOptions);const g={method:"DELETE",...f,...c},y={},x={};await Re(y,"Authorization",i),t!==void 0&&(x.mediaSourceId=t),s!==void 0&&(x.nextMediaType=s),n!==void 0&&(x.positionTicks=n),r!==void 0&&(x.liveStreamId=r),l!==void 0&&(x.playSessionId=l),Te(u,x);let S=f&&f.headers?f.headers:{};return g.headers={...y,...S,...c.headers},{url:Ee(u),options:g}},pingPlaybackSession:async(e,t={})=>{Le("pingPlaybackSession","playSessionId",e);const s="/Sessions/Playing/Ping",n=new URL(s,be);let r;i&&(r=i.baseOptions);const l={method:"POST",...r,...t},c={},d={};await Re(c,"Authorization",i),e!==void 0&&(d.playSessionId=e),Te(n,d);let u=r&&r.headers?r.headers:{};return l.headers={...c,...u,...t.headers},{url:Ee(n),options:l}},reportPlaybackProgress:async(e,t={})=>{const s="/Sessions/Playing/Progress",n=new URL(s,be);let r;i&&(r=i.baseOptions);const l={method:"POST",...r,...t},c={},d={};await Re(c,"Authorization",i),c["Content-Type"]="application/json",Te(n,d);let u=r&&r.headers?r.headers:{};return l.headers={...c,...u,...t.headers},l.data=Ts(e,l,i),{url:Ee(n),options:l}},reportPlaybackStart:async(e,t={})=>{const s="/Sessions/Playing",n=new URL(s,be);let r;i&&(r=i.baseOptions);const l={method:"POST",...r,...t},c={},d={};await Re(c,"Authorization",i),c["Content-Type"]="application/json",Te(n,d);let u=r&&r.headers?r.headers:{};return l.headers={...c,...u,...t.headers},l.data=Ts(e,l,i),{url:Ee(n),options:l}},reportPlaybackStopped:async(e,t={})=>{const s="/Sessions/Playing/Stopped",n=new URL(s,be);let r;i&&(r=i.baseOptions);const l={method:"POST",...r,...t},c={},d={};await Re(c,"Authorization",i),c["Content-Type"]="application/json",Te(n,d);let u=r&&r.headers?r.headers:{};return l.headers={...c,...u,...t.headers},l.data=Ts(e,l,i),{url:Ee(n),options:l}}}},jn=function(i){const e=KL(i);return{async markPlayedItem(t,s,n,r){var l,c,d;const u=await e.markPlayedItem(t,s,n,r),f=(l=i?.serverIndex)!==null&&l!==void 0?l:0,g=(d=(c=Se["PlaystateApi.markPlayedItem"])===null||c===void 0?void 0:c[f])===null||d===void 0?void 0:d.url;return(y,x)=>Ae(u,ce,ve,i)(y,g||x)},async markUnplayedItem(t,s,n){var r,l,c;const d=await e.markUnplayedItem(t,s,n),u=(r=i?.serverIndex)!==null&&r!==void 0?r:0,f=(c=(l=Se["PlaystateApi.markUnplayedItem"])===null||l===void 0?void 0:l[u])===null||c===void 0?void 0:c.url;return(g,y)=>Ae(d,ce,ve,i)(g,f||y)},async onPlaybackProgress(t,s,n,r,l,c,d,u,f,g,y,x,S){var E,T,A;const I=await e.onPlaybackProgress(t,s,n,r,l,c,d,u,f,g,y,x,S),_=(E=i?.serverIndex)!==null&&E!==void 0?E:0,C=(A=(T=Se["PlaystateApi.onPlaybackProgress"])===null||T===void 0?void 0:T[_])===null||A===void 0?void 0:A.url;return(k,D)=>Ae(I,ce,ve,i)(k,C||D)},async onPlaybackStart(t,s,n,r,l,c,d,u,f){var g,y,x;const S=await e.onPlaybackStart(t,s,n,r,l,c,d,u,f),E=(g=i?.serverIndex)!==null&&g!==void 0?g:0,T=(x=(y=Se["PlaystateApi.onPlaybackStart"])===null||y===void 0?void 0:y[E])===null||x===void 0?void 0:x.url;return(A,I)=>Ae(S,ce,ve,i)(A,T||I)},async onPlaybackStopped(t,s,n,r,l,c,d){var u,f,g;const y=await e.onPlaybackStopped(t,s,n,r,l,c,d),x=(u=i?.serverIndex)!==null&&u!==void 0?u:0,S=(g=(f=Se["PlaystateApi.onPlaybackStopped"])===null||f===void 0?void 0:f[x])===null||g===void 0?void 0:g.url;return(E,T)=>Ae(y,ce,ve,i)(E,S||T)},async pingPlaybackSession(t,s){var n,r,l;const c=await e.pingPlaybackSession(t,s),d=(n=i?.serverIndex)!==null&&n!==void 0?n:0,u=(l=(r=Se["PlaystateApi.pingPlaybackSession"])===null||r===void 0?void 0:r[d])===null||l===void 0?void 0:l.url;return(f,g)=>Ae(c,ce,ve,i)(f,u||g)},async reportPlaybackProgress(t,s){var n,r,l;const c=await e.reportPlaybackProgress(t,s),d=(n=i?.serverIndex)!==null&&n!==void 0?n:0,u=(l=(r=Se["PlaystateApi.reportPlaybackProgress"])===null||r===void 0?void 0:r[d])===null||l===void 0?void 0:l.url;return(f,g)=>Ae(c,ce,ve,i)(f,u||g)},async reportPlaybackStart(t,s){var n,r,l;const c=await e.reportPlaybackStart(t,s),d=(n=i?.serverIndex)!==null&&n!==void 0?n:0,u=(l=(r=Se["PlaystateApi.reportPlaybackStart"])===null||r===void 0?void 0:r[d])===null||l===void 0?void 0:l.url;return(f,g)=>Ae(c,ce,ve,i)(f,u||g)},async reportPlaybackStopped(t,s){var n,r,l;const c=await e.reportPlaybackStopped(t,s),d=(n=i?.serverIndex)!==null&&n!==void 0?n:0,u=(l=(r=Se["PlaystateApi.reportPlaybackStopped"])===null||r===void 0?void 0:r[d])===null||l===void 0?void 0:l.url;return(f,g)=>Ae(c,ce,ve,i)(f,u||g)}}};class YL extends vn{markPlayedItem(e,t){return jn(this.configuration).markPlayedItem(e.itemId,e.userId,e.datePlayed,t).then(s=>s(this.axios,this.basePath))}markUnplayedItem(e,t){return jn(this.configuration).markUnplayedItem(e.itemId,e.userId,t).then(s=>s(this.axios,this.basePath))}onPlaybackProgress(e,t){return jn(this.configuration).onPlaybackProgress(e.itemId,e.mediaSourceId,e.positionTicks,e.audioStreamIndex,e.subtitleStreamIndex,e.volumeLevel,e.playMethod,e.liveStreamId,e.playSessionId,e.repeatMode,e.isPaused,e.isMuted,t).then(s=>s(this.axios,this.basePath))}onPlaybackStart(e,t){return jn(this.configuration).onPlaybackStart(e.itemId,e.mediaSourceId,e.audioStreamIndex,e.subtitleStreamIndex,e.playMethod,e.liveStreamId,e.playSessionId,e.canSeek,t).then(s=>s(this.axios,this.basePath))}onPlaybackStopped(e,t){return jn(this.configuration).onPlaybackStopped(e.itemId,e.mediaSourceId,e.nextMediaType,e.positionTicks,e.liveStreamId,e.playSessionId,t).then(s=>s(this.axios,this.basePath))}pingPlaybackSession(e,t){return jn(this.configuration).pingPlaybackSession(e.playSessionId,t).then(s=>s(this.axios,this.basePath))}reportPlaybackProgress(e={},t){return jn(this.configuration).reportPlaybackProgress(e.playbackProgressInfo,t).then(s=>s(this.axios,this.basePath))}reportPlaybackStart(e={},t){return jn(this.configuration).reportPlaybackStart(e.playbackStartInfo,t).then(s=>s(this.axios,this.basePath))}reportPlaybackStopped(e={},t){return jn(this.configuration).reportPlaybackStopped(e.playbackStopInfo,t).then(s=>s(this.axios,this.basePath))}}class qL{constructor(){this.jellyfin=new OL({clientInfo:{name:"LegitFlix Client",version:"1.0.0.18"},deviceInfo:{name:"LegitFlix Web",id:"legitflix-web"}}),this.api=null}initialize(e=null,t=null){const s=t!==null?t:this.api?.basePath||window.location.origin;this.api=this.jellyfin.createApi(s,e),this.api.user=new BS(this.api.configuration),this.api.userLibrary=new PL(this.api.configuration),this.api.userViews=new ML(this.api.configuration),this.api.items=new FL(this.api.configuration),this.api.tvShows=new VL(this.api.configuration),this.api.library=new GL(this.api.configuration),this.api.subtitle=new zL(this.api.configuration),this.api.playstate=new YL(this.api.configuration),console.log("[LegitFlix] API Initialized. Access Token present:",!!e)}async getCurrentUser(){if(window.ApiClient)try{return await window.ApiClient.getCurrentUser()}catch(t){console.warn("Failed to get current user from window.ApiClient",t)}const e=localStorage.getItem("jellyfin_credentials");if(e)try{const t=JSON.parse(e);if(t.Servers&&t.Servers.length>0){const s=t.Servers.find(n=>n.AccessToken&&n.UserId);if(s){(!this.api||this.api.accessToken!==s.AccessToken)&&(console.log("[LegitFlix] Initializing API with stored token"),this.initialize(s.AccessToken));try{return(await this.api.user.getUserById({userId:s.UserId})).data}catch(n){return console.error("[LegitFlix] Token invalid or user not found. Clearing credentials.",n),this.logout(),null}}}}catch(t){console.error("[LegitFlix] Failed to parse jellyfin_credentials",t)}return null}async validateServer(e){const t=e.replace(/\/$/,""),s=new AbortController,n=setTimeout(()=>s.abort(),5e3);try{const r=await fetch(`${t}/System/Info/Public`,{signal:s.signal});if(clearTimeout(n),r.ok)return{valid:!0,data:await r.json(),baseUrl:t}}catch(r){clearTimeout(n),console.error("Server validation failed",r)}return{valid:!1}}async getPublicUsers(){return this.api||this.initialize(),(await this.api.user.getPublicUsers()).data}async authenticateUser(e,t){this.api||this.initialize();try{const n=(await this.api.user.authenticateUserByName({authenticateUserByName:{Username:e,Pw:t}})).data;if(n.AccessToken&&n.User){this.initialize(n.AccessToken);const r={Servers:[{DateLastAccessed:new Date().toISOString(),AccessToken:n.AccessToken,UserId:n.User.Id,Name:n.User.Name,ManualAddress:this.api.basePath}]};return localStorage.setItem("jellyfin_credentials",JSON.stringify(r)),n.User}}catch(s){throw console.error("Authentication failed",s),s}return null}async getItem(e,t){return this.api||this.initialize(),(await this.api.userLibrary.getItem({userId:e,itemId:t})).data}async getSimilarItems(e,t){return this.api||this.initialize(),(await this.api.library.getSimilarItems({userId:e,itemId:t,limit:12})).data}async getItems(e,t){return this.api||this.initialize(),(await this.api.items.getItems({userId:e,...t})).data}async markPlayed(e,t,s){this.api||this.initialize();const n=s?"POST":"DELETE",l=`${this.api.basePath||""}/Users/${e}/PlayedItems/${t}`;try{const c=this.api.accessToken,d={"Content-Type":"application/json"};c&&(d["X-Emby-Authorization"]=`MediaBrowser Client="${this.jellyfin.clientInfo.name}", Device="${this.jellyfin.deviceInfo.name}", DeviceId="${this.jellyfin.deviceInfo.id}", Version="${this.jellyfin.clientInfo.version}", Token="${c}"`);const u=await fetch(l,{method:n,headers:d});if(!u.ok)throw new Error(`Failed to mark played/unplayed: ${u.status} ${u.statusText}`);return await u.json()}catch(c){throw console.error("markPlayed failed",c),c}}async markFavorite(e,t,s){return this.api||this.initialize(),s?await this.api.userLibrary.markFavoriteItem({userId:e,itemId:t}):await this.api.userLibrary.unmarkFavoriteItem({userId:e,itemId:t})}async getSeasons(e,t){return this.api||this.initialize(),(await this.api.tvShows.getSeasons({userId:e,seriesId:t})).data}async getEpisodes(e,t,s){return this.api||this.initialize(),(await this.api.tvShows.getEpisodes({userId:e,seriesId:t,seasonId:s,fields:["MediaSources","RunTimeTicks","UserData","Overview","Path"]})).data}async getNextUp(e,t){return this.api||this.initialize(),(await this.api.tvShows.getNextUp({userId:e,seriesId:t,limit:1})).data}async getUserViews(e){return this.api||this.initialize(),(await this.api.userViews.getUserViews({userId:e})).data}async getSeries(e,t){this.api||this.initialize();const s=["Overview","Genres","Studios","OfficialRating","CommunityRating","ImageTags","BackdropImageTags","People","RemoteTrailers","LocalTrailers","ChildCount","MediaSources"];return(await this.api.userLibrary.getItem({userId:e,itemId:t,fields:s})).data}async getResumeItems(e,t=12){return this.api||this.initialize(),await this.getItems(e,{filters:["IsResumable"],sortBy:["DatePlayed"],sortOrder:["Descending"],limit:t,recursive:!0,includeItemTypes:["Movie","Episode"]})}async getHistoryItems(e,t=12){return this.api||this.initialize(),await this.getItems(e,{sortBy:["DatePlayed"],sortOrder:["Descending"],limit:t,recursive:!0,filters:["IsPlayed"],includeItemTypes:["Movie","Episode"],fields:["PrimaryImageAspectRatio","Overview","ImageTags","ProductionYear","RunTimeTicks"]})}async getItemDetails(e,t){this.api||this.initialize();try{const s=["RemoteTrailers","LocalTrailers","People","Studios","Genres","Overview","ProductionYear","OfficialRating","RunTimeTicks","Tags","ImageTags","MediaStreams","UserData","MediaSources","Trickplay","Chapters","Width","Height"];return(await this.api.userLibrary.getItem({userId:e,itemId:t,fields:s})).data}catch(s){return console.error("getItemDetails failed",s),null}}async getLatestItems(e,t){this.api||this.initialize();try{return(await this.api.items.getItems({userId:e,parentId:t,sortBy:["DateCreated"],sortOrder:["Descending"],includeItemTypes:["Movie","Series"],recursive:!0,fields:["PrimaryImageAspectRatio","Overview","ImageTags","ProductionYear","RunTimeTicks"]})).data}catch(s){return console.error("getLatestItems failed",s),{Items:[]}}}getImageUrl(e,t="Primary",s={}){if(!e||!e.Id)return"";const{maxWidth:n=800,quality:r=90}=s;this.api||this.initialize();const l=this.api.configuration.basePath||"",c=e.ImageTags&&e.ImageTags[t]?`&tag=${e.ImageTags[t]}`:"";return`${l}/Items/${e.Id}/Images/${t}?maxWidth=${n}&quality=${r}${c}`}getPlaybackUrl(e){return`#/play/${e}`}getStreamUrl(e,t=null,s=null,n=null,r=null){this.api||this.initialize();const l=this.api.accessToken,c=this.jellyfin.deviceInfo.id;let u=`${this.api.configuration.basePath}/Videos/${e}/master.m3u8?PlaySessionId=LegitFlix-${Date.now()}&api_key=${l}&DeviceId=${c}&VideoCodec=h264,hevc,vp9,av1&AudioCodec=aac,mp3,opus,vorbis&TranscodingContainer=ts&TranscodingProtocol=hls`;return n&&(u+=`&MediaSourceId=${n}`),t!==null&&(u+=`&AudioStreamIndex=${t}`),s!==null&&(u+=`&SubtitleStreamIndex=${s}`),r&&(u+=`&VideoBitrate=${r}`),u}async reportPlaybackProgress(e,t,s,n){this.api||this.initialize();try{await this.api.playstate.reportPlaybackProgress({playbackProgressInfo:{ItemId:e,MediaSourceId:n||e,PositionTicks:t,IsPaused:s,EventName:"TimeUpdate"}})}catch(r){console.warn("Report progress failed (silent)",r)}}async reportPlaybackStopped(e,t){this.api||this.initialize();try{await this.api.playstate.reportPlaybackStopped({playbackStopInfo:{ItemId:e,PositionTicks:t}})}catch(s){console.warn("Report stop failed (silent)",s)}}async getTrickplayManifest(e){this.api||this.initialize();const t=this.api.configuration.basePath||"",n=`MediaBrowser Client="LegitFlix Client", Device="LegitFlix Web", DeviceId="legitflix-web", Version="1.0.0.18", Token="${this.api.accessToken}"`;try{const r=`${t}/Videos/${e}/Trickplay`;console.log("[Trickplay] Fetching manifest:",r);const l=await fetch(r,{headers:{Authorization:n}});if(!l.ok)return console.warn("[Trickplay] Manifest fetch failed:",l.status,l.statusText),null;const c=await l.json();return console.log("[Trickplay] Manifest data:",JSON.stringify(c).substring(0,500)),c}catch(r){return console.warn("Failed to fetch trickplay manifest",r),null}}getSubtitleUrl(e,t,s){this.api||this.initialize();const n=this.api.configuration.basePath||"",r=this.api.accessToken;return`${n}/Videos/${e}/${t}/Subtitles/${s}/0/Stream.vtt?api_key=${r}`}getRawSubtitleUrl(e,t,s,n){this.api||this.initialize();const r=this.api.configuration.basePath||"",l=this.api.accessToken;return`${r}/Videos/${e}/${t}/Subtitles/${s}/0/Stream.${n}?api_key=${l}`}getTrickplayTileUrl(e,t,s){this.api||this.initialize();const n=this.api.configuration.basePath||"",r=this.api.accessToken;return`${n}/Videos/${e}/Trickplay/${t}/${s}.jpg?api_key=${r}`}async deleteSubtitle(e,t){this.api||this.initialize();try{return(await this.api.subtitle.deleteSubtitle({itemId:e,index:t})).data}catch(s){throw console.error("Failed to delete subtitle",s),s}}async searchRemoteSubtitles(e,t){this.api||this.initialize();try{return(await this.api.subtitle.searchRemoteSubtitles({itemId:e,language:t,isPerfectMatch:!1})).data}catch(s){return console.error("Failed to search subtitles",s),[]}}async downloadRemoteSubtitles(e,t){this.api||this.initialize();try{return(await this.api.subtitle.downloadRemoteSubtitles({itemId:e,subtitleId:t})).data}catch(s){throw console.error("Failed to download subtitle",s),s}}async getMediaStreams(e,t){this.api||this.initialize();const s=await this.getItemDetails(e,t);return s&&s.MediaSources&&s.MediaSources[0]?s.MediaSources[0].MediaStreams||[]:[]}async updatePassword(e,t,s){this.api||this.initialize();const n=await fetch(`${this.api.basePath}/Users/${e}/Password`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`MediaBrowser Token="${this.api.accessToken}"`},body:JSON.stringify({CurrentPw:t,NewPw:s})});if(!n.ok){const r=await n.text();throw new Error(r||"Failed to update password")}return!0}async updateUserConfiguration(e,t){if(this.api||this.initialize(),!(await fetch(`${this.api.basePath}/Users/${e}/Configuration`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`MediaBrowser Token="${this.api.accessToken}"`},body:JSON.stringify(t)})).ok)throw new Error("Failed to update user configuration");return!0}async getAllBackdrops(e,t=50){return this.api||this.initialize(),(await this.api.items.getItems({userId:e,includeItemTypes:["Movie","Series"],imageTypes:["Backdrop"],sortBy:["Random"],limit:t,recursive:!0,fields:["BackdropImageTags"]})).data?.Items||[]}async getUserViews(e){return this.api||this.initialize(),(await this.api.userViews.getUserViews({userId:e})).data}async searchItems(e,t,s=[],n=null){this.api||this.initialize();const r={searchTerm:t,recursive:!0,fields:["PrimaryImageAspectRatio","ProductionYear","DateCreated"],includeItemTypes:s,limit:20};return n&&n!=="All"&&(r.parentId=n),await this.getItems(e,r)}async quickConnect(e){if(this.api||this.initialize(),!(await fetch(`${this.api.basePath}/QuickConnect/Authorize?Code=${e}`,{method:"POST",headers:{Authorization:`MediaBrowser Token="${this.api.accessToken}"`}})).ok)throw new Error("Quick Connect failed. Check the code.");return!0}async initiateQuickConnect(){this.api||this.initialize();const e={"X-Emby-Authorization":`MediaBrowser Client="${this.jellyfin.clientInfo.name}", Device="${this.jellyfin.deviceInfo.name}", DeviceId="${this.jellyfin.deviceInfo.id}", Version="${this.jellyfin.clientInfo.version}"`},t=await fetch(`${this.api.basePath||""}/QuickConnect/Initiate`,{method:"POST",headers:e});if(!t.ok)throw new Error("Failed to initiate Quick Connect");return t.json()}async checkQuickConnectStatus(e){this.api||this.initialize();const t=await fetch(`${this.api.basePath||""}/QuickConnect/Connect?Secret=${e}`,{method:"GET"});if(t.status===200){const s=await t.json();if(s.Authenticated){this.initialize(s.AccessToken);const n=await this.api.user.getUserById({userId:s.UserId}),r={Servers:[{DateLastAccessed:new Date().toISOString(),AccessToken:s.AccessToken,UserId:n.data.Id,Name:n.data.Name,ManualAddress:this.api.basePath}]};return localStorage.setItem("jellyfin_credentials",JSON.stringify(r)),n.data}}return null}async logout(){if(console.log("[LegitFlix] Logging out..."),window.ApiClient)try{await window.ApiClient.logout()}catch(e){console.warn("ApiClient logout failed",e)}localStorage.removeItem("jellyfin_credentials"),this.api=null,window.location.href="/#/login/select-user"}async uploadUserImage(e,t,s){this.api||this.initialize();const n=this.api.accessToken;if(!n)throw new Error("No access token available for upload");const r=`MediaBrowser Client="${this.jellyfin.clientInfo.name}", Device="${this.jellyfin.deviceInfo.name}", DeviceId="${this.jellyfin.deviceInfo.id}", Version="${this.jellyfin.clientInfo.version}", Token="${n}"`,l=s.type||"image/png";console.log(`[LegitFlix] Uploading ${t} image. Size: ${s.size}, Type: ${l}`);const c=await fetch(`${this.api.basePath}/Users/${e}/Images/${t}`,{method:"POST",headers:{"Content-Type":l,"X-Emby-Authorization":r},body:s});if(!c.ok){const d=await c.text();throw console.error("Upload failed response:",d),new Error(`Failed to upload image: ${c.status} ${c.statusText}`)}return!0}async deleteUserImage(e,t){this.api||this.initialize();const s=this.api.accessToken;if(!s)throw new Error("No access token available for delete");const n=`MediaBrowser Client="${this.jellyfin.clientInfo.name}", Device="${this.jellyfin.deviceInfo.name}", DeviceId="${this.jellyfin.deviceInfo.id}", Version="${this.jellyfin.clientInfo.version}", Token="${s}"`,r=await fetch(`${this.api.basePath}/Users/${e}/Images/${t}`,{method:"DELETE",headers:{"X-Emby-Authorization":n}});if(!r.ok)throw new Error(`Failed to delete image: ${r.status} ${r.statusText}`);return!0}}const te=new qL,ze=({type:i="text",width:e,height:t,style:s={}})=>p.jsx("div",{className:`skeleton skeleton-${i}`,style:{width:e,height:t,...s}});function bv(i,e){if(typeof i=="function")return i(e);i!=null&&(i.current=e)}function QL(...i){return e=>{let t=!1;const s=i.map(n=>{const r=bv(n,e);return!t&&typeof r=="function"&&(t=!0),r});if(t)return()=>{for(let n=0;n<s.length;n++){const r=s[n];typeof r=="function"?r():bv(i[n],null)}}}}var WL=Symbol.for("react.lazy"),Eu=OA[" use ".trim().toString()];function XL(i){return typeof i=="object"&&i!==null&&"then"in i}function VS(i){return i!=null&&typeof i=="object"&&"$$typeof"in i&&i.$$typeof===WL&&"_payload"in i&&XL(i._payload)}function ZL(i){const e=e1(i),t=w.forwardRef((s,n)=>{let{children:r,...l}=s;VS(r)&&typeof Eu=="function"&&(r=Eu(r._payload));const c=w.Children.toArray(r),d=c.find(s1);if(d){const u=d.props.children,f=c.map(g=>g===d?w.Children.count(u)>1?w.Children.only(null):w.isValidElement(u)?u.props.children:null:g);return p.jsx(e,{...l,ref:n,children:w.isValidElement(u)?w.cloneElement(u,void 0,f):null})}return p.jsx(e,{...l,ref:n,children:r})});return t.displayName=`${i}.Slot`,t}var JL=ZL("Slot");function e1(i){const e=w.forwardRef((t,s)=>{let{children:n,...r}=t;if(VS(n)&&typeof Eu=="function"&&(n=Eu(n._payload)),w.isValidElement(n)){const l=n1(n),c=i1(r,n.props);return n.type!==w.Fragment&&(c.ref=s?QL(s,l):l),w.cloneElement(n,c)}return w.Children.count(n)>1?w.Children.only(null):null});return e.displayName=`${i}.SlotClone`,e}var t1=Symbol("radix.slottable");function s1(i){return w.isValidElement(i)&&typeof i.type=="function"&&"__radixId"in i.type&&i.type.__radixId===t1}function i1(i,e){const t={...e};for(const s in e){const n=i[s],r=e[s];/^on[A-Z]/.test(s)?n&&r?t[s]=(...c)=>{const d=r(...c);return n(...c),d}:n&&(t[s]=n):s==="style"?t[s]={...n,...r}:s==="className"&&(t[s]=[n,r].filter(Boolean).join(" "))}return{...i,...t}}function n1(i){let e=Object.getOwnPropertyDescriptor(i.props,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?i.ref:(e=Object.getOwnPropertyDescriptor(i,"ref")?.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?i.props.ref:i.props.ref||i.ref)}const Tv={default:"lf-btn--primary",primary:"lf-btn--primary",ringHover:"lf-btn--ring-hover",glass:"lf-btn--glass",outline:"lf-btn--outline",ghost:"lf-btn--ghost",destructive:"lf-btn--destructive"},a1={default:"",sm:"lf-btn--sm",lg:"lf-btn--lg",icon:"lf-btn--icon"},bi=w.forwardRef(({className:i="",variant:e="default",size:t="default",asChild:s=!1,...n},r)=>{const l=s?JL:"button",c=Tv[e]||Tv.default,d=a1[t]||"",u=["lf-btn",c,d,i].filter(Boolean).join(" ");return p.jsx(l,{className:u,ref:r,...n})});bi.displayName="Button";const r1=({onInfoClick:i})=>{const{config:e}=Wi();js();const[t,s]=w.useState([]),[n,r]=w.useState(0),[l,c]=w.useState(0),[d,u]=w.useState(!0),f=w.useRef(null),g=w.useRef(null);w.useEffect(()=>{(async()=>{try{const k=await te.getCurrentUser();if(!k){console.error("No user found for HeroCarousel. jellyfinService.api:",te.api),u(!1);return}console.log("[HeroCarousel] User found:",k.Name,k.Id);const D=e.contentSortMode||"latest",O={latest:{sortBy:"DateCreated",sortOrder:"Descending"},random:{sortBy:"Random",sortOrder:"Descending"},topRated:{sortBy:"CommunityRating",sortOrder:"Descending"}},{sortBy:F,sortOrder:j}=O[D]||O.latest,U={includeItemTypes:e.heroMediaTypes,recursive:!0,sortBy:F,sortOrder:j,limit:20,fields:["PrimaryImageAspectRatio","Overview","ProductionYear","OfficialRating","CommunityRating","RunTimeTicks","Genres","MediaStreams","UserData","ImageTags","BackdropImageTags"],imageTypeLimit:1,enableImageTypes:["Backdrop","Primary","Logo"]};let ee=((await te.getItems(k.Id,U)).Items||[]).filter(de=>de.BackdropImageTags&&de.BackdropImageTags.length>0);const re=ee.length>3?ee.slice(3,9):ee.slice(0,6);for(const de of re)if(de.Type==="Series")try{const M=await te.getNextUp(k.Id,de.Id);M.Items&&M.Items.length>0&&(de._nextUp=M.Items[0])}catch(M){console.warn("Failed to fetch Next Up",M)}s(re)}catch(k){console.error("HeroCarousel fetch error",k)}finally{u(!1)}})()},[e]);const y=()=>{s(C=>(C.length===0||r(k=>(k+1)%C.length),C)),c(C=>C+1)},x=C=>{r(C),c(k=>k+1),S()},S=()=>{f.current&&clearInterval(f.current),f.current=setInterval(y,8e3),g.current&&g.current.classList.remove("carousel-paused")};w.useEffect(()=>(t.length>0&&S(),()=>clearInterval(f.current)),[t]);const E=async(C,k)=>{C.stopPropagation(),C.currentTarget;const D=k.UserData?.IsFavorite,O={...k,UserData:{...k.UserData,IsFavorite:!D}};s(F=>F.map(j=>j.Id===k.Id?O:j));try{const F=await te.getCurrentUser();F&&await te.markFavorite(F.Id,k.Id,!D)}catch(F){console.error("Failed to toggle fav",F),s(j=>j.map(U=>U.Id===k.Id?k:U))}};if(d)return p.jsxs("div",{className:"hero-carousel-container",style:{height:"90vh",background:"#111",position:"relative"},children:[p.jsx(ze,{width:"100%",height:"100%"}),p.jsxs("div",{style:{position:"absolute",top:"42.5%",left:"4%",transform:"translateY(-50%)",width:"40%",maxWidth:"600px",display:"flex",flexDirection:"column",gap:"1.25rem"},children:[p.jsx(ze,{width:"70%",height:"60px",style:{marginBottom:"0"}}),p.jsx(ze,{width:"40%",height:"24px"}),p.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"8px",width:"100%"},children:[p.jsx(ze,{width:"100%",height:"18px"}),p.jsx(ze,{width:"95%",height:"18px"}),p.jsx(ze,{width:"60%",height:"18px"})]}),p.jsxs("div",{style:{display:"flex",gap:"12px",marginTop:"0.5rem"},children:[p.jsx(ze,{width:"160px",height:"46px",style:{borderRadius:"50px"}}),p.jsx(ze,{width:"42px",height:"42px",style:{borderRadius:"50%"}}),p.jsx(ze,{width:"42px",height:"42px",style:{borderRadius:"50%"}})]})]})]});if(t.length===0)return null;const T=C=>`${te.api.basePath}/Items/${C}/Images/Backdrop/0?maxHeight=1080&quality=96`,A=C=>`${te.api.basePath}/Items/${C}/Images/Logo?maxHeight=200&maxWidth=450&quality=90`,I=C=>{let k=new Set,D=new Set;C.MediaStreams&&C.MediaStreams.forEach(j=>{j.Type==="Audio"&&j.Language&&k.add(j.Language),j.Type==="Subtitle"&&j.Language&&D.add(j.Language)});const O=D.size>0,F=k.size>1;return O&&F?"Sub | Dub":O?"Sub":F?"Dub":""},_=C=>{if(C.RunTimeTicks&&C.Type!=="Series"){const k=C.RunTimeTicks/1e4,O=new Date(Date.now()+k).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1});return p.jsxs(p.Fragment,{children:[p.jsx("span",{className:"hero-meta-divider",children:""}),p.jsxs("span",{className:"hero-meta-text",children:["Ends at ",O]})]})}return null};return p.jsxs("div",{id:"legit-hero-carousel",className:"hero-carousel-container",ref:g,children:[t.map((C,k)=>{const D=k===n,O=I(C),F=_(C),j=C.ImageTags&&C.ImageTags.Logo;let U="START WATCHING",K="";if(C.Type==="Series")if(C._nextUp){const ee=C._nextUp.ParentIndexNumber,re=C._nextUp.IndexNumber;U="CONTINUE",K=`S${ee} E${re}`}else K="S1 E1";else if(C.UserData&&C.UserData.PlaybackPositionTicks>0){const ee=Math.round(C.UserData.PlaybackPositionTicks/C.RunTimeTicks*100);ee>2&&ee<90&&(U="CONTINUE",K=` - ${ee}%`)}const H=C.UserData?.IsFavorite;return p.jsxs("div",{className:`hero-slide ${D?"active":""}`,"data-index":k,children:[p.jsx("div",{className:"hero-backdrop",style:{backgroundImage:`url('${T(C.Id)}')`}}),p.jsx("div",{className:"hero-overlay"}),p.jsxs("div",{className:"hero-content",children:[j?p.jsx("img",{src:A(C.Id),className:"hero-logo",alt:C.Name}):p.jsx("h1",{className:"hero-title",children:C.Name}),p.jsxs("div",{className:"hero-meta-line",children:[p.jsx("span",{className:"hero-badge-age",children:C.OfficialRating||"13+"}),O&&p.jsxs(p.Fragment,{children:[p.jsx("span",{className:"hero-meta-divider",children:""}),p.jsx("span",{className:"hero-meta-text",children:O})]}),p.jsx("span",{className:"hero-meta-divider",children:""}),p.jsx("span",{className:"hero-meta-text",children:C.Genres?C.Genres.slice(0,3).join(", "):"Anime"}),C.CommunityRating&&p.jsxs(p.Fragment,{children:[p.jsx("span",{className:"hero-meta-divider",children:""}),p.jsxs("span",{className:"hero-meta-text",children:[" ",C.CommunityRating.toFixed(1)]})]}),F]}),p.jsx("p",{className:"hero-desc",children:C.Overview}),p.jsxs("div",{className:"hero-actions flex gap-3 items-center",children:[p.jsxs(bi,{variant:"ringHover",onClick:ee=>{ee.stopPropagation(),window.location.href=`/web/index.html?classic=true#!/playback?id=${C.Id}`},children:[p.jsx("i",{className:"material-icons",children:"play_arrow"}),p.jsxs("span",{children:[U," ",p.jsx("small",{className:"text-sm ml-1",children:K})]})]}),p.jsx(bi,{variant:"outline",size:"icon",className:`rounded-full w-12 h-12 border-2 border-white/20 bg-black/40 hover:bg-white/10 hover:border-white ${H?"text-primary":"text-white"}`,onClick:ee=>E(ee,C),children:p.jsx("span",{className:H?"material-icons":"material-icons-outlined",children:H?"bookmark":"bookmark_border"})}),p.jsx(bi,{variant:"outline",size:"icon",className:"rounded-full w-12 h-12 border-2 border-white/20 bg-black/40 hover:bg-white/10 hover:border-white text-white",onClick:ee=>{ee.stopPropagation(),i(C.Id)},title:"More Info",children:p.jsx("span",{className:"material-icons-outlined",children:"info"})})]})]})]},C.Id)}),p.jsx("div",{className:"hero-indicators",children:t.map((C,k)=>{const D=k===n,O=k<n;return p.jsx("div",{className:`hero-indicator ${D?"active":""} ${O?"completed":""}`,onClick:()=>x(k),children:p.jsx("div",{className:"fill"},`fill-${k}-${D?l:"inactive"}`)},k)})})]})},l1=({item:i,onClick:e})=>{const[t,s]=w.useState(!1),[n,r]=w.useState(null),[l,c]=w.useState({top:0,left:0,width:0,height:0}),d=w.useRef(null),u=w.useRef(null),[f,g]=w.useState(i.UserData||{}),y=async()=>{if(d.current&&(clearTimeout(d.current),d.current=null),u.current){const _=u.current.getBoundingClientRect();if(c({top:_.top+window.scrollY,left:_.left+window.scrollX,width:_.width,height:_.height}),s(!0),!n)try{const C=await te.getCurrentUser();if(C){const k=await te.getItemDetails(C.Id,i.Id);r(k),g(k.UserData||{})}}catch(C){console.error("Failed to fetch details",C)}}},x=()=>{d.current=setTimeout(()=>{s(!1)},100)},S=()=>{d.current&&(clearTimeout(d.current),d.current=null)},E=async(_,C)=>{if(_.stopPropagation(),!!n)try{const k=await te.getCurrentUser();if(C==="played"){const D=!f.Played;g(O=>({...O,Played:D})),await te.markPlayed(k.Id,i.Id,D)}else if(C==="favorite"){const D=!f.IsFavorite;g(O=>({...O,IsFavorite:D})),await te.markFavorite(k.Id,i.Id,D)}}catch(k){console.error("Action failed",k)}},T=()=>{const _=[];return i.ProductionYear&&_.push(i.ProductionYear),i.Type==="Series"&&i.Status==="Continuing"&&_.push("Airing"),_.join("  ")||""},A=_=>{if(!_||!_.MediaSources||!_.MediaSources[0])return null;const C=_.MediaSources[0].MediaStreams||[];if(C.length===0)return null;const k=C.filter(U=>U.Type==="Audio"),D=C.filter(U=>U.Type==="Subtitle"),O=k.some(U=>U.Language==="eng"||U.Language==="en"||U.Language==="english"||U.DisplayTitle&&U.DisplayTitle.toLowerCase().includes("eng")),F=k.some(U=>U.Language==="jpn"||U.Language==="ja"||U.Language==="japanese"||U.DisplayTitle&&U.DisplayTitle.toLowerCase().includes("jap")),j=D.some(U=>U.Language==="eng"||U.Language==="en"||U.Language==="english"||U.DisplayTitle&&U.DisplayTitle.toLowerCase().includes("eng"));return O&&(F||j)?"Sub | Dub":O?"Dub":j?"Sub":null},I=()=>{if(!t)return null;const _=n||i,C=_.CommunityRating?_.CommunityRating.toFixed(1):"",k=_.VoteCount?`(${(_.VoteCount/1e3).toFixed(1)}K)`:"",D=_.ChildCount,O=_.RecursiveItemCount||_.ChildCount,F=A(_),j=l.width+4,U=l.height+8,K=l.left-2,H=l.top-4,ee=`${te.api.basePath}/Items/${i.Id}/Images/Primary?fillHeight=600&fillWidth=400&quality=90`;return SI.createPortal(p.jsxs("div",{className:"media-card-hover-overlay",style:{top:H,left:K,width:j,minHeight:U,backgroundImage:`url('${ee}')`},onMouseEnter:S,onMouseLeave:x,onClick:e,children:[p.jsx("div",{className:"hover-overlay-gradient"}),p.jsxs("div",{className:"hover-overlay-content",children:[p.jsxs("div",{className:"hover-info-group",children:[p.jsx("h3",{className:"hover-title",children:_.Name}),p.jsxs("div",{className:"hover-meta-row",children:[C&&p.jsxs("span",{className:"hover-rating",children:[C," ",p.jsx("span",{className:"material-icons star-icon",children:"star"}),k&&p.jsx("span",{className:"hover-rating-count",children:k})]}),p.jsx("span",{className:"hover-meta-separator",children:""}),p.jsxs("div",{className:"hover-stats",children:[_.Type==="Series"?p.jsxs(p.Fragment,{children:[D?p.jsxs("span",{children:[D," Seasons"]}):null,D&&O?p.jsx("span",{children:"  "}):null,O?p.jsxs("span",{children:[O," Episodes"]}):null]}):p.jsx("span",{children:_.ProductionYear}),F&&p.jsxs(p.Fragment,{children:[p.jsx("span",{children:"  "}),p.jsx("span",{style:{color:"#fff",fontWeight:"bold",border:"1px solid rgba(255,255,255,0.3)",padding:"0 4px",borderRadius:"3px",fontSize:"0.7rem"},children:F})]})]})]}),_.Overview&&p.jsx("p",{className:"hover-desc",children:_.Overview})]}),p.jsxs("div",{className:"hover-actions",children:[p.jsx("button",{className:"btn-action-icon play-icon",title:"Play",onClick:re=>{re.stopPropagation(),e&&e()},children:p.jsx("span",{className:"material-icons",children:"play_arrow"})}),p.jsx("button",{className:`btn-action-icon bookmark-icon ${f.IsFavorite?"active":""}`,onClick:re=>E(re,"favorite"),title:f.IsFavorite?"Unfavorite":"Favorite",children:p.jsx("span",{className:"material-icons",children:f.IsFavorite?"bookmark":"bookmark_border"})}),p.jsx("button",{className:`btn-action-icon plus-icon ${f.Played?"active":""}`,onClick:re=>E(re,"played"),title:f.Played?"Mark Unplayed":"Mark Played",children:p.jsx("span",{className:"material-icons",children:"add"})})]})]})]}),document.body)};return p.jsxs(p.Fragment,{children:[p.jsxs("div",{className:"media-card",ref:u,onMouseEnter:y,onMouseLeave:x,onClick:e,children:[p.jsx("div",{className:"media-card-image-container",children:p.jsx("img",{src:`${te.api.basePath}/Items/${i.Id}/Images/Primary?fillHeight=500&fillWidth=340&quality=90`,alt:i.Name,className:"media-card-image",loading:"lazy",onError:_=>{_.target.style.display="none"}})}),p.jsxs("div",{className:"media-card-info",children:[p.jsx("div",{className:"media-card-title",children:i.Name}),T()&&p.jsx("div",{className:"media-card-subtitle",children:T()})]})]}),I()]})},o1=({title:i,libraryId:e,onCardClick:t})=>{const[s,n]=w.useState([]),[r,l]=w.useState(!0),[c,d]=w.useState(!1),[u,f]=w.useState(!1),g=w.useRef(null),y=js(),x=()=>{if(g.current){const{scrollLeft:E,scrollWidth:T,clientWidth:A}=g.current;d(E>5),f(E+A<T-5)}};w.useEffect(()=>{(async()=>{l(!0);try{const T=await te.getCurrentUser();if(T&&e){const A=await te.getLatestItems(T.Id,e);A&&A.Items&&n(A.Items)}}catch(T){console.error("MediaRow fetch error",T)}finally{l(!1)}})()},[e]),w.useEffect(()=>{if(!r&&s.length>0){const E=setTimeout(x,100);return window.addEventListener("resize",x),()=>{window.removeEventListener("resize",x),clearTimeout(E)}}},[r,s]);const S=E=>{if(g.current){const T=g.current,A=window.innerWidth*.8;T.scrollBy({left:E==="left"?-A:A,behavior:"smooth"}),setTimeout(x,500)}};return r?p.jsxs("div",{className:"media-row-container",children:[p.jsx("div",{style:{padding:"0 4%",marginBottom:"15px"},children:p.jsx(ze,{width:"150px",height:"24px"})}),p.jsx("div",{className:"media-row-wrapper",style:{paddingLeft:"4%",display:"flex",gap:"15px",overflow:"hidden"},children:[1,2,3,4,5,6].map(E=>p.jsx("div",{style:{flex:"0 0 160px"},children:p.jsx(ze,{width:"100%",height:"240px",style:{borderRadius:"8px"}})},E))})]}):s.length===0?null:p.jsxs("div",{className:"media-row-container",children:[p.jsxs("h2",{className:"media-row-title",onClick:()=>y(`/library/${e}`),style:{cursor:"pointer",display:"flex",alignItems:"center",gap:"5px"},children:[i," ",p.jsx("span",{style:{fontSize:"0.8em",opacity:.7},children:""})]}),p.jsxs("div",{className:"media-row-wrapper",children:[c&&p.jsx("button",{className:"row-arrow left",onClick:()=>S("left"),children:p.jsx("span",{className:"material-icons",children:"chevron_left"})}),p.jsx("div",{className:"media-row-scroll",ref:g,onScroll:x,children:s.map(E=>p.jsx(l1,{item:E,onClick:()=>t?t(E):y(`/item/${E.Id}`)},E.Id))}),u&&p.jsx("button",{className:"row-arrow right",onClick:()=>S("right"),children:p.jsx("span",{className:"material-icons",children:"chevron_right"})})]})]})},c1=({itemId:i,onClose:e,isOpen:t})=>{const[s,n]=w.useState(null),[r,l]=w.useState([]),[c,d]=w.useState(null),[u,f]=w.useState(!0),[g,y]=w.useState(!1),[x,S]=w.useState(!1),[E,T]=w.useState(null);if(w.useEffect(()=>!t||!i?void 0:((async()=>{S(!0);const U=await te.getCurrentUser(),K=H=>H?H.includes("v=")?H.split("v=")[1].split("&")[0]:H.includes("youtu.be/")?H.split("youtu.be/")[1].split("?")[0]:H.includes("embed/")?H.split("embed/")[1].split("?")[0]:null:null;if(U){T(U.Id);const H=await te.getItemDetails(U.Id,i);n(H);const ee=[];if(H.RemoteTrailers&&H.RemoteTrailers.forEach(re=>{const de=K(re.Url);de&&ee.push({title:"Main Trailer",id:de,type:"Movie"})}),H.Type==="Series"&&(await te.getSeasons(U.Id,i)).forEach(de=>{de.RemoteTrailers&&de.RemoteTrailers.forEach(M=>{const V=K(M.Url);V&&ee.push({title:de.Name,id:V})})}),H.LocalTrailers&&H.LocalTrailers.forEach(re=>{ee.push({title:re.Name||"Local Trailer",id:re.Id,type:"Local"})}),l(ee),ee.length>0)d(ee[0].id);else if(H.Type==="Series"||H.Type==="Movie"){const re=`${H.Name} ${H.ProductionYear||""} Trailer`;l([{title:"Search YouTube",id:re,type:"Search"}]),d(re)}}})(),document.body.style.overflow="hidden",()=>{document.body.style.overflow="",n(null),l([]),d(null),S(!1)}),[t,i]),w.useEffect(()=>{let j;const U=()=>{y(!1),clearTimeout(j),j=setTimeout(()=>y(!0),5e3)};return window.addEventListener("mousemove",U),window.addEventListener("click",U),U(),()=>{window.removeEventListener("mousemove",U),window.removeEventListener("click",U),clearTimeout(j)}},[t]),!t||!s)return null;const A=async()=>{if(!E||!s)return;const j=!s.UserData?.IsFavorite;n(U=>({...U,UserData:{...U.UserData,IsFavorite:j}}));try{await te.markFavorite(E,s.Id,j)}catch{n(K=>({...K,UserData:{...K.UserData,IsFavorite:!j}}))}},I=()=>{window.location.href=`#!/details?id=${s.Id}`},_=()=>{f(!u)},C=`${te.api.basePath}/Items/${s.Id}/Images/Backdrop/0?quality=90&maxWidth=1920`,k=s.ImageTags&&s.ImageTags.Logo?`${te.api.basePath}/Items/${s.Id}/Images/Logo?maxHeight=140&maxWidth=400&quality=90`:null,D=r.find(j=>j.id===c);let O=null,F=!1;return D&&(D.type==="Local"?(F=!0,O=`${te.api.basePath}/Videos/${D.id}/stream?Container=mp4&Static=true&api_key=${te.api.accessToken}`):D.type==="Search"?O=`https://www.youtube.com/embed?listType=search&list=${encodeURIComponent(D.id)}&autoplay=1&mute=${u?1:0}&loop=1&modestbranding=1&rel=0&iv_load_policy=3&fs=0&color=white&controls=0&disablekb=1`:O=`https://www.youtube.com/embed/${D.id}?autoplay=1&mute=${u?1:0}&loop=1&modestbranding=1&rel=0&iv_load_policy=3&fs=0&color=white&controls=0&disablekb=1&playlist=${D.id}&enablejsapi=1`),p.jsxs("div",{className:`legitflix-info-modal ${x?"visible":""}`,children:[p.jsx("div",{className:"info-modal-backdrop",onClick:e}),p.jsxs("div",{className:"info-modal-content",children:[p.jsx(bi,{variant:"ghost",size:"icon",className:"btn-close-modal absolute top-5 right-5 z-50 rounded-full bg-black/50 text-white hover:bg-white/20",onClick:e,children:p.jsx("span",{className:"material-icons",children:"close"})}),p.jsxs("div",{className:"info-video-container",children:[p.jsx("div",{className:"iframe-wrapper",children:O?F?p.jsx("video",{className:"info-video-iframe",src:O,autoPlay:!0,muted:u,loop:!0,playsInline:!0,style:{objectFit:"cover",width:"100%",height:"100%"}}):p.jsx("iframe",{className:"info-video-iframe",src:O,title:"Trailer",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"}):p.jsx("div",{className:"info-backdrop-fallback",style:{backgroundImage:`url('${C}')`}})}),p.jsx("div",{className:"video-overlay-gradient"}),O&&p.jsx("div",{className:"video-mute-overlay",children:p.jsx(bi,{variant:"ghost",size:"icon",className:"rounded-full w-10 h-10 border border-white/30 bg-black/30 hover:bg-white/10 text-white",onClick:_,children:p.jsx("span",{className:"material-icons text-lg",children:u?"volume_off":"volume_up"})})}),p.jsxs("div",{className:`info-hero-content ${g?"idle":""}`,children:[k?p.jsx("img",{src:k,className:"info-logo",alt:s.Name}):p.jsx("h1",{className:"info-title-text",children:s.Name}),p.jsxs("div",{className:"info-actions flex gap-4 mt-6",children:[p.jsxs(bi,{variant:"ringHover",size:"lg",className:"h-12 px-8 text-lg font-bold rounded-md gap-2",onClick:I,children:[p.jsx("span",{className:"material-icons",children:"play_arrow"})," Play"]}),p.jsxs(bi,{variant:"outline",size:"lg",className:`h-12 px-6 text-lg rounded-md gap-2 border-2 bg-transparent hover:bg-white/10 ${s.UserData?.IsFavorite?"border-primary text-primary":"border-white/40 text-white"}`,onClick:A,children:[p.jsx("span",{className:"material-icons",children:s.UserData?.IsFavorite?"check":"add"})," My List"]})]})]})]}),p.jsx("div",{className:"info-details-container",children:p.jsxs("div",{className:"info-col-left",children:[p.jsxs("div",{className:"info-meta-row",children:[p.jsx("span",{className:"info-year",children:s.ProductionYear}),s.OfficialRating&&p.jsx("span",{className:"info-rating",children:s.OfficialRating}),p.jsx("span",{className:"info-duration",children:s.RunTimeTicks?Math.round(s.RunTimeTicks/6e8)+"m":""}),p.jsx("span",{className:"info-quality",children:"HD"})]}),p.jsx("p",{className:"info-desc",children:s.Overview||"No description available."})]})}),p.jsxs("div",{className:"info-trailers-section",children:[p.jsx("h3",{children:"Trailers & More"}),p.jsxs("div",{className:"trailers-grid",children:[r.map(j=>p.jsxs("div",{className:"trailer-card",onClick:()=>d(j.id),children:[p.jsxs("div",{className:"trailer-thumb",children:[j.type==="Local"?p.jsx("div",{className:"local-trailer-placeholder",children:p.jsx("span",{className:"material-icons",children:"movie"})}):p.jsx("img",{src:`https://img.youtube.com/vi/${j.id}/mqdefault.jpg`,alt:j.title,loading:"lazy"}),p.jsx("div",{className:"play-overlay",children:p.jsx("span",{className:"material-icons",children:"play_circle_outline"})})]}),p.jsx("div",{className:"trailer-title",children:j.title})]},j.id)),p.jsxs("a",{href:`https://www.youtube.com/results?search_query=${encodeURIComponent(s.Name+" "+(s.ProductionYear||"")+" trailer")}`,target:"_blank",rel:"noopener noreferrer",className:"trailer-card search-card",children:[p.jsx("div",{className:"trailer-thumb search-thumb",children:p.jsx("span",{className:"material-icons",children:"search"})}),p.jsx("div",{className:"trailer-title",children:"Search YouTube"})]})]})]}),p.jsxs("div",{className:"info-about-section",children:[p.jsxs("h3",{children:["About ",s.Name]}),s.People&&p.jsxs("div",{className:"about-row",children:[p.jsx("span",{className:"label",children:"Cast: "}),p.jsx("span",{className:"value",children:s.People.slice(0,10).map(j=>j.Name).join(", ")})]}),s.Genres&&p.jsxs("div",{className:"about-row",children:[p.jsx("span",{className:"label",children:"Genres: "}),p.jsx("span",{className:"value",children:s.Genres.join(", ")})]})]})]})]})},u1=()=>{const{config:i}=Wi();return i.enableJellyseerr?p.jsx("div",{className:"library-card jellyseerr-card-wrapper",children:p.jsx("a",{href:i.jellyseerrUrl,target:"_blank",rel:"noopener noreferrer",className:"jellyseerr-card",children:p.jsxs("div",{className:"jellyseerr-image",style:{backgroundImage:`url('${i.jellyseerrBackground||"https://raw.githubusercontent.com/gorillasuti/Legitflix-plugin/refs/heads/main/legitflix-client/public/jellyseerr.jpg"}')`},children:[p.jsx("div",{className:"jellyseerr-overlay"}),p.jsxs("div",{className:"jellyseerr-content",children:[p.jsx("span",{className:"material-icons card-icon",children:"add_circle_outline"}),p.jsx("span",{className:"card-label",children:i.jellyseerrText||"Request Feature"})]})]})})}):null},d1=({isOpen:i,onClose:e})=>{const[t,s]=w.useState(""),[n,r]=w.useState([]),[l,c]=w.useState({Name:"All",Id:"All"}),[d,u]=w.useState([{Name:"All",Id:"All"}]),[f,g]=w.useState(!1),y=w.useRef(null),x=js();if(w.useEffect(()=>{(async()=>{try{const T=await te.getCurrentUser();if(T){const A=await te.getUserViews(T.Id);A&&A.Items&&u([{Name:"All",Id:"All"},...A.Items])}}catch(T){console.error("Failed to fetch views",T)}})()},[]),w.useEffect(()=>{i&&setTimeout(()=>y.current?.focus(),100)},[i]),w.useEffect(()=>{const T=setTimeout(async()=>{if(g(!0),r([]),t.trim().length===0){if(l.Id!=="All")try{const A=await te.getCurrentUser();if(A){const I=await te.getItems(A.Id,{parentId:l.Id,limit:20,sortBy:["DateCreated"],sortOrder:["Descending"],includeItemTypes:["Movie","Series","BoxSet"],recursive:!0,fields:["PrimaryImageAspectRatio","ProductionYear"]});r(I.Items||[])}}catch(A){console.error("Category fetch failed",A),r([])}else r([]);g(!1);return}try{const A=await te.getCurrentUser();if(!A){g(!1);return}const I=await te.searchItems(A.Id,t,["Movie","Series","Person","BoxSet"],l.Id);r(I.Items||[])}catch(A){console.error("Search failed",A)}finally{g(!1)}},300);return()=>clearTimeout(T)},[t,l]),!i)return null;const S=E=>{e(),E.Type==="Movie"?x(`/movie/${E.Id}`):E.Type==="Series"?x(`/series/${E.Id}`):E.Type==="Person"?x(`/person/${E.Id}`):E.Type==="BoxSet"?x(`/collections/${E.Id}`):x(`/details/${E.Id}`)};return p.jsx("div",{className:`legit-search-overlay ${i?"visible":""}`,onClick:e,children:p.jsxs("div",{className:"legit-search-modal",onClick:E=>E.stopPropagation(),children:[p.jsxs("div",{className:"legit-search-header",children:[p.jsx("span",{className:"material-icons legit-search-icon",children:"search"}),p.jsx("input",{ref:y,className:"legit-search-input",placeholder:"Start typing to search...",value:t,onChange:E=>s(E.target.value),onKeyDown:E=>{E.key==="Escape"&&e()}}),p.jsxs("div",{className:"legit-search-actions",onClick:e,children:[p.jsx("span",{className:"legit-search-esc",children:"esc"}),p.jsx("span",{className:"legit-search-close",children:"Close"})]})]}),p.jsx("div",{className:"legit-search-categories",children:d.map(E=>p.jsx("div",{className:`legit-search-category-pill ${l.Id===E.Id?"active":""}`,onClick:()=>c(E),children:E.Name},E.Id))}),p.jsx("div",{className:"legit-search-results",children:f?Array.from({length:5}).map((E,T)=>p.jsxs("div",{className:"legit-search-result-item skeleton-item",style:{pointerEvents:"none"},children:[p.jsx(ze,{width:"40px",height:"60px",style:{borderRadius:"4px",marginRight:"15px"}}),p.jsxs("div",{className:"legit-result-info",style:{width:"100%"},children:[p.jsx(ze,{width:"60%",height:"20px",style:{marginBottom:"8px"}}),p.jsx(ze,{width:"30%",height:"14px"})]})]},`skeleton-${T}`)):p.jsxs(p.Fragment,{children:[n.length===0&&t.length>0&&p.jsxs("div",{className:"legit-no-results",children:['No results found for "',t,'"']}),n.length===0&&t.length===0&&l.Id!=="All"&&p.jsxs("div",{className:"legit-no-results",children:["No items found in ",l.Name]}),t.length===0&&l.Id==="All"&&p.jsxs("div",{className:"legit-search-helper",children:[p.jsx("span",{className:"material-icons",children:"keyboard"}),p.jsx("p",{children:"Start typing to search..."})]}),n.map(E=>p.jsxs("div",{className:"legit-search-result-item",onClick:()=>S(E),children:[p.jsx("div",{className:"legit-result-thumb",style:{backgroundImage:`url(${te.api.basePath}/Items/${E.Id}/Images/Primary?fillHeight=60&fillWidth=40&quality=90)`,backgroundColor:"#222"},children:!E.ImageTags?.Primary&&p.jsx("span",{className:"material-icons legit-result-icon-fallback",children:"movie"})}),p.jsxs("div",{className:"legit-result-info",children:[p.jsx("div",{className:"legit-result-title",children:E.Name}),p.jsxs("div",{className:"legit-result-meta",children:[p.jsx("span",{className:"legit-result-tag",children:E.Type?.toUpperCase()}),E.ProductionYear&&p.jsx("span",{children:E.ProductionYear})]})]})]},E.Id))]})})]})})},Pm=({isOpen:i,onClose:e,onSave:t,userId:s})=>{const[n,r]=w.useState([]),[l,c]=w.useState(null),[d,u]=w.useState(!1);if(w.useEffect(()=>{if(!i||!s)return;u(!0),c(null),(async()=>{try{const E=(await te.getAllBackdrops(s,50)).filter(T=>T.BackdropImageTags&&T.BackdropImageTags.length>0);r(E)}catch(S){console.error("[BannerPicker] Failed to fetch backdrops",S)}finally{u(!1)}})()},[i,s]),!i)return null;const f=x=>{const S=x.BackdropImageTags?.[0];return`${te.api.basePath}/Items/${x.Id}/Images/Backdrop/0?quality=80&maxWidth=600&tag=${S}`},g=x=>{const S=x.BackdropImageTags?.[0];return`${te.api.basePath}/Items/${x.Id}/Images/Backdrop/0?quality=90&maxWidth=1920&tag=${S}`},y=()=>{l&&t(l),e()};return p.jsxs("div",{className:"banner-picker-overlay",children:[p.jsx("div",{className:"banner-picker-backdrop",onClick:e}),p.jsxs("div",{className:"banner-picker-modal",children:[p.jsx("h2",{className:"banner-picker-title",children:"Select Banner"}),d?p.jsx("div",{className:"banner-picker-grid",children:[1,2,3,4,5,6,7,8,9,10,11,12].map(x=>p.jsx("div",{className:"banner-picker-card",children:p.jsx(ze,{width:"100%",height:"100%",style:{borderRadius:"6px"}})},x))}):p.jsx("div",{className:"banner-picker-grid",children:n.map(x=>{const S=f(x),E=g(x),T=l===E;return p.jsx("div",{className:`banner-picker-card ${T?"selected":""}`,onClick:()=>c(E),children:p.jsx("img",{src:S,alt:x.Name,loading:"lazy"})},x.Id)})}),p.jsxs("div",{className:"banner-picker-actions",children:[p.jsx("button",{className:"btn-picker-close",onClick:e,children:"CLOSE"}),p.jsxs("button",{className:"btn-picker-save",onClick:y,disabled:!l,children:[p.jsx("span",{className:"material-icons",children:"save"})," SAVE"]})]})]})]})},h1=["010c7b9061ece2fbf7bbb8d9bb6d2bee16f4a68c.png","1b2d497a3f909e45b0cdbc08cc6d5aa1a949a1a2.png","1def8ba1616b0966e1db6021f1055ca356d1cea9.png","27c51845bddee8f4ff1c30aeb716d8aa731b6286.png","31687dea129fb21a578977565077d44b0ca92da5.png","3394687450705634476d174e6b395f0aa41db487.png","339bc7408b3c9e38fe40f8d6689bf441bca8357a.png","35d29230db5589057d23849f6369f22e90044cd1.png","38d52512bdd7a762bbadf4ae673d80140a118957.png","3bf2c8889e738213673c1a77803587aedd4a8148.png","45aff5dc4892254211d4982c12e2bf0ac8caef90.png","5e3f3f8dd9ca520c92d2b3dd23ec9737203631d9.png","62c5f931445c1a5a1228cb24f913fa0234a577c2.png","64fd2f5c0fbb5e0c5348f3947e5fd6b762e3e8ea.png","6980956ae6150a0697586505546be9ad377250a0.png","6ef91d4e1b1377703ed9caef1072f327c5ce107f.png","71dcab8c2f39540c99eab624d2bdada0ac9cb44e.png","79b07958e72c796a12eceba7832dc8e3bae85ca9.png","7cafcf32034f4c292574ced3e745a83d0c68e11e.png","8623109ba7bc471ab63ca32e1d820c3806c2c36c.png","98b48b004a2882f1dc3e9f12167304d6417d3bd4.png","99d8a4f741a9f042c71a6d2f5017f39f6f35e350.png","ab21304ad03dc74e4267320069636ca096ec7ea2.png","ae4337ebf3305b6c66020fde433c92257b7c5616.png","aebd06a8792119a23ca1c11a285cfca7468bfa67.png","b0caf3e60209775ab9c34662b7d860ba3e07f17a.png","b20b75517fe91a777d67d434f534378c987c8f89.png","b628ef1fe21c1a97773cab1b8efe341f651a20ef.png","c9d0048f1edf7bd5c415e676ebfce0e600166481.png","cde86a64d2c491f4494c916fc81fdc3a1980654e.png","d96038f9fde13a71369fd3b42bd53832f8db4be0.png","e8b7f5f61a4905834e169f89f3835b905659a44d.png","Netflix-abaya-61.png","Netflix-abaya-69.png","Netflix-academic_gown-27.png","Netflix-academic_gown-75.png","Netflix-affenpinscher-38.png","Netflix-ashcan-38.png","Netflix-balance_beam-10.png","Netflix-balloon-17.png","Netflix-balloon-20.png","Netflix-balloon-24.png","Netflix-balloon-35.png","Netflix-balloon-58.png","Netflix-ballplayer-21.png","Netflix-Band_Aid-23.png","Netflix-Band_Aid-29.png","Netflix-Band_Aid-34.png","Netflix-Band_Aid-54.png","Netflix-Band_Aid-65.png","Netflix-Band_Aid-92.png","Netflix-Band_Aid-94.png","Netflix-barn_spider-14.png","Netflix-basenji-11.png","Netflix-bassoon-11.png","Netflix-bearskin-54.png","Netflix-bikini-14.png","Netflix-bikini-26.png","Netflix-binoculars-62.png","Netflix-book_jacket-14.png","Netflix-bow_tie-10.png","Netflix-bow_tie-13.png","Netflix-bow_tie-39.png","Netflix-bow_tie-66.png","Netflix-bow_tie-97.png","Netflix-brassiere-11.png","Netflix-brassiere-15.png","Netflix-brassiere-18.png","Netflix-brassiere-58.png","Netflix-cardigan-28.png","Netflix-cellular_telephone-73.png","Netflix-chain_saw-43.png","Netflix-chain_saw-82.png","Netflix-chime-11.png","Netflix-coffeepot-11.png","Netflix-comic_book-12.png","Netflix-comic_book-13.png","Netflix-comic_book-14.png","Netflix-comic_book-16.png","Netflix-comic_book-18.png","Netflix-comic_book-20.png","Netflix-comic_book-21.png","Netflix-comic_book-23.png","Netflix-comic_book-26.png","Netflix-comic_book-31.png","Netflix-comic_book-35.png","Netflix-comic_book-36.png","Netflix-comic_book-38.png","Netflix-comic_book-39.png","Netflix-comic_book-45.png","Netflix-comic_book-46.png","Netflix-comic_book-48.png","Netflix-comic_book-49.png","Netflix-comic_book-51.png","Netflix-comic_book-53.png","Netflix-comic_book-55.png","Netflix-comic_book-56.png","Netflix-comic_book-61.png","Netflix-comic_book-64.png","Netflix-comic_book-65.png","Netflix-comic_book-66.png","Netflix-comic_book-69.png","Netflix-comic_book-70.png","Netflix-comic_book-74.png","Netflix-comic_book-76.png","Netflix-comic_book-77.png","Netflix-comic_book-78.png","Netflix-comic_book-81.png","Netflix-comic_book-83.png","Netflix-comic_book-84.png","Netflix-comic_book-85.png","Netflix-comic_book-92.png","Netflix-comic_book-93.png","Netflix-comic_book-95.png","Netflix-comic_book-96.png","Netflix-comic_book-97.png","Netflix-corkscrew-10.png","Netflix-cornet-14.png","Netflix-crane-77.png","Netflix-crash_helmet-56.png","Netflix-Crock_Pot-42.png","Netflix-Crock_Pot-49.png","Netflix-digital_clock-37.png","Netflix-digital_clock-69.png","Netflix-drum-48.png","Netflix-dumbbell-18.png","Netflix-envelope-25.png","Netflix-feather_boa-59.png","Netflix-fountain-41.png","Netflix-fur_coat-21.png","Netflix-fur_coat-31.png","Netflix-gasmask-95.png","Netflix-gasmask-98.png","Netflix-golden_retriever-94.png","Netflix-hair_slide-32.png","Netflix-hair_spray-37.png","Netflix-hen-91.png","Netflix-hippopotamus-13.png","Netflix-hippopotamus-25.png","Netflix-hook-15.png","Netflix-hornbill-25.png","Netflix-hornbill-95.png","Netflix-ice_bear-90.png","Netflix-jaguar-90.png","Netflix-jersey-10.png","Netflix-jersey-11.png","Netflix-jersey-12.png","Netflix-jersey-13.png","Netflix-jersey-21.png","Netflix-jersey-28.png","Netflix-jersey-30.png","Netflix-jersey-31.png","Netflix-jersey-32.png","Netflix-jersey-48.png","Netflix-jersey-70.png","Netflix-jersey-73.png","Netflix-joystick-66.png","Netflix-kimono-16.png","Netflix-king_penguin-93.png","Netflix-lab_coat-29.png","Netflix-lab_coat-36.png","Netflix-loggerhead-81.png","Netflix-loudspeaker-83.png","Netflix-macaque-49.png","Netflix-magnetic_compass-54.png","Netflix-maillot-13.png","Netflix-maillot-14.png","Netflix-maillot-23.png","Netflix-maillot-37.png","Netflix-mask-11.png","Netflix-mask-12.png","Netflix-mask-13.png","Netflix-mask-14.png","Netflix-mask-21.png","Netflix-mask-24.png","Netflix-mask-25.png","Netflix-mask-26.png","Netflix-mask-27.png","Netflix-mask-31.png","Netflix-mask-41.png","Netflix-mask-44.png","Netflix-mask-48.png","Netflix-mask-55.png","Netflix-mask-56.png","Netflix-mask-65.png","Netflix-mask-77.png","Netflix-mask-85.png","Netflix-mask-99.png","Netflix-matchstick-45.png","Netflix-military_uniform-54.png","Netflix-mouse-24.png","Netflix-mushroom-51.png","Netflix-neck_brace-84.png","Netflix-nipple-36.png","Netflix-oboe-10.png","Netflix-orangutan-77.png","Netflix-pajama-16.png","Netflix-palace-23.png","Netflix-Pembroke-97.png","Netflix-pencil_box-40.png","Netflix-pencil_sharpener-34.png","Netflix-perfume-24.png","Netflix-pick-39.png","Netflix-pick-73.png","Netflix-pickelhaube-11.png","Netflix-ping-pong_ball-11.png","Netflix-ping-pong_ball-47.png","Netflix-ping-pong_ball-53.png","Netflix-pinwheel-16.png","Netflix-pinwheel-28.png","Netflix-pole-25.png","Netflix-poncho-36.png","Netflix-pool_table-19.png","Netflix-pool_table-48.png","Netflix-pool_table-58.png","Netflix-pool_table-62.png","Netflix-pool_table-68.png","Netflix-pool_table-80.png","Netflix-pool_table-92.png","Netflix-punching_bag-61.png","Netflix-racket-12.png","Netflix-rapeseed-26.png","Netflix-red_fox-80.png","Netflix-red_wine-49.png","Netflix-ski_mask-11.png","Netflix-ski_mask-41.png","Netflix-soap_dispenser-14.png","Netflix-soap_dispenser-20.png","Netflix-soap_dispenser-27.png","Netflix-soap_dispenser-62.png","Netflix-sombrero-74.png","Netflix-spotlight-39.png","Netflix-stage-43.png","Netflix-stethoscope-11.png","Netflix-stethoscope-12.png","Netflix-street_sign-69.png","Netflix-suit-18.png","Netflix-suit-22.png","Netflix-suit-25.png","Netflix-suit-31.png","Netflix-suit-36.png","Netflix-suit-40.png","Netflix-suit-44.png","Netflix-suit-74.png","Netflix-suit-76.png","Netflix-suit-79.png","Netflix-sulphur_butterfly-33.png","Netflix-sunglass-51.png","Netflix-sweatshirt-11.png","Netflix-sweatshirt-20.png","Netflix-sweatshirt-23.png","Netflix-sweatshirt-35.png","Netflix-sweatshirt-54.png","Netflix-table_lamp-17.png","Netflix-table_lamp-39.png","Netflix-teddy-10.png","Netflix-teddy-11.png","Netflix-teddy-15.png","Netflix-teddy-21.png","Netflix-teddy-27.png","Netflix-teddy-98.png","Netflix-tennis_ball-13.png","Netflix-tiger-72.png","Netflix-tiger_shark-70.png","Netflix-torch-23.png","Netflix-totem_pole-65.png","Netflix-toyshop-11.png","Netflix-tree_frog-97.png","Netflix-trench_coat-83.png","Netflix-triceratops-63.png","Netflix-tub-32.png","Netflix-umbrella-44.png","Netflix-umbrella-83.png","Netflix-violin-17.png","Netflix-violin-67.png","Netflix-water_bottle-18.png","Netflix-water_bottle-68.png","Netflix-Weimaraner-41.png","Netflix-whistle-14.png","Netflix-wig-11.png","Netflix-wig-14.png","Netflix-wig-15.png","Netflix-wig-21.png","Netflix-wig-29.png","Netflix-wig-30.png","Netflix-wig-35.png","Netflix-wig-39.png","Netflix-wig-43.png","Netflix-wig-45.png","Netflix-wig-46.png","Netflix-wig-47.png","Netflix-wig-48.png","Netflix-wig-71.png","Netflix-wig-92.png","Netflix-Windsor_tie-11.png"],f1=JSON.parse('["100001-the-rising-of-the-shield-hero-naofumi.png","100002-the-rising-of-the-shield-hero-raphtalia.png","100003-the-rising-of-the-shield-hero-filo.png","100004-the-rising-of-the-shield-hero-melty.png","100005-the-rising-of-the-shield-hero-rishia.png","100006-spy-x-family-loid.png","100007-spy-x-family-yor.png","100008-spy-x-family-anya-1.png","100009-spy-x-family-anya-2.png","100010-spy-x-family-anya-3.png","1001-the-worlds-finest-assassin-lugh.png","1002-the-worlds-finest-assassin-dia.png","1003-the-worlds-finest-assassin-tart.png","1004-the-worlds-finest-assassin-maha.png","1005-the-worlds-finest-assassin-assassin.png","1011-fena-pirate-princess-fena.png","1012-fena-pirate-princess-yukimaru.png","1013-fena-pirate-princess-shitan.png","1014-fena-pirate-princess-karin.png","1015-fena-pirate-princess-twins.png","1016-fena-pirate-princess-makaba.png","1017-fena-pirate-princess-tsubaki.png","1018-fena-pirate-princess-brule.png","1019-fena-pirate-princess-fena-young.png","1020-fena-pirate-princess-yukimaru-young.png","1021-to-your-eternity-fushi.png","1022-to-your-eternity-joann.png","1023-to-your-eternity-march.png","1024-to-your-eternity-parona.png","1025-to-your-eternity-thebeholder.png","1026-to-your-eternity-gugu.png","1027-to-your-eternity-tonari.png","1028-to-your-eternity-theboy.png","1029-to-your-eternity-fushi.png","1030-to-your-eternity-march.png","1036-tokyo-revengers-takemichi.jpg","1037-tokyo-revengers-mikey.jpg","1038-tokyo-revengers-draken.jpg","1039-tokyo-revengers-mitsuya.jpg","1040-tokyo-revengers-baji.jpg","1041-jujutsu-kaisen-yuji-itadori.png","1042-jujutsu-kaisen-megumi-fushigoro.png","1043-jujutsu-kaisen-nobara-kugisaki.png","1044-jujutsu-kaisen-satoru-gojo.png","1045-jujutsu-kaisen-ryomen-sukuna.png","1046-dr-stone-senku.png","1047-dr-stone-suika.png","1048-dr-stone-kohaku.png","1049-dr-stone-chrome.png","1050-dr-stone-gen.png","1051-so-im-a-spider-so-what-kumoko.png","1052-so-im-a-spider-so-what-shun.png","1053-so-im-a-spider-so-what-katia.png","1054-so-im-a-spider-so-what-sue.png","1055-so-im-a-spider-so-what-fei.png","1056-black-clover-asta.png","1057-black-clover-yuno.png","1058-black-clover-noelle.png","1059-black-clover-yami.png","1060-black-clover-nero.png","11-tower-of-god-bam.png","12-tower-of-god-khun.png","13-tower-of-god-rak.jpg","14-tower-of-god-yuri-jahad.jpg","15-tower-of-god-endorsi-jahad.png","16-the-god-of-high-school-jin-mori.png","17-the-god-of-high-school-han-daewi.png","18-the-god-of-high-school-yoo-mira.png","19-the-god-of-high-school-park-mujin.png","20-the-god-of-high-school-park-ilpyo.png","21-bananya-bananya.png","22-bananya-droopy-eared.png","23-bananya-pirate.png","24-bananya-night-rainbow.png","25-bananya-emo.png","26-inspectre-kotoko-iwanaga.jpg","27-inspectre-kuro-sakuragawa.jpg","28-inspectre-saki-yumihara.jpg","29-inspectre-steel-lady-nanase.jpg","2bluenagi_nagi_avatar.png","30-inspectre-komainu.jpg","31-somali-and-the-forest-spirit-golem.jpg","32-somali-and-the-forest-spirit-somali.jpg","33-somali-and-the-forest-spirit-shizuno.jpg","34-somali-and-the-forest-spirit-uzoi.jpg","35-somali-and-the-forest-spirit-kikila.jpg","36-that-time-i-got-reincarnated-as-a-slime-rimuru-human.png","37-that-time-i-got-reincarnated-as-a-slime-shuna.png","38-that-time-i-got-reincarnated-as-a-slime-shion.png","39-that-time-i-got-reincarnated-as-a-slime-rimuru-slime.png","40-that-time-i-got-reincarnated-as-a-slime-hinata.jpg","41-zombieland-saga-revenge-sakura-minamoto.jpg","42-zombieland-saga-revenge-saki-nikaido.jpg","43-zombieland-saga-revenge-ai-mizuno.jpg","44-zombieland-saga-revenge-junko-konno.jpg","45-zombieland-saga-revenge-yugiri.jpg","46-zombieland-saga-revenge-lily-hoshikawa.jpg","47-zombieland-saga-revenge-tae-yamada.jpg","afdal.png","aot_fc_annie-avatar.png","aot_fc_armin-avatar.png","aot_fc_conny-avatar.png","aot_fc_eren-avatar.png","aot_fc_hange-avatar.png","aot_fc_jean-avatar.png","aot_fc_levi-avatar.png","aot_fc_mikasa-avatar.png","aot_fc_reiner-avatar.png","aot_fc_sasha-avatar.png","apothecary_gaoshun.png","apothecary_gyokuyou.png","apothecary_jinshi-1.png","apothecary_jinshi-2.png","apothecary_lihaku.png","apothecary_maomao-1.png","apothecary_maomao-2.png","apothecary_xiaolan.png","ash.png","avatars-big_mom.png","avatars-brook.png","avatars-chopper.png","avatars-franky.png","avatars-jinbei.png","avatars-kaido.png","avatars-kid.png","avatars-law.png","avatars-luffy.png","avatars-nami.png","avatars-perona.png","avatars-robin.png","avatars-sanji.png","avatars-shanks.png","avatars-usopp.png","avatars-yamato.png","avatars-zoro.png","bachira_avatar.png","bb-ciel-avatar.png","bb-edgar-avatar.png","bb-herman-avatar.png","bb-lawrence-avatar.png","bb_gregory-avatar.png","bb_sebastian-avatar.png","bluelock_bachira_avatar.png","bluelock_bachira_teaser_avatar.png","bluelock_barou_avatar.png","bluelock_chigiri_avatar.png","bluelock_ego_avatar.png","bluelock_hiori_teaser_avatar.png","bluelock_isagi_avatar.png","bluelock_isagi_kv1_avatar.png","bluelock_isagi_teaser_avatar.png","bluelock_karasu_teaser_avatar.png","bluelock_kunigami_avatar.png","bluelock_nagi_avatar.png","bluelock_nagi_teaser_avatar.png","bluelock_nanase_teaser_avatar.png","bluelock_oliver_kv1_avatar.png","bluelock_otoya_teaser_avatar.png","bluelock_reo_avatar.png","bluelock_rin_avatar.png","bluelock_rin_kv1_avatar.png","bluelock_rin_teaser_avatar.png","bluelock_sae_kv1_avatar.png","bluelock_sae_teaser_avatar.png","bluelock_shidou_teaser_avatar.png","bluelock_yukimiya_teaser_avatar.png","bluelock_zantetsu_avatar.png","bluenagi_chigiri_avatar.png","bluenagi_isagi_avatar.png","bluenagi_kunigami_avatar.png","bluenagi_nagi_school_avatar.png","bluenagi_reo_avatar.png","bluenagi_reo_school_avatar.png","bluenagi_rin_avatar.png","bocchi-avatar.jpg","bocchi-iita-kv-avatar.jpg","bocchi-kita-avatar.jpg","bocchi-kv-avatar.jpg","bocchi-nijika-kv-avatar.jpg","bocchi-ryo-avatar.jpg","bocchi-ryo-kv-avatar.jpg","bochhi-nijika-avatar.jpg","chainsawman-aki.jpg","chainsawman-chainsawman.jpg","chainsawman-denji.jpg","chainsawman-himeno.jpg","chainsawman-kishibe.jpg","chainsawman-kobeni.jpg","chainsawman-makima.jpg","chainsawman-pochita.jpg","chainsawman-power.jpg","chris-1.png","chris-2.png","classic-hime-avatar-1.png","classic-hime-avatar-2.png","classic-hime-avatar-3.png","classic-sudachi-avatar-1.png","classic-sudachi-avatar-2.png","classic-sudachi-avatar-3.png","classic-yuzu-avatar-1.png","classic-yuzu-avatar-2.png","classic-yuzu-avatar-3.png","crbrand_avatars_logo_marks_black_orange.jpg","crbrand_avatars_logo_marks_black_taupe.jpg","crbrand_avatars_logo_marks_black_white.jpg","crbrand_avatars_logo_marks_mangaeye_taupe.jpg","crbrand_avatars_logo_marks_mangagirl_taupe.jpg","crbrand_avatars_logo_marks_manga_eye_orange.jpg","crbrand_avatars_logo_marks_manga_skull_orange.jpg","crbrand_avatars_logo_marks_manga_skull_taupe.jpg","crbrand_avatars_logo_marks_mech_orange.jpg","crbrand_avatars_logo_marks_mech_orange2.jpg","crbrand_avatars_logo_marks_mech_taupe.jpg","crbrand_avatars_logo_marks_mech_taupe2.jpg","crbrand_avatars_logo_marks_orange_black.jpg","crbrand_avatars_logo_marks_orange_expressive.jpg","crbrand_avatars_logo_marks_orange_stars.jpg","crbrand_avatars_logo_marks_orange_taupe.jpg","crbrand_avatars_logo_marks_orange_taupe_stars.jpg","crbrand_avatars_logo_marks_orange_white.jpg","crbrand_avatars_logo_marks_taupe_expressive.jpg","crbrand_avatars_logo_marks_the_rings.jpg","dbdiama_avatarbackground2025_avatar_10.jpg","dbdiama_avatarbackground2025_avatar_3.jpg","dbdiama_avatarbackground2025_avatar_4.jpg","dbdiama_avatarbackground2025_avatar_5.jpg","dbdiama_avatarbackground2025_avatar_6.jpg","dbdiama_avatarbackground2025_avatar_7.jpg","dbdiama_avatarbackground2025_avatar_8.jpg","dbdiama_avatarbackground2025_avatar_9.jpg","dotm_avatar_02.png","dr_stone_s4_avatar_2.jpg","dr_stone_s4_avatar_3.jpg","dr_stone_s4_avatar_4.jpg","eden.png","egghead-brook.png","egghead-chopper.png","egghead-franky.png","egghead-jimbei.png","egghead-luffy.png","egghead-nami.png","egghead-robin.png","egghead-sanji.png","egghead-usopp.png","egghead-zoro.png","finn-1.png","finn-2.png","freiren-avatar-1.png","freiren-avatar-2.png","freiren-avatar-3.png","frieren_eisen-avatar-1.png","frieren_eisen-avatar-2.png","frieren_fern-avatar-1.png","frieren_fern-avatar-2.png","frieren_heiter-avatar-1.png","frieren_heiter-avatar-2.png","frieren_himmel-avatar-1.png","frieren_himmel-avatar-2.png","frieren_stark-avatar-1.png","frieren_stark-avatar-2.png","gear5avatar1.png","gear5avatar2.png","gear5avatar3.png","gear5avatar4.png","gear5avatar5.png","gear5avatar6.png","gear5avatar7.png","gear5avatar8.png","gear5avatar9.png","gene-1.png","gene-2.png","giallon-1.png","giallon-2.png","im_in_love_clarie-kv1.png","im_in_love_clarie-kv2.png","im_in_love_clarie.png","im_in_love_lene.png","im_in_love_manaria.png","im_in_love_misha.png","im_in_love_rae-kv1.png","im_in_love_rae-kv2.png","im_in_love_rae.png","inbento_avatar_1.png","inbento_avatar_3.png","inbento_avatar_4.png","inbento_avatar_5.png","jill.png","leo-1.png","leo-2.png","momoka-1.png","momoka-2.png","momoka-3.png","momoka-4.png","momoka-5.png","mushokutensei_ariel.jpg","mushokutensei_cliff.jpg","mushokutensei_elinalise.jpg","mushokutensei_eris.jpg","mushokutensei_ghislaine.jpg","mushokutensei_juli.jpg","mushokutensei_linia.jpg","mushokutensei_luke.jpg","mushokutensei_pursena.jpg","mushokutensei_rudeus-school-uniform.jpg","mushokutensei_rudeus.jpg","mushokutensei_ruijerd.jpg","mushokutensei_sara.jpg","mushokutensei_soldat.jpg","mushokutensei_suzanne.jpg","mushokutensei_sylphie-fitz.jpg","mushokutensei_sylphie.jpg","mushokutensei_zanoba.jpg","my-dress-up-gojo-1-avatar.jpg","my-dress-up-gojo-2-avatar.jpg","my-dress-up-marin-1-avatar.jpg","my-dress-up-marin-2-avatar.jpg","my-dress-up-marin-cosplay-avatar.jpg","my-dress-up-marin-normal-avatar.jpg","my-dress-up-sajuna-1-avatar.jpg","my-dress-up-sajuna-2-avatar.jpg","my-dress-up-shinju-1-avatar.jpg","my-dress-up-shinju-2-avatar.jpg","naomi-1.png","naomi-2.png","nina-1.png","nina-2.png","nina-3.png","nina-4.png","nina-5.png","noid.png","one-piece-chopper-1.png","one-piece-chopper-2.png","one-piece-chopper-3.png","one-piece-franky-1.png","one-piece-franky-2.png","one-piece-franky-3.png","one-piece-jimbei-1.png","one-piece-jimbei-2.png","one-piece-jimbei-3.png","one-piece-jimbei-4.png","one-piece-luffy-1.png","one-piece-luffy-2.png","one-piece-luffy-3.png","one-piece-luffy-4.png","one-piece-luffy-5.png","one-piece-nico-robin-1.png","one-piece-nico-robin-2.png","one-piece-nico-robin-3.png","one-piece-roronoa-zoro-1.png","one-piece-roronoa-zoro-2.png","one-piece-sanji-1.png","one-piece-sanji-2.png","one-piece-sanji-3.png","one-piece-usopp-1.png","one-piece-usopp-2.png","rcg1_avatar_02.png","rcg1_avatar_04.png","rcg2_avatar_01.png","rcg2_avatar_03.png","rcg2_avatar_04.png","rent-a-gf-chizuru-s1-date-kv.jpg","rent-a-gf-chizuru-s2-date-kv.jpg","rent-a-gf-chizuru-s3-date-kv.jpg","rent-a-gf-mami-s1-date-kv.jpg","rent-a-gf-mami-s2-date-kv_1.jpg","rent-a-gf-mami-s2-date-kv_2.jpg","rent-a-gf-mami-s3-date-kv_1.jpg","rent-a-gf-mami-s3-date-kv_2.jpg","rent-a-gf-ruka-s1-date-kv.jpg","rent-a-gf-ruka-s2-date-kv.jpg","rent-a-gf-ruka-s3-date-kv.jpg","rent-a-gf-sumi-s1-date-kv.jpg","rent-a-gf-yaemori-s3-date-kv.jpg","rent-a-gf-yaemori-s3-main-kv.jpg","rent-a-gf-yaemori-s3-teaser-kv.jpg","rezero_s3_avatar_01.jpg","rezero_s3_avatar_02.jpg","rezero_s3_avatar_04.jpg","rezero_s3_avatar_05.jpg","rezero_s3_avatar_06.jpg","rezero_s3_avatar_07.jpg","rezero_s3_avatar_08.jpg","rezero_s3_avatar_09.jpg","rezero_s3_avatar_10.jpg","rezero_s3_avatar_11.jpg","rezero_s3_avatar_12.jpg","rezero_s3_avatar_13.jpg","rezero_s3_avatar_14.jpg","rezero_s3_avatar_15.jpg","rezero_s3_avatar_16.jpg","rezero_s3_avatar_17.jpg","rezero_s3_avatar_18.jpg","rezero_s3_avatar_19.jpg","rezero_s3_avatar_20.jpg","rezero_s3_avatar_21.jpg","rezero_s3_avatar_22.jpg","rezero_s3_avatar_23.jpg","rouge-1.png","rouge-2.png","rouge-3.png","rouge-4.png","rupa-1.png","rupa-2.png","rupa-3.png","rupa-4.png","rupa-5.png","rwby_avatar_01.png","rwby_avatar_03.png","rwby_avatar_04.png","sarah.png","shangrilafrontier_s2_avatar_1.jpg","shangrilafrontier_s2_avatar_10.jpg","shangrilafrontier_s2_avatar_11.jpg","shangrilafrontier_s2_avatar_12.jpg","shangrilafrontier_s2_avatar_13.jpg","shangrilafrontier_s2_avatar_14.jpg","shangrilafrontier_s2_avatar_15.jpg","shangrilafrontier_s2_avatar_2.jpg","shangrilafrontier_s2_avatar_3.jpg","shangrilafrontier_s2_avatar_4.jpg","shangrilafrontier_s2_avatar_5.jpg","shangrilafrontier_s2_avatar_6.jpg","shangrilafrontier_s2_avatar_7.jpg","shangrilafrontier_s2_avatar_8.jpg","shangrilafrontier_s2_avatar_9.jpg","sololeveling_s2_avatar_1_v2_choi_avatar.png","sololeveling_s2_avatar_2_v2_jinwoo_avatar.png","sololeveling_s2_avatar_3_v2_igris_avatar.png","sololeveling_s2_avatar_4_v2_baek_avatar.png","sololeveling_s2_avatar_5_v2_cha_avatar.png","solo_baekyoonho.png","solo_chahaein.png","solo_choijongin.png","solo_gogunhee.png","solo_sungjinwoo.png","solo_teaser_visual.png","solo_woojinchul.png","solo_yoojinho.png","spidersaurs_avatar_02.png","sss_avatar_01.png","subaru-1.png","subaru-2.png","subaru-3.png","subaru-4.png","subaru-5.png","tog_bam_avatar_1.png","tog_bam_avatar_2.png","tog_bam_avatar_3.png","tog_endorsi_avatar_1.png","tog_endorsi_avatar_2.png","tog_hayuri_avatar_1.png","tog_hwaryun_avatar_1.png","tog_ja_avatar_1.png","tog_ja_avatar_2.png","tog_jihwa_avatar_1.png","tog_jihwa_avatar_2.png","tog_khunaa_avatar_1.png","tog_khunaa_avatar_2.png","tog_khunran_avatar_1.png","tog_rak_avatar_1.png","tog_rak_avatar_2.png","tomo-1.png","tomo-2.png","tomo-3.png","tomo-4.png","tomo-5.png","vijay-1.png","vijay-2.png","wendy-1.png","wendy-2.png"]'),m1=["scale(1).png","scale(10).png","scale(100).png","scale(101).png","scale(102).png","scale(103).png","scale(104).png","scale(105).png","scale(106).png","scale(107).png","scale(108).png","scale(11).png","scale(110).png","scale(111).png","scale(112).png","scale(113).png","scale(114).png","scale(115).png","scale(116).png","scale(117).png","scale(118).png","scale(119).png","scale(12).png","scale(120).png","scale(121).png","scale(122).png","scale(123).png","scale(124).png","scale(125).png","scale(126).png","scale(127).png","scale(128).png","scale(129).png","scale(13).png","scale(130).png","scale(131).png","scale(132).png","scale(133).png","scale(134).png","scale(135).png","scale(136).png","scale(137).png","scale(138).png","scale(139).png","scale(14).png","scale(140).png","scale(141).png","scale(142).png","scale(143).png","scale(144).png","scale(145).png","scale(146).png","scale(147).png","scale(148).png","scale(149).png","scale(15).png","scale(150).png","scale(151).png","scale(152).png","scale(153).png","scale(154).png","scale(155).png","scale(156).png","scale(157).png","scale(158).png","scale(159).png","scale(16).png","scale(160).png","scale(161).png","scale(162).png","scale(163).png","scale(164).png","scale(165).png","scale(166).png","scale(167).png","scale(168).png","scale(169).png","scale(17).png","scale(170).png","scale(171).png","scale(172).png","scale(173).png","scale(174).png","scale(175).png","scale(176).png","scale(177).png","scale(178).png","scale(179).png","scale(18).png","scale(180).png","scale(181).png","scale(182).png","scale(183).png","scale(184).png","scale(185).png","scale(186).png","scale(187).png","scale(189).png","scale(19).png","scale(190).png","scale(191).png","scale(192).png","scale(193).png","scale(194).png","scale(195).png","scale(196).png","scale(197).png","scale(198).png","scale(199).png","scale(2).png","scale(20).png","scale(200).png","scale(201).png","scale(202).png","scale(203).png","scale(204).png","scale(205).png","scale(206).png","scale(207).png","scale(208).png","scale(209).png","scale(21).png","scale(210).png","scale(211).png","scale(212).png","scale(22).png","scale(23).png","scale(24).png","scale(25).png","scale(26).png","scale(27).png","scale(28).png","scale(29).png","scale(3).png","scale(30).png","scale(31).png","scale(32).png","scale(33).png","scale(34).png","scale(35).png","scale(36).png","scale(37).png","scale(38).png","scale(39).png","scale(4).png","scale(40).png","scale(41).png","scale(42).png","scale(43).png","scale(44).png","scale(45).png","scale(46).png","scale(47).png","scale(48).png","scale(49).png","scale(5).png","scale(50).png","scale(51).png","scale(52).png","scale(53).png","scale(54).png","scale(55).png","scale(56).png","scale(57).png","scale(58).png","scale(59).png","scale(6).png","scale(60).png","scale(61).png","scale(62).png","scale(63).png","scale(64).png","scale(65).png","scale(66).png","scale(67).png","scale(68).png","scale(69).png","scale(7).png","scale(70).png","scale(71).png","scale(72).png","scale(73).png","scale(74).png","scale(75).png","scale(76).png","scale(77).png","scale(78).png","scale(79).png","scale(8).png","scale(80).png","scale(81).png","scale(82).png","scale(83).png","scale(84).png","scale(85).png","scale(86).png","scale(87).png","scale(88).png","scale(89).png","scale(9).png","scale(90).png","scale(91).png","scale(92).png","scale(93).png","scale(94).png","scale(95).png","scale(96).png","scale(97).png","scale(98).png","scale(99).png"],Vc={Netflix:h1,Crunchyroll:f1,DisneyPlus:m1},Ku=({isOpen:i,onClose:e,onSave:t,userId:s})=>{const[n,r]=w.useState(Object.keys(Vc)[0]),[l,c]=w.useState(null),[d,u]=w.useState(!1);if(w.useEffect(()=>{i&&(r(Object.keys(Vc)[0]),c(null))},[i]),!i)return null;const f=Object.keys(Vc),g=Vc[n]||[],y=async()=>{if(l){u(!0);try{const S=await(await fetch(l)).blob(),T=`avatar.${l.split(".").pop().split("?")[0]||"png"}`,A=new File([S],T,{type:S.type});await t(A)}catch(x){console.error("Failed to fetch avatar blob",x)}finally{u(!1)}}};return p.jsx("div",{className:"apm-overlay",onClick:e,children:p.jsxs("div",{className:"apm-modal",onClick:x=>x.stopPropagation(),children:[p.jsxs("div",{className:"apm-header",children:[p.jsx("h2",{children:"Choose Avatar"}),p.jsx("button",{className:"apm-close",onClick:e,children:""})]}),p.jsxs("div",{className:"apm-body",children:[p.jsx("div",{className:"apm-sidebar",children:f.map(x=>p.jsx("button",{className:`apm-cat-btn ${n===x?"active":""}`,onClick:()=>r(x),children:x},x))}),p.jsx("div",{className:"apm-content",children:p.jsx("div",{className:"apm-grid",children:g.map(x=>{const E=`/legitflix/client/avatars/${n}/${x}`;return p.jsx("div",{className:`apm-item ${l===E?"selected":""}`,onClick:()=>c(E),children:p.jsx("div",{className:"apm-img-wrapper",children:p.jsx("img",{src:E,alt:x,loading:"lazy"})})},x)})})})]}),p.jsxs("div",{className:"apm-footer",children:[p.jsx("button",{className:"apm-btn-cancel",onClick:e,disabled:d,children:"Cancel"}),p.jsx("button",{className:"apm-btn-save",onClick:y,disabled:!l||d,children:d?"Saving...":"Set Avatar"})]})]})})},Ev=[{name:"Orange",value:"#ff7e00"},{name:"Blue",value:"#00aaff"},{name:"Pink",value:"#ff00aa"},{name:"Green",value:"#00ff7e"},{name:"Red",value:"#ff3333"},{name:"Purple",value:"#aa00ff"}],$S=({isOpen:i,onClose:e,userId:t})=>{const{config:s,updateConfig:n}=Wi(),[r,l]=w.useState("appearance"),[c,d]=w.useState(""),[u,f]=w.useState(!1),[g,y]=w.useState(!1),[x,S]=w.useState("app"),[E,T]=w.useState(!1),[A,I]=w.useState(s.accentColor||"#ff7e00"),[_,C]=w.useState(s.logoUrl||""),[k,D]=w.useState(s.showNavbarCategories!==!1),[O,F]=w.useState(s.enableJellyseerr!==!1),[j,U]=w.useState(s.jellyseerrUrl||"https://request.legitflix.eu"),[K,H]=w.useState(s.showLibraryTitles!==!1),[ee,re]=w.useState(s.showNavbarRequests!==!1),[de,M]=w.useState(""),[V,q]=w.useState(s.contentTypeFilters||{Movie:!0,Series:!0,MusicAlbum:!1,Audio:!1,MusicVideo:!1}),[ae,pe]=w.useState(s.contentSortMode||"latest"),[P,$]=w.useState(s.playerSeekForward||30),[G,fe]=w.useState(s.playerSeekBackward||10),[ge,_e]=w.useState(s.defaultAudioLanguage||"auto"),[Ne,Ge]=w.useState(s.defaultSubtitleLanguage||"auto"),[Be,pt]=w.useState(s.autoSkipIntro||!1),[At,Vt]=w.useState(s.autoSkipOutro||!1),[bt,gt]=w.useState(s.subtitleSize||"100%"),[zt,Fe]=w.useState(s.subtitleColor||"#ffffff"),[we,Ue]=w.useState(s.subtitleBackground||"drop-shadow");w.useEffect(()=>{i&&(I(s.accentColor||"#ff7e00"),C(s.logoUrl||""),D(s.showNavbarCategories!==!1),F(s.enableJellyseerr!==!1),U(s.jellyseerrUrl||"https://request.legitflix.eu"),H(s.showLibraryTitles!==!1),re(s.showNavbarRequests!==!1),q(s.contentTypeFilters||{Movie:!0,Series:!0,MusicAlbum:!1,Audio:!1,MusicVideo:!1}),pe(s.contentSortMode||"latest"),$(s.playerSeekForward||30),fe(s.playerSeekBackward||10),_e(s.defaultAudioLanguage||"auto"),Ge(s.defaultSubtitleLanguage||"auto"),pt(s.autoSkipIntro||!1),Vt(s.autoSkipOutro||!1),gt(s.subtitleSize||"100%"),Fe(s.subtitleColor||"#ffffff"),Ue(s.subtitleBackground||"drop-shadow"),d(""),Ev.some(ye=>ye.value===s.accentColor)||M(s.accentColor))},[i,s]),w.useEffect(()=>(i?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[i]);const qe=ye=>{I(ye),M("")},dt=ye=>{const We=ye.target.value;M(We),/^#[0-9A-F]{6}$/i.test(We)&&I(We)},Ce=()=>{const ye=Object.entries(V).filter(([,ls])=>ls).map(([ls])=>ls),We=ye.length>0?ye.join(","):"Movie,Series",it=ye.length>0?ye:["Movie","Series"];n({accentColor:A,logoUrl:_,logoType:_?"image":"text",showNavbarCategories:k,enableJellyseerr:O,jellyseerrUrl:j,showLibraryTitles:K,showNavbarRequests:ee,contentTypeFilters:V,heroMediaTypes:We,promoMediaTypes:it,contentSortMode:ae,playerSeekForward:P,playerSeekBackward:G,defaultAudioLanguage:ge,defaultSubtitleLanguage:Ne,autoSkipIntro:Be,autoSkipOutro:At,subtitleSize:bt,subtitleColor:zt,subtitleBackground:we}),e()},He=()=>{I("#ff7e00"),C(""),M(""),D(!0),F(!0),U("https://request.legitflix.eu"),H(!0),re(!0),q({Movie:!0,Series:!0,MusicAlbum:!1,Audio:!1,MusicVideo:!1}),pe("latest"),$(30),fe(10),_e("auto"),Ge("auto"),gt("100%"),Fe("#ffffff"),Ue("drop-shadow")},Tt=async ye=>{if(!(!ye||!t)){T(!0);try{(await fetch(`${te.api.basePath}/Users/${t}/Images/Primary`,{method:"POST",headers:{"Content-Type":ye.type,"X-Emby-Authorization":te.api.authHeader},body:ye})).ok&&y(!1)}catch(We){console.error("Avatar upload failed",We)}finally{T(!1)}}},Kt=[{id:"accentColor",tab:"appearance",label:"Accent Color",keywords:["color","theme","style","appearance"],render:()=>p.jsxs("div",{className:"setting-section",children:[p.jsx("h3",{children:"Accent Color"}),p.jsx("div",{className:"color-presets",children:Ev.map(ye=>p.jsx("div",{className:`color-preset ${A===ye.value?"selected":""}`,style:{backgroundColor:ye.value},onClick:()=>qe(ye.value),title:ye.name,children:A===ye.value&&p.jsx("span",{className:"material-icons",children:"check"})},ye.value))}),p.jsxs("div",{className:"custom-color-input",children:[p.jsx("label",{children:"Custom Hex:"}),p.jsx("input",{type:"text",placeholder:"#RRGGBB",value:de,onChange:dt,maxLength:7}),p.jsx("div",{className:"color-preview",style:{backgroundColor:A}})]})]},"accentColor")},{id:"logoUrl",tab:"appearance",label:"Custom Logo URL",keywords:["logo","image","branding","appearance"],render:()=>p.jsxs("div",{className:"setting-section",children:[p.jsx("h3",{children:"Custom Logo URL"}),p.jsx("p",{className:"setting-desc",children:"Enter a direct URL to an image to replace the top-left logo."}),p.jsx("input",{type:"text",className:"legit-input",placeholder:"https://example.com/logo.png",value:_,onChange:ye=>C(ye.target.value)})]},"logoUrl")},{id:"faviconUrl",tab:"appearance",label:"Custom Favicon URL",keywords:["favicon","icon","tab","browser","branding"],render:()=>p.jsxs("div",{className:"setting-section",children:[p.jsx("h3",{children:"Custom Favicon URL"}),p.jsx("p",{className:"setting-desc",children:"Enter a direct URL to an image to use as the browser tab icon."}),p.jsx("input",{type:"text",className:"legit-input",placeholder:"https://example.com/favicon.ico",value:s.faviconUrl||"",onChange:ye=>n({faviconUrl:ye.target.value})})]},"faviconUrl")},{id:"avatar",tab:"appearance",label:"Profile Avatar",keywords:["avatar","profile","image","picture","user"],render:()=>p.jsxs("div",{className:"setting-section",children:[p.jsx("h3",{children:"Profile Avatar"}),p.jsx("p",{className:"setting-desc",children:"Change your user profile picture."}),p.jsx("div",{className:"setting-row",children:p.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[p.jsx("img",{src:`${te.api.basePath}/Users/${t}/Images/Primary?quality=90&t=${Date.now()}`,alt:"Current Avatar",style:{width:"50px",height:"50px",borderRadius:"50%",objectFit:"cover",border:"2px solid rgba(255,255,255,0.1)"},onError:ye=>{ye.target.style.display="none"}}),p.jsxs("button",{className:"lf-btn lf-btn--secondary",onClick:()=>y(!0),children:[p.jsx("span",{className:"material-icons",style:{fontSize:"18px",marginRight:"8px"},children:"face"}),"Change Avatar"]})]})})]},"avatar")},{id:"requestFeature",tab:"home",label:"Request Feature (Jellyseerr)",keywords:["request","jellyseerr","ombi","home","card"],render:()=>p.jsxs(p.Fragment,{children:[p.jsxs("div",{className:"setting-section",children:[p.jsxs("div",{className:"setting-row",children:[p.jsxs("div",{children:[p.jsx("h3",{className:"setting-title",children:"Request Feature"}),p.jsx("p",{className:"setting-desc",children:'Enable "Request" card on Home screen'})]}),p.jsxs("label",{className:"toggle-switch",children:[p.jsx("input",{type:"checkbox",checked:O,onChange:ye=>F(ye.target.checked)}),p.jsx("span",{className:"slider"})]})]}),p.jsxs("div",{className:"fade-in",style:{marginTop:"10px"},children:[p.jsx("p",{className:"setting-desc",children:"Request URL (Required for both Home Card and Navbar):"}),p.jsx("input",{type:"text",className:"legit-input",placeholder:"https://request.legitflix.eu",value:j,onChange:ye=>U(ye.target.value)})]})]},"requestFeature"),p.jsxs("div",{className:"setting-section",children:[p.jsx("h3",{children:"Card Appearance"}),p.jsx("p",{className:"setting-desc",children:"Customize the look of the Request card on the Home screen."}),p.jsx("div",{className:"setting-row",style:{marginBottom:"15px"},children:p.jsxs("div",{style:{flex:1},children:[p.jsx("label",{className:"setting-label",style:{display:"block",marginBottom:"5px",fontSize:"0.9rem"},children:"Card Title"}),p.jsx("input",{type:"text",className:"legit-input",placeholder:"Request Feature",value:s.jellyseerrText||"",onChange:ye=>n({jellyseerrText:ye.target.value})})]})}),p.jsx("div",{className:"setting-row",style:{flexDirection:"column",alignItems:"stretch",gap:"10px"},children:p.jsxs("div",{children:[p.jsx("label",{className:"setting-label",style:{display:"block",marginBottom:"5px",fontSize:"0.9rem"},children:"Card Background URL"}),p.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[p.jsx("div",{style:{width:"120px",height:"68px",borderRadius:"6px",backgroundColor:"#2a2a2a",backgroundImage:`url('${s.jellyseerrBackground||"https://raw.githubusercontent.com/gorillasuti/Legitflix-plugin/refs/heads/main/legitflix-client/public/jellyseerr.jpg"}')`,backgroundSize:"cover",backgroundPosition:"center",border:"1px solid rgba(255,255,255,0.1)",flexShrink:0}}),p.jsx("input",{type:"text",className:"legit-input",style:{marginTop:0},placeholder:"https://example.com/background.jpg",value:s.jellyseerrBackground||"",onChange:ye=>n({jellyseerrBackground:ye.target.value||null})})]})]})})]},"requestFeatureCustomization")]})},{id:"libraryTitles",tab:"home",label:"Show Library Titles",keywords:["library","names","titles","overlay","home"],render:()=>p.jsx("div",{className:"setting-section",children:p.jsxs("div",{className:"setting-row",children:[p.jsxs("div",{children:[p.jsx("h3",{className:"setting-title",children:"Show Library Titles"}),p.jsx("p",{className:"setting-desc",children:"Display text overlay on library cards"})]}),p.jsxs("label",{className:"toggle-switch",children:[p.jsx("input",{type:"checkbox",checked:K,onChange:ye=>H(ye.target.checked)}),p.jsx("span",{className:"slider"})]})]})},"libraryTitles")},{id:"contentFilters",tab:"home",label:"Content Filters",keywords:["content","media","type","movie","series","music","filter","carousel","promo","hero"],render:()=>{const ye=[{key:"Movie",label:"Movies",icon:"movie"},{key:"Series",label:"Series",icon:"tv"},{key:"MusicAlbum",label:"Music Albums",icon:"album"},{key:"Audio",label:"Audio",icon:"audiotrack"},{key:"MusicVideo",label:"Music Videos",icon:"music_video"}];return p.jsxs("div",{className:"setting-section",children:[p.jsx("h3",{children:"Content Filters"}),p.jsx("p",{className:"setting-desc",children:"Choose which media types appear in the Hero Carousel and Promo Banner."}),p.jsx("div",{className:"content-type-grid",children:ye.map(We=>p.jsxs("label",{className:`content-type-chip ${V[We.key]?"active":""}`,children:[p.jsx("input",{type:"checkbox",checked:!!V[We.key],onChange:it=>q(ls=>({...ls,[We.key]:it.target.checked}))}),p.jsx("span",{className:"material-icons",children:We.icon}),p.jsx("span",{children:We.label})]},We.key))})]},"contentFilters")}},{id:"displayOrder",tab:"home",label:"Display Order",keywords:["sort","order","random","latest","rated","carousel","promo","display"],render:()=>{const ye=[{key:"latest",label:"Latest",icon:"schedule",desc:"Newest additions first"},{key:"random",label:"Random",icon:"shuffle",desc:"Shuffled each visit"},{key:"topRated",label:"Top Rated",icon:"star",desc:"Highest community rating"}];return p.jsxs("div",{className:"setting-section",children:[p.jsx("h3",{children:"Display Order"}),p.jsx("p",{className:"setting-desc",children:"How content is sorted in the Hero Carousel and Promo Banner."}),p.jsx("div",{className:"content-type-grid",children:ye.map(We=>p.jsxs("label",{className:`content-type-chip ${ae===We.key?"active":""}`,title:We.desc,children:[p.jsx("input",{type:"radio",name:"sortMode",checked:ae===We.key,onChange:()=>pe(We.key)}),p.jsx("span",{className:"material-icons",children:We.icon}),p.jsx("span",{children:We.label})]},We.key))})]},"displayOrder")}},{id:"navbarCategories",tab:"navigation",label:"Show Categories in Navbar",keywords:["navigation","menu","navbar","categories","links"],render:()=>p.jsx("div",{className:"setting-section",children:p.jsxs("div",{className:"setting-row",children:[p.jsxs("div",{children:[p.jsx("h3",{className:"setting-title",children:"Show Categories in Navbar"}),p.jsx("p",{className:"setting-desc",children:"Display library links in the top navigation bar"})]}),p.jsxs("label",{className:"toggle-switch",children:[p.jsx("input",{type:"checkbox",checked:k,onChange:ye=>D(ye.target.checked)}),p.jsx("span",{className:"slider"})]})]})},"navbarCategories")},{id:"navbarRequests",tab:"navigation",label:"Show Requests in Navbar",keywords:["navigation","navbar","requests","jellyseerr"],render:()=>p.jsx("div",{className:"setting-section",children:p.jsxs("div",{className:"setting-row",children:[p.jsxs("div",{children:[p.jsx("h3",{className:"setting-title",children:"Show Requests in Navbar"}),p.jsx("p",{className:"setting-desc",children:'Display the "Requests" link next to categories in the navbar'})]}),p.jsxs("label",{className:"toggle-switch",children:[p.jsx("input",{type:"checkbox",checked:ee,onChange:ye=>re(ye.target.checked)}),p.jsx("span",{className:"slider"})]})]})},"navbarRequests")},{id:"playerSeek",tab:"player",label:"Seek Durations",keywords:["player","seek","skip","forward","backward","time"],render:()=>p.jsxs("div",{className:"setting-section",children:[p.jsx("div",{className:"setting-row",children:p.jsxs("div",{children:[p.jsx("h3",{className:"setting-title",children:"Seek Durations"}),p.jsx("p",{className:"setting-desc",children:"Customize how many seconds to skip forward or backward."})]})}),p.jsxs("div",{className:"setting-row",style:{alignItems:"flex-start",gap:"20px"},children:[p.jsxs("div",{style:{flex:1},children:[p.jsx("label",{className:"setting-label",children:"Seek Forward (Right Arrow)"}),p.jsxs("div",{className:"time-stepper",children:[p.jsx("button",{className:"stepper-btn",onClick:()=>$(ye=>Math.max(5,ye-5)),disabled:P<=5,children:p.jsx("span",{className:"material-icons",children:"remove"})}),p.jsxs("div",{className:"stepper-value",children:[p.jsx("span",{className:"stepper-number",children:P}),p.jsx("span",{className:"stepper-unit",children:"sec"})]}),p.jsx("button",{className:"stepper-btn",onClick:()=>$(ye=>Math.min(300,ye+5)),disabled:P>=300,children:p.jsx("span",{className:"material-icons",children:"add"})})]})]}),p.jsxs("div",{style:{flex:1},children:[p.jsx("label",{className:"setting-label",children:"Seek Backward (Left Arrow)"}),p.jsxs("div",{className:"time-stepper",children:[p.jsx("button",{className:"stepper-btn",onClick:()=>fe(ye=>Math.max(5,ye-5)),disabled:G<=5,children:p.jsx("span",{className:"material-icons",children:"remove"})}),p.jsxs("div",{className:"stepper-value",children:[p.jsx("span",{className:"stepper-number",children:G}),p.jsx("span",{className:"stepper-unit",children:"sec"})]}),p.jsx("button",{className:"stepper-btn",onClick:()=>fe(ye=>Math.min(300,ye+5)),disabled:G>=300,children:p.jsx("span",{className:"material-icons",children:"add"})})]})]})]})]},"playerSeek")},{id:"playerLanguages",tab:"player",label:"Default Languages",keywords:["player","audio","subtitle","language","default","dub"],render:()=>{const ye=[{code:"auto",label:"Auto (Server Default)"},{code:"eng",label:"English"},{code:"hun",label:"Hungarian (Magyar)"},{code:"ger",label:"German (Deutsch)"},{code:"jpn",label:"Japanese ()"},{code:"spa",label:"Spanish (Espaol)"},{code:"fre",label:"French (Franais)"},{code:"ita",label:"Italian (Italiano)"},{code:"por",label:"Portuguese (Portugus)"},{code:"rus",label:"Russian ()"},{code:"chi",label:"Chinese ()"},{code:"kor",label:"Korean ()"},{code:"ara",label:"Arabic ()"},{code:"hin",label:"Hindi ()"},{code:"pol",label:"Polish (Polski)"},{code:"dut",label:"Dutch (Nederlands)"},{code:"swe",label:"Swedish (Svenska)"},{code:"nor",label:"Norwegian (Norsk)"},{code:"dan",label:"Danish (Dansk)"},{code:"fin",label:"Finnish (Suomi)"},{code:"tur",label:"Turkish (Trke)"},{code:"tha",label:"Thai ()"},{code:"vie",label:"Vietnamese (Ting Vit)"},{code:"ukr",label:"Ukrainian ()"},{code:"cze",label:"Czech (etina)"},{code:"rum",label:"Romanian (Romn)"},{code:"gre",label:"Greek ()"},{code:"heb",label:"Hebrew ()"}],We=[{code:"auto",label:"Auto (Server Default)"},{code:"none",label:"None (Disabled)"},...ye.filter(it=>it.code!=="auto")];return p.jsxs("div",{className:"setting-section",children:[p.jsx("div",{className:"setting-row",children:p.jsxs("div",{children:[p.jsx("h3",{className:"setting-title",children:"Default Languages"}),p.jsx("p",{className:"setting-desc",children:"Preferred audio and subtitle languages for new playback."})]})}),p.jsxs("div",{className:"setting-row",style:{alignItems:"flex-start",gap:"20px"},children:[p.jsxs("div",{style:{flex:1},children:[p.jsx("label",{className:"setting-label",children:"Default Audio Language"}),p.jsx("select",{className:"legit-input",value:ge,onChange:it=>_e(it.target.value),children:ye.map(it=>p.jsx("option",{value:it.code,children:it.label},it.code))})]}),p.jsxs("div",{style:{flex:1},children:[p.jsx("label",{className:"setting-label",children:"Default Subtitle Language"}),p.jsx("select",{className:"legit-input",value:Ne,onChange:it=>Ge(it.target.value),children:We.map(it=>p.jsx("option",{value:it.code,children:it.label},it.code))})]})]})]},"playerLanguages")}},{id:"playerAutoSkip",tab:"player",label:"Auto Skip",keywords:["player","skip","intro","outro","auto","chapter"],render:()=>p.jsxs("div",{className:"setting-section",children:[p.jsxs("div",{className:"setting-row",children:[p.jsxs("div",{children:[p.jsx("h3",{className:"setting-title",children:"Auto Skip Intro"}),p.jsx("p",{className:"setting-desc",children:"Automatically skip intro segments when detected by Jellyfin chapters."})]}),p.jsxs("label",{className:"toggle-switch",children:[p.jsx("input",{type:"checkbox",checked:Be,onChange:ye=>pt(ye.target.checked)}),p.jsx("span",{className:"slider"})]})]}),p.jsxs("div",{className:"setting-row",children:[p.jsxs("div",{children:[p.jsx("h3",{className:"setting-title",children:"Auto Skip Outro"}),p.jsx("p",{className:"setting-desc",children:"Automatically skip outro/credits segments when detected by Jellyfin chapters."})]}),p.jsxs("label",{className:"toggle-switch",children:[p.jsx("input",{type:"checkbox",checked:At,onChange:ye=>Vt(ye.target.checked)}),p.jsx("span",{className:"slider"})]})]})]},"playerAutoSkip")},{id:"subtitleAppearance",tab:"player",label:"Subtitle Appearance",keywords:["subtitle","appearance","style","color","size","background","font"],render:()=>p.jsxs("div",{className:"setting-section",children:[p.jsx("h3",{className:"setting-title",children:"Subtitle Appearance"}),p.jsx("p",{className:"setting-desc",children:"Customize how subtitles look in the player."}),p.jsxs("div",{className:"setting-row",style:{alignItems:"flex-start",gap:"20px"},children:[p.jsxs("div",{style:{flex:1},children:[p.jsx("label",{className:"setting-label",children:"Size"}),p.jsxs("select",{className:"legit-input",value:bt,onChange:ye=>gt(ye.target.value),children:[p.jsx("option",{value:"75%",children:"Small"}),p.jsx("option",{value:"100%",children:"Medium"}),p.jsx("option",{value:"125%",children:"Large"}),p.jsx("option",{value:"150%",children:"Extra Large"}),p.jsx("option",{value:"200%",children:"Huge"})]})]}),p.jsxs("div",{style:{flex:1},children:[p.jsx("label",{className:"setting-label",children:"Background Style"}),p.jsxs("select",{className:"legit-input",value:we,onChange:ye=>Ue(ye.target.value),children:[p.jsx("option",{value:"none",children:"None"}),p.jsx("option",{value:"drop-shadow",children:"Drop Shadow"}),p.jsx("option",{value:"outline",children:"Outline"}),p.jsx("option",{value:"box",children:"Box (Semi-Transparent)"})]})]})]}),p.jsxs("div",{className:"setting-row",style:{marginTop:"16px",display:"block"},children:[p.jsx("label",{className:"setting-label",style:{marginBottom:"8px",display:"block"},children:"Text Color"}),p.jsx("div",{className:"color-presets",style:{gap:"10px"},children:[{name:"White",value:"#ffffff"},{name:"Yellow",value:"#ffff00"},{name:"Cyan",value:"#00ffff"},{name:"Green",value:"#00ff00"},{name:"Magenta",value:"#ff00ff"},{name:"Red",value:"#ff0000"},{name:"Black",value:"#000000"}].map(ye=>p.jsx("div",{className:`color-preset ${zt===ye.value?"selected":""}`,style:{backgroundColor:ye.value,width:"30px",height:"30px",borderRadius:"50%",cursor:"pointer",border:zt===ye.value?"2px solid white":"1px solid #444",position:"relative"},onClick:()=>Fe(ye.value),title:ye.name,children:zt===ye.value&&p.jsx("span",{className:"material-icons",style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"18px",color:ye.value==="#ffffff"||ye.value==="#ffff00"||ye.value==="#00ff00"||ye.value==="#00ffff"?"black":"white"},children:"check"})},ye.value))})]})]},"subtitleAppearance")}].filter(ye=>{if(!c)return ye.tab===r;const We=c.toLowerCase();return ye.label.toLowerCase().includes(We)||ye.keywords.some(it=>it.includes(We))});return i?p.jsxs(p.Fragment,{children:[p.jsx("div",{className:"legit-settings-overlay",onClick:e,children:p.jsxs("div",{className:"legit-settings-modal expanded",onClick:ye=>ye.stopPropagation(),children:[p.jsxs("div",{className:"legit-settings-sidebar",children:[p.jsx("div",{className:"sidebar-header",children:p.jsx("h2",{children:"Settings"})}),p.jsxs("div",{className:"sidebar-tabs",children:[p.jsxs("button",{className:`sidebar-tab ${r==="appearance"&&!c?"active":""}`,onClick:()=>{l("appearance"),d("")},children:[p.jsx("span",{className:"material-icons",children:"palette"})," Appearance"]}),p.jsxs("button",{className:`sidebar-tab ${r==="home"&&!c?"active":""}`,onClick:()=>{l("home"),d("")},children:[p.jsx("span",{className:"material-icons",children:"home"})," Home Screen"]}),p.jsxs("button",{className:`sidebar-tab ${r==="navigation"&&!c?"active":""}`,onClick:()=>{l("navigation"),d("")},children:[p.jsx("span",{className:"material-icons",children:"menu"})," Navigation"]}),p.jsxs("button",{className:`sidebar-tab ${r==="player"&&!c?"active":""}`,onClick:()=>{l("player"),d("")},children:[p.jsx("span",{className:"material-icons",children:"play_circle"})," Player"]})]})]}),p.jsxs("div",{className:"legit-settings-content",children:[p.jsxs("div",{className:"content-header",children:[p.jsxs("div",{className:"search-container",children:[p.jsx("span",{className:"material-icons search-icon",children:"search"}),p.jsx("input",{type:"text",placeholder:"Search settings...",value:c,onChange:ye=>d(ye.target.value)}),c&&p.jsx("button",{className:"clear-search",onClick:()=>d(""),children:p.jsx("span",{className:"material-icons",children:"close"})})]}),p.jsx("button",{className:"close-btn-icon",onClick:e,children:""})]}),p.jsx("div",{className:"content-body",children:Kt.length>0?Kt.map(ye=>ye.render()):p.jsxs("div",{className:"no-results",children:[p.jsx("span",{className:"material-icons",children:"search_off"}),p.jsxs("p",{children:['No settings found for "',c,'"']})]})}),p.jsxs("div",{className:"content-footer",children:[p.jsx("button",{className:"btn-reset",onClick:He,children:"Reset Defaults"}),p.jsx("button",{className:"btn-save lf-btn--ring-hover",onClick:Ce,children:"Save Changes"})]})]})]})}),p.jsx(Pm,{isOpen:u,onClose:()=>f(!1),onSave:ye=>{x==="app"?n({appBackground:ye}):x==="jellyseerr"&&n({jellyseerrBackground:ye}),f(!1)},userId:t}),p.jsx(Ku,{isOpen:g,onClose:()=>y(!1),onSave:Tt,userId:t})]}):null},p1=({isOpen:i,onClose:e})=>{const[t,s]=w.useState(""),[n,r]=w.useState(""),[l,c]=w.useState(""),d=async()=>{if(t.trim()){r("loading"),c("");try{const u=await fetch(`${te.api.basePath}/QuickConnect/Authorize`,{method:"POST",headers:{"Content-Type":"application/json","X-Emby-Authorization":te.api.authHeader},body:JSON.stringify({Code:t.trim()})});if(u.ok)r("success"),setTimeout(()=>{s(""),r(""),e()},1500);else{const f=await u.json().catch(()=>({}));r("error"),c(f.Message||"Invalid code. Please try again.")}}catch{r("error"),c("Connection failed. Please try again.")}}};return i?p.jsx("div",{className:"qc-overlay",onClick:e,children:p.jsxs("div",{className:"qc-modal",onClick:u=>u.stopPropagation(),children:[p.jsxs("div",{className:"qc-header",children:[p.jsx("span",{className:"material-icons qc-icon",children:"qr_code"}),p.jsx("h2",{children:"Quick Connect"}),p.jsx("button",{className:"qc-close",onClick:e,children:""})]}),p.jsx("p",{className:"qc-desc",children:"Enter the code displayed on your other device to link it to your account."}),p.jsx("input",{className:"qc-input",type:"text",placeholder:"Enter Quick Connect code",value:t,onChange:u=>s(u.target.value),onKeyDown:u=>{u.key==="Enter"&&d()},autoFocus:!0}),n==="error"&&p.jsx("p",{className:"qc-error",children:l}),n==="success"&&p.jsx("p",{className:"qc-success",children:"Connected successfully!"}),p.jsx("button",{className:"qc-submit",onClick:d,disabled:n==="loading"||!t.trim(),children:n==="loading"?"Connecting...":"Authorize"})]})}):null},g1=({isOpen:i,onClose:e,user:t})=>{const[s,n]=w.useState(!1),[r,l]=w.useState(""),[c,d]=w.useState(!1),[u,f]=w.useState(!1),g=w.useRef(null),y=t?t.ImageTags?.Banner?`${te.api.basePath}/Users/${t.Id}/Images/Banner?tag=${t.ImageTags.Banner}&quality=90`:t.BackdropImageTags?.[0]?`${te.api.basePath}/Users/${t.Id}/Images/Backdrop/0?tag=${t.BackdropImageTags[0]}&quality=90`:"":"",x=async A=>{if(!(!t||!A)){l("Updating banner..."),n(!0);try{const _=await(await fetch(A)).blob();await te.uploadUserImage(t.Id,"Banner",_),l("Banner updated! Refresh to see changes.")}catch(I){console.error(I),l("Banner upload failed.")}finally{n(!1)}}};if(!i||!t)return null;const S=async A=>{if(A){n(!0),l("");try{await te.uploadUserImage(t.Id,"Primary",A),l("Profile image updated! Refresh to see changes."),f(!1)}catch(I){console.error(I),l("Upload failed. Check your connection.")}finally{n(!1)}}},E=A=>{const I=A.target.files?.[0];S(I)},T=async()=>{n(!0),l("");try{await te.deleteUserImage(t.Id,"Primary"),l("Profile image removed.")}catch(A){console.error(A),l("Failed to remove image.")}finally{n(!1)}};return p.jsxs(p.Fragment,{children:[p.jsx("div",{className:"pm-overlay",onClick:e,children:p.jsxs("div",{className:"pm-modal",onClick:A=>A.stopPropagation(),children:[p.jsx("button",{className:"pm-close-floating",onClick:e,children:p.jsx("span",{className:"material-icons",children:"close"})}),p.jsxs("div",{className:"pm-cover",children:[y?p.jsx("img",{src:y,alt:"Banner",className:"pm-cover-img"}):p.jsx("div",{style:{width:"100%",height:"100%",background:"#333",display:"flex",alignItems:"center",justifyContent:"center"},children:p.jsx("span",{className:"material-icons",style:{fontSize:"48px",opacity:.1},children:"wallpaper"})}),p.jsx("div",{className:"pm-cover-overlay",children:p.jsxs("button",{className:"pm-edit-cover-btn",onClick:()=>d(!0),disabled:s,children:[p.jsx("span",{className:"material-icons",children:"edit"}),"Change Cover"]})})]}),p.jsxs("div",{className:"pm-profile-header",children:[p.jsxs("div",{className:"pm-avatar-container",children:[p.jsx("img",{src:`${te.api.basePath}/Users/${t.Id}/Images/Primary?quality=90&t=${Date.now()}`,alt:t.Name,className:"pm-avatar-img",onError:A=>{A.target.style.display="none"}}),p.jsx("div",{className:"pm-avatar-edit-overlay",onClick:()=>f(!0),children:p.jsx("span",{className:"material-icons",children:"photo_camera"})})]}),p.jsxs("div",{className:"pm-user-details",children:[p.jsx("h2",{children:t.Name}),p.jsxs("p",{children:[p.jsx("span",{className:"material-icons",style:{fontSize:"16px"},children:t?.Policy?.IsAdministrator?"shield":"person"}),t?.Policy?.IsAdministrator?"Administrator":"User"]})]})]}),p.jsx("div",{className:"pm-divider"}),p.jsxs("div",{className:"pm-actions",children:[p.jsxs("button",{className:"pm-action-row",onClick:()=>g.current?.click(),disabled:s,children:[p.jsx("span",{className:"material-icons",children:"upload"}),p.jsx("span",{children:"Upload Custom Avatar"})]}),p.jsxs("button",{className:"pm-action-row danger",onClick:T,disabled:s,children:[p.jsx("span",{className:"material-icons",children:"delete"}),p.jsx("span",{children:"Remove Avatar"})]})]}),r&&p.jsx("div",{className:"pm-status",children:r}),p.jsx("input",{ref:g,type:"file",accept:"image/*",style:{display:"none"},onChange:E})]})}),p.jsx(Pm,{isOpen:c,onClose:()=>d(!1),onSave:A=>{x(A),d(!1)},userId:t?.Id}),p.jsx(Ku,{isOpen:u,onClose:()=>f(!1),onSave:S,userId:t?.Id})]})},_a=({alwaysFilled:i=!1})=>{const{config:e}=Wi(),[t,s]=w.useState(null),[n,r]=w.useState([]),[l,c]=w.useState(!1),[d,u]=w.useState(!1),[f,g]=w.useState(!1),[y,x]=w.useState(!1),[S,E]=w.useState(!1),[T,A]=w.useState(!1),[I,_]=w.useState(!1),[C,k]=w.useState(!1),[D,O]=w.useState(!1),F=js(),j=Qx.useRef(null);w.useEffect(()=>{(async()=>{try{const ee=await te.getCurrentUser();if(s(ee),ee&&e.showNavbarCategories){const re=await te.getUserViews(ee.Id);re&&re.Items&&r(re.Items)}}catch(ee){console.error("Navbar fetch error",ee)}})()},[e.showNavbarCategories]),w.useEffect(()=>{const H=()=>{c(window.scrollY>50)};return window.addEventListener("scroll",H),()=>window.removeEventListener("scroll",H)},[]),w.useEffect(()=>{const H=ee=>{ee.target.closest(".nav-avatar-container")||g(!1)};return document.addEventListener("click",H),()=>document.removeEventListener("click",H)},[]),w.useEffect(()=>{(async()=>{try{if(!te.api)return;const ee=te.api.accessToken,re=te.api.configuration?.basePath||te.api.basePath;if(!ee||!re)return;const de=`MediaBrowser Client="${te.jellyfin.clientInfo.name}", Device="${te.jellyfin.deviceInfo.name}", DeviceId="${te.jellyfin.deviceInfo.id}", Version="${te.jellyfin.clientInfo.version}", Token="${ee}"`,M=await fetch(`${re}/Plugins`,{headers:{"X-Emby-Authorization":de}});if(M.ok){const q=(await M.json()).some(ae=>ae.Name?.toLowerCase().includes("enhanced")||ae.Name?.toLowerCase().includes("random button"));O(q)}}catch{}})()},[]);const U=t?.Policy?.IsAdministrator,K=async H=>{if(!(!H||!t?.Id)){k(!0);try{await te.uploadUserImage(t.Id,"Primary",H),_(!1),window.dispatchEvent(new CustomEvent("userUpdated",{detail:t})),window.location.reload()}catch(ee){console.error("Avatar upload failed",ee),alert("Failed to upload avatar. Please try again.")}finally{k(!1)}}};return p.jsxs(p.Fragment,{children:[p.jsx("nav",{className:`navbar ${l||i?"scrolled":""}`,children:p.jsxs("div",{className:"nav-content",children:[p.jsxs("div",{className:"nav-start",children:[p.jsx(Wr,{to:"/",className:"nav-logo",children:e.logoUrl?p.jsx("img",{src:e.logoUrl,alt:e.appName}):p.jsx("img",{src:yo(e.accentColor),alt:e.appName})}),p.jsxs("div",{className:"nav-links primary-links",children:[p.jsx(Wr,{to:"/",className:"nav-link",children:"Home"}),e.showNavbarCategories&&n.map(H=>p.jsx("span",{className:"nav-link",onClick:()=>F(`/library/${H.Id}`),children:H.Name},H.Id)),e.jellyseerrUrl&&e.showNavbarRequests!==!1&&p.jsxs(p.Fragment,{children:[p.jsx("span",{className:"nav-divider"}),p.jsx("a",{href:e.jellyseerrUrl,target:"_blank",rel:"noopener noreferrer",className:"nav-link",children:"Requests"})]})]})]}),p.jsx("div",{className:"nav-end",children:p.jsxs("div",{className:"nav-actions",children:[p.jsx("button",{className:"nav-icon-btn",onClick:()=>u(!0),title:"Search",children:p.jsx("span",{className:"material-icons",children:"search"})}),p.jsx("button",{className:"nav-icon-btn",onClick:()=>F("/favorites"),title:"Watchlist",children:p.jsx("span",{className:"material-icons",children:"bookmark_border"})}),D&&p.jsx("button",{className:"nav-icon-btn",onClick:()=>{window.location.href="/web/index.html?classic#!/randomitems"},title:"Random",children:p.jsx("span",{className:"material-icons",children:"shuffle"})}),p.jsxs("div",{className:`nav-avatar-container ${f?"active":""}`,onClick:H=>{H.stopPropagation(),g(!f)},ref:j,children:[t?p.jsxs("div",{className:"nav-avatar-wrapper",children:[p.jsx("img",{src:`${te.api.basePath}/Users/${t.Id}/Images/Primary?quality=90&${new Date().getTime()}`,alt:t.Name,className:"nav-avatar",onError:H=>{H.target.style.display="none"}}),p.jsx("span",{className:"material-icons avatar-arrow",children:"expand_more"})]}):p.jsxs("div",{className:"nav-avatar-wrapper",children:[p.jsx("span",{className:"material-icons nav-avatar-placeholder",children:"account_circle"}),p.jsx("span",{className:"material-icons avatar-arrow",children:"expand_more"})]}),f&&p.jsxs("div",{className:"nav-dropdown-menu usermenu",children:[t&&p.jsxs("div",{className:"user-menu-header",onClick:()=>{g(!1),A(!0)},children:[p.jsx("div",{className:"header-avatar-container",children:p.jsx("img",{src:`${te.api.basePath}/Users/${t.Id}/Images/Primary?quality=90&${new Date().getTime()}`,alt:t.Name,className:"menu-avatar",onError:H=>{H.target.style.display="none"}})}),p.jsxs("div",{className:"user-menu-info",children:[p.jsx("span",{className:"user-name",children:t.Name}),p.jsxs("span",{className:"user-status",children:[p.jsx("span",{className:"material-icons",children:U?"shield":"person"}),U?"Administrator":"User"]})]}),p.jsx("span",{className:"material-icons edit-icon",children:"edit"})]}),p.jsx("div",{className:"menu-section-label",children:"General"}),p.jsxs("button",{onClick:()=>{g(!1),u(!0)},children:[p.jsx("span",{className:"material-icons",children:"search"})," Search"]}),p.jsxs("button",{onClick:()=>{g(!1),window.location.href="/web/index.html?classic#!/remotecontrol"},children:[p.jsx("span",{className:"material-icons",children:"cast"})," Cast to Device"]}),p.jsxs("button",{onClick:()=>{g(!1),window.location.href="/web/index.html?classic#!/syncplay"},children:[p.jsx("span",{className:"material-icons",children:"sync"})," SyncPlay"]}),p.jsxs("button",{onClick:()=>{g(!1),window.location.href="/web/index.html?classic#!/playback"},children:[p.jsx("span",{className:"material-icons",children:"play_circle"})," Player"]}),D&&p.jsxs("button",{onClick:()=>{g(!1),window.location.href="/web/index.html?classic#!/randomitems"},children:[p.jsx("span",{className:"material-icons",children:"shuffle"})," Random"]}),U&&p.jsxs(p.Fragment,{children:[p.jsx("div",{className:"dropdown-divider"}),p.jsx("div",{className:"menu-section-label",children:"Administration"}),p.jsxs("button",{onClick:()=>{g(!1),window.location.href="/web/index.html?classic#!/dashboard"},children:[p.jsx("span",{className:"material-icons",children:"dashboard"})," Dashboard"]})]}),p.jsx("div",{className:"dropdown-divider"}),p.jsx("div",{className:"menu-section-label",children:"Preferences"}),p.jsxs("button",{onClick:()=>{g(!1),window.location.href="/web/index.html?#/profile"},children:[p.jsx("span",{className:"material-icons",children:"settings"})," User Settings"]}),p.jsxs("button",{onClick:()=>{g(!1),x(!0)},children:[p.jsx("span",{className:"material-icons",children:"palette"})," Theme Settings"]}),D&&p.jsxs("button",{onClick:()=>{g(!1),window.location.href="/web/index.html#!/configurationpage?name=JellyfinEnhanced"},children:[p.jsx("span",{className:"material-icons",children:"auto_awesome"})," Jellyfin Enhanced"]}),p.jsx("div",{className:"dropdown-divider"}),p.jsx("div",{className:"menu-section-label",children:"Account"}),p.jsxs("button",{onClick:()=>{g(!1),_(!0)},children:[p.jsx("span",{className:"material-icons",children:"face"})," Change Avatar"]}),p.jsxs("button",{onClick:()=>{g(!1),E(!0)},children:[p.jsx("span",{className:"material-icons",children:"qr_code"})," Quick Connect"]}),p.jsxs("button",{onClick:()=>{g(!1),F("/login/select-server")},children:[p.jsx("span",{className:"material-icons",children:"dns"})," Change Server"]}),p.jsxs("button",{onClick:()=>{g(!1),localStorage.removeItem("jellyfin_credentials"),window.location.reload()},children:[p.jsx("span",{className:"material-icons",children:"logout"})," Log Out"]})]})]})]})})]})}),p.jsx(d1,{isOpen:d,onClose:()=>u(!1)}),p.jsx($S,{isOpen:y,onClose:()=>x(!1),userId:t?.Id}),p.jsx(p1,{isOpen:S,onClose:()=>E(!1)}),p.jsx(g1,{isOpen:T,onClose:()=>A(!1),user:t}),p.jsx(Ku,{isOpen:I,onClose:()=>_(!1),onSave:K,userId:t?.Id,uploading:C})]})},y1=()=>{const{config:i}=Wi();return p.jsx("div",{className:"legitflix-footer",children:p.jsxs("div",{className:"footer-content",children:[p.jsx("div",{className:"footer-logo",children:p.jsx("a",{href:"https://github.com/gorillasuti/Legitflix-plugin",target:"_blank",rel:"noopener noreferrer",className:"footer-link",children:p.jsx("img",{className:"footer-logo-img",src:yo(i.accentColor),alt:i.appName})})}),p.jsx("div",{className:"footer-divider"}),p.jsxs("div",{className:"footer-author",children:["Created by ",p.jsx("a",{href:"https://github.com/gorillasuti",target:"_blank",rel:"noopener noreferrer",className:"footer-link",children:p.jsx("strong",{children:"gorillasuti"})})]})]})})},Av=()=>{const[i,e]=w.useState([]),[t,s]=w.useState([]),[n,r]=w.useState([]),[l,c]=w.useState([]),[d,u]=w.useState(!0),[f,g]=w.useState(null),{config:y}=Wi(),x=js();w.useEffect(()=>{(async()=>{u(!0);try{const A=await te.getCurrentUser();if(A){const I=await te.getUserViews(A.Id);e(I.Items||[]);const C=(await te.getResumeItems(A.Id)).Items||[];s(C);const D=((await te.getHistoryItems(A.Id,12)).Items||[]).filter(U=>!C.some(K=>K.Id===U.Id));r(D);const j=(await(async()=>{const U=y.contentSortMode||"latest",K={latest:{sortBy:"DateCreated",sortOrder:"Descending"},random:{sortBy:"Random",sortOrder:"Descending"},topRated:{sortBy:"CommunityRating",sortOrder:"Descending"}},{sortBy:H,sortOrder:ee}=K[U]||K.latest;return te.getItems(A.Id,{limit:20,recursive:!0,includeItemTypes:y.promoMediaTypes||["Movie","Series"],sortBy:H,sortOrder:ee,imageTypeLimit:1,enableImageTypes:["Primary","Backdrop","Thumb","Logo"],fields:["Overview","ProductionYear","ImageTags","OfficialRating","CommunityRating","Genres"]})})()).Items||[];c(j.slice(0,3))}}catch(A){console.error("Failed to fetch data",A)}finally{u(!1)}})()},[y]);const S=T=>{g(T)},E=()=>{g(null)};return p.jsxs("div",{className:"home-page",children:[p.jsx(_a,{}),p.jsx(r1,{onInfoClick:S}),p.jsx("div",{className:"home-content-container",style:{position:"relative",zIndex:10},children:d?p.jsxs("div",{style:{padding:"0 4.2%",marginTop:"40px"},children:[p.jsx(ze,{width:"180px",height:"24px",style:{marginBottom:"20px"}}),p.jsx("div",{style:{display:"flex",gap:"15px",overflow:"hidden",marginBottom:"50px"},children:[1,2,3,4,5,6].map(T=>p.jsx("div",{style:{flex:"0 0 160px"},children:p.jsx(ze,{width:"100%",height:"240px",style:{borderRadius:"8px"}})},T))}),p.jsx(ze,{width:"220px",height:"24px",style:{marginBottom:"20px"}}),p.jsx("div",{style:{display:"flex",gap:"15px",overflow:"hidden",marginBottom:"50px"},children:[1,2,3,4,5].map(T=>p.jsxs("div",{style:{flex:"0 0 280px"},children:[p.jsx(ze,{width:"100%",height:"157px",style:{borderRadius:"4px",marginBottom:"8px"}}),p.jsx(ze,{width:"70%",height:"14px",style:{marginBottom:"4px"}}),p.jsx(ze,{width:"40%",height:"12px"})]},T))}),p.jsxs("div",{style:{marginBottom:"50px"},children:[p.jsx(ze,{width:"100%",height:"300px",style:{borderRadius:"12px",marginBottom:"15px"}}),p.jsxs("div",{style:{display:"flex",gap:"15px"},children:[p.jsx(ze,{width:"50%",height:"180px",style:{borderRadius:"12px"}}),p.jsx(ze,{width:"50%",height:"180px",style:{borderRadius:"12px"}})]})]}),p.jsx(ze,{width:"180px",height:"24px",style:{marginBottom:"20px"}}),p.jsx("div",{style:{display:"flex",gap:"15px",overflow:"hidden"},children:[1,2,3,4,5].map(T=>p.jsx("div",{style:{flex:"0 0 220px"},children:p.jsx(ze,{width:"100%",height:"330px",style:{borderRadius:"4px"}})},T))})]}):p.jsxs(p.Fragment,{children:[p.jsxs("section",{className:"home-section",style:{paddingLeft:"4%",paddingRight:"4%",marginBottom:"40px"},children:[p.jsx("h2",{className:"section-title",style:{fontSize:"1.4rem",fontWeight:"bold",marginBottom:"15px",color:"#cacaca"},children:"Browse Libraries"}),p.jsxs("div",{className:"libraries-grid",children:[i.map(T=>p.jsxs("div",{className:"library-card",onClick:()=>x(`/library/${T.Id}`),children:[p.jsx("img",{src:`${te.api.basePath}/Items/${T.Id}/Images/Primary?fillHeight=480&fillWidth=320&quality=90`,alt:T.Name,className:"library-card-image",onError:A=>{A.target.style.display="none",A.target.nextSibling.style.display="flex"}}),p.jsx("div",{className:"library-card-content fallback",style:{display:"none"},children:p.jsx("span",{className:"material-icons library-icon",children:T.CollectionType==="movies"?"movie":T.CollectionType==="tvshows"?"tv":"folder"})}),y.showLibraryTitles&&p.jsx("div",{className:"library-card-overlay",children:p.jsx("span",{className:"library-name",children:T.Name})})]},T.Id)),p.jsx(u1,{})]})]}),t.length>0&&p.jsxs("section",{className:"home-section",style:{paddingLeft:"4%",paddingRight:"4%",marginBottom:"40px"},children:[p.jsx("h2",{className:"section-title",style:{fontSize:"1.4rem",fontWeight:"bold",marginBottom:"15px",color:"#cacaca"},children:"Continue Watching"}),p.jsx("div",{className:"backdrop-scroll-container",children:t.map(T=>{const A=T.UserData?.PlayedPercentage>=100||T.UserData?.Played,I=T.RunTimeTicks&&T.UserData?.PlaybackPositionTicks?T.RunTimeTicks-T.UserData.PlaybackPositionTicks:0,_=I>0?Math.round(I/6e8):0;return p.jsxs("div",{className:"backdrop-card",onClick:()=>window.location.href=`/web/index.html?classic=true#!/playback?id=${T.Id}`,title:`Resume: ${T.Name}`,children:[p.jsxs("div",{className:"backdrop-card-image",children:[p.jsx("img",{src:`${te.api.basePath}/Items/${T.Id}/Images/Backdrop/0?maxWidth=500&quality=90`,alt:T.Name,onError:C=>{C.target.src=`${te.api.basePath}/Items/${T.Id}/Images/Primary?maxWidth=500`}}),p.jsx("div",{className:"backdrop-play-overlay",children:p.jsx("span",{className:"material-icons",children:"play_arrow"})}),A?p.jsx("div",{className:"backdrop-badge watched",children:"Watched"}):_>0?p.jsxs("div",{className:"backdrop-badge time-left",children:[_,"m left"]}):null]}),T.UserData&&T.RunTimeTicks>0&&!A&&p.jsx("div",{className:"backdrop-progress-track",children:p.jsx("div",{className:"backdrop-progress-fill",style:{width:`${Math.min(100,T.UserData.PlaybackPositionTicks/T.RunTimeTicks*100)}%`}})}),p.jsxs("div",{className:"backdrop-card-info",children:[p.jsx("span",{className:"backdrop-card-series",children:T.SeriesName||""}),p.jsx("span",{className:"backdrop-card-title",children:T.SeriesName&&T.ParentIndexNumber!=null&&T.IndexNumber!=null?`S${T.ParentIndexNumber} E${T.IndexNumber}  ${T.Name}`:T.Name})]})]},T.Id)})})]}),n.length>0&&p.jsxs("section",{className:"home-section",style:{paddingLeft:"4%",paddingRight:"4%",marginBottom:"40px"},children:[p.jsx("h2",{className:"section-title",style:{fontSize:"1.4rem",fontWeight:"bold",marginBottom:"15px",color:"#cacaca"},children:"History"}),p.jsx("div",{className:"backdrop-scroll-container",children:n.map(T=>p.jsxs("div",{className:"backdrop-card",onClick:()=>x(`/item/${T.Id}`),title:T.Name,children:[p.jsxs("div",{className:"backdrop-card-image",children:[p.jsx("img",{src:`${te.api.basePath}/Items/${T.Id}/Images/Backdrop/0?maxWidth=500&quality=90`,alt:T.Name,onError:A=>{A.target.src=`${te.api.basePath}/Items/${T.Id}/Images/Primary?maxWidth=500`}}),p.jsx("div",{className:"backdrop-play-overlay",children:p.jsx("span",{className:"material-icons",children:"info"})})]}),p.jsxs("div",{className:"backdrop-card-info",children:[p.jsx("span",{className:"backdrop-card-series",children:T.SeriesName||""}),p.jsx("span",{className:"backdrop-card-title",children:T.SeriesName&&T.ParentIndexNumber!=null&&T.IndexNumber!=null?`S${T.ParentIndexNumber} E${T.IndexNumber}  ${T.Name}`:T.Name})]})]},T.Id))})]}),l.length>0&&p.jsx("section",{className:"home-section",style:{paddingLeft:"4%",paddingRight:"4%",marginBottom:"50px"},children:p.jsxs("div",{className:"promo2-wrapper",children:[p.jsxs("div",{className:"promo2-hero",onClick:()=>x(`/item/${l[0].Id}`),children:[p.jsx("img",{src:`${te.api.basePath}/Items/${l[0].Id}/Images/Backdrop/0?maxWidth=1400&quality=90`,className:"promo2-hero-img",alt:l[0].Name}),p.jsx("div",{className:"promo2-hero-gradient"}),p.jsxs("div",{className:"promo2-hero-content",children:[l[0].ImageTags?.Logo?p.jsx("img",{src:`${te.api.basePath}/Items/${l[0].Id}/Images/Logo/0?maxWidth=350&quality=90`,className:"promo2-hero-logo",alt:l[0].Name}):p.jsx("h2",{className:"promo2-hero-title",children:l[0].Name}),p.jsxs("div",{className:"promo2-meta-line",children:[p.jsx("span",{className:"promo2-badge",children:l[0].OfficialRating||"13+"}),l[0].ProductionYear&&p.jsxs(p.Fragment,{children:[p.jsx("span",{className:"promo2-meta-dot",children:""}),p.jsx("span",{className:"promo2-meta-text",children:l[0].ProductionYear})]}),l[0].Genres&&l[0].Genres.length>0&&p.jsxs(p.Fragment,{children:[p.jsx("span",{className:"promo2-meta-dot",children:""}),p.jsx("span",{className:"promo2-meta-text",children:l[0].Genres.slice(0,3).join(", ")})]}),l[0].CommunityRating&&p.jsxs(p.Fragment,{children:[p.jsx("span",{className:"promo2-meta-dot",children:""}),p.jsxs("span",{className:"promo2-meta-text",children:[" ",l[0].CommunityRating.toFixed(1)]})]})]}),l[0].Overview&&p.jsx("p",{className:"promo2-hero-desc",children:l[0].Overview}),p.jsx(bi,{variant:"ringHover",size:"lg",className:"promo2-btn",onClick:T=>{T.stopPropagation(),x(`/item/${l[0].Id}`)},children:"WATCH NOW"})]})]}),(l[1]||l[2])&&p.jsx("div",{className:"promo2-row",children:l.slice(1,3).map(T=>p.jsxs("div",{className:"promo2-card",onClick:()=>x(`/item/${T.Id}`),children:[p.jsxs("div",{className:"promo2-card-text",children:[T.ImageTags?.Logo?p.jsx("img",{src:`${te.api.basePath}/Items/${T.Id}/Images/Logo/0?maxWidth=220&quality=90`,className:"promo2-card-logo",alt:T.Name}):p.jsx("h3",{className:"promo2-card-title",children:T.Name}),p.jsxs("div",{className:"promo2-meta-line promo2-meta-line--card",children:[p.jsx("span",{className:"promo2-badge",children:T.OfficialRating||"13+"}),T.ProductionYear&&p.jsxs(p.Fragment,{children:[p.jsx("span",{className:"promo2-meta-dot",children:""}),p.jsx("span",{className:"promo2-meta-text",children:T.ProductionYear})]}),T.Genres&&T.Genres.length>0&&p.jsxs(p.Fragment,{children:[p.jsx("span",{className:"promo2-meta-dot",children:""}),p.jsx("span",{className:"promo2-meta-text",children:T.Genres.slice(0,2).join(", ")})]}),T.CommunityRating&&p.jsxs(p.Fragment,{children:[p.jsx("span",{className:"promo2-meta-dot",children:""}),p.jsxs("span",{className:"promo2-meta-text",children:[" ",T.CommunityRating.toFixed(1)]})]})]}),p.jsx("p",{className:"promo2-card-desc",children:T.Overview}),p.jsx(bi,{variant:"ringHover",className:"promo2-btn",onClick:A=>{A.stopPropagation(),x(`/item/${T.Id}`)},children:"START WATCHING"})]}),p.jsx("div",{className:"promo2-card-img",children:p.jsx("img",{src:`${te.api.basePath}/Items/${T.Id}/Images/Backdrop/0?maxWidth=500&quality=90`,alt:T.Name,onError:A=>{A.target.src=`${te.api.basePath}/Items/${T.Id}/Images/Primary?maxWidth=400`}})})]},T.Id))})]})}),i.map(T=>p.jsx(o1,{title:`Latest ${T.Name}`,libraryId:T.Id,onCardClick:A=>x(`/item/${A.Id}`)},T.Id)),p.jsx(y1,{})]})}),p.jsx(c1,{itemId:f,isOpen:!!f,onClose:E})]})};var yf={exports:{}},vf,_v;function v1(){if(_v)return vf;_v=1;var i="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return vf=i,vf}var xf,Iv;function x1(){if(Iv)return xf;Iv=1;var i=v1();function e(){}function t(){}return t.resetWarningCache=e,xf=function(){function s(l,c,d,u,f,g){if(g!==i){var y=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw y.name="Invariant Violation",y}}s.isRequired=s;function n(){return s}var r={array:s,bigint:s,bool:s,func:s,number:s,object:s,string:s,symbol:s,any:s,arrayOf:n,element:s,elementType:s,instanceOf:n,node:s,objectOf:n,oneOf:n,oneOfType:n,shape:n,exact:n,checkPropTypes:t,resetWarningCache:e};return r.PropTypes=r,r},xf}var Rv;function S1(){return Rv||(Rv=1,yf.exports=x1()()),yf.exports}var b1=S1();const Et=bm(b1),Lv={popular:[{code:"eng",name:"English"},{code:"spa",name:"Spanish"},{code:"jpn",name:"Japanese"},{code:"hun",name:"Hungarian"}],more:[{code:"ara",name:"Arabic"},{code:"bul",name:"Bulgarian"},{code:"chi",name:"Chinese"},{code:"hrv",name:"Croatian"},{code:"cze",name:"Czech"},{code:"dan",name:"Danish"},{code:"dut",name:"Dutch"},{code:"fin",name:"Finnish"},{code:"fre",name:"French"},{code:"ger",name:"German"},{code:"gre",name:"Greek"},{code:"heb",name:"Hebrew"},{code:"hin",name:"Hindi"},{code:"ind",name:"Indonesian"},{code:"ita",name:"Italian"},{code:"kor",name:"Korean"},{code:"may",name:"Malay"},{code:"nor",name:"Norwegian"},{code:"per",name:"Persian"},{code:"pol",name:"Polish"},{code:"por",name:"Portuguese"},{code:"rum",name:"Romanian"},{code:"rus",name:"Russian"},{code:"srp",name:"Serbian"},{code:"slo",name:"Slovak"},{code:"slv",name:"Slovenian"},{code:"swe",name:"Swedish"},{code:"tha",name:"Thai"},{code:"tur",name:"Turkish"},{code:"ukr",name:"Ukrainian"},{code:"vie",name:"Vietnamese"}]},Yu=({isOpen:i,onClose:e,seriesId:t,initialSeasonId:s,initialEpisodeId:n,isMovie:r=!1,onSubtitleDownloaded:l})=>{const[c,d]=w.useState([]),[u,f]=w.useState([]),[g,y]=w.useState(s||""),[x,S]=w.useState(n||""),[E,T]=w.useState([]),[A,I]=w.useState([]),[_,C]=w.useState("eng"),[k,D]=w.useState(!1),[O,F]=w.useState(!1),[j,U]=w.useState(null);w.useEffect(()=>{i&&t&&(r?S(n||t):K())},[i,t,r]),w.useEffect(()=>{g&&H(g)},[g]),w.useEffect(()=>{x&&ee()},[x]);const K=async()=>{try{const V=await te.getCurrentUser(),q=await te.getSeasons(V.Id,t);d(q.Items||[]),!g&&q.Items.length>0&&y(q.Items[0].Id)}catch(V){console.error("Failed to load seasons",V)}},H=async V=>{try{const q=await te.getCurrentUser(),ae=await te.getEpisodes(q.Id,t,V);f(ae.Items||[]),!x&&ae.Items.length>0?S(ae.Items[0].Id):x&&(ae.Items.find(pe=>pe.Id===x)||S(ae.Items[0]?ae.Items[0].Id:""))}catch(q){console.error("Failed to load episodes",q)}},ee=async()=>{if(x){D(!0),U(null);try{const V=await te.getCurrentUser(),q=await te.getMediaStreams(V.Id,x);T(q.filter(ae=>ae.Type==="Subtitle"))}catch(V){U("Failed to load subtitles."),console.error(V)}finally{D(!1)}}},re=async V=>{if(window.confirm("Are you sure you want to delete this subtitle?"))try{await te.deleteSubtitle(x,V),ee()}catch{alert("Failed to delete subtitle")}},de=async V=>{if(V.preventDefault(),!!x){F(!0),I([]);try{const q=await te.searchRemoteSubtitles(x,_);I(q||[])}catch{alert("Search failed")}finally{F(!1)}}},M=async V=>{try{await te.downloadRemoteSubtitles(x||n,V),alert("Subtitle downloaded!"),ee(),l&&l()}catch{alert("Download failed")}};return i?p.jsx("div",{className:"lf-sub-overlay",onClick:e,children:p.jsxs("div",{className:"lf-sub-modal",onClick:V=>V.stopPropagation(),children:[p.jsxs("div",{className:"lf-sub-header",children:[p.jsx("h3",{children:"Subtitles Manager"}),p.jsx("button",{className:"lf-sub-header__close",onClick:e,children:p.jsx("span",{className:"material-icons",children:"close"})})]}),p.jsxs("div",{className:"lf-sub-content",children:[!r&&p.jsxs("div",{className:"lf-sub-selectors",children:[p.jsxs("div",{children:[p.jsx("label",{className:"lf-sub-label",children:"Season"}),p.jsx("select",{className:"lf-sub-select",value:g,onChange:V=>{y(V.target.value),S("")},children:c.map(V=>p.jsx("option",{value:V.Id,children:V.Name},V.Id))})]}),p.jsxs("div",{children:[p.jsx("label",{className:"lf-sub-label",children:"Episode"}),p.jsx("select",{className:"lf-sub-select",value:x,onChange:V=>S(V.target.value),children:u.map(V=>p.jsxs("option",{value:V.Id,children:[V.IndexNumber,". ",V.Name]},V.Id))})]})]}),p.jsxs("div",{className:"lf-sub-section",children:[p.jsx("h4",{className:"lf-sub-section-title",children:"Current Subtitles"}),k?p.jsxs("div",{className:"lf-sub-loading",children:[p.jsx("span",{className:"material-icons",children:"sync"}),"Loading"]}):p.jsx("div",{className:"lf-sub-list",children:E.length===0?p.jsx("div",{className:"lf-sub-list__empty",children:"No subtitles found."}):E.map((V,q)=>p.jsxs("div",{className:"lf-sub-list__item",children:[p.jsxs("div",{children:[p.jsx("div",{className:"lf-sub-list__name",children:V.DisplayTitle||V.Language||"Unknown"}),p.jsxs("div",{className:"lf-sub-list__meta",children:[V.IsExternal?"External":"Embedded","  ",V.Codec]})]}),V.IsExternal&&p.jsxs("button",{className:"lf-sub-action-btn lf-sub-action-btn--delete",onClick:()=>re(V.Index),children:[p.jsx("span",{className:"material-icons",children:"delete_outline"}),"Delete"]})]},q))})]}),p.jsxs("div",{className:"lf-sub-section",children:[p.jsx("h4",{className:"lf-sub-section-title",children:"Search Subtitles"}),p.jsxs("form",{onSubmit:de,className:"lf-sub-search-row",children:[p.jsxs("select",{className:"lf-sub-select",value:_,onChange:V=>C(V.target.value),style:{flex:1},children:[p.jsx("optgroup",{label:"Popular",children:Lv.popular.map(V=>p.jsx("option",{value:V.code,children:V.name},V.code))}),p.jsx("optgroup",{label:"More Languages",children:Lv.more.map(V=>p.jsx("option",{value:V.code,children:V.name},V.code))})]}),p.jsxs("button",{type:"submit",disabled:O||!x,className:"lf-sub-action-btn lf-sub-action-btn--search",children:[p.jsx("span",{className:"material-icons",children:"search"}),O?"Searching":"Search"]})]}),A.length>0&&p.jsx("div",{className:"lf-sub-list",children:A.map(V=>p.jsxs("div",{className:"lf-sub-list__item",children:[p.jsxs("div",{className:"lf-sub-list__info",children:[p.jsx("div",{className:"lf-sub-list__name",children:V.Name}),p.jsxs("div",{className:"lf-sub-list__meta",children:[V.Format,"  ",V.ProviderName,"  ",V.DownloadCount," DLs"]})]}),p.jsxs("button",{className:"lf-sub-action-btn lf-sub-action-btn--download",onClick:()=>M(V.Id),children:[p.jsx("span",{className:"material-icons",children:"download"}),"Download"]})]},V.Id))})]})]})]})}):null};Yu.propTypes={isOpen:Et.bool.isRequired,onClose:Et.func.isRequired,seriesId:Et.string,initialSeasonId:Et.string,initialEpisodeId:Et.string,isMovie:Et.bool,onSubtitleDownloaded:Et.func};const T1=()=>{const{id:i}=Fu(),e=js(),[t,s]=w.useState(null),[n,r]=w.useState([]),[l,c]=w.useState([]),[d,u]=w.useState(null),[f,g]=w.useState([]),[y,x]=w.useState(!0),[S,E]=w.useState(!1),[T,A]=w.useState(!1),[I,_]=w.useState(null),[C,k]=w.useState(!1),[D,O]=w.useState(!1),[F,j]=w.useState(!1),[U,K]=w.useState([]),[H,ee]=w.useState(localStorage.getItem("legitflix-audio-pref")||"en"),[re,de]=w.useState(localStorage.getItem("legitflix-sub-pref")||"en"),[M,V]=w.useState(!1),[q,ae]=w.useState("all"),[pe,P]=w.useState("default"),[$,G]=w.useState(!1),[fe,ge]=w.useState(!1),[_e,Ne]=w.useState(!1),[Ge,Be]=w.useState(!1),[pt,At]=w.useState(!1),[Vt,bt]=w.useState(!1),[gt,zt]=w.useState(null),[Fe,we]=w.useState(!1),[Ue,qe]=w.useState(!1),dt=w.useRef(null),Ce=w.useRef(null),He=w.useRef(null),Tt=w.useRef(null),rt=w.useRef(null),Kt=w.useRef(null),ye=w.useRef(null),We=w.useRef(null);w.useEffect(()=>{(async()=>{x(!0);try{const Oe=await te.getCurrentUser();if(!Oe)return;const Qe=await te.getSeries(Oe.Id,i);if(s(Qe),qe(Qe.UserData?.IsFavorite||!1),Qe.RemoteTrailers&&Qe.RemoteTrailers.length>0){const mt=Qe.RemoteTrailers[0].Url.match(/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/);mt&&mt[1]&&zt(mt[1])}const ts=await te.getSeasons(Oe.Id,i);let Ie=null;ts.Items&&ts.Items.length>0&&(r(ts.Items),Ie=ts.Items[0].Id);try{const _t=await te.getNextUp(Oe.Id,i);if(_t&&_t.Items&&_t.Items.length>0){const mt=_t.Items[0];_(mt),mt.SeasonId&&ts.Items.find(Ji=>Ji.Id===mt.SeasonId)&&(Ie=mt.SeasonId)}}catch(_t){console.warn("Failed to fetch Next Up for smart season selection",_t)}Ie&&u(Ie);const ss=await te.getSimilarItems(Oe.Id,i);g(ss.Items||[])}catch(Oe){console.error("Failed to load series data",Oe)}finally{x(!1)}})()},[i]);const it=async()=>{if(!(!t||!d))try{const le=await te.getCurrentUser(),Oe=await te.getEpisodes(le.Id,t.Id,d);c(Oe.Items||[])}catch(le){console.error("Failed to load episodes",le)}};w.useEffect(()=>{it()},[d,t]),w.useEffect(()=>{const le=Oe=>{dt.current&&!dt.current.contains(Oe.target)&&O(!1),Ce.current&&!Ce.current.contains(Oe.target)&&V(!1),He.current&&!He.current.contains(Oe.target)&&G(!1),Tt.current&&!Tt.current.contains(Oe.target)&&ge(!1)};return document.addEventListener("mousedown",le),()=>document.removeEventListener("mousedown",le)},[]);const ls=()=>{j(!F),K([])},Ns=le=>{e(`/play/${le}`)},os=le=>{F?U.includes(le)?K(U.filter(Oe=>Oe!==le)):K([...U,le]):Ns(le)},Zi=async le=>{if(!(U.length===0||T)){A(!0),c(Oe=>Oe.map(Qe=>U.includes(Qe.Id)?{...Qe,UserData:{...Qe.UserData||{},Played:le}}:Qe));try{const Oe=await te.getCurrentUser();if(!Oe)throw new Error("No user");await Promise.all(U.map(Qe=>te.markPlayed(Oe.Id,Qe,le))),await it()}catch(Oe){console.error("Failed to mark episodes",Oe),await it()}finally{A(!1),K([])}}},Es=()=>{const le=l.map(Qe=>Qe.Id),Oe=le.every(Qe=>U.includes(Qe));K(Oe?[]:le)},$t=(le,Oe)=>{le==="audio"?(ee(Oe),localStorage.setItem("legitflix-audio-pref",Oe)):(de(Oe),localStorage.setItem("legitflix-sub-pref",Oe)),V(!1)},As=async()=>{try{const le=await te.getCurrentUser(),Oe=!Ue;await te.markFavorite(le.Id,t.Id,Oe),qe(Oe)}catch(le){console.error("Favorite toggle failed",le)}},Yt=()=>{const le=!Fe;we(le);const Oe=le?"mute":"unMute";We.current?.contentWindow?.postMessage(JSON.stringify({event:"command",func:Oe,args:[]}),"*")},ii=()=>{Kt.current&&clearTimeout(Kt.current),Kt.current=setTimeout(()=>{_e&&Be(!0)},5e3)},Ai=()=>{Be(!1),_e&&ii()},_i=()=>{if(_e){xs();return}Ne(!0),Be(!1),ii();let le=!1;const Oe=Qe=>{typeof Qe.data=="string"&&(Qe.data.includes('"event"')||Qe.data.includes('"id"'))&&(le=!0,rt.current&&clearTimeout(rt.current))};window.addEventListener("message",Oe),window.lfMessageHandler=Oe,rt.current=setTimeout(()=>{!le&&_e&&(console.log("Possible block detected: No YT API message received."),At(!0))},4e3)},xs=()=>{Ne(!1),Be(!1),At(!1),bt(!1),we(!1),Kt.current&&(clearTimeout(Kt.current),Kt.current=null),rt.current&&(clearTimeout(rt.current),rt.current=null),window.lfMessageHandler&&(window.removeEventListener("message",window.lfMessageHandler),delete window.lfMessageHandler)},Wt=le=>{F||(ye.current=setTimeout(()=>{j(!0),K([le]),navigator.vibrate&&navigator.vibrate(50)},600))},Os=()=>{ye.current&&clearTimeout(ye.current)},Xt=U.length===0?{label:"Mark Watched",icon:"visibility"}:U.every(Oe=>l.find(ts=>ts.Id===Oe)?.UserData?.Played)?{label:"Mark Unwatched",icon:"visibility_off",isPlayed:!1}:{label:"Mark Watched",icon:"visibility",isPlayed:!0},Vs=w.useMemo(()=>{let le=[...l];return q==="unwatched"?le=le.filter(Oe=>!Oe.UserData?.Played):q==="watched"&&(le=le.filter(Oe=>Oe.UserData?.Played)),pe==="newest"?le.sort((Oe,Qe)=>(Qe.IndexNumber||0)-(Oe.IndexNumber||0)):pe==="oldest"&&le.sort((Oe,Qe)=>(Oe.IndexNumber||0)-(Qe.IndexNumber||0)),le},[l,q,pe]);if(w.useEffect(()=>()=>{Kt.current&&clearTimeout(Kt.current),rt.current&&clearTimeout(rt.current),window.lfMessageHandler&&window.removeEventListener("message",window.lfMessageHandler)},[]),y)return p.jsxs("div",{className:"lf-series-container",children:[p.jsx(_a,{alwaysFilled:!0}),p.jsxs("section",{className:"lf-series-hero",children:[p.jsx("div",{className:"lf-series-hero__backdrop",style:{background:"#141414"}}),p.jsxs("div",{className:"lf-series-hero__content",children:[p.jsx("div",{className:"lf-series-hero__poster",children:p.jsx(ze,{type:"rect",width:"100%",height:"100%",style:{aspectRatio:"2/3",borderRadius:"8px"}})}),p.jsxs("div",{className:"lf-series-hero__info",children:[p.jsx("h1",{className:"lf-series-hero__title",style:{marginBottom:"1rem"},children:p.jsx(ze,{type:"text",width:"60%",height:"3rem"})}),p.jsxs("div",{className:"lf-series-hero__meta",style:{display:"flex",gap:"1rem",marginBottom:"1.5rem"},children:[p.jsx(ze,{type:"text",width:"60px"}),p.jsx(ze,{type:"text",width:"40px"}),p.jsx(ze,{type:"text",width:"80px"})]}),p.jsxs("div",{className:"lf-series-hero__details",children:[p.jsxs("div",{className:"lf-series-hero__description",children:[p.jsx(ze,{type:"text",width:"100%"}),p.jsx(ze,{type:"text",width:"95%"}),p.jsx(ze,{type:"text",width:"90%"})]}),p.jsxs("div",{className:"lf-series-hero__cast-info",style:{marginTop:"1rem"},children:[p.jsx(ze,{type:"text",width:"80%"}),p.jsx(ze,{type:"text",width:"70%"})]})]}),p.jsxs("div",{className:"lf-series-hero__actions",style:{marginTop:"2rem",display:"flex",gap:"1rem"},children:[p.jsx(ze,{type:"rect",width:"180px",height:"48px",style:{borderRadius:"24px"}}),p.jsx(ze,{type:"rect",width:"160px",height:"48px",style:{borderRadius:"24px"}})]})]})]})]})]});if(!t)return p.jsx("div",{className:"lf-series-container",style:{color:"white"},children:"Series not found"});const ni=te.getImageUrl(t,"Backdrop"),Ii=te.getImageUrl(t,"Primary"),ai=te.getImageUrl(t,"Logo"),cs=t.People?t.People.slice(0,10):[],$i=n.find(le=>le.Id===d),ri=[{code:"en",name:"English"},{code:"ja",name:"Japanese"}],xn=[{code:"en",name:"English"},{code:"es",name:"Spanish"},{code:"hu",name:"Hungarian"}];return p.jsxs("div",{className:"lf-series-container",children:[p.jsx(_a,{alwaysFilled:!0}),p.jsxs("section",{className:`lf-series-hero ${Ge?"is-clean-view":""}`,onMouseMove:Ai,onClick:Ai,children:[p.jsx("div",{className:`lf-series-hero__backdrop ${_e?"is-hidden":""}`,style:{backgroundImage:`url('${ni}')`}}),p.jsx("div",{className:`lf-series-hero__trailer ${_e?"is-playing":""}`,children:_e&&gt&&p.jsx("iframe",{ref:We,src:`https://www.youtube.com/embed/${gt}?autoplay=1&mute=0&loop=1&modestbranding=1&rel=0&iv_load_policy=3&fs=0&color=white&controls=0&disablekb=1&playlist=${gt}&enablejsapi=1&origin=${window.location.origin}&widget_referrer=${window.location.origin}`,frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",referrerPolicy:"strict-origin-when-cross-origin",allowFullScreen:!0,title:"Trailer"})}),_e&&p.jsxs("button",{className:"lf-trailer-help-btn",onClick:le=>{le.stopPropagation(),bt(!0)},children:[p.jsx("span",{className:"material-icons",children:"help_outline"}),p.jsx("span",{children:"Trouble playing?"})]}),ai&&p.jsx("img",{className:"lf-series-hero__logo",src:ai,alt:t.Name}),p.jsxs("div",{className:"lf-series-hero__content",children:[p.jsx("img",{className:"lf-series-hero__poster",src:Ii,alt:t.Name}),p.jsxs("div",{className:"lf-series-hero__info",children:[p.jsx("h1",{className:"lf-series-hero__title",children:t.Name}),p.jsxs("div",{className:"lf-series-hero__meta",children:[p.jsx("span",{children:t.ProductionYear}),p.jsx("span",{children:""}),p.jsx("span",{children:t.OfficialRating}),p.jsx("span",{children:""}),p.jsxs("div",{className:"lf-series-hero__rating",children:[p.jsx("span",{className:"material-icons",children:"star"}),p.jsx("span",{children:t.CommunityRating?t.CommunityRating.toFixed(1):""})]})]}),p.jsxs("div",{className:"lf-series-hero__details",children:[p.jsxs("div",{className:"lf-series-hero__description",children:[p.jsx("p",{className:`lf-series-hero__description-text ${C?"is-expanded":""}`,children:t.Overview}),t.Overview&&t.Overview.length>200&&p.jsxs("button",{className:`lf-series-hero__load-more ${C?"is-expanded":""}`,onClick:()=>k(!C),children:[C?"Show Less":"Read More",p.jsx("span",{className:"material-icons",children:"expand_more"})]})]}),cs.length>0&&p.jsxs("div",{className:"lf-series-hero__cast-info",children:[p.jsxs("div",{style:{marginBottom:8},children:[p.jsx("strong",{children:"Starring: "}),cs.slice(0,3).map(le=>le.Name).join(", "),cs.length>3&&p.jsx("span",{children:"..."})]}),p.jsxs("div",{children:[p.jsx("strong",{children:"Genres: "}),t.Genres?t.Genres.join(", "):""]})]})]}),p.jsxs("div",{className:"lf-series-hero__actions",children:[p.jsxs("button",{className:"lf-btn lf-btn--primary lf-btn--ring-hover",onClick:()=>{I?Ns(I.Id):l.length>0&&Ns(l[0].Id)},children:[p.jsx("span",{className:"material-icons",children:"play_arrow"}),I?I.UserData?.PlaybackPositionTicks>0?`Resume S${I.ParentIndexNumber} E${I.IndexNumber}`:`Continue S${I.ParentIndexNumber} E${I.IndexNumber}`:"Start Watching"]}),p.jsxs("button",{className:"lf-btn lf-btn--glass lf-btn--ring-hover-secondary",onClick:_i,style:gt?{}:{opacity:.5,pointerEvents:"none"},children:[p.jsx("span",{className:"material-icons",children:_e?"stop_circle":"theaters"}),_e?"Stop Trailer":"Watch Trailer"]}),_e&&p.jsx("button",{className:`lf-btn lf-btn--glass lf-btn--icon-only ${Fe?"is-muted":""}`,onClick:Yt,title:Fe?"Unmute":"Mute",children:p.jsx("span",{className:"material-icons",children:Fe?"volume_off":"volume_up"})}),p.jsx("button",{className:`lf-btn lf-btn--glass lf-btn--icon-only ${Ue?"is-active":""}`,onClick:As,title:"Add to List",children:p.jsx("span",{className:"material-icons",children:Ue?"bookmark":"bookmark_border"})}),p.jsx("button",{className:"lf-btn lf-btn--glass lf-btn--icon-only",onClick:()=>E(!0),title:"Edit Subtitles",children:p.jsx("span",{className:"material-icons",children:"subtitles"})})]})]})]})]}),p.jsx("hr",{className:"lf-section-divider"}),p.jsxs("div",{className:"lf-content-section",children:[p.jsxs("div",{className:"lf-episodes-header",children:[p.jsxs("div",{className:`lf-season-selector ${D?"is-open":""}`,ref:dt,children:[p.jsxs("div",{className:"lf-season-selector__button",onClick:()=>O(!D),children:[p.jsx("span",{children:$i?$i.Name:"Select Season"}),p.jsx("span",{className:"material-icons",children:"expand_more"})]}),p.jsx("div",{className:"lf-season-selector__dropdown",children:n.map(le=>p.jsx("div",{className:`lf-season-selector__option ${d===le.Id?"is-selected":""}`,onClick:()=>{u(le.Id),O(!1)},children:p.jsx("span",{children:le.Name})},le.Id))})]}),p.jsxs("div",{className:"lf-filter-controls",children:[p.jsxs("div",{className:`lf-filter-dropdown ${M?"is-open":""}`,ref:Ce,children:[p.jsxs("button",{className:"lf-filter-btn",onClick:()=>V(!M),title:"Audio & Subtitles",children:[p.jsx("span",{className:"material-icons",children:"subtitles"}),p.jsx("span",{children:"Audio & Subs"}),p.jsx("span",{className:"material-icons",children:"expand_more"})]}),p.jsxs("div",{className:"lf-filter-dropdown__menu lf-lang-menu",children:[p.jsxs("div",{className:"lf-lang-section",children:[p.jsx("div",{className:"lf-dropdown-section-title",children:"Audio"}),ri.map(le=>p.jsxs("div",{className:`lf-filter-dropdown__option ${H===le.code?"is-selected":""}`,onClick:()=>$t("audio",le.code),children:[p.jsx("span",{children:le.name}),H===le.code&&p.jsx("span",{className:"material-icons",children:"check"})]},le.code))]}),p.jsx("div",{className:"lf-lang-separator"}),p.jsxs("div",{className:"lf-lang-section",children:[p.jsx("div",{className:"lf-dropdown-section-title",children:"Subtitles"}),xn.map(le=>p.jsxs("div",{className:`lf-filter-dropdown__option ${re===le.code?"is-selected":""}`,onClick:()=>$t("sub",le.code),children:[p.jsx("span",{children:le.name}),re===le.code&&p.jsx("span",{className:"material-icons",children:"check"})]},le.code))]}),p.jsx("div",{className:"lf-lang-footer",children:p.jsxs("button",{className:"lf-edit-subs-btn",onClick:()=>{V(!1),E(!0)},children:[p.jsx("span",{className:"material-icons",children:"edit"}),p.jsx("span",{children:"Edit Subtitles"})]})})]})]}),F?p.jsxs(p.Fragment,{children:[p.jsxs("button",{className:"lf-edit-subs-btn",style:{width:"auto",padding:"8px 16px",opacity:T?.6:1},onClick:()=>Zi(Xt.isPlayed),disabled:T||U.length===0,children:[p.jsx("span",{className:"material-icons",style:T?{animation:"lf-spin 1s linear infinite"}:{},children:T?"sync":Xt.icon}),p.jsx("span",{children:T?"Updating":Xt.label})]}),p.jsxs("button",{className:"lf-filter-btn",onClick:Es,children:[p.jsx("span",{className:"material-icons",children:"select_all"}),p.jsx("span",{children:l.length>0&&l.every(le=>U.includes(le.Id))?"Deselect All":"Select All"})]}),p.jsxs("button",{className:"lf-filter-btn is-active",onClick:ls,title:"Cancel",children:[p.jsx("span",{className:"material-icons",children:"close"}),p.jsx("span",{children:"Cancel"})]})]}):p.jsxs(p.Fragment,{children:[p.jsxs("div",{className:`lf-filter-dropdown ${$?"is-open":""}`,ref:He,children:[p.jsxs("button",{className:`lf-filter-btn ${q!=="all"?"is-active":""}`,onClick:()=>G(!$),title:"Filter episodes",children:[p.jsx("span",{className:"material-icons",children:"filter_list"}),p.jsx("span",{children:q==="all"?"Filter":q==="unwatched"?"Unwatched":"Watched"}),p.jsx("span",{className:"material-icons",children:"expand_more"})]}),p.jsx("div",{className:"lf-filter-dropdown__menu",children:[{key:"all",label:"All"},{key:"unwatched",label:"Unwatched"},{key:"watched",label:"Watched"}].map(le=>p.jsxs("div",{className:`lf-filter-dropdown__option ${q===le.key?"is-selected":""}`,onClick:()=>{ae(le.key),G(!1)},children:[p.jsx("span",{children:le.label}),q===le.key&&p.jsx("span",{className:"material-icons",children:"check"})]},le.key))})]}),p.jsxs("div",{className:`lf-filter-dropdown ${fe?"is-open":""}`,ref:Tt,children:[p.jsxs("button",{className:`lf-filter-btn ${pe!=="default"?"is-active":""}`,onClick:()=>ge(!fe),title:"Sort episodes",children:[p.jsx("span",{className:"material-icons",children:"sort"}),p.jsx("span",{children:pe==="default"?"Sort":pe==="newest"?"Newest":"Oldest"}),p.jsx("span",{className:"material-icons",children:"expand_more"})]}),p.jsx("div",{className:"lf-filter-dropdown__menu",children:[{key:"default",label:"Default"},{key:"newest",label:"Newest First"},{key:"oldest",label:"Oldest First"}].map(le=>p.jsxs("div",{className:`lf-filter-dropdown__option ${pe===le.key?"is-selected":""}`,onClick:()=>{P(le.key),ge(!1)},children:[p.jsx("span",{children:le.label}),pe===le.key&&p.jsx("span",{className:"material-icons",children:"check"})]},le.key))})]}),p.jsxs("button",{className:"lf-filter-btn",onClick:ls,title:"Bulk Edit",children:[p.jsx("span",{className:"material-icons",children:"done_all"}),p.jsx("span",{children:"Select Item"})]})]})]})]}),p.jsx("div",{className:"lf-episode-grid",children:Vs.map(le=>{const Oe=U.includes(le.Id),Qe=le.UserData?.Played;return p.jsxs("div",{className:`lf-episode-card ${F?"is-selecting-mode":""} ${Oe?"is-selected":""} ${Qe?"is-watched":""}`,onClick:()=>os(le.Id),onPointerDown:()=>Wt(le.Id),onPointerUp:Os,onPointerLeave:Os,children:[p.jsxs("div",{className:"lf-episode-card__thumbnail",children:[p.jsx("img",{src:te.getImageUrl(le,"Primary"),alt:le.Name,loading:"lazy"}),le.IndexNumber&&p.jsx("span",{className:"lf-episode-card__badge",children:le.IndexNumber}),p.jsx("div",{className:"lf-episode-card__play-icon",children:p.jsx("span",{className:"material-icons",children:"play_arrow"})}),p.jsx("div",{className:"lf-episode-checkbox",children:p.jsx("span",{className:"material-icons",children:"check"})}),Qe&&!F&&p.jsx("div",{className:"lf-episode-checkbox",style:{opacity:1,background:"#4caf50",borderColor:"#4caf50"},children:p.jsx("span",{className:"material-icons",style:{opacity:1,transform:"scale(1)"},children:"check"})})]}),p.jsxs("div",{className:"lf-episode-card__info",children:[p.jsx("h3",{className:"lf-episode-card__title",children:le.Name}),p.jsx("p",{className:"lf-episode-card__subtitle",children:le.Overview})]})]},le.Id)})})]}),p.jsx("hr",{className:"lf-section-divider"}),cs.length>0&&p.jsxs("div",{className:"lf-content-section",children:[p.jsx("h2",{className:"lf-section-title",children:"Cast & Crew"}),p.jsx("div",{className:"lf-cast-grid",children:cs.map(le=>p.jsxs("div",{className:"lf-cast-card",children:[p.jsx("img",{src:te.getImageUrl(le,"Primary")||"https://via.placeholder.com/80x80?text=?",alt:le.Name,className:"lf-cast-card__image",onError:Oe=>{Oe.target.src="https://via.placeholder.com/80x80?text=?"}}),p.jsx("div",{className:"lf-cast-card__name",children:le.Name}),p.jsx("div",{className:"lf-cast-card__role",children:le.Role})]},le.Id||le.Name))})]}),p.jsx("hr",{className:"lf-section-divider"}),f.length>0&&p.jsxs("div",{className:"lf-content-section",style:{marginBottom:40},children:[p.jsx("h2",{className:"lf-section-title",children:"More Like This"}),p.jsx("div",{className:"lf-similar-grid",children:f.map(le=>p.jsxs(Wr,{to:`/series/${le.Id}`,className:"lf-similar-card",children:[p.jsx("img",{className:"lf-similar-card__poster",src:te.getImageUrl(le,"Primary"),alt:le.Name,loading:"lazy"}),p.jsx("div",{className:"lf-similar-card__title",children:le.Name})]},le.Id))})]}),p.jsx(Yu,{isOpen:S,onClose:()=>E(!1),seriesId:t?t.Id:"",initialSeasonId:d,initialEpisodeId:l.length>0?l[0].Id:""}),Vt&&p.jsx("div",{className:"lf-blocked-modal-overlay",onClick:()=>{bt(!1),xs()},children:p.jsxs("div",{className:"lf-blocked-modal",onClick:le=>le.stopPropagation(),children:[p.jsx("button",{className:"lf-blocked-modal__close",onClick:()=>{bt(!1),xs()},children:p.jsx("span",{className:"material-icons",children:"close"})}),p.jsx("span",{className:"material-icons lf-blocked-icon",children:"error_outline"}),p.jsx("h3",{children:"Playback issue"}),p.jsx("p",{children:"The trailer can't play  your browser's tracking protection or ad blocker is likely blocking the YouTube embed."}),p.jsx("button",{className:"lf-btn lf-btn--glass",onClick:()=>{bt(!1),xs()},children:"Got it"})]})})]})},E1=()=>{const{id:i}=Fu(),e=js(),[t,s]=w.useState(null),[n,r]=w.useState([]),[l,c]=w.useState(!0),[d,u]=w.useState(!1),[f,g]=w.useState(!1),[y,x]=w.useState(localStorage.getItem("legitflix-audio-pref")||"en"),[S,E]=w.useState(localStorage.getItem("legitflix-sub-pref")||"en"),[T,A]=w.useState(!1),[I,_]=w.useState(!1),[C,k]=w.useState(!1),[D,O]=w.useState(!1),[F,j]=w.useState(!1),[U,K]=w.useState(!1),[H,ee]=w.useState(null),[re,de]=w.useState(!1),[M,V]=w.useState(!1);w.useRef(null);const q=w.useRef(null),ae=w.useRef(null),pe=w.useRef(null),P=w.useRef(null);w.useEffect(()=>{(async()=>{c(!0);try{const Ue=await te.getCurrentUser();if(!Ue)return;const qe=await te.getItemDetails(Ue.Id,i);if(s(qe),de(qe.UserData?.IsFavorite||!1),V(qe.UserData?.Played||!1),qe.RemoteTrailers&&qe.RemoteTrailers.length>0){const He=qe.RemoteTrailers[0].Url.match(/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/);He&&He[1]&&ee(He[1])}const dt=await te.getSimilarItems(Ue.Id,i);r(dt.Items||[])}catch(Ue){console.error("Failed to load movie data",Ue)}finally{c(!1)}})()},[i]),w.useEffect(()=>{const we=Ue=>{q.current&&!q.current.contains(Ue.target)&&A(!1)};return document.addEventListener("mousedown",we),()=>document.removeEventListener("mousedown",we)},[]);const $=(we,Ue)=>{we==="audio"?(x(Ue),localStorage.setItem("legitflix-audio-pref",Ue)):(E(Ue),localStorage.setItem("legitflix-sub-pref",Ue)),A(!1)},G=async()=>{try{const we=await te.getCurrentUser(),Ue=!re;await te.markFavorite(we.Id,t.Id,Ue),de(Ue)}catch(we){console.error("Favorite toggle failed",we)}},fe=async()=>{try{const we=await te.getCurrentUser(),Ue=!M;await te.markPlayed(we.Id,t.Id,Ue),V(Ue),s(qe=>({...qe,UserData:{...qe.UserData,Played:Ue}}))}catch(we){console.error("Played toggle failed",we)}},ge=()=>{const we=!C;k(we);const Ue=we?"mute":"unMute";P.current?.contentWindow?.postMessage(JSON.stringify({event:"command",func:Ue,args:[]}),"*")},_e=()=>{pe.current&&clearTimeout(pe.current),pe.current=setTimeout(()=>{I&&O(!0)},5e3)},Ne=()=>{O(!1),I&&_e()},Ge=()=>{if(I){Be();return}_(!0),O(!1),_e();let we=!1;const Ue=qe=>{typeof qe.data=="string"&&(qe.data.includes('"event"')||qe.data.includes('"id"'))&&(we=!0,ae.current&&clearTimeout(ae.current))};window.addEventListener("message",Ue),window.lfMessageHandler=Ue,ae.current=setTimeout(()=>{!we&&I&&(console.log("Possible block detected: No YT API message received."),j(!0))},4e3)},Be=()=>{_(!1),O(!1),j(!1),K(!1),k(!1),pe.current&&clearTimeout(pe.current),ae.current&&clearTimeout(ae.current),window.lfMessageHandler&&(window.removeEventListener("message",window.lfMessageHandler),delete window.lfMessageHandler)};if(w.useEffect(()=>()=>{pe.current&&clearTimeout(pe.current),ae.current&&clearTimeout(ae.current),window.lfMessageHandler&&window.removeEventListener("message",window.lfMessageHandler)},[]),l)return p.jsx("div",{className:"lf-movie-container",style:{color:"white"},children:"Loading..."});if(!t)return p.jsx("div",{className:"lf-movie-container",style:{color:"white"},children:"Movie not found"});const pt=te.getImageUrl(t,"Backdrop"),At=te.getImageUrl(t,"Primary"),Vt=te.getImageUrl(t,"Logo"),bt=t.People?t.People.slice(0,10):[],gt=[{code:"en",name:"English"},{code:"ja",name:"Japanese"}],zt=[{code:"en",name:"English"},{code:"es",name:"Spanish"},{code:"hu",name:"Hungarian"}],Fe=we=>{if(!we)return"";const Ue=Math.floor(we/6e8),qe=Math.floor(Ue/60),dt=Ue%60;return qe>0?`${qe}h ${dt}m`:`${Ue}m`};return p.jsxs("div",{className:"lf-movie-container",children:[p.jsx(_a,{alwaysFilled:!0}),p.jsxs("section",{className:`lf-movie-hero ${D?"is-clean-view":""}`,onMouseMove:Ne,onClick:Ne,children:[p.jsx("div",{className:`lf-movie-hero__backdrop ${I?"is-hidden":""}`,style:{backgroundImage:`url('${pt}')`}}),p.jsxs("div",{className:`lf-movie-hero__trailer ${I?"is-playing":""}`,children:[I&&H&&p.jsx("iframe",{ref:P,src:`https://www.youtube.com/embed/${H}?autoplay=1&mute=0&loop=1&modestbranding=1&rel=0&iv_load_policy=3&fs=0&color=white&controls=0&disablekb=1&playlist=${H}&enablejsapi=1&origin=${window.location.origin}&widget_referrer=${window.location.origin}`,frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",referrerPolicy:"strict-origin-when-cross-origin",allowFullScreen:!0,title:"Trailer"}),I&&p.jsxs("button",{className:"lf-trailer-help-btn",onClick:we=>{we.stopPropagation(),K(!0)},children:[p.jsx("span",{className:"material-icons",children:"help_outline"}),p.jsx("span",{children:"Trouble playing?"})]})]}),Vt&&p.jsx("img",{className:"lf-movie-hero__logo",src:Vt,alt:t.Name}),p.jsxs("div",{className:"lf-movie-hero__content",children:[p.jsx("img",{className:"lf-movie-hero__poster",src:At,alt:t.Name}),p.jsxs("div",{className:"lf-movie-hero__info",children:[p.jsx("h1",{className:"lf-movie-hero__title",children:t.Name}),p.jsxs("div",{className:"lf-movie-hero__meta",children:[p.jsx("span",{children:t.ProductionYear}),p.jsx("span",{children:""}),p.jsx("span",{children:t.OfficialRating}),p.jsx("span",{children:""}),p.jsx("span",{children:Fe(t.RunTimeTicks)}),p.jsx("span",{children:""}),p.jsxs("div",{className:"lf-movie-hero__rating",children:[p.jsx("span",{className:"material-icons",children:"star"}),p.jsx("span",{children:t.CommunityRating?t.CommunityRating.toFixed(1):""})]})]}),p.jsxs("div",{className:"lf-movie-hero__details",children:[p.jsxs("div",{className:"lf-movie-hero__description",children:[p.jsx("p",{className:`lf-movie-hero__description-text ${f?"is-expanded":""}`,children:t.Overview}),t.Overview&&t.Overview.length>200&&p.jsxs("button",{className:`lf-movie-hero__load-more ${f?"is-expanded":""}`,onClick:()=>g(!f),children:[f?"Show Less":"Read More",p.jsx("span",{className:"material-icons",children:"expand_more"})]})]}),bt.length>0&&p.jsxs("div",{className:"lf-movie-hero__cast-info",children:[p.jsxs("div",{style:{marginBottom:8},children:[p.jsx("strong",{children:"Starring: "}),bt.slice(0,3).map(we=>we.Name).join(", "),bt.length>3&&p.jsx("span",{children:"..."})]}),p.jsxs("div",{children:[p.jsx("strong",{children:"Genres: "}),t.Genres?t.Genres.join(", "):""]})]})]}),p.jsxs("div",{className:"lf-movie-hero__actions",children:[p.jsxs("button",{className:"lf-btn lf-btn--primary lf-btn--ring-hover",onClick:()=>e(`/play/${t.Id}`),children:[p.jsx("span",{className:"material-icons",children:"play_arrow"}),"Start Watching"]}),p.jsxs("button",{className:"lf-btn lf-btn--glass lf-btn--ring-hover-secondary",onClick:Ge,style:H?{}:{opacity:.5,pointerEvents:"none"},children:[p.jsx("span",{className:"material-icons",children:I?"stop_circle":"theaters"}),I?"Stop Trailer":"Watch Trailer"]}),I&&p.jsx("button",{className:`lf-btn lf-btn--glass lf-btn--icon-only ${C?"is-muted":""}`,onClick:ge,title:C?"Unmute":"Mute",children:p.jsx("span",{className:"material-icons",children:C?"volume_off":"volume_up"})}),p.jsx("button",{className:`lf-btn lf-btn--glass lf-btn--icon-only ${re?"is-active":""}`,onClick:G,title:"Add to List",children:p.jsx("span",{className:"material-icons",children:re?"bookmark":"bookmark_border"})}),p.jsx("button",{className:"lf-btn lf-btn--glass lf-btn--icon-only",onClick:()=>u(!0),title:"Edit Subtitles",children:p.jsx("span",{className:"material-icons",children:"subtitles"})})]})]})]})]}),p.jsx("hr",{className:"lf-section-divider"}),p.jsxs("div",{className:"lf-content-section",id:"lfDirectPlayer",children:[p.jsxs("div",{className:"lf-section-header",children:[p.jsx("h2",{className:"lf-section-title",children:t.Name}),p.jsxs("div",{className:"lf-filter-controls",children:[p.jsxs("div",{className:`lf-filter-dropdown ${T?"is-open":""}`,ref:q,children:[p.jsxs("button",{className:"lf-filter-btn",onClick:()=>A(!T),title:"Audio & Subtitles",children:[p.jsx("span",{className:"material-icons",children:"subtitles"}),p.jsx("span",{children:"Audio & Subs"}),p.jsx("span",{className:"material-icons",children:"expand_more"})]}),p.jsxs("div",{className:"lf-filter-dropdown__menu lf-lang-menu",children:[p.jsxs("div",{className:"lf-lang-section",children:[p.jsx("div",{className:"lf-dropdown-section-title",children:"Audio"}),gt.map(we=>p.jsxs("div",{className:`lf-filter-dropdown__option ${y===we.code?"is-selected":""}`,onClick:()=>$("audio",we.code),children:[p.jsx("span",{children:we.name}),y===we.code&&p.jsx("span",{className:"material-icons",children:"check"})]},we.code))]}),p.jsx("div",{className:"lf-lang-separator"}),p.jsxs("div",{className:"lf-lang-section",children:[p.jsx("div",{className:"lf-dropdown-section-title",children:"Subtitles"}),zt.map(we=>p.jsxs("div",{className:`lf-filter-dropdown__option ${S===we.code?"is-selected":""}`,onClick:()=>$("sub",we.code),children:[p.jsx("span",{children:we.name}),S===we.code&&p.jsx("span",{className:"material-icons",children:"check"})]},we.code))]}),p.jsx("div",{className:"lf-lang-footer",children:p.jsxs("button",{className:"lf-edit-subs-btn",onClick:()=>{A(!1),u(!0)},children:[p.jsx("span",{className:"material-icons",children:"edit"}),p.jsx("span",{children:"Edit Subtitles"})]})})]})]}),p.jsxs("button",{className:"lf-filter-btn",onClick:fe,title:M?"Mark as Unwatched":"Mark as Watched",children:[p.jsx("span",{className:"material-icons",children:M?"visibility_off":"visibility"}),p.jsx("span",{children:M?"Mark Unwatched":"Mark Watched"})]})]})]}),p.jsx("div",{className:"lf-movie-player-main",children:p.jsxs("div",{className:"lf-movie-player-placeholder",children:[p.jsx("span",{className:"material-icons",style:{fontSize:"64px",opacity:.5},children:"play_circle_outline"}),p.jsx("p",{style:{marginTop:"10px",fontWeight:500},children:"Click 'Start Watching' to play movie"})]})})]}),p.jsx("hr",{className:"lf-section-divider"}),bt.length>0&&p.jsxs("div",{className:"lf-content-section",children:[p.jsx("h2",{className:"lf-section-title",children:"Cast & Crew"}),p.jsx("div",{className:"lf-cast-grid",children:bt.map(we=>p.jsxs("div",{className:"lf-cast-card",children:[p.jsx("img",{src:te.getImageUrl(we,"Primary")||"https://via.placeholder.com/80x80?text=?",alt:we.Name,className:"lf-cast-card__image",onError:Ue=>{Ue.target.src="https://via.placeholder.com/80x80?text=?"}}),p.jsx("div",{className:"lf-cast-card__name",children:we.Name}),p.jsx("div",{className:"lf-cast-card__role",children:we.Role})]},we.Id||we.Name))})]}),p.jsx("hr",{className:"lf-section-divider"}),n.length>0&&p.jsxs("div",{className:"lf-content-section",style:{marginBottom:40},children:[p.jsx("h2",{className:"lf-section-title",children:"More Like This"}),p.jsx("div",{className:"lf-similar-grid",children:n.map(we=>p.jsxs(Wr,{to:`/movie/${we.Id}`,className:"lf-similar-card",children:[p.jsx("img",{className:"lf-similar-card__poster",src:te.getImageUrl(we,"Primary"),alt:we.Name,loading:"lazy"}),p.jsx("div",{className:"lf-similar-card__title",children:we.Name})]},we.Id))})]}),p.jsx(Yu,{isOpen:d,onClose:()=>u(!1),seriesId:t?t.Id:"",initialSeasonId:null,initialEpisodeId:t?t.Id:"",isMovie:!0}),U&&p.jsx("div",{className:"lf-blocked-modal-overlay",children:p.jsxs("div",{className:"lf-blocked-modal",children:[p.jsx("span",{className:"material-icons lf-blocked-icon",children:"block"}),p.jsx("h3",{children:"Content blocked by browser"}),p.jsx("p",{children:"The trailer cannot be played because your browser blocked it. This usually happens due to tracking protection or ad blockers affecting the YouTube player."}),p.jsx("button",{className:"lf-btn lf-btn--primary",onClick:()=>{K(!1),Be()},children:"Close"})]})})]})},A1=[{id:"details",label:"My details"},{id:"display",label:"Display"},{id:"home",label:"Home Screen"},{id:"playback",label:"Playback"},{id:"subtitles",label:"Subtitles"},{id:"quickconnect",label:"Quick Connect"},{id:"advanced",label:"Advanced"}],_1=()=>{js();const[i,e]=w.useState(null),[t,s]=w.useState("details"),[n,r]=w.useState(""),[l,c]=w.useState(!1),[d,u]=w.useState(!1),[f,g]=w.useState(!1),[y,x]=w.useState(""),[S,E]=w.useState(""),[T,A]=w.useState(""),[I,_]=w.useState(null),[C,k]=w.useState(!1),[D,O]=w.useState("en-US"),[F,j]=w.useState("default"),[U,K]=w.useState(""),[H,ee]=w.useState(""),[re,de]=w.useState("Default"),[M,V]=w.useState(""),[q,ae]=w.useState("Default"),[pe,P]=w.useState(""),[$,G]=w.useState(null),[fe,ge]=w.useState([{id:"resume",label:"Continue Watching",enabled:!0},{id:"latestMedia",label:"Latest Media",enabled:!0},{id:"nextUp",label:"Next Up",enabled:!0},{id:"favorites",label:"My Favorites",enabled:!0}]);w.useEffect(()=>{(async()=>{const He=await te.getCurrentUser();if(He){e(He);const Tt=He.Configuration||{};Tt.AudioLanguagePreference&&K(Tt.AudioLanguagePreference),Tt.SubtitleLanguagePreference&&V(Tt.SubtitleLanguagePreference),Tt.SubtitleMode&&ae(Tt.SubtitleMode);const rt=localStorage.getItem(`LegitFlix_Banner_${He.Id}`);rt?r(rt):He.ImageTags&&He.ImageTags.Banner?r(`${te.api.basePath}/Users/${He.Id}/Images/Banner?tag=${He.ImageTags.Banner}&quality=90`):He.BackdropImageTags&&He.BackdropImageTags.length>0&&r(`${te.api.basePath}/Users/${He.Id}/Images/Backdrop/0?tag=${He.BackdropImageTags[0]}&quality=90`)}})()},[]);const _e=Ce=>{i&&(localStorage.setItem(`LegitFlix_Banner_${i.Id}`,Ce),r(Ce))},Ne=async Ce=>{if(!(!Ce||!i))try{await te.uploadUserImage(i.Id,"Primary",Ce),e(Tt=>({...Tt,PrimaryImageTag:Date.now().toString()}));const He=await te.getCurrentUser();He&&e(He),u(!1)}catch(He){console.error("Failed to upload avatar",He)}},Ge=async Ce=>{if(Ce.preventDefault(),_(null),S!==T){_({type:"error",text:"New passwords do not match."});return}if(!S){_({type:"error",text:"New password cannot be empty."});return}k(!0);try{await te.updatePassword(i.Id,y,S),_({type:"success",text:"Password updated successfully!"}),x(""),E(""),A("")}catch(He){_({type:"error",text:He.message||"Failed to update password."})}finally{k(!1)}},Be=async()=>{if(G(null),!pe.trim()){G({type:"error",text:"Please enter a code."});return}try{await te.quickConnect(pe.trim()),G({type:"success",text:"Device authorized successfully!"}),P("")}catch(Ce){G({type:"error",text:Ce.message||"Authorization failed."})}},pt=Ce=>{ge(He=>He.map(Tt=>Tt.id===Ce?{...Tt,enabled:!Tt.enabled}:Tt))},At=async()=>{await te.logout()};if(!i)return p.jsxs("div",{className:"profile-page",children:[p.jsx(_a,{}),p.jsxs("div",{className:"settings-container",children:[p.jsx(ze,{type:"text",width:"200px",height:"32px",style:{marginBottom:"20px"}}),p.jsx("div",{className:"settings-tabs",children:[1,2,3,4,5,6].map(Ce=>p.jsx(ze,{width:"100px",height:"40px",style:{display:"inline-block",marginRight:"8px",borderRadius:"20px"}},Ce))}),p.jsx(ze,{width:"100%",height:"250px",style:{margin:"20px 0",borderRadius:"12px"}}),p.jsx("div",{style:{display:"flex",gap:"20px",marginTop:"-55px",paddingLeft:"30px",position:"relative",marginBottom:"28px"},children:p.jsx(ze,{type:"circle",width:"110px",height:"110px",style:{border:"4px solid #0e0e0e"}})}),p.jsxs("div",{className:"settings-card",style:{padding:"28px",border:"1px solid rgba(255,255,255,0.05)",borderRadius:"14px"},children:[p.jsx(ze,{width:"180px",height:"24px",style:{marginBottom:"24px"}}),p.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(180px, 1fr))",gap:"18px"},children:[1,2,3,4].map(Ce=>p.jsxs("div",{children:[p.jsx(ze,{width:"80px",height:"14px",style:{marginBottom:"8px"}}),p.jsx(ze,{width:"140px",height:"20px"})]},Ce))})]})]})]});const Vt=i.PrimaryImageTag?`${te.api.basePath}/Users/${i.Id}/Images/Primary?tag=${i.PrimaryImageTag}&quality=90`:null,bt=()=>p.jsxs(p.Fragment,{children:[p.jsxs("div",{className:"settings-card",children:[p.jsx("h3",{className:"settings-card-title",children:"User Information"}),p.jsxs("div",{className:"info-grid",children:[p.jsxs("div",{className:"info-item",children:[p.jsx("label",{children:"Username"}),p.jsx("div",{className:"info-value",children:i.Name})]}),p.jsxs("div",{className:"info-item",children:[p.jsx("label",{children:"Last Login"}),p.jsx("div",{className:"info-value",children:i.LastLoginDate?new Date(i.LastLoginDate).toLocaleDateString():""})]}),p.jsxs("div",{className:"info-item",children:[p.jsx("label",{children:"Administrator"}),p.jsx("div",{className:"info-value",children:i.Policy?.IsAdministrator?"Yes":"No"})]}),p.jsxs("div",{className:"info-item",children:[p.jsx("label",{children:"User ID"}),p.jsx("div",{className:"info-value info-value-small",children:i.Id})]})]})]}),p.jsxs("div",{className:"settings-card",children:[p.jsx("h3",{className:"settings-card-title",children:"Change Password"}),p.jsxs("form",{className:"password-form",onSubmit:Ge,children:[p.jsxs("div",{className:"form-group",children:[p.jsx("label",{children:"Current Password"}),p.jsx("input",{type:"password",value:y,onChange:Ce=>x(Ce.target.value),className:"settings-input",autoComplete:"current-password"})]}),p.jsxs("div",{className:"form-group",children:[p.jsx("label",{children:"New Password"}),p.jsx("input",{type:"password",value:S,onChange:Ce=>E(Ce.target.value),className:"settings-input",autoComplete:"new-password"})]}),p.jsxs("div",{className:"form-group",children:[p.jsx("label",{children:"Confirm New Password"}),p.jsx("input",{type:"password",value:T,onChange:Ce=>A(Ce.target.value),className:"settings-input",autoComplete:"new-password"})]}),I&&p.jsxs("div",{className:`form-message ${I.type}`,children:[p.jsx("span",{className:"material-icons",children:I.type==="success"?"check_circle":"error"}),I.text]}),p.jsx("button",{type:"submit",className:"btn-accent",disabled:C,children:C?"SAVING...":"SAVE PASSWORD"})]})]})]}),gt=()=>p.jsxs("div",{className:"settings-card",children:[p.jsx("h3",{className:"settings-card-title",children:"Display Preferences"}),p.jsxs("div",{className:"form-group",children:[p.jsx("label",{children:"Display Language"}),p.jsxs("select",{className:"settings-select",value:D,onChange:Ce=>O(Ce.target.value),children:[p.jsx("option",{value:"en-US",children:"English (United States)"}),p.jsx("option",{value:"hu",children:"Magyar (Hungarian)"}),p.jsx("option",{value:"de",children:"Deutsch (German)"}),p.jsx("option",{value:"fr",children:"Franais (French)"}),p.jsx("option",{value:"es",children:"Espaol (Spanish)"}),p.jsx("option",{value:"ja",children:" (Japanese)"})]})]}),p.jsxs("div",{className:"form-group",children:[p.jsx("label",{children:"Date Format"}),p.jsxs("select",{className:"settings-select",value:F,onChange:Ce=>j(Ce.target.value),children:[p.jsx("option",{value:"default",children:"Use browser default"}),p.jsx("option",{value:"yyyy-MM-dd",children:"YYYY-MM-DD"}),p.jsx("option",{value:"dd/MM/yyyy",children:"DD/MM/YYYY"}),p.jsx("option",{value:"MM/dd/yyyy",children:"MM/DD/YYYY"})]})]}),p.jsxs("div",{className:"setting-row",children:[p.jsxs("div",{className:"setting-row-label",children:[p.jsx("span",{children:"Enable LegitFlix Theme"}),p.jsx("span",{className:"setting-hint",children:"Use the custom gaming profile theme"})]}),p.jsxs("label",{className:"toggle-switch",children:[p.jsx("input",{type:"checkbox",defaultChecked:!0}),p.jsx("span",{className:"slider"})]})]})]}),zt=()=>p.jsxs("div",{className:"settings-card",children:[p.jsx("h3",{className:"settings-card-title",children:"Home Screen Sections"}),p.jsx("p",{className:"settings-description",children:"Choose which sections to display on your home screen."}),fe.map(Ce=>p.jsxs("div",{className:"setting-row",children:[p.jsx("div",{className:"setting-row-label",children:p.jsx("span",{children:Ce.label})}),p.jsxs("label",{className:"toggle-switch",children:[p.jsx("input",{type:"checkbox",checked:Ce.enabled,onChange:()=>pt(Ce.id)}),p.jsx("span",{className:"slider"})]})]},Ce.id))]}),Fe=()=>p.jsxs("div",{className:"settings-card",children:[p.jsx("h3",{className:"settings-card-title",children:"Playback Settings"}),p.jsxs("div",{className:"form-group",children:[p.jsx("label",{children:"Preferred Audio Language"}),p.jsxs("select",{className:"settings-select",value:U,onChange:Ce=>K(Ce.target.value),children:[p.jsx("option",{value:"",children:"Auto / Server Default"}),p.jsx("option",{value:"eng",children:"English"}),p.jsx("option",{value:"hun",children:"Hungarian"}),p.jsx("option",{value:"jpn",children:"Japanese"}),p.jsx("option",{value:"ger",children:"German"}),p.jsx("option",{value:"fre",children:"French"}),p.jsx("option",{value:"spa",children:"Spanish"})]})]}),p.jsxs("div",{className:"form-group",children:[p.jsx("label",{children:"Max Streaming Bitrate"}),p.jsxs("select",{className:"settings-select",value:H,onChange:Ce=>ee(Ce.target.value),children:[p.jsx("option",{value:"",children:"Auto"}),p.jsx("option",{value:"120000000",children:"120 Mbps (4K)"}),p.jsx("option",{value:"80000000",children:"80 Mbps"}),p.jsx("option",{value:"60000000",children:"60 Mbps"}),p.jsx("option",{value:"40000000",children:"40 Mbps"}),p.jsx("option",{value:"20000000",children:"20 Mbps (1080p)"}),p.jsx("option",{value:"8000000",children:"8 Mbps (720p)"}),p.jsx("option",{value:"4000000",children:"4 Mbps"}),p.jsx("option",{value:"2000000",children:"2 Mbps"})]})]}),p.jsxs("div",{className:"setting-row",children:[p.jsxs("div",{className:"setting-row-label",children:[p.jsx("span",{children:"Prefer fMP4-HLS Container"}),p.jsx("span",{className:"setting-hint",children:"Uses fMP4 container for HLS playback when available"})]}),p.jsxs("label",{className:"toggle-switch",children:[p.jsx("input",{type:"checkbox",defaultChecked:!1}),p.jsx("span",{className:"slider"})]})]}),p.jsxs("div",{className:"setting-row",children:[p.jsxs("div",{className:"setting-row-label",children:[p.jsx("span",{children:"Enable Cinema Mode"}),p.jsx("span",{className:"setting-hint",children:"Play trailers and custom intros before the main feature"})]}),p.jsxs("label",{className:"toggle-switch",children:[p.jsx("input",{type:"checkbox",defaultChecked:!0}),p.jsx("span",{className:"slider"})]})]})]}),we=()=>p.jsxs("div",{className:"settings-card",children:[p.jsx("h3",{className:"settings-card-title",children:"Subtitle Preferences"}),p.jsxs("div",{className:"form-group",children:[p.jsx("label",{children:"Preferred Subtitle Language"}),p.jsxs("select",{className:"settings-select",value:M,onChange:Ce=>V(Ce.target.value),children:[p.jsx("option",{value:"",children:"None"}),p.jsx("option",{value:"eng",children:"English"}),p.jsx("option",{value:"hun",children:"Hungarian"}),p.jsx("option",{value:"jpn",children:"Japanese"}),p.jsx("option",{value:"ger",children:"German"}),p.jsx("option",{value:"fre",children:"French"}),p.jsx("option",{value:"spa",children:"Spanish"})]})]}),p.jsxs("div",{className:"form-group",children:[p.jsx("label",{children:"Subtitle Mode"}),p.jsxs("select",{className:"settings-select",value:q,onChange:Ce=>ae(Ce.target.value),children:[p.jsx("option",{value:"Default",children:"Default"}),p.jsx("option",{value:"Always",children:"Always Show"}),p.jsx("option",{value:"OnlyForced",children:"Only Forced"}),p.jsx("option",{value:"None",children:"None"}),p.jsx("option",{value:"Smart",children:"Smart (match audio)"})]})]}),p.jsxs("div",{className:"setting-row",children:[p.jsxs("div",{className:"setting-row-label",children:[p.jsx("span",{children:"Burn in Subtitles"}),p.jsx("span",{className:"setting-hint",children:"Permanently render subtitles into the video stream"})]}),p.jsxs("label",{className:"toggle-switch",children:[p.jsx("input",{type:"checkbox",defaultChecked:!1}),p.jsx("span",{className:"slider"})]})]})]}),Ue=()=>p.jsxs("div",{className:"settings-card",children:[p.jsx("h3",{className:"settings-card-title",children:"Quick Connect"}),p.jsx("p",{className:"settings-description",children:"Enter the code displayed on your device to authorize it with your account."}),p.jsxs("div",{className:"qc-row",children:[p.jsx("input",{type:"text",className:"settings-input qc-input",placeholder:"Enter code",value:pe,onChange:Ce=>P(Ce.target.value),maxLength:10}),p.jsx("button",{className:"btn-accent",onClick:Be,children:"AUTHORIZE"})]}),$&&p.jsxs("div",{className:`form-message ${$.type}`,style:{marginTop:"12px"},children:[p.jsx("span",{className:"material-icons",children:$.type==="success"?"check_circle":"error"}),$.text]})]}),qe=()=>p.jsxs("div",{className:"settings-card",children:[p.jsx("h3",{className:"settings-card-title",children:"Advanced"}),i.Policy?.IsAdministrator&&p.jsxs("button",{className:"btn-link-row",onClick:()=>window.location.href="/web/index.html#!/dashboard",children:[p.jsx("span",{className:"material-icons",children:"dashboard"}),p.jsxs("div",{children:[p.jsx("span",{children:"Server Dashboard"}),p.jsx("span",{className:"setting-hint",children:"Manage server settings, users, and libraries"})]}),p.jsx("span",{className:"material-icons link-arrow",children:"chevron_right"})]}),p.jsxs("button",{className:"btn-link-row",onClick:()=>window.location.href="/web/index.html#!/playback/profile",children:[p.jsx("span",{className:"material-icons",children:"tune"}),p.jsxs("div",{children:[p.jsx("span",{children:"Playback Profiles"}),p.jsx("span",{className:"setting-hint",children:"Configure device playback profiles"})]}),p.jsx("span",{className:"material-icons link-arrow",children:"chevron_right"})]}),p.jsxs("button",{className:"btn-link-row",onClick:()=>window.location.href="/web/index.html#!/networking",children:[p.jsx("span",{className:"material-icons",children:"lan"}),p.jsxs("div",{children:[p.jsx("span",{children:"Networking"}),p.jsx("span",{className:"setting-hint",children:"Server networking and remote access settings"})]}),p.jsx("span",{className:"material-icons link-arrow",children:"chevron_right"})]}),p.jsxs("button",{className:"btn-link-row",onClick:()=>window.location.href="/web/index.html#!/mypreferencesmenu",children:[p.jsx("span",{className:"material-icons",children:"settings_applications"}),p.jsxs("div",{children:[p.jsx("span",{children:"Classic User Settings"}),p.jsx("span",{className:"setting-hint",children:"Open the default Jellyfin user preferences"})]}),p.jsx("span",{className:"material-icons link-arrow",children:"chevron_right"})]}),i.Policy?.IsAdministrator&&p.jsxs("button",{className:"btn-link-row",onClick:()=>window.location.href="/web/index.html#!/plugins",children:[p.jsx("span",{className:"material-icons",children:"extension"}),p.jsxs("div",{children:[p.jsx("span",{children:"Plugins"}),p.jsx("span",{className:"setting-hint",children:"Manage installed plugins"})]}),p.jsx("span",{className:"material-icons link-arrow",children:"chevron_right"})]}),p.jsx("div",{className:"dropdown-divider",style:{margin:"16px 0",borderColor:"rgba(255,255,255,0.05)"}}),p.jsxs("button",{className:"btn-link-row",onClick:()=>g(!0),children:[p.jsx("span",{className:"material-icons",children:"palette"}),p.jsxs("div",{children:[p.jsx("span",{children:"LegitFlix Settings"}),p.jsx("span",{className:"setting-hint",children:"Customize theme colors and logo"})]}),p.jsx("span",{className:"material-icons link-arrow",children:"chevron_right"})]})]}),dt=()=>{switch(t){case"details":return bt();case"display":return gt();case"home":return zt();case"playback":return Fe();case"subtitles":return we();case"quickconnect":return Ue();case"advanced":return qe();default:return null}};return p.jsxs("div",{className:"profile-page",children:[p.jsx(_a,{}),p.jsxs("div",{className:"settings-container",children:[p.jsx("h1",{className:"settings-page-title",children:"Account Settings"}),p.jsxs("div",{className:"settings-tabs",children:[A1.map(Ce=>p.jsx("button",{className:`settings-tab ${t===Ce.id?"active":""}`,onClick:()=>s(Ce.id),children:Ce.label},Ce.id)),p.jsx("button",{className:"settings-tab settings-tab-logout",onClick:At,title:"Sign Out",children:p.jsx("span",{className:"material-icons",children:"exit_to_app"})})]}),p.jsxs("div",{className:`settings-banner ${n?"has-banner":""}`,style:n?{backgroundImage:`url('${n}')`}:{},children:[p.jsx("div",{className:"banner-overlay"}),p.jsxs("div",{className:"banner-edit-btn",onClick:()=>c(!0),children:[p.jsx("span",{className:"material-icons-outlined",children:n?"edit":"add_photo_alternate"}),p.jsx("span",{children:n?"Change profile banner":"Add profile banner"})]})]}),p.jsxs("div",{className:"settings-avatar-wrap",children:[p.jsx("div",{className:"settings-avatar",style:Vt?{backgroundImage:`url('${Vt}')`}:{},children:!Vt&&p.jsx("span",{className:"material-icons avatar-placeholder",children:"person"})}),p.jsx("div",{className:"avatar-edit-badge",title:"Change avatar",onClick:()=>u(!0),children:p.jsx("span",{className:"material-icons",children:"edit"})})]}),p.jsx("div",{className:"settings-content",children:dt()})]}),p.jsx(Pm,{isOpen:l,onClose:()=>c(!1),onSave:_e,userId:i?.Id}),p.jsx($S,{isOpen:f,onClose:()=>g(!1),userId:i?.Id}),p.jsx(Ku,{isOpen:d,onClose:()=>u(!1),onSave:Ne,userId:i?.Id})]})},I1=()=>{const i=js(),{config:e}=Wi(),[t,s]=w.useState(window.location.origin),[n,r]=w.useState(!1),[l,c]=w.useState(""),d=async u=>{u.preventDefault(),r(!0),c("");try{const f=await te.validateServer(t);f&&f.valid?(te.initialize(null,f.baseUrl),i("/login/select-user")):c("Could not connect to server. Please check the URL.")}catch(f){console.error("Validation error",f),c("An error occurred while connecting.")}finally{r(!1)}};return p.jsx("div",{className:"auth-page",children:p.jsxs("div",{className:"auth-container",children:[p.jsxs("div",{className:"auth-logo",children:[e.logoUrl?p.jsx("img",{src:e.logoUrl,alt:"LegitFlix",className:"auth-logo-img"}):p.jsx("img",{src:yo(e.accentColor),alt:"LegitFlix",className:"auth-logo-img"}),p.jsx("p",{children:"Connect to Server"})]}),p.jsxs("form",{onSubmit:d,className:"auth-form",children:[p.jsxs("div",{className:"form-group",children:[p.jsx("label",{children:"Server URL"}),p.jsx("input",{type:"text",className:"auth-input",value:t,onChange:u=>s(u.target.value),placeholder:"http://myserver:8096"})]}),l&&p.jsx("div",{className:"auth-error",children:l}),p.jsx(bi,{type:"submit",variant:"ringHover",size:"lg",disabled:n,className:"w-full",children:n?"Connecting...":"Connect"})]})]})})},R1=()=>{const i=js(),{config:e}=Wi(),[t,s]=w.useState([]),[n,r]=w.useState(!0);w.useEffect(()=>{(async()=>{try{const f=await te.getPublicUsers();f&&s(f)}catch(f){console.error("Failed to load users",f)}finally{r(!1)}})()},[]);const l=u=>{i("/login",{state:{username:u.Name,userId:u.Id}})},c=()=>{i("/login")},d=()=>{i("/login/select-server")};return p.jsx("div",{className:"auth-page",children:p.jsxs("div",{className:"auth-container",children:[p.jsxs("div",{className:"auth-logo",children:[e.logoUrl?p.jsx("img",{src:e.logoUrl,alt:"LegitFlix",className:"auth-logo-img"}):p.jsx("img",{src:yo(e.accentColor),alt:"LegitFlix",className:"auth-logo-img"}),p.jsx("p",{children:"Who's watching?"})]}),n?p.jsx("div",{className:"user-grid",children:[1,2,3].map(u=>p.jsxs("div",{className:"user-card",style:{cursor:"default"},children:[p.jsx("div",{className:"user-avatar-container",style:{border:"none",padding:0},children:p.jsx(ze,{type:"circle",width:"100px",height:"100px"})}),p.jsx(ze,{type:"text",width:"80px",height:"20px",style:{marginTop:"10px"}})]},u))}):p.jsxs(p.Fragment,{children:[p.jsx("div",{className:"user-grid",children:t.map(u=>p.jsxs("button",{className:"user-card",onClick:()=>l(u),children:[p.jsxs("div",{className:"user-avatar-container",children:[p.jsx("div",{className:"auth-avatar-wrapper",children:p.jsx("img",{src:`${te.api.basePath||""}/Users/${u.Id}/Images/Primary?quality=90`,alt:u.Name,className:"auth-avatar",onError:f=>{f.target.style.display="none",f.target.parentElement.nextSibling.style.display="flex"}})}),p.jsx("div",{className:"user-avatar-placeholder",style:{display:"none"},children:p.jsx("span",{className:"material-icons",children:"person"})})]}),p.jsx("span",{className:"user-card-name",children:u.Name})]},u.Id))}),p.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"10px",alignItems:"center"},children:[p.jsx("button",{className:"text-link",onClick:c,children:"Manual Login"}),p.jsx("button",{className:"text-link",style:{fontSize:"0.8rem",opacity:.7},onClick:d,children:"Switch Server"})]})]})]})})},L1=()=>{const i=js(),e=Kn(),{config:t}=Wi(),s=e.state?.username||"",[n,r]=w.useState(s),[l,c]=w.useState(""),[d,u]=w.useState(!1),[f,g]=w.useState(""),[y,x]=w.useState(!1),[S,E]=w.useState(""),[T,A]=w.useState("");w.useEffect(()=>{let _;return y?(async()=>{try{u(!0);const k=await te.initiateQuickConnect();E(k.Code),A(k.Secret),u(!1),_=setInterval(async()=>{if(k.Secret)try{await te.checkQuickConnectStatus(k.Secret)&&(clearInterval(_),i("/"))}catch(D){console.warn("Polling error",D)}},2e3)}catch(k){console.error("Quick Connect Init Failed",k),g("Failed to initialize Quick Connect."),u(!1)}})():(E(""),A(""),_&&clearInterval(_)),()=>{_&&clearInterval(_)}},[y,i]);const I=async _=>{_.preventDefault(),u(!0),g("");try{await te.authenticateUser(n,l),await te.getCurrentUser()?i("/"):g("Login succeeded but failed to retrieve user session.")}catch(C){console.error("Login error",C),g("Invalid username or password.")}finally{u(!1)}};return p.jsx("div",{className:"auth-page",children:p.jsxs("div",{className:"auth-container",children:[p.jsxs("div",{className:"auth-logo",children:[t.logoUrl?p.jsx("img",{src:t.logoUrl,alt:"LegitFlix",className:"auth-logo-img"}):p.jsx("img",{src:yo(t.accentColor),alt:"LegitFlix",className:"auth-logo-img"}),p.jsx("p",{children:y?"Quick Connect":"Sign In"})]}),y?p.jsxs("div",{className:"qc-container",children:[d?p.jsx("div",{className:"qc-spinner"}):p.jsxs(p.Fragment,{children:[p.jsx("div",{className:"qc-instructions",children:"Use your mobile device to scan the code or enter it manually."}),p.jsx("div",{className:"qc-code-display",children:S}),p.jsx("div",{className:"qc-instructions",children:"Waiting for authorization..."}),p.jsx("div",{className:"qc-spinner"})]}),p.jsx("button",{type:"button",className:"text-link",onClick:()=>x(!1),children:"Cancel"})]}):p.jsxs("form",{onSubmit:I,className:"auth-form",children:[p.jsxs("div",{className:"form-group",children:[p.jsx("label",{children:"Username"}),p.jsx("input",{type:"text",className:"auth-input",value:n,onChange:_=>r(_.target.value),placeholder:"Enter username"})]}),p.jsxs("div",{className:"form-group",children:[p.jsx("label",{children:"Password"}),p.jsx("input",{type:"password",className:"auth-input",value:l,onChange:_=>c(_.target.value),placeholder:"Enter password"})]}),f&&p.jsx("div",{className:"auth-error",children:f}),p.jsxs("div",{className:"auth-btn-group",children:[p.jsx(bi,{type:"submit",variant:"ringHover",size:"lg",disabled:d,className:"w-full",children:d?"Signing in...":"Sign In"}),p.jsx(bi,{type:"button",variant:"outline",size:"lg",onClick:()=>x(!0),className:"w-full",children:"Quick Connect"})]}),p.jsx("button",{type:"button",className:"text-link",onClick:()=>i("/login/select-user"),children:"Back to Users"})]})]})})},w1=()=>{const[i,e]=w.useState(null);return w.useEffect(()=>{(async()=>{try{const s=await te.getCurrentUser();e(!!s)}catch(s){console.error("Auth check failed",s),e(!1)}})()},[]),i===null?p.jsx("div",{style:{padding:"20px"},children:p.jsx(ze,{width:"100%",height:"100vh"})}):i?p.jsx(j_,{}):p.jsx(M_,{to:"/login/select-user",replace:!0})},C1=()=>{const i=js();return w.useEffect(()=>{const e=window.location.hash;if(e.startsWith("#!/")){if(e==="#!/"||e==="#!/home"||e==="#!/home.html")return;if(console.log("[LegitFlix] Intercepted legacy hash:",e),e.includes("details?id=")){const r=new URLSearchParams(e.split("?")[1]).get("id");if(r){i(`/item/${r}`);return}}if(["mypreferencesmenu","user","settings"].some(n=>e.includes(n))){console.log("[LegitFlix] Redirecting settings hash to /profile:",e),i("/profile");return}if(e.includes("selectserver.html")||e.includes("login.html")){console.log("[LegitFlix] Redirecting auth hash to /login/select-user:",e),i("/login/select-user");return}if(["dashboard","plugins","wizard","scheduledtasks","server","networking","devices","api","logs","notifications","librarydisplay","playback","transcoding","live-tv","dlna","intro-s","activity","itemdetails","edititem"].some(n=>e.includes(n))){console.log("[LegitFlix] Redirecting to Classic Mode for:",e),window.location.replace(`/web/index.html?classic=true${e}`);return}}},[i]),null},k1=()=>{const{id:i}=Fu(),e=js(),[t,s]=w.useState(null);return w.useEffect(()=>{i&&(async()=>{try{const r=await te.getCurrentUser();if(!r)return;const l=await te.getItem(r.Id,i);if(!l){s("Item not found");return}switch(console.log("[LegitFlix] Resolved item type:",l.Type),l.Type){case"Series":e(`/series/${l.Id}`,{replace:!0});break;case"Movie":e(`/movie/${l.Id}`,{replace:!0});break;case"Season":case"Episode":l.SeriesId?e(`/series/${l.SeriesId}`,{replace:!0}):window.location.href=`/web/index.html?classic=true#!/details?id=${l.Id}`;break;default:console.log("[LegitFlix] Unsupported item type, falling back to classic:",l.Type),window.location.href=`/web/index.html?classic=true#!/details?id=${l.Id}`;break}}catch(r){console.error("Failed to resolve item:",r),s("Failed to resolve item link."),setTimeout(()=>{window.location.href=`/web/index.html?classic=true#!/details?id=${i}`},2e3)}})()},[i,e]),p.jsxs("div",{style:{minHeight:"100vh",background:"#000",color:"#fff",display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column"},children:[p.jsx(_a,{}),t&&p.jsxs("div",{style:{marginTop:100},children:[p.jsx("h2",{children:t}),p.jsx("p",{children:"Redirecting to classic view..."})]})]})},ke=Number.isFinite||function(i){return typeof i=="number"&&isFinite(i)},N1=Number.isSafeInteger||function(i){return typeof i=="number"&&Math.abs(i)<=O1},O1=Number.MAX_SAFE_INTEGER||9007199254740991;let je=(function(i){return i.NETWORK_ERROR="networkError",i.MEDIA_ERROR="mediaError",i.KEY_SYSTEM_ERROR="keySystemError",i.MUX_ERROR="muxError",i.OTHER_ERROR="otherError",i})({}),W=(function(i){return i.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",i.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",i.KEY_SYSTEM_NO_SESSION="keySystemNoSession",i.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",i.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",i.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",i.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",i.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",i.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",i.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",i.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",i.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",i.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",i.MANIFEST_LOAD_ERROR="manifestLoadError",i.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",i.MANIFEST_PARSING_ERROR="manifestParsingError",i.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",i.LEVEL_EMPTY_ERROR="levelEmptyError",i.LEVEL_LOAD_ERROR="levelLoadError",i.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",i.LEVEL_PARSING_ERROR="levelParsingError",i.LEVEL_SWITCH_ERROR="levelSwitchError",i.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",i.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",i.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",i.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",i.FRAG_LOAD_ERROR="fragLoadError",i.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",i.FRAG_DECRYPT_ERROR="fragDecryptError",i.FRAG_PARSING_ERROR="fragParsingError",i.FRAG_GAP="fragGap",i.REMUX_ALLOC_ERROR="remuxAllocError",i.KEY_LOAD_ERROR="keyLoadError",i.KEY_LOAD_TIMEOUT="keyLoadTimeOut",i.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",i.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",i.BUFFER_APPEND_ERROR="bufferAppendError",i.BUFFER_APPENDING_ERROR="bufferAppendingError",i.BUFFER_STALLED_ERROR="bufferStalledError",i.BUFFER_FULL_ERROR="bufferFullError",i.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",i.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",i.ASSET_LIST_LOAD_ERROR="assetListLoadError",i.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",i.ASSET_LIST_PARSING_ERROR="assetListParsingError",i.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",i.INTERNAL_EXCEPTION="internalException",i.INTERNAL_ABORTED="aborted",i.ATTACH_MEDIA_ERROR="attachMediaError",i.UNKNOWN="unknown",i})({}),L=(function(i){return i.MEDIA_ATTACHING="hlsMediaAttaching",i.MEDIA_ATTACHED="hlsMediaAttached",i.MEDIA_DETACHING="hlsMediaDetaching",i.MEDIA_DETACHED="hlsMediaDetached",i.MEDIA_ENDED="hlsMediaEnded",i.STALL_RESOLVED="hlsStallResolved",i.BUFFER_RESET="hlsBufferReset",i.BUFFER_CODECS="hlsBufferCodecs",i.BUFFER_CREATED="hlsBufferCreated",i.BUFFER_APPENDING="hlsBufferAppending",i.BUFFER_APPENDED="hlsBufferAppended",i.BUFFER_EOS="hlsBufferEos",i.BUFFERED_TO_END="hlsBufferedToEnd",i.BUFFER_FLUSHING="hlsBufferFlushing",i.BUFFER_FLUSHED="hlsBufferFlushed",i.MANIFEST_LOADING="hlsManifestLoading",i.MANIFEST_LOADED="hlsManifestLoaded",i.MANIFEST_PARSED="hlsManifestParsed",i.LEVEL_SWITCHING="hlsLevelSwitching",i.LEVEL_SWITCHED="hlsLevelSwitched",i.LEVEL_LOADING="hlsLevelLoading",i.LEVEL_LOADED="hlsLevelLoaded",i.LEVEL_UPDATED="hlsLevelUpdated",i.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",i.LEVELS_UPDATED="hlsLevelsUpdated",i.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",i.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",i.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",i.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",i.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",i.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",i.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",i.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",i.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",i.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",i.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",i.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",i.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",i.CUES_PARSED="hlsCuesParsed",i.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",i.INIT_PTS_FOUND="hlsInitPtsFound",i.FRAG_LOADING="hlsFragLoading",i.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",i.FRAG_LOADED="hlsFragLoaded",i.FRAG_DECRYPTED="hlsFragDecrypted",i.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",i.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",i.FRAG_PARSING_METADATA="hlsFragParsingMetadata",i.FRAG_PARSED="hlsFragParsed",i.FRAG_BUFFERED="hlsFragBuffered",i.FRAG_CHANGED="hlsFragChanged",i.FPS_DROP="hlsFpsDrop",i.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",i.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",i.ERROR="hlsError",i.DESTROYING="hlsDestroying",i.KEY_LOADING="hlsKeyLoading",i.KEY_LOADED="hlsKeyLoaded",i.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",i.BACK_BUFFER_REACHED="hlsBackBufferReached",i.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",i.ASSET_LIST_LOADING="hlsAssetListLoading",i.ASSET_LIST_LOADED="hlsAssetListLoaded",i.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",i.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",i.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",i.INTERSTITIAL_STARTED="hlsInterstitialStarted",i.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",i.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",i.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",i.INTERSTITIAL_ENDED="hlsInterstitialEnded",i.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",i.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",i.EVENT_CUE_ENTER="hlsEventCueEnter",i})({});var at={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},De={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};class jr{constructor(e,t=0,s=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=s}sample(e,t){const s=Math.pow(this.alpha_,e);this.estimate_=t*(1-s)+s*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class D1{constructor(e,t,s,n=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=s,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new jr(e),this.fast_=new jr(t),this.defaultTTFB_=n,this.ttfb_=new jr(e)}update(e,t){const{slow_:s,fast_:n,ttfb_:r}=this;s.halfLife!==e&&(this.slow_=new jr(e,s.getEstimate(),s.getTotalWeight())),n.halfLife!==t&&(this.fast_=new jr(t,n.getEstimate(),n.getTotalWeight())),r.halfLife!==e&&(this.ttfb_=new jr(e,r.getEstimate(),r.getTotalWeight()))}sample(e,t){e=Math.max(e,this.minDelayMs_);const s=8*t,n=e/1e3,r=s/n;this.fast_.sample(n,r),this.slow_.sample(n,r)}sampleTTFB(e){const t=e/1e3,s=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(s,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}get defaultEstimate(){return this.defaultEstimate_}destroy(){}}function P1(i,e,t){return(e=M1(e))in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function Ot(){return Ot=Object.assign?Object.assign.bind():function(i){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var s in t)({}).hasOwnProperty.call(t,s)&&(i[s]=t[s])}return i},Ot.apply(null,arguments)}function wv(i,e){var t=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);e&&(s=s.filter(function(n){return Object.getOwnPropertyDescriptor(i,n).enumerable})),t.push.apply(t,s)}return t}function Lt(i){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?wv(Object(t),!0).forEach(function(s){P1(i,s,t[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(t)):wv(Object(t)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(t,s))})}return i}function U1(i,e){if(typeof i!="object"||!i)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}function M1(i){var e=U1(i,"string");return typeof e=="symbol"?e:e+""}class Vi{constructor(e,t){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;const s=`[${e}]:`;this.trace=Ta,this.debug=t.debug.bind(null,s),this.log=t.log.bind(null,s),this.warn=t.warn.bind(null,s),this.info=t.info.bind(null,s),this.error=t.error.bind(null,s)}}const Ta=function(){},j1={trace:Ta,debug:Ta,log:Ta,warn:Ta,info:Ta,error:Ta};function Jf(){return Ot({},j1)}function F1(i,e){const t=self.console[i];return t?t.bind(self.console,`${e?"["+e+"] ":""}[${i}] >`):Ta}function Cv(i,e,t){return e[i]?e[i].bind(e):F1(i,t)}const em=Jf();function B1(i,e,t){const s=Jf();if(typeof console=="object"&&i===!0||typeof i=="object"){const n=["debug","log","info","warn","error"];n.forEach(r=>{s[r]=Cv(r,i,t)});try{s.log(`Debug logs enabled for "${e}" in hls.js version 1.6.15`)}catch{return Jf()}n.forEach(r=>{em[r]=Cv(r,i)})}else Ot(em,s);return s}const wt=em;function Ia(i=!0){return typeof self>"u"?void 0:(i||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function V1(i){return typeof self<"u"&&i===self.ManagedMediaSource}function GS(i,e){const t=Object.keys(i),s=Object.keys(e),n=t.length,r=s.length;return!n||!r||n===r&&!t.some(l=>s.indexOf(l)===-1)}function Ti(i,e=!1){if(typeof TextDecoder<"u"){const u=new TextDecoder("utf-8").decode(i);if(e){const f=u.indexOf("\0");return f!==-1?u.substring(0,f):u}return u.replace(/\0/g,"")}const t=i.length;let s,n,r,l="",c=0;for(;c<t;){if(s=i[c++],s===0&&e)return l;if(s===0||s===3)continue;switch(s>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:l+=String.fromCharCode(s);break;case 12:case 13:n=i[c++],l+=String.fromCharCode((s&31)<<6|n&63);break;case 14:n=i[c++],r=i[c++],l+=String.fromCharCode((s&15)<<12|(n&63)<<6|(r&63)<<0);break}}return l}function Cs(i){let e="";for(let t=0;t<i.length;t++){let s=i[t].toString(16);s.length<2&&(s="0"+s),e+=s}return e}function HS(i){return Uint8Array.from(i.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}function $1(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var Sf={exports:{}},kv;function G1(){return kv||(kv=1,(function(i,e){(function(t){var s=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,n=/^(?=([^\/?#]*))\1([^]*)$/,r=/(?:\/|^)\.(?=\/)/g,l=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,c={buildAbsoluteURL:function(d,u,f){if(f=f||{},d=d.trim(),u=u.trim(),!u){if(!f.alwaysNormalize)return d;var g=c.parseURL(d);if(!g)throw new Error("Error trying to parse base URL.");return g.path=c.normalizePath(g.path),c.buildURLFromParts(g)}var y=c.parseURL(u);if(!y)throw new Error("Error trying to parse relative URL.");if(y.scheme)return f.alwaysNormalize?(y.path=c.normalizePath(y.path),c.buildURLFromParts(y)):u;var x=c.parseURL(d);if(!x)throw new Error("Error trying to parse base URL.");if(!x.netLoc&&x.path&&x.path[0]!=="/"){var S=n.exec(x.path);x.netLoc=S[1],x.path=S[2]}x.netLoc&&!x.path&&(x.path="/");var E={scheme:x.scheme,netLoc:y.netLoc,path:null,params:y.params,query:y.query,fragment:y.fragment};if(!y.netLoc&&(E.netLoc=x.netLoc,y.path[0]!=="/"))if(!y.path)E.path=x.path,y.params||(E.params=x.params,y.query||(E.query=x.query));else{var T=x.path,A=T.substring(0,T.lastIndexOf("/")+1)+y.path;E.path=c.normalizePath(A)}return E.path===null&&(E.path=f.alwaysNormalize?c.normalizePath(y.path):y.path),c.buildURLFromParts(E)},parseURL:function(d){var u=s.exec(d);return u?{scheme:u[1]||"",netLoc:u[2]||"",path:u[3]||"",params:u[4]||"",query:u[5]||"",fragment:u[6]||""}:null},normalizePath:function(d){for(d=d.split("").reverse().join("").replace(r,"");d.length!==(d=d.replace(l,"")).length;);return d.split("").reverse().join("")},buildURLFromParts:function(d){return d.scheme+d.netLoc+d.path+d.params+d.query+d.fragment}};i.exports=c})()})(Sf)),Sf.exports}var Um=G1();class Mm{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var Pt={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class zS{constructor(e){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,typeof e=="string"&&(e={url:e}),this.base=e,z1(this,"stats")}setByteRange(e,t){const s=e.split("@",2);let n;s.length===1?n=t?.byteRangeEndOffset||0:n=parseInt(s[1]),this._byteRange=[n,parseInt(s[0])+n]}get baseurl(){return this.base.url}get byteRange(){return this._byteRange===null?[]:this._byteRange}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get elementaryStreams(){return this._streams===null&&(this._streams={[Pt.AUDIO]:null,[Pt.VIDEO]:null,[Pt.AUDIOVIDEO]:null}),this._streams}set elementaryStreams(e){this._streams=e}get hasStats(){return this._stats!==null}get hasStreams(){return this._streams!==null}get stats(){return this._stats===null&&(this._stats=new Mm),this._stats}set stats(e){this._stats=e}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Um.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[Pt.AUDIO]=null,e[Pt.VIDEO]=null,e[Pt.AUDIOVIDEO]=null}}function rs(i){return i.sn!=="initSegment"}class bf extends zS{constructor(e,t){super(t),this._decryptdata=null,this._programDateTime=null,this._ref=null,this._bitrate=void 0,this.rawProgramDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.playlistOffset=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get byteLength(){if(this.hasStats){const e=this.stats.total;if(e)return e}if(this.byteRange.length){const e=this.byteRange[0],t=this.byteRange[1];if(ke(e)&&ke(t))return t-e}return null}get bitrate(){return this.byteLength?this.byteLength*8/this.duration:this._bitrate?this._bitrate:null}set bitrate(e){this._bitrate=e}get decryptdata(){var e;const{levelkeys:t}=this;if(!t||t.NONE)return null;if(t.identity)this._decryptdata||(this._decryptdata=t.identity.getDecryptData(this.sn));else if(!((e=this._decryptdata)!=null&&e.keyId)){const s=Object.keys(t);if(s.length===1){const n=this._decryptdata=t[s[0]]||null;n&&(this._decryptdata=n.getDecryptData(this.sn,t))}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null)return null;const e=ke(this.duration)?this.duration:0;return this.programDateTime+e*1e3}get encrypted(){var e;if((e=this._decryptdata)!=null&&e.encrypted)return!0;if(this.levelkeys){var t;const s=Object.keys(this.levelkeys),n=s.length;if(n>1||n===1&&(t=this.levelkeys[s[0]])!=null&&t.encrypted)return!0}return!1}get programDateTime(){return this._programDateTime===null&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime}set programDateTime(e){if(!ke(e)){this._programDateTime=this.rawProgramDateTime=null;return}this._programDateTime=e}get ref(){return rs(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}addStart(e){this.setStart(this.start+e)}setStart(e){this.start=e,this._ref&&(this._ref.start=e)}setDuration(e){this.duration=e,this._ref&&(this._ref.duration=e)}setKeyFormat(e){const t=this.levelkeys;if(t){var s;const n=t[e];n&&!((s=this._decryptdata)!=null&&s.keyId)&&(this._decryptdata=n.getDecryptData(this.sn,t))}}abortRequests(){var e,t;(e=this.loader)==null||e.abort(),(t=this.keyLoader)==null||t.abort()}setElementaryStreamInfo(e,t,s,n,r,l=!1){const{elementaryStreams:c}=this,d=c[e];if(!d){c[e]={startPTS:t,endPTS:s,startDTS:n,endDTS:r,partial:l};return}d.startPTS=Math.min(d.startPTS,t),d.endPTS=Math.max(d.endPTS,s),d.startDTS=Math.min(d.startDTS,n),d.endDTS=Math.max(d.endDTS,r)}}class H1 extends zS{constructor(e,t,s,n,r){super(s),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=n;const l=e.enumeratedString("BYTERANGE");l&&this.setByteRange(l,r),r&&(this.fragOffset=r.fragOffset+r.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}function KS(i,e){const t=Object.getPrototypeOf(i);if(t){const s=Object.getOwnPropertyDescriptor(t,e);return s||KS(t,e)}}function z1(i,e){const t=KS(i,e);t&&(t.enumerable=!0,Object.defineProperty(i,e,t))}const Nv=Math.pow(2,32)-1,K1=[].push,YS={video:1,audio:2,id3:3,text:4};function ys(i){return String.fromCharCode.apply(null,i)}function qS(i,e){const t=i[e]<<8|i[e+1];return t<0?65536+t:t}function Ye(i,e){const t=QS(i,e);return t<0?4294967296+t:t}function Ov(i,e){let t=Ye(i,e);return t*=Math.pow(2,32),t+=Ye(i,e+4),t}function QS(i,e){return i[e]<<24|i[e+1]<<16|i[e+2]<<8|i[e+3]}function Y1(i){const e=i.byteLength;for(let t=0;t<e;){const s=Ye(i,t);if(s>8&&i[t+4]===109&&i[t+5]===111&&i[t+6]===111&&i[t+7]===102)return!0;t=s>1?t+s:e}return!1}function st(i,e){const t=[];if(!e.length)return t;const s=i.byteLength;for(let n=0;n<s;){const r=Ye(i,n),l=ys(i.subarray(n+4,n+8)),c=r>1?n+r:s;if(l===e[0])if(e.length===1)t.push(i.subarray(n+8,c));else{const d=st(i.subarray(n+8,c),e.slice(1));d.length&&K1.apply(t,d)}n=c}return t}function q1(i){const e=[],t=i[0];let s=8;const n=Ye(i,s);s+=4;let r=0,l=0;t===0?(r=Ye(i,s),l=Ye(i,s+4),s+=8):(r=Ov(i,s),l=Ov(i,s+8),s+=16),s+=2;let c=i.length+l;const d=qS(i,s);s+=2;for(let u=0;u<d;u++){let f=s;const g=Ye(i,f);f+=4;const y=g&2147483647;if((g&2147483648)>>>31===1)return wt.warn("SIDX has hierarchical references (not supported)"),null;const S=Ye(i,f);f+=4,e.push({referenceSize:y,subsegmentDuration:S,info:{duration:S/n,start:c,end:c+y-1}}),c+=y,f+=4,s=f}return{earliestPresentationTime:r,timescale:n,version:t,referencesCount:d,references:e}}function WS(i){const e=[],t=st(i,["moov","trak"]);for(let n=0;n<t.length;n++){const r=t[n],l=st(r,["tkhd"])[0];if(l){let c=l[0];const d=Ye(l,c===0?12:20),u=st(r,["mdia","mdhd"])[0];if(u){c=u[0];const f=Ye(u,c===0?12:20),g=st(r,["mdia","hdlr"])[0];if(g){const y=ys(g.subarray(8,12)),x={soun:Pt.AUDIO,vide:Pt.VIDEO}[y],S=st(r,["mdia","minf","stbl","stsd"])[0],E=Q1(S);x?(e[d]={timescale:f,type:x,stsd:E},e[x]=Lt({timescale:f,id:d},E)):e[d]={timescale:f,type:y,stsd:E}}}}}return st(i,["moov","mvex","trex"]).forEach(n=>{const r=Ye(n,4),l=e[r];l&&(l.default={duration:Ye(n,12),flags:Ye(n,20)})}),e}function Q1(i){const e=i.subarray(8),t=e.subarray(86),s=ys(e.subarray(4,8));let n=s,r;const l=s==="enca"||s==="encv";if(l){const u=st(e,[s])[0].subarray(s==="enca"?28:78);st(u,["sinf"]).forEach(g=>{const y=st(g,["schm"])[0];if(y){const x=ys(y.subarray(4,8));if(x==="cbcs"||x==="cenc"){const S=st(g,["frma"])[0];S&&(n=ys(S))}}})}const c=n;switch(n){case"avc1":case"avc2":case"avc3":case"avc4":{const d=st(t,["avcC"])[0];d&&d.length>3&&(n+="."+Gc(d[1])+Gc(d[2])+Gc(d[3]),r=$c(c==="avc1"?"dva1":"dvav",t));break}case"mp4a":{const d=st(e,[s])[0],u=st(d.subarray(28),["esds"])[0];if(u&&u.length>7){let f=4;if(u[f++]!==3)break;f=Tf(u,f),f+=2;const g=u[f++];if(g&128&&(f+=2),g&64&&(f+=u[f++]),u[f++]!==4)break;f=Tf(u,f);const y=u[f++];if(y===64)n+="."+Gc(y);else break;if(f+=12,u[f++]!==5)break;f=Tf(u,f);const x=u[f++];let S=(x&248)>>3;S===31&&(S+=1+((x&7)<<3)+((u[f]&224)>>5)),n+="."+S}break}case"hvc1":case"hev1":{const d=st(t,["hvcC"])[0];if(d&&d.length>12){const u=d[1],f=["","A","B","C"][u>>6],g=u&31,y=Ye(d,2),x=(u&32)>>5?"H":"L",S=d[12],E=d.subarray(6,12);n+="."+f+g,n+="."+W1(y).toString(16).toUpperCase(),n+="."+x+S;let T="";for(let A=E.length;A--;){const I=E[A];(I||T)&&(T="."+I.toString(16).toUpperCase()+T)}n+=T}r=$c(c=="hev1"?"dvhe":"dvh1",t);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":{n=$c(n,t)||n;break}case"vp09":{const d=st(t,["vpcC"])[0];if(d&&d.length>6){const u=d[4],f=d[5],g=d[6]>>4&15;n+="."+hn(u)+"."+hn(f)+"."+hn(g)}break}case"av01":{const d=st(t,["av1C"])[0];if(d&&d.length>2){const u=d[1]>>>5,f=d[1]&31,g=d[2]>>>7?"H":"M",y=(d[2]&64)>>6,x=(d[2]&32)>>5,S=u===2&&y?x?12:10:y?10:8,E=(d[2]&16)>>4,T=(d[2]&8)>>3,A=(d[2]&4)>>2,I=d[2]&3;n+="."+u+"."+hn(f)+g+"."+hn(S)+"."+E+"."+T+A+I+"."+hn(1)+"."+hn(1)+"."+hn(1)+"."+0,r=$c("dav1",t)}break}}return{codec:n,encrypted:l,supplemental:r}}function $c(i,e){const t=st(e,["dvvC"]),s=t.length?t[0]:st(e,["dvcC"])[0];if(s){const n=s[2]>>1&127,r=s[2]<<5&32|s[3]>>3&31;return i+"."+hn(n)+"."+hn(r)}}function W1(i){let e=0;for(let t=0;t<32;t++)e|=(i>>t&1)<<31-t;return e>>>0}function Tf(i,e){const t=e+5;for(;i[e++]&128&&e<t;);return e}function Gc(i){return("0"+i.toString(16).toUpperCase()).slice(-2)}function hn(i){return(i<10?"0":"")+i}function X1(i,e){if(!i||!e)return;const t=e.keyId;t&&e.isCommonEncryption&&XS(i,(s,n)=>{const r=s.subarray(8,24);r.some(l=>l!==0)||(wt.log(`[eme] Patching keyId in 'enc${n?"a":"v"}>sinf>>tenc' box: ${Cs(r)} -> ${Cs(t)}`),s.set(t,8))})}function Z1(i){const e=[];return XS(i,t=>e.push(t.subarray(8,24))),e}function XS(i,e){st(i,["moov","trak"]).forEach(s=>{const n=st(s,["mdia","minf","stbl","stsd"])[0];if(!n)return;const r=n.subarray(8);let l=st(r,["enca"]);const c=l.length>0;c||(l=st(r,["encv"])),l.forEach(d=>{const u=c?d.subarray(28):d.subarray(78);st(u,["sinf"]).forEach(g=>{const y=ZS(g);y&&e(y,c)})})})}function ZS(i){const e=st(i,["schm"])[0];if(e){const t=ys(e.subarray(4,8));if(t==="cbcs"||t==="cenc"){const s=st(i,["schi","tenc"])[0];if(s)return s}}}function J1(i,e,t){const s={},n=st(i,["moof","traf"]);for(let r=0;r<n.length;r++){const l=n[r],c=st(l,["tfhd"])[0],d=Ye(c,4),u=e[d];if(!u)continue;s[d]||(s[d]={start:NaN,duration:0,sampleCount:0,timescale:u.timescale,type:u.type});const f=s[d],g=st(l,["tfdt"])[0];if(g){const _=g[0];let C=Ye(g,4);_===1&&(C===Nv?t.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"):(C*=Nv+1,C+=Ye(g,8))),ke(C)&&(!ke(f.start)||C<f.start)&&(f.start=C)}const y=u.default,x=Ye(c,0)|y?.flags;let S=y?.duration||0;x&8&&(x&2?S=Ye(c,12):S=Ye(c,8));const E=st(l,["trun"]);let T=f.start||0,A=0,I=S;for(let _=0;_<E.length;_++){const C=E[_],k=Ye(C,4),D=f.sampleCount;f.sampleCount+=k;const O=C[3]&1,F=C[3]&4,j=C[2]&1,U=C[2]&2,K=C[2]&4,H=C[2]&8;let ee=8,re=k;for(O&&(ee+=4),F&&k&&(!(C[ee+1]&1)&&f.keyFrameIndex===void 0&&(f.keyFrameIndex=D),ee+=4,j?(I=Ye(C,ee),ee+=4):I=S,U&&(ee+=4),H&&(ee+=4),T+=I,A+=I,re--);re--;)j?(I=Ye(C,ee),ee+=4):I=S,U&&(ee+=4),K&&(C[ee+1]&1||f.keyFrameIndex===void 0&&(f.keyFrameIndex=f.sampleCount-(re+1),f.keyFrameStart=T),ee+=4),H&&(ee+=4),T+=I,A+=I;!A&&S&&(A+=S*k)}f.duration+=A}if(!Object.keys(s).some(r=>s[r].duration)){let r=1/0,l=0;const c=st(i,["sidx"]);for(let d=0;d<c.length;d++){const u=q1(c[d]);if(u!=null&&u.references){r=Math.min(r,u.earliestPresentationTime/u.timescale);const f=u.references.reduce((g,y)=>g+y.info.duration||0,0);l=Math.max(l,f+u.earliestPresentationTime/u.timescale)}}l&&ke(l)&&Object.keys(s).forEach(d=>{s[d].duration||(s[d].duration=l*s[d].timescale-s[d].start)})}return s}function ew(i){const e={valid:null,remainder:null},t=st(i,["moof"]);if(t.length<2)return e.remainder=i,e;const s=t[t.length-1];return e.valid=i.slice(0,s.byteOffset-8),e.remainder=i.slice(s.byteOffset-8),e}function Fi(i,e){const t=new Uint8Array(i.length+e.length);return t.set(i),t.set(e,i.length),t}function Dv(i,e){const t=[],s=e.samples,n=e.timescale,r=e.id;let l=!1;return st(s,["moof"]).map(d=>{const u=d.byteOffset-8;st(d,["traf"]).map(g=>{const y=st(g,["tfdt"]).map(x=>{const S=x[0];let E=Ye(x,4);return S===1&&(E*=Math.pow(2,32),E+=Ye(x,8)),E/n})[0];return y!==void 0&&(i=y),st(g,["tfhd"]).map(x=>{const S=Ye(x,4),E=Ye(x,0)&16777215,T=(E&1)!==0,A=(E&2)!==0,I=(E&8)!==0;let _=0;const C=(E&16)!==0;let k=0;const D=(E&32)!==0;let O=8;S===r&&(T&&(O+=8),A&&(O+=4),I&&(_=Ye(x,O),O+=4),C&&(k=Ye(x,O),O+=4),D&&(O+=4),e.type==="video"&&(l=qu(e.codec)),st(g,["trun"]).map(F=>{const j=F[0],U=Ye(F,0)&16777215,K=(U&1)!==0;let H=0;const ee=(U&4)!==0,re=(U&256)!==0;let de=0;const M=(U&512)!==0;let V=0;const q=(U&1024)!==0,ae=(U&2048)!==0;let pe=0;const P=Ye(F,4);let $=8;K&&(H=Ye(F,$),$+=4),ee&&($+=4);let G=H+u;for(let fe=0;fe<P;fe++){if(re?(de=Ye(F,$),$+=4):de=_,M?(V=Ye(F,$),$+=4):V=k,q&&($+=4),ae&&(j===0?pe=Ye(F,$):pe=QS(F,$),$+=4),e.type===Pt.VIDEO){let ge=0;for(;ge<V;){const _e=Ye(s,G);if(G+=4,tw(l,s[G])){const Ne=s.subarray(G,G+_e);jm(Ne,l?2:1,i+pe/n,t)}G+=_e,ge+=_e+4}}i+=de/n}}))})})}),t}function qu(i){if(!i)return!1;const e=i.substring(0,4);return e==="hvc1"||e==="hev1"||e==="dvh1"||e==="dvhe"}function tw(i,e){if(i){const t=e>>1&63;return t===39||t===40}else return(e&31)===6}function jm(i,e,t,s){const n=JS(i);let r=0;r+=e;let l=0,c=0,d=0;for(;r<n.length;){l=0;do{if(r>=n.length)break;d=n[r++],l+=d}while(d===255);c=0;do{if(r>=n.length)break;d=n[r++],c+=d}while(d===255);const u=n.length-r;let f=r;if(c<u)r+=c;else if(c>u){wt.error(`Malformed SEI payload. ${c} is too small, only ${u} bytes left to parse.`);break}if(l===4){if(n[f++]===181){const y=qS(n,f);if(f+=2,y===49){const x=Ye(n,f);if(f+=4,x===1195456820){const S=n[f++];if(S===3){const E=n[f++],T=31&E,A=64&E,I=A?2+T*3:0,_=new Uint8Array(I);if(A){_[0]=E;for(let C=1;C<I;C++)_[C]=n[f++]}s.push({type:S,payloadType:l,pts:t,bytes:_})}}}}}else if(l===5&&c>16){const g=[];for(let S=0;S<16;S++){const E=n[f++].toString(16);g.push(E.length==1?"0"+E:E),(S===3||S===5||S===7||S===9)&&g.push("-")}const y=c-16,x=new Uint8Array(y);for(let S=0;S<y;S++)x[S]=n[f++];s.push({payloadType:l,pts:t,uuid:g.join(""),userData:Ti(x),userDataBytes:x})}}}function JS(i){const e=i.byteLength,t=[];let s=1;for(;s<e-2;)i[s]===0&&i[s+1]===0&&i[s+2]===3?(t.push(s+2),s+=2):s++;if(t.length===0)return i;const n=e-t.length,r=new Uint8Array(n);let l=0;for(s=0;s<n;l++,s++)l===t[0]&&(l++,t.shift()),r[s]=i[l];return r}function sw(i){const e=i[0];let t="",s="",n=0,r=0,l=0,c=0,d=0,u=0;if(e===0){for(;ys(i.subarray(u,u+1))!=="\0";)t+=ys(i.subarray(u,u+1)),u+=1;for(t+=ys(i.subarray(u,u+1)),u+=1;ys(i.subarray(u,u+1))!=="\0";)s+=ys(i.subarray(u,u+1)),u+=1;s+=ys(i.subarray(u,u+1)),u+=1,n=Ye(i,12),r=Ye(i,16),c=Ye(i,20),d=Ye(i,24),u=28}else if(e===1){u+=4,n=Ye(i,u),u+=4;const g=Ye(i,u);u+=4;const y=Ye(i,u);for(u+=4,l=2**32*g+y,N1(l)||(l=Number.MAX_SAFE_INTEGER,wt.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),c=Ye(i,u),u+=4,d=Ye(i,u),u+=4;ys(i.subarray(u,u+1))!=="\0";)t+=ys(i.subarray(u,u+1)),u+=1;for(t+=ys(i.subarray(u,u+1)),u+=1;ys(i.subarray(u,u+1))!=="\0";)s+=ys(i.subarray(u,u+1)),u+=1;s+=ys(i.subarray(u,u+1)),u+=1}const f=i.subarray(u,i.byteLength);return{schemeIdUri:t,value:s,timeScale:n,presentationTime:l,presentationTimeDelta:r,eventDuration:c,id:d,payload:f}}function iw(i,...e){const t=e.length;let s=8,n=t;for(;n--;)s+=e[n].byteLength;const r=new Uint8Array(s);for(r[0]=s>>24&255,r[1]=s>>16&255,r[2]=s>>8&255,r[3]=s&255,r.set(i,4),n=0,s=8;n<t;n++)r.set(e[n],s),s+=e[n].byteLength;return r}function nw(i,e,t){if(i.byteLength!==16)throw new RangeError("Invalid system id");let s,n;s=0,n=new Uint8Array;let r;s>0?(r=new Uint8Array(4),e.length>0&&new DataView(r.buffer).setUint32(0,e.length,!1)):r=new Uint8Array;const l=new Uint8Array(4);return t.byteLength>0&&new DataView(l.buffer).setUint32(0,t.byteLength,!1),iw([112,115,115,104],new Uint8Array([s,0,0,0]),i,r,n,l,t)}function aw(i){const e=[];if(i instanceof ArrayBuffer){const t=i.byteLength;let s=0;for(;s+32<t;){const n=new DataView(i,s),r=rw(n);e.push(r),s+=r.size}}return e}function rw(i){const e=i.getUint32(0),t=i.byteOffset,s=i.byteLength;if(s<e)return{offset:t,size:s};if(i.getUint32(4)!==1886614376)return{offset:t,size:e};const r=i.getUint32(8)>>>24;if(r!==0&&r!==1)return{offset:t,size:e};const l=i.buffer,c=Cs(new Uint8Array(l,t+12,16));let d=null,u=null,f=0;if(r===0)f=28;else{const y=i.getUint32(28);if(!y||s<32+y*16)return{offset:t,size:e};d=[];for(let x=0;x<y;x++)d.push(new Uint8Array(l,t+32+x*16,16));f=32+y*16}if(!f)return{offset:t,size:e};const g=i.getUint32(f);return e-32<g?{offset:t,size:e}:(u=new Uint8Array(l,t+f+4,g),{version:r,systemId:c,kids:d,data:u,offset:t,size:e})}const eb=()=>/\(Windows.+Firefox\//i.test(navigator.userAgent),Zr={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function Fm(i,e){const t=Zr[e];return!!t&&!!t[i.slice(0,4)]}function lo(i,e,t=!0){return!i.split(",").some(s=>!Bm(s,e,t))}function Bm(i,e,t=!0){var s;const n=Ia(t);return(s=n?.isTypeSupported(oo(i,e)))!=null?s:!1}function oo(i,e){return`${e}/mp4;codecs=${i}`}function Pv(i){if(i){const e=i.substring(0,4);return Zr.video[e]}return 2}function Au(i){const e=eb();return i.split(",").reduce((t,s)=>{const r=e&&qu(s)?9:Zr.video[s];return r?(r*2+t)/(t?3:2):(Zr.audio[s]+t)/(t?2:1)},0)}const Ef={};function lw(i,e=!0){if(Ef[i])return Ef[i];const t={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[i];for(let n=0;n<t.length;n++){var s;if(Bm(t[n],"audio",e))return Ef[i]=t[n],t[n];if(t[n]==="mp3"&&(s=Ia(e))!=null&&s.isTypeSupported("audio/mpeg"))return""}return i}const ow=/flac|opus|mp4a\.40\.34/i;function _u(i,e=!0){return i.replace(ow,t=>lw(t.toLowerCase(),e))}function cw(i,e){const t=[];if(i){const s=i.split(",");for(let n=0;n<s.length;n++)Fm(s[n],"video")||t.push(s[n])}return e&&t.push(e),t.join(",")}function cu(i,e){if(i&&(i.length>4||["ac-3","ec-3","alac","fLaC","Opus"].indexOf(i)!==-1)&&(Uv(i,"audio")||Uv(i,"video")))return i;if(e){const t=e.split(",");if(t.length>1){if(i){for(let s=t.length;s--;)if(t[s].substring(0,4)===i.substring(0,4))return t[s]}return t[0]}}return e||i}function Uv(i,e){return Fm(i,e)&&Bm(i,e)}function uw(i){const e=i.split(",");for(let t=0;t<e.length;t++){const s=e[t].split(".");s.length>2&&s[0]==="avc1"&&(e[t]=`avc1.${parseInt(s[1]).toString(16)}${("000"+parseInt(s[2]).toString(16)).slice(-4)}`)}return e.join(",")}function dw(i){if(i.startsWith("av01.")){const e=i.split("."),t=["0","111","01","01","01","0"];for(let s=e.length;s>4&&s<10;s++)e[s]=t[s-4];return e.join(".")}return i}function Mv(i){const e=Ia(i)||{isTypeSupported:()=>!1};return{mpeg:e.isTypeSupported("audio/mpeg"),mp3:e.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:e.isTypeSupported('audio/mp4; codecs="ac-3"')}}function tm(i){return i.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}const hw={supported:!0,powerEfficient:!0,smooth:!0},fw={supported:!1,smooth:!1,powerEfficient:!1},tb={supported:!0,configurations:[],decodingInfoResults:[hw]};function sb(i,e){return{supported:!1,configurations:e,decodingInfoResults:[fw],error:i}}function mw(i,e,t,s,n,r){const l=i.videoCodec,c=i.audioCodec?i.audioGroups:null,d=r?.audioCodec,u=r?.channels,f=u?parseInt(u):d?1/0:2;let g=null;if(c!=null&&c.length)try{c.length===1&&c[0]?g=e.groups[c[0]].channels:g=c.reduce((y,x)=>{if(x){const S=e.groups[x];if(!S)throw new Error(`Audio track group ${x} not found`);Object.keys(S.channels).forEach(E=>{y[E]=(y[E]||0)+S.channels[E]})}return y},{2:0})}catch{return!0}return l!==void 0&&(l.split(",").some(y=>qu(y))||i.width>1920&&i.height>1088||i.height>1920&&i.width>1088||i.frameRate>Math.max(s,30)||i.videoRange!=="SDR"&&i.videoRange!==t||i.bitrate>Math.max(n,8e6))||!!g&&ke(f)&&Object.keys(g).some(y=>parseInt(y)>f)}function ib(i,e,t,s={}){const n=i.videoCodec;if(!n&&!i.audioCodec||!t)return Promise.resolve(tb);const r=[],l=pw(i),c=l.length,d=gw(i,e,c>0),u=d.length;for(let f=c||1*u||1;f--;){const g={type:"media-source"};if(c&&(g.video=l[f%c]),u){g.audio=d[f%u];const y=g.audio.bitrate;g.video&&y&&(g.video.bitrate-=y)}r.push(g)}if(n){const f=navigator.userAgent;if(n.split(",").some(g=>qu(g))&&eb())return Promise.resolve(sb(new Error(`Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent string: (${f})`),r))}return Promise.all(r.map(f=>{const g=vw(f);return s[g]||(s[g]=t.decodingInfo(f))})).then(f=>({supported:!f.some(g=>!g.supported),configurations:r,decodingInfoResults:f})).catch(f=>({supported:!1,configurations:r,decodingInfoResults:[],error:f}))}function pw(i){var e;const t=(e=i.videoCodec)==null?void 0:e.split(","),s=nb(i),n=i.width||640,r=i.height||480,l=i.frameRate||30,c=i.videoRange.toLowerCase();return t?t.map(d=>{const u={contentType:oo(dw(d),"video"),width:n,height:r,bitrate:s,framerate:l};return c!=="sdr"&&(u.transferFunction=c),u}):[]}function gw(i,e,t){var s;const n=(s=i.audioCodec)==null?void 0:s.split(","),r=nb(i);return n&&i.audioGroups?i.audioGroups.reduce((l,c)=>{var d;const u=c?(d=e.groups[c])==null?void 0:d.tracks:null;return u?u.reduce((f,g)=>{if(g.groupId===c){const y=parseFloat(g.channels||"");n.forEach(x=>{const S={contentType:oo(x,"audio"),bitrate:t?yw(x,r):r};y&&(S.channels=""+y),f.push(S)})}return f},l):l},[]):[]}function yw(i,e){if(e<=1)return 1;let t=128e3;return i==="ec-3"?t=768e3:i==="ac-3"&&(t=64e4),Math.min(e/2,t)}function nb(i){return Math.ceil(Math.max(i.bitrate*.9,i.averageBitrate)/1e3)*1e3||1}function vw(i){let e="";const{audio:t,video:s}=i;if(s){const n=tm(s.contentType);e+=`${n}_r${s.height}x${s.width}f${Math.ceil(s.framerate)}${s.transferFunction||"sd"}_${Math.ceil(s.bitrate/1e5)}`}if(t){const n=tm(t.contentType);e+=`${s?"_":""}${n}_c${t.channels}`}return e}const sm=["NONE","TYPE-0","TYPE-1",null];function xw(i){return sm.indexOf(i)>-1}const Iu=["SDR","PQ","HLG"];function Sw(i){return!!i&&Iu.indexOf(i)>-1}var uu={No:"",Yes:"YES",v2:"v2"};function jv(i){const{canSkipUntil:e,canSkipDateRanges:t,age:s}=i,n=s<e/2;return e&&n?t?uu.v2:uu.Yes:uu.No}class Fv{constructor(e,t,s){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=s}addDirectives(e){const t=new self.URL(e);return this.msn!==void 0&&t.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class co{constructor(e){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter(s=>!!s).map(s=>s.substring(0,4)).join(","),"supplemental"in e){var t;this.supplemental=e.supplemental;const s=(t=e.supplemental)==null?void 0:t.videoCodec;s&&s!==e.videoCodec&&(this.codecSet+=`,${s.substring(0,4)}`)}this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return Bv(this._audioGroups,e)}hasSubtitleGroup(e){return Bv(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,t){if(t){if(e==="audio"){let s=this._audioGroups;s||(s=this._audioGroups=[]),s.indexOf(t)===-1&&s.push(t)}else if(e==="text"){let s=this._subtitleGroups;s||(s=this._subtitleGroups=[]),s.indexOf(t)===-1&&s.push(t)}}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return(e=this.audioGroups)==null?void 0:e[0]}get textGroupId(){var e;return(e=this.subtitleGroups)==null?void 0:e[0]}addFallback(){}}function Bv(i,e){return!e||!i?!1:i.indexOf(e)!==-1}function bw(){if(typeof matchMedia=="function"){const i=matchMedia("(dynamic-range: high)"),e=matchMedia("bad query");if(i.media!==e.media)return i.matches===!0}return!1}function Tw(i,e){let t=!1,s=[];if(i&&(t=i!=="SDR",s=[i]),e){s=e.allowedVideoRanges||Iu.slice(0);const n=s.join("")!=="SDR"&&!e.videoCodec;t=e.preferHDR!==void 0?e.preferHDR:n&&bw(),t||(s=["SDR"])}return{preferHDR:t,allowedVideoRanges:s}}const Ew=i=>{const e=new WeakSet;return(t,s)=>{if(i&&(s=i(t,s)),typeof s=="object"&&s!==null){if(e.has(s))return;e.add(s)}return s}},Ut=(i,e)=>JSON.stringify(i,Ew(e));function Aw(i,e,t,s,n){const r=Object.keys(i),l=s?.channels,c=s?.audioCodec,d=n?.videoCodec,u=l&&parseInt(l)===2;let f=!1,g=!1,y=1/0,x=1/0,S=1/0,E=1/0,T=0,A=[];const{preferHDR:I,allowedVideoRanges:_}=Tw(e,n);for(let F=r.length;F--;){const j=i[r[F]];f||(f=j.channels[2]>0),y=Math.min(y,j.minHeight),x=Math.min(x,j.minFramerate),S=Math.min(S,j.minBitrate),_.filter(K=>j.videoRanges[K]>0).length>0&&(g=!0)}y=ke(y)?y:0,x=ke(x)?x:0;const C=Math.max(1080,y),k=Math.max(30,x);S=ke(S)?S:t,t=Math.max(S,t),g||(e=void 0);const D=r.length>1;return{codecSet:r.reduce((F,j)=>{const U=i[j];if(j===F)return F;if(A=g?_.filter(K=>U.videoRanges[K]>0):[],D){if(U.minBitrate>t)return un(j,`min bitrate of ${U.minBitrate} > current estimate of ${t}`),F;if(!U.hasDefaultAudio)return un(j,"no renditions with default or auto-select sound found"),F;if(c&&j.indexOf(c.substring(0,4))%5!==0)return un(j,`audio codec preference "${c}" not found`),F;if(l&&!u){if(!U.channels[l])return un(j,`no renditions with ${l} channel sound found (channels options: ${Object.keys(U.channels)})`),F}else if((!c||u)&&f&&U.channels[2]===0)return un(j,"no renditions with stereo sound found"),F;if(U.minHeight>C)return un(j,`min resolution of ${U.minHeight} > maximum of ${C}`),F;if(U.minFramerate>k)return un(j,`min framerate of ${U.minFramerate} > maximum of ${k}`),F;if(!A.some(K=>U.videoRanges[K]>0))return un(j,`no variants with VIDEO-RANGE of ${Ut(A)} found`),F;if(d&&j.indexOf(d.substring(0,4))%5!==0)return un(j,`video codec preference "${d}" not found`),F;if(U.maxScore<T)return un(j,`max score of ${U.maxScore} < selected max of ${T}`),F}return F&&(Au(j)>=Au(F)||U.fragmentError>i[F].fragmentError)?F:(E=U.minIndex,T=U.maxScore,j)},void 0),videoRanges:A,preferHDR:I,minFramerate:x,minBitrate:S,minIndex:E}}function un(i,e){wt.log(`[abr] start candidates with "${i}" ignored because ${e}`)}function ab(i){return i.reduce((e,t)=>{let s=e.groups[t.groupId];s||(s=e.groups[t.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),s.tracks.push(t);const n=t.channels||"2";return s.channels[n]=(s.channels[n]||0)+1,s.hasDefault=s.hasDefault||t.default,s.hasAutoSelect=s.hasAutoSelect||t.autoselect,s.hasDefault&&(e.hasDefaultAudio=!0),s.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function _w(i,e,t,s){return i.slice(t,s+1).reduce((n,r,l)=>{if(!r.codecSet)return n;const c=r.audioGroups;let d=n[r.codecSet];d||(n[r.codecSet]=d={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:l,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!c,fragmentError:0}),d.minBitrate=Math.min(d.minBitrate,r.bitrate);const u=Math.min(r.height,r.width);return d.minHeight=Math.min(d.minHeight,u),d.minFramerate=Math.min(d.minFramerate,r.frameRate),d.minIndex=Math.min(d.minIndex,l),d.maxScore=Math.max(d.maxScore,r.score),d.fragmentError+=r.fragmentError,d.videoRanges[r.videoRange]=(d.videoRanges[r.videoRange]||0)+1,c&&c.forEach(f=>{if(!f)return;const g=e.groups[f];g&&(d.hasDefaultAudio=d.hasDefaultAudio||e.hasDefaultAudio?g.hasDefault:g.hasAutoSelect||!e.hasDefaultAudio&&!e.hasAutoSelectAudio,Object.keys(g.channels).forEach(y=>{d.channels[y]=(d.channels[y]||0)+g.channels[y]}))}),n},{})}function Vv(i){if(!i)return i;const{lang:e,assocLang:t,characteristics:s,channels:n,audioCodec:r}=i;return{lang:e,assocLang:t,characteristics:s,channels:n,audioCodec:r}}function mn(i,e,t){if("attrs"in i){const s=e.indexOf(i);if(s!==-1)return s}for(let s=0;s<e.length;s++){const n=e[s];if(Xa(i,n,t))return s}return-1}function Xa(i,e,t){const{groupId:s,name:n,lang:r,assocLang:l,default:c}=i,d=i.forced;return(s===void 0||e.groupId===s)&&(n===void 0||e.name===n)&&(r===void 0||Iw(r,e.lang))&&(r===void 0||e.assocLang===l)&&(c===void 0||e.default===c)&&(d===void 0||e.forced===d)&&(!("characteristics"in i)||Rw(i.characteristics||"",e.characteristics))&&(t===void 0||t(i,e))}function Iw(i,e="--"){return i.length===e.length?i===e:i.startsWith(e)||e.startsWith(i)}function Rw(i,e=""){const t=i.split(","),s=e.split(",");return t.length===s.length&&!t.some(n=>s.indexOf(n)===-1)}function Ya(i,e){const{audioCodec:t,channels:s}=i;return(t===void 0||(e.audioCodec||"").substring(0,4)===t.substring(0,4))&&(s===void 0||s===(e.channels||"2"))}function Lw(i,e,t,s,n){const r=e[s],c=e.reduce((y,x,S)=>{const E=x.uri;return(y[E]||(y[E]=[])).push(S),y},{})[r.uri];c.length>1&&(s=Math.max.apply(Math,c));const d=r.videoRange,u=r.frameRate,f=r.codecSet.substring(0,4),g=$v(e,s,y=>{if(y.videoRange!==d||y.frameRate!==u||y.codecSet.substring(0,4)!==f)return!1;const x=y.audioGroups,S=t.filter(E=>!x||x.indexOf(E.groupId)!==-1);return mn(i,S,n)>-1});return g>-1?g:$v(e,s,y=>{const x=y.audioGroups,S=t.filter(E=>!x||x.indexOf(E.groupId)!==-1);return mn(i,S,n)>-1})}function $v(i,e,t){for(let s=e;s>-1;s--)if(t(i[s]))return s;for(let s=e+1;s<i.length;s++)if(t(i[s]))return s;return-1}function Ru(i,e){var t;return!!i&&i!==((t=e.loadLevelObj)==null?void 0:t.uri)}class ww extends Vi{constructor(e){super("abr",e.logger),this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.rebufferNotice=-1,this.supportedCache={},this.bwEstimator=void 0,this._abandonRulesCheck=t=>{var s;const{fragCurrent:n,partCurrent:r,hls:l}=this,{autoLevelEnabled:c,media:d}=l;if(!n||!d)return;const u=performance.now(),f=r?r.stats:n.stats,g=r?r.duration:n.duration,y=u-f.loading.start,x=l.minAutoLevel,S=n.level,E=this._nextAutoLevel;if(f.aborted||f.loaded&&f.loaded===f.total||S<=x){this.clearTimer(),this._nextAutoLevel=-1;return}if(!c)return;const T=E>-1&&E!==S,A=!!t||T;if(!A&&(d.paused||!d.playbackRate||!d.readyState))return;const I=l.mainForwardBufferInfo;if(!A&&I===null)return;const _=this.bwEstimator.getEstimateTTFB(),C=Math.abs(d.playbackRate);if(y<=Math.max(_,1e3*(g/(C*2))))return;const k=I?I.len/C:0,D=f.loading.first?f.loading.first-f.loading.start:-1,O=f.loaded&&D>-1,F=this.getBwEstimate(),j=l.levels,U=j[S],K=Math.max(f.loaded,Math.round(g*(n.bitrate||U.averageBitrate)/8));let H=O?y-D:y;H<1&&O&&(H=Math.min(y,f.loaded*8/F));const ee=O?f.loaded*1e3/H:0,re=_/1e3,de=ee?(K-f.loaded)/ee:K*8/F+re;if(de<=k)return;const M=ee?ee*8:F,V=((s=t?.details||this.hls.latestLevelDetails)==null?void 0:s.live)===!0,q=this.hls.config.abrBandWidthUpFactor;let ae=Number.POSITIVE_INFINITY,pe;for(pe=S-1;pe>x;pe--){const fe=j[pe].maxBitrate,ge=!j[pe].details||V;if(ae=this.getTimeToLoadFrag(re,M,g*fe,ge),ae<Math.min(k,g+re))break}if(ae>=de||ae>g*10)return;O?this.bwEstimator.sample(y-Math.min(_,D),f.loaded):this.bwEstimator.sampleTTFB(y);const P=j[pe].maxBitrate;this.getBwEstimate()*q>P&&this.resetEstimator(P);const $=this.findBestLevel(P,x,pe,0,k,1,1);$>-1&&(pe=$),this.warn(`Fragment ${n.sn}${r?" part "+r.index:""} of level ${S} is loading too slowly;
      Fragment duration: ${n.duration.toFixed(3)}
      Time to underbuffer: ${k.toFixed(3)} s
      Estimated load time for current fragment: ${de.toFixed(3)} s
      Estimated load time for down switch fragment: ${ae.toFixed(3)} s
      TTFB estimate: ${D|0} ms
      Current BW estimate: ${ke(F)?F|0:"Unknown"} bps
      New BW estimate: ${this.getBwEstimate()|0} bps
      Switching to level ${pe} @ ${P|0} bps`),l.nextLoadLevel=l.nextAutoLevel=pe,this.clearTimer();const G=()=>{if(this.clearTimer(),this.fragCurrent===n&&this.hls.loadLevel===pe&&pe>0){const fe=this.getStarvationDelay();if(this.warn(`Aborting inflight request ${pe>0?"and switching down":""}
      Fragment duration: ${n.duration.toFixed(3)} s
      Time to underbuffer: ${fe.toFixed(3)} s`),n.abortRequests(),this.fragCurrent=this.partCurrent=null,pe>x){let ge=this.findBestLevel(this.hls.levels[x].bitrate,x,pe,0,fe,1,1);ge===-1&&(ge=x),this.hls.nextLoadLevel=this.hls.nextAutoLevel=ge,this.resetEstimator(this.hls.levels[ge].bitrate)}}};T||de>ae*2?G():this.timer=self.setInterval(G,ae*1e3),l.trigger(L.FRAG_LOAD_EMERGENCY_ABORTED,{frag:n,part:r,stats:f})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(this.log(`setting initial bwe to ${e}`),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const e=this.hls.config;return new D1(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){const{hls:e}=this;e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.FRAG_LOADING,this.onFragLoading,this),e.on(L.FRAG_LOADED,this.onFragLoaded,this),e.on(L.FRAG_BUFFERED,this.onFragBuffered,this),e.on(L.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(L.LEVEL_LOADED,this.onLevelLoaded,this),e.on(L.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(L.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(L.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e&&(e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.FRAG_LOADING,this.onFragLoading,this),e.off(L.FRAG_LOADED,this.onFragLoaded,this),e.off(L.FRAG_BUFFERED,this.onFragBuffered,this),e.off(L.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(L.LEVEL_LOADED,this.onLevelLoaded,this),e.off(L.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(L.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(L.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=this.supportedCache=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.supportedCache={},this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,t){const s=t.frag;if(!this.ignoreFragment(s)){if(!s.bitrateTest){var n;this.fragCurrent=s,this.partCurrent=(n=t.part)!=null?n:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,t){this.clearTimer()}onError(e,t){if(!t.fatal)switch(t.details){case W.BUFFER_ADD_CODEC_ERROR:case W.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case W.FRAG_LOAD_TIMEOUT:{const s=t.frag,{fragCurrent:n,partCurrent:r}=this;if(s&&n&&s.sn===n.sn&&s.level===n.level){const l=performance.now(),c=r?r.stats:s.stats,d=l-c.loading.start,u=c.loading.first?c.loading.first-c.loading.start:-1;if(c.loaded&&u>-1){const g=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(d-Math.min(g,u),c.loaded)}else this.bwEstimator.sampleTTFB(d)}break}}}getTimeToLoadFrag(e,t,s,n){const r=e+s/t,l=n?e+this.lastLevelLoadSec:0;return r+l}onLevelLoaded(e,t){const s=this.hls.config,{loading:n}=t.stats,r=n.end-n.first;ke(r)&&(this.lastLevelLoadSec=r/1e3),t.details.live?this.bwEstimator.update(s.abrEwmaSlowLive,s.abrEwmaFastLive):this.bwEstimator.update(s.abrEwmaSlowVoD,s.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(t.levelInfo)}onFragLoaded(e,{frag:t,part:s}){const n=s?s.stats:t.stats;if(t.type===De.MAIN&&this.bwEstimator.sampleTTFB(n.loading.first-n.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),t.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const r=s?s.duration:t.duration,l=this.hls.levels[t.level],c=(l.loaded?l.loaded.bytes:0)+n.loaded,d=(l.loaded?l.loaded.duration:0)+r;l.loaded={bytes:c,duration:d},l.realBitrate=Math.round(8*c/d)}if(t.bitrateTest){const r={stats:n,frag:t,part:s,id:t.type};this.onFragBuffered(L.FRAG_BUFFERED,r),t.bitrateTest=!1}else this.lastLoadedFragLevel=t.level}}onFragBuffered(e,t){const{frag:s,part:n}=t,r=n!=null&&n.stats.loaded?n.stats:s.stats;if(r.aborted||this.ignoreFragment(s))return;const l=r.parsing.end-r.loading.start-Math.min(r.loading.first-r.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(l,r.loaded),r.bwEstimate=this.getBwEstimate(),s.bitrateTest?this.bitrateTestDelay=l/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==De.MAIN||e.sn==="initSegment"}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:e,minAutoLevel:t}=this.hls,s=this.getBwEstimate(),n=this.hls.config.maxStarvationDelay,r=this.findBestLevel(s,t,e,0,n,1,1);if(r>-1)return r;const l=this.hls.firstLevel,c=Math.min(Math.max(l,t),e);return this.warn(`Could not find best starting auto level. Defaulting to first in playlist ${l} clamped to ${c}`),c}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const e=this.forcedAutoLevel,s=this.bwEstimator.canEstimate(),n=this.lastLoadedFragLevel>-1;if(e!==-1&&(!s||!n||this.nextAutoLevelKey===this.getAutoLevelKey()))return e;const r=s&&n?this.getNextABRAutoLevel():this.firstAutoLevel;if(e!==-1){const l=this.hls.levels;if(l.length>Math.max(e,r)&&l[e].loadError<=l[r].loadError)return e}return this._nextAutoLevel=r,this.nextAutoLevelKey=this.getAutoLevelKey(),r}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:t,hls:s}=this;if(s.levels.length<=1)return s.loadLevel;const{maxAutoLevel:n,config:r,minAutoLevel:l}=s,c=t?t.duration:e?e.duration:0,d=this.getBwEstimate(),u=this.getStarvationDelay();let f=r.abrBandWidthFactor,g=r.abrBandWidthUpFactor;if(u){const T=this.findBestLevel(d,l,n,u,0,f,g);if(T>=0)return this.rebufferNotice=-1,T}let y=c?Math.min(c,r.maxStarvationDelay):r.maxStarvationDelay;if(!u){const T=this.bitrateTestDelay;T&&(y=(c?Math.min(c,r.maxLoadingDelay):r.maxLoadingDelay)-T,this.info(`bitrate test took ${Math.round(1e3*T)}ms, set first fragment max fetchDuration to ${Math.round(1e3*y)} ms`),f=g=1)}const x=this.findBestLevel(d,l,n,u,y,f,g);if(this.rebufferNotice!==x&&(this.rebufferNotice=x,this.info(`${u?"rebuffering expected":"buffer is empty"}, optimal quality level ${x}`)),x>-1)return x;const S=s.levels[l],E=s.loadLevelObj;return E&&S?.bitrate<E.bitrate?l:s.loadLevel}getStarvationDelay(){const e=this.hls,t=e.media;if(!t)return 1/0;const s=t&&t.playbackRate!==0?Math.abs(t.playbackRate):1,n=e.mainForwardBufferInfo;return(n?n.len:0)/s}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,t,s,n,r,l,c){var d;const u=n+r,f=this.lastLoadedFragLevel,g=f===-1?this.hls.firstLevel:f,{fragCurrent:y,partCurrent:x}=this,{levels:S,allAudioTracks:E,loadLevel:T,config:A}=this.hls;if(S.length===1)return 0;const I=S[g],_=!!((d=this.hls.latestLevelDetails)!=null&&d.live),C=T===-1||f===-1;let k,D="SDR",O=I?.frameRate||0;const{audioPreference:F,videoPreference:j}=A,U=this.audioTracksByGroup||(this.audioTracksByGroup=ab(E));let K=-1;if(C){if(this.firstSelection!==-1)return this.firstSelection;const M=this.codecTiers||(this.codecTiers=_w(S,U,t,s)),V=Aw(M,D,e,F,j),{codecSet:q,videoRanges:ae,minFramerate:pe,minBitrate:P,minIndex:$,preferHDR:G}=V;K=$,k=q,D=G?ae[ae.length-1]:ae[0],O=pe,e=Math.max(e,P),this.log(`picked start tier ${Ut(V)}`)}else k=I?.codecSet,D=I?.videoRange;const H=x?x.duration:y?y.duration:0,ee=this.bwEstimator.getEstimateTTFB()/1e3,re=[];for(let M=s;M>=t;M--){var de;const V=S[M],q=M>g;if(!V)continue;if(A.useMediaCapabilities&&!V.supportedResult&&!V.supportedPromise){const ge=navigator.mediaCapabilities;typeof ge?.decodingInfo=="function"&&mw(V,U,D,O,e,F)?(V.supportedPromise=ib(V,U,ge,this.supportedCache),V.supportedPromise.then(_e=>{if(!this.hls)return;V.supportedResult=_e;const Ne=this.hls.levels,Ge=Ne.indexOf(V);_e.error?this.warn(`MediaCapabilities decodingInfo error: "${_e.error}" for level ${Ge} ${Ut(_e)}`):_e.supported?_e.decodingInfoResults.some(Be=>Be.smooth===!1||Be.powerEfficient===!1)&&this.log(`MediaCapabilities decodingInfo for level ${Ge} not smooth or powerEfficient: ${Ut(_e)}`):(this.warn(`Unsupported MediaCapabilities decodingInfo result for level ${Ge} ${Ut(_e)}`),Ge>-1&&Ne.length>1&&(this.log(`Removing unsupported level ${Ge}`),this.hls.removeLevel(Ge),this.hls.loadLevel===-1&&(this.hls.nextLoadLevel=0)))}).catch(_e=>{this.warn(`Error handling MediaCapabilities decodingInfo: ${_e}`)})):V.supportedResult=tb}if((k&&V.codecSet!==k||D&&V.videoRange!==D||q&&O>V.frameRate||!q&&O>0&&O<V.frameRate||(de=V.supportedResult)!=null&&(de=de.decodingInfoResults)!=null&&de.some(ge=>ge.smooth===!1))&&(!C||M!==K)){re.push(M);continue}const ae=V.details,pe=(x?ae?.partTarget:ae?.averagetargetduration)||H;let P;q?P=c*e:P=l*e;const $=H&&n>=H*2&&r===0?V.averageBitrate:V.maxBitrate,G=this.getTimeToLoadFrag(ee,P,$*pe,ae===void 0);if(P>=$&&(M===f||V.loadError===0&&V.fragmentError===0)&&(G<=ee||!ke(G)||_&&!this.bitrateTestDelay||G<u)){const ge=this.forcedAutoLevel;return M!==T&&(ge===-1||ge!==T)&&(re.length&&this.trace(`Skipped level(s) ${re.join(",")} of ${s} max with CODECS and VIDEO-RANGE:"${S[re[0]].codecs}" ${S[re[0]].videoRange}; not compatible with "${k}" ${D}`),this.info(`switch candidate:${g}->${M} adjustedbw(${Math.round(P)})-bitrate=${Math.round(P-$)} ttfb:${ee.toFixed(1)} avgDuration:${pe.toFixed(1)} maxFetchDuration:${u.toFixed(1)} fetchDuration:${G.toFixed(1)} firstSelection:${C} codecSet:${V.codecSet} videoRange:${V.videoRange} hls.loadLevel:${T}`)),C&&(this.firstSelection=M),M}}return-1}set nextAutoLevel(e){const t=this.deriveNextAutoLevel(e);this._nextAutoLevel!==t&&(this.nextAutoLevelKey="",this._nextAutoLevel=t)}deriveNextAutoLevel(e){const{maxAutoLevel:t,minAutoLevel:s}=this.hls;return Math.min(Math.max(e,s),t)}}const rb={search:function(i,e){let t=0,s=i.length-1,n=null,r=null;for(;t<=s;){n=(t+s)/2|0,r=i[n];const l=e(r);if(l>0)t=n+1;else if(l<0)s=n-1;else return r}return null}};function Cw(i,e,t){if(e===null||!Array.isArray(i)||!i.length||!ke(e))return null;const s=i[0].programDateTime;if(e<(s||0))return null;const n=i[i.length-1].endProgramDateTime;if(e>=(n||0))return null;for(let r=0;r<i.length;++r){const l=i[r];if(Nw(e,t,l))return l}return null}function Ja(i,e,t=0,s=0,n=.005){let r=null;if(i){r=e[1+i.sn-e[0].sn]||null;const c=i.endDTS-t;c>0&&c<15e-7&&(t+=15e-7),r&&i.level!==r.level&&r.end<=i.end&&(r=e[2+i.sn-e[0].sn]||null)}else t===0&&e[0].start===0&&(r=e[0]);if(r&&((!i||i.level===r.level)&&Gv(t,s,r)===0||kw(r,i,Math.min(n,s))))return r;const l=rb.search(e,Gv.bind(null,t,s));return l&&(l!==i||!r)?l:r}function kw(i,e,t){if(e&&e.start===0&&e.level<i.level&&(e.endPTS||0)>0){const s=e.tagList.reduce((n,r)=>(r[0]==="INF"&&(n+=parseFloat(r[1])),n),t);return i.start<=s}return!1}function Gv(i=0,e=0,t){if(t.start<=i&&t.start+t.duration>i)return 0;const s=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0));return t.start+t.duration-s<=i?1:t.start-s>i&&t.start?-1:0}function Nw(i,e,t){const s=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0))*1e3;return(t.endProgramDateTime||0)-s>i}function lb(i,e,t){if(i&&i.startCC<=e&&i.endCC>=e){let s=i.fragments;const{fragmentHint:n}=i;n&&(s=s.concat(n));let r;return rb.search(s,l=>l.cc<e?1:l.cc>e?-1:(r=l,l.end<=t?1:l.start>t?-1:0)),r||null}return null}function Lu(i){switch(i.details){case W.FRAG_LOAD_TIMEOUT:case W.KEY_LOAD_TIMEOUT:case W.LEVEL_LOAD_TIMEOUT:case W.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function ob(i){return i.details.startsWith("key")}function cb(i){return ob(i)&&!!i.frag&&!i.frag.decryptdata}function Hv(i,e){const t=Lu(e);return i.default[`${t?"timeout":"error"}Retry`]}function Vm(i,e){const t=i.backoff==="linear"?1:Math.pow(2,e);return Math.min(t*i.retryDelayMs,i.maxRetryDelayMs)}function zv(i){return Lt(Lt({},i),{errorRetry:null,timeoutRetry:null})}function wu(i,e,t,s){if(!i)return!1;const n=s?.code,r=e<i.maxNumRetry&&(Ow(n)||!!t);return i.shouldRetry?i.shouldRetry(i,e,t,s,r):r}function Ow(i){return im(i)||!!i&&(i<400||i>499)}function im(i){return i===0&&navigator.onLine===!1}var ws={DoNothing:0,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,RetryRequest:5},gi={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,MoveAllAlternatesMatchingKey:4};class Dw extends Vi{constructor(e){super("error-controller",e.logger),this.hls=void 0,this.playlistError=0,this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(L.ERROR,this.onError,this),e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off(L.ERROR,this.onError,this),e.off(L.ERROR,this.onErrorOut,this),e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return e?.type===De.MAIN?e.level:this.getVariantIndex()}getVariantIndex(){var e;const t=this.hls,s=t.currentLevel;return(e=t.loadLevelObj)!=null&&e.details||s===-1?t.loadLevel:s}variantHasKey(e,t){if(e){var s;if((s=e.details)!=null&&s.hasKey(t))return!0;const n=e.audioGroups;if(n)return this.hls.allAudioTracks.filter(l=>n.indexOf(l.groupId)>=0).some(l=>{var c;return(c=l.details)==null?void 0:c.hasKey(t)})}return!1}onManifestLoading(){this.playlistError=0}onLevelUpdated(){this.playlistError=0}onError(e,t){var s;if(t.fatal)return;const n=this.hls,r=t.context;switch(t.details){case W.FRAG_LOAD_ERROR:case W.FRAG_LOAD_TIMEOUT:case W.KEY_LOAD_ERROR:case W.KEY_LOAD_TIMEOUT:t.errorAction=this.getFragRetryOrSwitchAction(t);return;case W.FRAG_PARSING_ERROR:if((s=t.frag)!=null&&s.gap){t.errorAction=Kr();return}case W.FRAG_GAP:case W.FRAG_DECRYPT_ERROR:{t.errorAction=this.getFragRetryOrSwitchAction(t),t.errorAction.action=ws.SendAlternateToPenaltyBox;return}case W.LEVEL_EMPTY_ERROR:case W.LEVEL_PARSING_ERROR:{var l;const d=t.parent===De.MAIN?t.level:n.loadLevel;t.details===W.LEVEL_EMPTY_ERROR&&((l=t.context)!=null&&(l=l.levelDetails)!=null&&l.live)?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,d):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,d))}return;case W.LEVEL_LOAD_ERROR:case W.LEVEL_LOAD_TIMEOUT:typeof r?.level=="number"&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,r.level));return;case W.AUDIO_TRACK_LOAD_ERROR:case W.AUDIO_TRACK_LOAD_TIMEOUT:case W.SUBTITLE_LOAD_ERROR:case W.SUBTITLE_TRACK_LOAD_TIMEOUT:if(r){const d=n.loadLevelObj;if(d&&(r.type===at.AUDIO_TRACK&&d.hasAudioGroup(r.groupId)||r.type===at.SUBTITLE_TRACK&&d.hasSubtitleGroup(r.groupId))){t.errorAction=this.getPlaylistRetryOrSwitchAction(t,n.loadLevel),t.errorAction.action=ws.SendAlternateToPenaltyBox,t.errorAction.flags=gi.MoveAllAlternatesMatchingHost;return}}return;case W.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:t.errorAction={action:ws.SendAlternateToPenaltyBox,flags:gi.MoveAllAlternatesMatchingHDCP};return;case W.KEY_SYSTEM_SESSION_UPDATE_FAILED:case W.KEY_SYSTEM_STATUS_INTERNAL_ERROR:case W.KEY_SYSTEM_NO_SESSION:t.errorAction={action:ws.SendAlternateToPenaltyBox,flags:gi.MoveAllAlternatesMatchingKey};return;case W.BUFFER_ADD_CODEC_ERROR:case W.REMUX_ALLOC_ERROR:case W.BUFFER_APPEND_ERROR:if(!t.errorAction){var c;t.errorAction=this.getLevelSwitchAction(t,(c=t.level)!=null?c:n.loadLevel)}return;case W.INTERNAL_EXCEPTION:case W.BUFFER_APPENDING_ERROR:case W.BUFFER_FULL_ERROR:case W.LEVEL_SWITCH_ERROR:case W.BUFFER_STALLED_ERROR:case W.BUFFER_SEEK_OVER_HOLE:case W.BUFFER_NUDGE_ON_STALL:t.errorAction=Kr();return}t.type===je.KEY_SYSTEM_ERROR&&(t.levelRetry=!1,t.errorAction=Kr())}getPlaylistRetryOrSwitchAction(e,t){const s=this.hls,n=Hv(s.config.playlistLoadPolicy,e),r=this.playlistError++;if(wu(n,r,Lu(e),e.response))return{action:ws.RetryRequest,flags:gi.None,retryConfig:n,retryCount:r};const c=this.getLevelSwitchAction(e,t);return n&&(c.retryConfig=n,c.retryCount=r),c}getFragRetryOrSwitchAction(e){const t=this.hls,s=this.getVariantLevelIndex(e.frag),n=t.levels[s],{fragLoadPolicy:r,keyLoadPolicy:l}=t.config,c=Hv(ob(e)?l:r,e),d=t.levels.reduce((f,g)=>f+g.fragmentError,0);if(n&&(e.details!==W.FRAG_GAP&&n.fragmentError++,!cb(e)&&wu(c,d,Lu(e),e.response)))return{action:ws.RetryRequest,flags:gi.None,retryConfig:c,retryCount:d};const u=this.getLevelSwitchAction(e,s);return c&&(u.retryConfig=c,u.retryCount=d),u}getLevelSwitchAction(e,t){const s=this.hls;t==null&&(t=s.loadLevel);const n=this.hls.levels[t];if(n){var r,l;const u=e.details;n.loadError++,u===W.BUFFER_APPEND_ERROR&&n.fragmentError++;let f=-1;const{levels:g,loadLevel:y,minAutoLevel:x,maxAutoLevel:S}=s;!s.autoLevelEnabled&&!s.config.preserveManualLevelOnError&&(s.loadLevel=-1);const E=(r=e.frag)==null?void 0:r.type,A=(E===De.AUDIO&&u===W.FRAG_PARSING_ERROR||e.sourceBufferName==="audio"&&(u===W.BUFFER_ADD_CODEC_ERROR||u===W.BUFFER_APPEND_ERROR))&&g.some(({audioCodec:D})=>n.audioCodec!==D),_=e.sourceBufferName==="video"&&(u===W.BUFFER_ADD_CODEC_ERROR||u===W.BUFFER_APPEND_ERROR)&&g.some(({codecSet:D,audioCodec:O})=>n.codecSet!==D&&n.audioCodec===O),{type:C,groupId:k}=(l=e.context)!=null?l:{};for(let D=g.length;D--;){const O=(D+y)%g.length;if(O!==y&&O>=x&&O<=S&&g[O].loadError===0){var c,d;const F=g[O];if(u===W.FRAG_GAP&&E===De.MAIN&&e.frag){const j=g[O].details;if(j){const U=Ja(e.frag,j.fragments,e.frag.start);if(U!=null&&U.gap)continue}}else{if(C===at.AUDIO_TRACK&&F.hasAudioGroup(k)||C===at.SUBTITLE_TRACK&&F.hasSubtitleGroup(k))continue;if(E===De.AUDIO&&(c=n.audioGroups)!=null&&c.some(j=>F.hasAudioGroup(j))||E===De.SUBTITLE&&(d=n.subtitleGroups)!=null&&d.some(j=>F.hasSubtitleGroup(j))||A&&n.audioCodec===F.audioCodec||_&&n.codecSet===F.codecSet||!A&&n.codecSet!==F.codecSet)continue}f=O;break}}if(f>-1&&s.loadLevel!==f)return e.levelRetry=!0,this.playlistError=0,{action:ws.SendAlternateToPenaltyBox,flags:gi.None,nextAutoLevel:f}}return{action:ws.SendAlternateToPenaltyBox,flags:gi.MoveAllAlternatesMatchingHost}}onErrorOut(e,t){var s;switch((s=t.errorAction)==null?void 0:s.action){case ws.DoNothing:break;case ws.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(t),!t.errorAction.resolved&&t.details!==W.FRAG_GAP?t.fatal=!0:/MediaSource readyState: ended/.test(t.error.message)&&(this.warn(`MediaSource ended after "${t.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError());break}if(t.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(e){const t=this.hls,s=e.errorAction;if(!s)return;const{flags:n}=s,r=s.nextAutoLevel;switch(n){case gi.None:this.switchLevel(e,r);break;case gi.MoveAllAlternatesMatchingHDCP:{const d=this.getVariantLevelIndex(e.frag),u=t.levels[d],f=u?.attrs["HDCP-LEVEL"];if(s.hdcpLevel=f,f==="NONE")this.warn("HDCP policy resticted output with HDCP-LEVEL=NONE");else if(f){t.maxHdcpLevel=sm[sm.indexOf(f)-1],s.resolved=!0,this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`);break}}case gi.MoveAllAlternatesMatchingKey:{const d=e.decryptdata;if(d){const u=this.hls.levels,f=u.length;for(let y=f;y--;)if(this.variantHasKey(u[y],d)){var l,c;this.log(`Banned key found in level ${y} (${u[y].bitrate}bps) or audio group "${(l=u[y].audioGroups)==null?void 0:l.join(",")}" (${(c=e.frag)==null?void 0:c.type} fragment) ${Cs(d.keyId||[])}`),u[y].fragmentError++,u[y].loadError++,this.log(`Removing level ${y} with key error (${e.error})`),this.hls.removeLevel(y)}const g=e.frag;if(this.hls.levels.length<f)s.resolved=!0;else if(g&&g.type!==De.MAIN){const y=g.decryptdata;y&&!d.matches(y)&&(s.resolved=!0)}}break}}s.resolved||this.switchLevel(e,r)}switchLevel(e,t){if(t!==void 0&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,e.details===W.BUFFER_ADD_CODEC_ERROR&&e.mimeType&&e.sourceBufferName!=="audiovideo")){const s=tm(e.mimeType),n=this.hls.levels;for(let r=n.length;r--;)n[r][`${e.sourceBufferName}Codec`]===s&&(this.log(`Removing level ${r} for ${e.details} ("${s}" not supported)`),this.hls.removeLevel(r))}}}function Kr(i){const e={action:ws.DoNothing,flags:gi.None};return i&&(e.resolved=!0),e}var vs={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class Pw{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e&&(e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.BUFFER_APPENDED,this.onBufferAppended,this),e.on(L.FRAG_BUFFERED,this.onFragBuffered,this),e.on(L.FRAG_LOADED,this.onFragLoaded,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.BUFFER_APPENDED,this.onBufferAppended,this),e.off(L.FRAG_BUFFERED,this.onFragBuffered,this),e.off(L.FRAG_LOADED,this.onFragLoaded,this))}destroy(){this._unregisterListeners(),this.hls=this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){const s=this.activePartLists[t];if(s)for(let n=s.length;n--;){const r=s[n];if(!r)break;if(r.start<=e&&e<=r.end&&r.loaded)return r}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){return this.getFragAtPos(e,t,!0)}getFragAtPos(e,t,s){const{fragments:n}=this,r=Object.keys(n);for(let l=r.length;l--;){const c=n[r[l]];if(c?.body.type===t&&(!s||c.buffered)){const d=c.body;if(d.start<=e&&e<=d.end)return d}}return null}detectEvictedFragments(e,t,s,n,r){this.timeRanges&&(this.timeRanges[e]=t);const l=n?.fragment.sn||-1;Object.keys(this.fragments).forEach(c=>{const d=this.fragments[c];if(!d||l>=d.body.sn)return;if(!d.buffered&&(!d.loaded||r)){d.body.type===s&&this.removeFragment(d.body);return}const u=d.range[e];if(u){if(u.time.length===0){this.removeFragment(d.body);return}u.time.some(f=>{const g=!this.isTimeBuffered(f.startPTS,f.endPTS,t);return g&&this.removeFragment(d.body),g})}})}detectPartialFragments(e){const t=this.timeRanges;if(!t||e.frag.sn==="initSegment")return;const s=e.frag,n=Fr(s),r=this.fragments[n];if(!r||r.buffered&&s.gap)return;const l=!s.relurl;Object.keys(t).forEach(c=>{const d=s.elementaryStreams[c];if(!d)return;const u=t[c],f=l||d.partial===!0;r.range[c]=this.getBufferedTimes(s,e.part,f,u)}),r.loaded=null,Object.keys(r.range).length?(this.bufferedEnd(r,s),Hc(r)||this.removeParts(s.sn-1,s.type)):this.removeFragment(r.body)}bufferedEnd(e,t){e.buffered=!0,(e.body.endList=t.endList||e.body.endList)&&(this.endListFragments[e.body.type]=e)}removeParts(e,t){const s=this.activePartLists[t];s&&(this.activePartLists[t]=Kv(s,n=>n.fragment.sn>=e))}fragBuffered(e,t){const s=Fr(e);let n=this.fragments[s];!n&&t&&(n=this.fragments[s]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),n&&(n.loaded=null,this.bufferedEnd(n,e))}getBufferedTimes(e,t,s,n){const r={time:[],partial:s},l=e.start,c=e.end,d=e.minEndPTS||c,u=e.maxStartPTS||l;for(let f=0;f<n.length;f++){const g=n.start(f)-this.bufferPadding,y=n.end(f)+this.bufferPadding;if(u>=g&&d<=y){r.time.push({startPTS:Math.max(l,n.start(f)),endPTS:Math.min(c,n.end(f))});break}else if(l<y&&c>g){const x=Math.max(l,n.start(f)),S=Math.min(c,n.end(f));S>x&&(r.partial=!0,r.time.push({startPTS:x,endPTS:S}))}else if(c<=g)break}return r}getPartialFragment(e){let t=null,s,n,r,l=0;const{bufferPadding:c,fragments:d}=this;return Object.keys(d).forEach(u=>{const f=d[u];f&&Hc(f)&&(n=f.body.start-c,r=f.body.end+c,e>=n&&e<=r&&(s=Math.min(e-n,r-e),l<=s&&(t=f.body,l=s)))}),t}isEndListAppended(e){const t=this.endListFragments[e];return t!==void 0&&(t.buffered||Hc(t))}getState(e){const t=Fr(e),s=this.fragments[t];return s?s.buffered?Hc(s)?vs.PARTIAL:vs.OK:vs.APPENDING:vs.NOT_LOADED}isTimeBuffered(e,t,s){let n,r;for(let l=0;l<s.length;l++){if(n=s.start(l)-this.bufferPadding,r=s.end(l)+this.bufferPadding,e>=n&&t<=r)return!0;if(t<=n)return!1}return!1}onManifestLoading(){this.removeAllFragments()}onFragLoaded(e,t){if(t.frag.sn==="initSegment"||t.frag.bitrateTest)return;const s=t.frag,n=t.part?null:t,r=Fr(s);this.fragments[r]={body:s,appendedPTS:null,loaded:n,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){const{frag:s,part:n,timeRanges:r,type:l}=t;if(s.sn==="initSegment")return;const c=s.type;if(n){let u=this.activePartLists[c];u||(this.activePartLists[c]=u=[]),u.push(n)}this.timeRanges=r;const d=r[l];this.detectEvictedFragments(l,d,c,n)}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){const t=Fr(e);return!!this.fragments[t]}hasFragments(e){const{fragments:t}=this,s=Object.keys(t);if(!e)return s.length>0;for(let n=s.length;n--;){const r=t[s[n]];if(r?.body.type===e)return!0}return!1}hasParts(e){var t;return!!((t=this.activePartLists[e])!=null&&t.length)}removeFragmentsInRange(e,t,s,n,r){n&&!this.hasGaps||Object.keys(this.fragments).forEach(l=>{const c=this.fragments[l];if(!c)return;const d=c.body;d.type!==s||n&&!d.gap||d.start<t&&d.end>e&&(c.buffered||r)&&this.removeFragment(d)})}removeFragment(e){const t=Fr(e);e.clearElementaryStreamInfo();const s=this.activePartLists[e.type];if(s){const n=e.sn;this.activePartLists[e.type]=Kv(s,r=>r.fragment.sn!==n)}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){var e;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;const t=(e=this.hls)==null||(e=e.latestLevelDetails)==null?void 0:e.partList;t&&t.forEach(s=>s.clearElementaryStreamInfo())}}function Hc(i){var e,t,s;return i.buffered&&!!(i.body.gap||(e=i.range.video)!=null&&e.partial||(t=i.range.audio)!=null&&t.partial||(s=i.range.audiovideo)!=null&&s.partial)}function Fr(i){return`${i.type}_${i.level}_${i.sn}`}function Kv(i,e){return i.filter(t=>{const s=e(t);return s||t.clearElementaryStreamInfo(),s})}var Ra={cbc:0,ctr:1};class Uw{constructor(e,t,s){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=e,this.aesIV=t,this.aesMode=s}decrypt(e,t){switch(this.aesMode){case Ra.cbc:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e);case Ra.ctr:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},t,e);default:throw new Error(`[AESCrypto] invalid aes mode ${this.aesMode}`)}}}function Mw(i){const e=i.byteLength,t=e&&new DataView(i.buffer).getUint8(e-1);return t?i.slice(0,e-t):i}class jw{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),s=new Uint32Array(4);for(let n=0;n<4;n++)s[n]=t.getUint32(n*4);return s}initTable(){const e=this.sBox,t=this.invSBox,s=this.subMix,n=s[0],r=s[1],l=s[2],c=s[3],d=this.invSubMix,u=d[0],f=d[1],g=d[2],y=d[3],x=new Uint32Array(256);let S=0,E=0,T=0;for(T=0;T<256;T++)T<128?x[T]=T<<1:x[T]=T<<1^283;for(T=0;T<256;T++){let A=E^E<<1^E<<2^E<<3^E<<4;A=A>>>8^A&255^99,e[S]=A,t[A]=S;const I=x[S],_=x[I],C=x[_];let k=x[A]*257^A*16843008;n[S]=k<<24|k>>>8,r[S]=k<<16|k>>>16,l[S]=k<<8|k>>>24,c[S]=k,k=C*16843009^_*65537^I*257^S*16843008,u[A]=k<<24|k>>>8,f[A]=k<<16|k>>>16,g[A]=k<<8|k>>>24,y[A]=k,S?(S=I^x[x[x[C^I]]],E^=x[x[E]]):S=E=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let s=!0,n=0;for(;n<t.length&&s;)s=t[n]===this.key[n],n++;if(s)return;this.key=t;const r=this.keySize=t.length;if(r!==4&&r!==6&&r!==8)throw new Error("Invalid aes key size="+r);const l=this.ksRows=(r+6+1)*4;let c,d;const u=this.keySchedule=new Uint32Array(l),f=this.invKeySchedule=new Uint32Array(l),g=this.sBox,y=this.rcon,x=this.invSubMix,S=x[0],E=x[1],T=x[2],A=x[3];let I,_;for(c=0;c<l;c++){if(c<r){I=u[c]=t[c];continue}_=I,c%r===0?(_=_<<8|_>>>24,_=g[_>>>24]<<24|g[_>>>16&255]<<16|g[_>>>8&255]<<8|g[_&255],_^=y[c/r|0]<<24):r>6&&c%r===4&&(_=g[_>>>24]<<24|g[_>>>16&255]<<16|g[_>>>8&255]<<8|g[_&255]),u[c]=I=(u[c-r]^_)>>>0}for(d=0;d<l;d++)c=l-d,d&3?_=u[c]:_=u[c-4],d<4||c<=4?f[d]=_:f[d]=S[g[_>>>24]]^E[g[_>>>16&255]]^T[g[_>>>8&255]]^A[g[_&255]],f[d]=f[d]>>>0}networkToHostOrderSwap(e){return e<<24|(e&65280)<<8|(e&16711680)>>8|e>>>24}decrypt(e,t,s){const n=this.keySize+6,r=this.invKeySchedule,l=this.invSBox,c=this.invSubMix,d=c[0],u=c[1],f=c[2],g=c[3],y=this.uint8ArrayToUint32Array_(s);let x=y[0],S=y[1],E=y[2],T=y[3];const A=new Int32Array(e),I=new Int32Array(A.length);let _,C,k,D,O,F,j,U,K,H,ee,re,de,M;const V=this.networkToHostOrderSwap;for(;t<A.length;){for(K=V(A[t]),H=V(A[t+1]),ee=V(A[t+2]),re=V(A[t+3]),O=K^r[0],F=re^r[1],j=ee^r[2],U=H^r[3],de=4,M=1;M<n;M++)_=d[O>>>24]^u[F>>16&255]^f[j>>8&255]^g[U&255]^r[de],C=d[F>>>24]^u[j>>16&255]^f[U>>8&255]^g[O&255]^r[de+1],k=d[j>>>24]^u[U>>16&255]^f[O>>8&255]^g[F&255]^r[de+2],D=d[U>>>24]^u[O>>16&255]^f[F>>8&255]^g[j&255]^r[de+3],O=_,F=C,j=k,U=D,de=de+4;_=l[O>>>24]<<24^l[F>>16&255]<<16^l[j>>8&255]<<8^l[U&255]^r[de],C=l[F>>>24]<<24^l[j>>16&255]<<16^l[U>>8&255]<<8^l[O&255]^r[de+1],k=l[j>>>24]<<24^l[U>>16&255]<<16^l[O>>8&255]<<8^l[F&255]^r[de+2],D=l[U>>>24]<<24^l[O>>16&255]<<16^l[F>>8&255]<<8^l[j&255]^r[de+3],I[t]=V(_^x),I[t+1]=V(D^S),I[t+2]=V(k^E),I[t+3]=V(C^T),x=K,S=H,E=ee,T=re,t=t+4}return I.buffer}}class Fw{constructor(e,t,s){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=e,this.key=t,this.aesMode=s}expandKey(){const e=Bw(this.aesMode);return this.subtle.importKey("raw",this.key,{name:e},!1,["encrypt","decrypt"])}}function Bw(i){switch(i){case Ra.cbc:return"AES-CBC";case Ra.ctr:return"AES-CTR";default:throw new Error(`[FastAESKey] invalid aes mode ${i}`)}}const Vw=16;class $m{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const s=self.crypto;s&&(this.subtle=s.subtle||s.webkitSubtle)}catch{}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;const s=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?Mw(s):s}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,s,n){return this.useSoftware?new Promise((r,l)=>{const c=ArrayBuffer.isView(e)?e:new Uint8Array(e);this.softwareDecrypt(c,t,s,n);const d=this.flush();d?r(d.buffer):l(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,s,n)}softwareDecrypt(e,t,s,n){const{currentIV:r,currentResult:l,remainderData:c}=this;if(n!==Ra.cbc||t.byteLength!==16)return wt.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),c&&(e=Fi(c,e),this.remainderData=null);const d=this.getValidChunk(e);if(!d.length)return null;r&&(s=r);let u=this.softwareDecrypter;u||(u=this.softwareDecrypter=new jw),u.expandKey(t);const f=l;return this.currentResult=u.decrypt(d.buffer,0,s),this.currentIV=d.slice(-16).buffer,f||null}webCryptoDecrypt(e,t,s,n){if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,t,s,n));this.key=t,this.fastAesKey=new Fw(this.subtle,t,n)}return this.fastAesKey.expandKey().then(r=>this.subtle?(this.logOnce("WebCrypto AES decrypt"),new Uw(this.subtle,new Uint8Array(s),n).decrypt(e.buffer,r)):Promise.reject(new Error("web crypto not initialized"))).catch(r=>(wt.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${r.name}: ${r.message}`),this.onWebCryptoError(e,t,s,n)))}onWebCryptoError(e,t,s,n){const r=this.enableSoftwareAES;if(r){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,s,n);const l=this.flush();if(l)return l.buffer}throw new Error("WebCrypto"+(r?" and softwareDecrypt":"")+": failed to decrypt data")}getValidChunk(e){let t=e;const s=e.length-e.length%Vw;return s!==e.length&&(t=e.slice(0,s),this.remainderData=e.slice(s)),t}logOnce(e){this.logEnabled&&(wt.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}const Yv=Math.pow(2,17);class $w{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){const s=e.url;if(!s)return Promise.reject(new Vn({type:je.NETWORK_ERROR,details:W.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error(`Fragment does not have a ${s?"part list":"url"}`),networkDetails:null}));this.abort();const n=this.config,r=n.fLoader,l=n.loader;return new Promise((c,d)=>{if(this.loader&&this.loader.destroy(),e.gap)if(e.tagList.some(S=>S[0]==="GAP")){d(Qv(e));return}else e.gap=!1;const u=this.loader=r?new r(n):new l(n),f=qv(e);e.loader=u;const g=zv(n.fragLoadPolicy.default),y={loadPolicy:g,timeout:g.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:e.sn==="initSegment"?1/0:Yv};e.stats=u.stats;const x={onSuccess:(S,E,T,A)=>{this.resetLoader(e,u);let I=S.data;T.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(I.slice(0,16)),I=I.slice(16)),c({frag:e,part:null,payload:I,networkDetails:A})},onError:(S,E,T,A)=>{this.resetLoader(e,u),d(new Vn({type:je.NETWORK_ERROR,details:W.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:Lt({url:s,data:void 0},S),error:new Error(`HTTP Error ${S.code} ${S.text}`),networkDetails:T,stats:A}))},onAbort:(S,E,T)=>{this.resetLoader(e,u),d(new Vn({type:je.NETWORK_ERROR,details:W.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:T,stats:S}))},onTimeout:(S,E,T)=>{this.resetLoader(e,u),d(new Vn({type:je.NETWORK_ERROR,details:W.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${y.timeout}ms`),networkDetails:T,stats:S}))}};t&&(x.onProgress=(S,E,T,A)=>t({frag:e,part:null,payload:T,networkDetails:A})),u.load(f,y,x)})}loadPart(e,t,s){this.abort();const n=this.config,r=n.fLoader,l=n.loader;return new Promise((c,d)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap){d(Qv(e,t));return}const u=this.loader=r?new r(n):new l(n),f=qv(e,t);e.loader=u;const g=zv(n.fragLoadPolicy.default),y={loadPolicy:g,timeout:g.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:Yv};t.stats=u.stats,u.load(f,y,{onSuccess:(x,S,E,T)=>{this.resetLoader(e,u),this.updateStatsFromPart(e,t);const A={frag:e,part:t,payload:x.data,networkDetails:T};s(A),c(A)},onError:(x,S,E,T)=>{this.resetLoader(e,u),d(new Vn({type:je.NETWORK_ERROR,details:W.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:Lt({url:f.url,data:void 0},x),error:new Error(`HTTP Error ${x.code} ${x.text}`),networkDetails:E,stats:T}))},onAbort:(x,S,E)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,u),d(new Vn({type:je.NETWORK_ERROR,details:W.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:E,stats:x}))},onTimeout:(x,S,E)=>{this.resetLoader(e,u),d(new Vn({type:je.NETWORK_ERROR,details:W.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error(`Timeout after ${y.timeout}ms`),networkDetails:E,stats:x}))}})})}updateStatsFromPart(e,t){const s=e.stats,n=t.stats,r=n.total;if(s.loaded+=n.loaded,r){const d=Math.round(e.duration/t.duration),u=Math.min(Math.round(s.loaded/r),d),g=(d-u)*Math.round(s.loaded/u);s.total=s.loaded+g}else s.total=Math.max(s.loaded,s.total);const l=s.loading,c=n.loading;l.start?l.first+=c.first-c.start:(l.start=c.start,l.first=c.first),l.end=c.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function qv(i,e=null){const t=e||i,s={frag:i,part:e,responseType:"arraybuffer",url:t.url,headers:{},rangeStart:0,rangeEnd:0},n=t.byteRangeStartOffset,r=t.byteRangeEndOffset;if(ke(n)&&ke(r)){var l;let c=n,d=r;if(i.sn==="initSegment"&&Gw((l=i.decryptdata)==null?void 0:l.method)){const u=r-n;u%16&&(d=r+(16-u%16)),n!==0&&(s.resetIV=!0,c=n-16)}s.rangeStart=c,s.rangeEnd=d}return s}function Qv(i,e){const t=new Error(`GAP ${i.gap?"tag":"attribute"} found`),s={type:je.MEDIA_ERROR,details:W.FRAG_GAP,fatal:!1,frag:i,error:t,networkDetails:null};return e&&(s.part=e),(e||i).stats.aborted=!0,new Vn(s)}function Gw(i){return i==="AES-128"||i==="AES-256"}class Vn extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class ub extends Vi{constructor(e,t){super(e,t),this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}class Gm{constructor(e,t,s,n=0,r=-1,l=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=zc(),this.buffering={audio:zc(),video:zc(),audiovideo:zc()},this.level=e,this.sn=t,this.id=s,this.size=n,this.part=r,this.partial=l}}function zc(){return{start:0,executeStart:0,executeEnd:0,end:0}}const Wv={length:0,start:()=>0,end:()=>0};class Xe{static isBuffered(e,t){if(e){const s=Xe.getBuffered(e);for(let n=s.length;n--;)if(t>=s.start(n)&&t<=s.end(n))return!0}return!1}static bufferedRanges(e){if(e){const t=Xe.getBuffered(e);return Xe.timeRangesToArray(t)}return[]}static timeRangesToArray(e){const t=[];for(let s=0;s<e.length;s++)t.push({start:e.start(s),end:e.end(s)});return t}static bufferInfo(e,t,s){if(e){const n=Xe.bufferedRanges(e);if(n.length)return Xe.bufferedInfo(n,t,s)}return{len:0,start:t,end:t,bufferedIndex:-1}}static bufferedInfo(e,t,s){t=Math.max(0,t),e.length>1&&e.sort((f,g)=>f.start-g.start||g.end-f.end);let n=-1,r=[];if(s)for(let f=0;f<e.length;f++){t>=e[f].start&&t<=e[f].end&&(n=f);const g=r.length;if(g){const y=r[g-1].end;e[f].start-y<s?e[f].end>y&&(r[g-1].end=e[f].end):r.push(e[f])}else r.push(e[f])}else r=e;let l=0,c,d=t,u=t;for(let f=0;f<r.length;f++){const g=r[f].start,y=r[f].end;if(n===-1&&t>=g&&t<=y&&(n=f),t+s>=g&&t<y)d=g,u=y,l=u-t;else if(t+s<g){c=g;break}}return{len:l,start:d||0,end:u||0,nextStart:c,buffered:e,bufferedIndex:n}}static getBuffered(e){try{return e.buffered||Wv}catch(t){return wt.log("failed to get media.buffered",t),Wv}}}const db=/\{\$([a-zA-Z0-9-_]+)\}/g;function Xv(i){return db.test(i)}function nm(i,e){if(i.variableList!==null||i.hasVariableRefs){const t=i.variableList;return e.replace(db,s=>{const n=s.substring(2,s.length-1),r=t?.[n];return r===void 0?(i.playlistParsingError||(i.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${n}"`)),s):r})}return e}function Zv(i,e,t){let s=i.variableList;s||(i.variableList=s={});let n,r;if("QUERYPARAM"in e){n=e.QUERYPARAM;try{const l=new self.URL(t).searchParams;if(l.has(n))r=l.get(n);else throw new Error(`"${n}" does not match any query parameter in URI: "${t}"`)}catch(l){i.playlistParsingError||(i.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${l.message}`))}}else n=e.NAME,r=e.VALUE;n in s?i.playlistParsingError||(i.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${n}"`)):s[n]=r||""}function Hw(i,e,t){const s=e.IMPORT;if(t&&s in t){let n=i.variableList;n||(i.variableList=n={}),n[s]=t[s]}else i.playlistParsingError||(i.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${s}"`))}const zw=/^(\d+)x(\d+)$/,Jv=/(.+?)=(".*?"|.*?)(?:,|$)/g;class qt{constructor(e,t){typeof e=="string"&&(e=qt.parseAttrList(e,t)),Ot(this,e)}get clientAttrs(){return Object.keys(this).filter(e=>e.substring(0,2)==="X-")}decimalInteger(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(t.length&1?"0":"")+t;const s=new Uint8Array(t.length/2);for(let n=0;n<t.length/2;n++)s[n]=parseInt(t.slice(n*2,n*2+2),16);return s}return null}hexadecimalIntegerAsNumber(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){const s=this[e];return s?parseFloat(s):t}enumeratedString(e){return this[e]}enumeratedStringList(e,t){const s=this[e];return(s?s.split(/[ ,]+/):[]).reduce((n,r)=>(n[r.toLowerCase()]=!0,n),t)}bool(e){return this[e]==="YES"}decimalResolution(e){const t=zw.exec(this[e]);if(t!==null)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e,t){let s;const n={};for(Jv.lastIndex=0;(s=Jv.exec(e))!==null;){const l=s[1].trim();let c=s[2];const d=c.indexOf('"')===0&&c.lastIndexOf('"')===c.length-1;let u=!1;if(d)c=c.slice(1,-1);else switch(l){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":u=!0}if(t&&(d||u))c=nm(t,c);else if(!u&&!d)switch(l){case"CLOSED-CAPTIONS":if(c==="NONE")break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":wt.warn(`${e}: attribute ${l} is missing quotes`)}n[l]=c}return n}}const Kw="com.apple.hls.interstitial";function Yw(i){return i!=="ID"&&i!=="CLASS"&&i!=="CUE"&&i!=="START-DATE"&&i!=="DURATION"&&i!=="END-DATE"&&i!=="END-ON-NEXT"}function qw(i){return i==="SCTE35-OUT"||i==="SCTE35-IN"||i==="SCTE35-CMD"}class hb{constructor(e,t,s=0){var n;if(this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=t?.tagAnchor||null,this.tagOrder=(n=t?.tagOrder)!=null?n:s,t){const r=t.attr;for(const l in r)if(Object.prototype.hasOwnProperty.call(e,l)&&e[l]!==r[l]){wt.warn(`DATERANGE tag attribute: "${l}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=l;break}e=Ot(new qt({}),r,e)}if(this.attr=e,t?(this._startDate=t._startDate,this._cue=t._cue,this._endDate=t._endDate,this._dateAtEnd=t._dateAtEnd):this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const r=t?.endDate||new Date(this.attr["END-DATE"]);ke(r.getTime())&&(this._endDate=r)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get cue(){const e=this._cue;return e===void 0?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):e}get startTime(){const{tagAnchor:e}=this;return e===null||e.programDateTime===null?(wt.warn(`Expected tagAnchor Fragment with PDT set for DateRange "${this.id}": ${e}`),NaN):e.start+(this.startDate.getTime()-e.programDateTime)/1e3}get startDate(){return this._startDate}get endDate(){const e=this._endDate||this._dateAtEnd;if(e)return e;const t=this.duration;return t!==null?this._dateAtEnd=new Date(this._startDate.getTime()+t*1e3):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(ke(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isInterstitial(){return this.class===Kw}get isValid(){return!!this.id&&!this._badValueForSameId&&ke(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}const Qw=10;class Ww{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e){this.advanced=!0,this.updated=!0;return}const t=this.lastPartSn-e.lastPartSn,s=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!s||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||t===0&&s>0,this.updated||this.advanced?this.misses=Math.floor(e.misses*.6):this.misses=e.misses+1}hasKey(e){return this.encryptedFragments.some(t=>{let s=t.decryptdata;return s||(t.setKeyFormat(e.keyFormat),s=t.decryptdata),!!s&&e.matches(s)})}get hasProgramDateTime(){return this.fragments.length?ke(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||Qw}get drift(){const e=this.driftEndTime-this.driftStartTime;return e>0?(this.driftEnd-this.driftStart)*1e3/e:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){return this.fragments.length?this.fragments[this.fragments.length-1].end:0}get fragmentStart(){return this.fragments.length?this.fragments[0].start:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].index:-1}get maxPartIndex(){const e=this.partList;if(e){const t=this.lastPartIndex;if(t!==-1){for(let s=e.length;s--;)if(e[s].index>t)return e[s].index;return t}}return 0}get lastPartSn(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}get expired(){if(this.live&&this.age&&this.misses<3){const e=this.partEnd-this.fragmentStart;return this.age>Math.max(e,this.totalduration)+this.levelTargetDuration}return!1}}function Cu(i,e){return i.length===e.length?!i.some((t,s)=>t!==e[s]):!1}function ex(i,e){return!i&&!e?!0:!i||!e?!1:Cu(i,e)}function Yr(i){return i==="AES-128"||i==="AES-256"||i==="AES-256-CTR"}function Hm(i){switch(i){case"AES-128":case"AES-256":return Ra.cbc;case"AES-256-CTR":return Ra.ctr;default:throw new Error(`invalid full segment method ${i}`)}}function zm(i){return Uint8Array.from(atob(i),e=>e.charCodeAt(0))}function am(i){return Uint8Array.from(unescape(encodeURIComponent(i)),e=>e.charCodeAt(0))}function Xw(i){const e=am(i).subarray(0,16),t=new Uint8Array(16);return t.set(e,16-e.length),t}function fb(i){const e=function(s,n,r){const l=s[n];s[n]=s[r],s[r]=l};e(i,0,3),e(i,1,2),e(i,4,5),e(i,6,7)}function mb(i){const e=i.split(":");let t=null;if(e[0]==="data"&&e.length===2){const s=e[1].split(";"),n=s[s.length-1].split(",");if(n.length===2){const r=n[0]==="base64",l=n[1];r?(s.splice(-1,1),t=zm(l)):t=Xw(l)}}return t}const ku=typeof self<"u"?self:void 0;var Qt={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},ks={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function du(i){switch(i){case ks.FAIRPLAY:return Qt.FAIRPLAY;case ks.PLAYREADY:return Qt.PLAYREADY;case ks.WIDEVINE:return Qt.WIDEVINE;case ks.CLEARKEY:return Qt.CLEARKEY}}function Af(i){switch(i){case Qt.FAIRPLAY:return ks.FAIRPLAY;case Qt.PLAYREADY:return ks.PLAYREADY;case Qt.WIDEVINE:return ks.WIDEVINE;case Qt.CLEARKEY:return ks.CLEARKEY}}function to(i){const{drmSystems:e,widevineLicenseUrl:t}=i,s=e?[Qt.FAIRPLAY,Qt.WIDEVINE,Qt.PLAYREADY,Qt.CLEARKEY].filter(n=>!!e[n]):[];return!s[Qt.WIDEVINE]&&t&&s.push(Qt.WIDEVINE),s}const pb=(function(i){return ku!=null&&(i=ku.navigator)!=null&&i.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null})();function Zw(i,e,t,s){let n;switch(i){case Qt.FAIRPLAY:n=["cenc","sinf"];break;case Qt.WIDEVINE:case Qt.PLAYREADY:n=["cenc"];break;case Qt.CLEARKEY:n=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${i}`)}return Jw(n,e,t,s)}function Jw(i,e,t,s){return[{initDataTypes:i,persistentState:s.persistentState||"optional",distinctiveIdentifier:s.distinctiveIdentifier||"optional",sessionTypes:s.sessionTypes||[s.sessionType||"temporary"],audioCapabilities:e.map(r=>({contentType:`audio/mp4; codecs=${r}`,robustness:s.audioRobustness||"",encryptionScheme:s.audioEncryptionScheme||null})),videoCapabilities:t.map(r=>({contentType:`video/mp4; codecs=${r}`,robustness:s.videoRobustness||"",encryptionScheme:s.videoEncryptionScheme||null}))}]}function eC(i){var e;return!!i&&(i.sessionType==="persistent-license"||!!((e=i.sessionTypes)!=null&&e.some(t=>t==="persistent-license")))}function gb(i){const e=new Uint16Array(i.buffer,i.byteOffset,i.byteLength/2),t=String.fromCharCode.apply(null,Array.from(e)),s=t.substring(t.indexOf("<"),t.length),l=new DOMParser().parseFromString(s,"text/xml").getElementsByTagName("KID")[0];if(l){const c=l.childNodes[0]?l.childNodes[0].nodeValue:l.getAttribute("VALUE");if(c){const d=zm(c).subarray(0,16);return fb(d),d}}return null}let Br={};class Aa{static clearKeyUriToKeyIdMap(){Br={}}static setKeyIdForUri(e,t){Br[e]=t}static addKeyIdForUri(e){const t=Object.keys(Br).length%Number.MAX_SAFE_INTEGER,s=new Uint8Array(16);return new DataView(s.buffer,12,4).setUint32(0,t),Br[e]=s,s}constructor(e,t,s,n=[1],r=null,l){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=s,this.keyFormatVersions=n,this.iv=r,this.encrypted=e?e!=="NONE":!1,this.isCommonEncryption=this.encrypted&&!Yr(e),l!=null&&l.startsWith("0x")&&(this.keyId=new Uint8Array(HS(l)))}matches(e){return e.uri===this.uri&&e.method===this.method&&e.encrypted===this.encrypted&&e.keyFormat===this.keyFormat&&Cu(e.keyFormatVersions,this.keyFormatVersions)&&ex(e.iv,this.iv)&&ex(e.keyId,this.keyId)}isSupported(){if(this.method){if(Yr(this.method)||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case ks.FAIRPLAY:case ks.WIDEVINE:case ks.PLAYREADY:case ks.CLEARKEY:return["SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(e,t){if(!this.encrypted||!this.uri)return null;if(Yr(this.method)){let r=this.iv;return r||(typeof e!="number"&&(wt.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0),r=sC(e)),new Aa(this.method,this.uri,"identity",this.keyFormatVersions,r)}if(this.keyId){const r=Br[this.uri];if(r&&!Cu(this.keyId,r)&&Aa.setKeyIdForUri(this.uri,this.keyId),this.pssh)return this}const s=mb(this.uri);if(s)switch(this.keyFormat){case ks.WIDEVINE:if(this.pssh=s,!this.keyId){const r=aw(s.buffer);if(r.length){var n;const l=r[0];this.keyId=(n=l.kids)!=null&&n.length?l.kids[0]:null}}this.keyId||(this.keyId=tx(t));break;case ks.PLAYREADY:{const r=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=nw(r,null,s),this.keyId=gb(s);break}default:{let r=s.subarray(0,16);if(r.length!==16){const l=new Uint8Array(16);l.set(r,16-r.length),r=l}this.keyId=r;break}}if(!this.keyId||this.keyId.byteLength!==16){let r;r=tC(t),r||(r=tx(t),r||(r=Br[this.uri])),r&&(this.keyId=r,Aa.setKeyIdForUri(this.uri,r))}return this}}function tC(i){const e=i?.[ks.WIDEVINE];return e?e.keyId:null}function tx(i){const e=i?.[ks.PLAYREADY];if(e){const t=mb(e.uri);if(t)return gb(t)}return null}function sC(i){const e=new Uint8Array(16);for(let t=12;t<16;t++)e[t]=i>>8*(15-t)&255;return e}const sx=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,ix=/#EXT-X-MEDIA:(.*)/g,iC=/^#EXT(?:INF|-X-TARGETDURATION):/m,_f=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),nC=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class pn{static findGroup(e,t){for(let s=0;s<e.length;s++){const n=e[s];if(n.id===t)return n}}static resolve(e,t){return Um.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return iC.test(e)}static parseMasterPlaylist(e,t){const s=Xv(e),n={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:s},r=[];if(sx.lastIndex=0,!e.startsWith("#EXTM3U"))return n.playlistParsingError=new Error("no EXTM3U delimiter"),n;let l;for(;(l=sx.exec(e))!=null;)if(l[1]){var c;const u=new qt(l[1],n),f=nm(n,l[2]),g={attrs:u,bitrate:u.decimalInteger("BANDWIDTH")||u.decimalInteger("AVERAGE-BANDWIDTH"),name:u.NAME,url:pn.resolve(f,t)},y=u.decimalResolution("RESOLUTION");y&&(g.width=y.width,g.height=y.height),rx(u.CODECS,g);const x=u["SUPPLEMENTAL-CODECS"];x&&(g.supplemental={},rx(x,g.supplemental)),(c=g.unknownCodecs)!=null&&c.length||r.push(g),n.levels.push(g)}else if(l[3]){const u=l[3],f=l[4];switch(u){case"SESSION-DATA":{const g=new qt(f,n),y=g["DATA-ID"];y&&(n.sessionData===null&&(n.sessionData={}),n.sessionData[y]=g);break}case"SESSION-KEY":{const g=nx(f,t,n);g.encrypted&&g.isSupported()?(n.sessionKeys===null&&(n.sessionKeys=[]),n.sessionKeys.push(g)):wt.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${f}"`);break}case"DEFINE":{{const g=new qt(f,n);Zv(n,g,t)}break}case"CONTENT-STEERING":{const g=new qt(f,n);n.contentSteering={uri:pn.resolve(g["SERVER-URI"],t),pathwayId:g["PATHWAY-ID"]||"."};break}case"START":{n.startTimeOffset=ax(f);break}}}const d=r.length>0&&r.length<n.levels.length;return n.levels=d?r:n.levels,n.levels.length===0&&(n.playlistParsingError=new Error("no levels found in manifest")),n}static parseMasterPlaylistMedia(e,t,s){let n;const r={},l=s.levels,c={AUDIO:l.map(u=>({id:u.attrs.AUDIO,audioCodec:u.audioCodec})),SUBTITLES:l.map(u=>({id:u.attrs.SUBTITLES,textCodec:u.textCodec})),"CLOSED-CAPTIONS":[]};let d=0;for(ix.lastIndex=0;(n=ix.exec(e))!==null;){const u=new qt(n[1],s),f=u.TYPE;if(f){const g=c[f],y=r[f]||[];r[f]=y;const x=u.LANGUAGE,S=u["ASSOC-LANGUAGE"],E=u.CHANNELS,T=u.CHARACTERISTICS,A=u["INSTREAM-ID"],I={attrs:u,bitrate:0,id:d++,groupId:u["GROUP-ID"]||"",name:u.NAME||x||"",type:f,default:u.bool("DEFAULT"),autoselect:u.bool("AUTOSELECT"),forced:u.bool("FORCED"),lang:x,url:u.URI?pn.resolve(u.URI,t):""};if(S&&(I.assocLang=S),E&&(I.channels=E),T&&(I.characteristics=T),A&&(I.instreamId=A),g!=null&&g.length){const _=pn.findGroup(g,I.groupId)||g[0];lx(I,_,"audioCodec"),lx(I,_,"textCodec")}y.push(I)}}return r}static parseLevelPlaylist(e,t,s,n,r,l){var c;const d={url:t},u=new Ww(t),f=u.fragments,g=[];let y=null,x=0,S=0,E=0,T=0,A=0,I=null,_=new bf(n,d),C,k,D,O=-1,F=!1,j=null,U;if(_f.lastIndex=0,u.m3u8=e,u.hasVariableRefs=Xv(e),((c=_f.exec(e))==null?void 0:c[0])!=="#EXTM3U")return u.playlistParsingError=new Error("Missing format identifier #EXTM3U"),u;for(;(C=_f.exec(e))!==null;){F&&(F=!1,_=new bf(n,d),_.playlistOffset=E,_.setStart(E),_.sn=x,_.cc=T,A&&(_.bitrate=A),_.level=s,y&&(_.initSegment=y,y.rawProgramDateTime&&(_.rawProgramDateTime=y.rawProgramDateTime,y.rawProgramDateTime=null),j&&(_.setByteRange(j),j=null)));const re=C[1];if(re){_.duration=parseFloat(re);const de=(" "+C[2]).slice(1);_.title=de||null,_.tagList.push(de?["INF",re,de]:["INF",re])}else if(C[3]){if(ke(_.duration)){_.playlistOffset=E,_.setStart(E),D&&cx(_,D,u),_.sn=x,_.level=s,_.cc=T,f.push(_);const de=(" "+C[3]).slice(1);_.relurl=nm(u,de),rm(_,I,g),I=_,E+=_.duration,x++,S=0,F=!0}}else{if(C=C[0].match(nC),!C){wt.warn("No matches on slow regex match for level playlist!");continue}for(k=1;k<C.length&&C[k]===void 0;k++);const de=(" "+C[k]).slice(1),M=(" "+C[k+1]).slice(1),V=C[k+2]?(" "+C[k+2]).slice(1):null;switch(de){case"BYTERANGE":I?_.setByteRange(M,I):_.setByteRange(M);break;case"PROGRAM-DATE-TIME":_.rawProgramDateTime=M,_.tagList.push(["PROGRAM-DATE-TIME",M]),O===-1&&(O=f.length);break;case"PLAYLIST-TYPE":u.type&&Fn(u,de,C),u.type=M.toUpperCase();break;case"MEDIA-SEQUENCE":u.startSN!==0?Fn(u,de,C):f.length>0&&ux(u,de,C),x=u.startSN=parseInt(M);break;case"SKIP":{u.skippedSegments&&Fn(u,de,C);const q=new qt(M,u),ae=q.decimalInteger("SKIPPED-SEGMENTS");if(ke(ae)){u.skippedSegments+=ae;for(let P=ae;P--;)f.push(null);x+=ae}const pe=q.enumeratedString("RECENTLY-REMOVED-DATERANGES");pe&&(u.recentlyRemovedDateranges=(u.recentlyRemovedDateranges||[]).concat(pe.split("	")));break}case"TARGETDURATION":u.targetduration!==0&&Fn(u,de,C),u.targetduration=Math.max(parseInt(M),1);break;case"VERSION":u.version!==null&&Fn(u,de,C),u.version=parseInt(M);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":u.live||Fn(u,de,C),u.live=!1;break;case"#":(M||V)&&_.tagList.push(V?[M,V]:[M]);break;case"DISCONTINUITY":T++,_.tagList.push(["DIS"]);break;case"GAP":_.gap=!0,_.tagList.push([de]);break;case"BITRATE":_.tagList.push([de,M]),A=parseInt(M)*1e3,ke(A)?_.bitrate=A:A=0;break;case"DATERANGE":{const q=new qt(M,u),ae=new hb(q,u.dateRanges[q.ID],u.dateRangeTagCount);u.dateRangeTagCount++,ae.isValid||u.skippedSegments?u.dateRanges[ae.id]=ae:wt.warn(`Ignoring invalid DATERANGE tag: "${M}"`),_.tagList.push(["EXT-X-DATERANGE",M]);break}case"DEFINE":{{const q=new qt(M,u);"IMPORT"in q?Hw(u,q,l):Zv(u,q,t)}break}case"DISCONTINUITY-SEQUENCE":u.startCC!==0?Fn(u,de,C):f.length>0&&ux(u,de,C),u.startCC=T=parseInt(M);break;case"KEY":{const q=nx(M,t,u);if(q.isSupported()){if(q.method==="NONE"){D=void 0;break}D||(D={});const ae=D[q.keyFormat];ae!=null&&ae.matches(q)||(ae&&(D=Ot({},D)),D[q.keyFormat]=q)}else wt.warn(`[Keys] Ignoring unsupported EXT-X-KEY tag: "${M}"`);break}case"START":u.startTimeOffset=ax(M);break;case"MAP":{const q=new qt(M,u);if(_.duration){const ae=new bf(n,d);ox(ae,q,s,D),y=ae,_.initSegment=y,y.rawProgramDateTime&&!_.rawProgramDateTime&&(_.rawProgramDateTime=y.rawProgramDateTime)}else{const ae=_.byteRangeEndOffset;if(ae){const pe=_.byteRangeStartOffset;j=`${ae-pe}@${pe}`}else j=null;ox(_,q,s,D),y=_,F=!0}y.cc=T;break}case"SERVER-CONTROL":{U&&Fn(u,de,C),U=new qt(M),u.canBlockReload=U.bool("CAN-BLOCK-RELOAD"),u.canSkipUntil=U.optionalFloat("CAN-SKIP-UNTIL",0),u.canSkipDateRanges=u.canSkipUntil>0&&U.bool("CAN-SKIP-DATERANGES"),u.partHoldBack=U.optionalFloat("PART-HOLD-BACK",0),u.holdBack=U.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{u.partTarget&&Fn(u,de,C);const q=new qt(M);u.partTarget=q.decimalFloatingPoint("PART-TARGET");break}case"PART":{let q=u.partList;q||(q=u.partList=[]);const ae=S>0?q[q.length-1]:void 0,pe=S++,P=new qt(M,u),$=new H1(P,_,d,pe,ae);q.push($),_.duration+=$.duration;break}case"PRELOAD-HINT":{const q=new qt(M,u);u.preloadHint=q;break}case"RENDITION-REPORT":{const q=new qt(M,u);u.renditionReports=u.renditionReports||[],u.renditionReports.push(q);break}default:wt.warn(`line parsed but not handled: ${C}`);break}}}I&&!I.relurl?(f.pop(),E-=I.duration,u.partList&&(u.fragmentHint=I)):u.partList&&(rm(_,I,g),_.cc=T,u.fragmentHint=_,D&&cx(_,D,u)),u.targetduration||(u.playlistParsingError=new Error("Missing Target Duration"));const K=f.length,H=f[0],ee=f[K-1];if(E+=u.skippedSegments*u.targetduration,E>0&&K&&ee){u.averagetargetduration=E/K;const re=ee.sn;u.endSN=re!=="initSegment"?re:0,u.live||(ee.endList=!0),O>0&&(rC(f,O),H&&g.unshift(H))}return u.fragmentHint&&(E+=u.fragmentHint.duration),u.totalduration=E,g.length&&u.dateRangeTagCount&&H&&yb(g,u),u.endCC=T,u}}function yb(i,e){let t=i.length;if(!t)if(e.hasProgramDateTime){const c=e.fragments[e.fragments.length-1];i.push(c),t++}else return;const s=i[t-1],n=e.live?1/0:e.totalduration,r=Object.keys(e.dateRanges);for(let c=r.length;c--;){const d=e.dateRanges[r[c]],u=d.startDate.getTime();d.tagAnchor=s.ref;for(let f=t;f--;){var l;if(((l=i[f])==null?void 0:l.sn)<e.startSN)break;const g=aC(e,u,i,f,n);if(g!==-1){d.tagAnchor=e.fragments[g].ref;break}}}}function aC(i,e,t,s,n){const r=t[s];if(r){const c=r.programDateTime;if(e>=c||s===0){var l;const d=(((l=t[s+1])==null?void 0:l.start)||n)-r.start;if(e<=c+d*1e3){const u=t[s].sn-i.startSN;if(u<0)return-1;const f=i.fragments;if(f.length>t.length){const y=(t[s+1]||f[f.length-1]).sn-i.startSN;for(let x=y;x>u;x--){const S=f[x].programDateTime;if(e>=S&&e<S+f[x].duration*1e3)return x}}return u}}}return-1}function nx(i,e,t){var s,n;const r=new qt(i,t),l=(s=r.METHOD)!=null?s:"",c=r.URI,d=r.hexadecimalInteger("IV"),u=r.KEYFORMATVERSIONS,f=(n=r.KEYFORMAT)!=null?n:"identity";c&&r.IV&&!d&&wt.error(`Invalid IV: ${r.IV}`);const g=c?pn.resolve(c,e):"",y=(u||"1").split("/").map(Number).filter(Number.isFinite);return new Aa(l,g,f,y,d,r.KEYID)}function ax(i){const t=new qt(i).decimalFloatingPoint("TIME-OFFSET");return ke(t)?t:null}function rx(i,e){let t=(i||"").split(/[ ,]+/).filter(s=>s);["video","audio","text"].forEach(s=>{const n=t.filter(r=>Fm(r,s));n.length&&(e[`${s}Codec`]=n.map(r=>r.split("/")[0]).join(","),t=t.filter(r=>n.indexOf(r)===-1))}),e.unknownCodecs=t}function lx(i,e,t){const s=e[t];s&&(i[t]=s)}function rC(i,e){let t=i[e];for(let s=e;s--;){const n=i[s];if(!n)return;n.programDateTime=t.programDateTime-n.duration*1e3,t=n}}function rm(i,e,t){i.rawProgramDateTime?t.push(i):e!=null&&e.programDateTime&&(i.programDateTime=e.endProgramDateTime)}function ox(i,e,t,s){i.relurl=e.URI,e.BYTERANGE&&i.setByteRange(e.BYTERANGE),i.level=t,i.sn="initSegment",s&&(i.levelkeys=s),i.initSegment=null}function cx(i,e,t){i.levelkeys=e;const{encryptedFragments:s}=t;(!s.length||s[s.length-1].levelkeys!==e)&&Object.keys(e).some(n=>e[n].isCommonEncryption)&&s.push(i)}function Fn(i,e,t){i.playlistParsingError=new Error(`#EXT-X-${e} must not appear more than once (${t[0]})`)}function ux(i,e,t){i.playlistParsingError=new Error(`#EXT-X-${e} must appear before the first Media Segment (${t[0]})`)}function If(i,e){const t=e.startPTS;if(ke(t)){let s=0,n;e.sn>i.sn?(s=t-i.start,n=i):(s=i.start-t,n=e),n.duration!==s&&n.setDuration(s)}else e.sn>i.sn?i.cc===e.cc&&i.minEndPTS?e.setStart(i.start+(i.minEndPTS-i.start)):e.setStart(i.start+i.duration):e.setStart(Math.max(i.start-e.duration,0))}function vb(i,e,t,s,n,r,l){s-t<=0&&(l.warn("Fragment should have a positive duration",e),s=t+e.duration,r=n+e.duration);let d=t,u=s;const f=e.startPTS,g=e.endPTS;if(ke(f)){const A=Math.abs(f-t);i&&A>i.totalduration?l.warn(`media timestamps and playlist times differ by ${A}s for level ${e.level} ${i.url}`):ke(e.deltaPTS)?e.deltaPTS=Math.max(A,e.deltaPTS):e.deltaPTS=A,d=Math.max(t,f),t=Math.min(t,f),n=e.startDTS!==void 0?Math.min(n,e.startDTS):n,u=Math.min(s,g),s=Math.max(s,g),r=e.endDTS!==void 0?Math.max(r,e.endDTS):r}const y=t-e.start;e.start!==0&&e.setStart(t),e.setDuration(s-e.start),e.startPTS=t,e.maxStartPTS=d,e.startDTS=n,e.endPTS=s,e.minEndPTS=u,e.endDTS=r;const x=e.sn;if(!i||x<i.startSN||x>i.endSN)return 0;let S;const E=x-i.startSN,T=i.fragments;for(T[E]=e,S=E;S>0;S--)If(T[S],T[S-1]);for(S=E;S<T.length-1;S++)If(T[S],T[S+1]);return i.fragmentHint&&If(T[T.length-1],i.fragmentHint),i.PTSKnown=i.alignedSliding=!0,y}function lC(i,e,t){if(i===e)return;let s=null;const n=i.fragments;for(let f=n.length-1;f>=0;f--){const g=n[f].initSegment;if(g){s=g;break}}i.fragmentHint&&delete i.fragmentHint.endPTS;let r;uC(i,e,(f,g,y,x)=>{if((!e.startCC||e.skippedSegments)&&g.cc!==f.cc){const S=f.cc-g.cc;for(let E=y;E<x.length;E++)x[E].cc+=S;e.endCC=x[x.length-1].cc}ke(f.startPTS)&&ke(f.endPTS)&&(g.setStart(g.startPTS=f.startPTS),g.startDTS=f.startDTS,g.maxStartPTS=f.maxStartPTS,g.endPTS=f.endPTS,g.endDTS=f.endDTS,g.minEndPTS=f.minEndPTS,g.setDuration(f.endPTS-f.startPTS),g.duration&&(r=g),e.PTSKnown=e.alignedSliding=!0),f.hasStreams&&(g.elementaryStreams=f.elementaryStreams),g.loader=f.loader,f.hasStats&&(g.stats=f.stats),f.initSegment&&(g.initSegment=f.initSegment,s=f.initSegment)});const l=e.fragments,c=e.fragmentHint?l.concat(e.fragmentHint):l;if(s&&c.forEach(f=>{var g;f&&(!f.initSegment||f.initSegment.relurl===((g=s)==null?void 0:g.relurl))&&(f.initSegment=s)}),e.skippedSegments){if(e.deltaUpdateFailed=l.some(f=>!f),e.deltaUpdateFailed){t.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let f=e.skippedSegments;f--;)l.shift();e.startSN=l[0].sn}else{e.canSkipDateRanges&&(e.dateRanges=oC(i.dateRanges,e,t));const f=i.fragments.filter(g=>g.rawProgramDateTime);if(i.hasProgramDateTime&&!e.hasProgramDateTime)for(let g=1;g<c.length;g++)c[g].programDateTime===null&&rm(c[g],c[g-1],f);yb(f,e)}e.endCC=l[l.length-1].cc}if(!e.startCC){var d;const f=bb(i,e.startSN-1);e.startCC=(d=f?.cc)!=null?d:l[0].cc}cC(i.partList,e.partList,(f,g)=>{g.elementaryStreams=f.elementaryStreams,g.stats=f.stats}),r?vb(e,r,r.startPTS,r.endPTS,r.startDTS,r.endDTS,t):xb(i,e),l.length&&(e.totalduration=e.edge-l[0].start),e.driftStartTime=i.driftStartTime,e.driftStart=i.driftStart;const u=e.advancedDateTime;if(e.advanced&&u){const f=e.edge;e.driftStart||(e.driftStartTime=u,e.driftStart=f),e.driftEndTime=u,e.driftEnd=f}else e.driftEndTime=i.driftEndTime,e.driftEnd=i.driftEnd,e.advancedDateTime=i.advancedDateTime;e.requestScheduled===-1&&(e.requestScheduled=i.requestScheduled)}function oC(i,e,t){const{dateRanges:s,recentlyRemovedDateranges:n}=e,r=Ot({},i);n&&n.forEach(d=>{delete r[d]});const c=Object.keys(r).length;return c?(Object.keys(s).forEach(d=>{const u=r[d],f=new hb(s[d].attr,u);f.isValid?(r[d]=f,u||(f.tagOrder+=c)):t.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${Ut(s[d].attr)}"`)}),r):s}function cC(i,e,t){if(i&&e){let s=0;for(let n=0,r=i.length;n<=r;n++){const l=i[n],c=e[n+s];l&&c&&l.index===c.index&&l.fragment.sn===c.fragment.sn?t(l,c):s--}}}function uC(i,e,t){const s=e.skippedSegments,n=Math.max(i.startSN,e.startSN)-e.startSN,r=(i.fragmentHint?1:0)+(s?e.endSN:Math.min(i.endSN,e.endSN))-e.startSN,l=e.startSN-i.startSN,c=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,d=i.fragmentHint?i.fragments.concat(i.fragmentHint):i.fragments;for(let u=n;u<=r;u++){const f=d[l+u];let g=c[u];if(s&&!g&&f&&(g=e.fragments[u]=f),f&&g){t(f,g,u,c);const y=f.relurl,x=g.relurl;if(y&&dC(y,x)){e.playlistParsingError=dx(`media sequence mismatch ${g.sn}:`,i,e,f,g);return}else if(f.cc!==g.cc){e.playlistParsingError=dx(`discontinuity sequence mismatch (${f.cc}!=${g.cc})`,i,e,f,g);return}}}}function dx(i,e,t,s,n){return new Error(`${i} ${n.url}
Playlist starting @${e.startSN}
${e.m3u8}

Playlist starting @${t.startSN}
${t.m3u8}`)}function xb(i,e,t=!0){const s=e.startSN+e.skippedSegments-i.startSN,n=i.fragments,r=s>=0;let l=0;if(r&&s<n.length)l=n[s].start;else if(r&&e.startSN===i.endSN+1)l=i.fragmentEnd;else if(r&&t)l=i.fragmentStart+s*e.levelTargetDuration;else if(!e.skippedSegments&&e.fragmentStart===0)l=i.fragmentStart;else return;lm(e,l)}function lm(i,e){if(e){const t=i.fragments;for(let s=i.skippedSegments;s<t.length;s++)t[s].addStart(e);i.fragmentHint&&i.fragmentHint.addStart(e)}}function Sb(i,e=1/0){let t=1e3*i.targetduration;if(i.updated){const s=i.fragments;if(s.length&&t*4>e){const r=s[s.length-1].duration*1e3;r<t&&(t=r)}}else t/=2;return Math.round(t)}function bb(i,e,t){if(!i)return null;let s=i.fragments[e-i.startSN];return s||(s=i.fragmentHint,s&&s.sn===e)?s:e<i.startSN&&t&&t.sn===e?t:null}function hx(i,e,t){return i?Tb(i.partList,e,t):null}function Tb(i,e,t){if(i)for(let s=i.length;s--;){const n=i[s];if(n.index===t&&n.fragment.sn===e)return n}return null}function Eb(i){i.forEach((e,t)=>{var s;(s=e.details)==null||s.fragments.forEach(n=>{n.level=t,n.initSegment&&(n.initSegment.level=t)})})}function dC(i,e){return i!==e&&e?fx(i)!==fx(e):!1}function fx(i){return i.replace(/\?[^?]*$/,"")}function io(i,e){for(let s=0,n=i.length;s<n;s++){var t;if(((t=i[s])==null?void 0:t.cc)===e)return i[s]}return null}function hC(i,e){return!!(i&&e.startCC<i.endCC&&e.endCC>i.startCC)}function mx(i,e){const t=i.start+e;i.startPTS=t,i.setStart(t),i.endPTS=t+i.duration}function Ab(i,e){const t=e.fragments;for(let s=0,n=t.length;s<n;s++)mx(t[s],i);e.fragmentHint&&mx(e.fragmentHint,i),e.alignedSliding=!0}function fC(i,e){i&&(_b(e,i),e.alignedSliding||Nu(e,i),!e.alignedSliding&&!e.skippedSegments&&xb(i,e,!1))}function _b(i,e){if(!hC(e,i))return;const t=Math.min(e.endCC,i.endCC),s=io(e.fragments,t),n=io(i.fragments,t);if(!s||!n)return;wt.log(`Aligning playlist at start of dicontinuity sequence ${t}`);const r=s.start-n.start;Ab(r,i)}function Nu(i,e){if(!i.hasProgramDateTime||!e.hasProgramDateTime)return;const t=i.fragments,s=e.fragments;if(!t.length||!s.length)return;let n,r;const l=Math.min(e.endCC,i.endCC);e.startCC<l&&i.startCC<l&&(n=io(s,l),r=io(t,l)),(!n||!r)&&(n=s[Math.floor(s.length/2)],r=io(t,n.cc)||t[Math.floor(t.length/2)]);const c=n.programDateTime,d=r.programDateTime;if(!c||!d)return;const u=(d-c)/1e3-(r.start-n.start);Ab(u,i)}function Bs(i,e,t){ei(i,e,t),i.addEventListener(e,t)}function ei(i,e,t){i.removeEventListener(e,t)}const mC={toString:function(i){let e="";const t=i.length;for(let s=0;s<t;s++)e+=`[${i.start(s).toFixed(3)}-${i.end(s).toFixed(3)}]`;return e}},ue={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class Km extends ub{constructor(e,t,s,n,r){super(n,e.logger),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=ue.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.loadingParts=!1,this.loopSn=void 0,this.onMediaSeeking=()=>{const{config:l,fragCurrent:c,media:d,mediaBuffer:u,state:f}=this,g=d?d.currentTime:0,y=Xe.bufferInfo(u||d,g,l.maxBufferHole),x=!y.len;if(this.log(`Media seeking to ${ke(g)?g.toFixed(3):g}, state: ${f}, ${x?"out of":"in"} buffer`),this.state===ue.ENDED)this.resetLoadingState();else if(c){const S=l.maxFragLookUpTolerance,E=c.start-S,T=c.start+c.duration+S;if(x||T<y.start||E>y.end){const A=g>T;(g<E||A)&&(A&&c.loader&&(this.log(`Cancelling fragment load for seek (sn: ${c.sn})`),c.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}if(d){this.fragmentTracker.removeFragmentsInRange(g,1/0,this.playlistType,!0);const S=this.lastCurrentTime;if(g>S&&(this.lastCurrentTime=g),!this.loadingParts){const E=Math.max(y.end,g),T=this.shouldLoadParts(this.getLevelDetails(),E);T&&(this.log(`LL-Part loading ON after seeking to ${g.toFixed(2)} with buffer @${E.toFixed(2)}`),this.loadingParts=T)}}this.hls.hasEnoughToStart||(this.log(`Setting ${x?"startPosition":"nextLoadPosition"} to ${g} for seek without enough to start`),this.nextLoadPosition=g,x&&(this.startPosition=g)),x&&this.state===ue.IDLE&&this.tickImmediate()},this.onMediaEnded=()=>{this.log("setting startPosition to 0 because media ended"),this.startPosition=this.lastCurrentTime=0},this.playlistType=r,this.hls=e,this.fragmentLoader=new $w(e.config),this.keyLoader=s,this.fragmentTracker=t,this.config=e.config,this.decrypter=new $m(e.config)}registerListeners(){const{hls:e}=this;e.on(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(L.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(L.ERROR,this.onError,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){if(this.state===ue.STOPPED)return;this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;e!=null&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=ue.STOPPED}get startPositionValue(){const{nextLoadPosition:e,startPosition:t}=this;return t===-1&&e?e:t}get bufferingEnabled(){return this.buffering}pauseBuffering(){this.buffering=!1}resumeBuffering(){this.buffering=!0}get inFlightFrag(){return{frag:this.fragCurrent,state:this.state}}_streamEnded(e,t){if(t.live||!this.media)return!1;const s=e.end||0,n=this.config.timelineOffset||0;if(s<=n)return!1;const r=e.buffered;this.config.maxBufferHole&&r&&r.length>1&&(e=Xe.bufferedInfo(r,e.start,0));const l=e.nextStart;if(l&&l>n&&l<t.edge||this.media.currentTime<e.start)return!1;const d=t.partList;if(d!=null&&d.length){const f=d[d.length-1];return Xe.isBuffered(this.media,f.start+f.duration/2)}const u=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(u)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null)return this.levelLastLoaded.details}get timelineOffset(){const e=this.config.timelineOffset;if(e){var t;return((t=this.getLevelDetails())==null?void 0:t.appliedTimelineOffset)||e}return 0}onMediaAttached(e,t){const s=this.media=this.mediaBuffer=t.media;Bs(s,"seeking",this.onMediaSeeking),Bs(s,"ended",this.onMediaEnded);const n=this.config;this.levels&&n.autoStartLoad&&this.state===ue.STOPPED&&this.startLoad(n.startPosition)}onMediaDetaching(e,t){const s=!!t.transferMedia,n=this.media;if(n!==null){if(n.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),ei(n,"seeking",this.onMediaSeeking),ei(n,"ended",this.onMediaEnded),this.keyLoader&&!s&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,s){this.resetLoadingState(),this.resetTransmuxer();return}this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}}onManifestLoading(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1}onError(e,t){}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset}onHandlerDestroying(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),super.onHandlerDestroying(),this.hls=this.onMediaSeeking=this.onMediaEnded=null}onHandlerDestroyed(){this.state=ue.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,s){this.startFragRequested=!0,this._loadFragForPlayback(e,t,s)}_loadFragForPlayback(e,t,s){const n=r=>{const l=r.frag;if(this.fragContextChanged(l)){this.warn(`${l.type} sn: ${l.sn}${r.part?" part: "+r.part.index:""} of ${this.fragInfo(l,!1,r.part)}) was dropped during download.`),this.fragmentTracker.removeFragment(l);return}l.stats.chunkCount++,this._handleFragmentLoadProgress(r)};this._doFragLoad(e,t,s,n).then(r=>{if(!r)return;const l=this.state,c=r.frag;if(this.fragContextChanged(c)){(l===ue.FRAG_LOADING||!this.fragCurrent&&l===ue.PARSING)&&(this.fragmentTracker.removeFragment(c),this.state=ue.IDLE);return}"payload"in r&&(this.log(`Loaded ${c.type} sn: ${c.sn} of ${this.playlistLabel()} ${c.level}`),this.hls.trigger(L.FRAG_LOADED,r)),this._handleFragmentLoadComplete(r)}).catch(r=>{this.state===ue.STOPPED||this.state===ue.ERROR||(this.warn(`Frag error: ${r?.message||r}`),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var t;const{fragmentTracker:s}=this;if(s.getState(e)===vs.APPENDING){const r=e.type,l=this.getFwdBufferInfo(this.mediaBuffer,r),c=Math.max(e.duration,l?l.len:this.config.maxBufferLength),d=this.backtrackFragment;((d?e.sn-d.sn:0)===1||this.reduceMaxBufferLength(c,e.duration))&&s.removeFragment(e)}else((t=this.mediaBuffer)==null?void 0:t.buffered.length)===0?s.removeAllFragments():s.hasParts(e.type)&&(s.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),s.getState(e)===vs.PARTIAL&&s.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}waitForLive(e){const t=e.details;return t?.live&&t.type!=="EVENT"&&(this.levelLastLoaded!==e||t.expired)}flushMainBuffer(e,t,s=null){if(!(e-t))return;const n={startOffset:e,endOffset:t,type:s};this.hls.trigger(L.BUFFER_FLUSHING,n)}_loadInitSegment(e,t){this._doFragLoad(e,t).then(s=>{const n=s?.frag;if(!n||this.fragContextChanged(n)||!this.levels)throw new Error("init load aborted");return s}).then(s=>{const{hls:n}=this,{frag:r,payload:l}=s,c=r.decryptdata;if(l&&l.byteLength>0&&c!=null&&c.key&&c.iv&&Yr(c.method)){const d=self.performance.now();return this.decrypter.decrypt(new Uint8Array(l),c.key.buffer,c.iv.buffer,Hm(c.method)).catch(u=>{throw n.trigger(L.ERROR,{type:je.MEDIA_ERROR,details:W.FRAG_DECRYPT_ERROR,fatal:!1,error:u,reason:u.message,frag:r}),u}).then(u=>{const f=self.performance.now();return n.trigger(L.FRAG_DECRYPTED,{frag:r,payload:u,stats:{tstart:d,tdecrypt:f}}),s.payload=u,this.completeInitSegmentLoad(s)})}return this.completeInitSegmentLoad(s)}).catch(s=>{this.state===ue.STOPPED||this.state===ue.ERROR||(this.warn(s),this.resetFragmentLoading(e))})}completeInitSegmentLoad(e){const{levels:t}=this;if(!t)throw new Error("init load aborted, missing levels");const s=e.frag.stats;this.state!==ue.STOPPED&&(this.state=ue.IDLE),e.frag.data=new Uint8Array(e.payload),s.parsing.start=s.buffering.start=self.performance.now(),s.parsing.end=s.buffering.end=self.performance.now(),this.tick()}unhandledEncryptionError(e,t){var s,n;const r=e.tracks;if(r&&!t.encrypted&&((s=r.audio)!=null&&s.encrypted||(n=r.video)!=null&&n.encrypted)&&(!this.config.emeEnabled||!this.keyLoader.emeController)){const l=this.media,c=new Error(`Encrypted track with no key in ${this.fragInfo(t)} (media ${l?"attached mediaKeys: "+l.mediaKeys:"detached"})`);return this.warn(c.message),!l||l.mediaKeys?!1:(this.hls.trigger(L.ERROR,{type:je.KEY_SYSTEM_ERROR,details:W.KEY_SYSTEM_NO_KEYS,fatal:!1,error:c,frag:t}),this.resetTransmuxer(),!0)}return!1}fragContextChanged(e){const{fragCurrent:t}=this;return!e||!t||e.sn!==t.sn||e.level!==t.level}fragBufferedComplete(e,t){const s=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)} > buffer:${s?mC.toString(Xe.getBuffered(s)):"(detached)"})`),rs(e)){var n;if(e.type!==De.SUBTITLE){const l=e.elementaryStreams;if(!Object.keys(l).some(c=>!!l[c])){this.state=ue.IDLE;return}}const r=(n=this.levels)==null?void 0:n[e.level];r!=null&&r.fragmentError&&(this.log(`Resetting level fragment error count of ${r.fragmentError} on frag buffered`),r.fragmentError=0)}this.state=ue.IDLE}_handleFragmentLoadComplete(e){const{transmuxer:t}=this;if(!t)return;const{frag:s,part:n,partsLoaded:r}=e,l=!r||r.length===0||r.some(d=>!d),c=new Gm(s.level,s.sn,s.stats.chunkCount+1,0,n?n.index:-1,!l);t.flush(c)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,s=null,n){var r;this.fragCurrent=e;const l=t.details;if(!this.levels||!l)throw new Error(`frag load aborted, missing level${l?"":" detail"}s`);let c=null;if(e.encrypted&&!((r=e.decryptdata)!=null&&r.key)){if(this.log(`Loading key for ${e.sn} of [${l.startSN}-${l.endSN}], ${this.playlistLabel()} ${e.level}`),this.state=ue.KEY_LOADING,this.fragCurrent=e,c=this.keyLoader.load(e).then(y=>{if(!this.fragContextChanged(y.frag))return this.hls.trigger(L.KEY_LOADED,y),this.state===ue.KEY_LOADING&&(this.state=ue.IDLE),y}),this.hls.trigger(L.KEY_LOADING,{frag:e}),this.fragCurrent===null)return this.log("context changed in KEY_LOADING"),Promise.resolve(null)}else e.encrypted||(c=this.keyLoader.loadClear(e,l.encryptedFragments,this.startFragRequested),c&&this.log("[eme] blocking frag load until media-keys acquired"));const d=this.fragPrevious;if(rs(e)&&(!d||e.sn!==d.sn)){const y=this.shouldLoadParts(t.details,e.end);y!==this.loadingParts&&(this.log(`LL-Part loading ${y?"ON":"OFF"} loading sn ${d?.sn}->${e.sn}`),this.loadingParts=y)}if(s=Math.max(e.start,s||0),this.loadingParts&&rs(e)){const y=l.partList;if(y&&n){s>l.fragmentEnd&&l.fragmentHint&&(e=l.fragmentHint);const x=this.getNextPart(y,e,s);if(x>-1){const S=y[x];e=this.fragCurrent=S.fragment,this.log(`Loading ${e.type} sn: ${e.sn} part: ${S.index} (${x}/${y.length-1}) of ${this.fragInfo(e,!1,S)}) cc: ${e.cc} [${l.startSN}-${l.endSN}], target: ${parseFloat(s.toFixed(3))}`),this.nextLoadPosition=S.start+S.duration,this.state=ue.FRAG_LOADING;let E;return c?E=c.then(T=>!T||this.fragContextChanged(T.frag)?null:this.doFragPartsLoad(e,S,t,n)).catch(T=>this.handleFragLoadError(T)):E=this.doFragPartsLoad(e,S,t,n).catch(T=>this.handleFragLoadError(T)),this.hls.trigger(L.FRAG_LOADING,{frag:e,part:S,targetBufferTime:s}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):E}else if(!e.url||this.loadedEndOfParts(y,s))return Promise.resolve(null)}}if(rs(e)&&this.loadingParts){var u;this.log(`LL-Part loading OFF after next part miss @${s.toFixed(2)} Check buffer at sn: ${e.sn} loaded parts: ${(u=l.partList)==null?void 0:u.filter(y=>y.loaded).map(y=>`[${y.start}-${y.end}]`)}`),this.loadingParts=!1}else if(!e.url)return Promise.resolve(null);this.log(`Loading ${e.type} sn: ${e.sn} of ${this.fragInfo(e,!1)}) cc: ${e.cc} ${"["+l.startSN+"-"+l.endSN+"]"}, target: ${parseFloat(s.toFixed(3))}`),ke(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=ue.FRAG_LOADING;const f=this.config.progressive&&e.type!==De.SUBTITLE;let g;return f&&c?g=c.then(y=>!y||this.fragContextChanged(y.frag)?null:this.fragmentLoader.load(e,n)).catch(y=>this.handleFragLoadError(y)):g=Promise.all([this.fragmentLoader.load(e,f?n:void 0),c]).then(([y])=>(!f&&n&&n(y),y)).catch(y=>this.handleFragLoadError(y)),this.hls.trigger(L.FRAG_LOADING,{frag:e,targetBufferTime:s}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):g}doFragPartsLoad(e,t,s,n){return new Promise((r,l)=>{var c;const d=[],u=(c=s.details)==null?void 0:c.partList,f=g=>{this.fragmentLoader.loadPart(e,g,n).then(y=>{d[g.index]=y;const x=y.part;this.hls.trigger(L.FRAG_LOADED,y);const S=hx(s.details,e.sn,g.index+1)||Tb(u,e.sn,g.index+1);if(S)f(S);else return r({frag:e,part:x,partsLoaded:d})}).catch(l)};f(t)})}handleFragLoadError(e){if("data"in e){const t=e.data;t.frag&&t.details===W.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):t.frag&&t.type===je.KEY_SYSTEM_ERROR?(t.frag.abortRequests(),this.resetStartWhenNotLoaded(),this.resetFragmentLoading(t.frag)):this.hls.trigger(L.ERROR,t)}else this.hls.trigger(L.ERROR,{type:je.OTHER_ERROR,details:W.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const t=this.getCurrentContext(e);if(!t||this.state!==ue.PARSING){!this.fragCurrent&&this.state!==ue.STOPPED&&this.state!==ue.ERROR&&(this.state=ue.IDLE);return}const{frag:s,part:n,level:r}=t,l=self.performance.now();s.stats.parsing.end=l,n&&(n.stats.parsing.end=l);const c=this.getLevelDetails(),u=c&&s.sn>c.endSN||this.shouldLoadParts(c,s.end);u!==this.loadingParts&&(this.log(`LL-Part loading ${u?"ON":"OFF"} after parsing segment ending @${s.end.toFixed(2)}`),this.loadingParts=u),this.updateLevelTiming(s,n,r,e.partial)}shouldLoadParts(e,t){if(this.config.lowLatencyMode){if(!e)return this.loadingParts;if(e.partList){var s;const r=e.partList[0];if(r.fragment.type===De.SUBTITLE)return!1;const l=r.end+(((s=e.fragmentHint)==null?void 0:s.duration)||0);if(t>=l){var n;if((this.hls.hasEnoughToStart?((n=this.media)==null?void 0:n.currentTime)||this.lastCurrentTime:this.getLoadPosition())>r.start-r.fragment.duration)return!0}}}return!1}getCurrentContext(e){const{levels:t,fragCurrent:s}=this,{level:n,sn:r,part:l}=e;if(!(t!=null&&t[n]))return this.warn(`Levels object was unset while buffering fragment ${r} of ${this.playlistLabel()} ${n}. The current chunk will not be buffered.`),null;const c=t[n],d=c.details,u=l>-1?hx(d,r,l):null,f=u?u.fragment:bb(d,r,s);return f?(s&&s!==f&&(f.stats=s.stats),{frag:f,part:u,level:c}):null}bufferFragmentData(e,t,s,n,r){if(this.state!==ue.PARSING)return;const{data1:l,data2:c}=e;let d=l;if(c&&(d=Fi(l,c)),!d.length)return;const u=this.initPTS[t.cc],f=u?-u.baseTime/u.timescale:void 0,g={type:e.type,frag:t,part:s,chunkMeta:n,offset:f,parent:t.type,data:d};if(this.hls.trigger(L.BUFFER_APPENDING,g),e.dropped&&e.independent&&!s){if(r)return;this.flushBufferGap(t)}}flushBufferGap(e){const t=this.media;if(!t)return;if(!Xe.isBuffered(t,t.currentTime)){this.flushMainBuffer(0,e.start);return}const s=t.currentTime,n=Xe.bufferInfo(t,s,0),r=e.duration,l=Math.min(this.config.maxFragLookUpTolerance*2,r*.25),c=Math.max(Math.min(e.start-l,n.end-l),s+l);e.start-c>l&&this.flushMainBuffer(c,e.start)}getFwdBufferInfo(e,t){var s;const n=this.getLoadPosition();if(!ke(n))return null;const l=this.lastCurrentTime>n||(s=this.media)!=null&&s.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(e,n,t,l)}getFwdBufferInfoAtPos(e,t,s,n){const r=Xe.bufferInfo(e,t,n);if(r.len===0&&r.nextStart!==void 0){const l=this.fragmentTracker.getBufferedFrag(t,s);if(l&&(r.nextStart<=l.end||l.gap)){const c=Math.max(Math.min(r.nextStart,l.end)-t,n);return Xe.bufferInfo(e,t,c)}}return r}getMaxBufferLength(e){const{config:t}=this;let s;return e?s=Math.max(8*t.maxBufferSize/e,t.maxBufferLength):s=t.maxBufferLength,Math.min(s,t.maxMaxBufferLength)}reduceMaxBufferLength(e,t){const s=this.config,n=Math.max(Math.min(e-t,s.maxBufferLength),t),r=Math.max(e-t*3,s.maxMaxBufferLength/2,n);return r>=n?(s.maxMaxBufferLength=r,this.warn(`Reduce max buffer length to ${r}s`),!0):!1}getAppendedFrag(e,t=De.MAIN){const s=this.fragmentTracker?this.fragmentTracker.getAppendedFrag(e,t):null;return s&&"fragment"in s?s.fragment:s}getNextFragment(e,t){const s=t.fragments,n=s.length;if(!n)return null;const{config:r}=this,l=s[0].start,c=r.lowLatencyMode&&!!t.partList;let d=null;if(t.live){const g=r.initialLiveManifestSize;if(n<g)return this.warn(`Not enough fragments to start playback (have: ${n}, need: ${g})`),null;if(!t.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||e<l){var u;c&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),d=this.getInitialLiveFragment(t);const y=this.hls.startPosition,x=this.hls.liveSyncPosition,S=d?(y!==-1&&y>=l?y:x)||d.start:e;this.log(`Setting startPosition to ${S} to match start frag at live edge. mainStart: ${y} liveSyncPosition: ${x} frag.start: ${(u=d)==null?void 0:u.start}`),this.startPosition=this.nextLoadPosition=S}}else e<=l&&(d=s[0]);if(!d){const g=this.loadingParts?t.partEnd:t.fragmentEnd;d=this.getFragmentAtPosition(e,g,t)}let f=this.filterReplacedPrimary(d,t);if(!f&&d){const g=d.sn-t.startSN;f=this.filterReplacedPrimary(s[g+1]||null,t)}return this.mapToInitFragWhenRequired(f)}isLoopLoading(e,t){const s=this.fragmentTracker.getState(e);return(s===vs.OK||s===vs.PARTIAL&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,s,n,r){let l=null;if(e.gap&&(l=this.getNextFragment(this.nextLoadPosition,t),l&&!l.gap&&s.nextStart)){const c=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,s.nextStart,n,0);if(c!==null&&s.len+c.len>=r){const d=l.sn;return this.loopSn!==d&&(this.log(`buffer full after gaps in "${n}" playlist starting at sn: ${d}`),this.loopSn=d),null}}return this.loopSn=void 0,l}get primaryPrefetch(){if(px(this.config)){var e;if((e=this.hls.interstitialsManager)==null||(e=e.playingItem)==null?void 0:e.event)return!0}return!1}filterReplacedPrimary(e,t){if(!e)return e;if(px(this.config)&&e.type!==De.SUBTITLE){const s=this.hls.interstitialsManager,n=s?.bufferingItem;if(n){const l=n.event;if(l){if(l.appendInPlace||Math.abs(e.start-n.start)>1||n.start===0)return null}else if(e.end<=n.start&&t?.live===!1||e.start>n.end&&n.nextEvent&&(n.nextEvent.appendInPlace||e.start-n.end>1))return null}const r=s?.playerQueue;if(r)for(let l=r.length;l--;){const c=r[l].interstitial;if(c.appendInPlace&&e.start>=c.startTime&&e.end<=c.resumeTime)return null}}return e}mapToInitFragWhenRequired(e){return e!=null&&e.initSegment&&!e.initSegment.data&&!this.bitrateTest?e.initSegment:e}getNextPart(e,t,s){let n=-1,r=!1,l=!0;for(let c=0,d=e.length;c<d;c++){const u=e[c];if(l=l&&!u.independent,n>-1&&s<u.start)break;const f=u.loaded;f?n=-1:(r||(u.independent||l)&&u.fragment===t)&&(u.fragment!==t&&this.warn(`Need buffer at ${s} but next unloaded part starts at ${u.start}`),n=c),r=f}return n}loadedEndOfParts(e,t){let s;for(let n=e.length;n--;){if(s=e[n],!s.loaded)return!1;if(t>s.start)return!0}return!1}getInitialLiveFragment(e){const t=e.fragments,s=this.fragPrevious;let n=null;if(s){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${s.programDateTime}`),n=Cw(t,s.endProgramDateTime,this.config.maxFragLookUpTolerance)),!n){const r=s.sn+1;if(r>=e.startSN&&r<=e.endSN){const l=t[r-e.startSN];s.cc===l.cc&&(n=l,this.log(`Live playlist, switching playlist, load frag with next SN: ${n.sn}`))}n||(n=lb(e,s.cc,s.end),n&&this.log(`Live playlist, switching playlist, load frag with same CC: ${n.sn}`))}}else{const r=this.hls.liveSyncPosition;r!==null&&(n=this.getFragmentAtPosition(r,this.bitrateTest?e.fragmentEnd:e.edge,e))}return n}getFragmentAtPosition(e,t,s){const{config:n}=this;let{fragPrevious:r}=this,{fragments:l,endSN:c}=s;const{fragmentHint:d}=s,{maxFragLookUpTolerance:u}=n,f=s.partList,g=!!(this.loadingParts&&f!=null&&f.length&&d);g&&!this.bitrateTest&&f[f.length-1].fragment.sn===d.sn&&(l=l.concat(d),c=d.sn);let y;if(e<t){var x;const E=e<this.lastCurrentTime||e>t-u||(x=this.media)!=null&&x.paused||!this.startFragRequested?0:u;y=Ja(r,l,e,E)}else y=l[l.length-1];if(y){const S=y.sn-s.startSN,E=this.fragmentTracker.getState(y);if((E===vs.OK||E===vs.PARTIAL&&y.gap)&&(r=y),r&&y.sn===r.sn&&(!g||f[0].fragment.sn>y.sn||!s.live)&&y.level===r.level){const A=l[S+1];y.sn<c&&this.fragmentTracker.getState(A)!==vs.OK?y=A:y=null}}return y}alignPlaylists(e,t,s){const n=e.fragments.length;if(!n)return this.warn("No fragments in live playlist"),0;const r=e.fragmentStart,l=!t,c=e.alignedSliding&&ke(r);if(l||!c&&!r){fC(s,e);const d=e.fragmentStart;return this.log(`Live playlist sliding: ${d.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} fragments: ${n}`),d}return r}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,e.partTarget*3)}setStartPosition(e,t){let s=this.startPosition;s<t&&(s=-1);const n=this.timelineOffset;if(s===-1){const r=this.startTimeOffset!==null,l=r?this.startTimeOffset:e.startTimeOffset;l!==null&&ke(l)?(s=t+l,l<0&&(s+=e.edge),s=Math.min(Math.max(t,s),t+e.totalduration),this.log(`Setting startPosition to ${s} for start time offset ${l} found in ${r?"multivariant":"media"} playlist`),this.startPosition=s):e.live?(s=this.hls.liveSyncPosition||t,this.log(`Setting startPosition to -1 to start at live edge ${s}`),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=s=0),this.lastCurrentTime=s+n}this.nextLoadPosition=s+n}getLoadPosition(){var e;const{media:t}=this;let s=0;return(e=this.hls)!=null&&e.hasEnoughToStart&&t?s=t.currentTime:this.nextLoadPosition>=0&&(s=this.nextLoadPosition),s}handleFragLoadAborted(e,t){this.transmuxer&&e.type===this.playlistType&&rs(e)&&e.stats.aborted&&(this.log(`Fragment ${e.sn}${t?" part "+t.index:""} of ${this.playlistLabel()} ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){(!this.fragCurrent||!this.fragContextChanged(e)&&this.state!==ue.FRAG_LOADING_WAITING_RETRY)&&(this.state=ue.IDLE)}onFragmentOrKeyLoadError(e,t){var s;if(t.chunkMeta&&!t.frag){const A=this.getCurrentContext(t.chunkMeta);A&&(t.frag=A.frag)}const n=t.frag;if(!n||n.type!==e||!this.levels)return;if(this.fragContextChanged(n)){var r;this.warn(`Frag load error must match current frag to retry ${n.url} > ${(r=this.fragCurrent)==null?void 0:r.url}`);return}const l=t.details===W.FRAG_GAP;l&&this.fragmentTracker.fragBuffered(n,!0);const c=t.errorAction;if(!c){this.state=ue.ERROR;return}const{action:d,flags:u,retryCount:f=0,retryConfig:g}=c,y=!!g,x=y&&d===ws.RetryRequest,S=y&&!c.resolved&&u===gi.MoveAllAlternatesMatchingHost,E=(s=this.hls.latestLevelDetails)==null?void 0:s.live;if(!x&&S&&rs(n)&&!n.endList&&E&&!cb(t))this.resetFragmentErrors(e),this.treatAsGap(n),c.resolved=!0;else if((x||S)&&f<g.maxNumRetry){var T;const A=im((T=t.response)==null?void 0:T.code),I=Vm(g,f);if(this.resetStartWhenNotLoaded(),this.retryDate=self.performance.now()+I,this.state=ue.FRAG_LOADING_WAITING_RETRY,c.resolved=!0,A){this.log("Waiting for connection (offline)"),this.retryDate=1/0,t.reason="offline";return}this.warn(`Fragment ${n.sn} of ${e} ${n.level} errored with ${t.details}, retrying loading ${f+1}/${g.maxNumRetry} in ${I}ms`)}else if(g)if(this.resetFragmentErrors(e),f<g.maxNumRetry)!l&&d!==ws.RemoveAlternatePermanently&&(c.resolved=!0);else{this.warn(`${t.details} reached or exceeded max retry (${f})`);return}else d===ws.SendAlternateToPenaltyBox?this.state=ue.WAITING_LEVEL:this.state=ue.ERROR;this.tickImmediate()}checkRetryDate(){const e=self.performance.now(),t=this.retryDate,s=t===1/0;(!t||e>=t||s&&!im(0))&&(s&&this.log("Connection restored (online)"),this.resetStartWhenNotLoaded(),this.state=ue.IDLE)}reduceLengthAndFlushBuffer(e){if(this.state===ue.PARSING||this.state===ue.PARSED){const t=e.frag,s=e.parent,n=this.getFwdBufferInfo(this.mediaBuffer,s),r=n&&n.len>.5;r&&this.reduceMaxBufferLength(n.len,t?.duration||10);const l=!r;return l&&this.warn(`Buffer full error while media.currentTime (${this.getLoadPosition()}) is not buffered, flush ${s} buffer`),t&&(this.fragmentTracker.removeFragment(t),this.nextLoadPosition=t.start),this.resetLoadingState(),l}return!1}resetFragmentErrors(e){e===De.AUDIO&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==ue.STOPPED&&(this.state=ue.IDLE)}afterBufferFlushed(e,t,s){if(!e)return;const n=Xe.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,n,s),this.state===ue.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==ue.STOPPED&&(this.state=ue.IDLE)}resetStartWhenNotLoaded(){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;const e=this.levelLastLoaded,t=e?e.details:null;t!=null&&t.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(t,t.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.log(`Loading context changed while buffering sn ${e.sn} of ${this.playlistLabel()} ${e.level===-1?"<removed>":e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,s,n){const r=s.details;if(!r){this.warn("level.details undefined");return}if(!Object.keys(e.elementaryStreams).reduce((d,u)=>{const f=e.elementaryStreams[u];if(f){const g=f.endPTS-f.startPTS;if(g<=0)return this.warn(`Could not parse fragment ${e.sn} ${u} duration reliably (${g})`),d||!1;const y=n?0:vb(r,e,f.startPTS,f.endPTS,f.startDTS,f.endDTS,this);return this.hls.trigger(L.LEVEL_PTS_UPDATED,{details:r,level:s,drift:y,type:u,frag:e,start:f.startPTS,end:f.endPTS}),!0}return d},!1)){var c;const d=((c=this.transmuxer)==null?void 0:c.error)===null;if((s.fragmentError===0||d&&(s.fragmentError<2||e.endList))&&this.treatAsGap(e,s),d){const u=new Error(`Found no media in fragment ${e.sn} of ${this.playlistLabel()} ${e.level} resetting transmuxer to fallback to playlist timing`);if(this.warn(u.message),this.hls.trigger(L.ERROR,{type:je.MEDIA_ERROR,details:W.FRAG_PARSING_ERROR,fatal:!1,error:u,frag:e,reason:`Found no media in msn ${e.sn} of ${this.playlistLabel()} "${s.url}"`}),!this.hls)return;this.resetTransmuxer()}}this.state=ue.PARSED,this.log(`Parsed ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)})`),this.hls.trigger(L.FRAG_PARSED,{frag:e,part:t})}playlistLabel(){return this.playlistType===De.MAIN?"level":"track"}fragInfo(e,t=!0,s){var n,r;return`${this.playlistLabel()} ${e.level} (${s?"part":"frag"}:[${((n=t&&!s?e.startPTS:(s||e).start)!=null?n:NaN).toFixed(3)}-${((r=t&&!s?e.endPTS:(s||e).end)!=null?r:NaN).toFixed(3)}]${s&&e.type==="main"?"INDEPENDENT="+(s.independent?"YES":"NO"):""}`}treatAsGap(e,t){t&&t.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)}resetTransmuxer(){var e;(e=this.transmuxer)==null||e.reset()}recoverWorkerError(e){e.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(),this.resetLoadingState())}set state(e){const t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}}function px(i){return!!i.interstitialsController&&i.enableInterstitialPlayback!==!1}class Ib{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:t}=this;let s;if(e.length)e.length===1?s=e[0]:s=pC(e,t);else return new Uint8Array(0);return this.reset(),s}reset(){this.chunks.length=0,this.dataLength=0}}function pC(i,e){const t=new Uint8Array(e);let s=0;for(let n=0;n<i.length;n++){const r=i[n];t.set(r,s),s+=r.length}return t}var Rf={exports:{}},gx;function gC(){return gx||(gx=1,(function(i){var e=Object.prototype.hasOwnProperty,t="~";function s(){}Object.create&&(s.prototype=Object.create(null),new s().__proto__||(t=!1));function n(d,u,f){this.fn=d,this.context=u,this.once=f||!1}function r(d,u,f,g,y){if(typeof f!="function")throw new TypeError("The listener must be a function");var x=new n(f,g||d,y),S=t?t+u:u;return d._events[S]?d._events[S].fn?d._events[S]=[d._events[S],x]:d._events[S].push(x):(d._events[S]=x,d._eventsCount++),d}function l(d,u){--d._eventsCount===0?d._events=new s:delete d._events[u]}function c(){this._events=new s,this._eventsCount=0}c.prototype.eventNames=function(){var u=[],f,g;if(this._eventsCount===0)return u;for(g in f=this._events)e.call(f,g)&&u.push(t?g.slice(1):g);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(f)):u},c.prototype.listeners=function(u){var f=t?t+u:u,g=this._events[f];if(!g)return[];if(g.fn)return[g.fn];for(var y=0,x=g.length,S=new Array(x);y<x;y++)S[y]=g[y].fn;return S},c.prototype.listenerCount=function(u){var f=t?t+u:u,g=this._events[f];return g?g.fn?1:g.length:0},c.prototype.emit=function(u,f,g,y,x,S){var E=t?t+u:u;if(!this._events[E])return!1;var T=this._events[E],A=arguments.length,I,_;if(T.fn){switch(T.once&&this.removeListener(u,T.fn,void 0,!0),A){case 1:return T.fn.call(T.context),!0;case 2:return T.fn.call(T.context,f),!0;case 3:return T.fn.call(T.context,f,g),!0;case 4:return T.fn.call(T.context,f,g,y),!0;case 5:return T.fn.call(T.context,f,g,y,x),!0;case 6:return T.fn.call(T.context,f,g,y,x,S),!0}for(_=1,I=new Array(A-1);_<A;_++)I[_-1]=arguments[_];T.fn.apply(T.context,I)}else{var C=T.length,k;for(_=0;_<C;_++)switch(T[_].once&&this.removeListener(u,T[_].fn,void 0,!0),A){case 1:T[_].fn.call(T[_].context);break;case 2:T[_].fn.call(T[_].context,f);break;case 3:T[_].fn.call(T[_].context,f,g);break;case 4:T[_].fn.call(T[_].context,f,g,y);break;default:if(!I)for(k=1,I=new Array(A-1);k<A;k++)I[k-1]=arguments[k];T[_].fn.apply(T[_].context,I)}}return!0},c.prototype.on=function(u,f,g){return r(this,u,f,g,!1)},c.prototype.once=function(u,f,g){return r(this,u,f,g,!0)},c.prototype.removeListener=function(u,f,g,y){var x=t?t+u:u;if(!this._events[x])return this;if(!f)return l(this,x),this;var S=this._events[x];if(S.fn)S.fn===f&&(!y||S.once)&&(!g||S.context===g)&&l(this,x);else{for(var E=0,T=[],A=S.length;E<A;E++)(S[E].fn!==f||y&&!S[E].once||g&&S[E].context!==g)&&T.push(S[E]);T.length?this._events[x]=T.length===1?T[0]:T:l(this,x)}return this},c.prototype.removeAllListeners=function(u){var f;return u?(f=t?t+u:u,this._events[f]&&l(this,f)):(this._events=new s,this._eventsCount=0),this},c.prototype.off=c.prototype.removeListener,c.prototype.addListener=c.prototype.on,c.prefixed=t,c.EventEmitter=c,i.exports=c})(Rf)),Rf.exports}var yC=gC(),Ym=$1(yC);const uo="1.6.15",Jr={};function vC(){return typeof __HLS_WORKER_BUNDLE__=="function"}function xC(){const i=Jr[uo];if(i)return i.clientCount++,i;const e=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),t=self.URL.createObjectURL(e),n={worker:new self.Worker(t),objectURL:t,clientCount:1};return Jr[uo]=n,n}function SC(i){const e=Jr[i];if(e)return e.clientCount++,e;const t=new self.URL(i,self.location.href).href,n={worker:new self.Worker(t),scriptURL:t,clientCount:1};return Jr[i]=n,n}function bC(i){const e=Jr[i||uo];if(e&&e.clientCount--===1){const{worker:s,objectURL:n}=e;delete Jr[i||uo],n&&self.URL.revokeObjectURL(n),s.terminate()}}function Rb(i,e){return e+10<=i.length&&i[e]===51&&i[e+1]===68&&i[e+2]===73&&i[e+3]<255&&i[e+4]<255&&i[e+6]<128&&i[e+7]<128&&i[e+8]<128&&i[e+9]<128}function qm(i,e){return e+10<=i.length&&i[e]===73&&i[e+1]===68&&i[e+2]===51&&i[e+3]<255&&i[e+4]<255&&i[e+6]<128&&i[e+7]<128&&i[e+8]<128&&i[e+9]<128}function Qu(i,e){let t=0;return t=(i[e]&127)<<21,t|=(i[e+1]&127)<<14,t|=(i[e+2]&127)<<7,t|=i[e+3]&127,t}function ho(i,e){const t=e;let s=0;for(;qm(i,e);){s+=10;const n=Qu(i,e+6);s+=n,Rb(i,e+10)&&(s+=10),e+=s}if(s>0)return i.subarray(t,t+s)}function TC(i,e,t,s){const n=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],r=e[t+2],l=r>>2&15;if(l>12){const x=new Error(`invalid ADTS sampling index:${l}`);i.emit(L.ERROR,L.ERROR,{type:je.MEDIA_ERROR,details:W.FRAG_PARSING_ERROR,fatal:!0,error:x,reason:x.message});return}const c=(r>>6&3)+1,d=e[t+3]>>6&3|(r&1)<<2,u="mp4a.40."+c,f=n[l];let g=l;(c===5||c===29)&&(g-=3);const y=[c<<3|(g&14)>>1,(g&1)<<7|d<<3];return wt.log(`manifest codec:${s}, parsed codec:${u}, channels:${d}, rate:${f} (ADTS object type:${c} sampling index:${l})`),{config:y,samplerate:f,channelCount:d,codec:u,parsedCodec:u,manifestCodec:s}}function Lb(i,e){return i[e]===255&&(i[e+1]&246)===240}function wb(i,e){return i[e+1]&1?7:9}function Qm(i,e){return(i[e+3]&3)<<11|i[e+4]<<3|(i[e+5]&224)>>>5}function EC(i,e){return e+5<i.length}function Ou(i,e){return e+1<i.length&&Lb(i,e)}function AC(i,e){return EC(i,e)&&Lb(i,e)&&Qm(i,e)<=i.length-e}function _C(i,e){if(Ou(i,e)){const t=wb(i,e);if(e+t>=i.length)return!1;const s=Qm(i,e);if(s<=t)return!1;const n=e+s;return n===i.length||Ou(i,n)}return!1}function Cb(i,e,t,s,n){if(!i.samplerate){const r=TC(e,t,s,n);if(!r)return;Ot(i,r)}}function kb(i){return 1024*9e4/i}function IC(i,e){const t=wb(i,e);if(e+t<=i.length){const s=Qm(i,e)-t;if(s>0)return{headerLength:t,frameLength:s}}}function Nb(i,e,t,s,n){const r=kb(i.samplerate),l=s+n*r,c=IC(e,t);let d;if(c){const{frameLength:g,headerLength:y}=c,x=y+g,S=Math.max(0,t+x-e.length);S?(d=new Uint8Array(x-y),d.set(e.subarray(t+y,e.length),0)):d=e.subarray(t+y,t+x);const E={unit:d,pts:l};return S||i.samples.push(E),{sample:E,length:x,missing:S}}const u=e.length-t;return d=new Uint8Array(u),d.set(e.subarray(t,e.length),0),{sample:{unit:d,pts:l},length:u,missing:-1}}function RC(i,e){return qm(i,e)&&Qu(i,e+6)+10<=i.length-e}function LC(i){return i instanceof ArrayBuffer?i:i.byteOffset==0&&i.byteLength==i.buffer.byteLength?i.buffer:new Uint8Array(i).buffer}function Lf(i,e=0,t=1/0){return wC(i,e,t,Uint8Array)}function wC(i,e,t,s){const n=CC(i);let r=1;"BYTES_PER_ELEMENT"in s&&(r=s.BYTES_PER_ELEMENT);const l=kC(i)?i.byteOffset:0,c=(l+i.byteLength)/r,d=(l+e)/r,u=Math.floor(Math.max(0,Math.min(d,c))),f=Math.floor(Math.min(u+Math.max(t,0),c));return new s(n,u,f-u)}function CC(i){return i instanceof ArrayBuffer?i:i.buffer}function kC(i){return i&&i.buffer instanceof ArrayBuffer&&i.byteLength!==void 0&&i.byteOffset!==void 0}function NC(i){const e={key:i.type,description:"",data:"",mimeType:null,pictureType:null},t=3;if(i.size<2)return;if(i.data[0]!==t){console.log("Ignore frame with unrecognized character encoding");return}const s=i.data.subarray(1).indexOf(0);if(s===-1)return;const n=Ti(Lf(i.data,1,s)),r=i.data[2+s],l=i.data.subarray(3+s).indexOf(0);if(l===-1)return;const c=Ti(Lf(i.data,3+s,l));let d;return n==="-->"?d=Ti(Lf(i.data,4+s+l)):d=LC(i.data.subarray(4+s+l)),e.mimeType=n,e.pictureType=r,e.description=c,e.data=d,e}function OC(i){if(i.size<2)return;const e=Ti(i.data,!0),t=new Uint8Array(i.data.subarray(e.length+1));return{key:i.type,info:e,data:t.buffer}}function DC(i){if(i.size<2)return;if(i.type==="TXXX"){let t=1;const s=Ti(i.data.subarray(t),!0);t+=s.length+1;const n=Ti(i.data.subarray(t));return{key:i.type,info:s,data:n}}const e=Ti(i.data.subarray(1));return{key:i.type,info:"",data:e}}function PC(i){if(i.type==="WXXX"){if(i.size<2)return;let t=1;const s=Ti(i.data.subarray(t),!0);t+=s.length+1;const n=Ti(i.data.subarray(t));return{key:i.type,info:s,data:n}}const e=Ti(i.data);return{key:i.type,info:"",data:e}}function UC(i){return i.type==="PRIV"?OC(i):i.type[0]==="W"?PC(i):i.type==="APIC"?NC(i):DC(i)}function MC(i){const e=String.fromCharCode(i[0],i[1],i[2],i[3]),t=Qu(i,4),s=10;return{type:e,size:t,data:i.subarray(s,s+t)}}const Kc=10,jC=10;function Ob(i){let e=0;const t=[];for(;qm(i,e);){const s=Qu(i,e+6);i[e+5]>>6&1&&(e+=Kc),e+=Kc;const n=e+s;for(;e+jC<n;){const r=MC(i.subarray(e)),l=UC(r);l&&t.push(l),e+=r.size+Kc}Rb(i,e)&&(e+=Kc)}return t}function Db(i){return i&&i.key==="PRIV"&&i.info==="com.apple.streaming.transportStreamTimestamp"}function FC(i){if(i.data.byteLength===8){const e=new Uint8Array(i.data),t=e[3]&1;let s=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return s/=45,t&&(s+=4772185884e-2),Math.round(s)}}function Wm(i){const e=Ob(i);for(let t=0;t<e.length;t++){const s=e[t];if(Db(s))return FC(s)}}let vi=(function(i){return i.audioId3="org.id3",i.dateRange="com.apple.quicktime.HLS",i.emsg="https://aomedia.org/emsg/ID3",i.misbklv="urn:misb:KLV:bin:1910.1",i})({});function fn(i="",e=9e4){return{type:i,id:-1,pid:-1,inputTimeScale:e,sequenceNumber:-1,samples:[],dropped:0}}class Xm{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,s,n){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,s){}demux(e,t){this.cachedData&&(e=Fi(this.cachedData,e),this.cachedData=null);let s=ho(e,0),n=s?s.length:0,r;const l=this._audioTrack,c=this._id3Track,d=s?Wm(s):void 0,u=e.length;for((this.basePTS===null||this.frameIndex===0&&ke(d))&&(this.basePTS=BC(d,t,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),s&&s.length>0&&c.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:s,type:vi.audioId3,duration:Number.POSITIVE_INFINITY});n<u;){if(this.canParse(e,n)){const f=this.appendFrame(l,e,n);f?(this.frameIndex++,this.lastPTS=f.sample.pts,n+=f.length,r=n):n=u}else RC(e,n)?(s=ho(e,n),c.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:s,type:vi.audioId3,duration:Number.POSITIVE_INFINITY}),n+=s.length,r=n):n++;if(n===u&&r!==u){const f=e.slice(r);this.cachedData?this.cachedData=Fi(this.cachedData,f):this.cachedData=f}}return{audioTrack:l,videoTrack:fn(),id3Track:c,textTrack:fn()}}demuxSampleAes(e,t,s){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:fn(),id3Track:this._id3Track,textTrack:fn()}}destroy(){this.cachedData=null,this._audioTrack=this._id3Track=void 0}}const BC=(i,e,t)=>{if(ke(i))return i*90;const s=t?t.baseTime*9e4/t.timescale:0;return e*9e4+s};let Yc=null;const VC=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],$C=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],GC=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],HC=[0,1,1,4];function Pb(i,e,t,s,n){if(t+24>e.length)return;const r=Ub(e,t);if(r&&t+r.frameLength<=e.length){const l=r.samplesPerFrame*9e4/r.sampleRate,c=s+n*l,d={unit:e.subarray(t,t+r.frameLength),pts:c,dts:c};return i.config=[],i.channelCount=r.channelCount,i.samplerate=r.sampleRate,i.samples.push(d),{sample:d,length:r.frameLength,missing:0}}}function Ub(i,e){const t=i[e+1]>>3&3,s=i[e+1]>>1&3,n=i[e+2]>>4&15,r=i[e+2]>>2&3;if(t!==1&&n!==0&&n!==15&&r!==3){const l=i[e+2]>>1&1,c=i[e+3]>>6,d=t===3?3-s:s===3?3:4,u=VC[d*14+n-1]*1e3,g=$C[(t===3?0:t===2?1:2)*3+r],y=c===3?1:2,x=GC[t][s],S=HC[s],E=x*8*S,T=Math.floor(x*u/g+l)*S;if(Yc===null){const _=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);Yc=_?parseInt(_[1]):0}return Yc&&Yc<=87&&s===2&&u>=224e3&&c===0&&(i[e+3]=i[e+3]|128),{sampleRate:g,channelCount:y,frameLength:T,samplesPerFrame:E}}}function Zm(i,e){return i[e]===255&&(i[e+1]&224)===224&&(i[e+1]&6)!==0}function Mb(i,e){return e+1<i.length&&Zm(i,e)}function zC(i,e){return Zm(i,e)&&4<=i.length-e}function jb(i,e){if(e+1<i.length&&Zm(i,e)){const s=Ub(i,e);let n=4;s!=null&&s.frameLength&&(n=s.frameLength);const r=e+n;return r===i.length||Mb(i,r)}return!1}class KC extends Xm{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,s,n){super.resetInitSegment(e,t,s,n),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:n,inputTimeScale:9e4,dropped:0}}static probe(e,t){if(!e)return!1;const s=ho(e,0);let n=s?.length||0;if(jb(e,n))return!1;for(let r=e.length;n<r;n++)if(_C(e,n))return t.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return AC(e,t)}appendFrame(e,t,s){Cb(e,this.observer,t,s,e.manifestCodec);const n=Nb(e,t,s,this.basePTS,this.frameIndex);if(n&&n.missing===0)return n}}const Fb=(i,e)=>{let t=0,s=5;e+=s;const n=new Uint32Array(1),r=new Uint32Array(1),l=new Uint8Array(1);for(;s>0;){l[0]=i[e];const c=Math.min(s,8),d=8-c;r[0]=4278190080>>>24+d<<d,n[0]=(l[0]&r[0])>>d,t=t?t<<c|n[0]:n[0],e+=1,s-=c}return t};class YC extends Xm{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,t,s,n){super.resetInitSegment(e,t,s,n),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:t,duration:n,inputTimeScale:9e4,dropped:0}}canParse(e,t){return t+64<e.length}appendFrame(e,t,s){const n=Bb(e,t,s,this.basePTS,this.frameIndex);if(n!==-1)return{sample:e.samples[e.samples.length-1],length:n,missing:0}}static probe(e){if(!e)return!1;const t=ho(e,0);if(!t)return!1;const s=t.length;return e[s]===11&&e[s+1]===119&&Wm(t)!==void 0&&Fb(e,s)<16}}function Bb(i,e,t,s,n){if(t+8>e.length||e[t]!==11||e[t+1]!==119)return-1;const r=e[t+4]>>6;if(r>=3)return-1;const c=[48e3,44100,32e3][r],d=e[t+4]&63,f=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][d*3+r]*2;if(t+f>e.length)return-1;const g=e[t+6]>>5;let y=0;g===2?y+=2:(g&1&&g!==1&&(y+=2),g&4&&(y+=2));const x=(e[t+6]<<8|e[t+7])>>12-y&1,E=[2,1,2,3,3,4,4,5][g]+x,T=e[t+5]>>3,A=e[t+5]&7,I=new Uint8Array([r<<6|T<<1|A>>2,(A&3)<<6|g<<3|x<<2|d>>4,d<<4&224]),_=1536/c*9e4,C=s+n*_,k=e.subarray(t,t+f);return i.config=I,i.channelCount=E,i.samplerate=c,i.samples.push({unit:k,pts:C}),f}class qC extends Xm{resetInitSegment(e,t,s,n){super.resetInitSegment(e,t,s,n),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:n,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=ho(e,0);let s=t?.length||0;if(t&&e[s]===11&&e[s+1]===119&&Wm(t)!==void 0&&Fb(e,s)<=16)return!1;for(let n=e.length;s<n;s++)if(jb(e,s))return wt.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return zC(e,t)}appendFrame(e,t,s){if(this.basePTS!==null)return Pb(e,t,s,this.basePTS,this.frameIndex)}}const QC=/\/emsg[-/]ID3/i;class WC{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,s,n){const r=this.videoTrack=fn("video",1),l=this.audioTrack=fn("audio",1),c=this.txtTrack=fn("text",1);if(this.id3Track=fn("id3",1),this.timeOffset=0,!(e!=null&&e.byteLength))return;const d=WS(e);if(d.video){const{id:u,timescale:f,codec:g,supplemental:y}=d.video;r.id=u,r.timescale=c.timescale=f,r.codec=g,r.supplemental=y}if(d.audio){const{id:u,timescale:f,codec:g}=d.audio;l.id=u,l.timescale=f,l.codec=g}c.id=YS.text,r.sampleDuration=0,r.duration=l.duration=n}resetContiguity(){this.remainderData=null}static probe(e){return Y1(e)}demux(e,t){this.timeOffset=t;let s=e;const n=this.videoTrack,r=this.txtTrack;if(this.config.progressive){this.remainderData&&(s=Fi(this.remainderData,e));const c=ew(s);this.remainderData=c.remainder,n.samples=c.valid||new Uint8Array}else n.samples=s;const l=this.extractID3Track(n,t);return r.samples=Dv(t,n),{videoTrack:n,audioTrack:this.audioTrack,id3Track:l,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,t=this.videoTrack,s=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const n=this.extractID3Track(t,this.timeOffset);return s.samples=Dv(e,t),{videoTrack:t,audioTrack:fn(),id3Track:n,textTrack:fn()}}extractID3Track(e,t){const s=this.id3Track;if(e.samples.length){const n=st(e.samples,["emsg"]);n&&n.forEach(r=>{const l=sw(r);if(QC.test(l.schemeIdUri)){const c=yx(l,t);let d=l.eventDuration===4294967295?Number.POSITIVE_INFINITY:l.eventDuration/l.timeScale;d<=.001&&(d=Number.POSITIVE_INFINITY);const u=l.payload;s.samples.push({data:u,len:u.byteLength,dts:c,pts:c,type:vi.emsg,duration:d})}else if(this.config.enableEmsgKLVMetadata&&l.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){const c=yx(l,t);s.samples.push({data:l.payload,len:l.payload.byteLength,dts:c,pts:c,type:vi.misbklv,duration:Number.POSITIVE_INFINITY})}})}return s}demuxSampleAes(e,t,s){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0}}function yx(i,e){return ke(i.presentationTime)?i.presentationTime/i.timeScale:e+i.presentationTimeDelta/i.timeScale}class XC{constructor(e,t,s){this.keyData=void 0,this.decrypter=void 0,this.keyData=s,this.decrypter=new $m(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer,Ra.cbc)}decryptAacSample(e,t,s){const n=e[t].unit;if(n.length<=16)return;const r=n.subarray(16,n.length-n.length%16),l=r.buffer.slice(r.byteOffset,r.byteOffset+r.length);this.decryptBuffer(l).then(c=>{const d=new Uint8Array(c);n.set(d,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,s)}).catch(s)}decryptAacSamples(e,t,s){for(;;t++){if(t>=e.length){s();return}if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,s),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){const t=Math.floor((e.length-48)/160)*16+16,s=new Int8Array(t);let n=0;for(let r=32;r<e.length-16;r+=160,n+=16)s.set(e.subarray(r,r+16),n);return s}getAvcDecryptedUnit(e,t){const s=new Uint8Array(t);let n=0;for(let r=32;r<e.length-16;r+=160,n+=16)e.set(s.subarray(n,n+16),r);return e}decryptAvcSample(e,t,s,n,r){const l=JS(r.data),c=this.getAvcEncryptedData(l);this.decryptBuffer(c.buffer).then(d=>{r.data=this.getAvcDecryptedUnit(l,d),this.decrypter.isSync()||this.decryptAvcSamples(e,t,s+1,n)}).catch(n)}decryptAvcSamples(e,t,s,n){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,s=0){if(t>=e.length){n();return}const r=e[t].units;for(;!(s>=r.length);s++){const l=r[s];if(!(l.data.length<=48||l.type!==1&&l.type!==5)&&(this.decryptAvcSample(e,t,s,n,l),!this.decrypter.isSync()))return}}}}class Vb{constructor(){this.VideoSample=null}createVideoSample(e,t,s){return{key:e,frame:!1,pts:t,dts:s,units:[],length:0}}getLastNalUnit(e){var t;let s=this.VideoSample,n;if((!s||s.units.length===0)&&(s=e[e.length-1]),(t=s)!=null&&t.units){const r=s.units;n=r[r.length-1]}return n}pushAccessUnit(e,t){if(e.units.length&&e.frame){if(e.pts===void 0){const s=t.samples,n=s.length;if(n){const r=s[n-1];e.pts=r.pts,e.dts=r.dts}else{t.dropped++;return}}t.samples.push(e)}}parseNALu(e,t,s){const n=t.byteLength;let r=e.naluState||0;const l=r,c=[];let d=0,u,f,g,y=-1,x=0;for(r===-1&&(y=0,x=this.getNALuType(t,0),r=0,d=1);d<n;){if(u=t[d++],!r){r=u?0:1;continue}if(r===1){r=u?0:2;continue}if(!u)r=3;else if(u===1){if(f=d-r-1,y>=0){const S={data:t.subarray(y,f),type:x};c.push(S)}else{const S=this.getLastNalUnit(e.samples);S&&(l&&d<=4-l&&S.state&&(S.data=S.data.subarray(0,S.data.byteLength-l)),f>0&&(S.data=Fi(S.data,t.subarray(0,f)),S.state=0))}d<n?(g=this.getNALuType(t,d),y=d,x=g,r=0):r=-1}else r=0}if(y>=0&&r>=0){const S={data:t.subarray(y,n),type:x,state:r};c.push(S)}if(c.length===0){const S=this.getLastNalUnit(e.samples);S&&(S.data=Fi(S.data,t))}return e.naluState=r,c}}class no{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,s=e.byteLength-t,n=new Uint8Array(4),r=Math.min(4,t);if(r===0)throw new Error("no bytes available");n.set(e.subarray(s,s+r)),this.word=new DataView(n.buffer).getUint32(0),this.bitsAvailable=r*8,this.bytesAvailable-=r}skipBits(e){let t;e=Math.min(e,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const s=this.word>>>32-t;if(e>32&&wt.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return t=e-t,t>0&&this.bitsAvailable?s<<t|this.readBits(t):s}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if((this.word&2147483648>>>e)!==0)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}}class ZC extends Vb{parsePES(e,t,s,n){const r=this.parseNALu(e,s.data,n);let l=this.VideoSample,c,d=!1;s.data=null,l&&r.length&&!e.audFound&&(this.pushAccessUnit(l,e),l=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts)),r.forEach(u=>{var f,g;switch(u.type){case 1:{let E=!1;c=!0;const T=u.data;if(d&&T.length>4){const A=this.readSliceType(T);(A===2||A===4||A===7||A===9)&&(E=!0)}if(E){var y;(y=l)!=null&&y.frame&&!l.key&&(this.pushAccessUnit(l,e),l=this.VideoSample=null)}l||(l=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),l.frame=!0,l.key=E;break}case 5:c=!0,(f=l)!=null&&f.frame&&!l.key&&(this.pushAccessUnit(l,e),l=this.VideoSample=null),l||(l=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),l.key=!0,l.frame=!0;break;case 6:{c=!0,jm(u.data,1,s.pts,t.samples);break}case 7:{var x,S;c=!0,d=!0;const E=u.data,T=this.readSPS(E);if(!e.sps||e.width!==T.width||e.height!==T.height||((x=e.pixelRatio)==null?void 0:x[0])!==T.pixelRatio[0]||((S=e.pixelRatio)==null?void 0:S[1])!==T.pixelRatio[1]){e.width=T.width,e.height=T.height,e.pixelRatio=T.pixelRatio,e.sps=[E];const A=E.subarray(1,4);let I="avc1.";for(let _=0;_<3;_++){let C=A[_].toString(16);C.length<2&&(C="0"+C),I+=C}e.codec=I}break}case 8:c=!0,e.pps=[u.data];break;case 9:c=!0,e.audFound=!0,(g=l)!=null&&g.frame&&(this.pushAccessUnit(l,e),l=null),l||(l=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts));break;case 12:c=!0;break;default:c=!1;break}l&&c&&l.units.push(u)}),n&&l&&(this.pushAccessUnit(l,e),this.VideoSample=null)}getNALuType(e,t){return e[t]&31}readSliceType(e){const t=new no(e);return t.readUByte(),t.readUEG(),t.readUEG()}skipScalingList(e,t){let s=8,n=8,r;for(let l=0;l<e;l++)n!==0&&(r=t.readEG(),n=(s+r+256)%256),s=n===0?s:n}readSPS(e){const t=new no(e);let s=0,n=0,r=0,l=0,c,d,u;const f=t.readUByte.bind(t),g=t.readBits.bind(t),y=t.readUEG.bind(t),x=t.readBoolean.bind(t),S=t.skipBits.bind(t),E=t.skipEG.bind(t),T=t.skipUEG.bind(t),A=this.skipScalingList.bind(this);f();const I=f();if(g(5),S(3),f(),T(),I===100||I===110||I===122||I===244||I===44||I===83||I===86||I===118||I===128){const F=y();if(F===3&&S(1),T(),T(),S(1),x())for(d=F!==3?8:12,u=0;u<d;u++)x()&&(u<6?A(16,t):A(64,t))}T();const _=y();if(_===0)y();else if(_===1)for(S(1),E(),E(),c=y(),u=0;u<c;u++)E();T(),S(1);const C=y(),k=y(),D=g(1);D===0&&S(1),S(1),x()&&(s=y(),n=y(),r=y(),l=y());let O=[1,1];if(x()&&x())switch(f()){case 1:O=[1,1];break;case 2:O=[12,11];break;case 3:O=[10,11];break;case 4:O=[16,11];break;case 5:O=[40,33];break;case 6:O=[24,11];break;case 7:O=[20,11];break;case 8:O=[32,11];break;case 9:O=[80,33];break;case 10:O=[18,11];break;case 11:O=[15,11];break;case 12:O=[64,33];break;case 13:O=[160,99];break;case 14:O=[4,3];break;case 15:O=[3,2];break;case 16:O=[2,1];break;case 255:{O=[f()<<8|f(),f()<<8|f()];break}}return{width:Math.ceil((C+1)*16-s*2-n*2),height:(2-D)*(k+1)*16-(D?2:4)*(r+l),pixelRatio:O}}}class JC extends Vb{constructor(...e){super(...e),this.initVPS=null}parsePES(e,t,s,n){const r=this.parseNALu(e,s.data,n);let l=this.VideoSample,c,d=!1;s.data=null,l&&r.length&&!e.audFound&&(this.pushAccessUnit(l,e),l=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts)),r.forEach(u=>{var f,g;switch(u.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:l||(l=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts)),l.frame=!0,c=!0;break;case 16:case 17:case 18:case 21:if(c=!0,d){var y;(y=l)!=null&&y.frame&&!l.key&&(this.pushAccessUnit(l,e),l=this.VideoSample=null)}l||(l=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),l.key=!0,l.frame=!0;break;case 19:case 20:c=!0,(f=l)!=null&&f.frame&&!l.key&&(this.pushAccessUnit(l,e),l=this.VideoSample=null),l||(l=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),l.key=!0,l.frame=!0;break;case 39:c=!0,jm(u.data,2,s.pts,t.samples);break;case 32:c=!0,e.vps||(typeof e.params!="object"&&(e.params={}),e.params=Ot(e.params,this.readVPS(u.data)),this.initVPS=u.data),e.vps=[u.data];break;case 33:if(c=!0,d=!0,e.vps!==void 0&&e.vps[0]!==this.initVPS&&e.sps!==void 0&&!this.matchSPS(e.sps[0],u.data)&&(this.initVPS=e.vps[0],e.sps=e.pps=void 0),!e.sps){const x=this.readSPS(u.data);e.width=x.width,e.height=x.height,e.pixelRatio=x.pixelRatio,e.codec=x.codecString,e.sps=[],typeof e.params!="object"&&(e.params={});for(const S in x.params)e.params[S]=x.params[S]}this.pushParameterSet(e.sps,u.data,e.vps),l||(l=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),l.key=!0;break;case 34:if(c=!0,typeof e.params=="object"){if(!e.pps){e.pps=[];const x=this.readPPS(u.data);for(const S in x)e.params[S]=x[S]}this.pushParameterSet(e.pps,u.data,e.vps)}break;case 35:c=!0,e.audFound=!0,(g=l)!=null&&g.frame&&(this.pushAccessUnit(l,e),l=null),l||(l=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts));break;default:c=!1;break}l&&c&&l.units.push(u)}),n&&l&&(this.pushAccessUnit(l,e),this.VideoSample=null)}pushParameterSet(e,t,s){(s&&s[0]===this.initVPS||!s&&!e.length)&&e.push(t)}getNALuType(e,t){return(e[t]&126)>>>1}ebsp2rbsp(e){const t=new Uint8Array(e.byteLength);let s=0;for(let n=0;n<e.byteLength;n++)n>=2&&e[n]===3&&e[n-1]===0&&e[n-2]===0||(t[s]=e[n],s++);return new Uint8Array(t.buffer,0,s)}pushAccessUnit(e,t){super.pushAccessUnit(e,t),this.initVPS&&(this.initVPS=null)}readVPS(e){const t=new no(e);t.readUByte(),t.readUByte(),t.readBits(4),t.skipBits(2),t.readBits(6);const s=t.readBits(3),n=t.readBoolean();return{numTemporalLayers:s+1,temporalIdNested:n}}readSPS(e){const t=new no(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.readBits(4);const s=t.readBits(3);t.readBoolean();const n=t.readBits(2),r=t.readBoolean(),l=t.readBits(5),c=t.readUByte(),d=t.readUByte(),u=t.readUByte(),f=t.readUByte(),g=t.readUByte(),y=t.readUByte(),x=t.readUByte(),S=t.readUByte(),E=t.readUByte(),T=t.readUByte(),A=t.readUByte(),I=[],_=[];for(let Fe=0;Fe<s;Fe++)I.push(t.readBoolean()),_.push(t.readBoolean());if(s>0)for(let Fe=s;Fe<8;Fe++)t.readBits(2);for(let Fe=0;Fe<s;Fe++)I[Fe]&&(t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte()),_[Fe]&&t.readUByte();t.readUEG();const C=t.readUEG();C==3&&t.skipBits(1);const k=t.readUEG(),D=t.readUEG(),O=t.readBoolean();let F=0,j=0,U=0,K=0;O&&(F+=t.readUEG(),j+=t.readUEG(),U+=t.readUEG(),K+=t.readUEG());const H=t.readUEG(),ee=t.readUEG(),re=t.readUEG(),de=t.readBoolean();for(let Fe=de?0:s;Fe<=s;Fe++)t.skipUEG(),t.skipUEG(),t.skipUEG();if(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.readBoolean()&&t.readBoolean())for(let we=0;we<4;we++)for(let Ue=0;Ue<(we===3?2:6);Ue++)if(!t.readBoolean())t.readUEG();else{const dt=Math.min(64,1<<4+(we<<1));we>1&&t.readEG();for(let Ce=0;Ce<dt;Ce++)t.readEG()}t.readBoolean(),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.skipUEG(),t.skipUEG(),t.readBoolean());const q=t.readUEG();let ae=0;for(let Fe=0;Fe<q;Fe++){let we=!1;if(Fe!==0&&(we=t.readBoolean()),we){Fe===q&&t.readUEG(),t.readBoolean(),t.readUEG();let Ue=0;for(let qe=0;qe<=ae;qe++){const dt=t.readBoolean();let Ce=!1;dt||(Ce=t.readBoolean()),(dt||Ce)&&Ue++}ae=Ue}else{const Ue=t.readUEG(),qe=t.readUEG();ae=Ue+qe;for(let dt=0;dt<Ue;dt++)t.readUEG(),t.readBoolean();for(let dt=0;dt<qe;dt++)t.readUEG(),t.readBoolean()}}if(t.readBoolean()){const Fe=t.readUEG();for(let we=0;we<Fe;we++){for(let Ue=0;Ue<re+4;Ue++)t.readBits(1);t.readBits(1)}}let P=0,$=1,G=1,fe=!0,ge=1,_e=0;t.readBoolean(),t.readBoolean();let Ne=!1;if(t.readBoolean()){if(t.readBoolean()){const He=t.readUByte(),Tt=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],rt=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];He>0&&He<16?($=Tt[He-1],G=rt[He-1]):He===255&&($=t.readBits(16),G=t.readBits(16))}if(t.readBoolean()&&t.readBoolean(),t.readBoolean()&&(t.readBits(3),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.readUByte(),t.readUByte())),t.readBoolean()&&(t.readUEG(),t.readUEG()),t.readBoolean(),t.readBoolean(),t.readBoolean(),Ne=t.readBoolean(),Ne&&(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG()),t.readBoolean()&&(ge=t.readBits(32),_e=t.readBits(32),t.readBoolean()&&t.readUEG(),t.readBoolean())){const rt=t.readBoolean(),Kt=t.readBoolean();let ye=!1;(rt||Kt)&&(ye=t.readBoolean(),ye&&(t.readUByte(),t.readBits(5),t.readBoolean(),t.readBits(5)),t.readBits(4),t.readBits(4),ye&&t.readBits(4),t.readBits(5),t.readBits(5),t.readBits(5));for(let We=0;We<=s;We++){fe=t.readBoolean();const it=fe||t.readBoolean();let ls=!1;it?t.readEG():ls=t.readBoolean();const Ns=ls?1:t.readUEG()+1;if(rt)for(let os=0;os<Ns;os++)t.readUEG(),t.readUEG(),ye&&(t.readUEG(),t.readUEG()),t.skipBits(1);if(Kt)for(let os=0;os<Ns;os++)t.readUEG(),t.readUEG(),ye&&(t.readUEG(),t.readUEG()),t.skipBits(1)}}t.readBoolean()&&(t.readBoolean(),t.readBoolean(),t.readBoolean(),P=t.readUEG())}let Be=k,pt=D;if(O){let Fe=1,we=1;C===1?Fe=we=2:C==2&&(Fe=2),Be=k-Fe*j-Fe*F,pt=D-we*K-we*U}const At=n?["A","B","C"][n]:"",Vt=c<<24|d<<16|u<<8|f;let bt=0;for(let Fe=0;Fe<32;Fe++)bt=(bt|(Vt>>Fe&1)<<31-Fe)>>>0;let gt=bt.toString(16);return l===1&&gt==="2"&&(gt="6"),{codecString:`hvc1.${At}${l}.${gt}.${r?"H":"L"}${A}.B0`,params:{general_tier_flag:r,general_profile_idc:l,general_profile_space:n,general_profile_compatibility_flags:[c,d,u,f],general_constraint_indicator_flags:[g,y,x,S,E,T],general_level_idc:A,bit_depth:H+8,bit_depth_luma_minus8:H,bit_depth_chroma_minus8:ee,min_spatial_segmentation_idc:P,chroma_format_idc:C,frame_rate:{fixed:fe,fps:_e/ge}},width:Be,height:pt,pixelRatio:[$,G]}}readPPS(e){const t=new no(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.skipUEG(),t.skipUEG(),t.skipBits(2),t.skipBits(3),t.skipBits(2),t.skipUEG(),t.skipUEG(),t.skipEG(),t.skipBits(2),t.readBoolean()&&t.skipUEG(),t.skipEG(),t.skipEG(),t.skipBits(4);const n=t.readBoolean(),r=t.readBoolean();let l=1;return r&&n?l=0:r?l=3:n&&(l=2),{parallelismType:l}}matchSPS(e,t){return String.fromCharCode.apply(null,e).substr(3)===String.fromCharCode.apply(null,t).substr(3)}}const bs=188;class Ea{constructor(e,t,s,n){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=t,this.typeSupported=s,this.logger=n,this.videoParser=null}static probe(e,t){const s=Ea.syncOffset(e);return s>0&&t.warn(`MPEG2-TS detected but first sync word found @ offset ${s}`),s!==-1}static syncOffset(e){const t=e.length;let s=Math.min(bs*5,t-bs)+1,n=0;for(;n<s;){let r=!1,l=-1,c=0;for(let d=n;d<t;d+=bs)if(e[d]===71&&(t-d===bs||e[d+bs]===71)){if(c++,l===-1&&(l=d,l!==0&&(s=Math.min(l+bs*99,e.length-bs)+1)),r||(r=om(e,d)===0),r&&c>1&&(l===0&&c>2||d+bs>s))return l}else{if(c)return-1;break}n++}return-1}static createTrack(e,t){return{container:e==="video"||e==="audio"?"video/mp2t":void 0,type:e,id:YS[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:e==="audio"?t:void 0}}resetInitSegment(e,t,s,n){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=Ea.createTrack("video"),this._videoTrack.duration=n,this._audioTrack=Ea.createTrack("audio",n),this._id3Track=Ea.createTrack("id3"),this._txtTrack=Ea.createTrack("text"),this._audioTrack.segmentCodec="aac",this.videoParser=null,this.aacOverFlow=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=s}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_videoTrack:t,_id3Track:s}=this;e&&(e.pesData=null),t&&(t.pesData=null),s&&(s.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,t,s=!1,n=!1){s||(this.sampleAes=null);let r;const l=this._videoTrack,c=this._audioTrack,d=this._id3Track,u=this._txtTrack;let f=l.pid,g=l.pesData,y=c.pid,x=d.pid,S=c.pesData,E=d.pesData,T=null,A=this.pmtParsed,I=this._pmtId,_=e.length;if(this.remainderData&&(e=Fi(this.remainderData,e),_=e.length,this.remainderData=null),_<bs&&!n)return this.remainderData=e,{audioTrack:c,videoTrack:l,id3Track:d,textTrack:u};const C=Math.max(0,Ea.syncOffset(e));_-=(_-C)%bs,_<e.byteLength&&!n&&(this.remainderData=new Uint8Array(e.buffer,_,e.buffer.byteLength-_));let k=0;for(let O=C;O<_;O+=bs)if(e[O]===71){const F=!!(e[O+1]&64),j=om(e,O),U=(e[O+3]&48)>>4;let K;if(U>1){if(K=O+5+e[O+4],K===O+bs)continue}else K=O+4;switch(j){case f:F&&(g&&(r=Vr(g,this.logger))&&(this.readyVideoParser(l.segmentCodec),this.videoParser!==null&&this.videoParser.parsePES(l,u,r,!1)),g={data:[],size:0}),g&&(g.data.push(e.subarray(K,O+bs)),g.size+=O+bs-K);break;case y:if(F){if(S&&(r=Vr(S,this.logger)))switch(c.segmentCodec){case"aac":this.parseAACPES(c,r);break;case"mp3":this.parseMPEGPES(c,r);break;case"ac3":this.parseAC3PES(c,r);break}S={data:[],size:0}}S&&(S.data.push(e.subarray(K,O+bs)),S.size+=O+bs-K);break;case x:F&&(E&&(r=Vr(E,this.logger))&&this.parseID3PES(d,r),E={data:[],size:0}),E&&(E.data.push(e.subarray(K,O+bs)),E.size+=O+bs-K);break;case 0:F&&(K+=e[K]+1),I=this._pmtId=ek(e,K);break;case I:{F&&(K+=e[K]+1);const H=tk(e,K,this.typeSupported,s,this.observer,this.logger);f=H.videoPid,f>0&&(l.pid=f,l.segmentCodec=H.segmentVideoCodec),y=H.audioPid,y>0&&(c.pid=y,c.segmentCodec=H.segmentAudioCodec),x=H.id3Pid,x>0&&(d.pid=x),T!==null&&!A&&(this.logger.warn(`MPEG-TS PMT found at ${O} after unknown PID '${T}'. Backtracking to sync byte @${C} to parse all TS packets.`),T=null,O=C-188),A=this.pmtParsed=!0;break}case 17:case 8191:break;default:T=j;break}}else k++;k>0&&cm(this.observer,new Error(`Found ${k} TS packet/s that do not start with 0x47`),void 0,this.logger),l.pesData=g,c.pesData=S,d.pesData=E;const D={audioTrack:c,videoTrack:l,id3Track:d,textTrack:u};return n&&this.extractRemainingSamples(D),D}flush(){const{remainderData:e}=this;this.remainderData=null;let t;return e?t=this.demux(e,-1,!1,!0):t={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){const{audioTrack:t,videoTrack:s,id3Track:n,textTrack:r}=e,l=s.pesData,c=t.pesData,d=n.pesData;let u;if(l&&(u=Vr(l,this.logger))?(this.readyVideoParser(s.segmentCodec),this.videoParser!==null&&(this.videoParser.parsePES(s,r,u,!0),s.pesData=null)):s.pesData=l,c&&(u=Vr(c,this.logger))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,u);break;case"mp3":this.parseMPEGPES(t,u);break;case"ac3":this.parseAC3PES(t,u);break}t.pesData=null}else c!=null&&c.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=c;d&&(u=Vr(d,this.logger))?(this.parseID3PES(n,u),n.pesData=null):n.pesData=d}demuxSampleAes(e,t,s){const n=this.demux(e,s,!0,!this.config.progressive),r=this.sampleAes=new XC(this.observer,this.config,t);return this.decrypt(n,r)}readyVideoParser(e){this.videoParser===null&&(e==="avc"?this.videoParser=new ZC:e==="hevc"&&(this.videoParser=new JC))}decrypt(e,t){return new Promise(s=>{const{audioTrack:n,videoTrack:r}=e;n.samples&&n.segmentCodec==="aac"?t.decryptAacSamples(n.samples,0,()=>{r.samples?t.decryptAvcSamples(r.samples,0,0,()=>{s(e)}):s(e)}):r.samples&&t.decryptAvcSamples(r.samples,0,0,()=>{s(e)})})}destroy(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0}parseAACPES(e,t){let s=0;const n=this.aacOverFlow;let r=t.data;if(n){this.aacOverFlow=null;const g=n.missing,y=n.sample.unit.byteLength;if(g===-1)r=Fi(n.sample.unit,r);else{const x=y-g;n.sample.unit.set(r.subarray(0,g),x),e.samples.push(n.sample),s=n.missing}}let l,c;for(l=s,c=r.length;l<c-1&&!Ou(r,l);l++);if(l!==s){let g;const y=l<c-1;if(y?g=`AAC PES did not start with ADTS header,offset:${l}`:g="No ADTS header found in AAC PES",cm(this.observer,new Error(g),y,this.logger),!y)return}Cb(e,this.observer,r,l,this.audioCodec);let d;if(t.pts!==void 0)d=t.pts;else if(n){const g=kb(e.samplerate);d=n.sample.pts+g}else{this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}let u=0,f;for(;l<c;)if(f=Nb(e,r,l,d,u),l+=f.length,f.missing){this.aacOverFlow=f;break}else for(u++;l<c-1&&!Ou(r,l);l++);}parseMPEGPES(e,t){const s=t.data,n=s.length;let r=0,l=0;const c=t.pts;if(c===void 0){this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;l<n;)if(Mb(s,l)){const d=Pb(e,s,l,c,r);if(d)l+=d.length,r++;else break}else l++}parseAC3PES(e,t){{const s=t.data,n=t.pts;if(n===void 0){this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");return}const r=s.length;let l=0,c=0,d;for(;c<r&&(d=Bb(e,s,c,n,l++))>0;)c+=d}}parseID3PES(e,t){if(t.pts===void 0){this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}const s=Ot({},t,{type:this._videoTrack?vi.emsg:vi.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(s)}}function om(i,e){return((i[e+1]&31)<<8)+i[e+2]}function ek(i,e){return(i[e+10]&31)<<8|i[e+11]}function tk(i,e,t,s,n,r){const l={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},c=(i[e+1]&15)<<8|i[e+2],d=e+3+c-4,u=(i[e+10]&15)<<8|i[e+11];for(e+=12+u;e<d;){const f=om(i,e),g=(i[e+3]&15)<<8|i[e+4];switch(i[e]){case 207:if(!s){wf("ADTS AAC",r);break}case 15:l.audioPid===-1&&(l.audioPid=f);break;case 21:l.id3Pid===-1&&(l.id3Pid=f);break;case 219:if(!s){wf("H.264",r);break}case 27:l.videoPid===-1&&(l.videoPid=f);break;case 3:case 4:!t.mpeg&&!t.mp3?r.log("MPEG audio found, not supported in this browser"):l.audioPid===-1&&(l.audioPid=f,l.segmentAudioCodec="mp3");break;case 193:if(!s){wf("AC-3",r);break}case 129:t.ac3?l.audioPid===-1&&(l.audioPid=f,l.segmentAudioCodec="ac3"):r.log("AC-3 audio found, not supported in this browser");break;case 6:if(l.audioPid===-1&&g>0){let y=e+5,x=g;for(;x>2;){i[y]===106&&(t.ac3!==!0?r.log("AC-3 audio found, not supported in this browser for now"):(l.audioPid=f,l.segmentAudioCodec="ac3"));const E=i[y+1]+2;y+=E,x-=E}}break;case 194:case 135:return cm(n,new Error("Unsupported EC-3 in M2TS found"),void 0,r),l;case 36:l.videoPid===-1&&(l.videoPid=f,l.segmentVideoCodec="hevc",r.log("HEVC in M2TS found"));break}e+=g+5}return l}function cm(i,e,t,s){s.warn(`parsing error: ${e.message}`),i.emit(L.ERROR,L.ERROR,{type:je.MEDIA_ERROR,details:W.FRAG_PARSING_ERROR,fatal:!1,levelRetry:t,error:e,reason:e.message})}function wf(i,e){e.log(`${i} with AES-128-CBC encryption found in unencrypted stream`)}function Vr(i,e){let t=0,s,n,r,l,c;const d=i.data;if(!i||i.size===0)return null;for(;d[0].length<19&&d.length>1;)d[0]=Fi(d[0],d[1]),d.splice(1,1);if(s=d[0],(s[0]<<16)+(s[1]<<8)+s[2]===1){if(n=(s[4]<<8)+s[5],n&&n>i.size-6)return null;const f=s[7];f&192&&(l=(s[9]&14)*536870912+(s[10]&255)*4194304+(s[11]&254)*16384+(s[12]&255)*128+(s[13]&254)/2,f&64?(c=(s[14]&14)*536870912+(s[15]&255)*4194304+(s[16]&254)*16384+(s[17]&255)*128+(s[18]&254)/2,l-c>60*9e4&&(e.warn(`${Math.round((l-c)/9e4)}s delta between PTS and DTS, align them`),l=c)):c=l),r=s[8];let g=r+9;if(i.size<=g)return null;i.size-=g;const y=new Uint8Array(i.size);for(let x=0,S=d.length;x<S;x++){s=d[x];let E=s.byteLength;if(g)if(g>E){g-=E;continue}else s=s.subarray(g),E-=g,g=0;y.set(s,t),t+=E}return n&&(n-=r+3),{data:y,pts:l,dts:c,len:n}}return null}class sk{static getSilentFrame(e,t){switch(e){case"mp4a.40.2":if(t===1)return new Uint8Array([0,200,0,128,35,128]);if(t===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(t===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(t===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(t===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(t===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(t===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const Sa=Math.pow(2,32)-1;class Q{static init(){Q.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let e;for(e in Q.types)Q.types.hasOwnProperty(e)&&(Q.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),s=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);Q.HDLR_TYPES={video:t,audio:s};const n=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),r=new Uint8Array([0,0,0,0,0,0,0,0]);Q.STTS=Q.STSC=Q.STCO=r,Q.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),Q.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),Q.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),Q.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const l=new Uint8Array([105,115,111,109]),c=new Uint8Array([97,118,99,49]),d=new Uint8Array([0,0,0,1]);Q.FTYP=Q.box(Q.types.ftyp,l,d,l,c),Q.DINF=Q.box(Q.types.dinf,Q.box(Q.types.dref,n))}static box(e,...t){let s=8,n=t.length;const r=n;for(;n--;)s+=t[n].byteLength;const l=new Uint8Array(s);for(l[0]=s>>24&255,l[1]=s>>16&255,l[2]=s>>8&255,l[3]=s&255,l.set(e,4),n=0,s=8;n<r;n++)l.set(t[n],s),s+=t[n].byteLength;return l}static hdlr(e){return Q.box(Q.types.hdlr,Q.HDLR_TYPES[e])}static mdat(e){return Q.box(Q.types.mdat,e)}static mdhd(e,t){t*=e;const s=Math.floor(t/(Sa+1)),n=Math.floor(t%(Sa+1));return Q.box(Q.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,s>>24,s>>16&255,s>>8&255,s&255,n>>24,n>>16&255,n>>8&255,n&255,85,196,0,0]))}static mdia(e){return Q.box(Q.types.mdia,Q.mdhd(e.timescale||0,e.duration||0),Q.hdlr(e.type),Q.minf(e))}static mfhd(e){return Q.box(Q.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255]))}static minf(e){return e.type==="audio"?Q.box(Q.types.minf,Q.box(Q.types.smhd,Q.SMHD),Q.DINF,Q.stbl(e)):Q.box(Q.types.minf,Q.box(Q.types.vmhd,Q.VMHD),Q.DINF,Q.stbl(e))}static moof(e,t,s){return Q.box(Q.types.moof,Q.mfhd(e),Q.traf(s,t))}static moov(e){let t=e.length;const s=[];for(;t--;)s[t]=Q.trak(e[t]);return Q.box.apply(null,[Q.types.moov,Q.mvhd(e[0].timescale||0,e[0].duration||0)].concat(s).concat(Q.mvex(e)))}static mvex(e){let t=e.length;const s=[];for(;t--;)s[t]=Q.trex(e[t]);return Q.box.apply(null,[Q.types.mvex,...s])}static mvhd(e,t){t*=e;const s=Math.floor(t/(Sa+1)),n=Math.floor(t%(Sa+1)),r=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,s>>24,s>>16&255,s>>8&255,s&255,n>>24,n>>16&255,n>>8&255,n&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return Q.box(Q.types.mvhd,r)}static sdtp(e){const t=e.samples||[],s=new Uint8Array(4+t.length);let n,r;for(n=0;n<t.length;n++)r=t[n].flags,s[n+4]=r.dependsOn<<4|r.isDependedOn<<2|r.hasRedundancy;return Q.box(Q.types.sdtp,s)}static stbl(e){return Q.box(Q.types.stbl,Q.stsd(e),Q.box(Q.types.stts,Q.STTS),Q.box(Q.types.stsc,Q.STSC),Q.box(Q.types.stsz,Q.STSZ),Q.box(Q.types.stco,Q.STCO))}static avc1(e){let t=[],s=[],n,r,l;for(n=0;n<e.sps.length;n++)r=e.sps[n],l=r.byteLength,t.push(l>>>8&255),t.push(l&255),t=t.concat(Array.prototype.slice.call(r));for(n=0;n<e.pps.length;n++)r=e.pps[n],l=r.byteLength,s.push(l>>>8&255),s.push(l&255),s=s.concat(Array.prototype.slice.call(r));const c=Q.box(Q.types.avcC,new Uint8Array([1,t[3],t[4],t[5],255,224|e.sps.length].concat(t).concat([e.pps.length]).concat(s))),d=e.width,u=e.height,f=e.pixelRatio[0],g=e.pixelRatio[1];return Q.box(Q.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,d>>8&255,d&255,u>>8&255,u&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),c,Q.box(Q.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),Q.box(Q.types.pasp,new Uint8Array([f>>24,f>>16&255,f>>8&255,f&255,g>>24,g>>16&255,g>>8&255,g&255])))}static esds(e){const t=e.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2,...t,6,1,2])}static audioStsd(e){const t=e.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount||0,0,16,0,0,0,0,t>>8&255,t&255,0,0])}static mp4a(e){return Q.box(Q.types.mp4a,Q.audioStsd(e),Q.box(Q.types.esds,Q.esds(e)))}static mp3(e){return Q.box(Q.types[".mp3"],Q.audioStsd(e))}static ac3(e){return Q.box(Q.types["ac-3"],Q.audioStsd(e),Q.box(Q.types.dac3,e.config))}static stsd(e){const{segmentCodec:t}=e;if(e.type==="audio"){if(t==="aac")return Q.box(Q.types.stsd,Q.STSD,Q.mp4a(e));if(t==="ac3"&&e.config)return Q.box(Q.types.stsd,Q.STSD,Q.ac3(e));if(t==="mp3"&&e.codec==="mp3")return Q.box(Q.types.stsd,Q.STSD,Q.mp3(e))}else if(e.pps&&e.sps){if(t==="avc")return Q.box(Q.types.stsd,Q.STSD,Q.avc1(e));if(t==="hevc"&&e.vps)return Q.box(Q.types.stsd,Q.STSD,Q.hvc1(e))}else throw new Error("video track missing pps or sps");throw new Error(`unsupported ${e.type} segment codec (${t}/${e.codec})`)}static tkhd(e){const t=e.id,s=(e.duration||0)*(e.timescale||0),n=e.width||0,r=e.height||0,l=Math.floor(s/(Sa+1)),c=Math.floor(s%(Sa+1));return Q.box(Q.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,0,0,0,0,l>>24,l>>16&255,l>>8&255,l&255,c>>24,c>>16&255,c>>8&255,c&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,n>>8&255,n&255,0,0,r>>8&255,r&255,0,0]))}static traf(e,t){const s=Q.sdtp(e),n=e.id,r=Math.floor(t/(Sa+1)),l=Math.floor(t%(Sa+1));return Q.box(Q.types.traf,Q.box(Q.types.tfhd,new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,n&255])),Q.box(Q.types.tfdt,new Uint8Array([1,0,0,0,r>>24,r>>16&255,r>>8&255,r&255,l>>24,l>>16&255,l>>8&255,l&255])),Q.trun(e,s.length+16+20+8+16+8+8),s)}static trak(e){return e.duration=e.duration||4294967295,Q.box(Q.types.trak,Q.tkhd(e),Q.mdia(e))}static trex(e){const t=e.id;return Q.box(Q.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){const s=e.samples||[],n=s.length,r=12+16*n,l=new Uint8Array(r);let c,d,u,f,g,y;for(t+=8+r,l.set([e.type==="video"?1:0,0,15,1,n>>>24&255,n>>>16&255,n>>>8&255,n&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255],0),c=0;c<n;c++)d=s[c],u=d.duration,f=d.size,g=d.flags,y=d.cts,l.set([u>>>24&255,u>>>16&255,u>>>8&255,u&255,f>>>24&255,f>>>16&255,f>>>8&255,f&255,g.isLeading<<2|g.dependsOn,g.isDependedOn<<6|g.hasRedundancy<<4|g.paddingValue<<1|g.isNonSync,g.degradPrio&61440,g.degradPrio&15,y>>>24&255,y>>>16&255,y>>>8&255,y&255],12+16*c);return Q.box(Q.types.trun,l)}static initSegment(e){Q.types||Q.init();const t=Q.moov(e);return Fi(Q.FTYP,t)}static hvc1(e){const t=e.params,s=[e.vps,e.sps,e.pps],n=4,r=new Uint8Array([1,t.general_profile_space<<6|(t.general_tier_flag?32:0)|t.general_profile_idc,t.general_profile_compatibility_flags[0],t.general_profile_compatibility_flags[1],t.general_profile_compatibility_flags[2],t.general_profile_compatibility_flags[3],t.general_constraint_indicator_flags[0],t.general_constraint_indicator_flags[1],t.general_constraint_indicator_flags[2],t.general_constraint_indicator_flags[3],t.general_constraint_indicator_flags[4],t.general_constraint_indicator_flags[5],t.general_level_idc,240|t.min_spatial_segmentation_idc>>8,255&t.min_spatial_segmentation_idc,252|t.parallelismType,252|t.chroma_format_idc,248|t.bit_depth_luma_minus8,248|t.bit_depth_chroma_minus8,0,parseInt(t.frame_rate.fps),n-1|t.temporal_id_nested<<2|t.num_temporal_layers<<3|(t.frame_rate.fixed?64:0),s.length]);let l=r.length;for(let S=0;S<s.length;S+=1){l+=3;for(let E=0;E<s[S].length;E+=1)l+=2+s[S][E].length}const c=new Uint8Array(l);c.set(r,0),l=r.length;const d=s.length-1;for(let S=0;S<s.length;S+=1){c.set(new Uint8Array([32+S|(S===d?128:0),0,s[S].length]),l),l+=3;for(let E=0;E<s[S].length;E+=1)c.set(new Uint8Array([s[S][E].length>>8,s[S][E].length&255]),l),l+=2,c.set(s[S][E],l),l+=s[S][E].length}const u=Q.box(Q.types.hvcC,c),f=e.width,g=e.height,y=e.pixelRatio[0],x=e.pixelRatio[1];return Q.box(Q.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,f>>8&255,f&255,g>>8&255,g&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),u,Q.box(Q.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),Q.box(Q.types.pasp,new Uint8Array([y>>24,y>>16&255,y>>8&255,y&255,x>>24,x>>16&255,x>>8&255,x&255])))}}Q.types=void 0;Q.HDLR_TYPES=void 0;Q.STTS=void 0;Q.STSC=void 0;Q.STCO=void 0;Q.STSZ=void 0;Q.VMHD=void 0;Q.SMHD=void 0;Q.STSD=void 0;Q.FTYP=void 0;Q.DINF=void 0;const $b=9e4;function Jm(i,e,t=1,s=!1){const n=i*e*t;return s?Math.round(n):n}function ik(i,e,t=1,s=!1){return Jm(i,e,1/t,s)}function eo(i,e=!1){return Jm(i,1e3,1/$b,e)}function nk(i,e=1){return Jm(i,$b,1/e)}function vx(i){const{baseTime:e,timescale:t,trackId:s}=i;return`${e/t} (${e}/${t}) trackId: ${s}`}const ak=10*1e3,rk=1024,lk=1152,ok=1536;let $r=null,Cf=null;function xx(i,e,t,s){return{duration:e,size:t,cts:s,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:i?2:1,isNonSync:i?0:1}}}class hu extends Vi{constructor(e,t,s,n){if(super("mp4-remuxer",n),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextVideoTs=null,this.nextAudioTs=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=t,this.typeSupported=s,this.ISGenerated=!1,$r===null){const l=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);$r=l?parseInt(l[1]):0}if(Cf===null){const r=navigator.userAgent.match(/Safari\/(\d+)/i);Cf=r?parseInt(r[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){const t=this._initPTS;(!t||!e||e.trackId!==t.trackId||e.baseTime!==t.baseTime||e.timescale!==t.timescale)&&this.log(`Reset initPTS: ${t&&vx(t)} > ${e&&vx(e)}`),this._initPTS=this._initDTS=e}resetNextTimestamp(){this.log("reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){this.log("ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let t=!1;const s=e[0].pts,n=e.reduce((r,l)=>{let c=l.pts,d=c-r;return d<-4294967296&&(t=!0,c=yi(c,s),d=c-r),d>0?r:c},s);return t&&this.debug("PTS rollover detected"),n}remux(e,t,s,n,r,l,c,d){let u,f,g,y,x,S,E=r,T=r;const A=e.pid>-1,I=t.pid>-1,_=t.samples.length,C=e.samples.length>0,k=c&&_>0||_>1;if((!A||C)&&(!I||k)||this.ISGenerated||c){if(this.ISGenerated){var O,F,j,U;const re=this.videoTrackConfig;(re&&(t.width!==re.width||t.height!==re.height||((O=t.pixelRatio)==null?void 0:O[0])!==((F=re.pixelRatio)==null?void 0:F[0])||((j=t.pixelRatio)==null?void 0:j[1])!==((U=re.pixelRatio)==null?void 0:U[1]))||!re&&k||this.nextAudioTs===null&&C)&&this.resetInitSegment()}this.ISGenerated||(g=this.generateIS(e,t,r,l));const K=this.isVideoContiguous;let H=-1,ee;if(k&&(H=ck(t.samples),!K&&this.config.forceKeyFrameOnDiscontinuity))if(S=!0,H>0){this.warn(`Dropped ${H} out of ${_} video samples due to a missing keyframe`);const re=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(H),t.dropped+=H,T+=(t.samples[0].pts-re)/t.inputTimeScale,ee=T}else H===-1&&(this.warn(`No keyframe found out of ${_} video samples`),S=!1);if(this.ISGenerated){if(C&&k){const re=this.getVideoStartPts(t.samples),M=(yi(e.samples[0].pts,re)-re)/t.inputTimeScale;E+=Math.max(0,M),T+=Math.max(0,-M)}if(C){if(e.samplerate||(this.warn("regenerate InitSegment as audio detected"),g=this.generateIS(e,t,r,l)),f=this.remuxAudio(e,E,this.isAudioContiguous,l,I||k||d===De.AUDIO?T:void 0),k){const re=f?f.endPTS-f.startPTS:0;t.inputTimeScale||(this.warn("regenerate InitSegment as video detected"),g=this.generateIS(e,t,r,l)),u=this.remuxVideo(t,T,K,re)}}else k&&(u=this.remuxVideo(t,T,K,0));u&&(u.firstKeyFrame=H,u.independent=H!==-1,u.firstKeyFramePTS=ee)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(s.samples.length&&(x=Gb(s,r,this._initPTS,this._initDTS)),n.samples.length&&(y=Hb(n,r,this._initPTS))),{audio:f,video:u,initSegment:g,independent:S,text:y,id3:x}}computeInitPts(e,t,s,n){const r=Math.round(s*t);let l=yi(e,r);if(l<r+t)for(this.log(`Adjusting PTS for rollover in timeline near ${(r-l)/t} ${n}`);l<r+t;)l+=8589934592;return l-r}generateIS(e,t,s,n){const r=e.samples,l=t.samples,c=this.typeSupported,d={},u=this._initPTS;let f=!u||n,g="audio/mp4",y,x,S,E=-1;if(f&&(y=x=1/0),e.config&&r.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":c.mpeg?(g="audio/mpeg",e.codec=""):c.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3";break}d.audio={id:"audio",container:g,codec:e.codec,initSegment:e.segmentCodec==="mp3"&&c.mpeg?new Uint8Array(0):Q.initSegment([e]),metadata:{channelCount:e.channelCount}},f&&(E=e.id,S=e.inputTimeScale,!u||S!==u.timescale?y=x=this.computeInitPts(r[0].pts,S,s,"audio"):f=!1)}if(t.sps&&t.pps&&l.length){if(t.timescale=t.inputTimeScale,d.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:Q.initSegment([t]),metadata:{width:t.width,height:t.height}},f)if(E=t.id,S=t.inputTimeScale,!u||S!==u.timescale){const T=this.getVideoStartPts(l),A=yi(l[0].dts,T),I=this.computeInitPts(A,S,s,"video"),_=this.computeInitPts(T,S,s,"video");x=Math.min(x,I),y=Math.min(y,_)}else f=!1;this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(d).length)return this.ISGenerated=!0,f?(u&&this.warn(`Timestamps at playlist time: ${n?"":"~"}${s} ${y/S} != initPTS: ${u.baseTime/u.timescale} (${u.baseTime}/${u.timescale}) trackId: ${u.trackId}`),this.log(`Found initPTS at playlist time: ${s} offset: ${y/S} (${y}/${S}) trackId: ${E}`),this._initPTS={baseTime:y,timescale:S,trackId:E},this._initDTS={baseTime:x,timescale:S,trackId:E}):y=S=void 0,{tracks:d,initPTS:y,timescale:S,trackId:E}}remuxVideo(e,t,s,n){const r=e.inputTimeScale,l=e.samples,c=[],d=l.length,u=this._initPTS,f=u.baseTime*r/u.timescale;let g=this.nextVideoTs,y=8,x=this.videoSampleDuration,S,E,T=Number.POSITIVE_INFINITY,A=Number.NEGATIVE_INFINITY,I=!1;if(!s||g===null){const P=f+t*r,$=l[0].pts-yi(l[0].dts,l[0].pts);$r&&g!==null&&Math.abs(P-$-(g+f))<15e3?s=!0:g=P-$-f}const _=g+f;for(let P=0;P<d;P++){const $=l[P];$.pts=yi($.pts,_),$.dts=yi($.dts,_),$.dts<l[P>0?P-1:P].dts&&(I=!0)}I&&l.sort(function(P,$){const G=P.dts-$.dts,fe=P.pts-$.pts;return G||fe}),S=l[0].dts,E=l[l.length-1].dts;const C=E-S,k=C?Math.round(C/(d-1)):x||e.inputTimeScale/30;if(s){const P=S-_,$=P>k,G=P<-1;if(($||G)&&($?this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${eo(P,!0)} ms (${P}dts) hole between fragments detected at ${t.toFixed(3)}`):this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${eo(-P,!0)} ms (${P}dts) overlapping between fragments detected at ${t.toFixed(3)}`),!G||_>=l[0].pts||$r)){S=_;const fe=l[0].pts-P;if($)l[0].dts=S,l[0].pts=fe;else{let ge=!0;for(let _e=0;_e<l.length&&!(l[_e].dts>fe&&ge);_e++){const Ne=l[_e].pts;if(l[_e].dts-=P,l[_e].pts-=P,_e<l.length-1){const Ge=l[_e+1].pts,Be=l[_e].pts,pt=Ge<=Be,At=Ge<=Ne;ge=pt==At}}}this.log(`Video: Initial PTS/DTS adjusted: ${eo(fe,!0)}/${eo(S,!0)}, delta: ${eo(P,!0)} ms`)}}S=Math.max(0,S);let D=0,O=0,F=S;for(let P=0;P<d;P++){const $=l[P],G=$.units,fe=G.length;let ge=0;for(let _e=0;_e<fe;_e++)ge+=G[_e].data.length;O+=ge,D+=fe,$.length=ge,$.dts<F?($.dts=F,F+=k/4|0||1):F=$.dts,T=Math.min($.pts,T),A=Math.max($.pts,A)}E=l[d-1].dts;const j=O+4*D+8;let U;try{U=new Uint8Array(j)}catch(P){this.observer.emit(L.ERROR,L.ERROR,{type:je.MUX_ERROR,details:W.REMUX_ALLOC_ERROR,fatal:!1,error:P,bytes:j,reason:`fail allocating video mdat ${j}`});return}const K=new DataView(U.buffer);K.setUint32(0,j),U.set(Q.types.mdat,4);let H=!1,ee=Number.POSITIVE_INFINITY,re=Number.POSITIVE_INFINITY,de=Number.NEGATIVE_INFINITY,M=Number.NEGATIVE_INFINITY;for(let P=0;P<d;P++){const $=l[P],G=$.units;let fe=0;for(let Ne=0,Ge=G.length;Ne<Ge;Ne++){const Be=G[Ne],pt=Be.data,At=Be.data.byteLength;K.setUint32(y,At),y+=4,U.set(pt,y),y+=At,fe+=4+At}let ge;if(P<d-1)x=l[P+1].dts-$.dts,ge=l[P+1].pts-$.pts;else{const Ne=this.config,Ge=P>0?$.dts-l[P-1].dts:k;if(ge=P>0?$.pts-l[P-1].pts:k,Ne.stretchShortVideoTrack&&this.nextAudioTs!==null){const Be=Math.floor(Ne.maxBufferHole*r),pt=(n?T+n*r:this.nextAudioTs+f)-$.pts;pt>Be?(x=pt-Ge,x<0?x=Ge:H=!0,this.log(`It is approximately ${pt/90} ms to the next segment; using duration ${x/90} ms for the last video frame.`)):x=Ge}else x=Ge}const _e=Math.round($.pts-$.dts);ee=Math.min(ee,x),de=Math.max(de,x),re=Math.min(re,ge),M=Math.max(M,ge),c.push(xx($.key,x,fe,_e))}if(c.length){if($r){if($r<70){const P=c[0].flags;P.dependsOn=2,P.isNonSync=0}}else if(Cf&&M-re<de-ee&&k/de<.025&&c[0].cts===0){this.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let P=S;for(let $=0,G=c.length;$<G;$++){const fe=P+c[$].duration,ge=P+c[$].cts;if($<G-1){const _e=fe+c[$+1].cts;c[$].duration=_e-ge}else c[$].duration=$?c[$-1].duration:k;c[$].cts=0,P=fe}}}x=H||!x?k:x;const V=E+x;this.nextVideoTs=g=V-f,this.videoSampleDuration=x,this.isVideoContiguous=!0;const pe={data1:Q.moof(e.sequenceNumber++,S,Ot(e,{samples:c})),data2:U,startPTS:(T-f)/r,endPTS:(A+x-f)/r,startDTS:(S-f)/r,endDTS:g/r,type:"video",hasAudio:!1,hasVideo:!0,nb:c.length,dropped:e.dropped};return e.samples=[],e.dropped=0,pe}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return lk;case"ac3":return ok;default:return rk}}remuxAudio(e,t,s,n,r){const l=e.inputTimeScale,c=e.samplerate?e.samplerate:l,d=l/c,u=this.getSamplesPerFrame(e),f=u*d,g=this._initPTS,y=e.segmentCodec==="mp3"&&this.typeSupported.mpeg,x=[],S=r!==void 0;let E=e.samples,T=y?0:8,A=this.nextAudioTs||-1;const I=g.baseTime*l/g.timescale,_=I+t*l;if(this.isAudioContiguous=s=s||E.length&&A>0&&(n&&Math.abs(_-(A+I))<9e3||Math.abs(yi(E[0].pts,_)-(A+I))<20*f),E.forEach(function(M){M.pts=yi(M.pts,_)}),!s||A<0){const M=E.length;if(E=E.filter(V=>V.pts>=0),M!==E.length&&this.warn(`Removed ${E.length-M} of ${M} samples (initPTS ${I} / ${l})`),!E.length)return;r===0?A=0:n&&!S?A=Math.max(0,_-I):A=E[0].pts-I}if(e.segmentCodec==="aac"){const M=this.config.maxAudioFramesDrift;for(let V=0,q=A+I;V<E.length;V++){const ae=E[V],pe=ae.pts,P=pe-q,$=Math.abs(1e3*P/l);if(P<=-M*f&&S)V===0&&(this.warn(`Audio frame @ ${(pe/l).toFixed(3)}s overlaps marker by ${Math.round(1e3*P/l)} ms.`),this.nextAudioTs=A=pe-I,q=pe);else if(P>=M*f&&$<ak&&S){let G=Math.round(P/f);for(q=pe-G*f;q<0&&G&&f;)G--,q+=f;V===0&&(this.nextAudioTs=A=q-I),this.warn(`Injecting ${G} audio frames @ ${((q-I)/l).toFixed(3)}s due to ${Math.round(1e3*P/l)} ms gap.`);for(let fe=0;fe<G;fe++){let ge=sk.getSilentFrame(e.parsedCodec||e.manifestCodec||e.codec,e.channelCount);ge||(this.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),ge=ae.unit.subarray()),E.splice(V,0,{unit:ge,pts:q}),q+=f,V++}}ae.pts=q,q+=f}}let C=null,k=null,D,O=0,F=E.length;for(;F--;)O+=E[F].unit.byteLength;for(let M=0,V=E.length;M<V;M++){const q=E[M],ae=q.unit;let pe=q.pts;if(k!==null){const $=x[M-1];$.duration=Math.round((pe-k)/d)}else if(s&&e.segmentCodec==="aac"&&(pe=A+I),C=pe,O>0){O+=T;try{D=new Uint8Array(O)}catch($){this.observer.emit(L.ERROR,L.ERROR,{type:je.MUX_ERROR,details:W.REMUX_ALLOC_ERROR,fatal:!1,error:$,bytes:O,reason:`fail allocating audio mdat ${O}`});return}y||(new DataView(D.buffer).setUint32(0,O),D.set(Q.types.mdat,4))}else return;D.set(ae,T);const P=ae.byteLength;T+=P,x.push(xx(!0,u,P,0)),k=pe}const j=x.length;if(!j)return;const U=x[x.length-1];A=k-I,this.nextAudioTs=A+d*U.duration;const K=y?new Uint8Array(0):Q.moof(e.sequenceNumber++,C/d,Ot({},e,{samples:x}));e.samples=[];const H=(C-I)/l,ee=this.nextAudioTs/l,de={data1:K,data2:D,startPTS:H,endPTS:ee,startDTS:H,endDTS:ee,type:"audio",hasAudio:!0,hasVideo:!1,nb:j};return this.isAudioContiguous=!0,de}}function yi(i,e){let t;if(e===null)return i;for(e<i?t=-8589934592:t=8589934592;Math.abs(i-e)>4294967296;)i+=t;return i}function ck(i){for(let e=0;e<i.length;e++)if(i[e].key)return e;return-1}function Gb(i,e,t,s){const n=i.samples.length;if(!n)return;const r=i.inputTimeScale;for(let c=0;c<n;c++){const d=i.samples[c];d.pts=yi(d.pts-t.baseTime*r/t.timescale,e*r)/r,d.dts=yi(d.dts-s.baseTime*r/s.timescale,e*r)/r}const l=i.samples;return i.samples=[],{samples:l}}function Hb(i,e,t){const s=i.samples.length;if(!s)return;const n=i.inputTimeScale;for(let l=0;l<s;l++){const c=i.samples[l];c.pts=yi(c.pts-t.baseTime*n/t.timescale,e*n)/n}i.samples.sort((l,c)=>l.pts-c.pts);const r=i.samples;return i.samples=[],{samples:r}}class uk extends Vi{constructor(e,t,s,n){super("passthrough-remuxer",n),this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null,this.isVideoContiguous=!1}destroy(){}resetTimeStamp(e){this.lastEndTime=null;const t=this.initPTS;t&&e&&t.baseTime===e.baseTime&&t.timescale===e.timescale||(this.initPTS=e)}resetNextTimestamp(){this.isVideoContiguous=!1,this.lastEndTime=null}resetInitSegment(e,t,s,n){this.audioCodec=t,this.videoCodec=s,this.generateInitSegment(e,n),this.emitInitSegment=!0}generateInitSegment(e,t){let{audioCodec:s,videoCodec:n}=this;if(!(e!=null&&e.byteLength)){this.initTracks=void 0,this.initData=void 0;return}const{audio:r,video:l}=this.initData=WS(e);if(t)X1(e,t);else{const d=r||l;d!=null&&d.encrypted&&this.warn(`Init segment with encrypted track with has no key ("${d.codec}")!`)}r&&(s=Sx(r,Pt.AUDIO,this)),l&&(n=Sx(l,Pt.VIDEO,this));const c={};r&&l?c.audiovideo={container:"video/mp4",codec:s+","+n,supplemental:l.supplemental,encrypted:l.encrypted,initSegment:e,id:"main"}:r?c.audio={container:"audio/mp4",codec:s,encrypted:r.encrypted,initSegment:e,id:"audio"}:l?c.video={container:"video/mp4",codec:n,supplemental:l.supplemental,encrypted:l.encrypted,initSegment:e,id:"main"}:this.warn("initSegment does not contain moov or trak boxes."),this.initTracks=c}remux(e,t,s,n,r,l){var c,d;let{initPTS:u,lastEndTime:f}=this;const g={audio:void 0,video:void 0,text:n,id3:s,initSegment:void 0};ke(f)||(f=this.lastEndTime=r||0);const y=t.samples;if(!y.length)return g;const x={initPTS:void 0,timescale:void 0,trackId:void 0};let S=this.initData;if((c=S)!=null&&c.length||(this.generateInitSegment(y),S=this.initData),!((d=S)!=null&&d.length))return this.warn("Failed to generate initSegment."),g;this.emitInitSegment&&(x.tracks=this.initTracks,this.emitInitSegment=!1);const E=J1(y,S,this),T=S.audio?E[S.audio.id]:null,A=S.video?E[S.video.id]:null,I=qc(A,1/0),_=qc(T,1/0),C=qc(A,0,!0),k=qc(T,0,!0);let D=r,O=0;const F=T&&(!A||!u&&_<I||u&&u.trackId===S.audio.id),j=F?T:A;if(j){const q=j.timescale,ae=j.start-r*q,pe=F?S.audio.id:S.video.id;D=j.start/q,O=F?k-_:C-I,(l||!u)&&(dk(u,D,r,O)||q!==u.timescale)&&(u&&this.warn(`Timestamps at playlist time: ${l?"":"~"}${r} ${ae/q} != initPTS: ${u.baseTime/u.timescale} (${u.baseTime}/${u.timescale}) trackId: ${u.trackId}`),this.log(`Found initPTS at playlist time: ${r} offset: ${D-r} (${ae}/${q}) trackId: ${pe}`),u=null,x.initPTS=ae,x.timescale=q,x.trackId=pe)}else this.warn(`No audio or video samples found for initPTS at playlist time: ${r}`);u?(x.initPTS=u.baseTime,x.timescale=u.timescale,x.trackId=u.trackId):((!x.timescale||x.trackId===void 0||x.initPTS===void 0)&&(this.warn("Could not set initPTS"),x.initPTS=D,x.timescale=1,x.trackId=-1),this.initPTS=u={baseTime:x.initPTS,timescale:x.timescale,trackId:x.trackId});const U=D-u.baseTime/u.timescale,K=U+O;O>0?this.lastEndTime=K:(this.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const H=!!S.audio,ee=!!S.video;let re="";H&&(re+="audio"),ee&&(re+="video");const de=(S.audio?S.audio.encrypted:!1)||(S.video?S.video.encrypted:!1),M={data1:y,startPTS:U,startDTS:U,endPTS:K,endDTS:K,type:re,hasAudio:H,hasVideo:ee,nb:1,dropped:0,encrypted:de};g.audio=H&&!ee?M:void 0,g.video=ee?M:void 0;const V=A?.sampleCount;if(V){const q=A.keyFrameIndex,ae=q!==-1;M.nb=V,M.dropped=q===0||this.isVideoContiguous?0:ae?q:V,M.independent=ae,M.firstKeyFrame=q,ae&&A.keyFrameStart&&(M.firstKeyFramePTS=(A.keyFrameStart-u.baseTime)/u.timescale),this.isVideoContiguous||(g.independent=ae),this.isVideoContiguous||(this.isVideoContiguous=ae),M.dropped&&this.warn(`fmp4 does not start with IDR: firstIDR ${q}/${V} dropped: ${M.dropped} start: ${M.firstKeyFramePTS||"NA"}`)}return g.initSegment=x,g.id3=Gb(s,r,u,u),n.samples.length&&(g.text=Hb(n,r,u)),g}}function qc(i,e,t=!1){return i?.start!==void 0?(i.start+(t?i.duration:0))/i.timescale:e}function dk(i,e,t,s){if(i===null)return!0;const n=Math.max(s,1),r=e-i.baseTime/i.timescale;return Math.abs(r-t)>n}function Sx(i,e,t){const s=i.codec;return s&&s.length>4?s:e===Pt.AUDIO?s==="ec-3"||s==="ac-3"||s==="alac"?s:s==="fLaC"||s==="Opus"?_u(s,!1):(t.warn(`Unhandled audio codec "${s}" in mp4 MAP`),s||"mp4a"):(t.warn(`Unhandled video codec "${s}" in mp4 MAP`),s||"avc1")}let $n;try{$n=self.performance.now.bind(self.performance)}catch{$n=Date.now}const fu=[{demux:WC,remux:uk},{demux:Ea,remux:hu},{demux:KC,remux:hu},{demux:qC,remux:hu}];fu.splice(2,0,{demux:YC,remux:hu});class bx{constructor(e,t,s,n,r,l){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=s,this.id=r,this.logger=l}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,s,n){const r=s.transmuxing;r.executeStart=$n();let l=new Uint8Array(e);const{currentTransmuxState:c,transmuxConfig:d}=this;n&&(this.currentTransmuxState=n);const{contiguous:u,discontinuity:f,trackSwitch:g,accurateTimeOffset:y,timeOffset:x,initSegmentChange:S}=n||c,{audioCodec:E,videoCodec:T,defaultInitPts:A,duration:I,initSegmentData:_}=d,C=hk(l,t);if(C&&Yr(C.method)){const F=this.getDecrypter(),j=Hm(C.method);if(F.isSync()){let U=F.softwareDecrypt(l,C.key.buffer,C.iv.buffer,j);if(s.part>-1){const H=F.flush();U=H&&H.buffer}if(!U)return r.executeEnd=$n(),kf(s);l=new Uint8Array(U)}else return this.asyncResult=!0,this.decryptionPromise=F.webCryptoDecrypt(l,C.key.buffer,C.iv.buffer,j).then(U=>{const K=this.push(U,null,s);return this.decryptionPromise=null,K}),this.decryptionPromise}const k=this.needsProbing(f,g);if(k){const F=this.configureTransmuxer(l);if(F)return this.logger.warn(`[transmuxer] ${F.message}`),this.observer.emit(L.ERROR,L.ERROR,{type:je.MEDIA_ERROR,details:W.FRAG_PARSING_ERROR,fatal:!1,error:F,reason:F.message}),r.executeEnd=$n(),kf(s)}(f||g||S||k)&&this.resetInitSegment(_,E,T,I,t),(f||S||k)&&this.resetInitialTimestamp(A),u||this.resetContiguity();const D=this.transmux(l,C,x,y,s);this.asyncResult=fo(D);const O=this.currentTransmuxState;return O.contiguous=!0,O.discontinuity=!1,O.trackSwitch=!1,r.executeEnd=$n(),D}flush(e){const t=e.transmuxing;t.executeStart=$n();const{decrypter:s,currentTransmuxState:n,decryptionPromise:r}=this;if(r)return this.asyncResult=!0,r.then(()=>this.flush(e));const l=[],{timeOffset:c}=n;if(s){const g=s.flush();g&&l.push(this.push(g.buffer,null,e))}const{demuxer:d,remuxer:u}=this;if(!d||!u){t.executeEnd=$n();const g=[kf(e)];return this.asyncResult?Promise.resolve(g):g}const f=d.flush(c);return fo(f)?(this.asyncResult=!0,f.then(g=>(this.flushRemux(l,g,e),l))):(this.flushRemux(l,f,e),this.asyncResult?Promise.resolve(l):l)}flushRemux(e,t,s){const{audioTrack:n,videoTrack:r,id3Track:l,textTrack:c}=t,{accurateTimeOffset:d,timeOffset:u}=this.currentTransmuxState;this.logger.log(`[transmuxer.ts]: Flushed ${this.id} sn: ${s.sn}${s.part>-1?" part: "+s.part:""} of ${this.id===De.MAIN?"level":"track"} ${s.level}`);const f=this.remuxer.remux(n,r,l,c,u,d,!0,this.id);e.push({remuxResult:f,chunkMeta:s}),s.transmuxing.executeEnd=$n()}resetInitialTimestamp(e){const{demuxer:t,remuxer:s}=this;!t||!s||(t.resetTimeStamp(e),s.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:t}=this;!e||!t||(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,s,n,r){const{demuxer:l,remuxer:c}=this;!l||!c||(l.resetInitSegment(e,t,s,n),c.resetInitSegment(e,t,s,r))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,s,n,r){let l;return t&&t.method==="SAMPLE-AES"?l=this.transmuxSampleAes(e,t,s,n,r):l=this.transmuxUnencrypted(e,s,n,r),l}transmuxUnencrypted(e,t,s,n){const{audioTrack:r,videoTrack:l,id3Track:c,textTrack:d}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(r,l,c,d,t,s,!1,this.id),chunkMeta:n}}transmuxSampleAes(e,t,s,n,r){return this.demuxer.demuxSampleAes(e,t,s).then(l=>({remuxResult:this.remuxer.remux(l.audioTrack,l.videoTrack,l.id3Track,l.textTrack,s,n,!1,this.id),chunkMeta:r}))}configureTransmuxer(e){const{config:t,observer:s,typeSupported:n}=this;let r;for(let g=0,y=fu.length;g<y;g++){var l;if((l=fu[g].demux)!=null&&l.probe(e,this.logger)){r=fu[g];break}}if(!r)return new Error("Failed to find demuxer by probing fragment data");const c=this.demuxer,d=this.remuxer,u=r.remux,f=r.demux;(!d||!(d instanceof u))&&(this.remuxer=new u(s,t,n,this.logger)),(!c||!(c instanceof f))&&(this.demuxer=new f(s,t,n,this.logger),this.probe=f.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new $m(this.config)),e}}function hk(i,e){let t=null;return i.byteLength>0&&e?.key!=null&&e.iv!==null&&e.method!=null&&(t=e),t}const kf=i=>({remuxResult:{},chunkMeta:i});function fo(i){return"then"in i&&i.then instanceof Function}class fk{constructor(e,t,s,n,r){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=s,this.duration=n,this.defaultInitPts=r||null}}class mk{constructor(e,t,s,n,r,l){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=s,this.trackSwitch=n,this.timeOffset=r,this.initSegmentChange=l}}let Tx=0;class zb{constructor(e,t,s,n){this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=Tx++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=d=>{const u=d.data,f=this.hls;if(!(!f||!(u!=null&&u.event)||u.instanceNo!==this.instanceNo))switch(u.event){case"init":{var g;const y=(g=this.workerContext)==null?void 0:g.objectURL;y&&self.URL.revokeObjectURL(y);break}case"transmuxComplete":{this.handleTransmuxComplete(u.data);break}case"flush":{this.onFlush(u.data);break}case"workerLog":{f.logger[u.data.logType]&&f.logger[u.data.logType](u.data.message);break}default:{u.data=u.data||{},u.data.frag=this.frag,u.data.part=this.part,u.data.id=this.id,f.trigger(u.event,u.data);break}}},this.onWorkerError=d=>{if(!this.hls)return;const u=new Error(`${d.message}  (${d.filename}:${d.lineno})`);this.hls.config.enableWorker=!1,this.hls.logger.warn(`Error in "${this.id}" Web Worker, fallback to inline`),this.hls.trigger(L.ERROR,{type:je.OTHER_ERROR,details:W.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:u})};const r=e.config;this.hls=e,this.id=t,this.useWorker=!!r.enableWorker,this.onTransmuxComplete=s,this.onFlush=n;const l=(d,u)=>{u=u||{},u.frag=this.frag||void 0,d===L.ERROR&&(u=u,u.parent=this.id,u.part=this.part,this.error=u.error),this.hls.trigger(d,u)};this.observer=new Ym,this.observer.on(L.FRAG_DECRYPTED,l),this.observer.on(L.ERROR,l);const c=Mv(r.preferManagedMediaSource);if(this.useWorker&&typeof Worker<"u"){const d=this.hls.logger;if(r.workerPath||vC()){try{r.workerPath?(d.log(`loading Web Worker ${r.workerPath} for "${t}"`),this.workerContext=SC(r.workerPath)):(d.log(`injecting Web Worker for "${t}"`),this.workerContext=xC());const{worker:f}=this.workerContext;f.addEventListener("message",this.onWorkerMessage),f.addEventListener("error",this.onWorkerError),f.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:c,id:t,config:Ut(r)})}catch(f){d.warn(`Error setting up "${t}" Web Worker, fallback to inline`,f),this.terminateWorker(),this.error=null,this.transmuxer=new bx(this.observer,c,r,"",t,e.logger)}return}}this.transmuxer=new bx(this.observer,c,r,"",t,e.logger)}reset(){if(this.frag=null,this.part=null,this.workerContext){const e=this.instanceNo;this.instanceNo=Tx++;const t=this.hls.config,s=Mv(t.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:e,typeSupported:s,id:this.id,config:Ut(t)})}}terminateWorker(){if(this.workerContext){const{worker:e}=this.workerContext;this.workerContext=null,e.removeEventListener("message",this.onWorkerMessage),e.removeEventListener("error",this.onWorkerError),bC(this.hls.config.workerPath)}}destroy(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{const t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null}push(e,t,s,n,r,l,c,d,u,f){var g,y;u.transmuxing.start=self.performance.now();const{instanceNo:x,transmuxer:S}=this,E=l?l.start:r.start,T=r.decryptdata,A=this.frag,I=!(A&&r.cc===A.cc),_=!(A&&u.level===A.level),C=A?u.sn-A.sn:-1,k=this.part?u.part-this.part.index:-1,D=C===0&&u.id>1&&u.id===A?.stats.chunkCount,O=!_&&(C===1||C===0&&(k===1||D&&k<=0)),F=self.performance.now();(_||C||r.stats.parsing.start===0)&&(r.stats.parsing.start=F),l&&(k||!O)&&(l.stats.parsing.start=F);const j=!(A&&((g=r.initSegment)==null?void 0:g.url)===((y=A.initSegment)==null?void 0:y.url)),U=new mk(I,O,d,_,E,j);if(!O||I||j){this.hls.logger.log(`[transmuxer-interface]: Starting new transmux session for ${r.type} sn: ${u.sn}${u.part>-1?" part: "+u.part:""} ${this.id===De.MAIN?"level":"track"}: ${u.level} id: ${u.id}
        discontinuity: ${I}
        trackSwitch: ${_}
        contiguous: ${O}
        accurateTimeOffset: ${d}
        timeOffset: ${E}
        initSegmentChange: ${j}`);const K=new fk(s,n,t,c,f);this.configureTransmuxer(K)}if(this.frag=r,this.part=l,this.workerContext)this.workerContext.worker.postMessage({instanceNo:x,cmd:"demux",data:e,decryptdata:T,chunkMeta:u,state:U},e instanceof ArrayBuffer?[e]:[]);else if(S){const K=S.push(e,T,u,U);fo(K)?K.then(H=>{this.handleTransmuxComplete(H)}).catch(H=>{this.transmuxerError(H,u,"transmuxer-interface push error")}):this.handleTransmuxComplete(K)}}flush(e){e.transmuxing.start=self.performance.now();const{instanceNo:t,transmuxer:s}=this;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:t,cmd:"flush",chunkMeta:e});else if(s){const n=s.flush(e);fo(n)?n.then(r=>{this.handleFlushResult(r,e)}).catch(r=>{this.transmuxerError(r,e,"transmuxer-interface flush error")}):this.handleFlushResult(n,e)}}transmuxerError(e,t,s){this.hls&&(this.error=e,this.hls.trigger(L.ERROR,{type:je.MEDIA_ERROR,details:W.FRAG_PARSING_ERROR,chunkMeta:t,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:e,err:e,reason:s}))}handleFlushResult(e,t){e.forEach(s=>{this.handleTransmuxComplete(s)}),this.onFlush(t)}configureTransmuxer(e){const{instanceNo:t,transmuxer:s}=this;this.workerContext?this.workerContext.worker.postMessage({instanceNo:t,cmd:"configure",config:e}):s&&s.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}const Ex=100;class pk extends Km{constructor(e,t,s){super(e,t,s,"audio-stream-controller",De.AUDIO),this.mainAnchor=null,this.mainFragLoading=null,this.audioOnly=!1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.resetItem()}resetItem(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(L.LEVEL_LOADED,this.onLevelLoaded,this),e.on(L.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(L.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(L.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(L.BUFFER_RESET,this.onBufferReset,this),e.on(L.BUFFER_CREATED,this.onBufferCreated,this),e.on(L.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(L.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(L.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(L.FRAG_LOADING,this.onFragLoading,this),e.on(L.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){const{hls:e}=this;e&&(super.unregisterListeners(),e.off(L.LEVEL_LOADED,this.onLevelLoaded,this),e.off(L.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(L.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(L.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(L.BUFFER_RESET,this.onBufferReset,this),e.off(L.BUFFER_CREATED,this.onBufferCreated,this),e.off(L.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(L.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(L.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(L.FRAG_LOADING,this.onFragLoading,this),e.off(L.FRAG_BUFFERED,this.onFragBuffered,this))}onInitPtsFound(e,{frag:t,id:s,initPTS:n,timescale:r,trackId:l}){if(s===De.MAIN){const c=t.cc,d=this.fragCurrent;if(this.initPTS[c]={baseTime:n,timescale:r,trackId:l},this.log(`InitPTS for cc: ${c} found from main: ${n/r} (${n}/${r}) trackId: ${l}`),this.mainAnchor=t,this.state===ue.WAITING_INIT_PTS){const u=this.waitingData;(!u&&!this.loadingParts||u&&u.frag.cc!==c)&&this.syncWithAnchor(t,u?.frag)}else!this.hls.hasEnoughToStart&&d&&d.cc!==c?(d.abortRequests(),this.syncWithAnchor(t,d)):this.state===ue.IDLE&&this.tick()}}getLoadPosition(){return!this.startFragRequested&&this.nextLoadPosition>=0?this.nextLoadPosition:super.getLoadPosition()}syncWithAnchor(e,t){var s;const n=((s=this.mainFragLoading)==null?void 0:s.frag)||null;if(t&&n?.cc===t.cc)return;const r=(n||e).cc,l=this.getLevelDetails(),c=this.getLoadPosition(),d=lb(l,r,c);d&&(this.log(`Syncing with main frag at ${d.start} cc ${d.cc}`),this.startFragRequested=!1,this.nextLoadPosition=d.start,this.resetLoadingState(),this.state===ue.IDLE&&this.doTickIdle())}startLoad(e,t){if(!this.levels){this.startPosition=e,this.state=ue.STOPPED;return}const s=this.lastCurrentTime;this.stopLoad(),this.setInterval(Ex),s>0&&e===-1?(this.log(`Override startPosition with lastCurrentTime @${s.toFixed(3)}`),e=s,this.state=ue.IDLE):this.state=ue.WAITING_TRACK,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}doTick(){switch(this.state){case ue.IDLE:this.doTickIdle();break;case ue.WAITING_TRACK:{const{levels:e,trackId:t}=this,s=e?.[t],n=s?.details;if(n&&!this.waitForLive(s)){if(this.waitForCdnTuneIn(n))break;this.state=ue.WAITING_INIT_PTS}break}case ue.FRAG_LOADING_WAITING_RETRY:{this.checkRetryDate();break}case ue.WAITING_INIT_PTS:{const e=this.waitingData;if(e){const{frag:t,part:s,cache:n,complete:r}=e,l=this.mainAnchor;if(this.initPTS[t.cc]!==void 0){this.waitingData=null,this.state=ue.FRAG_LOADING;const c=n.flush().buffer,d={frag:t,part:s,payload:c,networkDetails:null};this._handleFragmentLoadProgress(d),r&&super._handleFragmentLoadComplete(d)}else l&&l.cc!==e.frag.cc&&this.syncWithAnchor(l,e.frag)}else this.state=ue.IDLE}}this.onTickEnd()}resetLoadingState(){const e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null),super.resetLoadingState()}onTickEnd(){const{media:e}=this;e!=null&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){var e;const{hls:t,levels:s,media:n,trackId:r}=this,l=t.config;if(!this.buffering||!n&&!this.primaryPrefetch&&(this.startFragRequested||!l.startFragPrefetch)||!(s!=null&&s[r]))return;const c=s[r],d=c.details;if(!d||this.waitForLive(c)||this.waitForCdnTuneIn(d)){this.state=ue.WAITING_TRACK,this.startFragRequested=!1;return}const u=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&u&&(this.bufferFlushed=!1,this.afterBufferFlushed(u,Pt.AUDIO,De.AUDIO));const f=this.getFwdBufferInfo(u,De.AUDIO);if(f===null)return;if(!this.switchingTrack&&this._streamEnded(f,d)){t.trigger(L.BUFFER_EOS,{type:"audio"}),this.state=ue.ENDED;return}const g=f.len,y=t.maxBufferLength,x=d.fragments,S=x[0].start,E=this.getLoadPosition(),T=this.flushing?E:f.end;if(this.switchingTrack&&n){const _=E;d.PTSKnown&&_<S&&(f.end>S||f.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),n.currentTime=S+.05)}if(g>=y&&!this.switchingTrack&&T<x[x.length-1].start)return;let A=this.getNextFragment(T,d);if(A&&this.isLoopLoading(A,T)&&(A=this.getNextFragmentLoopLoading(A,d,f,De.MAIN,y)),!A){this.bufferFlushed=!0;return}let I=((e=this.mainFragLoading)==null?void 0:e.frag)||null;if(!this.audioOnly&&this.startFragRequested&&I&&rs(A)&&!A.endList&&(!d.live||!this.loadingParts&&T<this.hls.liveSyncPosition)&&(this.fragmentTracker.getState(I)===vs.OK&&(this.mainFragLoading=I=null),I&&rs(I))){if(A.start>I.end){const C=this.fragmentTracker.getFragAtPos(T,De.MAIN);C&&C.end>I.end&&(I=C,this.mainFragLoading={frag:C,targetBufferTime:null})}if(A.start>I.end)return}this.loadFragment(A,c,T)}onMediaDetaching(e,t){this.bufferFlushed=this.flushing=!1,super.onMediaDetaching(e,t)}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map(s=>new co(s))}onAudioTrackSwitching(e,t){const s=!!t.url;this.trackId=t.id;const{fragCurrent:n}=this;n&&(n.abortRequests(),this.removeUnbufferedFrags(n.start)),this.resetLoadingState(),s?(this.switchingTrack=t,this.flushAudioIfNeeded(t),this.state!==ue.STOPPED&&(this.setInterval(Ex),this.state=ue.IDLE,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=t,this.clearInterval())}onManifestLoading(){super.onManifestLoading(),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1}onLevelLoaded(e,t){this.mainDetails=t.details;const s=this.cachedTrackLoadedData;s&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded(L.AUDIO_TRACK_LOADED,s))}onAudioTrackLoaded(e,t){var s;const{levels:n}=this,{details:r,id:l,groupId:c,track:d}=t;if(!n){this.warn(`Audio tracks reset while loading track ${l} "${d.name}" of "${c}"`);return}const u=this.mainDetails;if(!u||r.endCC>u.endCC||u.expired){this.cachedTrackLoadedData=t,this.state!==ue.STOPPED&&(this.state=ue.WAITING_TRACK);return}this.cachedTrackLoadedData=null,this.log(`Audio track ${l} "${d.name}" of "${c}" loaded [${r.startSN},${r.endSN}]${r.lastPartSn?`[part-${r.lastPartSn}-${r.lastPartIndex}]`:""},duration:${r.totalduration}`);const f=n[l];let g=0;if(r.live||(s=f.details)!=null&&s.live){if(this.checkLiveUpdate(r),r.deltaUpdateFailed)return;if(f.details){var y;g=this.alignPlaylists(r,f.details,(y=this.levelLastLoaded)==null?void 0:y.details)}r.alignedSliding||(_b(r,u),r.alignedSliding||Nu(r,u),g=r.fragmentStart)}f.details=r,this.levelLastLoaded=f,this.startFragRequested||this.setStartPosition(u,g),this.hls.trigger(L.AUDIO_TRACK_UPDATED,{details:r,id:l,groupId:t.groupId}),this.state===ue.WAITING_TRACK&&!this.waitForCdnTuneIn(r)&&(this.state=ue.IDLE),this.tick()}_handleFragmentLoadProgress(e){var t;const s=e.frag,{part:n,payload:r}=e,{config:l,trackId:c,levels:d}=this;if(!d){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${s.sn} of level ${s.level} will not be buffered`);return}const u=d[c];if(!u){this.warn("Audio track is undefined on fragment load progress");return}const f=u.details;if(!f){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(s.start);return}const g=l.defaultAudioCodec||u.audioCodec||"mp4a.40.2";let y=this.transmuxer;y||(y=this.transmuxer=new zb(this.hls,De.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const x=this.initPTS[s.cc],S=(t=s.initSegment)==null?void 0:t.data;if(x!==void 0){const T=n?n.index:-1,A=T!==-1,I=new Gm(s.level,s.sn,s.stats.chunkCount,r.byteLength,T,A);y.push(r,S,g,"",s,n,f.totalduration,!1,I,x)}else{this.log(`Unknown video PTS for cc ${s.cc}, waiting for video PTS before demuxing audio frag ${s.sn} of [${f.startSN} ,${f.endSN}],track ${c}`);const{cache:E}=this.waitingData=this.waitingData||{frag:s,part:n,cache:new Ib,complete:!1};E.push(new Uint8Array(r)),this.state!==ue.STOPPED&&(this.state=ue.WAITING_INIT_PTS)}}_handleFragmentLoadComplete(e){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=null}onBufferCreated(e,t){this.bufferFlushed=this.flushing=!1;const s=t.tracks.audio;s&&(this.mediaBuffer=s.buffer||null)}onFragLoading(e,t){!this.audioOnly&&t.frag.type===De.MAIN&&rs(t.frag)&&(this.mainFragLoading=t,this.state===ue.IDLE&&this.tick())}onFragBuffered(e,t){const{frag:s,part:n}=t;if(s.type!==De.AUDIO){!this.audioOnly&&s.type===De.MAIN&&!s.elementaryStreams.video&&!s.elementaryStreams.audiovideo&&(this.audioOnly=!0,this.mainFragLoading=null);return}if(this.fragContextChanged(s)){this.warn(`Fragment ${s.sn}${n?" p: "+n.index:""} of level ${s.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(rs(s)){this.fragPrevious=s;const r=this.switchingTrack;r&&(this.bufferedTrack=r,this.switchingTrack=null,this.hls.trigger(L.AUDIO_TRACK_SWITCHED,Lt({},r)))}this.fragBufferedComplete(s,n),this.media&&this.tick()}onError(e,t){var s;if(t.fatal){this.state=ue.ERROR;return}switch(t.details){case W.FRAG_GAP:case W.FRAG_PARSING_ERROR:case W.FRAG_DECRYPT_ERROR:case W.FRAG_LOAD_ERROR:case W.FRAG_LOAD_TIMEOUT:case W.KEY_LOAD_ERROR:case W.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(De.AUDIO,t);break;case W.AUDIO_TRACK_LOAD_ERROR:case W.AUDIO_TRACK_LOAD_TIMEOUT:case W.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===ue.WAITING_TRACK&&((s=t.context)==null?void 0:s.type)===at.AUDIO_TRACK&&(this.state=ue.IDLE);break;case W.BUFFER_ADD_CODEC_ERROR:case W.BUFFER_APPEND_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)||this.resetLoadingState();break;case W.BUFFER_FULL_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case W.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onBufferFlushing(e,{type:t}){t!==Pt.VIDEO&&(this.flushing=!0)}onBufferFlushed(e,{type:t}){if(t!==Pt.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===ue.ENDED&&(this.state=ue.IDLE);const s=this.mediaBuffer||this.media;s&&(this.afterBufferFlushed(s,t,De.AUDIO),this.tick())}}_handleTransmuxComplete(e){var t;const s="audio",{hls:n}=this,{remuxResult:r,chunkMeta:l}=e,c=this.getCurrentContext(l);if(!c){this.resetWhenMissingContext(l);return}const{frag:d,part:u,level:f}=c,{details:g}=f,{audio:y,text:x,id3:S,initSegment:E}=r;if(this.fragContextChanged(d)||!g){this.fragmentTracker.removeFragment(d);return}if(this.state=ue.PARSING,this.switchingTrack&&y&&this.completeAudioSwitch(this.switchingTrack),E!=null&&E.tracks){const T=d.initSegment||d;if(this.unhandledEncryptionError(E,d))return;this._bufferInitSegment(f,E.tracks,T,l),n.trigger(L.FRAG_PARSING_INIT_SEGMENT,{frag:T,id:s,tracks:E.tracks})}if(y){const{startPTS:T,endPTS:A,startDTS:I,endDTS:_}=y;u&&(u.elementaryStreams[Pt.AUDIO]={startPTS:T,endPTS:A,startDTS:I,endDTS:_}),d.setElementaryStreamInfo(Pt.AUDIO,T,A,I,_),this.bufferFragmentData(y,d,u,l)}if(S!=null&&(t=S.samples)!=null&&t.length){const T=Ot({id:s,frag:d,details:g},S);n.trigger(L.FRAG_PARSING_METADATA,T)}if(x){const T=Ot({id:s,frag:d,details:g},x);n.trigger(L.FRAG_PARSING_USERDATA,T)}}_bufferInitSegment(e,t,s,n){if(this.state!==ue.PARSING||(t.video&&delete t.video,t.audiovideo&&delete t.audiovideo,!t.audio))return;const r=t.audio;r.id=De.AUDIO;const l=e.audioCodec;this.log(`Init audio buffer, container:${r.container}, codecs[level/parsed]=[${l}/${r.codec}]`),l&&l.split(",").length===1&&(r.levelCodec=l),this.hls.trigger(L.BUFFER_CODECS,t);const c=r.initSegment;if(c!=null&&c.byteLength){const d={type:"audio",frag:s,part:null,chunkMeta:n,parent:s.type,data:c};this.hls.trigger(L.BUFFER_APPENDING,d)}this.tickImmediate()}loadFragment(e,t,s){const n=this.fragmentTracker.getState(e);if(this.switchingTrack||n===vs.NOT_LOADED||n===vs.PARTIAL){var r;if(!rs(e))this._loadInitSegment(e,t);else if((r=t.details)!=null&&r.live&&!this.initPTS[e.cc]){this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=ue.WAITING_INIT_PTS;const l=this.mainDetails;l&&l.fragmentStart!==t.details.fragmentStart&&Nu(t.details,l)}else super.loadFragment(e,t,s)}else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){if(this.media&&this.bufferedTrack){const{name:t,lang:s,assocLang:n,characteristics:r,audioCodec:l,channels:c}=this.bufferedTrack;Xa({name:t,lang:s,assocLang:n,characteristics:r,audioCodec:l,channels:c},e,Ya)||(Ru(e.url,this.hls)?(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null):this.bufferedTrack=e)}}completeAudioSwitch(e){const{hls:t}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(L.AUDIO_TRACK_SWITCHED,Lt({},e))}}class ep extends Vi{constructor(e,t){super(t,e.logger),this.hls=void 0,this.canLoad=!1,this.timer=-1,this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t,s){const n=t?.renditionReports;if(n){let r=-1;for(let l=0;l<n.length;l++){const c=n[l];let d;try{d=new self.URL(c.URI,t.url).href}catch(u){this.warn(`Could not construct new URL for Rendition Report: ${u}`),d=c.URI||""}if(d===e){r=l;break}else d===e.substring(0,d.length)&&(r=l)}if(r!==-1){const l=n[r],c=parseInt(l["LAST-MSN"])||t.lastPartSn;let d=parseInt(l["LAST-PART"])||t.lastPartIndex;if(this.hls.config.lowLatencyMode){const f=Math.min(t.age-t.partTarget,t.targetduration);d>=0&&f>t.partTarget&&(d+=1)}const u=s&&jv(s);return new Fv(c,d>=0?d:void 0,u)}}}loadPlaylist(e){this.clearTimer()}loadingPlaylist(e,t){this.clearTimer()}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}getUrlWithDirectives(e,t){if(t)try{return t.addDirectives(e)}catch(s){this.warn(`Could not construct new URL with HLS Delivery Directives: ${s}`)}return e}playlistLoaded(e,t,s){const{details:n,stats:r}=t,l=self.performance.now(),c=r.loading.first?Math.max(0,l-r.loading.first):0;n.advancedDateTime=Date.now()-c;const d=this.hls.config.timelineOffset;if(d!==n.appliedTimelineOffset){const f=Math.max(d||0,0);n.appliedTimelineOffset=f,n.fragments.forEach(g=>{g.setStart(g.playlistOffset+f)})}if(n.live||s!=null&&s.live){const f="levelInfo"in t?t.levelInfo:t.track;if(n.reloaded(s),s&&n.fragments.length>0){lC(s,n,this);const I=n.playlistParsingError;if(I){this.warn(I);const _=this.hls;if(!_.config.ignorePlaylistParsingErrors){var u;const{networkDetails:C}=t;_.trigger(L.ERROR,{type:je.NETWORK_ERROR,details:W.LEVEL_PARSING_ERROR,fatal:!1,url:n.url,error:I,reason:I.message,level:t.level||void 0,parent:(u=n.fragments[0])==null?void 0:u.type,networkDetails:C,stats:r});return}n.playlistParsingError=null}}n.requestScheduled===-1&&(n.requestScheduled=r.loading.start);const g=this.hls.mainForwardBufferInfo,y=g?g.end-g.len:0,x=(n.edge-y)*1e3,S=Sb(n,x);if(n.requestScheduled+S<l?n.requestScheduled=l:n.requestScheduled+=S,this.log(`live playlist ${e} ${n.advanced?"REFRESHED "+n.lastPartSn+"-"+n.lastPartIndex:n.updated?"UPDATED":"MISSED"}`),!this.canLoad||!n.live)return;let E,T,A;if(n.canBlockReload&&n.endSN&&n.advanced){const I=this.hls.config.lowLatencyMode,_=n.lastPartSn,C=n.endSN,k=n.lastPartIndex,D=k!==-1,O=_===C;D?O?(T=C+1,A=I?0:k):(T=_,A=I?k+1:n.maxPartIndex):T=C+1;const F=n.age,j=F+n.ageHeader;let U=Math.min(j-n.partTarget,n.targetduration*1.5);if(U>0){if(j>n.targetduration*3)this.log(`Playlist last advanced ${F.toFixed(2)}s ago. Omitting segment and part directives.`),T=void 0,A=void 0;else if(s!=null&&s.tuneInGoal&&j-n.partTarget>s.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${s.tuneInGoal} to: ${U} with playlist age: ${n.age}`),U=0;else{const K=Math.floor(U/n.targetduration);if(T+=K,A!==void 0){const H=Math.round(U%n.targetduration/n.partTarget);A+=H}this.log(`CDN Tune-in age: ${n.ageHeader}s last advanced ${F.toFixed(2)}s goal: ${U} skip sn ${K} to part ${A}`)}n.tuneInGoal=U}if(E=this.getDeliveryDirectives(n,t.deliveryDirectives,T,A),I||!O){n.requestScheduled=l,this.loadingPlaylist(f,E);return}}else(n.canBlockReload||n.canSkipUntil)&&(E=this.getDeliveryDirectives(n,t.deliveryDirectives,T,A));E&&T!==void 0&&n.canBlockReload&&(n.requestScheduled=r.loading.first+Math.max(S-c*2,S/2)),this.scheduleLoading(f,E,n)}else this.clearTimer()}scheduleLoading(e,t,s){const n=s||e.details;if(!n){this.loadingPlaylist(e,t);return}const r=self.performance.now(),l=n.requestScheduled;if(r>=l){this.loadingPlaylist(e,t);return}const c=l-r;this.log(`reload live playlist ${e.name||e.bitrate+"bps"} in ${Math.round(c)} ms`),this.clearTimer(),this.timer=self.setTimeout(()=>this.loadingPlaylist(e,t),c)}getDeliveryDirectives(e,t,s,n){let r=jv(e);return t!=null&&t.skip&&e.deltaUpdateFailed&&(s=t.msn,n=t.part,r=uu.No),new Fv(s,n,r)}checkRetry(e){const t=e.details,s=Lu(e),n=e.errorAction,{action:r,retryCount:l=0,retryConfig:c}=n||{},d=!!n&&!!c&&(r===ws.RetryRequest||!n.resolved&&r===ws.SendAlternateToPenaltyBox);if(d){var u;if(l>=c.maxNumRetry)return!1;if(s&&(u=e.context)!=null&&u.deliveryDirectives)this.warn(`Retrying playlist loading ${l+1}/${c.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{const f=Vm(c,l);this.clearTimer(),this.timer=self.setTimeout(()=>this.loadPlaylist(),f),this.warn(`Retrying playlist loading ${l+1}/${c.maxNumRetry} after "${t}" in ${f}ms`)}e.levelRetry=!0,n.resolved=!0}return d}}function Kb(i,e){if(i.length!==e.length)return!1;for(let t=0;t<i.length;t++)if(!mo(i[t].attrs,e[t].attrs))return!1;return!0}function mo(i,e,t){const s=i["STABLE-RENDITION-ID"];return s&&!t?s===e["STABLE-RENDITION-ID"]:!(t||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(n=>i[n]!==e[n])}function um(i,e){return e.label.toLowerCase()===i.name.toLowerCase()&&(!e.language||e.language.toLowerCase()===(i.lang||"").toLowerCase())}class gk extends ep{constructor(e){super(e,"audio-track-controller"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.MANIFEST_PARSED,this.onManifestParsed,this),e.on(L.LEVEL_LOADING,this.onLevelLoading,this),e.on(L.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(L.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(L.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.MANIFEST_PARSED,this.onManifestParsed,this),e.off(L.LEVEL_LOADING,this.onLevelLoading,this),e.off(L.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(L.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(L.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){const{id:s,groupId:n,details:r}=t,l=this.tracksInGroup[s];if(!l||l.groupId!==n){this.warn(`Audio track with id:${s} and group:${n} not found in active group ${l?.groupId}`);return}const c=l.details;l.details=t.details,this.log(`Audio track ${s} "${l.name}" lang:${l.lang} group:${n} loaded [${r.startSN}-${r.endSN}]`),s===this.trackId&&this.playlistLoaded(s,t,c)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const s=t.audioGroups||null,n=this.groupIds;let r=this.currentTrack;if(!s||n?.length!==s?.length||s!=null&&s.some(c=>n?.indexOf(c)===-1)){this.groupIds=s,this.trackId=-1,this.currentTrack=null;const c=this.tracks.filter(y=>!s||s.indexOf(y.groupId)!==-1);if(c.length)this.selectDefaultTrack&&!c.some(y=>y.default)&&(this.selectDefaultTrack=!1),c.forEach((y,x)=>{y.id=x});else if(!r&&!this.tracksInGroup.length)return;this.tracksInGroup=c;const d=this.hls.config.audioPreference;if(!r&&d){const y=mn(d,c,Ya);if(y>-1)r=c[y];else{const x=mn(d,this.tracks);r=this.tracks[x]}}let u=this.findTrackId(r);u===-1&&r&&(u=this.findTrackId(null));const f={audioTracks:c};this.log(`Updating audio tracks, ${c.length} track(s) found in group(s): ${s?.join(",")}`),this.hls.trigger(L.AUDIO_TRACKS_UPDATED,f);const g=this.trackId;if(u!==-1&&g===-1)this.setAudioTrack(u);else if(c.length&&g===-1){var l;const y=new Error(`No audio track selected for current audio group-ID(s): ${(l=this.groupIds)==null?void 0:l.join(",")} track count: ${c.length}`);this.warn(y.message),this.hls.trigger(L.ERROR,{type:je.MEDIA_ERROR,details:W.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:y})}}}onError(e,t){t.fatal||!t.context||t.context.type===at.AUDIO_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){const t=this.hls;if(t.config.audioPreference=e,e){const s=this.allAudioTracks;if(this.selectDefaultTrack=!1,s.length){const n=this.currentTrack;if(n&&Xa(e,n,Ya))return n;const r=mn(e,this.tracksInGroup,Ya);if(r>-1){const l=this.tracksInGroup[r];return this.setAudioTrack(r),l}else if(n){let l=t.loadLevel;l===-1&&(l=t.firstAutoLevel);const c=Lw(e,t.levels,s,l,Ya);if(c===-1)return null;t.nextLoadLevel=c}if(e.channels||e.audioCodec){const l=mn(e,s);if(l>-1)return s[l]}}}return null}setAudioTrack(e){const t=this.tracksInGroup;if(e<0||e>=t.length){this.warn(`Invalid audio track id: ${e}`);return}this.selectDefaultTrack=!1;const s=this.currentTrack,n=t[e],r=n.details&&!n.details.live;if(e===this.trackId&&n===s&&r||(this.log(`Switching to audio-track ${e} "${n.name}" lang:${n.lang} group:${n.groupId} channels:${n.channels}`),this.trackId=e,this.currentTrack=n,this.hls.trigger(L.AUDIO_TRACK_SWITCHING,Lt({},n)),r))return;const l=this.switchParams(n.url,s?.details,n.details);this.loadPlaylist(l)}findTrackId(e){const t=this.tracksInGroup;for(let s=0;s<t.length;s++){const n=t[s];if(!(this.selectDefaultTrack&&!n.default)&&(!e||Xa(e,n,Ya)))return s}if(e){const{name:s,lang:n,assocLang:r,characteristics:l,audioCodec:c,channels:d}=e;for(let u=0;u<t.length;u++){const f=t[u];if(Xa({name:s,lang:n,assocLang:r,characteristics:l,audioCodec:c,channels:d},f,Ya))return u}for(let u=0;u<t.length;u++){const f=t[u];if(mo(e.attrs,f.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return u}for(let u=0;u<t.length;u++){const f=t[u];if(mo(e.attrs,f.attrs,["LANGUAGE"]))return u}}return-1}loadPlaylist(e){super.loadPlaylist();const t=this.currentTrack;this.shouldLoadPlaylist(t)&&Ru(t.url,this.hls)&&this.scheduleLoading(t,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const s=e.id,n=e.groupId,r=this.getUrlWithDirectives(e.url,t),l=e.details,c=l?.age;this.log(`Loading audio-track ${s} "${e.name}" lang:${e.lang} group:${n}${t?.msn!==void 0?" at sn "+t.msn+" part "+t.part:""}${c&&l.live?" age "+c.toFixed(1)+(l.type&&" "+l.type||""):""} ${r}`),this.hls.trigger(L.AUDIO_TRACK_LOADING,{url:r,id:s,groupId:n,deliveryDirectives:t||null,track:e})}}class yk{constructor(e){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=e}destroy(){this.tracks=this.queues=null}append(e,t,s){if(this.queues===null||this.tracks===null)return;const n=this.queues[t];n.push(e),n.length===1&&!s&&this.executeNext(t)}appendBlocker(e){return new Promise(t=>{const s={label:"async-blocker",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.append(s,e)})}prependBlocker(e){return new Promise(t=>{if(this.queues){const s={label:"async-blocker-prepend",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.queues[e].unshift(s)}})}removeBlockers(){this.queues!==null&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach(e=>{var t;const s=(t=e[0])==null?void 0:t.label;(s==="async-blocker"||s==="async-blocker-prepend")&&(e[0].execute(),e.splice(0,1))})}unblockAudio(e){if(this.queues===null)return;this.queues.audio[0]===e&&this.shiftAndExecuteNext("audio")}executeNext(e){if(this.queues===null||this.tracks===null)return;const t=this.queues[e];if(t.length){const n=t[0];try{n.execute()}catch(r){var s;if(n.onError(r),this.queues===null||this.tracks===null)return;const l=(s=this.tracks[e])==null?void 0:s.buffer;l!=null&&l.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){this.queues!==null&&(this.queues[e].shift(),this.executeNext(e))}current(e){var t;return((t=this.queues)==null?void 0:t[e][0])||null}toString(){const{queues:e,tracks:t}=this;return e===null||t===null?"<destroyed>":`
${this.list("video")}
${this.list("audio")}
${this.list("audiovideo")}}`}list(e){var t,s;return(t=this.queues)!=null&&t[e]||(s=this.tracks)!=null&&s[e]?`${e}: (${this.listSbInfo(e)}) ${this.listOps(e)}`:""}listSbInfo(e){var t;const s=(t=this.tracks)==null?void 0:t[e],n=s?.buffer;return n?`SourceBuffer${n.updating?" updating":""}${s.ended?" ended":""}${s.ending?" ending":""}`:"none"}listOps(e){var t;return((t=this.queues)==null?void 0:t[e].map(s=>s.label).join(", "))||""}}const Ax=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,Yb="HlsJsTrackRemovedError";class vk extends Error{constructor(e){super(e),this.name=Yb}}class xk extends Vi{constructor(e,t){super("buffer-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.details=null,this._objectUrl=null,this.operationQueue=null,this.bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.blockedAudioAppend=null,this.lastVideoAppendEnd=0,this.appendSource=void 0,this.transferData=void 0,this.overrides=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.sourceBuffers=[[null,null],[null,null]],this._onEndStreaming=s=>{var n;this.hls&&((n=this.mediaSource)==null?void 0:n.readyState)==="open"&&this.hls.pauseBuffering()},this._onStartStreaming=s=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=s=>{const{media:n,mediaSource:r}=this;s&&this.log("Media source opened"),!(!n||!r)&&(r.removeEventListener("sourceopen",this._onMediaSourceOpen),n.removeEventListener("emptied",this._onMediaEmptied),this.updateDuration(),this.hls.trigger(L.MEDIA_ATTACHED,{media:n,mediaSource:r}),this.mediaSource!==null&&this.checkPendingTracks())},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:s,_objectUrl:n}=this;s!==n&&this.error(`Media element src was set while attaching MediaSource (${n} > ${s})`)},this.hls=e,this.fragmentTracker=t,this.appendSource=V1(Ia(e.config.preferManagedMediaSource)),this.initTracks(),this.registerListeners()}hasSourceTypes(){return Object.keys(this.tracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null}registerListeners(){const{hls:e}=this;e.on(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.MANIFEST_PARSED,this.onManifestParsed,this),e.on(L.BUFFER_RESET,this.onBufferReset,this),e.on(L.BUFFER_APPENDING,this.onBufferAppending,this),e.on(L.BUFFER_CODECS,this.onBufferCodecs,this),e.on(L.BUFFER_EOS,this.onBufferEos,this),e.on(L.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(L.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(L.FRAG_PARSED,this.onFragParsed,this),e.on(L.FRAG_CHANGED,this.onFragChanged,this),e.on(L.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.MANIFEST_PARSED,this.onManifestParsed,this),e.off(L.BUFFER_RESET,this.onBufferReset,this),e.off(L.BUFFER_APPENDING,this.onBufferAppending,this),e.off(L.BUFFER_CODECS,this.onBufferCodecs,this),e.off(L.BUFFER_EOS,this.onBufferEos,this),e.off(L.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(L.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(L.FRAG_PARSED,this.onFragParsed,this),e.off(L.FRAG_CHANGED,this.onFragChanged,this),e.off(L.ERROR,this.onError,this)}transferMedia(){const{media:e,mediaSource:t}=this;if(!e)return null;const s={};if(this.operationQueue){const r=this.isUpdating();r||this.operationQueue.removeBlockers();const l=this.isQueued();(r||l)&&this.warn(`Transfering MediaSource with${l?" operations in queue":""}${r?" updating SourceBuffer(s)":""} ${this.operationQueue}`),this.operationQueue.destroy()}const n=this.transferData;return!this.sourceBufferCount&&n&&n.mediaSource===t?Ot(s,n.tracks):this.sourceBuffers.forEach(r=>{const[l]=r;l&&(s[l]=Ot({},this.tracks[l]),this.removeBuffer(l)),r[0]=r[1]=null}),{media:e,mediaSource:t,tracks:s}}initTracks(){const e={};this.sourceBuffers=[[null,null],[null,null]],this.tracks=e,this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0}onManifestLoading(){this.bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){var s;let n=2;(t.audio&&!t.video||!t.altAudio)&&(n=1),this.bufferCodecEventsTotal=n,this.log(`${n} bufferCodec event(s) expected.`),(s=this.transferData)!=null&&s.mediaSource&&this.sourceBufferCount&&n&&this.bufferCreated()}onMediaAttaching(e,t){const s=this.media=t.media;this.transferData=this.overrides=void 0;const n=Ia(this.appendSource);if(n){const r=!!t.mediaSource;(r||t.overrides)&&(this.transferData=t,this.overrides=t.overrides);const l=this.mediaSource=t.mediaSource||new n;if(this.assignMediaSource(l),r)this._objectUrl=s.src,this.attachTransferred();else{const c=this._objectUrl=self.URL.createObjectURL(l);if(this.appendSource)try{s.removeAttribute("src");const d=self.ManagedMediaSource;s.disableRemotePlayback=s.disableRemotePlayback||d&&l instanceof d,_x(s),Sk(s,c),s.load()}catch{s.src=c}else s.src=c}s.addEventListener("emptied",this._onMediaEmptied)}}assignMediaSource(e){var t,s;this.log(`${((t=this.transferData)==null?void 0:t.mediaSource)===e?"transferred":"created"} media source: ${(s=e.constructor)==null?void 0:s.name}`),e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.addEventListener("startstreaming",this._onStartStreaming),e.addEventListener("endstreaming",this._onEndStreaming))}attachTransferred(){const e=this.media,t=this.transferData;if(!t||!e)return;const s=this.tracks,n=t.tracks,r=n?Object.keys(n):null,l=r?r.length:0,c=()=>{Promise.resolve().then(()=>{this.media&&this.mediaSourceOpenOrEnded&&this._onMediaSourceOpen()})};if(n&&r&&l){if(!this.tracksReady){this.hls.config.startFragPrefetch=!0,this.log("attachTransferred: waiting for SourceBuffer track info");return}if(this.log(`attachTransferred: (bufferCodecEventsTotal ${this.bufferCodecEventsTotal})
required tracks: ${Ut(s,(d,u)=>d==="initSegment"?void 0:u)};
transfer tracks: ${Ut(n,(d,u)=>d==="initSegment"?void 0:u)}}`),!GS(n,s)){t.mediaSource=null,t.tracks=void 0;const d=e.currentTime,u=this.details,f=Math.max(d,u?.fragments[0].start||0);if(f-d>1){this.log(`attachTransferred: waiting for playback to reach new tracks start time ${d} -> ${f}`);return}this.warn(`attachTransferred: resetting MediaSource for incompatible tracks ("${Object.keys(n)}"->"${Object.keys(s)}") start time: ${f} currentTime: ${d}`),this.onMediaDetaching(L.MEDIA_DETACHING,{}),this.onMediaAttaching(L.MEDIA_ATTACHING,t),e.currentTime=f;return}this.transferData=void 0,r.forEach(d=>{const u=d,f=n[u];if(f){const g=f.buffer;if(g){const y=this.fragmentTracker,x=f.id;if(y.hasFragments(x)||y.hasParts(x)){const T=Xe.getBuffered(g);y.detectEvictedFragments(u,T,x,null,!0)}const S=Nf(u),E=[u,g];this.sourceBuffers[S]=E,g.updating&&this.operationQueue&&this.operationQueue.prependBlocker(u),this.trackSourceBuffer(u,f)}}}),c(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),c()}get mediaSourceOpenOrEnded(){var e;const t=(e=this.mediaSource)==null?void 0:e.readyState;return t==="open"||t==="ended"}onMediaDetaching(e,t){const s=!!t.transferMedia;this.transferData=this.overrides=void 0;const{media:n,mediaSource:r,_objectUrl:l}=this;if(r){if(this.log(`media source ${s?"transferring":"detaching"}`),s)this.sourceBuffers.forEach(([c])=>{c&&this.removeBuffer(c)}),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){const c=r.readyState==="open";try{const d=r.sourceBuffers;for(let u=d.length;u--;)c&&d[u].abort(),r.removeSourceBuffer(d[u]);c&&r.endOfStream()}catch(d){this.warn(`onMediaDetaching: ${d.message} while calling endOfStream`)}}this.sourceBufferCount&&this.onBufferReset()}r.removeEventListener("sourceopen",this._onMediaSourceOpen),r.removeEventListener("sourceended",this._onMediaSourceEnded),r.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(r.removeEventListener("startstreaming",this._onStartStreaming),r.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}n&&(n.removeEventListener("emptied",this._onMediaEmptied),s||(l&&self.URL.revokeObjectURL(l),this.mediaSrc===l?(n.removeAttribute("src"),this.appendSource&&_x(n),n.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(L.MEDIA_DETACHED,t)}onBufferReset(){this.sourceBuffers.forEach(([e])=>{e&&this.resetBuffer(e)}),this.initTracks()}resetBuffer(e){var t;const s=(t=this.tracks[e])==null?void 0:t.buffer;if(this.removeBuffer(e),s)try{var n;(n=this.mediaSource)!=null&&n.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(s)}catch(r){this.warn(`onBufferReset ${e}`,r)}delete this.tracks[e]}removeBuffer(e){this.removeBufferListeners(e),this.sourceBuffers[Nf(e)]=[null,null];const t=this.tracks[e];t&&(t.buffer=void 0)}resetQueue(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new yk(this.tracks)}onBufferCodecs(e,t){var s;const n=this.tracks,r=Object.keys(t);this.log(`BUFFER_CODECS: "${r}" (current SB count ${this.sourceBufferCount})`);const l="audiovideo"in t&&(n.audio||n.video)||n.audiovideo&&("audio"in t||"video"in t),c=!l&&this.sourceBufferCount&&this.media&&r.some(d=>!n[d]);if(l||c){this.warn(`Unsupported transition between "${Object.keys(n)}" and "${r}" SourceBuffers`);return}r.forEach(d=>{var u,f;const g=t[d],{id:y,codec:x,levelCodec:S,container:E,metadata:T,supplemental:A}=g;let I=n[d];const _=(u=this.transferData)==null||(u=u.tracks)==null?void 0:u[d],C=_!=null&&_.buffer?_:I,k=C?.pendingCodec||C?.codec,D=C?.levelCodec;I||(I=n[d]={buffer:void 0,listeners:[],codec:x,supplemental:A,container:E,levelCodec:S,metadata:T,id:y});const O=cu(k,D),F=O?.replace(Ax,"$1");let j=cu(x,S);const U=(f=j)==null?void 0:f.replace(Ax,"$1");j&&O&&F!==U&&(d.slice(0,5)==="audio"&&(j=_u(j,this.appendSource)),this.log(`switching codec ${k} to ${j}`),j!==(I.pendingCodec||I.codec)&&(I.pendingCodec=j),I.container=E,this.appendChangeType(d,E,j))}),(this.tracksReady||this.sourceBufferCount)&&(t.tracks=this.sourceBufferTracks),!this.sourceBufferCount&&(this.bufferCodecEventsTotal>1&&!this.tracks.video&&!t.video&&((s=t.audio)==null?void 0:s.id)==="main"&&(this.log("Main audio-only"),this.bufferCodecEventsTotal=1),this.mediaSourceOpenOrEnded&&this.checkPendingTracks())}get sourceBufferTracks(){return Object.keys(this.tracks).reduce((e,t)=>{const s=this.tracks[t];return e[t]={id:s.id,container:s.container,codec:s.codec,levelCodec:s.levelCodec},e},{})}appendChangeType(e,t,s){const n=`${t};codecs=${s}`,r={label:`change-type=${n}`,execute:()=>{const l=this.tracks[e];if(l){const c=l.buffer;c!=null&&c.changeType&&(this.log(`changing ${e} sourceBuffer type to ${n}`),c.changeType(n),l.codec=s,l.container=t)}this.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:l=>{this.warn(`Failed to change ${e} SourceBuffer type`,l)}};this.append(r,e,this.isPending(this.tracks[e]))}blockAudio(e){var t;const s=e.start,n=s+e.duration*.05;if(((t=this.fragmentTracker.getAppendedFrag(s,De.MAIN))==null?void 0:t.gap)===!0)return;const l={label:"block-audio",execute:()=>{var c;const d=this.tracks.video;(this.lastVideoAppendEnd>n||d!=null&&d.buffer&&Xe.isBuffered(d.buffer,n)||((c=this.fragmentTracker.getAppendedFrag(n,De.MAIN))==null?void 0:c.gap)===!0)&&(this.blockedAudioAppend=null,this.shiftAndExecuteNext("audio"))},onStart:()=>{},onComplete:()=>{},onError:c=>{this.warn("Error executing block-audio operation",c)}};this.blockedAudioAppend={op:l,frag:e},this.append(l,"audio",!0)}unblockAudio(){const{blockedAudioAppend:e,operationQueue:t}=this;e&&t&&(this.blockedAudioAppend=null,t.unblockAudio(e.op))}onBufferAppending(e,t){const{tracks:s}=this,{data:n,type:r,parent:l,frag:c,part:d,chunkMeta:u,offset:f}=t,g=u.buffering[r],{sn:y,cc:x}=c,S=self.performance.now();g.start=S;const E=c.stats.buffering,T=d?d.stats.buffering:null;E.start===0&&(E.start=S),T&&T.start===0&&(T.start=S);const A=s.audio;let I=!1;r==="audio"&&A?.container==="audio/mpeg"&&(I=!this.lastMpegAudioChunk||u.id===1||this.lastMpegAudioChunk.sn!==u.sn,this.lastMpegAudioChunk=u);const _=s.video,C=_?.buffer;if(C&&y!=="initSegment"){const O=d||c,F=this.blockedAudioAppend;if(r==="audio"&&l!=="main"&&!this.blockedAudioAppend&&!(_.ending||_.ended)){const U=O.start+O.duration*.05,K=C.buffered,H=this.currentOp("video");!K.length&&!H?this.blockAudio(O):!H&&!Xe.isBuffered(C,U)&&this.lastVideoAppendEnd<U&&this.blockAudio(O)}else if(r==="video"){const j=O.end;if(F){const U=F.frag.start;(j>U||j<this.lastVideoAppendEnd||Xe.isBuffered(C,U))&&this.unblockAudio()}this.lastVideoAppendEnd=j}}const k=(d||c).start,D={label:`append-${r}`,execute:()=>{var O;g.executeStart=self.performance.now();const F=(O=this.tracks[r])==null?void 0:O.buffer;F&&(I?this.updateTimestampOffset(F,k,.1,r,y,x):f!==void 0&&ke(f)&&this.updateTimestampOffset(F,f,1e-6,r,y,x)),this.appendExecutor(n,r)},onStart:()=>{},onComplete:()=>{const O=self.performance.now();g.executeEnd=g.end=O,E.first===0&&(E.first=O),T&&T.first===0&&(T.first=O);const F={};this.sourceBuffers.forEach(([j,U])=>{j&&(F[j]=Xe.getBuffered(U))}),this.appendErrors[r]=0,r==="audio"||r==="video"?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(L.BUFFER_APPENDED,{type:r,frag:c,part:d,chunkMeta:u,parent:c.type,timeRanges:F})},onError:O=>{var F;const j={type:je.MEDIA_ERROR,parent:c.type,details:W.BUFFER_APPEND_ERROR,sourceBufferName:r,frag:c,part:d,chunkMeta:u,error:O,err:O,fatal:!1},U=(F=this.media)==null?void 0:F.error;if(O.code===DOMException.QUOTA_EXCEEDED_ERR||O.name=="QuotaExceededError"||"quota"in O)j.details=W.BUFFER_FULL_ERROR;else if(O.code===DOMException.INVALID_STATE_ERR&&this.mediaSourceOpenOrEnded&&!U)j.errorAction=Kr(!0);else if(O.name===Yb&&this.sourceBufferCount===0)j.errorAction=Kr(!0);else{const K=++this.appendErrors[r];this.warn(`Failed ${K}/${this.hls.config.appendErrorMaxRetry} times to append segment in "${r}" sourceBuffer (${U||"no media error"})`),(K>=this.hls.config.appendErrorMaxRetry||U)&&(j.fatal=!0)}this.hls.trigger(L.ERROR,j)}};this.log(`queuing "${r}" append sn: ${y}${d?" p: "+d.index:""} of ${c.type===De.MAIN?"level":"track"} ${c.level} cc: ${x}`),this.append(D,r,this.isPending(this.tracks[r]))}getFlushOp(e,t,s){return this.log(`queuing "${e}" remove ${t}-${s}`),{label:"remove",execute:()=>{this.removeExecutor(e,t,s)},onStart:()=>{},onComplete:()=>{this.hls.trigger(L.BUFFER_FLUSHED,{type:e})},onError:n=>{this.warn(`Failed to remove ${t}-${s} from "${e}" SourceBuffer`,n)}}}onBufferFlushing(e,t){const{type:s,startOffset:n,endOffset:r}=t;s?this.append(this.getFlushOp(s,n,r),s):this.sourceBuffers.forEach(([l])=>{l&&this.append(this.getFlushOp(l,n,r),l)})}onFragParsed(e,t){const{frag:s,part:n}=t,r=[],l=n?n.elementaryStreams:s.elementaryStreams;l[Pt.AUDIOVIDEO]?r.push("audiovideo"):(l[Pt.AUDIO]&&r.push("audio"),l[Pt.VIDEO]&&r.push("video"));const c=()=>{const d=self.performance.now();s.stats.buffering.end=d,n&&(n.stats.buffering.end=d);const u=n?n.stats:s.stats;this.hls.trigger(L.FRAG_BUFFERED,{frag:s,part:n,stats:u,id:s.type})};r.length===0&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${s.type} level: ${s.level} sn: ${s.sn}`),this.blockBuffers(c,r).catch(d=>{this.warn(`Fragment buffered callback ${d}`),this.stepOperationQueue(this.sourceBufferTypes)})}onFragChanged(e,t){this.trimBuffers()}get bufferedToEnd(){return this.sourceBufferCount>0&&!this.sourceBuffers.some(([e])=>{if(e){const t=this.tracks[e];if(t)return!t.ended||t.ending}return!1})}onBufferEos(e,t){var s;this.sourceBuffers.forEach(([l])=>{if(l){const c=this.tracks[l];(!t.type||t.type===l)&&(c.ending=!0,c.ended||(c.ended=!0,this.log(`${l} buffer reached EOS`)))}});const n=((s=this.overrides)==null?void 0:s.endOfStream)!==!1;this.sourceBufferCount>0&&!this.sourceBuffers.some(([l])=>{var c;return l&&!((c=this.tracks[l])!=null&&c.ended)})?n?(this.log("Queueing EOS"),this.blockUntilOpen(()=>{this.tracksEnded();const{mediaSource:l}=this;if(!l||l.readyState!=="open"){l&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${l.readyState}`);return}this.log("Calling mediaSource.endOfStream()"),l.endOfStream(),this.hls.trigger(L.BUFFERED_TO_END,void 0)})):(this.tracksEnded(),this.hls.trigger(L.BUFFERED_TO_END,void 0)):t.type==="video"&&this.unblockAudio()}tracksEnded(){this.sourceBuffers.forEach(([e])=>{if(e!==null){const t=this.tracks[e];t&&(t.ending=!1)}})}onLevelUpdated(e,{details:t}){t.fragments.length&&(this.details=t,this.updateDuration())}updateDuration(){this.blockUntilOpen(()=>{const e=this.getDurationAndRange();e&&this.updateMediaSource(e)})}onError(e,t){if(t.details===W.BUFFER_APPEND_ERROR&&t.frag){var s;const n=(s=t.errorAction)==null?void 0:s.nextAutoLevel;ke(n)&&n!==t.frag.level&&this.resetAppendErrors()}}resetAppendErrors(){this.appendErrors={audio:0,video:0,audiovideo:0}}trimBuffers(){const{hls:e,details:t,media:s}=this;if(!s||t===null||!this.sourceBufferCount)return;const n=e.config,r=s.currentTime,l=t.levelTargetDuration,c=t.live&&n.liveBackBufferLength!==null?n.liveBackBufferLength:n.backBufferLength;if(ke(c)&&c>=0){const u=Math.max(c,l),f=Math.floor(r/l)*l-u;this.flushBackBuffer(r,l,f)}const d=n.frontBufferFlushThreshold;if(ke(d)&&d>0){const u=Math.max(n.maxBufferLength,d),f=Math.max(u,l),g=Math.floor(r/l)*l+f;this.flushFrontBuffer(r,l,g)}}flushBackBuffer(e,t,s){this.sourceBuffers.forEach(([n,r])=>{if(r){const c=Xe.getBuffered(r);if(c.length>0&&s>c.start(0)){var l;this.hls.trigger(L.BACK_BUFFER_REACHED,{bufferEnd:s});const d=this.tracks[n];if((l=this.details)!=null&&l.live)this.hls.trigger(L.LIVE_BACK_BUFFER_REACHED,{bufferEnd:s});else if(d!=null&&d.ended){this.log(`Cannot flush ${n} back buffer while SourceBuffer is in ended state`);return}this.hls.trigger(L.BUFFER_FLUSHING,{startOffset:0,endOffset:s,type:n})}}})}flushFrontBuffer(e,t,s){this.sourceBuffers.forEach(([n,r])=>{if(r){const l=Xe.getBuffered(r),c=l.length;if(c<2)return;const d=l.start(c-1),u=l.end(c-1);if(s>d||e>=d&&e<=u)return;this.hls.trigger(L.BUFFER_FLUSHING,{startOffset:d,endOffset:1/0,type:n})}})}getDurationAndRange(){var e;const{details:t,mediaSource:s}=this;if(!t||!this.media||s?.readyState!=="open")return null;const n=t.edge;if(t.live&&this.hls.config.liveDurationInfinity){if(t.fragments.length&&s.setLiveSeekableRange){const u=Math.max(0,t.fragmentStart),f=Math.max(u,n);return{duration:1/0,start:u,end:f}}return{duration:1/0}}const r=(e=this.overrides)==null?void 0:e.duration;if(r)return ke(r)?{duration:r}:null;const l=this.media.duration,c=ke(s.duration)?s.duration:0;return n>c&&n>l||!ke(l)?{duration:n}:null}updateMediaSource({duration:e,start:t,end:s}){const n=this.mediaSource;!this.media||!n||n.readyState!=="open"||(n.duration!==e&&(ke(e)&&this.log(`Updating MediaSource duration to ${e.toFixed(3)}`),n.duration=e),t!==void 0&&s!==void 0&&(this.log(`MediaSource duration is set to ${n.duration}. Setting seekable range to ${t}-${s}.`),n.setLiveSeekableRange(t,s)))}get tracksReady(){const e=this.pendingTrackCount;return e>0&&(e>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}checkPendingTracks(){const{bufferCodecEventsTotal:e,pendingTrackCount:t,tracks:s}=this;if(this.log(`checkPendingTracks (pending: ${t} codec events expected: ${e}) ${Ut(s)}`),this.tracksReady){var n;const r=(n=this.transferData)==null?void 0:n.tracks;r&&Object.keys(r).length?this.attachTransferred():this.createSourceBuffers()}}bufferCreated(){if(this.sourceBufferCount){const e={};this.sourceBuffers.forEach(([t,s])=>{if(t){const n=this.tracks[t];e[t]={buffer:s,container:n.container,codec:n.codec,supplemental:n.supplemental,levelCodec:n.levelCodec,id:n.id,metadata:n.metadata}}}),this.hls.trigger(L.BUFFER_CREATED,{tracks:e}),this.log(`SourceBuffers created. Running queue: ${this.operationQueue}`),this.sourceBuffers.forEach(([t])=>{this.executeNext(t)})}else{const e=new Error("could not create source buffer for media codec(s)");this.hls.trigger(L.ERROR,{type:je.MEDIA_ERROR,details:W.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:e,reason:e.message})}}createSourceBuffers(){const{tracks:e,sourceBuffers:t,mediaSource:s}=this;if(!s)throw new Error("createSourceBuffers called when mediaSource was null");for(const r in e){const l=r,c=e[l];if(this.isPending(c)){const d=this.getTrackCodec(c,l),u=`${c.container};codecs=${d}`;c.codec=d,this.log(`creating sourceBuffer(${u})${this.currentOp(l)?" Queued":""} ${Ut(c)}`);try{const f=s.addSourceBuffer(u),g=Nf(l),y=[l,f];t[g]=y,c.buffer=f}catch(f){var n;this.error(`error while trying to add sourceBuffer: ${f.message}`),this.shiftAndExecuteNext(l),(n=this.operationQueue)==null||n.removeBlockers(),delete this.tracks[l],this.hls.trigger(L.ERROR,{type:je.MEDIA_ERROR,details:W.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:f,sourceBufferName:l,mimeType:u,parent:c.id});return}this.trackSourceBuffer(l,c)}}this.bufferCreated()}getTrackCodec(e,t){const s=e.supplemental;let n=e.codec;s&&(t==="video"||t==="audiovideo")&&lo(s,"video")&&(n=cw(n,s));const r=cu(n,e.levelCodec);return r?t.slice(0,5)==="audio"?_u(r,this.appendSource):r:""}trackSourceBuffer(e,t){const s=t.buffer;if(!s)return;const n=this.getTrackCodec(t,e);this.tracks[e]={buffer:s,codec:n,container:t.container,levelCodec:t.levelCodec,supplemental:t.supplemental,metadata:t.metadata,id:t.id,listeners:[]},this.removeBufferListeners(e),this.addBufferListener(e,"updatestart",this.onSBUpdateStart),this.addBufferListener(e,"updateend",this.onSBUpdateEnd),this.addBufferListener(e,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(e,"bufferedchange",(r,l)=>{const c=l.removedRanges;c!=null&&c.length&&this.hls.trigger(L.BUFFER_FLUSHED,{type:r})})}get mediaSrc(){var e,t;const s=((e=this.media)==null||(t=e.querySelector)==null?void 0:t.call(e,"source"))||this.media;return s?.src}onSBUpdateStart(e){const t=this.currentOp(e);t&&t.onStart()}onSBUpdateEnd(e){var t;if(((t=this.mediaSource)==null?void 0:t.readyState)==="closed"){this.resetBuffer(e);return}const s=this.currentOp(e);s&&(s.onComplete(),this.shiftAndExecuteNext(e))}onSBUpdateError(e,t){var s;const n=new Error(`${e} SourceBuffer error. MediaSource readyState: ${(s=this.mediaSource)==null?void 0:s.readyState}`);this.error(`${n}`,t),this.hls.trigger(L.ERROR,{type:je.MEDIA_ERROR,details:W.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:n,fatal:!1});const r=this.currentOp(e);r&&r.onError(n)}updateTimestampOffset(e,t,s,n,r,l){const c=t-e.timestampOffset;Math.abs(c)>=s&&(this.log(`Updating ${n} SourceBuffer timestampOffset to ${t} (sn: ${r} cc: ${l})`),e.timestampOffset=t)}removeExecutor(e,t,s){const{media:n,mediaSource:r}=this,l=this.tracks[e],c=l?.buffer;if(!n||!r||!c){this.warn(`Attempting to remove from the ${e} SourceBuffer, but it does not exist`),this.shiftAndExecuteNext(e);return}const d=ke(n.duration)?n.duration:1/0,u=ke(r.duration)?r.duration:1/0,f=Math.max(0,t),g=Math.min(s,d,u);g>f&&(!l.ending||l.ended)?(l.ended=!1,this.log(`Removing [${f},${g}] from the ${e} SourceBuffer`),c.remove(f,g)):this.shiftAndExecuteNext(e)}appendExecutor(e,t){const s=this.tracks[t],n=s?.buffer;if(!n)throw new vk(`Attempting to append to the ${t} SourceBuffer, but it does not exist`);s.ending=!1,s.ended=!1,n.appendBuffer(e)}blockUntilOpen(e){if(this.isUpdating()||this.isQueued())this.blockBuffers(e).catch(t=>{this.warn(`SourceBuffer blocked callback ${t}`),this.stepOperationQueue(this.sourceBufferTypes)});else try{e()}catch(t){this.warn(`Callback run without blocking ${this.operationQueue} ${t}`)}}isUpdating(){return this.sourceBuffers.some(([e,t])=>e&&t.updating)}isQueued(){return this.sourceBuffers.some(([e])=>e&&!!this.currentOp(e))}isPending(e){return!!e&&!e.buffer}blockBuffers(e,t=this.sourceBufferTypes){if(!t.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);const{operationQueue:s}=this,n=t.map(l=>this.appendBlocker(l));return t.length>1&&this.blockedAudioAppend&&this.unblockAudio(),Promise.all(n).then(l=>{s===this.operationQueue&&(e(),this.stepOperationQueue(this.sourceBufferTypes))})}stepOperationQueue(e){e.forEach(t=>{var s;const n=(s=this.tracks[t])==null?void 0:s.buffer;!n||n.updating||this.shiftAndExecuteNext(t)})}append(e,t,s){this.operationQueue&&this.operationQueue.append(e,t,s)}appendBlocker(e){if(this.operationQueue)return this.operationQueue.appendBlocker(e)}currentOp(e){return this.operationQueue?this.operationQueue.current(e):null}executeNext(e){e&&this.operationQueue&&this.operationQueue.executeNext(e)}shiftAndExecuteNext(e){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(e)}get pendingTrackCount(){return Object.keys(this.tracks).reduce((e,t)=>e+(this.isPending(this.tracks[t])?1:0),0)}get sourceBufferCount(){return this.sourceBuffers.reduce((e,[t])=>e+(t?1:0),0)}get sourceBufferTypes(){return this.sourceBuffers.map(([e])=>e).filter(e=>!!e)}addBufferListener(e,t,s){const n=this.tracks[e];if(!n)return;const r=n.buffer;if(!r)return;const l=s.bind(this,e);n.listeners.push({event:t,listener:l}),r.addEventListener(t,l)}removeBufferListeners(e){const t=this.tracks[e];if(!t)return;const s=t.buffer;s&&(t.listeners.forEach(n=>{s.removeEventListener(n.event,n.listener)}),t.listeners.length=0)}}function _x(i){const e=i.querySelectorAll("source");[].slice.call(e).forEach(t=>{i.removeChild(t)})}function Sk(i,e){const t=self.document.createElement("source");t.type="video/mp4",t.src=e,i.appendChild(t)}function Nf(i){return i==="audio"?1:0}class tp{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(L.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(L.MANIFEST_PARSED,this.onManifestParsed,this),e.on(L.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(L.BUFFER_CODECS,this.onBufferCodecs,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(L.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(L.MANIFEST_PARSED,this.onManifestParsed,this),e.off(L.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(L.BUFFER_CODECS,this.onBufferCodecs,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){const s=this.hls.levels[t.droppedLevel];this.isLevelAllowed(s)&&this.restrictedLevels.push({bitrate:s.bitrate,height:s.height,width:s.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,t){const s=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,s.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onLevelsUpdated(e,t){this.timer&&ke(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping(),this.media=null}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}const e=this.hls.levels;if(e.length){const t=this.hls,s=this.getMaxLevel(e.length-1);s!==this.autoLevelCapping&&t.logger.log(`Setting autoLevelCapping to ${s}: ${e[s].height}p@${e[s].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),t.autoLevelCapping=s,t.autoLevelEnabled&&t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){const t=this.hls.levels;if(!t.length)return-1;const s=t.filter((n,r)=>this.isLevelAllowed(n)&&r<=e);return this.clientRect=null,tp.getMaxLevelByMediaSize(s,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,t={width:0,height:0};if(e){const s=e.getBoundingClientRect();t.width=s.width,t.height=s.height,!t.width&&!t.height&&(t.width=s.right-s.left||e.width||0,t.height=s.bottom-s.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch{}return Math.min(e,this.hls.config.maxDevicePixelRatio)}isLevelAllowed(e){return!this.restrictedLevels.some(s=>e.bitrate===s.bitrate&&e.width===s.width&&e.height===s.height)}static getMaxLevelByMediaSize(e,t,s){if(!(e!=null&&e.length))return-1;const n=(c,d)=>d?c.width!==d.width||c.height!==d.height:!0;let r=e.length-1;const l=Math.max(t,s);for(let c=0;c<e.length;c+=1){const d=e[c];if((d.width>=l||d.height>=l)&&n(d,e[c+1])){r=c;break}}return r}}const bk={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"},Zs=bk,Tk={HLS:"h"},Ek=Tk;class gn{constructor(e,t){Array.isArray(e)&&(e=e.map(s=>s instanceof gn?s:new gn(s))),this.value=e,this.params=t}}const Ak="Dict";function _k(i){return Array.isArray(i)?JSON.stringify(i):i instanceof Map?"Map{}":i instanceof Set?"Set{}":typeof i=="object"?JSON.stringify(i):String(i)}function Ik(i,e,t,s){return new Error(`failed to ${i} "${_k(e)}" as ${t}`,{cause:s})}function yn(i,e,t){return Ik("serialize",i,e,t)}class qb{constructor(e){this.description=e}}const Ix="Bare Item",Rk="Boolean";function Lk(i){if(typeof i!="boolean")throw yn(i,Rk);return i?"?1":"?0"}function wk(i){return btoa(String.fromCharCode(...i))}const Ck="Byte Sequence";function kk(i){if(ArrayBuffer.isView(i)===!1)throw yn(i,Ck);return`:${wk(i)}:`}const Nk="Integer";function Ok(i){return i<-999999999999999||999999999999999<i}function Qb(i){if(Ok(i))throw yn(i,Nk);return i.toString()}function Dk(i){return`@${Qb(i.getTime()/1e3)}`}function Wb(i,e){if(i<0)return-Wb(-i,e);const t=Math.pow(10,e);if(Math.abs(i*t%1-.5)<Number.EPSILON){const n=Math.floor(i*t);return(n%2===0?n:n+1)/t}else return Math.round(i*t)/t}const Pk="Decimal";function Uk(i){const e=Wb(i,3);if(Math.floor(Math.abs(e)).toString().length>12)throw yn(i,Pk);const t=e.toString();return t.includes(".")?t:`${t}.0`}const Mk="String",jk=/[\x00-\x1f\x7f]+/;function Fk(i){if(jk.test(i))throw yn(i,Mk);return`"${i.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}function Bk(i){return i.description||i.toString().slice(7,-1)}const Vk="Token";function Rx(i){const e=Bk(i);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(e)===!1)throw yn(e,Vk);return e}function dm(i){switch(typeof i){case"number":if(!ke(i))throw yn(i,Ix);return Number.isInteger(i)?Qb(i):Uk(i);case"string":return Fk(i);case"symbol":return Rx(i);case"boolean":return Lk(i);case"object":if(i instanceof Date)return Dk(i);if(i instanceof Uint8Array)return kk(i);if(i instanceof qb)return Rx(i);default:throw yn(i,Ix)}}const $k="Key";function hm(i){if(/^[a-z*][a-z0-9\-_.*]*$/.test(i)===!1)throw yn(i,$k);return i}function sp(i){return i==null?"":Object.entries(i).map(([e,t])=>t===!0?`;${hm(e)}`:`;${hm(e)}=${dm(t)}`).join("")}function Xb(i){return i instanceof gn?`${dm(i.value)}${sp(i.params)}`:dm(i)}function Gk(i){return`(${i.value.map(Xb).join(" ")})${sp(i.params)}`}function Hk(i,e={whitespace:!0}){if(typeof i!="object"||i==null)throw yn(i,Ak);const t=i instanceof Map?i.entries():Object.entries(i),s=e?.whitespace?" ":"";return Array.from(t).map(([n,r])=>{r instanceof gn||(r=new gn(r));let l=hm(n);return r.value===!0?l+=sp(r.params):(l+="=",Array.isArray(r.value)?l+=Gk(r):l+=Xb(r)),l}).join(`,${s}`)}function Zb(i,e){return Hk(i,e)}const dn="CMCD-Object",es="CMCD-Request",za="CMCD-Session",ba="CMCD-Status",zk={br:dn,ab:dn,d:dn,ot:dn,tb:dn,tpb:dn,lb:dn,tab:dn,lab:dn,url:dn,pb:es,bl:es,tbl:es,dl:es,ltc:es,mtp:es,nor:es,nrr:es,rc:es,sn:es,sta:es,su:es,ttfb:es,ttfbb:es,ttlb:es,cmsdd:es,cmsds:es,smrt:es,df:es,cs:es,ts:es,cid:za,pr:za,sf:za,sid:za,st:za,v:za,msd:za,bs:ba,bsd:ba,cdn:ba,rtp:ba,bg:ba,pt:ba,ec:ba,e:ba},Kk={REQUEST:es};function Yk(i){return Object.keys(i).reduce((e,t)=>{var s;return(s=i[t])===null||s===void 0||s.forEach(n=>e[n]=t),e},{})}function qk(i,e){const t={};if(!i)return t;const s=Object.keys(i),n=e?Yk(e):{};return s.reduce((r,l)=>{var c;const d=zk[l]||n[l]||Kk.REQUEST,u=(c=r[d])!==null&&c!==void 0?c:r[d]={};return u[l]=i[l],r},t)}function Qk(i){return["ot","sf","st","e","sta"].includes(i)}function Wk(i){return typeof i=="number"?ke(i):i!=null&&i!==""&&i!==!1}const Jb="event";function Xk(i,e){const t=new URL(i),s=new URL(e);if(t.origin!==s.origin)return i;const n=t.pathname.split("/").slice(1),r=s.pathname.split("/").slice(1,-1);for(;n[0]===r[0];)n.shift(),r.shift();for(;r.length;)r.shift(),n.unshift("..");return n.join("/")+t.search+t.hash}const mu=i=>Math.round(i),fm=(i,e)=>Array.isArray(i)?i.map(t=>fm(t,e)):i instanceof gn&&typeof i.value=="string"?new gn(fm(i.value,e),i.params):(e.baseUrl&&(i=Xk(i,e.baseUrl)),e.version===1?encodeURIComponent(i):i),Qc=i=>mu(i/100)*100,Zk=(i,e)=>{let t=i;return e.version>=2&&(i instanceof gn&&typeof i.value=="string"?t=new gn([i]):typeof i=="string"&&(t=[i])),fm(t,e)},Jk={br:mu,d:mu,bl:Qc,dl:Qc,mtp:Qc,nor:Zk,rtp:Qc,tb:mu},eT="request",tT="response",ip=["ab","bg","bl","br","bs","bsd","cdn","cid","cs","df","ec","lab","lb","ltc","msd","mtp","pb","pr","pt","sf","sid","sn","st","sta","tab","tb","tbl","tpb","ts","v"],eN=["e"],tN=/^[a-zA-Z0-9-.]+-[a-zA-Z0-9-.]+$/;function Wu(i){return tN.test(i)}function sN(i){return ip.includes(i)||eN.includes(i)||Wu(i)}const sT=["d","dl","nor","ot","rtp","su"];function iN(i){return ip.includes(i)||sT.includes(i)||Wu(i)}const nN=["cmsdd","cmsds","rc","smrt","ttfb","ttfbb","ttlb","url"];function aN(i){return ip.includes(i)||sT.includes(i)||nN.includes(i)||Wu(i)}const rN=["bl","br","bs","cid","d","dl","mtp","nor","nrr","ot","pr","rtp","sf","sid","st","su","tb","v"];function lN(i){return rN.includes(i)||Wu(i)}const oN={[tT]:aN,[Jb]:sN,[eT]:iN};function iT(i,e={}){const t={};if(i==null||typeof i!="object")return t;const s=e.version||i.v||1,n=e.reportingMode||eT,r=s===1?lN:oN[n];let l=Object.keys(i).filter(r);const c=e.filter;typeof c=="function"&&(l=l.filter(c));const d=n===tT||n===Jb;d&&!l.includes("ts")&&l.push("ts"),s>1&&!l.includes("v")&&l.push("v");const u=Ot({},Jk,e.formatters),f={version:s,reportingMode:n,baseUrl:e.baseUrl};return l.sort().forEach(g=>{let y=i[g];const x=u[g];if(typeof x=="function"&&(y=x(y,f)),g==="v"){if(s===1)return;y=s}g=="pr"&&y===1||(d&&g==="ts"&&!ke(y)&&(y=Date.now()),Wk(y)&&(Qk(g)&&typeof y=="string"&&(y=new qb(y)),t[g]=y))}),t}function cN(i,e={}){const t={};if(!i)return t;const s=iT(i,e),n=qk(s,e?.customHeaderMap);return Object.entries(n).reduce((r,[l,c])=>{const d=Zb(c,{whitespace:!1});return d&&(r[l]=d),r},t)}function uN(i,e,t){return Ot(i,cN(e,t))}const dN="CMCD";function hN(i,e={}){return i?Zb(iT(i,e),{whitespace:!1}):""}function fN(i,e={}){if(!i)return"";const t=hN(i,e);return encodeURIComponent(t)}function mN(i,e={}){if(!i)return"";const t=fN(i,e);return`${dN}=${t}`}const Lx=/CMCD=[^&#]+/;function pN(i,e,t){const s=mN(e,t);if(!s)return i;if(Lx.test(i))return i.replace(Lx,s);const n=i.includes("?")?"&":"?";return`${i}${n}${s}`}class gN{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=n=>{try{this.apply(n,{ot:Zs.MANIFEST,su:!this.initialized})}catch(r){this.hls.logger.warn("Could not generate manifest CMCD data.",r)}},this.applyFragmentData=n=>{try{const{frag:r,part:l}=n,c=this.hls.levels[r.level],d=this.getObjectType(r),u={d:(l||r).duration*1e3,ot:d};(d===Zs.VIDEO||d===Zs.AUDIO||d==Zs.MUXED)&&(u.br=c.bitrate/1e3,u.tb=this.getTopBandwidth(d)/1e3,u.bl=this.getBufferLength(d));const f=l?this.getNextPart(l):this.getNextFrag(r);f!=null&&f.url&&f.url!==r.url&&(u.nor=f.url),this.apply(n,u)}catch(r){this.hls.logger.warn("Could not generate segment CMCD data.",r)}},this.hls=e;const t=this.config=e.config,{cmcd:s}=t;s!=null&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=s.sessionId||e.sessionId,this.cid=s.contentId,this.useHeaders=s.useHeaders===!0,this.includeKeys=s.includeKeys,this.registerListeners())}registerListeners(){const e=this.hls;e.on(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(L.MEDIA_DETACHED,this.onMediaDetached,this),e.on(L.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(L.MEDIA_DETACHED,this.onMediaDetached,this),e.off(L.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var s,n;this.audioBuffer=(s=t.tracks.audio)==null?void 0:s.buffer,this.videoBuffer=(n=t.tracks.video)==null?void 0:n.buffer}createData(){var e;return{v:1,sf:Ek.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)==null?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){Ot(t,this.createData());const s=t.ot===Zs.INIT||t.ot===Zs.VIDEO||t.ot===Zs.MUXED;this.starved&&s&&(t.bs=!0,t.su=!0,this.starved=!1),t.su==null&&(t.su=this.buffering);const{includeKeys:n}=this;n&&(t=Object.keys(t).reduce((l,c)=>(n.includes(c)&&(l[c]=t[c]),l),{}));const r={baseUrl:e.url};this.useHeaders?(e.headers||(e.headers={}),uN(e.headers,t,r)):e.url=pN(e.url,t,r)}getNextFrag(e){var t;const s=(t=this.hls.levels[e.level])==null?void 0:t.details;if(s){const n=e.sn-s.startSN;return s.fragments[n+1]}}getNextPart(e){var t;const{index:s,fragment:n}=e,r=(t=this.hls.levels[n.level])==null||(t=t.details)==null?void 0:t.partList;if(r){const{sn:l}=n;for(let c=r.length-1;c>=0;c--){const d=r[c];if(d.index===s&&d.fragment.sn===l)return r[c+1]}}}getObjectType(e){const{type:t}=e;if(t==="subtitle")return Zs.TIMED_TEXT;if(e.sn==="initSegment")return Zs.INIT;if(t==="audio")return Zs.AUDIO;if(t==="main")return this.hls.audioTracks.length?Zs.VIDEO:Zs.MUXED}getTopBandwidth(e){let t=0,s;const n=this.hls;if(e===Zs.AUDIO)s=n.audioTracks;else{const r=n.maxAutoLevel,l=r>-1?r+1:n.levels.length;s=n.levels.slice(0,l)}return s.forEach(r=>{r.bitrate>t&&(t=r.bitrate)}),t>0?t:NaN}getBufferLength(e){const t=this.media,s=e===Zs.AUDIO?this.audioBuffer:this.videoBuffer;return!s||!t?NaN:Xe.bufferInfo(s,t.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){const{pLoader:e}=this.config,t=this.applyPlaylistData,s=e||this.config.loader;return class{constructor(r){this.loader=void 0,this.loader=new s(r)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(r,l,c){t(r),this.loader.load(r,l,c)}}}createFragmentLoader(){const{fLoader:e}=this.config,t=this.applyFragmentData,s=e||this.config.loader;return class{constructor(r){this.loader=void 0,this.loader=new s(r)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(r,l,c){t(r),this.loader.load(r,l,c)}}}}const yN=3e5;class vN extends Vi{constructor(e){super("content-steering",e.logger),this.hls=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this._pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(L.MANIFEST_PARSED,this.onManifestParsed,this),e.on(L.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(L.MANIFEST_PARSED,this.onManifestParsed,this),e.off(L.ERROR,this.onError,this))}pathways(){return(this.levels||[]).reduce((e,t)=>(e.indexOf(t.pathwayId)===-1&&e.push(t.pathwayId),e),[])}get pathwayPriority(){return this._pathwayPriority}set pathwayPriority(e){this.updatePathwayPriority(e)}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const e=this.timeToLoad*1e3-(performance.now()-this.updated);if(e>0){this.scheduleRefresh(this.uri,e);return}}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const t=this.levels;t&&(this.levels=t.filter(s=>s!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){const{contentSteering:s}=t;s!==null&&(this.pathwayId=s.pathwayId,this.uri=s.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){const{errorAction:s}=t;if(s?.action===ws.SendAlternateToPenaltyBox&&s.flags===gi.MoveAllAlternatesMatchingHost){const n=this.levels;let r=this._pathwayPriority,l=this.pathwayId;if(t.context){const{groupId:c,pathwayId:d,type:u}=t.context;c&&n?l=this.getPathwayForGroupId(c,u,l):d&&(l=d)}l in this.penalizedPathways||(this.penalizedPathways[l]=performance.now()),!r&&n&&(r=this.pathways()),r&&r.length>1&&(this.updatePathwayPriority(r),s.resolved=this.pathwayId!==l),t.details===W.BUFFER_APPEND_ERROR&&!t.fatal?s.resolved=!0:s.resolved||this.warn(`Could not resolve ${t.details} ("${t.error.message}") with content-steering for Pathway: ${l} levels: ${n&&n.length} priorities: ${Ut(r)} penalized: ${Ut(this.penalizedPathways)}`)}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(t.length===0){const s=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${s}"`),t=this.getLevelsForPathway(s),this.pathwayId=s}return t.length!==e.length&&this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t}getLevelsForPathway(e){return this.levels===null?[]:this.levels.filter(t=>e===t.pathwayId)}updatePathwayPriority(e){this._pathwayPriority=e;let t;const s=this.penalizedPathways,n=performance.now();Object.keys(s).forEach(r=>{n-s[r]>yN&&delete s[r]});for(let r=0;r<e.length;r++){const l=e[r];if(l in s)continue;if(l===this.pathwayId)return;const c=this.hls.nextLoadLevel,d=this.hls.levels[c];if(t=this.getLevelsForPathway(l),t.length>0){this.log(`Setting Pathway to "${l}"`),this.pathwayId=l,Eb(t),this.hls.trigger(L.LEVELS_UPDATED,{levels:t});const u=this.hls.levels[c];d&&u&&this.levels&&(u.attrs["STABLE-VARIANT-ID"]!==d.attrs["STABLE-VARIANT-ID"]&&u.bitrate!==d.bitrate&&this.log(`Unstable Pathways change from bitrate ${d.bitrate} to ${u.bitrate}`),this.hls.nextLoadLevel=c);break}}}getPathwayForGroupId(e,t,s){const n=this.getLevelsForPathway(s).concat(this.levels||[]);for(let r=0;r<n.length;r++)if(t===at.AUDIO_TRACK&&n[r].hasAudioGroup(e)||t===at.SUBTITLE_TRACK&&n[r].hasSubtitleGroup(e))return n[r].pathwayId;return s}clonePathways(e){const t=this.levels;if(!t)return;const s={},n={};e.forEach(r=>{const{ID:l,"BASE-ID":c,"URI-REPLACEMENT":d}=r;if(t.some(f=>f.pathwayId===l))return;const u=this.getLevelsForPathway(c).map(f=>{const g=new qt(f.attrs);g["PATHWAY-ID"]=l;const y=g.AUDIO&&`${g.AUDIO}_clone_${l}`,x=g.SUBTITLES&&`${g.SUBTITLES}_clone_${l}`;y&&(s[g.AUDIO]=y,g.AUDIO=y),x&&(n[g.SUBTITLES]=x,g.SUBTITLES=x);const S=nT(f.uri,g["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",d),E=new co({attrs:g,audioCodec:f.audioCodec,bitrate:f.bitrate,height:f.height,name:f.name,url:S,videoCodec:f.videoCodec,width:f.width});if(f.audioGroups)for(let T=1;T<f.audioGroups.length;T++)E.addGroupId("audio",`${f.audioGroups[T]}_clone_${l}`);if(f.subtitleGroups)for(let T=1;T<f.subtitleGroups.length;T++)E.addGroupId("text",`${f.subtitleGroups[T]}_clone_${l}`);return E});t.push(...u),wx(this.audioTracks,s,d,l),wx(this.subtitleTracks,n,d,l)})}loadSteeringManifest(e){const t=this.hls.config,s=t.loader;this.loader&&this.loader.destroy(),this.loader=new s(t);let n;try{n=new self.URL(e)}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${e}`);return}if(n.protocol!=="data:"){const f=(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate)|0;n.searchParams.set("_HLS_pathway",this.pathwayId),n.searchParams.set("_HLS_throughput",""+f)}const r={responseType:"json",url:n.href},l=t.steeringManifestLoadPolicy.default,c=l.errorRetry||l.timeoutRetry||{},d={loadPolicy:l,timeout:l.maxLoadTimeMs,maxRetry:c.maxNumRetry||0,retryDelay:c.retryDelayMs||0,maxRetryDelay:c.maxRetryDelayMs||0},u={onSuccess:(f,g,y,x)=>{this.log(`Loaded steering manifest: "${n}"`);const S=f.data;if(S?.VERSION!==1){this.log(`Steering VERSION ${S.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=S.TTL;const{"RELOAD-URI":E,"PATHWAY-CLONES":T,"PATHWAY-PRIORITY":A}=S;if(E)try{this.uri=new self.URL(E,n).href}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${E}`);return}this.scheduleRefresh(this.uri||y.url),T&&this.clonePathways(T);const I={steeringManifest:S,url:n.toString()};this.hls.trigger(L.STEERING_MANIFEST_LOADED,I),A&&this.updatePathwayPriority(A)},onError:(f,g,y,x)=>{if(this.log(`Error loading steering manifest: ${f.code} ${f.text} (${g.url})`),this.stopLoad(),f.code===410){this.enabled=!1,this.log(`Steering manifest ${g.url} no longer available`);return}let S=this.timeToLoad*1e3;if(f.code===429){const E=this.loader;if(typeof E?.getResponseHeader=="function"){const T=E.getResponseHeader("Retry-After");T&&(S=parseFloat(T)*1e3)}this.log(`Steering manifest ${g.url} rate limited`);return}this.scheduleRefresh(this.uri||g.url,S)},onTimeout:(f,g,y)=>{this.log(`Timeout loading steering manifest (${g.url})`),this.scheduleRefresh(this.uri||g.url)}};this.log(`Requesting steering manifest: ${n}`),this.loader.load(r,d,u)}scheduleRefresh(e,t=this.timeToLoad*1e3){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var s;const n=(s=this.hls)==null?void 0:s.media;if(n&&!n.ended){this.loadSteeringManifest(e);return}this.scheduleRefresh(e,this.timeToLoad*1e3)},t)}}function wx(i,e,t,s){i&&Object.keys(e).forEach(n=>{const r=i.filter(l=>l.groupId===n).map(l=>{const c=Ot({},l);return c.details=void 0,c.attrs=new qt(c.attrs),c.url=c.attrs.URI=nT(l.url,l.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",t),c.groupId=c.attrs["GROUP-ID"]=e[n],c.attrs["PATHWAY-ID"]=s,c});i.push(...r)})}function nT(i,e,t,s){const{HOST:n,PARAMS:r,[t]:l}=s;let c;e&&(c=l?.[e],c&&(i=c));const d=new self.URL(i);return n&&!c&&(d.host=n),r&&Object.keys(r).sort().forEach(u=>{u&&d.searchParams.set(u,r[u])}),d.href}class qr extends Vi{constructor(e){super("eme",e.logger),this.hls=void 0,this.config=void 0,this.media=null,this.mediaResolved=void 0,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.mediaKeys=null,this.setMediaKeysQueue=qr.CDMCleanupPromise?[qr.CDMCleanupPromise]:[],this.bannedKeyIds={},this.onMediaEncrypted=t=>{const{initDataType:s,initData:n}=t,r=`"${t.type}" event: init data type: "${s}"`;if(this.debug(r),n!==null){if(!this.keyFormatPromise){let l=Object.keys(this.keySystemAccessPromises);l.length||(l=to(this.config));const c=l.map(Af).filter(d=>!!d);this.keyFormatPromise=this.getKeyFormatPromise(c)}this.keyFormatPromise.then(l=>{const c=du(l);if(s!=="sinf"||c!==Qt.FAIRPLAY){this.log(`Ignoring "${t.type}" event with init data type: "${s}" for selected key-system ${c}`);return}let d;try{const x=ys(new Uint8Array(n)),S=zm(JSON.parse(x).sinf),E=ZS(S);if(!E)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");d=new Uint8Array(E.subarray(8,24))}catch(x){this.warn(`${r} Failed to parse sinf: ${x}`);return}const u=Cs(d),{keyIdToKeySessionPromise:f,mediaKeySessions:g}=this;let y=f[u];for(let x=0;x<g.length;x++){const S=g[x],E=S.decryptdata;if(!E.keyId)continue;const T=Cs(E.keyId);if(Cu(d,E.keyId)||E.uri.replace(/-/g,"").indexOf(u)!==-1){if(y=f[T],!y)continue;if(E.pssh)break;delete f[T],E.pssh=new Uint8Array(n),E.keyId=d,y=f[u]=y.then(()=>this.generateRequestWithPreferredKeySession(S,s,n,"encrypted-event-key-match")),y.catch(A=>this.handleError(A));break}}y||this.handleError(new Error(`Key ID ${u} not encountered in playlist. Key-system sessions ${g.length}.`))}).catch(l=>this.handleError(l))}},this.onWaitingForKey=t=>{this.log(`"${t.type}" event`)},this.hls=e,this.config=e.config,this.registerListeners()}destroy(){this.onDestroying(),this.onMediaDetached();const e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onMediaEncrypted=this.onWaitingForKey=null}registerListeners(){this.hls.on(L.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(L.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(L.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(L.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.on(L.DESTROYING,this.onDestroying,this)}unregisterListeners(){this.hls.off(L.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(L.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(L.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(L.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.off(L.DESTROYING,this.onDestroying,this)}getLicenseServerUrl(e){const{drmSystems:t,widevineLicenseUrl:s}=this.config,n=t?.[e];if(n)return n.licenseUrl;if(e===Qt.WIDEVINE&&s)return s}getLicenseServerUrlOrThrow(e){const t=this.getLicenseServerUrl(e);if(t===void 0)throw new Error(`no license server URL configured for key-system "${e}"`);return t}getServerCertificateUrl(e){const{drmSystems:t}=this.config,s=t?.[e];if(s)return s.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){const t=this.hls.levels,s=(l,c,d)=>!!l&&d.indexOf(l)===c,n=t.map(l=>l.audioCodec).filter(s),r=t.map(l=>l.videoCodec).filter(s);return n.length+r.length===0&&r.push("avc1.42e01e"),new Promise((l,c)=>{const d=u=>{const f=u.shift();this.getMediaKeysPromise(f,n,r).then(g=>l({keySystem:f,mediaKeys:g})).catch(g=>{u.length?d(u):g instanceof pi?c(g):c(new pi({type:je.KEY_SYSTEM_ERROR,details:W.KEY_SYSTEM_NO_ACCESS,error:g,fatal:!0},g.message))})};d(e)})}requestMediaKeySystemAccess(e,t){const{requestMediaKeySystemAccessFunc:s}=this.config;if(typeof s!="function"){let n=`Configured requestMediaKeySystemAccess is not a function ${s}`;return pb===null&&self.location.protocol==="http:"&&(n=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(n))}return s(e,t)}getMediaKeysPromise(e,t,s){var n;const r=Zw(e,t,s,this.config.drmSystemOptions||{});let l=this.keySystemAccessPromises[e],c=(n=l)==null?void 0:n.keySystemAccess;if(!c){this.log(`Requesting encrypted media "${e}" key-system access with config: ${Ut(r)}`),c=this.requestMediaKeySystemAccess(e,r);const d=l=this.keySystemAccessPromises[e]={keySystemAccess:c};return c.catch(u=>{this.log(`Failed to obtain access to key-system "${e}": ${u}`)}),c.then(u=>{this.log(`Access for key-system "${u.keySystem}" obtained`);const f=this.fetchServerCertificate(e);this.log(`Create media-keys for "${e}"`);const g=d.mediaKeys=u.createMediaKeys().then(y=>(this.log(`Media-keys created for "${e}"`),d.hasMediaKeys=!0,f.then(x=>x?this.setMediaKeysServerCertificate(y,e,x):y)));return g.catch(y=>{this.error(`Failed to create media-keys for "${e}"}: ${y}`)}),g})}return c.then(()=>l.mediaKeys)}createMediaKeySessionContext({decryptdata:e,keySystem:t,mediaKeys:s}){this.log(`Creating key-system session "${t}" keyId: ${Cs(e.keyId||[])} keyUri: ${e.uri}`);const n=s.createSession(),r={decryptdata:e,keySystem:t,mediaKeys:s,mediaKeysSession:n,keyStatus:"status-pending"};return this.mediaKeySessions.push(r),r}renewKeySession(e){const t=e.decryptdata;if(t.pssh){const s=this.createMediaKeySessionContext(e),n=Wc(t),r="cenc";this.keyIdToKeySessionPromise[n]=this.generateRequestWithPreferredKeySession(s,r,t.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}updateKeySession(e,t){const s=e.mediaKeysSession;return this.log(`Updating key-session "${s.sessionId}" for keyId ${Cs(e.decryptdata.keyId||[])}
      } (data length: ${t.byteLength})`),s.update(t)}getSelectedKeySystemFormats(){return Object.keys(this.keySystemAccessPromises).map(e=>({keySystem:e,hasMediaKeys:this.keySystemAccessPromises[e].hasMediaKeys})).filter(({hasMediaKeys:e})=>!!e).map(({keySystem:e})=>Af(e)).filter(e=>!!e)}getKeySystemAccess(e){return this.getKeySystemSelectionPromise(e).then(({keySystem:t,mediaKeys:s})=>this.attemptSetMediaKeys(t,s))}selectKeySystem(e){return new Promise((t,s)=>{this.getKeySystemSelectionPromise(e).then(({keySystem:n})=>{const r=Af(n);r?t(r):s(new Error(`Unable to find format for key-system "${n}"`))}).catch(s)})}selectKeySystemFormat(e){const t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${t.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){const t=to(this.config),s=e.map(du).filter(n=>!!n&&t.indexOf(n)!==-1);return this.selectKeySystem(s)}getKeyStatus(e){const{mediaKeySessions:t}=this;for(let s=0;s<t.length;s++){const n=xN(e,t[s]);if(n)return n}}loadKey(e){const t=e.keyInfo.decryptdata,s=Wc(t),n=this.bannedKeyIds[s];if(n||this.getKeyStatus(t)==="internal-error"){const c=Cx(n||"internal-error",t);return this.handleError(c,e.frag),Promise.reject(c)}const r=`(keyId: ${s} format: "${t.keyFormat}" method: ${t.method} uri: ${t.uri})`;this.log(`Starting session for key ${r}`);const l=this.keyIdToKeySessionPromise[s];if(!l){const c=this.getKeySystemForKeyPromise(t).then(({keySystem:d,mediaKeys:u})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${r}`),this.attemptSetMediaKeys(d,u).then(()=>(this.throwIfDestroyed(),this.createMediaKeySessionContext({keySystem:d,mediaKeys:u,decryptdata:t}))))).then(d=>{const u="cenc",f=t.pssh?t.pssh.buffer:null;return this.generateRequestWithPreferredKeySession(d,u,f,"playlist-key")});return c.catch(d=>this.handleError(d,e.frag)),this.keyIdToKeySessionPromise[s]=c,c}return l.catch(c=>{if(c instanceof pi){const d=Lt({},c.data);this.getKeyStatus(t)==="internal-error"&&(d.decryptdata=t);const u=new pi(d,c.message);this.handleError(u,e.frag)}}),l}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(e,t){if(this.hls)if(e instanceof pi){t&&(e.data.frag=t);const s=e.data.decryptdata;this.error(`${e.message}${s?` (${Cs(s.keyId||[])})`:""}`),this.hls.trigger(L.ERROR,e.data)}else this.error(e.message),this.hls.trigger(L.ERROR,{type:je.KEY_SYSTEM_ERROR,details:W.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0})}getKeySystemForKeyPromise(e){const t=Wc(e),s=this.keyIdToKeySessionPromise[t];if(!s){const n=du(e.keyFormat),r=n?[n]:to(this.config);return this.attemptKeySystemAccess(r)}return s}getKeySystemSelectionPromise(e){if(e.length||(e=to(this.config)),e.length===0)throw new pi({type:je.KEY_SYSTEM_ERROR,details:W.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${Ut({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}attemptSetMediaKeys(e,t){if(this.mediaResolved=void 0,this.mediaKeys===t)return Promise.resolve();const s=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);const n=Promise.all(s).then(()=>this.media?this.media.setMediaKeys(t):new Promise((r,l)=>{this.mediaResolved=()=>{if(this.mediaResolved=void 0,!this.media)return l(new Error("Attempted to set mediaKeys without media element attached"));this.mediaKeys=t,this.media.setMediaKeys(t).then(r).catch(l)}}));return this.mediaKeys=t,this.setMediaKeysQueue.push(n),n.then(()=>{this.log(`Media-keys set for "${e}"`),s.push(n),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(r=>s.indexOf(r)===-1)})}generateRequestWithPreferredKeySession(e,t,s,n){var r;const l=(r=this.config.drmSystems)==null||(r=r[e.keySystem])==null?void 0:r.generateRequest;if(l)try{const S=l.call(this.hls,t,s,e);if(!S)throw new Error("Invalid response from configured generateRequest filter");t=S.initDataType,s=S.initData?S.initData:null,e.decryptdata.pssh=s?new Uint8Array(s):null}catch(S){if(this.warn(S.message),this.hls&&this.hls.config.debug)throw S}if(s===null)return this.log(`Skipping key-session request for "${n}" (no initData)`),Promise.resolve(e);const c=Wc(e.decryptdata),d=e.decryptdata.uri;this.log(`Generating key-session request for "${n}" keyId: ${c} URI: ${d} (init data type: ${t} length: ${s.byteLength})`);const u=new Ym,f=e._onmessage=S=>{const E=e.mediaKeysSession;if(!E){u.emit("error",new Error("invalid state"));return}const{messageType:T,message:A}=S;this.log(`"${T}" message event for session "${E.sessionId}" message size: ${A.byteLength}`),T==="license-request"||T==="license-renewal"?this.renewLicense(e,A).catch(I=>{u.eventNames().length?u.emit("error",I):this.handleError(I)}):T==="license-release"?e.keySystem===Qt.FAIRPLAY&&this.updateKeySession(e,am("acknowledged")).then(()=>this.removeSession(e)).catch(I=>this.handleError(I)):this.warn(`unhandled media key message type "${T}"`)},g=(S,E)=>{E.keyStatus=S;let T;S.startsWith("usable")?u.emit("resolved"):S==="internal-error"||S==="output-restricted"||S==="output-downscaled"?T=Cx(S,E.decryptdata):S==="expired"?T=new Error(`key expired (keyId: ${c})`):S==="released"?T=new Error("key released"):S==="status-pending"||this.warn(`unhandled key status change "${S}" (keyId: ${c})`),T&&(u.eventNames().length?u.emit("error",T):this.handleError(T))},y=e._onkeystatuseschange=S=>{if(!e.mediaKeysSession){u.emit("error",new Error("invalid state"));return}const T=this.getKeyStatuses(e);if(!Object.keys(T).some(C=>T[C]!=="status-pending"))return;if(T[c]==="expired"){this.log(`Expired key ${Ut(T)} in key-session "${e.mediaKeysSession.sessionId}"`),this.renewKeySession(e);return}let I=T[c];if(I)g(I,e);else{var _;e.keyStatusTimeouts||(e.keyStatusTimeouts={}),(_=e.keyStatusTimeouts)[c]||(_[c]=self.setTimeout(()=>{if(!e.mediaKeysSession||!this.mediaKeys)return;const k=this.getKeyStatus(e.decryptdata);if(k&&k!=="status-pending")return this.log(`No status for keyId ${c} in key-session "${e.mediaKeysSession.sessionId}". Using session key-status ${k} from other session.`),g(k,e);this.log(`key status for ${c} in key-session "${e.mediaKeysSession.sessionId}" timed out after 1000ms`),I="internal-error",g(I,e)},1e3)),this.log(`No status for keyId ${c} (${Ut(T)}).`)}};Bs(e.mediaKeysSession,"message",f),Bs(e.mediaKeysSession,"keystatuseschange",y);const x=new Promise((S,E)=>{u.on("error",E),u.on("resolved",S)});return e.mediaKeysSession.generateRequest(t,s).then(()=>{this.log(`Request generated for key-session "${e.mediaKeysSession.sessionId}" keyId: ${c} URI: ${d}`)}).catch(S=>{throw new pi({type:je.KEY_SYSTEM_ERROR,details:W.KEY_SYSTEM_NO_SESSION,error:S,decryptdata:e.decryptdata,fatal:!1},`Error generating key-session request: ${S}`)}).then(()=>x).catch(S=>(u.removeAllListeners(),this.removeSession(e).then(()=>{throw S}))).then(()=>(u.removeAllListeners(),e))}getKeyStatuses(e){const t={};return e.mediaKeysSession.keyStatuses.forEach((s,n)=>{if(typeof n=="string"&&typeof s=="object"){const c=n;n=s,s=c}const r="buffer"in n?new Uint8Array(n.buffer,n.byteOffset,n.byteLength):new Uint8Array(n);if(e.keySystem===Qt.PLAYREADY&&r.length===16){const c=Cs(r);t[c]=s,fb(r)}const l=Cs(r);s==="internal-error"&&(this.bannedKeyIds[l]=s),this.log(`key status change "${s}" for keyStatuses keyId: ${l} key-session "${e.mediaKeysSession.sessionId}"`),t[l]=s}),t}fetchServerCertificate(e){const t=this.config,s=t.loader,n=new s(t),r=this.getServerCertificateUrl(e);return r?(this.log(`Fetching server certificate for "${e}"`),new Promise((l,c)=>{const d={responseType:"arraybuffer",url:r},u=t.certLoadPolicy.default,f={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},g={onSuccess:(y,x,S,E)=>{l(y.data)},onError:(y,x,S,E)=>{c(new pi({type:je.KEY_SYSTEM_ERROR,details:W.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:S,response:Lt({url:d.url,data:void 0},y)},`"${e}" certificate request failed (${r}). Status: ${y.code} (${y.text})`))},onTimeout:(y,x,S)=>{c(new pi({type:je.KEY_SYSTEM_ERROR,details:W.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:S,response:{url:d.url,data:void 0}},`"${e}" certificate request timed out (${r})`))},onAbort:(y,x,S)=>{c(new Error("aborted"))}};n.load(d,f,g)})):Promise.resolve()}setMediaKeysServerCertificate(e,t,s){return new Promise((n,r)=>{e.setServerCertificate(s).then(l=>{this.log(`setServerCertificate ${l?"success":"not supported by CDM"} (${s.byteLength}) on "${t}"`),n(e)}).catch(l=>{r(new pi({type:je.KEY_SYSTEM_ERROR,details:W.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:l,fatal:!0},l.message))})})}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then(s=>this.updateKeySession(e,new Uint8Array(s)).catch(n=>{throw new pi({type:je.KEY_SYSTEM_ERROR,details:W.KEY_SYSTEM_SESSION_UPDATE_FAILED,decryptdata:e.decryptdata,error:n,fatal:!1},n.message)}))}unpackPlayReadyKeyMessage(e,t){const s=String.fromCharCode.apply(null,new Uint16Array(t.buffer));if(!s.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),t;const n=new DOMParser().parseFromString(s,"application/xml"),r=n.querySelectorAll("HttpHeader");if(r.length>0){let f;for(let g=0,y=r.length;g<y;g++){var l,c;f=r[g];const x=(l=f.querySelector("name"))==null?void 0:l.textContent,S=(c=f.querySelector("value"))==null?void 0:c.textContent;x&&S&&e.setRequestHeader(x,S)}}const d=n.querySelector("Challenge"),u=d?.textContent;if(!u)throw new Error("Cannot find <Challenge> in key message");return am(atob(u))}setupLicenseXHR(e,t,s,n){const r=this.config.licenseXhrSetup;return r?Promise.resolve().then(()=>{if(!s.decryptdata)throw new Error("Key removed");return r.call(this.hls,e,t,s,n)}).catch(l=>{if(!s.decryptdata)throw l;return e.open("POST",t,!0),r.call(this.hls,e,t,s,n)}).then(l=>(e.readyState||e.open("POST",t,!0),{xhr:e,licenseChallenge:l||n})):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:n}))}requestLicense(e,t){const s=this.config.keyLoadPolicy.default;return new Promise((n,r)=>{const l=this.getLicenseServerUrlOrThrow(e.keySystem);this.log(`Sending license request to URL: ${l}`);const c=new XMLHttpRequest;c.responseType="arraybuffer",c.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return r(new Error("invalid state"));if(c.readyState===4)if(c.status===200){this._requestLicenseFailureCount=0;let d=c.response;this.log(`License received ${d instanceof ArrayBuffer?d.byteLength:d}`);const u=this.config.licenseResponseCallback;if(u)try{d=u.call(this.hls,c,l,e)}catch(f){this.error(f)}n(d)}else{const d=s.errorRetry,u=d?d.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>u||c.status>=400&&c.status<500)r(new pi({type:je.KEY_SYSTEM_ERROR,details:W.KEY_SYSTEM_LICENSE_REQUEST_FAILED,decryptdata:e.decryptdata,fatal:!0,networkDetails:c,response:{url:l,data:void 0,code:c.status,text:c.statusText}},`License Request XHR failed (${l}). Status: ${c.status} (${c.statusText})`));else{const f=u-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${f} attempts left`),this.requestLicense(e,t).then(n,r)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=c,this.setupLicenseXHR(c,l,e,t).then(({xhr:d,licenseChallenge:u})=>{e.keySystem==Qt.PLAYREADY&&(u=this.unpackPlayReadyKeyMessage(d,u)),d.send(u)}).catch(r)})}onDestroying(){this.unregisterListeners(),this._clear()}onMediaAttached(e,t){if(!this.config.emeEnabled)return;const s=t.media;this.media=s,Bs(s,"encrypted",this.onMediaEncrypted),Bs(s,"waitingforkey",this.onWaitingForKey);const n=this.mediaResolved;n?n():this.mediaKeys=s.mediaKeys}onMediaDetached(){const e=this.media;e&&(ei(e,"encrypted",this.onMediaEncrypted),ei(e,"waitingforkey",this.onWaitingForKey),this.media=null,this.mediaKeys=null)}_clear(){var e;this._requestLicenseFailureCount=0,this.keyIdToKeySessionPromise={},this.bannedKeyIds={};const t=this.mediaResolved;if(t&&t(),!this.mediaKeys&&!this.mediaKeySessions.length)return;const s=this.media,n=this.mediaKeySessions.slice();this.mediaKeySessions=[],this.mediaKeys=null,Aa.clearKeyUriToKeyIdMap();const r=n.length;qr.CDMCleanupPromise=Promise.all(n.map(l=>this.removeSession(l)).concat((s==null||(e=s.setMediaKeys(null))==null?void 0:e.catch(l=>{this.log(`Could not clear media keys: ${l}`),this.hls&&this.hls.trigger(L.ERROR,{type:je.OTHER_ERROR,details:W.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:new Error(`Could not clear media keys: ${l}`)})}))||Promise.resolve())).catch(l=>{this.log(`Could not close sessions and clear media keys: ${l}`),this.hls&&this.hls.trigger(L.ERROR,{type:je.OTHER_ERROR,details:W.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close sessions and clear media keys: ${l}`)})}).then(()=>{r&&this.log("finished closing key sessions and clearing media keys")})}onManifestLoading(){this._clear()}onManifestLoaded(e,{sessionKeys:t}){if(!(!t||!this.config.emeEnabled)&&!this.keyFormatPromise){const s=t.reduce((n,r)=>(n.indexOf(r.keyFormat)===-1&&n.push(r.keyFormat),n),[]);this.log(`Selecting key-system from session-keys ${s.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(s)}}removeSession(e){const{mediaKeysSession:t,licenseXhr:s,decryptdata:n}=e;if(t){this.log(`Remove licenses and keys and close session "${t.sessionId}" keyId: ${Cs(n?.keyId||[])}`),e._onmessage&&(t.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(t.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),s&&s.readyState!==XMLHttpRequest.DONE&&s.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const r=this.mediaKeySessions.indexOf(e);r>-1&&this.mediaKeySessions.splice(r,1);const{keyStatusTimeouts:l}=e;l&&Object.keys(l).forEach(u=>self.clearTimeout(l[u]));const{drmSystemOptions:c}=this.config;return(eC(c)?new Promise((u,f)=>{self.setTimeout(()=>f(new Error("MediaKeySession.remove() timeout")),8e3),t.remove().then(u).catch(f)}):Promise.resolve()).catch(u=>{this.log(`Could not remove session: ${u}`),this.hls&&this.hls.trigger(L.ERROR,{type:je.OTHER_ERROR,details:W.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:new Error(`Could not remove session: ${u}`)})}).then(()=>t.close()).catch(u=>{this.log(`Could not close session: ${u}`),this.hls&&this.hls.trigger(L.ERROR,{type:je.OTHER_ERROR,details:W.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close session: ${u}`)})})}return Promise.resolve()}}qr.CDMCleanupPromise=void 0;function Wc(i){if(!i)throw new Error("Could not read keyId of undefined decryptdata");if(i.keyId===null)throw new Error("keyId is null");return Cs(i.keyId)}function xN(i,e){if(i.keyId&&e.mediaKeysSession.keyStatuses.has(i.keyId))return e.mediaKeysSession.keyStatuses.get(i.keyId);if(i.matches(e.decryptdata))return e.keyStatus}class pi extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}function Cx(i,e){const t=i==="output-restricted",s=t?W.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:W.KEY_SYSTEM_STATUS_INTERNAL_ERROR;return new pi({type:je.KEY_SYSTEM_ERROR,details:s,fatal:!1,decryptdata:e},t?"HDCP level output restricted":`key status changed to "${i}"`)}class SN{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(L.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(L.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListeners(){this.hls.off(L.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(L.MEDIA_DETACHING,this.onMediaDetaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){const s=this.hls.config;if(s.capLevelOnFPSDrop){const n=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=n,n&&typeof n.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),s.fpsDroppedMonitoringPeriod)}}onMediaDetaching(){this.media=null}checkFPS(e,t,s){const n=performance.now();if(t){if(this.lastTime){const r=n-this.lastTime,l=s-this.lastDroppedFrames,c=t-this.lastDecodedFrames,d=1e3*l/r,u=this.hls;if(u.trigger(L.FPS_DROP,{currentDropped:l,currentDecoded:c,totalDroppedFrames:s}),d>0&&l>u.config.fpsDroppedMonitoringThreshold*c){let f=u.currentLevel;u.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+f),f>0&&(u.autoLevelCapping===-1||u.autoLevelCapping>=f)&&(f=f-1,u.trigger(L.FPS_DROP_LEVEL_CAPPING,{level:f,droppedLevel:u.currentLevel}),u.autoLevelCapping=f,this.streamController.nextLevelSwitch())}}this.lastTime=n,this.lastDroppedFrames=s,this.lastDecodedFrames=t}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}function aT(i,e){let t;try{t=new Event("addtrack")}catch{t=document.createEvent("Event"),t.initEvent("addtrack",!1,!1)}t.track=i,e.dispatchEvent(t)}function rT(i,e){const t=i.mode;if(t==="disabled"&&(i.mode="hidden"),i.cues&&!i.cues.getCueById(e.id))try{if(i.addCue(e),!i.cues.getCueById(e.id))throw new Error(`addCue is failed for: ${e}`)}catch(s){wt.debug(`[texttrack-utils]: ${s}`);try{const n=new self.TextTrackCue(e.startTime,e.endTime,e.text);n.id=e.id,i.addCue(n)}catch(n){wt.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${n}`)}}t==="disabled"&&(i.mode=t)}function Hr(i,e){const t=i.mode;if(t==="disabled"&&(i.mode="hidden"),i.cues)for(let s=i.cues.length;s--;)e&&i.cues[s].removeEventListener("enter",e),i.removeCue(i.cues[s]);t==="disabled"&&(i.mode=t)}function mm(i,e,t,s){const n=i.mode;if(n==="disabled"&&(i.mode="hidden"),i.cues&&i.cues.length>0){const r=TN(i.cues,e,t);for(let l=0;l<r.length;l++)(!s||s(r[l]))&&i.removeCue(r[l])}n==="disabled"&&(i.mode=n)}function bN(i,e){if(e<=i[0].startTime)return 0;const t=i.length-1;if(e>i[t].endTime)return-1;let s=0,n=t,r;for(;s<=n;)if(r=Math.floor((n+s)/2),e<i[r].startTime)n=r-1;else if(e>i[r].startTime&&s<t)s=r+1;else return r;return i[s].startTime-e<e-i[n].startTime?s:n}function TN(i,e,t){const s=[],n=bN(i,e);if(n>-1)for(let r=n,l=i.length;r<l;r++){const c=i[r];if(c.startTime>=e&&c.endTime<=t)s.push(c);else if(c.startTime>t)return s}return s}function pu(i){const e=[];for(let t=0;t<i.length;t++){const s=i[t];(s.kind==="subtitles"||s.kind==="captions")&&s.label&&e.push(i[t])}return e}class EN extends ep{constructor(e){super(e,"subtitle-track-controller"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let t=null;const s=pu(this.media.textTracks);for(let r=0;r<s.length;r++)if(s[r].mode==="hidden")t=s[r];else if(s[r].mode==="showing"){t=s[r];break}const n=this.findTrackForTextTrack(t);this.subtitleTrack!==n&&this.setSubtitleTrack(n)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:e}=this;e.on(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.MANIFEST_PARSED,this.onManifestParsed,this),e.on(L.LEVEL_LOADING,this.onLevelLoading,this),e.on(L.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(L.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(L.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.MANIFEST_PARSED,this.onManifestParsed,this),e.off(L.LEVEL_LOADING,this.onLevelLoading,this),e.off(L.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(L.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(L.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(e,t){const s=this.media;if(!s)return;const n=!!t.transferMedia;if(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||s.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,n)return;pu(s.textTracks).forEach(l=>{Hr(l)})}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){const{id:s,groupId:n,details:r}=t,l=this.tracksInGroup[s];if(!l||l.groupId!==n){this.warn(`Subtitle track with id:${s} and group:${n} not found in active group ${l?.groupId}`);return}const c=l.details;l.details=t.details,this.log(`Subtitle track ${s} "${l.name}" lang:${l.lang} group:${n} loaded [${r.startSN}-${r.endSN}]`),s===this.trackId&&this.playlistLoaded(s,t,c)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const s=t.subtitleGroups||null,n=this.groupIds;let r=this.currentTrack;if(!s||n?.length!==s?.length||s!=null&&s.some(l=>n?.indexOf(l)===-1)){this.groupIds=s,this.trackId=-1,this.currentTrack=null;const l=this.tracks.filter(f=>!s||s.indexOf(f.groupId)!==-1);if(l.length)this.selectDefaultTrack&&!l.some(f=>f.default)&&(this.selectDefaultTrack=!1),l.forEach((f,g)=>{f.id=g});else if(!r&&!this.tracksInGroup.length)return;this.tracksInGroup=l;const c=this.hls.config.subtitlePreference;if(!r&&c){this.selectDefaultTrack=!1;const f=mn(c,l);if(f>-1)r=l[f];else{const g=mn(c,this.tracks);r=this.tracks[g]}}let d=this.findTrackId(r);d===-1&&r&&(d=this.findTrackId(null));const u={subtitleTracks:l};this.log(`Updating subtitle tracks, ${l.length} track(s) found in "${s?.join(",")}" group-id`),this.hls.trigger(L.SUBTITLE_TRACKS_UPDATED,u),d!==-1&&this.trackId===-1&&this.setSubtitleTrack(d)}}findTrackId(e){const t=this.tracksInGroup,s=this.selectDefaultTrack;for(let n=0;n<t.length;n++){const r=t[n];if(!(s&&!r.default||!s&&!e)&&(!e||Xa(r,e)))return n}if(e){for(let n=0;n<t.length;n++){const r=t[n];if(mo(e.attrs,r.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return n}for(let n=0;n<t.length;n++){const r=t[n];if(mo(e.attrs,r.attrs,["LANGUAGE"]))return n}}return-1}findTrackForTextTrack(e){if(e){const t=this.tracksInGroup;for(let s=0;s<t.length;s++){const n=t[s];if(um(n,e))return s}}return-1}onError(e,t){t.fatal||!t.context||t.context.type===at.SUBTITLE_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){if(e.id===-1)return this.setSubtitleTrack(-1),null;const t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){const s=this.currentTrack;if(s&&Xa(e,s))return s;const n=mn(e,this.tracksInGroup);if(n>-1){const r=this.tracksInGroup[n];return this.setSubtitleTrack(n),r}else{if(s)return null;{const r=mn(e,t);if(r>-1)return t[r]}}}}return null}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const s=e.id,n=e.groupId,r=this.getUrlWithDirectives(e.url,t),l=e.details,c=l?.age;this.log(`Loading subtitle ${s} "${e.name}" lang:${e.lang} group:${n}${t?.msn!==void 0?" at sn "+t.msn+" part "+t.part:""}${c&&l.live?" age "+c.toFixed(1)+(l.type&&" "+l.type||""):""} ${r}`),this.hls.trigger(L.SUBTITLE_TRACK_LOADING,{url:r,id:s,groupId:n,deliveryDirectives:t||null,track:e})}toggleTrackModes(){const{media:e}=this;if(!e)return;const t=pu(e.textTracks),s=this.currentTrack;let n;if(s&&(n=t.filter(r=>um(s,r))[0],n||this.warn(`Unable to find subtitle TextTrack with name "${s.name}" and language "${s.lang}"`)),[].slice.call(t).forEach(r=>{r.mode!=="disabled"&&r!==n&&(r.mode="disabled")}),n){const r=this.subtitleDisplay?"showing":"hidden";n.mode!==r&&(n.mode=r)}}setSubtitleTrack(e){const t=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(e<-1||e>=t.length||!ke(e)){this.warn(`Invalid subtitle track id: ${e}`);return}this.selectDefaultTrack=!1;const s=this.currentTrack,n=t[e]||null;if(this.trackId=e,this.currentTrack=n,this.toggleTrackModes(),!n){this.hls.trigger(L.SUBTITLE_TRACK_SWITCH,{id:e});return}const r=!!n.details&&!n.details.live;if(e===this.trackId&&n===s&&r)return;this.log(`Switching to subtitle-track ${e}`+(n?` "${n.name}" lang:${n.lang} group:${n.groupId}`:""));const{id:l,groupId:c="",name:d,type:u,url:f}=n;this.hls.trigger(L.SUBTITLE_TRACK_SWITCH,{id:l,groupId:c,name:d,type:u,url:f});const g=this.switchParams(n.url,s?.details,n.details);this.loadPlaylist(g)}}function AN(){try{return crypto.randomUUID()}catch{try{const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}catch{let t=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,n=>{const r=(t+Math.random()*16)%16|0;return t=Math.floor(t/16),(n=="x"?r:r&3|8).toString(16)})}}}function ao(i){let e=5381,t=i.length;for(;t;)e=e*33^i.charCodeAt(--t);return(e>>>0).toString()}const Qr=.025;let Du=(function(i){return i[i.Point=0]="Point",i[i.Range=1]="Range",i})({});function _N(i,e,t){return`${i.identifier}-${t+1}-${ao(e)}`}class IN{constructor(e,t){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=t,this.dateRange=e,this.setDateRange(e)}setDateRange(e){this.dateRange=e,this.resumeOffset=e.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=e.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=e.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=e.attr.enumeratedStringList("X-SNAP",this.snapOptions)}reset(){var e;this.appendInPlaceStarted=!1,(e=this.assetListLoader)==null||e.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)}isAssetPastPlayoutLimit(e){var t;if(e>0&&e>=this.assetList.length)return!0;const s=this.playoutLimit;return e<=0||isNaN(s)?!1:s===0?!0:(((t=this.assetList[e])==null?void 0:t.startOffset)||0)>s}findAssetIndex(e){return this.assetList.indexOf(e)}get identifier(){return this.dateRange.id}get startDate(){return this.dateRange.startDate}get startTime(){const e=this.dateRange.startTime;if(this.snapOptions.out){const t=this.dateRange.tagAnchor;if(t)return Of(e,t)}return e}get startOffset(){return this.cue.pre?0:this.startTime}get startIsAligned(){if(this.startTime===0||this.snapOptions.out)return!0;const e=this.dateRange.tagAnchor;if(e){const t=this.dateRange.startTime,s=Of(t,e);return t-s<.1}return!1}get resumptionOffset(){const e=this.resumeOffset,t=ke(e)?e:this.duration;return this.cumulativeDuration+t}get resumeTime(){const e=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){const t=this.resumeAnchor;if(t)return Of(e,t)}return e}get appendInPlace(){return this.appendInPlaceStarted?!0:this.appendInPlaceDisabled?!1:!!(!this.cue.once&&!this.cue.pre&&this.startIsAligned&&(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&Math.abs(this.resumeOffset-this.duration)<Qr))}set appendInPlace(e){if(this.appendInPlaceStarted){this.resetOnResume=!e;return}this.appendInPlaceDisabled=!e}get timelineStart(){return this._timelineStart!==null?this._timelineStart:this.startTime}set timelineStart(e){this._timelineStart=e}get duration(){const e=this.playoutLimit;let t;return this._duration!==null?t=this._duration:this.dateRange.duration?t=this.dateRange.duration:t=this.dateRange.plannedDuration||0,!isNaN(e)&&e<t&&(t=e),t}set duration(e){this._duration=e}get cue(){return this.dateRange.cue}get timelineOccupancy(){return this.dateRange.attr["X-TIMELINE-OCCUPIES"]==="RANGE"?Du.Range:Du.Point}get supplementsPrimary(){return this.dateRange.attr["X-TIMELINE-STYLE"]==="PRIMARY"}get contentMayVary(){return this.dateRange.attr["X-CONTENT-MAY-VARY"]!=="NO"}get assetUrl(){return this.dateRange.attr["X-ASSET-URI"]}get assetListUrl(){return this.dateRange.attr["X-ASSET-LIST"]}get baseUrl(){return this.base.url}get assetListLoaded(){return this.assetList.length>0||this.assetListResponse!==null}toString(){return RN(this)}}function Of(i,e){return i-e.start<e.duration/2&&!(Math.abs(i-(e.start+e.duration))<Qr)?e.start:e.start+e.duration}function lT(i,e,t){const s=new self.URL(i,t);return s.protocol!=="data:"&&s.searchParams.set("_HLS_primary_id",e),s}function Df(i,e){for(;(t=i.assetList[++e])!=null&&t.error;)var t;return e}function RN(i){return`["${i.identifier}" ${i.cue.pre?"<pre>":i.cue.post?"<post>":""}${i.timelineStart.toFixed(2)}-${i.resumeTime.toFixed(2)}]`}function Gr(i){const e=i.timelineStart,t=i.duration||0;return`["${i.identifier}" ${e.toFixed(2)}-${(e+t).toFixed(2)}]`}class LN{constructor(e,t,s,n){this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=()=>{this.reachedPlayout(this.currentTime)&&this.hls&&this.hls.trigger(L.PLAYOUT_LIMIT_REACHED,{})};const r=this.hls=new e(t);this.interstitial=s,this.assetItem=n;const l=()=>{this.hasDetails=!0};r.once(L.LEVEL_LOADED,l),r.once(L.AUDIO_TRACK_LOADED,l),r.once(L.SUBTITLE_TRACK_LOADED,l),r.on(L.MEDIA_ATTACHING,(c,{media:d})=>{this.removeMediaListeners(),this.mediaAttached=d,this.interstitial.playoutLimit&&(d.addEventListener("timeupdate",this.checkPlayout),this.appendInPlace&&r.on(L.BUFFER_APPENDED,()=>{const f=this.bufferedEnd;this.reachedPlayout(f)&&(this._bufferedEosTime=f,r.trigger(L.BUFFERED_TO_END,void 0))}))})}get appendInPlace(){return this.interstitial.appendInPlace}loadSource(){const e=this.hls;if(e)if(e.url)e.levels.length&&!e.started&&e.startLoad(-1,!0);else{let t=this.assetItem.uri;try{t=lT(t,e.config.primarySessionId||"").href}catch{}e.loadSource(t)}}bufferedInPlaceToEnd(e){var t;if(!this.appendInPlace)return!1;if((t=this.hls)!=null&&t.bufferedToEnd)return!0;if(!e)return!1;const s=Math.min(this._bufferedEosTime||1/0,this.duration),n=this.timelineOffset,r=Xe.bufferInfo(e,n,0);return this.getAssetTime(r.end)>=s-.02}reachedPlayout(e){const s=this.interstitial.playoutLimit;return this.startOffset+e>=s}get destroyed(){var e;return!((e=this.hls)!=null&&e.userConfig)}get assetId(){return this.assetItem.identifier}get interstitialId(){return this.assetItem.parentIdentifier}get media(){var e;return((e=this.hls)==null?void 0:e.media)||null}get bufferedEnd(){const e=this.media||this.mediaAttached;if(!e)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;const t=Xe.bufferInfo(e,e.currentTime,.001);return this.getAssetTime(t.end)}get currentTime(){const e=this.media||this.mediaAttached;return e?this.getAssetTime(e.currentTime):this._currentTime||0}get duration(){const e=this.assetItem.duration;if(!e)return 0;const t=this.interstitial.playoutLimit;if(t){const s=t-this.startOffset;if(s>0&&s<e)return s}return e}get remaining(){const e=this.duration;return e?Math.max(0,e-this.currentTime):0}get startOffset(){return this.assetItem.startOffset}get timelineOffset(){var e;return((e=this.hls)==null?void 0:e.config.timelineOffset)||0}set timelineOffset(e){const t=this.timelineOffset;if(e!==t){const s=e-t;if(Math.abs(s)>1/9e4&&this.hls){if(this.hasDetails)throw new Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=e}}}getAssetTime(e){const t=this.timelineOffset,s=this.duration;return Math.min(Math.max(0,e-t),s)}removeMediaListeners(){const e=this.mediaAttached;e&&(this._currentTime=e.currentTime,this.bufferSnapShot(),e.removeEventListener("timeupdate",this.checkPlayout))}bufferSnapShot(){if(this.mediaAttached){var e;(e=this.hls)!=null&&e.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd)}}destroy(){this.removeMediaListeners(),this.hls&&this.hls.destroy(),this.hls=null,this.tracks=this.mediaAttached=this.checkPlayout=null}attachMedia(e){var t;this.loadSource(),(t=this.hls)==null||t.attachMedia(e)}detachMedia(){var e;this.removeMediaListeners(),this.mediaAttached=null,(e=this.hls)==null||e.detachMedia()}resumeBuffering(){var e;(e=this.hls)==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.hls)==null||e.pauseBuffering()}transferMedia(){var e;return this.bufferSnapShot(),((e=this.hls)==null?void 0:e.transferMedia())||null}resetDetails(){const e=this.hls;if(e&&this.hasDetails){e.stopLoad();const t=s=>delete s.details;e.levels.forEach(t),e.allAudioTracks.forEach(t),e.allSubtitleTracks.forEach(t),this.hasDetails=!1}}on(e,t,s){var n;(n=this.hls)==null||n.on(e,t)}once(e,t,s){var n;(n=this.hls)==null||n.once(e,t)}off(e,t,s){var n;(n=this.hls)==null||n.off(e,t)}toString(){var e;return`HlsAssetPlayer: ${Gr(this.assetItem)} ${(e=this.hls)==null?void 0:e.sessionId} ${this.appendInPlace?"append-in-place":""}`}}const kx=.033;class wN extends Vi{constructor(e,t){super("interstitials-sched",t),this.onScheduleUpdate=void 0,this.eventMap={},this.events=null,this.items=null,this.durations={primary:0,playout:0,integrated:0},this.onScheduleUpdate=e}destroy(){this.reset(),this.onScheduleUpdate=null}reset(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach(e=>e.reset()),this.events=this.items=null}resetErrorsInRange(e,t){return this.events?this.events.reduce((s,n)=>e<=n.startOffset&&t>n.startOffset?(delete n.error,s+1):s,0):0}get duration(){const e=this.items;return e?e[e.length-1].end:0}get length(){return this.items?this.items.length:0}getEvent(e){return e&&this.eventMap[e]||null}hasEvent(e){return e in this.eventMap}findItemIndex(e,t){if(e.event)return this.findEventIndex(e.event.identifier);let s=-1;e.nextEvent?s=this.findEventIndex(e.nextEvent.identifier)-1:e.previousEvent&&(s=this.findEventIndex(e.previousEvent.identifier)+1);const n=this.items;if(n)for(n[s]||(t===void 0&&(t=e.start),s=this.findItemIndexAtTime(t));s>=0&&(r=n[s])!=null&&r.event;){var r;s--}return s}findItemIndexAtTime(e,t){const s=this.items;if(s)for(let n=0;n<s.length;n++){let r=s[n];if(t&&t!=="primary"&&(r=r[t]),e===r.start||e>r.start&&e<r.end)return n}return-1}findJumpRestrictedIndex(e,t){const s=this.items;if(s)for(let n=e;n<=t&&s[n];n++){const r=s[n].event;if(r!=null&&r.restrictions.jump&&!r.appendInPlace)return n}return-1}findEventIndex(e){const t=this.items;if(t)for(let n=t.length;n--;){var s;if(((s=t[n].event)==null?void 0:s.identifier)===e)return n}return-1}findAssetIndex(e,t){const s=e.assetList,n=s.length;if(n>1)for(let r=0;r<n;r++){const l=s[r];if(!l.error){const c=l.timelineStart;if(t===c||t>c&&(t<c+(l.duration||0)||r===n-1))return r}}return 0}get assetIdAtEnd(){var e;const t=(e=this.items)==null||(e=e[this.length-1])==null?void 0:e.event;if(t){const s=t.assetList,n=s[s.length-1];if(n)return n.identifier}return null}parseInterstitialDateRanges(e,t){const s=e.main.details,{dateRanges:n}=s,r=this.events,l=this.parseDateRanges(n,{url:s.url},t),c=Object.keys(n),d=r?r.filter(u=>!c.includes(u.identifier)):[];l.length&&l.sort((u,f)=>{const g=u.cue.pre,y=u.cue.post,x=f.cue.pre,S=f.cue.post;if(g&&!x)return-1;if(x&&!g||y&&!S)return 1;if(S&&!y)return-1;if(!g&&!x&&!y&&!S){const E=u.startTime,T=f.startTime;if(E!==T)return E-T}return u.dateRange.tagOrder-f.dateRange.tagOrder}),this.events=l,d.forEach(u=>{this.removeEvent(u)}),this.updateSchedule(e,d)}updateSchedule(e,t=[],s=!1){const n=this.events||[];if(n.length||t.length||this.length<2){const r=this.items,l=this.parseSchedule(n,e);(s||t.length||r?.length!==l.length||l.some((d,u)=>Math.abs(d.playout.start-r[u].playout.start)>.005||Math.abs(d.playout.end-r[u].playout.end)>.005))&&(this.items=l,this.onScheduleUpdate(t,r))}}parseDateRanges(e,t,s){const n=[],r=Object.keys(e);for(let l=0;l<r.length;l++){const c=r[l],d=e[c];if(d.isInterstitial){let u=this.eventMap[c];u?u.setDateRange(d):(u=new IN(d,t),this.eventMap[c]=u,s===!1&&(u.appendInPlace=s)),n.push(u)}}return n}parseSchedule(e,t){const s=[],n=t.main.details,r=n.live?1/0:n.edge;let l=0;if(e=e.filter(d=>!d.error&&!(d.cue.once&&d.hasPlayed)),e.length){this.resolveOffsets(e,t);let d=0,u=0;if(e.forEach((f,g)=>{const y=f.cue.pre,x=f.cue.post,S=e[g-1]||null,E=f.appendInPlace,T=x?r:f.startOffset,A=f.duration,I=f.timelineOccupancy===Du.Range?A:0,_=f.resumptionOffset,C=S?.startTime===T,k=T+f.cumulativeDuration;let D=E?k+A:T+_;if(y||!x&&T<=0){const F=u;u+=I,f.timelineStart=k;const j=l;l+=A,s.push({event:f,start:k,end:D,playout:{start:j,end:l},integrated:{start:F,end:u}})}else if(T<=r){if(!C){const U=T-d;if(U>kx){const K=d,H=u;u+=U;const ee=l;l+=U;const re={previousEvent:e[g-1]||null,nextEvent:f,start:K,end:K+U,playout:{start:ee,end:l},integrated:{start:H,end:u}};s.push(re)}else U>0&&S&&(S.cumulativeDuration+=U,s[s.length-1].end=T)}x&&(D=k),f.timelineStart=k;const F=u;u+=I;const j=l;l+=A,s.push({event:f,start:k,end:D,playout:{start:j,end:l},integrated:{start:F,end:u}})}else return;const O=f.resumeTime;x||O>r?d=r:d=O}),d<r){var c;const f=d,g=u,y=r-d;u+=y;const x=l;l+=y,s.push({previousEvent:((c=s[s.length-1])==null?void 0:c.event)||null,nextEvent:null,start:d,end:f+y,playout:{start:x,end:l},integrated:{start:g,end:u}})}this.setDurations(r,l,u)}else s.push({previousEvent:null,nextEvent:null,start:0,end:r,playout:{start:0,end:r},integrated:{start:0,end:r}}),this.setDurations(r,r,r);return s}setDurations(e,t,s){this.durations={primary:e,playout:t,integrated:s}}resolveOffsets(e,t){const s=t.main.details,n=s.live?1/0:s.edge;let r=0,l=-1;e.forEach((c,d)=>{const u=c.cue.pre,f=c.cue.post,g=u?0:f?n:c.startTime;this.updateAssetDurations(c),l===g?c.cumulativeDuration=r:(r=0,l=g),!f&&c.snapOptions.in&&(c.resumeAnchor=Ja(null,s.fragments,c.startOffset+c.resumptionOffset,0,0)||void 0),c.appendInPlace&&!c.appendInPlaceStarted&&(this.primaryCanResumeInPlaceAt(c,t)||(c.appendInPlace=!1)),!c.appendInPlace&&d+1<e.length&&e[d+1].startTime-e[d].resumeTime<kx&&(e[d+1].appendInPlace=!1,e[d+1].appendInPlace&&this.warn(`Could not change append strategy for abutting event ${c}`));const x=ke(c.resumeOffset)?c.resumeOffset:c.duration;r+=x})}primaryCanResumeInPlaceAt(e,t){const s=e.resumeTime,n=e.startTime+e.resumptionOffset;return Math.abs(s-n)>Qr?(this.log(`"${e.identifier}" resumption ${s} not aligned with estimated timeline end ${n}`),!1):!Object.keys(t).some(l=>{const c=t[l].details,d=c.edge;if(s>=d)return this.log(`"${e.identifier}" resumption ${s} past ${l} playlist end ${d}`),!1;const u=Ja(null,c.fragments,s);if(!u)return this.log(`"${e.identifier}" resumption ${s} does not align with any fragments in ${l} playlist (${c.fragStart}-${c.fragmentEnd})`),!0;const f=l==="audio"?.175:0;return Math.abs(u.start-s)<Qr+f||Math.abs(u.end-s)<Qr+f?!1:(this.log(`"${e.identifier}" resumption ${s} not aligned with ${l} fragment bounds (${u.start}-${u.end} sn: ${u.sn} cc: ${u.cc})`),!0)})}updateAssetDurations(e){if(!e.assetListLoaded)return;const t=e.timelineStart;let s=0,n=!1,r=!1;for(let l=0;l<e.assetList.length;l++){const c=e.assetList[l],d=t+s;c.startOffset=s,c.timelineStart=d,n||(n=c.duration===null),r||(r=!!c.error);const u=c.error?0:c.duration||0;s+=u}n&&!r?e.duration=Math.max(s,e.duration):e.duration=s}removeEvent(e){e.reset(),delete this.eventMap[e.identifier]}}function qi(i){return`[${i.event?'"'+i.event.identifier+'"':"primary"}: ${i.start.toFixed(2)}-${i.end.toFixed(2)}]`}class CN{constructor(e){this.hls=void 0,this.hls=e}destroy(){this.hls=null}loadAssetList(e,t){const s=e.assetListUrl;let n;try{n=lT(s,this.hls.sessionId,e.baseUrl)}catch(y){const x=this.assignAssetListError(e,W.ASSET_LIST_LOAD_ERROR,y,s);this.hls.trigger(L.ERROR,x);return}t&&n.protocol!=="data:"&&n.searchParams.set("_HLS_start_offset",""+t);const r=this.hls.config,l=r.loader,c=new l(r),d={responseType:"json",url:n.href},u=r.interstitialAssetListLoadPolicy.default,f={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},g={onSuccess:(y,x,S,E)=>{const T=y.data,A=T?.ASSETS;if(!Array.isArray(A)){const I=this.assignAssetListError(e,W.ASSET_LIST_PARSING_ERROR,new Error("Invalid interstitial asset list"),S.url,x,E);this.hls.trigger(L.ERROR,I);return}e.assetListResponse=T,this.hls.trigger(L.ASSET_LIST_LOADED,{event:e,assetListResponse:T,networkDetails:E})},onError:(y,x,S,E)=>{const T=this.assignAssetListError(e,W.ASSET_LIST_LOAD_ERROR,new Error(`Error loading X-ASSET-LIST: HTTP status ${y.code} ${y.text} (${x.url})`),x.url,E,S);this.hls.trigger(L.ERROR,T)},onTimeout:(y,x,S)=>{const E=this.assignAssetListError(e,W.ASSET_LIST_LOAD_TIMEOUT,new Error(`Timeout loading X-ASSET-LIST (${x.url})`),x.url,y,S);this.hls.trigger(L.ERROR,E)}};return c.load(d,f,g),this.hls.trigger(L.ASSET_LIST_LOADING,{event:e}),c}assignAssetListError(e,t,s,n,r,l){return e.error=s,{type:je.NETWORK_ERROR,details:t,fatal:!1,interstitial:e,url:n,error:s,networkDetails:l,stats:r}}}function Nx(i){var e;i==null||(e=i.play())==null||e.catch(()=>{})}function Xc(i,e){return`[${i}] Advancing timeline position to ${e}`}class kN extends Vi{constructor(e,t){super("interstitials",e.logger),this.HlsPlayerClass=void 0,this.hls=void 0,this.assetListLoader=void 0,this.mediaSelection=null,this.altSelection=null,this.media=null,this.detachedData=null,this.requiredTracks=null,this.manager=null,this.playerQueue=[],this.bufferedPos=-1,this.timelinePos=-1,this.schedule=void 0,this.playingItem=null,this.bufferingItem=null,this.waitingItem=null,this.endedItem=null,this.playingAsset=null,this.endedAsset=null,this.bufferingAsset=null,this.shouldPlay=!1,this.onPlay=()=>{this.shouldPlay=!0},this.onPause=()=>{this.shouldPlay=!1},this.onSeeking=()=>{const s=this.currentTime;if(s===void 0||this.playbackDisabled||!this.schedule)return;const n=s-this.timelinePos;if(Math.abs(n)<1/7056e5)return;const l=n<=-.01;this.timelinePos=s,this.bufferedPos=s;const c=this.playingItem;if(!c){this.checkBuffer();return}if(l&&this.schedule.resetErrorsInRange(s,s-n)&&this.updateSchedule(!0),this.checkBuffer(),l&&s<c.start||s>=c.end){var d;const x=this.findItemIndex(c);let S=this.schedule.findItemIndexAtTime(s);if(S===-1&&(S=x+(l?-1:1),this.log(`seeked ${l?"back ":""}to position not covered by schedule ${s} (resolving from ${x} to ${S})`)),!this.isInterstitial(c)&&(d=this.media)!=null&&d.paused&&(this.shouldPlay=!1),!l&&S>x){const E=this.schedule.findJumpRestrictedIndex(x+1,S);if(E>x){this.setSchedulePosition(E);return}}this.setSchedulePosition(S);return}const u=this.playingAsset;if(!u){if(this.playingLastItem&&this.isInterstitial(c)){const x=c.event.assetList[0];x&&(this.endedItem=this.playingItem,this.playingItem=null,this.setScheduleToAssetAtTime(s,x))}return}const f=u.timelineStart,g=u.duration||0;if(l&&s<f||s>=f+g){var y;(y=c.event)!=null&&y.appendInPlace&&(this.clearAssetPlayers(c.event,c),this.flushFrontBuffer(s)),this.setScheduleToAssetAtTime(s,u)}},this.onTimeupdate=()=>{const s=this.currentTime;if(s===void 0||this.playbackDisabled)return;if(s>this.timelinePos)this.timelinePos=s,s>this.bufferedPos&&this.checkBuffer();else return;const n=this.playingItem;if(!n||this.playingLastItem)return;if(s>=n.end){this.timelinePos=n.end;const c=this.findItemIndex(n);this.setSchedulePosition(c+1)}const r=this.playingAsset;if(!r)return;const l=r.timelineStart+(r.duration||0);s>=l&&this.setScheduleToAssetAtTime(s,r)},this.onScheduleUpdate=(s,n)=>{const r=this.schedule;if(!r)return;const l=this.playingItem,c=r.events||[],d=r.items||[],u=r.durations,f=s.map(E=>E.identifier),g=!!(c.length||f.length);(g||n)&&this.log(`INTERSTITIALS_UPDATED (${c.length}): ${c}
Schedule: ${d.map(E=>qi(E))} pos: ${this.timelinePos}`),f.length&&this.log(`Removed events ${f}`);let y=null,x=null;l&&(y=this.updateItem(l,this.timelinePos),this.itemsMatch(l,y)?this.playingItem=y:this.waitingItem=this.endedItem=null),this.waitingItem=this.updateItem(this.waitingItem),this.endedItem=this.updateItem(this.endedItem);const S=this.bufferingItem;if(S&&(x=this.updateItem(S,this.bufferedPos),this.itemsMatch(S,x)?this.bufferingItem=x:S.event&&(this.bufferingItem=this.playingItem,this.clearInterstitial(S.event,null))),s.forEach(E=>{E.assetList.forEach(T=>{this.clearAssetPlayer(T.identifier,null)})}),this.playerQueue.forEach(E=>{if(E.interstitial.appendInPlace){const T=E.assetItem.timelineStart,A=E.timelineOffset-T;if(A)try{E.timelineOffset=T}catch(I){Math.abs(A)>Qr&&this.warn(`${I} ("${E.assetId}" ${E.timelineOffset}->${T})`)}}}),g||n){if(this.hls.trigger(L.INTERSTITIALS_UPDATED,{events:c.slice(0),schedule:d.slice(0),durations:u,removedIds:f}),this.isInterstitial(l)&&f.includes(l.event.identifier)){this.warn(`Interstitial "${l.event.identifier}" removed while playing`),this.primaryFallback(l.event);return}l&&this.trimInPlace(y,l),S&&x!==y&&this.trimInPlace(x,S),this.checkBuffer()}},this.hls=e,this.HlsPlayerClass=t,this.assetListLoader=new CN(e),this.schedule=new wN(this.onScheduleUpdate,e.logger),this.registerListeners()}registerListeners(){const e=this.hls;e&&(e.on(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(L.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(L.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.on(L.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(L.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.on(L.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.on(L.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.on(L.BUFFER_APPENDED,this.onBufferAppended,this),e.on(L.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(L.BUFFERED_TO_END,this.onBufferedToEnd,this),e.on(L.MEDIA_ENDED,this.onMediaEnded,this),e.on(L.ERROR,this.onError,this),e.on(L.DESTROYING,this.onDestroying,this))}unregisterListeners(){const e=this.hls;e&&(e.off(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(L.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(L.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.off(L.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(L.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.off(L.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.off(L.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.off(L.BUFFER_CODECS,this.onBufferCodecs,this),e.off(L.BUFFER_APPENDED,this.onBufferAppended,this),e.off(L.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(L.BUFFERED_TO_END,this.onBufferedToEnd,this),e.off(L.MEDIA_ENDED,this.onMediaEnded,this),e.off(L.ERROR,this.onError,this),e.off(L.DESTROYING,this.onDestroying,this))}startLoad(){this.resumeBuffering()}stopLoad(){this.pauseBuffering()}resumeBuffering(){var e;(e=this.getBufferingPlayer())==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.getBufferingPlayer())==null||e.pauseBuffering()}destroy(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.schedule=this.manager=null,this.hls=this.HlsPlayerClass=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null}onDestroying(){const e=this.primaryMedia||this.media;e&&this.removeMediaListeners(e)}removeMediaListeners(e){ei(e,"play",this.onPlay),ei(e,"pause",this.onPause),ei(e,"seeking",this.onSeeking),ei(e,"timeupdate",this.onTimeupdate)}onMediaAttaching(e,t){const s=this.media=t.media;Bs(s,"seeking",this.onSeeking),Bs(s,"timeupdate",this.onTimeupdate),Bs(s,"play",this.onPlay),Bs(s,"pause",this.onPause)}onMediaAttached(e,t){const s=this.effectivePlayingItem,n=this.detachedData;if(this.detachedData=null,s===null)this.checkStart();else if(!n){this.clearScheduleState();const r=this.findItemIndex(s);this.setSchedulePosition(r)}}clearScheduleState(){this.log("clear schedule state"),this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null}onMediaDetaching(e,t){const s=!!t.transferMedia,n=this.media;if(this.media=null,!s&&(n&&this.removeMediaListeners(n),this.detachedData)){const r=this.getBufferingPlayer();r&&(this.log(`Removing schedule state for detachedData and ${r}`),this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,r.detachMedia()),this.shouldPlay=!1}}get interstitialsManager(){if(!this.hls)return null;if(this.manager)return this.manager;const e=this,t=()=>e.bufferingItem||e.waitingItem,s=g=>g&&e.getAssetPlayer(g.identifier),n=(g,y,x,S,E)=>{if(g){let T=g[y].start;const A=g.event;if(A){if(y==="playout"||A.timelineOccupancy!==Du.Point){const I=s(x);I?.interstitial===A&&(T+=I.assetItem.startOffset+I[E])}}else{const I=S==="bufferedPos"?l():e[S];T+=I-g.start}return T}return 0},r=(g,y)=>{var x;if(g!==0&&y!=="primary"&&(x=e.schedule)!=null&&x.length){var S;const E=e.schedule.findItemIndexAtTime(g),T=(S=e.schedule.items)==null?void 0:S[E];if(T){const A=T[y].start-T.start;return g+A}}return g},l=()=>{const g=e.bufferedPos;return g===Number.MAX_VALUE?c("primary"):Math.max(g,0)},c=g=>{var y,x;return(y=e.primaryDetails)!=null&&y.live?e.primaryDetails.edge:((x=e.schedule)==null?void 0:x.durations[g])||0},d=(g,y)=>{var x,S;const E=e.effectivePlayingItem;if(E!=null&&(x=E.event)!=null&&x.restrictions.skip||!e.schedule)return;e.log(`seek to ${g} "${y}"`);const T=e.effectivePlayingItem,A=e.schedule.findItemIndexAtTime(g,y),I=(S=e.schedule.items)==null?void 0:S[A],_=e.getBufferingPlayer(),C=_?.interstitial,k=C?.appendInPlace,D=T&&e.itemsMatch(T,I);if(T&&(k||D)){const O=s(e.playingAsset),F=O?.media||e.primaryMedia;if(F){const j=y==="primary"?F.currentTime:n(T,y,e.playingAsset,"timelinePos","currentTime"),U=g-j,K=(k?j:F.currentTime)+U;if(K>=0&&(!O||k||K<=O.duration)){F.currentTime=K;return}}}if(I){let O=g;if(y!=="primary"){const j=I[y].start,U=g-j;O=I.start+U}const F=!e.isInterstitial(I);if((!e.isInterstitial(T)||T.event.appendInPlace)&&(F||I.event.appendInPlace)){const j=e.media||(k?_?.media:null);j&&(j.currentTime=O)}else if(T){const j=e.findItemIndex(T);if(A>j){const K=e.schedule.findJumpRestrictedIndex(j+1,A);if(K>j){e.setSchedulePosition(K);return}}let U=0;if(F)e.timelinePos=O,e.checkBuffer();else{const K=I.event.assetList,H=g-(I[y]||I).start;for(let ee=K.length;ee--;){const re=K[ee];if(re.duration&&H>=re.startOffset&&H<re.startOffset+re.duration){U=ee;break}}}e.setSchedulePosition(A,U)}}},u=()=>{const g=e.effectivePlayingItem;if(e.isInterstitial(g))return g;const y=t();return e.isInterstitial(y)?y:null},f={get bufferedEnd(){const g=t(),y=e.bufferingItem;if(y&&y===g){var x;return n(y,"playout",e.bufferingAsset,"bufferedPos","bufferedEnd")-y.playout.start||((x=e.bufferingAsset)==null?void 0:x.startOffset)||0}return 0},get currentTime(){const g=u(),y=e.effectivePlayingItem;return y&&y===g?n(y,"playout",e.effectivePlayingAsset,"timelinePos","currentTime")-y.playout.start:0},set currentTime(g){const y=u(),x=e.effectivePlayingItem;x&&x===y&&d(g+x.playout.start,"playout")},get duration(){const g=u();return g?g.playout.end-g.playout.start:0},get assetPlayers(){var g;const y=(g=u())==null?void 0:g.event.assetList;return y?y.map(x=>e.getAssetPlayer(x.identifier)):[]},get playingIndex(){var g;const y=(g=u())==null?void 0:g.event;return y&&e.effectivePlayingAsset?y.findAssetIndex(e.effectivePlayingAsset):-1},get scheduleItem(){return u()}};return this.manager={get events(){var g;return((g=e.schedule)==null||(g=g.events)==null?void 0:g.slice(0))||[]},get schedule(){var g;return((g=e.schedule)==null||(g=g.items)==null?void 0:g.slice(0))||[]},get interstitialPlayer(){return u()?f:null},get playerQueue(){return e.playerQueue.slice(0)},get bufferingAsset(){return e.bufferingAsset},get bufferingItem(){return t()},get bufferingIndex(){const g=t();return e.findItemIndex(g)},get playingAsset(){return e.effectivePlayingAsset},get playingItem(){return e.effectivePlayingItem},get playingIndex(){const g=e.effectivePlayingItem;return e.findItemIndex(g)},primary:{get bufferedEnd(){return l()},get currentTime(){const g=e.timelinePos;return g>0?g:0},set currentTime(g){d(g,"primary")},get duration(){return c("primary")},get seekableStart(){var g;return((g=e.primaryDetails)==null?void 0:g.fragmentStart)||0}},integrated:{get bufferedEnd(){return n(t(),"integrated",e.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return n(e.effectivePlayingItem,"integrated",e.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(g){d(g,"integrated")},get duration(){return c("integrated")},get seekableStart(){var g;return r(((g=e.primaryDetails)==null?void 0:g.fragmentStart)||0,"integrated")}},skip:()=>{const g=e.effectivePlayingItem,y=g?.event;if(y&&!y.restrictions.skip){const x=e.findItemIndex(g);if(y.appendInPlace){const S=g.playout.start+g.event.duration;d(S+.001,"playout")}else e.advanceAfterAssetEnded(y,x,1/0)}}}}get effectivePlayingItem(){return this.waitingItem||this.playingItem||this.endedItem}get effectivePlayingAsset(){return this.playingAsset||this.endedAsset}get playingLastItem(){var e;const t=this.playingItem,s=(e=this.schedule)==null?void 0:e.items;return!this.playbackStarted||!t||!s?!1:this.findItemIndex(t)===s.length-1}get playbackStarted(){return this.effectivePlayingItem!==null}get currentTime(){var e,t;if(this.mediaSelection===null)return;const s=this.waitingItem||this.playingItem;if(this.isInterstitial(s)&&!s.event.appendInPlace)return;let n=this.media;!n&&(e=this.bufferingItem)!=null&&(e=e.event)!=null&&e.appendInPlace&&(n=this.primaryMedia);const r=(t=n)==null?void 0:t.currentTime;if(!(r===void 0||!ke(r)))return r}get primaryMedia(){var e;return this.media||((e=this.detachedData)==null?void 0:e.media)||null}isInterstitial(e){return!!(e!=null&&e.event)}retreiveMediaSource(e,t){const s=this.getAssetPlayer(e);s&&this.transferMediaFromPlayer(s,t)}transferMediaFromPlayer(e,t){const s=e.interstitial.appendInPlace,n=e.media;if(s&&n===this.primaryMedia){if(this.bufferingAsset=null,(!t||this.isInterstitial(t)&&!t.event.appendInPlace)&&t&&n){this.detachedData={media:n};return}const r=e.transferMedia();this.log(`transfer MediaSource from ${e} ${Ut(r)}`),this.detachedData=r}else t&&n&&(this.shouldPlay||(this.shouldPlay=!n.paused))}transferMediaTo(e,t){var s,n;if(e.media===t)return;let r=null;const l=this.hls,c=e!==l,d=c&&e.interstitial.appendInPlace,u=(s=this.detachedData)==null?void 0:s.mediaSource;let f;if(l.media)d&&(r=l.transferMedia(),this.detachedData=r),f="Primary";else if(u){const S=this.getBufferingPlayer();S?(r=S.transferMedia(),f=`${S}`):f="detached MediaSource"}else f="detached media";if(!r){if(u)r=this.detachedData,this.log(`using detachedData: MediaSource ${Ut(r)}`);else if(!this.detachedData||l.media===t){const S=this.playerQueue;S.length>1&&S.forEach(E=>{if(c&&E.interstitial.appendInPlace!==d){const T=E.interstitial;this.clearInterstitial(E.interstitial,null),T.appendInPlace=!1,T.appendInPlace&&this.warn(`Could not change append strategy for queued assets ${T}`)}}),this.hls.detachMedia(),this.detachedData={media:t}}}const g=r&&"mediaSource"in r&&((n=r.mediaSource)==null?void 0:n.readyState)!=="closed",y=g&&r?r:t;this.log(`${g?"transfering MediaSource":"attaching media"} to ${c?e:"Primary"} from ${f} (media.currentTime: ${t.currentTime})`);const x=this.schedule;if(y===r&&x){const S=c&&e.assetId===x.assetIdAtEnd;y.overrides={duration:x.duration,endOfStream:!c||S,cueRemoval:!c}}e.attachMedia(y)}onInterstitialCueEnter(){this.onTimeupdate()}checkStart(){const e=this.schedule,t=e?.events;if(!t||this.playbackDisabled||!this.media)return;this.bufferedPos===-1&&(this.bufferedPos=0);const s=this.timelinePos,n=this.effectivePlayingItem;if(s===-1){const r=this.hls.startPosition;if(this.log(Xc("checkStart",r)),this.timelinePos=r,t.length&&t[0].cue.pre){const l=e.findEventIndex(t[0].identifier);this.setSchedulePosition(l)}else if(r>=0||!this.primaryLive){const l=this.timelinePos=r>0?r:0,c=e.findItemIndexAtTime(l);this.setSchedulePosition(c)}}else if(n&&!this.playingItem){const r=e.findItemIndex(n);this.setSchedulePosition(r)}}advanceAssetBuffering(e,t){const s=e.event,n=s.findAssetIndex(t),r=Df(s,n);if(!s.isAssetPastPlayoutLimit(r))this.bufferedToEvent(e,r);else if(this.schedule){var l;const c=(l=this.schedule.items)==null?void 0:l[this.findItemIndex(e)+1];c&&this.bufferedToItem(c)}}advanceAfterAssetEnded(e,t,s){const n=Df(e,s);if(e.isAssetPastPlayoutLimit(n)){if(this.schedule){const r=this.schedule.items;if(r){const l=t+1,c=r.length;if(l>=c){this.setSchedulePosition(-1);return}const d=e.resumeTime;this.timelinePos<d&&(this.log(Xc("advanceAfterAssetEnded",d)),this.timelinePos=d,e.appendInPlace&&this.advanceInPlace(d),this.checkBuffer(this.bufferedPos<d)),this.setSchedulePosition(l)}}}else{if(e.appendInPlace){const r=e.assetList[n];r&&this.advanceInPlace(r.timelineStart)}this.setSchedulePosition(t,n)}}setScheduleToAssetAtTime(e,t){const s=this.schedule;if(!s)return;const n=t.parentIdentifier,r=s.getEvent(n);if(r){const l=s.findEventIndex(n),c=s.findAssetIndex(r,e);this.advanceAfterAssetEnded(r,l,c-1)}}setSchedulePosition(e,t){var s;const n=(s=this.schedule)==null?void 0:s.items;if(!n||this.playbackDisabled)return;const r=e>=0?n[e]:null;this.log(`setSchedulePosition ${e}, ${t} (${r&&qi(r)}) pos: ${this.timelinePos}`);const l=this.waitingItem||this.playingItem,c=this.playingLastItem;if(this.isInterstitial(l)){const f=l.event,g=this.playingAsset,y=g?.identifier,x=y?this.getAssetPlayer(y):null;if(x&&y&&(!this.eventItemsMatch(l,r)||t!==void 0&&y!==f.assetList[t].identifier)){var d;const S=f.findAssetIndex(g);if(this.log(`INTERSTITIAL_ASSET_ENDED ${S+1}/${f.assetList.length} ${Gr(g)}`),this.endedAsset=g,this.playingAsset=null,this.hls.trigger(L.INTERSTITIAL_ASSET_ENDED,{asset:g,assetListIndex:S,event:f,schedule:n.slice(0),scheduleIndex:e,player:x}),l!==this.playingItem){this.itemsMatch(l,this.playingItem)&&!this.playingAsset&&this.advanceAfterAssetEnded(f,this.findItemIndex(this.playingItem),S);return}this.retreiveMediaSource(y,r),x.media&&!((d=this.detachedData)!=null&&d.mediaSource)&&x.detachMedia()}if(!this.eventItemsMatch(l,r)&&(this.endedItem=l,this.playingItem=null,this.log(`INTERSTITIAL_ENDED ${f} ${qi(l)}`),f.hasPlayed=!0,this.hls.trigger(L.INTERSTITIAL_ENDED,{event:f,schedule:n.slice(0),scheduleIndex:e}),f.cue.once)){var u;this.updateSchedule();const S=(u=this.schedule)==null?void 0:u.items;if(r&&S){const E=this.findItemIndex(r);this.advanceSchedule(E,S,t,l,c)}return}}this.advanceSchedule(e,n,t,l,c)}advanceSchedule(e,t,s,n,r){const l=this.schedule;if(!l)return;const c=t[e]||null,d=this.primaryMedia,u=this.playerQueue;if(u.length&&u.forEach(f=>{const g=f.interstitial,y=l.findEventIndex(g.identifier);(y<e||y>e+1)&&this.clearInterstitial(g,c)}),this.isInterstitial(c)){this.timelinePos=Math.min(Math.max(this.timelinePos,c.start),c.end);const f=c.event;if(s===void 0){s=l.findAssetIndex(f,this.timelinePos);const S=Df(f,s-1);if(f.isAssetPastPlayoutLimit(S)||f.appendInPlace&&this.timelinePos===c.end){this.advanceAfterAssetEnded(f,e,s);return}s=S}const g=this.waitingItem;this.assetsBuffered(c,d)||this.setBufferingItem(c);let y=this.preloadAssets(f,s);if(this.eventItemsMatch(c,g||n)||(this.waitingItem=c,this.log(`INTERSTITIAL_STARTED ${qi(c)} ${f.appendInPlace?"append in place":""}`),this.hls.trigger(L.INTERSTITIAL_STARTED,{event:f,schedule:t.slice(0),scheduleIndex:e})),!f.assetListLoaded){this.log(`Waiting for ASSET-LIST to complete loading ${f}`);return}if(f.assetListLoader&&(f.assetListLoader.destroy(),f.assetListLoader=void 0),!d){this.log(`Waiting for attachMedia to start Interstitial ${f}`);return}this.waitingItem=this.endedItem=null,this.playingItem=c;const x=f.assetList[s];if(!x){this.advanceAfterAssetEnded(f,e,s||0);return}if(y||(y=this.getAssetPlayer(x.identifier)),y===null||y.destroyed){const S=f.assetList.length;this.warn(`asset ${s+1}/${S} player destroyed ${f}`),y=this.createAssetPlayer(f,x,s),y.loadSource()}if(!this.eventItemsMatch(c,this.bufferingItem)&&f.appendInPlace&&this.isAssetBuffered(x))return;this.startAssetPlayer(y,s,t,e,d),this.shouldPlay&&Nx(y.media)}else c?(this.resumePrimary(c,e,n),this.shouldPlay&&Nx(this.hls.media)):r&&this.isInterstitial(n)&&(this.endedItem=null,this.playingItem=n,n.event.appendInPlace||this.attachPrimary(l.durations.primary,null))}get playbackDisabled(){return this.hls.config.enableInterstitialPlayback===!1}get primaryDetails(){var e;return(e=this.mediaSelection)==null?void 0:e.main.details}get primaryLive(){var e;return!!((e=this.primaryDetails)!=null&&e.live)}resumePrimary(e,t,s){var n,r;if(this.playingItem=e,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(e),this.log(`resuming ${qi(e)}`),!((n=this.detachedData)!=null&&n.mediaSource)){let c=this.timelinePos;(c<e.start||c>=e.end)&&(c=this.getPrimaryResumption(e,t),this.log(Xc("resumePrimary",c)),this.timelinePos=c),this.attachPrimary(c,e)}if(!s)return;const l=(r=this.schedule)==null?void 0:r.items;l&&(this.log(`INTERSTITIALS_PRIMARY_RESUMED ${qi(e)}`),this.hls.trigger(L.INTERSTITIALS_PRIMARY_RESUMED,{schedule:l.slice(0),scheduleIndex:t}),this.checkBuffer())}getPrimaryResumption(e,t){const s=e.start;if(this.primaryLive){const n=this.primaryDetails;if(t===0)return this.hls.startPosition;if(n&&(s<n.fragmentStart||s>n.edge))return this.hls.liveSyncPosition||-1}return s}isAssetBuffered(e){const t=this.getAssetPlayer(e.identifier);return t!=null&&t.hls?t.hls.bufferedToEnd:Xe.bufferInfo(this.primaryMedia,this.timelinePos,0).end+1>=e.timelineStart+(e.duration||0)}attachPrimary(e,t,s){t?this.setBufferingItem(t):this.bufferingItem=this.playingItem,this.bufferingAsset=null;const n=this.primaryMedia;if(!n)return;const r=this.hls;r.media?this.checkBuffer():(this.transferMediaTo(r,n),s&&this.startLoadingPrimaryAt(e,s)),s||(this.log(Xc("attachPrimary",e)),this.timelinePos=e,this.startLoadingPrimaryAt(e,s))}startLoadingPrimaryAt(e,t){var s;const n=this.hls;!n.loadingEnabled||!n.media||Math.abs((((s=n.mainForwardBufferInfo)==null?void 0:s.start)||n.media.currentTime)-e)>.5?n.startLoad(e,t):n.bufferingEnabled||n.resumeBuffering()}onManifestLoading(){var e;this.stopLoad(),(e=this.schedule)==null||e.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off(L.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on(L.BUFFER_CODECS,this.onBufferCodecs,this)}onLevelUpdated(e,t){if(t.level===-1||!this.schedule)return;const s=this.hls.levels[t.level];if(!s.details)return;const n=Lt(Lt({},this.mediaSelection||this.altSelection),{},{main:s});this.mediaSelection=n,this.schedule.parseInterstitialDateRanges(n,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}onAudioTrackUpdated(e,t){const s=this.hls.audioTracks[t.id],n=this.mediaSelection;if(!n){this.altSelection=Lt(Lt({},this.altSelection),{},{audio:s});return}const r=Lt(Lt({},n),{},{audio:s});this.mediaSelection=r}onSubtitleTrackUpdated(e,t){const s=this.hls.subtitleTracks[t.id],n=this.mediaSelection;if(!n){this.altSelection=Lt(Lt({},this.altSelection),{},{subtitles:s});return}const r=Lt(Lt({},n),{},{subtitles:s});this.mediaSelection=r}onAudioTrackSwitching(e,t){const s=Vv(t);this.playerQueue.forEach(({hls:n})=>n&&(n.setAudioOption(t)||n.setAudioOption(s)))}onSubtitleTrackSwitch(e,t){const s=Vv(t);this.playerQueue.forEach(({hls:n})=>n&&(n.setSubtitleOption(t)||t.id!==-1&&n.setSubtitleOption(s)))}onBufferCodecs(e,t){const s=t.tracks;s&&(this.requiredTracks=s)}onBufferAppended(e,t){this.checkBuffer()}onBufferFlushed(e,t){const s=this.playingItem;if(s&&!this.itemsMatch(s,this.bufferingItem)&&!this.isInterstitial(s)){const n=this.timelinePos;this.bufferedPos=n,this.checkBuffer()}}onBufferedToEnd(e){if(!this.schedule)return;const t=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&t){for(let n=0;n<t.length;n++){const r=t[n];if(r.cue.post){var s;const l=this.schedule.findEventIndex(r.identifier),c=(s=this.schedule.items)==null?void 0:s[l];this.isInterstitial(c)&&this.eventItemsMatch(c,this.bufferingItem)&&this.bufferedToItem(c,0);break}}this.bufferedPos=Number.MAX_VALUE}}onMediaEnded(e){const t=this.playingItem;if(!this.playingLastItem&&t){const s=this.findItemIndex(t);this.setSchedulePosition(s+1)}else this.shouldPlay=!1}updateItem(e,t){var s;const n=(s=this.schedule)==null?void 0:s.items;if(e&&n){const r=this.findItemIndex(e,t);return n[r]||null}return null}trimInPlace(e,t){if(this.isInterstitial(e)&&e.event.appendInPlace&&t.end-e.end>.25){e.event.assetList.forEach((r,l)=>{e.event.isAssetPastPlayoutLimit(l)&&this.clearAssetPlayer(r.identifier,null)});const s=e.end+.25,n=Xe.bufferInfo(this.primaryMedia,s,0);(n.end>s||(n.nextStart||0)>s)&&(this.log(`trim buffered interstitial ${qi(e)} (was ${qi(t)})`),this.attachPrimary(s,null,!0),this.flushFrontBuffer(s))}}itemsMatch(e,t){return!!t&&(e===t||e.event&&t.event&&this.eventItemsMatch(e,t)||!e.event&&!t.event&&this.findItemIndex(e)===this.findItemIndex(t))}eventItemsMatch(e,t){var s;return!!t&&(e===t||e.event.identifier===((s=t.event)==null?void 0:s.identifier))}findItemIndex(e,t){return e&&this.schedule?this.schedule.findItemIndex(e,t):-1}updateSchedule(e=!1){var t;const s=this.mediaSelection;s&&((t=this.schedule)==null||t.updateSchedule(s,[],e))}checkBuffer(e){var t;const s=(t=this.schedule)==null?void 0:t.items;if(!s)return;const n=Xe.bufferInfo(this.primaryMedia,this.timelinePos,0);e&&(this.bufferedPos=this.timelinePos),e||(e=n.len<1),this.updateBufferedPos(n.end,s,e)}updateBufferedPos(e,t,s){const n=this.schedule,r=this.bufferingItem;if(this.bufferedPos>e||!n)return;if(t.length===1&&this.itemsMatch(t[0],r)){this.bufferedPos=e;return}const l=this.playingItem,c=this.findItemIndex(l);let d=n.findItemIndexAtTime(e);if(this.bufferedPos<e){var u;const f=this.findItemIndex(r),g=Math.min(f+1,t.length-1),y=t[g];if((d===-1&&r&&e>=r.end||(u=y.event)!=null&&u.appendInPlace&&e+.01>=y.start)&&(d=g),this.isInterstitial(r)){const x=r.event;if(g-c>1&&x.appendInPlace===!1||x.assetList.length===0&&x.assetListLoader)return}if(this.bufferedPos=e,d>f&&d>c)this.bufferedToItem(y);else{const x=this.primaryDetails;this.primaryLive&&x&&e>x.edge-x.targetduration&&y.start<x.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(y)&&this.preloadAssets(y.event,0)}}else s&&l&&!this.itemsMatch(l,r)&&(d===c?this.bufferedToItem(l):d===c+1&&this.bufferedToItem(t[d]))}assetsBuffered(e,t){return e.event.assetList.length===0?!1:!e.event.assetList.some(n=>{const r=this.getAssetPlayer(n.identifier);return!(r!=null&&r.bufferedInPlaceToEnd(t))})}setBufferingItem(e){const t=this.bufferingItem,s=this.schedule;if(!this.itemsMatch(e,t)&&s){const{items:n,events:r}=s;if(!n||!r)return t;const l=this.isInterstitial(e),c=this.getBufferingPlayer();this.bufferingItem=e,this.bufferedPos=Math.max(e.start,Math.min(e.end,this.timelinePos));const d=c?c.remaining:t?t.end-this.timelinePos:0;if(this.log(`INTERSTITIALS_BUFFERED_TO_BOUNDARY ${qi(e)}`+(t?` (${d.toFixed(2)} remaining)`:"")),!this.playbackDisabled)if(l){const u=s.findAssetIndex(e.event,this.bufferedPos);e.event.assetList.forEach((f,g)=>{const y=this.getAssetPlayer(f.identifier);y&&(g===u&&y.loadSource(),y.resumeBuffering())})}else this.hls.resumeBuffering(),this.playerQueue.forEach(u=>u.pauseBuffering());this.hls.trigger(L.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:r.slice(0),schedule:n.slice(0),bufferingIndex:this.findItemIndex(e),playingIndex:this.findItemIndex(this.playingItem)})}else this.bufferingItem!==e&&(this.bufferingItem=e);return t}bufferedToItem(e,t=0){const s=this.setBufferingItem(e);if(!this.playbackDisabled){if(this.isInterstitial(e))this.bufferedToEvent(e,t);else if(s!==null){this.bufferingAsset=null;const n=this.detachedData;n?n.mediaSource?this.attachPrimary(e.start,e,!0):this.preloadPrimary(e):this.preloadPrimary(e)}}}preloadPrimary(e){const t=this.findItemIndex(e),s=this.getPrimaryResumption(e,t);this.startLoadingPrimaryAt(s)}bufferedToEvent(e,t){const s=e.event,n=s.assetList.length===0&&!s.assetListLoader,r=s.cue.once;if(n||!r){const l=this.preloadAssets(s,t);if(l!=null&&l.interstitial.appendInPlace){const c=this.primaryMedia;c&&this.bufferAssetPlayer(l,c)}}}preloadAssets(e,t){const s=e.assetUrl,n=e.assetList.length,r=n===0&&!e.assetListLoader,l=e.cue.once;if(r){const d=e.timelineStart;if(e.appendInPlace){var c;const y=this.playingItem;!this.isInterstitial(y)&&(y==null||(c=y.nextEvent)==null?void 0:c.identifier)===e.identifier&&this.flushFrontBuffer(d+.25)}let u,f=0;if(!this.playingItem&&this.primaryLive&&(f=this.hls.startPosition,f===-1&&(f=this.hls.liveSyncPosition||0)),f&&!(e.cue.pre||e.cue.post)){const y=f-d;y>0&&(u=Math.round(y*1e3)/1e3)}if(this.log(`Load interstitial asset ${t+1}/${s?1:n} ${e}${u?` live-start: ${f} start-offset: ${u}`:""}`),s)return this.createAsset(e,0,0,d,e.duration,s);const g=this.assetListLoader.loadAssetList(e,u);g&&(e.assetListLoader=g)}else if(!l&&n){for(let u=t;u<n;u++){const f=e.assetList[u],g=this.getAssetPlayerQueueIndex(f.identifier);(g===-1||this.playerQueue[g].destroyed)&&!f.error&&this.createAssetPlayer(e,f,u)}const d=e.assetList[t];if(d){const u=this.getAssetPlayer(d.identifier);return u&&u.loadSource(),u}}return null}flushFrontBuffer(e){const t=this.requiredTracks;if(!t)return;this.log(`Removing front buffer starting at ${e}`),Object.keys(t).forEach(n=>{this.hls.trigger(L.BUFFER_FLUSHING,{startOffset:e,endOffset:1/0,type:n})})}getAssetPlayerQueueIndex(e){const t=this.playerQueue;for(let s=0;s<t.length;s++)if(e===t[s].assetId)return s;return-1}getAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);return this.playerQueue[t]||null}getBufferingPlayer(){const{playerQueue:e,primaryMedia:t}=this;if(t){for(let s=0;s<e.length;s++)if(e[s].media===t)return e[s]}return null}createAsset(e,t,s,n,r,l){const c={parentIdentifier:e.identifier,identifier:_N(e,l,t),duration:r,startOffset:s,timelineStart:n,uri:l};return this.createAssetPlayer(e,c,t)}createAssetPlayer(e,t,s){const n=this.hls,r=n.userConfig;let l=r.videoPreference;const c=n.loadLevelObj||n.levels[n.currentLevel];(l||c)&&(l=Ot({},l),c.videoCodec&&(l.videoCodec=c.videoCodec),c.videoRange&&(l.allowedVideoRanges=[c.videoRange]));const d=n.audioTracks[n.audioTrack],u=n.subtitleTracks[n.subtitleTrack];let f=0;if(this.primaryLive||e.appendInPlace){const C=this.timelinePos-t.timelineStart;if(C>1){const k=t.duration;k&&C<k&&(f=C)}}const g=t.identifier,y=Lt(Lt({},r),{},{maxMaxBufferLength:Math.min(180,n.config.maxMaxBufferLength),autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:n.sessionId,assetPlayerId:g,abrEwmaDefaultEstimate:n.bandwidthEstimate,interstitialsController:void 0,startPosition:f,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:l,audioPreference:d||r.audioPreference,subtitlePreference:u||r.subtitlePreference});e.appendInPlace&&(e.appendInPlaceStarted=!0,t.timelineStart&&(y.timelineOffset=t.timelineStart));const x=y.cmcd;x!=null&&x.sessionId&&x.contentId&&(y.cmcd=Ot({},x,{contentId:ao(t.uri)})),this.getAssetPlayer(g)&&this.warn(`Duplicate date range identifier ${e} and asset ${g}`);const S=new LN(this.HlsPlayerClass,y,e,t);this.playerQueue.push(S),e.assetList[s]=t;let E=!0;const T=C=>{if(C.live){var k;const F=new Error(`Interstitials MUST be VOD assets ${e}`),j={fatal:!0,type:je.OTHER_ERROR,details:W.INTERSTITIAL_ASSET_ITEM_ERROR,error:F},U=((k=this.schedule)==null?void 0:k.findEventIndex(e.identifier))||-1;this.handleAssetItemError(j,e,U,s,F.message);return}const D=C.edge-C.fragmentStart,O=t.duration;(E||O===null||D>O)&&(E=!1,this.log(`Interstitial asset "${g}" duration change ${O} > ${D}`),t.duration=D,this.updateSchedule())};S.on(L.LEVEL_UPDATED,(C,{details:k})=>T(k)),S.on(L.LEVEL_PTS_UPDATED,(C,{details:k})=>T(k)),S.on(L.EVENT_CUE_ENTER,()=>this.onInterstitialCueEnter());const A=(C,k)=>{const D=this.getAssetPlayer(g);if(D&&k.tracks){D.off(L.BUFFER_CODECS,A),D.tracks=k.tracks;const O=this.primaryMedia;this.bufferingAsset===D.assetItem&&O&&!D.media&&this.bufferAssetPlayer(D,O)}};S.on(L.BUFFER_CODECS,A);const I=()=>{var C;const k=this.getAssetPlayer(g);if(this.log(`buffered to end of asset ${k}`),!k||!this.schedule)return;const D=this.schedule.findEventIndex(e.identifier),O=(C=this.schedule.items)==null?void 0:C[D];this.isInterstitial(O)&&this.advanceAssetBuffering(O,t)};S.on(L.BUFFERED_TO_END,I);const _=C=>()=>{if(!this.getAssetPlayer(g)||!this.schedule)return;this.shouldPlay=!0;const D=this.schedule.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,D,C)};return S.once(L.MEDIA_ENDED,_(s)),S.once(L.PLAYOUT_LIMIT_REACHED,_(1/0)),S.on(L.ERROR,(C,k)=>{if(!this.schedule)return;const D=this.getAssetPlayer(g);if(k.details===W.BUFFER_STALLED_ERROR){if(D!=null&&D.appendInPlace){this.handleInPlaceStall(e);return}this.onTimeupdate(),this.checkBuffer(!0);return}this.handleAssetItemError(k,e,this.schedule.findEventIndex(e.identifier),s,`Asset player error ${k.error} ${e}`)}),S.on(L.DESTROYING,()=>{if(!this.getAssetPlayer(g)||!this.schedule)return;const k=new Error(`Asset player destroyed unexpectedly ${g}`),D={fatal:!0,type:je.OTHER_ERROR,details:W.INTERSTITIAL_ASSET_ITEM_ERROR,error:k};this.handleAssetItemError(D,e,this.schedule.findEventIndex(e.identifier),s,k.message)}),this.log(`INTERSTITIAL_ASSET_PLAYER_CREATED ${Gr(t)}`),this.hls.trigger(L.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:t,assetListIndex:s,event:e,player:S}),S}clearInterstitial(e,t){this.clearAssetPlayers(e,t),e.reset()}clearAssetPlayers(e,t){e.assetList.forEach(s=>{this.clearAssetPlayer(s.identifier,t)})}resetAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);if(t!==-1){this.log(`reset asset player "${e}" after error`);const s=this.playerQueue[t];this.transferMediaFromPlayer(s,null),s.resetDetails()}}clearAssetPlayer(e,t){const s=this.getAssetPlayerQueueIndex(e);if(s!==-1){const n=this.playerQueue[s];this.log(`clear ${n} toSegment: ${t&&qi(t)}`),this.transferMediaFromPlayer(n,t),this.playerQueue.splice(s,1),n.destroy()}}emptyPlayerQueue(){let e;for(;e=this.playerQueue.pop();)e.destroy();this.playerQueue=[]}startAssetPlayer(e,t,s,n,r){const{interstitial:l,assetItem:c,assetId:d}=e,u=l.assetList.length,f=this.playingAsset;this.endedAsset=null,this.playingAsset=c,(!f||f.identifier!==d)&&(f&&(this.clearAssetPlayer(f.identifier,s[n]),delete f.error),this.log(`INTERSTITIAL_ASSET_STARTED ${t+1}/${u} ${Gr(c)}`),this.hls.trigger(L.INTERSTITIAL_ASSET_STARTED,{asset:c,assetListIndex:t,event:l,schedule:s.slice(0),scheduleIndex:n,player:e})),this.bufferAssetPlayer(e,r)}bufferAssetPlayer(e,t){var s,n;if(!this.schedule)return;const{interstitial:r,assetItem:l}=e,c=this.schedule.findEventIndex(r.identifier),d=(s=this.schedule.items)==null?void 0:s[c];if(!d)return;e.loadSource(),this.setBufferingItem(d),this.bufferingAsset=l;const u=this.getBufferingPlayer();if(u===e)return;const f=r.appendInPlace;if(f&&u?.interstitial.appendInPlace===!1)return;const g=u?.tracks||((n=this.detachedData)==null?void 0:n.tracks)||this.requiredTracks;if(f&&l!==this.playingAsset){if(!e.tracks){this.log(`Waiting for track info before buffering ${e}`);return}if(g&&!GS(g,e.tracks)){const y=new Error(`Asset ${Gr(l)} SourceBuffer tracks ('${Object.keys(e.tracks)}') are not compatible with primary content tracks ('${Object.keys(g)}')`),x={fatal:!0,type:je.OTHER_ERROR,details:W.INTERSTITIAL_ASSET_ITEM_ERROR,error:y},S=r.findAssetIndex(l);this.handleAssetItemError(x,r,c,S,y.message);return}}this.transferMediaTo(e,t)}handleInPlaceStall(e){const t=this.schedule,s=this.primaryMedia;if(!t||!s)return;const n=s.currentTime,r=t.findAssetIndex(e,n),l=e.assetList[r];if(l){const c=this.getAssetPlayer(l.identifier);if(c){const d=c.currentTime||n-l.timelineStart,u=c.duration-d;if(this.warn(`Stalled at ${d} of ${d+u} in ${c} ${e} (media.currentTime: ${n})`),d&&(u/s.playbackRate<.5||c.bufferedInPlaceToEnd(s))&&c.hls){const f=t.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,f,r)}}}}advanceInPlace(e){const t=this.primaryMedia;t&&t.currentTime<e&&(t.currentTime=e)}handleAssetItemError(e,t,s,n,r){if(e.details===W.BUFFER_STALLED_ERROR)return;const l=t.assetList[n]||null;if(this.warn(`INTERSTITIAL_ASSET_ERROR ${l&&Gr(l)} ${e.error}`),!this.schedule)return;const c=l?.identifier||"",d=this.getAssetPlayerQueueIndex(c),u=this.playerQueue[d]||null,f=this.schedule.items,g=Ot({},e,{fatal:!1,errorAction:Kr(!0),asset:l,assetListIndex:n,event:t,schedule:f,scheduleIndex:s,player:u});if(this.hls.trigger(L.INTERSTITIAL_ASSET_ERROR,g),!e.fatal)return;const y=this.playingAsset,x=this.bufferingAsset,S=new Error(r);if(l&&(this.clearAssetPlayer(c,null),l.error=S),!t.assetList.some(E=>!E.error))t.error=S;else for(let E=n;E<t.assetList.length;E++)this.resetAssetPlayer(t.assetList[E].identifier);this.updateSchedule(!0),t.error?this.primaryFallback(t):y&&y.identifier===c?this.advanceAfterAssetEnded(t,s,n):x&&x.identifier===c&&this.isInterstitial(this.bufferingItem)&&this.advanceAssetBuffering(this.bufferingItem,x)}primaryFallback(e){const t=e.timelineStart,s=this.effectivePlayingItem;let n=this.timelinePos;if(s){this.log(`Fallback to primary from event "${e.identifier}" start: ${t} pos: ${n} playing: ${qi(s)} error: ${e.error}`),n===-1&&(n=this.hls.startPosition);const l=this.updateItem(s,n);this.itemsMatch(s,l)&&this.clearInterstitial(e,null),e.appendInPlace&&(this.attachPrimary(t,null),this.flushFrontBuffer(t))}else if(n===-1){this.checkStart();return}if(!this.schedule)return;const r=this.schedule.findItemIndexAtTime(n);this.setSchedulePosition(r)}onAssetListLoaded(e,t){var s,n;const r=t.event,l=r.identifier,c=t.assetListResponse.ASSETS;if(!((s=this.schedule)!=null&&s.hasEvent(l)))return;const d=r.timelineStart,u=r.duration;let f=0;c.forEach((E,T)=>{const A=parseFloat(E.DURATION);this.createAsset(r,T,f,d+f,A,E.URI),f+=A}),r.duration=f,this.log(`Loaded asset-list with duration: ${f} (was: ${u}) ${r}`);const g=this.waitingItem,y=g?.event.identifier===l;this.updateSchedule();const x=(n=this.bufferingItem)==null?void 0:n.event;if(y){var S;const E=this.schedule.findEventIndex(l),T=(S=this.schedule.items)==null?void 0:S[E];if(T){if(!this.playingItem&&this.timelinePos>T.end&&this.schedule.findItemIndexAtTime(this.timelinePos)!==E){r.error=new Error(`Interstitial ${c.length?"no longer within playback range":"asset-list is empty"} ${this.timelinePos} ${r}`),this.log(r.error.message),this.updateSchedule(!0),this.primaryFallback(r);return}this.setBufferingItem(T)}this.setSchedulePosition(E)}else if(x?.identifier===l){const E=r.assetList[0];if(E){const T=this.getAssetPlayer(E.identifier);if(x.appendInPlace){const A=this.primaryMedia;T&&A&&this.bufferAssetPlayer(T,A)}else T&&T.loadSource()}}}onError(e,t){if(this.schedule)switch(t.details){case W.ASSET_LIST_PARSING_ERROR:case W.ASSET_LIST_LOAD_ERROR:case W.ASSET_LIST_LOAD_TIMEOUT:{const s=t.interstitial;s&&(this.updateSchedule(!0),this.primaryFallback(s));break}case W.BUFFER_STALLED_ERROR:{const s=this.endedItem||this.waitingItem||this.playingItem;if(this.isInterstitial(s)&&s.event.appendInPlace){this.handleInPlaceStall(s.event);return}this.log(`Primary player stall @${this.timelinePos} bufferedPos: ${this.bufferedPos}`),this.onTimeupdate(),this.checkBuffer(!0);break}}}}const Ox=500;class NN extends Km{constructor(e,t,s){super(e,t,s,"subtitle-stream-controller",De.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(L.LEVEL_LOADED,this.onLevelLoaded,this),e.on(L.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(L.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(L.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(L.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(L.BUFFER_FLUSHING,this.onBufferFlushing,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(L.LEVEL_LOADED,this.onLevelLoaded,this),e.off(L.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(L.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(L.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(L.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(L.BUFFER_FLUSHING,this.onBufferFlushing,this)}startLoad(e,t){this.stopLoad(),this.state=ue.IDLE,this.setInterval(Ox),this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}onManifestLoading(){super.onManifestLoading(),this.mainDetails=null}onMediaDetaching(e,t){this.tracksBuffered=[],super.onMediaDetaching(e,t)}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){const{frag:s,success:n}=t;if(this.fragContextChanged(s)||(rs(s)&&(this.fragPrevious=s),this.state=ue.IDLE),!n)return;const r=this.tracksBuffered[this.currentTrackId];if(!r)return;let l;const c=s.start;for(let u=0;u<r.length;u++)if(c>=r[u].start&&c<=r[u].end){l=r[u];break}const d=s.start+s.duration;l?l.end=d:(l={start:c,end:d},r.push(l)),this.fragmentTracker.fragBuffered(s),this.fragBufferedComplete(s,null),this.media&&this.tick()}onBufferFlushing(e,t){const{startOffset:s,endOffset:n}=t;if(s===0&&n!==Number.POSITIVE_INFINITY){const r=n-1;if(r<=0)return;t.endOffsetSubtitles=Math.max(0,r),this.tracksBuffered.forEach(l=>{for(let c=0;c<l.length;){if(l[c].end<=r){l.shift();continue}else if(l[c].start<r)l[c].start=r;else break;c++}}),this.fragmentTracker.removeFragmentsInRange(s,r,De.SUBTITLE)}}onError(e,t){const s=t.frag;s?.type===De.SUBTITLE&&(t.details===W.FRAG_GAP&&this.fragmentTracker.fragBuffered(s,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==ue.STOPPED&&(this.state=ue.IDLE))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){if(this.levels&&Kb(this.levels,t)){this.levels=t.map(s=>new co(s));return}this.tracksBuffered=[],this.levels=t.map(s=>{const n=new co(s);return this.tracksBuffered[n.id]=[],n}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,De.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(e,t){var s;if(this.currentTrackId=t.id,!((s=this.levels)!=null&&s.length)||this.currentTrackId===-1){this.clearInterval();return}const n=this.levels[this.currentTrackId];n!=null&&n.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,n&&this.state!==ue.STOPPED&&this.setInterval(Ox)}onSubtitleTrackLoaded(e,t){var s;const{currentTrackId:n,levels:r}=this,{details:l,id:c}=t;if(!r){this.warn(`Subtitle tracks were reset while loading level ${c}`);return}const d=r[c];if(c>=r.length||!d)return;this.log(`Subtitle track ${c} loaded [${l.startSN},${l.endSN}]${l.lastPartSn?`[part-${l.lastPartSn}-${l.lastPartIndex}]`:""},duration:${l.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let u=0;if(l.live||(s=d.details)!=null&&s.live){if(l.deltaUpdateFailed)return;const g=this.mainDetails;if(!g){this.startFragRequested=!1;return}const y=g.fragments[0];if(!d.details)l.hasProgramDateTime&&g.hasProgramDateTime?(Nu(l,g),u=l.fragmentStart):y&&(u=y.start,lm(l,u));else{var f;u=this.alignPlaylists(l,d.details,(f=this.levelLastLoaded)==null?void 0:f.details),u===0&&y&&(u=y.start,lm(l,u))}g&&!this.startFragRequested&&this.setStartPosition(g,u)}d.details=l,this.levelLastLoaded=d,c===n&&(this.hls.trigger(L.SUBTITLE_TRACK_UPDATED,{details:l,id:c,groupId:t.groupId}),this.tick(),l.live&&!this.fragCurrent&&this.media&&this.state===ue.IDLE&&(Ja(null,l.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),d.details=void 0)))}_handleFragmentLoadComplete(e){const{frag:t,payload:s}=e,n=t.decryptdata,r=this.hls;if(!this.fragContextChanged(t)&&s&&s.byteLength>0&&n!=null&&n.key&&n.iv&&Yr(n.method)){const l=performance.now();this.decrypter.decrypt(new Uint8Array(s),n.key.buffer,n.iv.buffer,Hm(n.method)).catch(c=>{throw r.trigger(L.ERROR,{type:je.MEDIA_ERROR,details:W.FRAG_DECRYPT_ERROR,fatal:!1,error:c,reason:c.message,frag:t}),c}).then(c=>{const d=performance.now();r.trigger(L.FRAG_DECRYPTED,{frag:t,payload:c,stats:{tstart:l,tdecrypt:d}})}).catch(c=>{this.warn(`${c.name}: ${c.message}`),this.state=ue.IDLE})}}doTick(){if(!this.media){this.state=ue.IDLE;return}if(this.state===ue.IDLE){const{currentTrackId:e,levels:t}=this,s=t?.[e];if(!s||!t.length||!s.details||this.waitForLive(s))return;const{config:n}=this,r=this.getLoadPosition(),l=Xe.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],r,n.maxBufferHole),{end:c,len:d}=l,u=s.details,f=this.hls.maxBufferLength+u.levelTargetDuration;if(d>f)return;const g=u.fragments,y=g.length,x=u.edge;let S=null;const E=this.fragPrevious;if(c<x){const I=n.maxFragLookUpTolerance,_=c>x-I?0:I;S=Ja(E,g,Math.max(g[0].start,c),_),!S&&E&&E.start<g[0].start&&(S=g[0])}else S=g[y-1];if(S=this.filterReplacedPrimary(S,s.details),!S)return;const T=S.sn-u.startSN,A=g[T-1];if(A&&A.cc===S.cc&&this.fragmentTracker.getState(A)===vs.NOT_LOADED&&(S=A),this.fragmentTracker.getState(S)===vs.NOT_LOADED){const I=this.mapToInitFragWhenRequired(S);I&&this.loadFragment(I,s,c)}}}loadFragment(e,t,s){rs(e)?super.loadFragment(e,t,s):this._loadInitSegment(e,t)}get mediaBufferTimeRanges(){return new ON(this.tracksBuffered[this.currentTrackId]||[])}}class ON{constructor(e){this.buffered=void 0;const t=(s,n,r)=>{if(n=n>>>0,n>r-1)throw new DOMException(`Failed to execute '${s}' on 'TimeRanges': The index provided (${n}) is greater than the maximum bound (${r})`);return e[n][s]};this.buffered={get length(){return e.length},end(s){return t("end",s,e.length)},start(s){return t("start",s,e.length)}}}}const DN={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},oT=i=>String.fromCharCode(DN[i]||i),Qi=15,Bn=100,PN={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},UN={17:2,18:4,21:6,22:8,23:10,19:13,20:15},MN={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},jN={25:2,26:4,29:6,30:8,31:10,27:13,28:15},FN=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class BN{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){const s=typeof t=="function"?t():t;wt.log(`${this.time} [${e}] ${s}`)}}}const Ka=function(e){const t=[];for(let s=0;s<e.length;s++)t.push(e[s].toString(16));return t};class cT{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const t=["foreground","underline","italics","background","flash"];for(let s=0;s<t.length;s++){const n=t[s];e.hasOwnProperty(n)&&(this[n]=e[n])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class VN{constructor(){this.uchar=" ",this.penState=new cT}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}}class $N{constructor(e){this.chars=[],this.pos=0,this.currPenState=new cT,this.cueStartTime=null,this.logger=void 0;for(let t=0;t<Bn;t++)this.chars.push(new VN);this.logger=e}equals(e){for(let t=0;t<Bn;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0}copy(e){for(let t=0;t<Bn;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<Bn;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>Bn&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=Bn)}moveCursor(e){const t=this.pos+e;if(e>1)for(let s=this.pos+1;s<t+1;s++)this.chars[s].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const t=oT(e);if(this.pos>=Bn){this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1)}clearFromPos(e){let t;for(t=e;t<Bn;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let t=!0;for(let s=0;s<Bn;s++){const n=this.chars[s].uchar;n!==" "&&(t=!1),e.push(n)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}class Pf{constructor(e){this.rows=[],this.currRow=Qi-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let t=0;t<Qi;t++)this.rows.push(new $N(e));this.logger=e}reset(){for(let e=0;e<Qi;e++)this.rows[e].clear();this.currRow=Qi-1}equals(e){let t=!0;for(let s=0;s<Qi;s++)if(!this.rows[s].equals(e.rows[s])){t=!1;break}return t}copy(e){for(let t=0;t<Qi;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<Qi;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+Ut(e));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let c=0;c<Qi;c++)this.rows[c].clear();const r=this.currRow+1-this.nrRollUpRows,l=this.lastOutputScreen;if(l){const c=l.rows[r].cueStartTime,d=this.logger.time;if(c!==null&&d!==null&&c<d)for(let u=0;u<this.nrRollUpRows;u++)this.rows[t-this.nrRollUpRows+u+1].copy(l.rows[r+u])}}this.currRow=t;const s=this.rows[this.currRow];if(e.indent!==null){const r=e.indent,l=Math.max(r-1,0);s.setCursor(e.indent),e.color=s.chars[l].penState.foreground}const n={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(n)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+Ut(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());const e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const t=[];let s="",n=-1;for(let r=0;r<Qi;r++){const l=this.rows[r].getTextString();l&&(n=r+1,e?t.push("Row "+n+": '"+l+"'"):t.push(l.trim()))}return t.length>0&&(e?s="["+t.join(" | ")+"]":s=t.join(`
`)),s}getTextAndFormat(){return this.rows}}class Dx{constructor(e,t,s){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new Pf(s),this.nonDisplayedMemory=new Pf(s),this.lastOutputScreen=new Pf(s),this.currRollUpRow=this.displayedMemory.rows[Qi-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=s}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[Qi-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let s=0;s<e.length;s++)this.writeScreen.insertChar(e[s]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>t+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const t={flash:!1};if(t.underline=e%2===1,t.italics=e>=46,t.italics)t.foreground="white";else{const s=Math.floor(e/2)-16,n=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=n[s]}this.logger.log(2,"MIDROW: "+Ut(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){const t=this.logger.time;t!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=t:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class Px{constructor(e,t,s){this.channels=void 0,this.currentChannel=0,this.cmdHistory=HN(),this.logger=void 0;const n=this.logger=new BN;this.channels=[null,new Dx(e,t,n),new Dx(e+1,s,n)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){this.logger.time=e;for(let s=0;s<t.length;s+=2){const n=t[s]&127,r=t[s+1]&127;let l=!1,c=null;if(n===0&&r===0)continue;this.logger.log(3,()=>"["+Ka([t[s],t[s+1]])+"] -> ("+Ka([n,r])+")");const d=this.cmdHistory;if(n>=16&&n<=31){if(GN(n,r,d)){Zc(null,null,d),this.logger.log(3,()=>"Repeated command ("+Ka([n,r])+") is dropped");continue}Zc(n,r,this.cmdHistory),l=this.parseCmd(n,r),l||(l=this.parseMidrow(n,r)),l||(l=this.parsePAC(n,r)),l||(l=this.parseBackgroundAttributes(n,r))}else Zc(null,null,d);if(!l&&(c=this.parseChars(n,r),c)){const f=this.currentChannel;f&&f>0?this.channels[f].insertChars(c):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!l&&!c&&this.logger.log(2,()=>"Couldn't parse cleaned data "+Ka([n,r])+" orig: "+Ka([t[s],t[s+1]]))}}parseCmd(e,t){const s=(e===20||e===28||e===21||e===29)&&t>=32&&t<=47,n=(e===23||e===31)&&t>=33&&t<=35;if(!(s||n))return!1;const r=e===20||e===21||e===23?1:2,l=this.channels[r];return e===20||e===21||e===28||e===29?t===32?l.ccRCL():t===33?l.ccBS():t===34?l.ccAOF():t===35?l.ccAON():t===36?l.ccDER():t===37?l.ccRU(2):t===38?l.ccRU(3):t===39?l.ccRU(4):t===40?l.ccFON():t===41?l.ccRDC():t===42?l.ccTR():t===43?l.ccRTD():t===44?l.ccEDM():t===45?l.ccCR():t===46?l.ccENM():t===47&&l.ccEOC():l.ccTO(t-32),this.currentChannel=r,!0}parseMidrow(e,t){let s=0;if((e===17||e===25)&&t>=32&&t<=47){if(e===17?s=1:s=2,s!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const n=this.channels[s];return n?(n.ccMIDROW(t),this.logger.log(3,()=>"MIDROW ("+Ka([e,t])+")"),!0):!1}return!1}parsePAC(e,t){let s;const n=(e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127,r=(e===16||e===24)&&t>=64&&t<=95;if(!(n||r))return!1;const l=e<=23?1:2;t>=64&&t<=95?s=l===1?PN[e]:MN[e]:s=l===1?UN[e]:jN[e];const c=this.channels[l];return c?(c.setPAC(this.interpretPAC(s,t)),this.currentChannel=l,!0):!1}interpretPAC(e,t){let s;const n={color:null,italics:!1,indent:null,underline:!1,row:e};return t>95?s=t-96:s=t-64,n.underline=(s&1)===1,s<=13?n.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(s/2)]:s<=15?(n.italics=!0,n.color="white"):n.indent=Math.floor((s-16)/2)*4,n}parseChars(e,t){let s,n=null,r=null;if(e>=25?(s=2,r=e-8):(s=1,r=e),r>=17&&r<=19){let l;r===17?l=t+80:r===18?l=t+112:l=t+144,this.logger.log(2,()=>"Special char '"+oT(l)+"' in channel "+s),n=[l]}else e>=32&&e<=127&&(n=t===0?[e]:[e,t]);return n&&this.logger.log(3,()=>"Char codes =  "+Ka(n).join(",")),n}parseBackgroundAttributes(e,t){const s=(e===16||e===24)&&t>=32&&t<=47,n=(e===23||e===31)&&t>=45&&t<=47;if(!(s||n))return!1;let r;const l={};e===16||e===24?(r=Math.floor((t-32)/2),l.background=FN[r],t%2===1&&(l.background=l.background+"_semi")):t===45?l.background="transparent":(l.foreground="black",t===47&&(l.underline=!0));const c=e<=23?1:2;return this.channels[c].setBkgData(l),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}Zc(null,null,this.cmdHistory)}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){const s=this.channels[t];s&&s.cueSplitAtTime(e)}}}function Zc(i,e,t){t.a=i,t.b=e}function GN(i,e,t){return t.a===i&&t.b===e}function HN(){return{a:null,b:null}}var np=(function(){if(ku!=null&&ku.VTTCue)return self.VTTCue;const i=["","lr","rl"],e=["start","middle","end","left","right"];function t(c,d){if(typeof d!="string"||!Array.isArray(c))return!1;const u=d.toLowerCase();return~c.indexOf(u)?u:!1}function s(c){return t(i,c)}function n(c){return t(e,c)}function r(c,...d){let u=1;for(;u<arguments.length;u++){const f=arguments[u];for(const g in f)c[g]=f[g]}return c}function l(c,d,u){const f=this,g={enumerable:!0};f.hasBeenReset=!1;let y="",x=!1,S=c,E=d,T=u,A=null,I="",_=!0,C="auto",k="start",D=50,O="middle",F=50,j="middle";Object.defineProperty(f,"id",r({},g,{get:function(){return y},set:function(U){y=""+U}})),Object.defineProperty(f,"pauseOnExit",r({},g,{get:function(){return x},set:function(U){x=!!U}})),Object.defineProperty(f,"startTime",r({},g,{get:function(){return S},set:function(U){if(typeof U!="number")throw new TypeError("Start time must be set to a number.");S=U,this.hasBeenReset=!0}})),Object.defineProperty(f,"endTime",r({},g,{get:function(){return E},set:function(U){if(typeof U!="number")throw new TypeError("End time must be set to a number.");E=U,this.hasBeenReset=!0}})),Object.defineProperty(f,"text",r({},g,{get:function(){return T},set:function(U){T=""+U,this.hasBeenReset=!0}})),Object.defineProperty(f,"region",r({},g,{get:function(){return A},set:function(U){A=U,this.hasBeenReset=!0}})),Object.defineProperty(f,"vertical",r({},g,{get:function(){return I},set:function(U){const K=s(U);if(K===!1)throw new SyntaxError("An invalid or illegal string was specified.");I=K,this.hasBeenReset=!0}})),Object.defineProperty(f,"snapToLines",r({},g,{get:function(){return _},set:function(U){_=!!U,this.hasBeenReset=!0}})),Object.defineProperty(f,"line",r({},g,{get:function(){return C},set:function(U){if(typeof U!="number"&&U!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");C=U,this.hasBeenReset=!0}})),Object.defineProperty(f,"lineAlign",r({},g,{get:function(){return k},set:function(U){const K=n(U);if(!K)throw new SyntaxError("An invalid or illegal string was specified.");k=K,this.hasBeenReset=!0}})),Object.defineProperty(f,"position",r({},g,{get:function(){return D},set:function(U){if(U<0||U>100)throw new Error("Position must be between 0 and 100.");D=U,this.hasBeenReset=!0}})),Object.defineProperty(f,"positionAlign",r({},g,{get:function(){return O},set:function(U){const K=n(U);if(!K)throw new SyntaxError("An invalid or illegal string was specified.");O=K,this.hasBeenReset=!0}})),Object.defineProperty(f,"size",r({},g,{get:function(){return F},set:function(U){if(U<0||U>100)throw new Error("Size must be between 0 and 100.");F=U,this.hasBeenReset=!0}})),Object.defineProperty(f,"align",r({},g,{get:function(){return j},set:function(U){const K=n(U);if(!K)throw new SyntaxError("An invalid or illegal string was specified.");j=K,this.hasBeenReset=!0}})),f.displayState=void 0}return l.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},l})();class zN{decode(e,t){if(!e)return"";if(typeof e!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function uT(i){function e(s,n,r,l){return(s|0)*3600+(n|0)*60+(r|0)+parseFloat(l||0)}const t=i.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return t?parseFloat(t[2])>59?e(t[2],t[3],0,t[4]):e(t[1],t[2],t[3],t[4]):null}class KN{constructor(){this.values=Object.create(null)}set(e,t){!this.get(e)&&t!==""&&(this.values[e]=t)}get(e,t,s){return s?this.has(e)?this.values[e]:t[s]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,s){for(let n=0;n<s.length;++n)if(t===s[n]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const s=parseFloat(t);if(s>=0&&s<=100)return this.set(e,s),!0}return!1}}function dT(i,e,t,s){const n=s?i.split(s):[i];for(const r in n){if(typeof n[r]!="string")continue;const l=n[r].split(t);if(l.length!==2)continue;const c=l[0],d=l[1];e(c,d)}}const pm=new np(0,0,""),Jc=pm.align==="middle"?"middle":"center";function YN(i,e,t){const s=i;function n(){const c=uT(i);if(c===null)throw new Error("Malformed timestamp: "+s);return i=i.replace(/^[^\sa-zA-Z-]+/,""),c}function r(c,d){const u=new KN;dT(c,function(y,x){let S;switch(y){case"region":for(let E=t.length-1;E>=0;E--)if(t[E].id===x){u.set(y,t[E].region);break}break;case"vertical":u.alt(y,x,["rl","lr"]);break;case"line":S=x.split(","),u.integer(y,S[0]),u.percent(y,S[0])&&u.set("snapToLines",!1),u.alt(y,S[0],["auto"]),S.length===2&&u.alt("lineAlign",S[1],["start",Jc,"end"]);break;case"position":S=x.split(","),u.percent(y,S[0]),S.length===2&&u.alt("positionAlign",S[1],["start",Jc,"end","line-left","line-right","auto"]);break;case"size":u.percent(y,x);break;case"align":u.alt(y,x,["start",Jc,"end","left","right"]);break}},/:/,/\s/),d.region=u.get("region",null),d.vertical=u.get("vertical","");let f=u.get("line","auto");f==="auto"&&pm.line===-1&&(f=-1),d.line=f,d.lineAlign=u.get("lineAlign","start"),d.snapToLines=u.get("snapToLines",!0),d.size=u.get("size",100),d.align=u.get("align",Jc);let g=u.get("position","auto");g==="auto"&&pm.position===50&&(g=d.align==="start"||d.align==="left"?0:d.align==="end"||d.align==="right"?100:50),d.position=g}function l(){i=i.replace(/^\s+/,"")}if(l(),e.startTime=n(),l(),i.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+s);i=i.slice(3),l(),e.endTime=n(),l(),r(i,e)}function hT(i){return i.replace(/<br(?: \/)?>/gi,`
`)}class qN{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new zN,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const t=this;e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));function s(){let r=t.buffer,l=0;for(r=hT(r);l<r.length&&r[l]!=="\r"&&r[l]!==`
`;)++l;const c=r.slice(0,l);return r[l]==="\r"&&++l,r[l]===`
`&&++l,t.buffer=r.slice(l),c}function n(r){dT(r,function(l,c){},/:/)}try{let r="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;r=s();const c=r.match(/^()?WEBVTT([ \t].*)?$/);if(!(c!=null&&c[0]))throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let l=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(l?l=!1:r=s(),t.state){case"HEADER":/:/.test(r)?n(r):r||(t.state="ID");continue;case"NOTE":r||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(r)){t.state="NOTE";break}if(!r)continue;if(t.cue=new np(0,0,""),t.state="CUE",r.indexOf("-->")===-1){t.cue.id=r;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{YN(r,t.cue,t.regionList)}catch{t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const c=r.indexOf("-->")!==-1;if(!r||c&&(l=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=r}continue;case"BADCUE":r||(t.state="ID")}}}catch{t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||e.state==="HEADER")&&(e.buffer+=`

`,e.parse()),e.state==="INITIAL"||e.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}}const QN=/\r\n|\n\r|\n|\r/g,Uf=function(e,t,s=0){return e.slice(s,s+t.length)===t},WN=function(e){let t=parseInt(e.slice(-3));const s=parseInt(e.slice(-6,-4)),n=parseInt(e.slice(-9,-7)),r=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!ke(t)||!ke(s)||!ke(n)||!ke(r))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*s,t+=60*1e3*n,t+=3600*1e3*r,t};function ap(i,e,t){return ao(i.toString())+ao(e.toString())+ao(t)}const XN=function(e,t,s){let n=e[t],r=e[n.prevCC];if(!r||!r.new&&n.new){e.ccOffset=e.presentationOffset=n.start,n.new=!1;return}for(;(l=r)!=null&&l.new;){var l;e.ccOffset+=n.start-r.start,n.new=!1,n=r,r=e[n.prevCC]}e.presentationOffset=s};function ZN(i,e,t,s,n,r,l){const c=new qN,d=Ti(new Uint8Array(i)).trim().replace(QN,`
`).split(`
`),u=[],f=e?nk(e.baseTime,e.timescale):0;let g="00:00.000",y=0,x=0,S,E=!0;c.oncue=function(T){const A=t[s];let I=t.ccOffset;const _=(y-f)/9e4;if(A!=null&&A.new&&(x!==void 0?I=t.ccOffset=A.start:XN(t,s,_)),_){if(!e){S=new Error("Missing initPTS for VTT MPEGTS");return}I=_-t.presentationOffset}const C=T.endTime-T.startTime,k=yi((T.startTime+I-x)*9e4,n*9e4)/9e4;T.startTime=Math.max(k,0),T.endTime=Math.max(k+C,0);const D=T.text.trim();T.text=decodeURIComponent(encodeURIComponent(D)),T.id||(T.id=ap(T.startTime,T.endTime,D)),T.endTime>0&&u.push(T)},c.onparsingerror=function(T){S=T},c.onflush=function(){if(S){l(S);return}r(u)},d.forEach(T=>{if(E)if(Uf(T,"X-TIMESTAMP-MAP=")){E=!1,T.slice(16).split(",").forEach(A=>{Uf(A,"LOCAL:")?g=A.slice(6):Uf(A,"MPEGTS:")&&(y=parseInt(A.slice(7)))});try{x=WN(g)/1e3}catch(A){S=A}return}else T===""&&(E=!1);c.parse(T+`
`)}),c.flush()}const Mf="stpp.ttml.im1t",fT=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,mT=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,JN={left:"start",center:"center",right:"end",start:"start",end:"end"};function Ux(i,e,t,s){const n=st(new Uint8Array(i),["mdat"]);if(n.length===0){s(new Error("Could not parse IMSC1 mdat"));return}const r=n.map(c=>Ti(c)),l=ik(e.baseTime,1,e.timescale);try{r.forEach(c=>t(eO(c,l)))}catch(c){s(c)}}function eO(i,e){const n=new DOMParser().parseFromString(i,"text/xml").getElementsByTagName("tt")[0];if(!n)throw new Error("Invalid ttml");const r={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},l=Object.keys(r).reduce((g,y)=>(g[y]=n.getAttribute(`ttp:${y}`)||r[y],g),{}),c=n.getAttribute("xml:space")!=="preserve",d=Mx(jf(n,"styling","style")),u=Mx(jf(n,"layout","region")),f=jf(n,"body","[begin]");return[].map.call(f,g=>{const y=pT(g,c);if(!y||!g.hasAttribute("begin"))return null;const x=Bf(g.getAttribute("begin"),l),S=Bf(g.getAttribute("dur"),l);let E=Bf(g.getAttribute("end"),l);if(x===null)throw jx(g);if(E===null){if(S===null)throw jx(g);E=x+S}const T=new np(x-e,E-e,y);T.id=ap(T.startTime,T.endTime,T.text);const A=u[g.getAttribute("region")],I=d[g.getAttribute("style")],_=tO(A,I,d),{textAlign:C}=_;if(C){const k=JN[C];k&&(T.lineAlign=k),T.align=C}return Ot(T,_),T}).filter(g=>g!==null)}function jf(i,e,t){const s=i.getElementsByTagName(e)[0];return s?[].slice.call(s.querySelectorAll(t)):[]}function Mx(i){return i.reduce((e,t)=>{const s=t.getAttribute("xml:id");return s&&(e[s]=t),e},{})}function pT(i,e){return[].slice.call(i.childNodes).reduce((t,s,n)=>{var r;return s.nodeName==="br"&&n?t+`
`:(r=s.childNodes)!=null&&r.length?pT(s,e):e?t+s.textContent.trim().replace(/\s+/g," "):t+s.textContent},"")}function tO(i,e,t){const s="http://www.w3.org/ns/ttml#styling";let n=null;const r=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],l=i!=null&&i.hasAttribute("style")?i.getAttribute("style"):null;return l&&t.hasOwnProperty(l)&&(n=t[l]),r.reduce((c,d)=>{const u=Ff(e,s,d)||Ff(i,s,d)||Ff(n,s,d);return u&&(c[d]=u),c},{})}function Ff(i,e,t){return i&&i.hasAttributeNS(e,t)?i.getAttributeNS(e,t):null}function jx(i){return new Error(`Could not parse ttml timestamp ${i}`)}function Bf(i,e){if(!i)return null;let t=uT(i);return t===null&&(fT.test(i)?t=sO(i,e):mT.test(i)&&(t=iO(i,e))),t}function sO(i,e){const t=fT.exec(i),s=(t[4]|0)+(t[5]|0)/e.subFrameRate;return(t[1]|0)*3600+(t[2]|0)*60+(t[3]|0)+s/e.frameRate}function iO(i,e){const t=mT.exec(i),s=Number(t[1]);switch(t[2]){case"h":return s*3600;case"m":return s*60;case"ms":return s*1e3;case"f":return s/e.frameRate;case"t":return s/e.tickRate}return s}class eu{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,s){(this.startTime===null||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=s,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}class nO{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=Bx(),this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(L.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(L.FRAG_LOADING,this.onFragLoading,this),e.on(L.FRAG_LOADED,this.onFragLoaded,this),e.on(L.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(L.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(L.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(L.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(L.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(L.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(L.FRAG_LOADING,this.onFragLoading,this),e.off(L.FRAG_LOADED,this.onFragLoaded,this),e.off(L.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(L.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(L.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(L.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(L.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){const e=new eu(this,"textTrack1"),t=new eu(this,"textTrack2"),s=new eu(this,"textTrack3"),n=new eu(this,"textTrack4");this.cea608Parser1=new Px(1,e,t),this.cea608Parser2=new Px(3,s,n)}addCues(e,t,s,n,r){let l=!1;for(let c=r.length;c--;){const d=r[c],u=aO(d[0],d[1],t,s);if(u>=0&&(d[0]=Math.min(d[0],t),d[1]=Math.max(d[1],s),l=!0,u/(s-t)>.5))return}if(l||r.push([t,s]),this.config.renderTextTracksNatively){const c=this.captionsTracks[e];this.Cues.newCue(c,t,s,n)}else{const c=this.Cues.newCue(null,t,s,n);this.hls.trigger(L.CUES_PARSED,{type:"captions",cues:c,track:e})}}onInitPtsFound(e,{frag:t,id:s,initPTS:n,timescale:r,trackId:l}){const{unparsedVttFrags:c}=this;s===De.MAIN&&(this.initPTS[t.cc]={baseTime:n,timescale:r,trackId:l}),c.length&&(this.unparsedVttFrags=[],c.forEach(d=>{this.initPTS[d.frag.cc]?this.onFragLoaded(L.FRAG_LOADED,d):this.hls.trigger(L.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:d.frag,error:new Error("Subtitle discontinuity domain does not match main")})}))}getExistingTrack(e,t){const{media:s}=this;if(s)for(let n=0;n<s.textTracks.length;n++){const r=s.textTracks[n];if(Fx(r,{name:e,lang:t,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return r}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:t,captionsTracks:s,media:n}=this,{label:r,languageCode:l}=t[e],c=this.getExistingTrack(r,l);if(c)s[e]=c,Hr(s[e]),aT(s[e],n);else{const d=this.createTextTrack("captions",r,l);d&&(d[e]=!0,s[e]=d)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const s=t.label,n={_id:e,label:s,kind:"captions",default:t.media?!!t.media.default:!1,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=n,this.hls.trigger(L.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[n]})}createTextTrack(e,t,s){const n=this.media;if(n)return n.addTextTrack(e,t,s)}onMediaAttaching(e,t){this.media=t.media,t.mediaSource||this._cleanTracks()}onMediaDetaching(e,t){const s=!!t.transferMedia;if(this.media=null,s)return;const{captionsTracks:n}=this;Object.keys(n).forEach(r=>{Hr(n[r]),delete n[r]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=Bx(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const t=e.textTracks;if(t)for(let s=0;s<t.length;s++)Hr(t[s])}onSubtitleTracksUpdated(e,t){const s=t.subtitleTracks||[],n=s.some(r=>r.textCodec===Mf);if(this.config.enableWebVTT||n&&this.config.enableIMSC1){if(Kb(this.tracks,s)){this.tracks=s;return}if(this.textTracks=[],this.tracks=s,this.config.renderTextTracksNatively){const l=this.media,c=l?pu(l.textTracks):null;if(this.tracks.forEach((d,u)=>{let f;if(c){let g=null;for(let y=0;y<c.length;y++)if(c[y]&&Fx(c[y],d)){g=c[y],c[y]=null;break}g&&(f=g)}if(f)Hr(f);else{const g=gT(d);f=this.createTextTrack(g,d.name,d.lang),f&&(f.mode="disabled")}f&&this.textTracks.push(f)}),c!=null&&c.length){const d=c.filter(u=>u!==null).map(u=>u.label);d.length&&this.hls.logger.warn(`Media element contains unused subtitle tracks: ${d.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const l=this.tracks.map(c=>({label:c.name,kind:c.type.toLowerCase(),default:c.default,subtitleTrack:c}));this.hls.trigger(L.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:l})}}}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(s=>{const n=/(?:CC|SERVICE)([1-4])/.exec(s.instreamId);if(!n)return;const r=`textTrack${n[1]}`,l=this.captionsProperties[r];l&&(l.label=s.name,s.lang&&(l.languageCode=s.lang),l.media=s)})}closedCaptionsForLevel(e){const t=this.hls.levels[e.level];return t?.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){if(this.enabled&&t.frag.type===De.MAIN){var s,n;const{cea608Parser1:r,cea608Parser2:l,lastSn:c}=this,{cc:d,sn:u}=t.frag,f=(s=(n=t.part)==null?void 0:n.index)!=null?s:-1;r&&l&&(u!==c+1||u===c&&f!==this.lastPartIndex+1||d!==this.lastCc)&&(r.reset(),l.reset()),this.lastCc=d,this.lastSn=u,this.lastPartIndex=f}}onFragLoaded(e,t){const{frag:s,payload:n}=t;if(s.type===De.SUBTITLE)if(n.byteLength){const r=s.decryptdata,l="stats"in t;if(r==null||!r.encrypted||l){const c=this.tracks[s.level],d=this.vttCCs;d[s.cc]||(d[s.cc]={start:s.start,prevCC:this.prevCC,new:!0},this.prevCC=s.cc),c&&c.textCodec===Mf?this._parseIMSC1(s,n):this._parseVTTs(t)}}else this.hls.trigger(L.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:s,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){const s=this.hls;Ux(t,this.initPTS[e.cc],n=>{this._appendCues(n,e.level),s.trigger(L.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},n=>{s.logger.log(`Failed to parse IMSC1: ${n}`),s.trigger(L.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:n})})}_parseVTTs(e){var t;const{frag:s,payload:n}=e,{initPTS:r,unparsedVttFrags:l}=this,c=r.length-1;if(!r[s.cc]&&c===-1){l.push(e);return}const d=this.hls,u=(t=s.initSegment)!=null&&t.data?Fi(s.initSegment.data,new Uint8Array(n)).buffer:n;ZN(u,this.initPTS[s.cc],this.vttCCs,s.cc,s.start,f=>{this._appendCues(f,s.level),d.trigger(L.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:s})},f=>{const g=f.message==="Missing initPTS for VTT MPEGTS";g?l.push(e):this._fallbackToIMSC1(s,n),d.logger.log(`Failed to parse VTT cue: ${f}`),!(g&&c>s.cc)&&d.trigger(L.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:s,error:f})})}_fallbackToIMSC1(e,t){const s=this.tracks[e.level];s.textCodec||Ux(t,this.initPTS[e.cc],()=>{s.textCodec=Mf,this._parseIMSC1(e,t)},()=>{s.textCodec="wvtt"})}_appendCues(e,t){const s=this.hls;if(this.config.renderTextTracksNatively){const n=this.textTracks[t];if(!n||n.mode==="disabled")return;e.forEach(r=>rT(n,r))}else{const n=this.tracks[t];if(!n)return;const r=n.default?"default":"subtitles"+t;s.trigger(L.CUES_PARSED,{type:"subtitles",cues:e,track:r})}}onFragDecrypted(e,t){const{frag:s}=t;s.type===De.SUBTITLE&&this.onFragLoaded(L.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){if(!this.enabled||!this.config.enableCEA708Captions)return;const{frag:s,samples:n}=t;if(!(s.type===De.MAIN&&this.closedCaptionsForLevel(s)==="NONE"))for(let r=0;r<n.length;r++){const l=n[r].bytes;if(l){this.cea608Parser1||this.initCea608Parsers();const c=this.extractCea608Data(l);this.cea608Parser1.addData(n[r].pts,c[0]),this.cea608Parser2.addData(n[r].pts,c[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:s,endOffsetSubtitles:n,type:r}){const{media:l}=this;if(!(!l||l.currentTime<s)){if(!r||r==="video"){const{captionsTracks:c}=this;Object.keys(c).forEach(d=>mm(c[d],t,s))}if(this.config.renderTextTracksNatively&&t===0&&n!==void 0){const{textTracks:c}=this;Object.keys(c).forEach(d=>mm(c[d],t,n))}}}extractCea608Data(e){const t=[[],[]],s=e[0]&31;let n=2;for(let r=0;r<s;r++){const l=e[n++],c=127&e[n++],d=127&e[n++];if(c===0&&d===0)continue;if((4&l)!==0){const f=3&l;(f===0||f===1)&&(t[f].push(c),t[f].push(d))}}return t}}function gT(i){return i.characteristics&&/transcribes-spoken-dialog/gi.test(i.characteristics)&&/describes-music-and-sound/gi.test(i.characteristics)?"captions":"subtitles"}function Fx(i,e){return!!i&&i.kind===gT(e)&&um(e,i)}function aO(i,e,t,s){return Math.min(e,s)-Math.max(i,t)}function Bx(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}const rO=/\s/,lO={newCue(i,e,t,s){const n=[];let r,l,c,d,u;const f=self.VTTCue||self.TextTrackCue;for(let y=0;y<s.rows.length;y++)if(r=s.rows[y],c=!0,d=0,u="",!r.isEmpty()){var g;for(let E=0;E<r.chars.length;E++)rO.test(r.chars[E].uchar)&&c?d++:(u+=r.chars[E].uchar,c=!1);r.cueStartTime=e,e===t&&(t+=1e-4),d>=16?d--:d++;const x=hT(u.trim()),S=ap(e,t,x);i!=null&&(g=i.cues)!=null&&g.getCueById(S)||(l=new f(e,t,x),l.id=S,l.line=y+1,l.align="left",l.position=10+Math.min(80,Math.floor(d*8/32)*10),n.push(l))}return i&&n.length&&(n.sort((y,x)=>y.line==="auto"||x.line==="auto"?0:y.line>8&&x.line>8?x.line-y.line:y.line-x.line),n.forEach(y=>rT(i,y))),n}};function oO(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}const cO=/(\d+)-(\d+)\/(\d+)/;class Vx{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||fO,this.controller=new self.AbortController,this.stats=new Mm}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,s){const n=this.stats;if(n.loading.start)throw new Error("Loader can only be used once.");n.loading.start=self.performance.now();const r=uO(e,this.controller.signal),l=e.responseType==="arraybuffer",c=l?"byteLength":"length",{maxTimeToFirstByteMs:d,maxLoadTimeMs:u}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=s,this.request=this.fetchSetup(e,r),self.clearTimeout(this.requestTimeout),t.timeout=d&&ke(d)?d:u,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(n,e,this.response))},t.timeout),(fo(this.request)?this.request.then(self.fetch):self.fetch(this.request)).then(g=>{var y;this.response=this.loader=g;const x=Math.max(self.performance.now(),n.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=u,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(n,e,this.response))},u-(x-n.loading.start)),!g.ok){const{status:E,statusText:T}=g;throw new mO(T||"fetch, bad network response",E,g)}n.loading.first=x,n.total=hO(g.headers)||n.total;const S=(y=this.callbacks)==null?void 0:y.onProgress;return S&&ke(t.highWaterMark)?this.loadProgressively(g,n,e,t.highWaterMark,S):l?g.arrayBuffer():e.responseType==="json"?g.json():g.text()}).then(g=>{var y,x;const S=this.response;if(!S)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),n.loading.end=Math.max(self.performance.now(),n.loading.first);const E=g[c];E&&(n.loaded=n.total=E);const T={url:S.url,data:g,code:S.status},A=(y=this.callbacks)==null?void 0:y.onProgress;A&&!ke(t.highWaterMark)&&A(n,e,g,S),(x=this.callbacks)==null||x.onSuccess(T,n,e,S)}).catch(g=>{var y;if(self.clearTimeout(this.requestTimeout),n.aborted)return;const x=g&&g.code||0,S=g?g.message:null;(y=this.callbacks)==null||y.onError({code:x,text:S},e,g?g.details:null,n)})}getCacheAge(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,s,n=0,r){const l=new Ib,c=e.body.getReader(),d=()=>c.read().then(u=>{if(u.done)return l.dataLength&&r(t,s,l.flush().buffer,e),Promise.resolve(new ArrayBuffer(0));const f=u.value,g=f.length;return t.loaded+=g,g<n||l.dataLength?(l.push(f),l.dataLength>=n&&r(t,s,l.flush().buffer,e)):r(t,s,f.buffer,e),d()}).catch(()=>Promise.reject());return d()}}function uO(i,e){const t={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers(Ot({},i.headers))};return i.rangeEnd&&t.headers.set("Range","bytes="+i.rangeStart+"-"+String(i.rangeEnd-1)),t}function dO(i){const e=cO.exec(i);if(e)return parseInt(e[2])-parseInt(e[1])+1}function hO(i){const e=i.get("Content-Range");if(e){const s=dO(e);if(ke(s))return s}const t=i.get("Content-Length");if(t)return parseInt(t)}function fO(i,e){return new self.Request(i.url,e)}class mO extends Error{constructor(e,t,s){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=s}}const pO=/^age:\s*[\d.]+\s*$/im;class yT{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new Mm,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,e.readyState!==4&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,s){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=s,this.loadInternal()}loadInternal(){const{config:e,context:t}=this;if(!e||!t)return;const s=this.loader=new self.XMLHttpRequest,n=this.stats;n.loading.first=0,n.loaded=0,n.aborted=!1;const r=this.xhrSetup;r?Promise.resolve().then(()=>{if(!(this.loader!==s||this.stats.aborted))return r(s,t.url)}).catch(l=>{if(!(this.loader!==s||this.stats.aborted))return s.open("GET",t.url,!0),r(s,t.url)}).then(()=>{this.loader!==s||this.stats.aborted||this.openAndSendXhr(s,t,e)}).catch(l=>{var c;(c=this.callbacks)==null||c.onError({code:s.status,text:l.message},t,s,n)}):this.openAndSendXhr(s,t,e)}openAndSendXhr(e,t,s){e.readyState||e.open("GET",t.url,!0);const n=t.headers,{maxTimeToFirstByteMs:r,maxLoadTimeMs:l}=s.loadPolicy;if(n)for(const c in n)e.setRequestHeader(c,n[c]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),s.timeout=r&&ke(r)?r:l,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),s.timeout),e.send()}readystatechange(){const{context:e,loader:t,stats:s}=this;if(!e||!t)return;const n=t.readyState,r=this.config;if(!s.aborted&&n>=2&&(s.loading.first===0&&(s.loading.first=Math.max(self.performance.now(),s.loading.start),r.timeout!==r.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),r.timeout=r.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),r.loadPolicy.maxLoadTimeMs-(s.loading.first-s.loading.start)))),n===4)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const u=t.status,f=t.responseType==="text"?t.responseText:null;if(u>=200&&u<300){const S=f??t.response;if(S!=null){var l,c;s.loading.end=Math.max(self.performance.now(),s.loading.first);const E=t.responseType==="arraybuffer"?S.byteLength:S.length;s.loaded=s.total=E,s.bwEstimate=s.total*8e3/(s.loading.end-s.loading.first);const T=(l=this.callbacks)==null?void 0:l.onProgress;T&&T(s,e,S,t);const A={url:t.responseURL,data:S,code:u};(c=this.callbacks)==null||c.onSuccess(A,s,e,t);return}}const g=r.loadPolicy.errorRetry,y=s.retry,x={url:e.url,data:void 0,code:u};if(wu(g,y,!1,x))this.retry(g);else{var d;wt.error(`${u} while loading ${e.url}`),(d=this.callbacks)==null||d.onError({code:u,text:t.statusText},e,t,s)}}}loadtimeout(){if(!this.config)return;const e=this.config.loadPolicy.timeoutRetry,t=this.stats.retry;if(wu(e,t,!0))this.retry(e);else{var s;wt.warn(`timeout while loading ${(s=this.context)==null?void 0:s.url}`);const n=this.callbacks;n&&(this.abortInternal(),n.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:t,stats:s}=this;this.retryDelay=Vm(e,s.retry),s.retry++,wt.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${t?.url}, retrying ${s.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&pO.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}const gO={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},yO=Lt(Lt({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,startOnSegmentBoundary:!1,maxBufferSize:60*1e3*1e3,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncMode:"edge",liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:yT,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:ww,bufferController:xk,capLevelController:tp,errorController:Dw,fpsController:SN,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:pb,requireKeySystemAccessOnStart:!1,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,preserveManualLevelOnError:!1,certLoadPolicy:{default:gO},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},vO()),{},{subtitleStreamController:NN,subtitleTrackController:EN,timelineController:nO,audioStreamController:pk,audioTrackController:gk,emeController:qr,cmcdController:gN,contentSteeringController:vN,interstitialsController:kN});function vO(){return{cueHandler:lO,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function xO(i,e,t){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(e.liveMaxLatencyDurationCount!==void 0&&(e.liveSyncDurationCount===void 0||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(e.liveMaxLatencyDuration!==void 0&&(e.liveSyncDuration===void 0||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const s=gm(i),n=["manifest","level","frag"],r=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return n.forEach(l=>{const c=`${l==="level"?"playlist":l}LoadPolicy`,d=e[c]===void 0,u=[];r.forEach(f=>{const g=`${l}Loading${f}`,y=e[g];if(y!==void 0&&d){u.push(g);const x=s[c].default;switch(e[c]={default:x},f){case"TimeOut":x.maxLoadTimeMs=y,x.maxTimeToFirstByteMs=y;break;case"MaxRetry":x.errorRetry.maxNumRetry=y,x.timeoutRetry.maxNumRetry=y;break;case"RetryDelay":x.errorRetry.retryDelayMs=y,x.timeoutRetry.retryDelayMs=y;break;case"MaxRetryTimeout":x.errorRetry.maxRetryDelayMs=y,x.timeoutRetry.maxRetryDelayMs=y;break}}}),u.length&&t.warn(`hls.js config: "${u.join('", "')}" setting(s) are deprecated, use "${c}": ${Ut(e[c])}`)}),Lt(Lt({},s),e)}function gm(i){return i&&typeof i=="object"?Array.isArray(i)?i.map(gm):Object.keys(i).reduce((e,t)=>(e[t]=gm(i[t]),e),{}):i}function SO(i,e){const t=i.loader;t!==Vx&&t!==yT?(e.log("[config]: Custom loader detected, cannot enable progressive streaming"),i.progressive=!1):oO()&&(i.loader=Vx,i.progressive=!0,i.enableSoftwareAES=!0,e.log("[config]: Progressive streaming enabled, using FetchLoader"))}const gu=2,bO=.1,TO=.05,EO=100;class AO extends ub{constructor(e,t){super("gap-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.media=null,this.mediaSource=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.buffered={},this.lastCurrentTime=0,this.ended=0,this.waiting=0,this.onMediaPlaying=()=>{this.ended=0,this.waiting=0},this.onMediaWaiting=()=>{var s;(s=this.media)!=null&&s.seeking||(this.waiting=self.performance.now(),this.tick())},this.onMediaEnded=()=>{if(this.hls){var s;this.ended=((s=this.media)==null?void 0:s.currentTime)||1,this.hls.trigger(L.MEDIA_ENDED,{stalled:!1})}},this.hls=e,this.fragmentTracker=t,this.registerListeners()}registerListeners(){const{hls:e}=this;e&&(e.on(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(L.BUFFER_APPENDED,this.onBufferAppended,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(L.BUFFER_APPENDED,this.onBufferAppended,this))}destroy(){super.destroy(),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0}onMediaAttached(e,t){this.setInterval(EO),this.mediaSource=t.mediaSource;const s=this.media=t.media;Bs(s,"playing",this.onMediaPlaying),Bs(s,"waiting",this.onMediaWaiting),Bs(s,"ended",this.onMediaEnded)}onMediaDetaching(e,t){this.clearInterval();const{media:s}=this;s&&(ei(s,"playing",this.onMediaPlaying),ei(s,"waiting",this.onMediaWaiting),ei(s,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0}onBufferAppended(e,t){this.buffered=t.timeRanges}get hasBuffered(){return Object.keys(this.buffered).length>0}tick(){var e;if(!((e=this.media)!=null&&e.readyState)||!this.hasBuffered)return;const t=this.media.currentTime;this.poll(t,this.lastCurrentTime),this.lastCurrentTime=t}poll(e,t){var s,n;const r=(s=this.hls)==null?void 0:s.config;if(!r)return;const l=this.media;if(!l)return;const{seeking:c}=l,d=this.seeking&&!c,u=!this.seeking&&c,f=l.paused&&!c||l.ended||l.playbackRate===0;if(this.seeking=c,e!==t){t&&(this.ended=0),this.moved=!0,c||(this.nudgeRetry=0,r.nudgeOnVideoHole&&!f&&e>t&&this.nudgeOnVideoHole(e,t)),this.waiting===0&&this.stallResolved(e);return}if(u||d){d&&this.stallResolved(e);return}if(f){this.nudgeRetry=0,this.stallResolved(e),!this.ended&&l.ended&&this.hls&&(this.ended=e||1,this.hls.trigger(L.MEDIA_ENDED,{stalled:!1}));return}if(!Xe.getBuffered(l).length){this.nudgeRetry=0;return}const g=Xe.bufferInfo(l,e,0),y=g.nextStart||0,x=this.fragmentTracker;if(c&&x&&this.hls){const D=$x(this.hls.inFlightFragments,e),O=g.len>gu,F=!y||D||y-e>gu&&!x.getPartialFragment(e);if(O||F)return;this.moved=!1}const S=(n=this.hls)==null?void 0:n.latestLevelDetails;if(!this.moved&&this.stalled!==null&&x){if(!(g.len>0)&&!y)return;const O=Math.max(y,g.start||0)-e,j=!!(S!=null&&S.live)?S.targetduration*2:gu,U=tu(e,x);if(O>0&&(O<=j||U)){l.paused||this._trySkipBufferHole(U);return}}const E=r.detectStallWithCurrentTimeMs,T=self.performance.now(),A=this.waiting;let I=this.stalled;if(I===null)if(A>0&&T-A<E)I=this.stalled=A;else{this.stalled=T;return}const _=T-I;if(!c&&(_>=E||A)&&this.hls){var C;if(((C=this.mediaSource)==null?void 0:C.readyState)==="ended"&&!(S!=null&&S.live)&&Math.abs(e-(S?.edge||0))<1){if(this.ended)return;this.ended=e||1,this.hls.trigger(L.MEDIA_ENDED,{stalled:!0});return}if(this._reportStall(g),!this.media||!this.hls)return}const k=Xe.bufferInfo(l,e,r.maxBufferHole);this._tryFixBufferStall(k,_,e)}stallResolved(e){const t=this.stalled;if(t&&this.hls&&(this.stalled=null,this.stallReported)){const s=self.performance.now()-t;this.log(`playback not stuck anymore @${e}, after ${Math.round(s)}ms`),this.stallReported=!1,this.waiting=0,this.hls.trigger(L.STALL_RESOLVED,{})}}nudgeOnVideoHole(e,t){var s;const n=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&(s=this.buffered.audio)!=null&&s.length&&n&&n.length>1&&e>n.end(0)){const r=Xe.bufferedInfo(Xe.timeRangesToArray(this.buffered.audio),e,0);if(r.len>1&&t>=r.start){const l=Xe.timeRangesToArray(n),c=Xe.bufferedInfo(l,t,0).bufferedIndex;if(c>-1&&c<l.length-1){const d=Xe.bufferedInfo(l,e,0).bufferedIndex,u=l[c].end,f=l[c+1].start;if((d===-1||d>c)&&f-u<1&&e-u<2){const g=new Error(`nudging playhead to flush pipeline after video hole. currentTime: ${e} hole: ${u} -> ${f} buffered index: ${d}`);this.warn(g.message),this.media.currentTime+=1e-6;let y=tu(e,this.fragmentTracker);y&&"fragment"in y?y=y.fragment:y||(y=void 0);const x=Xe.bufferInfo(this.media,e,0);this.hls.trigger(L.ERROR,{type:je.MEDIA_ERROR,details:W.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:g,reason:g.message,frag:y,buffer:x.len,bufferInfo:x})}}}}}_tryFixBufferStall(e,t,s){var n,r;const{fragmentTracker:l,media:c}=this,d=(n=this.hls)==null?void 0:n.config;if(!c||!l||!d)return;const u=(r=this.hls)==null?void 0:r.latestLevelDetails,f=tu(s,l);if((f||u!=null&&u.live&&s<u.fragmentStart)&&(this._trySkipBufferHole(f)||!this.media))return;const g=e.buffered,y=this.adjacentTraversal(e,s);(g&&g.length>1&&e.len>d.maxBufferHole||e.nextStart&&(e.nextStart-s<d.maxBufferHole||y))&&(t>d.highBufferWatchdogPeriod*1e3||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(e))}adjacentTraversal(e,t){const s=this.fragmentTracker,n=e.nextStart;if(s&&n){const r=s.getFragAtPos(t,De.MAIN),l=s.getFragAtPos(n,De.MAIN);if(r&&l)return l.sn-r.sn<2}return!1}_reportStall(e){const{hls:t,media:s,stallReported:n,stalled:r}=this;if(!n&&r!==null&&s&&t){this.stallReported=!0;const l=new Error(`Playback stalling at @${s.currentTime} due to low buffer (${Ut(e)})`);this.warn(l.message),t.trigger(L.ERROR,{type:je.MEDIA_ERROR,details:W.BUFFER_STALLED_ERROR,fatal:!1,error:l,buffer:e.len,bufferInfo:e,stalled:{start:r}})}}_trySkipBufferHole(e){var t;const{fragmentTracker:s,media:n}=this,r=(t=this.hls)==null?void 0:t.config;if(!n||!s||!r)return 0;const l=n.currentTime,c=Xe.bufferInfo(n,l,0),d=l<c.start?c.start:c.nextStart;if(d&&this.hls){const f=c.len<=r.maxBufferHole,g=c.len>0&&c.len<1&&n.readyState<3,y=d-l;if(y>0&&(f||g)){if(y>r.maxBufferHole){let S=!1;if(l===0){const E=s.getAppendedFrag(0,De.MAIN);E&&d<E.end&&(S=!0)}if(!S&&e){var u;if(!((u=this.hls.loadLevelObj)!=null&&u.details)||$x(this.hls.inFlightFragments,d))return 0;let T=!1,A=e.end;for(;A<d;){const I=tu(A,s);if(I)A+=I.duration;else{T=!0;break}}if(T)return 0}}const x=Math.max(d+TO,l+bO);if(this.warn(`skipping hole, adjusting currentTime from ${l} to ${x}`),this.moved=!0,n.currentTime=x,!(e!=null&&e.gap)){const S=new Error(`fragment loaded with buffer holes, seeking from ${l} to ${x}`),E={type:je.MEDIA_ERROR,details:W.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:S,reason:S.message,buffer:c.len,bufferInfo:c};e&&("fragment"in e?E.part=e:E.frag=e),this.hls.trigger(L.ERROR,E)}return x}}return 0}_tryNudgeBuffer(e){const{hls:t,media:s,nudgeRetry:n}=this,r=t?.config;if(!s||!r)return 0;const l=s.currentTime;if(this.nudgeRetry++,n<r.nudgeMaxRetry){const c=l+(n+1)*r.nudgeOffset,d=new Error(`Nudging 'currentTime' from ${l} to ${c}`);this.warn(d.message),s.currentTime=c,t.trigger(L.ERROR,{type:je.MEDIA_ERROR,details:W.BUFFER_NUDGE_ON_STALL,error:d,fatal:!1,buffer:e.len,bufferInfo:e})}else{const c=new Error(`Playhead still not moving while enough data buffered @${l} after ${r.nudgeMaxRetry} nudges`);this.error(c.message),t.trigger(L.ERROR,{type:je.MEDIA_ERROR,details:W.BUFFER_STALLED_ERROR,error:c,fatal:!0,buffer:e.len,bufferInfo:e})}}}function $x(i,e){const t=Gx(i.main);if(t&&t.start<=e)return t;const s=Gx(i.audio);return s&&s.start<=e?s:null}function Gx(i){if(!i)return null;switch(i.state){case ue.IDLE:case ue.STOPPED:case ue.ENDED:case ue.ERROR:return null}return i.frag}function tu(i,e){return e.getAppendedFrag(i,De.MAIN)||e.getPartialFragment(i)}const _O=.25;function ym(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function Vf(i,e,t,s,n){let r=new i(e,t,"");try{r.value=s,n&&(r.type=n)}catch{r=new i(e,t,Ut(n?Lt({type:n},s):s))}return r}const su=(()=>{const i=ym();try{i&&new i(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();class IO{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.assetCue=void 0,this.onEventCueEnter=()=>{this.hls&&this.hls.trigger(L.EVENT_CUE_ENTER,{})},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null}_registerListeners(){const{hls:e}=this;e&&(e.on(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(L.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(L.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(L.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(L.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(L.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(L.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}onMediaAttaching(e,t){var s;this.media=t.media,((s=t.overrides)==null?void 0:s.cueRemoval)===!1&&(this.removeCues=!1)}onMediaAttached(){var e;const t=(e=this.hls)==null?void 0:e.latestLevelDetails;t&&this.updateDateRangeCues(t)}onMediaDetaching(e,t){this.media=null,!t.transferMedia&&(this.id3Track&&(this.removeCues&&Hr(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){const s=e[t];if(s.kind==="metadata"&&s.label==="id3")return aT(s,this.media),s}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media||!this.hls)return;const{enableEmsgMetadataCues:s,enableID3MetadataCues:n}=this.hls.config;if(!s&&!n)return;const{samples:r}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const l=ym();if(l)for(let c=0;c<r.length;c++){const d=r[c].type;if(d===vi.emsg&&!s||!n)continue;const u=Ob(r[c].data),f=r[c].pts;let g=f+r[c].duration;g>su&&(g=su),g-f<=0&&(g=f+_O);for(let x=0;x<u.length;x++){const S=u[x];if(!Db(S)){this.updateId3CueEnds(f,d);const E=Vf(l,f,g,S,d);E&&this.id3Track.addCue(E)}}}}updateId3CueEnds(e,t){var s;const n=(s=this.id3Track)==null?void 0:s.cues;if(n)for(let r=n.length;r--;){const l=n[r];l.type===t&&l.startTime<e&&l.endTime===su&&(l.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:s,type:n}){const{id3Track:r,hls:l}=this;if(!l)return;const{config:{enableEmsgMetadataCues:c,enableID3MetadataCues:d}}=l;if(r&&(c||d)){let u;n==="audio"?u=f=>f.type===vi.audioId3&&d:n==="video"?u=f=>f.type===vi.emsg&&c:u=f=>f.type===vi.audioId3&&d||f.type===vi.emsg&&c,mm(r,t,s,u)}}onLevelUpdated(e,{details:t}){this.updateDateRangeCues(t,!0)}onLevelPtsUpdated(e,t){Math.abs(t.drift)>.01&&this.updateDateRangeCues(t.details)}updateDateRangeCues(e,t){if(!this.hls||!this.media)return;const{assetPlayerId:s,timelineOffset:n,enableDateRangeMetadataCues:r,interstitialsController:l}=this.hls.config;if(!r)return;const c=ym();if(s&&n&&!l){const{fragmentStart:E,fragmentEnd:T}=e;let A=this.assetCue;A?(A.startTime=E,A.endTime=T):c&&(A=this.assetCue=Vf(c,E,T,{assetPlayerId:this.hls.config.assetPlayerId},"hlsjs.interstitial.asset"),A&&(A.id=s,this.id3Track||(this.id3Track=this.createTrack(this.media)),this.id3Track.addCue(A),A.addEventListener("enter",this.onEventCueEnter)))}if(!e.hasProgramDateTime)return;const{id3Track:d}=this,{dateRanges:u}=e,f=Object.keys(u);let g=this.dateRangeCuesAppended;if(d&&t){var y;if((y=d.cues)!=null&&y.length){const E=Object.keys(g).filter(T=>!f.includes(T));for(let T=E.length;T--;){var x;const A=E[T],I=(x=g[A])==null?void 0:x.cues;delete g[A],I&&Object.keys(I).forEach(_=>{const C=I[_];if(C){C.removeEventListener("enter",this.onEventCueEnter);try{d.removeCue(C)}catch{}}})}}else g=this.dateRangeCuesAppended={}}const S=e.fragments[e.fragments.length-1];if(!(f.length===0||!ke(S?.programDateTime))){this.id3Track||(this.id3Track=this.createTrack(this.media));for(let E=0;E<f.length;E++){const T=f[E],A=u[T],I=A.startTime,_=g[T],C=_?.cues||{};let k=_?.durationKnown||!1,D=su;const{duration:O,endDate:F}=A;if(F&&O!==null)D=I+O,k=!0;else if(A.endOnNext&&!k){const U=f.reduce((K,H)=>{if(H!==A.id){const ee=u[H];if(ee.class===A.class&&ee.startDate>A.startDate&&(!K||A.startDate<K.startDate))return ee}return K},null);U&&(D=U.startTime,k=!0)}const j=Object.keys(A.attr);for(let U=0;U<j.length;U++){const K=j[U];if(!Yw(K))continue;const H=C[K];if(H)k&&!(_!=null&&_.durationKnown)?H.endTime=D:Math.abs(H.startTime-I)>.01&&(H.startTime=I,H.endTime=D);else if(c){let ee=A.attr[K];qw(K)&&(ee=HS(ee));const de=Vf(c,I,D,{key:K,data:ee},vi.dateRange);de&&(de.id=T,this.id3Track.addCue(de),C[K]=de,l&&(K==="X-ASSET-LIST"||K==="X-ASSET-URL")&&de.addEventListener("enter",this.onEventCueEnter))}}g[T]={cues:C,dateRange:A,durationKnown:k}}}}}class RO{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=()=>{const{media:t}=this,s=this.levelDetails;if(!t||!s)return;this.currentTime=t.currentTime;const n=this.computeLatency();if(n===null)return;this._latency=n;const{lowLatencyMode:r,maxLiveSyncPlaybackRate:l}=this.config;if(!r||l===1||!s.live)return;const c=this.targetLatency;if(c===null)return;const d=n-c,u=Math.min(this.maxLatency,c+s.targetduration);if(d<u&&d>.05&&this.forwardBufferLength>1){const g=Math.min(2,Math.max(1,l)),y=Math.round(2/(1+Math.exp(-.75*d-this.edgeStalled))*20)/20,x=Math.min(g,Math.max(1,y));this.changeMediaPlaybackRate(t,x)}else t.playbackRate!==1&&t.playbackRate!==0&&this.changeMediaPlaybackRate(t,1)},this.hls=e,this.config=e.config,this.registerListeners()}get levelDetails(){var e;return((e=this.hls)==null?void 0:e.latestLevelDetails)||null}get latency(){return this._latency||0}get maxLatency(){const{config:e}=this;if(e.liveMaxLatencyDuration!==void 0)return e.liveMaxLatencyDuration;const t=this.levelDetails;return t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){const e=this.levelDetails;if(e===null||this.hls===null)return null;const{holdBack:t,partHoldBack:s,targetduration:n}=e,{liveSyncDuration:r,liveSyncDurationCount:l,lowLatencyMode:c}=this.config,d=this.hls.userConfig;let u=c&&s||t;(this._targetLatencyUpdated||d.liveSyncDuration||d.liveSyncDurationCount||u===0)&&(u=r!==void 0?r:l*n);const f=n;return u+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,f)}set targetLatency(e){this.stallCount=0,this.config.liveSyncDuration=e,this._targetLatencyUpdated=!0}get liveSyncPosition(){const e=this.estimateLiveEdge(),t=this.targetLatency;if(e===null||t===null)return null;const s=this.levelDetails;if(s===null)return null;const n=s.edge,r=e-t-this.edgeStalled,l=n-s.totalduration,c=n-(this.config.lowLatencyMode&&s.partTarget||s.targetduration);return Math.min(Math.max(l,r),c)}get drift(){const e=this.levelDetails;return e===null?1:e.drift}get edgeStalled(){const e=this.levelDetails;if(e===null)return 0;const t=(this.config.lowLatencyMode&&e.partTarget||e.targetduration)*3;return Math.max(e.age-t,0)}get forwardBufferLength(){const{media:e}=this,t=this.levelDetails;if(!e||!t)return 0;const s=e.buffered.length;return(s?e.buffered.end(s-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null}registerListeners(){const{hls:e}=this;e&&(e.on(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(L.ERROR,this.onError,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(L.ERROR,this.onError,this))}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.onTimeupdate)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)}onManifestLoading(){this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){t.advanced&&this.onTimeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)}onError(e,t){var s;t.details===W.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&(s=this.levelDetails)!=null&&s.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))}changeMediaPlaybackRate(e,t){var s,n;e.playbackRate!==t&&((s=this.hls)==null||s.logger.debug(`[latency-controller]: latency=${this.latency.toFixed(3)}, targetLatency=${(n=this.targetLatency)==null?void 0:n.toFixed(3)}, forwardBufferLength=${this.forwardBufferLength.toFixed(3)}: adjusting playback rate from ${e.playbackRate} to ${t}`),e.playbackRate=t)}estimateLiveEdge(){const e=this.levelDetails;return e===null?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return e===null?null:e-this.currentTime}}class LO extends ep{constructor(e,t){super(e,"level-controller"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(L.LEVEL_LOADED,this.onLevelLoaded,this),e.on(L.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(L.FRAG_BUFFERED,this.onFragBuffered,this),e.on(L.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(L.LEVEL_LOADED,this.onLevelLoaded,this),e.off(L.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(L.FRAG_BUFFERED,this.onFragBuffered,this),e.off(L.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(t=>{t.loadError=0,t.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){const s=this.hls.config.preferManagedMediaSource,n=[],r={},l={};let c=!1,d=!1,u=!1;t.levels.forEach(f=>{const g=f.attrs;let{audioCodec:y,videoCodec:x}=f;y&&(f.audioCodec=y=_u(y,s)||void 0),x&&(x=f.videoCodec=uw(x));const{width:S,height:E,unknownCodecs:T}=f,A=T?.length||0;if(c||(c=!!(S&&E)),d||(d=!!x),u||(u=!!y),A||y&&!this.isAudioSupported(y)||x&&!this.isVideoSupported(x)){this.log(`Some or all CODECS not supported "${g.CODECS}"`);return}const{CODECS:I,"FRAME-RATE":_,"HDCP-LEVEL":C,"PATHWAY-ID":k,RESOLUTION:D,"VIDEO-RANGE":O}=g,j=`${`${k||"."}-`}${f.bitrate}-${D}-${_}-${I}-${O}-${C}`;if(r[j])if(r[j].uri!==f.url&&!f.attrs["PATHWAY-ID"]){const U=l[j]+=1;f.attrs["PATHWAY-ID"]=new Array(U+1).join(".");const K=this.createLevel(f);r[j]=K,n.push(K)}else r[j].addGroupId("audio",g.AUDIO),r[j].addGroupId("text",g.SUBTITLES);else{const U=this.createLevel(f);r[j]=U,l[j]=1,n.push(U)}}),this.filterAndSortMediaOptions(n,t,c,d,u)}createLevel(e){const t=new co(e),s=e.supplemental;if(s!=null&&s.videoCodec&&!this.isVideoSupported(s.videoCodec)){const n=new Error(`SUPPLEMENTAL-CODECS not supported "${s.videoCodec}"`);this.log(n.message),t.supportedResult=sb(n,[])}return t}isAudioSupported(e){return lo(e,"audio",this.hls.config.preferManagedMediaSource)}isVideoSupported(e){return lo(e,"video",this.hls.config.preferManagedMediaSource)}filterAndSortMediaOptions(e,t,s,n,r){var l;let c=[],d=[],u=e;const f=((l=t.stats)==null?void 0:l.parsing)||{};if((s||n)&&r&&(u=u.filter(({videoCodec:I,videoRange:_,width:C,height:k})=>(!!I||!!(C&&k))&&Sw(_))),u.length===0){Promise.resolve().then(()=>{if(this.hls){let I="no level with compatible codecs found in manifest",_=I;t.levels.length&&(_=`one or more CODECS in variant not supported: ${Ut(t.levels.map(k=>k.attrs.CODECS).filter((k,D,O)=>O.indexOf(k)===D))}`,this.warn(_),I+=` (${_})`);const C=new Error(I);this.hls.trigger(L.ERROR,{type:je.MEDIA_ERROR,details:W.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:C,reason:_})}}),f.end=performance.now();return}t.audioTracks&&(c=t.audioTracks.filter(I=>!I.audioCodec||this.isAudioSupported(I.audioCodec)),Hx(c)),t.subtitles&&(d=t.subtitles,Hx(d));const g=u.slice(0);u.sort((I,_)=>{if(I.attrs["HDCP-LEVEL"]!==_.attrs["HDCP-LEVEL"])return(I.attrs["HDCP-LEVEL"]||"")>(_.attrs["HDCP-LEVEL"]||"")?1:-1;if(s&&I.height!==_.height)return I.height-_.height;if(I.frameRate!==_.frameRate)return I.frameRate-_.frameRate;if(I.videoRange!==_.videoRange)return Iu.indexOf(I.videoRange)-Iu.indexOf(_.videoRange);if(I.videoCodec!==_.videoCodec){const C=Pv(I.videoCodec),k=Pv(_.videoCodec);if(C!==k)return k-C}if(I.uri===_.uri&&I.codecSet!==_.codecSet){const C=Au(I.codecSet),k=Au(_.codecSet);if(C!==k)return k-C}return I.averageBitrate!==_.averageBitrate?I.averageBitrate-_.averageBitrate:0});let y=g[0];if(this.steering&&(u=this.steering.filterParsedLevels(u),u.length!==g.length)){for(let I=0;I<g.length;I++)if(g[I].pathwayId===u[0].pathwayId){y=g[I];break}}this._levels=u;for(let I=0;I<u.length;I++)if(u[I]===y){var x;this._firstLevel=I;const _=y.bitrate,C=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${u.length} level(s) found, first bitrate: ${_}`),((x=this.hls.userConfig)==null?void 0:x.abrEwmaDefaultEstimate)===void 0){const k=Math.min(_,this.hls.config.abrEwmaDefaultEstimateMax);k>C&&C===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=k)}break}const S=r&&!n,E=this.hls.config,T=!!(E.audioStreamController&&E.audioTrackController),A={levels:u,audioTracks:c,subtitleTracks:d,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:r,video:n,altAudio:T&&!S&&c.some(I=>!!I.url)};f.end=performance.now(),this.hls.trigger(L.MANIFEST_PARSED,A)}get levels(){return this._levels.length===0?null:this._levels}get loadLevelObj(){return this.currentLevel}get level(){return this.currentLevelIndex}set level(e){const t=this._levels;if(t.length===0)return;if(e<0||e>=t.length){const f=new Error("invalid level idx"),g=e<0;if(this.hls.trigger(L.ERROR,{type:je.OTHER_ERROR,details:W.LEVEL_SWITCH_ERROR,level:e,fatal:g,error:f,reason:f.message}),g)return;e=Math.min(e,t.length-1)}const s=this.currentLevelIndex,n=this.currentLevel,r=n?n.attrs["PATHWAY-ID"]:void 0,l=t[e],c=l.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=l,s===e&&n&&r===c)return;this.log(`Switching to level ${e} (${l.height?l.height+"p ":""}${l.videoRange?l.videoRange+" ":""}${l.codecSet?l.codecSet+" ":""}@${l.bitrate})${c?" with Pathway "+c:""} from level ${s}${r?" with Pathway "+r:""}`);const d={level:e,attrs:l.attrs,details:l.details,bitrate:l.bitrate,averageBitrate:l.averageBitrate,maxBitrate:l.maxBitrate,realBitrate:l.realBitrate,width:l.width,height:l.height,codecSet:l.codecSet,audioCodec:l.audioCodec,videoCodec:l.videoCodec,audioGroups:l.audioGroups,subtitleGroups:l.subtitleGroups,loaded:l.loaded,loadError:l.loadError,fragmentError:l.fragmentError,name:l.name,id:l.id,uri:l.uri,url:l.url,urlId:0,audioGroupIds:l.audioGroupIds,textGroupIds:l.textGroupIds};this.hls.trigger(L.LEVEL_SWITCHING,d);const u=l.details;if(!u||u.live){const f=this.switchParams(l.uri,n?.details,u);this.loadPlaylist(f)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,this._startLevel===void 0&&(this._startLevel=e),e!==-1&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(this._startLevel===void 0){const e=this.hls.config.startLevel;return e!==void 0?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}get pathways(){return this.steering?this.steering.pathways():[]}get pathwayPriority(){return this.steering?this.steering.pathwayPriority:null}set pathwayPriority(e){if(this.steering){const t=this.steering.pathways(),s=e.filter(n=>t.indexOf(n)!==-1);if(e.length<1){this.warn(`pathwayPriority ${e} should contain at least one pathway from list: ${t}`);return}this.steering.pathwayPriority=s}}onError(e,t){t.fatal||!t.context||t.context.type===at.LEVEL&&t.context.level===this.level&&this.checkRetry(t)}onFragBuffered(e,{frag:t}){if(t!==void 0&&t.type===De.MAIN){const s=t.elementaryStreams;if(!Object.keys(s).some(r=>!!s[r]))return;const n=this._levels[t.level];n!=null&&n.loadError&&(this.log(`Resetting level error count of ${n.loadError} on frag buffered`),n.loadError=0)}}onLevelLoaded(e,t){var s;const{level:n,details:r}=t,l=t.levelInfo;if(!l){var c;this.warn(`Invalid level index ${n}`),(c=t.deliveryDirectives)!=null&&c.skip&&(r.deltaUpdateFailed=!0);return}if(l===this.currentLevel||t.withoutMultiVariant){l.fragmentError===0&&(l.loadError=0);let d=l.details;d===t.details&&d.advanced&&(d=void 0),this.playlistLoaded(n,t,d)}else(s=t.deliveryDirectives)!=null&&s.skip&&(r.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const s=this.getUrlWithDirectives(e.uri,t),n=this.currentLevelIndex,r=e.attrs["PATHWAY-ID"],l=e.details,c=l?.age;this.log(`Loading level index ${n}${t?.msn!==void 0?" at sn "+t.msn+" part "+t.part:""}${r?" Pathway "+r:""}${c&&l.live?" age "+c.toFixed(1)+(l.type&&" "+l.type||""):""} ${s}`),this.hls.trigger(L.LEVEL_LOADING,{url:s,level:n,levelInfo:e,pathwayId:e.attrs["PATHWAY-ID"],id:0,deliveryDirectives:t||null})}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=e)}removeLevel(e){var t;if(this._levels.length===1)return;const s=this._levels.filter((r,l)=>l!==e?!0:(this.steering&&this.steering.removeLevel(r),r===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,r.details&&r.details.fragments.forEach(c=>c.level=-1)),!1));Eb(s),this._levels=s,this.currentLevelIndex>-1&&(t=this.currentLevel)!=null&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);const n=s.length-1;this._firstLevel=Math.min(this._firstLevel,n),this._startLevel&&(this._startLevel=Math.min(this._startLevel,n)),this.hls.trigger(L.LEVELS_UPDATED,{levels:s})}onLevelsUpdated(e,{levels:t}){this._levels=t}checkMaxAutoUpdated(){const{autoLevelCapping:e,maxAutoLevel:t,maxHdcpLevel:s}=this.hls;this._maxAutoLevel!==t&&(this._maxAutoLevel=t,this.hls.trigger(L.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:t,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:s}))}}function Hx(i){const e={};i.forEach(t=>{const s=t.groupId||"";t.id=e[s]=e[s]||0,e[s]++})}function vT(){return self.SourceBuffer||self.WebKitSourceBuffer}function xT(){if(!Ia())return!1;const e=vT();return!e||e.prototype&&typeof e.prototype.appendBuffer=="function"&&typeof e.prototype.remove=="function"}function wO(){if(!xT())return!1;const i=Ia();return typeof i?.isTypeSupported=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(e=>i.isTypeSupported(oo(e,"video")))||["mp4a.40.2","fLaC"].some(e=>i.isTypeSupported(oo(e,"audio"))))}function CO(){var i;const e=vT();return typeof(e==null||(i=e.prototype)==null?void 0:i.changeType)=="function"}const kO=100;class NO extends Km{constructor(e,t,s){super(e,t,s,"stream-controller",De.MAIN),this.audioCodecSwap=!1,this.level=-1,this._forceStartLoad=!1,this._hasEnoughToStart=!1,this.altAudio=0,this.audioOnly=!1,this.fragPlaying=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this.onMediaPlaying=()=>{this.tick()},this.onMediaSeeked=()=>{const n=this.media,r=n?n.currentTime:null;if(r===null||!ke(r)||(this.log(`Media seeked to ${r.toFixed(3)}`),!this.getBufferedFrag(r)))return;const l=this.getFwdBufferInfoAtPos(n,r,De.MAIN,0);if(l===null||l.len===0){this.warn(`Main forward buffer length at ${r} on "seeked" event ${l?l.len:"empty"})`);return}this.tick()},this.registerListeners()}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(L.MANIFEST_PARSED,this.onManifestParsed,this),e.on(L.LEVEL_LOADING,this.onLevelLoading,this),e.on(L.LEVEL_LOADED,this.onLevelLoaded,this),e.on(L.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(L.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(L.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(L.BUFFER_CREATED,this.onBufferCreated,this),e.on(L.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(L.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(L.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(L.MANIFEST_PARSED,this.onManifestParsed,this),e.off(L.LEVEL_LOADED,this.onLevelLoaded,this),e.off(L.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(L.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(L.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(L.BUFFER_CREATED,this.onBufferCreated,this),e.off(L.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(L.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(L.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),super.onHandlerDestroying()}startLoad(e,t){if(this.levels){const{lastCurrentTime:s,hls:n}=this;if(this.stopLoad(),this.setInterval(kO),this.level=-1,!this.startFragRequested){let r=n.startLevel;r===-1&&(n.config.testBandwidth&&this.levels.length>1?(r=0,this.bitrateTest=!0):r=n.firstAutoLevel),n.nextLoadLevel=r,this.level=n.loadLevel,this._hasEnoughToStart=!!t}s>0&&e===-1&&!t&&(this.log(`Override startPosition with lastCurrentTime @${s.toFixed(3)}`),e=s),this.state=ue.IDLE,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}else this._forceStartLoad=!0,this.state=ue.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case ue.WAITING_LEVEL:{const{levels:e,level:t}=this,s=e?.[t],n=s?.details;if(n&&(!n.live||this.levelLastLoaded===s&&!this.waitForLive(s))){if(this.waitForCdnTuneIn(n))break;this.state=ue.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=ue.IDLE;break}break}case ue.FRAG_LOADING_WAITING_RETRY:this.checkRetryDate();break}this.state===ue.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){var e;super.onTickEnd(),(e=this.media)!=null&&e.readyState&&this.media.seeking===!1&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:t,levels:s,media:n}=this;if(t===null||!n&&!this.primaryPrefetch&&(this.startFragRequested||!e.config.startFragPrefetch)||this.altAudio&&this.audioOnly)return;const r=this.buffering?e.nextLoadLevel:e.loadLevel;if(!(s!=null&&s[r]))return;const l=s[r],c=this.getMainFwdBufferInfo();if(c===null)return;const d=this.getLevelDetails();if(d&&this._streamEnded(c,d)){const E={};this.altAudio===2&&(E.type="video"),this.hls.trigger(L.BUFFER_EOS,E),this.state=ue.ENDED;return}if(!this.buffering)return;e.loadLevel!==r&&e.manualLevel===-1&&this.log(`Adapting to level ${r} from level ${this.level}`),this.level=e.nextLoadLevel=r;const u=l.details;if(!u||this.state===ue.WAITING_LEVEL||this.waitForLive(l)){this.level=r,this.state=ue.WAITING_LEVEL,this.startFragRequested=!1;return}const f=c.len,g=this.getMaxBufferLength(l.maxBitrate);if(f>=g)return;this.backtrackFragment&&this.backtrackFragment.start>c.end&&(this.backtrackFragment=null);const y=this.backtrackFragment?this.backtrackFragment.start:c.end;let x=this.getNextFragment(y,u);if(this.couldBacktrack&&!this.fragPrevious&&x&&rs(x)&&this.fragmentTracker.getState(x)!==vs.OK){var S;const T=((S=this.backtrackFragment)!=null?S:x).sn-u.startSN,A=u.fragments[T-1];A&&x.cc===A.cc&&(x=A,this.fragmentTracker.removeFragment(A))}else this.backtrackFragment&&c.len&&(this.backtrackFragment=null);if(x&&this.isLoopLoading(x,y)){if(!x.gap){const T=this.audioOnly&&!this.altAudio?Pt.AUDIO:Pt.VIDEO,A=(T===Pt.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;A&&this.afterBufferFlushed(A,T,De.MAIN)}x=this.getNextFragmentLoopLoading(x,u,c,De.MAIN,g)}x&&(x.initSegment&&!x.initSegment.data&&!this.bitrateTest&&(x=x.initSegment),this.loadFragment(x,l,y))}loadFragment(e,t,s){const n=this.fragmentTracker.getState(e);n===vs.NOT_LOADED||n===vs.PARTIAL?rs(e)?this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):super.loadFragment(e,t,s):this._loadInitSegment(e,t):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,De.MAIN)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:t}=this;if(t!=null&&t.readyState){let s;const n=this.getAppendedFrag(t.currentTime);n&&n.start>1&&this.flushMainBuffer(0,n.start-1);const r=this.getLevelDetails();if(r!=null&&r.live){const c=this.getMainFwdBufferInfo();if(!c||c.len<r.targetduration*2)return}if(!t.paused&&e){const c=this.hls.nextLoadLevel,d=e[c],u=this.fragLastKbps;u&&this.fragCurrent?s=this.fragCurrent.duration*d.maxBitrate/(1e3*u)+1:s=0}else s=0;const l=this.getBufferedFrag(t.currentTime+s);if(l){const c=this.followingBufferedFrag(l);if(c){this.abortCurrentFrag();const d=c.maxStartPTS?c.maxStartPTS:c.start,u=c.duration,f=Math.max(l.end,d+Math.min(Math.max(u-this.config.maxFragLookUpTolerance,u*(this.couldBacktrack?.5:.125)),u*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(f,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case ue.KEY_LOADING:case ue.FRAG_LOADING:case ue.FRAG_LOADING_WAITING_RETRY:case ue.PARSING:case ue.PARSED:this.state=ue.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,this.altAudio===2?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);const s=t.media;Bs(s,"playing",this.onMediaPlaying),Bs(s,"seeked",this.onMediaSeeked)}onMediaDetaching(e,t){const{media:s}=this;s&&(ei(s,"playing",this.onMediaPlaying),ei(s,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,super.onMediaDetaching(e,t),!t.transferMedia&&(this._hasEnoughToStart=!1)}onManifestLoading(){super.onManifestLoading(),this.log("Trigger BUFFER_RESET"),this.hls.trigger(L.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1}onManifestParsed(e,t){let s=!1,n=!1;for(let r=0;r<t.levels.length;r++){const l=t.levels[r].audioCodec;l&&(s=s||l.indexOf("mp4a.40.2")!==-1,n=n||l.indexOf("mp4a.40.5")!==-1)}this.audioCodecSwitch=s&&n&&!CO(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){const{levels:s}=this;if(!s||this.state!==ue.IDLE)return;const n=t.levelInfo;(!n.details||n.details.live&&(this.levelLastLoaded!==n||n.details.expired)||this.waitForCdnTuneIn(n.details))&&(this.state=ue.WAITING_LEVEL)}onLevelLoaded(e,t){var s;const{levels:n,startFragRequested:r}=this,l=t.level,c=t.details,d=c.totalduration;if(!n){this.warn(`Levels were reset while loading level ${l}`);return}this.log(`Level ${l} loaded [${c.startSN},${c.endSN}]${c.lastPartSn?`[part-${c.lastPartSn}-${c.lastPartIndex}]`:""}, cc [${c.startCC}, ${c.endCC}] duration:${d}`);const u=t.levelInfo,f=this.fragCurrent;f&&(this.state===ue.FRAG_LOADING||this.state===ue.FRAG_LOADING_WAITING_RETRY)&&f.level!==t.level&&f.loader&&this.abortCurrentFrag();let g=0;if(c.live||(s=u.details)!=null&&s.live){var y;if(this.checkLiveUpdate(c),c.deltaUpdateFailed)return;g=this.alignPlaylists(c,u.details,(y=this.levelLastLoaded)==null?void 0:y.details)}if(u.details=c,this.levelLastLoaded=u,r||this.setStartPosition(c,g),this.hls.trigger(L.LEVEL_UPDATED,{details:c,level:l}),this.state===ue.WAITING_LEVEL){if(this.waitForCdnTuneIn(c))return;this.state=ue.IDLE}r&&c.live&&this.synchronizeToLiveEdge(c),this.tick()}synchronizeToLiveEdge(e){const{config:t,media:s}=this;if(!s)return;const n=this.hls.liveSyncPosition,r=this.getLoadPosition(),l=e.fragmentStart,c=e.edge,d=r>=l-t.maxFragLookUpTolerance&&r<=c;if(n!==null&&s.duration>n&&(r<n||!d)){const f=t.liveMaxLatencyDuration!==void 0?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;if((!d&&s.readyState<4||r<c-f)&&(this._hasEnoughToStart||(this.nextLoadPosition=n),s.readyState))if(this.warn(`Playback: ${r.toFixed(3)} is located too far from the end of live sliding playlist: ${c}, reset currentTime to : ${n.toFixed(3)}`),this.config.liveSyncMode==="buffered"){var u;const g=Xe.bufferInfo(s,n,0);if(!((u=g.buffered)!=null&&u.length)){s.currentTime=n;return}if(g.start<=r){s.currentTime=n;return}const{nextStart:x}=Xe.bufferedInfo(g.buffered,r,0);x&&(s.currentTime=x)}else s.currentTime=n}}_handleFragmentLoadProgress(e){var t;const s=e.frag,{part:n,payload:r}=e,{levels:l}=this;if(!l){this.warn(`Levels were reset while fragment load was in progress. Fragment ${s.sn} of level ${s.level} will not be buffered`);return}const c=l[s.level];if(!c){this.warn(`Level ${s.level} not found on progress`);return}const d=c.details;if(!d){this.warn(`Dropping fragment ${s.sn} of level ${s.level} after level details were reset`),this.fragmentTracker.removeFragment(s);return}const u=c.videoCodec,f=d.PTSKnown||!d.live,g=(t=s.initSegment)==null?void 0:t.data,y=this._getAudioCodec(c),x=this.transmuxer=this.transmuxer||new zb(this.hls,De.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),S=n?n.index:-1,E=S!==-1,T=new Gm(s.level,s.sn,s.stats.chunkCount,r.byteLength,S,E),A=this.initPTS[s.cc];x.push(r,g,y,u,s,n,d.totalduration,f,T,A)}onAudioTrackSwitching(e,t){const s=this.hls,n=this.altAudio!==0;if(Ru(t.url,s))this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const l=this.fragCurrent;l&&(this.log("Switching to main audio track, cancel main fragment load"),l.abortRequests(),this.fragmentTracker.removeFragment(l)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(n){this.altAudio=0,this.fragmentTracker.removeAllFragments(),s.once(L.BUFFER_FLUSHED,()=>{this.hls&&this.hls.trigger(L.AUDIO_TRACK_SWITCHED,t)}),s.trigger(L.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});return}s.trigger(L.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){const s=Ru(t.url,this.hls);if(s){const n=this.videoBuffer;n&&this.mediaBuffer!==n&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=n)}this.altAudio=s?2:0,this.tick()}onBufferCreated(e,t){const s=t.tracks;let n,r,l=!1;for(const c in s){const d=s[c];if(d.id==="main"){if(r=c,n=d,c==="video"){const u=s[c];u&&(this.videoBuffer=u.buffer)}}else l=!0}l&&n?(this.log(`Alternate track found, use ${r}.buffered to schedule main fragment loading`),this.mediaBuffer=n.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){const{frag:s,part:n}=t,r=s.type===De.MAIN;if(r){if(this.fragContextChanged(s)){this.warn(`Fragment ${s.sn}${n?" p: "+n.index:""} of level ${s.level} finished buffering, but was aborted. state: ${this.state}`),this.state===ue.PARSED&&(this.state=ue.IDLE);return}const c=n?n.stats:s.stats;this.fragLastKbps=Math.round(8*c.total/(c.buffering.end-c.loading.first)),rs(s)&&(this.fragPrevious=s),this.fragBufferedComplete(s,n)}const l=this.media;l&&(!this._hasEnoughToStart&&Xe.getBuffered(l).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),r&&this.tick())}get hasEnoughToStart(){return this._hasEnoughToStart}onError(e,t){var s;if(t.fatal){this.state=ue.ERROR;return}switch(t.details){case W.FRAG_GAP:case W.FRAG_PARSING_ERROR:case W.FRAG_DECRYPT_ERROR:case W.FRAG_LOAD_ERROR:case W.FRAG_LOAD_TIMEOUT:case W.KEY_LOAD_ERROR:case W.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(De.MAIN,t);break;case W.LEVEL_LOAD_ERROR:case W.LEVEL_LOAD_TIMEOUT:case W.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===ue.WAITING_LEVEL&&((s=t.context)==null?void 0:s.type)===at.LEVEL&&(this.state=ue.IDLE);break;case W.BUFFER_ADD_CODEC_ERROR:case W.BUFFER_APPEND_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&this.resetLoadingState();break;case W.BUFFER_FULL_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&(!this.config.interstitialsController&&this.config.assetPlayerId?this._hasEnoughToStart=!0:this.flushMainBuffer(0,Number.POSITIVE_INFINITY));break;case W.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onFragLoadEmergencyAborted(){this.state=ue.IDLE,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()}onBufferFlushed(e,{type:t}){if(t!==Pt.AUDIO||!this.altAudio){const s=(t===Pt.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;s&&(this.afterBufferFlushed(s,t,De.MAIN),this.tick())}}onLevelsUpdated(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,this.level===-1&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const t=e.currentTime;let s=this.startPosition;if(s>=0&&t<s){if(e.seeking){this.log(`could not seek to ${s}, already seeking at ${t}`);return}const n=this.timelineOffset;n&&s&&(s+=n);const r=this.getLevelDetails(),l=Xe.getBuffered(e),c=l.length?l.start(0):0,d=c-s,u=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);(this.config.startOnSegmentBoundary||d>0&&(d<u||this.loadingParts&&d<2*(r?.partTarget||0)))&&(this.log(`adjusting start position by ${d} to match buffer start`),s+=d,this.startPosition=s),t<s&&(this.log(`seek to target start position ${s} from current time ${t} buffer start ${c}`),e.currentTime=s)}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t.indexOf("mp4a.40.5")!==-1?t="mp4a.40.2":t="mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then(s=>{const{hls:n}=this,r=s?.frag;if(!r||this.fragContextChanged(r))return;t.fragmentError=0,this.state=ue.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const l=r.stats;l.parsing.start=l.parsing.end=l.buffering.start=l.buffering.end=self.performance.now(),n.trigger(L.FRAG_LOADED,s),r.bitrateTest=!1}).catch(s=>{this.state===ue.STOPPED||this.state===ue.ERROR||(this.warn(s),this.resetFragmentLoading(e))})}_handleTransmuxComplete(e){const t=this.playlistType,{hls:s}=this,{remuxResult:n,chunkMeta:r}=e,l=this.getCurrentContext(r);if(!l){this.resetWhenMissingContext(r);return}const{frag:c,part:d,level:u}=l,{video:f,text:g,id3:y,initSegment:x}=n,{details:S}=u,E=this.altAudio?void 0:n.audio;if(this.fragContextChanged(c)){this.fragmentTracker.removeFragment(c);return}if(this.state=ue.PARSING,x){const T=x.tracks;if(T){const C=c.initSegment||c;if(this.unhandledEncryptionError(x,c))return;this._bufferInitSegment(u,T,C,r),s.trigger(L.FRAG_PARSING_INIT_SEGMENT,{frag:C,id:t,tracks:T})}const A=x.initPTS,I=x.timescale,_=this.initPTS[c.cc];if(ke(A)&&(!_||_.baseTime!==A||_.timescale!==I)){const C=x.trackId;this.initPTS[c.cc]={baseTime:A,timescale:I,trackId:C},s.trigger(L.INIT_PTS_FOUND,{frag:c,id:t,initPTS:A,timescale:I,trackId:C})}}if(f&&S){E&&f.type==="audiovideo"&&this.logMuxedErr(c);const T=S.fragments[c.sn-1-S.startSN],A=c.sn===S.startSN,I=!T||c.cc>T.cc;if(n.independent!==!1){const{startPTS:_,endPTS:C,startDTS:k,endDTS:D}=f;if(d)d.elementaryStreams[f.type]={startPTS:_,endPTS:C,startDTS:k,endDTS:D};else if(f.firstKeyFrame&&f.independent&&r.id===1&&!I&&(this.couldBacktrack=!0),f.dropped&&f.independent){const O=this.getMainFwdBufferInfo(),F=(O?O.end:this.getLoadPosition())+this.config.maxBufferHole,j=f.firstKeyFramePTS?f.firstKeyFramePTS:_;if(!A&&F<j-this.config.maxBufferHole&&!I){this.backtrack(c);return}else I&&(c.gap=!0);c.setElementaryStreamInfo(f.type,c.start,C,c.start,D,!0)}else A&&_-(S.appliedTimelineOffset||0)>gu&&(c.gap=!0);c.setElementaryStreamInfo(f.type,_,C,k,D),this.backtrackFragment&&(this.backtrackFragment=c),this.bufferFragmentData(f,c,d,r,A||I)}else if(A||I)c.gap=!0;else{this.backtrack(c);return}}if(E){const{startPTS:T,endPTS:A,startDTS:I,endDTS:_}=E;d&&(d.elementaryStreams[Pt.AUDIO]={startPTS:T,endPTS:A,startDTS:I,endDTS:_}),c.setElementaryStreamInfo(Pt.AUDIO,T,A,I,_),this.bufferFragmentData(E,c,d,r)}if(S&&y!=null&&y.samples.length){const T={id:t,frag:c,details:S,samples:y.samples};s.trigger(L.FRAG_PARSING_METADATA,T)}if(S&&g){const T={id:t,frag:c,details:S,samples:g.samples};s.trigger(L.FRAG_PARSING_USERDATA,T)}}logMuxedErr(e){this.warn(`${rs(e)?"Media":"Init"} segment with muxed audiovideo where only video expected: ${e.url}`)}_bufferInitSegment(e,t,s,n){if(this.state!==ue.PARSING)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&(delete t.audio,t.audiovideo&&this.logMuxedErr(s));const{audio:r,video:l,audiovideo:c}=t;if(r){const u=e.audioCodec;let f=cu(r.codec,u);f==="mp4a"&&(f="mp4a.40.5");const g=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){f&&(f.indexOf("mp4a.40.5")!==-1?f="mp4a.40.2":f="mp4a.40.5");const y=r.metadata;y&&"channelCount"in y&&(y.channelCount||1)!==1&&g.indexOf("firefox")===-1&&(f="mp4a.40.5")}f&&f.indexOf("mp4a.40.5")!==-1&&g.indexOf("android")!==-1&&r.container!=="audio/mpeg"&&(f="mp4a.40.2",this.log(`Android: force audio codec to ${f}`)),u&&u!==f&&this.log(`Swapping manifest audio codec "${u}" for "${f}"`),r.levelCodec=f,r.id=De.MAIN,this.log(`Init audio buffer, container:${r.container}, codecs[selected/level/parsed]=[${f||""}/${u||""}/${r.codec}]`),delete t.audiovideo}if(l){l.levelCodec=e.videoCodec,l.id=De.MAIN;const u=l.codec;if(u?.length===4)switch(u){case"hvc1":case"hev1":l.codec="hvc1.1.6.L120.90";break;case"av01":l.codec="av01.0.04M.08";break;case"avc1":l.codec="avc1.42e01e";break}this.log(`Init video buffer, container:${l.container}, codecs[level/parsed]=[${e.videoCodec||""}/${u}]${l.codec!==u?" parsed-corrected="+l.codec:""}${l.supplemental?" supplemental="+l.supplemental:""}`),delete t.audiovideo}c&&(this.log(`Init audiovideo buffer, container:${c.container}, codecs[level/parsed]=[${e.codecs}/${c.codec}]`),delete t.video,delete t.audio);const d=Object.keys(t);if(d.length){if(this.hls.trigger(L.BUFFER_CODECS,t),!this.hls)return;d.forEach(u=>{const g=t[u].initSegment;g!=null&&g.byteLength&&this.hls.trigger(L.BUFFER_APPENDING,{type:u,data:g,frag:s,part:null,chunkMeta:n,parent:s.type})})}this.tickImmediate()}getMainFwdBufferInfo(){const e=this.mediaBuffer&&this.altAudio===2?this.mediaBuffer:this.media;return this.getFwdBufferInfo(e,De.MAIN)}get maxBufferLength(){const{levels:e,level:t}=this,s=e?.[t];return s?this.getMaxBufferLength(s.maxBitrate):this.config.maxBufferLength}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=ue.IDLE}checkFragmentChanged(){const e=this.media;let t=null;if(e&&e.readyState>1&&e.seeking===!1){const s=e.currentTime;if(Xe.isBuffered(e,s)?t=this.getAppendedFrag(s):Xe.isBuffered(e,s+.1)&&(t=this.getAppendedFrag(s+.1)),t){this.backtrackFragment=null;const n=this.fragPlaying,r=t.level;(!n||t.sn!==n.sn||n.level!==r)&&(this.fragPlaying=t,this.hls.trigger(L.FRAG_CHANGED,{frag:t}),(!n||n.level!==r)&&this.hls.trigger(L.LEVEL_SWITCHED,{level:r}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){var e;if(this.fragPlaying)return this.fragPlaying;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;return ke(t)?this.getAppendedFrag(t):null}get currentProgramDateTime(){var e;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;if(ke(t)){const s=this.getLevelDetails(),n=this.currentFrag||(s?Ja(null,s.fragments,t):null);if(n){const r=n.programDateTime;if(r!==null){const l=r+(t-n.start)*1e3;return new Date(l)}}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class OO extends Vi{constructor(e,t){super("key-loader",t),this.config=void 0,this.keyIdToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const s in this.keyIdToKeyInfo){const n=this.keyIdToKeyInfo[s].loader;if(n){var t;if(e&&e!==((t=n.context)==null?void 0:t.frag.type))return;n.abort()}}}detach(){for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyIdToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e].loader;t&&t.destroy()}this.keyIdToKeyInfo={}}createKeyLoadError(e,t=W.KEY_LOAD_ERROR,s,n,r){return new Vn({type:je.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:r,error:s,networkDetails:n})}loadClear(e,t,s){if(this.emeController&&this.config.emeEnabled&&!this.emeController.getSelectedKeySystemFormats().length){if(t.length)for(let n=0,r=t.length;n<r;n++){const l=t[n];if(e.cc<=l.cc&&(!rs(e)||!rs(l)||e.sn<l.sn)||!s&&n==r-1)return this.emeController.selectKeySystemFormat(l).then(c=>{if(!this.emeController)return;l.setKeyFormat(c);const d=du(c);if(d)return this.emeController.getKeySystemAccess([d])})}if(this.config.requireKeySystemAccessOnStart){const n=to(this.config);if(n.length)return this.emeController.getKeySystemAccess(n)}}return null}load(e){return!e.decryptdata&&e.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(e).then(t=>this.loadInternal(e,t)):this.loadInternal(e)}loadInternal(e,t){var s,n;t&&e.setKeyFormat(t);const r=e.decryptdata;if(!r){const u=new Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:`Missing decryption data on fragment in onKeyLoading (emeEnabled with controller: ${this.emeController&&this.config.emeEnabled})`);return Promise.reject(this.createKeyLoadError(e,W.KEY_LOAD_ERROR,u))}const l=r.uri;if(!l)return Promise.reject(this.createKeyLoadError(e,W.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${l}"`)));const c=$f(r);let d=this.keyIdToKeyInfo[c];if((s=d)!=null&&s.decryptdata.key)return r.key=d.decryptdata.key,Promise.resolve({frag:e,keyInfo:d});if(this.emeController&&(n=d)!=null&&n.keyLoadPromise)switch(this.emeController.getKeyStatus(d.decryptdata)){case"usable":case"usable-in-future":return d.keyLoadPromise.then(f=>{const{keyInfo:g}=f;return r.key=g.decryptdata.key,{frag:e,keyInfo:g}})}switch(this.log(`${this.keyIdToKeyInfo[c]?"Rel":"L"}oading${r.keyId?" keyId: "+Cs(r.keyId):""} URI: ${r.uri} from ${e.type} ${e.level}`),d=this.keyIdToKeyInfo[c]={decryptdata:r,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},r.method){case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return r.keyFormat==="identity"?this.loadKeyHTTP(d,e):this.loadKeyEME(d,e);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(d,e);default:return Promise.reject(this.createKeyLoadError(e,W.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${r.method}"`)))}}loadKeyEME(e,t){const s={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){var n;if(!e.decryptdata.keyId&&(n=t.initSegment)!=null&&n.data){const l=Z1(t.initSegment.data);if(l.length){let c=l[0];c.some(d=>d!==0)?(this.log(`Using keyId found in init segment ${Cs(c)}`),Aa.setKeyIdForUri(e.decryptdata.uri,c)):(c=Aa.addKeyIdForUri(e.decryptdata.uri),this.log(`Generating keyId to patch media ${Cs(c)}`)),e.decryptdata.keyId=c}}if(!e.decryptdata.keyId&&!rs(t))return Promise.resolve(s);const r=this.emeController.loadKey(s);return(e.keyLoadPromise=r.then(l=>(e.mediaKeySessionContext=l,s))).catch(l=>{throw e.keyLoadPromise=null,"data"in l&&(l.data.frag=t),l})}return Promise.resolve(s)}loadKeyHTTP(e,t){const s=this.config,n=s.loader,r=new n(s);return t.keyLoader=e.loader=r,e.keyLoadPromise=new Promise((l,c)=>{const d={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},u=s.keyLoadPolicy.default,f={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},g={onSuccess:(y,x,S,E)=>{const{frag:T,keyInfo:A}=S,I=$f(A.decryptdata);if(!T.decryptdata||A!==this.keyIdToKeyInfo[I])return c(this.createKeyLoadError(T,W.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),E));A.decryptdata.key=T.decryptdata.key=new Uint8Array(y.data),T.keyLoader=null,A.loader=null,l({frag:T,keyInfo:A})},onError:(y,x,S,E)=>{this.resetLoader(x),c(this.createKeyLoadError(t,W.KEY_LOAD_ERROR,new Error(`HTTP Error ${y.code} loading key ${y.text}`),S,Lt({url:d.url,data:void 0},y)))},onTimeout:(y,x,S)=>{this.resetLoader(x),c(this.createKeyLoadError(t,W.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),S))},onAbort:(y,x,S)=>{this.resetLoader(x),c(this.createKeyLoadError(t,W.INTERNAL_ABORTED,new Error("key loading aborted"),S))}};r.load(d,f,g)})}resetLoader(e){const{frag:t,keyInfo:s,url:n}=e,r=s.loader;t.keyLoader===r&&(t.keyLoader=null,s.loader=null);const l=$f(s.decryptdata)||n;delete this.keyIdToKeyInfo[l],r&&r.destroy()}}function $f(i){if(i.keyFormat!==ks.FAIRPLAY){const e=i.keyId;if(e)return Cs(e)}return i.uri}function zx(i){const{type:e}=i;switch(e){case at.AUDIO_TRACK:return De.AUDIO;case at.SUBTITLE_TRACK:return De.SUBTITLE;default:return De.MAIN}}function Gf(i,e){let t=i.url;return(t===void 0||t.indexOf("data:")===0)&&(t=e.url),t}class DO{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.LEVEL_LOADING,this.onLevelLoading,this),e.on(L.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(L.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.on(L.LEVELS_UPDATED,this.onLevelsUpdated,this)}unregisterListeners(){const{hls:e}=this;e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.LEVEL_LOADING,this.onLevelLoading,this),e.off(L.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(L.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.off(L.LEVELS_UPDATED,this.onLevelsUpdated,this)}createInternalLoader(e){const t=this.hls.config,s=t.pLoader,n=t.loader,r=s||n,l=new r(t);return this.loaders[e.type]=l,l}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){const{url:s}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:at.MANIFEST,url:s,deliveryDirectives:null,levelOrTrack:null})}onLevelLoading(e,t){const{id:s,level:n,pathwayId:r,url:l,deliveryDirectives:c,levelInfo:d}=t;this.load({id:s,level:n,pathwayId:r,responseType:"text",type:at.LEVEL,url:l,deliveryDirectives:c,levelOrTrack:d})}onAudioTrackLoading(e,t){const{id:s,groupId:n,url:r,deliveryDirectives:l,track:c}=t;this.load({id:s,groupId:n,level:null,responseType:"text",type:at.AUDIO_TRACK,url:r,deliveryDirectives:l,levelOrTrack:c})}onSubtitleTrackLoading(e,t){const{id:s,groupId:n,url:r,deliveryDirectives:l,track:c}=t;this.load({id:s,groupId:n,level:null,responseType:"text",type:at.SUBTITLE_TRACK,url:r,deliveryDirectives:l,levelOrTrack:c})}onLevelsUpdated(e,t){const s=this.loaders[at.LEVEL];if(s){const n=s.context;n&&!t.levels.some(r=>r===n.levelOrTrack)&&(s.abort(),delete this.loaders[at.LEVEL])}}load(e){var t;const s=this.hls.config;let n=this.getInternalLoader(e);if(n){const u=this.hls.logger,f=n.context;if(f&&f.levelOrTrack===e.levelOrTrack&&(f.url===e.url||f.deliveryDirectives&&!e.deliveryDirectives)){f.url===e.url?u.log(`[playlist-loader]: ignore ${e.url} ongoing request`):u.log(`[playlist-loader]: ignore ${e.url} in favor of ${f.url}`);return}u.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),n.abort()}let r;if(e.type===at.MANIFEST?r=s.manifestLoadPolicy.default:r=Ot({},s.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),n=this.createInternalLoader(e),ke((t=e.deliveryDirectives)==null?void 0:t.part)){let u;if(e.type===at.LEVEL&&e.level!==null?u=this.hls.levels[e.level].details:e.type===at.AUDIO_TRACK&&e.id!==null?u=this.hls.audioTracks[e.id].details:e.type===at.SUBTITLE_TRACK&&e.id!==null&&(u=this.hls.subtitleTracks[e.id].details),u){const f=u.partTarget,g=u.targetduration;if(f&&g){const y=Math.max(f*3,g*.8)*1e3;r=Ot({},r,{maxTimeToFirstByteMs:Math.min(y,r.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(y,r.maxTimeToFirstByteMs)})}}}const l=r.errorRetry||r.timeoutRetry||{},c={loadPolicy:r,timeout:r.maxLoadTimeMs,maxRetry:l.maxNumRetry||0,retryDelay:l.retryDelayMs||0,maxRetryDelay:l.maxRetryDelayMs||0},d={onSuccess:(u,f,g,y)=>{const x=this.getInternalLoader(g);this.resetInternalLoader(g.type);const S=u.data;f.parsing.start=performance.now(),pn.isMediaPlaylist(S)||g.type!==at.MANIFEST?this.handleTrackOrLevelPlaylist(u,f,g,y||null,x):this.handleMasterPlaylist(u,f,g,y)},onError:(u,f,g,y)=>{this.handleNetworkError(f,g,!1,u,y)},onTimeout:(u,f,g)=>{this.handleNetworkError(f,g,!0,void 0,u)}};n.load(e,c,d)}checkAutostartLoad(){if(!this.hls)return;const{config:{autoStartLoad:e,startPosition:t},forceStartLoad:s}=this.hls;(e||s)&&(this.hls.logger.log(`${e?"auto":"force"} startLoad with configured startPosition ${t}`),this.hls.startLoad(t))}handleMasterPlaylist(e,t,s,n){const r=this.hls,l=e.data,c=Gf(e,s),d=pn.parseMasterPlaylist(l,c);if(d.playlistParsingError){t.parsing.end=performance.now(),this.handleManifestParsingError(e,s,d.playlistParsingError,n,t);return}const{contentSteering:u,levels:f,sessionData:g,sessionKeys:y,startTimeOffset:x,variableList:S}=d;this.variableList=S,f.forEach(I=>{const{unknownCodecs:_}=I;if(_){const{preferManagedMediaSource:C}=this.hls.config;let{audioCodec:k,videoCodec:D}=I;for(let O=_.length;O--;){const F=_[O];lo(F,"audio",C)?(I.audioCodec=k=k?`${k},${F}`:F,Zr.audio[k.substring(0,4)]=2,_.splice(O,1)):lo(F,"video",C)&&(I.videoCodec=D=D?`${D},${F}`:F,Zr.video[D.substring(0,4)]=2,_.splice(O,1))}}});const{AUDIO:E=[],SUBTITLES:T,"CLOSED-CAPTIONS":A}=pn.parseMasterPlaylistMedia(l,c,d);E.length&&!E.some(_=>!_.url)&&f[0].audioCodec&&!f[0].attrs.AUDIO&&(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),E.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new qt({}),bitrate:0,url:""})),r.trigger(L.MANIFEST_LOADED,{levels:f,audioTracks:E,subtitles:T,captions:A,contentSteering:u,url:c,stats:t,networkDetails:n,sessionData:g,sessionKeys:y,startTimeOffset:x,variableList:S})}handleTrackOrLevelPlaylist(e,t,s,n,r){const l=this.hls,{id:c,level:d,type:u}=s,f=Gf(e,s),g=ke(d)?d:ke(c)?c:0,y=zx(s),x=pn.parseLevelPlaylist(e.data,f,g,y,0,this.variableList);if(u===at.MANIFEST){const S={attrs:new qt({}),bitrate:0,details:x,name:"",url:f};x.requestScheduled=t.loading.start+Sb(x,0),l.trigger(L.MANIFEST_LOADED,{levels:[S],audioTracks:[],url:f,stats:t,networkDetails:n,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),s.levelDetails=x,this.handlePlaylistLoaded(x,e,t,s,n,r)}handleManifestParsingError(e,t,s,n,r){this.hls.trigger(L.ERROR,{type:je.NETWORK_ERROR,details:W.MANIFEST_PARSING_ERROR,fatal:t.type===at.MANIFEST,url:e.url,err:s,error:s,reason:s.message,response:e,context:t,networkDetails:n,stats:r})}handleNetworkError(e,t,s=!1,n,r){let l=`A network ${s?"timeout":"error"+(n?" (status "+n.code+")":"")} occurred while loading ${e.type}`;e.type===at.LEVEL?l+=`: ${e.level} id: ${e.id}`:(e.type===at.AUDIO_TRACK||e.type===at.SUBTITLE_TRACK)&&(l+=` id: ${e.id} group-id: "${e.groupId}"`);const c=new Error(l);this.hls.logger.warn(`[playlist-loader]: ${l}`);let d=W.UNKNOWN,u=!1;const f=this.getInternalLoader(e);switch(e.type){case at.MANIFEST:d=s?W.MANIFEST_LOAD_TIMEOUT:W.MANIFEST_LOAD_ERROR,u=!0;break;case at.LEVEL:d=s?W.LEVEL_LOAD_TIMEOUT:W.LEVEL_LOAD_ERROR,u=!1;break;case at.AUDIO_TRACK:d=s?W.AUDIO_TRACK_LOAD_TIMEOUT:W.AUDIO_TRACK_LOAD_ERROR,u=!1;break;case at.SUBTITLE_TRACK:d=s?W.SUBTITLE_TRACK_LOAD_TIMEOUT:W.SUBTITLE_LOAD_ERROR,u=!1;break}f&&this.resetInternalLoader(e.type);const g={type:je.NETWORK_ERROR,details:d,fatal:u,url:e.url,loader:f,context:e,error:c,networkDetails:t,stats:r};if(n){const y=t?.url||e.url;g.response=Lt({url:y,data:void 0},n)}this.hls.trigger(L.ERROR,g)}handlePlaylistLoaded(e,t,s,n,r,l){const c=this.hls,{type:d,level:u,levelOrTrack:f,id:g,groupId:y,deliveryDirectives:x}=n,S=Gf(t,n),E=zx(n);let T=typeof n.level=="number"&&E===De.MAIN?u:void 0;const A=e.playlistParsingError;if(A){if(this.hls.logger.warn(`${A} ${e.url}`),!c.config.ignorePlaylistParsingErrors){c.trigger(L.ERROR,{type:je.NETWORK_ERROR,details:W.LEVEL_PARSING_ERROR,fatal:!1,url:S,error:A,reason:A.message,response:t,context:n,level:T,parent:E,networkDetails:r,stats:s});return}e.playlistParsingError=null}if(!e.fragments.length){const I=e.playlistParsingError=new Error("No Segments found in Playlist");c.trigger(L.ERROR,{type:je.NETWORK_ERROR,details:W.LEVEL_EMPTY_ERROR,fatal:!1,url:S,error:I,reason:I.message,response:t,context:n,level:T,parent:E,networkDetails:r,stats:s});return}switch(e.live&&l&&(l.getCacheAge&&(e.ageHeader=l.getCacheAge()||0),(!l.getCacheAge||isNaN(e.ageHeader))&&(e.ageHeader=0)),d){case at.MANIFEST:case at.LEVEL:if(T){if(!f)T=0;else if(f!==c.levels[T]){const I=c.levels.indexOf(f);I>-1&&(T=I)}}c.trigger(L.LEVEL_LOADED,{details:e,levelInfo:f||c.levels[0],level:T||0,id:g||0,stats:s,networkDetails:r,deliveryDirectives:x,withoutMultiVariant:d===at.MANIFEST});break;case at.AUDIO_TRACK:c.trigger(L.AUDIO_TRACK_LOADED,{details:e,track:f,id:g||0,groupId:y||"",stats:s,networkDetails:r,deliveryDirectives:x});break;case at.SUBTITLE_TRACK:c.trigger(L.SUBTITLE_TRACK_LOADED,{details:e,track:f,id:g||0,groupId:y||"",stats:s,networkDetails:r,deliveryDirectives:x});break}}}class xi{static get version(){return uo}static isMSESupported(){return xT()}static isSupported(){return wO()}static getMediaSource(){return Ia()}static get Events(){return L}static get MetadataSchema(){return vi}static get ErrorTypes(){return je}static get ErrorDetails(){return W}static get DefaultConfig(){return xi.defaultConfig?xi.defaultConfig:yO}static set DefaultConfig(e){xi.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new Ym,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;const t=this.logger=B1(e.debug||!1,"Hls instance",e.assetPlayerId),s=this.config=xO(xi.DefaultConfig,e,t);this.userConfig=e,s.progressive&&SO(s,t);const{abrController:n,bufferController:r,capLevelController:l,errorController:c,fpsController:d}=s,u=new c(this),f=this.abrController=new n(this),g=new Pw(this),y=s.interstitialsController,x=y?this.interstitialsController=new y(this,xi):null,S=this.bufferController=new r(this,g),E=this.capLevelController=new l(this),T=new d(this),A=new DO(this),I=s.contentSteeringController,_=I?new I(this):null,C=this.levelController=new LO(this,_),k=new IO(this),D=new OO(this.config,this.logger),O=this.streamController=new NO(this,g,D),F=this.gapController=new AO(this,g);E.setStreamController(O),T.setStreamController(O);const j=[A,C,O];x&&j.splice(1,0,x),_&&j.splice(1,0,_),this.networkControllers=j;const U=[f,S,F,E,T,k,g];this.audioTrackController=this.createController(s.audioTrackController,j);const K=s.audioStreamController;K&&j.push(this.audioStreamController=new K(this,g,D)),this.subtitleTrackController=this.createController(s.subtitleTrackController,j);const H=s.subtitleStreamController;H&&j.push(this.subtititleStreamController=new H(this,g,D)),this.createController(s.timelineController,U),D.emeController=this.emeController=this.createController(s.emeController,U),this.cmcdController=this.createController(s.cmcdController,U),this.latencyController=this.createController(RO,U),this.coreComponents=U,j.push(u);const ee=u.onErrorOut;typeof ee=="function"&&this.on(L.ERROR,ee,u),this.on(L.MANIFEST_LOADED,A.onManifestLoaded,A)}createController(e,t){if(e){const s=new e(this);return t&&t.push(s),s}return null}on(e,t,s=this){this._emitter.on(e,t,s)}once(e,t,s=this){this._emitter.once(e,t,s)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t,s=this,n){this._emitter.off(e,t,s,n)}listeners(e){return this._emitter.listeners(e)}emit(e,t,s){return this._emitter.emit(e,t,s)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(s){if(this.logger.error("An internal error happened while handling event "+e+'. Error message: "'+s.message+'". Here is a stacktrace:',s),!this.triggeringException){this.triggeringException=!0;const n=e===L.ERROR;this.trigger(L.ERROR,{type:je.OTHER_ERROR,details:W.INTERNAL_EXCEPTION,fatal:n,event:e,error:s}),this.triggeringException=!1}}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){this.logger.log("destroy"),this.trigger(L.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach(t=>t.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(t=>t.destroy()),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){if(!e||"media"in e&&!e.media){const r=new Error(`attachMedia failed: invalid argument (${e})`);this.trigger(L.ERROR,{type:je.OTHER_ERROR,details:W.ATTACH_MEDIA_ERROR,fatal:!0,error:r});return}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());const t="media"in e,s=t?e.media:e,n=t?e:{media:s};this._media=s,this.trigger(L.MEDIA_ATTACHING,n)}detachMedia(){this.logger.log("detachMedia"),this.trigger(L.MEDIA_DETACHING,{}),this._media=null}transferMedia(){this._media=null;const e=this.bufferController.transferMedia();return this.trigger(L.MEDIA_DETACHING,{transferMedia:e}),e}loadSource(e){this.stopLoad();const t=this.media,s=this._url,n=this._url=Um.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log(`loadSource:${n}`),t&&s&&(s!==n||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(L.MANIFEST_LOADING,{url:e})}get url(){return this._url}get hasEnoughToStart(){return this.streamController.hasEnoughToStart}get startPosition(){return this.streamController.startPositionValue}startLoad(e=-1,t){this.logger.log(`startLoad(${e+(t?", <skip seek to start>":"")})`),this.started=!0,this.resumeBuffering();for(let s=0;s<this.networkControllers.length&&(this.networkControllers[s].startLoad(e,t),!(!this.started||!this.networkControllers));s++);}stopLoad(){this.logger.log("stopLoad"),this.started=!1;for(let e=0;e<this.networkControllers.length&&(this.networkControllers[e].stopLoad(),!(this.started||!this.networkControllers));e++);}get loadingEnabled(){return this.started}get bufferingEnabled(){return this.streamController.bufferingEnabled}resumeBuffering(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach(e=>{e.resumeBuffering&&e.resumeBuffering()}))}pauseBuffering(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach(e=>{e.pauseBuffering&&e.pauseBuffering()}))}get inFlightFragments(){const e={[De.MAIN]:this.streamController.inFlightFrag};return this.audioStreamController&&(e[De.AUDIO]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(e[De.SUBTITLE]=this.subtititleStreamController.inFlightFrag),e}swapAudioCodec(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){this.logger.log("recoverMediaError");const e=this._media,t=e?.currentTime;this.detachMedia(),e&&(this.attachMedia(e),t&&this.startLoad(t))}removeLevel(e){this.levelController.removeLevel(e)}get sessionId(){let e=this._sessionId;return e||(e=this._sessionId=AN()),e}get levels(){const e=this.levelController.levels;return e||[]}get latestLevelDetails(){return this.streamController.getLevelDetails()||null}get loadLevelObj(){return this.levelController.loadLevelObj}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){this.logger.log(`set currentLevel:${e}`),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){this.logger.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){this.logger.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){this.logger.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){const e=this.levelController.startLevel;return e===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e}set startLevel(e){this.logger.log(`set startLevel:${e}`),e!==-1&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}set bandwidthEstimate(e){this.abrController.resetEstimator(e)}get abrEwmaDefaultEstimate(){const{bwEstimator:e}=this.abrController;return e?e.defaultEstimate:NaN}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(this.logger.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){xw(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;const s=e.length;for(let n=0;n<s;n++)if(e[n].maxBitrate>=t)return n;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:t,maxHdcpLevel:s}=this;let n;if(t===-1&&e!=null&&e.length?n=e.length-1:n=t,s)for(let r=n;r--;){const l=e[r].attrs["HDCP-LEVEL"];if(l&&l<=s)return r}return n}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(e){this.abrController.nextAutoLevel=e}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get maxBufferLength(){return this.streamController.maxBufferLength}setAudioOption(e){var t;return((t=this.audioTrackController)==null?void 0:t.setAudioOption(e))||null}setSubtitleOption(e){var t;return((t=this.subtitleTrackController)==null?void 0:t.setSubtitleOption(e))||null}get allAudioTracks(){const e=this.audioTrackController;return e?e.allAudioTracks:[]}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const t=this.audioTrackController;t&&(t.audioTrack=e)}get allSubtitleTracks(){const e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return e?e.subtitleDisplay:!1}set subtitleDisplay(e){const t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}set targetLatency(e){this.latencyController.targetLatency=e}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}get pathways(){return this.levelController.pathways}get pathwayPriority(){return this.levelController.pathwayPriority}set pathwayPriority(e){this.levelController.pathwayPriority=e}get bufferedToEnd(){var e;return!!((e=this.bufferController)!=null&&e.bufferedToEnd)}get interstitialsManager(){var e;return((e=this.interstitialsController)==null?void 0:e.interstitialsManager)||null}getMediaDecodingInfo(e,t=this.allAudioTracks){const s=ab(t);return ib(e,s,navigator.mediaCapabilities)}}xi.defaultConfig=void 0;const Gn=typeof HTMLVideoElement<"u"?HTMLVideoElement.prototype:{},PO="getVideoPlaybackQuality"in Gn||"webkitDecodedFrameCount"in Gn||"mozPresentedFrames"in Gn||"mozPaintedFrames"in Gn;if(!("requestVideoFrameCallback"in Gn)&&PO&&typeof requestAnimationFrame=="function"){Gn._rvfcpolyfillmap={};const i="getVideoPlaybackQuality"in Gn?e=>{const{totalFrameDelay:t,totalVideoFrames:s,droppedVideoFrames:n}=e.getVideoPlaybackQuality();return{presentedFrames:s-n,totalFrameDelay:t}}:e=>({presentedFrames:e.mozPresentedFrames||e.mozPaintedFrames||e.webkitDecodedFrameCount-(e.webkitDroppedFrameCount||0),totalFrameDelay:e.mozFrameDelay||0});Gn.requestVideoFrameCallback=function(e){const t=performance.now(),s=i(this),n=s.presentedFrames,r=(l,c)=>{const d=i(this),u=d.presentedFrames;if(u>n){const f=d.totalFrameDelay-s.totalFrameDelay||0,g=c-l;e(c,{presentationTime:c+f*1e3,expectedDisplayTime:c+g,width:this.videoWidth,height:this.videoHeight,mediaTime:Math.max(0,this.currentTime||0)+g/1e3,presentedFrames:u,processingDuration:f}),delete this._rvfcpolyfillmap[t]}else this._rvfcpolyfillmap[t]=requestAnimationFrame(f=>r(c,f))};return this._rvfcpolyfillmap[t]=requestAnimationFrame(l=>r(t,l)),t},Gn.cancelVideoFrameCallback=function(e){cancelAnimationFrame(this._rvfcpolyfillmap[e]),delete this._rvfcpolyfillmap[e]}}var el;(function(i){i.RAW="RAW",i.PROXY="PROXY",i.THROW="THROW",i.HANDLER="HANDLER"})(el||(el={}));var Si;(function(i){i.GET="GET",i.SET="SET",i.APPLY="APPLY",i.CONSTRUCT="CONSTRUCT",i.RELEASE="RELEASE"})(Si||(Si={}));const vm=Symbol("Abslink.proxy"),xm=Symbol("Abslink.releaseProxy"),yu=Symbol("Abslink.finalizer"),vu=Symbol("Abslink.thrown"),ST=i=>typeof i=="object"&&i!==null||typeof i=="function",UO={canHandle:i=>ST(i)&&vm in i,serialize(i,e){const t=i[vm];return BO(i,e,t),t},deserialize(i,e){return TT(e,void 0,i)}};function MO(i){"close"in i&&typeof i.close=="function"&&i.close()}const jO={canHandle:i=>ST(i)&&vu in i,serialize({value:i}){let e;return i instanceof Error?e={isError:!0,value:{message:i.message,name:i.name,stack:i.stack}}:e={isError:!1,value:i},e},deserialize(i){throw i.isError?Object.assign(new Error(i.value.message),i.value):i.value}},bT=new Map([["proxy",UO],["throw",jO]]);function FO(i,e){let t=e;const s=i.slice(0,-1);for(const l of s)Object.prototype.hasOwnProperty.call(t,l)&&(t=t[l]);const n=i[i.length-1],r=n?t[n]:t;return{parent:t,RawValue:r,lastSegment:n}}function BO(i,e,t){return e.on("message",function s(n){if(!n)return;const{id:r,type:l,path:c,markerID:d}={path:[],...n};if(d!==t)return;const u=(n.argumentList??[]).map(g=>zr(g,e));let f;try{const{parent:g,RawValue:y,lastSegment:x}=FO(c,i);switch(l){case Si.GET:f=y;break;case Si.SET:g[x]=zr(n.value,e),f=!0;break;case Si.APPLY:f=y.apply(g,u);break;case Si.CONSTRUCT:{const S=new y(...u);f=AT(S)}break;case Si.RELEASE:f=void 0;break;default:return}}catch(g){f={value:g,[vu]:0}}Promise.resolve(f).catch(g=>({value:g,[vu]:0})).then(g=>{const y=Mu(g,e);e.postMessage({...y,id:r,markerID:t}),l===Si.RELEASE&&(e.off("message",s),yu in i&&typeof i[yu]=="function"&&i[yu]())}).catch(g=>{const y=Mu({value:new TypeError("Unserializable return value"),[vu]:0},e);e.postMessage({...y,id:r,markerID:t})})}),i}function TT(i,e,t){const s=new Map;return i.on("message",n=>{if(!n?.id)return;const r=s.get(n.id);if(r)try{r(n)}finally{s.delete(n.id)}}),Sm({endpoint:i,pendingListeners:s,nextRequestId:1},[],e,t)}function iu(i){if(i)throw new Error("Proxy has been released and is not useable")}async function ET(i){await so(i,{type:Si.RELEASE}),MO(i.endpoint)}const Pu=new WeakMap,Uu="FinalizationRegistry"in globalThis&&new FinalizationRegistry(i=>{const e=(Pu.get(i)??0)-1;Pu.set(i,e),e===0&&ET(i).finally(()=>{i.pendingListeners.clear()})});function VO(i,e){const t=(Pu.get(e)??0)+1;Pu.set(e,t),Uu&&Uu.register(i,e,i)}function $O(i){Uu&&Uu.unregister(i)}function Sm(i,e=[],t=function(){},s){let n=!1;const r=new Map,l=new Proxy(t,{get(c,d){if(iu(n),d===xm)return async()=>{for(const g of r.values())g[xm]();r.clear(),$O(l),ET(i).finally(()=>{i.pendingListeners.clear()}),n=!0};if(d==="then"){if(e.length===0)return{then:()=>l};const g=so(i,{type:Si.GET,markerID:s,path:e.map(y=>y.toString())}).then(y=>zr(y,i.endpoint));return g.then.bind(g)}const u=r.get(d);if(u)return u;const f=Sm(i,[...e,d],void 0,s);return r.set(d,f),f},set(c,d,u){iu(n);const f=Mu(u,i.endpoint);return so(i,{type:Si.SET,markerID:s,path:[...e,d].map(g=>g.toString()),value:f}).then(g=>zr(g,i.endpoint))},apply(c,d,u){if(iu(n),e[e.length-1]==="bind")return Sm(i,e.slice(0,-1),void 0,s);const g=Kx(u,i);return so(i,{type:Si.APPLY,markerID:s,path:e.map(y=>y.toString()),argumentList:g}).then(y=>zr(y,i.endpoint))},construct(c,d){iu(n);const u=Kx(d,i);return so(i,{type:Si.CONSTRUCT,markerID:s,path:e.map(f=>f.toString()),argumentList:u}).then(f=>zr(f,i.endpoint))}});return VO(l,i),l}function Kx(i,e){return i.map(t=>Mu(t,e.endpoint))}function AT(i){return Object.assign(i,{[vm]:_T()})}function Mu(i,e){for(const[t,s]of bT)if(s.canHandle(i)){const n=s.serialize(i,e);return{type:el.HANDLER,name:t,value:n}}return{type:el.RAW,value:i}}function zr(i,e){switch(i.type){case el.HANDLER:return bT.get(i.name).deserialize(i.value,e);case el.RAW:return i.value}}function so(i,e){return new Promise(t=>{const s=_T();i.pendingListeners.set(s,t),i.endpoint.postMessage({id:s,...e})})}function _T(){return Math.trunc(Math.random()*Number.MAX_SAFE_INTEGER).toString()}function GO(i,e){const t=new WeakMap;return{on(s,n){const r=l=>n(l.data);"addEventListener"in i?i.addEventListener(s,r):"addListener"in i?i.addListener(s,r):i.on(s,r),t.set(n,r)},off(s,n){const r=t.get(n);"removeEventListener"in i?i.removeEventListener(s,r):"removeListener"in i?i.removeListener(s,r):i.off(s,r),t.delete(n)},postMessage(s){e.postMessage(s)},[yu]:()=>{i.terminate?.(),e.terminate?.()}}}function HO(i,e=i){return TT(GO(i,e))}var Hf,Yx;function zO(){if(Yx)return Hf;Yx=1;const i=typeof process<"u"&&!!process.hrtime,e=65535,t=10,s=i?1e9/t:1e3/t,n=i?()=>{const[l,c]=process.hrtime();return l*1e9+c}:()=>performance.now();function r(l){return(n()-l)/s&e}return Hf=function(l){const c=n(),d=t*(l||5),u=[0];let f=1,g=r(c)-1&e;return function(y){const x=r(c);let S=x-g&e;for(S>d&&(S=d),g=x;S--;)f===d&&(f=0),u[f]=u[f===0?d-1:f-1],f++;y&&(u[f-1]+=y);const E=u[f-1],T=u.length<d?0:u[f===d?0:f];return u.length<t?E:(E-T)*t/u.length}},Hf}var KO=zO();const qx=bm(KO);class YO{fps=qx(5);processingDuration=qx(5);droppedFrames=0;presentedFrames=0;mistimedFrames=0;_drop(){++this.droppedFrames}_startTime=0;_startFrame(){this._startTime=performance.now()}onsubtitleFrameCallback=(e,{fps:t,processingDuration:s,droppedFrames:n})=>console.info("%cFPS: %c%f %c| Frame Time: %c%d ms %c| Dropped Frames: %c%d %c| 5s Avg","color: #888","color: #0f0; font-weight: bold",t.toFixed(1),"color: #888","color: #0ff; font-weight: bold",s,"color: #888","color: #f00; font-weight: bold",n,"color: #888");_endFrame(e){++this.presentedFrames;const t=this.fps(1),s=performance.now(),n=this.processingDuration((s-this._startTime)/t),r=Math.max(0,s-e.expectedDisplayTime);r&&++this.mistimedFrames,this.onsubtitleFrameCallback?.(s,{fps:t,processingDuration:n,droppedFrames:this.droppedFrames,presentedFrames:this.presentedFrames,mistimedFrames:this.mistimedFrames,presentationTime:s,expectedDisplayTime:e.expectedDisplayTime+(r>0?t/1e3:0),frameDelay:r,width:e.width,height:e.height,mediaTime:e.mediaTime})}}const qO={rgb:"RGB",bt709:"BT709",bt470bg:"BT601",smpte170m:"BT601"};class qa{timeOffset;prescaleFactor;prescaleHeightLimit;maxRenderHeight;debug;renderer;ready;busy=!1;_video;_videoWidth=0;_videoHeight=0;_videoColorSpace=null;_canvas;_canvasParent;_ctrl=new AbortController;_ro=new ResizeObserver(async()=>{await this.ready,this.resize()});_destroyed=!1;_lastDemandTime;_skipped=!1;_worker;constructor(e){if(!globalThis.Worker)throw new Error("Worker not supported");if(!e)throw new Error("No options provided");if(!e.video&&!e.canvas)throw new Error("You should give video or canvas in options.");qa._test(),this.timeOffset=e.timeOffset??0,this._video=e.video,this._canvas=e.canvas??document.createElement("canvas"),this._video&&!e.canvas&&(this._canvasParent=document.createElement("div"),this._canvasParent.className="JASSUB",this._canvasParent.style.position="relative",this._canvas.style.display="block",this._canvas.style.position="absolute",this._canvas.style.pointerEvents="none",this._canvasParent.appendChild(this._canvas),this._video.insertAdjacentElement("afterend",this._canvasParent));const t=this._canvas.transferControlToOffscreen();this.debug=e.debug?new YO:null,this.prescaleFactor=e.prescaleFactor??1,this.prescaleHeightLimit=e.prescaleHeightLimit??1080,this.maxRenderHeight=e.maxRenderHeight??0,this._worker=e.workerUrl?new Worker(e.workerUrl,{name:"jassub-worker",type:"module"}):new Worker(new URL("/LegitFlix/Client/worker-7SB75w7h.js",import.meta.url),{name:"jassub-worker",type:"module"});const s=HO(this._worker),n=e.modernWasmUrl??new URL("/LegitFlix/Client/style.css",import.meta.url).href,r=e.wasmUrl??new URL("/LegitFlix/Client/style2.css",import.meta.url).href,l=e.availableFonts??{};!l["liberation sans"]&&!e.defaultFont&&(l["liberation sans"]=new URL("/LegitFlix/Client/style3.css",import.meta.url).href),this.ready=(async()=>{this.renderer=await new s({wasmUrl:qa._supportsSIMD?n:r,width:t.width,height:t.height,subUrl:e.subUrl,subContent:e.subContent??null,fonts:e.fonts??[],availableFonts:l,defaultFont:e.defaultFont??"liberation sans",debug:!!e.debug,libassMemoryLimit:e.libassMemoryLimit??0,libassGlyphLimit:e.libassGlyphLimit??0,queryFonts:e.queryFonts??"local"},AT(c=>this._getLocalFont(c))),await this.renderer.ready()})(),this._video&&this.setVideo(this._video),this._worker.postMessage({name:"offscreenCanvas",ctrl:t},[t])}static _supportsSIMD;static _test(){if(qa._supportsSIMD!=null)return;try{qa._supportsSIMD=WebAssembly.validate(Uint8Array.of(0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11))}catch{qa._supportsSIMD=!1}const e=new WebAssembly.Module(Uint8Array.of(0,97,115,109,1,0,0,0));if(!(e instanceof WebAssembly.Module)||!(new WebAssembly.Instance(e)instanceof WebAssembly.Instance))throw new Error("WASM not supported")}async resize(e=!!this._video?.paused,t=0,s=0,n=0,r=0){if((!t||!s)&&this._video){const l=this._getVideoPosition();let c=null;if(this._videoWidth){const d=this._video.videoWidth/this._videoWidth,u=this._video.videoHeight/this._videoHeight;c=this._computeCanvasSize((l.width||0)/d,(l.height||0)/u)}else c=this._computeCanvasSize(l.width||0,l.height||0);t=c.width,s=c.height,this._canvasParent&&(n=l.y-(this._canvasParent.getBoundingClientRect().top-this._video.getBoundingClientRect().top),r=l.x),this._canvas.style.width=l.width+"px",this._canvas.style.height=l.height+"px"}this._canvasParent&&(this._canvas.style.top=n+"px",this._canvas.style.left=r+"px"),await this.renderer._resizeCanvas(t,s,(this._videoWidth||this._video?.videoWidth)??t,(this._videoHeight||this._video?.videoHeight)??s),this._lastDemandTime&&await this._demandRender(e)}_getVideoPosition(e=this._video.videoWidth,t=this._video.videoHeight){const s=e/t,{offsetWidth:n,offsetHeight:r}=this._video,l=n/r;e=n,t=r,l>s?e=Math.floor(r*s):t=Math.floor(n/s);const c=(n-e)/2,d=(r-t)/2;return{width:e,height:t,x:c,y:d}}_computeCanvasSize(e=0,t=0){const s=this.prescaleFactor<=0?1:this.prescaleFactor,n=self.devicePixelRatio||1;if(t<=0||e<=0)e=0,t=0;else{const r=s<1?-1:1;let l=t*n;r*l*s<=r*this.prescaleHeightLimit?l*=s:r*l<r*this.prescaleHeightLimit&&(l=this.prescaleHeightLimit),this.maxRenderHeight>0&&l>this.maxRenderHeight&&(l=this.maxRenderHeight),e*=l/t,t=l}return{width:e,height:t}}async setVideo(e){if(e instanceof HTMLVideoElement)this._removeListeners(),this._video=e,await this.ready,this._video.requestVideoFrameCallback((t,s)=>this._handleRVFC(s)),"VideoFrame"in globalThis&&(e.addEventListener("loadedmetadata",()=>this._updateColorSpace(),this._ctrl),e.readyState>2&&this._updateColorSpace()),e.videoWidth>0&&this.resize(),this._ro.observe(e);else throw new Error("Video element invalid!")}async _getLocalFont(e,t="regular"){if(navigator.permissions?.query){const{state:s}=await navigator.permissions.query({name:"local-fonts"});if(s!=="granted")return}for(const s of await self.queryLocalFonts()){const n=s.family.toLowerCase(),r=s.style.toLowerCase();if(n===e&&r===t){const l=await s.blob();return new Uint8Array(await l.arrayBuffer())}}}_handleRVFC(e){this._destroyed||(this._lastDemandTime=e,this._demandRender(),this._video.requestVideoFrameCallback((t,s)=>this._handleRVFC(s)))}async _demandRender(e=!1){const{mediaTime:t,width:s,height:n}=this._lastDemandTime;if(s!==this._videoWidth||n!==this._videoHeight)return this._videoWidth=s,this._videoHeight=n,await this.resize(e);if(this.busy){this._skipped=!0,this.debug?._drop();return}this.busy=!0,this._skipped=!1,this.debug?._startFrame(),await this.renderer._draw(t+this.timeOffset,e),this.debug?._endFrame(this._lastDemandTime),this.busy=!1,this._skipped&&await this._demandRender()}async _updateColorSpace(){await this.ready,this._video.requestVideoFrameCallback(async()=>{try{const e=new VideoFrame(this._video);e.close(),await this.renderer._setColorSpace(qO[e.colorSpace.matrix])}catch(e){console.warn(e)}})}_removeListeners(){this._video&&(this._ro&&this._ro.unobserve(this._video),this._ctrl.abort(),this._ctrl=new AbortController)}async destroy(){this._destroyed||(this._destroyed=!0,this._video&&this._canvasParent&&this._video.parentNode?.removeChild(this._canvasParent),this._removeListeners(),await this.renderer?.[xm](),this._worker.terminate())}}const IT=({isOpen:i,onClose:e,settingsTab:t,setSettingsTab:s,maxBitrate:n,setMaxBitrate:r,audioStreams:l,selectedAudioIndex:c,onSelectAudio:d,subtitleStreams:u,selectedSubtitleIndex:f,onSelectSubtitle:g,onOpenSubtitleSearch:y,onDeleteSubtitle:x,playbackRate:S,setPlaybackRate:E,autoPlay:T,setAutoPlay:A,autoSkipIntro:I,setAutoSkipIntro:_,autoSkipOutro:C,setAutoSkipOutro:k,updateConfig:D})=>{if(!i)return null;const O=()=>p.jsxs("div",{className:"setting-section",children:[p.jsx("h3",{className:"setting-title",children:"Quality"}),p.jsx("p",{className:"setting-desc",children:"Select maximum playback bitrate."}),p.jsxs("div",{className:"settings-list",children:[p.jsxs("button",{className:`lf-btn ${n?"lf-btn--secondary":"lf-btn--primary"}`,onClick:()=>r(null),style:{width:"100%",marginBottom:"8px",justifyContent:"flex-start"},children:["Auto",!n&&p.jsx("span",{className:"material-icons",style:{marginLeft:"auto",fontSize:"18px"},children:"check"})]}),p.jsxs("button",{className:`lf-btn ${n===12e7?"lf-btn--primary":"lf-btn--secondary"}`,onClick:()=>r(12e7),style:{width:"100%",marginBottom:"8px",justifyContent:"flex-start"},children:["4K (120Mbps)",n===12e7&&p.jsx("span",{className:"material-icons",style:{marginLeft:"auto",fontSize:"18px"},children:"check"})]}),p.jsxs("button",{className:`lf-btn ${n===6e7?"lf-btn--primary":"lf-btn--secondary"}`,onClick:()=>r(6e7),style:{width:"100%",marginBottom:"8px",justifyContent:"flex-start"},children:["1080p High (60Mbps)",n===6e7&&p.jsx("span",{className:"material-icons",style:{marginLeft:"auto",fontSize:"18px"},children:"check"})]}),p.jsxs("button",{className:`lf-btn ${n===2e7?"lf-btn--primary":"lf-btn--secondary"}`,onClick:()=>r(2e7),style:{width:"100%",marginBottom:"8px",justifyContent:"flex-start"},children:["1080p (20Mbps)",n===2e7&&p.jsx("span",{className:"material-icons",style:{marginLeft:"auto",fontSize:"18px"},children:"check"})]}),p.jsxs("button",{className:`lf-btn ${n===1e7?"lf-btn--primary":"lf-btn--secondary"}`,onClick:()=>r(1e7),style:{width:"100%",marginBottom:"8px",justifyContent:"flex-start"},children:["720p (10Mbps)",n===1e7&&p.jsx("span",{className:"material-icons",style:{marginLeft:"auto",fontSize:"18px"},children:"check"})]})]})]}),F=()=>p.jsxs("div",{className:"setting-section",children:[p.jsx("h3",{className:"setting-title",children:"Audio Streams"}),p.jsxs("div",{className:"settings-list",children:[l.length===0&&p.jsx("p",{className:"setting-desc",children:"No audio streams found."}),l.map(H=>p.jsxs("button",{className:`lf-btn ${c===H.Index?"lf-btn--primary":"lf-btn--secondary"}`,onClick:()=>d(H.Index),style:{width:"100%",marginBottom:"8px",justifyContent:"flex-start"},children:[H.Language||"Unknown"," - ",H.Codec," ",H.Title?`(${H.Title})`:"",c===H.Index&&p.jsx("span",{className:"material-icons",style:{marginLeft:"auto",fontSize:"18px"},children:"check"})]},H.Index))]})]}),j=()=>p.jsxs("div",{className:"setting-section",children:[p.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},children:[p.jsx("h3",{className:"setting-title",style:{margin:0},children:"Subtitles"}),p.jsxs("button",{className:"lf-btn lf-btn--secondary",onClick:y,style:{padding:"6px 12px",fontSize:"0.85rem"},children:[p.jsx("span",{className:"material-icons",style:{fontSize:"16px",marginRight:"6px"},children:"search"}),"Download"]})]}),p.jsxs("div",{className:"settings-list",children:[p.jsx("button",{className:`lf-btn ${f===null?"lf-btn--primary":"lf-btn--secondary"}`,onClick:()=>g(null),style:{width:"100%",marginBottom:"8px",justifyContent:"flex-start"},children:"Off"}),u.map(H=>p.jsxs("div",{style:{display:"flex",gap:"8px",marginBottom:"8px"},children:[p.jsxs("button",{className:`lf-btn ${f===H.Index?"lf-btn--primary":"lf-btn--secondary"}`,onClick:()=>g(H.Index),style:{flex:1,justifyContent:"flex-start"},children:[H.Language||"Unknown"," ",H.Title?`(${H.Title})`:""," ",H.IsForced?"[Forced]":""," ",H.IsExternal?"(Ext)":"",f===H.Index&&p.jsx("span",{className:"material-icons",style:{marginLeft:"auto",fontSize:"18px"},children:"check"})]}),H.IsExternal&&p.jsx("button",{className:"lf-btn lf-btn--secondary",onClick:ee=>{ee.stopPropagation(),x(H.Index)},title:"Delete Subtitle",style:{width:"40px",padding:0,justifyContent:"center"},children:p.jsx("span",{className:"material-icons",style:{fontSize:"18px",color:"#ff4444"},children:"delete_outline"})})]},H.Index))]})]}),U=()=>p.jsxs("div",{className:"setting-section",children:[p.jsx("h3",{className:"setting-title",children:"Playback Speed"}),p.jsx("div",{className:"settings-list",children:[.5,.75,1,1.25,1.5,2].map(H=>p.jsxs("button",{className:`lf-btn ${S===H?"lf-btn--primary":"lf-btn--secondary"}`,onClick:()=>E(H),style:{width:"100%",marginBottom:"8px",justifyContent:"flex-start"},children:[H,"x",S===H&&p.jsx("span",{className:"material-icons",style:{marginLeft:"auto",fontSize:"18px"},children:"check"})]},H))})]}),K=()=>p.jsxs("div",{className:"setting-section",children:[p.jsx("h3",{className:"setting-title",children:"General"}),p.jsxs("div",{className:"setting-row",children:[p.jsxs("div",{children:[p.jsx("h4",{className:"setting-title",style:{fontSize:"0.95rem"},children:"Auto Play"}),p.jsx("p",{className:"setting-desc",children:"Automatically play videos on load"})]}),p.jsxs("label",{className:"toggle-switch",children:[p.jsx("input",{type:"checkbox",checked:T,onChange:H=>A(H.target.checked)}),p.jsx("span",{className:"slider"})]})]}),p.jsxs("div",{className:"setting-row",style:{marginTop:"16px"},children:[p.jsxs("div",{children:[p.jsx("h4",{className:"setting-title",style:{fontSize:"0.95rem"},children:"Auto Skip Intro"}),p.jsx("p",{className:"setting-desc",children:"Automatically skip intro sequences"})]}),p.jsxs("label",{className:"toggle-switch",children:[p.jsx("input",{type:"checkbox",checked:I,onChange:H=>{const ee=H.target.checked;_(ee),D&&D({autoSkipIntro:ee})}}),p.jsx("span",{className:"slider"})]})]}),p.jsxs("div",{className:"setting-row",style:{marginTop:"16px"},children:[p.jsxs("div",{children:[p.jsx("h4",{className:"setting-title",style:{fontSize:"0.95rem"},children:"Auto Skip Outro"}),p.jsx("p",{className:"setting-desc",children:"Automatically skip credits/outro"})]}),p.jsxs("label",{className:"toggle-switch",children:[p.jsx("input",{type:"checkbox",checked:C,onChange:H=>{const ee=H.target.checked;k(ee),D&&D({autoSkipOutro:ee})}}),p.jsx("span",{className:"slider"})]})]})]});return p.jsx("div",{className:"legit-settings-overlay",onClick:e,children:p.jsxs("div",{className:"legit-settings-modal",onClick:H=>H.stopPropagation(),style:{pointerEvents:"auto",flexDirection:"row",width:"800px",height:"500px",maxWidth:"95vw"},children:[p.jsxs("div",{className:"legit-settings-sidebar",children:[p.jsx("div",{className:"sidebar-header",children:p.jsx("h2",{children:"Settings"})}),p.jsxs("div",{className:"sidebar-tabs",children:[p.jsxs("button",{className:`sidebar-tab ${t==="Quality"?"active":""}`,onClick:()=>s("Quality"),children:[p.jsx("span",{className:"material-icons",children:"hd"})," Quality"]}),p.jsxs("button",{className:`sidebar-tab ${t==="Audio"?"active":""}`,onClick:()=>s("Audio"),children:[p.jsx("span",{className:"material-icons",children:"audiotrack"})," Audio"]}),p.jsxs("button",{className:`sidebar-tab ${t==="Subtitles"?"active":""}`,onClick:()=>s("Subtitles"),children:[p.jsx("span",{className:"material-icons",children:"subtitles"})," Subtitles"]}),p.jsxs("button",{className:`sidebar-tab ${t==="Speed"?"active":""}`,onClick:()=>s("Speed"),children:[p.jsx("span",{className:"material-icons",children:"speed"})," Speed"]}),p.jsxs("button",{className:`sidebar-tab ${t==="General"?"active":""}`,onClick:()=>s("General"),children:[p.jsx("span",{className:"material-icons",children:"room_service"})," General"]})]})]}),p.jsxs("div",{className:"legit-settings-content",children:[p.jsxs("div",{className:"content-header",children:[p.jsx("h2",{children:t}),p.jsx("button",{className:"close-btn-icon",onClick:e,children:p.jsx("span",{className:"material-icons",children:"close"})})]}),p.jsxs("div",{className:"content-body",children:[t==="Quality"&&O(),t==="Audio"&&F(),t==="Subtitles"&&j(),t==="Speed"&&U(),t==="General"&&K()]})]})]})})};IT.propTypes={isOpen:Et.bool.isRequired,onClose:Et.func.isRequired,settingsTab:Et.string.isRequired,setSettingsTab:Et.func.isRequired,maxBitrate:Et.number,setMaxBitrate:Et.func.isRequired,audioStreams:Et.array.isRequired,selectedAudioIndex:Et.number,onSelectAudio:Et.func.isRequired,subtitleStreams:Et.array.isRequired,selectedSubtitleIndex:Et.number,onSelectSubtitle:Et.func.isRequired,onOpenSubtitleSearch:Et.func.isRequired,onDeleteSubtitle:Et.func.isRequired,playbackRate:Et.number.isRequired,setPlaybackRate:Et.func.isRequired,autoPlay:Et.bool.isRequired,setAutoPlay:Et.func.isRequired,autoSkipIntro:Et.bool,setAutoSkipIntro:Et.func,autoSkipOutro:Et.bool,setAutoSkipOutro:Et.func,updateConfig:Et.func};const QO=()=>{const{id:i}=Fu(),e=js(),{config:t,updateConfig:s}=Wi(),n=w.useRef(null),r=w.useRef(null),l=w.useRef(null),c=w.useRef(null),d=w.useRef(null),[u,f]=w.useState(!0),[g,y]=w.useState(0),[x,S]=w.useState(0),[E,T]=w.useState(1),[A,I]=w.useState(1),[_,C]=w.useState(!1),[k,D]=w.useState(!0),[O,F]=w.useState(null),[j,U]=w.useState(!1),[K,H]=w.useState(1),[ee,re]=w.useState(!0),[de,M]=w.useState(!1),[V,q]=w.useState("Quality"),[ae,pe]=w.useState(null),[P,$]=w.useState(!1),[G,fe]=w.useState(null),[ge,_e]=w.useState(null),[Ne,Ge]=w.useState(null),[Be,pt]=w.useState(null),[At,Vt]=w.useState(0),[bt,gt]=w.useState(!1),[zt,Fe]=w.useState(null),[we,Ue]=w.useState([]),[qe,dt]=w.useState(null),[Ce,He]=w.useState([]),[Tt,rt]=w.useState([]),[Kt,ye]=w.useState(!1),[We,it]=w.useState(null),[ls,Ns]=w.useState(0),[os,Zi]=w.useState({x:0,y:0,totalWidth:0,totalHeight:0}),[Es,$t]=w.useState(!1);t?.player?.seekForward,t?.player?.seekBackward;const[As,Yt]=w.useState([]),[ii,Ai]=w.useState([]),[_i,xs]=w.useState(null),[Wt,Os]=w.useState(null),[Ds,Xt]=w.useState(!1),[Vs,ni]=w.useState(!1),[Ii,ai]=w.useState(null),[cs,$i]=w.useState(null),[ri,xn]=w.useState(null),[le,Oe]=w.useState(null),Qe=w.useRef(null),ts=w.useRef(null),Ie=w.useRef(null),ss=w.useRef({intro:!1,outro:!1}),_t=w.useCallback(async(se,xe,tt)=>{try{const nt=await te.getSeasons(se,xe);Ue(nt.Items||[]);const yt=tt||nt.Items?.[0]?.Id;dt(yt)}catch(nt){console.error("Failed to load seasons",nt)}},[]),[mt,Sn]=w.useState(null);w.useCallback(async se=>{try{const xe=await te.getTrickplayManifest(se);if(!xe)return;const tt=Object.keys(xe);if(tt.length===0)return;const nt=xe[tt[0]],yt=Object.keys(nt).map(Number).sort((ps,us)=>ps-us);if(yt.length===0)return;const Mt=yt[0],ht=nt[Mt];Sn({itemId:se,width:Mt,interval:ht.Interval,tileWidth:ht.TileWidth,tileHeight:ht.TileHeight,thumbWidth:ht.Width,thumbHeight:ht.Height,thumbnailCount:ht.ThumbnailCount}),console.log("[Trickplay] Loaded:",{width:Mt,interval:ht.Interval,cols:ht.TileWidth,rows:ht.TileHeight,thumbs:ht.ThumbnailCount})}catch(xe){console.warn("Failed to load trickplay data",xe)}},[]);const Ji=w.useCallback(async()=>{try{D(!0),F(null);const se=await te.getCurrentUser();if(!se){e("/login");return}const xe=await te.getItemDetails(se.Id,i);if(fe(xe),$t(xe.UserData?.IsFavorite||!1),ss.current&&(ss.current={intro:!1,outro:!1}),xe.MediaSources&&xe.MediaSources.length>0){const tt=xe.MediaSources[0];_e(tt.Id);const nt=tt.MediaStreams||[],yt=nt.filter(us=>us.Type==="Audio"),Mt=nt.filter(us=>us.Type==="Subtitle");Yt(yt),Ai(Mt);const ht=yt.find(us=>us.Index===tt.DefaultAudioStreamIndex);ht?xs(ht.Index):yt.length>0&&xs(yt[0].Index);const ps=Mt.find(us=>us.Index===tt.DefaultSubtitleStreamIndex);Os(ps?ps.Index:-1)}xe.Type==="Episode"&&xe.SeriesId&&_t(se.Id,xe.SeriesId,xe.SeasonId),D(!1)}catch(se){console.error("Failed to load item",se),F("Failed to load video."),D(!1)}},[i,e]);w.useEffect(()=>{Ji()},[Ji]);const Xu=async se=>{if(window.confirm("Are you sure you want to delete this subtitle?"))try{await te.deleteSubtitle(G.Id,se),Ji()}catch(xe){console.error("Failed to delete subtitle:",xe),alert("Failed to delete subtitle")}};w.useEffect(()=>{if(!G)return;d.current===G.Id?n.current&&n.current.currentTime>0&&(console.log("[Player] Stream switch detected. Saving time:",n.current.currentTime),c.current=n.current.currentTime):(c.current=null,d.current=G.Id);const se=te.getStreamUrl(G.Id,_i,Wt,ge,ae);Ge(se)},[G,_i,Wt,ae,ge]),w.useEffect(()=>{qe&&G?.SeriesId&&(async()=>{ye(!0);try{const xe=await te.getCurrentUser(),tt=await te.getEpisodes(xe.Id,G.SeriesId,qe);He(tt.Items||[])}catch(xe){console.error("Failed to load episodes",xe)}finally{ye(!1)}})()},[qe,G?.SeriesId]),w.useEffect(()=>{if(G&&G.Type==="Episode"&&Ce.length>0){const se=Ce.findIndex(xe=>xe.Id===G.Id);se!==-1&&se<Ce.length-1?Oe(Ce[se+1].Id):Oe(null)}},[G,Ce]);const Zu=se=>{if(!x)return;const xe=se.currentTarget.getBoundingClientRect(),tt=se.clientX-xe.left,nt=Math.max(0,Math.min(1,tt/xe.width)),yt=nt*x;if(pt(yt),Vt(nt),gt(!0),mt){const{itemId:Mt,width:ht,interval:ps,tileWidth:us,tileHeight:Qn}=mt,ar=us*Qn,Wn=Math.floor(yt*1e3/ps),ll=Math.floor(Wn/ar),rr=Wn%ar,Hs=rr%us,Hi=Math.floor(rr/us),ol=te.getTrickplayTileUrl(Mt,ht,ll);Fe(ol),Zi({x:-(Hs*mt.thumbWidth),y:-(Hi*mt.thumbHeight),totalWidth:us*mt.thumbWidth,totalHeight:Qn*mt.thumbHeight})}},Eo=()=>{gt(!1),pt(null),Fe(null)};w.useEffect(()=>{if(!Ne)return;const se=async()=>{const xe=n.current;if(xe&&(c.current!==null&&(console.log("[Player] Restoring position to:",c.current),xe.currentTime=c.current,c.current=null),D(!1),u))try{await xe.play()}catch(tt){console.warn("Autoplay with sound blocked. Falling back to muted.",tt),xe.muted=!0,C(!0);try{await xe.play()}catch(nt){console.error("Autoplay failed completely.",nt)}}};if(xi.isSupported()){ts.current&&ts.current.destroy();const xe=new xi({capLevelToPlayerSize:!0,autoStartLoad:!0});xe.loadSource(Ne),xe.attachMedia(n.current),ts.current=xe,xe.on(xi.Events.MANIFEST_PARSED,()=>{se()}),xe.on(xi.Events.ERROR,(tt,nt)=>{if(nt.fatal)switch(console.error("HLS Fatal Error",nt),nt.type){case xi.ErrorTypes.NETWORK_ERROR:xe.startLoad();break;case xi.ErrorTypes.MEDIA_ERROR:xe.recoverMediaError();break;default:xe.destroy();break}})}else if(n.current.canPlayType("application/vnd.apple.mpegurl")){n.current.src=Ne;const xe=()=>{se(),n.current.removeEventListener("loadedmetadata",xe)};n.current.addEventListener("loadedmetadata",xe)}else{n.current.src=Ne;const xe=()=>{se(),n.current.removeEventListener("loadedmetadata",xe)};n.current.addEventListener("loadedmetadata",xe)}return()=>{ts.current&&ts.current.destroy()}},[Ne]),w.useEffect(()=>{const se=n.current;se&&(Math.abs(se.volume-E)>.01&&(se.volume=E),se.muted!==_&&(se.muted=_))},[E,_]),w.useEffect(()=>{n.current&&(n.current.playbackRate=K)},[K]),w.useEffect(()=>{const se=n.current;if(!se)return;l.current&&(l.current.destroy(),l.current=null),se.querySelectorAll("track").forEach(ht=>ht.remove());for(let ht=0;ht<se.textTracks.length;ht++)se.textTracks[ht].mode="disabled";if(Wt===null||Wt===-1||!G?.Id||!ge){console.log("[Subtitles] Subtitles off");return}const tt=ii.find(ht=>ht.Index===Wt);if(!tt)return;const nt=(tt.Codec||"").toLowerCase();if(console.log("[Subtitles] Loading:",tt.Language,"Codec:",nt),nt==="ass"||nt==="ssa"){(()=>{const ps=te.getRawSubtitleUrl(G.Id,ge,Wt,"ass");try{l.current=new qa({video:se,subUrl:ps,workerUrl:"/jassub-worker.js",wasmUrl:"/jassub-worker.wasm",onDemand:!0})}catch(us){console.error("[Subtitles] JASSUB failed to initialize",us)}})();return}if(nt==="srt"||nt==="subrip"){(async()=>{try{const ps=te.getRawSubtitleUrl(G.Id,ge,Wt,"srt"),us=localStorage.getItem("jellyfin_accessToken")||te.api?.accessToken,Qn=await fetch(ps,{headers:{Authorization:`MediaBrowser Token="${us}"`}});if(!Qn.ok)throw new Error("Failed to fetch SRT");const Wn=`WEBVTT

`+(await Qn.text()).replace(/(\d{2}:\d{2}:\d{2}),(\d{3})/g,"$1.$2"),ll=new Blob([Wn],{type:"text/vtt"}),rr=URL.createObjectURL(ll),Hs=document.createElement("track");Hs.kind="subtitles",Hs.label=tt.Language||"Unknown",Hs.srclang=tt.Language||"und",Hs.src=rr,Hs.default=!0,se.appendChild(Hs),Hs.track.mode="showing"}catch(ps){console.error("[Subtitles] Failed to load/convert SRT",ps)}})();return}const yt=te.getSubtitleUrl(G.Id,ge,Wt),Mt=document.createElement("track");Mt.kind="subtitles",Mt.label=tt.Language||tt.Title||"Unknown",Mt.srclang=tt.Language||"und",Mt.src=yt,Mt.default=!0,se.appendChild(Mt),Mt.track.mode="showing"},[Wt,G?.Id,ge,ii]),w.useEffect(()=>()=>{l.current&&l.current.destroy()},[]),w.useEffect(()=>{if(!(!G||!n.current)&&G.UserData&&G.UserData.PlaybackPositionTicks){const se=G.UserData.PlaybackPositionTicks/1e7,xe=()=>{se>0&&se<n.current.duration&&(n.current.currentTime=se)};return n.current.addEventListener("loadedmetadata",xe),n.current.readyState>=1&&xe(),()=>n.current?.removeEventListener("loadedmetadata",xe)}},[G]),w.useEffect(()=>{if(!(!G||!ge))return Ie.current=setInterval(()=>{if(n.current&&!n.current.paused){const se=n.current.currentTime;te.reportPlaybackProgress(G.Id,Math.floor(se*1e7),!1,ge).catch(xe=>console.warn("Report progress failed",xe))}},1e4),()=>clearInterval(Ie.current)},[G,ge]);const Ri=w.useCallback(()=>{G&&n.current&&te.reportPlaybackStopped(G.Id,Math.floor(n.current.currentTime*1e7))},[G]);w.useEffect(()=>()=>{Ri()},[Ri]);const La=w.useCallback(()=>{n.current&&(n.current.paused?(n.current.play().catch(se=>console.log("Play prevented:",se)),f(!0)):(n.current.pause(),f(!1)))},[n]),li=se=>{it(se),setTimeout(()=>it(null),600)},bn=w.useCallback(()=>{if(n.current){const se=t.playerSeekForward||30;n.current.currentTime=Math.min(n.current.duration,n.current.currentTime+se),y(n.current.currentTime),li("fast_forward")}},[t.playerSeekForward]),Yn=w.useCallback(()=>{if(n.current){const se=t.playerSeekBackward||10;n.current.currentTime=Math.max(0,n.current.currentTime-se),y(n.current.currentTime),li("fast_rewind")}},[t.playerSeekBackward]),en=w.useCallback(()=>{document.fullscreenElement?document.exitFullscreen&&document.exitFullscreen():r.current&&r.current.requestFullscreen().catch(se=>{console.error(`Error attempting to enable full - screen mode: ${se.message} (${se.name})`)})},[]),is=w.useCallback(()=>{n.current&&(C(se=>!se),E===0&&T(1))},[E]);w.useEffect(()=>{const se=xe=>{if(!de)switch([" ","ArrowLeft","ArrowRight"].includes(xe.key)&&xe.preventDefault(),xe.key){case" ":case"k":La();break;case"ArrowLeft":Yn();break;case"ArrowRight":bn();break;case"f":en();break;case"m":is();break}};return document.addEventListener("keydown",se),()=>{document.removeEventListener("keydown",se)}},[u,de]);const Gi=w.useRef(null),al=w.useCallback(se=>{const xe=se.target;if(!(xe.closest("button")||xe.closest("input")||xe.closest("select")||xe.closest(".lf-skip-btn")||xe.closest(".center-play-btn")||xe.closest(".legit-settings-overlay")||xe.closest(".lf-player-back-button"))){if(Gi.current){clearTimeout(Gi.current),Gi.current=null;return}Gi.current=setTimeout(()=>{Gi.current=null,n.current&&(n.current.paused?(n.current.play().catch(tt=>console.log("Play prevented:",tt)),f(!0),li("play_arrow")):(n.current.pause(),f(!1),li("pause"))),U(!0),Qe.current&&clearTimeout(Qe.current),Qe.current=setTimeout(()=>{U(!1)},3e3)},250)}},[n]),tn=w.useCallback(se=>{const xe=se.target;xe.closest("button")||xe.closest("input")||xe.closest("select")||xe.closest(".lf-settings-modal")||(Gi.current&&(clearTimeout(Gi.current),Gi.current=null),en())},[]),qn=w.useCallback(se=>{if(G?.Chapters&&Math.floor(se)%5===0&&console.log("Current Chapters:",G.Chapters.map(tt=>tt.Name)),!G?.Chapters||G.Chapters.length===0)return;const xe=G.Chapters.findIndex((tt,nt)=>{const yt=tt.StartPositionTicks/1e7,Mt=G.Chapters[nt+1],ht=Mt?Mt.StartPositionTicks/1e7:x;return se>=yt&&se<ht});if(xe!==-1){const yt=G.Chapters[xe].Name.toLowerCase().toLowerCase();if(yt.includes("intro")||yt.includes("opening")||yt==="op"||yt==="avant"){const Mt=G.Chapters[xe+1];if(Mt){const ht=Mt.StartPositionTicks/1e7;Xt(!0),ai(ht),t.autoSkipIntro&&!ss.current.intro&&n.current&&(ss.current.intro=!0,n.current.currentTime=ht,y(ht),li("skip_next"),console.log("[AutoSkip] Skipped intro to",ht));return}}else Xt(!1);yt.includes("outro")||yt.includes("ending")||yt.includes("credits")||yt==="ed"?(ni(!0),t.autoSkipOutro&&!ss.current.outro&&n.current&&(ss.current.outro=!0,le&&$s())):ni(!1)}else Xt(!1),ni(!1)},[G,x,t.autoSkipIntro,t.autoSkipOutro,le]),Ao=()=>{Ri(),window.history.length>2?e(-1):G&&G.SeriesId?e(`/series/${G.SeriesId}`):G&&G.ParentId?e("/ library"):e("/")},_o=se=>{if(n.current){const xe=n.current.currentTime;y(xe),S(n.current.duration||0),n.current.buffered.length>0&&Ns(n.current.buffered.end(n.current.buffered.length-1)),cs!==null&&ri!==null?xe>=cs&&xe<ri?Xt(!0):Xt(!1):cs===null&&ri===null&&!G?.Chapters&&Xt(!1),qn(xe)}},Io=()=>{},Ju=()=>{ee&&le?setTimeout(()=>$s(),1500):(f(!1),Ri(),U(!0))},tr=()=>{n.current&&Ii&&(n.current.currentTime=Ii,li("fast_forward"),Xt(!1))},sr=()=>{ni(!1),le?$s():n.current&&(n.current.currentTime=n.current.duration)},$s=()=>{le&&(Ri(),Yt([]),Ai([]),$i(null),Xt(!1),e(`/player/${le}`))},Gs=w.useCallback(()=>{U(!0),Qe.current&&clearTimeout(Qe.current),Qe.current=setTimeout(()=>{n.current&&!n.current.paused&&U(!1)},3e3)},[]),Ro=se=>{dt(se)},ed=se=>{se!==G.Id&&(Ri(),e(`/player/${se}`))},rl=async()=>{if(!(!G||!G.SeriesId))try{const se=await te.getCurrentUser(),xe=!Es;await te.markFavorite(se.Id,G.SeriesId,xe),$t(xe)}catch(se){console.error("Favorite toggle failed",se)}},ir=se=>{if(!se||isNaN(se))return"0:00";const xe=Math.floor(se/3600),tt=Math.floor(se%3600/60),nt=Math.floor(se%60);return xe>0?`${xe}:${tt.toString().padStart(2,"0")}:${nt.toString().padStart(2,"0")} `:`${tt}:${nt.toString().padStart(2,"0")} `},nr=x?g/x*100:0,td=x?ls/x*100:0;return p.jsxs("div",{className:"lf-player-page",children:[p.jsx(_a,{alwaysFilled:!0}),p.jsx("div",{ref:r,className:`lf-player-video-container ${document.fullscreenElement?"is-fullscreen":""}`,style:{cursor:j?"default":"none"},onMouseMove:Gs,onMouseLeave:()=>u&&U(!1),onClick:al,onDoubleClick:tn,children:p.jsxs("div",{className:"lf-player-video-wrapper",children:[p.jsx("video",{ref:n,className:"lf-player-video",playsInline:!0,autoPlay:ee,muted:_,onTimeUpdate:_o,onLoadedMetadata:Io,onEnded:Ju,onWaiting:()=>D(!0),onCanPlay:()=>D(!1),onClick:al,onDoubleClick:tn,crossOrigin:"anonymous"}),Ds&&p.jsx("button",{className:"lf-skip-btn",onClick:tr,children:"Skip Intro"}),Vs&&!Ds&&p.jsx("button",{className:"lf-skip-btn",onClick:sr,children:le?"Next Episode":"Skip Credits"}),k&&p.jsx("div",{className:"lf-player-loader",children:p.jsx("div",{className:"spinner"})}),O&&p.jsxs("div",{className:"lf-player-error",children:[p.jsx("div",{className:"error-icon",children:"!"}),p.jsx("p",{children:O}),p.jsx("button",{onClick:Ao,children:"Go Back"})]}),p.jsx("div",{className:`lf-player-center-icon ${We?"visible":""}`,children:p.jsx("span",{className:"material-icons",children:We})}),p.jsxs("div",{className:`lf-player-controls ${j?"visible":""}`,children:[p.jsxs("div",{className:"lf-player-controls-top",children:[p.jsx("button",{className:"icon-btn back-btn",onClick:Ao,children:p.jsx("span",{className:"material-icons",children:"arrow_back"})}),p.jsx("div",{className:"player-title",children:G?p.jsxs(p.Fragment,{children:[p.jsx("span",{className:"series-title",children:G.SeriesName}),G.SeriesName&&G.Name&&p.jsx("span",{className:"divider",children:"|"}),p.jsx("span",{className:"episode-title",children:G.Name})]}):"Loading..."})]}),!u&&!k&&!O&&!de&&p.jsx("button",{className:"center-play-btn",onClick:se=>{se.stopPropagation(),La()},children:p.jsx("span",{className:"material-icons",children:"play_arrow"})}),de&&p.jsx(IT,{isOpen:de,onClose:()=>M(!1),settingsTab:V,setSettingsTab:q,maxBitrate:ae,setMaxBitrate:pe,audioStreams:As,selectedAudioIndex:_i,onSelectAudio:xs,subtitleStreams:ii,selectedSubtitleIndex:Wt,onSelectSubtitle:Os,onOpenSubtitleSearch:()=>{M(!1),$(!0)},onDeleteSubtitle:Xu,playbackRate:K,setPlaybackRate:H,autoPlay:ee,setAutoPlay:re,autoSkipIntro:t?.autoSkipIntro,setAutoSkipIntro:se=>s({autoSkipIntro:se}),autoSkipOutro:t?.autoSkipOutro,setAutoSkipOutro:se=>s({autoSkipOutro:se}),updateConfig:s}),P&&p.jsx(Yu,{isOpen:P,onClose:()=>$(!1),seriesId:G?.SeriesId,initialSeasonId:qe||G?.SeasonId,initialEpisodeId:G?.Id,isMovie:G?.Type==="Movie",onSubtitleDownloaded:()=>{Ji(),$(!1)}}),p.jsxs("div",{className:"lf-player-controls-bottom",children:[p.jsxs("div",{className:"lf-player-timeline-container",onClick:se=>{se.stopPropagation();const xe=se.currentTarget.getBoundingClientRect(),nt=(se.clientX-xe.left)/xe.width*(x||0);n.current&&(n.current.currentTime=nt,y(nt))},onMouseMove:Zu,onMouseLeave:Eo,children:[p.jsxs("div",{className:"lf-player-timeline-track",children:[p.jsx("div",{className:"lf-player-timeline-buffered",style:{width:`${td}%`}}),p.jsx("div",{className:"lf-player-timeline-fill",style:{width:`${nr}%`},children:p.jsx("div",{className:"lf-player-timeline-thumb"})})]}),bt&&Be!==null&&p.jsxs("div",{className:"lf-timeline-tooltip",style:{left:`${At*100}%`},children:[zt&&os&&p.jsx("div",{className:"lf-timeline-thumbnail",style:{backgroundImage:`url(${zt})`,backgroundPosition:`${os.x}px ${os.y} px`,backgroundSize:`${os.totalWidth}px ${os.totalHeight} px`,width:`${mt?.thumbWidth||160} px`,height:`${mt?.thumbHeight||90} px`}}),p.jsx("span",{className:"lf-timeline-time",children:ir(Be)})]})]}),p.jsxs("div",{className:"lf-player-controls-row",children:[p.jsxs("div",{className:"controls-left",children:[p.jsx("button",{className:"icon-btn",onClick:se=>{se.stopPropagation(),La()},children:p.jsx("span",{className:"material-icons",children:u?"pause":"play_arrow"})}),p.jsx("button",{className:"icon-btn",onClick:se=>{se.stopPropagation(),Yn()},children:p.jsx("span",{className:"material-icons",children:"replay_10"})}),p.jsx("button",{className:"icon-btn",onClick:se=>{se.stopPropagation(),bn()},children:p.jsx("span",{className:"material-icons",children:"forward_30"})}),le&&p.jsx("button",{className:"icon-btn",onClick:se=>{se.stopPropagation(),$s()},title:"Next Episode",children:p.jsx("span",{className:"material-icons",children:"skip_next"})}),p.jsxs("div",{className:"volume-container",children:[p.jsx("button",{className:"icon-btn",onClick:se=>{se.stopPropagation(),is()},children:p.jsx("span",{className:"material-icons",children:_||E===0?"volume_off":E<.5?"volume_down":"volume_up"})}),p.jsx("div",{className:"volume-slider-wrapper",children:p.jsx("input",{type:"range",className:"volume-slider",min:"0",max:"1",step:"0.05",value:_?0:E,onChange:se=>{const xe=parseFloat(se.target.value);T(xe),n.current&&(n.current.volume=xe,n.current.muted=xe===0),C(xe===0),xe>0&&I(xe)},onClick:se=>se.stopPropagation()})})]}),p.jsxs("span",{className:"time-display",children:[ir(g)," / ",ir(x)]})]}),p.jsxs("div",{className:"controls-right",children:[p.jsx("button",{className:"icon-btn",onClick:se=>{se.stopPropagation(),M(!de)},children:p.jsx("span",{className:"material-icons",children:"settings"})}),p.jsx("button",{className:"icon-btn",onClick:se=>{se.stopPropagation(),en()},children:p.jsx("span",{className:"material-icons",children:document.fullscreenElement?"fullscreen_exit":"fullscreen"})})]})]})]})]})]})}),G&&G.Type==="Episode"&&p.jsxs("div",{className:"lf-player-content-container",children:[p.jsxs("div",{className:"lf-player-column-left",children:[p.jsxs("div",{className:"lf-player-header-row",children:[p.jsxs("div",{className:"lf-player-title-block",children:[p.jsx("h4",{className:"lf-series-link",onClick:()=>e(`/series/${G.SeriesId}`),children:G.SeriesName}),p.jsxs("h1",{className:"lf-episode-name",children:["E",G.IndexNumber," - ",G.Name]})]}),p.jsx("div",{className:"lf-player-actions",children:p.jsx("button",{className:`lf-action-btn ${Es?"is-active":""}`,onClick:rl,title:Es?"Remove from Watchlist":"Add to Watchlist",children:p.jsx("span",{className:"material-icons",children:Es?"bookmark":"bookmark_border"})})})]}),p.jsxs("div",{className:"lf-player-tags-row",children:[G.OfficialRating&&p.jsx("span",{className:"lf-tag-rating",children:G.OfficialRating}),p.jsx("span",{className:"lf-tag-text",children:"Sub | Dub"}),G.PremiereDate&&p.jsxs("span",{className:"lf-release-date",children:["Released on ",new Date(G.PremiereDate).toLocaleDateString()]})]}),p.jsxs("div",{className:"lf-player-metadata",children:[p.jsx("h1",{children:G.Name}),p.jsx("p",{className:"lf-player-description",children:G.Overview})]})]}),p.jsx("div",{className:"lf-player-column-right",children:p.jsxs("div",{className:"lf-player-episodes-panel",children:[p.jsxs("div",{className:"lf-episodes-panel-header",children:[p.jsx("span",{className:"lf-panel-title",children:"Episodes"}),p.jsxs("div",{className:"season-select-wrapper",children:[p.jsx("select",{className:"lf-season-dropdown",value:qe||"",onChange:se=>Ro(se.target.value),children:we.map(se=>p.jsx("option",{value:se.Id,children:se.Name},se.Id))}),p.jsx("span",{className:"material-icons dropdown-icon",children:"expand_more"})]})]}),p.jsx("div",{className:"lf-episodes-grid",children:Kt?p.jsx("div",{className:"loading-txt",children:"Loading..."}):Ce.map(se=>p.jsxs("div",{className:`lf-episode-card-small ${se.Id===G.Id?"current":""}`,onClick:()=>ed(se.Id),children:[p.jsxs("div",{className:"ep-card-img",children:[p.jsx("img",{src:te.getImageUrl(se,"Primary",{maxWidth:300}),alt:se.Name,onError:xe=>xe.target.style.display="none"}),se.Id===G.Id&&p.jsx("div",{className:"ep-playing-overlay",children:p.jsx("span",{className:"material-icons",children:"play_circle"})})]}),p.jsxs("div",{className:"ep-card-info",children:[p.jsxs("div",{className:"ep-card-title",children:[p.jsxs("span",{className:"ep-prefix",children:["E",se.IndexNumber]})," - ",se.Name]}),p.jsx("div",{className:"ep-card-meta",children:"Sub | Dub"})]})]},se.Id))})]})})]})]})};function WO(){const{config:i}=Wi();return p.jsxs(p.Fragment,{children:[i.appBackground&&p.jsx("div",{style:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",backgroundImage:`url('${i.appBackground}')`,backgroundSize:"cover",backgroundPosition:"center",zIndex:-1,opacity:.3,filter:"grayscale(0.5) brightness(0.5)"}}),p.jsxs(uI,{children:[p.jsx(C1,{}),p.jsxs(B_,{children:[p.jsx(Mi,{path:"/login",element:p.jsx(L1,{})}),p.jsx(Mi,{path:"/login/select-server",element:p.jsx(I1,{})}),p.jsx(Mi,{path:"/login/select-user",element:p.jsx(R1,{})}),p.jsxs(Mi,{element:p.jsx(w1,{}),children:[p.jsx(Mi,{path:"/",element:p.jsx(Av,{})}),p.jsx(Mi,{path:"/series/:id",element:p.jsx(T1,{})}),p.jsx(Mi,{path:"/movie/:id",element:p.jsx(E1,{})}),p.jsx(Mi,{path:"/item/:id",element:p.jsx(k1,{})}),p.jsx(Mi,{path:"/profile",element:p.jsx(_1,{})}),p.jsx(Mi,{path:"/play/:id",element:p.jsx(QO,{})}),p.jsx(Mi,{path:"*",element:p.jsx(Av,{})})]})]})]})]})}function XO(){return p.jsx(TI,{children:p.jsx(WO,{})})}FA.createRoot(document.getElementById("root")).render(p.jsx(w.StrictMode,{children:p.jsx(XO,{})}));
